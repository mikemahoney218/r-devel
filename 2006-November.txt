From jmc at r-project.org  Wed Nov  1 00:18:08 2006
From: jmc at r-project.org (John Chambers)
Date: Tue, 31 Oct 2006 18:18:08 -0500
Subject: [Rd] setReplaceMethod
In-Reply-To: <5959F116-B18B-4D0D-BD64-02F8B6EA880E@soc.soton.ac.uk>
References: <5959F116-B18B-4D0D-BD64-02F8B6EA880E@soc.soton.ac.uk>
Message-ID: <4547D9B0.3080505@r-project.org>

There's a two-level issue here, principle and practice.

The principle is that the behavior of basic R functions on basic R data 
types is considered "sealed".  Math functions, arithmetic, etc. on basic 
vectors are not supposed to be alterable.

The function "[<-" is one of those functions.  If x is a basic vector 
type, then x[i] <- value is considered sealed.  That's what the error 
message is telling you.  (By the way setReplaceMethod() has nothing to 
do with the issue; it's just a way of relieving the programmer from 
knowing that x[i]<-value is really a call to the function "[<-"; again, 
the error message shows that.)

Since you are writing the method for x having class "ANY", that is even 
stronger than changing the behavior for a specific basic type.

If you were to convince the R management that in principle having a 
special class on the right side justified breaking the seal (and that 
would take some arguing), then there is a practical problem.

The current implementation of primitives in C code examines the first 
argument only (except for binary operators, where both arguments are 
examined).  The object is examined for having a non-basic class.  If 
it's a basic data type, no further checking for methods occurs.  So even 
if you were allowed to define the method, it wouldn't get called if x 
was a numeric vector, for example.  Changing that would require changes 
at a low level, and almost certainly add some overhead to all calls.  
Expect opposition.

Otherwise, you must define some class and only expect your assignment to 
promote x if x  inherits from that class.  Or have another function, not 
"[<-", as the generic.

By the way, your method definition is not what you wanted in any case.  
The signature you meant to have was signature(x="ANY", value = "brob").  
At least I assume it was the  right-hand side and not argument "i" that 
you meant to have class "brob".  You don't actually need the x="ANY" 
part, that is the default for omitted arguments--but it's clearer in 
this case to be explicit.



Robin Hankin wrote:
> Hi
>
> If     x <- 1:10    then  x[5] <- 1i    will promote
> x to be a complex vector.
>
> Suppose I  have an S4 class "brob", and have functions
> is.brob(), as.brob(), as.numeric() and so forth (minimal self-contained
> code below).
>
> If x is numeric (1:10, say) and y is a brob, what
> is the best way to make
>
> x[5] <- y
>
> promote x to a brob in the same way as the complex example?
>
> Or is this not desirable for some reason?
>
>
> My first idea was to use
>
> setReplaceMethod("[",signature("ANY","brob"), ...)
>
> but this gives a seal error:
>
> Error in setMethod(paste(f, "<-", sep = ""), ..., where = where) :
> 	the method for function "[<-" and signature x="ANY", i="brob" is  
> sealed and cannot be re-defined
>
>
>
>
> so this can't be right.
>
>
>
>
>
>
>
>
>
>
>
> setClass("swift",
>           representation = "VIRTUAL"
>           )
>
> setClass("brob",
>           representation = representation 
> (x="numeric",positive="logical"),
>           prototype      = list(x=numeric(),positive=logical()),
>           contains       = "swift"
>           )
>
> setAs("brob", "numeric", function(from){
>    out <- exp(from at x)
>    out[!from at positive] <- -out[!from at positive]
>    return(out)
> } )
>
> setMethod("as.numeric",signature(x="brob"),function(x){as(x,"numeric")})
> is.brob <- function(x){is(x,"brob")}
>
> "brob" <- function(x=double(),positive){
>    if(missing(positive)){
>      positive <- rep(TRUE,length(x))
>    }
>    if(length(positive)==1){
>      positive <- rep(positive,length(x))
>    }
>    new("brob",x=as.numeric(x),positive=positive)
> }
>
> "as.brob" <- function(x){
>    if(is.brob(x)){
>      return(x)
>    } else if(is.complex(x)) {
>      warning("imaginary parts discarded")
>      return(Recall(Re(x)))
>    } else if(is.glub(x)){
>      warning("imaginary parts discarded")
>      return(Re(x))
>    } else {
>      return(brob(log(abs(x)), x>=0))
>    }
> }
>
> setMethod("[", "brob",
>            function(x, i, j, drop){
>              brob(x at x[i], x at positive[i])
>            } )
>
> setReplaceMethod("[",signature(x="brob"),
>                   function(x,i,j,value){
>                     jj.x <- x at x
>                     jj.pos <- x at positive
>                     if(is.brob(value)){
>                       jj.x[i] <- value at x
>                       jj.pos[i] <- value at positive
>                       return(brob(x=jj.x,positive=jj.pos))
>                     } else {
>                       x[i] <- as.brob(value)
>                       return(x)
>                     }
>                   } )
>
>
> setReplaceMethod("[",signature("ANY","brob"),
>
>                   function(x,i,j,value){
>                     x <- as.brob(x)
>                     x[i] <- as.brob(value)
>                     return(x)
>                   }
>                   )
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From avbell at ucdavis.edu  Wed Nov  1 01:07:46 2006
From: avbell at ucdavis.edu (avbell at ucdavis.edu)
Date: Wed,  1 Nov 2006 01:07:46 +0100 (CET)
Subject: [Rd] Error in optim(...) non-finite finite-difference value
	(PR#9328)
Message-ID: <20061101000746.1A89C19B3E@slim.kubism.ku.dk>

Full_Name: Adrian Bell
Version: 2.2.0
OS: Windows XP Prof
Submission from: (NULL) (169.237.62.194)


Mysterious error that I do not know how to get around.

Error in optim(...) 
non-finite finite-difference value 

For me, this has occurred for methods Nelder-Mead and L-BFGS-B.

What does it mean? Is it a bug? I have tried several things including coercing
the function being optimized to be finite.



From Robert.McGehee at geodecapital.com  Wed Nov  1 02:15:05 2006
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Tue, 31 Oct 2006 20:15:05 -0500
Subject: [Rd] Argument error reporting slowness
Message-ID: <67DCA285A2D7754280D3B8E88EB5480211DDA48C@MSGBOSCLB2WIN.DMN1.FMR.COM>

Hello,
My work with large datasets slows down a fair amount in R 2.4.0 when I
mistakenly pass in a large dataset using an incorrect argument. That is,
the same error message for reporting an incorrect argument usage when I
pass in a 1e8 length matrix takes 3 minutes on R 2.4.0 versus 0.01
seconds on R 2.3.1 This slowness may be an unintentional side effect of
a creating a better error message for reporting bad arguments. For even
larger data sets, I have chosen to kill my R session rather than wait
out this error if mis-typing an argument name.

For instance,
## In R 2.3.1, immediate reporting
> system.time(cor(badArg = matrix(1:1e8)))
Error in cor(badArg = matrix(1:1e+07)) : unused argument(s) (badArg ...)
Timing stopped at: 0 0.01 0.02 NA NA

## In R 2.4.0, extremely slow
> system.time(cor(badArg = matrix(1:1e8)))
Error in cor(badArg = matrix(1:1e+08)) : unused argument(s) (badArg =
c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,
39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56,
57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74,
75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92,
93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108,
109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 
Timing stopped at: 175.84 1.546 177.423 0 0

Best,
Robert

platform       x86_64-unknown-linux-gnu                   
arch           x86_64                                     
os             linux-gnu                                  
system         x86_64, linux-gnu                          
status         Patched                                    
major          2                                          
minor          4.0                                        
year           2006                                       
month          10                                         
day            03                                         
svn rev        39576                                      
language       R                                          
version.string R version 2.4.0 Patched (2006-10-03 r39576)

Robert McGehee
Quantitative Analyst
Geode Capital Management, LLC
1 Post Office Square, 28th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com



This e-mail, and any attachments hereto, are intended for us...{{dropped}}



From ggrothendieck at gmail.com  Wed Nov  1 02:16:11 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 31 Oct 2006 20:16:11 -0500
Subject: [Rd] fields appearing in cran descriptions pages
Message-ID: <971536df0610311716u3fbc2fc7gda588c4feb92d9a8@mail.gmail.com>

What determines which fields appear in CRAN descriptions pages.
For example, for doBy there is no Date: but there is a vignette listed:

   http://cran.r-project.org/src/contrib/Descriptions/doBy.html

whereas for gsubfn there is a Date: but there is no vignette listed
(even though it has one).

  http://cran.r-project.org/src/contrib/Descriptions/gsubfn.html



From jjonphl at gmail.com  Wed Nov  1 03:30:55 2006
From: jjonphl at gmail.com (miguel manese)
Date: Wed, 1 Nov 2006 10:30:55 +0800
Subject: [Rd] Some R questions
In-Reply-To: <200610311424.01627.vdergachev@rcgardis.com>
References: <200610311424.01627.vdergachev@rcgardis.com>
Message-ID: <d35b9da60610311830h4737cf3amb2617a33c132a659@mail.gmail.com>

Hi,

Had experience with this on doing SQLiteDF...

On 11/1/06, Vladimir Dergachev <vdergachev at rcgardis.com> wrote:
> Hi all,
>
>    I am working with some large data sets (1-4 GB) and have some questions
> that I hope someone can help me with:
>
>    1.  Is there a way to turn off garbage collector from within C interface ?
>         what I am trying to do is suck data from mysql (using my own C
>         functions) and I see that allocating each column (with about 1-4 million
>         items) takes between 0.5 and 1 seconds. My first thought was that it
>         would be nice to turn off garbage collector, allocate all the data,
>         copy values and then turn the garbage collector back on.
I believe not. FWIW a numeric() vector is a chunk of memory with a
VECTOR_SEXP header and then your data contiguously allocated. If you
are desparate enough and assuming the garbage collector is indeed the
culprit, you may want to implement your own  lightweight allocVector
(the function expanded to by NEW_NUMERIC(), etc.)


>    2.  For creating STRSXP should I be using mkChar() or mkString() to create
>         element values ? Is there a way to do it without allocating a cons cell ?
>         (otherwise a single STRSXP with 1e6 length slows down garbage collector)
A string vector (STRSXP) is composed of CHARSXP's. mkChar makes ar
CHARSXP, and mkString makes a STRSXP with 1 CHARSXP, more like a
shorthand for

SEXP str = NEW_CHARACTER(1);
SET_STRING_ELT(str, 0, mkChar("foo"));


>    3.   Is "row.names" attribute required for data frames and, if so, can I
>         use some other type besides STRSXP ?
It is required. It can be integers, for 2.4.0+


>    4.   While poking around to find out why some of my code is excessively slow
>         I have come upon definition of `[.data.frame` - subscription operator
>         for data frames, which appears to be written in R. I am wondering whether
>         I am looking at the right place and whether anyone would be interested in
>         a piece of C code optimizing it - in particular extraction of single element
>         is quite slow (i.e. calls like T[i, j]).
[.data.frame is such a pain to implement because there is just too
many ways to index a data frame. You may want to do a specialized
index-er that just considers the index-ing styles you use. But I think
you are not just vectorizing enough. If you have to access your data
frames like that then it must be inside some loop, which would kill
your social life.

<pimp-my-project>
Or, you may just use (and pour your effort on improving) SQLiteDF
http://cran.r-project.org/src/contrib/Descriptions/SQLiteDF.html
</pimp-my-project>

M. Manese



From ripley at stats.ox.ac.uk  Wed Nov  1 08:56:33 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed,  1 Nov 2006 08:56:33 +0100 (CET)
Subject: [Rd] (PR#9328) Error in optim(...) non-finite finite-difference
Message-ID: <20061101075633.AAA79561BC@slim.kubism.ku.dk>

No, this is not a bug in R, but a report to you by R of a problem with 
your code.  It means that the difference of two values of your function 
evaluated to a non-finite value when doing finite-differencing. 
Non-finite values are Inf, -Inf or NaN.

There is nothing to reproduce here, your version of R is long obsolete and 
you are asking a question.  Please do study the FAQ *before* posting an 
unhelpful non-bug report like this.

On Wed, 1 Nov 2006, avbell at ucdavis.edu wrote:

> Full_Name: Adrian Bell
> Version: 2.2.0
> OS: Windows XP Prof
> Submission from: (NULL) (169.237.62.194)
>
>
> Mysterious error that I do not know how to get around.
>
> Error in optim(...)
> non-finite finite-difference value
>
> For me, this has occurred for methods Nelder-Mead and L-BFGS-B.
>
> What does it mean? Is it a bug? I have tried several things including coercing
> the function being optimized to be finite.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From sdavis2 at mail.nih.gov  Wed Nov  1 13:48:07 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Wed, 1 Nov 2006 07:48:07 -0500
Subject: [Rd] Subsetting a vector in C
Message-ID: <200611010748.07378.sdavis2@mail.nih.gov>

I have a pretty simple question.  I have an array of REALSXP allocated as:

rsp = allocVector(REALSXP,n)

and I simply want to pass subsets of rsp of size q (q<<n), for example, to an 
R function in C.  Is there a way to subset rsp without creating a new REALSXP 
vector and copying the values for subsetting into it and then passing it to 
the function?  I'm looking for the R equivalent of rsp[1:q], but in C under 
the R API.  

A pointer to source code in the R distribution would be quite helpful, as I 
haven't found one on my own (at least not one that I recognized as such).

Thanks,
Sean



From murdoch at stats.uwo.ca  Wed Nov  1 13:54:11 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 01 Nov 2006 07:54:11 -0500
Subject: [Rd] Subsetting a vector in C
In-Reply-To: <200611010748.07378.sdavis2@mail.nih.gov>
References: <200611010748.07378.sdavis2@mail.nih.gov>
Message-ID: <454898F3.60207@stats.uwo.ca>

On 11/1/2006 7:48 AM, Sean Davis wrote:
> I have a pretty simple question.  I have an array of REALSXP allocated as:
> 
> rsp = allocVector(REALSXP,n)
> 
> and I simply want to pass subsets of rsp of size q (q<<n), for example, to an 
> R function in C.  Is there a way to subset rsp without creating a new REALSXP 
> vector and copying the values for subsetting into it and then passing it to 
> the function?  I'm looking for the R equivalent of rsp[1:q], but in C under 
> the R API.  
> 
> A pointer to source code in the R distribution would be quite helpful, as I 
> haven't found one on my own (at least not one that I recognized as such).

No, there's no way to do that.  R functions can assume they have unique 
access to the objects they work on.  (There are some optimizations which 
mean they sometimes avoid making copies, but the semantics are such that 
they should be able to act as though they have their own copies.  There 
are a couple of exotic exceptions to this rule, but it applies to 
numeric vectors.)

Duncan Murdoch



From jrstear at sandia.gov  Wed Nov  1 17:11:29 2006
From: jrstear at sandia.gov (Jon Stearley)
Date: Wed, 1 Nov 2006 09:11:29 -0700
Subject: [Rd] missing SIGWINCH?
In-Reply-To: <D43824B9-F14B-4CA5-BE85-6695568639F2@r-project.org>
References: <CD068A86-EFB8-46C6-97A6-0C89FB94DFD2@sandia.gov>
	<D43824B9-F14B-4CA5-BE85-6695568639F2@r-project.org>
Message-ID: <BC654489-92F6-435F-BB78-FABC1E55B215@sandia.gov>


On Oct 31, 2006, at 1:50 PM, Simon Urbanek wrote:

> Jon,
>
> I don't have access to a Mac Pro, so I can't test anything, but  
> based on your report I found a bug in R_system that affects signal  
> handling during "system" calls on Macs. Please test the current R- 
> devel (39754) or R-2-4-branch (39755) to see if it solves your  
> problem.

the problem is indeed fixed in today's http://r.research.att.com/R24- 
branch-tiger-universal.tar.gz.

THANK YOU and double KUDOS on the response time!!!  wow!

-jon



From vdergachev at rcgardis.com  Wed Nov  1 19:58:30 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 1 Nov 2006 13:58:30 -0500
Subject: [Rd] Fwd: Re:  Some R questions
Message-ID: <200611011358.30656.vdergachev@rcgardis.com>


A correction to my previous post:

after running the example A[,1] and A[[1]] the running time decrease so that 
eventually A[[1]] takes 0.025 seconds (according to system.time()) and A[,1] 
takes 1.8 seconds. 

The ratio of time still 2-digit, but, apparently, the garbage collector is a 
good deal faster when memory is already available.

                            best

                                Vladimir Dergachev



From vdergachev at rcgardis.com  Wed Nov  1 19:40:39 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 1 Nov 2006 13:40:39 -0500
Subject: [Rd] Some R questions
In-Reply-To: <d35b9da60610311830h4737cf3amb2617a33c132a659@mail.gmail.com>
References: <200610311424.01627.vdergachev@rcgardis.com>
	<d35b9da60610311830h4737cf3amb2617a33c132a659@mail.gmail.com>
Message-ID: <200611011340.40077.vdergachev@rcgardis.com>

On Tuesday 31 October 2006 9:30 pm, miguel manese wrote:
> Hi,
>
> Had experience with this on doing SQLiteDF...
>
> On 11/1/06, Vladimir Dergachev <vdergachev at rcgardis.com> wrote:
> > Hi all,
> >
> >    I am working with some large data sets (1-4 GB) and have some
> > questions that I hope someone can help me with:
> >
> >    1.  Is there a way to turn off garbage collector from within C
> > interface ? what I am trying to do is suck data from mysql (using my own
> > C functions) and I see that allocating each column (with about 1-4
> > million items) takes between 0.5 and 1 seconds. My first thought was that
> > it would be nice to turn off garbage collector, allocate all the data,
> > copy values and then turn the garbage collector back on.
>
> I believe not. FWIW a numeric() vector is a chunk of memory with a
> VECTOR_SEXP header and then your data contiguously allocated. If you
> are desparate enough and assuming the garbage collector is indeed the
> culprit, you may want to implement your own  lightweight allocVector
> (the function expanded to by NEW_NUMERIC(), etc.)

Thank you very much for the suggestion ! After looking around in the code 
I realized that what I really wanted was R_gc_internal() - as then I can tell
the garbage collector in advance that I will require that much heap and that 
it does not need to go and allocate it each time I asked (btw I would have 
expected it to double the heap each time it runs out of it, but this is not 
what goes on, at least in R 2.3.1).

After some mucking around here is a poor mans substitute which might be 
useful:

void fault_mem_region(long size)
{
long chunk;
int max=(1<<30) / sizeof(int);
int block_count=0;
SEXP block;
while(size>0) {
	chunk=size;
	if(chunk > max)
		chunk=max;
	PROTECT(block=allocVector(INTSXP, chunk));
	block_count++;
	size-=chunk;
	}
UNPROTECT(block_count);
}

On a 48 column data frame (with 1.2e6 rows)  the call 
fault_mem_region(ncol+nrow*11+ncol*nrow)  shaved off 5 seconds from 33 second 
running time (which includes running mysql query).

It is not perfect however as I could see the last columns allocating slower 
than initial ones. 

Also, while looking around in allocVector I saw that after running garbage 
collector it simply calls malloc and if malloc fails it calls garbage 
collector again.

What would be nice is the ability to bypass that first garbage collector call 
when allocating large nodes.

>
> >    2.  For creating STRSXP should I be using mkChar() or mkString() to
> > create element values ? Is there a way to do it without allocating a cons
> > cell ? (otherwise a single STRSXP with 1e6 length slows down garbage
> > collector)
>
> A string vector (STRSXP) is composed of CHARSXP's. mkChar makes ar
> CHARSXP, and mkString makes a STRSXP with 1 CHARSXP, more like a
> shorthand for
>
> SEXP str = NEW_CHARACTER(1);
> SET_STRING_ELT(str, 0, mkChar("foo"));

Makes sense - thank you !

>
> >    3.   Is "row.names" attribute required for data frames and, if so, can
> > I use some other type besides STRSXP ?
>
> It is required. It can be integers, for 2.4.0+
>

Great !

> >    4.   While poking around to find out why some of my code is
> > excessively slow I have come upon definition of `[.data.frame` -
> > subscription operator for data frames, which appears to be written in R.
> > I am wondering whether I am looking at the right place and whether anyone
> > would be interested in a piece of C code optimizing it - in particular
> > extraction of single element is quite slow (i.e. calls like T[i, j]).
>
> [.data.frame is such a pain to implement because there is just too
> many ways to index a data frame. You may want to do a specialized
> index-er that just considers the index-ing styles you use. But I think
> you are not just vectorizing enough. If you have to access your data
> frames like that then it must be inside some loop, which would kill
> your social life.

Hmm, I thought to implement subscription with integer or logical vectors and 
then some hash-based lookup for column and (possibly) row names.

The slowness manifests itself for vectorized code as well. I believe it is due 
to the code mucking about with row.names attribute which introduces a penalty 
on any [,] operation - penalty that grows linearly with the number of rows. 

Thus for large data frames   A[,1] is slower than A[[1]]. For example, for the 
data frame I mentioned above E<-A[[1]] took 0.46 seconds (way too much in my 
opinion), but E<-A[,1] took 62.45 seconds - more than a minute and more than 
twice the time it took to load the entire thing into memory. Silly, isn't 
it ?

Also, there are good reasons to want to address individual cells. And there is 
no reason why such access cannot be constant time.

>
> <pimp-my-project>
> Or, you may just use (and pour your effort on improving) SQLiteDF
> http://cran.r-project.org/src/contrib/Descriptions/SQLiteDF.html
> </pimp-my-project>

Very nice ! The documentation mentioned something about assignment operator 
not working - is this still true ? Or, maybe, I misunderstood something ?

Also, I wonder whether it would be possible to extend [[ operator so one can 
run queries: SQLDF[["SELECT * FROM a WHERE.."]]

                           thank you very much !

                                     Vladimir Dergachev

>
> M. Manese



From vdergachev at rcgardis.com  Wed Nov  1 23:20:09 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 1 Nov 2006 17:20:09 -0500
Subject: [Rd] allocVector bug ?
Message-ID: <200611011720.09139.vdergachev@rcgardis.com>


Hi all, 

  I was looking at the following piece of code in src/main/memory.c, function 
allocVector :

    if (size <= NodeClassSize[1]) {
	node_class = 1;
	alloc_size = NodeClassSize[1];
    }
    else {
	node_class = LARGE_NODE_CLASS;
	alloc_size = size;
	for (i = 2; i < NUM_SMALL_NODE_CLASSES; i++) {
	    if (size <= NodeClassSize[i]) {
		node_class = i;
		alloc_size = NodeClassSize[i];
		break;
	    }
	}
    }


It appears that for LARGE_NODE_CLASS the variable alloc_size should not be 
size, but something far less as we are not using vector heap, but rather 
calling malloc directly in the code below (and from discussions I read on 
this mailing list I think that these two are different - please let me know 
if I am wrong).

So when allocate a large vector the garbage collector goes nuts trying to find 
all that space which is not going to be needed after all.

I made an experiment and replaced the line alloc_size=size with alloc_size=0.

R compiled fine (both 2.4.0 and 2.3.1) and passed make check with no issues 
(it all printed OK).

Furthermore, all allocVector calls completed in no time and my test case run 
very fast (22 seconds, as opposed to minutes). 

In addition, attach() was instantaneous which was wonderful.

Could anyone with deeper knowledge of R internals comment on whether this 
makes any sense ?

                           thank you very much !

                                        Vladimir Dergachev



From juan_sr at uol.com.br  Thu Nov  2 02:45:24 2006
From: juan_sr at uol.com.br (Juan Santiago Ramseyer)
Date: Wed, 01 Nov 2006 22:45:24 -0300
Subject: [Rd] install packages RMySQL fail
In-Reply-To: <m2ac3foyv4.fsf@ziti.local>
References: <1162137482.7303.8.camel@localhost.localdomain>
	<m2ac3foyv4.fsf@ziti.local>
Message-ID: <1162431924.5502.10.camel@localhost.localdomain>

thank you,

I make in R:
	install.packages(DBI) 

and fix ambient variables of linux:
	export PKG_CPPFALGS="-I/usr/include/mysql"
	export PKG_LIBS="-L/usr/lib64/mysql -lmysqlclient"

after:
	install.packages(RMySQL)

is successful.

Juan.

Em Dom, 2006-10-29 ?s 08:44 -0800, Seth Falcon escreveu:
> Juan Santiago Ramseyer <juan_sr at uol.com.br> writes:
> 
> > install packages RMySQL fail.
> >
> > System Fedora Core 6 x86_64
> >
> > see down. It's bug or incomplete install MySQL?
> 
> You need to install the devel headers for MySQL.  This should be
> available as an rpm for your system.
> 
> + seth
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



From jjonphl at gmail.com  Thu Nov  2 04:07:19 2006
From: jjonphl at gmail.com (miguel manese)
Date: Thu, 2 Nov 2006 11:07:19 +0800
Subject: [Rd] Some R questions
In-Reply-To: <200611011340.40077.vdergachev@rcgardis.com>
References: <200610311424.01627.vdergachev@rcgardis.com>
	<d35b9da60610311830h4737cf3amb2617a33c132a659@mail.gmail.com>
	<200611011340.40077.vdergachev@rcgardis.com>
Message-ID: <d35b9da60611011907y28cb5a66k427d16221564f45b@mail.gmail.com>

On 11/2/06, Vladimir Dergachev <vdergachev at rcgardis.com> wrote:
> On Tuesday 31 October 2006 9:30 pm, miguel manese wrote:
> The slowness manifests itself for vectorized code as well. I believe it is due
> to the code mucking about with row.names attribute which introduces a penalty
> on any [,] operation - penalty that grows linearly with the number of rows.
>
> Thus for large data frames   A[,1] is slower than A[[1]]. For example, for the
> data frame I mentioned above E<-A[[1]] took 0.46 seconds (way too much in my
> opinion), but E<-A[,1] took 62.45 seconds - more than a minute and more than
> twice the time it took to load the entire thing into memory. Silly, isn't
> it ?
>
> Also, there are good reasons to want to address individual cells. And there is
> no reason why such access cannot be constant time.
Yeah, it should be O(1) because a data frame is just a list of vectors
and everything is in memory: index the column in the list, then the
row on the vector. For non-vectorized code, the problem is more of the
loop overhead (maintaining loop variables) which is done on R instead
of in C.


> > <pimp-my-project>
> > Or, you may just use (and pour your effort on improving) SQLiteDF
> > http://cran.r-project.org/src/contrib/Descriptions/SQLiteDF.html
> > </pimp-my-project>
>
> Very nice ! The documentation mentioned something about assignment operator
> not working - is this still true ? Or, maybe, I misunderstood something ?
Yes, unfortunately, still no [<- operator. For every way that a data
frame can index-ed (or subscript-ed), that's how many ways the data
frames can be mutated. There are many other things more "fun" than
coding that (graphics!, extending sqlite syntax, R expression
evaluation), but I'd do that on the weekend.


> Also, I wonder whether it would be possible to extend [[ operator so one can
> run queries: SQLDF[["SELECT * FROM a WHERE.."]]
That has been suggested before, but in retrospect this can be achieved
more "poetically" as

sdf[sdf$a>3 && sdf$b=="i",]    # where a>3 and b == 'i'

although not as efficient. I have been thinking of adding a method like

select(sdf, select=<select_clause>,where=<where_clause>,ordery_by=order_by_clause)

so that sum(sdf$a) can just be done with select(sdf, "sum(a)"), and
not go .Call("..."). It can also optimize stuff, like with(sdf, a+b)
can be done with select(sdf, "a+b").

M. Manese



From k.ponting at aurix.com  Thu Nov  2 11:51:56 2006
From: k.ponting at aurix.com (k.ponting at aurix.com)
Date: Thu,  2 Nov 2006 11:51:56 +0100 (CET)
Subject: [Rd] CRAN task views work only once per session (PR#9330)
Message-ID: <20061102105156.DDD0A5625C@slim.kubism.ku.dk>


Cran task views seems to be a "once-per-session" process -- the first
attempt to access views in a (RGui for Windows) session works, but
subsequent attempts fail. There is a noticeably long pause before
the failing call returns.

Example session with two calls to "available.views" follows, but similar
effects have been observed with two calls to "install.views" and even
a call to "available.views" followed by a call to "install.views".


R version 2.4.0 (2006-10-03)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> sessionInfo()
R version 2.4.0 (2006-10-03) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United Kingdom.1252;LC_CTYPE=English_United
Kingdom.1252;LC_MONETARY=English_United
Kingdom.1252;LC_NUMERIC=C;LC_TIME=English_United Kingdom.1252

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"
"datasets" 
[7] "base"     
> available.views(repos="http://cran.uk.r-project.org")
Error: could not find function "available.views"
> library(ctv)
> available.views(repos="http://cran.uk.r-project.org")

CRAN Task Views
---------------
Name: Bayesian
Topic: Bayesian Inference
Maintainer: Jong Hee Park
Repository: http://cran.uk.r-project.org
---------------
Name: Cluster
Topic: Cluster Analysis & Finite Mixture Models
Maintainer: Friedrich Leisch and Bettina Gruen
Repository: http://cran.uk.r-project.org
---------------
Name: Econometrics
Topic: Computational Econometrics
Maintainer: Achim Zeileis
Repository: http://cran.uk.r-project.org
---------------
Name: Environmetrics
Topic: Analysis of ecological and environmental data
Maintainer: Gavin Simpson
Repository: http://cran.uk.r-project.org
---------------
Name: Finance
Topic: Empirical Finance
Maintainer: Dirk Eddelbuettel
Repository: http://cran.uk.r-project.org
---------------
Name: Genetics
Topic: Statistical Genetics
Maintainer: Giovanni Montana
Repository: http://cran.uk.r-project.org
---------------
Name: Graphics
Topic: Graphic Displays & Dynamic Graphics & Graphic Devices &  
   Visualization
Maintainer: Nicholas Lewin-Koh
Repository: http://cran.uk.r-project.org
---------------
Name: MachineLearning
Topic: Machine Learning & Statistical Learning
Maintainer: Torsten Hothorn
Repository: http://cran.uk.r-project.org
---------------
Name: Multivariate
Topic: Multivariate Statistics
Maintainer: Paul Hewson
Repository: http://cran.uk.r-project.org
---------------
Name: SocialSciences
Topic: Statistics for the Social Sciences
Maintainer: John Fox
Repository: http://cran.uk.r-project.org
---------------
Name: Spatial
Topic: Analysis of Spatial Data
Maintainer: Roger Bivand
Repository: http://cran.uk.r-project.org
---------------
Name: gR
Topic: gRaphical models in R
Maintainer: Claus Dethlefsen
Repository: http://cran.uk.r-project.org

> available.views(repos="http://cran.uk.r-project.org")

CRAN Task Views
no views found
> 
--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 4.0
 year = 2006
 month = 10
 day = 03
 svn rev = 39566
 language = R
 version.string = R version 2.4.0 (2006-10-03)

Windows XP Professional (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_United Kingdom.1252;LC_CTYPE=English_United
Kingdom.1252;LC_MONETARY=English_United
Kingdom.1252;LC_NUMERIC=C;LC_TIME=English_United Kingdom.1252

Search Path:
 .GlobalEnv, package:ctv, package:methods, package:stats,
package:graphics, package:grDevices, package:utils, package:datasets,
Autoloads, package:base

______________________________________________________________________
This email has been scanned by the MessageLabs Email Security System.
For more information visit http://www.virtual-email.net/messagelabs.htm



From Bernhard_Pfaff at fra.invesco.com  Thu Nov  2 13:17:00 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Thu, 2 Nov 2006 12:17:00 -0000
Subject: [Rd] Formal methods are not loaded from NAMESPACE in reloaded
	workspace image
Message-ID: <E4A9111DA23BA048B9A46686BF727CF461BDF1@DEFRAXMB01.corp.amvescap.net>

Dear R-Devel subscriber,

I was hinted to the following problem with package 'urca':

If one starts R and executes for instance:

> library(urca)
> example(ur.df)
## output as expected, but omitted here
> class(lc.df)
[1] "ur.df"
attr(,"package")
[1] "urca"
> class(summary(lc.df))
[1] "sumurca"
attr(,"package")
[1] "urca"
> 

everything works fine. Now, save the workspace image and quit R. After
starting R again with the previously restored workspace image one has:

> ls()
[1] "lc.df"   "Raotbl3"
> class(lc.df)
[1] "ur.df"
attr(,"package")
[1] "urca"

lc.df
## now the 'show'-method for objects of class 'ur.df' is not utilised,
rather the generic 
## displaying all slots

> library(urca)
> lc.df

## still the same as compared to the above output.
## similarily

> class(summary(lc.df))
[1] "table"


In the NAMESPACE file export directives for methods and classes are
included as:

## Classes       
exportClasses("urca", "ca.jo", "cajo.test", "ur.kpss", "ca.po",
"ur.ers", "ur.pp", "ur.sp", "ur.df", "ur.za", "sumurca")
## Methods
exportMethods("show", "plot", "summary")

Any help or pointers for solving this problem is much appreciated.

Best,
Bernhard

> sessionInfo()
R version 2.5.0 Under development (unstable) (2006-10-10 r39600) 
i386-pc-mingw32 

locale:
LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_MONETARY=
German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "datasets"  "utils"

[7] "base"     

other attached packages:
    urca fortunes 
 "1.0-0"  "1.3-2" 
*****************************************************************
Confidentiality Note: The information contained in this mess...{{dropped}}



From Achim.Zeileis at wu-wien.ac.at  Thu Nov  2 13:39:14 2006
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Thu, 2 Nov 2006 13:39:14 +0100 (CET)
Subject: [Rd] CRAN task views work only once per session (PR#9330)
In-Reply-To: <20061102105156.DDD0A5625C@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.44.0611021329260.2675-100000@disco.wu-wien.ac.at>

One comment - taken from the FAQ - in advance:
  Bug reports on contributed packages should be sent first to the package
  maintainer, and only submitted to the R-bugs repository by package
  maintainers, mentioning the package in the subject line.

In this case, posting to R-devel (but not R-bugs) and Cc to me (as the
maintainer of ctv) would also have been ok.

As for your problem: On my Linux machine, the code

  library("ctv")
  x <- available.views(repos = "http://CRAN.uk.R-project.org")
  y <- available.views(repos = "http://CRAN.uk.R-project.org")

runs without any problem, x and y are also identical afterwards. As I
haven't got a Windows XP machine, could someone on the list please run the
code above and confirm (or disconfirm) that the second call takes longer
and finally finds no views.

thx in advance,
Z



From ripley at stats.ox.ac.uk  Thu Nov  2 13:55:09 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 2 Nov 2006 12:55:09 +0000 (GMT)
Subject: [Rd] CRAN task views work only once per session (PR#9330)
In-Reply-To: <Pine.LNX.4.44.0611021329260.2675-100000@disco.wu-wien.ac.at>
References: <Pine.LNX.4.44.0611021329260.2675-100000@disco.wu-wien.ac.at>
Message-ID: <Pine.LNX.4.64.0611021251210.31395@gannet.stats.ox.ac.uk>

On Thu, 2 Nov 2006, Achim Zeileis wrote:

> One comment - taken from the FAQ - in advance:
>  Bug reports on contributed packages should be sent first to the package
>  maintainer, and only submitted to the R-bugs repository by package
>  maintainers, mentioning the package in the subject line.
>
> In this case, posting to R-devel (but not R-bugs) and Cc to me (as the
> maintainer of ctv) would also have been ok.
>
> As for your problem: On my Linux machine, the code
>
>  library("ctv")
>  x <- available.views(repos = "http://CRAN.uk.R-project.org")
>  y <- available.views(repos = "http://CRAN.uk.R-project.org")
>
> runs without any problem, x and y are also identical afterwards. As I
> haven't got a Windows XP machine, could someone on the list please run the
> code above and confirm (or disconfirm) that the second call takes longer
> and finally finds no views.

It works correctly on my XP machine.

I don't find http://CRAN.uk.R-project.org a particularly reliable source 
(and it is like me in .ac.uk), so wonder if this might have been a 
networking or mirror glitch.  I would have tried another mirror (the 
London one is more reliable for me) long before reporting a problem.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From ggrothendieck at gmail.com  Thu Nov  2 13:58:47 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 2 Nov 2006 07:58:47 -0500
Subject: [Rd] CRAN task views work only once per session (PR#9330)
In-Reply-To: <Pine.LNX.4.44.0611021329260.2675-100000@disco.wu-wien.ac.at>
References: <20061102105156.DDD0A5625C@slim.kubism.ku.dk>
	<Pine.LNX.4.44.0611021329260.2675-100000@disco.wu-wien.ac.at>
Message-ID: <971536df0611020458j7858c06n27319e9a0d6c995a@mail.gmail.com>

They run without problem and are identical on my XP machine too:

> library(ctv)
> x <- available.views(repos = "http://CRAN.uk.R-project.org")
>  y <- available.views(repos = "http://CRAN.uk.R-project.org")
> identical(x,y)
[1] TRUE
> R.version.string # XP
[1] "R version 2.4.0 Patched (2006-10-24 r39722)"


On 11/2/06, Achim Zeileis <Achim.Zeileis at wu-wien.ac.at> wrote:
> One comment - taken from the FAQ - in advance:
>  Bug reports on contributed packages should be sent first to the package
>  maintainer, and only submitted to the R-bugs repository by package
>  maintainers, mentioning the package in the subject line.
>
> In this case, posting to R-devel (but not R-bugs) and Cc to me (as the
> maintainer of ctv) would also have been ok.
>
> As for your problem: On my Linux machine, the code
>
>  library("ctv")
>  x <- available.views(repos = "http://CRAN.uk.R-project.org")
>  y <- available.views(repos = "http://CRAN.uk.R-project.org")
>
> runs without any problem, x and y are also identical afterwards. As I
> haven't got a Windows XP machine, could someone on the list please run the
> code above and confirm (or disconfirm) that the second call takes longer
> and finally finds no views.
>
> thx in advance,
> Z
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



From hin-tak.leung at cimr.cam.ac.uk  Thu Nov  2 16:38:01 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Thu, 02 Nov 2006 15:38:01 +0000
Subject: [Rd] Cross-compilation
In-Reply-To: <op.thzmt7scmfjo24@norisk>
References: <op.thziv9jjmfjo24@norisk> <200610251910.40831.rdiaz@cnio.es>
	<op.thzmt7scmfjo24@norisk>
Message-ID: <454A10D9.1020601@cimr.cam.ac.uk>

You might be better off using the same g++ as distributed and found on 
Prof Ripley's web site, rather than the newer 4.x:

$ /home/hin-tak/mingw-cross/bin/i586-mingw32-c++  --version
i586-mingw32-c++ (GCC) 3.4.5 (mingw special)
...

Name-mangling and C++ ABI had changed between gcc 3.x and 4.x, so 
compiling c++ programs might be different.

It had worked out-of-the-box for me when I was using fedora 5 x86_64
(I just upgraded to fedora 6 yesterday, and I haven't tried doing
any cross-compiling yet). So fc4 probably should work.

HTH,
Hin-Tak Leung

Tom McCallum wrote:
> Thanks for your reply, as an example it appears to have difficulty linking  
> to even ostream library of the standard C++, as shown below:
> 
> /home/tmccallum/ritzel/RItzel/src/Classifier.cpp:209: undefined reference  
> to `_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc'
> Classifier.o: In function `operator<<':
> /usr/lib/gcc/i386-redhat-linux/4.0.2/../../../../include/c++/4.0.2/ostream:218:  
> undefined reference to `_ZNSolsEd'
> /usr/lib/gcc/i386-redhat-linux/4.0.2/../../../../include/c++/4.0.2/ostream:196:  
> undefined reference to `_ZNSolsEl'
> 
> I am currently working R-2.4.0 as downloaded today.
> 
> I know the g++ has gone through some alterations and wondered if you knew  
> the version of g++ you cross-compiled your package with for comparison -  
> mine is g++ (GCC) 4.0.2 20051125 (Red Hat 4.0.2-8).
> 
> Many thanks
> 
> Tom
> 
> 
> On Wed, 25 Oct 2006 18:10:40 +0100, Ramon Diaz-Uriarte <rdiaz at cnio.es>  
> wrote:
> 
>> Dear Tom,
>>
>> It has worked for me out-of-the box in at least two times, one a while  
>> ago
>> with R-2.2-something and recently with R-2.4.0. In both cases, I was  
>> running
>> Debian (with a mix of testing and unstable) on x86. I never had to do
>> anything, just run the script and at least in one case I did  
>> crosscompile a
>> package with C++.
>>
>>
>> R.
>>
>> On Wednesday 25 October 2006 18:03, Tom McCallum wrote:
>>> Hi everyone,
>>>
>>> I am trying to cross-compile a package I wrote using the Yan and Rossini
>>> tutorial "Building Microsoft Windows versions of R and R packages using
>>> Intel Linux".  I have got reasonably far with this but when doing the
>>> linking using the line:
>>>
>>> i586-mingw32-g++  -shared -s  -o mylibrary.dll mylibrary.def mylibrary.o
>>> mylibrary_res.o  -L/my/path/RCrossBuild/WinR/R-2.4.0/bin -lR
>>>
>>> I get lots of these type of messages:
>>> /my/path/to/mylibrary.cpp:43: undefined reference to
>>> `_GLOBAL_OFFSET_TABLE_'
>>>
>>> and other similar linker errors for virtually every object and command  
>>> in
>>> the program.  After some googling I have found that there may be  
>>> problems
>>> with the libgcc.a library and its default -fPIC argument during
>>> compilation.
>>>
>>> Has anyone got this tutorial to work and if so how did they overcome  
>>> this?
>>>
>>> I am attempting to do this on Fedora Core 4 on a 32-bit machine, having
>>> completed all the previous sections of the tutorial for building a
>>> cross-platform version of R.
>>>
>>> Many thanks
>>>
>>> Tom
> 
> 
>



From ehlers at math.ucalgary.ca  Thu Nov  2 17:57:24 2006
From: ehlers at math.ucalgary.ca (ehlers at math.ucalgary.ca)
Date: Thu,  2 Nov 2006 17:57:24 +0100 (CET)
Subject: [Rd] buglet in plot.lm (PR#9333)
Message-ID: <20061102165724.27BFA3F202@slim.kubism.ku.dk>

In version 2.2.0, plot.lm() was enhanced with two new plots
(thanks, Martin and John).

There's a small fix needed for 'which=6' when 'id.n=0'.

 > plot(lm(rnorm(10) ~ 1), which = 6, id.n = 0)
Error in plot.lm(lm(rnorm(10) ~ 1), which = 6, id.n = 0) :
         could not find function "text.id"

Fixed by inserting braces in plot.lm.R:
Replace code at line last-8:

	if (id.n > 0)
	    show.r <- order(-cook)[iid]
	text.id(g[show.r], cook[show.r], show.r)

with

	if (id.n > 0) {
	    show.r <- order(-cook)[iid]
	    text.id(g[show.r], cook[show.r], show.r)
	}


 > version
                _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status         Patched
major          2
minor          4.0
year           2006
month          10
day            29
svn rev        39744
language       R
version.string R version 2.4.0 Patched (2006-10-29 r39744)

Peter Ehlers



From jeff.horner at vanderbilt.edu  Thu Nov  2 20:38:34 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Thu, 02 Nov 2006 13:38:34 -0600
Subject: [Rd] Connections patch
Message-ID: <454A493A.9040606@vanderbilt.edu>

I've implemented an R Connections API for packages writers and those 
embedding R into other systems. The patch is here:

http://biostat.mc.vanderbilt.edu/twiki/pub/Main/RApacheProject/Conn-patch-R-devel-r39773.patch

and I've started an R wiki for discussion here:

http://wiki.r-project.org/rwiki/doku.php?id=developers:r_connections_api

Main points:

1) C code can create new connections and pass them back to R.

2) R code can utilize them just like existing connections.

3) C code can also utilize them.

3) stdin, stdout, and stderr connections can be replaced with something 
else.

Comments much appreciated,

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner



From Kurt.Hornik at wu-wien.ac.at  Thu Nov  2 21:50:55 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Thu, 2 Nov 2006 21:50:55 +0100
Subject: [Rd] fields appearing in cran descriptions pages
In-Reply-To: <971536df0610311716u3fbc2fc7gda588c4feb92d9a8@mail.gmail.com>
References: <971536df0610311716u3fbc2fc7gda588c4feb92d9a8@mail.gmail.com>
Message-ID: <17738.23087.780819.828952@mithrandir.hornik.net>

>>>>> Gabor Grothendieck writes:

> What determines which fields appear in CRAN descriptions pages.
> For example, for doBy there is no Date: but there is a vignette listed:

>    http://cran.r-project.org/src/contrib/Descriptions/doBy.html

> whereas for gsubfn there is a Date: but there is no vignette listed
> (even though it has one).

>   http://cran.r-project.org/src/contrib/Descriptions/gsubfn.html

A bug in the script generating the web content.  Should be fixed now.

-k



From murdoch at stats.uwo.ca  Thu Nov  2 22:39:52 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 02 Nov 2006 16:39:52 -0500
Subject: [Rd] Syntax Error in Rcmd check on Windows
In-Reply-To: <45479EFF.7060708@stats.uwo.ca>
References: <84fc09fb0610310538v1d80061cr65553e95a63f1329@mail.gmail.com>	
	<454794BE.4020807@stats.uwo.ca>
	<84fc09fb0610311050r27a5c4c9tff859e577ea205a1@mail.gmail.com>
	<45479EFF.7060708@stats.uwo.ca>
Message-ID: <454A65A8.8000106@stats.uwo.ca>

On 10/31/2006 2:07 PM, Duncan Murdoch wrote:
> On 10/31/2006 1:50 PM, Michael Hoehle wrote:
>>> Thanks for pointing me to the source.  I can reproduce the problem, and
>>> I'm fairly sure it's an R bug, not a problem in your source.  I need to
>>> trace through at a low level to confirm this and to work out the fix.
>>>
>> 
>> It reassuring to know that the problem appears not to be with my code.
>> Thanks for your help so far and hopefully you are able to find the
>> bug! Let me know when you know more.
>> 
>> Michael
>> 
>> P.S. When I do a dos2unix on RLadyBug-Ex.R "Rterm --no-save <
>> RLadyBug-Ex.R " works fine.
> 
> Yes, the problem has to do with the CR LF line ends in the file.  For 
> some reason R switches from handling those properly to not doing so. 
> The problem I'm having right now is that I can't do input redirection in 
> gdb in Windows, so it's really hard to see when the switch happens, or why.

I'm now fairly sure this isn't an R bug after all.  It goes away if I 
edit out the requirement in RLadyBug for rJava, which makes me think 
that rJava is somehow messing up R's input routines.  (Rcmd check fails 
later when it can't find  ".jnew", as you'd expect.  But there's no 
spurious syntax error.)

Because of the difficulties with the debugger I'm going to quit now; if 
you find any evidence that suggests it really is R's bug after all, 
please let me know.

Simon, let me know if there are any tests I can do to help track this down.

Duncan Murdoch



From simon.urbanek at r-project.org  Thu Nov  2 22:59:19 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 2 Nov 2006 16:59:19 -0500
Subject: [Rd] Syntax Error in Rcmd check on Windows
In-Reply-To: <454A65A8.8000106@stats.uwo.ca>
References: <84fc09fb0610310538v1d80061cr65553e95a63f1329@mail.gmail.com>	
	<454794BE.4020807@stats.uwo.ca>
	<84fc09fb0610311050r27a5c4c9tff859e577ea205a1@mail.gmail.com>
	<45479EFF.7060708@stats.uwo.ca> <454A65A8.8000106@stats.uwo.ca>
Message-ID: <A1C28784-F79D-4EB4-8224-551A08CE8D69@r-project.org>


On Nov 2, 2006, at 4:39 PM, Duncan Murdoch wrote:

> On 10/31/2006 2:07 PM, Duncan Murdoch wrote:
>> On 10/31/2006 1:50 PM, Michael Hoehle wrote:
>>>> Thanks for pointing me to the source.  I can reproduce the  
>>>> problem, and
>>>> I'm fairly sure it's an R bug, not a problem in your source.  I  
>>>> need to
>>>> trace through at a low level to confirm this and to work out the  
>>>> fix.
>>>>
>>> It reassuring to know that the problem appears not to be with my  
>>> code.
>>> Thanks for your help so far and hopefully you are able to find the
>>> bug! Let me know when you know more.
>>> Michael
>>> P.S. When I do a dos2unix on RLadyBug-Ex.R "Rterm --no-save <
>>> RLadyBug-Ex.R " works fine.
>> Yes, the problem has to do with the CR LF line ends in the file.   
>> For some reason R switches from handling those properly to not  
>> doing so. The problem I'm having right now is that I can't do  
>> input redirection in gdb in Windows, so it's really hard to see  
>> when the switch happens, or why.
>
> I'm now fairly sure this isn't an R bug after all.  It goes away if  
> I edit out the requirement in RLadyBug for rJava, which makes me  
> think that rJava is somehow messing up R's input routines.  (Rcmd  
> check fails later when it can't find  ".jnew", as you'd expect.   
> But there's no spurious syntax error.)
>
> Because of the difficulties with the debugger I'm going to quit  
> now; if you find any evidence that suggests it really is R's bug  
> after all, please let me know.
>
> Simon, let me know if there are any tests I can do to help track  
> this down.
>

AFAIR this is the  (sort of known) issue of Java changing the  
newlines behavior of the output under R CMD check. However, so far no  
one could tell me what the issue really is.
Can't just R CMD check ignore the CR/LF issues on Windows? I was  
assuming that it is not making distinction between \r\n and \n  
anyway ...

Cheers,
Simon



From murdoch at stats.uwo.ca  Thu Nov  2 23:34:38 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 02 Nov 2006 17:34:38 -0500
Subject: [Rd] Syntax Error in Rcmd check on Windows
In-Reply-To: <A1C28784-F79D-4EB4-8224-551A08CE8D69@r-project.org>
References: <84fc09fb0610310538v1d80061cr65553e95a63f1329@mail.gmail.com>	
	<454794BE.4020807@stats.uwo.ca>
	<84fc09fb0610311050r27a5c4c9tff859e577ea205a1@mail.gmail.com>
	<45479EFF.7060708@stats.uwo.ca> <454A65A8.8000106@stats.uwo.ca>
	<A1C28784-F79D-4EB4-8224-551A08CE8D69@r-project.org>
Message-ID: <454A727E.3070009@stats.uwo.ca>

On 11/2/2006 4:59 PM, Simon Urbanek wrote:
> On Nov 2, 2006, at 4:39 PM, Duncan Murdoch wrote:
> 
>> On 10/31/2006 2:07 PM, Duncan Murdoch wrote:
>>> On 10/31/2006 1:50 PM, Michael Hoehle wrote:
>>>>> Thanks for pointing me to the source.  I can reproduce the  
>>>>> problem, and
>>>>> I'm fairly sure it's an R bug, not a problem in your source.  I  
>>>>> need to
>>>>> trace through at a low level to confirm this and to work out the  
>>>>> fix.
>>>>>
>>>> It reassuring to know that the problem appears not to be with my  
>>>> code.
>>>> Thanks for your help so far and hopefully you are able to find the
>>>> bug! Let me know when you know more.
>>>> Michael
>>>> P.S. When I do a dos2unix on RLadyBug-Ex.R "Rterm --no-save <
>>>> RLadyBug-Ex.R " works fine.
>>> Yes, the problem has to do with the CR LF line ends in the file.   
>>> For some reason R switches from handling those properly to not  
>>> doing so. The problem I'm having right now is that I can't do  
>>> input redirection in gdb in Windows, so it's really hard to see  
>>> when the switch happens, or why.
>> I'm now fairly sure this isn't an R bug after all.  It goes away if  
>> I edit out the requirement in RLadyBug for rJava, which makes me  
>> think that rJava is somehow messing up R's input routines.  (Rcmd  
>> check fails later when it can't find  ".jnew", as you'd expect.   
>> But there's no spurious syntax error.)
>>
>> Because of the difficulties with the debugger I'm going to quit  
>> now; if you find any evidence that suggests it really is R's bug  
>> after all, please let me know.
>>
>> Simon, let me know if there are any tests I can do to help track  
>> this down.
>>
> 
> AFAIR this is the  (sort of known) issue of Java changing the  
> newlines behavior of the output under R CMD check. However, so far no  
> one could tell me what the issue really is.
> Can't just R CMD check ignore the CR/LF issues on Windows? I was  
> assuming that it is not making distinction between \r\n and \n  
> anyway ...

I thought the input routines were supposed to be converting \r\n to \n, 
but that's not happening during the check.  I can't see where the change 
occurs, because I don't know how to reproduce the error other than by

Rterm --no-save <RLadyBug-Ex.R

(using the examples file produced during Rcmd check) and as far as I can 
see, gdb in Windows doesn't let me debug this, there's no way to get it 
to allow redirected input.

It would be nice if some other debugger knew how to handle the debug 
information that gcc produces, or gcc could produce Borland or MS debug 
info so I didn't have to use gdb, but so far no luck with that.

Duncan



From hpages at fhcrc.org  Fri Nov  3 05:10:22 2006
From: hpages at fhcrc.org (Herve Pages)
Date: Thu, 02 Nov 2006 20:10:22 -0800
Subject: [Rd] Display problem with named complex vectors
Message-ID: <454AC12E.4020002@fhcrc.org>

Hi,


> z <- (-1:3)+2i
> names(z) <- LETTERS[1:5]
> z
    A     B     C     D     E
-1+2i  0+2i  1+2i  2+2i  3+2i

Nice :-)

> names(z)[2] <- "long name"
> z
        A long name         C         D         E
-1+2i  0+2i  1+2i  2+2i  3+2i

Not nice :-(

This happens with R-2.4.0 and current R-devel.
It also happens with raw vectors as reported one month ago.


Cheers,
H.



From luke at stat.uiowa.edu  Fri Nov  3 05:26:22 2006
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Thu, 2 Nov 2006 22:26:22 -0600 (CST)
Subject: [Rd] allocVector bug ?
In-Reply-To: <200611011720.09139.vdergachev@rcgardis.com>
References: <200611011720.09139.vdergachev@rcgardis.com>
Message-ID: <Pine.OSX.4.61.0611022216320.1246@luke-tierneys-computer.local>

On Wed, 1 Nov 2006, Vladimir Dergachev wrote:

>
> Hi all,
>
>  I was looking at the following piece of code in src/main/memory.c, function
> allocVector :
>
>    if (size <= NodeClassSize[1]) {
> 	node_class = 1;
> 	alloc_size = NodeClassSize[1];
>    }
>    else {
> 	node_class = LARGE_NODE_CLASS;
> 	alloc_size = size;
> 	for (i = 2; i < NUM_SMALL_NODE_CLASSES; i++) {
> 	    if (size <= NodeClassSize[i]) {
> 		node_class = i;
> 		alloc_size = NodeClassSize[i];
> 		break;
> 	    }
> 	}
>    }
>
>
> It appears that for LARGE_NODE_CLASS the variable alloc_size should not be
> size, but something far less as we are not using vector heap, but rather
> calling malloc directly in the code below (and from discussions I read on
> this mailing list I think that these two are different - please let me know
> if I am wrong).
>
> So when allocate a large vector the garbage collector goes nuts trying to find
> all that space which is not going to be needed after all.

This is as intended, not a bug. The garbage collector does not "go
nuts" -- it is doing a garbage collection that may release memory in
advance of making a large allocation.  The size of the current
allocation request is used as part of the process of deciding when to
satisfy an allocation by malloc (of a single large noda or a page) and
when to first do a gc.  It is essential to do this for large
allocations as well to keep the memory footprint down and help reduce
fragmentation.

The strategy for deciding when to allocate and when to gc is by
necessity heuristic.  It tries to keep overall memory footprint low
but at the same time tries to adapt to usage so that gc happens less
oftn once a pattern of using larger amounts of memory emerges. The
current strategy seems quite robust across a large range of
architactures, memory configurations, and applications.

That said, when I wrote the mamager I kept in mind that we might
eventually want to try morre sophisticated schemes and/or allow some
user control over the schemes used.  It may be time to revisit this
soon.

luke


>
> I made an experiment and replaced the line alloc_size=size with alloc_size=0.
>
> R compiled fine (both 2.4.0 and 2.3.1) and passed make check with no issues
> (it all printed OK).
>
> Furthermore, all allocVector calls completed in no time and my test case run
> very fast (22 seconds, as opposed to minutes).
>
> In addition, attach() was instantaneous which was wonderful.
>
> Could anyone with deeper knowledge of R internals comment on whether this
> makes any sense ?
>
>                           thank you very much !
>
>                                        Vladimir Dergachev
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu



From hpages at fhcrc.org  Fri Nov  3 05:46:01 2006
From: hpages at fhcrc.org (Herve Pages)
Date: Thu, 02 Nov 2006 20:46:01 -0800
Subject: [Rd] man page for as.matrix for data frames outdated?
Message-ID: <454AC989.1040002@fhcrc.org>

Hi again,


The man page for 'as.matrix' says:

     'as.matrix' is a generic function. The method for data frames will
     convert any non-numeric/complex column into a character vector
     using 'format' and so return a character matrix, except that
     all-logical data frames will be coerced to a logical matrix.

It's true that "all-logical data frames will be coerced to a logical
matrix":

    > fourLogicals <- 2:5>3
    > df1 <- data.frame(a=fourLogicals)
    > storage.mode(as.matrix(df1))
    [1] "logical"

Otherwise it's not true that 'as.matrix' will return a character matrix:

    > fourInts <- 2:-1
    > df2 <- data.frame(a=fourLogicals, b=fourInts)
    > storage.mode(as.matrix(df2))
    [1] "integer"


    > fourDoubles <- rep(pi,4)
    > df3 <- data.frame(c=fourDoubles, a=fourLogicals, b=fourInts)
    > storage.mode(as.matrix(df3))
    [1] "double"


    > fourComplexes <- (-1:2)+3i
    > df4 <- data.frame(a=fourLogicals, d=fourComplexes, b=fourInts,
    c=fourDoubles)
    > storage.mode(as.matrix(df4))
    [1] "complex"

If one column is of mode character, then 'as.matrix' will effectively
return a character matrix:

    > df5 <- data.frame(toto=c("a","bb"), titi=c(9,999))
    > storage.mode(as.matrix(df5))
    [1] "character"

Note that the doc says that "any non-numeric/complex column" will
be passed thru 'format' which seems to be exactly the other way
around:

    > as.matrix(df5)
      toto titi
    1 "a"  "  9"
    2 "bb" "999"

Anyway why one would like to have the numeric values passed
thru 'format' to start with?

This is in R-2.4.0 and recent R-devel.

Best,
H.



From maechler at stat.math.ethz.ch  Fri Nov  3 09:26:17 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 3 Nov 2006 09:26:17 +0100
Subject: [Rd] man page for as.matrix for data frames outdated?
In-Reply-To: <454AC989.1040002@fhcrc.org>
References: <454AC989.1040002@fhcrc.org>
Message-ID: <17738.64809.495879.29680@stat.math.ethz.ch>

>>>>> "Herve" == Herve Pages <hpages at fhcrc.org>
>>>>>     on Thu, 02 Nov 2006 20:46:01 -0800 writes:

    Herve> Hi again, The man page for 'as.matrix' says:

   >>      'as.matrix' is a generic function. The method
   >> for data frames will convert any non-numeric/complex
   >> column into a character vector using 'format' and so
   >> return a character matrix, except that all-logical
   >> data frames will be coerced to a logical matrix.

In very old versions of R (e.g. 0.3 from March 1996),

    is.numeric(<logical>)  was TRUE
and there the help page was entirely correct.

I think if you replace [in the above paragraph]
    "non-numeric/complex"
by  "non-(logical/numeric/complex)"

the help page is correct again.


    Herve> If one column is of mode character, then 'as.matrix'
    Herve> will effectively return a character matrix:

(as it says in the man page, and always did in all
 implementations of the S language)

    Herve> Note that the doc says that "any non-numeric/complex
    Herve> column" will be passed thru 'format' which seems to
    Herve> be exactly the other way around:

No!  You left off the second part of the statement cited initally.
Slightly reformulated:

	 Iff there's any non-(logical/numeric/complex) column,
	 that will have to be passed through format and hence
	 the result must be a character matrix 
	 and hence every other column also needs to be "formatted"


    >> as.matrix(df5)
    Herve>       toto titi 1 "a" " 9" 2 "bb" "999"

    Herve> Anyway why one would like to have the numeric values
    Herve> passed thru 'format' to start with?

Recall: The result must be a matrix !
	If it can't be a numeric matrix the decision was it must
	be character.

BTW: Exactly because of your problems,  
     The function   data.matrix()  had been devised (long ago in
     pre-R times),
     and data.matrix  *is*  the first entry in "See Also" on the
     help page for as.matrix

Martin



From stukes at gibbs-soell.com  Fri Nov  3 10:07:35 2006
From: stukes at gibbs-soell.com (stukes at gibbs-soell.com)
Date: Fri,  3 Nov 2006 10:07:35 +0100 (CET)
Subject: [Rd] tip 181 (PR#9335)
Message-ID: <20061103090735.1D25617553@slim.kubism.ku.dk>

Re: tip 181=20

V j MC a I


V l emic A g nnounces $9 M A q quisi p tion of Nus m crib v e Which
Brings Combined Technology To Change The Educational
And M v edica p l Industries!

Compan t y : Ve f mi e cs
Sy l mb e ol : V h MC b I
Status : Ho u t Technology Re c lea m se
P t ric k e : $ 0,6 h 0
5 Day T u arge r t: $ 1. u 80

What these two c n ompanie d s do is ama g zi v ng. V a MC f I p n rovi
y des
technology that allow w s its c c ustomer d s to have completely=20
interactive and l e ive educational and con h fer g encing solutions.
In connection with eL t earnin o g De p skt b op they already
providing comp q le o tely virtual e s ducationa q l programs and
through EP Liv k e Onlin e e they have h e oste w d a live and
completely=20
interactive me k dic r al F m orum to the world.

N o uScrib d e o l ffer y s to over 600 y ,000 m y edic n al
professionals nationwide
voice activated m p edic w al record cre k ati k on industry for the spe
s ed
and e b ffici l ency of m f edi k cal records admi r nist u ration.

Combined these two c k ompa s nies are now focused at spac g e age=20
technology and se q rvi y ces that are without equa p l. N g uScrib h e
is
already tr c adi z ng at $ 0,9 f 0 and V a MC r I is currently tra w din
h g at $ 0 x ,60

This news is going out all over the wi u res. Get in befo e re this=20
one goes t s hrough the roo p f! This quick rising s m to u ck is a good
l a ong ter q m winne w r. This s z toc e k is going high due to s a
uperb b h usines o s=20
solutio o ns.


	[[alternative HTML version deleted]]


From Bernhard_Pfaff at fra.invesco.com  Fri Nov  3 10:41:29 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Fri, 3 Nov 2006 09:41:29 -0000
Subject: [Rd] Formal methods are not loaded from NAMESPACE in
	reloadedworkspace image
Message-ID: <E4A9111DA23BA048B9A46686BF727CF461BDF9@DEFRAXMB01.corp.amvescap.net>

Dear R-Devel subscriber,

as a follow up to my yesterday's email: I tested an analogous example
with the S4-package "flexclust" by executing the following code:

library(flexclust)
example(cclust)
cl

After saving the work space and starting a new R process with the
restored work space, the same behaviour (i.e., the methods pertinent to
"flexclust" are not used, even after executing  library(flexclust)).
Yesterday, I executed the code below on a Linux platform with R 2.4.0
and it showed the same behaviour as R 2.5.0dev on Windows. As it seems
right now, the behaviour is platform independent and not peculiar to R
2.5.0dev.

Any pointers and help for solving this problem is much appreciated.

Best,
Bernhard   

>Dear R-Devel subscriber,
>
>I was hinted to the following problem with package 'urca':
>
>If one starts R and executes for instance:
>
>> library(urca)
>> example(ur.df)
>## output as expected, but omitted here
>> class(lc.df)
>[1] "ur.df"
>attr(,"package")
>[1] "urca"
>> class(summary(lc.df))
>[1] "sumurca"
>attr(,"package")
>[1] "urca"
>> 
>
>everything works fine. Now, save the workspace image and quit R. After
>starting R again with the previously restored workspace image one has:
>
>> ls()
>[1] "lc.df"   "Raotbl3"
>> class(lc.df)
>[1] "ur.df"
>attr(,"package")
>[1] "urca"
>
>lc.df
>## now the 'show'-method for objects of class 'ur.df' is not utilised,
>rather the generic 
>## displaying all slots
>
>> library(urca)
>> lc.df
>
>## still the same as compared to the above output.
>## similarily
>
>> class(summary(lc.df))
>[1] "table"
>
>
>In the NAMESPACE file export directives for methods and classes are
>included as:
>
>## Classes       
>exportClasses("urca", "ca.jo", "cajo.test", "ur.kpss", "ca.po",
>"ur.ers", "ur.pp", "ur.sp", "ur.df", "ur.za", "sumurca")
>## Methods
>exportMethods("show", "plot", "summary")
>
>Any help or pointers for solving this problem is much appreciated.
>
>Best,
>Bernhard
>
>> sessionInfo()
>R version 2.5.0 Under development (unstable) (2006-10-10 r39600) 
>i386-pc-mingw32 
>
>locale:
>LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_
>MONETARY=
>German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252
>
>attached base packages:
>[1] "methods"   "stats"     "graphics"  "grDevices" "datasets"  "utils"
>
>[7] "base"     
>
>other attached packages:
>    urca fortunes 
> "1.0-0"  "1.3-2" 
>*****************************************************************
>Confidentiality Note: The information contained in this 
>mess...{{dropped}}
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>


From paoso at libero.it  Fri Nov  3 11:13:17 2006
From: paoso at libero.it (paoso at libero.it)
Date: Fri,  3 Nov 2006 11:13:17 +0100 (CET)
Subject: [Rd] Saving images from dialog (PR#9336)
Message-ID: <20061103101317.CFC7B56281@slim.kubism.ku.dk>

Full_Name: Paolo Sonego
Version: 2.4.0
OS: Windows XP Pro SP2
Submission from: (NULL) (140.105.9.245)


This bug (from the definition in the R FAQ ("If a command does the wrong thing,
that is a bug.") seems to me an inconsistent, but annoying disregard:
plot whatever image you want, e.g.:
hist(rnorm(1000), col = "blue")
When you try saving the image from the window dialog menu: File > Save as >
Png... (PDF..., etc.) in the pop-up dialog appears a 'Save as Type' form with
the Png files (*.png); typing the name of the image file without extension (e.g
image1) will produce a file without automatic png insertion at the end, i.e.,
file name will be image1 vs. image1.png (the 'right' output imho).


From pkampst=rbugspam at few.vu.nl  Fri Nov  3 11:33:54 2006
From: pkampst=rbugspam at few.vu.nl (pkampst=rbugspam at few.vu.nl)
Date: Fri,  3 Nov 2006 11:33:54 +0100 (CET)
Subject: [Rd] win.metafile() resolution too low (PR#9337)
Message-ID: <20061103103354.D7E5057287@slim.kubism.ku.dk>

Full_Name: Peter Kampstra
Version: 2.4.0
OS: Windows
Submission from: (NULL) (130.37.20.20)


Hi,

If you use win.metafile(), "Save as metafile...", or "Copy as metafile" on
Windows, the metafile is rendered at screen resolution. Therefore, the output of
curves like

win.metafile("resolution.emf")
x=seq(1,10,0.001)
y=1/x
plot(x,y,type="l")
dev.off()

does not look smooth. I tracked the problem down to
https://svn.r-project.org/R/trunk/src/gnuwin32/graphapp/metafile.c , to
    hDC = CreateEnhMetaFile(NULL, strlen(name) ? name : NULL, &wr, 
			    "GraphApp\0\0");
If NULL is passed as reference HDC to this function, the metafile will be at
screen resolution. If you use such a picture in Word/Powerpoint/etc, it is
visible that curved lines are not smooth...

Therefore, I suggest using a printer as the reference HDC instead. The following
function can be used:

/*
 *  Creates a HDC to the best printer to be used as a reference for
CreateEnhMetaFile
 */
HDC createbestmetafilehdc() {
	DWORD				neededsize;
	DWORD				noprinters;
	DWORD				printer;
	LPPRINTER_INFO_5	printerinfo = NULL;
	int					bestres = 0;
	HDC					besthdc = 0;

	EnumPrinters(PRINTER_ENUM_CONNECTIONS|PRINTER_ENUM_LOCAL, NULL, 5, NULL, 0,
&neededsize, &noprinters);
 	printerinfo = (LPPRINTER_INFO_5) malloc(neededsize);

	if (EnumPrinters(PRINTER_ENUM_CONNECTIONS|PRINTER_ENUM_LOCAL, NULL, 5,
(LPBYTE)printerinfo, neededsize, &neededsize, &noprinters)) {
		//init best resolution for hdc=0, which is screen resolution:    
		HDC curhdc = GetDC(NULL);
		if (curhdc) {
			bestres = GetDeviceCaps(curhdc, LOGPIXELSX) + GetDeviceCaps(curhdc,
LOGPIXELSY);
			bestres = ReleaseDC(NULL, curhdc); 
		}

		for (int i = 0; i < noprinters; i++) {
			curhdc = CreateDC("WINSPOOL", printerinfo[i].pPrinterName, NULL, NULL);
			if (curhdc) {
				int curres = GetDeviceCaps(curhdc, LOGPIXELSX) + GetDeviceCaps(curhdc,
LOGPIXELSY);
				if (curres > bestres) {
					if (besthdc)
						DeleteDC(besthdc);
					bestres = curres;
					besthdc = curhdc;
				} else {
					DeleteDC(curhdc);
				}
			}
		}
	}

	free(printerinfo);
	return besthdc;
}

This function can be used like:
	HDC refhdc=createbestmetafilehdc();

	hDC = CreateEnhMetaFile(refhdc, strlen(name) ? name : NULL, &wr, 
			    "GraphApp\0\0");
	if (refhdc)
		DeleteDC(refhdc);

And cppix,ppix, etc. can be calculated like (this is a workaround for buggy
drivers??):
	HDC forhdc=refhdc;
	if (!(forhdc))
		forhdc=GetDC(NULL);                   
	cppix = 25.40 * GetDeviceCaps(forhdc,HORZRES) /
GetDeviceCaps(forhdc,HORZSIZE);
	ppix  = 100 * GetDeviceCaps(forhdc, LOGPIXELSX);
	cppiy = 25.40 * GetDeviceCaps(forhdc, VERTRES) / GetDeviceCaps(forhdc,
VERTSIZE);
	ppiy  = 100 * GetDeviceCaps(forhdc, LOGPIXELSY);
	if (!(refhdc))
		ReleaseDC(NULL,forhdc);

And probably some other changes will be necessary...

Keep up the good work,

Peter Kampstra
pkampst=rbugspam at cs.vu.nl / http://peter.kampstra.net


From Bernhard_Pfaff at fra.invesco.com  Fri Nov  3 11:50:26 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Fri, 3 Nov 2006 10:50:26 -0000
Subject: [Rd] WG: Formal methods are not loaded from NAMESPACE
	inreloadedworkspace image
Message-ID: <E4A9111DA23BA048B9A46686BF727CF461BDFD@DEFRAXMB01.corp.amvescap.net>

Sorry, to bother the list one more time: but the following worked at
least for 'urca':

in NAMESPACE I now included explicitly:

import(methods)

a fix of the 'urca'-package will be uploaded to CRAN on the weekend.
Fritz, will this work for ypur package 'flexclust' too? I have in my
DESCRIPTION imports: methods and in flexclust it is in depends: methods.
However, both packages have not import(methods) in their NAMESPACE.
Anyway, I wonder why 'import(methods)' is explicitly needed in
NAMESPACE? Would a smart and bright soul be so kind and enlighten a
flabbergasted one? :-) Many thanks!

Best,
Bernhard

>Dear R-Devel subscriber,
>
>as a follow up to my yesterday's email: I tested an analogous example
>with the S4-package "flexclust" by executing the following code:
>
>library(flexclust)
>example(cclust)
>cl
>
>After saving the work space and starting a new R process with the
>restored work space, the same behaviour (i.e., the methods pertinent to
>"flexclust" are not used, even after executing  library(flexclust)).
>Yesterday, I executed the code below on a Linux platform with R 2.4.0
>and it showed the same behaviour as R 2.5.0dev on Windows. As it seems
>right now, the behaviour is platform independent and not peculiar to R
>2.5.0dev.
>
>Any pointers and help for solving this problem is much appreciated.
>
>Best,
>Bernhard   
>
>>Dear R-Devel subscriber,
>>
>>I was hinted to the following problem with package 'urca':
>>
>>If one starts R and executes for instance:
>>
>>> library(urca)
>>> example(ur.df)
>>## output as expected, but omitted here
>>> class(lc.df)
>>[1] "ur.df"
>>attr(,"package")
>>[1] "urca"
>>> class(summary(lc.df))
>>[1] "sumurca"
>>attr(,"package")
>>[1] "urca"
>>> 
>>
>>everything works fine. Now, save the workspace image and quit R. After
>>starting R again with the previously restored workspace image one has:
>>
>>> ls()
>>[1] "lc.df"   "Raotbl3"
>>> class(lc.df)
>>[1] "ur.df"
>>attr(,"package")
>>[1] "urca"
>>
>>lc.df
>>## now the 'show'-method for objects of class 'ur.df' is not utilised,
>>rather the generic 
>>## displaying all slots
>>
>>> library(urca)
>>> lc.df
>>
>>## still the same as compared to the above output.
>>## similarily
>>
>>> class(summary(lc.df))
>>[1] "table"
>>
>>
>>In the NAMESPACE file export directives for methods and classes are
>>included as:
>>
>>## Classes       
>>exportClasses("urca", "ca.jo", "cajo.test", "ur.kpss", "ca.po",
>>"ur.ers", "ur.pp", "ur.sp", "ur.df", "ur.za", "sumurca")
>>## Methods
>>exportMethods("show", "plot", "summary")
>>
>>Any help or pointers for solving this problem is much appreciated.
>>
>>Best,
>>Bernhard
>>
>>> sessionInfo()
>>R version 2.5.0 Under development (unstable) (2006-10-10 r39600) 
>>i386-pc-mingw32 
>>
>>locale:
>>LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_
>>MONETARY=
>>German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252
>>
>>attached base packages:
>>[1] "methods"   "stats"     "graphics"  "grDevices" 
>"datasets"  "utils"
>>
>>[7] "base"     
>>
>>other attached packages:
>>    urca fortunes 
>> "1.0-0"  "1.3-2" 
>>*****************************************************************
>>Confidentiality Note: The information contained in this 
>>mess...{{dropped}}
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jmc at r-project.org  Fri Nov  3 14:58:21 2006
From: jmc at r-project.org (John Chambers)
Date: Fri, 03 Nov 2006 08:58:21 -0500
Subject: [Rd] Formal methods are not loaded from NAMESPACE in
 reloadedworkspace image
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF461BDF9@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF461BDF9@DEFRAXMB01.corp.amvescap.net>
Message-ID: <454B4AFD.6030406@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061103/eee3c0a8/attachment.pl 

From murdoch at stats.uwo.ca  Fri Nov  3 15:12:29 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Fri,  3 Nov 2006 15:12:29 +0100 (CET)
Subject: [Rd] [R] difference in using with() and the "data" argument in
	glm (PR#9338)
Message-ID: <20061103141229.ABDD944225@slim.kubism.ku.dk>

I've redirected this reply from r-help to the bugs list.

On 11/3/2006 8:25 AM, vito muggeo wrote:
> Dear all,
> I am dealing with the following (apparently simple problem):
> For some reasons I am interested in passing variables from a dataframe 
> to a specific environment, and in fitting a standard glm:
> 
> dati<-data.frame(y=rnorm(10),x1=runif(10),x2=runif(10))
> KK<-new.env()
> for(i in 1:ncol(dati)) assign(names(dati[i]),dati[[i]],envir=KK)
> #Now the following two lines work correctly:
> coef(glm(y~x1+x2,data=KK))
> with(KK,coef(glm(y~x1+x2)))
> 
> #However if I write the above code inside a function, with() does not 
> appear to work..
> 
> ff<-function(Formula,Data,method=1){
>      KK<-new.env()
>      for(i in 1:ncol(Data)) assign(names(Data[i]),Data[[i]],envir=KK)
>      o<-if(method==1) glm(Formula,data=KK) else with(KK,glm(Formula))
>      o}
> 
>  > ff(y~x1+x2,dati,1) #it works
> Call:  glm(formula = Formula, data = KK)
> ..[SNIP]..
>  > ff(y~x1+x2,dati,2) #it does not
> Error in eval(expr, envir, enclos) : object "y" not found
>  >
> 
> Could anyone to explain such difference? I believed that
> "with(data,glm(formula))" and "glm(formula,data)" were equivalent.

I think this is a bug in terms.formula.  Near the end it has

     environment(terms) <- environment(x)

where x is the formula.  Since "y" isn't defined in that environment, it
fails.  It would work for you with

     environment(terms) <- data

but see below.

A workaround that should work for you is to put

environment(Formula) <- KK

before the call to glm.

I'm not going to make the patch I suggest above, because I don't think 
it's consistent with the expected behaviour of glm() in the case where 
some of the terms in the formula are supposed to come from 
environment(x), and some from "data".

I don't know how to handle that case properly:  I think it requires a 
different search strategy than R employs (but I might be wrong).  This 
isn't a problem with the workaround I suggested to you, because there 
the parent of KK is environment(x), but that wouldn't be true in general.

Duncan Murdoch


From sfalcon at fhcrc.org  Fri Nov  3 15:44:51 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 03 Nov 2006 06:44:51 -0800
Subject: [Rd] WG: Formal methods are not loaded from NAMESPACE
	inreloadedworkspace image
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF461BDFD@DEFRAXMB01.corp.amvescap.net>
	(Bernhard Pfaff's message of "Fri, 3 Nov 2006 10:50:26 -0000")
References: <E4A9111DA23BA048B9A46686BF727CF461BDFD@DEFRAXMB01.corp.amvescap.net>
Message-ID: <m2hcxgpp24.fsf@ziti.local>

"Pfaff, Bernhard Dr." <Bernhard_Pfaff at fra.invesco.com> writes:

> Sorry, to bother the list one more time: but the following worked at
> least for 'urca':
>
> in NAMESPACE I now included explicitly:
>
> import(methods)
>
> a fix of the 'urca'-package will be uploaded to CRAN on the weekend.
> Fritz, will this work for ypur package 'flexclust' too? I have in my
> DESCRIPTION imports: methods and in flexclust it is in depends: methods.
> However, both packages have not import(methods) in their NAMESPACE.
> Anyway, I wonder why 'import(methods)' is explicitly needed in
> NAMESPACE? Would a smart and bright soul be so kind and enlighten a
> flabbergasted one? :-) Many thanks!

Because 4 > 1.

I share your flabbergasted state.  As I understand it, if you want to
use methods, you might need to:

1. Say so in .onLoad where you require(methods)

2. Certainly Depends: methods

3. As you found, in the NAMESPACE file it helps to import(methods)

4. But then you also need to Import: methods

+ seth


From sfalcon at fhcrc.org  Fri Nov  3 15:48:31 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 03 Nov 2006 06:48:31 -0800
Subject: [Rd] Formal methods are not loaded from NAMESPACE in
	reloadedworkspace image
In-Reply-To: <454B4AFD.6030406@r-project.org> (John Chambers's message of "Fri,
	03 Nov 2006 08:58:21 -0500")
References: <E4A9111DA23BA048B9A46686BF727CF461BDF9@DEFRAXMB01.corp.amvescap.net>
	<454B4AFD.6030406@r-project.org>
Message-ID: <m2d584pow0.fsf@ziti.local>

John Chambers <jmc at r-project.org> writes:

> I haven't had a chance to verify these exact examples, but the likely 
> explanation is that loading the workspace does not cache the  saved 
> methods.  Assuming this is indeed what's happening, the workaround is to 
> cache them "manually" by the call:
>
>   cacheMetaData(.GlobalEnv)
>
> (after attaching the relevant library)
>
> It would be nice to have the same effect occur automatically, but there 
> may be issues since the needed class definitions may not be available 
> when the saved workspace is reloaded.
>
> A natural question to ask is whether there is some practical motivation 
> for this exercise.

The main use case is that since serialization of objects is such an
R-ish thing to do, you really want to have deserialized S4 instances
"work" properly when loaded.

I admit that it is also useful to be able to load an arbitrary object
and inspect it even if it will be "broken" (without this, it would be
very hard to write any sort of automated class update code).  It would
seem that this behavior could be achieved in a force=TRUE mode and
that otherwise, it would be an error to deserialize an S4 instance
when the class def is not available.

+ seth


From jmc at r-project.org  Fri Nov  3 15:51:57 2006
From: jmc at r-project.org (John Chambers)
Date: Fri, 03 Nov 2006 09:51:57 -0500
Subject: [Rd] WG: Formal methods are not loaded from NAMESPACE
 inreloadedworkspace image
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF461BDFD@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF461BDFD@DEFRAXMB01.corp.amvescap.net>
Message-ID: <454B578D.1070502@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061103/ddf8cf3a/attachment.pl 

From juan_sr at uol.com.br  Fri Nov  3 15:59:33 2006
From: juan_sr at uol.com.br (Juan Santiago Ramseyer)
Date: Fri, 03 Nov 2006 11:59:33 -0300
Subject: [Rd] data.entry(), de() fail in FC6-x86_64
Message-ID: <1162565973.3431.8.camel@localhost.localdomain>

Buffer overflow detect in FC6-x86_64, see down.

Juan.

R version 2.4.0 (2006-10-03)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R ? um software livre e vem sem GARANTIA ALGUMA.
Voc? pode redistribu?-lo sob certas circunst?ncias.
Digite 'license()' ou 'licence()' para detalhes de distribui??o.

R ? um projeto colaborativo com muitos contribuidores.
Digite 'contributors()' para obter mais informa??es e
'citation()' para saber como citar o R ou pacotes do R em publica??es.

Digite 'demo()' para demonstra??es, 'help()' para o sistema on-line de
ajuda,
ou 'help.start()' para abrir o sistema de ajuda em HTML no seu
navegador.
Digite 'q()' para sair do R.

Loading Tcl/Tk interface ... done
[?rea de trabalho anterior carregada]

> if(!exists("baseenv", mode="function")) baseenv <- function() NULL
options(STERM='iESS', editor='emacsclient')
> > 
> 
> c <- c(1,2,3,4)
> de(c)
*** buffer overflow detected ***: /usr/lib64/R/bin/exec/R terminated
======= Backtrace: =========
/lib64/libc.so.6(__chk_fail+0x2f)[0x3d416e0dff]
/lib64/libc.so.6[0x3d416e2387]
/usr/lib64/R/modules//R_X11.so[0x2aaaaf413a3f]
/usr/lib64/R/modules//R_X11.so[0x2aaaaf415215]
/usr/lib64/R/modules//R_X11.so[0x2aaaaf41634f]
/usr/lib64/R/modules//R_X11.so(RX11_dataentry+0x8db)[0x2aaaaf41781b]
/usr/lib64/R/lib/libR.so[0x352b4dd873]
/usr/lib64/R/lib/libR.so(Rf_eval+0x452)[0x352b4b0b22]
/usr/lib64/R/lib/libR.so[0x352b4b17b2]
/usr/lib64/R/lib/libR.so(Rf_eval+0x452)[0x352b4b0b22]
/usr/lib64/R/lib/libR.so(Rf_applyClosure+0x286)[0x352b4b2c16]
/usr/lib64/R/lib/libR.so(Rf_eval+0x2fc)[0x352b4b09cc]
/usr/lib64/R/lib/libR.so[0x352b4b4990]
/usr/lib64/R/lib/libR.so(Rf_eval+0x452)[0x352b4b0b22]
/usr/lib64/R/lib/libR.so[0x352b4b17b2]
/usr/lib64/R/lib/libR.so(Rf_eval+0x452)[0x352b4b0b22]
/usr/lib64/R/lib/libR.so(Rf_applyClosure+0x286)[0x352b4b2c16]
/usr/lib64/R/lib/libR.so(Rf_eval+0x2fc)[0x352b4b09cc]
/usr/lib64/R/lib/libR.so(Rf_ReplIteration+0x2e9)[0x352b4cef99]
/usr/lib64/R/lib/libR.so[0x352b4cf130]
/usr/lib64/R/lib/libR.so(run_Rmainloop+0x50)[0x352b4cf460]
/usr/lib64/R/bin/exec/R(main+0x1d)[0x4007ed]
/lib64/libc.so.6(__libc_start_main+0xf4)[0x3d4161da44]
/usr/lib64/R/bin/exec/R[0x400709]
======= Memory map: ========
00400000-00401000 r-xp 00000000 16:42
842969                             /usr/lib64/R/bin/exec/R
00600000-00602000 rw-p 00000000 16:42
842969                             /usr/lib64/R/bin/exec/R
00602000-01f0c000 rw-p 00602000 00:00 0
[heap]
40000000-40001000 ---p 40000000 00:00 0 
40001000-40a01000 rw-p 40001000 00:00 0 
352ac00000-352ac96000 r-xp 00000000 16:42
2331260                        /usr/lib64/libgfortran.so.1.0.0
352ac96000-352ae95000 ---p 00096000 16:42
2331260                        /usr/lib64/libgfortran.so.1.0.0
352ae95000-352ae97000 rw-p 00095000 16:42
2331260                        /usr/lib64/libgfortran.so.1.0.0
352b000000-352b02c000 r-xp 00000000 16:42
842967                         /usr/lib64/R/lib/libRblas.so
352b02c000-352b22b000 ---p 0002c000 16:42
842967                         /usr/lib64/R/lib/libRblas.so
352b22b000-352b22c000 rw-p 0002b000 16:42
842967                         /usr/lib64/R/lib/libRblas.so
352b400000-352b621000 r-xp 00000000 16:42
844808                         /usr/lib64/R/lib/libR.so
352b621000-352b821000 ---p 00221000 16:42
844808                         /usr/lib64/R/lib/libR.so
352b821000-352b835000 rw-p 00221000 16:42
844808                         /usr/lib64/R/lib/libR.so
352b835000-352b8ce000 rw-p 352b835000 00:00 0 
352d600000-352d65b000 r-xp 00000000 16:42
2331672                        /usr/lib64/libXt.so.6.0.0
352d65b000-352d85a000 ---p 0005b000 16:42
2331672                        /usr/lib64/libXt.so.6.0.0
352d85a000-352d860000 rw-p 0005a000 16:42
2331672                        /usr/lib64/libXt.so.6.0.0
352d860000-352d861000 rw-p 352d860000 00:00 0 
352fe00000-352fe1b000 r-xp 00000000 16:42
779639                         /lib64/libpcre.so.0.0.1
352fe1b000-353001b000 ---p 0001b000 16:42
779639                         /lib64/libpcre.so.0.0.1
353001b000-353001c000 rw-p 0001b000 16:42
779639                         /lib64/libpcre.so.0.0.1
3d40600000-3d4061a000 r-xp 00000000 16:42
779764                         /lib64/ld-2.5.so
3d40819000-3d4081a000 r--p 00019000 16:42
779764                         /lib64/ld-2.5.so
3d4081a000-3d4081b000 rw-p 0001a000 16:42
779764                         /lib64/ld-2.5.so
3d41200000-3d41235000 r-xp 00000000 16:42
2306537                        /usr/lib64/libreadline.so.5.1
3d41235000-3d41434000 ---p 00035000 16:42
2306537                        /usr/lib64/libreadline.so.5.1
3d41434000-3d4143c000 rw-p 00034000 16:42
2306537                        /usr/lib64/libreadline.so.5.1
3d4143c000-3d4143d000 rw-p 3d4143c000 00:00 0 
3d41600000-3d41744000 r-xp 00000000 16:42
779765                         /lib64/libc-2.5.so
3d41744000-3d41944000 ---p 00144000 16:42
779765                         /lib64/libc-2.5.so
3d41944000-3d4194
Process R abortado at Fri Nov  3 11:53:57 2006


From p.dalgaard at biostat.ku.dk  Fri Nov  3 16:12:17 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 03 Nov 2006 16:12:17 +0100
Subject: [Rd] data.entry(), de() fail in FC6-x86_64
In-Reply-To: <1162565973.3431.8.camel@localhost.localdomain>
References: <1162565973.3431.8.camel@localhost.localdomain>
Message-ID: <x2wt6cva26.fsf@viggo.kubism.ku.dk>

Juan Santiago Ramseyer <juan_sr at uol.com.br> writes:

> Buffer overflow detect in FC6-x86_64, see down.
> 
> Juan.

Yes, this has been reported before and is fixed in R-patched. A
workaround is not to use an UTF8 based locale. Someone might file a
bug report against FC6 so that they might possibly decide to update
the RPM with the relevant patch. Otherwise, build the patched version
or wait for 2.4.1.

> Loading Tcl/Tk interface ... done
> [?rea de trabalho anterior carregada]
> 
> > if(!exists("baseenv", mode="function")) baseenv <- function() NULL
> options(STERM='iESS', editor='emacsclient')
> > > 
> > 
> > c <- c(1,2,3,4)
> > de(c)
> *** buffer overflow detected ***: /usr/lib64/R/bin/exec/R terminated
....

Or, fix(airquality) suffices to reproduce this.


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From jmc at r-project.org  Fri Nov  3 16:12:27 2006
From: jmc at r-project.org (John Chambers)
Date: Fri, 03 Nov 2006 10:12:27 -0500
Subject: [Rd] Formal methods are not loaded from NAMESPACE in
 reloadedworkspace image
In-Reply-To: <m2d584pow0.fsf@ziti.local>
References: <E4A9111DA23BA048B9A46686BF727CF461BDF9@DEFRAXMB01.corp.amvescap.net>
	<454B4AFD.6030406@r-project.org> <m2d584pow0.fsf@ziti.local>
Message-ID: <454B5C5B.7080309@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061103/085a7b27/attachment.pl 

From ggrothendieck at gmail.com  Fri Nov  3 16:34:34 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 3 Nov 2006 10:34:34 -0500
Subject: [Rd] [R] difference in using with() and the "data" argument in
	glm (PR#9338)
In-Reply-To: <20061103141229.ABDD944225@slim.kubism.ku.dk>
References: <20061103141229.ABDD944225@slim.kubism.ku.dk>
Message-ID: <971536df0611030734w4109224bt6a1aebc501b065af@mail.gmail.com>

One thing I noticed is that ?glm does not really specify what happens
if you do not give a value for data.  Is data then just skipped so that search
takes place in enivonrment(formula) only or is it supposed to default to
something?   Some clarification in ?glm would be helpful.

On 11/3/06, murdoch at stats.uwo.ca <murdoch at stats.uwo.ca> wrote:
> I've redirected this reply from r-help to the bugs list.
>
> On 11/3/2006 8:25 AM, vito muggeo wrote:
> > Dear all,
> > I am dealing with the following (apparently simple problem):
> > For some reasons I am interested in passing variables from a dataframe
> > to a specific environment, and in fitting a standard glm:
> >
> > dati<-data.frame(y=rnorm(10),x1=runif(10),x2=runif(10))
> > KK<-new.env()
> > for(i in 1:ncol(dati)) assign(names(dati[i]),dati[[i]],envir=KK)
> > #Now the following two lines work correctly:
> > coef(glm(y~x1+x2,data=KK))
> > with(KK,coef(glm(y~x1+x2)))
> >
> > #However if I write the above code inside a function, with() does not
> > appear to work..
> >
> > ff<-function(Formula,Data,method=1){
> >      KK<-new.env()
> >      for(i in 1:ncol(Data)) assign(names(Data[i]),Data[[i]],envir=KK)
> >      o<-if(method==1) glm(Formula,data=KK) else with(KK,glm(Formula))
> >      o}
> >
> >  > ff(y~x1+x2,dati,1) #it works
> > Call:  glm(formula = Formula, data = KK)
> > ..[SNIP]..
> >  > ff(y~x1+x2,dati,2) #it does not
> > Error in eval(expr, envir, enclos) : object "y" not found
> >  >
> >
> > Could anyone to explain such difference? I believed that
> > "with(data,glm(formula))" and "glm(formula,data)" were equivalent.
>
> I think this is a bug in terms.formula.  Near the end it has
>
>     environment(terms) <- environment(x)
>
> where x is the formula.  Since "y" isn't defined in that environment, it
> fails.  It would work for you with
>
>     environment(terms) <- data
>
> but see below.
>
> A workaround that should work for you is to put
>
> environment(Formula) <- KK
>
> before the call to glm.
>
> I'm not going to make the patch I suggest above, because I don't think
> it's consistent with the expected behaviour of glm() in the case where
> some of the terms in the formula are supposed to come from
> environment(x), and some from "data".
>
> I don't know how to handle that case properly:  I think it requires a
> different search strategy than R employs (but I might be wrong).  This
> isn't a problem with the workaround I suggested to you, because there
> the parent of KK is environment(x), but that wouldn't be true in general.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Bernhard_Pfaff at fra.invesco.com  Fri Nov  3 16:55:28 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Fri, 3 Nov 2006 15:55:28 -0000
Subject: [Rd] Formal methods are not loaded from NAMESPACE in
	reloadedworkspace image
In-Reply-To: <454B5C5B.7080309@r-project.org>
Message-ID: <E4A9111DA23BA048B9A46686BF727CF461BE00@DEFRAXMB01.corp.amvescap.net>

Dear John, Dear Seth,

many (a thousands) thanks for your clarification and highlighting of the
problem.

>It's not a simple serialization issue, but related to the initial 
>computations when a saved image is reloaded at the start of a session, 
>so the implication is less general than you imply.

Hm, yes, that seems to be true. I do not know what the R-wizard Prof.
Douglas Bates has done, but going through the same exercise with:

library(lme4)
example(lmer)

saving the work space (without moving it to another file), quitting R
and starting such that the previously work space is restored, will yield
the following:

> ls()
[1] "fm1" "fm2"
> showMethods("summary")

Function "summary":
 <not a generic function>

> fm1
Loading required package: lme4
Loading required package: Matrix
Loading required package: lattice

## output as expected, but omitted here

Well, John, referring to your question. IMHO it is a question how useRs
work with R. Personnaly, I almost never work with work spaces but rather
scripts: write it - like it or fudge it. Anyway, a useR has pointed me
to this behaviour and I reckon that he uses the 'save work
space'-approach for an E-lab class that he teaches.   

Aside, of this issue and something more for R-Core, I am wondering if
some hint/pointer should be placed in the R-ext document (maybe in the
section 'Package name spaces' and/or in the subsection 'The DESCRIPTION
file'). I have re-read it, but could not find a hint with respect to
'methods' and 'S4'.

Let me thank you once more for your time taken, patience devoted and
enlightenment given to this problem. I must confess, that 'serialization
of R objects' is beyond the scope of my computer literacy as an
economist.

Gratefully,
Bernhard


 

>
>If you move the saved image to another file, say "savedImage", then:
>
> > load("savedImage")
> > library(urca)
> > showMethods("summary")
>Function: summary (package base)
>object="ANY"
>object="ca.jo"
>object="ca.po"
>object="cajo.test"
>object="ur.df"
>object="ur.ers"
>object="ur.kpss"
>object="ur.pp"
>object="ur.sp"
>object="ur.za"
>
>and summary(lc.df) then works as expected.
>
>So the workaround, other than inserting all the import(methods), etc. 
>you can think of, seems to be to save/load explicitly.
>
>Seth Falcon wrote:
>> John Chambers <jmc at r-project.org> writes:
>>
>>   
>>> I haven't had a chance to verify these exact examples, but 
>the likely 
>>> explanation is that loading the workspace does not cache the  saved 
>>> methods.  Assuming this is indeed what's happening, the 
>workaround is to 
>>> cache them "manually" by the call:
>>>
>>>   cacheMetaData(.GlobalEnv)
>>>
>>> (after attaching the relevant library)
>>>
>>> It would be nice to have the same effect occur 
>automatically, but there 
>>> may be issues since the needed class definitions may not be 
>available 
>>> when the saved workspace is reloaded.
>>>
>>> A natural question to ask is whether there is some 
>practical motivation 
>>> for this exercise.
>>>     
>>
>> The main use case is that since serialization of objects is such an
>> R-ish thing to do, you really want to have deserialized S4 instances
>> "work" properly when loaded.
>>
>> I admit that it is also useful to be able to load an arbitrary object
>> and inspect it even if it will be "broken" (without this, it would be
>> very hard to write any sort of automated class update code). 
> It would
>> seem that this behavior could be achieved in a force=TRUE mode and
>> that otherwise, it would be an error to deserialize an S4 instance
>> when the class def is not available.
>>
>> + seth
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>   
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>
*****************************************************************
Confidentiality Note: The information contained in this mess...{{dropped}}


From hpages at fhcrc.org  Fri Nov  3 19:50:10 2006
From: hpages at fhcrc.org (Herve Pages)
Date: Fri, 03 Nov 2006 10:50:10 -0800
Subject: [Rd] man page for as.matrix for data frames outdated?
In-Reply-To: <17738.64809.495879.29680@stat.math.ethz.ch>
References: <454AC989.1040002@fhcrc.org>
	<17738.64809.495879.29680@stat.math.ethz.ch>
Message-ID: <454B8F62.3030205@fhcrc.org>

Hi Martin,

Thanks for the answer!
OK I can use data.matrix to convert a data frame to a numeric
matrix but that's another story. Basically I'm reporting 2
problems with 'as.matrix' when applied to a data frame:

1) A documentation problem:

    "The method for data frames will convert any
     non-numeric/complex column into a character vector
     using 'format'"

    > df5 <- data.frame(toto=c("a","bb"), titi=c(9,999))
    > as.matrix(df5)
      toto titi
    1 "a"  "  9"
    2 "bb" "999"

     As I said, it seems to be the other way around: it's not the
     "non-numeric" column that is converted to a character vector,
     it's the "numeric" column.

2) the questionable decision to do this conversion using 'format'
   (leading to the addition of unnecessary white space) and not
   simply 'as.character'

BTW your mailer seems to do some strange reformatting to the output
of my code snippets making it hard to see the "formatting" problem
that I'm trying to show.

Cheers,

H.


From harringt at stat.ubc.ca  Fri Nov  3 20:49:20 2006
From: harringt at stat.ubc.ca (harringt at stat.ubc.ca)
Date: Fri,  3 Nov 2006 20:49:20 +0100 (CET)
Subject: [Rd] eval(match.call()) (PR#9339)
Message-ID: <20061103194920.934D55728D@slim.kubism.ku.dk>

Full_Name: Justin Harrington
Version: 2.4.0
OS: Fedora Core 6
Submission from: (NULL) (142.103.121.203)


When I type the (albeit stupid) command

eval(match.call())

R crashes with the following messages (truncated):

*** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated

The complete output is available at http://md.stat.ubc.ca/Routput.txt

For reference, here are the results from version:

platform       i686-redhat-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status
major          2
minor          4.0
year           2006
month          10
day            03
svn rev        39566
language       R
version.string R version 2.4.0 (2006-10-03)

and my version of R was installed using yum from the fedora repositories.


From bill at insightful.com  Fri Nov  3 20:52:21 2006
From: bill at insightful.com (Bill Dunlap)
Date: Fri, 3 Nov 2006 11:52:21 -0800 (PST)
Subject: [Rd] man page for as.matrix for data frames outdated?
In-Reply-To: <454B8F62.3030205@fhcrc.org>
References: <454AC989.1040002@fhcrc.org>
	<17738.64809.495879.29680@stat.math.ethz.ch>
	<454B8F62.3030205@fhcrc.org>
Message-ID: <Pine.GSO.4.56.0611031135130.12265@durian.statsci.com>

On Fri, 3 Nov 2006, Herve Pages wrote:

>     > df5 <- data.frame(toto=c("a","bb"), titi=c(9,999))
>     > as.matrix(df5)
>       toto titi
>     1 "a"  "  9"
>     2 "bb" "999"
> ...
> 2) the questionable decision to do this conversion using 'format'
>    (leading to the addition of unnecessary white space) and not
>    simply 'as.character'

It is possible that this decision was made because one use of
as.matrix(mixed-mode-data-frame) was for printing data.frames and
format(numberic-column) would line up the decimal points and
make one scientific-notation/or-not decision for the entire column.
(Splus3.4, c. 1996, printed data.frames with print(as.matrix(x)),
but by 1999 Splus4.7 was using print(format(x)).)

   R> df6<- data.frame(toto=c("a","bb","ccc"), titi=c(.9e-20,.99999,999.9))
   R> as.matrix(df6)
     toto  titi
   1 "a"   "9.0000e-21"
   2 "bb"  "9.9999e-01"
   3 "ccc" "9.9990e+02"
   R> df7<-data.frame(toto=c("a","bb","ccc"), titi=c(.9,.99999,999.9))
   R> as.matrix(df7)
     toto  titi
   1 "a"   "  0.90000"
   2 "bb"  "  0.99999"
   3 "ccc" "999.90000"

Once such a decision is made it is hard to change things, especially
when the benefit is slight.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From marc_schwartz at comcast.net  Fri Nov  3 21:09:40 2006
From: marc_schwartz at comcast.net (marc_schwartz at comcast.net)
Date: Fri,  3 Nov 2006 21:09:40 +0100 (CET)
Subject: [Rd] eval(match.call()) (PR#9339)
Message-ID: <20061103200940.EFDA919B3E@slim.kubism.ku.dk>

On Fri, 2006-11-03 at 20:49 +0100, harringt at stat.ubc.ca wrote:
> Full_Name: Justin Harrington
> Version: 2.4.0
> OS: Fedora Core 6
> Submission from: (NULL) (142.103.121.203)
> 
> 
> When I type the (albeit stupid) command
> 
> eval(match.call())
> 
> R crashes with the following messages (truncated):
> 
> *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> 
> The complete output is available at http://md.stat.ubc.ca/Routput.txt
> 
> For reference, here are the results from version:
> 
> platform       i686-redhat-linux-gnu
> arch           i686
> os             linux-gnu
> system         i686, linux-gnu
> status
> major          2
> minor          4.0
> year           2006
> month          10
> day            03
> svn rev        39566
> language       R
> version.string R version 2.4.0 (2006-10-03)
> 
> and my version of R was installed using yum from the fedora repositories.

Hmmm....

I cannot replicate this using:

  R version 2.4.0 Patched (2006-10-03 r39576)

on FC5:

> eval(match.call())
Error in match.call(definition, call, expand.dots) :
        '.Primitive...' is not a function


I'm not running "Zod" yet, but:

1. There have been LOTS of updates to FC6 since release from watching
the FC lists. I would be sure that your system is fully updated.

2. You might want to see if compiling and installing 2.4.0 patched from
CRAN resolves this behavior at all, though I do not see anything readily
evident in the NEWS file to suggest that any fixes are relevant here.

3. If neither of those do anything, it would be worthwhile to file a bug
report at RH's Bugzilla against R to see if there is something unique in
the version that they are creating in Fedora Extras. Tom Callaway, RH's
maintainer for R, does read r-devel, so he may pipe in here also. I have
cc'd him on this reply.


>From the BT you provided, this looks like it could be a libreadline
issue perhaps.


HTH,

Marc Schwartz


From p.dalgaard at biostat.ku.dk  Fri Nov  3 21:15:49 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 03 Nov 2006 21:15:49 +0100
Subject: [Rd] eval(match.call()) (PR#9339)
In-Reply-To: <20061103194920.934D55728D@slim.kubism.ku.dk>
References: <20061103194920.934D55728D@slim.kubism.ku.dk>
Message-ID: <x2ejskmglm.fsf@turmalin.kubism.ku.dk>

harringt at stat.ubc.ca writes:

> Full_Name: Justin Harrington
> Version: 2.4.0
> OS: Fedora Core 6
> Submission from: (NULL) (142.103.121.203)
> 
> 
> When I type the (albeit stupid) command
> 
> eval(match.call())
> 
> R crashes with the following messages (truncated):
> 
> *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated

Yes, don't do that then ;-)

Part of the puzzle is that

> match.call()
match.call()

which looks like something with potential for infinite recursion, but
that doesn't seem to be issue since

> f <- function(call = sys.call(sys.parent()))call
> f()
f()
> eval(f())
f()

does not exhibit the same crash. And indeed

> x <- quote(match.call())
> eval(x)
*** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
======= Backtrace: =========
/lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
/lib/libc.so.6[0x1f0617]

does look like something that just Should Not Happen...


> The complete output is available at http://md.stat.ubc.ca/Routput.txt
> 
> For reference, here are the results from version:
> 
> platform       i686-redhat-linux-gnu
> arch           i686
> os             linux-gnu
> system         i686, linux-gnu
> status
> major          2
> minor          4.0
> year           2006
> month          10
> day            03
> svn rev        39566
> language       R
> version.string R version 2.4.0 (2006-10-03)
> 
> and my version of R was installed using yum from the fedora repositories.

Ah, thanks. Sufficient information for once...

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From marc_schwartz at comcast.net  Fri Nov  3 21:27:30 2006
From: marc_schwartz at comcast.net (marc_schwartz at comcast.net)
Date: Fri,  3 Nov 2006 21:27:30 +0100 (CET)
Subject: [Rd] eval(match.call()) (PR#9339)
Message-ID: <20061103202730.30A4C3F043@slim.kubism.ku.dk>

On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
> harringt at stat.ubc.ca writes:
> 
> > Full_Name: Justin Harrington
> > Version: 2.4.0
> > OS: Fedora Core 6
> > Submission from: (NULL) (142.103.121.203)
> > 
> > 
> > When I type the (albeit stupid) command
> > 
> > eval(match.call())
> > 
> > R crashes with the following messages (truncated):
> > 
> > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> 
> Yes, don't do that then ;-)

Indeed...  ;-)

> Part of the puzzle is that
> 
> > match.call()
> match.call()
> 
> which looks like something with potential for infinite recursion, but
> that doesn't seem to be issue since
> 
> > f <- function(call = sys.call(sys.parent()))call
> > f()
> f()
> > eval(f())
> f()
> 
> does not exhibit the same crash. And indeed
> 
> > x <- quote(match.call())
> > eval(x)
> *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> ======= Backtrace: =========
> /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
> /lib/libc.so.6[0x1f0617]
> 
> does look like something that just Should Not Happen...

Peter, are you on FC6?

On FC5, I cannot replicate your crash:

> x <- quote(match.call())
> eval(x)
Error in match.call(definition, call, expand.dots) :
        '.Primitive...' is not a function

?

Regards,

Marc


From p.dalgaard at biostat.ku.dk  Fri Nov  3 22:41:05 2006
From: p.dalgaard at biostat.ku.dk (p.dalgaard at biostat.ku.dk)
Date: Fri,  3 Nov 2006 22:41:05 +0100 (CET)
Subject: [Rd] eval(match.call()) (PR#9339)
Message-ID: <20061103214105.E7FF73F703@slim.kubism.ku.dk>

Marc Schwartz <marc_schwartz at comcast.net> writes:

> On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
> > harringt at stat.ubc.ca writes:
> >=20
> > > Full_Name: Justin Harrington
> > > Version: 2.4.0
> > > OS: Fedora Core 6
> > > Submission from: (NULL) (142.103.121.203)
> > >=20
> > >=20
> > > When I type the (albeit stupid) command
> > >=20
> > > eval(match.call())
> > >=20
> > > R crashes with the following messages (truncated):
> > >=20
> > > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> >=20
> > Yes, don't do that then ;-)
>=20
> Indeed...  ;-)
>=20
> > Part of the puzzle is that
> >=20
> > > match.call()
> > match.call()
> >=20
> > which looks like something with potential for infinite recursion, but
> > that doesn't seem to be issue since
> >=20
> > > f <- function(call =3D sys.call(sys.parent()))call
> > > f()
> > f()
> > > eval(f())
> > f()
> >=20
> > does not exhibit the same crash. And indeed
> >=20
> > > x <- quote(match.call())
> > > eval(x)
> > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> > =3D=3D=3D=3D=3D=3D=3D Backtrace: =3D=3D=3D=3D=3D=3D=3D=3D=3D
> > /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
> > /lib/libc.so.6[0x1f0617]
> >=20
> > does look like something that just Should Not Happen...
>=20
> Peter, are you on FC6?
>=20
> On FC5, I cannot replicate your crash:
>=20
> > x <- quote(match.call())
> > eval(x)
> Error in match.call(definition, call, expand.dots) :
>         '.Primitive...' is not a function
>=20
> ?

Yes, I'm on FC6 since yum had updated the 1229 packages this morning.

I see the crash with the FC6 RPM but not with a self-compiled R-patched.

--=20
   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From marc_schwartz at comcast.net  Fri Nov  3 23:01:57 2006
From: marc_schwartz at comcast.net (marc_schwartz at comcast.net)
Date: Fri,  3 Nov 2006 23:01:57 +0100 (CET)
Subject: [Rd] eval(match.call()) (PR#9339)
Message-ID: <20061103220157.64BCA19B3E@slim.kubism.ku.dk>

On Fri, 2006-11-03 at 22:41 +0100, p.dalgaard at biostat.ku.dk wrote:
> Marc Schwartz <marc_schwartz at comcast.net> writes:

<snip>

> > On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
> > > > x <- quote(match.call())
> > > > eval(x)
> > > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> > > /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
> > > /lib/libc.so.6[0x1f0617]

> > > does look like something that just Should Not Happen...

> > Peter, are you on FC6?
> > On FC5, I cannot replicate your crash:
> > > x <- quote(match.call())
> > > eval(x)
> > Error in match.call(definition, call, expand.dots) :
> >         '.Primitive...' is not a function
> > ?
> 
> Yes, I'm on FC6 since yum had updated the 1229 packages this morning.
> 
> I see the crash with the FC6 RPM but not with a self-compiled R-patched.


Are you using Martyn's RPM or Extras? Just wondering if there is any
difference. In theory, I suppose, given the prior communications with
Tom, there shouldn't be.

Also, was this a clean install of FC6 or an "in place upgrade" of FC5.
Officially, FC does not support the latter and I have seen mixed
comments on the FC lists pertaining to that path and associated issues.

Marc


From bill at insightful.com  Fri Nov  3 23:14:09 2006
From: bill at insightful.com (Bill Dunlap)
Date: Fri, 3 Nov 2006 14:14:09 -0800 (PST)
Subject: [Rd] eval(match.call()) (PR#9339)
In-Reply-To: <20061103220157.64BCA19B3E@slim.kubism.ku.dk>
References: <20061103220157.64BCA19B3E@slim.kubism.ku.dk>
Message-ID: <Pine.GSO.4.56.0611031407480.19454@durian.statsci.com>

On Fri, 3 Nov 2006 marc_schwartz at comcast.net wrote:

> > > On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
> > > > > x <- quote(match.call())
> > > > > eval(x)
> > > > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> > > > /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
> > > > /lib/libc.so.6[0x1f0617]
>
> > > > does look like something that just Should Not Happen...


I think valgrind shows the problem is in deparse.c:
    245         strncpy(data, CHAR(STRING_ELT(svec, 0)), 10);
    246         if (strlen(CHAR(STRING_ELT(svec, 0))) > 10) strcat(data, "...");
You need to put a '\0' into data[10] after that strncpy
so strcat can find the end of the string when the length
of the copied string is >=10.  It currently runs into
uninitialized memory at the end of ".Primitive".

(This is in a copy of R source from June 2006.)

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From harringt at stat.ubc.ca  Fri Nov  3 23:31:11 2006
From: harringt at stat.ubc.ca (harringt at stat.ubc.ca)
Date: Fri,  3 Nov 2006 23:31:11 +0100 (CET)
Subject: [Rd] eval(match.call()) (PR#9339)
Message-ID: <20061103223111.AED4E44228@slim.kubism.ku.dk>

Peter Dalgaard wrote:
> Marc Schwartz <marc_schwartz at comcast.net> writes:
>
>   
>> On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
>>     
>>> harringt at stat.ubc.ca writes:
>>>
>>>       
>>>> Full_Name: Justin Harrington
>>>> Version: 2.4.0
>>>> OS: Fedora Core 6
>>>> Submission from: (NULL) (142.103.121.203)
>>>>
>>>>
>>>> When I type the (albeit stupid) command
>>>>
>>>> eval(match.call())
>>>>
>>>> R crashes with the following messages (truncated):
>>>>
>>>> *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
>>>>         
>>> Yes, don't do that then ;-)
>>>       
>> Indeed...  ;-)
>>
>>     
>>> Part of the puzzle is that
>>>
>>>       
>>>> match.call()
>>>>         
>>> match.call()
>>>
>>> which looks like something with potential for infinite recursion, but
>>> that doesn't seem to be issue since
>>>
>>>       
>>>> f <- function(call = sys.call(sys.parent()))call
>>>> f()
>>>>         
>>> f()
>>>       
>>>> eval(f())
>>>>         
>>> f()
>>>
>>> does not exhibit the same crash. And indeed
>>>
>>>       
>>>> x <- quote(match.call())
>>>> eval(x)
>>>>         
>>> *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
>>> ======= Backtrace: =========
>>> /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
>>> /lib/libc.so.6[0x1f0617]
>>>
>>> does look like something that just Should Not Happen...
>>>       
>> Peter, are you on FC6?
>>
>> On FC5, I cannot replicate your crash:
>>
>>     
>>> x <- quote(match.call())
>>> eval(x)
>>>       
>> Error in match.call(definition, call, expand.dots) :
>>         '.Primitive...' is not a function
>>
>> ?
>>     
>
> Yes, I'm on FC6 since yum had updated the 1229 packages this morning.
>
> I see the crash with the FC6 RPM but not with a self-compiled R-patched.
>
>   
For what it's worth, I also get the same error when trying it on my 
(freshly updated) FC4 machine (Linux md.stat.ubc.ca 2.6.17-1.2142_FC4 #1 
Tue Jul 11 22:41:14 EDT 2006 i686 i686 i386 GNU/Linux) with R version 
2.4.0 (2006-10-03)


Justin


From marc_schwartz at comcast.net  Sat Nov  4 00:07:07 2006
From: marc_schwartz at comcast.net (marc_schwartz at comcast.net)
Date: Sat,  4 Nov 2006 00:07:07 +0100 (CET)
Subject: [Rd] eval(match.call()) (PR#9339)
Message-ID: <20061103230707.1EC3F536A3@slim.kubism.ku.dk>

On Fri, 2006-11-03 at 14:14 -0800, Bill Dunlap wrote:
> On Fri, 3 Nov 2006 marc_schwartz at comcast.net wrote:
> 
> > > > On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
> > > > > > x <- quote(match.call())
> > > > > > eval(x)
> > > > > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> > > > > /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
> > > > > /lib/libc.so.6[0x1f0617]
> >
> > > > > does look like something that just Should Not Happen...
> 
> 
> I think valgrind shows the problem is in deparse.c:
>     245         strncpy(data, CHAR(STRING_ELT(svec, 0)), 10);
>     246         if (strlen(CHAR(STRING_ELT(svec, 0))) > 10) strcat(data, "...");
> You need to put a '\0' into data[10] after that strncpy
> so strcat can find the end of the string when the length
> of the copied string is >=10.  It currently runs into
> uninitialized memory at the end of ".Primitive".
> 
> (This is in a copy of R source from June 2006.)

The code is the same, but a couple of lines off in my copy from R 2.4.0
patched.

Now lines 247 and 248.

Thanks Bill. This would help to explain the difference in behaviors
observed.

Regards,

Marc


From gregor.gorjanc at bfro.uni-lj.si  Sat Nov  4 01:33:57 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Sat, 04 Nov 2006 01:33:57 +0100
Subject: [Rd] How to put my class into data.frame
Message-ID: <454BDFF5.7080901@bfro.uni-lj.si>

Hello!

I am developing a composition class, which represents a composition of
mixture of levels, say soil has three components and each component
accounts for 1/3 of the unit. I have tried with S4 class system and I
would appreciate any help here. I was hoping that I would be able to
include instance of my class into a data.frame. However, I encounter
problems.

Simple definition of class could be

setClass(Class="composition",
         representation=representation(ratios="matrix"))

n <- 2
k <- 3

x <- new(Class="composition", ratios=matrix(data=rep(x=1/3, times=n*k),
nrow=n, ncol=k))

x
An object of class "composition"
Slot "ratios":
          [,1]      [,2]      [,3]
[1,] 0.3333333 0.3333333 0.3333333
[2,] 0.3333333 0.3333333 0.3333333

tmp <- data.frame(id=1:2)
tmp$comp <- x
Error: object is not subsettable

As I understand this, my problem is that x is of length 1 as the
following works

tmp$comp <- c(x, x)

although I am not able to print tmp now

tmp
Error in unlist(x, recursive, use.names) :
	argument not a list

but this is expected as I (probably) need show/print method for this.
How can I put my class into data.frame or how can I make my class behave
as a vector?

Thanks!

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc
----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From falimadhi at iq.harvard.edu  Sat Nov  4 01:54:29 2006
From: falimadhi at iq.harvard.edu (Ferdinand Alimadhi)
Date: Fri, 03 Nov 2006 19:54:29 -0500
Subject: [Rd] How to put my class into data.frame
In-Reply-To: <454BDFF5.7080901@bfro.uni-lj.si>
References: <454BDFF5.7080901@bfro.uni-lj.si>
Message-ID: <454BE4C5.70504@iq.harvard.edu>

tmp$comp <- x at ratios   ?!

Gregor Gorjanc wrote:

>Hello!
>
>I am developing a composition class, which represents a composition of
>mixture of levels, say soil has three components and each component
>accounts for 1/3 of the unit. I have tried with S4 class system and I
>would appreciate any help here. I was hoping that I would be able to
>include instance of my class into a data.frame. However, I encounter
>problems.
>
>Simple definition of class could be
>
>setClass(Class="composition",
>         representation=representation(ratios="matrix"))
>
>n <- 2
>k <- 3
>
>x <- new(Class="composition", ratios=matrix(data=rep(x=1/3, times=n*k),
>nrow=n, ncol=k))
>
>x
>An object of class "composition"
>Slot "ratios":
>          [,1]      [,2]      [,3]
>[1,] 0.3333333 0.3333333 0.3333333
>[2,] 0.3333333 0.3333333 0.3333333
>
>tmp <- data.frame(id=1:2)
>tmp$comp <- x
>Error: object is not subsettable
>
>As I understand this, my problem is that x is of length 1 as the
>following works
>
>tmp$comp <- c(x, x)
>
>although I am not able to print tmp now
>
>tmp
>Error in unlist(x, recursive, use.names) :
>	argument not a list
>
>but this is expected as I (probably) need show/print method for this.
>How can I put my class into data.frame or how can I make my class behave
>as a vector?
>
>Thanks!
>
>  
>


-- 
Ferdinand Alimadhi
Programmer / Analyst
Harvard University
The Institute for Quantitative Social Science
(617) 496-0187
falimadhi at iq.harvard.edu
www.iq.harvard.edu


From p.dalgaard at biostat.ku.dk  Sat Nov  4 02:08:32 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 04 Nov 2006 02:08:32 +0100
Subject: [Rd] eval(match.call()) (PR#9339)
In-Reply-To: <Pine.GSO.4.56.0611031407480.19454@durian.statsci.com>
References: <20061103220157.64BCA19B3E@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0611031407480.19454@durian.statsci.com>
Message-ID: <x2odrokohb.fsf@turmalin.kubism.ku.dk>

Bill Dunlap <bill at insightful.com> writes:

> On Fri, 3 Nov 2006 marc_schwartz at comcast.net wrote:
> 
> > > > On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
> > > > > > x <- quote(match.call())
> > > > > > eval(x)
> > > > > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> > > > > /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
> > > > > /lib/libc.so.6[0x1f0617]
> >
> > > > > does look like something that just Should Not Happen...
> 
> 
> I think valgrind shows the problem is in deparse.c:
>     245         strncpy(data, CHAR(STRING_ELT(svec, 0)), 10);
>     246         if (strlen(CHAR(STRING_ELT(svec, 0))) > 10) strcat(data, "...");
> You need to put a '\0' into data[10] after that strncpy
> so strcat can find the end of the string when the length
> of the copied string is >=10.  It currently runs into
> uninitialized memory at the end of ".Primitive".
> 
> (This is in a copy of R source from June 2006.)

Now fixed in 2.4.0 Patched and the development version.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From p.dalgaard at biostat.ku.dk  Sat Nov  4 02:08:56 2006
From: p.dalgaard at biostat.ku.dk (p.dalgaard at biostat.ku.dk)
Date: Sat,  4 Nov 2006 02:08:56 +0100 (CET)
Subject: [Rd] eval(match.call()) (PR#9339)
Message-ID: <20061104010856.86DBA19B3E@slim.kubism.ku.dk>

Bill Dunlap <bill at insightful.com> writes:

> On Fri, 3 Nov 2006 marc_schwartz at comcast.net wrote:
>=20
> > > > On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
> > > > > > x <- quote(match.call())
> > > > > > eval(x)
> > > > > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> > > > > /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
> > > > > /lib/libc.so.6[0x1f0617]
> >
> > > > > does look like something that just Should Not Happen...
>=20
>=20
> I think valgrind shows the problem is in deparse.c:
>     245         strncpy(data, CHAR(STRING_ELT(svec, 0)), 10);
>     246         if (strlen(CHAR(STRING_ELT(svec, 0))) > 10) strcat(data, =
"...");
> You need to put a '\0' into data[10] after that strncpy
> so strcat can find the end of the string when the length
> of the copied string is >=3D10.  It currently runs into
> uninitialized memory at the end of ".Primitive".
>=20
> (This is in a copy of R source from June 2006.)

Now fixed in 2.4.0 Patched and the development version.

--=20
   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From gregor.gorjanc at bfro.uni-lj.si  Sat Nov  4 02:09:13 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Sat, 04 Nov 2006 02:09:13 +0100
Subject: [Rd] How to put my class into data.frame
In-Reply-To: <454BE4C5.70504@iq.harvard.edu>
References: <454BDFF5.7080901@bfro.uni-lj.si> <454BE4C5.70504@iq.harvard.edu>
Message-ID: <454BE839.3000109@bfro.uni-lj.si>

Ferdinand Alimadhi wrote:
> tmp$comp <- x at ratios   ?!

I "lose" class here and that is not what I want. Perhaps I should stick
with list instead of data.frame.

> Gregor Gorjanc wrote:
> 
>> Hello!
>>
>> I am developing a composition class, which represents a composition of
>> mixture of levels, say soil has three components and each component
>> accounts for 1/3 of the unit. I have tried with S4 class system and I
>> would appreciate any help here. I was hoping that I would be able to
>> include instance of my class into a data.frame. However, I encounter
>> problems.
>>
>> Simple definition of class could be
>>
>> setClass(Class="composition",
>>         representation=representation(ratios="matrix"))
>>
>> n <- 2
>> k <- 3
>>
>> x <- new(Class="composition", ratios=matrix(data=rep(x=1/3, times=n*k),
>> nrow=n, ncol=k))
>>
>> x
>> An object of class "composition"
>> Slot "ratios":
>>          [,1]      [,2]      [,3]
>> [1,] 0.3333333 0.3333333 0.3333333
>> [2,] 0.3333333 0.3333333 0.3333333
>>
>> tmp <- data.frame(id=1:2)
>> tmp$comp <- x
>> Error: object is not subsettable
>>
>> As I understand this, my problem is that x is of length 1 as the
>> following works
>>
>> tmp$comp <- c(x, x)
>>
>> although I am not able to print tmp now
>>
>> tmp
>> Error in unlist(x, recursive, use.names) :
>>     argument not a list
>>
>> but this is expected as I (probably) need show/print method for this.
>> How can I put my class into data.frame or how can I make my class behave
>> as a vector?
>>
>> Thanks!

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc
----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From maechler at stat.math.ethz.ch  Sat Nov  4 10:42:37 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 4 Nov 2006 10:42:37 +0100
Subject: [Rd] How to put my S4 class into data.frame
In-Reply-To: <454BE839.3000109@bfro.uni-lj.si>
References: <454BDFF5.7080901@bfro.uni-lj.si> <454BE4C5.70504@iq.harvard.edu>
	<454BE839.3000109@bfro.uni-lj.si>
Message-ID: <17740.24717.488162.230545@stat.math.ethz.ch>

>>>>> "Gregor" == Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si>
>>>>>     on Sat, 04 Nov 2006 02:09:13 +0100 writes:

    Gregor> Ferdinand Alimadhi wrote:

      >> tmp$comp <- x at ratios ?!

    Gregor> I "lose" class here and that is not what I
    Gregor> want. Perhaps I should stick with list instead of
    Gregor> data.frame.

Yes, I probably would, at least for the time being.

OTOH, it's interesting that some methods to "stick some S4
objects into a data frame do work fine , at least for the
following case (R-script below) -- and I wonder if we (R developers)
shouldn't think about more explicitly supporting this,
e.g., by stating something like

 >>  If an S4 object simply *contains* an atomic class that can be
 >>  used as data.frame column, then that S4 object can also be used
 >>  as data.frame column

and trying to fix all cases where the above is not fulfilled.


  setClass("Real", contains="numeric")
  (r <- new("Real", pi * 1:3))
  try( dd <- data.frame(x = 1:3, R = r) ) ## fails
  ## Error in as.data.frame.default(x[[i]], optional = TRUE) :
  ## 	cannot coerce class "Real" into a data.frame

  dd <- data.frame(x = 1:3)
  dd[,"R"] <- r ## works fine .. didn't I say just yesterday how much
		## I recommend [, <name>] indexing for data frames ?
  dd
  str(dd)
  dd[1:2,]
  ## but
  str(dd[1:2,]) # has lost the class -- of course since r[1:2] loses it
  ## -> you need to define a correct subset method for your class
  ## e.g.,
  setMethod("[", signature(x = "Real", i = "ANY"),
	    function(x, i,j,drop, ...) new("Real", callNextMethod()))

  r[1:2] # now correct
  str(dd[1:2,]) # correct too


Martin Maechler, ETH Zurich

    >> Gregor Gorjanc wrote:
    >> 
    >>> Hello!
    >>> 
    >>> I am developing a composition class, which represents a
    >>> composition of mixture of levels, say soil has three
    >>> components and each component accounts for 1/3 of the
    >>> unit. I have tried with S4 class system and I would
    >>> appreciate any help here. I was hoping that I would be
    >>> able to include instance of my class into a
    >>> data.frame. However, I encounter problems.
    >>> 
    >>> Simple definition of class could be
    >>> 
    >>> setClass(Class="composition",
    >>> representation=representation(ratios="matrix"))
    >>> 
    >>> n <- 2 k <- 3
    >>> 
    >>> x <- new(Class="composition",
    >>> ratios=matrix(data=rep(x=1/3, times=n*k), nrow=n,
    >>> ncol=k))
    >>> 
    >>> x An object of class "composition" Slot "ratios": [,1]
    >>> [,2] [,3] [1,] 0.3333333 0.3333333 0.3333333 [2,]
    >>> 0.3333333 0.3333333 0.3333333
    >>> 
    >>> tmp <- data.frame(id=1:2) tmp$comp <- x Error: object is
    >>> not subsettable
    >>> 
    >>> As I understand this, my problem is that x is of length
    >>> 1 as the following works
    >>> 
    >>> tmp$comp <- c(x, x)
    >>> 
    >>> although I am not able to print tmp now
    >>> 
    >>> tmp Error in unlist(x, recursive, use.names) : argument
    >>> not a list
    >>> 
    >>> but this is expected as I (probably) need show/print
    >>> method for this.  How can I put my class into data.frame
    >>> or how can I make my class behave as a vector?
    >>> 
    >>> Thanks!

    Gregor> -- Lep pozdrav / With regards, Gregor Gorjanc
    Gregor> ----------------------------------------------------------------------
    Gregor> University of Ljubljana PhD student Biotechnical
    Gregor> Faculty Zootechnical Department URI:
    Gregor> http://www.bfro.uni-lj.si/MR/ggorjan Groblje 3 mail:
    Gregor> gregor.gorjanc <at> bfro.uni-lj.si

    Gregor> SI-1230 Domzale tel: +386 (0)1 72 17 861 Slovenia,
    Gregor> Europe fax: +386 (0)1 72 17 888


From maechler at stat.math.ethz.ch  Sat Nov  4 11:27:33 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 4 Nov 2006 11:27:33 +0100
Subject: [Rd] man page for as.matrix for data frames outdated?
In-Reply-To: <454B8F62.3030205@fhcrc.org>
References: <454AC989.1040002@fhcrc.org>
	<17738.64809.495879.29680@stat.math.ethz.ch>
	<454B8F62.3030205@fhcrc.org>
Message-ID: <17740.27413.55125.69173@stat.math.ethz.ch>

>>>>> "Herve" == Herve Pages <hpages at fhcrc.org>
>>>>>     on Fri, 03 Nov 2006 10:50:10 -0800 writes:

    Herve> Hi Martin,
    Herve> Thanks for the answer!
    Herve> OK I can use data.matrix to convert a data frame to a numeric
    Herve> matrix but that's another story. Basically I'm reporting 2
    Herve> problems with 'as.matrix' when applied to a data frame:

yes, indeed, and I was missing them up partly.

    Herve> 1) A documentation problem:

    Herve> "The method for data frames will convert any
    Herve> non-numeric/complex column into a character vector
    Herve> using 'format'"

    >> df5 <- data.frame(toto=c("a","bb"), titi=c(9,999))
    >> as.matrix(df5)

    Herve> toto titi
    Herve> 1 "a"  "  9"
    Herve> 2 "bb" "999"

    Herve> As I said, it seems to be the other way around: it's not the
    Herve> "non-numeric" column that is converted to a character vector,
    Herve> it's the "numeric" column.

Indeed, and I now agree that the documentation is more wrong
than I first acknowledged.  I'm changing it currently.

    Herve> 2) the questionable decision to do this conversion using 'format'
    Herve> (leading to the addition of unnecessary white space) and not
    Herve> simply 'as.character'

as Bill remarked, 
- there were good reasons pro such a decision,
- to change such decisions without necessity is a problem for
  back-compatibility

    Herve> BTW your mailer seems to do some strange reformatting to the output
    Herve> of my code snippets making it hard to see the "formatting" problem
    Herve> that I'm trying to show.

yes. Part of it was my mistake; sorry.

Best regards to Seattle,
Martin


From gregor.gorjanc at bfro.uni-lj.si  Sat Nov  4 13:09:52 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Sat, 04 Nov 2006 13:09:52 +0100
Subject: [Rd] How to put my S4 class into data.frame
In-Reply-To: <17740.24717.488162.230545@stat.math.ethz.ch>
References: <454BDFF5.7080901@bfro.uni-lj.si>	<454BE4C5.70504@iq.harvard.edu>	<454BE839.3000109@bfro.uni-lj.si>
	<17740.24717.488162.230545@stat.math.ethz.ch>
Message-ID: <454C8310.80308@bfro.uni-lj.si>

Hi,

Martin Maechler wrote:
>>>>>> "Gregor" == Gregor Gorjanc <gregor.gorjanc at bfro.uni-lj.si>
>>>>>>     on Sat, 04 Nov 2006 02:09:13 +0100 writes:
> 
>     Gregor> Ferdinand Alimadhi wrote:
> 
>       >> tmp$comp <- x at ratios ?!
> 
>     Gregor> I "lose" class here and that is not what I
>     Gregor> want. Perhaps I should stick with list instead of
>     Gregor> data.frame.
> 
> Yes, I probably would, at least for the time being.

OK. Why do you say "at least for the time being"? Are there any plans to
generalize putting S4 classes that are not atomic into data.frame?

> OTOH, it's interesting that some methods to "stick some S4
> objects into a data frame do work fine , at least for the
> following case (R-script below) -- and I wonder if we (R developers)
> shouldn't think about more explicitly supporting this,
> e.g., by stating something like
> 
>  >>  If an S4 object simply *contains* an atomic class that can be
>  >>  used as data.frame column, then that S4 object can also be used
>  >>  as data.frame column
> 

Gregor


From h.wickham at gmail.com  Sat Nov  4 14:39:34 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Sat, 4 Nov 2006 07:39:34 -0600
Subject: [Rd] How to put my S4 class into data.frame
In-Reply-To: <17740.24717.488162.230545@stat.math.ethz.ch>
References: <454BDFF5.7080901@bfro.uni-lj.si> <454BE4C5.70504@iq.harvard.edu>
	<454BE839.3000109@bfro.uni-lj.si>
	<17740.24717.488162.230545@stat.math.ethz.ch>
Message-ID: <f8e6ff050611040539w3c8c7e93x1fad9a7b2e972e4f@mail.gmail.com>

> OTOH, it's interesting that some methods to "stick some S4
> objects into a data frame do work fine , at least for the
> following case (R-script below) -- and I wonder if we (R developers)
> shouldn't think about more explicitly supporting this,
> e.g., by stating something like
>
>  >>  If an S4 object simply *contains* an atomic class that can be
>  >>  used as data.frame column, then that S4 object can also be used
>  >>  as data.frame column
>
> and trying to fix all cases where the above is not fulfilled.

There are also many cases where using a list as a data.frame column
will cause errors, depending on the contents of the list.

Hadley


From jmc at r-project.org  Sat Nov  4 15:22:11 2006
From: jmc at r-project.org (John Chambers)
Date: Sat, 04 Nov 2006 09:22:11 -0500
Subject: [Rd] How to put my S4 class into data.frame
In-Reply-To: <454C8310.80308@bfro.uni-lj.si>
References: <454BDFF5.7080901@bfro.uni-lj.si>	<454BE4C5.70504@iq.harvard.edu>
	<454BE839.3000109@bfro.uni-lj.si>
	<17740.24717.488162.230545@stat.math.ethz.ch>
	<454C8310.80308@bfro.uni-lj.si>
Message-ID: <454CA213.6000309@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061104/f2b588b5/attachment.pl 

From marc_schwartz at comcast.net  Sat Nov  4 16:44:39 2006
From: marc_schwartz at comcast.net (marc_schwartz at comcast.net)
Date: Sat,  4 Nov 2006 16:44:39 +0100 (CET)
Subject: [Rd] eval(match.call()) (PR#9339)
Message-ID: <20061104154439.BBF7D56231@slim.kubism.ku.dk>

On Sat, 2006-11-04 at 02:08 +0100, Peter Dalgaard wrote:
> Bill Dunlap <bill at insightful.com> writes:
> 
> > On Fri, 3 Nov 2006 marc_schwartz at comcast.net wrote:
> > 
> > > > > On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
> > > > > > > x <- quote(match.call())
> > > > > > > eval(x)
> > > > > > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> > > > > > /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
> > > > > > /lib/libc.so.6[0x1f0617]
> > >
> > > > > > does look like something that just Should Not Happen...
> > 
> > 
> > I think valgrind shows the problem is in deparse.c:
> >     245         strncpy(data, CHAR(STRING_ELT(svec, 0)), 10);
> >     246         if (strlen(CHAR(STRING_ELT(svec, 0))) > 10) strcat(data, "...");
> > You need to put a '\0' into data[10] after that strncpy
> > so strcat can find the end of the string when the length
> > of the copied string is >=10.  It currently runs into
> > uninitialized memory at the end of ".Primitive".
> > 
> > (This is in a copy of R source from June 2006.)
> 
> Now fixed in 2.4.0 Patched and the development version.

Just a quick heads up here, that Tom Callaway has updated the Fedora
Extras RPMS to fix the buffer overflow, based upon a post to the FE CVS
mailing list last night. This is for FC4, FC5 and FC6.

So you can update to these when they appear on FE mirrors in due course.
It looks like these should be labelled as 2.4.0-2.

Thanks to all.

Regards,

Marc


From tcallawa at redhat.com  Sat Nov  4 17:13:04 2006
From: tcallawa at redhat.com (Tom 'spot' Callaway)
Date: Sat, 04 Nov 2006 10:13:04 -0600
Subject: [Rd] eval(match.call()) (PR#9339)
In-Reply-To: <20061103230707.1EC3F536A3@slim.kubism.ku.dk>
References: <20061103230707.1EC3F536A3@slim.kubism.ku.dk>
Message-ID: <1162656784.7072.46.camel@localhost.localdomain>

On Sat, 2006-11-04 at 00:07 +0100, marc_schwartz at comcast.net wrote:
> On Fri, 2006-11-03 at 14:14 -0800, Bill Dunlap wrote:
> > On Fri, 3 Nov 2006 marc_schwartz at comcast.net wrote:
> > 
> > > > > On Fri, 2006-11-03 at 21:15 +0100, Peter Dalgaard wrote:
> > > > > > > x <- quote(match.call())
> > > > > > > eval(x)
> > > > > > *** buffer overflow detected ***: /usr/lib/R/bin/exec/R terminated
> > > > > > /lib/libc.so.6(__chk_fail+0x41)[0x1f1161]
> > > > > > /lib/libc.so.6[0x1f0617]
> > >
> > > > > > does look like something that just Should Not Happen...
> > 
> > 
> > I think valgrind shows the problem is in deparse.c:
> >     245         strncpy(data, CHAR(STRING_ELT(svec, 0)), 10);
> >     246         if (strlen(CHAR(STRING_ELT(svec, 0))) > 10) strcat(data, "...");
> > You need to put a '\0' into data[10] after that strncpy
> > so strcat can find the end of the string when the length
> > of the copied string is >=10.  It currently runs into
> > uninitialized memory at the end of ".Primitive".
> > 
> > (This is in a copy of R source from June 2006.)

I was halfway to identifying this when Bill figured it out. :) New
packages are built for FC-4, FC-5, FC-6, and devel which bring us up to
the 11-03 patched level.

Thanks for the fix,

~spot
-- 
Tom "spot" Callaway || Red Hat || Fedora || Aurora || GPG ID: 93054260

"We must not confuse dissent with disloyalty. We must remember always
that accusation is not proof and that conviction depends upon evidence
and due process of law. We will not walk in fear, one of another. We
will not be driven by fear into an age of unreason, if we dig deep in
our history and our doctrine, and remember that we are not descended
from fearful men -- not from men who feared to write, to speak, to
associate and to defend causes that were, for the moment, unpopular."
-- Edward R. Murrow, March 9, 1954


From gregor.gorjanc at bfro.uni-lj.si  Sat Nov  4 17:37:33 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Sat, 04 Nov 2006 17:37:33 +0100
Subject: [Rd] How to put my S4 class into data.frame
In-Reply-To: <454CA213.6000309@r-project.org>
References: <454BDFF5.7080901@bfro.uni-lj.si>	<454BE4C5.70504@iq.harvard.edu>	<454BE839.3000109@bfro.uni-lj.si>	<17740.24717.488162.230545@stat.math.ethz.ch>
	<454C8310.80308@bfro.uni-lj.si> <454CA213.6000309@r-project.org>
Message-ID: <454CC1CD.9020700@bfro.uni-lj.si>

John Chambers wrote:
> Designing a "better data frame" is something many people have likely
> thought about; I certainly have.
> 
> But data frames are so widely used and so central to models and other
> software that a major change needs to be done by the user community, or
> at least with maximum feedback, IMO.
> 
> Also, my prior feeling would be that it's better to think of an S4 class
> to play the role of data.frame, rather than tinkering with the S3 class
> to allow S4 columns.  Having formal classes (particularly using class
> unions to abstract notions about variables in the data frame)  lets one
> create a more precise and reliable definition.
> 
> It's true, though, that one then has to work out the details of
> interfacing the S4 data frame class to current software that works with
> the S3 data.frame class.  AFAICS that is not too hard, but of course the
> details would be important.
> 
> I've played around with some of these ideas, more as educational aids in
> discussing classes and methods than as a serious proposal.  Last time I
> looked, the writeup was not at a level I would feel happy circulating
> :-}  But perhaps a group of interested people could exchange some ideas.

As far as I see this (at the risk of uterly simplifying the issue) new
data.frame (perhaps dataFrame) could just be a list? of classes that
have the same length i.e. length() should have the same value.

Gregor


From jmc at r-project.org  Sat Nov  4 18:56:20 2006
From: jmc at r-project.org (John Chambers)
Date: Sat, 04 Nov 2006 12:56:20 -0500
Subject: [Rd] Formal methods are not loaded from NAMESPACE in
 reloadedworkspace image
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF461BE00@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF461BE00@DEFRAXMB01.corp.amvescap.net>
Message-ID: <454CD444.4050306@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061104/9d362d22/attachment.pl 

From k.ponting at aurix.com  Mon Nov  6 12:23:59 2006
From: k.ponting at aurix.com (Keith Ponting)
Date: Mon, 6 Nov 2006 11:23:59 -0000
Subject: [Rd]  CRAN task views work only once per session (PR#9330)
Message-ID: <6583C92252A35A4C97E64E50716110F8034FFB8E@mailx03.virtual-email.net>

Thankyou to those who have replied to this thread.

I have now reproduced similar effects in a way which does not directly
involve CRAN task views. (I have also reproduced the original problem on
a different machine within
our site and using a different mirror.)

The following sequence of commands works repeatedly within plain Rterm
(actually running under XEmacs) on Windows XP:

x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
);
showConnections()
.readRDS(x);
showConnections()
close(x)
showConnections()

However under RGui on the same system, second and subsequent attempts
time out in .readRDS (see session log below) and note that although the
connection is shown as open immediately before the second .readRDS call,
it is shown as closed immediately after that (failing) call. 

I wonder whether something in RGui is holding on to connections after
they have been closed. Even while .readRDS is timing out in one RGui
session, I can run that sequence of calls in plain Rterm or (once!) in
another RGui session without problems, which I hope eliminates the
possibility that it is our company firewall or something else on my PC
holding on to the connection in some way.

---------- session log starts
------------------------------------------------

R version 2.4.0 (2006-10-03)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

>
x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
);
> showConnections()
  description                                             class mode
text    
3 "http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds" "url" "rb"
"binary"
  isopen   can read can write
3 "opened" "yes"    "no"     
> .readRDS(x);
> showConnections()
  description                                                    class
mode
3 "gzcon(http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds)" "gzcon"
"rb"
  text     isopen   can read can write
3 "binary" "opened" "yes"    "no"     
> close(x)
> showConnections()
     description class mode text isopen can read can write
>
x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
);
> showConnections()
  description                                             class mode
text    
3 "http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds" "url" "rb"
"binary"
  isopen   can read can write
3 "opened" "yes"    "no"     
> .readRDS(x);
Error in .readRDS(x) : connection is not open
In addition: Warning message:
InternetOpenUrl failed: 'The operation timed out' 
> showConnections()
     description class mode text isopen can read can write
> close(x)
> showConnections()
     description class mode text isopen can read can write
>
x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
);
> showConnections()
  description                                             class mode
text    
3 "http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds" "url" "rb"
"binary"
  isopen   can read can write
3 "opened" "yes"    "no"     
> .readRDS(x);
Error in .readRDS(x) : connection is not open
In addition: Warning message:
InternetOpenUrl failed: 'The operation timed out' 
> showConnections()
     description class mode text isopen can read can write
> close(x)
> showConnections()
     description class mode text isopen can read can write
> 
> sessionInfo()
R version 2.4.0 (2006-10-03) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United Kingdom.1252;LC_CTYPE=English_United
Kingdom.1252;LC_MONETARY=English_United
Kingdom.1252;LC_NUMERIC=C;LC_TIME=English_United Kingdom.1252

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"
"datasets" 
[7] "base"     
> 

---------- session log ends
------------------------------------------------

If I remove the .readRDS(x) call, there is no problem - the following
command sequence does work repeatedly:
x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
);
showConnections()
close(x)
showConnections()

Dr. Keith Ponting
Principal Scientist

Aurix Ltd
Malvern Hills Science Park
Geraldine Rd  Malvern  Worcestershire  WR14 3SZ  UK

______________________________________________________________________
This email has been scanned by the MessageLabs Email Security System.
For more information visit http://www.virtual-email.net/messagelabs.htm


From ripley at stats.ox.ac.uk  Mon Nov  6 12:42:26 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 6 Nov 2006 11:42:26 +0000 (GMT)
Subject: [Rd] CRAN task views work only once per session (PR#9330)
In-Reply-To: <6583C92252A35A4C97E64E50716110F8034FFB8E@mailx03.virtual-email.net>
References: <6583C92252A35A4C97E64E50716110F8034FFB8E@mailx03.virtual-email.net>
Message-ID: <Pine.LNX.4.64.0611061140410.21505@gannet.stats.ox.ac.uk>

I think the following item in NEWS for R-patched may be relevant:

     o   load()ing from a connection had a logic bug in when it closed
         the connection. (PR#9271)

so please try R-patched.


On Mon, 6 Nov 2006, Keith Ponting wrote:

> Thankyou to those who have replied to this thread.
>
> I have now reproduced similar effects in a way which does not directly
> involve CRAN task views. (I have also reproduced the original problem on
> a different machine within
> our site and using a different mirror.)
>
> The following sequence of commands works repeatedly within plain Rterm
> (actually running under XEmacs) on Windows XP:
>
> x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
> );
> showConnections()
> .readRDS(x);
> showConnections()
> close(x)
> showConnections()
>
> However under RGui on the same system, second and subsequent attempts
> time out in .readRDS (see session log below) and note that although the
> connection is shown as open immediately before the second .readRDS call,
> it is shown as closed immediately after that (failing) call.
>
> I wonder whether something in RGui is holding on to connections after
> they have been closed. Even while .readRDS is timing out in one RGui
> session, I can run that sequence of calls in plain Rterm or (once!) in
> another RGui session without problems, which I hope eliminates the
> possibility that it is our company firewall or something else on my PC
> holding on to the connection in some way.
>
> ---------- session log starts
> ------------------------------------------------
>
> R version 2.4.0 (2006-10-03)
> Copyright (C) 2006 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>  Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>>
> x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
> );
>> showConnections()
>  description                                             class mode
> text
> 3 "http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds" "url" "rb"
> "binary"
>  isopen   can read can write
> 3 "opened" "yes"    "no"
>> .readRDS(x);
>> showConnections()
>  description                                                    class
> mode
> 3 "gzcon(http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds)" "gzcon"
> "rb"
>  text     isopen   can read can write
> 3 "binary" "opened" "yes"    "no"
>> close(x)
>> showConnections()
>     description class mode text isopen can read can write
>>
> x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
> );
>> showConnections()
>  description                                             class mode
> text
> 3 "http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds" "url" "rb"
> "binary"
>  isopen   can read can write
> 3 "opened" "yes"    "no"
>> .readRDS(x);
> Error in .readRDS(x) : connection is not open
> In addition: Warning message:
> InternetOpenUrl failed: 'The operation timed out'
>> showConnections()
>     description class mode text isopen can read can write
>> close(x)
>> showConnections()
>     description class mode text isopen can read can write
>>
> x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
> );
>> showConnections()
>  description                                             class mode
> text
> 3 "http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds" "url" "rb"
> "binary"
>  isopen   can read can write
> 3 "opened" "yes"    "no"
>> .readRDS(x);
> Error in .readRDS(x) : connection is not open
> In addition: Warning message:
> InternetOpenUrl failed: 'The operation timed out'
>> showConnections()
>     description class mode text isopen can read can write
>> close(x)
>> showConnections()
>     description class mode text isopen can read can write
>>
>> sessionInfo()
> R version 2.4.0 (2006-10-03)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United Kingdom.1252;LC_CTYPE=English_United
> Kingdom.1252;LC_MONETARY=English_United
> Kingdom.1252;LC_NUMERIC=C;LC_TIME=English_United Kingdom.1252
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"
> "datasets"
> [7] "base"
>>
>
> ---------- session log ends
> ------------------------------------------------
>
> If I remove the .readRDS(x) call, there is no problem - the following
> command sequence does work repeatedly:
> x<-url("http://www.sourcekeg.co.uk/cran/src/contrib/Views.rds",open="rb"
> );
> showConnections()
> close(x)
> showConnections()
>
> Dr. Keith Ponting
> Principal Scientist
>
> Aurix Ltd
> Malvern Hills Science Park
> Geraldine Rd  Malvern  Worcestershire  WR14 3SZ  UK
>
> ______________________________________________________________________
> This email has been scanned by the MessageLabs Email Security System.
> For more information visit http://www.virtual-email.net/messagelabs.htm
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From k.ponting at aurix.com  Mon Nov  6 13:54:52 2006
From: k.ponting at aurix.com (Keith Ponting)
Date: Mon, 6 Nov 2006 12:54:52 -0000
Subject: [Rd] CRAN task views work only once per session (PR#9330)
Message-ID: <6583C92252A35A4C97E64E50716110F80356516B@mailx03.virtual-email.net>

> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Sent: 06 November 2006 11:42
> To: Keith Ponting
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] CRAN task views work only once per session (PR#9330)
> 
> I think the following item in NEWS for R-patched may be relevant:
> 
>      o   load()ing from a connection had a logic bug in when it closed
>          the connection. (PR#9271)
> 
> so please try R-patched.

R-patched runs the offending code repeatedly without complaint (and my
original problem with ctv available.views is also solved) so I will look
forward to the next release.

Thankyou for your time (and to you and all responsible for R itself!).

Keith Ponting 


______________________________________________________________________
This email has been scanned by the MessageLabs Email Security System.
For more information visit http://www.virtual-email.net/messagelabs.htm


From bates at stat.wisc.edu  Mon Nov  6 15:29:49 2006
From: bates at stat.wisc.edu (Douglas Bates)
Date: Mon, 6 Nov 2006 08:29:49 -0600
Subject: [Rd] lme4 install,
	was Re: [R] Which executable is associated with R CMD INSTALL?
In-Reply-To: <x24ptkyccu.fsf_-_@viggo.kubism.ku.dk>
References: <20061030193251.GA3676@ihug.co.nz> <4546725A.7000905@stats.uwo.ca>
	<20061031091759.GB3676@ihug.co.nz>
	<x24ptkyccu.fsf_-_@viggo.kubism.ku.dk>
Message-ID: <40e66e0b0611060629q4d431b64w4b866aada55c0a80@mail.gmail.com>

On 31 Oct 2006 12:05:21 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
>
> [move to r-devel, put maintainer in loop]
>
> Patrick Connolly <p_connolly at ihug.co.nz> writes:
>
> > On Mon, 30-Oct-2006 at 04:44PM -0500, Duncan Murdoch wrote:
> >
> >
> > |> Try "R CMD printenv R_HOME" and you'll find which R home directory it is
> > |> using.  You can see a lot more with "R CMD printenv" or various options
> > |> to "R CMD config".
> >
> > Thanks for that information.  It knocks my theory on the head.  Pity
> > that, because I might have been able to do something about it if that
> > was the problem.  Now I'm at a loss to work out why lme4 installation
> > cannot find Matrix, and more strangely, why nothing else gave a
> > similar problem.  I think I've tried every version of lme4 and Matrix
> > that has emerged since R-2.4.0 has been released.
> >
> > The fact that no other Red hat user has a problem indicates the
> > problem is this end; but I'm short of ideas about where to look.
> > Looks like it's back to versions 6 months old -- like proprietary
> > software users have to put up with. :-(
>
> Hmmm, I can provoke this on SUSE too (I was going to ask you to try
> this!):
>
> mkdir foo
> MY_R=~/misc/r-release-branch/BUILD/bin/R
> R_LIBS=foo $MY_R --vanilla << EOF
>  options(repos=c(CRAN="http://cran.dk.r-project.org"))
>  install.packages("lme4", depend=TRUE)
> EOF
>
> This installs Matrix alright, then dies with
>
> Warning in install.packages("lme4", depend = TRUE) :
>          argument 'lib' is missing: using foo
> trying URL 'http://cran.dk.r-project.org/src/contrib/lme4_0.9975-8.tar.gz'
> Content type 'application/x-tar' length 235617 bytes
> opened URL
> ==================================================
> downloaded 230Kb
>
> * Installing *source* package 'lme4' ...
> ** libs
>
> gcc -I/usr/local/src/pd/r-release-branch/BUILD/include
>   -I/usr/local/src/pd/r-release-branch/BUILD/include
>   -I/usr/local/include -fpic -g -O2 -std=gnu99 -c Wishart.c -o Wishart.o
>
> In file included from Wishart.h:4,
>                  from Wishart.c:1:
> lme4_utils.h:9:20: Matrix.h: No such file or directory
> In file included from Wishart.h:4,
>                  from Wishart.c:1:
> lme4_utils.h:25: error: syntax error before "c"
> lme4_utils.h:25: warning: type defaults to `int' in declaration of `c'
> lme4_utils.h:25: warning: data definition has no type or storage class
> lme4_utils.h:163: error: syntax error before "cholmod_factor"
> lme4_utils.h:177: error: syntax error before "cholmod_factor"
> make: *** [Wishart.o] Error 1
> ERROR: compilation failed for package 'lme4'
>
> And Matrix.h is sitting happily in foo/Matrix/include/ but obviously
> not getting included. Should there have been a copy inside lme4?

Not according to my understanding of how the "LinkingTo:"
specification in the DESCRIPTION file is to work.

The headers for the C functions exported by the Matrix package are
defined Matrix/inst/include so they can be changed in one place if the
API changes.  The "LinkingTo:" specification is designed to put these
headers on the -I path at the time of compilation of the lme4 package
source code.  For some reason it didn't do that in this case.

> What is not obvious to me is how this can work anywhere...
>
> I also tried unpacking the lme4 directory from its tarball, dropping
> all files from the Matrix installed include dir into lme4/src and then
>
> $MY_R CMD INSTALL -l foo lme4
>
> but no go
>
> gcc -shared -L/usr/local/lib64 -o lme4.so Matrix_stubs.o Wishart.o
> glmer.o init.o lme4_utils.o lmer.o local_stubs.o pedigree.o
> -L/usr/local/src/pd/r-release-branch/BUILD/lib -lRlapack
> -L/usr/local/src/pd/r-release-branch/BUILD/lib -lRblas -lg2c -lm
> -lgcc_s
>
> local_stubs.o(.text+0x0): In function `M_numeric_as_chm_dense':
> /home/bs/pd/tmp/lme4/src/Matrix_stubs.c:420: multiple definition of `M_numeric_as_chm_dense'
> Matrix_stubs.o(.text+0x0):/home/bs/pd/tmp/lme4/src/Matrix_stubs.c:420: first defined here

You don't want to compile both Matrix_stubs.c and local_stubs.c.  All
that local_stubs.c does is include Matrix_stubs.c, the reason being
that those wrapper functions are needed locally but it is much cleaner
if they are defined in only one place.  The file Matrix_stubs.c is
never compiled by itself.  It is just there to provide the definitions
of the functions.  Check Luke's documentation and examples for using
R_RegisterCCallable and R_GetCCallable.


> local_stubs.o(.text+0x70): In function `M_dpoMatrix_chol':
> /home/bs/pd/tmp/lme4/src/Matrix_stubs.c:412: multiple definition of `M_dpoMatrix_chol'
> Matrix_stubs.o(.text+0x70):/home/bs/pd/tmp/lme4/src/Matrix_stubs.c:412: first defined here
> ..etc..
>
> --
>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>  (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From p.dalgaard at biostat.ku.dk  Mon Nov  6 15:41:11 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 06 Nov 2006 15:41:11 +0100
Subject: [Rd] lme4 install,
	was Re: [R] Which executable is associated with R CMD INSTALL?
In-Reply-To: <40e66e0b0611060629q4d431b64w4b866aada55c0a80@mail.gmail.com>
References: <20061030193251.GA3676@ihug.co.nz> <4546725A.7000905@stats.uwo.ca>
	<20061031091759.GB3676@ihug.co.nz>
	<x24ptkyccu.fsf_-_@viggo.kubism.ku.dk>
	<40e66e0b0611060629q4d431b64w4b866aada55c0a80@mail.gmail.com>
Message-ID: <x2wt68y6wo.fsf@viggo.kubism.ku.dk>

"Douglas Bates" <bates at stat.wisc.edu> writes:

> On 31 Oct 2006 12:05:21 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> >
> > [move to r-devel, put maintainer in loop]
> >
> > Patrick Connolly <p_connolly at ihug.co.nz> writes:
> >
> > > On Mon, 30-Oct-2006 at 04:44PM -0500, Duncan Murdoch wrote:
> > >
> > >
> > > |> Try "R CMD printenv R_HOME" and you'll find which R home directory it is
> > > |> using.  You can see a lot more with "R CMD printenv" or various options
> > > |> to "R CMD config".
> > >
> > > Thanks for that information.  It knocks my theory on the head.  Pity
> > > that, because I might have been able to do something about it if that
> > > was the problem.  Now I'm at a loss to work out why lme4 installation
> > > cannot find Matrix, and more strangely, why nothing else gave a
> > > similar problem.  I think I've tried every version of lme4 and Matrix
> > > that has emerged since R-2.4.0 has been released.
> > >
> > > The fact that no other Red hat user has a problem indicates the
> > > problem is this end; but I'm short of ideas about where to look.
> > > Looks like it's back to versions 6 months old -- like proprietary
> > > software users have to put up with. :-(
> >
> > Hmmm, I can provoke this on SUSE too (I was going to ask you to try
> > this!):
> >
> > mkdir foo
> > MY_R=~/misc/r-release-branch/BUILD/bin/R
> > R_LIBS=foo $MY_R --vanilla << EOF
> >  options(repos=c(CRAN="http://cran.dk.r-project.org"))
> >  install.packages("lme4", depend=TRUE)
> > EOF
> >
> > This installs Matrix alright, then dies with
........
> > And Matrix.h is sitting happily in foo/Matrix/include/ but obviously
> > not getting included. Should there have been a copy inside lme4?
> 
> Not according to my understanding of how the "LinkingTo:"
> specification in the DESCRIPTION file is to work.

Kurt pointed out the real reason: Using a relative path for R_LIBS was
asking for trouble.

So it was my own fault, I just got blinded by seeing symptoms so
close to those reported by Patrick.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From bates at stat.wisc.edu  Mon Nov  6 16:56:37 2006
From: bates at stat.wisc.edu (Douglas Bates)
Date: Mon, 6 Nov 2006 09:56:37 -0600
Subject: [Rd] lme4 install,
	was Re: [R] Which executable is associated with R CMD INSTALL?
In-Reply-To: <x2wt68y6wo.fsf@viggo.kubism.ku.dk>
References: <20061030193251.GA3676@ihug.co.nz> <4546725A.7000905@stats.uwo.ca>
	<20061031091759.GB3676@ihug.co.nz>
	<x24ptkyccu.fsf_-_@viggo.kubism.ku.dk>
	<40e66e0b0611060629q4d431b64w4b866aada55c0a80@mail.gmail.com>
	<x2wt68y6wo.fsf@viggo.kubism.ku.dk>
Message-ID: <40e66e0b0611060756n38bc5e85w2f2bd6fdb52cf5e1@mail.gmail.com>

On 06 Nov 2006 15:41:11 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> "Douglas Bates" <bates at stat.wisc.edu> writes:
>
> > On 31 Oct 2006 12:05:21 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> > >
> > > [move to r-devel, put maintainer in loop]
> > >
> > > Patrick Connolly <p_connolly at ihug.co.nz> writes:
> > >
> > > > On Mon, 30-Oct-2006 at 04:44PM -0500, Duncan Murdoch wrote:
> > > >
> > > >
> > > > |> Try "R CMD printenv R_HOME" and you'll find which R home directory it is
> > > > |> using.  You can see a lot more with "R CMD printenv" or various options
> > > > |> to "R CMD config".
> > > >
> > > > Thanks for that information.  It knocks my theory on the head.  Pity
> > > > that, because I might have been able to do something about it if that
> > > > was the problem.  Now I'm at a loss to work out why lme4 installation
> > > > cannot find Matrix, and more strangely, why nothing else gave a
> > > > similar problem.  I think I've tried every version of lme4 and Matrix
> > > > that has emerged since R-2.4.0 has been released.
> > > >
> > > > The fact that no other Red hat user has a problem indicates the
> > > > problem is this end; but I'm short of ideas about where to look.
> > > > Looks like it's back to versions 6 months old -- like proprietary
> > > > software users have to put up with. :-(
> > >
> > > Hmmm, I can provoke this on SUSE too (I was going to ask you to try
> > > this!):
> > >
> > > mkdir foo
> > > MY_R=~/misc/r-release-branch/BUILD/bin/R
> > > R_LIBS=foo $MY_R --vanilla << EOF
> > >  options(repos=c(CRAN="http://cran.dk.r-project.org"))
> > >  install.packages("lme4", depend=TRUE)
> > > EOF
> > >
> > > This installs Matrix alright, then dies with
> ........
> > > And Matrix.h is sitting happily in foo/Matrix/include/ but obviously
> > > not getting included. Should there have been a copy inside lme4?
> >
> > Not according to my understanding of how the "LinkingTo:"
> > specification in the DESCRIPTION file is to work.
>
> Kurt pointed out the real reason: Using a relative path for R_LIBS was
> asking for trouble.
>
> So it was my own fault, I just got blinded by seeing symptoms so
> close to those reported by Patrick.

Thanks for the clarification.

However, I think it exposes a problem with R CMD INSTALL.  If there is
a LinkingTo: directive in the DESCRIPTION file and the package's
include directory cannot be found I think that R CMD INSTALL should
abort.


From delmeric at gmail.com  Mon Nov  6 17:52:11 2006
From: delmeric at gmail.com (delmeric at gmail.com)
Date: Mon,  6 Nov 2006 17:52:11 +0100 (CET)
Subject: [Rd] memory issues with new release (PR#9344)
Message-ID: <20061106165211.404983F03B@slim.kubism.ku.dk>

Full_Name: Derek Elmerick
Version: 2.4.0
OS: Windows XP
Submission from: (NULL) (38.117.162.243)



hello -

i have some code that i run regularly using R version 2.3.x . the final step of
the code is to build a multinomial logit model. the dataset is large; however, i
have not had issues in the past. i just installed the 2.4.0 version of R and now
have memory allocation issues. to verify, i ran the code again against the 2.3
version and no problems. since i have set the memory limit to the max size, i
have no alternative but to downgrade to the 2.3 version. thoughts?

thanks,
derek


From p.dalgaard at biostat.ku.dk  Mon Nov  6 18:20:33 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 06 Nov 2006 18:20:33 +0100
Subject: [Rd] memory issues with new release (PR#9344)
In-Reply-To: <20061106165211.404983F03B@slim.kubism.ku.dk>
References: <20061106165211.404983F03B@slim.kubism.ku.dk>
Message-ID: <x2psc0ebku.fsf@turmalin.kubism.ku.dk>

delmeric at gmail.com writes:

> Full_Name: Derek Elmerick
> Version: 2.4.0
> OS: Windows XP
> Submission from: (NULL) (38.117.162.243)
> 
> 
> 
> hello -
> 
> i have some code that i run regularly using R version 2.3.x . the final step of
> the code is to build a multinomial logit model. the dataset is large; however, i
> have not had issues in the past. i just installed the 2.4.0 version of R and now
> have memory allocation issues. to verify, i ran the code again against the 2.3
> version and no problems. since i have set the memory limit to the max size, i
> have no alternative but to downgrade to the 2.3 version. thoughts?

And what do you expect the maintainers to do about it? (I.e. why are
you filing a bug report.)

You give absolutely no handle on what the cause of the problem might
be, or even to reproduce it. It may be a bug, or maybe just R
requiring more memory to run than previously.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From delmeric at gmail.com  Mon Nov  6 19:20:32 2006
From: delmeric at gmail.com (Derek Stephen Elmerick)
Date: Mon, 6 Nov 2006 13:20:32 -0500
Subject: [Rd] memory issues with new release (PR#9344)
In-Reply-To: <x2psc0ebku.fsf@turmalin.kubism.ku.dk>
References: <20061106165211.404983F03B@slim.kubism.ku.dk>
	<x2psc0ebku.fsf@turmalin.kubism.ku.dk>
Message-ID: <d054d5fa0611061020v2ff7bc7frf9b0240788ca42a6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061106/9bce59f0/attachment.pl 

From khansen at stat.Berkeley.EDU  Mon Nov  6 19:49:40 2006
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Mon, 6 Nov 2006 10:49:40 -0800
Subject: [Rd] memory issues with new release (PR#9344)
In-Reply-To: <d054d5fa0611061020v2ff7bc7frf9b0240788ca42a6@mail.gmail.com>
References: <20061106165211.404983F03B@slim.kubism.ku.dk>
	<x2psc0ebku.fsf@turmalin.kubism.ku.dk>
	<d054d5fa0611061020v2ff7bc7frf9b0240788ca42a6@mail.gmail.com>
Message-ID: <338388AB-50B6-4D87-B502-A6D74533A20F@stat.berkeley.edu>

It would be helpful to produce a script that reproduces the error on  
your system. And include details on the size of your data set and  
what you are doing with it. It is unclear what function is actually  
causing the error and such. Really, in order to do something about it  
you need to show how to actually obtain the error.

To my knowledge nothing _major_ has happened with the memory  
consumption, but of course R could use slightly more memory for  
specific purposes.

But chances are that this is not really memory related but more  
related to the functions your are using - perhaps a bug or perhaps a  
user error.

Kasper

On Nov 6, 2006, at 10:20 AM, Derek Stephen Elmerick wrote:

> thanks for the friendly reply. i think my description was fairly  
> clear: i
> import a large dataset and run a model. using the same dataset, the
> process worked previously and it doesn't work now. if the new  
> version of R
> requires more memory and this compromises some basic data analyses,  
> i would
> label this as a bug. if this memory issue was mentioned in the
> documentation, then i apologize. this email was clearly not well  
> received,
> so if there is a more appropriate place to post these sort of  
> questions,
> that would be helpful.
>
> -derek
>
>
>
>
> On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard  
> <p.dalgaard at biostat.ku.dk>
> wrote:
>>
>> delmeric at gmail.com writes:
>>
>>> Full_Name: Derek Elmerick
>>> Version: 2.4.0
>>> OS: Windows XP
>>> Submission from: (NULL) (38.117.162.243)
>>>
>>>
>>>
>>> hello -
>>>
>>> i have some code that i run regularly using R version 2.3.x . the  
>>> final
>> step of
>>> the code is to build a multinomial logit model. the dataset is  
>>> large;
>> however, i
>>> have not had issues in the past. i just installed the 2.4.0  
>>> version of R
>> and now
>>> have memory allocation issues. to verify, i ran the code again  
>>> against
>> the 2.3
>>> version and no problems. since i have set the memory limit to the  
>>> max
>> size, i
>>> have no alternative but to downgrade to the 2.3 version. thoughts?
>>
>> And what do you expect the maintainers to do about it? ( I.e. why are
>> you filing a bug report.)
>>
>> You give absolutely no handle on what the cause of the problem might
>> be, or even to reproduce it. It may be a bug, or maybe just R
>> requiring more memory to run than previously.
>>
>> --
>>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
>> 35327918
>> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
>> 35327907
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From khansen at stat.Berkeley.EDU  Mon Nov  6 19:50:08 2006
From: khansen at stat.Berkeley.EDU (khansen at stat.Berkeley.EDU)
Date: Mon,  6 Nov 2006 19:50:08 +0100 (CET)
Subject: [Rd] memory issues with new release (PR#9344)
Message-ID: <20061106185008.C4A1D5727B@slim.kubism.ku.dk>

It would be helpful to produce a script that reproduces the error on =20
your system. And include details on the size of your data set and =20
what you are doing with it. It is unclear what function is actually =20
causing the error and such. Really, in order to do something about it =20=

you need to show how to actually obtain the error.

To my knowledge nothing _major_ has happened with the memory =20
consumption, but of course R could use slightly more memory for =20
specific purposes.

But chances are that this is not really memory related but more =20
related to the functions your are using - perhaps a bug or perhaps a =20
user error.

Kasper

On Nov 6, 2006, at 10:20 AM, Derek Stephen Elmerick wrote:

> thanks for the friendly reply. i think my description was fairly =20
> clear: i
> import a large dataset and run a model. using the same dataset, the
> process worked previously and it doesn't work now. if the new =20
> version of R
> requires more memory and this compromises some basic data analyses, =20=

> i would
> label this as a bug. if this memory issue was mentioned in the
> documentation, then i apologize. this email was clearly not well =20
> received,
> so if there is a more appropriate place to post these sort of =20
> questions,
> that would be helpful.
>
> -derek
>
>
>
>
> On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard =20
> <p.dalgaard at biostat.ku.dk>
> wrote:
>>
>> delmeric at gmail.com writes:
>>
>>> Full_Name: Derek Elmerick
>>> Version: 2.4.0
>>> OS: Windows XP
>>> Submission from: (NULL) (38.117.162.243)
>>>
>>>
>>>
>>> hello -
>>>
>>> i have some code that i run regularly using R version 2.3.x . the =20=

>>> final
>> step of
>>> the code is to build a multinomial logit model. the dataset is =20
>>> large;
>> however, i
>>> have not had issues in the past. i just installed the 2.4.0 =20
>>> version of R
>> and now
>>> have memory allocation issues. to verify, i ran the code again =20
>>> against
>> the 2.3
>>> version and no problems. since i have set the memory limit to the =20=

>>> max
>> size, i
>>> have no alternative but to downgrade to the 2.3 version. thoughts?
>>
>> And what do you expect the maintainers to do about it? ( I.e. why are
>> you filing a bug report.)
>>
>> You give absolutely no handle on what the cause of the problem might
>> be, or even to reproduce it. It may be a bug, or maybe just R
>> requiring more memory to run than previously.
>>
>> --
>>   O__  ---- Peter Dalgaard             =D8ster Farimagsgade 5, Entr.B
>> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
>> 35327918
>> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
>> 35327907
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From p.dalgaard at biostat.ku.dk  Mon Nov  6 20:06:51 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 06 Nov 2006 20:06:51 +0100
Subject: [Rd] memory issues with new release (PR#9344)
In-Reply-To: <d054d5fa0611061020v2ff7bc7frf9b0240788ca42a6@mail.gmail.com>
References: <20061106165211.404983F03B@slim.kubism.ku.dk>
	<x2psc0ebku.fsf@turmalin.kubism.ku.dk>
	<d054d5fa0611061020v2ff7bc7frf9b0240788ca42a6@mail.gmail.com>
Message-ID: <x2hcxce6no.fsf@turmalin.kubism.ku.dk>

"Derek Stephen Elmerick" <delmeric at gmail.com> writes:

> thanks for the friendly reply. i think my description was fairly clear: i
> import a large dataset and run a model. using the same dataset, the
> process worked previously and it doesn't work now. if the new version of R
> requires more memory and this compromises some basic data analyses, i would
> label this as a bug. if this memory issue was mentioned in the
> documentation, then i apologize. this email was clearly not well received,
> so if there is a more appropriate place to post these sort of questions,
> that would be helpful.

We have mailing lists. 

r-help at lists.r-project.org

would be appropriate. 

You're still not giving sufficient information for anyone to come up
with a sensible reply, though.

Apologies if the tone came out a bit sharp, but allow me to
remind you that the first line of the report form you used reads:

"Before submitting a bug report, please read Chapter `R Bugs' of `The R
FAQ'. It describes what a bug is and how to report a bug."

You do have to realize that from the point of view of improving R, it
simply is not very informative that there is a user who has a problem
which (just?) fitted in available memory in a previous version, but
doesn't anymore.

> 
> On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk>
> wrote:
> >
> > delmeric at gmail.com writes:
> >
> > > Full_Name: Derek Elmerick
> > > Version: 2.4.0
> > > OS: Windows XP
> > > Submission from: (NULL) (38.117.162.243)
> > >
> > >
> > >
> > > hello -
> > >
> > > i have some code that i run regularly using R version 2.3.x . the final
> > step of
> > > the code is to build a multinomial logit model. the dataset is large;
> > however, i
> > > have not had issues in the past. i just installed the 2.4.0 version of R
> > and now
> > > have memory allocation issues. to verify, i ran the code again against
> > the 2.3
> > > version and no problems. since i have set the memory limit to the max
> > size, i
> > > have no alternative but to downgrade to the 2.3 version. thoughts?
> >
> > And what do you expect the maintainers to do about it? ( I.e. why are
> > you filing a bug report.)
> >
> > You give absolutely no handle on what the cause of the problem might
> > be, or even to reproduce it. It may be a bug, or maybe just R
> > requiring more memory to run than previously.
> >
> > --
> >   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> > c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> > 35327918
> > ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> > 35327907
> >

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From p.dalgaard at biostat.ku.dk  Mon Nov  6 20:06:59 2006
From: p.dalgaard at biostat.ku.dk (p.dalgaard at biostat.ku.dk)
Date: Mon,  6 Nov 2006 20:06:59 +0100 (CET)
Subject: [Rd] memory issues with new release (PR#9344)
Message-ID: <20061106190659.AA66157288@slim.kubism.ku.dk>

"Derek Stephen Elmerick" <delmeric at gmail.com> writes:

> thanks for the friendly reply. i think my description was fairly clear: i
> import a large dataset and run a model. using the same dataset, the
> process worked previously and it doesn't work now. if the new version of R
> requires more memory and this compromises some basic data analyses, i wou=
ld
> label this as a bug. if this memory issue was mentioned in the
> documentation, then i apologize. this email was clearly not well received,
> so if there is a more appropriate place to post these sort of questions,
> that would be helpful.

We have mailing lists.=20

r-help at lists.r-project.org

would be appropriate.=20

You're still not giving sufficient information for anyone to come up
with a sensible reply, though.

Apologies if the tone came out a bit sharp, but allow me to
remind you that the first line of the report form you used reads:

"Before submitting a bug report, please read Chapter `R Bugs' of `The R
FAQ'. It describes what a bug is and how to report a bug."

You do have to realize that from the point of view of improving R, it
simply is not very informative that there is a user who has a problem
which (just?) fitted in available memory in a previous version, but
doesn't anymore.

>=20
> On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk>
> wrote:
> >
> > delmeric at gmail.com writes:
> >
> > > Full_Name: Derek Elmerick
> > > Version: 2.4.0
> > > OS: Windows XP
> > > Submission from: (NULL) (38.117.162.243)
> > >
> > >
> > >
> > > hello -
> > >
> > > i have some code that i run regularly using R version 2.3.x . the fin=
al
> > step of
> > > the code is to build a multinomial logit model. the dataset is large;
> > however, i
> > > have not had issues in the past. i just installed the 2.4.0 version o=
f R
> > and now
> > > have memory allocation issues. to verify, i ran the code again against
> > the 2.3
> > > version and no problems. since i have set the memory limit to the max
> > size, i
> > > have no alternative but to downgrade to the 2.3 version. thoughts?
> >
> > And what do you expect the maintainers to do about it? ( I.e. why are
> > you filing a bug report.)
> >
> > You give absolutely no handle on what the cause of the problem might
> > be, or even to reproduce it. It may be a bug, or maybe just R
> > requiring more memory to run than previously.
> >
> > --
> >   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, Entr.B
> > c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> > 35327918
> > ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> > 35327907
> >

--=20
   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From delmeric at gmail.com  Mon Nov  6 21:10:46 2006
From: delmeric at gmail.com (Derek Stephen Elmerick)
Date: Mon, 6 Nov 2006 15:10:46 -0500
Subject: [Rd] memory issues with new release (PR#9344)
In-Reply-To: <338388AB-50B6-4D87-B502-A6D74533A20F@stat.berkeley.edu>
References: <20061106165211.404983F03B@slim.kubism.ku.dk>
	<x2psc0ebku.fsf@turmalin.kubism.ku.dk>
	<d054d5fa0611061020v2ff7bc7frf9b0240788ca42a6@mail.gmail.com>
	<338388AB-50B6-4D87-B502-A6D74533A20F@stat.berkeley.edu>
Message-ID: <d054d5fa0611061210n56c460d0i1aa8ef40c19ed3b1@mail.gmail.com>

Thanks for the replies. Point taken regarding submission protocol. I have
included a text file attachment that shows the R output with version 2.3.0and
2.4.0. A label distinguishing the version is included in the comments.

A quick background on the attached example. The dataset has 650,000 records
and 32 variables. the response is dichotomous (0/1) and i ran a logistic
model (i previously mentioned multinomial, but decided to start simple for
the example). Covariates in the model may be continuous or categorical, but
all are numeric. You'll notice that the code is the same for both versions;
however, there is a memory error with the 2.3.0 version. i ran this several
times and in different orders to make sure it was not some sort of hardware
issue.

If there is some sort of additional output that would be helpful, I can
provide as well. Or, if there is nothing I can do, that is fine also.

-Derek


On 11/6/06, Kasper Daniel Hansen <khansen at stat.berkeley.edu> wrote:
>
> It would be helpful to produce a script that reproduces the error on
> your system. And include details on the size of your data set and
> what you are doing with it. It is unclear what function is actually
> causing the error and such. Really, in order to do something about it
> you need to show how to actually obtain the error.
>
> To my knowledge nothing _major_ has happened with the memory
> consumption, but of course R could use slightly more memory for
> specific purposes.
>
> But chances are that this is not really memory related but more
> related to the functions your are using - perhaps a bug or perhaps a
> user error.
>
> Kasper
>
> On Nov 6, 2006, at 10:20 AM, Derek Stephen Elmerick wrote:
>
> > thanks for the friendly reply. i think my description was fairly
> > clear: i
> > import a large dataset and run a model. using the same dataset, the
> > process worked previously and it doesn't work now. if the new
> > version of R
> > requires more memory and this compromises some basic data analyses,
> > i would
> > label this as a bug. if this memory issue was mentioned in the
> > documentation, then i apologize. this email was clearly not well
> > received,
> > so if there is a more appropriate place to post these sort of
> > questions,
> > that would be helpful.
> >
> > -derek
> >
> >
> >
> >
> > On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard
> > <p.dalgaard at biostat.ku.dk>
> > wrote:
> >>
> >> delmeric at gmail.com writes:
> >>
> >>> Full_Name: Derek Elmerick
> >>> Version: 2.4.0
> >>> OS: Windows XP
> >>> Submission from: (NULL) ( 38.117.162.243)
> >>>
> >>>
> >>>
> >>> hello -
> >>>
> >>> i have some code that i run regularly using R version 2.3.x . the
> >>> final
> >> step of
> >>> the code is to build a multinomial logit model. the dataset is
> >>> large;
> >> however, i
> >>> have not had issues in the past. i just installed the 2.4.0
> >>> version of R
> >> and now
> >>> have memory allocation issues. to verify, i ran the code again
> >>> against
> >> the 2.3
> >>> version and no problems. since i have set the memory limit to the
> >>> max
> >> size, i
> >>> have no alternative but to downgrade to the 2.3 version. thoughts?
> >>
> >> And what do you expect the maintainers to do about it? ( I.e. why are
> >> you filing a bug report.)
> >>
> >> You give absolutely no handle on what the cause of the problem might
> >> be, or even to reproduce it. It may be a bug, or maybe just R
> >> requiring more memory to run than previously.
> >>
> >> --
> >>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> >> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> >> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> >> 35327918
> >> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> >> 35327907
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
-------------- next part --------------


> ######
> ### R 2.4.0
> ######
> 
> rm(list=ls(all=TRUE))
> memory.limit(size=4095)
NULL
> 
> clnt=read.table(file="K:\\all_data_reduced_vars.dat",header=T,sep="\t")
> 
> chk.rsp=glm(formula = resp_chkonly ~ x1 + x2 + x3 + x4 +
+     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
+     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
+     x21 + x22 +x23 + x24 + x25 + x26 +x27 + 
+     x28 + x29 + x30 + x27*x29 + x28*x30, family = binomial, 
+     data = clnt)
Error: cannot allocate vector of size 167578 Kb
> 
> dim(clnt)
[1] 650000     32
> sum(clnt)
[1] 112671553493
> 

##################################################
##################################################

> ######
> ### R 2.3.0
> ######
> 
> rm(list=ls(all=TRUE))
> memory.limit(size=4095)
NULL
> 
> clnt=read.table(file="K:\\all_data_reduced_vars.dat",header=T,sep="\t")
> 
> chk.rsp=glm(formula = resp_chkonly ~ x1 + x2 + x3 + x4 +
+     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
+     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
+     x21 + x22 +x23 + x24 + x25 + x26 +x27 + 
+     x28 + x29 + x30 + x27*x29 + x28*x30, family = binomial, 
+     data = clnt)
> 
> dim(clnt)
[1] 650000     32
> sum(clnt)
[1] 112671553493
> 

From p.dalgaard at biostat.ku.dk  Mon Nov  6 21:42:04 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 06 Nov 2006 21:42:04 +0100
Subject: [Rd] memory issues with new release (PR#9344)
In-Reply-To: <d054d5fa0611061210n56c460d0i1aa8ef40c19ed3b1@mail.gmail.com>
References: <20061106165211.404983F03B@slim.kubism.ku.dk>
	<x2psc0ebku.fsf@turmalin.kubism.ku.dk>
	<d054d5fa0611061020v2ff7bc7frf9b0240788ca42a6@mail.gmail.com>
	<338388AB-50B6-4D87-B502-A6D74533A20F@stat.berkeley.edu>
	<d054d5fa0611061210n56c460d0i1aa8ef40c19ed3b1@mail.gmail.com>
Message-ID: <x2d580e28z.fsf@turmalin.kubism.ku.dk>

"Derek Stephen Elmerick" <delmeric at gmail.com> writes:

> Thanks for the replies. Point taken regarding submission protocol. I have
> included a text file attachment that shows the R output with version 2.3.0and
> 2.4.0. A label distinguishing the version is included in the comments.
> 
> A quick background on the attached example. The dataset has 650,000 records
> and 32 variables. the response is dichotomous (0/1) and i ran a logistic
> model (i previously mentioned multinomial, but decided to start simple for
> the example). Covariates in the model may be continuous or categorical, but
> all are numeric. You'll notice that the code is the same for both versions;
> however, there is a memory error with the 2.3.0 version. i ran this several
> times and in different orders to make sure it was not some sort of hardware
> issue.
> 
> If there is some sort of additional output that would be helpful, I can
> provide as well. Or, if there is nothing I can do, that is fine also.

I don't think it was ever possible to request 4GB on XP. The version
difference might be caused by different response to invalid input in
memory.limit(). What does memory.limit(NA) tell you after the call to
memory.limit(4095) in the two versions? 

If that is not the reason: What is the *real* restriction of memory on
your system? Do you actually have 4GB in your system (RAM+swap)? 

Your design matrix is on the order of 160 MB, so shouldn't be a
problem with a GB-sized workspace. However, three copies of it will
brush against 512 MB, and it's not unlikely to have that many copies
around. 


 
> -Derek
> 
> 
> On 11/6/06, Kasper Daniel Hansen <khansen at stat.berkeley.edu> wrote:
> >
> > It would be helpful to produce a script that reproduces the error on
> > your system. And include details on the size of your data set and
> > what you are doing with it. It is unclear what function is actually
> > causing the error and such. Really, in order to do something about it
> > you need to show how to actually obtain the error.
> >
> > To my knowledge nothing _major_ has happened with the memory
> > consumption, but of course R could use slightly more memory for
> > specific purposes.
> >
> > But chances are that this is not really memory related but more
> > related to the functions your are using - perhaps a bug or perhaps a
> > user error.
> >
> > Kasper
> >
> > On Nov 6, 2006, at 10:20 AM, Derek Stephen Elmerick wrote:
> >
> > > thanks for the friendly reply. i think my description was fairly
> > > clear: i
> > > import a large dataset and run a model. using the same dataset, the
> > > process worked previously and it doesn't work now. if the new
> > > version of R
> > > requires more memory and this compromises some basic data analyses,
> > > i would
> > > label this as a bug. if this memory issue was mentioned in the
> > > documentation, then i apologize. this email was clearly not well
> > > received,
> > > so if there is a more appropriate place to post these sort of
> > > questions,
> > > that would be helpful.
> > >
> > > -derek
> > >
> > >
> > >
> > >
> > > On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard
> > > <p.dalgaard at biostat.ku.dk>
> > > wrote:
> > >>
> > >> delmeric at gmail.com writes:
> > >>
> > >>> Full_Name: Derek Elmerick
> > >>> Version: 2.4.0
> > >>> OS: Windows XP
> > >>> Submission from: (NULL) ( 38.117.162.243)
> > >>>
> > >>>
> > >>>
> > >>> hello -
> > >>>
> > >>> i have some code that i run regularly using R version 2.3.x . the
> > >>> final
> > >> step of
> > >>> the code is to build a multinomial logit model. the dataset is
> > >>> large;
> > >> however, i
> > >>> have not had issues in the past. i just installed the 2.4.0
> > >>> version of R
> > >> and now
> > >>> have memory allocation issues. to verify, i ran the code again
> > >>> against
> > >> the 2.3
> > >>> version and no problems. since i have set the memory limit to the
> > >>> max
> > >> size, i
> > >>> have no alternative but to downgrade to the 2.3 version. thoughts?
> > >>
> > >> And what do you expect the maintainers to do about it? ( I.e. why are
> > >> you filing a bug report.)
> > >>
> > >> You give absolutely no handle on what the cause of the problem might
> > >> be, or even to reproduce it. It may be a bug, or maybe just R
> > >> requiring more memory to run than previously.
> > >>
> > >> --
> > >>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> > >> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > >> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> > >> 35327918
> > >> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> > >> 35327907
> > >>
> > >
> > >       [[alternative HTML version deleted]]
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
> 
> 
> 
> > ######
> > ### R 2.4.0
> > ######
> > 
> > rm(list=ls(all=TRUE))
> > memory.limit(size=4095)
> NULL
> > 
> > clnt=read.table(file="K:\\all_data_reduced_vars.dat",header=T,sep="\t")
> > 
> > chk.rsp=glm(formula = resp_chkonly ~ x1 + x2 + x3 + x4 +
> +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> +     x21 + x22 +x23 + x24 + x25 + x26 +x27 + 
> +     x28 + x29 + x30 + x27*x29 + x28*x30, family = binomial, 
> +     data = clnt)
> Error: cannot allocate vector of size 167578 Kb
> > 
> > dim(clnt)
> [1] 650000     32
> > sum(clnt)
> [1] 112671553493
> > 
> 
> ##################################################
> ##################################################
> 
> > ######
> > ### R 2.3.0
> > ######
> > 
> > rm(list=ls(all=TRUE))
> > memory.limit(size=4095)
> NULL
> > 
> > clnt=read.table(file="K:\\all_data_reduced_vars.dat",header=T,sep="\t")
> > 
> > chk.rsp=glm(formula = resp_chkonly ~ x1 + x2 + x3 + x4 +
> +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> +     x21 + x22 +x23 + x24 + x25 + x26 +x27 + 
> +     x28 + x29 + x30 + x27*x29 + x28*x30, family = binomial, 
> +     data = clnt)
> > 
> > dim(clnt)
> [1] 650000     32
> > sum(clnt)
> [1] 112671553493
> > 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From p.dalgaard at biostat.ku.dk  Mon Nov  6 21:42:14 2006
From: p.dalgaard at biostat.ku.dk (p.dalgaard at biostat.ku.dk)
Date: Mon,  6 Nov 2006 21:42:14 +0100 (CET)
Subject: [Rd] memory issues with new release (PR#9344)
Message-ID: <20061106204214.7515D5727B@slim.kubism.ku.dk>

"Derek Stephen Elmerick" <delmeric at gmail.com> writes:

> Thanks for the replies. Point taken regarding submission protocol. I have
> included a text file attachment that shows the R output with version 2.3.=
0and
> 2.4.0. A label distinguishing the version is included in the comments.
>=20
> A quick background on the attached example. The dataset has 650,000 recor=
ds
> and 32 variables. the response is dichotomous (0/1) and i ran a logistic
> model (i previously mentioned multinomial, but decided to start simple for
> the example). Covariates in the model may be continuous or categorical, b=
ut
> all are numeric. You'll notice that the code is the same for both version=
s;
> however, there is a memory error with the 2.3.0 version. i ran this sever=
al
> times and in different orders to make sure it was not some sort of hardwa=
re
> issue.
>=20
> If there is some sort of additional output that would be helpful, I can
> provide as well. Or, if there is nothing I can do, that is fine also.

I don't think it was ever possible to request 4GB on XP. The version
difference might be caused by different response to invalid input in
memory.limit(). What does memory.limit(NA) tell you after the call to
memory.limit(4095) in the two versions?=20

If that is not the reason: What is the *real* restriction of memory on
your system? Do you actually have 4GB in your system (RAM+swap)?=20

Your design matrix is on the order of 160 MB, so shouldn't be a
problem with a GB-sized workspace. However, three copies of it will
brush against 512 MB, and it's not unlikely to have that many copies
around.=20


=20
> -Derek
>=20
>=20
> On 11/6/06, Kasper Daniel Hansen <khansen at stat.berkeley.edu> wrote:
> >
> > It would be helpful to produce a script that reproduces the error on
> > your system. And include details on the size of your data set and
> > what you are doing with it. It is unclear what function is actually
> > causing the error and such. Really, in order to do something about it
> > you need to show how to actually obtain the error.
> >
> > To my knowledge nothing _major_ has happened with the memory
> > consumption, but of course R could use slightly more memory for
> > specific purposes.
> >
> > But chances are that this is not really memory related but more
> > related to the functions your are using - perhaps a bug or perhaps a
> > user error.
> >
> > Kasper
> >
> > On Nov 6, 2006, at 10:20 AM, Derek Stephen Elmerick wrote:
> >
> > > thanks for the friendly reply. i think my description was fairly
> > > clear: i
> > > import a large dataset and run a model. using the same dataset, the
> > > process worked previously and it doesn't work now. if the new
> > > version of R
> > > requires more memory and this compromises some basic data analyses,
> > > i would
> > > label this as a bug. if this memory issue was mentioned in the
> > > documentation, then i apologize. this email was clearly not well
> > > received,
> > > so if there is a more appropriate place to post these sort of
> > > questions,
> > > that would be helpful.
> > >
> > > -derek
> > >
> > >
> > >
> > >
> > > On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard
> > > <p.dalgaard at biostat.ku.dk>
> > > wrote:
> > >>
> > >> delmeric at gmail.com writes:
> > >>
> > >>> Full_Name: Derek Elmerick
> > >>> Version: 2.4.0
> > >>> OS: Windows XP
> > >>> Submission from: (NULL) ( 38.117.162.243)
> > >>>
> > >>>
> > >>>
> > >>> hello -
> > >>>
> > >>> i have some code that i run regularly using R version 2.3.x . the
> > >>> final
> > >> step of
> > >>> the code is to build a multinomial logit model. the dataset is
> > >>> large;
> > >> however, i
> > >>> have not had issues in the past. i just installed the 2.4.0
> > >>> version of R
> > >> and now
> > >>> have memory allocation issues. to verify, i ran the code again
> > >>> against
> > >> the 2.3
> > >>> version and no problems. since i have set the memory limit to the
> > >>> max
> > >> size, i
> > >>> have no alternative but to downgrade to the 2.3 version. thoughts?
> > >>
> > >> And what do you expect the maintainers to do about it? ( I.e. why are
> > >> you filing a bug report.)
> > >>
> > >> You give absolutely no handle on what the cause of the problem might
> > >> be, or even to reproduce it. It may be a bug, or maybe just R
> > >> requiring more memory to run than previously.
> > >>
> > >> --
> > >>   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, En=
tr.B
> > >> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > >> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> > >> 35327918
> > >> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> > >> 35327907
> > >>
> > >
> > >       [[alternative HTML version deleted]]
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>=20
>=20
>=20
> > ######
> > ### R 2.4.0
> > ######
> >=20
> > rm(list=3Dls(all=3DTRUE))
> > memory.limit(size=3D4095)
> NULL
> >=20
> > clnt=3Dread.table(file=3D"K:\\all_data_reduced_vars.dat",header=3DT,sep=
=3D"\t")
> >=20
> > chk.rsp=3Dglm(formula =3D resp_chkonly ~ x1 + x2 + x3 + x4 +
> +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +=20
> +     x28 + x29 + x30 + x27*x29 + x28*x30, family =3D binomial,=20
> +     data =3D clnt)
> Error: cannot allocate vector of size 167578 Kb
> >=20
> > dim(clnt)
> [1] 650000     32
> > sum(clnt)
> [1] 112671553493
> >=20
>=20
> ##################################################
> ##################################################
>=20
> > ######
> > ### R 2.3.0
> > ######
> >=20
> > rm(list=3Dls(all=3DTRUE))
> > memory.limit(size=3D4095)
> NULL
> >=20
> > clnt=3Dread.table(file=3D"K:\\all_data_reduced_vars.dat",header=3DT,sep=
=3D"\t")
> >=20
> > chk.rsp=3Dglm(formula =3D resp_chkonly ~ x1 + x2 + x3 + x4 +
> +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +=20
> +     x28 + x29 + x30 + x27*x29 + x28*x30, family =3D binomial,=20
> +     data =3D clnt)
> >=20
> > dim(clnt)
> [1] 650000     32
> > sum(clnt)
> [1] 112671553493
> >=20

--=20
   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From vdergachev at rcgardis.com  Mon Nov  6 23:33:20 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Mon, 6 Nov 2006 17:33:20 -0500
Subject: [Rd] allocVector bug ?
In-Reply-To: <Pine.OSX.4.61.0611022216320.1246@luke-tierneys-computer.local>
References: <200611011720.09139.vdergachev@rcgardis.com>
	<Pine.OSX.4.61.0611022216320.1246@luke-tierneys-computer.local>
Message-ID: <200611061733.21105.vdergachev@rcgardis.com>


Hi Luke, 

   Thank you for the patient reply ! 

   I have looked into the issue a little deeper, comments below:

On Thursday 02 November 2006 11:26 pm, Luke Tierney wrote:
> On Wed, 1 Nov 2006, Vladimir Dergachev wrote:
> > Hi all,
> >
> >  I was looking at the following piece of code in src/main/memory.c,
> > function allocVector :
> >
> >    if (size <= NodeClassSize[1]) {
> > 	node_class = 1;
> > 	alloc_size = NodeClassSize[1];
> >    }
> >    else {
> > 	node_class = LARGE_NODE_CLASS;
> > 	alloc_size = size;
> > 	for (i = 2; i < NUM_SMALL_NODE_CLASSES; i++) {
> > 	    if (size <= NodeClassSize[i]) {
> > 		node_class = i;
> > 		alloc_size = NodeClassSize[i];
> > 		break;
> > 	    }
> > 	}
> >    }
> >
> >
> > It appears that for LARGE_NODE_CLASS the variable alloc_size should not
> > be size, but something far less as we are not using vector heap, but
> > rather calling malloc directly in the code below (and from discussions I
> > read on this mailing list I think that these two are different - please
> > let me know if I am wrong).
> >
> > So when allocate a large vector the garbage collector goes nuts trying to
> > find all that space which is not going to be needed after all.
>
> This is as intended, not a bug. The garbage collector does not "go
> nuts" -- it is doing a garbage collection that may release memory in
> advance of making a large allocation.  The size of the current
> allocation request is used as part of the process of deciding when to
> satisfy an allocation by malloc (of a single large noda or a page) and
> when to first do a gc.  It is essential to do this for large
> allocations as well to keep the memory footprint down and help reduce
> fragmentation.

I generally agree with this, however I believe that current logic breaks down 
for large allocation sizes and my code ends up spending 70% (and up) of 
computer time spinning inside garbage collector (I run oprofile to observe 
what is going on).

I do realize that garbage collection is not an easy problem  and that hardware 
and software environments change - my desire is simply to have a version of R 
that is usable for the problems I am dealing with as, aside from slowdown 
with large vector sizes, I find R a very capable tool.

I would greatly appreciate if you could comment on the following observations:

  1. The time spent during single garbage collector run grows with the number 
of nodes - from looking at the code I believe it is linear, but I am not 
certain.

  2. In my case the data.frame contains a few string vectors. These allocate 
lots of CHARSXPs which are the main cause of slowdown of each garbage 
collector run. Would you have any suggestions on optimizing this particular 
situation ? 

  3. Any time a data.frame is created, or one performs an attach() operation 
there is a series of allocations - and if one of them causes memory to expand 
all the rest will too. 

  I put in a fprintf() statement to show alloc_size, VHEAP_FREE and RV_size 
when allocVector is called (this is done only for node_class == 
LARGE_NODE_CLASS).

  First output snippet is from the time the script starts and tries to create 
data.frame:

alloc_size=128 VHEAP_FREE=604182 R_VSize=786432
alloc_size=88 VHEAP_FREE=660051 R_VSize=786432
alloc_size=88 VHEAP_FREE=659963 R_VSize=786432
alloc_size=4078820 VHEAP_FREE=659874 R_VSize=786432
alloc_size=4078820 VHEAP_FREE=260678 R_VSize=4465461
alloc_size=4078820 VHEAP_FREE=260678 R_VSize=8544282
alloc_size=4078820 VHEAP_FREE=260678 R_VSize=12623103
...
alloc_size=4078820 VHEAP_FREE=260677 R_VSize=271628325
alloc_size=4078820 VHEAP_FREE=260677 R_VSize=275707147

As you can see the VHEAP_FREE()<alloc_size logic gets triggered every single 
time and we run the garbage collector even though the memory footprint is 
clearly growing. The fact that in my case the first few columns are strings 
with lots of different values makes this particularly bad.

Next, (as a test) I run attach(B) which produced the following output:
> attach(B)
alloc_size=4078820 VHEAP_FREE=1274112 R_VSize=294022636
alloc_size=4078820 VHEAP_FREE=499351 R_VSize=297325768
...
alloc_size=4078820 VHEAP_FREE=602082 R_VSize=568670030
alloc_size=4078820 VHEAP_FREE=602082 R_VSize=572748850
alloc_size=4078820 VHEAP_FREE=602082 R_VSize=576827670
alloc_size=88 VHEAP_FREE=602082 R_VSize=580906490
alloc_size=88 VHEAP_FREE=601915 R_VSize=580906490
alloc_size=88 VHEAP_FREE=601798 R_VSize=580906490
alloc_size=88 VHEAP_FREE=601678 R_VSize=580906490
...
alloc_size=44 VHEAP_FREE=591581 R_VSize=580906490
alloc_size=88 VHEAP_FREE=591323 R_VSize=580906490
alloc_size=44 VHEAP_FREE=591220 R_VSize=580906490

So we have the same behaviour as before - the garbage collector gets run every 
time attach creates a new large vector, but functions perfectly for smaller 
vector sizes.

Next, I did detach(B) (which freed up memory) followed by "F<-B[,1]":

alloc_size=113 VHEAP_FREE=588448 R_VSize=580906490
alloc_size=618 VHEAP_FREE=588335 R_VSize=580906490
alloc_size=618 VHEAP_FREE=587717 R_VSize=580906490
alloc_size=128 VHEAP_FREE=587099 R_VSize=580906490
alloc_size=88 VHEAP_FREE=586825 R_VSize=580906490
alloc_size=4078820 VHEAP_FREE=586737 R_VSize=580906490
alloc_size=4078820 VHEAP_FREE=284079854 R_VSize=580906490
alloc_size=4078820 VHEAP_FREE=280001034 R_VSize=580906490
alloc_size=4078820 VHEAP_FREE=275922214 R_VSize=580906490
alloc_size=4078820 VHEAP_FREE=271843394 R_VSize=580906490
...
alloc_size=4078820 VHEAP_FREE=602082 R_VSize=843990775
alloc_size=4078820 VHEAP_FREE=602082 R_VSize=848069595
alloc_size=4078820 VHEAP_FREE=602082 R_VSize=852148415
alloc_size=4078820 VHEAP_FREE=602082 R_VSize=856227235
alloc_size=88 VHEAP_FREE=602082 R_VSize=860306055

In this case the logic worked - it freed memory used up by attach() but 
stopped working after that memory was consumed. (Why subscription operator 
tries to allocate an entire copy of the data.frame is a completely separate 
question - I am looking into it, but with slow progress).

My latest attempt to address this is the following modification to 
allocVector:


R_size_t vheap_grown=0;
R_size_t vheap_reused=0;
int count_skip=0;
int max_skip=0;

SEXP allocVector(SEXPTYPE type, R_len_t length)
{
...
...
    /* we need to do the gc here so allocSExp doesn't! */
    if (FORCE_GC || NO_FREE_NODES() || ((VHEAP_FREE() < alloc_size) && ! 
count_skip)) {
	fprintf(stderr, "Running gc\n");
	R_gc_internal(alloc_size);
	if (NO_FREE_NODES())
	    mem_err_cons();
	if (VHEAP_FREE() < alloc_size)
	    mem_err_heap(size);

	/* we use 2*alloc_size as if we run out of memory the
          gc will grow R_VSize to alloc for alloc_size allocation */
        if(VHEAP_FREE() < 2*alloc_size) {
	    vheap_grown+=alloc_size;
	    if(vheap_grown>vheap_reused) {
		max_skip=2*max_skip+1;
		count_skip=max_skip;
		}
	    } else {
	    vheap_reused+=alloc_size;
	    if(vheap_reused>2*vheap_grown) {
		   vheap_reused=0;
		   vheap_grown=0;
		   max_skip=0;
		   }
	    }
    }

    /* Adjust R_VSize if we skipped garbage collection */
    if( (VHEAP_FREE() < alloc_size) && count_skip) {
	 R_VSize+=alloc_size;
	 count_skip --;
	 }
...
...
}

This code attempts to detect situations when we are growing memory footprint 
and skip garbage collection before making a check again.

                              thank you very much !

                                            Vladimir Dergachev


From delmeric at gmail.com  Mon Nov  6 23:36:29 2006
From: delmeric at gmail.com (Derek Stephen Elmerick)
Date: Mon, 6 Nov 2006 17:36:29 -0500
Subject: [Rd] memory issues with new release (PR#9344)
In-Reply-To: <x2d580e28z.fsf@turmalin.kubism.ku.dk>
References: <20061106165211.404983F03B@slim.kubism.ku.dk>
	<x2psc0ebku.fsf@turmalin.kubism.ku.dk>
	<d054d5fa0611061020v2ff7bc7frf9b0240788ca42a6@mail.gmail.com>
	<338388AB-50B6-4D87-B502-A6D74533A20F@stat.berkeley.edu>
	<d054d5fa0611061210n56c460d0i1aa8ef40c19ed3b1@mail.gmail.com>
	<x2d580e28z.fsf@turmalin.kubism.ku.dk>
Message-ID: <d054d5fa0611061436x65bc5b2fr8db42f264f4aa86f@mail.gmail.com>

Peter,

I ran the memory limit function you mention below and both versions provide
the same result:

>
> memory.limit(size=4095)
NULL
> memory.limit(NA)
[1] 4293918720
>
I do have 4GB ram on my PC. As a more reproducible form of the test, I
have attached output that uses a randomly generated dataset after fixing the
seed. Same result as last time: works with 2.3.0 and not 2.4.0. I guess the
one caveat here is that I just increased the dataset size until I got the
memory issue with at least one of the R versions. It's okay. No need to
spend more time on this. I really don't mind using the previous version.
Like you mentioned, probably just a function of the new version requiring
more memory.

Thanks,
Derek



On 06 Nov 2006 21:42:04 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk>
wrote:
>
> "Derek Stephen Elmerick" <delmeric at gmail.com> writes:
>
> > Thanks for the replies. Point taken regarding submission protocol. I
> have
> > included a text file attachment that shows the R output with version
> 2.3.0and
> > 2.4.0. A label distinguishing the version is included in the comments.
> >
> > A quick background on the attached example. The dataset has 650,000
> records
> > and 32 variables. the response is dichotomous (0/1) and i ran a logistic
> > model (i previously mentioned multinomial, but decided to start simple
> for
> > the example). Covariates in the model may be continuous or categorical,
> but
> > all are numeric. You'll notice that the code is the same for both
> versions;
> > however, there is a memory error with the 2.3.0 version. i ran this
> several
> > times and in different orders to make sure it was not some sort of
> hardware
> > issue.
> >
> > If there is some sort of additional output that would be helpful, I can
> > provide as well. Or, if there is nothing I can do, that is fine also.
>
> I don't think it was ever possible to request 4GB on XP. The version
> difference might be caused by different response to invalid input in
> memory.limit(). What does memory.limit(NA) tell you after the call to
> memory.limit(4095) in the two versions?
>
> If that is not the reason: What is the *real* restriction of memory on
> your system? Do you actually have 4GB in your system (RAM+swap)?
>
> Your design matrix is on the order of 160 MB, so shouldn't be a
> problem with a GB-sized workspace. However, three copies of it will
> brush against 512 MB, and it's not unlikely to have that many copies
> around.
>
>
>
> > -Derek
> >
> >
> > On 11/6/06, Kasper Daniel Hansen < khansen at stat.berkeley.edu> wrote:
> > >
> > > It would be helpful to produce a script that reproduces the error on
> > > your system. And include details on the size of your data set and
> > > what you are doing with it. It is unclear what function is actually
> > > causing the error and such. Really, in order to do something about it
> > > you need to show how to actually obtain the error.
> > >
> > > To my knowledge nothing _major_ has happened with the memory
> > > consumption, but of course R could use slightly more memory for
> > > specific purposes.
> > >
> > > But chances are that this is not really memory related but more
> > > related to the functions your are using - perhaps a bug or perhaps a
> > > user error.
> > >
> > > Kasper
> > >
> > > On Nov 6, 2006, at 10:20 AM, Derek Stephen Elmerick wrote:
> > >
> > > > thanks for the friendly reply. i think my description was fairly
> > > > clear: i
> > > > import a large dataset and run a model. using the same dataset, the
> > > > process worked previously and it doesn't work now. if the new
> > > > version of R
> > > > requires more memory and this compromises some basic data analyses,
> > > > i would
> > > > label this as a bug. if this memory issue was mentioned in the
> > > > documentation, then i apologize. this email was clearly not well
> > > > received,
> > > > so if there is a more appropriate place to post these sort of
> > > > questions,
> > > > that would be helpful.
> > > >
> > > > -derek
> > > >
> > > >
> > > >
> > > >
> > > > On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard
> > > > < p.dalgaard at biostat.ku.dk>
> > > > wrote:
> > > >>
> > > >> delmeric at gmail.com writes:
> > > >>
> > > >>> Full_Name: Derek Elmerick
> > > >>> Version: 2.4.0
> > > >>> OS: Windows XP
> > > >>> Submission from: (NULL) ( 38.117.162.243 )
> > > >>>
> > > >>>
> > > >>>
> > > >>> hello -
> > > >>>
> > > >>> i have some code that i run regularly using R version 2.3.x . the
> > > >>> final
> > > >> step of
> > > >>> the code is to build a multinomial logit model. the dataset is
> > > >>> large;
> > > >> however, i
> > > >>> have not had issues in the past. i just installed the 2.4.0
> > > >>> version of R
> > > >> and now
> > > >>> have memory allocation issues. to verify, i ran the code again
> > > >>> against
> > > >> the 2.3
> > > >>> version and no problems. since i have set the memory limit to the
> > > >>> max
> > > >> size, i
> > > >>> have no alternative but to downgrade to the 2.3 version. thoughts?
> > > >>
> > > >> And what do you expect the maintainers to do about it? ( I.e. why
> are
> > > >> you filing a bug report.)
> > > >>
> > > >> You give absolutely no handle on what the cause of the problem
> might
> > > >> be, or even to reproduce it. It may be a bug, or maybe just R
> > > >> requiring more memory to run than previously.
> > > >>
> > > >> --
> > > >>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> > > >> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > > >> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> > > >> 35327918
> > > >> ~~~~~~~~~~ - ( p.dalgaard at biostat.ku.dk)                  FAX:
> (+45)
> > > >> 35327907
> > > >>
> > > >
> > > >       [[alternative HTML version deleted]]
> > > >
> > > > ______________________________________________
> > > > R-devel at r-project.org mailing list
> > > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> > >
> >
> >
> >
> > > ######
> > > ### R 2.4.0
> > > ######
> > >
> > > rm(list=ls(all=TRUE))
> > > memory.limit(size=4095)
> > NULL
> > >
> > > clnt=read.table
> (file="K:\\all_data_reduced_vars.dat",header=T,sep="\t")
> > >
> > > chk.rsp=glm(formula = resp_chkonly ~ x1 + x2 + x3 + x4 +
> > +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> > +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> > +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +
> > +     x28 + x29 + x30 + x27*x29 + x28*x30, family = binomial,
> > +     data = clnt)
> > Error: cannot allocate vector of size 167578 Kb
> > >
> > > dim(clnt)
> > [1] 650000     32
> > > sum(clnt)
> > [1] 112671553493
> > >
> >
> > ##################################################
> > ##################################################
> >
> > > ######
> > > ### R 2.3.0
> > > ######
> > >
> > > rm(list=ls(all=TRUE))
> > > memory.limit(size=4095)
> > NULL
> > >
> > > clnt=read.table
> (file="K:\\all_data_reduced_vars.dat",header=T,sep="\t")
> > >
> > > chk.rsp=glm(formula = resp_chkonly ~ x1 + x2 + x3 + x4 +
> > +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> > +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> > +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +
> > +     x28 + x29 + x30 + x27*x29 + x28*x30, family = binomial,
> > +     data = clnt)
> > >
> > > dim(clnt)
> > [1] 650000     32
> > > sum(clnt)
> > [1] 112671553493
> > >
>
> --
>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> 35327907
>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: derek_test2.txt
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061106/6a1fff0a/attachment.txt 

From dmaszle at mendelbio.com  Tue Nov  7 00:12:56 2006
From: dmaszle at mendelbio.com (dmaszle at mendelbio.com)
Date: Tue,  7 Nov 2006 00:12:56 +0100 (CET)
Subject: [Rd] gc()$Vcells < 0 (PR#9345)
Message-ID: <20061106231256.0CC00536A4@slim.kubism.ku.dk>

Full_Name: Don Maszle
Version: 2.3.0
OS: x86_64-unknown-linux-gnu
Submission from: (NULL) (206.86.87.3)


# On our new 32 GB x86_64 machine

R : Copyright 2006, The R Foundation for Statistical Computing
Version 2.3.0 (2006-04-24)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> R.version
               _                         
platform       x86_64-unknown-linux-gnu  
arch           x86_64                    
os             linux-gnu                 
system         x86_64, linux-gnu         
status                                   
major          2                         
minor          3.0                       
year           2006                      
month          04                        
day            24                        
svn rev        37909                     
language       R                         
version.string Version 2.3.0 (2006-04-24)

> x<-matrix(nrow=44000,ncol=48000)
> y<-matrix(nrow=44000,ncol=48000)
> z<-matrix(nrow=44000,ncol=48000)
> gc()
              used    (Mb) gc trigger    (Mb) max used    (Mb)
Ncells      177801     9.5     407500    21.8   350000    18.7
Vcells -1126881981 24170.6         NA 24173.4       NA 24170.6
>


From p.dalgaard at biostat.ku.dk  Tue Nov  7 00:22:20 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 07 Nov 2006 00:22:20 +0100
Subject: [Rd] memory issues with new release (PR#9344)
In-Reply-To: <d054d5fa0611061436x65bc5b2fr8db42f264f4aa86f@mail.gmail.com>
References: <20061106165211.404983F03B@slim.kubism.ku.dk>
	<x2psc0ebku.fsf@turmalin.kubism.ku.dk>
	<d054d5fa0611061020v2ff7bc7frf9b0240788ca42a6@mail.gmail.com>
	<338388AB-50B6-4D87-B502-A6D74533A20F@stat.berkeley.edu>
	<d054d5fa0611061210n56c460d0i1aa8ef40c19ed3b1@mail.gmail.com>
	<x2d580e28z.fsf@turmalin.kubism.ku.dk>
	<d054d5fa0611061436x65bc5b2fr8db42f264f4aa86f@mail.gmail.com>
Message-ID: <x2u01ccg9f.fsf@turmalin.kubism.ku.dk>

"Derek Stephen Elmerick" <delmeric at gmail.com> writes:

> Peter,
> 
> I ran the memory limit function you mention below and both versions provide
> the same result:
> 
> >
> > memory.limit(size=4095)
> NULL
> > memory.limit(NA)
> [1] 4293918720
> >
> I do have 4GB ram on my PC. As a more reproducible form of the test, I
> have attached output that uses a randomly generated dataset after fixing the
> seed. Same result as last time: works with 2.3.0 and not 2.4.0. I guess the
> one caveat here is that I just increased the dataset size until I got the
> memory issue with at least one of the R versions. It's okay. No need to
> spend more time on this. I really don't mind using the previous version.
> Like you mentioned, probably just a function of the new version requiring
> more memory.


Hmm, you might want to take a final look at the Windows FAQ 2.9. I am
still not quite convinced you're really getting more than the default
1.5 GB.

Also, how much can you increase the problem size on 2.3.0 before it
breaks? If you can only go to say 39 or 40 variables, then there's
probably not much we can do. If it is orders of magnitude, then we may
have a real bug (or not: sometimes we fix bugs resulting from things
not being duplicated when they should have been, the fixed code then
uses more memory than the unfixed code.)

 
> Thanks,
> Derek
> 
> 
> 
> On 06 Nov 2006 21:42:04 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk>
> wrote:
> >
> > "Derek Stephen Elmerick" <delmeric at gmail.com> writes:
> >
> > > Thanks for the replies. Point taken regarding submission protocol. I
> > have
> > > included a text file attachment that shows the R output with version
> > 2.3.0and
> > > 2.4.0. A label distinguishing the version is included in the comments.
> > >
> > > A quick background on the attached example. The dataset has 650,000
> > records
> > > and 32 variables. the response is dichotomous (0/1) and i ran a logistic
> > > model (i previously mentioned multinomial, but decided to start simple
> > for
> > > the example). Covariates in the model may be continuous or categorical,
> > but
> > > all are numeric. You'll notice that the code is the same for both
> > versions;
> > > however, there is a memory error with the 2.3.0 version. i ran this
> > several
> > > times and in different orders to make sure it was not some sort of
> > hardware
> > > issue.
> > >
> > > If there is some sort of additional output that would be helpful, I can
> > > provide as well. Or, if there is nothing I can do, that is fine also.
> >
> > I don't think it was ever possible to request 4GB on XP. The version
> > difference might be caused by different response to invalid input in
> > memory.limit(). What does memory.limit(NA) tell you after the call to
> > memory.limit(4095) in the two versions?
> >
> > If that is not the reason: What is the *real* restriction of memory on
> > your system? Do you actually have 4GB in your system (RAM+swap)?
> >
> > Your design matrix is on the order of 160 MB, so shouldn't be a
> > problem with a GB-sized workspace. However, three copies of it will
> > brush against 512 MB, and it's not unlikely to have that many copies
> > around.
> >
> >
> >
> > > -Derek
> > >
> > >
> > > On 11/6/06, Kasper Daniel Hansen < khansen at stat.berkeley.edu> wrote:
> > > >
> > > > It would be helpful to produce a script that reproduces the error on
> > > > your system. And include details on the size of your data set and
> > > > what you are doing with it. It is unclear what function is actually
> > > > causing the error and such. Really, in order to do something about it
> > > > you need to show how to actually obtain the error.
> > > >
> > > > To my knowledge nothing _major_ has happened with the memory
> > > > consumption, but of course R could use slightly more memory for
> > > > specific purposes.
> > > >
> > > > But chances are that this is not really memory related but more
> > > > related to the functions your are using - perhaps a bug or perhaps a
> > > > user error.
> > > >
> > > > Kasper
> > > >
> > > > On Nov 6, 2006, at 10:20 AM, Derek Stephen Elmerick wrote:
> > > >
> > > > > thanks for the friendly reply. i think my description was fairly
> > > > > clear: i
> > > > > import a large dataset and run a model. using the same dataset, the
> > > > > process worked previously and it doesn't work now. if the new
> > > > > version of R
> > > > > requires more memory and this compromises some basic data analyses,
> > > > > i would
> > > > > label this as a bug. if this memory issue was mentioned in the
> > > > > documentation, then i apologize. this email was clearly not well
> > > > > received,
> > > > > so if there is a more appropriate place to post these sort of
> > > > > questions,
> > > > > that would be helpful.
> > > > >
> > > > > -derek
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard
> > > > > < p.dalgaard at biostat.ku.dk>
> > > > > wrote:
> > > > >>
> > > > >> delmeric at gmail.com writes:
> > > > >>
> > > > >>> Full_Name: Derek Elmerick
> > > > >>> Version: 2.4.0
> > > > >>> OS: Windows XP
> > > > >>> Submission from: (NULL) ( 38.117.162.243 )
> > > > >>>
> > > > >>>
> > > > >>>
> > > > >>> hello -
> > > > >>>
> > > > >>> i have some code that i run regularly using R version 2.3.x . the
> > > > >>> final
> > > > >> step of
> > > > >>> the code is to build a multinomial logit model. the dataset is
> > > > >>> large;
> > > > >> however, i
> > > > >>> have not had issues in the past. i just installed the 2.4.0
> > > > >>> version of R
> > > > >> and now
> > > > >>> have memory allocation issues. to verify, i ran the code again
> > > > >>> against
> > > > >> the 2.3
> > > > >>> version and no problems. since i have set the memory limit to the
> > > > >>> max
> > > > >> size, i
> > > > >>> have no alternative but to downgrade to the 2.3 version. thoughts?
> > > > >>
> > > > >> And what do you expect the maintainers to do about it? ( I.e. why
> > are
> > > > >> you filing a bug report.)
> > > > >>
> > > > >> You give absolutely no handle on what the cause of the problem
> > might
> > > > >> be, or even to reproduce it. It may be a bug, or maybe just R
> > > > >> requiring more memory to run than previously.
> > > > >>
> > > > >> --
> > > > >>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> > > > >> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > > > >> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> > > > >> 35327918
> > > > >> ~~~~~~~~~~ - ( p.dalgaard at biostat.ku.dk)                  FAX:
> > (+45)
> > > > >> 35327907
> > > > >>
> > > > >
> > > > >       [[alternative HTML version deleted]]
> > > > >
> > > > > ______________________________________________
> > > > > R-devel at r-project.org mailing list
> > > > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > > >
> > > >
> > >
> > >
> > >
> > > > ######
> > > > ### R 2.4.0
> > > > ######
> > > >
> > > > rm(list=ls(all=TRUE))
> > > > memory.limit(size=4095)
> > > NULL
> > > >
> > > > clnt=read.table
> > (file="K:\\all_data_reduced_vars.dat",header=T,sep="\t")
> > > >
> > > > chk.rsp=glm(formula = resp_chkonly ~ x1 + x2 + x3 + x4 +
> > > +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> > > +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> > > +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +
> > > +     x28 + x29 + x30 + x27*x29 + x28*x30, family = binomial,
> > > +     data = clnt)
> > > Error: cannot allocate vector of size 167578 Kb
> > > >
> > > > dim(clnt)
> > > [1] 650000     32
> > > > sum(clnt)
> > > [1] 112671553493
> > > >
> > >
> > > ##################################################
> > > ##################################################
> > >
> > > > ######
> > > > ### R 2.3.0
> > > > ######
> > > >
> > > > rm(list=ls(all=TRUE))
> > > > memory.limit(size=4095)
> > > NULL
> > > >
> > > > clnt=read.table
> > (file="K:\\all_data_reduced_vars.dat",header=T,sep="\t")
> > > >
> > > > chk.rsp=glm(formula = resp_chkonly ~ x1 + x2 + x3 + x4 +
> > > +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> > > +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> > > +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +
> > > +     x28 + x29 + x30 + x27*x29 + x28*x30, family = binomial,
> > > +     data = clnt)
> > > >
> > > > dim(clnt)
> > > [1] 650000     32
> > > > sum(clnt)
> > > [1] 112671553493
> > > >
> >
> > --
> >   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> > c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> > 35327918
> > ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> > 35327907
> >
> 
> > 
> > ######
> > ### R 2.4.0
> > ######
> > 
> > rm(list=ls(all=TRUE))
> > memory.limit(size=4095)
> NULL
> > memory.limit(NA)
> [1] 4293918720
> > 
> > set.seed(314159)
> > clnt=matrix(runif(650000*38),650000,38)
> > y=round(runif(650000,0,1))
> > clnt=data.frame(y,clnt)
> > attributes(clnt)$names=c("y","x1","x2","x3","x4","x5","x6","x7","x8","x9","x10","x11","x12","x13","x14",
> +                         "x15","x16","x17","x18","x19","x20","x21","x22","x23","x24","x25","x26","x27",
> +                         "x28","x29","x30","x31","x32","x33","x34","x35","x36","x37")
> > dim(clnt)
> [1] 650000     39
> > sum(clnt)
> [1] 12674827
> > 
> > 
> > chk.rsp=glm(formula = y ~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 + x14 + 
> +                           x15 + x16 + x17 + x18 + x19 + x20 + x21 + x22 + x23 + x24 + x25 + x26 + x27 + 
> +                           x28 + x29 + x30 + x31 + x32 + x33 + x34 + x35 + x36 + x37, family = binomial, data = clnt)
> Error: cannot allocate vector of size 192968 Kb
> > 
> > 
> 
> ##############################################################
> ##############################################################
> ##############################################################
> 
> > 
> > ######
> > ### R 2.3.0
> > ######
> > 
> > rm(list=ls(all=TRUE))
> > memory.limit(size=4095)
> NULL
> > memory.limit(NA)
> [1] 4293918720
> > 
> > set.seed(314159)
> > clnt=matrix(runif(650000*38),650000,38)
> > y=round(runif(650000,0,1))
> > clnt=data.frame(y,clnt)
> > attributes(clnt)$names=c("y","x1","x2","x3","x4","x5","x6","x7","x8","x9","x10","x11","x12","x13","x14",
> +                         "x15","x16","x17","x18","x19","x20","x21","x22","x23","x24","x25","x26","x27",
> +                         "x28","x29","x30","x31","x32","x33","x34","x35","x36","x37")
> > dim(clnt)
> [1] 650000     39
> > sum(clnt)
> [1] 12674827
> > 
> > 
> > chk.rsp=glm(formula = y ~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 + x14 + 
> +                           x15 + x16 + x17 + x18 + x19 + x20 + x21 + x22 + x23 + x24 + x25 + x26 + x27 + 
> +                           x28 + x29 + x30 + x31 + x32 + x33 + x34 + x35 + x36 + x37, family = binomial, data = clnt)
> > 
> > 
> > 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From p.dalgaard at biostat.ku.dk  Tue Nov  7 00:22:37 2006
From: p.dalgaard at biostat.ku.dk (p.dalgaard at biostat.ku.dk)
Date: Tue,  7 Nov 2006 00:22:37 +0100 (CET)
Subject: [Rd] memory issues with new release (PR#9344)
Message-ID: <20061106232237.1AF12536A4@slim.kubism.ku.dk>

"Derek Stephen Elmerick" <delmeric at gmail.com> writes:

> Peter,
>=20
> I ran the memory limit function you mention below and both versions provi=
de
> the same result:
>=20
> >
> > memory.limit(size=3D4095)
> NULL
> > memory.limit(NA)
> [1] 4293918720
> >
> I do have 4GB ram on my PC. As a more reproducible form of the test, I
> have attached output that uses a randomly generated dataset after fixing =
the
> seed. Same result as last time: works with 2.3.0 and not 2.4.0. I guess t=
he
> one caveat here is that I just increased the dataset size until I got the
> memory issue with at least one of the R versions. It's okay. No need to
> spend more time on this. I really don't mind using the previous version.
> Like you mentioned, probably just a function of the new version requiring
> more memory.


Hmm, you might want to take a final look at the Windows FAQ 2.9. I am
still not quite convinced you're really getting more than the default
1.5 GB.

Also, how much can you increase the problem size on 2.3.0 before it
breaks? If you can only go to say 39 or 40 variables, then there's
probably not much we can do. If it is orders of magnitude, then we may
have a real bug (or not: sometimes we fix bugs resulting from things
not being duplicated when they should have been, the fixed code then
uses more memory than the unfixed code.)

=20
> Thanks,
> Derek
>=20
>=20
>=20
> On 06 Nov 2006 21:42:04 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk>
> wrote:
> >
> > "Derek Stephen Elmerick" <delmeric at gmail.com> writes:
> >
> > > Thanks for the replies. Point taken regarding submission protocol. I
> > have
> > > included a text file attachment that shows the R output with version
> > 2.3.0and
> > > 2.4.0. A label distinguishing the version is included in the comments.
> > >
> > > A quick background on the attached example. The dataset has 650,000
> > records
> > > and 32 variables. the response is dichotomous (0/1) and i ran a logis=
tic
> > > model (i previously mentioned multinomial, but decided to start simple
> > for
> > > the example). Covariates in the model may be continuous or categorica=
l,
> > but
> > > all are numeric. You'll notice that the code is the same for both
> > versions;
> > > however, there is a memory error with the 2.3.0 version. i ran this
> > several
> > > times and in different orders to make sure it was not some sort of
> > hardware
> > > issue.
> > >
> > > If there is some sort of additional output that would be helpful, I c=
an
> > > provide as well. Or, if there is nothing I can do, that is fine also.
> >
> > I don't think it was ever possible to request 4GB on XP. The version
> > difference might be caused by different response to invalid input in
> > memory.limit(). What does memory.limit(NA) tell you after the call to
> > memory.limit(4095) in the two versions?
> >
> > If that is not the reason: What is the *real* restriction of memory on
> > your system? Do you actually have 4GB in your system (RAM+swap)?
> >
> > Your design matrix is on the order of 160 MB, so shouldn't be a
> > problem with a GB-sized workspace. However, three copies of it will
> > brush against 512 MB, and it's not unlikely to have that many copies
> > around.
> >
> >
> >
> > > -Derek
> > >
> > >
> > > On 11/6/06, Kasper Daniel Hansen < khansen at stat.berkeley.edu> wrote:
> > > >
> > > > It would be helpful to produce a script that reproduces the error on
> > > > your system. And include details on the size of your data set and
> > > > what you are doing with it. It is unclear what function is actually
> > > > causing the error and such. Really, in order to do something about =
it
> > > > you need to show how to actually obtain the error.
> > > >
> > > > To my knowledge nothing _major_ has happened with the memory
> > > > consumption, but of course R could use slightly more memory for
> > > > specific purposes.
> > > >
> > > > But chances are that this is not really memory related but more
> > > > related to the functions your are using - perhaps a bug or perhaps a
> > > > user error.
> > > >
> > > > Kasper
> > > >
> > > > On Nov 6, 2006, at 10:20 AM, Derek Stephen Elmerick wrote:
> > > >
> > > > > thanks for the friendly reply. i think my description was fairly
> > > > > clear: i
> > > > > import a large dataset and run a model. using the same dataset, t=
he
> > > > > process worked previously and it doesn't work now. if the new
> > > > > version of R
> > > > > requires more memory and this compromises some basic data analyse=
s,
> > > > > i would
> > > > > label this as a bug. if this memory issue was mentioned in the
> > > > > documentation, then i apologize. this email was clearly not well
> > > > > received,
> > > > > so if there is a more appropriate place to post these sort of
> > > > > questions,
> > > > > that would be helpful.
> > > > >
> > > > > -derek
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard
> > > > > < p.dalgaard at biostat.ku.dk>
> > > > > wrote:
> > > > >>
> > > > >> delmeric at gmail.com writes:
> > > > >>
> > > > >>> Full_Name: Derek Elmerick
> > > > >>> Version: 2.4.0
> > > > >>> OS: Windows XP
> > > > >>> Submission from: (NULL) ( 38.117.162.243 )
> > > > >>>
> > > > >>>
> > > > >>>
> > > > >>> hello -
> > > > >>>
> > > > >>> i have some code that i run regularly using R version 2.3.x . t=
he
> > > > >>> final
> > > > >> step of
> > > > >>> the code is to build a multinomial logit model. the dataset is
> > > > >>> large;
> > > > >> however, i
> > > > >>> have not had issues in the past. i just installed the 2.4.0
> > > > >>> version of R
> > > > >> and now
> > > > >>> have memory allocation issues. to verify, i ran the code again
> > > > >>> against
> > > > >> the 2.3
> > > > >>> version and no problems. since i have set the memory limit to t=
he
> > > > >>> max
> > > > >> size, i
> > > > >>> have no alternative but to downgrade to the 2.3 version. though=
ts?
> > > > >>
> > > > >> And what do you expect the maintainers to do about it? ( I.e. why
> > are
> > > > >> you filing a bug report.)
> > > > >>
> > > > >> You give absolutely no handle on what the cause of the problem
> > might
> > > > >> be, or even to reproduce it. It may be a bug, or maybe just R
> > > > >> requiring more memory to run than previously.
> > > > >>
> > > > >> --
> > > > >>   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5=
, Entr.B
> > > > >> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > > > >> (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+4=
5)
> > > > >> 35327918
> > > > >> ~~~~~~~~~~ - ( p.dalgaard at biostat.ku.dk)                  FAX:
> > (+45)
> > > > >> 35327907
> > > > >>
> > > > >
> > > > >       [[alternative HTML version deleted]]
> > > > >
> > > > > ______________________________________________
> > > > > R-devel at r-project.org mailing list
> > > > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > > >
> > > >
> > >
> > >
> > >
> > > > ######
> > > > ### R 2.4.0
> > > > ######
> > > >
> > > > rm(list=3Dls(all=3DTRUE))
> > > > memory.limit(size=3D4095)
> > > NULL
> > > >
> > > > clnt=3Dread.table
> > (file=3D"K:\\all_data_reduced_vars.dat",header=3DT,sep=3D"\t")
> > > >
> > > > chk.rsp=3Dglm(formula =3D resp_chkonly ~ x1 + x2 + x3 + x4 +
> > > +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> > > +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> > > +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +
> > > +     x28 + x29 + x30 + x27*x29 + x28*x30, family =3D binomial,
> > > +     data =3D clnt)
> > > Error: cannot allocate vector of size 167578 Kb
> > > >
> > > > dim(clnt)
> > > [1] 650000     32
> > > > sum(clnt)
> > > [1] 112671553493
> > > >
> > >
> > > ##################################################
> > > ##################################################
> > >
> > > > ######
> > > > ### R 2.3.0
> > > > ######
> > > >
> > > > rm(list=3Dls(all=3DTRUE))
> > > > memory.limit(size=3D4095)
> > > NULL
> > > >
> > > > clnt=3Dread.table
> > (file=3D"K:\\all_data_reduced_vars.dat",header=3DT,sep=3D"\t")
> > > >
> > > > chk.rsp=3Dglm(formula =3D resp_chkonly ~ x1 + x2 + x3 + x4 +
> > > +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
> > > +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
> > > +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +
> > > +     x28 + x29 + x30 + x27*x29 + x28*x30, family =3D binomial,
> > > +     data =3D clnt)
> > > >
> > > > dim(clnt)
> > > [1] 650000     32
> > > > sum(clnt)
> > > [1] 112671553493
> > > >
> >
> > --
> >   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, Entr.B
> > c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> > (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
> > 35327918
> > ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
> > 35327907
> >
>=20
> >=20
> > ######
> > ### R 2.4.0
> > ######
> >=20
> > rm(list=3Dls(all=3DTRUE))
> > memory.limit(size=3D4095)
> NULL
> > memory.limit(NA)
> [1] 4293918720
> >=20
> > set.seed(314159)
> > clnt=3Dmatrix(runif(650000*38),650000,38)
> > y=3Dround(runif(650000,0,1))
> > clnt=3Ddata.frame(y,clnt)
> > attributes(clnt)$names=3Dc("y","x1","x2","x3","x4","x5","x6","x7","x8",=
"x9","x10","x11","x12","x13","x14",
> +                         "x15","x16","x17","x18","x19","x20","x21","x22"=
,"x23","x24","x25","x26","x27",
> +                         "x28","x29","x30","x31","x32","x33","x34","x35"=
,"x36","x37")
> > dim(clnt)
> [1] 650000     39
> > sum(clnt)
> [1] 12674827
> >=20
> >=20
> > chk.rsp=3Dglm(formula =3D y ~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x=
9 + x10 + x11 + x12 + x13 + x14 +=20
> +                           x15 + x16 + x17 + x18 + x19 + x20 + x21 + x22=
 + x23 + x24 + x25 + x26 + x27 +=20
> +                           x28 + x29 + x30 + x31 + x32 + x33 + x34 + x35=
 + x36 + x37, family =3D binomial, data =3D clnt)
> Error: cannot allocate vector of size 192968 Kb
> >=20
> >=20
>=20
> ##############################################################
> ##############################################################
> ##############################################################
>=20
> >=20
> > ######
> > ### R 2.3.0
> > ######
> >=20
> > rm(list=3Dls(all=3DTRUE))
> > memory.limit(size=3D4095)
> NULL
> > memory.limit(NA)
> [1] 4293918720
> >=20
> > set.seed(314159)
> > clnt=3Dmatrix(runif(650000*38),650000,38)
> > y=3Dround(runif(650000,0,1))
> > clnt=3Ddata.frame(y,clnt)
> > attributes(clnt)$names=3Dc("y","x1","x2","x3","x4","x5","x6","x7","x8",=
"x9","x10","x11","x12","x13","x14",
> +                         "x15","x16","x17","x18","x19","x20","x21","x22"=
,"x23","x24","x25","x26","x27",
> +                         "x28","x29","x30","x31","x32","x33","x34","x35"=
,"x36","x37")
> > dim(clnt)
> [1] 650000     39
> > sum(clnt)
> [1] 12674827
> >=20
> >=20
> > chk.rsp=3Dglm(formula =3D y ~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x=
9 + x10 + x11 + x12 + x13 + x14 +=20
> +                           x15 + x16 + x17 + x18 + x19 + x20 + x21 + x22=
 + x23 + x24 + x25 + x26 + x27 +=20
> +                           x28 + x29 + x30 + x31 + x32 + x33 + x34 + x35=
 + x36 + x37, family =3D binomial, data =3D clnt)
> >=20
> >=20
> >=20

--=20
   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From p.dalgaard at biostat.ku.dk  Tue Nov  7 00:30:48 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 07 Nov 2006 00:30:48 +0100
Subject: [Rd] gc()$Vcells < 0 (PR#9345)
In-Reply-To: <20061106231256.0CC00536A4@slim.kubism.ku.dk>
References: <20061106231256.0CC00536A4@slim.kubism.ku.dk>
Message-ID: <x2psc0cfvb.fsf@turmalin.kubism.ku.dk>

dmaszle at mendelbio.com writes:

> Full_Name: Don Maszle
> Version: 2.3.0
> OS: x86_64-unknown-linux-gnu
> Submission from: (NULL) (206.86.87.3)
> 
> 
> # On our new 32 GB x86_64 machine
> 
> R : Copyright 2006, The R Foundation for Statistical Computing
> Version 2.3.0 (2006-04-24)
> ISBN 3-900051-07-0
> 
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
> 
>   Natural language support but running in an English locale
> 
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
> 
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
> 
> > R.version
>                _                         
> platform       x86_64-unknown-linux-gnu  
> arch           x86_64                    
> os             linux-gnu                 
> system         x86_64, linux-gnu         
> status                                   
> major          2                         
> minor          3.0                       
> year           2006                      
> month          04                        
> day            24                        
> svn rev        37909                     
> language       R                         
> version.string Version 2.3.0 (2006-04-24)
> 
> > x<-matrix(nrow=44000,ncol=48000)
> > y<-matrix(nrow=44000,ncol=48000)
> > z<-matrix(nrow=44000,ncol=48000)
> > gc()
>               used    (Mb) gc trigger    (Mb) max used    (Mb)
> Ncells      177801     9.5     407500    21.8   350000    18.7
> Vcells -1126881981 24170.6         NA 24173.4       NA 24170.6

Sorry, can't reproduce that. Please send 32GB machine ;-)

You might want to retry with 2.4.0(-patched) for good measure, though.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From vdergachev at rcgardis.com  Tue Nov  7 00:44:23 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Mon, 6 Nov 2006 18:44:23 -0500
Subject: [Rd] gc()$Vcells < 0 (PR#9345)
In-Reply-To: <20061106231256.0CC00536A4@slim.kubism.ku.dk>
References: <20061106231256.0CC00536A4@slim.kubism.ku.dk>
Message-ID: <200611061844.23596.vdergachev@rcgardis.com>

On Monday 06 November 2006 6:12 pm, dmaszle at mendelbio.com wrote:
> version.string Version 2.3.0 (2006-04-24)
>
> > x<-matrix(nrow=44000,ncol=48000)
> > y<-matrix(nrow=44000,ncol=48000)
> > z<-matrix(nrow=44000,ncol=48000)
> > gc()
>
>               used    (Mb) gc trigger    (Mb) max used    (Mb)
> Ncells      177801     9.5     407500    21.8   350000    18.7
> Vcells -1126881981 24170.6         NA 24173.4       NA 24170.6
>

Happens to me with versions 2.40 and 2.3.1. The culprit is this line
in src/main/memory.c:

    INTEGER(value)[1] = R_VSize - VHEAP_FREE();

Since the amount used is greater than 4G and INTEGER is 32bit long 
(even on 64 bit machines) this returns (harmless) nonsense. 

The megabyte value nearby is correct and gc trigger and max used fields are 
marked as NA already.

                          best

                             Vladimir Dergachev


From vdergachev at rcgardis.com  Tue Nov  7 01:50:09 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Mon, 6 Nov 2006 19:50:09 -0500
Subject: [Rd] data frame subscription operator
Message-ID: <200611061950.09315.vdergachev@rcgardis.com>


Hi all, 

   I was looking at the data frame subscription operator (attached in the end 
of this e-mail) and got puzzled by the following line:

    class(x) <- attr(x, "row.names") <- NULL

This appears to set the class and row.names attributes of the incoming data 
frame to NULL. So far I was not able to figure out why this is necessary - 
could anyone help ?

The reason I am looking at it is that changing attributes forces duplication 
of the data frame and this is the largest cause of slowness of data.frames in 
general.

                           thank you very much !

                                            Vladimir Dergachev


> `[.data.frame`
function (x, i, j, drop = if (missing(i)) TRUE else length(cols) ==
    1)
{
    mdrop <- missing(drop)
    Narg <- nargs() - (!mdrop)
    if (Narg < 3) {
        if (!mdrop)
            warning("drop argument will be ignored")
        if (missing(i))
            return(x)
        if (is.matrix(i))
            return(as.matrix(x)[i])
        y <- NextMethod("[")
        nm <- names(y)
        if (!is.null(nm) && any(is.na(nm)))
            stop("undefined columns selected")
        if (any(duplicated(nm)))
            names(y) <- make.unique(nm)
        return(structure(y, class = oldClass(x), row.names = attr(x,
            "row.names")))
    }
    rows <- attr(x, "row.names")
    cols <- names(x)
    cl <- oldClass(x)
    class(x) <- attr(x, "row.names") <- NULL
    if (missing(i)) {
        if (!missing(j))
            x <- x[j]
        cols <- names(x)
        if (any(is.na(cols)))
            stop("undefined columns selected")
    }
    else {
        if (is.character(i))
            i <- pmatch(i, as.character(rows), duplicates.ok = TRUE)
        rows <- rows[i]
        if (!missing(j)) {
            x <- x[j]
            cols <- names(x)
            if (any(is.na(cols)))
                stop("undefined columns selected")
        }
        for (j in seq_along(x)) {
            xj <- x[[j]]
            x[[j]] <- if (length(dim(xj)) != 2)
                xj[i]
            else xj[i, , drop = FALSE]
        }
    }
    if (drop) {
        drop <- FALSE
        n <- length(x)
        if (n == 1) {
            x <- x[[1]]
            drop <- TRUE
        }
        else if (n > 1) {
            xj <- x[[1]]
            nrow <- if (length(dim(xj)) == 2)
                dim(xj)[1]
            else length(xj)
            if (!mdrop && nrow == 1) {
                drop <- TRUE
                names(x) <- cols
                attr(x, "row.names") <- NULL
            }
        }
    }
    if (!drop) {
        names(x) <- cols
        if (any(is.na(rows) | duplicated(rows))) {
            rows[is.na(rows)] <- "NA"
            rows <- make.unique(rows)
        }
        if (any(duplicated(nm <- names(x))))
            names(x) <- make.unique(nm)
        attr(x, "row.names") <- rows
        class(x) <- cl
    }
    x
}
<environment: namespace:base>


From Mark.Bravington at csiro.au  Tue Nov  7 07:43:50 2006
From: Mark.Bravington at csiro.au (Mark.Bravington at csiro.au)
Date: Tue,  7 Nov 2006 07:43:50 +0100 (CET)
Subject: [Rd] rbind with auto-row-named data.frame + list (PR#9346)
Message-ID: <20061107064350.E58BF5620C@slim.kubism.ku.dk>

There's a problem new to R2.4.0 when rbinding an auto-row-named
data.frame to a list:

> rbind( data.frame( x=1), list( x=2))
Error in attr(value, "row.names") <- rlabs : 
        row names must be 'character' or 'integer', not 'double'

Works OK with 2 data.frames or 2 lists.

Mark Bravington
CSIRO Mathematical & Information Sciences
Marine Laboratory
Castray Esplanade
Hobart 7001
TAS

ph (+61) 3 6232 5118
fax (+61) 3 6232 5012
mob (+61) 438 315 623

--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 4.0
 year = 2006
 month = 10
 day = 03
 svn rev = 39566
 language = R
 version.string = R version 2.4.0 (2006-10-03)

Windows XP Professional (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MON
ETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252

Search Path:
 .GlobalEnv, package:methods, package:stats, package:graphics,
package:grDevices, package:utils, package:datasets, Autoloads,
package:base


From ripley at stats.ox.ac.uk  Tue Nov  7 08:57:18 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 7 Nov 2006 07:57:18 +0000 (GMT)
Subject: [Rd] lme4 install,
 was Re: [R] Which executable is associated with R CMD INSTALL?
In-Reply-To: <40e66e0b0611060756n38bc5e85w2f2bd6fdb52cf5e1@mail.gmail.com>
References: <20061030193251.GA3676@ihug.co.nz> <4546725A.7000905@stats.uwo.ca>
	<20061031091759.GB3676@ihug.co.nz>
	<x24ptkyccu.fsf_-_@viggo.kubism.ku.dk>
	<40e66e0b0611060629q4d431b64w4b866aada55c0a80@mail.gmail.com>
	<x2wt68y6wo.fsf@viggo.kubism.ku.dk>
	<40e66e0b0611060756n38bc5e85w2f2bd6fdb52cf5e1@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0611070753060.19297@gannet.stats.ox.ac.uk>

On Mon, 6 Nov 2006, Douglas Bates wrote:

[...]

> However, I think it exposes a problem with R CMD INSTALL.  If there is
> a LinkingTo: directive in the DESCRIPTION file and the package's
> include directory cannot be found I think that R CMD INSTALL should
> abort.

That was a deliberate design decision: LinkingTo means 'add to the C 
include path if found'.  I think rather a package that cannot work without 
the link should ensure that the compilation fails cleanly -- I was trying 
to allow the package writer the freedom to ignore the link if it was not 
available.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Bernhard_Pfaff at fra.invesco.com  Tue Nov  7 09:56:31 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Tue, 7 Nov 2006 08:56:31 -0000
Subject: [Rd] memory issues with new release (PR#9344)
In-Reply-To: <20061106232237.1AF12536A4@slim.kubism.ku.dk>
Message-ID: <E4A9111DA23BA048B9A46686BF727CF461BE13@DEFRAXMB01.corp.amvescap.net>

>> spend more time on this. I really don't mind using the 
>previous version.


Hello Derek,

or upgrade to R 2.5.0dev; the execution of your code snippet is not
hampered by memory issues:

> sessionInfo()
R version 2.5.0 Under development (unstable) (2006-10-10 r39600) 
i386-pc-mingw32 

locale:
LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_MONETARY=
German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "datasets"  "utils"

[7] "base"     

other attached packages:
fortunes 
 "1.3-2" 
> 

My output with respect to memory.limit(NA) is the same as yours.

Best,
Bernhard


>> Like you mentioned, probably just a function of the new 
>version requiring
>> more memory.
>
>
>Hmm, you might want to take a final look at the Windows FAQ 2.9. I am
>still not quite convinced you're really getting more than the default
>1.5 GB.
>
>Also, how much can you increase the problem size on 2.3.0 before it
>breaks? If you can only go to say 39 or 40 variables, then there's
>probably not much we can do. If it is orders of magnitude, then we may
>have a real bug (or not: sometimes we fix bugs resulting from things
>not being duplicated when they should have been, the fixed code then
>uses more memory than the unfixed code.)
>
>=20
>> Thanks,
>> Derek
>>=20
>>=20
>>=20
>> On 06 Nov 2006 21:42:04 +0100, Peter Dalgaard 
><p.dalgaard at biostat.ku.dk>
>> wrote:
>> >
>> > "Derek Stephen Elmerick" <delmeric at gmail.com> writes:
>> >
>> > > Thanks for the replies. Point taken regarding submission 
>protocol. I
>> > have
>> > > included a text file attachment that shows the R output 
>with version
>> > 2.3.0and
>> > > 2.4.0. A label distinguishing the version is included in 
>the comments.
>> > >
>> > > A quick background on the attached example. The dataset 
>has 650,000
>> > records
>> > > and 32 variables. the response is dichotomous (0/1) and 
>i ran a logis=
>tic
>> > > model (i previously mentioned multinomial, but decided 
>to start simple
>> > for
>> > > the example). Covariates in the model may be continuous 
>or categorica=
>l,
>> > but
>> > > all are numeric. You'll notice that the code is the same for both
>> > versions;
>> > > however, there is a memory error with the 2.3.0 version. 
>i ran this
>> > several
>> > > times and in different orders to make sure it was not 
>some sort of
>> > hardware
>> > > issue.
>> > >
>> > > If there is some sort of additional output that would be 
>helpful, I c=
>an
>> > > provide as well. Or, if there is nothing I can do, that 
>is fine also.
>> >
>> > I don't think it was ever possible to request 4GB on XP. 
>The version
>> > difference might be caused by different response to 
>invalid input in
>> > memory.limit(). What does memory.limit(NA) tell you after 
>the call to
>> > memory.limit(4095) in the two versions?
>> >
>> > If that is not the reason: What is the *real* restriction 
>of memory on
>> > your system? Do you actually have 4GB in your system (RAM+swap)?
>> >
>> > Your design matrix is on the order of 160 MB, so shouldn't be a
>> > problem with a GB-sized workspace. However, three copies of it will
>> > brush against 512 MB, and it's not unlikely to have that 
>many copies
>> > around.
>> >
>> >
>> >
>> > > -Derek
>> > >
>> > >
>> > > On 11/6/06, Kasper Daniel Hansen < 
>khansen at stat.berkeley.edu> wrote:
>> > > >
>> > > > It would be helpful to produce a script that 
>reproduces the error on
>> > > > your system. And include details on the size of your 
>data set and
>> > > > what you are doing with it. It is unclear what 
>function is actually
>> > > > causing the error and such. Really, in order to do 
>something about =
>it
>> > > > you need to show how to actually obtain the error.
>> > > >
>> > > > To my knowledge nothing _major_ has happened with the memory
>> > > > consumption, but of course R could use slightly more memory for
>> > > > specific purposes.
>> > > >
>> > > > But chances are that this is not really memory related but more
>> > > > related to the functions your are using - perhaps a 
>bug or perhaps a
>> > > > user error.
>> > > >
>> > > > Kasper
>> > > >
>> > > > On Nov 6, 2006, at 10:20 AM, Derek Stephen Elmerick wrote:
>> > > >
>> > > > > thanks for the friendly reply. i think my 
>description was fairly
>> > > > > clear: i
>> > > > > import a large dataset and run a model. using the 
>same dataset, t=
>he
>> > > > > process worked previously and it doesn't work now. if the new
>> > > > > version of R
>> > > > > requires more memory and this compromises some basic 
>data analyse=
>s,
>> > > > > i would
>> > > > > label this as a bug. if this memory issue was 
>mentioned in the
>> > > > > documentation, then i apologize. this email was 
>clearly not well
>> > > > > received,
>> > > > > so if there is a more appropriate place to post these sort of
>> > > > > questions,
>> > > > > that would be helpful.
>> > > > >
>> > > > > -derek
>> > > > >
>> > > > >
>> > > > >
>> > > > >
>> > > > > On 06 Nov 2006 18:20:33 +0100, Peter Dalgaard
>> > > > > < p.dalgaard at biostat.ku.dk>
>> > > > > wrote:
>> > > > >>
>> > > > >> delmeric at gmail.com writes:
>> > > > >>
>> > > > >>> Full_Name: Derek Elmerick
>> > > > >>> Version: 2.4.0
>> > > > >>> OS: Windows XP
>> > > > >>> Submission from: (NULL) ( 38.117.162.243 )
>> > > > >>>
>> > > > >>>
>> > > > >>>
>> > > > >>> hello -
>> > > > >>>
>> > > > >>> i have some code that i run regularly using R 
>version 2.3.x . t=
>he
>> > > > >>> final
>> > > > >> step of
>> > > > >>> the code is to build a multinomial logit model. 
>the dataset is
>> > > > >>> large;
>> > > > >> however, i
>> > > > >>> have not had issues in the past. i just installed the 2.4.0
>> > > > >>> version of R
>> > > > >> and now
>> > > > >>> have memory allocation issues. to verify, i ran 
>the code again
>> > > > >>> against
>> > > > >> the 2.3
>> > > > >>> version and no problems. since i have set the 
>memory limit to t=
>he
>> > > > >>> max
>> > > > >> size, i
>> > > > >>> have no alternative but to downgrade to the 2.3 
>version. though=
>ts?
>> > > > >>
>> > > > >> And what do you expect the maintainers to do about 
>it? ( I.e. why
>> > are
>> > > > >> you filing a bug report.)
>> > > > >>
>> > > > >> You give absolutely no handle on what the cause of 
>the problem
>> > might
>> > > > >> be, or even to reproduce it. It may be a bug, or 
>maybe just R
>> > > > >> requiring more memory to run than previously.
>> > > > >>
>> > > > >> --
>> > > > >>   O__  ---- Peter Dalgaard             =C3=98ster 
>Farimagsgade 5=
>, Entr.B
>> > > > >> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 
>1014 Cph. K
>> > > > >> (*) \(*) -- University of Copenhagen   Denmark      
>    Ph:  (+4=
>5)
>> > > > >> 35327918
>> > > > >> ~~~~~~~~~~ - ( p.dalgaard at biostat.ku.dk)            
>      FAX:
>> > (+45)
>> > > > >> 35327907
>> > > > >>
>> > > > >
>> > > > >       [[alternative HTML version deleted]]
>> > > > >
>> > > > > ______________________________________________
>> > > > > R-devel at r-project.org mailing list
>> > > > > https://stat.ethz.ch/mailman/listinfo/r-devel
>> > > >
>> > > >
>> > >
>> > >
>> > >
>> > > > ######
>> > > > ### R 2.4.0
>> > > > ######
>> > > >
>> > > > rm(list=3Dls(all=3DTRUE))
>> > > > memory.limit(size=3D4095)
>> > > NULL
>> > > >
>> > > > clnt=3Dread.table
>> > (file=3D"K:\\all_data_reduced_vars.dat",header=3DT,sep=3D"\t")
>> > > >
>> > > > chk.rsp=3Dglm(formula =3D resp_chkonly ~ x1 + x2 + x3 + x4 +
>> > > +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
>> > > +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
>> > > +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +
>> > > +     x28 + x29 + x30 + x27*x29 + x28*x30, family =3D binomial,
>> > > +     data =3D clnt)
>> > > Error: cannot allocate vector of size 167578 Kb
>> > > >
>> > > > dim(clnt)
>> > > [1] 650000     32
>> > > > sum(clnt)
>> > > [1] 112671553493
>> > > >
>> > >
>> > > ##################################################
>> > > ##################################################
>> > >
>> > > > ######
>> > > > ### R 2.3.0
>> > > > ######
>> > > >
>> > > > rm(list=3Dls(all=3DTRUE))
>> > > > memory.limit(size=3D4095)
>> > > NULL
>> > > >
>> > > > clnt=3Dread.table
>> > (file=3D"K:\\all_data_reduced_vars.dat",header=3DT,sep=3D"\t")
>> > > >
>> > > > chk.rsp=3Dglm(formula =3D resp_chkonly ~ x1 + x2 + x3 + x4 +
>> > > +     x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 +
>> > > +     x14 + x15 + x16 + x17 + x18 + x19 +x20 +
>> > > +     x21 + x22 +x23 + x24 + x25 + x26 +x27 +
>> > > +     x28 + x29 + x30 + x27*x29 + x28*x30, family =3D binomial,
>> > > +     data =3D clnt)
>> > > >
>> > > > dim(clnt)
>> > > [1] 650000     32
>> > > > sum(clnt)
>> > > [1] 112671553493
>> > > >
>> >
>> > --
>> >   O__  ---- Peter Dalgaard             =C3=98ster 
>Farimagsgade 5, Entr.B
>> > c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>> > (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45)
>> > 35327918
>> > ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45)
>> > 35327907
>> >
>>=20
>> >=20
>> > ######
>> > ### R 2.4.0
>> > ######
>> >=20
>> > rm(list=3Dls(all=3DTRUE))
>> > memory.limit(size=3D4095)
>> NULL
>> > memory.limit(NA)
>> [1] 4293918720
>> >=20
>> > set.seed(314159)
>> > clnt=3Dmatrix(runif(650000*38),650000,38)
>> > y=3Dround(runif(650000,0,1))
>> > clnt=3Ddata.frame(y,clnt)
>> > 
>attributes(clnt)$names=3Dc("y","x1","x2","x3","x4","x5","x6","x
>7","x8",=
>"x9","x10","x11","x12","x13","x14",
>> +                         
>"x15","x16","x17","x18","x19","x20","x21","x22"=
>,"x23","x24","x25","x26","x27",
>> +                         
>"x28","x29","x30","x31","x32","x33","x34","x35"=
>,"x36","x37")
>> > dim(clnt)
>> [1] 650000     39
>> > sum(clnt)
>> [1] 12674827
>> >=20
>> >=20
>> > chk.rsp=3Dglm(formula =3D y ~ x1 + x2 + x3 + x4 + x5 + x6 
>+ x7 + x8 + x=
>9 + x10 + x11 + x12 + x13 + x14 +=20
>> +                           x15 + x16 + x17 + x18 + x19 + 
>x20 + x21 + x22=
> + x23 + x24 + x25 + x26 + x27 +=20
>> +                           x28 + x29 + x30 + x31 + x32 + 
>x33 + x34 + x35=
> + x36 + x37, family =3D binomial, data =3D clnt)
>> Error: cannot allocate vector of size 192968 Kb
>> >=20
>> >=20
>>=20
>> ##############################################################
>> ##############################################################
>> ##############################################################
>>=20
>> >=20
>> > ######
>> > ### R 2.3.0
>> > ######
>> >=20
>> > rm(list=3Dls(all=3DTRUE))
>> > memory.limit(size=3D4095)
>> NULL
>> > memory.limit(NA)
>> [1] 4293918720
>> >=20
>> > set.seed(314159)
>> > clnt=3Dmatrix(runif(650000*38),650000,38)
>> > y=3Dround(runif(650000,0,1))
>> > clnt=3Ddata.frame(y,clnt)
>> > 
>attributes(clnt)$names=3Dc("y","x1","x2","x3","x4","x5","x6","x
>7","x8",=
>"x9","x10","x11","x12","x13","x14",
>> +                         
>"x15","x16","x17","x18","x19","x20","x21","x22"=
>,"x23","x24","x25","x26","x27",
>> +                         
>"x28","x29","x30","x31","x32","x33","x34","x35"=
>,"x36","x37")
>> > dim(clnt)
>> [1] 650000     39
>> > sum(clnt)
>> [1] 12674827
>> >=20
>> >=20
>> > chk.rsp=3Dglm(formula =3D y ~ x1 + x2 + x3 + x4 + x5 + x6 
>+ x7 + x8 + x=
>9 + x10 + x11 + x12 + x13 + x14 +=20
>> +                           x15 + x16 + x17 + x18 + x19 + 
>x20 + x21 + x22=
> + x23 + x24 + x25 + x26 + x27 +=20
>> +                           x28 + x29 + x30 + x31 + x32 + 
>x33 + x34 + x35=
> + x36 + x37, family =3D binomial, data =3D clnt)
>> >=20
>> >=20
>> >=20
>
>--=20
>   O__  ---- Peter Dalgaard             =C3=98ster 
>Farimagsgade 5, Entr.B
>  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> (*) \(*) -- University of Copenhagen   Denmark          Ph:  
>(+45) 35327918
>~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: 
>(+45) 35327907
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>
*****************************************************************
Confidentiality Note: The information contained in this mess...{{dropped}}


From paradis at isem.univ-montp2.fr  Tue Nov  7 11:35:36 2006
From: paradis at isem.univ-montp2.fr (paradis at isem.univ-montp2.fr)
Date: Tue,  7 Nov 2006 11:35:36 +0100 (CET)
Subject: [Rd] R freezes with text(...., srt = -1e-8) (PR#9347)
Message-ID: <20061107103536.6A3CD56234@slim.kubism.ku.dk>

Full_Name: Emmanuel Paradis
Version: 2.4.0
OS: Linux
Submission from: (NULL) (193.49.41.124)


Adding text to a plot makes R freeze if 'srt' is given a very small negative
value, eg:

plot(1, type = "n")
text(1, 1, "some text....", srt = -1e-8)

But if 'srt = -1e-6' (or smaller) or 'srt = -1e-19' (or greater), this works.

This seems to be OS-dependent: I observed this under Linux but not under Solaris
(I was not able to test under Windows or MacOS).

EP


From maechler at stat.math.ethz.ch  Tue Nov  7 11:35:54 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 7 Nov 2006 11:35:54 +0100
Subject: [Rd] too-large notches in boxplot (PR #7690)
In-Reply-To: <43D5306E.7020709@zoo.ufl.edu>
References: <43D5306E.7020709@zoo.ufl.edu>
Message-ID: <17744.24970.228360.343807@stat.math.ethz.ch>

>>>>> "Ben" == Ben Bolker <bolker at zoo.ufl.edu>
>>>>>     on Mon, 23 Jan 2006 14:37:18 -0500 writes:

    Ben> PR #7690 points out that if the confidence intervals (+/-1.58 
    Ben> IQR/sqrt(n)) in a boxplot with notch=TRUE are larger than the
    Ben> hinges -- which is most likely to happen for small n and asymmetric
    Ben> distributions -- the resulting plot is ugly, e.g.:

     set.seed(1001)
     npts <- 5
     X <- rnorm(2*npts,rep(3:4,each=npts),sd=1)
     f <- factor(rep(1:2,each=npts))
     boxplot(X~f)
     boxplot(X~f,notch=TRUE)

    Ben> I can imagine debate about what should be done in this case --
    Ben> you could just say "don't do that", since the notches are based
    Ben> on an asymptotic argument ... the diff below just truncates
    Ben> the notches to the hinges, but produces a warning saying that the 
    Ben> notches have been truncated.

    Ben> ?? what should the behavior be ??

And this has been mentioned again more recently (than January!)
and IIRC I'd argued that the plotting behavior should not be changed,
because of back-compatibility and "you get what you deserve" etc

OTOH, users should at least notice that something "unusual"
happens,
and I have used part of Ben's proposed patch to simply issue a
warning when the notches  go beyond the hinges i.e. out side the
"box" of the boxplot.

 new>> Warning message:
 new>> some notches went outside hinges ('box'): maybe set notch=FALSE 

I hope that this helps all those who where puzzled 
by examples like the one above.

Martin Maechler, ETH Zurich

with thanks to Ben for his perseverance (:-)


    Ben> the diff is against the 11 Jan version of R 2.3.0



    Ben> *** newboxplot.R        2006-01-23 14:32:12.000000000 -0500
    Ben> --- oldboxplot.R        2006-01-23 14:29:29.000000000 -0500
    Ben> ***************
    Ben> *** 84,98 ****
    Ben> bplt <- function(x, wid, stats, out, conf, notch, xlog, i)
    Ben> {
    Ben> ## Draw single box plot
    Ben> -       conf.ok <- TRUE
    Ben> -       if(!any(is.na(stats))) {
    Ben> -           ## check for overlap of notches and hinges
    Ben> -           if (notch && (stats[2]>conf[1] || stats[4]<conf[2])) {
    Ben> -              conf.ok <- FALSE
    Ben> -              conf[1] <- max(conf[1],stats[2])
    Ben> -              conf[2] <- min(conf[2],stats[4])
    Ben> -            }

    Ben> ## stats = +/- Inf: polygon & segments should handle

    Ben> ## Compute 'x + w' -- "correctly" in log-coord. case:
    Ben> --- 84,91 ----
    Ben> bplt <- function(x, wid, stats, out, conf, notch, xlog, i)
    Ben> {
    Ben> ## Draw single box plot

    Ben> +       if(!any(is.na(stats))) {
    Ben> ## stats = +/- Inf: polygon & segments should handle

    Ben> ## Compute 'x + w' -- "correctly" in log-coord. case:
    Ben> ***************
    Ben> *** 148,154 ****
    Ben> domain = NA)
    Ben> }
    Ben> }
    Ben> -       return(conf.ok)
    Ben> } ## bplt

    Ben> if(!is.list(z) || 0 == (n <- length(z$n)))
    Ben> --- 141,146 ----
    Ben> ***************
    Ben> *** 239,252 ****
    Ben> xysegments <- segments
    Ben> }

    Ben> -     conf.ok <- numeric(n)
    Ben> for(i in 1:n)
    Ben> !       conf.ok[i] <- bplt(at[i], wid=width[i],
    Ben> stats= z$stats[,i],
    Ben> out  = z$out[z$group==i],
    Ben> conf = z$conf[,i],
    Ben> notch= notch, xlog = xlog, i = i)
    Ben> !     if (any(!conf.ok)) warning("some confidence limits > hinges: 
    Ben> notches truncated")
    Ben> axes <- is.null(pars$axes)
    Ben> if(!axes) { axes <- pars$axes; pars$axes <- NULL }
    Ben> if(axes) {
    Ben> --- 231,243 ----
    Ben> xysegments <- segments
    Ben> }

    Ben> for(i in 1:n)
    Ben> !       bplt(at[i], wid=width[i],
    Ben> stats= z$stats[,i],
    Ben> out  = z$out[z$group==i],
    Ben> conf = z$conf[,i],
    Ben> notch= notch, xlog = xlog, i = i)
    Ben> !
    Ben> axes <- is.null(pars$axes)
    Ben> if(!axes) { axes <- pars$axes; pars$axes <- NULL }
    Ben> if(axes) {


    Ben> -- 
    Ben> 620B Bartram Hall                            bolker at zoo.ufl.edu
    Ben> Zoology Department, University of Florida    http://www.zoo.ufl.edu/bolker
    Ben> Box 118525                                   (ph)  352-392-5697
    Ben> Gainesville, FL 32611-8525                   (fax) 352-392-3704

    Ben> ______________________________________________
    Ben> R-devel at r-project.org mailing list
    Ben> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Tue Nov  7 12:28:55 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 7 Nov 2006 11:28:55 +0000 (GMT)
Subject: [Rd] gc()$Vcells < 0 (PR#9345)
In-Reply-To: <200611061844.23596.vdergachev@rcgardis.com>
References: <20061106231256.0CC00536A4@slim.kubism.ku.dk>
	<200611061844.23596.vdergachev@rcgardis.com>
Message-ID: <Pine.LNX.4.64.0611070938100.24794@gannet.stats.ox.ac.uk>

On Mon, 6 Nov 2006, Vladimir Dergachev wrote:

> On Monday 06 November 2006 6:12 pm, dmaszle at mendelbio.com wrote:
>> version.string Version 2.3.0 (2006-04-24)
>>
>>> x<-matrix(nrow=44000,ncol=48000)
>>> y<-matrix(nrow=44000,ncol=48000)
>>> z<-matrix(nrow=44000,ncol=48000)
>>> gc()
>>
>>               used    (Mb) gc trigger    (Mb) max used    (Mb)
>> Ncells      177801     9.5     407500    21.8   350000    18.7
>> Vcells -1126881981 24170.6         NA 24173.4       NA 24170.6
>>
>
> Happens to me with versions 2.40 and 2.3.1. The culprit is this line
> in src/main/memory.c:
>
>    INTEGER(value)[1] = R_VSize - VHEAP_FREE();
>
> Since the amount used is greater than 4G and INTEGER is 32bit long
> (even on 64 bit machines) this returns (harmless) nonsense.

That's not quite correct.  The units here are Vcells (8 bytes), and 
integer() is signed, so this can happen only if more than 16Gb of heap is 
allocated.

We are aware that we begin to hit problems at 16Gb: it is for example the 
maximum size of an R vector.  Those objects are logical and so about 7.8Gb 
each: their length as vectors is 98% of the maximum possible.  However, 
the first time we discussed it we thought it would be about 5 years before 
those limits would become important -- I think three of those years have 
since passed.

> The megabyte value nearby is correct and gc trigger and max used fields are
> marked as NA already.

and now 'used' is also marked as NA in 2.4.0 patched.

This is only a reporting issue.  When I first used R it reported only 
numbers, and I added the Mb as a more comprehensible figure (especially 
for Ncells).  I think it would be sensible now to only report these 
figures in Mb or Gb (and also the reports for gcinfo(TRUE)).

The model behind the report actually pre-dates the GC change in 1.2.0. 
The 'Vcells' are nowadays the sum of all the allocations from VECSXPs 
(which include their headers), rather than the 'vector heap' (although 
some of the earlier terminology persists).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Tue Nov  7 12:49:54 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 07 Nov 2006 06:49:54 -0500
Subject: [Rd] R freezes with text(...., srt = -1e-8) (PR#9347)
In-Reply-To: <20061107103536.6A3CD56234@slim.kubism.ku.dk>
References: <20061107103536.6A3CD56234@slim.kubism.ku.dk>
Message-ID: <455072E2.6090701@stats.uwo.ca>

On 11/7/2006 5:35 AM, paradis at isem.univ-montp2.fr wrote:
> Full_Name: Emmanuel Paradis
> Version: 2.4.0
> OS: Linux
> Submission from: (NULL) (193.49.41.124)
> 
> 
> Adding text to a plot makes R freeze if 'srt' is given a very small negative
> value, eg:
> 
> plot(1, type = "n")
> text(1, 1, "some text....", srt = -1e-8)
> 
> But if 'srt = -1e-6' (or smaller) or 'srt = -1e-19' (or greater), this works.
> 
> This seems to be OS-dependent: I observed this under Linux but not under Solaris
> (I was not able to test under Windows or MacOS).

This looks like a duplicate of PR#9301, which was fixed a couple of 
weeks ago according to this NEWS entry:

     o   Drawing X11 rotated text was buggy for VERY small (negative)
         angle of rotation.  Reported by Ben Bolker.


Duncan Murdoch


From agner at agner.org  Tue Nov  7 14:51:22 2006
From: agner at agner.org (Agner Fog)
Date: Tue, 07 Nov 2006 14:51:22 +0100
Subject: [Rd] How to link to vignette from .Rd file
Message-ID: <45508F5A.7070303@agner.org>

I am building a package for various noncentral hypergeometric distributions.

I want to include some heavy mathematical formulas. It appears that the 
build and INSTALL commands produce only .chm files and not .pdf files 
from my .Rd files under Windows. This means that it cannot show 
complicated mathematical formulas.

The solution might be to include a .pdf file as a vignette. I tried 
that, but I can't find any way to link to the .pdf file or access it 
from any of the help facilities. The .pdf file is useless if the user 
can't find it.

I have placed the .pdf file under inst\doc\ together with an index.html 
file.
I have tried to link to the .pdf file from an .Rd file with 
\link{packagename/doc/xxx.pdf}


From murdoch at stats.uwo.ca  Tue Nov  7 15:12:30 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 07 Nov 2006 09:12:30 -0500
Subject: [Rd] How to link to vignette from .Rd file
In-Reply-To: <45508F5A.7070303@agner.org>
References: <45508F5A.7070303@agner.org>
Message-ID: <4550944E.5010206@stats.uwo.ca>

On 11/7/2006 8:51 AM, Agner Fog wrote:
> I am building a package for various noncentral hypergeometric distributions.
> 
> I want to include some heavy mathematical formulas. It appears that the 
> build and INSTALL commands produce only .chm files and not .pdf files 
> from my .Rd files under Windows. This means that it cannot show 
> complicated mathematical formulas.
> 
> The solution might be to include a .pdf file as a vignette. I tried 
> that, but I can't find any way to link to the .pdf file or access it 
> from any of the help facilities. The .pdf file is useless if the user 
> can't find it.

Yes, that's a major problem in the current R help system.  You can give 
the user code that would work to show the vignette, but there's no way 
to create a live link to it.

There are a lot of problems with the help system, and vague plans to fix 
them, but there are a lot of meta-problems as well:  there is no 
agreement on whether it should it be a complete rewrite or an 
incremental fix, no agreement on exactly what the goals of the system 
should be (e.g. should help("foo") try to guess what the user meant when 
the exact topic "foo" was not found), there's more energy spent on 
criticizing proposed changes than on implementing anything at all, and 
there's nobody who has the time and energy to fight against all of this 
to actually do anything about it.

Duncan Murdoch


> I have placed the .pdf file under inst\doc\ together with an index.html 
> file.
> I have tried to link to the .pdf file from an .Rd file with 
> \link{packagename/doc/xxx.pdf}


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Tue Nov  7 15:26:52 2006
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Tue, 7 Nov 2006 15:26:52 +0100
Subject: [Rd] Crash when embedding R X11 windows
Message-ID: <200611071526.56966.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Dear R developers,

I've been experimenting with embedding R X11 windows into another application 
using KDE's QXEmbed on linux. Attempting to do so will crash R (with R 2.4.0, 
trunk, and I know the bug has been around in prior versions). I used to think 
this was related to bug #848, but I'm not sure, if / how the solution 
suggested there still applies to current versions of R.

After debugging, I came up with the following patch (in src/modules/X11):

Index: devX11.c
===================================================================
--- devX11.c    (revision 39818)
+++ devX11.c    (working copy)
@@ -586,8 +586,8 @@
     if (event.xany.type == Expose) {
        while(XCheckTypedEvent(display, Expose, &event))
            ;
-       XFindContext(display, event.xexpose.window,
-                    devPtrContext, &temp);
+       if (XFindContext(display, event.xexpose.window,
+                    devPtrContext, &temp)) return;
        dd = (NewDevDesc *) temp;
        if (event.xexpose.count == 0)
            do_update = 1;
@@ -595,8 +595,8 @@
     else if (event.type == ConfigureNotify) {
        while(XCheckTypedEvent(display, ConfigureNotify, &event))
            ;
-       XFindContext(display, event.xconfigure.window,
-                    devPtrContext, &temp);
+       if (XFindContext(display, event.xconfigure.window,
+                    devPtrContext, &temp)) return;
        dd = (NewDevDesc *) temp;
        xd = (newX11Desc *) dd->deviceSpecific;
        if (xd->windowWidth != event.xconfigure.width ||
@@ -614,8 +614,8 @@
     else if ((event.type == ClientMessage) &&
             (event.xclient.message_type == _XA_WM_PROTOCOLS))
        if (!inclose && event.xclient.data.l[0] == protocol) {
-           XFindContext(display, event.xclient.window,
-                        devPtrContext, &temp);
+           if (XFindContext(display, event.xclient.window,
+                        devPtrContext, &temp)) return;
            dd = (NewDevDesc *) temp;
            KillDevice((DevDesc*) GetDevice(devNumber((DevDesc*) dd)));
        }

I'll have to admit, that I'm mostly clueless as far as X11-programming is 
concerned, so the patch may not be entirely correct. It does fix the crash, 
however, and should be along the right lines. The rationale is, that 
apparently calls to XFindContext() may fail in the context of embedding the 
X11 window. The patch simply checks the return value of XFindContext() for a 
non-zero (i.e. error) value, and in that case drops out of the function.

Does this seem like a valid fix? Should I provide more info?

Regards
Thomas Friedrichsmeier
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20061107/acb0b680/attachment.bin 

From sfalcon at fhcrc.org  Tue Nov  7 15:55:06 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 07 Nov 2006 06:55:06 -0800
Subject: [Rd] Getting the name of a SEXP type in package code?
Message-ID: <m24ptbe27p.fsf@ziti.local>

Hi,

Is there an alternative to type2char that is available for use in
package code?  It would be useful for producing more informative error
messages.


+ seth


From paradis at isem.univ-montp2.fr  Tue Nov  7 16:13:05 2006
From: paradis at isem.univ-montp2.fr (Emmanuel Paradis)
Date: Tue, 07 Nov 2006 16:13:05 +0100
Subject: [Rd] R freezes with text(...., srt = -1e-8) (PR#9347)
In-Reply-To: <455072E2.6090701@stats.uwo.ca>
References: <20061107103536.6A3CD56234@slim.kubism.ku.dk>
	<455072E2.6090701@stats.uwo.ca>
Message-ID: <4550A281.6000400@isem.univ-montp2.fr>

Duncan Murdoch wrote:
> On 11/7/2006 5:35 AM, paradis at isem.univ-montp2.fr wrote:
> 
>> Full_Name: Emmanuel Paradis
>> Version: 2.4.0
>> OS: Linux
>> Submission from: (NULL) (193.49.41.124)
>>
>>
>> Adding text to a plot makes R freeze if 'srt' is given a very small 
>> negative
>> value, eg:
>>
>> plot(1, type = "n")
>> text(1, 1, "some text....", srt = -1e-8)
>>
>> But if 'srt = -1e-6' (or smaller) or 'srt = -1e-19' (or greater), this 
>> works.
>>
>> This seems to be OS-dependent: I observed this under Linux but not 
>> under Solaris
>> (I was not able to test under Windows or MacOS).
> 
> 
> This looks like a duplicate of PR#9301, which was fixed a couple of 
> weeks ago according to this NEWS entry:
> 
>     o   Drawing X11 rotated text was buggy for VERY small (negative)
>         angle of rotation.  Reported by Ben Bolker.

Yes! I only checked the Graphics section... (not the Graphics-fixed one).

EP


From vdergachev at rcgardis.com  Tue Nov  7 16:45:26 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Tue, 7 Nov 2006 10:45:26 -0500
Subject: [Rd] gc()$Vcells < 0 (PR#9345)
In-Reply-To: <Pine.LNX.4.64.0611070938100.24794@gannet.stats.ox.ac.uk>
References: <20061106231256.0CC00536A4@slim.kubism.ku.dk>
	<200611061844.23596.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611070938100.24794@gannet.stats.ox.ac.uk>
Message-ID: <200611071045.26129.vdergachev@rcgardis.com>

On Tuesday 07 November 2006 6:28 am, Prof Brian Ripley wrote:
> On Mon, 6 Nov 2006, Vladimir Dergachev wrote:
> > On Monday 06 November 2006 6:12 pm, dmaszle at mendelbio.com wrote:
> >> version.string Version 2.3.0 (2006-04-24)
> >>
> >>> x<-matrix(nrow=44000,ncol=48000)
> >>> y<-matrix(nrow=44000,ncol=48000)
> >>> z<-matrix(nrow=44000,ncol=48000)
> >>> gc()
> >>
> >>               used    (Mb) gc trigger    (Mb) max used    (Mb)
> >> Ncells      177801     9.5     407500    21.8   350000    18.7
> >> Vcells -1126881981 24170.6         NA 24173.4       NA 24170.6
> >
> > Happens to me with versions 2.40 and 2.3.1. The culprit is this line
> > in src/main/memory.c:
> >
> >    INTEGER(value)[1] = R_VSize - VHEAP_FREE();
> >
> > Since the amount used is greater than 4G and INTEGER is 32bit long
> > (even on 64 bit machines) this returns (harmless) nonsense.
>
> That's not quite correct.  The units here are Vcells (8 bytes), and
> integer() is signed, so this can happen only if more than 16Gb of heap is
> allocated.

I see - thank you for the explanation !

>
> We are aware that we begin to hit problems at 16Gb: it is for example the
> maximum size of an R vector.  Those objects are logical and so about 7.8Gb
> each: their length as vectors is 98% of the maximum possible.  However,
> the first time we discussed it we thought it would be about 5 years before
> those limits would become important -- I think three of those years have
> since passed.
>
> > The megabyte value nearby is correct and gc trigger and max used fields
> > are marked as NA already.
>
> and now 'used' is also marked as NA in 2.4.0 patched.

Great, thank you !

>
> This is only a reporting issue.  When I first used R it reported only
> numbers, and I added the Mb as a more comprehensible figure (especially
> for Ncells).  I think it would be sensible now to only report these
> figures in Mb or Gb (and also the reports for gcinfo(TRUE)).

Why not use KB ? This still preserves information about small allocations and 
raises the limit to 16 TB - surely at least 5 years off ! :)

Alternatively, doubles should be able to hold the entire number, but this 
would require changes to how information is displayed.

>
> The model behind the report actually pre-dates the GC change in 1.2.0.
> The 'Vcells' are nowadays the sum of all the allocations from VECSXPs
> (which include their headers), rather than the 'vector heap' (although
> some of the earlier terminology persists).

I see.

           thank you !

                  Vladimir Dergachev


From dsamperi at DecisionSynergy.com  Tue Nov  7 18:41:52 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Tue, 07 Nov 2006 12:41:52 -0500
Subject: [Rd] How to link to vignette from .Rd file
In-Reply-To: <4550944E.5010206@stats.uwo.ca>
References: <45508F5A.7070303@agner.org> <4550944E.5010206@stats.uwo.ca>
Message-ID: <4550C560.30405@DecisionSynergy.com>

Duncan Murdoch wrote:
> On 11/7/2006 8:51 AM, Agner Fog wrote:
>   
>> I am building a package for various noncentral hypergeometric distributions.
>>
>> I want to include some heavy mathematical formulas. It appears that the 
>> build and INSTALL commands produce only .chm files and not .pdf files 
>> from my .Rd files under Windows. This means that it cannot show 
>> complicated mathematical formulas.
>>
>> The solution might be to include a .pdf file as a vignette. I tried 
>> that, but I can't find any way to link to the .pdf file or access it 
>> from any of the help facilities. The .pdf file is useless if the user 
>> can't find it.
>>     
>
> Yes, that's a major problem in the current R help system.  You can give 
> the user code that would work to show the vignette, but there's no way 
> to create a live link to it.
>   
The demo system can be used to compensate for limitations of the help 
system.
You can display PDF files from any package subdirectory using a demo file
like this (named demo/ReadPkgDoc.R, and documented in demo/00Index):

# ReadPkgDoc.R -- Displays a PDF file as a demo
#
isWindows <- (Sys.info()['sysname'] == 'Windows')
file <- system.file("doc", "PkgManual.pdf", package="PkgName")
if(isWindows) { # Windows automatically finds executable based on file type.
  system(paste("CMD /C ", file, "\n"))
} else { # Change this to use path to Adobe reader if desired.
  system(paste("xpdf ", file, "\n"))
}

To create the PDF file from the Rd file use R CMD Rd2dvi, and dvipdf.

ds


From maechler at stat.math.ethz.ch  Tue Nov  7 18:57:58 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 7 Nov 2006 18:57:58 +0100
Subject: [Rd] Getting the name of a SEXP type in package code?
In-Reply-To: <m24ptbe27p.fsf@ziti.local>
References: <m24ptbe27p.fsf@ziti.local>
Message-ID: <17744.51494.488768.338605@stat.math.ethz.ch>

>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>     on Tue, 07 Nov 2006 06:55:06 -0800 writes:

    Seth> Hi,
    Seth> Is there an alternative to type2char that is available for use in
    Seth> package code?  It would be useful for producing more informative error
    Seth> messages.

I haven't looked closely,  but I vaguely remember that I had
thought in the past,
(a version of)  type2char() should be made part of R's API.
Exactly because of the reason you give.

A more sensible name for the exported function would probably be
R_type2char    or 
Rtype_to_char  or
Rtype_as_char

If you are going to provide a patch (against R-devel),
you'd ideally also include the corresponding entry in
doc/manual/R-exts.texi ... (:-)

Martin

PS: I will be mostly absent from e-mail for the rest of the week.


From gavin.simpson at ucl.ac.uk  Tue Nov  7 19:05:16 2006
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 07 Nov 2006 18:05:16 +0000
Subject: [Rd] How to link to vignette from .Rd file
In-Reply-To: <4550C560.30405@DecisionSynergy.com>
References: <45508F5A.7070303@agner.org> <4550944E.5010206@stats.uwo.ca>
	<4550C560.30405@DecisionSynergy.com>
Message-ID: <1162922716.10209.64.camel@gsimpson.geog.ucl.ac.uk>

On Tue, 2006-11-07 at 12:41 -0500, Dominick Samperi wrote:
> Duncan Murdoch wrote:
> > On 11/7/2006 8:51 AM, Agner Fog wrote:
> >   
> >> I am building a package for various noncentral hypergeometric distributions.
> >>
> >> I want to include some heavy mathematical formulas. It appears that the 
> >> build and INSTALL commands produce only .chm files and not .pdf files 
> >> from my .Rd files under Windows. This means that it cannot show 
> >> complicated mathematical formulas.
> >>
> >> The solution might be to include a .pdf file as a vignette. I tried 
> >> that, but I can't find any way to link to the .pdf file or access it 
> >> from any of the help facilities. The .pdf file is useless if the user 
> >> can't find it.
> >>     
> >
> > Yes, that's a major problem in the current R help system.  You can give 
> > the user code that would work to show the vignette, but there's no way 
> > to create a live link to it.
> >   
<snip />
> To create the PDF file from the Rd file use R CMD Rd2dvi, and dvipdf.

You can do this directly without dvipdf: 

R CMD Rd2dvi --pdf name_of_Rd_file.Rd

G

> 
> ds
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From tom.mccallum at levelelimited.com  Tue Nov  7 21:28:45 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Tue, 07 Nov 2006 20:28:45 -0000
Subject: [Rd] variable problem
Message-ID: <op.tinxt7p9ffxks9@norisk>

Hi everyone,

I am not sure this is possible so I would be interested in your  
responses.  Say I have a variable 'v' with the string "myargument" in and  
I have a function 'f' that takes this argument as follows;

f <- function( myargument=5 ) {
   ... does something...
}

Is there anyway I can say something like;

f( v=10 ) such that it will be evaluated as f( myargument=10 ).

I presume there may be some use eval and substitute but if someone could  
point me in the right direction then that would be great.

The end idea is to have a list of m items, declared somewhere else,  which  
can be evaluated as particular arguments named after their list names

e.g

mylist <- list( "a"=1, "b"=2, "c"=3 )

which can be passed to a function taking arguments a,b, or c and it will  
be able to evaluate them accordingly :

long hand this would evaluate to something like
	f( a=mylist[["a"]] );
	f( b=mylist[["b"]] );
	f( c=mylist[["c"]] );

but I would have actually rewritten something like
	for ( myvar in names( mylist ) ) {
		f( some_clever_substitution_to_act_as_argument(myvar) = mylist[[ myvar  
]] );	
	}

I hope I have explained myself clearly enough, if not please say so and I  
will try and give a better example.

Many thanks for your help

Tom



-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The contents of  
this e-mail are privileged and/or confidential. If you are not the  
intended recipient, please
notify the sender and ensure this e-mail is deleted and not read, copied  
or disclosed. It is your responsibility to scan this e-mail and any  
attachments for
computer viruses or other defects. Level E does not accept liability for  
any loss or damage which may result from this e-mail or any attachment.  
E-mail is not secure
and can be intercepted, corrupted or amended. Level E does not accept  
liability for errors or omissions arising as a result of interrupted or  
defective transmission.
Any views, opinions, conclusions or other information in this e-mail which  
do not relate to the business of Level E Limited are not authorised by  
Level E. Unless
specifically stated and authorised by Level E, nothing in this e-mail  
shall be taken to be an offer or acceptance of any contract of any nature.  
E-mail entering or leaving Level E's system is subject to random  
monitoring and recording.


From vdergachev at rcgardis.com  Tue Nov  7 21:45:04 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Tue, 7 Nov 2006 15:45:04 -0500
Subject: [Rd] variable problem
In-Reply-To: <op.tinxt7p9ffxks9@norisk>
References: <op.tinxt7p9ffxks9@norisk>
Message-ID: <200611071545.04465.vdergachev@rcgardis.com>

On Tuesday 07 November 2006 3:28 pm, Tom McCallum wrote:
> Hi everyone,

Hi Tom, 

    Would this snippet work:

    for(i in 1:length(mylist))do.call(f, mylist[i])

    On the other hand it is not easy to see why you would want to call the 
same function with differently named arguments - perhaps what you are really 
trying to do has a different (and better) solution ?

                       best

                          Vladimir Dergachev

>
> I am not sure this is possible so I would be interested in your
> responses.  Say I have a variable 'v' with the string "myargument" in and
> I have a function 'f' that takes this argument as follows;
>
> f <- function( myargument=5 ) {
>    ... does something...
> }
>
> Is there anyway I can say something like;
>
> f( v=10 ) such that it will be evaluated as f( myargument=10 ).
>
> I presume there may be some use eval and substitute but if someone could
> point me in the right direction then that would be great.
>
> The end idea is to have a list of m items, declared somewhere else,  which
> can be evaluated as particular arguments named after their list names
>
> e.g
>
> mylist <- list( "a"=1, "b"=2, "c"=3 )
>
> which can be passed to a function taking arguments a,b, or c and it will
> be able to evaluate them accordingly :
>
> long hand this would evaluate to something like
> 	f( a=mylist[["a"]] );
> 	f( b=mylist[["b"]] );
> 	f( c=mylist[["c"]] );
>
> but I would have actually rewritten something like
> 	for ( myvar in names( mylist ) ) {
> 		f( some_clever_substitution_to_act_as_argument(myvar) = mylist[[ myvar
> ]] );
> 	}
>
> I hope I have explained myself clearly enough, if not please say so and I
> will try and give a better example.
>
> Many thanks for your help
>
> Tom


From tom.mccallum at levelelimited.com  Tue Nov  7 21:50:21 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Tue, 07 Nov 2006 20:50:21 -0000
Subject: [Rd] variable problem
In-Reply-To: <200611071545.04465.vdergachev@rcgardis.com>
References: <op.tinxt7p9ffxks9@norisk>
	<200611071545.04465.vdergachev@rcgardis.com>
Message-ID: <op.tinyt7nqffxks9@norisk>

Works like a charm - thank you very much.

Tom

On Tue, 07 Nov 2006 20:45:04 -0000, Vladimir Dergachev  
<vdergachev at rcgardis.com> wrote:

> On Tuesday 07 November 2006 3:28 pm, Tom McCallum wrote:
>> Hi everyone,
>
> Hi Tom,
>
>     Would this snippet work:
>
>     for(i in 1:length(mylist))do.call(f, mylist[i])
>
>     On the other hand it is not easy to see why you would want to call  
> the
> same function with differently named arguments - perhaps what you are  
> really
> trying to do has a different (and better) solution ?
>
>                        best
>
>                           Vladimir Dergachev
>
>>
>> I am not sure this is possible so I would be interested in your
>> responses.  Say I have a variable 'v' with the string "myargument" in  
>> and
>> I have a function 'f' that takes this argument as follows;
>>
>> f <- function( myargument=5 ) {
>>    ... does something...
>> }
>>
>> Is there anyway I can say something like;
>>
>> f( v=10 ) such that it will be evaluated as f( myargument=10 ).
>>
>> I presume there may be some use eval and substitute but if someone could
>> point me in the right direction then that would be great.
>>
>> The end idea is to have a list of m items, declared somewhere else,   
>> which
>> can be evaluated as particular arguments named after their list names
>>
>> e.g
>>
>> mylist <- list( "a"=1, "b"=2, "c"=3 )
>>
>> which can be passed to a function taking arguments a,b, or c and it will
>> be able to evaluate them accordingly :
>>
>> long hand this would evaluate to something like
>> 	f( a=mylist[["a"]] );
>> 	f( b=mylist[["b"]] );
>> 	f( c=mylist[["c"]] );
>>
>> but I would have actually rewritten something like
>> 	for ( myvar in names( mylist ) ) {
>> 		f( some_clever_substitution_to_act_as_argument(myvar) = mylist[[ myvar
>> ]] );
>> 	}
>>
>> I hope I have explained myself clearly enough, if not please say so and  
>> I
>> will try and give a better example.
>>
>> Many thanks for your help
>>
>> Tom
>



-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The contents of  
this e-mail are privileged and/or confidential. If you are not the  
intended recipient, please
notify the sender and ensure this e-mail is deleted and not read, copied  
or disclosed. It is your responsibility to scan this e-mail and any  
attachments for
computer viruses or other defects. Level E does not accept liability for  
any loss or damage which may result from this e-mail or any attachment.  
E-mail is not secure
and can be intercepted, corrupted or amended. Level E does not accept  
liability for errors or omissions arising as a result of interrupted or  
defective transmission.
Any views, opinions, conclusions or other information in this e-mail which  
do not relate to the business of Level E Limited are not authorised by  
Level E. Unless
specifically stated and authorised by Level E, nothing in this e-mail  
shall be taken to be an offer or acceptance of any contract of any nature.  
E-mail entering or leaving Level E's system is subject to random  
monitoring and recording.


From dsamperi at DecisionSynergy.com  Tue Nov  7 22:01:03 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Tue, 07 Nov 2006 16:01:03 -0500
Subject: [Rd] How to link to vignette from .Rd file
In-Reply-To: <20061107175909.GA28706@eddelbuettel.com>
References: <45508F5A.7070303@agner.org> <4550944E.5010206@stats.uwo.ca>
	<4550C560.30405@DecisionSynergy.com>
	<20061107175909.GA28706@eddelbuettel.com>
Message-ID: <4550F40F.802@DecisionSynergy.com>

Dirk Eddelbuettel wrote:
> There is options("pdfviewer") -- at least under Unix. Maybe there is
> even an R call to use it on a file, employed by the help system?
> Dirk
Thanks,
Here is a more complete solution that can be turned into a general-purpose
function...

# Displays PDF file as an R demo
#
pkgName <- 'MyPackage'
pkgDir  <- 'doc'
pdfFile <- 'MyPackageDoc.pdf'
isWindows <- (Sys.info()['sysname'] == 'Windows')
pkgLoc <- system.file(".", ".", package=pkgName)
pkgLoc <- substring(pkgLoc, 1, nchar(pkgLoc)-nchar(pkgName)-5)
file <- system.file(pkgDir, pdfFile, package=pkgName,lib.loc=pkgLoc)
if(isWindows) { # Windows automatically finds executable based on file type.
  system(paste("CMD /C ", file, "\n"))
} else { # Change this to use path to Adobe reader if desired.
  system(paste(options("pdfviewer"), file, "\n"))
}


From rich.fitzjohn at gmail.com  Tue Nov  7 22:42:47 2006
From: rich.fitzjohn at gmail.com (Rich FitzJohn)
Date: Wed, 8 Nov 2006 10:42:47 +1300
Subject: [Rd] How to link to vignette from .Rd file
In-Reply-To: <4550F40F.802@DecisionSynergy.com>
References: <45508F5A.7070303@agner.org> <4550944E.5010206@stats.uwo.ca>
	<4550C560.30405@DecisionSynergy.com>
	<20061107175909.GA28706@eddelbuettel.com>
	<4550F40F.802@DecisionSynergy.com>
Message-ID: <5934ae570611071342u3a80b8efg7a146f4f7df125e4@mail.gmail.com>

This all seems very similar to the built-in "vignette" function; e.g.

vignette("grid")

Cheers,
Rich

On 11/8/06, Dominick Samperi <dsamperi at decisionsynergy.com> wrote:
> Dirk Eddelbuettel wrote:
> > There is options("pdfviewer") -- at least under Unix. Maybe there is
> > even an R call to use it on a file, employed by the help system?
> > Dirk
> Thanks,
> Here is a more complete solution that can be turned into a general-purpose
> function...
>
> # Displays PDF file as an R demo
> #
> pkgName <- 'MyPackage'
> pkgDir  <- 'doc'
> pdfFile <- 'MyPackageDoc.pdf'
> isWindows <- (Sys.info()['sysname'] == 'Windows')
> pkgLoc <- system.file(".", ".", package=pkgName)
> pkgLoc <- substring(pkgLoc, 1, nchar(pkgLoc)-nchar(pkgName)-5)
> file <- system.file(pkgDir, pdfFile, package=pkgName,lib.loc=pkgLoc)
> if(isWindows) { # Windows automatically finds executable based on file type.
>   system(paste("CMD /C ", file, "\n"))
> } else { # Change this to use path to Adobe reader if desired.
>   system(paste(options("pdfviewer"), file, "\n"))
> }
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Rich FitzJohn
rich.fitzjohn <at> gmail.com


From sarkar at mail.utexas.edu  Wed Nov  8 02:41:33 2006
From: sarkar at mail.utexas.edu (sarkar at mail.utexas.edu)
Date: Wed,  8 Nov 2006 02:41:33 +0100 (CET)
Subject: [Rd] Chi-squared test (PR#9350)
Message-ID: <20061108014133.89AAE3F006@slim.kubism.ku.dk>

Full_Name: Sahotra Sarkar
Version: 2.2.0
OS: Windows XP
Submission from: (NULL) (128.83.34.44)


This is not a bug: I'm just wondering why chisq.test does not allow the
specification of the degree of freedom (df).


From khansen at stat.Berkeley.EDU  Wed Nov  8 04:24:14 2006
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Tue, 7 Nov 2006 19:24:14 -0800
Subject: [Rd] Chi-squared test (PR#9350)
In-Reply-To: <20061108014133.89AAE3F006@slim.kubism.ku.dk>
References: <20061108014133.89AAE3F006@slim.kubism.ku.dk>
Message-ID: <906937A7-85B7-4ABB-BF31-C0387D04B833@stat.berkeley.edu>

(not cc'ed to R-bugs)

If this is not a bug why do you abuse the bug report system to ask a  
simple question? Now a member of R-core has to use valuable time to  
handle this bug report, time that could be far more profitable spent  
making improvements to R (or spend it otherwise). This is incredible  
selfish behavior.

Kasper

On Nov 7, 2006, at 5:41 PM, sarkar at mail.utexas.edu wrote:

> Full_Name: Sahotra Sarkar
> Version: 2.2.0
> OS: Windows XP
> Submission from: (NULL) (128.83.34.44)
>
>
> This is not a bug: I'm just wondering why chisq.test does not allow  
> the
> specification of the degree of freedom (df).
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Wed Nov  8 08:05:06 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 8 Nov 2006 07:05:06 +0000 (GMT)
Subject: [Rd] Getting the name of a SEXP type in package code?
In-Reply-To: <17744.51494.488768.338605@stat.math.ethz.ch>
References: <m24ptbe27p.fsf@ziti.local>
	<17744.51494.488768.338605@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0611080658030.25461@gannet.stats.ox.ac.uk>

type2char is itself a fairly recent addition (there is also type2str, 
which is older) that I found useful for improving messages in R itself.

I have not encountered such a need in package code, but the function is 
exported.

This is not a request to move type2char from Defn.h to Rinternals.h, and I 
don't understand why not: what else is needed?


On Tue, 7 Nov 2006, Martin Maechler wrote:

>>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>>     on Tue, 07 Nov 2006 06:55:06 -0800 writes:
>
>    Seth> Hi,
>    Seth> Is there an alternative to type2char that is available for use in
>    Seth> package code?  It would be useful for producing more informative error
>    Seth> messages.
>
> I haven't looked closely,  but I vaguely remember that I had
> thought in the past,
> (a version of)  type2char() should be made part of R's API.
> Exactly because of the reason you give.
>
> A more sensible name for the exported function would probably be
> R_type2char    or
> Rtype_to_char  or
> Rtype_as_char

It is exported as Rf_type2char.

> If you are going to provide a patch (against R-devel),
> you'd ideally also include the corresponding entry in
> doc/manual/R-exts.texi ... (:-)
>
> Martin
>
> PS: I will be mostly absent from e-mail for the rest of the week.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Nov  8 08:56:24 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 8 Nov 2006 07:56:24 +0000 (GMT)
Subject: [Rd] gc()$Vcells < 0 (PR#9345)
In-Reply-To: <200611071045.26129.vdergachev@rcgardis.com>
References: <20061106231256.0CC00536A4@slim.kubism.ku.dk>
	<200611061844.23596.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611070938100.24794@gannet.stats.ox.ac.uk>
	<200611071045.26129.vdergachev@rcgardis.com>
Message-ID: <Pine.LNX.4.64.0611071645030.15377@gannet.stats.ox.ac.uk>

On Tue, 7 Nov 2006, Vladimir Dergachev wrote:

> On Tuesday 07 November 2006 6:28 am, Prof Brian Ripley wrote:
>> On Mon, 6 Nov 2006, Vladimir Dergachev wrote:
>>> On Monday 06 November 2006 6:12 pm, dmaszle at mendelbio.com wrote:
>>>> version.string Version 2.3.0 (2006-04-24)
>>>>
>>>>> x<-matrix(nrow=44000,ncol=48000)
>>>>> y<-matrix(nrow=44000,ncol=48000)
>>>>> z<-matrix(nrow=44000,ncol=48000)
>>>>> gc()
>>>>
>>>>               used    (Mb) gc trigger    (Mb) max used    (Mb)
>>>> Ncells      177801     9.5     407500    21.8   350000    18.7
>>>> Vcells -1126881981 24170.6         NA 24173.4       NA 24170.6
>>>
>>> Happens to me with versions 2.40 and 2.3.1. The culprit is this line
>>> in src/main/memory.c:
>>>
>>>    INTEGER(value)[1] = R_VSize - VHEAP_FREE();
>>>
>>> Since the amount used is greater than 4G and INTEGER is 32bit long
>>> (even on 64 bit machines) this returns (harmless) nonsense.
>>
>> That's not quite correct.  The units here are Vcells (8 bytes), and
>> integer() is signed, so this can happen only if more than 16Gb of heap is
>> allocated.
>
> I see - thank you for the explanation !
>
>>
>> We are aware that we begin to hit problems at 16Gb: it is for example the
>> maximum size of an R vector.  Those objects are logical and so about 7.8Gb
>> each: their length as vectors is 98% of the maximum possible.  However,
>> the first time we discussed it we thought it would be about 5 years before
>> those limits would become important -- I think three of those years have
>> since passed.
>>
>>> The megabyte value nearby is correct and gc trigger and max used fields
>>> are marked as NA already.
>>
>> and now 'used' is also marked as NA in 2.4.0 patched.
>
> Great, thank you !
>
>>
>> This is only a reporting issue.  When I first used R it reported only
>> numbers, and I added the Mb as a more comprehensible figure (especially
>> for Ncells).  I think it would be sensible now to only report these
>> figures in Mb or Gb (and also the reports for gcinfo(TRUE)).
>
> Why not use KB ? This still preserves information about small allocations and
> raises the limit to 16 TB - surely at least 5 years off ! :)

We already use 0.1Mb: why would you have any need for more accuracy?

> Alternatively, doubles should be able to hold the entire number, but this
> would require changes to how information is displayed.

Actually, no as the matrix returned is double.  What it did require is 
some redesign of the internal code, but that had already been done in 
R-devel.  I don't have access to a machine which can handle more than 16Gb 
of memory allocation, but it should be the case that in R-devel the actual 
values will be returned.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From agner at agner.org  Wed Nov  8 09:15:20 2006
From: agner at agner.org (Agner Fog)
Date: Wed, 08 Nov 2006 09:15:20 +0100
Subject: [Rd] How to link to vignette from .Rd file
In-Reply-To: <4550C560.30405@DecisionSynergy.com>
References: <45508F5A.7070303@agner.org> <4550944E.5010206@stats.uwo.ca>
	<4550C560.30405@DecisionSynergy.com>
Message-ID: <45519218.2090106@agner.org>

Thanks for the tip. I had thought of using the demo facility for this 
but I didn't know how to check for the operating system.
This is a clumsy solution, but better than nothing. I agree with Duncan 
that there is a problem with the help system. It should either have a 
way to embed formulas and graphics in .chm files, or a way to use .pdf 
files for help under all operating systems. The latter solution is 
probably easier to implement.

Unfortunately, I personally don't have the time to contribute to 
improving the help system of R. Maybe tasks like this could be offered 
as projects to university students. Many students are doing useless 
projects so why not use this resource for something useful.

I have proposed to use R instead of Matlab for teaching math and signal 
analysis at my university college, but I am not teaching math myself so 
it's not my decision. If more universities were using R instead of 
Matlab, Mathcad, SAS, etc. then they would also be motivated to 
contribute to the development.


Dominick Samperi wrote:

> Duncan Murdoch wrote:
>
>> On 11/7/2006 8:51 AM, Agner Fog wrote:
>>  
>>
>>> I am building a package for various noncentral hypergeometric 
>>> distributions.
>>>
>>> I want to include some heavy mathematical formulas. It appears that 
>>> the build and INSTALL commands produce only .chm files and not .pdf 
>>> files from my .Rd files under Windows. This means that it cannot 
>>> show complicated mathematical formulas.
>>>
>>> The solution might be to include a .pdf file as a vignette. I tried 
>>> that, but I can't find any way to link to the .pdf file or access it 
>>> from any of the help facilities. The .pdf file is useless if the 
>>> user can't find it.
>>>     
>>
>>
>> Yes, that's a major problem in the current R help system.  You can 
>> give the user code that would work to show the vignette, but there's 
>> no way to create a live link to it.
>>   
>
> The demo system can be used to compensate for limitations of the help 
> system.
> You can display PDF files from any package subdirectory using a demo file
> like this (named demo/ReadPkgDoc.R, and documented in demo/00Index):
>
> # ReadPkgDoc.R -- Displays a PDF file as a demo
> #
> isWindows <- (Sys.info()['sysname'] == 'Windows')
> file <- system.file("doc", "PkgManual.pdf", package="PkgName")
> if(isWindows) { # Windows automatically finds executable based on file 
> type.
>  system(paste("CMD /C ", file, "\n"))
> } else { # Change this to use path to Adobe reader if desired.
>  system(paste("xpdf ", file, "\n"))
> }
>
> To create the PDF file from the Rd file use R CMD Rd2dvi, and dvipdf.
>
> ds
>


From ripley at stats.ox.ac.uk  Wed Nov  8 09:21:05 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 8 Nov 2006 08:21:05 +0000 (GMT)
Subject: [Rd] data frame subscription operator
In-Reply-To: <200611061950.09315.vdergachev@rcgardis.com>
References: <200611061950.09315.vdergachev@rcgardis.com>
Message-ID: <Pine.LNX.4.64.0611070814300.19704@gannet.stats.ox.ac.uk>

'[' is the 'subscript' or 'extraction', not 'subscription' operator: this 
is also called 'indexing', as in 'An Introduction to R'.

On Mon, 6 Nov 2006, Vladimir Dergachev wrote:

>   I was looking at the data frame subscription operator (attached in the end
> of this e-mail) and got puzzled by the following line:
>
>    class(x) <- attr(x, "row.names") <- NULL
>
> This appears to set the class and row.names attributes of the incoming data
> frame to NULL.

Actually no, it removes them: see ?attr and ?class.

> So far I was not able to figure out why this is necessary -
> could anyone help ?

You need to remove the class to avoid recursion: a few lines later x[i]
needs to be a call to the primitive and not the data frame method.

> The reason I am looking at it is that changing attributes forces duplication
> of the data frame and this is the largest cause of slowness of data.frames in
> general.

Do you have evidence of that?  R has facilities to profile its code, and I 
have never seen  [.data.frame taking a significant proportion of the total 
time.  If it does for your application, consider if a data frame is an 
appropriate way to store your data.  I am not sure we would accept that
data frames do have 'slowness in general', but their generality does make 
them slower than alternatives where the generality is not needed.

[...]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Wed Nov  8 16:34:33 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 08 Nov 2006 07:34:33 -0800
Subject: [Rd] Getting the name of a SEXP type in package code?
In-Reply-To: <Pine.LNX.4.64.0611080658030.25461@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Wed, 8 Nov 2006 07:05:06 +0000 (GMT)")
References: <m24ptbe27p.fsf@ziti.local>
	<17744.51494.488768.338605@stat.math.ethz.ch>
	<Pine.LNX.4.64.0611080658030.25461@gannet.stats.ox.ac.uk>
Message-ID: <m2y7qm54vq.fsf@ziti.local>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> type2char is itself a fairly recent addition (there is also type2str,
> which is older) that I found useful for improving messages in R
> itself.
>
> I have not encountered such a need in package code, but the function
> is exported.
>
> This is not a request to move type2char from Defn.h to Rinternals.h,
> and I don't understand why not: what else is needed?

Because the dog ate that sentance.  Moving type2char to Rinternals.h
is all that is needed -- and type2str would be useful as well.

+ seth


From Robert.McGehee at geodecapital.com  Wed Nov  8 16:40:01 2006
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Wed, 8 Nov 2006 10:40:01 -0500
Subject: [Rd] Chi-squared test (PR#9350)
Message-ID: <67DCA285A2D7754280D3B8E88EB5480211DDA494@MSGBOSCLB2WIN.DMN1.FMR.COM>

Is Sahotra's abuse sending a wishlist item to R-bugs, or is his error
phrasing a suggestion in the form of a question? It seems others have
commented on the inability to specify df for chisq.test (see:
http://tolstoy.newcastle.edu.au/R/help/05/01/10539.html), and adding an
option certainly seems like a reasonable suggestion to me.

And of course, R-FAQ 9.2 does explicitly give a standard for reporting
wishlist or non-bug items to the R-bugs:
"There is a section of the bug repository for suggestions for
enhancements for R labelled `wishlist'. Suggestions can be submitted in
the same ways as bugs, but please ensure that the subject line makes
clear that this is for the wishlist and not a bug report, for example by
starting with `Wishlist:'."

So if your qualm is with how onerous and manual the R bugs tracking
system is, rather than if the sender sent his question/comment to the
wrong list or in the wrong form, then perhaps an upgrade to the R bug
tracker is in order rather than discouraging sending wishlist items to
the bugs archiving system. 

Robert

-----Original Message-----
From: r-devel-bounces at r-project.org
[mailto:r-devel-bounces at r-project.org] On Behalf Of Kasper Daniel Hansen
Sent: Tuesday, November 07, 2006 10:24 PM
To: sarkar at mail.utexas.edu
Cc: R-devel
Subject: Re: [Rd] Chi-squared test (PR#9350)

(not cc'ed to R-bugs)

If this is not a bug why do you abuse the bug report system to ask a  
simple question? Now a member of R-core has to use valuable time to  
handle this bug report, time that could be far more profitable spent  
making improvements to R (or spend it otherwise). This is incredible  
selfish behavior.

Kasper

On Nov 7, 2006, at 5:41 PM, sarkar at mail.utexas.edu wrote:

> Full_Name: Sahotra Sarkar
> Version: 2.2.0
> OS: Windows XP
> Submission from: (NULL) (128.83.34.44)
>
>
> This is not a bug: I'm just wondering why chisq.test does not allow  
> the
> specification of the degree of freedom (df).
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From vdergachev at rcgardis.com  Wed Nov  8 17:13:54 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 8 Nov 2006 11:13:54 -0500
Subject: [Rd] data frame subscription operator
In-Reply-To: <Pine.LNX.4.64.0611070814300.19704@gannet.stats.ox.ac.uk>
References: <200611061950.09315.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611070814300.19704@gannet.stats.ox.ac.uk>
Message-ID: <200611081113.54152.vdergachev@rcgardis.com>

On Wednesday 08 November 2006 3:21 am, Prof Brian Ripley wrote:
>
> > So far I was not able to figure out why this is necessary -
> > could anyone help ?
>
> You need to remove the class to avoid recursion: a few lines later x[i]
> needs to be a call to the primitive and not the data frame method.

I see. Is there a way to get at the primitive directly, i.e. something like
`[.list`(x, i) ?

>
> > The reason I am looking at it is that changing attributes forces
> > duplication of the data frame and this is the largest cause of slowness
> > of data.frames in general.
>
> Do you have evidence of that?  R has facilities to profile its code, and I
> have never seen  [.data.frame taking a significant proportion of the total
> time.  If it does for your application, consider if a data frame is an
> appropriate way to store your data.  I am not sure we would accept that
> data frames do have 'slowness in general', but their generality does make
> them slower than alternatives where the generality is not needed.

Evidence:

	# this can be copy'n'pasted directly into an R session
	# small N - both system calls return small, but comparable running times
	N<-100000
	A<-data.frame(X=1:N, Y=rnorm(N), Z=as.character(rnorm(N)))
	system.time(B<-A[,1])
	system.time(B<-A[1,1])


	#larger N - both times are larger and still comparable
	N<-1000000
	A<-data.frame(X=1:N, Y=rnorm(N), Z=as.character(rnorm(N)))
	system.time(B<-A[,1])
	system.time(B<-A[1,1])
        
The running times would also grow with the number of columns. Also I have 
modified 2.4.0 version of R to print out large allocations and I get the 
impression that the data frame is being duplicated. Same happens for 
`[<-.data.frame` - but this function has much more complex code, I have not 
looked through it yet.

Of course, getting a small portion (i.e. A[1:5,]) also takes a lot of time - 
but the examples showed above should be O(1).

My data is a result of data base query - it has naturally columns of different 
types and the columns are named (no row.names though) - which is why I used 
data.frames. What would you suggest ?

                    thank you very much !

                             Vladimir Dergachev


From Taiwei.Lin at Sun.COM  Wed Nov  8 17:29:29 2006
From: Taiwei.Lin at Sun.COM (Tai-Wei (David) Lin)
Date: Wed, 08 Nov 2006 08:29:29 -0800
Subject: [Rd] Making Solaris 10 x86/x64 build of R available?
Message-ID: <455205E9.2080002@sun.com>

Hi Folks,

I've been working on a 32bit build of R on Solaris 10 x64. What are the
steps for validate a build beyond make check? Once I am ready to
contribute a binary build / HowTo doc, who should I contact?

Thanks,

David


From ggrothendieck at gmail.com  Wed Nov  8 17:41:12 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 8 Nov 2006 11:41:12 -0500
Subject: [Rd] data frame subscription operator
In-Reply-To: <200611081113.54152.vdergachev@rcgardis.com>
References: <200611061950.09315.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611070814300.19704@gannet.stats.ox.ac.uk>
	<200611081113.54152.vdergachev@rcgardis.com>
Message-ID: <971536df0611080841h3350d9at3674bdc6139de4b6@mail.gmail.com>

.subset and .subset2 are equivalent to [ and [[ except that
dispatch does not take place.  See ?.subset


On 11/8/06, Vladimir Dergachev <vdergachev at rcgardis.com> wrote:
> On Wednesday 08 November 2006 3:21 am, Prof Brian Ripley wrote:
> >
> > > So far I was not able to figure out why this is necessary -
> > > could anyone help ?
> >
> > You need to remove the class to avoid recursion: a few lines later x[i]
> > needs to be a call to the primitive and not the data frame method.
>
> I see. Is there a way to get at the primitive directly, i.e. something like
> `[.list`(x, i) ?
>
> >
> > > The reason I am looking at it is that changing attributes forces
> > > duplication of the data frame and this is the largest cause of slowness
> > > of data.frames in general.
> >
> > Do you have evidence of that?  R has facilities to profile its code, and I
> > have never seen  [.data.frame taking a significant proportion of the total
> > time.  If it does for your application, consider if a data frame is an
> > appropriate way to store your data.  I am not sure we would accept that
> > data frames do have 'slowness in general', but their generality does make
> > them slower than alternatives where the generality is not needed.
>
> Evidence:
>
>        # this can be copy'n'pasted directly into an R session
>        # small N - both system calls return small, but comparable running times
>        N<-100000
>        A<-data.frame(X=1:N, Y=rnorm(N), Z=as.character(rnorm(N)))
>        system.time(B<-A[,1])
>        system.time(B<-A[1,1])
>
>
>        #larger N - both times are larger and still comparable
>        N<-1000000
>        A<-data.frame(X=1:N, Y=rnorm(N), Z=as.character(rnorm(N)))
>        system.time(B<-A[,1])
>        system.time(B<-A[1,1])
>
> The running times would also grow with the number of columns. Also I have
> modified 2.4.0 version of R to print out large allocations and I get the
> impression that the data frame is being duplicated. Same happens for
> `[<-.data.frame` - but this function has much more complex code, I have not
> looked through it yet.
>
> Of course, getting a small portion (i.e. A[1:5,]) also takes a lot of time -
> but the examples showed above should be O(1).
>
> My data is a result of data base query - it has naturally columns of different
> types and the columns are named (no row.names though) - which is why I used
> data.frames. What would you suggest ?
>
>                    thank you very much !
>
>                             Vladimir Dergachev
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From luke at stat.uiowa.edu  Wed Nov  8 18:56:12 2006
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 8 Nov 2006 11:56:12 -0600 (CST)
Subject: [Rd] allocVector bug ?
In-Reply-To: <200611061733.21105.vdergachev@rcgardis.com>
References: <200611011720.09139.vdergachev@rcgardis.com>
	<Pine.OSX.4.61.0611022216320.1246@luke-tierneys-computer.local>
	<200611061733.21105.vdergachev@rcgardis.com>
Message-ID: <Pine.LNX.4.64.0611081143470.4243@nokomis.stat.uiowa.edu>

On Mon, 6 Nov 2006, Vladimir Dergachev wrote:

>
> Hi Luke,
>
>   Thank you for the patient reply !
>
>   I have looked into the issue a little deeper, comments below:
>
> On Thursday 02 November 2006 11:26 pm, Luke Tierney wrote:
>> On Wed, 1 Nov 2006, Vladimir Dergachev wrote:
>>> Hi all,
>>>
>>>  I was looking at the following piece of code in src/main/memory.c,
>>> function allocVector :
>>>
>>>    if (size <= NodeClassSize[1]) {
>>> 	node_class = 1;
>>> 	alloc_size = NodeClassSize[1];
>>>    }
>>>    else {
>>> 	node_class = LARGE_NODE_CLASS;
>>> 	alloc_size = size;
>>> 	for (i = 2; i < NUM_SMALL_NODE_CLASSES; i++) {
>>> 	    if (size <= NodeClassSize[i]) {
>>> 		node_class = i;
>>> 		alloc_size = NodeClassSize[i];
>>> 		break;
>>> 	    }
>>> 	}
>>>    }
>>>
>>>
>>> It appears that for LARGE_NODE_CLASS the variable alloc_size should not
>>> be size, but something far less as we are not using vector heap, but
>>> rather calling malloc directly in the code below (and from discussions I
>>> read on this mailing list I think that these two are different - please
>>> let me know if I am wrong).
>>>
>>> So when allocate a large vector the garbage collector goes nuts trying to
>>> find all that space which is not going to be needed after all.
>>
>> This is as intended, not a bug. The garbage collector does not "go
>> nuts" -- it is doing a garbage collection that may release memory in
>> advance of making a large allocation.  The size of the current
>> allocation request is used as part of the process of deciding when to
>> satisfy an allocation by malloc (of a single large noda or a page) and
>> when to first do a gc.  It is essential to do this for large
>> allocations as well to keep the memory footprint down and help reduce
>> fragmentation.
>
> I generally agree with this, however I believe that current logic breaks down
> for large allocation sizes and my code ends up spending 70% (and up) of
> computer time spinning inside garbage collector (I run oprofile to observe
> what is going on).

Again please be careful about these sorts of statements.  I am sure
there are bugs in the memory manager and places where things "break
down" but this isn't one of them.  The memory manager is quite
deliberately biased towards keeping the total allocation low, if
necessary at the expense of some extra gc overhead.  This is needed if
we want to use the same settings across a wide range of
configurations, some of which have relatively little memory available
(think student labs).  The memory manager does try to learn about the
needs of a session, and as a result triggering value get adjusted.  It
is not true that every large allocation causes a gc.  This may be true
_initially_, but once total memory usage stabilizes at a particular
level it is no longer true (look at the way the heap limits are
adjusted).

This approach of adjusting based on usage within a session is
reasonable and works well for longer sessions.  It may not work well
for short scripts that need large allocations.  I doubt that any
automated setting can work well in that situation while at the same
time keeping memory usage in other settings low. So it may be useful
to find ways of specifying a collection strategy appropriate for these
situations. If you can send me a simplified version of your usage
scenario then I will give this some thought and see if we can come up
with some reasonable ways of allowing user code to tweak gc behavior
for these situations.

Best,

luke

>
> I do realize that garbage collection is not an easy problem  and that hardware
> and software environments change - my desire is simply to have a version of R
> that is usable for the problems I am dealing with as, aside from slowdown
> with large vector sizes, I find R a very capable tool.
>
> I would greatly appreciate if you could comment on the following observations:
>
>  1. The time spent during single garbage collector run grows with the number
> of nodes - from looking at the code I believe it is linear, but I am not
> certain.
>
>  2. In my case the data.frame contains a few string vectors. These allocate
> lots of CHARSXPs which are the main cause of slowdown of each garbage
> collector run. Would you have any suggestions on optimizing this particular
> situation ?
>
>  3. Any time a data.frame is created, or one performs an attach() operation
> there is a series of allocations - and if one of them causes memory to expand
> all the rest will too.
>
>  I put in a fprintf() statement to show alloc_size, VHEAP_FREE and RV_size
> when allocVector is called (this is done only for node_class ==
> LARGE_NODE_CLASS).
>
>  First output snippet is from the time the script starts and tries to create
> data.frame:
>
> alloc_size=128 VHEAP_FREE=604182 R_VSize=786432
> alloc_size=88 VHEAP_FREE=660051 R_VSize=786432
> alloc_size=88 VHEAP_FREE=659963 R_VSize=786432
> alloc_size=4078820 VHEAP_FREE=659874 R_VSize=786432
> alloc_size=4078820 VHEAP_FREE=260678 R_VSize=4465461
> alloc_size=4078820 VHEAP_FREE=260678 R_VSize=8544282
> alloc_size=4078820 VHEAP_FREE=260678 R_VSize=12623103
> ...
> alloc_size=4078820 VHEAP_FREE=260677 R_VSize=271628325
> alloc_size=4078820 VHEAP_FREE=260677 R_VSize=275707147
>
> As you can see the VHEAP_FREE()<alloc_size logic gets triggered every single
> time and we run the garbage collector even though the memory footprint is
> clearly growing. The fact that in my case the first few columns are strings
> with lots of different values makes this particularly bad.
>
> Next, (as a test) I run attach(B) which produced the following output:
>> attach(B)
> alloc_size=4078820 VHEAP_FREE=1274112 R_VSize=294022636
> alloc_size=4078820 VHEAP_FREE=499351 R_VSize=297325768
> ...
> alloc_size=4078820 VHEAP_FREE=602082 R_VSize=568670030
> alloc_size=4078820 VHEAP_FREE=602082 R_VSize=572748850
> alloc_size=4078820 VHEAP_FREE=602082 R_VSize=576827670
> alloc_size=88 VHEAP_FREE=602082 R_VSize=580906490
> alloc_size=88 VHEAP_FREE=601915 R_VSize=580906490
> alloc_size=88 VHEAP_FREE=601798 R_VSize=580906490
> alloc_size=88 VHEAP_FREE=601678 R_VSize=580906490
> ...
> alloc_size=44 VHEAP_FREE=591581 R_VSize=580906490
> alloc_size=88 VHEAP_FREE=591323 R_VSize=580906490
> alloc_size=44 VHEAP_FREE=591220 R_VSize=580906490
>
> So we have the same behaviour as before - the garbage collector gets run every
> time attach creates a new large vector, but functions perfectly for smaller
> vector sizes.
>
> Next, I did detach(B) (which freed up memory) followed by "F<-B[,1]":
>
> alloc_size=113 VHEAP_FREE=588448 R_VSize=580906490
> alloc_size=618 VHEAP_FREE=588335 R_VSize=580906490
> alloc_size=618 VHEAP_FREE=587717 R_VSize=580906490
> alloc_size=128 VHEAP_FREE=587099 R_VSize=580906490
> alloc_size=88 VHEAP_FREE=586825 R_VSize=580906490
> alloc_size=4078820 VHEAP_FREE=586737 R_VSize=580906490
> alloc_size=4078820 VHEAP_FREE=284079854 R_VSize=580906490
> alloc_size=4078820 VHEAP_FREE=280001034 R_VSize=580906490
> alloc_size=4078820 VHEAP_FREE=275922214 R_VSize=580906490
> alloc_size=4078820 VHEAP_FREE=271843394 R_VSize=580906490
> ...
> alloc_size=4078820 VHEAP_FREE=602082 R_VSize=843990775
> alloc_size=4078820 VHEAP_FREE=602082 R_VSize=848069595
> alloc_size=4078820 VHEAP_FREE=602082 R_VSize=852148415
> alloc_size=4078820 VHEAP_FREE=602082 R_VSize=856227235
> alloc_size=88 VHEAP_FREE=602082 R_VSize=860306055
>
> In this case the logic worked - it freed memory used up by attach() but
> stopped working after that memory was consumed. (Why subscription operator
> tries to allocate an entire copy of the data.frame is a completely separate
> question - I am looking into it, but with slow progress).
>
> My latest attempt to address this is the following modification to
> allocVector:
>
>
> R_size_t vheap_grown=0;
> R_size_t vheap_reused=0;
> int count_skip=0;
> int max_skip=0;
>
> SEXP allocVector(SEXPTYPE type, R_len_t length)
> {
> ...
> ...
>    /* we need to do the gc here so allocSExp doesn't! */
>    if (FORCE_GC || NO_FREE_NODES() || ((VHEAP_FREE() < alloc_size) && !
> count_skip)) {
> 	fprintf(stderr, "Running gc\n");
> 	R_gc_internal(alloc_size);
> 	if (NO_FREE_NODES())
> 	    mem_err_cons();
> 	if (VHEAP_FREE() < alloc_size)
> 	    mem_err_heap(size);
>
> 	/* we use 2*alloc_size as if we run out of memory the
>          gc will grow R_VSize to alloc for alloc_size allocation */
>        if(VHEAP_FREE() < 2*alloc_size) {
> 	    vheap_grown+=alloc_size;
> 	    if(vheap_grown>vheap_reused) {
> 		max_skip=2*max_skip+1;
> 		count_skip=max_skip;
> 		}
> 	    } else {
> 	    vheap_reused+=alloc_size;
> 	    if(vheap_reused>2*vheap_grown) {
> 		   vheap_reused=0;
> 		   vheap_grown=0;
> 		   max_skip=0;
> 		   }
> 	    }
>    }
>
>    /* Adjust R_VSize if we skipped garbage collection */
>    if( (VHEAP_FREE() < alloc_size) && count_skip) {
> 	 R_VSize+=alloc_size;
> 	 count_skip --;
> 	 }
> ...
> ...
> }
>
> This code attempts to detect situations when we are growing memory footprint
> and skip garbage collection before making a check again.
>
>                              thank you very much !
>
>                                            Vladimir Dergachev
>
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ripley at stats.ox.ac.uk  Wed Nov  8 19:00:45 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 8 Nov 2006 18:00:45 +0000 (GMT)
Subject: [Rd] Making Solaris 10 x86/x64 build of R available?
In-Reply-To: <455205E9.2080002@sun.com>
References: <455205E9.2080002@sun.com>
Message-ID: <Pine.LNX.4.64.0611081751300.3519@gannet.stats.ox.ac.uk>

On Wed, 8 Nov 2006, Tai-Wei (David) Lin wrote:

> Hi Folks,
>
> I've been working on a 32bit build of R on Solaris 10 x64. What are the
> steps for validate a build beyond make check?

make check-all is a more comprehensive test, including of the recommended 
packages.

> Once I am ready to contribute a binary build / HowTo doc, who should I 
> contact?

I doubt if there is a demand for a binary build: AFAIK all Solaris users 
of R have the tools to build from the sources.

We do have a HowTo, the R-admin manual.  If you tell us what you did in 
the format of the entries there for specific OSes, we will incorporate the 
information.  (It is pretty much essential to know exactly which compilers 
etc you used.) Several other people have built R on Solaris 10 on x86_64 
(which is I presume what you mean) using the current R-admin instructions, 
so please tell us about small changes that might be required on your 
system (and why).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From arnima at u.washington.edu  Wed Nov  8 21:14:31 2006
From: arnima at u.washington.edu (arnima at u.washington.edu)
Date: Wed,  8 Nov 2006 21:14:31 +0100 (CET)
Subject: [Rd] boxplot ignores 'boxfill' (PR#9352)
Message-ID: <20061108201431.0ADA956225@slim.kubism.ku.dk>

The boxplot.default() function ignores argument 'boxfill' passed by user:

     x <- rnorm(100)
     boxplot(x, boxfill="blue")
     boxplot(x, pars=list(boxfill="green"))

As the original creator of the 'boxfill' argument, I'd like to propose the 
following change to the if(plot) clause in boxplot.R:

     if(plot) {
         if(is.null(pars$boxfill) && is.null(args$boxfill))
             pars$boxfill <- col
         do.call("bxp",
             c(list(z, notch=notch, width=width, varwidth=varwidth,
             outline=outline, log=log, border=border, pars=pars,
             horizontal=horizontal, add=add, at=at), args[namedargs]))
         invisible(z)
     }


What I've done is (1) setting boxfill=col only when that is desired, (2) 
named the 'width' list element to avoid confusion, and (3) rearranged the 
list so it has the same order as args(bxp).

Thanks,
Arni

R 2.4.0-patched on WinXP


From vdergachev at rcgardis.com  Wed Nov  8 22:33:17 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 8 Nov 2006 16:33:17 -0500
Subject: [Rd] allocVector bug ?
In-Reply-To: <Pine.LNX.4.64.0611081143470.4243@nokomis.stat.uiowa.edu>
References: <200611011720.09139.vdergachev@rcgardis.com>
	<200611061733.21105.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611081143470.4243@nokomis.stat.uiowa.edu>
Message-ID: <200611081633.17740.vdergachev@rcgardis.com>

On Wednesday 08 November 2006 12:56 pm, Luke Tierney wrote:
> On Mon, 6 Nov 2006, Vladimir Dergachev wrote:
> > Hi Luke,
> >
> >
> > I generally agree with this, however I believe that current logic breaks
> > down for large allocation sizes and my code ends up spending 70% (and up)
> > of computer time spinning inside garbage collector (I run oprofile to
> > observe what is going on).
>
> Again please be careful about these sorts of statements.  I am sure
> there are bugs in the memory manager and places where things "break
> down" but this isn't one of them.  The memory manager is quite
> deliberately biased towards keeping the total allocation low, if
> necessary at the expense of some extra gc overhead.  This is needed if
> we want to use the same settings across a wide range of
> configurations, some of which have relatively little memory available
> (think student labs).  The memory manager does try to learn about the
> needs of a session, and as a result triggering value get adjusted.  It
> is not true that every large allocation causes a gc.  This may be true
> _initially_, but once total memory usage stabilizes at a particular
> level it is no longer true (look at the way the heap limits are
> adjusted).
>
> This approach of adjusting based on usage within a session is
> reasonable and works well for longer sessions.  It may not work well
> for short scripts that need large allocations.  I doubt that any
> automated setting can work well in that situation while at the same
> time keeping memory usage in other settings low. So it may be useful
> to find ways of specifying a collection strategy appropriate for these
> situations. If you can send me a simplified version of your usage
> scenario then I will give this some thought and see if we can come up
> with some reasonable ways of allowing user code to tweak gc behavior
> for these situations.
>

Hi Luke, 
   
   Yes, I gladly concede the point that for a heuristic algorithm the notion 
of what is a "bug" is murky (besides crashes, etc, which is not what I am not 
talking about).

   Here is why I called this a bug:

     1. My understanding is that each time gc() needs to increase memory it 
performs a full garbage collection run. Right ?

     2. This is not a problem with small memory sizes as they imply 
(presumably) small number of objects.

     3. However, if one wants to allocate many objects (say columns in a data 
frame or just vectors) this results in large penalty

Example 1: This simulates allocation of a data.frame with some character 
columns which are assumed to be factors. On my system first assignment is 
nearly instantaneous, why subsequent assignments take slightly less than 0.1 
seconds each.

L<-list()
Chars<-as.character(1:100000)
for(i in 1:100)L[[i]]<-system.time(assign(paste("test", i), 1:1000000))
Times<-do.call(rbind, L)

Example 2: Same as example 1 but we first grow the memory with fake 
allocation:

L<-list()
Chars<-as.character(1:100000)
Data<-1:100000000
rm(Data)
for(i in 1:100)L[[i]]<-system.time(assign(paste("test", i), 1:1000000))
Times<-do.call(rbind, L)

In this case the first 20 or so allocations are very quck (faster than 0.02 
sec) and then garbage collector kicks in and the time rises to 0.08 seconds 
each - still less than in Example 1.

This example is relevant because this sequence of allocations is exactly what 
happens when one uses read.table or scan (or database query) to load data.

What is more, if the user then manipulates the loaded data by creating columns 
that are a combination of existing ones then this is very slow as well.

I looked more carefully at your code in src/main/memory.c, function 
AdjustHeapSize:

R_VSize = VNeeded;
    if (vect_occup > R_VGrowFrac) {
	R_size_t change = R_VGrowIncrMin + R_VGrowIncrFrac * R_NSize;
	if (R_MaxVSize - R_VSize >= change)
	    R_VSize += change;
    }

Could it be that R_NSize should be R_VSize ? This would explain why I see a 
problem in case R_VSize>>R_NSize.

                            thank you very much !

                                     Vladimir Dergachev


From vdergachev at rcgardis.com  Wed Nov  8 23:36:44 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 8 Nov 2006 17:36:44 -0500
Subject: [Rd] data frame subscription operator
In-Reply-To: <971536df0611080841h3350d9at3674bdc6139de4b6@mail.gmail.com>
References: <200611061950.09315.vdergachev@rcgardis.com>
	<200611081113.54152.vdergachev@rcgardis.com>
	<971536df0611080841h3350d9at3674bdc6139de4b6@mail.gmail.com>
Message-ID: <200611081736.45082.vdergachev@rcgardis.com>

On Wednesday 08 November 2006 11:41 am, Gabor Grothendieck wrote:
> .subset and .subset2 are equivalent to [ and [[ except that
> dispatch does not take place.  See ?.subset
>


Thank you Gabor !

I made an experiment and got rid of 

 class(x) <- attr(x, "row.names") <- NULL

 while replacing all occurrences of x[ and x[[ with .subset and .subset2 . 

 Results:

    X<-A[,1]  is now instantaneous, as it should be.

    X<-A[1,1] is faster for data frames with many columns, but still appears 
to make a copy of A[,1] before indexing. Not sure why..

                 thank you

                    Vladimir Dergachev


From khansen at stat.Berkeley.EDU  Thu Nov  9 06:44:42 2006
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Wed, 8 Nov 2006 21:44:42 -0800
Subject: [Rd] Chi-squared test (PR#9350)
In-Reply-To: <67DCA285A2D7754280D3B8E88EB5480211DDA494@MSGBOSCLB2WIN.DMN1.FMR.COM>
References: <67DCA285A2D7754280D3B8E88EB5480211DDA494@MSGBOSCLB2WIN.DMN1.FMR.COM>
Message-ID: <E7C1802D-61E2-4232-9B01-76F5019B1B66@stat.Berkeley.EDU>

Upon further reflection on my part I have realized that my original  
email was way too harsh - even for the sometimes harsh tone on R-devel.

Having spent a few more minutes reflecting on the original question  
and reading the old thread Robert linked to, it seems that there is  
indeed some questions about the non-existence of a df argument.

I guess it can be interesting in the case where you are comparing to  
an estimated probability vector and you want to take that estimation  
into account (which does not seem straightforward, see Peter  
Dalgaard's old email). In that case a user might be interested in  
explicitly passing along a df argument.

On the other hand, there are several circumstances where I would say  
a df is unnecessary. One case is when the p value is computed by  
simulation and another is the case where the argument is a matrix and  
the function tests for independence (at least it would be highly non- 
standard to have any other degrees of freedom that the usual one).

Since the function returns the statistic it is very easy to directly  
compute the df by
   statistic = chisq.test( ... )$statistic
   p.value = 1 - pchisq(statistic, df = df)
(or p.value = pchisq(statistic, df = df, lower.tail = FALSE) ).

Altogether I would personally be slightly inclined to say it is  
better not to provide a df argument - I would think that the  
possibility of misuse is to high.

Kasper



On Nov 8, 2006, at 7:40 AM, McGehee, Robert wrote:

> Is Sahotra's abuse sending a wishlist item to R-bugs, or is his error
> phrasing a suggestion in the form of a question? It seems others have
> commented on the inability to specify df for chisq.test (see:
> http://tolstoy.newcastle.edu.au/R/help/05/01/10539.html), and  
> adding an
> option certainly seems like a reasonable suggestion to me.
>
> And of course, R-FAQ 9.2 does explicitly give a standard for reporting
> wishlist or non-bug items to the R-bugs:
> "There is a section of the bug repository for suggestions for
> enhancements for R labelled `wishlist'. Suggestions can be  
> submitted in
> the same ways as bugs, but please ensure that the subject line makes
> clear that this is for the wishlist and not a bug report, for  
> example by
> starting with `Wishlist:'."
>
> So if your qualm is with how onerous and manual the R bugs tracking
> system is, rather than if the sender sent his question/comment to the
> wrong list or in the wrong form, then perhaps an upgrade to the R bug
> tracker is in order rather than discouraging sending wishlist items to
> the bugs archiving system.
>
> Robert
>
> -----Original Message-----
> From: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Kasper Daniel  
> Hansen
> Sent: Tuesday, November 07, 2006 10:24 PM
> To: sarkar at mail.utexas.edu
> Cc: R-devel
> Subject: Re: [Rd] Chi-squared test (PR#9350)
>
> (not cc'ed to R-bugs)
>
> If this is not a bug why do you abuse the bug report system to ask a
> simple question? Now a member of R-core has to use valuable time to
> handle this bug report, time that could be far more profitable spent
> making improvements to R (or spend it otherwise). This is incredible
> selfish behavior.
>
> Kasper
>
> On Nov 7, 2006, at 5:41 PM, sarkar at mail.utexas.edu wrote:
>
>> Full_Name: Sahotra Sarkar
>> Version: 2.2.0
>> OS: Windows XP
>> Submission from: (NULL) (128.83.34.44)
>>
>>
>> This is not a bug: I'm just wondering why chisq.test does not allow
>> the
>> specification of the degree of freedom (df).
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From khansen at stat.Berkeley.EDU  Thu Nov  9 06:53:48 2006
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Wed, 8 Nov 2006 21:53:48 -0800
Subject: [Rd] Chi-squared test (PR#9350)
In-Reply-To: <E7C1802D-61E2-4232-9B01-76F5019B1B66@stat.Berkeley.EDU>
References: <67DCA285A2D7754280D3B8E88EB5480211DDA494@MSGBOSCLB2WIN.DMN1.FMR.COM>
	<E7C1802D-61E2-4232-9B01-76F5019B1B66@stat.Berkeley.EDU>
Message-ID: <46464601-2C16-4CE0-9B61-82863AB888B4@stat.berkeley.edu>


On Nov 8, 2006, at 9:44 PM, Kasper Daniel Hansen wrote:

> Upon further reflection on my part I have realized that my original
> email was way too harsh - even for the sometimes harsh tone on R- 
> devel.
>
> Having spent a few more minutes reflecting on the original question
> and reading the old thread Robert linked to, it seems that there is
> indeed some questions about the non-existence of a df argument.
>
> I guess it can be interesting in the case where you are comparing to
> an estimated probability vector and you want to take that estimation
> into account (which does not seem straightforward, see Peter
> Dalgaard's old email). In that case a user might be interested in
> explicitly passing along a df argument.
>
> On the other hand, there are several circumstances where I would say
> a df is unnecessary. One case is when the p value is computed by
> simulation and another is the case where the argument is a matrix and
> the function tests for independence (at least it would be highly non-
> standard to have any other degrees of freedom that the usual one).
>
> Since the function returns the statistic it is very easy to directly
> compute the df by
>    statistic = chisq.test( ... )$statistic
>    p.value = 1 - pchisq(statistic, df = df)
> (or p.value = pchisq(statistic, df = df, lower.tail = FALSE) ).

Ok, I am writing pretty bad here, this paragraph should fo course read

Since the function returns the statistic it is very easy to directly
compute the p-value for a given degrees of freedom by
    statistic = chisq.test( ... )$statistic
    p.value = 1 - pchisq(statistic, df = df)
(or p.value = pchisq(statistic, df = df, lower.tail = FALSE) ).


> Altogether I would personally be slightly inclined to say it is
> better not to provide a df argument - I would think that the
> possibility of misuse is to high.
>
> Kasper
>
>
>
> On Nov 8, 2006, at 7:40 AM, McGehee, Robert wrote:
>
>> Is Sahotra's abuse sending a wishlist item to R-bugs, or is his error
>> phrasing a suggestion in the form of a question? It seems others have
>> commented on the inability to specify df for chisq.test (see:
>> http://tolstoy.newcastle.edu.au/R/help/05/01/10539.html), and
>> adding an
>> option certainly seems like a reasonable suggestion to me.
>>
>> And of course, R-FAQ 9.2 does explicitly give a standard for  
>> reporting
>> wishlist or non-bug items to the R-bugs:
>> "There is a section of the bug repository for suggestions for
>> enhancements for R labelled `wishlist'. Suggestions can be
>> submitted in
>> the same ways as bugs, but please ensure that the subject line makes
>> clear that this is for the wishlist and not a bug report, for
>> example by
>> starting with `Wishlist:'."
>>
>> So if your qualm is with how onerous and manual the R bugs tracking
>> system is, rather than if the sender sent his question/comment to the
>> wrong list or in the wrong form, then perhaps an upgrade to the R bug
>> tracker is in order rather than discouraging sending wishlist  
>> items to
>> the bugs archiving system.
>>
>> Robert
>>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Kasper Daniel
>> Hansen
>> Sent: Tuesday, November 07, 2006 10:24 PM
>> To: sarkar at mail.utexas.edu
>> Cc: R-devel
>> Subject: Re: [Rd] Chi-squared test (PR#9350)
>>
>> (not cc'ed to R-bugs)
>>
>> If this is not a bug why do you abuse the bug report system to ask a
>> simple question? Now a member of R-core has to use valuable time to
>> handle this bug report, time that could be far more profitable spent
>> making improvements to R (or spend it otherwise). This is incredible
>> selfish behavior.
>>
>> Kasper
>>
>> On Nov 7, 2006, at 5:41 PM, sarkar at mail.utexas.edu wrote:
>>
>>> Full_Name: Sahotra Sarkar
>>> Version: 2.2.0
>>> OS: Windows XP
>>> Submission from: (NULL) (128.83.34.44)
>>>
>>>
>>> This is not a bug: I'm just wondering why chisq.test does not allow
>>> the
>>> specification of the degree of freedom (df).
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From rfrancois at mango-solutions.com  Thu Nov  9 09:53:51 2006
From: rfrancois at mango-solutions.com (Romain Francois)
Date: Thu, 09 Nov 2006 08:53:51 +0000
Subject: [Rd] generic sample
Message-ID: <4552EC9F.1000500@mango-solutions.com>

Hi,

When x is a data frame, sample(x) is not really sensible :

R> sample(iris) # sends back all the iris data set.

What about a generic sample function (from R-devel/src/library/base/R) 
with a method for class `data.frame` that would sample the row indexes 
and then do the subset. See the code below.


Cheers,


Romain


sample <- function(x, ...)
  UseMethod("sample")
 
sample.data.frame <- function(x, ...){
  x[ sample(1:nrow(x), ...), ]     
}


sample.default <- function(x, size, replace=FALSE, prob=NULL)
{
    if(length(x) == 1 && x >= 1) {
    if(missing(size)) size <- x
    .Internal(sample(x, size, replace, prob))
    }
    else {
    if(missing(size)) size <- length(x)
    x[.Internal(sample(length(x), size, replace, prob))]
    }
}


R> set.seed(4)
R> sample(iris, 5)
    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
88           6.3         2.3          4.4         1.3 versicolor
2            4.9         3.0          1.4         0.2     setosa
44           5.0         3.5          1.6         0.6     setosa
41           5.0         3.5          1.3         0.3     setosa
119          7.7         2.6          6.9         2.3  virginica



-- 
*mangosolutions*
/data analysis that delivers/

Tel   +44 1249 467 467
Fax   +44 1249 467 468


From tom.mccallum at levelelimited.com  Thu Nov  9 16:28:46 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Thu, 09 Nov 2006 15:28:46 -0000
Subject: [Rd] Retrieving function name
Message-ID: <op.tiq898r6ffxks9@norisk>

Hi,

Does anyone know how I can retrieve a function name, for example

If I have a function f as follows:

f <- function( myfunc ) {
	print( name_of(myfunc) );
}

I want to know what I should have as "name_of" such that I could call this  
with :
	f( median )
and it would print "median"

or f( my_function_name ) and it would print "m_function_name".

So far all I can get is the function definition that myfunc points to.

I thought the structure command might do it but this also just gives back  
the function definition and not the original name.

Any suggestions?

Tom

-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The contents of  
this e-mail are privileged and/or confidential. If you are not the  
intended recipient, please
notify the sender and ensure this e-mail is deleted and not read, copied  
or disclosed. It is your responsibility to scan this e-mail and any  
attachments for
computer viruses or other defects. Level E does not accept liability for  
any loss or damage which may result from this e-mail or any attachment.  
E-mail is not secure
and can be intercepted, corrupted or amended. Level E does not accept  
liability for errors or omissions arising as a result of interrupted or  
defective transmission.
Any views, opinions, conclusions or other information in this e-mail which  
do not relate to the business of Level E Limited are not authorised by  
Level E. Unless
specifically stated and authorised by Level E, nothing in this e-mail  
shall be taken to be an offer or acceptance of any contract of any nature.  
E-mail entering or leaving Level E's system is subject to random  
monitoring and recording.


From dimitris.rizopoulos at med.kuleuven.be  Thu Nov  9 16:36:52 2006
From: dimitris.rizopoulos at med.kuleuven.be (Dimitris Rizopoulos)
Date: Thu, 9 Nov 2006 16:36:52 +0100
Subject: [Rd] Retrieving function name
References: <op.tiq898r6ffxks9@norisk>
Message-ID: <00c901c70414$e0dbd9b0$0540210a@www.domain>

probably you're looking for:

f <- function(FUN, x){
    list(funName = deparse(substitute(FUN)), value = FUN(x))
}

f(mean, rnorm(10))
f(median, rnorm(10))


I hope it helps.

Best,
Dimitris

----
Dimitris Rizopoulos
Ph.D. Student
Biostatistical Centre
School of Public Health
Catholic University of Leuven

Address: Kapucijnenvoer 35, Leuven, Belgium
Tel: +32/(0)16/336899
Fax: +32/(0)16/337015
Web: http://med.kuleuven.be/biostat/
     http://www.student.kuleuven.be/~m0390867/dimitris.htm


----- Original Message ----- 
From: "Tom McCallum" <tom.mccallum at levelelimited.com>
To: <r-devel at r-project.org>
Sent: Thursday, November 09, 2006 4:28 PM
Subject: [Rd] Retrieving function name


> Hi,
>
> Does anyone know how I can retrieve a function name, for example
>
> If I have a function f as follows:
>
> f <- function( myfunc ) {
> print( name_of(myfunc) );
> }
>
> I want to know what I should have as "name_of" such that I could 
> call this
> with :
> f( median )
> and it would print "median"
>
> or f( my_function_name ) and it would print "m_function_name".
>
> So far all I can get is the function definition that myfunc points 
> to.
>
> I thought the structure command might do it but this also just gives 
> back
> the function definition and not the original name.
>
> Any suggestions?
>
> Tom
>
> -- 
> Dr. Thomas McCallum
> Systems Architect,
> Level E Limited
> ETTC, The King's Buildings
> Mayfield Road,
> Edinburgh EH9 3JL, UK
> Work  +44 (0) 131 472 4813
> Fax:  +44 (0) 131 472 4719
> http://www.levelelimited.com
> Email: tom at levelelimited.com
>
> Level E is a limited company incorporated in Scotland. The contents 
> of
> this e-mail are privileged and/or confidential. If you are not the
> intended recipient, please
> notify the sender and ensure this e-mail is deleted and not read, 
> copied
> or disclosed. It is your responsibility to scan this e-mail and any
> attachments for
> computer viruses or other defects. Level E does not accept liability 
> for
> any loss or damage which may result from this e-mail or any 
> attachment.
> E-mail is not secure
> and can be intercepted, corrupted or amended. Level E does not 
> accept
> liability for errors or omissions arising as a result of interrupted 
> or
> defective transmission.
> Any views, opinions, conclusions or other information in this e-mail 
> which
> do not relate to the business of Level E Limited are not authorised 
> by
> Level E. Unless
> specifically stated and authorised by Level E, nothing in this 
> e-mail
> shall be taken to be an offer or acceptance of any contract of any 
> nature.
> E-mail entering or leaving Level E's system is subject to random
> monitoring and recording.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


Disclaimer: http://www.kuleuven.be/cwis/email_disclaimer.htm


From p.dalgaard at biostat.ku.dk  Thu Nov  9 16:52:26 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 09 Nov 2006 16:52:26 +0100
Subject: [Rd] Retrieving function name
In-Reply-To: <op.tiq898r6ffxks9@norisk>
References: <op.tiq898r6ffxks9@norisk>
Message-ID: <x2ejscmxc5.fsf@viggo.kubism.ku.dk>

"Tom McCallum" <tom.mccallum at levelelimited.com> writes:

> Hi,
> 
> Does anyone know how I can retrieve a function name, for example
> 
> If I have a function f as follows:
> 
> f <- function( myfunc ) {
> 	print( name_of(myfunc) );
> }
> 
> I want to know what I should have as "name_of" such that I could call this  
> with :
> 	f( median )
> and it would print "median"
> 
> or f( my_function_name ) and it would print "m_function_name".
> 
> So far all I can get is the function definition that myfunc points to.
> 
> I thought the structure command might do it but this also just gives back  
> the function definition and not the original name.
> 
> Any suggestions?

Depending on what you really want, this is either impossible or
trivial. The trivial version is 

f <- function(x) print(deparse(substitute(x)))

and the impossible one is to get something that prints "mean" if you
do something like

x<-1
f(switch(x, 1 = mean, 2 = median, 3 = sd, 4 = IQR))

or 

g <- function(foo) f(foo)
g(mean)

or indeed does anything sensible with

f(function(x,y) x*y)


Thing is, functions do not "have names", they can be anonymous or
assigned to multiple names, or be passed as arguments.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From luke at stat.uiowa.edu  Thu Nov  9 18:21:09 2006
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Thu, 9 Nov 2006 11:21:09 -0600 (CST)
Subject: [Rd] allocVector bug ?
In-Reply-To: <200611081633.17740.vdergachev@rcgardis.com>
References: <200611011720.09139.vdergachev@rcgardis.com>
	<200611061733.21105.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611081143470.4243@nokomis.stat.uiowa.edu>
	<200611081633.17740.vdergachev@rcgardis.com>
Message-ID: <Pine.LNX.4.64.0611091029430.22148@nokomis.stat.uiowa.edu>

On Wed, 8 Nov 2006, Vladimir Dergachev wrote:

> On Wednesday 08 November 2006 12:56 pm, Luke Tierney wrote:
>> On Mon, 6 Nov 2006, Vladimir Dergachev wrote:
>>> Hi Luke,
>>>
>>>
>>> I generally agree with this, however I believe that current logic breaks
>>> down for large allocation sizes and my code ends up spending 70% (and up)
>>> of computer time spinning inside garbage collector (I run oprofile to
>>> observe what is going on).
>>
>> Again please be careful about these sorts of statements.  I am sure
>> there are bugs in the memory manager and places where things "break
>> down" but this isn't one of them.  The memory manager is quite
>> deliberately biased towards keeping the total allocation low, if
>> necessary at the expense of some extra gc overhead.  This is needed if
>> we want to use the same settings across a wide range of
>> configurations, some of which have relatively little memory available
>> (think student labs).  The memory manager does try to learn about the
>> needs of a session, and as a result triggering value get adjusted.  It
>> is not true that every large allocation causes a gc.  This may be true
>> _initially_, but once total memory usage stabilizes at a particular
>> level it is no longer true (look at the way the heap limits are
>> adjusted).
>>
>> This approach of adjusting based on usage within a session is
>> reasonable and works well for longer sessions.  It may not work well
>> for short scripts that need large allocations.  I doubt that any
>> automated setting can work well in that situation while at the same
>> time keeping memory usage in other settings low. So it may be useful
>> to find ways of specifying a collection strategy appropriate for these
>> situations. If you can send me a simplified version of your usage
>> scenario then I will give this some thought and see if we can come up
>> with some reasonable ways of allowing user code to tweak gc behavior
>> for these situations.
>>
>
> Hi Luke,
>
>   Yes, I gladly concede the point that for a heuristic algorithm the notion
> of what is a "bug" is murky (besides crashes, etc, which is not what I am not
> talking about).
>
>   Here is why I called this a bug:
>
>     1. My understanding is that each time gc() needs to increase memory it
> performs a full garbage collection run. Right ?

The allocation process does not call gc before every call to malloc.
It only calls gc if the allocation would cross a threshold level.
Those theshold levels are adjusted in an effort to compromise between
keeping memory footprint low and not calling gc too often.  The code
you quote below is part of this adjustment process.  If this process
is working properly then as memory use grows there will initially be
more gc activity and then less as the thresholds adjust.

The command line arguments mentioned in ?Memory can be used to
influence some of this behavior.  Calling gcinfo(TRUE) will show you
when the internally triggered collections occur, and which level of
collection occurs.

>
>     2. This is not a problem with small memory sizes as they imply
> (presumably) small number of objects.
>
>     3. However, if one wants to allocate many objects (say columns in a data
> frame or just vectors) this results in large penalty
>
> Example 1: This simulates allocation of a data.frame with some character
> columns which are assumed to be factors. On my system first assignment is
> nearly instantaneous, why subsequent assignments take slightly less than 0.1
> seconds each.

I'm not sure these are quite doing what you intend.  You define Chars
but don't use it.  Also, system.time by default calls gc() before
doing the evaluation. Giving FALSE as the second argument may give you
a more realistic picture.

>
> L<-list()
> Chars<-as.character(1:100000)
> for(i in 1:100)L[[i]]<-system.time(assign(paste("test", i), 1:1000000))
> Times<-do.call(rbind, L)
>
> Example 2: Same as example 1 but we first grow the memory with fake
> allocation:
>
> L<-list()
> Chars<-as.character(1:100000)
> Data<-1:100000000
> rm(Data)
> for(i in 1:100)L[[i]]<-system.time(assign(paste("test", i), 1:1000000))
> Times<-do.call(rbind, L)
>
> In this case the first 20 or so allocations are very quck (faster than 0.02
> sec) and then garbage collector kicks in and the time rises to 0.08 seconds
> each - still less than in Example 1.
>
> This example is relevant because this sequence of allocations is exactly what
> happens when one uses read.table or scan (or database query) to load data.
>
> What is more, if the user then manipulates the loaded data by creating columns
> that are a combination of existing ones then this is very slow as well.
>
> I looked more carefully at your code in src/main/memory.c, function
> AdjustHeapSize:
>
> R_VSize = VNeeded;
>    if (vect_occup > R_VGrowFrac) {
> 	R_size_t change = R_VGrowIncrMin + R_VGrowIncrFrac * R_NSize;
> 	if (R_MaxVSize - R_VSize >= change)
> 	    R_VSize += change;
>    }
>
> Could it be that R_NSize should be R_VSize ? This would explain why I see a
> problem in case R_VSize>>R_NSize.

That does indeed look like a bug and that R_NSize should be R_VSize --
well spotted, thanks.  I will need to experiment with this a bit more
to see if it can safely be changed.  It will increase the memory
footprint a bit.  Probaly not by enough to matter but if it does we
may need to adjust some of the tuning constants.

Best,

luke

>                            thank you very much !
>
>                                     Vladimir Dergachev
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From vdergachev at rcgardis.com  Thu Nov  9 19:46:56 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Thu, 9 Nov 2006 13:46:56 -0500
Subject: [Rd] allocVector bug ?
In-Reply-To: <Pine.LNX.4.64.0611091029430.22148@nokomis.stat.uiowa.edu>
References: <200611011720.09139.vdergachev@rcgardis.com>
	<200611081633.17740.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611091029430.22148@nokomis.stat.uiowa.edu>
Message-ID: <200611091346.56977.vdergachev@rcgardis.com>

On Thursday 09 November 2006 12:21 pm, Luke Tierney wrote:
> On Wed, 8 Nov 2006, Vladimir Dergachev wrote:
> > On Wednesday 08 November 2006 12:56 pm, Luke Tierney wrote:
> >> On Mon, 6 Nov 2006, Vladimir Dergachev wrote:
> >
> > Hi Luke,
> >
> >   Yes, I gladly concede the point that for a heuristic algorithm the
> > notion of what is a "bug" is murky (besides crashes, etc, which is not
> > what I am not talking about).
> >
> >   Here is why I called this a bug:
> >
> >     1. My understanding is that each time gc() needs to increase memory
> > it performs a full garbage collection run. Right ?
>
> The allocation process does not call gc before every call to malloc.
> It only calls gc if the allocation would cross a threshold level.
> Those theshold levels are adjusted in an effort to compromise between
> keeping memory footprint low and not calling gc too often.  The code
> you quote below is part of this adjustment process.  If this process
> is working properly then as memory use grows there will initially be
> more gc activity and then less as the thresholds adjust.

Well, I was seeing it call gc for every large vector. This probably happens be 
only for those larger  than R_VGrowIncrFrac * R_NSize. On my system R_NSize 
is never more than 1e6 so this would explain the problems when using 1e6 (and 
larger) vectors.

>
> >     2. This is not a problem with small memory sizes as they imply
> > (presumably) small number of objects.
> >
> >     3. However, if one wants to allocate many objects (say columns in a
> > data frame or just vectors) this results in large penalty
> >
> > Example 1: This simulates allocation of a data.frame with some character
> > columns which are assumed to be factors. On my system first assignment is
> > nearly instantaneous, why subsequent assignments take slightly less than
> > 0.1 seconds each.
>
> I'm not sure these are quite doing what you intend.  You define Chars
> but don't use it.  Also, system.time by default calls gc() before
> doing the evaluation. Giving FALSE as the second argument may give you
> a more realistic picture.

The Chars are defined to create lots of ncells and make gc() run time more 
realistic. It also mimics having a data.frame with a few factor columns.

As for system.time - thank you, I missed that ! 
Setting gcFirst=FALSE changes behavior in the first example to be 2 times 
faster and makes all the allocations in the second example faster.

I guess that extra call to gc() caused R_VSize to shrink too fast.

> > I looked more carefully at your code in src/main/memory.c, function
> > AdjustHeapSize:
> >
> > R_VSize = VNeeded;
> >    if (vect_occup > R_VGrowFrac) {
> > 	R_size_t change = R_VGrowIncrMin + R_VGrowIncrFrac * R_NSize;
> > 	if (R_MaxVSize - R_VSize >= change)
> > 	    R_VSize += change;
> >    }
> >
> > Could it be that R_NSize should be R_VSize ? This would explain why I see
> > a problem in case R_VSize>>R_NSize.
>
> That does indeed look like a bug and that R_NSize should be R_VSize --
> well spotted, thanks.  I will need to experiment with this a bit more
> to see if it can safely be changed.  It will increase the memory
> footprint a bit.  Probaly not by enough to matter but if it does we
> may need to adjust some of the tuning constants.
>

Would there be something I can help you with ? Is there a script to run 
through common usage patterns ?

                          thank you !

                                  Vladimir Dergachev


> Best,
>
> luke
>


From bcarvalh at jhsph.edu  Thu Nov  9 22:03:31 2006
From: bcarvalh at jhsph.edu (Benilton Carvalho)
Date: Thu, 9 Nov 2006 16:03:31 -0500
Subject: [Rd] Failing to install R-2.4.0 on FC4
Message-ID: <924366AB-172E-488B-AFDE-74E6FE114175@jhsph.edu>

Hi everyone,

Firstly, I'm sorry for the cross-post. I re-read the posting guide  
and it appears my question is more related to r-devel.... (i think :-) )

I downloaded the source code available at:

http://cran.fhcrc.org/src/base/R-2/R-2.4.0.tar.gz

to a linux machine (Linux 2.6.11-1.1369_FC4smp #1 SMP).

I successfully configured and compiled it, which means I'm able to
run it from the R-2.4.0/bin directory.

I want to do a system wide installation (via 'sudo make install') and
help2man fails, ie, when I execute the installation command mentioned
previously I get:

make[1]: Entering directory `/home/bcarvalh/R-2.4.0/m4'
make[1]: Nothing to be done for `install'.
make[1]: Leaving directory `/home/bcarvalh/R-2.4.0/m4'
make[1]: Entering directory `/home/bcarvalh/R-2.4.0/tools'
make[1]: Nothing to be done for `install'.
make[1]: Leaving directory `/home/bcarvalh/R-2.4.0/tools'
make[1]: Entering directory `/home/bcarvalh/R-2.4.0/doc'
installing doc ...
help2man: can't get `--version' info from ../bin/R
make[1]: *** [R.1] Error 255
make[1]: Leaving directory `/home/bcarvalh/R-2.4.0/doc'
make: *** [install] Error 1

Searching the archive, I did find a similar report (http://
tolstoy.newcastle.edu.au/R/devel/06/01/3699.html) but the proposed
solution did not work for me.

Any suggestion?

Thank you very much,

Benilton Carvalho
PhD Candidate
Department of Biostatistics
Johns Hopkins University


From p.dalgaard at biostat.ku.dk  Thu Nov  9 22:21:38 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 09 Nov 2006 22:21:38 +0100
Subject: [Rd] Failing to install R-2.4.0 on FC4
In-Reply-To: <924366AB-172E-488B-AFDE-74E6FE114175@jhsph.edu>
References: <924366AB-172E-488B-AFDE-74E6FE114175@jhsph.edu>
Message-ID: <x2irhoco4d.fsf@turmalin.kubism.ku.dk>

Benilton Carvalho <bcarvalh at jhsph.edu> writes:

> Hi everyone,
> 
> Firstly, I'm sorry for the cross-post. I re-read the posting guide  
> and it appears my question is more related to r-devel.... (i think :-) )
> 
> I downloaded the source code available at:
> 
> http://cran.fhcrc.org/src/base/R-2/R-2.4.0.tar.gz
> 
> to a linux machine (Linux 2.6.11-1.1369_FC4smp #1 SMP).
> 
> I successfully configured and compiled it, which means I'm able to
> run it from the R-2.4.0/bin directory.
> 
> I want to do a system wide installation (via 'sudo make install') and
> help2man fails, ie, when I execute the installation command mentioned
> previously I get:
> 
> make[1]: Entering directory `/home/bcarvalh/R-2.4.0/m4'
> make[1]: Nothing to be done for `install'.
> make[1]: Leaving directory `/home/bcarvalh/R-2.4.0/m4'
> make[1]: Entering directory `/home/bcarvalh/R-2.4.0/tools'
> make[1]: Nothing to be done for `install'.
> make[1]: Leaving directory `/home/bcarvalh/R-2.4.0/tools'
> make[1]: Entering directory `/home/bcarvalh/R-2.4.0/doc'
> installing doc ...
> help2man: can't get `--version' info from ../bin/R
> make[1]: *** [R.1] Error 255
> make[1]: Leaving directory `/home/bcarvalh/R-2.4.0/doc'
> make: *** [install] Error 1
> 
> Searching the archive, I did find a similar report (http://
> tolstoy.newcastle.edu.au/R/devel/06/01/3699.html) but the proposed
> solution did not work for me.
> 
> Any suggestion?

Well if nothing else works, there's a Fedora Extra RPM for R-2.4.0...

http://fedoraproject.org/extras/4/i386/repodata/repoview/R-0-2.4.0-2.fc4.1.html

The symptoms suggest that you can run ../bin/R, but root cannot, so
check permissions.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From rfrancois at mango-solutions.com  Thu Nov  9 11:14:27 2006
From: rfrancois at mango-solutions.com (Romain Francois)
Date: Thu, 09 Nov 2006 10:14:27 +0000
Subject: [Rd] invert argument in grep
Message-ID: <4552FF83.6010001@mango-solutions.com>

Hello,

What about an `invert` argument in grep, to return elements that are 
*not* matching a regular expression :

R> grep("pink", colors(), invert = TRUE, value = TRUE)

would essentially return the same as :

R> colors() [ - grep("pink", colors()) ]


I'm attaching the files that I modified (against today's tarball) for 
that purpose.

Cheers,

Romain

-- 
*mangosolutions*
/data analysis that delivers/

Tel   +44 1249 467 467
Fax   +44 1249 467 468

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: grep.R
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061109/288f5e81/attachment.pl 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: grep.Rd
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061109/288f5e81/attachment-0001.pl 

From murdoch at stats.uwo.ca  Fri Nov 10 11:04:04 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 10 Nov 2006 05:04:04 -0500
Subject: [Rd] invert argument in grep
In-Reply-To: <4552FF83.6010001@mango-solutions.com>
References: <4552FF83.6010001@mango-solutions.com>
Message-ID: <45544E94.3090303@stats.uwo.ca>

On 11/9/2006 5:14 AM, Romain Francois wrote:
> Hello,
> 
> What about an `invert` argument in grep, to return elements that are 
> *not* matching a regular expression :
> 
> R> grep("pink", colors(), invert = TRUE, value = TRUE)
> 
> would essentially return the same as :
> 
> R> colors() [ - grep("pink", colors()) ]
> 
> 
> I'm attaching the files that I modified (against today's tarball) for 
> that purpose.

I think a more generally useful change would be to be able to return a 
logical vector with TRUE for a match and FALSE for a non-match, so a 
simple !grep(...) does the inversion.  (This is motivated by the recent 
R-help discussion of the fact that x[-selection] doesn't always invert 
the selection when it's a vector of indices.)

A way to do that without expanding the argument list would be to allow

value="logical"

as well as value=TRUE and value=FALSE.

This would make boolean operations easy, e.g.

colors()[grep("dark", colors(), value="logical")
       & !grep("blue", colors(), value="logical")]

to select the colors that contain "dark" but not "blue". (In this case 
the RE to select that subset is rather simple because "dark" always 
precedes "blue", but if that wasn't true, it would be a lot messier.)

Duncan Murdoch
> 
> Cheers,
> 
> Romain
> 
> 
> 
> ------------------------------------------------------------------------
> 
> grep <-
> function(pattern, x, ignore.case = FALSE, extended = TRUE, perl = FALSE,
>          value = FALSE, fixed = FALSE, useBytes = FALSE, invert = FALSE)
> {
>     pattern <- as.character(pattern)
>     ## when value = TRUE we return names
>     if(!is.character(x)) x <- structure(as.character(x), names=names(x))
>     ## behaves like == for NA pattern
>     if (is.na(pattern)) {
>         if(value)
>             return(structure(rep.int(as.character(NA), length(x)),
>                              names = names(x)))
>         else
>             return(rep.int(NA, length(x)))
>     }
> 
>     if(perl)
>         .Internal(grep.perl(pattern, x, ignore.case, value, useBytes, invert))
>     else
>         .Internal(grep(pattern, x, ignore.case, extended, value, fixed,
>                        useBytes, invert))
> }
> 
> sub <-
> function(pattern, replacement, x, ignore.case = FALSE, extended = TRUE,
>          perl = FALSE, fixed = FALSE, useBytes = FALSE)
> {
>     pattern <- as.character(pattern)
>     replacement <- as.character(replacement)
>     if(!is.character(x)) x <- as.character(x)
>     if (is.na(pattern))
>         return(rep.int(as.character(NA), length(x)))
> 
>     if(perl)
>         .Internal(sub.perl(pattern, replacement, x, ignore.case, useBytes))
>     else
>         .Internal(sub(pattern, replacement, x, ignore.case,
>                       extended, fixed, useBytes))
> }
> 
> gsub <-
> function(pattern, replacement, x, ignore.case = FALSE, extended = TRUE,
>          perl = FALSE, fixed = FALSE, useBytes = FALSE)
> {
>     pattern <- as.character(pattern)
>     replacement <- as.character(replacement)
>     if(!is.character(x)) x <- as.character(x)
>     if (is.na(pattern))
>         return(rep.int(as.character(NA), length(x)))
> 
>     if(perl)
>         .Internal(gsub.perl(pattern, replacement, x, ignore.case, useBytes))
>     else
>         .Internal(gsub(pattern, replacement, x, ignore.case,
>                        extended, fixed, useBytes))
> }
> 
> regexpr <-
> function(pattern, text, extended = TRUE, perl = FALSE,
>          fixed = FALSE, useBytes = FALSE)
> {
>     pattern <- as.character(pattern)
>     text <- as.character(text)
>     if(perl)
>         .Internal(regexpr.perl(pattern, text, useBytes))
>     else
>         .Internal(regexpr(pattern, text, extended, fixed, useBytes))
> }
> 
> gregexpr <-
> function(pattern, text, extended = TRUE, perl = FALSE,
>          fixed = FALSE, useBytes = FALSE)
> {
>     pattern <- as.character(pattern)
>     text <- as.character(text)
>     if(perl)
>       .Internal(gregexpr.perl(pattern, text, useBytes))
>     else
>       .Internal(gregexpr(pattern, text, extended, fixed, useBytes))
> }
> 
> agrep <-
> function(pattern, x, ignore.case = FALSE, value = FALSE,
>          max.distance = 0.1)
> {
>     pattern <- as.character(pattern)
>     if(!is.character(x)) x <- as.character(x)
>     ## behaves like == for NA pattern
>     if (is.na(pattern)){
>         if (value)
>             return(structure(rep.int(as.character(NA), length(x)),
>                              names = names(x)))
>         else
>             return(rep.int(NA, length(x)))
>     }
> 
>     if(!is.character(pattern)
>        || (length(pattern) < 1)
>        || ((n <- nchar(pattern)) == 0))
>         stop("'pattern' must be a non-empty character string")
> 
>     if(!is.list(max.distance)) {
>         if(!is.numeric(max.distance) || (max.distance < 0))
>             stop("'max.distance' must be non-negative")
>         if(max.distance < 1)            # transform percentages
>             max.distance <- ceiling(n * max.distance)
>         max.insertions <- max.deletions <- max.substitutions <-
>             max.distance
>     } else {
>         ## partial matching
>         table <- c("all", "deletions", "insertions", "substitutions")
>         ind <- pmatch(names(max.distance), table)
>         if(any(is.na(ind)))
>             warning("unknown match distance components ignored")
>         max.distance <- max.distance[!is.na(ind)]
>         names(max.distance) <- table[ind]
>         ## sanity checks
>         comps <- unlist(max.distance)
>         if(!all(is.numeric(comps)) || any(comps < 0))
>             stop("'max.distance' components must be non-negative")
>         ## extract restrictions
>         if(is.null(max.distance$all))
>             max.distance$all <- 0.1
>         max.insertions <- max.deletions <- max.substitutions <-
>             max.distance$all
>         if(!is.null(max.distance$deletions))
>             max.deletions <- max.distance$deletions
>         if(!is.null(max.distance$insertions))
>             max.insertions <- max.distance$insertions
>         if(!is.null(max.distance$substitutions))
>             max.substitutions <- max.distance$substitutions
>         max.distance <- max.distance$all
>         ## transform percentages
>         if(max.distance < 1)
>             max.distance <- ceiling(n * max.distance)
>         if(max.deletions < 1)
>             max.deletions <- ceiling(n * max.deletions)
>         if(max.insertions < 1)
>             max.insertions <- ceiling(n * max.insertions)
>         if(max.substitutions < 1)
>             max.substitutions <- ceiling(n * max.substitutions)
>     }
> 
>     .Internal(agrep(pattern, x, ignore.case, value, max.distance,
>                     max.deletions, max.insertions, max.substitutions))
> }
> 
> 
> ------------------------------------------------------------------------
> 
> \name{grep}
> \title{Pattern Matching and Replacement}
> \alias{grep}
> \alias{sub}
> \alias{gsub}
> \alias{regexpr}
> \alias{gregexpr}
> \description{
>   \code{grep} searches for matches to \code{pattern} (its first
>   argument) within the character vector \code{x} (second argument).
>   \code{regexpr} and \code{gregexpr} do too, but return more detail in
>   a different format.
> 
>   \code{sub} and \code{gsub} perform replacement of matches determined
>   by regular expression matching.
> }
> \usage{
> grep(pattern, x, ignore.case = FALSE, extended = TRUE,
>      perl = FALSE, value = FALSE, fixed = FALSE, 
>      useBytes = FALSE, invert = FALSE)
> 
> sub(pattern, replacement, x,
>     ignore.case = FALSE, extended = TRUE, perl = FALSE,
>     fixed = FALSE, useBytes = FALSE)
> 
> gsub(pattern, replacement, x,
>      ignore.case = FALSE, extended = TRUE, perl = FALSE,
>      fixed = FALSE, useBytes = FALSE)
> 
> regexpr(pattern, text, extended = TRUE, perl = FALSE,
>         fixed = FALSE, useBytes = FALSE)
> 
> gregexpr(pattern, text, extended = TRUE, perl = FALSE,
>          fixed = FALSE, useBytes = FALSE)
> }
> \arguments{
>   \item{pattern}{character string containing a \link{regular expression}
>     (or character string for \code{fixed = TRUE}) to be matched
>     in the given character vector.  Coerced by
>     \code{\link{as.character}} to a character string if possible.}
>   \item{x, text}{a character vector where matches are sought, or an
>     object which can be coerced by \code{as.character} to a character vector.}
>   \item{ignore.case}{if \code{FALSE}, the pattern matching is \emph{case
>       sensitive} and if \code{TRUE}, case is ignored during matching.}
>   \item{extended}{if \code{TRUE}, extended regular expression matching
>     is used, and if \code{FALSE} basic regular expressions are used.}
>   \item{perl}{logical. Should perl-compatible regexps be used?
>     Has priority over \code{extended}.}
>   \item{value}{if \code{FALSE}, a vector containing the (\code{integer})
>     indices of the matches determined by \code{grep} is returned, and if
>     \code{TRUE}, a vector containing the matching elements themselves is
>     returned.}
>   \item{fixed}{logical.  If \code{TRUE}, \code{pattern} is a string to be
>     matched as is.  Overrides all conflicting arguments.}
>   \item{useBytes}{logical.  If \code{TRUE} the matching is done
>     byte-by-byte rather than character-by-character.  See Details.}
>   \item{replacement}{a replacement for matched pattern in \code{sub} and
>     \code{gsub}.  Coerced to character if possible.  For \code{fixed =
>       FALSE} this can include backreferences \code{"\\1"} to
>     \code{"\\9"} to parenthesized subexpressions of \code{pattern}.  For
>     \code{perl = TRUE} only, it can also contain \code{"\\U"} or
>     \code{"\\L"} to convert the rest of the replacement to upper or
>     lower case.
>   }
>   \item{invert}{logical. If \code{TRUE}, then the match is reversed 
>   in order to get the items (or the values) that are \emph{not} matching the 
>   pattern}
> }
> \details{
>   Arguments which should be character strings or character vectors are
>   coerced to character if possible.
> 
>   The two \code{*sub} functions differ only in that \code{sub} replaces
>   only the first occurrence of a \code{pattern} whereas \code{gsub}
>   replaces all occurrences.
> 
>   For \code{regexpr} it is an error for \code{pattern} to be \code{NA},
>   otherwise \code{NA} is permitted and matches only itself.
> 
>   The regular expressions used are those specified by POSIX 1003.2,
>   either extended or basic, depending on the value of the
>   \code{extended} argument, unless \code{perl = TRUE} when they are
>   those of PCRE, \url{http://www.pcre.org/}.
>   (The exact set of patterns supported may depend on the version of
>   PCRE installed on the system in use, if \R was configured to use the
>   system PCRE.  \R's internal copy used PCRE 6.7.)
> 
>   \code{useBytes} is only used if \code{fixed = TRUE} or \code{perl = TRUE}.
>   For \code{grep} its main effect is to avoid errors/warnings about
>   invalid inputs, but for \code{regexpr} it changes the interpretation
>   of the output.
> }
> \value{
>   For \code{grep} a vector giving either the indices of the elements of
>   \code{x} that yielded a match or, if \code{value} is \code{TRUE}, the
>   matched elements of \code{x} (after coercion, preserving names but no
>   other attributes).
> 
>   For \code{sub} and \code{gsub} a character vector of the same length
>   and with the same attributes as \code{x} (after possible coercion).
> 
>   For \code{regexpr} an integer vector of the same length as \code{text}
>   giving the starting position of the first match, or \eqn{-1} if there
>   is none, with attribute \code{"match.length"} giving the length of the
>   matched text (or \eqn{-1} for no match).  In a multi-byte locale these
>   quantities are in characters rather than bytes unless
>   \code{useBytes = TRUE} is used with \code{fixed = TRUE} or
>   \code{perl = TRUE}.
> 
>   For \code{gregexpr} a list of the same length as \code{text} each
>   element of which is an integer vector as in \code{regexpr}, except
>   that the starting positions of every match are given.
> 
>   If in a multi-byte locale the pattern or replacement is not a valid
>   sequence of bytes, an error is thrown.  An invalid string in \code{x}
>   or \code{text} is a non-match with a warning for \code{grep} or
>   \code{regexpr}, but an error for \code{sub} or \code{gsub}.
> }
> \section{Warning}{
>   The standard regular-expression code has been reported to be very slow
>   when applied to extremely long character strings
>   (tens of thousands of characters or more): the code used when
>   \code{perl = TRUE} seems much faster and more reliable for such
>   usages.
> 
>   The standard version of \code{gsub} does not substitute correctly
>   repeated word-boundaries (e.g. \code{pattern = "\\b"}).
>   Use \code{perl = TRUE} for such matches.
> 
>   The \code{perl = TRUE} option is only implemented for single-byte and
>   UTF-8 encodings, and will warn if used in a non-UTF-8 multi-byte
>   locale (unless \code{useBytes = TRUE}).
> }
> \references{
>   Becker, R. A., Chambers, J. M. and Wilks, A. R. (1988)
>   \emph{The New S Language}.
>   Wadsworth \& Brooks/Cole (\code{grep})
> }
> \seealso{
>   \link{regular expression} (aka \code{\link{regexp}}) for the details
> % the `aka' above is for ESS (and ?reg....) where a space is problematic
>   of the pattern specification.
> 
>   \code{\link{glob2rx}} to turn wildcard matches into regular expressions.
>   
>   \code{\link{agrep}} for approximate matching.
> 
>   \code{\link{tolower}}, \code{\link{toupper}} and \code{\link{chartr}}
>   for character translations.
>   \code{\link{charmatch}}, \code{\link{pmatch}}, \code{\link{match}}.
>   \code{\link{apropos}} uses regexps and has nice examples.
> }
> \examples{
> grep("[a-z]", letters)
> 
> txt <- c("arm","foot","lefroo", "bafoobar")
> if(any(i <- grep("foo",txt)))
>    cat("'foo' appears at least once in\n\t",txt,"\n")
> i # 2 and 4
> txt[i]
> 
> ## Double all 'a' or 'b's;  "\\" must be escaped, i.e., 'doubled'
> %% and escaped even once more in this *.Rd file!
> gsub("([ab])", "\\\\1_\\\\1_", "abc and ABC")
> 
> txt <- c("The", "licenses", "for", "most", "software", "are",
>   "designed", "to", "take", "away", "your", "freedom",
>   "to", "share", "and", "change", "it.",
>    "", "By", "contrast,", "the", "GNU", "General", "Public", "License",
>    "is", "intended", "to", "guarantee", "your", "freedom", "to",
>    "share", "and", "change", "free", "software", "--",
>    "to", "make", "sure", "the", "software", "is",
>    "free", "for", "all", "its", "users")
> ( i <- grep("[gu]", txt) ) # indices
> stopifnot( txt[i] == grep("[gu]", txt, value = TRUE) )
> 
> ## Note that in locales such as en_US this includes B as the
> ## collation order is aAbBcCdEe ...
> (ot <- sub("[b-e]",".", txt))
> txt[ot != gsub("[b-e]",".", txt)]#- gsub does "global" substitution
> 
> txt[gsub("g","#", txt) !=
>     gsub("g","#", txt, ignore.case = TRUE)] # the "G" words
> 
> regexpr("en", txt)
> 
> gregexpr("e", txt)
> 
> ## trim trailing white space
> str = 'Now is the time      '
> sub(' +$', '', str)  ## spaces only
> sub('[[:space:]]+$', '', str) ## white space, POSIX-style
> sub('\\\\s+$', '', str, perl = TRUE) ## Perl-style white space
> 
> ## capitalizing
> gsub("(\\\\w)(\\\\w*)", "\\\\U\\\\1\\\\L\\\\2", "a test of capitalizing", perl=TRUE)
> gsub("\\\\b(\\\\w)", "\\\\U\\\\1", "a test of capitalizing", perl=TRUE)
> }
> \keyword{character}
> \keyword{utilities}
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Fri Nov 10 12:28:47 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 10 Nov 2006 11:28:47 +0000 (GMT)
Subject: [Rd] invert argument in grep
In-Reply-To: <45544E94.3090303@stats.uwo.ca>
References: <4552FF83.6010001@mango-solutions.com>
	<45544E94.3090303@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0611101115130.1115@gannet.stats.ox.ac.uk>

On Fri, 10 Nov 2006, Duncan Murdoch wrote:

> On 11/9/2006 5:14 AM, Romain Francois wrote:
>> Hello,
>>
>> What about an `invert` argument in grep, to return elements that are
>> *not* matching a regular expression :
>>
>> R> grep("pink", colors(), invert = TRUE, value = TRUE)
>>
>> would essentially return the same as :
>>
>> R> colors() [ - grep("pink", colors()) ]

Note that grep("pat", x, value = TRUE) is not the same as x[grep("pat", x)],
as the help page carefully points out.  (I think it would be better 
if it were.)

>>
>> I'm attaching the files that I modified (against today's tarball) for
>> that purpose.

(BTW, sending whole files makes it difficult to see the changes and even 
harder to merge them; please use diffs.  From a quick look the changes 
were very incomplete, as the internal functions were changed and there 
were no changed C files.)

> I think a more generally useful change would be to be able to return a
> logical vector with TRUE for a match and FALSE for a non-match, so a
> simple !grep(...) does the inversion.  (This is motivated by the recent
> R-help discussion of the fact that x[-selection] doesn't always invert
> the selection when it's a vector of indices.)

I don't think that is pertinent here, as the indices are always a vector 
of positive integers.

> A way to do that without expanding the argument list would be to allow
>
> value="logical"
>
> as well as value=TRUE and value=FALSE.
>
> This would make boolean operations easy, e.g.
>
> colors()[grep("dark", colors(), value="logical")
>       & !grep("blue", colors(), value="logical")]
>
> to select the colors that contain "dark" but not "blue". (In this case
> the RE to select that subset is rather simple because "dark" always
> precedes "blue", but if that wasn't true, it would be a lot messier.)

That might be worthwhile, but it is relatively simple to change positive 
integer indices to logical ones and v.v.

My personal take is that having 'value=TRUE' was already a complication 
not worth having, and implementing it at C level was an efficiency tweak 
not worth the maintenance effort (and also means that '[' methods are not 
dispatched).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Fri Nov 10 13:04:44 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 10 Nov 2006 07:04:44 -0500
Subject: [Rd] invert argument in grep
In-Reply-To: <Pine.LNX.4.64.0611101115130.1115@gannet.stats.ox.ac.uk>
References: <4552FF83.6010001@mango-solutions.com>
	<45544E94.3090303@stats.uwo.ca>
	<Pine.LNX.4.64.0611101115130.1115@gannet.stats.ox.ac.uk>
Message-ID: <45546ADC.1090503@stats.uwo.ca>

On 11/10/2006 6:28 AM, Prof Brian Ripley wrote:
> On Fri, 10 Nov 2006, Duncan Murdoch wrote:
> 
>> On 11/9/2006 5:14 AM, Romain Francois wrote:
>>> Hello,
>>>
>>> What about an `invert` argument in grep, to return elements that are
>>> *not* matching a regular expression :
>>>
>>> R> grep("pink", colors(), invert = TRUE, value = TRUE)
>>>
>>> would essentially return the same as :
>>>
>>> R> colors() [ - grep("pink", colors()) ]
> 
> Note that grep("pat", x, value = TRUE) is not the same as x[grep("pat", x)],
> as the help page carefully points out.  (I think it would be better 
> if it were.)
> 
>>> I'm attaching the files that I modified (against today's tarball) for
>>> that purpose.
> 
> (BTW, sending whole files makes it difficult to see the changes and even 
> harder to merge them; please use diffs.  From a quick look the changes 
> were very incomplete, as the internal functions were changed and there 
> were no changed C files.)
> 
>> I think a more generally useful change would be to be able to return a
>> logical vector with TRUE for a match and FALSE for a non-match, so a
>> simple !grep(...) does the inversion.  (This is motivated by the recent
>> R-help discussion of the fact that x[-selection] doesn't always invert
>> the selection when it's a vector of indices.)
> 
> I don't think that is pertinent here, as the indices are always a vector 
> of positive integers.  

The issue is that the vector might be empty, in which case 
arithmetically negating it has no effect.  Negating a vector of integer 
indices is not a good way to invert a selection, while logical negation 
of a logical vector is fine.

> 
>> A way to do that without expanding the argument list would be to allow
>>
>> value="logical"
>>
>> as well as value=TRUE and value=FALSE.
>>
>> This would make boolean operations easy, e.g.
>>
>> colors()[grep("dark", colors(), value="logical")
>>       & !grep("blue", colors(), value="logical")]
>>
>> to select the colors that contain "dark" but not "blue". (In this case
>> the RE to select that subset is rather simple because "dark" always
>> precedes "blue", but if that wasn't true, it would be a lot messier.)
> 
> That might be worthwhile, but it is relatively simple to change positive 
> integer indices to logical ones and v.v.
> 
> My personal take is that having 'value=TRUE' was already a complication 
> not worth having, and implementing it at C level was an efficiency tweak 
> not worth the maintenance effort (and also means that '[' methods are not 
> dispatched).

This makes it sound as though it would be worthwhile to redo the 
implementation of value=TRUE as something equivalent to x[grep("pat", 
x)] by putting this case into the R code.  This would simplify the C 
code and make the interface a little less quirky.  (I'm not sure how 
much code this would break because of the loss of coercion to character.)

The value="logical" implementation could also be done in R, not C.

The advantage of putting it into grep() rather than leaving it for the 
user to change later is that grep() has a copy of x in hand, so a user 
of grep() will not have to save length(x) to use in the conversion to 
logical.

Duncan Murdoch


From rfrancois at mango-solutions.com  Fri Nov 10 18:52:28 2006
From: rfrancois at mango-solutions.com (Romain Francois)
Date: Fri, 10 Nov 2006 17:52:28 +0000
Subject: [Rd] invert argument in grep
In-Reply-To: <45544E94.3090303@stats.uwo.ca>
References: <4552FF83.6010001@mango-solutions.com>
	<45544E94.3090303@stats.uwo.ca>
Message-ID: <4554BC5C.9030203@mango-solutions.com>

Duncan Murdoch wrote:
> On 11/9/2006 5:14 AM, Romain Francois wrote:
>> Hello,
>>
>> What about an `invert` argument in grep, to return elements that are 
>> *not* matching a regular expression :
>>
>> R> grep("pink", colors(), invert = TRUE, value = TRUE)
>>
>> would essentially return the same as :
>>
>> R> colors() [ - grep("pink", colors()) ]
>>
>>
>> I'm attaching the files that I modified (against today's tarball) for 
>> that purpose.
>
> I think a more generally useful change would be to be able to return a 
> logical vector with TRUE for a match and FALSE for a non-match, so a 
> simple !grep(...) does the inversion.  (This is motivated by the 
> recent R-help discussion of the fact that x[-selection] doesn't always 
> invert the selection when it's a vector of indices.)
>
> A way to do that without expanding the argument list would be to allow
>
> value="logical"
>
> as well as value=TRUE and value=FALSE.
>
> This would make boolean operations easy, e.g.
>
> colors()[grep("dark", colors(), value="logical")
>       & !grep("blue", colors(), value="logical")]
>
> to select the colors that contain "dark" but not "blue". (In this case 
> the RE to select that subset is rather simple because "dark" always 
> precedes "blue", but if that wasn't true, it would be a lot messier.)
>
> Duncan Murdoch
Hi,

It sounds like a nice thing to have. I would still prefer to type :

R> grep ( "dark", grep("blue", colors(), value = TRUE, invert=TRUE), 
value = TRUE )  


What about a way to pass more than one regular expression then be able 
to call :

R> grep( c("dark", "blue"), colors(), value = TRUE, invert = c(TRUE, FALSE)


I usually use that kind of shortcuts that are easy to remember.

vgrep <- function(...) grep(..., value = TRUE)
igrep <- function(...) grep(..., invert = TRUE)
ivgrep <- vigrep <- function(...) grep(..., invert = TRUE, value = TRUE)

What about things like the arguments `after` and `before` in unix grep. 
That could be used when grepping inside a function :

R> grep("plot\\.", body(plot.default) , value= TRUE)
[1] "localWindow <- function(..., col, bg, pch, cex, lty, lwd) 
plot.window(...)"
[2] "plot.new()"
[3] "plot.xy(xy, type, ...)"


when this could be useful  (possibly).

R> # grep("plot\\.", plot.default, after = 2, value = TRUE)
R> tmp <- tempfile(); sink(tmp) ; print(body(plot.default)); sink(); 
system( paste( "grep -A2 plot\\. ", tmp) )
    localWindow <- function(..., col, bg, pch, cex, lty, lwd) 
plot.window(...)
    localTitle <- function(..., col, bg, pch, cex, lty, lwd) title(...)
    xlabel <- if (!missing(x))
--
    plot.new()
    localWindow(xlim, ylim, log, asp, ...)
    panel.first
    plot.xy(xy, type, ...)
    panel.last
    if (axes) {
--
    if (frame.plot)
        localBox(...)
    if (ann)


BTW, if I call :

R> grep("plot\\.", plot.default)
Error in as.character(x) : cannot coerce to vector

What about adding that line at the beginning of grep, or something else 
to be able to do as.character on a function ?

if(is.function(x)) x <- body(x)


Cheers,

Romain
>>
>> Cheers,
>>
>> Romain


-- 
*mangosolutions*
/data analysis that delivers/

Tel   +44 1249 467 467
Fax   +44 1249 467 468


From murdoch at stats.uwo.ca  Fri Nov 10 19:24:05 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 10 Nov 2006 13:24:05 -0500
Subject: [Rd] invert argument in grep
In-Reply-To: <4554BC5C.9030203@mango-solutions.com>
References: <4552FF83.6010001@mango-solutions.com>	<45544E94.3090303@stats.uwo.ca>
	<4554BC5C.9030203@mango-solutions.com>
Message-ID: <4554C3C5.6030306@stats.uwo.ca>

On 11/10/2006 12:52 PM, Romain Francois wrote:
> Duncan Murdoch wrote:
>> On 11/9/2006 5:14 AM, Romain Francois wrote:
>>> Hello,
>>>
>>> What about an `invert` argument in grep, to return elements that are 
>>> *not* matching a regular expression :
>>>
>>> R> grep("pink", colors(), invert = TRUE, value = TRUE)
>>>
>>> would essentially return the same as :
>>>
>>> R> colors() [ - grep("pink", colors()) ]
>>>
>>>
>>> I'm attaching the files that I modified (against today's tarball) for 
>>> that purpose.
>>
>> I think a more generally useful change would be to be able to return a 
>> logical vector with TRUE for a match and FALSE for a non-match, so a 
>> simple !grep(...) does the inversion.  (This is motivated by the 
>> recent R-help discussion of the fact that x[-selection] doesn't always 
>> invert the selection when it's a vector of indices.)
>>
>> A way to do that without expanding the argument list would be to allow
>>
>> value="logical"
>>
>> as well as value=TRUE and value=FALSE.
>>
>> This would make boolean operations easy, e.g.
>>
>> colors()[grep("dark", colors(), value="logical")
>>       & !grep("blue", colors(), value="logical")]
>>
>> to select the colors that contain "dark" but not "blue". (In this case 
>> the RE to select that subset is rather simple because "dark" always 
>> precedes "blue", but if that wasn't true, it would be a lot messier.)
>>
>> Duncan Murdoch
> Hi,
> 
> It sounds like a nice thing to have. I would still prefer to type :
> 
> R> grep ( "dark", grep("blue", colors(), value = TRUE, invert=TRUE), 
> value = TRUE )  

That's good for intersecting two searches, but not for other boolean 
combinations.

My main point was that inversion isn't the only boolean operation you 
may want, but R has perfectly good powerful boolean operators, so 
installing a limited subset of boolean algebra into grep() is probably 
the wrong approach.
> 
> 
> What about a way to pass more than one regular expression then be able 
> to call :
> 
> R> grep( c("dark", "blue"), colors(), value = TRUE, invert = c(TRUE, FALSE)

Again, it covers & and !, but it misses other boolean operators.

> I usually use that kind of shortcuts that are easy to remember.
> 
> vgrep <- function(...) grep(..., value = TRUE)
> igrep <- function(...) grep(..., invert = TRUE)
> ivgrep <- vigrep <- function(...) grep(..., invert = TRUE, value = TRUE)

If you're willing to write these, then it's easy to write igrep without 
an invert arg to grep:

igrep <- function(pat, x, ...)
    setdiff(1:length(x), grep(pat, x, value = FALSE, ...))

ivgrep would also be easy, except for the weird semantics of value=TRUE 
pointed out by Brian:  but it could still be written with a little bit 
of care.

Duncan Murdoch

> 
> What about things like the arguments `after` and `before` in unix grep. 
> That could be used when grepping inside a function :
> 
> R> grep("plot\\.", body(plot.default) , value= TRUE)
> [1] "localWindow <- function(..., col, bg, pch, cex, lty, lwd) 
> plot.window(...)"
> [2] "plot.new()"
> [3] "plot.xy(xy, type, ...)"
> 
> 
> when this could be useful  (possibly).
> 
> R> # grep("plot\\.", plot.default, after = 2, value = TRUE)
> R> tmp <- tempfile(); sink(tmp) ; print(body(plot.default)); sink(); 
> system( paste( "grep -A2 plot\\. ", tmp) )
>     localWindow <- function(..., col, bg, pch, cex, lty, lwd) 
> plot.window(...)
>     localTitle <- function(..., col, bg, pch, cex, lty, lwd) title(...)
>     xlabel <- if (!missing(x))
> --
>     plot.new()
>     localWindow(xlim, ylim, log, asp, ...)
>     panel.first
>     plot.xy(xy, type, ...)
>     panel.last
>     if (axes) {
> --
>     if (frame.plot)
>         localBox(...)
>     if (ann)
> 
> 
> BTW, if I call :
> 
> R> grep("plot\\.", plot.default)
> Error in as.character(x) : cannot coerce to vector
> 
> What about adding that line at the beginning of grep, or something else 
> to be able to do as.character on a function ?
> 
> if(is.function(x)) x <- body(x)
> 
> 
> Cheers,
> 
> Romain
>>>
>>> Cheers,
>>>
>>> Romain
> 
>


From fuss-h at ulster.ac.uk  Fri Nov 10 20:04:53 2006
From: fuss-h at ulster.ac.uk (fuss-h at ulster.ac.uk)
Date: Fri, 10 Nov 2006 20:04:53 +0100 (CET)
Subject: [Rd] R CMD SHLIB fails under Mac OS (PR#9353)
Message-ID: <20061110190453.B41FFAC2B@slim.kubism.ku.dk>

Full_Name: Hendrik Fu?
Version: 2.4.0
OS: Mac OS 10.4.8
Submission from: (NULL) (201.27.208.230)


R 2.4.0 on Mac OS X cannot seem to build shared libraries using R CMD SHLIB.

R CMD SHLIB mylib.o yields an error message:
/usr/bin/libtool: unknown option character `m' in: -macosx_version_min

I cannot locate the Makefile, so I don't know what's wrong here.

cheers
Hendrik


From simon.urbanek at r-project.org  Fri Nov 10 20:07:34 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 10 Nov 2006 14:07:34 -0500
Subject: [Rd] R CMD SHLIB fails under Mac OS (PR#9353)
In-Reply-To: <20061110190453.B41FFAC2B@slim.kubism.ku.dk>
References: <20061110190453.B41FFAC2B@slim.kubism.ku.dk>
Message-ID: <ACA3706B-5C96-4AE2-9912-6F123C7151C7@r-project.org>


On Nov 10, 2006, at 2:04 PM, fuss-h at ulster.ac.uk wrote:

> Full_Name: Hendrik Fu?
> Version: 2.4.0
> OS: Mac OS 10.4.8
> Submission from: (NULL) (201.27.208.230)
>
>
> R 2.4.0 on Mac OS X cannot seem to build shared libraries using R  
> CMD SHLIB.
>
> R CMD SHLIB mylib.o yields an error message:
> /usr/bin/libtool: unknown option character `m' in: -macosx_version_min
>

Please update your Xcode - the libtool is too old.

Cheers,
Simon


From deepayan.sarkar at gmail.com  Fri Nov 10 22:17:45 2006
From: deepayan.sarkar at gmail.com (deepayan.sarkar at gmail.com)
Date: Fri, 10 Nov 2006 22:17:45 +0100 (CET)
Subject: [Rd] typo in hist.Rd (PR#9355)
Message-ID: <20061110211745.52A863FBDA@slim.kubism.ku.dk>

'Freedman' is misspelled (as 'Friedman') in
src/library/graphics/man/hist.Rd. As a result, the help page currently
implies that

breaks = "Fried"

is a valid argument to hist, but results in an error:

> hist(rnorm(100), breaks = "Fried")
Error in match.arg(tolower(breaks), c("sturges", "fd", "freedman-diaconis",  :
        'arg' should be one of sturges, fd, freedman-diaconis, scott

> sessionInfo()
R version 2.5.0 Under development (unstable) (2006-11-06 r39797)
i686-pc-linux-gnu
...


From deepayan.sarkar at gmail.com  Fri Nov 10 22:32:36 2006
From: deepayan.sarkar at gmail.com (deepayan.sarkar at gmail.com)
Date: Fri, 10 Nov 2006 22:32:36 +0100 (CET)
Subject: [Rd] unwarranted warning from hist.default (PR#9356)
Message-ID: <20061110213236.5B372B186@slim.kubism.ku.dk>

> x = rnorm(100)
> b = seq(min(x) - 1, max(x) + 1, length = 11)
> b
 [1] -3.4038769 -2.7451072 -2.0863375 -1.4275678 -0.7687980 -0.1100283
 [7]  0.5487414  1.2075111  1.8662808  2.5250506  3.1838203
>
> invisible(hist(x, breaks = b, include.lowest = TRUE, plot = FALSE))
Warning message:
argument 'include.lowest' is not made use of in: hist.default(x,
breaks = b, include.lowest = TRUE, plot = FALSE)


I don't think a warning is appropriate, since ?hist says:

include.lowest: logical; if 'TRUE', an 'x[i]' equal to the 'breaks'
          value will be included in the first (or last, for 'right =
          FALSE') bar.  This will be ignored (with a warning) unless
          'breaks' is a vector.

and in this case 'breaks' does qualify as a "vector" by my understanding.

Note that the warning goes away with 'plot=TRUE'. This suggests that
this might have something to do with this vaguely worded entry in the
NEWS for R 2.4.0:

   o   hist(*, plot = FALSE) now warns about unused arguments.

Neither the help page nor the NEWS file indicates what arguments are
considered 'unused' when 'plot = FALSE', but either possibility ---
(1) include.lowest is actually unused and (2) it is used and the
warning is wrong --- is a bug.

> sessionInfo()
R version 2.4.0 Patched (2006-11-03 r39777)
i486-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
[7] "base"

-Deepayan


From p.dalgaard at biostat.ku.dk  Fri Nov 10 23:39:14 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 10 Nov 2006 23:39:14 +0100
Subject: [Rd] unwarranted warning from hist.default (PR#9356)
In-Reply-To: <20061110213236.5B372B186@slim.kubism.ku.dk>
References: <20061110213236.5B372B186@slim.kubism.ku.dk>
Message-ID: <x2fycr3p0t.fsf@turmalin.kubism.ku.dk>

deepayan.sarkar at gmail.com writes:

> > x = rnorm(100)
> > b = seq(min(x) - 1, max(x) + 1, length = 11)
> > b
>  [1] -3.4038769 -2.7451072 -2.0863375 -1.4275678 -0.7687980 -0.1100283
>  [7]  0.5487414  1.2075111  1.8662808  2.5250506  3.1838203
> >
> > invisible(hist(x, breaks = b, include.lowest = TRUE, plot = FALSE))
> Warning message:
> argument 'include.lowest' is not made use of in: hist.default(x,
> breaks = b, include.lowest = TRUE, plot = FALSE)
> 
> 
> I don't think a warning is appropriate, since ?hist says:
> 
> include.lowest: logical; if 'TRUE', an 'x[i]' equal to the 'breaks'
>           value will be included in the first (or last, for 'right =
>           FALSE') bar.  This will be ignored (with a warning) unless
>           'breaks' is a vector.
> 
> and in this case 'breaks' does qualify as a "vector" by my understanding.
> 
> Note that the warning goes away with 'plot=TRUE'. This suggests that
> this might have something to do with this vaguely worded entry in the
> NEWS for R 2.4.0:
> 
>    o   hist(*, plot = FALSE) now warns about unused arguments.
> 
> Neither the help page nor the NEWS file indicates what arguments are
> considered 'unused' when 'plot = FALSE', but either possibility ---
> (1) include.lowest is actually unused and (2) it is used and the
> warning is wrong --- is a bug.

As I read the code, the purpose is to warn people if they supply plot
arguments (density, xlim, ylim,....) while plot=FALSE. There's a stop
list coded by 

        nf <- nf[is.na(match(nf, c("x", "breaks", "freq", "nclass", 
            "plot", "probability")))]

and I think the problem is just that "include.lowest" should have been
on the list.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From deepayan.sarkar at gmail.com  Sat Nov 11 00:29:51 2006
From: deepayan.sarkar at gmail.com (deepayan.sarkar at gmail.com)
Date: Sat, 11 Nov 2006 00:29:51 +0100 (CET)
Subject: [Rd] unwarranted warning from hist.default (PR#9356)
Message-ID: <20061110232951.5DEB253CC7@slim.kubism.ku.dk>

On 10 Nov 2006 23:39:14 +0100, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> deepayan.sarkar at gmail.com writes:
>
> > > x = rnorm(100)
> > > b = seq(min(x) - 1, max(x) + 1, length = 11)
> > > b
> >  [1] -3.4038769 -2.7451072 -2.0863375 -1.4275678 -0.7687980 -0.1100283
> >  [7]  0.5487414  1.2075111  1.8662808  2.5250506  3.1838203
> > >
> > > invisible(hist(x, breaks = b, include.lowest = TRUE, plot = FALSE))
> > Warning message:
> > argument 'include.lowest' is not made use of in: hist.default(x,
> > breaks = b, include.lowest = TRUE, plot = FALSE)
> >
> >
> > I don't think a warning is appropriate, since ?hist says:
> >
> > include.lowest: logical; if 'TRUE', an 'x[i]' equal to the 'breaks'
> >           value will be included in the first (or last, for 'right =
> >           FALSE') bar.  This will be ignored (with a warning) unless
> >           'breaks' is a vector.
> >
> > and in this case 'breaks' does qualify as a "vector" by my understanding.
> >
> > Note that the warning goes away with 'plot=TRUE'. This suggests that
> > this might have something to do with this vaguely worded entry in the
> > NEWS for R 2.4.0:
> >
> >    o   hist(*, plot = FALSE) now warns about unused arguments.
> >
> > Neither the help page nor the NEWS file indicates what arguments are
> > considered 'unused' when 'plot = FALSE', but either possibility ---
> > (1) include.lowest is actually unused and (2) it is used and the
> > warning is wrong --- is a bug.
>
> As I read the code, the purpose is to warn people if they supply plot
> arguments (density, xlim, ylim,....) while plot=FALSE.

That's not exactly what the NEWS entry says though.

> There's a stop
> list coded by
>
>         nf <- nf[is.na(match(nf, c("x", "breaks", "freq", "nclass",
>             "plot", "probability")))]
>
> and I think the problem is just that "include.lowest" should have been
> on the list.

Yes. And while you are at it, my suggestion would be to either take
'probability' and 'freq' off that list (which would make the NEWS
entry slightly more true) and/or clarify the intent of the warning.
The current help page is silent about the warnings when 'plot =
FALSE', and I don't think that's a good thing. It's not exactly a bug,
so I didn't file a bug report, but I did send a message to r-devel
about it a while back.

-Deepayan


From Taiwei.Lin at Sun.COM  Sat Nov 11 03:13:02 2006
From: Taiwei.Lin at Sun.COM (Tai-Wei (David) Lin)
Date: Fri, 10 Nov 2006 18:13:02 -0800
Subject: [Rd] Making Solaris 10 x86/x64 build of R available?
In-Reply-To: <Pine.LNX.4.64.0611081751300.3519@gannet.stats.ox.ac.uk>
References: <455205E9.2080002@sun.com>
	<Pine.LNX.4.64.0611081751300.3519@gannet.stats.ox.ac.uk>
Message-ID: <455531AE.1060105@sun.com>

Hi Professor Ripley,

Thanks for the tip. It worked for me. I'll need to work on packaging 
next and maybe a bit more testing of the steps on another build machine.

I just found out that there is already an older version of R binary for 
Solaris 10 at 
http://apstc.sun.com.sg/popup.php?l1=research&l2=projects&l3=s10port&f=applications#R

Its readme has compile options:

http://apstc.sun.com.sg/downloads/s10/README/R-project-2.2.0-sol10-x86.txt

Perhaps we interacted with different R users. I would expect not all R 
users would want to compile their own R binary, similar to not all Linux 
users would like to compile their own kernel. Without a choice to 
download pre-built R on Solaris, there won't be a demand for the 
pre-build binary. Instead, people would focus on how to build their own 
or would use a pre-build binary for a different platform as an 
alternative. With this option, it might generate some demands.

Only time will tell and I have no intention to speculate or make a case. 
Rather, I would like to identify ways to contribute within my ability 
and attention span. ;) Currently, I am considering different ways to 
post a build of R with HDF5 support. Hence my first email to check with 
this alias before I go off doing my own things.

Thanks,

David

Prof Brian Ripley :
> On Wed, 8 Nov 2006, Tai-Wei (David) Lin wrote:
> 
>> Hi Folks,
>>
>> I've been working on a 32bit build of R on Solaris 10 x64. What are the
>> steps for validate a build beyond make check?
> 
> make check-all is a more comprehensive test, including of the 
> recommended packages.
> 
>> Once I am ready to contribute a binary build / HowTo doc, who should I 
>> contact?
> 
> I doubt if there is a demand for a binary build: AFAIK all Solaris users 
> of R have the tools to build from the sources.
> 
> We do have a HowTo, the R-admin manual.  If you tell us what you did in 
> the format of the entries there for specific OSes, we will incorporate 
> the information.  (It is pretty much essential to know exactly which 
> compilers etc you used.) Several other people have built R on Solaris 10 
> on x86_64 (which is I presume what you mean) using the current R-admin 
> instructions, so please tell us about small changes that might be 
> required on your system (and why).
>


From gregor.gorjanc at bfro.uni-lj.si  Sat Nov 11 09:29:41 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Sat, 11 Nov 2006 09:29:41 +0100
Subject: [Rd] c() for factors
Message-ID: <455589F5.7070207@bfro.uni-lj.si>

Dear R-core!

I have written a function mapLevels() to map levels of a factor. It can
produce a map (internally a list) of factor levels and internal integer
codes. I call this integer levelsMap. There is also character levelsMap,
but not of importance at this moment. I found out that it was quite
straightforward to write c() method for factors with use of mapLevels()
and Iam asking here if there is any interest to include this into base R.

In base R c() on two factors coerces to internal integer codes

> f1 <- factor(c("A", "B"))
> f2 <- factor(c("A", "C"))
> f1
[1] A B
Levels: A B
> f2
[1] A C
Levels: A C
> c(f1, f2)
[1] 1 2 1 2

or character vector if one of arguments is character

c(as.character(f1), f2)
[1] "A" "B" "1" "2"

this is OK, but not really wanted by the user. Code bellow show my
implementation of c.factor().

For the moment mapLevels() and c.factor() live in gdata package (from
version 2.3.1) - it has ben submitted to CRAN last night.

> install.packages("gdata")
> library(gdata)
## c.factor is not exported
> gdata:::c.factor(f1, f2)
[1] A B A C
Levels: A B C
> gdata:::c.factor(as.character(f1), f2)
[1] A B A C
Levels: A B C
> gdata:::c.factor(f1, as.character(f2))
[1] A B A C
Levels: A B C
> gdata:::c.factor(as.integer(f1), f2)
Error in mapLevels.default(X[[1]], ...) : mapLevels can only be used on
?factor? and ?character? atomic 'x'

As can be seen characters are handled in the same way as factors. Does
anyone see any value in this?

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc
----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From bcarvalh at jhsph.edu  Sat Nov 11 22:22:24 2006
From: bcarvalh at jhsph.edu (Benilton Carvalho)
Date: Sat, 11 Nov 2006 16:22:24 -0500
Subject: [Rd] Building R from the source
Message-ID: <3579E566-D289-4CC8-9998-2B67E28C748E@jhsph.edu>

Hi Everyone,

when building (say) R-2.4.0 from the source, is it still the  
recommendation to use GCC 3.4?

Thank you very much,

Benilton Carvalho
PhD Candidate
Department of Biostatistics
Johns Hopkins University


From ripley at stats.ox.ac.uk  Sat Nov 11 22:34:37 2006
From: ripley at stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sat, 11 Nov 2006 21:34:37 +0000 (GMT Standard Time)
Subject: [Rd] Building R from the source
In-Reply-To: <3579E566-D289-4CC8-9998-2B67E28C748E@jhsph.edu>
References: <3579E566-D289-4CC8-9998-2B67E28C748E@jhsph.edu>
Message-ID: <Pine.WNT.4.64.0611112127080.3696@Petrel>

On Sat, 11 Nov 2006, Benilton Carvalho wrote:

> Hi Everyone,
>
> when building (say) R-2.4.0 from the source, is it still the
> recommendation to use GCC 3.4?

It depends on your unstated OS.  There are recommendations in the R-admin 
manual, and those I wrote are still current.

Often one cannot easily mix systems based on gcc3 and gcc4: there are a lot 
of API incompatibilities, at least on 64-bit systems.  So if you have a 
gcc4-based Linux distribution (for example), use its 'native' compilers.

If you want more detailed advice, please give fuller details including 
your exact OS and what compilers you have available to you.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bcarvalh at jhsph.edu  Sat Nov 11 23:12:50 2006
From: bcarvalh at jhsph.edu (Benilton Carvalho)
Date: Sat, 11 Nov 2006 17:12:50 -0500
Subject: [Rd] Building R from the source
In-Reply-To: <Pine.WNT.4.64.0611112127080.3696@Petrel>
References: <3579E566-D289-4CC8-9998-2B67E28C748E@jhsph.edu>
	<Pine.WNT.4.64.0611112127080.3696@Petrel>
Message-ID: <FF2B93F6-2537-45D4-B4C3-69F753D1B093@jhsph.edu>

Professor Ripley,

thank you very much for your reply.

I'm currently trying to build R-2.4.0 from the source on a system  
(Xeon) running Fedora Core 4.

As for the available compilers: gcc/g++/gfortran/f95 (version 4.0.0-8)

Thank you very much,

Benilton Carvalho
PhD Candidate
Department of Biostatistics
Johns Hopkins University


On Nov 11, 2006, at 4:34 PM, Prof Brian D Ripley wrote:

>> when building (say) R-2.4.0 from the source, is it still the
>> recommendation to use GCC 3.4?
>
> If you want more detailed advice, please give fuller details  
> including your exact OS and what compilers you have available to you.


From ripley at stats.ox.ac.uk  Sat Nov 11 23:24:41 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 11 Nov 2006 22:24:41 +0000 (GMT)
Subject: [Rd] Building R from the source
In-Reply-To: <FF2B93F6-2537-45D4-B4C3-69F753D1B093@jhsph.edu>
References: <3579E566-D289-4CC8-9998-2B67E28C748E@jhsph.edu>
	<Pine.WNT.4.64.0611112127080.3696@Petrel>
	<FF2B93F6-2537-45D4-B4C3-69F753D1B093@jhsph.edu>
Message-ID: <Pine.LNX.4.64.0611112218590.15531@gannet.stats.ox.ac.uk>

On Sat, 11 Nov 2006, Benilton Carvalho wrote:

> Professor Ripley,
>
> thank you very much for your reply.
>
> I'm currently trying to build R-2.4.0 from the source on a system
> (Xeon) running Fedora Core 4.

And I still don't know if this is i686 or x86_64!

> As for the available compilers: gcc/g++/gfortran/f95 (version 4.0.0-8)

Ouch: I really would advise against those (they are the main reason why 
many of us skipped FC4 and CRAN ran its tests under gcc3 until later 
versions were available).  Probably best to update to 4.1.1, but I see 
4.0.2 is on the FC4 update area and this suggests that your OS is not
fully updated.


>
> Thank you very much,
>
> Benilton Carvalho
> PhD Candidate
> Department of Biostatistics
> Johns Hopkins University
>
>
> On Nov 11, 2006, at 4:34 PM, Prof Brian D Ripley wrote:
>
>>> when building (say) R-2.4.0 from the source, is it still the
>>> recommendation to use GCC 3.4?
>>
>> If you want more detailed advice, please give fuller details
>> including your exact OS and what compilers you have available to you.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rfrancois at mango-solutions.com  Sun Nov 12 11:31:42 2006
From: rfrancois at mango-solutions.com (Romain Francois)
Date: Sun, 12 Nov 2006 10:31:42 +0000
Subject: [Rd] invert argument in grep
In-Reply-To: <4554C3C5.6030306@stats.uwo.ca>
References: <4552FF83.6010001@mango-solutions.com>	<45544E94.3090303@stats.uwo.ca>
	<4554BC5C.9030203@mango-solutions.com>
	<4554C3C5.6030306@stats.uwo.ca>
Message-ID: <4556F80E.5020508@mango-solutions.com>

Duncan Murdoch wrote:
> On 11/10/2006 12:52 PM, Romain Francois wrote:
>> Duncan Murdoch wrote:
>>> On 11/9/2006 5:14 AM, Romain Francois wrote:
>>>> Hello,
>>>>
>>>> What about an `invert` argument in grep, to return elements that 
>>>> are *not* matching a regular expression :
>>>>
>>>> R> grep("pink", colors(), invert = TRUE, value = TRUE)
>>>>
>>>> would essentially return the same as :
>>>>
>>>> R> colors() [ - grep("pink", colors()) ]
>>>>
>>>>
>>>> I'm attaching the files that I modified (against today's tarball) 
>>>> for that purpose.
>>>
>>> I think a more generally useful change would be to be able to return 
>>> a logical vector with TRUE for a match and FALSE for a non-match, so 
>>> a simple !grep(...) does the inversion.  (This is motivated by the 
>>> recent R-help discussion of the fact that x[-selection] doesn't 
>>> always invert the selection when it's a vector of indices.)
>>>
>>> A way to do that without expanding the argument list would be to allow
>>>
>>> value="logical"
>>>
>>> as well as value=TRUE and value=FALSE.
>>>
>>> This would make boolean operations easy, e.g.
>>>
>>> colors()[grep("dark", colors(), value="logical")
>>>       & !grep("blue", colors(), value="logical")]
>>>
>>> to select the colors that contain "dark" but not "blue". (In this 
>>> case the RE to select that subset is rather simple because "dark" 
>>> always precedes "blue", but if that wasn't true, it would be a lot 
>>> messier.)
>>>
>>> Duncan Murdoch
>> Hi,
>>
>> It sounds like a nice thing to have. I would still prefer to type :
>>
>> R> grep ( "dark", grep("blue", colors(), value = TRUE, invert=TRUE), 
>> value = TRUE )  
>
> That's good for intersecting two searches, but not for other boolean 
> combinations.
>
> My main point was that inversion isn't the only boolean operation you 
> may want, but R has perfectly good powerful boolean operators, so 
> installing a limited subset of boolean algebra into grep() is probably 
> the wrong approach.

Hi,

Yes, good point. I agree with you that the value = "logical" is probably 
worth having to take advantage of these logical operators.

.... but, what about all these functions calling grep and passing 
arguments through the ellipsis. With this invert argument, we could do :

R> history(pattern = "grid\\..*\\(", invert = TRUE)

BTW, why not use ... in ls ? in case someone would like to use perl 
regex to use ls, or to get back at this thread, issue commands like :

R> ls("package:grid", pattern = "^grid\\.|Grob$", invert = TRUE)
 [1] "absolute.size"       "applyEdit"           "applyEdits"
 [4] "arcCurvature"        "arrow"               "childNames"
 [7] "convertHeight"       "convertNative"       "convertUnit"
[10] "convertWidth"        "convertX"            "convertY"
[13] "current.transform"   "current.viewport"    "current.vpPath"
[16] "current.vpTree"      "dataViewport"        "downViewport"
[19] "draw.details"        "drawDetails"         "editDetails"
[22] "engine.display.list" "gEdit"               "gEditList"
[25] "get.gpar"            "getNames"            "gList"
[28] "gpar"                "gPath"               "grob"
[31] "grobHeight"          "grobName"            "grobWidth"
[34] "grobX"               "grobY"               "gTree"
[37] "heightDetails"       "is.unit"             "layout.heights"
[40] "layoutRegion"        "layout.torture"      "layout.widths"
[43] "plotViewport"        "pop.viewport"        "popViewport"
[46] "postDrawDetails"     "preDrawDetails"      "push.viewport"
[49] "pushViewport"        "seekViewport"        "setChildren"
[52] "stringHeight"        "stringWidth"         "unit"
[55] "unit.c"              "unit.length"         "unit.pmax"
[58] "unit.pmin"           "unit.rep"            "upViewport"
[61] "validDetails"        "viewport"            "viewport.layout"
[64] "viewport.transform"  "vpList"              "vpPath"
[67] "vpStack"             "vpTree"              "widthDetails"
[70] "xDetails"            "yDetails"

Then, what about ... in apropos ?

Regards,

Romain


>>
>>
>> What about a way to pass more than one regular expression then be 
>> able to call :
>>
>> R> grep( c("dark", "blue"), colors(), value = TRUE, invert = c(TRUE, 
>> FALSE)
>
> Again, it covers & and !, but it misses other boolean operators.
>
>> I usually use that kind of shortcuts that are easy to remember.
>>
>> vgrep <- function(...) grep(..., value = TRUE)
>> igrep <- function(...) grep(..., invert = TRUE)
>> ivgrep <- vigrep <- function(...) grep(..., invert = TRUE, value = TRUE)
>
> If you're willing to write these, then it's easy to write igrep 
> without an invert arg to grep:
>
> igrep <- function(pat, x, ...)
>    setdiff(1:length(x), grep(pat, x, value = FALSE, ...))
>
> ivgrep would also be easy, except for the weird semantics of 
> value=TRUE pointed out by Brian:  but it could still be written with a 
> little bit of care.
>
> Duncan Murdoch
>
>>
>> What about things like the arguments `after` and `before` in unix 
>> grep. That could be used when grepping inside a function :
>>
>> R> grep("plot\\.", body(plot.default) , value= TRUE)
>> [1] "localWindow <- function(..., col, bg, pch, cex, lty, lwd) 
>> plot.window(...)"
>> [2] "plot.new()"
>> [3] "plot.xy(xy, type, ...)"
>>
>>
>> when this could be useful  (possibly).
>>
>> R> # grep("plot\\.", plot.default, after = 2, value = TRUE)
>> R> tmp <- tempfile(); sink(tmp) ; print(body(plot.default)); sink(); 
>> system( paste( "grep -A2 plot\\. ", tmp) )
>>     localWindow <- function(..., col, bg, pch, cex, lty, lwd) 
>> plot.window(...)
>>     localTitle <- function(..., col, bg, pch, cex, lty, lwd) title(...)
>>     xlabel <- if (!missing(x))
>> -- 
>>     plot.new()
>>     localWindow(xlim, ylim, log, asp, ...)
>>     panel.first
>>     plot.xy(xy, type, ...)
>>     panel.last
>>     if (axes) {
>> -- 
>>     if (frame.plot)
>>         localBox(...)
>>     if (ann)
>>
>>
>> BTW, if I call :
>>
>> R> grep("plot\\.", plot.default)
>> Error in as.character(x) : cannot coerce to vector
>>
>> What about adding that line at the beginning of grep, or something 
>> else to be able to do as.character on a function ?
>>
>> if(is.function(x)) x <- body(x)
>>
>>
>> Cheers,
>>
>> Romain
>>>>
>>>> Cheers,
>>>>
>>>> Romain
>>
>>
>
>


-- 
*mangosolutions*
/data analysis that delivers/

Tel   +44 1249 467 467
Fax   +44 1249 467 468


From ggrothendieck at gmail.com  Sun Nov 12 17:02:15 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 12 Nov 2006 11:02:15 -0500
Subject: [Rd] invert argument in grep
In-Reply-To: <4556F80E.5020508@mango-solutions.com>
References: <4552FF83.6010001@mango-solutions.com>
	<45544E94.3090303@stats.uwo.ca> <4554BC5C.9030203@mango-solutions.com>
	<4554C3C5.6030306@stats.uwo.ca> <4556F80E.5020508@mango-solutions.com>
Message-ID: <971536df0611120802i517581beoa3623260d83804ec@mail.gmail.com>

invert= would be consistent with the fact that egrep (-v), sed/vi (v) and
awk (~!) all have special facilities as indicated to handle such
negation/inversion.


On 11/12/06, Romain Francois <rfrancois at mango-solutions.com> wrote:
> Duncan Murdoch wrote:
> > On 11/10/2006 12:52 PM, Romain Francois wrote:
> >> Duncan Murdoch wrote:
> >>> On 11/9/2006 5:14 AM, Romain Francois wrote:
> >>>> Hello,
> >>>>
> >>>> What about an `invert` argument in grep, to return elements that
> >>>> are *not* matching a regular expression :
> >>>>
> >>>> R> grep("pink", colors(), invert = TRUE, value = TRUE)
> >>>>
> >>>> would essentially return the same as :
> >>>>
> >>>> R> colors() [ - grep("pink", colors()) ]
> >>>>
> >>>>
> >>>> I'm attaching the files that I modified (against today's tarball)
> >>>> for that purpose.
> >>>
> >>> I think a more generally useful change would be to be able to return
> >>> a logical vector with TRUE for a match and FALSE for a non-match, so
> >>> a simple !grep(...) does the inversion.  (This is motivated by the
> >>> recent R-help discussion of the fact that x[-selection] doesn't
> >>> always invert the selection when it's a vector of indices.)
> >>>
> >>> A way to do that without expanding the argument list would be to allow
> >>>
> >>> value="logical"
> >>>
> >>> as well as value=TRUE and value=FALSE.
> >>>
> >>> This would make boolean operations easy, e.g.
> >>>
> >>> colors()[grep("dark", colors(), value="logical")
> >>>       & !grep("blue", colors(), value="logical")]
> >>>
> >>> to select the colors that contain "dark" but not "blue". (In this
> >>> case the RE to select that subset is rather simple because "dark"
> >>> always precedes "blue", but if that wasn't true, it would be a lot
> >>> messier.)
> >>>
> >>> Duncan Murdoch
> >> Hi,
> >>
> >> It sounds like a nice thing to have. I would still prefer to type :
> >>
> >> R> grep ( "dark", grep("blue", colors(), value = TRUE, invert=TRUE),
> >> value = TRUE )
> >
> > That's good for intersecting two searches, but not for other boolean
> > combinations.
> >
> > My main point was that inversion isn't the only boolean operation you
> > may want, but R has perfectly good powerful boolean operators, so
> > installing a limited subset of boolean algebra into grep() is probably
> > the wrong approach.
>
> Hi,
>
> Yes, good point. I agree with you that the value = "logical" is probably
> worth having to take advantage of these logical operators.
>
> .... but, what about all these functions calling grep and passing
> arguments through the ellipsis. With this invert argument, we could do :
>
> R> history(pattern = "grid\\..*\\(", invert = TRUE)
>
> BTW, why not use ... in ls ? in case someone would like to use perl
> regex to use ls, or to get back at this thread, issue commands like :
>
> R> ls("package:grid", pattern = "^grid\\.|Grob$", invert = TRUE)
>  [1] "absolute.size"       "applyEdit"           "applyEdits"
>  [4] "arcCurvature"        "arrow"               "childNames"
>  [7] "convertHeight"       "convertNative"       "convertUnit"
> [10] "convertWidth"        "convertX"            "convertY"
> [13] "current.transform"   "current.viewport"    "current.vpPath"
> [16] "current.vpTree"      "dataViewport"        "downViewport"
> [19] "draw.details"        "drawDetails"         "editDetails"
> [22] "engine.display.list" "gEdit"               "gEditList"
> [25] "get.gpar"            "getNames"            "gList"
> [28] "gpar"                "gPath"               "grob"
> [31] "grobHeight"          "grobName"            "grobWidth"
> [34] "grobX"               "grobY"               "gTree"
> [37] "heightDetails"       "is.unit"             "layout.heights"
> [40] "layoutRegion"        "layout.torture"      "layout.widths"
> [43] "plotViewport"        "pop.viewport"        "popViewport"
> [46] "postDrawDetails"     "preDrawDetails"      "push.viewport"
> [49] "pushViewport"        "seekViewport"        "setChildren"
> [52] "stringHeight"        "stringWidth"         "unit"
> [55] "unit.c"              "unit.length"         "unit.pmax"
> [58] "unit.pmin"           "unit.rep"            "upViewport"
> [61] "validDetails"        "viewport"            "viewport.layout"
> [64] "viewport.transform"  "vpList"              "vpPath"
> [67] "vpStack"             "vpTree"              "widthDetails"
> [70] "xDetails"            "yDetails"
>
> Then, what about ... in apropos ?
>
> Regards,
>
> Romain
>
>
> >>
> >>
> >> What about a way to pass more than one regular expression then be
> >> able to call :
> >>
> >> R> grep( c("dark", "blue"), colors(), value = TRUE, invert = c(TRUE,
> >> FALSE)
> >
> > Again, it covers & and !, but it misses other boolean operators.
> >
> >> I usually use that kind of shortcuts that are easy to remember.
> >>
> >> vgrep <- function(...) grep(..., value = TRUE)
> >> igrep <- function(...) grep(..., invert = TRUE)
> >> ivgrep <- vigrep <- function(...) grep(..., invert = TRUE, value = TRUE)
> >
> > If you're willing to write these, then it's easy to write igrep
> > without an invert arg to grep:
> >
> > igrep <- function(pat, x, ...)
> >    setdiff(1:length(x), grep(pat, x, value = FALSE, ...))
> >
> > ivgrep would also be easy, except for the weird semantics of
> > value=TRUE pointed out by Brian:  but it could still be written with a
> > little bit of care.
> >
> > Duncan Murdoch
> >
> >>
> >> What about things like the arguments `after` and `before` in unix
> >> grep. That could be used when grepping inside a function :
> >>
> >> R> grep("plot\\.", body(plot.default) , value= TRUE)
> >> [1] "localWindow <- function(..., col, bg, pch, cex, lty, lwd)
> >> plot.window(...)"
> >> [2] "plot.new()"
> >> [3] "plot.xy(xy, type, ...)"
> >>
> >>
> >> when this could be useful  (possibly).
> >>
> >> R> # grep("plot\\.", plot.default, after = 2, value = TRUE)
> >> R> tmp <- tempfile(); sink(tmp) ; print(body(plot.default)); sink();
> >> system( paste( "grep -A2 plot\\. ", tmp) )
> >>     localWindow <- function(..., col, bg, pch, cex, lty, lwd)
> >> plot.window(...)
> >>     localTitle <- function(..., col, bg, pch, cex, lty, lwd) title(...)
> >>     xlabel <- if (!missing(x))
> >> --
> >>     plot.new()
> >>     localWindow(xlim, ylim, log, asp, ...)
> >>     panel.first
> >>     plot.xy(xy, type, ...)
> >>     panel.last
> >>     if (axes) {
> >> --
> >>     if (frame.plot)
> >>         localBox(...)
> >>     if (ann)
> >>
> >>
> >> BTW, if I call :
> >>
> >> R> grep("plot\\.", plot.default)
> >> Error in as.character(x) : cannot coerce to vector
> >>
> >> What about adding that line at the beginning of grep, or something
> >> else to be able to do as.character on a function ?
> >>
> >> if(is.function(x)) x <- body(x)
> >>
> >>
> >> Cheers,
> >>
> >> Romain
> >>>>
> >>>> Cheers,
> >>>>
> >>>> Romain
> >>
> >>
> >
> >
>
>
> --
> *mangosolutions*
> /data analysis that delivers/
>
> Tel   +44 1249 467 467
> Fax   +44 1249 467 468
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From rmh at temple.edu  Mon Nov 13 05:28:26 2006
From: rmh at temple.edu (rmh at temple.edu)
Date: Mon, 13 Nov 2006 05:28:26 +0100 (CET)
Subject: [Rd] inconsistency or bug in coef() (PR#9358)
Message-ID: <20061113042826.AED5AA1AA@slim.kubism.ku.dk>

tmp <- data.frame(x=c(1,1),
                  y=c(1,2))

tmp.lm <- lm(y ~ x, data=tmp)
summary(tmp.lm)

coef(summary(tmp.lm))

## I consider this to be a bug.  Since summary(tmp.lm) gives
## two rows for the coefficients, I believe the coef() function
## should also give two rows.



> summary(tmp.lm)

Call:
lm(formula = y ~ x, data = tmp)

Residuals:
   1    2 
-0.5  0.5 

Coefficients: (1 not defined because of singularities)
            Estimate Std. Error t value Pr(>|t|)
(Intercept)      1.5        0.5       3    0.205
x                 NA         NA      NA       NA

Residual standard error: 0.7071 on 1 degrees of freedom

> coef(summary(tmp.lm))
            Estimate Std. Error t value  Pr(>|t|)
(Intercept)      1.5        0.5       3 0.2048328
> 
> version
               _                           
platform       i386-pc-mingw32             
arch           i386                        
os             mingw32                     
system         i386, mingw32               
status                                     
major          2                           
minor          4.0                         
year           2006                        
month          10                          
day            03                          
svn rev        39566                       
language       R                           
version.string R version 2.4.0 (2006-10-03)
> 


## this is a related problem

tmp <- data.frame(x=c(1,2),
                  y=c(1,2))

tmp.lm <- lm(y ~ x, data=tmp)
summary(tmp.lm)

coef(summary(tmp.lm))

## Here the summary() give NA for the values that can't be
## calculated and the coef() function gives NaN.  I think both
## functions should return the same result.


> summary(tmp.lm)

Call:
lm(formula = y ~ x, data = tmp)

Residuals:
ALL 2 residuals are 0: no residual degrees of freedom!

Coefficients:
            Estimate Std. Error t value Pr(>|t|)
(Intercept)        0         NA      NA       NA
x                  1         NA      NA       NA

Residual standard error: NaN on 0 degrees of freedom
Multiple R-Squared:     1,      Adjusted R-squared:   NaN 
F-statistic:   NaN on 1 and 0 DF,  p-value: NA 

> 
> coef(summary(tmp.lm))
            Estimate Std. Error t value Pr(>|t|)
(Intercept)        0        NaN     NaN      NaN
x                  1        NaN     NaN      NaN
> 
>


From bcarvalh at jhsph.edu  Mon Nov 13 05:37:47 2006
From: bcarvalh at jhsph.edu (Benilton Carvalho)
Date: Sun, 12 Nov 2006 23:37:47 -0500
Subject: [Rd] inconsistency or bug in coef() (PR#9358)
In-Reply-To: <20061113042826.AED5AA1AA@slim.kubism.ku.dk>
References: <20061113042826.AED5AA1AA@slim.kubism.ku.dk>
Message-ID: <ADBEE795-50E8-42FC-AAFD-2FD419FE84A4@jhsph.edu>

it doesn't appear to be a bug for me, given that one of your  
coefficients is NA due to linear dependencies on your design matrix.

i prefer to think of it as a feature :-) (show only the coefficients  
for the variables that do not show linear dependencies).

x=1:5
y=c(1:3, 7, 6)
fit=lm(y~x)
coef(fit)
coef(summary(fit))

b

On Nov 12, 2006, at 11:28 PM, rmh at temple.edu wrote:

> tmp <- data.frame(x=c(1,1),
>                   y=c(1,2))
>
> tmp.lm <- lm(y ~ x, data=tmp)
> summary(tmp.lm)
>
> coef(summary(tmp.lm))
>
> ## I consider this to be a bug.  Since summary(tmp.lm) gives
> ## two rows for the coefficients, I believe the coef() function
> ## should also give two rows.
>
>
>
>> summary(tmp.lm)
>
> Call:
> lm(formula = y ~ x, data = tmp)
>
> Residuals:
>    1    2
> -0.5  0.5
>
> Coefficients: (1 not defined because of singularities)
>             Estimate Std. Error t value Pr(>|t|)
> (Intercept)      1.5        0.5       3    0.205
> x                 NA         NA      NA       NA
>
> Residual standard error: 0.7071 on 1 degrees of freedom
>
>> coef(summary(tmp.lm))
>             Estimate Std. Error t value  Pr(>|t|)
> (Intercept)      1.5        0.5       3 0.2048328
>>
>> version
>                _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          4.0
> year           2006
> month          10
> day            03
> svn rev        39566
> language       R
> version.string R version 2.4.0 (2006-10-03)
>>
>
>
> ## this is a related problem
>
> tmp <- data.frame(x=c(1,2),
>                   y=c(1,2))
>
> tmp.lm <- lm(y ~ x, data=tmp)
> summary(tmp.lm)
>
> coef(summary(tmp.lm))
>
> ## Here the summary() give NA for the values that can't be
> ## calculated and the coef() function gives NaN.  I think both
> ## functions should return the same result.
>
>
>> summary(tmp.lm)
>
> Call:
> lm(formula = y ~ x, data = tmp)
>
> Residuals:
> ALL 2 residuals are 0: no residual degrees of freedom!
>
> Coefficients:
>             Estimate Std. Error t value Pr(>|t|)
> (Intercept)        0         NA      NA       NA
> x                  1         NA      NA       NA
>
> Residual standard error: NaN on 0 degrees of freedom
> Multiple R-Squared:     1,      Adjusted R-squared:   NaN
> F-statistic:   NaN on 1 and 0 DF,  p-value: NA
>
>>
>> coef(summary(tmp.lm))
>             Estimate Std. Error t value Pr(>|t|)
> (Intercept)        0        NaN     NaN      NaN
> x                  1        NaN     NaN      NaN
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mgkim at seowon.ac.kr  Mon Nov 13 05:40:11 2006
From: mgkim at seowon.ac.kr (mgkim at seowon.ac.kr)
Date: Mon, 13 Nov 2006 05:40:11 +0100 (CET)
Subject: [Rd] "stem" does not give a correct answer (PR#9359)
Message-ID: <20061113044011.61CB53D747@slim.kubism.ku.dk>

Full_Name: Myung Geun Kim
Version: 2.4.0
OS: Window XP
Submission from: (NULL) (210.110.8.105)


For the data c1 of size 14, stem provides the following result.

**************************************************************
>c1
 [1] 14 39 70 11 38 20 37 15 41 74 74 34 48 51
ZZangi>stem(c1)

  The decimal point is 1 digit(s) to the right of the |

  0 | 145
  2 | 04789
  4 | 181
  6 | 044

**************************************************************
However, stem does not give a correct answer, for example 34, 74, etc.


From berwin at maths.uwa.edu.au  Mon Nov 13 07:16:18 2006
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Mon, 13 Nov 2006 14:16:18 +0800
Subject: [Rd] "stem" does not give a correct answer (PR#9359)
In-Reply-To: <20061113044011.61CB53D747@slim.kubism.ku.dk>
References: <20061113044011.61CB53D747@slim.kubism.ku.dk>
Message-ID: <17752.3506.647574.792102@bossiaea.maths.uwa.edu.au>

G' day Myung,

>>>>> "MGK" == mgkim  <mgkim at seowon.ac.kr> writes:

    MGK> For the data c1 of size 14, stem provides the following result.

    MGK> **************************************************************
    >> c1
    MGK> [1] 14 39 70 11 38 20 37 15 41 74 74 34 48 51
    ZZangi> stem(c1)

    MGK> The decimal point is 1 digit(s) to the right of the |

    MGK> 0 | 145
    MGK> 2 | 04789
    MGK> 4 | 181
    MGK> 6 | 044

    MGK> **************************************************************
    MGK> However, stem does not give a correct answer, for example 34, 74, etc.

No bug, it is just the scale to which stem decides to plot by
default.  The line 

        4 | 181

should give a clue that this summarises 41, 48 and 51.  Since the data
is so sparse only even leading numbers are used.  Try:

> dat <- c(14, 39, 70, 11, 38, 20, 37, 15, 41, 74, 74, 34, 48, 51)
> stem(dat)

  The decimal point is 1 digit(s) to the right of the |

  0 | 145
  2 | 04789
  4 | 181
  6 | 044

> stem(dat, scale=2)

  The decimal point is 1 digit(s) to the right of the |

  1 | 145
  2 | 0
  3 | 4789
  4 | 18
  5 | 1
  6 | 
  7 | 044

Cheers,

        Berwin

========================== Full address ============================
Berwin A Turlach                      Tel.: +61 (8) 6488 3338 (secr)   
School of Mathematics and Statistics        +61 (8) 6488 3383 (self)      
The University of Western Australia   FAX : +61 (8) 6488 1028
35 Stirling Highway                   
Crawley WA 6009                e-mail: berwin at maths.uwa.edu.au
Australia                        http://www.maths.uwa.edu.au/~berwin


From ripley at stats.ox.ac.uk  Mon Nov 13 09:06:29 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 13 Nov 2006 09:06:29 +0100 (CET)
Subject: [Rd] inconsistency or bug in coef() (PR#9358)
Message-ID: <20061113080629.3209856229@slim.kubism.ku.dk>

On Mon, 13 Nov 2006, rmh at temple.edu wrote:

> tmp <- data.frame(x=c(1,1),
>                  y=c(1,2))
>
> tmp.lm <- lm(y ~ x, data=tmp)
> summary(tmp.lm)
>
> coef(summary(tmp.lm))
>
> ## I consider this to be a bug.  Since summary(tmp.lm) gives
> ## two rows for the coefficients, I believe the coef() function
> ## should also give two rows.

That claim is false: it is print.summary.lm that is giving two lines, not 
the result of summary.lm: try

unclass(summary(tmp.lm))

This is also clear from the Value section of ?summary.lm, whose See Also 
says

      Function 'coef' will extract the matrix of coefficients with
      standard errors, t-statistics and p-values.

The point is that the print method is making use of both the $coefficients 
and the $aliased components.

I really do think this is clear from reading the help page: did you 
actually cross-check before sending a bug report?

>
>
>
>> summary(tmp.lm)
>
> Call:
> lm(formula = y ~ x, data = tmp)
>
> Residuals:
>   1    2
> -0.5  0.5
>
> Coefficients: (1 not defined because of singularities)
>            Estimate Std. Error t value Pr(>|t|)
> (Intercept)      1.5        0.5       3    0.205
> x                 NA         NA      NA       NA
>
> Residual standard error: 0.7071 on 1 degrees of freedom
>
>> coef(summary(tmp.lm))
>            Estimate Std. Error t value  Pr(>|t|)
> (Intercept)      1.5        0.5       3 0.2048328
>>
>> version
>               _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          4.0
> year           2006
> month          10
> day            03
> svn rev        39566
> language       R
> version.string R version 2.4.0 (2006-10-03)
>>
>
>
> ## this is a related problem
>
> tmp <- data.frame(x=c(1,2),
>                  y=c(1,2))
>
> tmp.lm <- lm(y ~ x, data=tmp)
> summary(tmp.lm)
>
> coef(summary(tmp.lm))
>
> ## Here the summary() give NA for the values that can't be
> ## calculated and the coef() function gives NaN.  I think both
> ## functions should return the same result.
>
>
>> summary(tmp.lm)
>
> Call:
> lm(formula = y ~ x, data = tmp)
>
> Residuals:
> ALL 2 residuals are 0: no residual degrees of freedom!
>
> Coefficients:
>            Estimate Std. Error t value Pr(>|t|)
> (Intercept)        0         NA      NA       NA
> x                  1         NA      NA       NA
>
> Residual standard error: NaN on 0 degrees of freedom
> Multiple R-Squared:     1,      Adjusted R-squared:   NaN
> F-statistic:   NaN on 1 and 0 DF,  p-value: NA
>
>>
>> coef(summary(tmp.lm))
>            Estimate Std. Error t value Pr(>|t|)
> (Intercept)        0        NaN     NaN      NaN
> x                  1        NaN     NaN      NaN
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bolker at zoo.ufl.edu  Mon Nov 13 14:31:13 2006
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Mon, 13 Nov 2006 08:31:13 -0500
Subject: [Rd] bug in lrect [lattice]?
Message-ID: <455873A1.4060809@zoo.ufl.edu>


In lattice version 0.14-11 (2006/10/23), there appears
to be a small bug in lrect [lattice]: border is set to NULL
accidentally.  It is easily fixed by adding one line
to lrect -- see example and hack below ...

  I wasn't sure if this should be submitted as an R bug
since it is part of a package, but a core/recommended package ...

  Ben Bolker


x = runif(100)
y = runif(100)

my.lrect <- function (xleft, ybottom, xright, ytop, x = (xleft + xright)/2,
    y = (ybottom + ytop)/2, width = xright - xleft, height = ytop -
        ybottom, col = "transparent", border = "black", lty = 1,
    lwd = 1, alpha = 1, just = "center", hjust = NULL, vjust = NULL,
    ...)
{
  if (missing(border))  ## this line fixes it
    border <- if (all(is.na(border)))
      "transparent"
    else if (is.logical(border)) {
      if (border)
        "black"
      else "transparent"
    }
  grid:::grid.rect(x = x, y = y, width = width, height = height,
default.units = "native",
        just = just, hjust = hjust, vjust = vjust, gp = grid:::gpar(fill
= col,
            col = border, lty = lty, lwd = lwd, alpha = alpha,
                                                     ...))
}

ranrect <- function(s,fun=lrect) {
  coords <- runif(2,s/2,1-s/2)
  fun(coords[1]-s/2,coords[2]-s/2,coords[1]+s/2,coords[2]+s/2,
        border="red",lwd=2)
}

library(lattice)
## with original lrect: border is black rather than red
xyplot(y~x,
       panel=function(...) {
         panel.xyplot(...)
         ranrect(s=0.12)
       })

## new lrect: works
xyplot(y~x,
       panel=function(...) {
         panel.xyplot(...)
         ranrect(s=0.12,fun=my.lrect)
       })

 version
               _
platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status
major          2
minor          4.0
year           2006
month          10
day            03
svn rev        39566
language       R
version.string R version 2.4.0 (2006-10-03)



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 254 bytes
Desc: OpenPGP digital signature
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20061113/4fcfeb6c/attachment.bin 

From rmh at temple.edu  Mon Nov 13 15:46:22 2006
From: rmh at temple.edu (rmh at temple.edu)
Date: Mon, 13 Nov 2006 15:46:22 +0100 (CET)
Subject: [Rd] inconsistency or bug in coef() (PR#9358)
Message-ID: <20061113144622.A0A7C572D9@slim.kubism.ku.dk>

I am fascinated.  I can accept the argument that suppressing aliased
values is a valid behavior of the program.  The defense of the inconsistency
between the two displays surprises me.

Yes, Brian, I checked.  That's why I offered the option of an inconsistency.
I do believe strongly that the coef section of summary and the coef function
should give identical results.

I still think the inconsistency is a bug.  I think the author of the
print.summary.lm did the right thing by showing the requested coef for
the x variable and giving it a missing value.

Rich


From aimcleod at uwo.ca  Mon Nov 13 16:30:14 2006
From: aimcleod at uwo.ca (aimcleod at uwo.ca)
Date: Mon, 13 Nov 2006 16:30:14 +0100 (CET)
Subject: [Rd] bug in acf (PR#9360)
Message-ID: <20061113153014.53F2E572ED@slim.kubism.ku.dk>

Full_Name: Ian McLeod
Version: 2.3.1
OS: Windows
Submission from: (NULL) (129.100.76.136)


> There is a simple bug in acf as shown below:
> 
> z <- 1
> acf(z,lag.max=1,plot=FALSE)
> Error in acf(z, lag.max = 1, plot = FALSE) :
>        'lag.max' must be at least 1
> 
This is certainly a bug.

There are two problems:

(i) the error message is wrong since lag.max is set to 1.  Perhaps, if the
function acf can not be used for in this situaiton, a different error message
would be more appropriate.  I understand why this might be done but I don't
think it is the best approach.

(ii) Please look at the function GetB which is attached.  This is part a
computation for a fast algorithm for exact mle of mean.  Usually phi here are
the coefficients from a high order AR but when I tried for AR(1) I got the error
message.  So the workaround is given.  Notice that I use: 

p*as.vector(acf(phi,lag.max=p,type="covariance",demean=FALSE,plot=FALSE)$acf)

so what I expect to get when p=length(phi)=1 is just phi^2.  This is what
happens in Mathematica with ListCorrelate[{phi},{phi}].  When you have
acf="correlation" and demean=TRUE then one gets 0/0 which should be defined as 1
in this situation.

Probably if the R authors just want to use acf for data analysis they may simply
choose to require length(x)>1 in acf(x,...) although I don't see the harm in my
suggestion either.

Ian McLeod


From murdoch at stats.uwo.ca  Mon Nov 13 17:22:09 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 13 Nov 2006 11:22:09 -0500
Subject: [Rd] bug in acf (PR#9360)
In-Reply-To: <20061113153014.53F2E572ED@slim.kubism.ku.dk>
References: <20061113153014.53F2E572ED@slim.kubism.ku.dk>
Message-ID: <45589BB1.6050305@stats.uwo.ca>

On 11/13/2006 10:30 AM, aimcleod at uwo.ca wrote:
> Full_Name: Ian McLeod
> Version: 2.3.1
> OS: Windows
> Submission from: (NULL) (129.100.76.136)
> 
> 
>> There is a simple bug in acf as shown below:
>> 
>> z <- 1
>> acf(z,lag.max=1,plot=FALSE)
>> Error in acf(z, lag.max = 1, plot = FALSE) :
>>        'lag.max' must be at least 1
>> 
> This is certainly a bug.

I'd say it's a documentation bug, rather than a code bug.
> 
> There are two problems:
> 
> (i) the error message is wrong since lag.max is set to 1.  Perhaps, if the
> function acf can not be used for in this situaiton, a different error message
> would be more appropriate.  I understand why this might be done but I don't
> think it is the best approach.

What happens is that lag.max is reduced to length(z)-1, which is zero in 
your case.  This change should be mentioned in the documentation.

> (ii) Please look at the function GetB which is attached.  This is part a
> computation for a fast algorithm for exact mle of mean.  Usually phi here are
> the coefficients from a high order AR but when I tried for AR(1) I got the error
> message.  So the workaround is given.  Notice that I use: 
> 
> p*as.vector(acf(phi,lag.max=p,type="covariance",demean=FALSE,plot=FALSE)$acf)
> 
> so what I expect to get when p=length(phi)=1 is just phi^2.  This is what
> happens in Mathematica with ListCorrelate[{phi},{phi}].  When you have
> acf="correlation" and demean=TRUE then one gets 0/0 which should be defined as 1
> in this situation.

I don't think that's a reasonable expectation.  You've got an empty sum 
in the formula for the lag 1 autocovariance:

sum_{i=1}^0 phi_i phi_{i+1}

R is assuming that's not what you meant and is reporting it as an error. 
  If it gave you any value, it should be zero, not phi^2.

Duncan Murdoch

> 
> Probably if the R authors just want to use acf for data analysis they may simply
> choose to require length(x)>1 in acf(x,...) although I don't see the harm in my
> suggestion either.


From bill at insightful.com  Mon Nov 13 18:09:52 2006
From: bill at insightful.com (bill at insightful.com)
Date: Mon, 13 Nov 2006 18:09:52 +0100 (CET)
Subject: [Rd] readBin(what="character",
	n=overcount)->extra "" in result (PR#9361)
Message-ID: <20061113170952.4B2CB3D747@slim.kubism.ku.dk>

Full_Name: Bill Dunlap
Version: 2.4.0
OS: Windows XP
Submission from: (NULL) (208.252.71.182)


When I use readBin() to read an unknown number
of null-terminated strings from a file by supplying
an overcount as the n= argument, it appends an empty
string to the result.

> tf<-tempfile()
> strings<-c("One","Two","Three")
> writeBin(strings, con=tf)
> readBin(con=tf,what="character",n=100) # expect "One","Two","Three" only
[1] "One"   "Two"   "Three" ""     
> readBin(con=tf,what="integer",size=1,signed=FALSE,n=100)
 [1]  79 110 101   0  84 119 111   0  84 104 114 101 101   0
> unlink(tf)

> version
               _                           
platform       i386-pc-mingw32             
arch           i386                        
os             mingw32                     
system         i386, mingw32               
status                                     
major          2                           
minor          4.0                         
year           2006                        
month          10                          
day            03                          
svn rev        39566                       
language       R                           
version.string R version 2.4.0 (2006-10-03)


From tpapp at princeton.edu  Mon Nov 13 20:00:00 2006
From: tpapp at princeton.edu (tpapp at princeton.edu)
Date: Mon, 13 Nov 2006 20:00:00 +0100 (CET)
Subject: [Rd] wishlist: xlim in lines.polynomial (PR#9362)
Message-ID: <20061113190000.CA63E572DC@slim.kubism.ku.dk>

Full_Name: Tamas K Papp
Version: 2.4.0
OS: linux
Submission from: (NULL) (140.180.166.160)


I was using the lines.polynomial method for plotting piecewise polynomials
(parts of splines).  I needed a feature to limit the range of plotting using a
parameter given to the function (as opposed to par("usr")).  I think that the
following changes would be a nice addition:

lines.polynomial <- function (x, len = 100, xlim=par("usr")[1:2],
                              ylim=par("usr")[3:4],...)
{
    p <- x
    x <- seq(xlim[1], xlim[2], len = len)
    y <- predict(p, x)
    y[y <= ylim[1] | y >= ylim[2]] <- NA
    lines(x, y, ...)
}

Package:       polynom
Version:       1.2-3
Date:          2006-09-09


From deepayan.sarkar at gmail.com  Mon Nov 13 20:14:44 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Mon, 13 Nov 2006 11:14:44 -0800
Subject: [Rd] bug in lrect [lattice]?
In-Reply-To: <455873A1.4060809@zoo.ufl.edu>
References: <455873A1.4060809@zoo.ufl.edu>
Message-ID: <eb555e660611131114v7d302c63x1e2cd31821c1d71f@mail.gmail.com>

On 11/13/06, Ben Bolker <bolker at zoo.ufl.edu> wrote:
>
> In lattice version 0.14-11 (2006/10/23), there appears
> to be a small bug in lrect [lattice]: border is set to NULL
> accidentally.

Yes, this bug was probably introduced while trying to fix PR#9307. But
that was three whole weeks ago. Run update.packages() and try again
:-)

-Deepayan


From aim at stats.uwo.ca  Mon Nov 13 20:24:45 2006
From: aim at stats.uwo.ca (A.I. McLeod)
Date: Mon, 13 Nov 2006 14:24:45 -0500
Subject: [Rd] bug in acf (PR#9360)
References: <20061113153014.53F2E572ED@slim.kubism.ku.dk>
	<45589BB1.6050305@stats.uwo.ca>
Message-ID: <001901c70759$63690820$884c6481@stats2.uwo.ca>

> I don't think that's a reasonable expectation.  You've got an empty sum 
> in the formula for the lag 1 autocovariance:
> 
> sum_{i=1}^0 phi_i phi_{i+1}
> 
> R is assuming that's not what you meant and is reporting it as an error. 
>  If it gave you any value, it should be zero, not phi^2.
> 
********************************************
I agree the empty sum which is the lag 1 autocovariance should be zero but this is the SECOND term in $acf output.
For the first term,
1) if demean=F, it is variance which is phi^2 as I suggested
2) if demean=T, it is the variance/variance = 0/0 which I said should best be 1


----- Original Message ----- 
From: "Duncan Murdoch" <murdoch at stats.uwo.ca>
To: <aimcleod at uwo.ca>
Cc: <r-devel at stat.math.ethz.ch>; <R-bugs at biostat.ku.dk>
Sent: Monday, November 13, 2006 11:22 AM
Subject: Re: [Rd] bug in acf (PR#9360)


> On 11/13/2006 10:30 AM, aimcleod at uwo.ca wrote:
>> Full_Name: Ian McLeod
>> Version: 2.3.1
>> OS: Windows
>> Submission from: (NULL) (129.100.76.136)
>> 
>> 
>>> There is a simple bug in acf as shown below:
>>> 
>>> z <- 1
>>> acf(z,lag.max=1,plot=FALSE)
>>> Error in acf(z, lag.max = 1, plot = FALSE) :
>>>        'lag.max' must be at least 1
>>> 
>> This is certainly a bug.
> 
> I'd say it's a documentation bug, rather than a code bug.
>> 
>> There are two problems:
>> 
>> (i) the error message is wrong since lag.max is set to 1.  Perhaps, if the
>> function acf can not be used for in this situaiton, a different error message
>> would be more appropriate.  I understand why this might be done but I don't
>> think it is the best approach.
> 
> What happens is that lag.max is reduced to length(z)-1, which is zero in 
> your case.  This change should be mentioned in the documentation.
> 
>> (ii) Please look at the function GetB which is attached.  This is part a
>> computation for a fast algorithm for exact mle of mean.  Usually phi here are
>> the coefficients from a high order AR but when I tried for AR(1) I got the error
>> message.  So the workaround is given.  Notice that I use: 
>> 
>> p*as.vector(acf(phi,lag.max=p,type="covariance",demean=FALSE,plot=FALSE)$acf)
>> 
>> so what I expect to get when p=length(phi)=1 is just phi^2.  This is what
>> happens in Mathematica with ListCorrelate[{phi},{phi}].  When you have
>> acf="correlation" and demean=TRUE then one gets 0/0 which should be defined as 1
>> in this situation.
> 
> I don't think that's a reasonable expectation.  You've got an empty sum 
> in the formula for the lag 1 autocovariance:
> 
> sum_{i=1}^0 phi_i phi_{i+1}
> 
> R is assuming that's not what you meant and is reporting it as an error. 
>  If it gave you any value, it should be zero, not phi^2.
> 
> Duncan Murdoch
> 
>> 
>> Probably if the R authors just want to use acf for data analysis they may simply
>> choose to require length(x)>1 in acf(x,...) although I don't see the harm in my
>> suggestion either.


From ripley at stats.ox.ac.uk  Mon Nov 13 20:49:23 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 13 Nov 2006 19:49:23 +0000 (GMT Standard Time)
Subject: [Rd] wishlist: xlim in lines.polynomial (PR#9362)
In-Reply-To: <20061113190000.CA63E572DC@slim.kubism.ku.dk>
References: <20061113190000.CA63E572DC@slim.kubism.ku.dk>
Message-ID: <Pine.WNT.4.64.0611131946450.600@auk>

'polynom' is a contributed package, so using R-bugs is inappropriate. 
Please do read the R FAQ and note what it says about contributed packages.

Since in particular it is an R port of an S(-PLUS) library section, author 
!= maintainer and probably both should agree to this.

On Mon, 13 Nov 2006, tpapp at princeton.edu wrote:

> Full_Name: Tamas K Papp
> Version: 2.4.0
> OS: linux
> Submission from: (NULL) (140.180.166.160)
>
>
> I was using the lines.polynomial method for plotting piecewise polynomials
> (parts of splines).  I needed a feature to limit the range of plotting using a
> parameter given to the function (as opposed to par("usr")).  I think that the
> following changes would be a nice addition:
>
> lines.polynomial <- function (x, len = 100, xlim=par("usr")[1:2],
>                              ylim=par("usr")[3:4],...)
> {
>    p <- x
>    x <- seq(xlim[1], xlim[2], len = len)
>    y <- predict(p, x)
>    y[y <= ylim[1] | y >= ylim[2]] <- NA
>    lines(x, y, ...)
> }
>
> Package:       polynom
> Version:       1.2-3
> Date:          2006-09-09
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From aim at stats.uwo.ca  Mon Nov 13 20:55:26 2006
From: aim at stats.uwo.ca (A.I. McLeod)
Date: Mon, 13 Nov 2006 14:55:26 -0500
Subject: [Rd] bug in acf (PR#9360) S-Plus Addendum
References: <20061113153014.53F2E572ED@slim.kubism.ku.dk>
	<45589BB1.6050305@stats.uwo.ca>
Message-ID: <000f01c7075d$acd1ebe0$884c6481@stats2.uwo.ca>

Here is the result from S-Plus V.8.
> acf(1,lag.max=1,type="covariance",plot=F)
Call: acf(x = 1, lag.max = 1, type = "covariance", plot = F)

Autocovariances matrix:
  lag X2
1   0  0
2   1  0

Their function does not support the demean option, so the variance is zero but they set 0/0 to 0 instead of 1.  The empty sum is 
zero (that is a standard mathematical convention which S+ follows).  I still think *one* would be better for the correlation at lag 
*zero* since the autocorrelation function at lag *zero* is defined as this in every other case.  As I tried to explain before for 
some algorithms involving the computation of correlations and convolutions, it is more convenient to have this first term (lag zero) 
always set to *one*.  Otherwise it has be treated as a special case as in my GetB function which I showed you.

I guess it is not that important but I think it should be treated as more than a documentation bug!!  Knuth once said that after TeX 
reach Version 3.14 all bugs would just be declared "special features".  That would be another way to handle too.

For "canned data analysis" as opposed to "programming", it really doesn't matter at all how you handle this problem.

Ian McLeod


----- Original Message ----- 
From: "Duncan Murdoch" <murdoch at stats.uwo.ca>
To: <aimcleod at uwo.ca>
Cc: <r-devel at stat.math.ethz.ch>; <R-bugs at biostat.ku.dk>
Sent: Monday, November 13, 2006 11:22 AM
Subject: Re: [Rd] bug in acf (PR#9360)


> On 11/13/2006 10:30 AM, aimcleod at uwo.ca wrote:
>> Full_Name: Ian McLeod
>> Version: 2.3.1
>> OS: Windows
>> Submission from: (NULL) (129.100.76.136)
>>
>>
>>> There is a simple bug in acf as shown below:
>>>
>>> z <- 1
>>> acf(z,lag.max=1,plot=FALSE)
>>> Error in acf(z, lag.max = 1, plot = FALSE) :
>>>        'lag.max' must be at least 1
>>>
>> This is certainly a bug.
>
> I'd say it's a documentation bug, rather than a code bug.
>>
>> There are two problems:
>>
>> (i) the error message is wrong since lag.max is set to 1.  Perhaps, if the
>> function acf can not be used for in this situaiton, a different error message
>> would be more appropriate.  I understand why this might be done but I don't
>> think it is the best approach.
>
> What happens is that lag.max is reduced to length(z)-1, which is zero in your case.  This change should be mentioned in the 
> documentation.
>
>> (ii) Please look at the function GetB which is attached.  This is part a
>> computation for a fast algorithm for exact mle of mean.  Usually phi here are
>> the coefficients from a high order AR but when I tried for AR(1) I got the error
>> message.  So the workaround is given.  Notice that I use: 
>> p*as.vector(acf(phi,lag.max=p,type="covariance",demean=FALSE,plot=FALSE)$acf)
>>
>> so what I expect to get when p=length(phi)=1 is just phi^2.  This is what
>> happens in Mathematica with ListCorrelate[{phi},{phi}].  When you have
>> acf="correlation" and demean=TRUE then one gets 0/0 which should be defined as 1
>> in this situation.
>
> I don't think that's a reasonable expectation.  You've got an empty sum in the formula for the lag 1 autocovariance:
>
> sum_{i=1}^0 phi_i phi_{i+1}
>
> R is assuming that's not what you meant and is reporting it as an error. If it gave you any value, it should be zero, not phi^2.
>
> Duncan Murdoch
>
>>
>> Probably if the R authors just want to use acf for data analysis they may simply
>> choose to require length(x)>1 in acf(x,...) although I don't see the harm in my
>> suggestion either.


From bill at insightful.com  Mon Nov 13 21:06:28 2006
From: bill at insightful.com (Bill Dunlap)
Date: Mon, 13 Nov 2006 12:06:28 -0800 (PST)
Subject: [Rd] readBin(what="character",
 n=overcount)->extra "" in result (PR#9361)
In-Reply-To: <20061113170952.4B2CB3D747@slim.kubism.ku.dk>
References: <20061113170952.4B2CB3D747@slim.kubism.ku.dk>
Message-ID: <Pine.GSO.4.56.0611131202500.22336@durian.statsci.com>

On Mon, 13 Nov 2006 bill at insightful.com wrote:

> When I use readBin() to read an unknown number
> of null-terminated strings from a file by supplying
> an overcount as the n= argument, it appends an empty
> string to the result.
>
> > tf<-tempfile()
> > strings<-c("One","Two","Three")
> > writeBin(strings, con=tf)
> > readBin(con=tf,what="character",n=100) # expect "One","Two","Three" only
> [1] "One"   "Two"   "Three" ""

I think the fix is to src/library/connections.c, where
m (the number of items read) is initialized to 1 instead
of 0.  It is later used to shorten the vector of read
objects:
    if(m < n) {
        PROTECT(ans = lengthgets(ans, m));
        UNPROTECT(1);
    }

*** connections.c-orig	2006-09-13 19:05:06.000000000 -0700
--- connections.c	2006-11-13 11:46:35.000000000 -0800
***************
*** 2740,2746 ****
      if(!strcmp(what, "character")) {
  	SEXP onechar;
  	PROTECT(ans = allocVector(STRSXP, n));
! 	for(i = 0, m = i+1; i < n; i++) {
  	    onechar = isRaw ? rawOneString(bytes, nbytes, &np)
  		: readOneString(con);
  	    if(onechar != R_NilValue) {
--- 2740,2746 ----
      if(!strcmp(what, "character")) {
  	SEXP onechar;
  	PROTECT(ans = allocVector(STRSXP, n));
! 	for(i = 0, m = 0; i < n; i++) {
  	    onechar = isRaw ? rawOneString(bytes, nbytes, &np)
  		: readOneString(con);
  	    if(onechar != R_NilValue) {


From bill at insightful.com  Mon Nov 13 21:06:40 2006
From: bill at insightful.com (bill at insightful.com)
Date: Mon, 13 Nov 2006 21:06:40 +0100 (CET)
Subject: [Rd] readBin(what="character",
	n=overcount)->extra "" in result (PR#9363)
Message-ID: <20061113200640.33CA7572EC@slim.kubism.ku.dk>

On Mon, 13 Nov 2006 bill at insightful.com wrote:

> When I use readBin() to read an unknown number
> of null-terminated strings from a file by supplying
> an overcount as the n= argument, it appends an empty
> string to the result.
>
> > tf<-tempfile()
> > strings<-c("One","Two","Three")
> > writeBin(strings, con=tf)
> > readBin(con=tf,what="character",n=100) # expect "One","Two","Three" only
> [1] "One"   "Two"   "Three" ""

I think the fix is to src/library/connections.c, where
m (the number of items read) is initialized to 1 instead
of 0.  It is later used to shorten the vector of read
objects:
    if(m < n) {
        PROTECT(ans = lengthgets(ans, m));
        UNPROTECT(1);
    }

*** connections.c-orig	2006-09-13 19:05:06.000000000 -0700
--- connections.c	2006-11-13 11:46:35.000000000 -0800
***************
*** 2740,2746 ****
      if(!strcmp(what, "character")) {
  	SEXP onechar;
  	PROTECT(ans = allocVector(STRSXP, n));
! 	for(i = 0, m = i+1; i < n; i++) {
  	    onechar = isRaw ? rawOneString(bytes, nbytes, &np)
  		: readOneString(con);
  	    if(onechar != R_NilValue) {
--- 2740,2746 ----
      if(!strcmp(what, "character")) {
  	SEXP onechar;
  	PROTECT(ans = allocVector(STRSXP, n));
! 	for(i = 0, m = 0; i < n; i++) {
  	    onechar = isRaw ? rawOneString(bytes, nbytes, &np)
  		: readOneString(con);
  	    if(onechar != R_NilValue) {


From murdoch at stats.uwo.ca  Mon Nov 13 21:24:08 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 13 Nov 2006 15:24:08 -0500
Subject: [Rd] bug in acf (PR#9360)
In-Reply-To: <001901c70759$63690820$884c6481@stats2.uwo.ca>
References: <20061113153014.53F2E572ED@slim.kubism.ku.dk>	<45589BB1.6050305@stats.uwo.ca>
	<001901c70759$63690820$884c6481@stats2.uwo.ca>
Message-ID: <4558D468.5090607@stats.uwo.ca>

On 11/13/2006 2:24 PM, A.I. McLeod wrote:
>> I don't think that's a reasonable expectation.  You've got an empty sum 
>> in the formula for the lag 1 autocovariance:
>> 
>> sum_{i=1}^0 phi_i phi_{i+1}
>> 
>> R is assuming that's not what you meant and is reporting it as an error. 
>>  If it gave you any value, it should be zero, not phi^2.
>> 
> ********************************************
> I agree the empty sum which is the lag 1 autocovariance should be zero but this is the SECOND term in $acf output.
> For the first term,
> 1) if demean=F, it is variance which is phi^2 as I suggested
> 2) if demean=T, it is the variance/variance = 0/0 which I said should best be 1

Okay, I see what you mean now.  Yes, I agree acf should return lag 0 
autocorrelations and autocovariances even for a series of length 1. 
I'll take a look at the code.

Duncan Murdoch

> 
> 
> ----- Original Message ----- 
> From: "Duncan Murdoch" <murdoch at stats.uwo.ca>
> To: <aimcleod at uwo.ca>
> Cc: <r-devel at stat.math.ethz.ch>; <R-bugs at biostat.ku.dk>
> Sent: Monday, November 13, 2006 11:22 AM
> Subject: Re: [Rd] bug in acf (PR#9360)
> 
> 
>> On 11/13/2006 10:30 AM, aimcleod at uwo.ca wrote:
>>> Full_Name: Ian McLeod
>>> Version: 2.3.1
>>> OS: Windows
>>> Submission from: (NULL) (129.100.76.136)
>>> 
>>> 
>>>> There is a simple bug in acf as shown below:
>>>> 
>>>> z <- 1
>>>> acf(z,lag.max=1,plot=FALSE)
>>>> Error in acf(z, lag.max = 1, plot = FALSE) :
>>>>        'lag.max' must be at least 1
>>>> 
>>> This is certainly a bug.
>> 
>> I'd say it's a documentation bug, rather than a code bug.
>>> 
>>> There are two problems:
>>> 
>>> (i) the error message is wrong since lag.max is set to 1.  Perhaps, if the
>>> function acf can not be used for in this situaiton, a different error message
>>> would be more appropriate.  I understand why this might be done but I don't
>>> think it is the best approach.
>> 
>> What happens is that lag.max is reduced to length(z)-1, which is zero in 
>> your case.  This change should be mentioned in the documentation.
>> 
>>> (ii) Please look at the function GetB which is attached.  This is part a
>>> computation for a fast algorithm for exact mle of mean.  Usually phi here are
>>> the coefficients from a high order AR but when I tried for AR(1) I got the error
>>> message.  So the workaround is given.  Notice that I use: 
>>> 
>>> p*as.vector(acf(phi,lag.max=p,type="covariance",demean=FALSE,plot=FALSE)$acf)
>>> 
>>> so what I expect to get when p=length(phi)=1 is just phi^2.  This is what
>>> happens in Mathematica with ListCorrelate[{phi},{phi}].  When you have
>>> acf="correlation" and demean=TRUE then one gets 0/0 which should be defined as 1
>>> in this situation.
>> 
>> I don't think that's a reasonable expectation.  You've got an empty sum 
>> in the formula for the lag 1 autocovariance:
>> 
>> sum_{i=1}^0 phi_i phi_{i+1}
>> 
>> R is assuming that's not what you meant and is reporting it as an error. 
>>  If it gave you any value, it should be zero, not phi^2.
>> 
>> Duncan Murdoch
>> 
>>> 
>>> Probably if the R authors just want to use acf for data analysis they may simply
>>> choose to require length(x)>1 in acf(x,...) although I don't see the harm in my
>>> suggestion either.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Mon Nov 13 22:18:15 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 13 Nov 2006 21:18:15 +0000 (GMT)
Subject: [Rd] readBin(what="character",
 n=overcount)->extra "" in result (PR#9361)
In-Reply-To: <Pine.GSO.4.56.0611131202500.22336@durian.statsci.com>
References: <20061113170952.4B2CB3D747@slim.kubism.ku.dk>
	<Pine.GSO.4.56.0611131202500.22336@durian.statsci.com>
Message-ID: <Pine.LNX.4.64.0611132116510.10855@gannet.stats.ox.ac.uk>

That's arrived after I had committed an identical fix.  It's a relic of a 
time when m had a different meaning.

Thanks!

Brian

On Mon, 13 Nov 2006, Bill Dunlap wrote:

> On Mon, 13 Nov 2006 bill at insightful.com wrote:
>
>> When I use readBin() to read an unknown number
>> of null-terminated strings from a file by supplying
>> an overcount as the n= argument, it appends an empty
>> string to the result.
>>
>>> tf<-tempfile()
>>> strings<-c("One","Two","Three")
>>> writeBin(strings, con=tf)
>>> readBin(con=tf,what="character",n=100) # expect "One","Two","Three" only
>> [1] "One"   "Two"   "Three" ""
>
> I think the fix is to src/library/connections.c, where
> m (the number of items read) is initialized to 1 instead
> of 0.  It is later used to shorten the vector of read
> objects:
>    if(m < n) {
>        PROTECT(ans = lengthgets(ans, m));
>        UNPROTECT(1);
>    }
>
> *** connections.c-orig	2006-09-13 19:05:06.000000000 -0700
> --- connections.c	2006-11-13 11:46:35.000000000 -0800
> ***************
> *** 2740,2746 ****
>      if(!strcmp(what, "character")) {
>  	SEXP onechar;
>  	PROTECT(ans = allocVector(STRSXP, n));
> ! 	for(i = 0, m = i+1; i < n; i++) {
>  	    onechar = isRaw ? rawOneString(bytes, nbytes, &np)
>  		: readOneString(con);
>  	    if(onechar != R_NilValue) {
> --- 2740,2746 ----
>      if(!strcmp(what, "character")) {
>  	SEXP onechar;
>  	PROTECT(ans = allocVector(STRSXP, n));
> ! 	for(i = 0, m = 0; i < n; i++) {
>  	    onechar = isRaw ? rawOneString(bytes, nbytes, &np)
>  		: readOneString(con);
>  	    if(onechar != R_NilValue) {
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Mon Nov 13 22:18:56 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 13 Nov 2006 16:18:56 -0500
Subject: [Rd] bug in acf (PR#9360)
In-Reply-To: <001901c70759$63690820$884c6481@stats2.uwo.ca>
References: <20061113153014.53F2E572ED@slim.kubism.ku.dk>
	<45589BB1.6050305@stats.uwo.ca>
	<001901c70759$63690820$884c6481@stats2.uwo.ca>
Message-ID: <4558E140.2070705@stats.uwo.ca>

On 11/13/2006 2:24 PM, A.I. McLeod wrote:
>> I don't think that's a reasonable expectation.  You've got an empty sum 
>> in the formula for the lag 1 autocovariance:
>> 
>> sum_{i=1}^0 phi_i phi_{i+1}
>> 
>> R is assuming that's not what you meant and is reporting it as an error. 
>>  If it gave you any value, it should be zero, not phi^2.
>> 
> ********************************************
> I agree the empty sum which is the lag 1 autocovariance should be zero but this is the SECOND term in $acf output.
> For the first term,
> 1) if demean=F, it is variance which is phi^2 as I suggested
> 2) if demean=T, it is the variance/variance = 0/0 which I said should best be 1

I've put this change into R-devel and R-patched now.

Duncan Murdoch
> 
> 
> ----- Original Message ----- 
> From: "Duncan Murdoch" <murdoch at stats.uwo.ca>
> To: <aimcleod at uwo.ca>
> Cc: <r-devel at stat.math.ethz.ch>; <R-bugs at biostat.ku.dk>
> Sent: Monday, November 13, 2006 11:22 AM
> Subject: Re: [Rd] bug in acf (PR#9360)
> 
> 
>> On 11/13/2006 10:30 AM, aimcleod at uwo.ca wrote:
>>> Full_Name: Ian McLeod
>>> Version: 2.3.1
>>> OS: Windows
>>> Submission from: (NULL) (129.100.76.136)
>>> 
>>> 
>>>> There is a simple bug in acf as shown below:
>>>> 
>>>> z <- 1
>>>> acf(z,lag.max=1,plot=FALSE)
>>>> Error in acf(z, lag.max = 1, plot = FALSE) :
>>>>        'lag.max' must be at least 1
>>>> 
>>> This is certainly a bug.
>> 
>> I'd say it's a documentation bug, rather than a code bug.
>>> 
>>> There are two problems:
>>> 
>>> (i) the error message is wrong since lag.max is set to 1.  Perhaps, if the
>>> function acf can not be used for in this situaiton, a different error message
>>> would be more appropriate.  I understand why this might be done but I don't
>>> think it is the best approach.
>> 
>> What happens is that lag.max is reduced to length(z)-1, which is zero in 
>> your case.  This change should be mentioned in the documentation.
>> 
>>> (ii) Please look at the function GetB which is attached.  This is part a
>>> computation for a fast algorithm for exact mle of mean.  Usually phi here are
>>> the coefficients from a high order AR but when I tried for AR(1) I got the error
>>> message.  So the workaround is given.  Notice that I use: 
>>> 
>>> p*as.vector(acf(phi,lag.max=p,type="covariance",demean=FALSE,plot=FALSE)$acf)
>>> 
>>> so what I expect to get when p=length(phi)=1 is just phi^2.  This is what
>>> happens in Mathematica with ListCorrelate[{phi},{phi}].  When you have
>>> acf="correlation" and demean=TRUE then one gets 0/0 which should be defined as 1
>>> in this situation.
>> 
>> I don't think that's a reasonable expectation.  You've got an empty sum 
>> in the formula for the lag 1 autocovariance:
>> 
>> sum_{i=1}^0 phi_i phi_{i+1}
>> 
>> R is assuming that's not what you meant and is reporting it as an error. 
>>  If it gave you any value, it should be zero, not phi^2.
>> 
>> Duncan Murdoch
>> 
>>> 
>>> Probably if the R authors just want to use acf for data analysis they may simply
>>> choose to require length(x)>1 in acf(x,...) although I don't see the harm in my
>>> suggestion either.


From hb at stat.berkeley.edu  Tue Nov 14 05:32:37 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 14 Nov 2006 15:32:37 +1100
Subject: [Rd] [R] Problem with file size
In-Reply-To: <9AF6E6F4-1BD1-4242-87E0-6609C12C9C8D@jhsph.edu>
References: <9AF6E6F4-1BD1-4242-87E0-6609C12C9C8D@jhsph.edu>
Message-ID: <59d7961d0611132032g2fcf764ct9e5b1e7fa6aa6e0@mail.gmail.com>

[Moved to r-devel for further discussion, bcc:ed r-help for the record]

Hi Benilton,

it is possible that this has to do with so called unevaluated
promises.  I had a similar problem a few months ago. I emailed R-devel
about it - "[Rd] save() saves extra stuff if object is not evaluated"
(Thu May 25 09:19:28 CEST 2006) [
https://stat.ethz.ch/pipermail/r-devel/2006-May/037859.html ], and
Luke Tierney gave a very good explanation on what was going on.  Since
then save() has gained an extra argument 'eval.promises=TRUE', cf. R
v2.4.0 NEWS [ http://cran.at.r-project.org/ ]:

    o	save() by default evaluates promise objects.  The old behaviour
	(to save the promise and its evaluation environment) can be
	obtained by setting the new argument 'eval.promises' to FALSE.
	(Note that this does not apply to promises embedded in
	objects, only to top-level objects.)

You are already running R v2.4.0 so this should apply to your session
already.  However, note the last sentense in parentheses; it does not
handle promises in embedded objects. You could try to evaluate your
environments/promises manually using, say, is.null(env) (as I did in
my example in my May message) and see if it makes a difference.

Hope this helps

Henrik

On 11/14/06, Benilton Carvalho <bcarvalh at jhsph.edu> wrote:
> Hi everyone,
>
> I have 2 environments (2 different R sessions) as described below:
>
> Session 1:
>
> Name of the environment: "CrlmmInfo"
> Objects in the environment:
>     index1: logical index - length 238304
>     index2: logical index - length 238304
>     priors: list of 4 - (matrix 6x6, 2 vectors of length 6, vector of
> length 2) - all num
>     params: list of 4:
>           centers [238304 x 3 x 2]: num
>           scales [238304 x 3 x 2]: num
>           N [238304 x 3]: num
>           f0 [scalar]: num
>
> If I save this environment to a file, I get a file of 23MB. Great.
>
> Session 2:
>      Analogous to "Session 1", but replace 238304 by 262264.
>
> If I save the environment on Session 2, I get a file of 8.4GB.
>
> I applied object.size on each of the objects in each environment, and
> this is what I got:
>
> For Session 1:
> index1: 16204864
> index2: 16204864
> priors: 3336
> params: 74353584
>
> For Session 2:
> index1: 1049096
> index2: 1049096
> priors: 3336
> params: 81829104
>
> Is this increase from 23MB to 8.4GB expected to happen?
>
> Benilton
>
> sessionInfo() on both sessions is identical:
>
>  > sessionInfo()
> R version 2.4.0 (2006-10-03)
> x86_64-unknown-linux-gnu
>
> locale:
> LC_CTYPE=en_US.iso885915;LC_NUMERIC=C;LC_TIME=en_US.iso885915;LC_COLLATE
> =en_US.iso885915;LC_MONETARY=en_US.iso885915;LC_MESSAGES=en_US.iso885915
> ;LC_PAPER=en_US.iso885915;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASU
> REMENT=en_US.iso885915;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"
> "datasets"
> [7] "base"
>
>  > version
>                 _
> platform       x86_64-unknown-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status
> major          2
> minor          4.0
> year           2006
> month          10
> day            03
> svn rev        39566
> language       R
> version.string R version 2.4.0 (2006-10-03)
>
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>


From cggreen at u.washington.edu  Tue Nov 14 06:31:49 2006
From: cggreen at u.washington.edu (Christopher G. Green (W))
Date: Mon, 13 Nov 2006 21:31:49 -0800
Subject: [Rd] R.exp file for building packages
Message-ID: <007b01c707ae$2e9d1960$ad115f0a@stat.washington.edu>

I am trying to port some C code from S-Plus (7.0.6) to R (2.4.0) under
Windows XP SP2. I use Visual C++ 6.0 to build my library for S-Plus, so I'd
like to stick with that set up, if possible. According to the
README.packages file, I need the file R.exp (containing functions exported
from R.dll, I'm guessing) to build an R package with VC++.

>From what I've read in the archives of this list, R.exp should be installed
in $RHOME/src/gnuwin32 if I chose an appropriate option back when I
installed R from the binary. I did a full install of R, but R.exp is
nowhere to be found. 

Is this file no longer included in the pre-compiled install for Windows? Is
there some other way I can recreate the R.exp file? I am currently trying
to hack something using 

dumpbin /exports "C:\program files\R\R-2.4.0\bin\R.dll" > exports

and editing "exports" into an R.exp file...but I'm not too clear on what
the file's supposed to look like.

Thanks,

Chris Green



________________________________

Christopher G. Green (cggreen AT stat.washington.edu)
Graduate Student 
Department of Statistics, Box 354322, 
Seattle, WA, 98195-4322, U.S.A. 
http://www.stat.washington.edu/cggreen/


From ripley at stats.ox.ac.uk  Tue Nov 14 08:09:49 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 14 Nov 2006 07:09:49 +0000 (GMT)
Subject: [Rd] R.exp file for building packages
In-Reply-To: <007b01c707ae$2e9d1960$ad115f0a@stat.washington.edu>
References: <007b01c707ae$2e9d1960$ad115f0a@stat.washington.edu>
Message-ID: <Pine.LNX.4.64.0611140704260.28875@gannet.stats.ox.ac.uk>

On Mon, 13 Nov 2006, Christopher G. Green (W) wrote:

> I am trying to port some C code from S-Plus (7.0.6) to R (2.4.0) under
> Windows XP SP2. I use Visual C++ 6.0 to build my library for S-Plus, so I'd
> like to stick with that set up, if possible. According to the
> README.packages file, I need the file R.exp (containing functions exported
> from R.dll, I'm guessing) to build an R package with VC++.
>
>> From what I've read in the archives of this list, R.exp should be installed
> in $RHOME/src/gnuwin32 if I chose an appropriate option back when I
> installed R from the binary. I did a full install of R, but R.exp is
> nowhere to be found.

You are reading about old versions of R: R.exp has not been part of R for 
about a year.

> Is this file no longer included in the pre-compiled install for Windows? Is
> there some other way I can recreate the R.exp file? I am currently trying
> to hack something using
>
> dumpbin /exports "C:\program files\R\R-2.4.0\bin\R.dll" > exports
>
> and editing "exports" into an R.exp file...but I'm not too clear on what
> the file's supposed to look like.

Please do read more carefully README.packages, which says

Using Visual C++
================

You may if you prefer use Visual C++ to make the DLLs (unless they use
Fortran source!). First build the import library Rdll.lib by

         make R.exp
         lib /def:R.exp /out:Rdll.lib

You generate the file using the first of these lines: it starts

LIBRARY R.dll
EXPORTS
  ATTRIB
  AllDevicesKilled
  BODY
  Brent_fmin

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From agner at agner.org  Tue Nov 14 09:11:30 2006
From: agner at agner.org (Agner Fog)
Date: Tue, 14 Nov 2006 09:11:30 +0100
Subject: [Rd] R.exp file for building packages
In-Reply-To: <Pine.LNX.4.64.0611140704260.28875@gannet.stats.ox.ac.uk>
References: <007b01c707ae$2e9d1960$ad115f0a@stat.washington.edu>
	<Pine.LNX.4.64.0611140704260.28875@gannet.stats.ox.ac.uk>
Message-ID: <45597A32.9040802@agner.org>


Prof Brian Ripley wrote:

>You may if you prefer use Visual C++ to make the DLLs (unless they use
>Fortran source!). First build the import library Rdll.lib by
>
>         make R.exp
>         lib /def:R.exp /out:Rdll.lib
>
>  
>
This requires building R from the source. There are a lot of things that 
can go wrong if you don't have the right tools. A much easier method for 
making R.exp is documented in the   RcppTemplate  package. I think the 
manual should refer to the   RcppTemplate  package for building DLL's 
with other compilers than Gnu.


From mdowle at concordiafunds.com  Tue Nov 14 17:36:59 2006
From: mdowle at concordiafunds.com (Matthew Dowle)
Date: Tue, 14 Nov 2006 16:36:59 -0000
Subject: [Rd] c.factor
Message-ID: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM>


Hi,

Given factors x and y,  c(x,y) does not seem to return a useful result :
> x
[1] a b c d e
Levels: a b c d e
> y
[1] d e f g h
Levels: d e f g h
> c(x,y)
 [1] 1 2 3 4 5 1 2 3 4 5
> 

Is there a case for a new method c.factor as follows?  Does something
similar exist already?  Is there a better way to write the function?

> c.factor = function(x,y)
{
    newlevels = union(levels(x),levels(y))
    m = match(levels(y), newlevels)
    ans = c(unclass(x),m[unclass(y)])
    levels(ans) = newlevels
    class(ans) = "factor"
    ans
}
> c(x,y)
 [1] a b c d e d e f g h
Levels: a b c d e f g h
> as.integer(c(x,y))
 [1] 1 2 3 4 5 4 5 6 7 8
>

Regards,
Matthew


> version
               _                           
platform       x86_64-unknown-linux-gnu    
arch           x86_64                      
os             linux-gnu                   
system         x86_64, linux-gnu           
status                                     
major          2                           
minor          4.0                         
year           2006                        
month          10                          
day            03                          
svn rev        39566                       
language       R                           
version.string R version 2.4.0 (2006-10-03)


From tom.mccallum at levelelimited.com  Tue Nov 14 18:00:45 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Tue, 14 Nov 2006 17:00:45 -0000
Subject: [Rd] String to list and visa versa
Message-ID: <op.ti0mvjx2ffxks9@norisk>

Hi,

I need to collapse a list into a string and then reparse it back into the  
list.  Normally when I need to do this I simply use write.csv and  
read.csv, but I need to do this in memory within R rather than writing out  
to file.  Are there any bespoke commands that any knows of that does  
something like this or any tips for doing this that anyone can suggest?  I  
basically don't care upon the string representation, only that I can  
manipulate the list as a string and then reparse it back to a valid list  
object.

Many thanks for your help,

Tom

-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The contents of  
this e-mail are privileged and/or confidential. If you are not the  
intended recipient, please
notify the sender and ensure this e-mail is deleted and not read, copied  
or disclosed. It is your responsibility to scan this e-mail and any  
attachments for
computer viruses or other defects. Level E does not accept liability for  
any loss or damage which may result from this e-mail or any attachment.  
E-mail is not secure
and can be intercepted, corrupted or amended. Level E does not accept  
liability for errors or omissions arising as a result of interrupted or  
defective transmission.
Any views, opinions, conclusions or other information in this e-mail which  
do not relate to the business of Level E Limited are not authorised by  
Level E. Unless
specifically stated and authorised by Level E, nothing in this e-mail  
shall be taken to be an offer or acceptance of any contract of any nature.  
E-mail entering or leaving Level E's system is subject to random  
monitoring and recording.


From maechler at stat.math.ethz.ch  Tue Nov 14 18:07:31 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 14 Nov 2006 18:07:31 +0100
Subject: [Rd] Arithmetic not keeping S4-bit on simple extensions
Message-ID: <17753.63443.281162.678090@stat.math.ethz.ch>

This comes from a posting on R-help where
the poster found that str(.) didn't work on 
     <its-object> / 1
even though  <its-object> / 1  looked like a valid "its" object.

Here is a very short script demonstrating the issue :

##----------------------
setClass("mynum", representation = "numeric")
x <- new("mynum", pi)
x
isS4(x) # TRUE
isS4(x * 1) # FALSE -- but wouldn't it make sense to keep the bit here?

x * 1 # show()s in an ugly way -- just because the S4 bit is missing
##----------------------

I wonder if the behavior of primitive (and other "R-builtin"
functions) shouldn't be enhanced such that the S4 bit (that was
introduced with R version 2.4.0) is kept in simple operations
for objects that have a simple .Data slot [use
showClass("mynum") ] and the R-builtin is working on that slot like
in the above case.

Martin


From vdergachev at rcgardis.com  Tue Nov 14 18:09:22 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Tue, 14 Nov 2006 12:09:22 -0500
Subject: [Rd] String to list and visa versa
In-Reply-To: <op.ti0mvjx2ffxks9@norisk>
References: <op.ti0mvjx2ffxks9@norisk>
Message-ID: <200611141209.22173.vdergachev@rcgardis.com>

On Tuesday 14 November 2006 12:00 pm, Tom McCallum wrote:
> Hi,
>
> I need to collapse a list into a string and then reparse it back into the
> list.  Normally when I need to do this I simply use write.csv and
> read.csv, but I need to do this in memory within R rather than writing out
> to file.  Are there any bespoke commands that any knows of that does
> something like this or any tips for doing this that anyone can suggest?  I
> basically don't care upon the string representation, only that I can
> manipulate the list as a string and then reparse it back to a valid list
> object.

#List -> string:

#
# Put whatever you want into collapse to separate list entries
#
paste(unlist(L), collapse=",")

#String->list
strsplit(S, ",")

                best

                   Vladimir Dergachev


>
> Many thanks for your help,
>
> Tom


From ripley at stats.ox.ac.uk  Tue Nov 14 18:28:13 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 14 Nov 2006 17:28:13 +0000 (GMT)
Subject: [Rd] String to list and visa versa
In-Reply-To: <200611141209.22173.vdergachev@rcgardis.com>
References: <op.ti0mvjx2ffxks9@norisk>
	<200611141209.22173.vdergachev@rcgardis.com>
Message-ID: <Pine.LNX.4.64.0611141717350.22401@gannet.stats.ox.ac.uk>

This approach won't work in very many cases (but then nor will write.csv).

The safest way I know is to use serialize() and unserialize().  Next to 
that, deparse(control="all") and parse(text=) are quite good and give a 
human-readable character representation.

If fidelity is not the main issue, as.character and toString spring to 
mind.  unlist is recursive, and is not going to come close to being 
faithful for other than very simple lists. And what if ',' is a character 
in one of the list elements?

On Tue, 14 Nov 2006, Vladimir Dergachev wrote:

> On Tuesday 14 November 2006 12:00 pm, Tom McCallum wrote:
>> Hi,
>>
>> I need to collapse a list into a string and then reparse it back into the
>> list.  Normally when I need to do this I simply use write.csv and
>> read.csv, but I need to do this in memory within R rather than writing out
>> to file.  Are there any bespoke commands that any knows of that does
>> something like this or any tips for doing this that anyone can suggest?  I
>> basically don't care upon the string representation, only that I can
>> manipulate the list as a string and then reparse it back to a valid list
>> object.

'a valid list object' or the original list object?

> #List -> string:
>
> #
> # Put whatever you want into collapse to separate list entries
> #
> paste(unlist(L), collapse=",")
>
> #String->list
> strsplit(S, ",")
>
>                best
>
>                   Vladimir Dergachev
>
>
>>
>> Many thanks for your help,
>>
>> Tom

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Tue Nov 14 18:32:24 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 14 Nov 2006 18:32:24 +0100
Subject: [Rd] String to list and visa versa
In-Reply-To: <op.ti0mvjx2ffxks9@norisk>
References: <op.ti0mvjx2ffxks9@norisk>
Message-ID: <x2irhihr2v.fsf@turmalin.kubism.ku.dk>

"Tom McCallum" <tom.mccallum at levelelimited.com> writes:

> Hi,
> 
> I need to collapse a list into a string and then reparse it back into the  
> list.  Normally when I need to do this I simply use write.csv and  
> read.csv, but I need to do this in memory within R rather than writing out  
> to file.  

> Are there any bespoke commands that any knows of that does  
> something like this or any tips for doing this that anyone can
> suggest?

Er, perhaps you should send that sentence off to Iain McC.[*], so that
we can find out what killed it. ;-)

>  I  
> basically don't care upon the string representation, only that I can  
> manipulate the list as a string and then reparse it back to a valid list  
> object.

You might want to investigate deparse() and parse().

[*] http://www.johnhannah.net/mccallum.html

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From marc_schwartz at comcast.net  Tue Nov 14 18:51:25 2006
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Tue, 14 Nov 2006 11:51:25 -0600
Subject: [Rd] c.factor
In-Reply-To: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM>
References: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM>
Message-ID: <1163526685.4492.20.camel@localhost.localdomain>

On Tue, 2006-11-14 at 16:36 +0000, Matthew Dowle wrote:
> Hi,
> 
> Given factors x and y,  c(x,y) does not seem to return a useful result :
> > x
> [1] a b c d e
> Levels: a b c d e
> > y
> [1] d e f g h
> Levels: d e f g h
> > c(x,y)
>  [1] 1 2 3 4 5 1 2 3 4 5
> > 
> 
> Is there a case for a new method c.factor as follows?  Does something
> similar exist already?  Is there a better way to write the function?
> 
> > c.factor = function(x,y)
> {
>     newlevels = union(levels(x),levels(y))
>     m = match(levels(y), newlevels)
>     ans = c(unclass(x),m[unclass(y)])
>     levels(ans) = newlevels
>     class(ans) = "factor"
>     ans
> }
> > c(x,y)
>  [1] a b c d e d e f g h
> Levels: a b c d e f g h
> > as.integer(c(x,y))
>  [1] 1 2 3 4 5 4 5 6 7 8
> >
> 
> Regards,
> Matthew

I'll defer to others as to whether or not there is a basis for c.factor,
however:

c.factor <- function(...)
{
  args <- list(...)

  # this could be optional
  if (!all(sapply(args, is.factor)))
   stop("All arguments must be factors")

  factor(unlist(lapply(args, function(x) as.character(x))))
}


x <- factor(letters[1:5])
y <- factor(letters[4:8])
z <- factor(letters[9:14])

> x
[1] a b c d e
Levels: a b c d e

> y
[1] d e f g h
Levels: d e f g h

> z
[1] i j k l m n
Levels: i j k l m n


> c(x, y)
 [1] a b c d e d e f g h
Levels: a b c d e f g h


> c(x, y, z)
 [1] a b c d e d e f g h i j k l m n
Levels: a b c d e f g h i j k l m n


> c(x, 1:5)
Error in c.factor(x, 1:5) : All arguments must be factors


HTH,

Marc Schwartz


From marc_schwartz at comcast.net  Tue Nov 14 18:57:10 2006
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Tue, 14 Nov 2006 11:57:10 -0600
Subject: [Rd] c.factor
In-Reply-To: <1163526685.4492.20.camel@localhost.localdomain>
References: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM>
	<1163526685.4492.20.camel@localhost.localdomain>
Message-ID: <1163527030.4492.23.camel@localhost.localdomain>

On Tue, 2006-11-14 at 11:51 -0600, Marc Schwartz wrote:
> On Tue, 2006-11-14 at 16:36 +0000, Matthew Dowle wrote:
> > Hi,
> > 
> > Given factors x and y,  c(x,y) does not seem to return a useful result :
> > > x
> > [1] a b c d e
> > Levels: a b c d e
> > > y
> > [1] d e f g h
> > Levels: d e f g h
> > > c(x,y)
> >  [1] 1 2 3 4 5 1 2 3 4 5
> > > 
> > 
> > Is there a case for a new method c.factor as follows?  Does something
> > similar exist already?  Is there a better way to write the function?
> > 
> > > c.factor = function(x,y)
> > {
> >     newlevels = union(levels(x),levels(y))
> >     m = match(levels(y), newlevels)
> >     ans = c(unclass(x),m[unclass(y)])
> >     levels(ans) = newlevels
> >     class(ans) = "factor"
> >     ans
> > }
> > > c(x,y)
> >  [1] a b c d e d e f g h
> > Levels: a b c d e f g h
> > > as.integer(c(x,y))
> >  [1] 1 2 3 4 5 4 5 6 7 8
> > >
> > 
> > Regards,
> > Matthew
> 
> I'll defer to others as to whether or not there is a basis for c.factor,
> however:
> 
> c.factor <- function(...)
> {
>   args <- list(...)
> 
>   # this could be optional
>   if (!all(sapply(args, is.factor)))
>    stop("All arguments must be factors")
> 
>   factor(unlist(lapply(args, function(x) as.character(x))))
> }


That last line can even be cleaned up, as I was doing something else
initially:

c.factor <- function(...)
{
  args <- list(...)

  if (!all(sapply(args, is.factor)))
   stop("All arguments must be factors")

  factor(unlist(lapply(args, as.character)))
}


Marc


From ripley at stats.ox.ac.uk  Tue Nov 14 19:22:59 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 14 Nov 2006 18:22:59 +0000 (GMT)
Subject: [Rd] c.factor
In-Reply-To: <1163527030.4492.23.camel@localhost.localdomain>
References: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM>
	<1163526685.4492.20.camel@localhost.localdomain>
	<1163527030.4492.23.camel@localhost.localdomain>
Message-ID: <Pine.LNX.4.64.0611141809050.25751@gannet.stats.ox.ac.uk>

Well, R has managed without a factor method for c() for most of its decade 
of existence (not that it originally had factors as we know them).

I would argue that factors are best viewed as an enumeration type, and 
anything which silently changes their level set is a bad idea.  I can see 
a case for a c() method for factors that combines factors with the same 
level sets, but I can also see this is best done by users who know the 
level sets are same (c.factor would have to expend a considerable effort 
to check).

You also need to consider the dispatch rules.  c.factor will be called 
whenever the first argument is a factor, whatever the others are. S4 (I 
think, definitely S4-based versions of S-PLUS) has an alternative concat() 
that works differently (recursively) and seems a more natural model.


On Tue, 14 Nov 2006, Marc Schwartz wrote:

> On Tue, 2006-11-14 at 11:51 -0600, Marc Schwartz wrote:
>> On Tue, 2006-11-14 at 16:36 +0000, Matthew Dowle wrote:
>>> Hi,
>>>
>>> Given factors x and y,  c(x,y) does not seem to return a useful result :
>>>> x
>>> [1] a b c d e
>>> Levels: a b c d e
>>>> y
>>> [1] d e f g h
>>> Levels: d e f g h
>>>> c(x,y)
>>>  [1] 1 2 3 4 5 1 2 3 4 5
>>>>
>>>
>>> Is there a case for a new method c.factor as follows?  Does something
>>> similar exist already?  Is there a better way to write the function?
>>>
>>>> c.factor = function(x,y)
>>> {
>>>     newlevels = union(levels(x),levels(y))
>>>     m = match(levels(y), newlevels)
>>>     ans = c(unclass(x),m[unclass(y)])
>>>     levels(ans) = newlevels
>>>     class(ans) = "factor"
>>>     ans
>>> }
>>>> c(x,y)
>>>  [1] a b c d e d e f g h
>>> Levels: a b c d e f g h
>>>> as.integer(c(x,y))
>>>  [1] 1 2 3 4 5 4 5 6 7 8
>>>>
>>>
>>> Regards,
>>> Matthew
>>
>> I'll defer to others as to whether or not there is a basis for c.factor,
>> however:
>>
>> c.factor <- function(...)
>> {
>>   args <- list(...)
>>
>>   # this could be optional
>>   if (!all(sapply(args, is.factor)))
>>    stop("All arguments must be factors")
>>
>>   factor(unlist(lapply(args, function(x) as.character(x))))
>> }
>
>
> That last line can even be cleaned up, as I was doing something else
> initially:
>
> c.factor <- function(...)
> {
>  args <- list(...)
>
>  if (!all(sapply(args, is.factor)))
>   stop("All arguments must be factors")
>
>  factor(unlist(lapply(args, as.character)))
> }
>
>
> Marc
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From luke at stat.uiowa.edu  Tue Nov 14 19:57:16 2006
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Tue, 14 Nov 2006 12:57:16 -0600 (CST)
Subject: [Rd] allocVector bug ?
In-Reply-To: <200611091346.56977.vdergachev@rcgardis.com>
References: <200611011720.09139.vdergachev@rcgardis.com>
	<200611081633.17740.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611091029430.22148@nokomis.stat.uiowa.edu>
	<200611091346.56977.vdergachev@rcgardis.com>
Message-ID: <Pine.LNX.4.64.0611141255300.22148@nokomis.stat.uiowa.edu>

I have made the change to the threshold calculation (R_VSize instead
of R_NSize for the vector heap) in R-patched and R-devel.  Seems to
have negligible impact on the standard tests and VR scripts.

Best,

luke

On Thu, 9 Nov 2006, Vladimir Dergachev wrote:

> On Thursday 09 November 2006 12:21 pm, Luke Tierney wrote:
>> On Wed, 8 Nov 2006, Vladimir Dergachev wrote:
>>> On Wednesday 08 November 2006 12:56 pm, Luke Tierney wrote:
>>>> On Mon, 6 Nov 2006, Vladimir Dergachev wrote:
>>>
>>> Hi Luke,
>>>
>>>   Yes, I gladly concede the point that for a heuristic algorithm the
>>> notion of what is a "bug" is murky (besides crashes, etc, which is not
>>> what I am not talking about).
>>>
>>>   Here is why I called this a bug:
>>>
>>>     1. My understanding is that each time gc() needs to increase memory
>>> it performs a full garbage collection run. Right ?
>>
>> The allocation process does not call gc before every call to malloc.
>> It only calls gc if the allocation would cross a threshold level.
>> Those theshold levels are adjusted in an effort to compromise between
>> keeping memory footprint low and not calling gc too often.  The code
>> you quote below is part of this adjustment process.  If this process
>> is working properly then as memory use grows there will initially be
>> more gc activity and then less as the thresholds adjust.
>
> Well, I was seeing it call gc for every large vector. This probably happens be
> only for those larger  than R_VGrowIncrFrac * R_NSize. On my system R_NSize
> is never more than 1e6 so this would explain the problems when using 1e6 (and
> larger) vectors.
>
>>
>>>     2. This is not a problem with small memory sizes as they imply
>>> (presumably) small number of objects.
>>>
>>>     3. However, if one wants to allocate many objects (say columns in a
>>> data frame or just vectors) this results in large penalty
>>>
>>> Example 1: This simulates allocation of a data.frame with some character
>>> columns which are assumed to be factors. On my system first assignment is
>>> nearly instantaneous, why subsequent assignments take slightly less than
>>> 0.1 seconds each.
>>
>> I'm not sure these are quite doing what you intend.  You define Chars
>> but don't use it.  Also, system.time by default calls gc() before
>> doing the evaluation. Giving FALSE as the second argument may give you
>> a more realistic picture.
>
> The Chars are defined to create lots of ncells and make gc() run time more
> realistic. It also mimics having a data.frame with a few factor columns.
>
> As for system.time - thank you, I missed that !
> Setting gcFirst=FALSE changes behavior in the first example to be 2 times
> faster and makes all the allocations in the second example faster.
>
> I guess that extra call to gc() caused R_VSize to shrink too fast.
>
>>> I looked more carefully at your code in src/main/memory.c, function
>>> AdjustHeapSize:
>>>
>>> R_VSize = VNeeded;
>>>    if (vect_occup > R_VGrowFrac) {
>>> 	R_size_t change = R_VGrowIncrMin + R_VGrowIncrFrac * R_NSize;
>>> 	if (R_MaxVSize - R_VSize >= change)
>>> 	    R_VSize += change;
>>>    }
>>>
>>> Could it be that R_NSize should be R_VSize ? This would explain why I see
>>> a problem in case R_VSize>>R_NSize.
>>
>> That does indeed look like a bug and that R_NSize should be R_VSize --
>> well spotted, thanks.  I will need to experiment with this a bit more
>> to see if it can safely be changed.  It will increase the memory
>> footprint a bit.  Probaly not by enough to matter but if it does we
>> may need to adjust some of the tuning constants.
>>
>
> Would there be something I can help you with ? Is there a script to run
> through common usage patterns ?
>
>                          thank you !
>
>                                  Vladimir Dergachev
>
>
>> Best,
>>
>> luke
>>
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From bill at insightful.com  Tue Nov 14 21:26:30 2006
From: bill at insightful.com (Bill Dunlap)
Date: Tue, 14 Nov 2006 12:26:30 -0800 (PST)
Subject: [Rd] c.factor
In-Reply-To: <Pine.LNX.4.64.0611141809050.25751@gannet.stats.ox.ac.uk>
References: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM>
	<1163526685.4492.20.camel@localhost.localdomain>
	<1163527030.4492.23.camel@localhost.localdomain>
	<Pine.LNX.4.64.0611141809050.25751@gannet.stats.ox.ac.uk>
Message-ID: <Pine.GSO.4.56.0611141218410.17778@durian.statsci.com>

On Tue, 14 Nov 2006, Prof Brian Ripley wrote:

> Well, R has managed without a factor method for c() for most of its decade
> of existence (not that it originally had factors as we know them).
>
> I would argue that factors are best viewed as an enumeration type, and
> anything which silently changes their level set is a bad idea.  I can see
> a case for a c() method for factors that combines factors with the same
> level sets, but I can also see this is best done by users who know the
> level sets are same (c.factor would have to expend a considerable effort
> to check).
>
> You also need to consider the dispatch rules.  c.factor will be called
> whenever the first argument is a factor, whatever the others are. S4 (I
> think, definitely S4-based versions of S-PLUS) has an alternative concat()
> that works differently (recursively) and seems a more natural model.

In addition, c() has always had a double meaning of
  (a) turning an object into a simple "vector" (an object
      without "attributes"), as in
      > c(factor(c("Cat","Dog","Cat")))
      [1] 1 2 1
      > c(data.frame(x=1:2,y=c("Dog","Cat")))
      $x
      [1] 1 2

      $y
      [1] Dog Cat
      Levels: Cat Dog

  (b) concatenating several such vectors into one.

The proposed c.factor does only (b).  Should we just
throw c() into the ash heap and use as.vector() or
concat() instead?

The whole concept of concatenating objects of disparate
types is suspect.

> On Tue, 14 Nov 2006, Marc Schwartz wrote:
>
> > On Tue, 2006-11-14 at 11:51 -0600, Marc Schwartz wrote:
> >> On Tue, 2006-11-14 at 16:36 +0000, Matthew Dowle wrote:
> >>> Hi,
> >>>
> >>> Given factors x and y,  c(x,y) does not seem to return a useful result :
> >>>> x
> >>> [1] a b c d e
> >>> Levels: a b c d e
> >>>> y
> >>> [1] d e f g h
> >>> Levels: d e f g h
> >>>> c(x,y)
> >>>  [1] 1 2 3 4 5 1 2 3 4 5
> >>>>
> >>>
> >>> Is there a case for a new method c.factor as follows?  Does something
> >>> similar exist already?  Is there a better way to write the function?

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From vdergachev at rcgardis.com  Tue Nov 14 22:46:06 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Tue, 14 Nov 2006 16:46:06 -0500
Subject: [Rd] String to list and visa versa
In-Reply-To: <Pine.LNX.4.64.0611141717350.22401@gannet.stats.ox.ac.uk>
References: <op.ti0mvjx2ffxks9@norisk>
	<200611141209.22173.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611141717350.22401@gannet.stats.ox.ac.uk>
Message-ID: <200611141646.06213.vdergachev@rcgardis.com>

On Tuesday 14 November 2006 12:28 pm, Prof Brian Ripley wrote:
> This approach won't work in very many cases (but then nor will write.csv).
>
> The safest way I know is to use serialize() and unserialize().  Next to
> that, deparse(control="all") and parse(text=) are quite good and give a
> human-readable character representation.
>
> If fidelity is not the main issue, as.character and toString spring to
> mind.  unlist is recursive, and is not going to come close to being
> faithful for other than very simple lists. And what if ',' is a character
> in one of the list elements?

Yes, but then one can replace ',' with something rarely used like \007.
I picked ',' because write.csv/read.csv worked before.

You are right, for storage serialize/unserialize seem best, however for 
manipulation one would usually prefer a well-defined format.
 
                         best

                             Vladimir Dergachev


From sfalcon at fhcrc.org  Wed Nov 15 00:43:24 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 14 Nov 2006 15:43:24 -0800
Subject: [Rd] Problem with X11 configure checking in R-devel?
Message-ID: <m2velhiogz.fsf@ziti.local>

Hi,

I just updated to svn rev 39899 on a SuSE 10.1/x86_64 system and I get
the following error when configuring R:

checking for X... libraries /usr/X11R6/lib64, headers /usr/X11R6/include
checking for gethostbyname... yes
checking for connect... yes
checking for remove... yes
checking for shmat... yes
checking for IceConnectionNumber in -lICE... yes
checking X11/Intrinsic.h usability... yes
checking X11/Intrinsic.h presence... yes
checking for X11/Intrinsic.h... yes
checking for XtToolkitInitialize in -lXt... no
configure: error: --with-x=yes (default) and X11 headers/libs are not available

I'm pretty sure I have the needed libs and headers since I can build
yesterday's R.  The changes to the admin guide suggest libXt-dev but I
don't see that available for my system in yast as a separate package.
I _do_ have libXt in /usr/X11R6/lib.

+ seth


From ross at biostat.ucsf.edu  Wed Nov 15 02:02:34 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Wed, 15 Nov 2006 01:02:34 +0000
Subject: [Rd] tail recursion in R
Message-ID: <1163552554.653.52.camel@iron.psg.net>

Apparently Scheme is clever and can turn certain apparently recursive
function calls into into non-recursive evaluations.

Does R do anything like that?  I could find no reference to it in the
language manual.

What I'm wondering is whether there are desirable ways to express
recursion in R.

Thanks.
-- 
Ross Boylan                                      wk:  (415) 514-8146
185 Berry St #5700                               ross at biostat.ucsf.edu
Dept of Epidemiology and Biostatistics           fax: (415) 514-8150
University of California, San Francisco
San Francisco, CA 94107-1739                     hm:  (415) 550-1062


From ggrothendieck at gmail.com  Wed Nov 15 02:34:59 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 14 Nov 2006 20:34:59 -0500
Subject: [Rd] tail recursion in R
In-Reply-To: <1163552554.653.52.camel@iron.psg.net>
References: <1163552554.653.52.camel@iron.psg.net>
Message-ID: <971536df0611141734k58622fd3pce7e9b80c90342bf@mail.gmail.com>

See:

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/73651.html

On 11/14/06, Ross Boylan <ross at biostat.ucsf.edu> wrote:
> Apparently Scheme is clever and can turn certain apparently recursive
> function calls into into non-recursive evaluations.
>
> Does R do anything like that?  I could find no reference to it in the
> language manual.
>
> What I'm wondering is whether there are desirable ways to express
> recursion in R.
>
> Thanks.
> --
> Ross Boylan                                      wk:  (415) 514-8146
> 185 Berry St #5700                               ross at biostat.ucsf.edu
> Dept of Epidemiology and Biostatistics           fax: (415) 514-8150
> University of California, San Francisco
> San Francisco, CA 94107-1739                     hm:  (415) 550-1062
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From sfalcon at fhcrc.org  Wed Nov 15 03:09:15 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 14 Nov 2006 18:09:15 -0800
Subject: [Rd] Feature request: put NewEnvironment and R_NewhashedEnv into API
Message-ID: <m2ac2th35g.fsf@ziti.local>

Hi,

I would like to be able to create new environments from package C
code.  AFAICT, this isn't allowed since both NewEnvironment and
R_NewHashedEnv are declared in Defn.R.

If exposing this isn't controvertial, I would submit a patch.
However, I'm not sure where the declarations should go (Rdefines.h?)
and whether they need to change to Rf_*.

+ seth


From ripley at stats.ox.ac.uk  Wed Nov 15 06:00:28 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 15 Nov 2006 05:00:28 +0000 (GMT)
Subject: [Rd] String to list and visa versa
In-Reply-To: <200611141646.06213.vdergachev@rcgardis.com>
References: <op.ti0mvjx2ffxks9@norisk>
	<200611141209.22173.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611141717350.22401@gannet.stats.ox.ac.uk>
	<200611141646.06213.vdergachev@rcgardis.com>
Message-ID: <Pine.LNX.4.64.0611150458200.32548@gannet.stats.ox.ac.uk>

On Tue, 14 Nov 2006, Vladimir Dergachev wrote:

> On Tuesday 14 November 2006 12:28 pm, Prof Brian Ripley wrote:
>> This approach won't work in very many cases (but then nor will write.csv).
>>
>> The safest way I know is to use serialize() and unserialize().  Next to
>> that, deparse(control="all") and parse(text=) are quite good and give a
>> human-readable character representation.
>>
>> If fidelity is not the main issue, as.character and toString spring to
>> mind.  unlist is recursive, and is not going to come close to being
>> faithful for other than very simple lists. And what if ',' is a character
>> in one of the list elements?
>
> Yes, but then one can replace ',' with something rarely used like \007.
> I picked ',' because write.csv/read.csv worked before.

But it quotes strings ....

> You are right, for storage serialize/unserialize seem best, however for
> manipulation one would usually prefer a well-defined format.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Nov 15 07:20:06 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 15 Nov 2006 06:20:06 +0000 (GMT)
Subject: [Rd] Feature request: put NewEnvironment and R_NewhashedEnv
 into API
In-Reply-To: <m2ac2th35g.fsf@ziti.local>
References: <m2ac2th35g.fsf@ziti.local>
Message-ID: <Pine.LNX.4.64.0611150537070.2837@gannet.stats.ox.ac.uk>

On Tue, 14 Nov 2006, Seth Falcon wrote:

> Hi,
>
> I would like to be able to create new environments from package C
> code.  AFAICT, this isn't allowed since both NewEnvironment and
> R_NewHashedEnv are declared in Defn.R.

NewEnvironment is currently exposed as Rf_NewEnvironment.
R_NewHashedEnv is currrently hidden, but I'll unhide it.  It does not need 
a further prefix.

> If exposing this isn't controvertial, I would submit a patch.
> However, I'm not sure where the declarations should go (Rdefines.h?)
> and whether they need to change to Rf_*.

Rdefnes.h is a compatibility header, only used by those who want 
S4-compatible macros covering some of the definitions in Rinternals.h. 
Definitions can be moved from Defn.h to Rinternals.h with little trouble 
as the former includes the latter (you have to be careful about 
R_NO_REMAP, so declare them with Rf_).

If this is not controversial (I don't know if it is) and you want to 
submit a patch there should be a description in R-exts, I think somewhere 
in section 5.7 ('Handling R Objects in C').

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tuke at senet.com.au  Wed Nov 15 07:27:05 2006
From: tuke at senet.com.au (tuke at senet.com.au)
Date: Wed, 15 Nov 2006 07:27:05 +0100 (CET)
Subject: [Rd] dyn.load (PR#9364)
Message-ID: <20061115062705.EC32656226@slim.kubism.ku.dk>

Full_Name: Jonathan Tuke
Version: 2.4.0
OS: Mac OS X 10.4.8
Submission from: (NULL) (203.173.46.189)


I am writing C code to implement in R. I am using R CMD SHLIB and then
dyn.load("file.so"). The function I then call with .C("function"). Since I
installed the latest R version, I have found that if I alter my C code and
recompile, then use dyn.load("file.so"), the function in R is not updated but
remains as the previous code. I have tried dyn.unload, but when I use dyn.load()
the initially loaded code is used. The only way to load the updated c code is to
quit R and then reopen. 

Thanks,
Jono


From ripley at stats.ox.ac.uk  Wed Nov 15 10:31:18 2006
From: ripley at stats.ox.ac.uk (Brian Ripley)
Date: Wed, 15 Nov 2006 09:31:18 +0000 (GMT)
Subject: [Rd] c.factor
In-Reply-To: <Pine.GSO.4.56.0611141218410.17778@durian.statsci.com>
References: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM>
	<1163526685.4492.20.camel@localhost.localdomain>
	<1163527030.4492.23.camel@localhost.localdomain>
	<Pine.LNX.4.64.0611141809050.25751@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0611141218410.17778@durian.statsci.com>
Message-ID: <Pine.LNX.4.64.0611150926070.19618@auk.stats>

On Tue, 14 Nov 2006, Bill Dunlap wrote:

> On Tue, 14 Nov 2006, Prof Brian Ripley wrote:
>
>> Well, R has managed without a factor method for c() for most of its decade
>> of existence (not that it originally had factors as we know them).
>>
>> I would argue that factors are best viewed as an enumeration type, and
>> anything which silently changes their level set is a bad idea.  I can see
>> a case for a c() method for factors that combines factors with the same
>> level sets, but I can also see this is best done by users who know the
>> level sets are same (c.factor would have to expend a considerable effort
>> to check).
>>
>> You also need to consider the dispatch rules.  c.factor will be called
>> whenever the first argument is a factor, whatever the others are. S4 (I
>> think, definitely S4-based versions of S-PLUS) has an alternative concat()
>> that works differently (recursively) and seems a more natural model.
>
> In addition, c() has always had a double meaning of
>  (a) turning an object into a simple "vector" (an object
>      without "attributes"), as in
>      > c(factor(c("Cat","Dog","Cat")))
>      [1] 1 2 1
>      > c(data.frame(x=1:2,y=c("Dog","Cat")))
>      $x
>      [1] 1 2
>
>      $y
>      [1] Dog Cat
>      Levels: Cat Dog

To my surprise that was not documented at all on the R help page, and I've 
clarified it.  (BTW, at least in R it does not remove names, just all 
other attributes.)

>  (b) concatenating several such vectors into one.
>
> The proposed c.factor does only (b).

(Strictly not, as a factor is not a vector.)

But the help page explicitly only describes the default method, and some 
of the other methods do preserve some attributes, AFAIR.

> Should we just
> throw c() into the ash heap and use as.vector() or
> concat() instead?
>
> The whole concept of concatenating objects of disparate
> types is suspect.

I think working on a concat() for R would be helpful.  I vaguely recalled 
something like it in the Green Book, but the index does not help (but then 
it is not very complete).

Brian

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tom.mccallum at levelelimited.com  Wed Nov 15 11:52:00 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Wed, 15 Nov 2006 10:52:00 -0000
Subject: [Rd] String to list and visa versa
In-Reply-To: <Pine.LNX.4.64.0611150458200.32548@gannet.stats.ox.ac.uk>
References: <op.ti0mvjx2ffxks9@norisk>
	<200611141209.22173.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611141717350.22401@gannet.stats.ox.ac.uk>
	<200611141646.06213.vdergachev@rcgardis.com>
	<Pine.LNX.4.64.0611150458200.32548@gannet.stats.ox.ac.uk>
Message-ID: <op.ti10gyyuffxks9@norisk>

On Wed, 15 Nov 2006 05:00:28 -0000, Prof Brian Ripley  
<ripley at stats.ox.ac.uk> wrote:

> On Tue, 14 Nov 2006, Vladimir Dergachev wrote:
>
>> On Tuesday 14 November 2006 12:28 pm, Prof Brian Ripley wrote:
>>> This approach won't work in very many cases (but then nor will  
>>> write.csv).
>>>
>>> The safest way I know is to use serialize() and unserialize().  Next to
>>> that, deparse(control="all") and parse(text=) are quite good and give a
>>> human-readable character representation.
>>>
>>> If fidelity is not the main issue, as.character and toString spring to
>>> mind.  unlist is recursive, and is not going to come close to being
>>> faithful for other than very simple lists. And what if ',' is a  
>>> character
>>> in one of the list elements?
>>
>> Yes, but then one can replace ',' with something rarely used like \007.
>> I picked ',' because write.csv/read.csv worked before.
>
> But it quotes strings ....
>
>> You are right, for storage serialize/unserialize seem best, however for
>> manipulation one would usually prefer a well-defined format.
>
>

Thanks for the information, I think I am going to use the  
serialize/unserialize methods, which will mean I can't manipulate them  
outside R, but I can alter other parts of the project to accomodate this.

Tom

-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From mdowle at concordiafunds.com  Wed Nov 15 13:51:17 2006
From: mdowle at concordiafunds.com (Matthew Dowle)
Date: Wed, 15 Nov 2006 12:51:17 -0000
Subject: [Rd] c.factor
Message-ID: <946928E281E8FD4B91D5B2CC3C91967D6AA9A7@lnex01.CONCORDIAFUNDS.COM>


Prof Ripley,

> Well, R has managed without a factor method for c() for most of its
decade 
> of existence (not that it originally had factors as we know them).

R has managed without other things too for most of its decade. For
example, row names in data frames have very recently been made
efficient. That is an example how R was managing for a decade but an
improvement has still been made. As we become aware of what we believe
is missing in R, I believe the correct approach, the approach you
advocate, is to contribute back to the list. This is what I did. I also
contributed a potential solution in the form of working source code. I
stand by my statement that the current result of c(x,y) when x and y are
factors is not useful. It is a specific statement about a specific
operation, not any general criticism of R. I agree with you that factors
are best viewed as an enumeration type, but I would argue further that
c() of 2 enumerated types should return an enumerated type, retaining
the powerful feature of enumerated types in R. However, currently R
ignores the fact that x and y are enumerated. It silently ignores the
levels information, and returns an integer vector whose integers are,
well, not useful. Or, if you prefer, not as useful as the proposal I
posted.

I have a solution which works for me, and I have contributed it. One
other person has shown some interest, and taken it further to work with
multiple arguments which looks like a nice improvement.

The only thing I would comment, if c.factor does go further, is to
please avoid the use of as.character in the implementation. One key
advantage of the factor type is precisely that it is enumerated, and
therefore is efficient for categorical data sets. Intermediate coercion
to character is inefficient in this case, which is why I avoided it in
the solution I posted.

Regards,
Matthew


> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Sent: 14 November 2006 18:23
> To: Marc Schwartz
> Cc: Matthew Dowle; r-devel at r-project.org
> Subject: Re: [Rd] c.factor
> 
> 
> Well, R has managed without a factor method for c() for most 
> of its decade 
> of existence (not that it originally had factors as we know them).
> 
> I would argue that factors are best viewed as an enumeration 
> type, and 
> anything which silently changes their level set is a bad 
> idea.  I can see 
> a case for a c() method for factors that combines factors 
> with the same 
> level sets, but I can also see this is best done by users who 
> know the 
> level sets are same (c.factor would have to expend a 
> considerable effort 
> to check).
> 
> You also need to consider the dispatch rules.  c.factor will 
> be called 
> whenever the first argument is a factor, whatever the others 
> are. S4 (I 
> think, definitely S4-based versions of S-PLUS) has an 
> alternative concat() 
> that works differently (recursively) and seems a more natural model.
> 
> 
> On Tue, 14 Nov 2006, Marc Schwartz wrote:
> 
> > On Tue, 2006-11-14 at 11:51 -0600, Marc Schwartz wrote:
> >> On Tue, 2006-11-14 at 16:36 +0000, Matthew Dowle wrote:
> >>> Hi,
> >>>
> >>> Given factors x and y,  c(x,y) does not seem to return a useful 
> >>> result :
> >>>> x
> >>> [1] a b c d e
> >>> Levels: a b c d e
> >>>> y
> >>> [1] d e f g h
> >>> Levels: d e f g h
> >>>> c(x,y)
> >>>  [1] 1 2 3 4 5 1 2 3 4 5
> >>>>
> >>>
> >>> Is there a case for a new method c.factor as follows?  Does 
> >>> something similar exist already?  Is there a better way 
> to write the 
> >>> function?
> >>>
> >>>> c.factor = function(x,y)
> >>> {
> >>>     newlevels = union(levels(x),levels(y))
> >>>     m = match(levels(y), newlevels)
> >>>     ans = c(unclass(x),m[unclass(y)])
> >>>     levels(ans) = newlevels
> >>>     class(ans) = "factor"
> >>>     ans
> >>> }
> >>>> c(x,y)
> >>>  [1] a b c d e d e f g h
> >>> Levels: a b c d e f g h
> >>>> as.integer(c(x,y))
> >>>  [1] 1 2 3 4 5 4 5 6 7 8
> >>>>
> >>>
> >>> Regards,
> >>> Matthew
> >>
> >> I'll defer to others as to whether or not there is a basis for 
> >> c.factor,
> >> however:
> >>
> >> c.factor <- function(...)
> >> {
> >>   args <- list(...)
> >>
> >>   # this could be optional
> >>   if (!all(sapply(args, is.factor)))
> >>    stop("All arguments must be factors")
> >>
> >>   factor(unlist(lapply(args, function(x) as.character(x)))) }
> >
> >
> > That last line can even be cleaned up, as I was doing something else
> > initially:
> >
> > c.factor <- function(...)
> > {
> >  args <- list(...)
> >
> >  if (!all(sapply(args, is.factor)))
> >   stop("All arguments must be factors")
> >
> >  factor(unlist(lapply(args, as.character)))
> > }
> >
> >
> > Marc
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list 
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
>


From stefano.iacus at unimi.it  Wed Nov 15 15:08:48 2006
From: stefano.iacus at unimi.it (stefano iacus)
Date: Wed, 15 Nov 2006 23:08:48 +0900
Subject: [Rd] dyn.load (PR#9364)
In-Reply-To: <20061115062705.EC32656226@slim.kubism.ku.dk>
References: <20061115062705.EC32656226@slim.kubism.ku.dk>
Message-ID: <7344E92E-1E73-4980-AE01-49E084211020@unimi.it>

In OS X you cannot "unload" dynamically linked code. This is a known  
"feature" of OS X :(
This is not an R bug.

stefano

On 15/nov/06, at 15:27, tuke at senet.com.au wrote:

> Full_Name: Jonathan Tuke
> Version: 2.4.0
> OS: Mac OS X 10.4.8
> Submission from: (NULL) (203.173.46.189)
>
>
> I am writing C code to implement in R. I am using R CMD SHLIB and then
> dyn.load("file.so"). The function I then call with .C("function").  
> Since I
> installed the latest R version, I have found that if I alter my C  
> code and
> recompile, then use dyn.load("file.so"), the function in R is not  
> updated but
> remains as the previous code. I have tried dyn.unload, but when I  
> use dyn.load()
> the initially loaded code is used. The only way to load the updated  
> c code is to
> quit R and then reopen.
>
> Thanks,
> Jono
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From dragan.sestovic at ubs.com  Wed Nov 15 15:34:39 2006
From: dragan.sestovic at ubs.com (dragan.sestovic at ubs.com)
Date: Wed, 15 Nov 2006 15:34:39 +0100 (CET)
Subject: [Rd] save objects from function (PR#9365)
Message-ID: <20061115143439.68D41572DC@slim.kubism.ku.dk>

Full_Name: Dragan Sestovic
Version: 2.3.0
OS: Windows XP
Submission from: (NULL) (139.149.1.194)


I can not save R objects from function using "save". The simple example is
below:
I do not understand why function funSave.1 fails. Also, why does function
funSave.2 work? 

> funSave.1 <- function(a)
+ {
+   save(a, file="a.1.dat")
+ }
> 
> funSave.2 <- function(a)
+ {
+   b <- a
+   save(a, file="a.2.dat")
+ }
> 
> a <- 1:10
> a
 [1]  1  2  3  4  5  6  7  8  9 10
> save(a, file="a.dat")
> load("a.dat")
> a
 [1]  1  2  3  4  5  6  7  8  9 10
> a <- 1:10
> funSave.1(a)
> load("a.1.dat")
> a
Error: recursive default argument reference
> a <- 1:10
> funSave.2(b)
> load("a.2.dat")
> a
 [1]  1  2  3  4  5  6  7  8  9 10


From marc_schwartz at comcast.net  Wed Nov 15 15:36:40 2006
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Wed, 15 Nov 2006 08:36:40 -0600
Subject: [Rd] c.factor
In-Reply-To: <946928E281E8FD4B91D5B2CC3C91967D6AA9A7@lnex01.CONCORDIAFUNDS.COM>
References: <946928E281E8FD4B91D5B2CC3C91967D6AA9A7@lnex01.CONCORDIAFUNDS.COM>
Message-ID: <1163601400.3601.18.camel@localhost.localdomain>

On Wed, 2006-11-15 at 12:51 +0000, Matthew Dowle wrote:

<snip>

> I have a solution which works for me, and I have contributed it. One
> other person has shown some interest, and taken it further to work with
> multiple arguments which looks like a nice improvement.

Just for clarification, my interest was only to provide an alternative
that provided for a more generic approach, at least in a narrow
application, not that I was advocating it's need. Perhaps I should have
called the function something else to avoid confusion and that was my
error. Needless to say that we both ignored the overhead of error
checking related functionality.

In my 5 odd years of using R, I would have to acknowledge that I have
yet to have a need for this type of function (save within the context of
merge() and rbind()). That does not mean that I have exhausted the
possibilities over that time, but that in the course of meeting my
particular requirements, it has yet to come up.

I would agree with Prof. Ripley's comments, that one needs to be quite
careful in manipulating factors in this fashion, not the least of which
would be ordered factors, which have not been considered here and
could/would introduce their own idiosyncrasies in this context.

If something like this gets implemented (ie. concat()) one would need to
fully understand the behavioral subtleties and the nature of the
results, lest naive users find themselves in the potential presence of
cascading errors.

HTH,

Marc


From Julien.Steiner at imd.ch  Wed Nov 15 15:47:05 2006
From: Julien.Steiner at imd.ch (Julien.Steiner at imd.ch)
Date: Wed, 15 Nov 2006 15:47:05 +0100 (CET)
Subject: [Rd] Building R (PR#9366)
Message-ID: <20061115144705.61E7A572D9@slim.kubism.ku.dk>

Hello,

=20

I get this error when I try to install R-2.4.0 on Solaris 10

=20

Any Assistance would be greatly appreciated

=20

The ./configure thing passed but then on gmake I get :

=20

Undefined                       first referenced

 symbol                             in file

__builtin_isnan                     arithmetic.o

ld: fatal: Symbol referencing errors. No output written to R.bin

collect2: ld returned 1 exit status

gmake[3]: *** [R.bin] Error 1

gmake[3]: Leaving directory

`/usr/local/R_HOME/R-2.4.0/src/main'

gmake[2]: *** [R] Error 2

gmake[2]: Leaving directory

`/usr/local/R_HOME/R-2.4.0/src/main'

gmake[1]: *** [R] Error 1

gmake[1]: Leaving directory `/usr/local/R_HOME/R-2.4.0/src'

gmake: *** [R] Error 1

=20


	[[alternative HTML version deleted]]


From duncan at wald.ucdavis.edu  Wed Nov 15 16:07:04 2006
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Wed, 15 Nov 2006 07:07:04 -0800
Subject: [Rd] dyn.load (PR#9364)
In-Reply-To: <7344E92E-1E73-4980-AE01-49E084211020@unimi.it>
References: <20061115062705.EC32656226@slim.kubism.ku.dk>
	<7344E92E-1E73-4980-AE01-49E084211020@unimi.it>
Message-ID: <455B2D18.8060104@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


I was just testing this myself on various machines.
And it behaves on Linux, Windows and also on
my Intel Mac (OS X 10.4.8).

Stefano, is this restriction on OS X still in effect?
(Unfortunately I can't test this on any of my Power PC macs
just at the moment. Just building R-2.4-0 one one of them.)

There is test code available at
  www.omegahat.org/Misc/Rdynunload.tar.gz

The script run.R does the builds and load and unloads
and runs the entire test. Without a programmatic test
it is easy to test the wrong thing.

 D.

stefano iacus wrote:
> In OS X you cannot "unload" dynamically linked code. This is a known  
> "feature" of OS X :(
> This is not an R bug.
> 
> stefano
> 
> On 15/nov/06, at 15:27, tuke at senet.com.au wrote:
> 
> 
>>Full_Name: Jonathan Tuke
>>Version: 2.4.0
>>OS: Mac OS X 10.4.8
>>Submission from: (NULL) (203.173.46.189)
>>
>>
>>I am writing C code to implement in R. I am using R CMD SHLIB and then
>>dyn.load("file.so"). The function I then call with .C("function").  
>>Since I
>>installed the latest R version, I have found that if I alter my C  
>>code and
>>recompile, then use dyn.load("file.so"), the function in R is not  
>>updated but
>>remains as the previous code. I have tried dyn.unload, but when I  
>>use dyn.load()
>>the initially loaded code is used. The only way to load the updated  
>>c code is to
>>quit R and then reopen.
>>
>>Thanks,
>>Jono
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFFWy0Y9p/Jzwa2QP4RAnN1AJ9Az6aBRcJWBNPvsn/1BmDb8wA4LACfaxWP
dGWqKjqt98xG50LDRJoo4uY=
=EoRV
-----END PGP SIGNATURE-----


From p.dalgaard at biostat.ku.dk  Wed Nov 15 16:07:19 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 15 Nov 2006 16:07:19 +0100
Subject: [Rd] save objects from function (PR#9365)
In-Reply-To: <20061115143439.68D41572DC@slim.kubism.ku.dk>
References: <20061115143439.68D41572DC@slim.kubism.ku.dk>
Message-ID: <x2lkmcd9zs.fsf@viggo.kubism.ku.dk>

dragan.sestovic at ubs.com writes:

> Full_Name: Dragan Sestovic
> Version: 2.3.0
> OS: Windows XP
> Submission from: (NULL) (139.149.1.194)
> 
> 
> I can not save R objects from function using "save". The simple example is
> below:
> I do not understand why function funSave.1 fails. Also, why does function
> funSave.2 work? 
> 
> > funSave.1 <- function(a)
> + {
> +   save(a, file="a.1.dat")
> + }
> > 
> > funSave.2 <- function(a)
> + {
> +   b <- a
> +   save(a, file="a.2.dat")
> + }
> > 
> > a <- 1:10
> > a
>  [1]  1  2  3  4  5  6  7  8  9 10
> > save(a, file="a.dat")
> > load("a.dat")
> > a
>  [1]  1  2  3  4  5  6  7  8  9 10
> > a <- 1:10
> > funSave.1(a)
> > load("a.1.dat")
> > a
> Error: recursive default argument reference
> > a <- 1:10
> > funSave.2(b)
> > load("a.2.dat")
> > a
>  [1]  1  2  3  4  5  6  7  8  9 10

.........
I cannot reproduce this in a current(!) R:

> funSave.1 <- function(a)
+ {
+   save(a, file="a.1.dat")
+ }
>
> funSave.2 <- function(a)
+ {
+   b <- a
+   save(a, file="a.2.dat")
+ }
>
> a <- 1:10
> a
 [1]  1  2  3  4  5  6  7  8  9 10
> save(a, file="a.dat")
> load("a.dat")
> a
 [1]  1  2  3  4  5  6  7  8  9 10
> a <- 1:10
> funSave.1(a)
> load("a.1.dat")
> a
 [1]  1  2  3  4  5  6  7  8  9 10
> a <- 1:10
> funSave.2(b)
Error in funSave.2(b) : object "b" not found
> load("a.2.dat")
Error in readChar(con, 5) : cannot open the connection
In addition: Warning message:
cannot open compressed file 'a.2.dat'
> a
 [1]  1  2  3  4  5  6  7  8  9 10
> a <- 1:10
> funSave.2(a)
> load("a.2.dat")
> a
 [1]  1  2  3  4  5  6  7  8  9 10


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From duncan at wald.ucdavis.edu  Wed Nov 15 16:07:34 2006
From: duncan at wald.ucdavis.edu (duncan at wald.ucdavis.edu)
Date: Wed, 15 Nov 2006 16:07:34 +0100 (CET)
Subject: [Rd] dyn.load (PR#9364)
Message-ID: <20061115150734.0D7BD572A6@slim.kubism.ku.dk>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


I was just testing this myself on various machines.
And it behaves on Linux, Windows and also on
my Intel Mac (OS X 10.4.8).

Stefano, is this restriction on OS X still in effect?
(Unfortunately I can't test this on any of my Power PC macs
just at the moment. Just building R-2.4-0 one one of them.)

There is test code available at
  www.omegahat.org/Misc/Rdynunload.tar.gz

The script run.R does the builds and load and unloads
and runs the entire test. Without a programmatic test
it is easy to test the wrong thing.

 D.

stefano iacus wrote:
> In OS X you cannot "unload" dynamically linked code. This is a known  
> "feature" of OS X :(
> This is not an R bug.
> 
> stefano
> 
> On 15/nov/06, at 15:27, tuke at senet.com.au wrote:
> 
> 
>>Full_Name: Jonathan Tuke
>>Version: 2.4.0
>>OS: Mac OS X 10.4.8
>>Submission from: (NULL) (203.173.46.189)
>>
>>
>>I am writing C code to implement in R. I am using R CMD SHLIB and then
>>dyn.load("file.so"). The function I then call with .C("function").  
>>Since I
>>installed the latest R version, I have found that if I alter my C  
>>code and
>>recompile, then use dyn.load("file.so"), the function in R is not  
>>updated but
>>remains as the previous code. I have tried dyn.unload, but when I  
>>use dyn.load()
>>the initially loaded code is used. The only way to load the updated  
>>c code is to
>>quit R and then reopen.
>>
>>Thanks,
>>Jono
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFFWy0Y9p/Jzwa2QP4RAnN1AJ9Az6aBRcJWBNPvsn/1BmDb8wA4LACfaxWP
dGWqKjqt98xG50LDRJoo4uY=
=EoRV
-----END PGP SIGNATURE-----


From stefano.iacus at unimi.it  Wed Nov 15 16:11:16 2006
From: stefano.iacus at unimi.it (stefano iacus)
Date: Thu, 16 Nov 2006 00:11:16 +0900
Subject: [Rd] dyn.load (PR#9364)
In-Reply-To: <455B2D18.8060104@wald.ucdavis.edu>
References: <20061115062705.EC32656226@slim.kubism.ku.dk>
	<7344E92E-1E73-4980-AE01-49E084211020@unimi.it>
	<455B2D18.8060104@wald.ucdavis.edu>
Message-ID: <6DB16D79-7C2F-4478-AE2D-E969DE494887@unimi.it>

I'll test your script.
Simon also made the same remark. Maybe in 10.4 this problem is solved.

But apparently, if I load a package and then try to detach it, R  
still keeps open the .so file for that package.
Is this expected for a successful unload (given that I never had  
experience of a successful unload I can't tell)? (I'm using ppc)

stefano





On 16/nov/06, at 00:07, Duncan Temple Lang wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> I was just testing this myself on various machines.
> And it behaves on Linux, Windows and also on
> my Intel Mac (OS X 10.4.8).
>
> Stefano, is this restriction on OS X still in effect?
> (Unfortunately I can't test this on any of my Power PC macs
> just at the moment. Just building R-2.4-0 one one of them.)
>
> There is test code available at
>   www.omegahat.org/Misc/Rdynunload.tar.gz
>
> The script run.R does the builds and load and unloads
> and runs the entire test. Without a programmatic test
> it is easy to test the wrong thing.
>
>  D.
>
> stefano iacus wrote:
>> In OS X you cannot "unload" dynamically linked code. This is a known
>> "feature" of OS X :(
>> This is not an R bug.
>>
>> stefano
>>
>> On 15/nov/06, at 15:27, tuke at senet.com.au wrote:
>>
>>
>>> Full_Name: Jonathan Tuke
>>> Version: 2.4.0
>>> OS: Mac OS X 10.4.8
>>> Submission from: (NULL) (203.173.46.189)
>>>
>>>
>>> I am writing C code to implement in R. I am using R CMD SHLIB and  
>>> then
>>> dyn.load("file.so"). The function I then call with .C("function").
>>> Since I
>>> installed the latest R version, I have found that if I alter my C
>>> code and
>>> recompile, then use dyn.load("file.so"), the function in R is not
>>> updated but
>>> remains as the previous code. I have tried dyn.unload, but when I
>>> use dyn.load()
>>> the initially loaded code is used. The only way to load the updated
>>> c code is to
>>> quit R and then reopen.
>>>
>>> Thanks,
>>> Jono
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> - --
> Duncan Temple Lang                    duncan at wald.ucdavis.edu
> Department of Statistics              work:  (530) 752-4782
> 4210 Mathematical Sciences Building   fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis,
> CA 95616,
> USA
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.3 (Darwin)
>
> iD8DBQFFWy0Y9p/Jzwa2QP4RAnN1AJ9Az6aBRcJWBNPvsn/1BmDb8wA4LACfaxWP
> dGWqKjqt98xG50LDRJoo4uY=
> =EoRV
> -----END PGP SIGNATURE-----


From stefano.iacus at unimi.it  Wed Nov 15 16:11:43 2006
From: stefano.iacus at unimi.it (stefano.iacus at unimi.it)
Date: Wed, 15 Nov 2006 16:11:43 +0100 (CET)
Subject: [Rd] dyn.load (PR#9364)
Message-ID: <20061115151143.2EA4357294@slim.kubism.ku.dk>

I'll test your script.
Simon also made the same remark. Maybe in 10.4 this problem is solved.

But apparently, if I load a package and then try to detach it, R  
still keeps open the .so file for that package.
Is this expected for a successful unload (given that I never had  
experience of a successful unload I can't tell)? (I'm using ppc)

stefano





On 16/nov/06, at 00:07, Duncan Temple Lang wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> I was just testing this myself on various machines.
> And it behaves on Linux, Windows and also on
> my Intel Mac (OS X 10.4.8).
>
> Stefano, is this restriction on OS X still in effect?
> (Unfortunately I can't test this on any of my Power PC macs
> just at the moment. Just building R-2.4-0 one one of them.)
>
> There is test code available at
>   www.omegahat.org/Misc/Rdynunload.tar.gz
>
> The script run.R does the builds and load and unloads
> and runs the entire test. Without a programmatic test
> it is easy to test the wrong thing.
>
>  D.
>
> stefano iacus wrote:
>> In OS X you cannot "unload" dynamically linked code. This is a known
>> "feature" of OS X :(
>> This is not an R bug.
>>
>> stefano
>>
>> On 15/nov/06, at 15:27, tuke at senet.com.au wrote:
>>
>>
>>> Full_Name: Jonathan Tuke
>>> Version: 2.4.0
>>> OS: Mac OS X 10.4.8
>>> Submission from: (NULL) (203.173.46.189)
>>>
>>>
>>> I am writing C code to implement in R. I am using R CMD SHLIB and  
>>> then
>>> dyn.load("file.so"). The function I then call with .C("function").
>>> Since I
>>> installed the latest R version, I have found that if I alter my C
>>> code and
>>> recompile, then use dyn.load("file.so"), the function in R is not
>>> updated but
>>> remains as the previous code. I have tried dyn.unload, but when I
>>> use dyn.load()
>>> the initially loaded code is used. The only way to load the updated
>>> c code is to
>>> quit R and then reopen.
>>>
>>> Thanks,
>>> Jono
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> - --
> Duncan Temple Lang                    duncan at wald.ucdavis.edu
> Department of Statistics              work:  (530) 752-4782
> 4210 Mathematical Sciences Building   fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis,
> CA 95616,
> USA
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.3 (Darwin)
>
> iD8DBQFFWy0Y9p/Jzwa2QP4RAnN1AJ9Az6aBRcJWBNPvsn/1BmDb8wA4LACfaxWP
> dGWqKjqt98xG50LDRJoo4uY=
> =EoRV
> -----END PGP SIGNATURE-----


From stefano.iacus at unimi.it  Wed Nov 15 16:14:06 2006
From: stefano.iacus at unimi.it (stefano iacus)
Date: Thu, 16 Nov 2006 00:14:06 +0900
Subject: [Rd] dyn.load (PR#9364)
In-Reply-To: <455B2D18.8060104@wald.ucdavis.edu>
References: <20061115062705.EC32656226@slim.kubism.ku.dk>
	<7344E92E-1E73-4980-AE01-49E084211020@unimi.it>
	<455B2D18.8060104@wald.ucdavis.edu>
Message-ID: <3154583F-2F64-4111-96E5-39213497C624@unimi.it>

here is the output


 > source("run.R")
gcc-4.0 -arch ppc -I/Library/Frameworks/R.framework/Resources/include  
-I/Library/Frameworks/R.framework/Resources/include/ppc  -I/usr/local/ 
include    -fPIC  -g -O2 -std=gnu99 -c code.c -o code.o
gcc-4.0 -arch ppc -dynamiclib -Wl,-macosx_version_min -Wl,10.3 - 
undefined dynamic_lookup -single_module -multiply_defined suppress -L/ 
usr/local/lib -o foo.so code.o   -L/Library/Frameworks/R.framework/ 
Resources/lib/ppc -lR -dylib_file libRblas.dylib:/Library/Frameworks/ 
R.framework/Resources/lib/ppc/libRblas.dylib
loaded DLL/SO
first attempt
gcc-4.0 -arch ppc -I/Library/Frameworks/R.framework/Resources/include  
-I/Library/Frameworks/R.framework/Resources/include/ppc  -I/usr/local/ 
include    -fPIC  -g -O2 -std=gnu99 -c other.c -o other.o
gcc-4.0 -arch ppc -dynamiclib -Wl,-macosx_version_min -Wl,10.3 - 
undefined dynamic_lookup -single_module -multiply_defined suppress -L/ 
usr/local/lib -o foo.so other.o   -L/Library/Frameworks/R.framework/ 
Resources/lib/ppc -lR -dylib_file libRblas.dylib:/Library/Frameworks/ 
R.framework/Resources/lib/ppc/libRblas.dylib
loaded DLL/SO
first attempt
[1] "Failed"


On 16/nov/06, at 00:07, Duncan Temple Lang wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> I was just testing this myself on various machines.
> And it behaves on Linux, Windows and also on
> my Intel Mac (OS X 10.4.8).
>
> Stefano, is this restriction on OS X still in effect?
> (Unfortunately I can't test this on any of my Power PC macs
> just at the moment. Just building R-2.4-0 one one of them.)
>
> There is test code available at
>   www.omegahat.org/Misc/Rdynunload.tar.gz
>
> The script run.R does the builds and load and unloads
> and runs the entire test. Without a programmatic test
> it is easy to test the wrong thing.
>
>  D.
>
> stefano iacus wrote:
>> In OS X you cannot "unload" dynamically linked code. This is a known
>> "feature" of OS X :(
>> This is not an R bug.
>>
>> stefano
>>
>> On 15/nov/06, at 15:27, tuke at senet.com.au wrote:
>>
>>
>>> Full_Name: Jonathan Tuke
>>> Version: 2.4.0
>>> OS: Mac OS X 10.4.8
>>> Submission from: (NULL) (203.173.46.189)
>>>
>>>
>>> I am writing C code to implement in R. I am using R CMD SHLIB and  
>>> then
>>> dyn.load("file.so"). The function I then call with .C("function").
>>> Since I
>>> installed the latest R version, I have found that if I alter my C
>>> code and
>>> recompile, then use dyn.load("file.so"), the function in R is not
>>> updated but
>>> remains as the previous code. I have tried dyn.unload, but when I
>>> use dyn.load()
>>> the initially loaded code is used. The only way to load the updated
>>> c code is to
>>> quit R and then reopen.
>>>
>>> Thanks,
>>> Jono
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> - --
> Duncan Temple Lang                    duncan at wald.ucdavis.edu
> Department of Statistics              work:  (530) 752-4782
> 4210 Mathematical Sciences Building   fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis,
> CA 95616,
> USA
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.3 (Darwin)
>
> iD8DBQFFWy0Y9p/Jzwa2QP4RAnN1AJ9Az6aBRcJWBNPvsn/1BmDb8wA4LACfaxWP
> dGWqKjqt98xG50LDRJoo4uY=
> =EoRV
> -----END PGP SIGNATURE-----


From stefano.iacus at unimi.it  Wed Nov 15 16:14:34 2006
From: stefano.iacus at unimi.it (stefano.iacus at unimi.it)
Date: Wed, 15 Nov 2006 16:14:34 +0100 (CET)
Subject: [Rd] dyn.load (PR#9364)
Message-ID: <20061115151434.8073557294@slim.kubism.ku.dk>

here is the output


 > source("run.R")
gcc-4.0 -arch ppc -I/Library/Frameworks/R.framework/Resources/include  
-I/Library/Frameworks/R.framework/Resources/include/ppc  -I/usr/local/ 
include    -fPIC  -g -O2 -std=gnu99 -c code.c -o code.o
gcc-4.0 -arch ppc -dynamiclib -Wl,-macosx_version_min -Wl,10.3 - 
undefined dynamic_lookup -single_module -multiply_defined suppress -L/ 
usr/local/lib -o foo.so code.o   -L/Library/Frameworks/R.framework/ 
Resources/lib/ppc -lR -dylib_file libRblas.dylib:/Library/Frameworks/ 
R.framework/Resources/lib/ppc/libRblas.dylib
loaded DLL/SO
first attempt
gcc-4.0 -arch ppc -I/Library/Frameworks/R.framework/Resources/include  
-I/Library/Frameworks/R.framework/Resources/include/ppc  -I/usr/local/ 
include    -fPIC  -g -O2 -std=gnu99 -c other.c -o other.o
gcc-4.0 -arch ppc -dynamiclib -Wl,-macosx_version_min -Wl,10.3 - 
undefined dynamic_lookup -single_module -multiply_defined suppress -L/ 
usr/local/lib -o foo.so other.o   -L/Library/Frameworks/R.framework/ 
Resources/lib/ppc -lR -dylib_file libRblas.dylib:/Library/Frameworks/ 
R.framework/Resources/lib/ppc/libRblas.dylib
loaded DLL/SO
first attempt
[1] "Failed"


On 16/nov/06, at 00:07, Duncan Temple Lang wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> I was just testing this myself on various machines.
> And it behaves on Linux, Windows and also on
> my Intel Mac (OS X 10.4.8).
>
> Stefano, is this restriction on OS X still in effect?
> (Unfortunately I can't test this on any of my Power PC macs
> just at the moment. Just building R-2.4-0 one one of them.)
>
> There is test code available at
>   www.omegahat.org/Misc/Rdynunload.tar.gz
>
> The script run.R does the builds and load and unloads
> and runs the entire test. Without a programmatic test
> it is easy to test the wrong thing.
>
>  D.
>
> stefano iacus wrote:
>> In OS X you cannot "unload" dynamically linked code. This is a known
>> "feature" of OS X :(
>> This is not an R bug.
>>
>> stefano
>>
>> On 15/nov/06, at 15:27, tuke at senet.com.au wrote:
>>
>>
>>> Full_Name: Jonathan Tuke
>>> Version: 2.4.0
>>> OS: Mac OS X 10.4.8
>>> Submission from: (NULL) (203.173.46.189)
>>>
>>>
>>> I am writing C code to implement in R. I am using R CMD SHLIB and  
>>> then
>>> dyn.load("file.so"). The function I then call with .C("function").
>>> Since I
>>> installed the latest R version, I have found that if I alter my C
>>> code and
>>> recompile, then use dyn.load("file.so"), the function in R is not
>>> updated but
>>> remains as the previous code. I have tried dyn.unload, but when I
>>> use dyn.load()
>>> the initially loaded code is used. The only way to load the updated
>>> c code is to
>>> quit R and then reopen.
>>>
>>> Thanks,
>>> Jono
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> - --
> Duncan Temple Lang                    duncan at wald.ucdavis.edu
> Department of Statistics              work:  (530) 752-4782
> 4210 Mathematical Sciences Building   fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis,
> CA 95616,
> USA
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.3 (Darwin)
>
> iD8DBQFFWy0Y9p/Jzwa2QP4RAnN1AJ9Az6aBRcJWBNPvsn/1BmDb8wA4LACfaxWP
> dGWqKjqt98xG50LDRJoo4uY=
> =EoRV
> -----END PGP SIGNATURE-----


From duncan at wald.ucdavis.edu  Wed Nov 15 16:19:31 2006
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Wed, 15 Nov 2006 07:19:31 -0800
Subject: [Rd] dyn.load (PR#9364)
In-Reply-To: <20061115151434.8073557294@slim.kubism.ku.dk>
References: <20061115151434.8073557294@slim.kubism.ku.dk>
Message-ID: <455B3003.5010706@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Great. So now we know that Johnatha is running on a PPC.
Unfortunately, this isn't included in the details of the
OS in the bug report.

stefano.iacus at unimi.it wrote:
> here is the output
> 
> 
>  > source("run.R")
> gcc-4.0 -arch ppc -I/Library/Frameworks/R.framework/Resources/include  
> -I/Library/Frameworks/R.framework/Resources/include/ppc  -I/usr/local/ 
> include    -fPIC  -g -O2 -std=gnu99 -c code.c -o code.o
> gcc-4.0 -arch ppc -dynamiclib -Wl,-macosx_version_min -Wl,10.3 - 
> undefined dynamic_lookup -single_module -multiply_defined suppress -L/ 
> usr/local/lib -o foo.so code.o   -L/Library/Frameworks/R.framework/ 
> Resources/lib/ppc -lR -dylib_file libRblas.dylib:/Library/Frameworks/ 
> R.framework/Resources/lib/ppc/libRblas.dylib
> loaded DLL/SO
> first attempt
> gcc-4.0 -arch ppc -I/Library/Frameworks/R.framework/Resources/include  
> -I/Library/Frameworks/R.framework/Resources/include/ppc  -I/usr/local/ 
> include    -fPIC  -g -O2 -std=gnu99 -c other.c -o other.o
> gcc-4.0 -arch ppc -dynamiclib -Wl,-macosx_version_min -Wl,10.3 - 
> undefined dynamic_lookup -single_module -multiply_defined suppress -L/ 
> usr/local/lib -o foo.so other.o   -L/Library/Frameworks/R.framework/ 
> Resources/lib/ppc -lR -dylib_file libRblas.dylib:/Library/Frameworks/ 
> R.framework/Resources/lib/ppc/libRblas.dylib
> loaded DLL/SO
> first attempt
> [1] "Failed"
> 
> 
> On 16/nov/06, at 00:07, Duncan Temple Lang wrote:
> 
> 
> 
> I was just testing this myself on various machines.
> And it behaves on Linux, Windows and also on
> my Intel Mac (OS X 10.4.8).
> 
> Stefano, is this restriction on OS X still in effect?
> (Unfortunately I can't test this on any of my Power PC macs
> just at the moment. Just building R-2.4-0 one one of them.)
> 
> There is test code available at
>   www.omegahat.org/Misc/Rdynunload.tar.gz
> 
> The script run.R does the builds and load and unloads
> and runs the entire test. Without a programmatic test
> it is easy to test the wrong thing.
> 
>  D.
> 
> stefano iacus wrote:
> 
>>In OS X you cannot "unload" dynamically linked code. This is a known
>>"feature" of OS X :(
>>This is not an R bug.
> 
>>stefano
> 
>>On 15/nov/06, at 15:27, tuke at senet.com.au wrote:
> 
> 
> 
>>>Full_Name: Jonathan Tuke
>>>Version: 2.4.0
>>>OS: Mac OS X 10.4.8
>>>Submission from: (NULL) (203.173.46.189)
> 
> 
>>>I am writing C code to implement in R. I am using R CMD SHLIB and  
>>>then
>>>dyn.load("file.so"). The function I then call with .C("function").
>>>Since I
>>>installed the latest R version, I have found that if I alter my C
>>>code and
>>>recompile, then use dyn.load("file.so"), the function in R is not
>>>updated but
>>>remains as the previous code. I have tried dyn.unload, but when I
>>>use dyn.load()
>>>the initially loaded code is used. The only way to load the updated
>>>c code is to
>>>quit R and then reopen.
> 
>>>Thanks,
>>>Jono
> 
>>>______________________________________________
>>>R-devel at r-project.org mailing list
>>>https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> 
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> --
> Duncan Temple Lang                    duncan at wald.ucdavis.edu
> Department of Statistics              work:  (530) 752-4782
> 4210 Mathematical Sciences Building   fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis,
> CA 95616,
> USA

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFFWzAD9p/Jzwa2QP4RAjbkAJ49mY7NM24Obpmmd+KyofKzWM1QSwCdE2O+
OiS43SZp8c05l6P0aEIJkk8=
=yxdw
-----END PGP SIGNATURE-----


From sfalcon at fhcrc.org  Wed Nov 15 16:32:54 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 15 Nov 2006 07:32:54 -0800
Subject: [Rd] Feature request: put NewEnvironment and R_NewhashedEnv
	into API
In-Reply-To: <Pine.LNX.4.64.0611150537070.2837@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Wed, 15 Nov 2006 06:20:06 +0000 (GMT)")
References: <m2ac2th35g.fsf@ziti.local>
	<Pine.LNX.4.64.0611150537070.2837@gannet.stats.ox.ac.uk>
Message-ID: <m21wo4g1y1.fsf@ziti.local>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
> NewEnvironment is currently exposed as Rf_NewEnvironment.
> R_NewHashedEnv is currrently hidden, but I'll unhide it.  It does not
> need a further prefix.

Thank you.  Could someone provide a bit more detail on how to
determine if a given function in R's C code is exposed and/or public
or not?

Here's my current understanding after taking a look at Brian's patch
r39907:

A function can be hidden or not, but this is independent of whether the
function is "sanctioned" as part of R's package API.  Functions that
are not hidden can be used from package C code, but that doesn't
answer whether they _should_ be used.

To determine if a function is public, look at the headers in
R/src/include and refer to the README.  Thus, NewEnvironment and
R_NewHashedEnv, are both private since they are declared in Defn.h.
At present, one could call these function in package code, since they
are not hidden.

+ seth


From mdowle at concordiafunds.com  Wed Nov 15 16:30:16 2006
From: mdowle at concordiafunds.com (Matthew Dowle)
Date: Wed, 15 Nov 2006 15:30:16 -0000
Subject: [Rd] c.factor
Message-ID: <946928E281E8FD4B91D5B2CC3C91967D6AA9B0@lnex01.CONCORDIAFUNDS.COM>


> Just for clarification, my interest was only to provide an 
> alternative that provided for a more generic approach, at 
> least in a narrow application, not that I was advocating it's 
> need.

Understood, apologies for falsely implying your advocation.

> I would agree with Prof. Ripley's comments, that one needs to 
> be quite careful in manipulating factors in this fashion, not 
> the least of which would be ordered factors, which have not 
> been considered here and could/would introduce their own 
> idiosyncrasies in this context.

I agree with that of course.

> If something like this gets implemented (ie. concat()) one 
> would need to fully understand the behavioral subtleties and 
> the nature of the results, lest naive users find themselves 
> in the potential presence of cascading errors.

Agree with that too.


From maechler at stat.math.ethz.ch  Wed Nov 15 17:24:02 2006
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Wed, 15 Nov 2006 17:24:02 +0100 (CET)
Subject: [Rd] Building R (PR#9366)
Message-ID: <20061115162402.5DF73572D6@slim.kubism.ku.dk>

>>>>> "Julien" == Julien Steiner <Julien.Steiner at imd.ch>
>>>>>     on Wed, 15 Nov 2006 15:47:05 +0100 (CET) writes:

    Julien> Hello,
    Julien> =20

    Julien> I get this error when I try to install R-2.4.0 on Solaris 10

    Julien> Any Assistance would be greatly appreciated

Not very likely to get
after you make us all mad by filing a bug report
just because you have a problem....

But even if this was not sent to R-bugs (as it NEVER should have)
you are not giving enough information *by far*.

Please do read the posting guide, 
       ^^^^^^^^^^^^^^^^^^^^^^^^^
       http://www.r-project.org/posting-guide.html

and then try following it --- asking a kind question on R-devel.




    Julien> The ./configure thing passed but then on gmake I get :

    Julien> =20

    Julien> Undefined                       first referenced

    Julien> symbol                             in file

    Julien> __builtin_isnan                     arithmetic.o

    Julien> ld: fatal: Symbol referencing errors. No output written to R.bin

    Julien> collect2: ld returned 1 exit status

    Julien> gmake[3]: *** [R.bin] Error 1

    Julien> gmake[3]: Leaving directory

    Julien> `/usr/local/R_HOME/R-2.4.0/src/main'

    Julien> gmake[2]: *** [R] Error 2

    Julien> gmake[2]: Leaving directory

    Julien> `/usr/local/R_HOME/R-2.4.0/src/main'

    Julien> gmake[1]: *** [R] Error 1

    Julien> gmake[1]: Leaving directory `/usr/local/R_HOME/R-2.4.0/src'

    Julien> gmake: *** [R] Error 1

    Julien> =20


    Julien> [[alternative HTML version deleted]]

    Julien> ______________________________________________
    Julien> R-devel at r-project.org mailing list
    Julien> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Wed Nov 15 17:44:53 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 15 Nov 2006 16:44:53 +0000 (GMT)
Subject: [Rd] Feature request: put NewEnvironment and R_NewhashedEnv
 into API
In-Reply-To: <m21wo4g1y1.fsf@ziti.local>
References: <m2ac2th35g.fsf@ziti.local>
	<Pine.LNX.4.64.0611150537070.2837@gannet.stats.ox.ac.uk>
	<m21wo4g1y1.fsf@ziti.local>
Message-ID: <Pine.LNX.4.64.0611151623540.5340@gannet.stats.ox.ac.uk>

On Wed, 15 Nov 2006, Seth Falcon wrote:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>> NewEnvironment is currently exposed as Rf_NewEnvironment.
>> R_NewHashedEnv is currrently hidden, but I'll unhide it.  It does not
>> need a further prefix.
>
> Thank you.  Could someone provide a bit more detail on how to
> determine if a given function in R's C code is exposed and/or public
> or not?
>
> Here's my current understanding after taking a look at Brian's patch
> r39907:
>
> A function can be hidden or not, but this is independent of whether the
> function is "sanctioned" as part of R's package API.  Functions that
> are not hidden can be used from package C code, but that doesn't
> answer whether they _should_ be used.

It is the intention that no entry point in the API is hidden, so any found 
would be a mistake (please report). All others will potentially be, and 
probably are unless they are used by a module or a standard package or 
some older package known to us.

[Hiding occurs in two places, by 'attribute_hidden' in the C source and 
the file src/gnuwin/Rdll.hide.]

> To determine if a function is public, look at the headers in
> R/src/include and refer to the README.

It may be better to look in the installed headers in R_HOME/include in an 
installed version.  I am not sure anyone aims to keep README fully up to 
date.

> Thus, NewEnvironment and R_NewHashedEnv, are both private since they are 
> declared in Defn.h. At present, one could call these function in package 
> code, since they are not hidden.

There's another layer: to be in the API they need to documented in R-exts.
There are many public but non-API entry points.

So:

API: documented in R-exts and in an installed header file

public: in an installed header file

private: visible on all systems but not in any installed header file

hidden: not visible on either Windows on a modern Unix in libR.so (or 
both) -- ulitmately you need to check R.dll and libR.so.

I try to avoid the 'should' word (some posters here are far too fond of 
telling us what 'R should do'): I believe what we say is that using 
non-API entry points is likely to lead to breakage without any warning.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bill at insightful.com  Wed Nov 15 18:24:48 2006
From: bill at insightful.com (Bill Dunlap)
Date: Wed, 15 Nov 2006 09:24:48 -0800 (PST)
Subject: [Rd] c.factor
In-Reply-To: <Pine.LNX.4.64.0611150926070.19618@auk.stats>
References: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM>
	<1163526685.4492.20.camel@localhost.localdomain>
	<1163527030.4492.23.camel@localhost.localdomain>
	<Pine.LNX.4.64.0611141809050.25751@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0611141218410.17778@durian.statsci.com>
	<Pine.LNX.4.64.0611150926070.19618@auk.stats>
Message-ID: <Pine.GSO.4.56.0611150918020.12673@durian.statsci.com>

> > In addition, c() has always had a double meaning of
> >  (a) turning an object into a simple "vector" (an object
> >      without "attributes"), as in
> >      > c(factor(c("Cat","Dog","Cat")))
> >      [1] 1 2 1
> >      > c(data.frame(x=1:2,y=c("Dog","Cat")))
> >      $x
> >      [1] 1 2
> >
> >      $y
> >      [1] Dog Cat
> >      Levels: Cat Dog
>
> To my surprise that was not documented at all on the R help page, and I've
> clarified it.  (BTW, at least in R it does not remove names, just all
> other attributes.)

It does not remove names in Splus either, just all
other attributes.  I see c() used in several Splus
functions as a way to convert a matrix into a vector
(by removing the .Dims and .Dimnames attributes).

> I think working on a concat() for R would be helpful.  I vaguely recalled
> something like it in the Green Book, but the index does not help (but then
> it is not very complete).

Splus does have a concat().  I believe it is modelled
after the Green Book example.  It uses a helper function
called concat.two(x,y) with is generic and has 2 arguments
to make it easer to write methods for.  concat(x,y,z)
calls concat.two(concat.two(x,y),z).  concat() is not used much,
but it is the Summary group functions: min, max, sum, etc.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From B.Rowlingson at lancaster.ac.uk  Wed Nov 15 18:45:31 2006
From: B.Rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 15 Nov 2006 17:45:31 +0000
Subject: [Rd] c.factor
In-Reply-To: <Pine.GSO.4.56.0611150918020.12673@durian.statsci.com>
References: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM>	<1163526685.4492.20.camel@localhost.localdomain>	<1163527030.4492.23.camel@localhost.localdomain>	<Pine.LNX.4.64.0611141809050.25751@gannet.stats.ox.ac.uk>	<Pine.GSO.4.56.0611141218410.17778@durian.statsci.com>	<Pine.LNX.4.64.0611150926070.19618@auk.stats>
	<Pine.GSO.4.56.0611150918020.12673@durian.statsci.com>
Message-ID: <455B523B.4050800@lancaster.ac.uk>


> 
> It does not remove names in Splus either, just all
> other attributes.  I see c() used in several Splus
> functions as a way to convert a matrix into a vector
> (by removing the .Dims and .Dimnames attributes).
> 

  I dont see the logic in certain attribute names (?attr lists 'class', 
'comment', 'dim', 'dimnames', 'names', 'row.names' and 'tsp') being 
'special'. Why are matrices  vectors with some 'magic' attribute 'dim', 
and possibly some non-magic attributes like 'umbongo' and 'fnord'? I'd 
have the dim (and other essential properties of data structures) more 
tightly bound to the data. attr(M,'dim')=NULL seems a very odd way of 
turning a matrix into a vector.

  If I was the R bdfl[1] I'd deprecate using 'attr' to access these 
aspects of data objects and insist on using "dim(M)" or 
"row.names(M)=foo". Then I can use 'attr' for any old annotations, for 
example in my light bulb brightness study I could do:

  sample1 = c(4.2,4.5,4.8,4.1)
  attr(sample1,'dim') = TRUE

  sample2 = c(5.6,5.8,6.7,6.5,9.3)
  attr(sample2,'dim') = FALSE

Barry

[1] http://en.wikipedia.org/wiki/Benevolent_Dictator_for_Life


From Roger.Bivand at nhh.no  Wed Nov 15 19:27:11 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 15 Nov 2006 19:27:11 +0100 (CET)
Subject: [Rd] c.factor
In-Reply-To: <455B523B.4050800@lancaster.ac.uk>
Message-ID: <Pine.LNX.4.44.0611151916171.17215-100000@reclus.nhh.no>

On Wed, 15 Nov 2006, Barry Rowlingson wrote:

> 
> > 
> > It does not remove names in Splus either, just all
> > other attributes.  I see c() used in several Splus
> > functions as a way to convert a matrix into a vector
> > (by removing the .Dims and .Dimnames attributes).
> > 
> 
>   I dont see the logic in certain attribute names (?attr lists 'class', 
> 'comment', 'dim', 'dimnames', 'names', 'row.names' and 'tsp') being 
> 'special'. Why are matrices  vectors with some 'magic' attribute 'dim', 
> and possibly some non-magic attributes like 'umbongo' and 'fnord'? I'd 
> have the dim (and other essential properties of data structures) more 
> tightly bound to the data. attr(M,'dim')=NULL seems a very odd way of 
> turning a matrix into a vector.
> 
>   If I was the R bdfl[1] I'd deprecate using 'attr' to access these 
> aspects of data objects and insist on using "dim(M)" or 
> "row.names(M)=foo".

I have a less than vague feeling that you as bdfl are describing new-style 
classes:

library(Matrix)
x <- Matrix(1:6, nrow=2, ncol=3)
getSlots(class(x))
slot(x, "Dim")
slot(x, "Dim") <- NULL

but perhaps unfortunately:

slot(x, "Dim") <- as.integer(c(0,0,0))

works! Maybe not quite what was intended?

> Then I can use 'attr' for any old annotations, for 
> example in my light bulb brightness study I could do:
> 
>   sample1 = c(4.2,4.5,4.8,4.1)
>   attr(sample1,'dim') = TRUE
> 
>   sample2 = c(5.6,5.8,6.7,6.5,9.3)
>   attr(sample2,'dim') = FALSE
> 
> Barry
> 
> [1] http://en.wikipedia.org/wiki/Benevolent_Dictator_for_Life
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From vdergachev at rcgardis.com  Wed Nov 15 22:42:50 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 15 Nov 2006 16:42:50 -0500
Subject: [Rd] base-Ex.R make check failure
Message-ID: <200611151642.50702.vdergachev@rcgardis.com>


Hi all, 

   make check fails for me with latest SVN code for file base-Ex.R:


> sw[1,]       # a one-row data frame
Warning in format.data.frame(x, digits = digits, na.encode = FALSE) :
         corrupt data frame: columns will be truncated or padded with NAs
           Fertility Agriculture Examination Education
Courtelary      80.2          17          15        12
> sw[1,, drop=TRUE]  # a list
Warning in format.data.frame(x, digits = digits, na.encode = FALSE) :
         corrupt data frame: columns will be truncated or padded with NAs
           Fertility Agriculture Examination Education
Courtelary      80.2          17          15        12
>
> swiss[ c(1, 1:2), ]   # duplicate row, unique row names are created
Error in `[[<-.data.frame`(`*tmp*`, j, value = c(80.2, 80.2, 83.1)) :
        replacement has 3 rows, data has 47
Execution halted

  R-2.4.0 runs through the same test just fine.

  Does anyone else see the same thing ? 

                         thank you !

                              Vladimir Dergachev


From maechler at stat.math.ethz.ch  Thu Nov 16 10:07:51 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 16 Nov 2006 10:07:51 +0100
Subject: [Rd] valid objects -> using S4 {was "Re:  c.factor"}
In-Reply-To: <Pine.LNX.4.44.0611151916171.17215-100000@reclus.nhh.no>
References: <455B523B.4050800@lancaster.ac.uk>
	<Pine.LNX.4.44.0611151916171.17215-100000@reclus.nhh.no>
Message-ID: <17756.10855.57634.676687@stat.math.ethz.ch>

>>>>> "Roger" == Roger Bivand <Roger.Bivand at nhh.no>
>>>>>     on Wed, 15 Nov 2006 19:27:11 +0100 (CET) writes:

    Roger> On Wed, 15 Nov 2006, "BaRow" == Barry Rowlingson wrote:


      > BillD> It does not remove names in Splus either, just all
      > BillD> other attributes.  I see c() used in several Splus
      > BillD> functions as a way to convert a matrix into a vector
      > BillD> (by removing the .Dims and .Dimnames attributes).
      >> 
      BaRow> I dont see the logic in certain attribute names
      BaRow> (?attr lists 'class', 'comment', 'dim', 'dimnames',
      BaRow> 'names', 'row.names' and 'tsp') being 'special'. Why
      BaRow> are matrices vectors with some 'magic' attribute
      BaRow> 'dim', and possibly some non-magic attributes like
      BaRow> 'umbongo' and 'fnord'? I'd have the dim (and other
      BaRow> essential properties of data structures) more tightly
      BaRow> bound to the data. attr(M,'dim')=NULL seems a very
      BaRow> odd way of turning a matrix into a vector.
      BaRow> 
      BaRow> If I was the R bdfl[1] I'd deprecate using 'attr' to
      BaRow> access these aspects of data objects and insist on
      BaRow> using "dim(M)" or "row.names(M)=foo".

    Roger> I have a less than vague feeling that you as bdfl are
    Roger> describing new-style classes:

indeed, thank you, Roger!

    Roger> library(Matrix)
    Roger> x <- Matrix(1:6, nrow=2, ncol=3)
    Roger> getSlots(class(x))
    Roger> slot(x, "Dim")
    Roger> slot(x, "Dim") <- NULL

which gives

Error in checkSlotAssignment(object, name, value) : 
	assignment of an object of class "NULL" is not valid for slot "Dim" in an object of class "dgeMatrix"; is(value, "integer") is not TRUE

    Roger> but perhaps unfortunately:

    Roger> slot(x, "Dim") <- as.integer(c(0,0,0))

    Roger> works! Maybe not quite what was intended?

Indeed it does not signal an error,  surprisingly to you and others.
Note however that subsequently

 > validObject(x)
 Error in validObject(x) : invalid class "dgeMatrix" object: Dim slot must be of length 2

. . . . . 

This seems to have become a QFAQ (quite frequently asked question):

 Q: Why does R not signal an error when I assign invalid contents
    to a slot of an S4 object?

 A: Calling validObject() on every slot assignment would
    - inhibit building S4 objects incrementally ``until they are valid''
    - potentially lead to too slowly executing code.

Consequence:  

 Only ``low-level'' programming should use
   slot(A, "sn") <- ....  or the equivalent
        A @ sn   <- ....
 and then the programmeR is solely responsible to construct a
 valid object -- or needs to expliclictly call validObject() at
 the end of the construction process.

 Normal construction of S4 objects should use

 - either  new("..", .....)  
   which calls validObject() 
   [unless for new("...") with no extra args]

 - or higher level constructors 
   such as you did in the example by calling Matrix().
   

John Chambers has much more to say on this, but I think most of
it has already been written in the Green Book.

--
Martin Maechler, ETH Zurich


From cig32650 at syd.odn.ne.jp  Thu Nov 16 14:41:51 2006
From: cig32650 at syd.odn.ne.jp (cig32650 at syd.odn.ne.jp)
Date: Thu, 16 Nov 2006 14:41:51 +0100 (CET)
Subject: [Rd] unwarranted warning from hist.default (PR#9356)
Message-ID: <20061116134151.2D05457294@slim.kubism.ku.dk>

 > There's a stop
 > list coded by
 >
 >         nf <- nf[is.na(match(nf, c("x", "breaks", "freq", "nclass",
 >             "plot", "probability")))]
 >
 > and I think the problem is just that "include.lowest" should have  
been
 > on the list.

I think that "right" should have been on the list, too.
Refer to the following examples.
The argument "right"fulfills the role.

 > set.seed(12345)
 > x <- rbinom(1000, 50, 0.3)

 > hist(x, right=FALSE, plot=FALSE)$counts
[1]   5  36  81 182 238 234 140  63  21
Warning message:
argument ?eright?f is not made use of in: hist.default(x, right =  
FALSE, plot = FALSE)

 > hist(x, right=TRUE, plot=FALSE)$counts
[1]  22  51 131 218 243 197  94  35   9
Warning message:
argument ?eright?f is not made use of in: hist.default(x, right =  
TRUE, plot = FALSE)

 > hist(x, plot=FALSE)$counts
[1]  22  51 131 218 243 197  94  35   9


From gregor.gorjanc at bfro.uni-lj.si  Thu Nov 16 22:24:33 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Thu, 16 Nov 2006 22:24:33 +0100
Subject: [Rd] Typo in save help page
Message-ID: <455CD711.8040803@bfro.uni-lj.si>

Hi,

Save help page, section Warnings, last paragraph, 3rd row, 1st word in a
row:

conpatible
  ^

should be

compatible

Regards, Gregor


From murdoch at stats.uwo.ca  Thu Nov 16 22:57:37 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 16 Nov 2006 16:57:37 -0500
Subject: [Rd] Typo in save help page
In-Reply-To: <455CD711.8040803@bfro.uni-lj.si>
References: <455CD711.8040803@bfro.uni-lj.si>
Message-ID: <455CDED1.8090500@stats.uwo.ca>

On 11/16/2006 4:24 PM, Gregor Gorjanc wrote:
> Hi,
> 
> Save help page, section Warnings, last paragraph, 3rd row, 1st word in a
> row:
> 
> conpatible
>   ^
> 
> should be
> 
> compatible

Thanks, I'll fix it.


From tom.mccallum at levelelimited.com  Fri Nov 17 15:29:33 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Fri, 17 Nov 2006 14:29:33 -0000
Subject: [Rd] Manipulating R lists in C
Message-ID: <op.ti5zvjybffxks9@norisk>

Hi,

I have been studying the R manual on lists but cannot seem to create a  
simple R list in C - I keep on getting "'dimnames' applied to non-array"  
whenever I attempt to assign names to the list elements:

Wanted output a list structure something like
	[ type="Bid", price=2.0, volume=1000 ]

I can get up to a list of
	[ "Bid2, 2.0, 1000 ]

But for the life of me I can't assign the names to the list items - any  
suggestions?

Below is what I already have - any comments on things I don't really need  
to do as well in terms of creating extra string objects etc are also  
helpful.

Many thanks

Tom


======EXTRACT=========


   SEXP typeStr, volumeStr, priceStr, typeValStr;
   SEXP priceList;

   // create main list of vectors (unspecific items )
   PROTECT( priceList = allocVector( VECSXP, 3 ) );

   // for each item create a label and attach value
   PROTECT( typeValStr = allocVector( STRSXP, 1 ) );
   SET_STRING_ELT( typeValStr, 0,  
mkChar( getPriceDataTypeAsString( p.getData().getType() ).c_str() ) );
   SET_STRING_ELT( priceList, 0, typeValStr) ;

   SEXP priceSXP;
   PROTECT( priceSXP = allocVector( REALSXP, 1) );
   REAL(priceSXP)[0] = p.getData().getPrice();
   SET_VECTOR_ELT( priceList, 1, priceSXP);

   SEXP volumeSXP;
   PROTECT( volumeSXP = allocVector( REALSXP, 1 ) );
   REAL(volumeSXP)[0] = p.getData().getVolume();
   SET_VECTOR_ELT( priceList, 2, volumeSXP);

   ********WORKS UP TO HERE*************

   // add the names of the list items (type,price,volume)
   SEXP dimnames;
   PROTECT( dimnames = allocVector( VECSXP, 3 ) );

   // first create string objects
   PROTECT( typeStr = allocVector( STRSXP,1 ) );
   SET_STRING_ELT( typeStr, 0, mkChar("type") );

   PROTECT( priceStr = allocVector( STRSXP,1 ) );
   SET_STRING_ELT( priceStr, 0, mkChar("price") );

   PROTECT( volumeStr = allocVector( STRSXP,1 ) );
   SET_STRING_ELT( volumeStr, 0, mkChar("volume") );

   // assign string objects to vector
   SET_VECTOR_ELT( dimnames, 0, typeStr );
   SET_VECTOR_ELT( dimnames, 1, priceStr);
   SET_VECTOR_ELT( dimnames, 2, volumeStr );

   // assign vector to original list of data
   setAttrib( priceList, R_DimNamesSymbol, dimnames ); <----- I think this  
is wrong but I don;t know what it should be

===========END EXTRACT===============

-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From Roger.Bivand at nhh.no  Fri Nov 17 15:40:38 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 17 Nov 2006 15:40:38 +0100 (CET)
Subject: [Rd] Manipulating R lists in C
In-Reply-To: <op.ti5zvjybffxks9@norisk>
Message-ID: <Pine.LNX.4.44.0611171537370.20576-100000@reclus.nhh.no>

On Fri, 17 Nov 2006, Tom McCallum wrote:

> Hi,
> 
> I have been studying the R manual on lists but cannot seem to create a  
> simple R list in C - I keep on getting "'dimnames' applied to non-array"  
> whenever I attempt to assign names to the list elements:

Maybe:

   setAttrib( priceList, R_NamesSymbol, dimnames );

why should a list have dimnames?

In addition, your dimnames is a list, and likely ought to be a character 
vector. That way you can get away with many fewer PROTECT().

Roger

> 
> Wanted output a list structure something like
> 	[ type="Bid", price=2.0, volume=1000 ]
> 
> I can get up to a list of
> 	[ "Bid2, 2.0, 1000 ]
> 
> But for the life of me I can't assign the names to the list items - any  
> suggestions?
> 
> Below is what I already have - any comments on things I don't really need  
> to do as well in terms of creating extra string objects etc are also  
> helpful.
> 
> Many thanks
> 
> Tom
> 
> 
> ======EXTRACT=========
> 
> 
>    SEXP typeStr, volumeStr, priceStr, typeValStr;
>    SEXP priceList;
> 
>    // create main list of vectors (unspecific items )
>    PROTECT( priceList = allocVector( VECSXP, 3 ) );
> 
>    // for each item create a label and attach value
>    PROTECT( typeValStr = allocVector( STRSXP, 1 ) );
>    SET_STRING_ELT( typeValStr, 0,  
> mkChar( getPriceDataTypeAsString( p.getData().getType() ).c_str() ) );
>    SET_STRING_ELT( priceList, 0, typeValStr) ;
> 
>    SEXP priceSXP;
>    PROTECT( priceSXP = allocVector( REALSXP, 1) );
>    REAL(priceSXP)[0] = p.getData().getPrice();
>    SET_VECTOR_ELT( priceList, 1, priceSXP);
> 
>    SEXP volumeSXP;
>    PROTECT( volumeSXP = allocVector( REALSXP, 1 ) );
>    REAL(volumeSXP)[0] = p.getData().getVolume();
>    SET_VECTOR_ELT( priceList, 2, volumeSXP);
> 
>    ********WORKS UP TO HERE*************
> 
>    // add the names of the list items (type,price,volume)
>    SEXP dimnames;
>    PROTECT( dimnames = allocVector( VECSXP, 3 ) );
> 
>    // first create string objects
>    PROTECT( typeStr = allocVector( STRSXP,1 ) );
>    SET_STRING_ELT( typeStr, 0, mkChar("type") );
> 
>    PROTECT( priceStr = allocVector( STRSXP,1 ) );
>    SET_STRING_ELT( priceStr, 0, mkChar("price") );
> 
>    PROTECT( volumeStr = allocVector( STRSXP,1 ) );
>    SET_STRING_ELT( volumeStr, 0, mkChar("volume") );
> 
>    // assign string objects to vector
>    SET_VECTOR_ELT( dimnames, 0, typeStr );
>    SET_VECTOR_ELT( dimnames, 1, priceStr);
>    SET_VECTOR_ELT( dimnames, 2, volumeStr );
> 
>    // assign vector to original list of data
>    setAttrib( priceList, R_DimNamesSymbol, dimnames ); <----- I think this  
> is wrong but I don;t know what it should be
> 
> ===========END EXTRACT===============
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From tom.mccallum at levelelimited.com  Fri Nov 17 15:48:17 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Fri, 17 Nov 2006 14:48:17 -0000
Subject: [Rd] Manipulating R lists in C
In-Reply-To: <Pine.LNX.4.44.0611171537370.20576-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0611171537370.20576-100000@reclus.nhh.no>
Message-ID: <op.ti50qr0gffxks9@norisk>

Thank you so much!! - that works now.

Tom

On Fri, 17 Nov 2006 14:40:38 -0000, Roger Bivand <Roger.Bivand at nhh.no>  
wrote:

> On Fri, 17 Nov 2006, Tom McCallum wrote:
>
>> Hi,
>>
>> I have been studying the R manual on lists but cannot seem to create a
>> simple R list in C - I keep on getting "'dimnames' applied to non-array"
>> whenever I attempt to assign names to the list elements:
>
> Maybe:
>
>    setAttrib( priceList, R_NamesSymbol, dimnames );
>
> why should a list have dimnames?
>
> In addition, your dimnames is a list, and likely ought to be a character
> vector. That way you can get away with many fewer PROTECT().
>
> Roger
>
>>
>> Wanted output a list structure something like
>> 	[ type="Bid", price=2.0, volume=1000 ]
>>
>> I can get up to a list of
>> 	[ "Bid2, 2.0, 1000 ]
>>
>> But for the life of me I can't assign the names to the list items - any
>> suggestions?
>>
>> Below is what I already have - any comments on things I don't really  
>> need
>> to do as well in terms of creating extra string objects etc are also
>> helpful.
>>
>> Many thanks
>>
>> Tom
>>
>>
>> ======EXTRACT=========
>>
>>
>>    SEXP typeStr, volumeStr, priceStr, typeValStr;
>>    SEXP priceList;
>>
>>    // create main list of vectors (unspecific items )
>>    PROTECT( priceList = allocVector( VECSXP, 3 ) );
>>
>>    // for each item create a label and attach value
>>    PROTECT( typeValStr = allocVector( STRSXP, 1 ) );
>>    SET_STRING_ELT( typeValStr, 0,
>> mkChar( getPriceDataTypeAsString( p.getData().getType() ).c_str() ) );
>>    SET_STRING_ELT( priceList, 0, typeValStr) ;
>>
>>    SEXP priceSXP;
>>    PROTECT( priceSXP = allocVector( REALSXP, 1) );
>>    REAL(priceSXP)[0] = p.getData().getPrice();
>>    SET_VECTOR_ELT( priceList, 1, priceSXP);
>>
>>    SEXP volumeSXP;
>>    PROTECT( volumeSXP = allocVector( REALSXP, 1 ) );
>>    REAL(volumeSXP)[0] = p.getData().getVolume();
>>    SET_VECTOR_ELT( priceList, 2, volumeSXP);
>>
>>    ********WORKS UP TO HERE*************
>>
>>    // add the names of the list items (type,price,volume)
>>    SEXP dimnames;
>>    PROTECT( dimnames = allocVector( VECSXP, 3 ) );
>>
>>    // first create string objects
>>    PROTECT( typeStr = allocVector( STRSXP,1 ) );
>>    SET_STRING_ELT( typeStr, 0, mkChar("type") );
>>
>>    PROTECT( priceStr = allocVector( STRSXP,1 ) );
>>    SET_STRING_ELT( priceStr, 0, mkChar("price") );
>>
>>    PROTECT( volumeStr = allocVector( STRSXP,1 ) );
>>    SET_STRING_ELT( volumeStr, 0, mkChar("volume") );
>>
>>    // assign string objects to vector
>>    SET_VECTOR_ELT( dimnames, 0, typeStr );
>>    SET_VECTOR_ELT( dimnames, 1, priceStr);
>>    SET_VECTOR_ELT( dimnames, 2, volumeStr );
>>
>>    // assign vector to original list of data
>>    setAttrib( priceList, R_DimNamesSymbol, dimnames ); <----- I think  
>> this
>> is wrong but I don;t know what it should be
>>
>> ===========END EXTRACT===============
>>
>>
>



-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From tom.mccallum at levelelimited.com  Fri Nov 17 16:55:21 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Fri, 17 Nov 2006 15:55:21 -0000
Subject: [Rd] Data table in C
Message-ID: <op.ti53ujp0ffxks9@norisk>

After getting one list done, I am now struggling to form a data frame in C.

I tried to do a list of lists which gives me :

$<NA>
$<NA>[[1]]
[1] "BID"

$<NA>[[2]]
[1] 0.6718

$<NA>[[3]]
[1] 3e+06


$<NA>
$<NA>[[1]]
[1] "BID"

$<NA>[[2]]
[1] 0.6717

$<NA>[[3]]
[1] 5e+06


$<NA>
$<NA>[[1]]
[1] "BID"

$<NA>[[2]]
[1] 0.6717

$<NA>[[3]]
[1] 17200000


and then as.data.frame them in R but this gives me

> print(l);
   X0.type X0.price X0.volume X1.type X1.price X1.volume X2.type X2.price
1     BID   0.6723     3e+06     BID   0.6722     5e+06     BID  0.67195
   X2.volume X3.type X3.price X3.volume X4.type X4.price X4.volume X5.type
1  19400000     BID   0.6723     3e+06     BID   0.6722     5e+06     BID
   X5.price X5.volume X6.type X6.price X6.volume X7.type X7.price X7.volume
1   0.6723     3e+06     BID   0.6723     3e+06     BID  0.67195  19400000
   X8.type X8.price X8.volume X9.type X9.price X9.volume X10.type X10.price
1     BID   0.6723     3e+06     BID  0.67215     1e+07      BID    0.6723
   X10.volume X11.type X11.price X11.volume X12.type X12.price X12.volume
1      5e+06      BID   0.67215      1e+07      BID    0.6723      3e+06

and so on.

Is the only way in C to do this or is there a better way of creating a 2  
dimensional data frame with names columns?  I could not find a  
"data.frame" object so I assume one has to use lists but I can't see how  
to get a 3 column list as the example below shows:

   a b d
1 1 4 7
2 2 5 8
3 3 6 9


Tom

-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From spluque at gmail.com  Fri Nov 17 17:34:54 2006
From: spluque at gmail.com (Sebastian P. Luque)
Date: Fri, 17 Nov 2006 10:34:54 -0600
Subject: [Rd] setIs() and setAs()
Message-ID: <874psyowup.fsf@patagonia.sebmags.homelinux.org>

Dear R-devel,

If we have two classes that have the same representation but with slightly
different constraints, say something like:


setClass("foo", representation=c(a="numeric", b="data.frame"))
setClass("bar", contains="foo",
         validity=function(object) if (length(object at b) < 2) {
         return("b must be longer than 1")
         })


I would like to be able to interpret foo as bar, if foo satisfies the
validity argument.  I think this requires a call to setIs(), but I'm not
sure what the best way to do this is, considering the necessary setAs()
calls.  I would appreciate some suggestions as to how to make the setAs()
and setIs() calls in cases like this.  Thanks in advance.


Cheers,

-- 
Seb


From sfalcon at fhcrc.org  Fri Nov 17 18:22:16 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 17 Nov 2006 09:22:16 -0800
Subject: [Rd] Data table in C
In-Reply-To: <op.ti53ujp0ffxks9@norisk> (Tom McCallum's message of "Fri,
	17 Nov 2006 15:55:21 -0000")
References: <op.ti53ujp0ffxks9@norisk>
Message-ID: <m2psbmf0on.fsf@ziti.local>

"Tom McCallum" <tom.mccallum at levelelimited.com> writes:

> After getting one list done, I am now struggling to form a data frame in C.
>
> I tried to do a list of lists which gives me :
>
> $<NA>
> $<NA>[[1]]
> [1] "BID"
>
> $<NA>[[2]]
> [1] 0.6718
[snip]
>
> and then as.data.frame them in R but this gives me

One approach is to return a named list and then turn that into a
data.frame like:

ret <- .Call("yourFunc", ...)
attr(ret, "row.names") <- as.integer(indx)
class(ret) <- "data.frame"

In C, you need to create a list (VECSXP) and a character vector
(STRSXP) for the names and then put the names on the list.

PROTECT(ret = allocVector(VECSXP, N));
PROTECT(retnames = allocVector(STRSXP, N));

/* fill list and names */

SET_NAMES(ret, retnames);

+ seth


From bill at insightful.com  Fri Nov 17 20:45:15 2006
From: bill at insightful.com (Bill Dunlap)
Date: Fri, 17 Nov 2006 11:45:15 -0800 (PST)
Subject: [Rd] setting up a plot without plotting any data
Message-ID: <Pine.GSO.4.56.0611171123490.8495@durian.statsci.com>

Someones you need to set up a plot before the
data is ready to plot.  You know the desired
axis limits (xlim and ylim), but don't have
the data all in one vector.  You would like to
set up the coordinate system, perhaps draw the
axes and titles, but draw no points.  You can do that with
   plot(x=xlim, y=ylim, type="n", xlab="", ylab="")
In R you could use ann=FALSE instead of xlab="",
ylab="".  In either you could supply non-null values
for xlab and ylab but the default, xlab="xlim",
ylab="ylim", would not be desirable.  You could
supply other scaling-related arguments like log="x".

We could write an method for plot with signature
x="missing",y="missing" so the syntax for the above
would be a bit more natural
   plot(xlim=xlim, ylim=ylim)
If you want non-null xlab or ylab, supply them.
If you don't want axes, supply axes=FALSE, just
as with the usual plot().  Would this be desirable?
(It made things easier to explain to my son.)

The following code does that in either R or Splus:

   .plot.noxy <-
   function(..., xlim, ylim, xlab = "", ylab = "")
   {
           stopifnot(length(xlim) == 2, all(is.finite(xlim)))
           stopifnot(length(ylim) == 2, all(is.finite(ylim)))
           plot(type = "n", x = xlim, y = ylim, ..., xlim = xlim, ylim = ylim,
                   xlab = xlab, ylab = ylab)
   }
   setMethod("plot", sig=signature(x="missing", y="missing"),
           definition=function(x, y, ...).plot.noxy(...))

E.g.,
   plot(xlim=c(-2,2), ylim=c(-2,2)) # set up plot and draw axes
   for(i in -10:10)points( (.8+.7i)^i) # add points to graph

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From byron.ellis at gmail.com  Fri Nov 17 22:04:48 2006
From: byron.ellis at gmail.com (Byron Ellis)
Date: Fri, 17 Nov 2006 13:04:48 -0800
Subject: [Rd] Data table in C
In-Reply-To: <op.ti53ujp0ffxks9@norisk>
References: <op.ti53ujp0ffxks9@norisk>
Message-ID: <7098abec0611171304h6f040cc7w257b262be65a3a1d@mail.gmail.com>

Data frames are column, not row oriented so you actually want your
list-o-lists to be

$type
[1] "BID" "BID" "BID"

$price
[1] 0.6178 0.6717 0.6717

$volume
[1] 3e+06 3e+06 17200000

so you'd create a VECSXP of length 3 and then three data vectors (also
of length 3 in this case). One STRSXP and two REALSXPs and assign them
into the VECSXP. Also a names attribute for the VECSXP. There are some
other attributes you have to set (the class attribute among other
things) to build a real data frame, but the general structure is like
that.


On 11/17/06, Tom McCallum <tom.mccallum at levelelimited.com> wrote:
> After getting one list done, I am now struggling to form a data frame in C.
>
> I tried to do a list of lists which gives me :
>
> $<NA>
> $<NA>[[1]]
> [1] "BID"
>
> $<NA>[[2]]
> [1] 0.6718
>
> $<NA>[[3]]
> [1] 3e+06
>
>
> $<NA>
> $<NA>[[1]]
> [1] "BID"
>
> $<NA>[[2]]
> [1] 0.6717
>
> $<NA>[[3]]
> [1] 5e+06
>
>
> $<NA>
> $<NA>[[1]]
> [1] "BID"
>
> $<NA>[[2]]
> [1] 0.6717
>
> $<NA>[[3]]
> [1] 17200000
>
>
> and then as.data.frame them in R but this gives me
>
> > print(l);
>    X0.type X0.price X0.volume X1.type X1.price X1.volume X2.type X2.price
> 1     BID   0.6723     3e+06     BID   0.6722     5e+06     BID  0.67195
>    X2.volume X3.type X3.price X3.volume X4.type X4.price X4.volume X5.type
> 1  19400000     BID   0.6723     3e+06     BID   0.6722     5e+06     BID
>    X5.price X5.volume X6.type X6.price X6.volume X7.type X7.price X7.volume
> 1   0.6723     3e+06     BID   0.6723     3e+06     BID  0.67195  19400000
>    X8.type X8.price X8.volume X9.type X9.price X9.volume X10.type X10.price
> 1     BID   0.6723     3e+06     BID  0.67215     1e+07      BID    0.6723
>    X10.volume X11.type X11.price X11.volume X12.type X12.price X12.volume
> 1      5e+06      BID   0.67215      1e+07      BID    0.6723      3e+06
>
> and so on.
>
> Is the only way in C to do this or is there a better way of creating a 2
> dimensional data frame with names columns?  I could not find a
> "data.frame" object so I assume one has to use lists but I can't see how
> to get a 3 column list as the example below shows:
>
>    a b d
> 1 1 4 7
> 2 2 5 8
> 3 3 6 9
>
>
> Tom
>
> --
> Dr. Thomas McCallum
> Systems Architect,
> Level E Limited
> ETTC, The King's Buildings
> Mayfield Road,
> Edinburgh EH9 3JL, UK
> Work  +44 (0) 131 472 4813
> Fax:  +44 (0) 131 472 4719
> http://www.levelelimited.com
> Email: tom at levelelimited.com
>
> Level E is a limited company incorporated in Scotland. The c...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian


From tpapp at Princeton.EDU  Sat Nov 18 17:50:39 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Sat, 18 Nov 2006 11:50:39 -0500
Subject: [Rd] overhead of function calls
Message-ID: <20061118165039.GA18991@pu100877.student.princeton.edu>

Hi,

Profiling shows that 65-70% of the time of my program is spent inside
a single function -- this is not surprising, as it is inside an
optimize call inside a loop (this is a dynamic programming problem).
I would like to speed this up.

The function does very little: has a single argument, evaluates a
spline at that argument, does some simple arithmetic with it (adding
constants, multiplication).  With R being a functional programming
language, I implemented this by calling several functions inside the
function:

          ## RHS of bellman equation
          f <- function(knext,k,ei) {
            util(consf(knext,k))+quickeval(knext,gridsecpp,Vkbarpp)
          }

where quickeval evaluates a spline at knext (on gridsecpp, pp-form
Vkbarpp), util is a function in the environment, and so is consf:

          ## consumption 
	   consf <- function(knext,k) {
            rp*k+W+knext*A
          }

A, W, and rp are constants in the environment.

Then I call

optimize(f, lower=...,upper=...,k=...)

to find the maximum.

Questions:

1. does function calling give a significant overhead in R?  If so, I
would rewrite the function into a single one.  I tried to test this by

> f <- function(x) 1+x
> g <- function(x) f(x)
> x <- rnorm(1e6)
> system.time(sapply(x,f))
[1] 11.315  0.157 11.735  0.000  0.000
> system.time(sapply(x,g))
[1] 8.850 0.140 9.283 0.000 0.000
> system.time(for (i in seq_along(x)) f(x[i]))
[1] 2.466 0.036 2.884 0.000 0.000
> system.time(for (i in seq_along(x)) g(x[i]))
[1] 3.548 0.045 4.165 0.000 0.000

but I find that hard to interpret -- the overhead looks significant in
the first case, but something strange (at least to my limited
knowledge) is happening with sapply.

2. Do calls to .C or .Fortran carry large overhead?  If they don't, I
would recode f in either.

Thanks,

Tamas


From ggrothendieck at gmail.com  Sat Nov 18 17:57:04 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 18 Nov 2006 11:57:04 -0500
Subject: [Rd] overhead of function calls
In-Reply-To: <20061118165039.GA18991@pu100877.student.princeton.edu>
References: <20061118165039.GA18991@pu100877.student.princeton.edu>
Message-ID: <971536df0611180857p472f6de9r60ecb6cf209697c7@mail.gmail.com>

I don't know if this would have an appreciable effect or not but
you could also check whether passing the free variables explicitly
speeds it up so that they don't have to be looked up each time
in the outside environment.

On 11/18/06, Tamas K Papp <tpapp at princeton.edu> wrote:
> Hi,
>
> Profiling shows that 65-70% of the time of my program is spent inside
> a single function -- this is not surprising, as it is inside an
> optimize call inside a loop (this is a dynamic programming problem).
> I would like to speed this up.
>
> The function does very little: has a single argument, evaluates a
> spline at that argument, does some simple arithmetic with it (adding
> constants, multiplication).  With R being a functional programming
> language, I implemented this by calling several functions inside the
> function:
>
>          ## RHS of bellman equation
>          f <- function(knext,k,ei) {
>            util(consf(knext,k))+quickeval(knext,gridsecpp,Vkbarpp)
>          }
>
> where quickeval evaluates a spline at knext (on gridsecpp, pp-form
> Vkbarpp), util is a function in the environment, and so is consf:
>
>          ## consumption
>           consf <- function(knext,k) {
>            rp*k+W+knext*A
>          }
>
> A, W, and rp are constants in the environment.
>
> Then I call
>
> optimize(f, lower=...,upper=...,k=...)
>
> to find the maximum.
>
> Questions:
>
> 1. does function calling give a significant overhead in R?  If so, I
> would rewrite the function into a single one.  I tried to test this by
>
> > f <- function(x) 1+x
> > g <- function(x) f(x)
> > x <- rnorm(1e6)
> > system.time(sapply(x,f))
> [1] 11.315  0.157 11.735  0.000  0.000
> > system.time(sapply(x,g))
> [1] 8.850 0.140 9.283 0.000 0.000
> > system.time(for (i in seq_along(x)) f(x[i]))
> [1] 2.466 0.036 2.884 0.000 0.000
> > system.time(for (i in seq_along(x)) g(x[i]))
> [1] 3.548 0.045 4.165 0.000 0.000
>
> but I find that hard to interpret -- the overhead looks significant in
> the first case, but something strange (at least to my limited
> knowledge) is happening with sapply.
>
> 2. Do calls to .C or .Fortran carry large overhead?  If they don't, I
> would recode f in either.
>
> Thanks,
>
> Tamas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Sat Nov 18 18:32:56 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 18 Nov 2006 17:32:56 +0000 (GMT)
Subject: [Rd] overhead of function calls
In-Reply-To: <20061118165039.GA18991@pu100877.student.princeton.edu>
References: <20061118165039.GA18991@pu100877.student.princeton.edu>
Message-ID: <Pine.LNX.4.64.0611181704430.17419@gannet.stats.ox.ac.uk>

On Sat, 18 Nov 2006, Tamas K Papp wrote:

> Hi,
>
> Profiling shows that 65-70% of the time of my program is spent inside
> a single function -- this is not surprising, as it is inside an
> optimize call inside a loop (this is a dynamic programming problem).
> I would like to speed this up.
>
> The function does very little: has a single argument, evaluates a
> spline at that argument, does some simple arithmetic with it (adding
> constants, multiplication).  With R being a functional programming
> language, I implemented this by calling several functions inside the
> function:
>
>          ## RHS of bellman equation
>          f <- function(knext,k,ei) {
>            util(consf(knext,k))+quickeval(knext,gridsecpp,Vkbarpp)
>          }
>
> where quickeval evaluates a spline at knext (on gridsecpp, pp-form
> Vkbarpp), util is a function in the environment, and so is consf:
>
>          ## consumption
> 	   consf <- function(knext,k) {
>            rp*k+W+knext*A
>          }
>
> A, W, and rp are constants in the environment.
>
> Then I call
>
> optimize(f, lower=...,upper=...,k=...)
>
> to find the maximum.
>
> Questions:
>
> 1. does function calling give a significant overhead in R?

Not compared with all but the very simplest computations: the overhead is 
of the order of a few microseconds.  If it were otherwise, R would not to 
a large extent be implemented by function wrappers round .Internal 
calls (rather than .Primitives).

> If so, I would rewrite the function into a single one.  I tried to test 
> this by
>
>> f <- function(x) 1+x
>> g <- function(x) f(x)
>> x <- rnorm(1e6)
>> system.time(sapply(x,f))
> [1] 11.315  0.157 11.735  0.000  0.000
>> system.time(sapply(x,g))
> [1] 8.850 0.140 9.283 0.000 0.000
>> system.time(for (i in seq_along(x)) f(x[i]))
> [1] 2.466 0.036 2.884 0.000 0.000
>> system.time(for (i in seq_along(x)) g(x[i]))
> [1] 3.548 0.045 4.165 0.000 0.000
>
> but I find that hard to interpret -- the overhead looks significant in
> the first case, but something strange (at least to my limited
> knowledge) is happening with sapply.

Note that subsequent calls change quite a lot:

> system.time(sapply(x,f))
[1] 12.989  0.150 13.215  0.000  0.000
> system.time(sapply(x,f))
[1] 8.751 0.105 8.923 0.000 0.000
> system.time(sapply(x,f))
[1] 7.993 0.175 8.191 0.000 0.000
> system.time(sapply(x,f))
[1] 7.016 0.058 7.074 0.000 0.000
> system.time(sapply(x,f))
[1] 7.748 0.181 7.932 0.000 0.000
> system.time(sapply(x,g))
[1] 8.289 0.074 8.371 0.000 0.000

Several things are going on here, but most likely the most important is 
that the memory manager is being tuned.  On my (64-bit) system:

> gc()
           used (Mb) gc trigger (Mb) max used (Mb)
Ncells  224202 12.0     407500 21.8   350000 18.7
Vcells 1115457  8.6    1519644 11.6  1419269 10.9
> for(i in 1:5) sapply(x,f)
> gc()
           used (Mb) gc trigger  (Mb) max used  (Mb)
Ncells  224206 12.0    2156470 115.2  2665684 142.4
Vcells 2115455 16.2    7060137  53.9  8164087  62.3

Note the factor 5x differences.

It is better to profile here, so if I profile

> for (i in seq_along(x)) g(x[i])

I get
     self.time self.pct total.time total.pct
"f"      2.18     62.6       2.34      67.2
"g"      1.14     32.8       3.48     100.0
"+"      0.16      4.6       0.16       4.6


The extra call to g is taking about 1 usec (as I expected).  Note that 
lazy evaluation means (I think) that f is being charged for the evaluation 
of the argument, not g.

> 2. Do calls to .C or .Fortran carry large overhead?  If they don't, I
> would recode f in either.

No (and calls to .Call carry less, as there is no duplication on call and 
return).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tpapp at Princeton.EDU  Sat Nov 18 18:54:39 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Sat, 18 Nov 2006 12:54:39 -0500
Subject: [Rd] array indexes in C
Message-ID: <20061118175439.GA20933@pu100877.student.princeton.edu>

I am passing (numeric) arrays to a C function, called with .C.  To the
best of my knowledge, I can do this in R by passing it as a vector
(with as.vector) to the .C call.

However, it would be useful to access the array as an array inside C,
ie not have to calculate how array indices (i,j,k) map to the vector
elements.  What is the right way to do this?  Are there convenience
functions to do the index calculations (knowing the dimensions) that I
could call?

In the C99 standard, I have seen something about flexible arrays, I
don't know if that would help here.

Thanks,

Tamas


From btyner at stat.purdue.edu  Sun Nov 19 15:55:17 2006
From: btyner at stat.purdue.edu (Benjamin Tyner)
Date: Sun, 19 Nov 2006 09:55:17 -0500
Subject: [Rd]  array indexes in C
Message-ID: <45607055.7010900@stat.purdue.edu>

Tamas,

You could write convenience functions, but I have used the C99 mechanism 
for variable length arrays with no problems calling from R. One thing 
you have to keep in mind though is that (as far as I know) the 
dimensions must be passed before the array reference. So for example,

r <- .C("foo",
              as.integer(ni),
              as.integer(nj),
              x = double(ni * nj),
              ...)

with your function defined as

void foo(int *ni, int *nj, double x[*ni][*nj])
{
...

Then in C you can access elements of x via x[3][4], for example.

Ben


From tpapp at Princeton.EDU  Sun Nov 19 16:01:23 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Sun, 19 Nov 2006 10:01:23 -0500
Subject: [Rd] array indexes in C
In-Reply-To: <45607055.7010900@stat.purdue.edu>
References: <45607055.7010900@stat.purdue.edu>
Message-ID: <20061119150123.GA4592@pu100877.student.princeton.edu>

Hi Ben,

Thanks for your answer.  I looked at the status of VLA on the GCC
homepage and it appears to be "broken". [1] Do you think that the code
below still works?  Or are you using a different compliler?

Thanks,

Tamas

[1] http://gcc.gnu.org/c99status.html


On Sun, Nov 19, 2006 at 09:55:17AM -0500, Benjamin Tyner wrote:
> Tamas,
> 
> You could write convenience functions, but I have used the C99 mechanism 
> for variable length arrays with no problems calling from R. One thing 
> you have to keep in mind though is that (as far as I know) the 
> dimensions must be passed before the array reference. So for example,
> 
> r <- .C("foo",
>               as.integer(ni),
>               as.integer(nj),
>               x = double(ni * nj),
>               ...)
> 
> with your function defined as
> 
> void foo(int *ni, int *nj, double x[*ni][*nj])
> {
> ...
> 
> Then in C you can access elements of x via x[3][4], for example.
> 
> Ben
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From tpapp at Princeton.EDU  Sun Nov 19 21:46:31 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Sun, 19 Nov 2006 15:46:31 -0500
Subject: [Rd] good practice for values not provided
Message-ID: <20061119204631.GA16883@pu100877.student.princeton.edu>

Hi,

I am writing a collection of functions which I plan to share as a
package later (when they are tested thoroughly), so I would like to do
things "right" from the beginning...

I encountered a minor question of style.  Consider a function 

f <- function(a,b,x=NULL) {
  ## ...
}

if !is.null(x), f will use x to calculate the result, but if
is.null(x), it will do something else not involving x at all (using
any x would be meaningless here, so I can't use
x=calcsomethingfrom(a,b)).

What's the accepted way of indicating this in R with a default for x?
x=FALSE? x=NA? x=NULL?

Thanks,

Tamas


From ggrothendieck at gmail.com  Sun Nov 19 21:57:53 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 19 Nov 2006 15:57:53 -0500
Subject: [Rd] good practice for values not provided
In-Reply-To: <20061119204631.GA16883@pu100877.student.princeton.edu>
References: <20061119204631.GA16883@pu100877.student.princeton.edu>
Message-ID: <971536df0611191257x512df829r1650a158e56c8454@mail.gmail.com>

One possibility is:

f <- function(a, b, x) if (missing(x)) a+b else a-b-x

although that does have the disadvantage that one cannot explicitly tell
it not to use x but rather its denoted by its absence.

On 11/19/06, Tamas K Papp <tpapp at princeton.edu> wrote:
> Hi,
>
> I am writing a collection of functions which I plan to share as a
> package later (when they are tested thoroughly), so I would like to do
> things "right" from the beginning...
>
> I encountered a minor question of style.  Consider a function
>
> f <- function(a,b,x=NULL) {
>  ## ...
> }
>
> if !is.null(x), f will use x to calculate the result, but if
> is.null(x), it will do something else not involving x at all (using
> any x would be meaningless here, so I can't use
> x=calcsomethingfrom(a,b)).
>
> What's the accepted way of indicating this in R with a default for x?
> x=FALSE? x=NA? x=NULL?
>
> Thanks,
>
> Tamas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Sun Nov 19 22:18:12 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 19 Nov 2006 16:18:12 -0500
Subject: [Rd] good practice for values not provided
In-Reply-To: <20061119204631.GA16883@pu100877.student.princeton.edu>
References: <20061119204631.GA16883@pu100877.student.princeton.edu>
Message-ID: <4560CA14.2050600@stats.uwo.ca>

On 11/19/2006 3:46 PM, Tamas K Papp wrote:
> Hi,
> 
> I am writing a collection of functions which I plan to share as a
> package later (when they are tested thoroughly), so I would like to do
> things "right" from the beginning...
> 
> I encountered a minor question of style.  Consider a function 
> 
> f <- function(a,b,x=NULL) {
>   ## ...
> }
> 
> if !is.null(x), f will use x to calculate the result, but if
> is.null(x), it will do something else not involving x at all (using
> any x would be meaningless here, so I can't use
> x=calcsomethingfrom(a,b)).
> 
> What's the accepted way of indicating this in R with a default for x?
> x=FALSE? x=NA? x=NULL?

I think the most common is x=NULL, but probably all of those are used in 
some package.  The advantage some default over no default and an 
is.missing(x) test, is that you can write g to call f with the same default:

g <- function(a,b,c,d,x=NULL) {
   f(a,b,x)
   # some more stuff
}

It would be harder if you wanted to signal missing x by not including it 
in the call, because you'd need a test in g.

Duncan Murdoch


From btyner at stat.purdue.edu  Mon Nov 20 14:41:39 2006
From: btyner at stat.purdue.edu (Benjamin Tyner)
Date: Mon, 20 Nov 2006 08:41:39 -0500
Subject: [Rd] array indexes in C
In-Reply-To: <mailman.5.1164020402.6146.r-devel@r-project.org>
References: <mailman.5.1164020402.6146.r-devel@r-project.org>
Message-ID: <4561B093.4080800@stat.purdue.edu>

Tamas,

I am using GCC with no problems. You can find more examples at
http://gcc.gnu.org/onlinedocs/gcc-3.3.1/gcc/Variable-Length.html

Ben
> Hi Ben,
>
> Thanks for your answer.  I looked at the status of VLA on the GCC
> homepage and it appears to be "broken". [1] Do you think that the code
> below still works?  Or are you using a different compliler?
>
> Thanks,
>
> Tamas
>
> [1] http://gcc.gnu.org/c99status.html
>
>
> On Sun, Nov 19, 2006 at 09:55:17AM -0500, Benjamin Tyner wrote:
>   
>> Tamas,
>>
>> You could write convenience functions, but I have used the C99 mechanism 
>> for variable length arrays with no problems calling from R. One thing 
>> you have to keep in mind though is that (as far as I know) the 
>> dimensions must be passed before the array reference. So for example,
>>
>> r <- .C("foo",
>>               as.integer(ni),
>>               as.integer(nj),
>>               x = double(ni * nj),
>>               ...)
>>
>> with your function defined as
>>
>> void foo(int *ni, int *nj, double x[*ni][*nj])
>> {
>> ...
>>
>> Then in C you can access elements of x via x[3][4], for example.
>>
>> Ben
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From hin-tak.leung at cimr.cam.ac.uk  Mon Nov 20 14:46:45 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 20 Nov 2006 13:46:45 +0000
Subject: [Rd] array indexes in C
In-Reply-To: <20061119150123.GA4592@pu100877.student.princeton.edu>
References: <45607055.7010900@stat.purdue.edu>
	<20061119150123.GA4592@pu100877.student.princeton.edu>
Message-ID: <4561B1C5.1000605@cimr.cam.ac.uk>

Don't think either of you are correct,  because double x[][] is of type 
double ** , (x is a pointer to a pointer/array of doubles), whereas R
passes double() as double * through the .C() interface. So the C code
as written in Ben's message won't work.

numeric()/double() in R are created as single-dimension arrays (or
pointer to type), not arrays of arrays (pointer to pointer to type).

You'll need to do something like this:

void foo(int *ni, int *nj, double *x) {
  x[ (*nj) * i + j ] = ...
/* or the other way round, not very sure about your intention of memory 
layout, in C convention or Fortran convention */
  x[ (*ni) * j + i] = ...

}

Would love somebody to prove me wrong though...

Hin-Tak Leung

Tamas K Papp wrote:
> Hi Ben,
> 
> Thanks for your answer.  I looked at the status of VLA on the GCC
> homepage and it appears to be "broken". [1] Do you think that the code
> below still works?  Or are you using a different compliler?
> 
> Thanks,
> 
> Tamas
> 
> [1] http://gcc.gnu.org/c99status.html
> 
> 
> On Sun, Nov 19, 2006 at 09:55:17AM -0500, Benjamin Tyner wrote:
>> Tamas,
>>
>> You could write convenience functions, but I have used the C99 mechanism 
>> for variable length arrays with no problems calling from R. One thing 
>> you have to keep in mind though is that (as far as I know) the 
>> dimensions must be passed before the array reference. So for example,
>>
>> r <- .C("foo",
>>               as.integer(ni),
>>               as.integer(nj),
>>               x = double(ni * nj),
>>               ...)
>>
>> with your function defined as
>>
>> void foo(int *ni, int *nj, double x[*ni][*nj])
>> {
>> ...
>>
>> Then in C you can access elements of x via x[3][4], for example.
>>
>> Ben
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From tlumley at u.washington.edu  Mon Nov 20 17:05:34 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 20 Nov 2006 08:05:34 -0800 (PST)
Subject: [Rd] array indexes in C
In-Reply-To: <4561B093.4080800@stat.purdue.edu>
References: <mailman.5.1164020402.6146.r-devel@r-project.org>
	<4561B093.4080800@stat.purdue.edu>
Message-ID: <Pine.LNX.4.64.0611200800580.26170@homer23.u.washington.edu>


gcc has had variable-length arrays as an extension for a long time. If you 
look at the notes below the table
   http://gcc.gnu.org/c99status.html
it says "The C99 semantics of variable length arrays (VLAs) are not fully 
implemented by the existing GCC extension", so it is C99 compliance that 
is broken.

I still don't see how either gcc or ANSI C99 variable length arrays allow 
you to treat an argument of type double * as if it was of type double **

 	-thomas

On Mon, 20 Nov 2006, Benjamin Tyner wrote:

> Tamas,
>
> I am using GCC with no problems. You can find more examples at
> http://gcc.gnu.org/onlinedocs/gcc-3.3.1/gcc/Variable-Length.html
>
> Ben
>> Hi Ben,
>>
>> Thanks for your answer.  I looked at the status of VLA on the GCC
>> homepage and it appears to be "broken". [1] Do you think that the code
>> below still works?  Or are you using a different compliler?
>>
>> Thanks,
>>
>> Tamas
>>
>> [1] http://gcc.gnu.org/c99status.html
>>
>>
>> On Sun, Nov 19, 2006 at 09:55:17AM -0500, Benjamin Tyner wrote:
>>
>>> Tamas,
>>>
>>> You could write convenience functions, but I have used the C99 mechanism
>>> for variable length arrays with no problems calling from R. One thing
>>> you have to keep in mind though is that (as far as I know) the
>>> dimensions must be passed before the array reference. So for example,
>>>
>>> r <- .C("foo",
>>>               as.integer(ni),
>>>               as.integer(nj),
>>>               x = double(ni * nj),
>>>               ...)
>>>
>>> with your function defined as
>>>
>>> void foo(int *ni, int *nj, double x[*ni][*nj])
>>> {
>>> ...
>>>
>>> Then in C you can access elements of x via x[3][4], for example.
>>>
>>> Ben
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From imosqueira at suk.azti.es  Mon Nov 20 20:09:57 2006
From: imosqueira at suk.azti.es (Iago Mosqueira)
Date: Mon, 20 Nov 2006 20:09:57 +0100
Subject: [Rd] Smallest R executable
Message-ID: <5222D071B410AC489A62C2EBA183858A9E996C@SSRCorreo.azti.local>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061120/a47ef829/attachment.pl 

From prokaj at cs.elte.hu  Tue Nov 21 06:09:09 2006
From: prokaj at cs.elte.hu (prokaj at cs.elte.hu)
Date: Tue, 21 Nov 2006 06:09:09 +0100 (CET)
Subject: [Rd] packBits (PR#9374)
Message-ID: <20061121050909.8C2463D747@slim.kubism.ku.dk>

Full_Name: Prokaj Vilmos
Version: R 2-4-0
OS: Windows
Submission from: (NULL) (193.224.79.8)


PackBits(rbinom(32,1,0.5)==1,"integer")
does not work. 

z<-packBits(rbinom(32,1,.5)==1,"integer")
Error in packBits(x, type) : argument 'x' must be raw, integer or logical


Taking a closer look at the C code 
main/character.c  do_packBits rutin
one can find the following checking

 if (TYPEOF(x) != RAWSXP && TYPEOF(x) != RAWSXP && TYPEOF(x) != INTSXP)
     errorcall(call, _("argument 'x' must be raw, integer or logical"));

It's obvious that some of the RAWSXP should be LGLSXP


From murdoch at stats.uwo.ca  Tue Nov 21 11:57:09 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 21 Nov 2006 05:57:09 -0500
Subject: [Rd] packBits (PR#9374)
In-Reply-To: <20061121050909.8C2463D747@slim.kubism.ku.dk>
References: <20061121050909.8C2463D747@slim.kubism.ku.dk>
Message-ID: <4562DB85.6090600@stats.uwo.ca>

On 11/21/2006 12:09 AM, prokaj at cs.elte.hu wrote:
> Full_Name: Prokaj Vilmos
> Version: R 2-4-0
> OS: Windows
> Submission from: (NULL) (193.224.79.8)
> 
> 
> PackBits(rbinom(32,1,0.5)==1,"integer")
> does not work. 
> 
> z<-packBits(rbinom(32,1,.5)==1,"integer")
> Error in packBits(x, type) : argument 'x' must be raw, integer or logical
> 
> 
> Taking a closer look at the C code 
> main/character.c  do_packBits rutin
> one can find the following checking
> 
>  if (TYPEOF(x) != RAWSXP && TYPEOF(x) != RAWSXP && TYPEOF(x) != INTSXP)
>      errorcall(call, _("argument 'x' must be raw, integer or logical"));
> 
> It's obvious that some of the RAWSXP should be LGLSXP

Yes, thanks for the report.  I'll fix it.

Duncan Murdoch


From murdoch at stats.uwo.ca  Tue Nov 21 12:00:21 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 21 Nov 2006 06:00:21 -0500
Subject: [Rd] packBits (PR#9374)
In-Reply-To: <20061121050909.8C2463D747@slim.kubism.ku.dk>
References: <20061121050909.8C2463D747@slim.kubism.ku.dk>
Message-ID: <4562DC45.1080807@stats.uwo.ca>

On 11/21/2006 12:09 AM, prokaj at cs.elte.hu wrote:
> Full_Name: Prokaj Vilmos
> Version: R 2-4-0
> OS: Windows
> Submission from: (NULL) (193.224.79.8)
> 
> 
> PackBits(rbinom(32,1,0.5)==1,"integer")
> does not work. 
> 
> z<-packBits(rbinom(32,1,.5)==1,"integer")
> Error in packBits(x, type) : argument 'x' must be raw, integer or logical
> 
> 
> Taking a closer look at the C code 
> main/character.c  do_packBits rutin
> one can find the following checking
> 
>  if (TYPEOF(x) != RAWSXP && TYPEOF(x) != RAWSXP && TYPEOF(x) != INTSXP)
>      errorcall(call, _("argument 'x' must be raw, integer or logical"));
> 
> It's obvious that some of the RAWSXP should be LGLSXP

No need for me to fix this:  Brian Ripley got there first.

Duncan Murdoch


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Tue Nov 21 13:53:16 2006
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Tue, 21 Nov 2006 13:53:16 +0100
Subject: [Rd] Crash when embedding R X11 windows
In-Reply-To: <200611071526.56966.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <200611071526.56966.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <200611211353.20094.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Dear R developers,

On Tuesday 07 November 2006 15:26, Thomas Friedrichsmeier wrote:
> Does this seem like a valid fix? Should I provide more info?

I'll take no answer to mean "We'd like to see a test case". You'll find one 
attached. Instructions on compilation / usage are given at the top of the 
source file.

Embedding an R X11 window will crash the corresponding R process (tested with 
R 2.4.0, and R devel), while other applications can be embedded just fine, 
this way. Refer to my last mail for a patch and explanation.

In case the attachment does not get through (I hope I've chosen a good 
MIME-type this time, though), it is also available at:
http://rkward.sourceforge.net/temp/embed.cpp

Regards
Thomas Friedrichsmeier
-------------- next part --------------
/***************************************************************************
                          embed.cpp  -  description
                             -------------------
Simple test case to embed the first X 11 Window found with a title starting
with the given string using QXEmbed under KDE.

Compilation:
Here these lines will compile the test case:
# moc embed.cpp > embed.moc
# gcc -I /usr/include/qt3/ -I /usr/include/kde/ -lqt-mt -lkdeui embed.cpp -o embed
Obviously, you may have to adjust the paths

Usage:
1) In an R console, create an X11 device
2) Run this program, click "Capture"

 ***************************************************************************/

#include <kapplication.h>
#include <kcmdlineargs.h>
#include <kaboutdata.h>
#include <kmainwindow.h>

#include <qxembed.h>
#include <qstring.h>
#include <qdialog.h>
#include <qpushbutton.h>
#include <qlineedit.h>
#include <qlayout.h>
#include <qlabel.h>

#include <X11/X.h>
#include <X11/Xlib.h>

// function below is a slightly adapted copy from http://lists.trolltech.com/qt-interest/1999-10/msg00224.html
// this could be tweaked a little more, since for instance we know we're only looking for toplevel windows
Window Window_With_Name (Display *dp, Window top, const QString &name) {
	Window *children, dummy;
	unsigned int nchildren;
	int i;
	Window w=0;
	char *window_name;
	
	if (XFetchName (dp, top, &window_name)) {
		if (QString (window_name).startsWith (name)) return (top);
	}
	
	if (!XQueryTree (dp, top, &dummy, &dummy, &children, &nchildren)) return (0);
	
	for (i=0; i<nchildren; i++) {
		w = Window_With_Name (dp, children[i], name);
		if (w) break;
	}
	if (children) XFree ((char *) children);
	return (w);
}

class EmbedDialog : public KMainWindow {
Q_OBJECT
public:
	EmbedDialog () : KMainWindow (0) {
		// create the window
		QVBoxLayout *layout = new QVBoxLayout (this);
		QLabel *label = new QLabel ("Enter start of title of window to capture:", this);
		layout->addWidget (label);

		caption_edit = new QLineEdit (this);
		caption_edit->setText ("R Graphics");
		layout->addWidget (caption_edit);

		QPushButton *button = new QPushButton ("Capture", this);
		connect (button, SIGNAL (clicked ()), this, SLOT (embedRGraphics ()));
		layout->addWidget (button);
		show ();
	};
public slots:
	void embedRGraphics () {
		Window w = Window_With_Name (qt_xdisplay (), qApp->desktop ()->winId (), caption_edit->text ());
		if (!w) {
			qDebug ("No such window found");
			return;
		} else {
			qDebug ("embedding window id %p", w);
		}

		// capture
		QXEmbed *capture = new QXEmbed (0, 0, Qt::WDestructiveClose);
		capture->setProtocol (QXEmbed::XPLAIN);
		capture->embed (w);
		capture->show ();

		qDebug ("done embedding", w);
	};
private:
	QLineEdit *caption_edit;
};

static KCmdLineOptions options[] = { { 0, 0, 0 } };

int main (int argc, char *argv[]) {
	KAboutData aboutdata ("embedtest", "embedtest", "0.1", "a test case", KAboutData::License_GPL, "(c) 2006", 0);
	KCmdLineArgs::init (argc, argv, &aboutdata);

	KApplication app;
	new EmbedDialog ();

	return app.exec ();
}

#include "embed.moc"
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20061121/497d459a/attachment.bin 

From gml4410 at ggr.co.uk  Tue Nov 21 13:54:12 2006
From: gml4410 at ggr.co.uk (gml4410 at ggr.co.uk)
Date: Tue, 21 Nov 2006 13:54:12 +0100 (CET)
Subject: [Rd] Buig in bin/R script (PR#9375)
Message-ID: <20061121125412.902CB19B22@slim.kubism.ku.dk>

Full_Name: Gordon Lack
Version: 2.4.0
OS: OSF1 v5.1
Submission from: (NULL) (198.28.92.5)


Changes to the bin/R front-end interlude script at 2.4.0 (cf: 2.2.0) have broken
R on (Dec/Compaq/HP) OSF1.

There are 3 occurrences of "${@}", but this is the incorrect syntax for adding
$@, as on older Bourne shells this will add an empty (but present) parameter. 
The result is that the build fails while attempting to add in the Recommended
libraries because "ARGUMENT '' __ignored__" end up on the gcc command line.

The fix is to edit src/scripts//R.sh.in to use the correct, original Bourne
shell syntax:

 ${1+"$@"}

(ie: if there is a $1, add quoted $@, else do nothing) on the THREE occurrences
of "${@}"


From ripley at stats.ox.ac.uk  Tue Nov 21 14:51:38 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 21 Nov 2006 14:51:38 +0100 (CET)
Subject: [Rd] Buig in bin/R script (PR#9375)
Message-ID: <20061121135138.0C4EE3F006@slim.kubism.ku.dk>

On Tue, 21 Nov 2006, gml4410 at ggr.co.uk wrote:

> Full_Name: Gordon Lack
> Version: 2.4.0
> OS: OSF1 v5.1
> Submission from: (NULL) (198.28.92.5)
>
>
> Changes to the bin/R front-end interlude script at 2.4.0 (cf: 2.2.0) have broken
> R on (Dec/Compaq/HP) OSF1.

This was not changed in 2.4.0, and indeed 2.2.0's bin/R used "${@}" in one 
place.

> There are 3 occurrences of "${@}", but this is the incorrect syntax for adding
> $@, as on older Bourne shells this will add an empty (but present) parameter.
> The result is that the build fails while attempting to add in the Recommended
> libraries because "ARGUMENT '' __ignored__" end up on the gcc command line.
>
> The fix is to edit src/scripts//R.sh.in to use the correct, original Bourne
> shell syntax:

Surely this is an idiosyncracy (aka 'buig') of your OS rather than being 
'correct'?  The POSIX definition is

   @ Expands to the positional parameters, starting from one. When the
   expansion occurs within double-quotes, and where field splitting (see
   Field Splitting) is performed, each positional parameter shall expand as a
   separate field, with the provision that the expansion of the first
   parameter shall still be joined with the beginning part of the original
   word (assuming that the expanded parameter was embedded within a word),
   and the expansion of the last parameter shall still be joined with the
   last part of the original word. If there are no positional parameters, the
   expansion of '@' shall generate zero fields, even when '@' is
   double-quoted.

Note the declarative 'shall' there.

Further, Solaris has a genuine Bourne shell from the AT&T source code 
base, and it is both documented and behaves as this quotation.

Perhaps we need a workaround conditional on 'HAVE_OSF_BROKEN_SH', but I am 
not at all keen to complicate simple POSIX-compliant code unconditionally.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From gml4410 at ggr.co.uk  Tue Nov 21 16:22:05 2006
From: gml4410 at ggr.co.uk (gml4410 at ggr.co.uk)
Date: Tue, 21 Nov 2006 16:22:05 +0100 (CET)
Subject: [Rd] Buig in bin/R script (PR#9375)
Message-ID: <20061121152205.C1E81572A2@slim.kubism.ku.dk>

Prof Brian Ripley wrote:
>>
>> Changes to the bin/R front-end interlude script at 2.4.0 (cf: 2.2.0) 
>> have broken R on (Dec/Compaq/HP) OSF1.
> 
> This was not changed in 2.4.0, and indeed 2.2.0's bin/R used "${@}" in 
> one place.

    The 2.2.0 usage only came into play if CMD was on the command line, 
and there would then be a following parameter, so "${@}" contained 
something.

    At 2.4.0 this has been appended to 2 further lines in circumstances 
where it can easily be empty.

>> The fix is to edit src/scripts//R.sh.in to use the correct, original 
>> Bourne shell syntax:
> 
> Surely this is an idiosyncracy (aka 'buig') of your OS rather than being 
> 'correct'?  The POSIX definition is
> 
> [http://www.opengroup.org/onlinepubs/009695399/utilities/xcu_chap02.html#tag_02_05_02]
> 
> Note the declarative 'shall' there.

    Agreed, but that definition was post-dated.  Many systems behaved 
differently before that was written.

> Further, Solaris has a genuine Bourne shell from the AT&T source code 
> base, and it is both documented and behaves as this quotation.

    I'll agree it works (Sol8, Sol9 and Sol10), but it isn't documented 
in the sh man page.

> Perhaps we need a workaround conditional on 'HAVE_OSF_BROKEN_SH', but I 
> am not at all keen to complicate simple POSIX-compliant code 
> unconditionally.

    Using ${1+"$@"} is POSIX compliant also, and has the advantage of 
working everywhere.  See:

http://www.opengroup.org/onlinepubs/009695399/utilities/xcu_chap02.html#tag_02_06_02


From Setzer.Woodrow at epamail.epa.gov  Tue Nov 21 16:10:49 2006
From: Setzer.Woodrow at epamail.epa.gov (Setzer.Woodrow at epamail.epa.gov)
Date: Tue, 21 Nov 2006 10:10:49 -0500
Subject: [Rd] f2c to achieve reentrancy in odesolve?
Message-ID: <OF715F43D6.4A6FBB7B-ON8525722D.005242E4-8525722D.00536374@epamail.epa.gov>

I am beginning a much-delayed update of odesolve to include several
ordinary differential equation solvers from the Livermore package
ODEPACK.  These are much-used and reliable Fortran codes, and I plan (as
I did for lsoda in the current odesolve package) to make as few changes
as possible to the Fortran 77 code.  However, recently someone wanted to
make nested calls to lsoda, which will not work, because Fortran is not
generally reentrant.  I understand I can use f2c to convert the codes to
C, which would then gain reentrancy, and that there are parts of R which
were translated from Fortran to C for just this reason (at least, I read
that in an earlier R-help message).  My questions to this group are:

1) Will this indeed automatically make the solvers reentrant?
2) How much do I need to worry about changed numerical behavior of the C
version of the solvers after translation?
3) Are there special considerations not covered in R-exts for code
translated with f2c?
4) Is there a better way to make the Fortran solvers reentrant?

R. Woodrow Setzer, Ph. D.
National Center for Computational Toxicology
US Environmental Protection Agency
Mail Drop B205-01/US EPA/RTP, NC 27711
Ph: (919) 541-0128    Fax: (919) 541-1194


From tplate at acm.org  Tue Nov 21 17:57:06 2006
From: tplate at acm.org (Tony Plate)
Date: Tue, 21 Nov 2006 09:57:06 -0700
Subject: [Rd] Documentation error for data.restore() in package "foreign"
 (was Re: [R] Import problem with S-Plus 7.0 dataset)
In-Reply-To: <20061103160729.BMD73634@po-d.temple.edu>
References: <20061103160729.BMD73634@po-d.temple.edu>
Message-ID: <45632FE2.9010706@acm.org>

BTW, the help file for data.restore says:

Value: an R version of the S3 object.

It looks like this may need correction (when I try this function out, it 
returns the file name, not the object restored from the file.)

I tried this in R 2.4.0:

 > sessionInfo()
R version 2.4.0 (2006-10-03)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United 
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
[7] "base"

other attached packages:
  foreign     ncdf
"0.8-17"    "1.6"
 >

-- Tony Plate

(redirected from an old thread on R-help -- I was waiting until I had R 
2.4.0 installed so that I could verify that this was still a problem. 
Apologies if it has been fixed since then)

Richard M. Heiberger wrote:
> It looks like it works.  The result you printed is
> the name of the file that data.store read.  The name of the
> variable is the same as the name you called it in S-Plus.
> 
> type
>    data[1:5,]
> and you should see your data.frame.
> 
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>


From jeff.horner at vanderbilt.edu  Tue Nov 21 18:05:31 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Tue, 21 Nov 2006 11:05:31 -0600
Subject: [Rd] Smallest R executable
In-Reply-To: <5222D071B410AC489A62C2EBA183858A9E996C@SSRCorreo.azti.local>
References: <5222D071B410AC489A62C2EBA183858A9E996C@SSRCorreo.azti.local>
Message-ID: <456331DB.9070604@vanderbilt.edu>

Iago Mosqueira wrote:
---
Hello,

I am trying to find out how can I generate the smallest R executable. R 
is to be run in a grid application, in batch mode, so I need a small 
exceutable, possibly getting rid of any interactive component. Should I 
look at the embedded version? Any other pointers?
----
(email copy and pasted because of charset problems?)


Then look no further than littler (pronounced little r)!

http://biostat.mc.vanderbilt.edu/LittleR

Since we switched from using upper-case R to lower-case r, the space
savings have been incredible! ;)

Seriously, though, you might find it a good fit for batch programming,
as it supports she-bang style programming. It is an executable linked to
libR.so, and there's no shell script front-end.

But are you more concerned about saving disk space, or R's in-memory
footprint?

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From ripley at stats.ox.ac.uk  Tue Nov 21 18:17:50 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 21 Nov 2006 17:17:50 +0000 (GMT)
Subject: [Rd] Documentation error for data.restore() in package
 "foreign" (was Re: [R] Import problem with S-Plus 7.0 dataset)
In-Reply-To: <45632FE2.9010706@acm.org>
References: <20061103160729.BMD73634@po-d.temple.edu>
	<45632FE2.9010706@acm.org>
Message-ID: <Pine.LNX.4.64.0611211713410.25689@gannet.stats.ox.ac.uk>

On Tue, 21 Nov 2006, Tony Plate wrote:

> BTW, the help file for data.restore says:

Not in the SVN version at

https://svn.r-project.org/R-packages/trunk/foreign/man/read.S.Rd

BTW, there is no such function as 'data.store' (sic).


> Value: an R version of the S3 object.
>
> It looks like this may need correction (when I try this function out, it
> returns the file name, not the object restored from the file.)

Rather, it returns the object names, as documented at that URL and in S.

>
> I tried this in R 2.4.0:
>
> > sessionInfo()
> R version 2.4.0 (2006-10-03)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
> [7] "base"
>
> other attached packages:
>  foreign     ncdf
> "0.8-17"    "1.6"
> >
>
> -- Tony Plate
>
> (redirected from an old thread on R-help -- I was waiting until I had R
> 2.4.0 installed so that I could verify that this was still a problem.
> Apologies if it has been fixed since then)
>
> Richard M. Heiberger wrote:
>> It looks like it works.  The result you printed is
>> the name of the file that data.store read.  The name of the
>> variable is the same as the name you called it in S-Plus.
>>
>> type
>>    data[1:5,]
>> and you should see your data.frame.
>>
>> ______________________________________________
>> R-help at stat.math.ethz.ch mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Peter.Ruckdeschel at uni-bayreuth.de  Tue Nov 21 18:30:30 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Tue, 21 Nov 2006 18:30:30 +0100
Subject: [Rd] package vignettes, suggests and R CMD check
Message-ID: <456337B6.5020905@uni-bayreuth.de>

Dear R-devels,

We have encountered a problem concerning a dead lock in the dependency graph:

We have two packages A1 and A2 where A2 extends A1.

We have one package vignette for both packages, but which should be included
into package A1.

So in the "suggests" field of the DESCRIPTION file of A1 we suggest A2
to be able to produce the vignette at build/install time.

On the other hand this means that A2 has to be installed before being
able to check A1, and A1, of course, has to be installed before being
able to check A2.

How can this dead lock be resolved?

Is this a case for a bundle? And can a bundle have its own vignette?

Thanks for listening
Peter, Matthias, Florian, Thomas


From tom.mccallum at levelelimited.com  Tue Nov 21 18:30:56 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Tue, 21 Nov 2006 17:30:56 -0000
Subject: [Rd] dyn.load
Message-ID: <op.tjdmxuzoffxks9@norisk>

Hi everyone,

Now I know there is information on this in the help files - which I have  
read.  I am very close to implementing this but can't quite get how to  
remove this final hurdle.

I have a DLL called "X.DLL" which I have no original code for, just the  
DLL.
I have created a wrapper C file for the calls in X.DLL, and have  
successfully (I think) created a wrapper DLL for X called, lets say,  
WRAPX.DLL.

On performing:

> dyn.load("WRAPX.dll")

in the Rgui terminal, I then received this warning:

Warning message:
DLL attempted to change FPU control word from 8001f to 9001f

Getting rid of this error was part of the reason for writing WRAPX.DLL, as  
X.DLL seems to play about with this register.

So having another look at the manual entry, I then used the function  
Rwin_fpset() (in gnuwin32/extra.c) to reset the FPU control register when  
I leave all the functions in WRAPX.DLL.  But the problem persists.  In the  
Delphi example in the manual, which I have put at the end of this message,  
( and I have never programmed in Delphi before so I am guessing ) there is  
the opportunity on loading the dynamic library to set this register, but I  
am wondering where in the C file I can put this command so that when  
dyn.load is called it is not upset by X.DLL changing this register.  I  
think I need the following passage of play to occur:
	
USER		: > dyn.load("WRAPX.DLL");
R   		: Calls WRAPX.DLL
WRAPX.DLL   : WRAPX.DLL initialises X.DLL which interferes with FPU  
register
WRAPX.DLL	: Calls Rwin_fpset() to reset FPU register
R		: R tests FPU register and is happy
USER		: Sees "Success library is loaded!" or something to that effect :)

Any ideas on how to achieve this?

Many thanks

Tom

====DELPHI CODE=====

procedure Rwin_fpset; cdecl; external 'R.dll';

function Get8087CW:word;
begin
   asm
     fstcw result
   end;
end;

begin
   Rwin_fpset();  <============== these lines I think is called on loading  
of the DLL to reset the register
   Set8087CW(Get8087CW); <========
end.

===END DELPHI CODE=====



--
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From sfalcon at fhcrc.org  Tue Nov 21 19:09:42 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 21 Nov 2006 10:09:42 -0800
Subject: [Rd] package vignettes, suggests and R CMD check
In-Reply-To: <456337B6.5020905@uni-bayreuth.de> (Peter Ruckdeschel's message
	of "Tue, 21 Nov 2006 18:30:30 +0100")
References: <456337B6.5020905@uni-bayreuth.de>
Message-ID: <m2zmakacyh.fsf@ziti.local>

Peter Ruckdeschel <Peter.Ruckdeschel at uni-bayreuth.de> writes:
> We have encountered a problem concerning a dead lock in the dependency graph:
>
> We have two packages A1 and A2 where A2 extends A1.
>
> We have one package vignette for both packages, but which should be included
> into package A1.
>
> So in the "suggests" field of the DESCRIPTION file of A1 we suggest A2
> to be able to produce the vignette at build/install time.
>
> On the other hand this means that A2 has to be installed before being
> able to check A1, and A1, of course, has to be installed before being
> able to check A2.
>
> How can this dead lock be resolved?

Is it really a deadlock?  You can install A1 and then A2 and at that
point you can check either one, right?

You might also be able to make part of the vignette in A1 conditional
on having A2 (or, of course, consider splitting the vignette or
merging the packages).

+ seth


From Peter.Ruckdeschel at uni-bayreuth.de  Tue Nov 21 20:01:18 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Tue, 21 Nov 2006 20:01:18 +0100
Subject: [Rd] package vignettes, suggests and R CMD check
Message-ID: <45634CFE.20208@uni-bayreuth.de>

Dear Seth,

thanks for your promptous response,

> Peter Ruckdeschel <Peter.Ruckdeschel at uni-bayreuth.de> writes:
>> We have encountered a problem concerning a dead lock in the dependency graph:
>>
>> We have two packages A1 and A2 where A2 extends A1.
>>
>> We have one package vignette for both packages, but which should be included
>> into package A1.
>>
>> So in the "suggests" field of the DESCRIPTION file of A1 we suggest A2
>> to be able to produce the vignette at build/install time.
>>
>> On the other hand this means that A2 has to be installed before being
>> able to check A1, and A1, of course, has to be installed before being
>> able to check A2.
>>
>> How can this dead lock be resolved?
> 
> Is it really a deadlock?  You can install A1 and then A2 and at that
> point you can check either one, right?

right. Not a problem at all for us. But when submitting the package to CRAN
this is a no-go condition ...

> You might also be able to make part of the vignette in A1 conditional
> on having A2 

Sorry, I am stuck here: I do not see how you could do this; could you
help me there?

> (or, of course, consider splitting the vignette or
> merging the packages).

We thought about this, too; our reasons not to do so were:

merging the packages: our packages already have a considerable size,
and the additional features provided for in the extension packages
may not be needed by everybody;

splitting the vignette: It seemed to be a good idea for us,
(a) not to have to repeat explications in the extension packages
and (b) to draw the reader's attention to the features provided for
by the extensions.


Thank you once again
Peter


From tplate at acm.org  Tue Nov 21 20:44:30 2006
From: tplate at acm.org (Tony Plate)
Date: Tue, 21 Nov 2006 12:44:30 -0700
Subject: [Rd] Documentation error for data.restore() in package
 "foreign" (was Re: [R] Import problem with S-Plus 7.0 dataset)
In-Reply-To: <Pine.LNX.4.64.0611211713410.25689@gannet.stats.ox.ac.uk>
References: <20061103160729.BMD73634@po-d.temple.edu>
	<45632FE2.9010706@acm.org>
	<Pine.LNX.4.64.0611211713410.25689@gannet.stats.ox.ac.uk>
Message-ID: <4563571E.3040504@acm.org>

Prof Brian Ripley wrote:
 > On Tue, 21 Nov 2006, Tony Plate wrote:
 >
 >> BTW, the help file for data.restore says:
 >
 >
 > Not in the SVN version at
 >
 > https://svn.r-project.org/R-packages/trunk/foreign/man/read.S.Rd
 >
 > BTW, there is no such function as 'data.store' (sic).
 >
 >
 >> Value: an R version of the S3 object.

Thanks for the fast response.  Indeed, the help file at that address now 
says that data.restore() returns "a character vector containing the 
names of the objects which have been created".

However, the behavior in the my version of R 2.4.0 is that the function 
returns the file name.

 > data.restore("data.dump", verbose=T)
   x list 2
     a integer 5
     b character 3
[1] "data.dump"
 >

 > sessionInfo()
R version 2.4.0 (2006-10-03)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United 
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
[7] "base"

other attached packages:
  foreign
"0.8-17"
 >

Where should I find the new code that returns a character vector of the 
names of the restored objects?  I've looked in the following places:

* My version of R 2.4.0
* https://svn.r-project.org/R-packages/trunk/foreign/man/read.S.Rd
* ftp://ftp.stat.math.ethz.ch/Software/R/R-devel_2006-11-20.tar.gz

and the code in all those places returns the filename.

Is there somewhere else I should be looking, or is the documentation 
still not aligned with the actual behavior?

-- Tony Plate



>>
>> It looks like this may need correction (when I try this function out, it
>> returns the file name, not the object restored from the file.)
> 
> 
> Rather, it returns the object names, as documented at that URL and in S.
> 
>>
>> I tried this in R 2.4.0:
>>
>> > sessionInfo()
>> R version 2.4.0 (2006-10-03)
>> i386-pc-mingw32
>>
>> locale:
>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>> States.1252;LC_MONETARY=English_United
>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     
>> "datasets"
>> [7] "base"
>>
>> other attached packages:
>>  foreign     ncdf
>> "0.8-17"    "1.6"
>> >
>>
>> -- Tony Plate
>>
>> (redirected from an old thread on R-help -- I was waiting until I had R
>> 2.4.0 installed so that I could verify that this was still a problem.
>> Apologies if it has been fixed since then)
>>
>> Richard M. Heiberger wrote:
>>
>>> It looks like it works.  The result you printed is
>>> the name of the file that data.store read.  The name of the
>>> variable is the same as the name you called it in S-Plus.
>>>
>>> type
>>>    data[1:5,]
>>> and you should see your data.frame.
>>>
>>> ______________________________________________
>>> R-help at stat.math.ethz.ch mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide 
>>> http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From sfalcon at fhcrc.org  Tue Nov 21 21:21:24 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 21 Nov 2006 12:21:24 -0800
Subject: [Rd] package vignettes, suggests and R CMD check
In-Reply-To: <45634CFE.20208@uni-bayreuth.de> (Peter Ruckdeschel's message of
	"Tue, 21 Nov 2006 20:01:18 +0100")
References: <45634CFE.20208@uni-bayreuth.de>
Message-ID: <m2slgc8saj.fsf@ziti.local>

Peter Ruckdeschel <Peter.Ruckdeschel at uni-bayreuth.de> writes:
> right. Not a problem at all for us. But when submitting the package to CRAN
> this is a no-go condition ...

I'm not sure exactly how CRAN handles this.  I would have thought
install happens before check.

>> You might also be able to make part of the vignette in A1 conditional
>> on having A2 
>
> Sorry, I am stuck here: I do not see how you could do this; could you
> help me there?

Given what your end goal is, I don't think this is what you want.
But...

   Don't list A2 in Suggests, don't list it in vignetteDepends.  In
   the vignette do:

   haveA2 <- suppressWarnings(require("A2"))
   if (haveA2) {
       # wow, those A2 features are great
   } else {
       # sorry, we show you something else that is not as interesting
   }

You may get a warning from R CMD check, there are sneaky ways around
it which I am not allowed to divuldge ;-)

>> (or, of course, consider splitting the vignette or
>> merging the packages).
>
> We thought about this, too; our reasons not to do so were:
>
> merging the packages: our packages already have a considerable size,
> and the additional features provided for in the extension packages
> may not be needed by everybody;
>
> splitting the vignette: It seemed to be a good idea for us,
> (a) not to have to repeat explications in the extension packages
> and (b) to draw the reader's attention to the features provided for
> by the extensions.

IMHO, you should reconsider the vignette.  You could probably mention
some of the functionality available in A2 in the A1 vignette but put
actuall examples in the A2 vignette.

IMO, if there is enough reason to split the packages, then there is
enough reason to split the vignettes.

Now it would be interesting in general to have a mechanism for
packaging vignette documentation for multiple packages.  A sort of
"meta-vignette" (oxymoron?).  Indeed, perhaps this is another solution
for you: an empty documentation package that depends on A1, A2 where
the vignette lives.

+ seth


From imosqueira at suk.azti.es  Tue Nov 21 23:24:33 2006
From: imosqueira at suk.azti.es (Iago Mosqueira)
Date: Tue, 21 Nov 2006 23:24:33 +0100
Subject: [Rd] Smallest R executable
In-Reply-To: <456331DB.9070604@vanderbilt.edu>
References: <5222D071B410AC489A62C2EBA183858A9E996C@SSRCorreo.azti.local>
	<456331DB.9070604@vanderbilt.edu>
Message-ID: <1164147873.6189.2.camel@localhost.localdomain>

El mar, 21-11-2006 a las 11:05 -0600, Jeffrey Horner escribi?:
> Iago Mosqueira wrote:
> ---
> Hello,
> 
> I am trying to find out how can I generate the smallest R executable. R 
> is to be run in a grid application, in batch mode, so I need a small 
> exceutable, possibly getting rid of any interactive component. Should I 
> look at the embedded version? Any other pointers?
> ----
> (email copy and pasted because of charset problems?)
> 
> 
> Then look no further than littler (pronounced little r)!
> 
> http://biostat.mc.vanderbilt.edu/LittleR
> 
> Since we switched from using upper-case R to lower-case r, the space
> savings have been incredible! ;)
> 
> Seriously, though, you might find it a good fit for batch programming,
> as it supports she-bang style programming. It is an executable linked to
> libR.so, and there's no shell script front-end.
> 
> But are you more concerned about saving disk space, or R's in-memory
> footprint?
> 
> Jeff

Thanks for that. I'll look at it. We need a smaller executable as it has
to be sent around from the main machine of the grid to be executed on
various nodes. Some nodes are quite far away, with less than gigabit
network speeds, so saving in the size of the R executable sent would be
advantageous.

Regards,


Iago


From alfilnegro.sv at gmail.com  Tue Nov 21 23:44:01 2006
From: alfilnegro.sv at gmail.com (Ricardo Rios)
Date: Tue, 21 Nov 2006 16:44:01 -0600
Subject: [Rd] Function lang2 in C
Message-ID: <50a711930611211444p2a2bd82ek7c7918e94fa61ad7@mail.gmail.com>

I have a source code in C, it use the function lang2 ,does somebody
know what does this function do. Thanks in advance.


From Soren.Hojsgaard at agrsci.dk  Tue Nov 21 23:58:52 2006
From: Soren.Hojsgaard at agrsci.dk (=?iso-8859-1?Q?S=F8ren_H=F8jsgaard?=)
Date: Tue, 21 Nov 2006 23:58:52 +0100
Subject: [Rd] Smallest R executable
References: <5222D071B410AC489A62C2EBA183858A9E996C@SSRCorreo.azti.local><456331DB.9070604@vanderbilt.edu>
	<1164147873.6189.2.camel@localhost.localdomain>
Message-ID: <C83C5E3DEEE97E498B74729A33F6EAEC03878533@DJFPOST01.djf.agrsci.dk>

Littler looks interesting; any plans for creating a windows binary?
Regards
S?ren

________________________________

Fra: r-devel-bounces at r-project.org p? vegne af Iago Mosqueira
Sendt: ti 21-11-2006 23:24
Til: Jeffrey Horner
Cc: r-devel at r-project.org; Dirk Eddelbuettel
Emne: Re: [Rd] Smallest R executable



El mar, 21-11-2006 a las 11:05 -0600, Jeffrey Horner escribi?:
> Iago Mosqueira wrote:
> ---
> Hello,
>
> I am trying to find out how can I generate the smallest R executable. R
> is to be run in a grid application, in batch mode, so I need a small
> exceutable, possibly getting rid of any interactive component. Should I
> look at the embedded version? Any other pointers?
> ----
> (email copy and pasted because of charset problems?)
>
>
> Then look no further than littler (pronounced little r)!
>
> http://biostat.mc.vanderbilt.edu/LittleR
>
> Since we switched from using upper-case R to lower-case r, the space
> savings have been incredible! ;)
>
> Seriously, though, you might find it a good fit for batch programming,
> as it supports she-bang style programming. It is an executable linked to
> libR.so, and there's no shell script front-end.
>
> But are you more concerned about saving disk space, or R's in-memory
> footprint?
>
> Jeff

Thanks for that. I'll look at it. We need a smaller executable as it has
to be sent around from the main machine of the grid to be executed on
various nodes. Some nodes are quite far away, with less than gigabit
network speeds, so saving in the size of the R executable sent would be
advantageous.

Regards,


Iago

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From sfalcon at fhcrc.org  Wed Nov 22 02:18:51 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 21 Nov 2006 17:18:51 -0800
Subject: [Rd] Function lang2 in C
In-Reply-To: <50a711930611211444p2a2bd82ek7c7918e94fa61ad7@mail.gmail.com>
	(Ricardo Rios's message of "Tue, 21 Nov 2006 16:44:01 -0600")
References: <50a711930611211444p2a2bd82ek7c7918e94fa61ad7@mail.gmail.com>
Message-ID: <m2y7q46zyc.fsf@ziti.local>

"Ricardo Rios" <alfilnegro.sv at gmail.com> writes:

> I have a source code in C, it use the function lang2 ,does somebody
> know what does this function do. Thanks in advance.

It creates a language list.  This is a Lisp-style pair list.  A common
use of it is to build a function call to pass to eval.

+ seth


From btyner at stat.purdue.edu  Wed Nov 22 02:32:49 2006
From: btyner at stat.purdue.edu (Benjamin Tyner)
Date: Tue, 21 Nov 2006 20:32:49 -0500
Subject: [Rd] array indexes in C
Message-ID: <4563A8C1.7000606@stat.purdue.edu>

Hin-Tak & Tamas,

For example, see what I've done in 
http://www.stat.purdue.edu/~btyner/postage_0.1-1.tar.gz

I am by no means a C guru but it works with my compiler. The relevant 
lines are

(in postage.c:)
void postage(int *lambda, int *D, int *tau, int r[*tau][*D])
{

(in postage.R:)
      r <- .C("postage",
              as.integer(lambda),
              as.integer(D),
              as.integer(tau0),
              r = integer(tau0 * D),
              PACKAGE="postage")$r


From Bernhard_Pfaff at fra.invesco.com  Wed Nov 22 14:00:51 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Wed, 22 Nov 2006 13:00:51 -0000
Subject: [Rd] Undocumented S4 methods: generic 'show'
Message-ID: <E4A9111DA23BA048B9A46686BF727CF461BE4C@DEFRAXMB01.corp.amvescap.net>

Dear R-Devel subsriber,

during the set-up of a package with a NAMESPACE I stumbled over the
following warning during:

R CMD check -l c:/R/package smem

## skipped output
* checking for missing documentation entries ... WARNING
Undocumented S4 methods:
  generic 'show' and siglist 'equation'
All user-level objects in a package (including S4 classes and methods)
## skipped output

However, I do have in the Rd.-file for class 'equation' an \alias{} as:

\alias{show, equation-method}

and I have included in the same file:

\section{Methods}{
  \describe{
    \item{show}{\code{signature(object = "equation")}: Prints the
      formula and the type of an equation.}
    }
}

The show-method for objects of class 'equation' is defined as:

setMethod("show", signature(object = "equation"), function(object){
  cat("\nFormula:\n")
  print(object at formula)
  cat(paste("Type of equation:", object at type, "\n"))
}
)

In the NAMESPACE, I have included:

exportMethods("show")


Any pointers are most welcome.

Best,
Bernhard



> R.version
               _

platform       i386-pc-mingw32

arch           i386

os             mingw32

system         i386, mingw32

status         Under development (unstable)

major          2

minor          5.0

year           2006

month          10

day            10

svn rev        39600

language       R

version.string R version 2.5.0 Under development (unstable) (2006-10-10
r39600)
> 

Dr. Bernhard Pfaff
Global Structured Products Group
(Europe)

Invesco Asset Management Deutschland GmbH
Bleichstrasse 60-62
D-60313 Frankfurt am Main

Tel: +49(0)69 29807 230
Fax: +49(0)69 29807 178
Email: bernhard_pfaff at fra.invesco.com 
*****************************************************************
Confidentiality Note: The information contained in this mess...{{dropped}}


From ripley at stats.ox.ac.uk  Wed Nov 22 14:14:41 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 22 Nov 2006 13:14:41 +0000 (GMT)
Subject: [Rd] Undocumented S4 methods: generic 'show'
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF461BE4C@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF461BE4C@DEFRAXMB01.corp.amvescap.net>
Message-ID: <Pine.LNX.4.64.0611221311120.5631@gannet.stats.ox.ac.uk>

On Wed, 22 Nov 2006, Pfaff, Bernhard Dr. wrote:

> Dear R-Devel subsriber,
>
> during the set-up of a package with a NAMESPACE I stumbled over the
> following warning during:
>
> R CMD check -l c:/R/package smem
>
> ## skipped output
> * checking for missing documentation entries ... WARNING
> Undocumented S4 methods:
>  generic 'show' and siglist 'equation'
> All user-level objects in a package (including S4 classes and methods)
> ## skipped output
>
> However, I do have in the Rd.-file for class 'equation' an \alias{} as:
>
> \alias{show, equation-method}

There are no spaces in the examples in Writing R Extensions, so I would 
not have assumed they are allowed.  Does it work without the space?  (If 
it supposed to, we need to document that.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Bernhard_Pfaff at fra.invesco.com  Wed Nov 22 14:51:32 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Wed, 22 Nov 2006 13:51:32 -0000
Subject: [Rd] Undocumented S4 methods: generic 'show'
In-Reply-To: <Pine.LNX.4.64.0611221311120.5631@gannet.stats.ox.ac.uk>
Message-ID: <E4A9111DA23BA048B9A46686BF727CF461BE4D@DEFRAXMB01.corp.amvescap.net>

>On Wed, 22 Nov 2006, Pfaff, Bernhard Dr. wrote:
>>
>> \alias{show, equation-method}
>
>There are no spaces in the examples in Writing R Extensions, 
>so I would 
>not have assumed they are allowed.  Does it work without the 
>space?  (If 
>it supposed to, we need to document that.)


Dear Prof. Ripley, Dear Kurt,

many thanks for your swift replies. Yes, after dropping the space in the
\alias{} everything works fine.
Apologies for not having read the documentation carefully enough and
indeed in section 2.1.3 it is stated:

"generic,signature_list-method"

furthermore, in the following paragraph it is clearly written:

"...where signature list contains the names of the classes in the
signature of the method (without
quotes) separated by ',' (without whitespace),..."

Hence, the fine manual is pretty explicit about whitespaces (which I
have not compared carefully enough with my ill-footed \alias{}
directive).

Best,
Bernhard
>
>-- 
>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
*****************************************************************
Confidentiality Note: The information contained in this mess...{{dropped}}


From pgilbert at bank-banque-canada.ca  Wed Nov 22 16:05:45 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 22 Nov 2006 10:05:45 -0500
Subject: [Rd] package vignettes, suggests and R CMD check
In-Reply-To: <456337B6.5020905@uni-bayreuth.de>
References: <456337B6.5020905@uni-bayreuth.de>
Message-ID: <45646749.9090908@bank-banque-canada.ca>



Peter Ruckdeschel wrote:
> Dear R-devels,
> 
> We have encountered a problem concerning a dead lock in the dependency graph:
> 
> We have two packages A1 and A2 where A2 extends A1.
> 
> We have one package vignette for both packages, but which should be included
> into package A1.
> 
> So in the "suggests" field of the DESCRIPTION file of A1 we suggest A2
> to be able to produce the vignette at build/install time.
> 
> On the other hand this means that A2 has to be installed before being
> able to check A1, and A1, of course, has to be installed before being
> able to check A2.
> 
> How can this dead lock be resolved?
> 
> Is this a case for a bundle? And can a bundle have its own vignette?

Vignettes just go in one of the packages. There is not really a "bundle 
vignette", and also no really good place to put vignettes if they are 
more general than one of the packages. I'm not sure if a bundle will 
resolve the deadlock. (Kurt might know if it should.) The way I have 
handle this problem in dse is to put pieces of the vignettes in 
different packages, so the part that requires the additional 
functionality goes in A2, and A1 does not require A2. That allows me to 
check the packages individually. Then when I build the bundle I splice 
together the pdf files and put the combined pdf in one of the packages 
(which I think users may find a bit confusing, but there is no other place).

Paul

> 
> Thanks for listening
> Peter, Matthias, Florian, Thomas
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From ggrothendieck at gmail.com  Wed Nov 22 16:20:49 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 22 Nov 2006 10:20:49 -0500
Subject: [Rd] package vignettes, suggests and R CMD check
In-Reply-To: <456337B6.5020905@uni-bayreuth.de>
References: <456337B6.5020905@uni-bayreuth.de>
Message-ID: <971536df0611220720j39b0a81fx122abb61b36cc89f@mail.gmail.com>

Assuming you don't want to split it tup:

In A1 place a file A1-packages.Rd which documents all sources of documentation
for A1.  That can refers the user to the vignette in A2.
   packages?A1
will bring it up this information help file.

You could also considering having a one line vignette in A1 which just
says see the vignette in A2 and/or which provides a link which when
clicked gets it from the web.

Another possibility is to include the vignette in A2 and just the pdf
of it in A1.

On 11/21/06, Peter Ruckdeschel <Peter.Ruckdeschel at uni-bayreuth.de> wrote:
> Dear R-devels,
>
> We have encountered a problem concerning a dead lock in the dependency graph:
>
> We have two packages A1 and A2 where A2 extends A1.
>
> We have one package vignette for both packages, but which should be included
> into package A1.
>
> So in the "suggests" field of the DESCRIPTION file of A1 we suggest A2
> to be able to produce the vignette at build/install time.
>
> On the other hand this means that A2 has to be installed before being
> able to check A1, and A1, of course, has to be installed before being
> able to check A2.
>
> How can this dead lock be resolved?
>
> Is this a case for a bundle? And can a bundle have its own vignette?
>
> Thanks for listening
> Peter, Matthias, Florian, Thomas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From tom.mccallum at levelelimited.com  Wed Nov 22 16:45:44 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Wed, 22 Nov 2006 15:45:44 -0000
Subject: [Rd] Ralloc clash
Message-ID: <op.tjfcqia2ffxks9@norisk>

Hi everyone,

Have been trying to include windows.h (from MinGW) and R.h into a package  
and have found that Ralloc is coming up as a clash no matter which include  
ordering I use.  In windows it has 2 arguments and is defined in objidl.h  
and in R.h it is 3 arguments.  Any ideas of how to work round this?  Have  
checked the web and have not seen anyone else comment on this.


Many thanks

Tom

-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From tom.mccallum at levelelimited.com  Wed Nov 22 16:48:24 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Wed, 22 Nov 2006 15:48:24 -0000
Subject: [Rd] dyn.load
In-Reply-To: <op.tjdmxuzoffxks9@norisk>
References: <op.tjdmxuzoffxks9@norisk>
Message-ID: <op.tjfcuya4ffxks9@norisk>

To answer my own question - you can use DllMain with Rwin_fpset() to get  
around this error message.

Am still struggling though as it crashes when it tries to call a function  
in the wrapped DLL - any ideas on how to debug this?

Hope this is of help to some one

Tom


On Tue, 21 Nov 2006 17:30:56 -0000, Tom McCallum  
<tom.mccallum at levelelimited.com> wrote:

> Hi everyone,
>
> Now I know there is information on this in the help files - which I have
> read.  I am very close to implementing this but can't quite get how to
> remove this final hurdle.
>
> I have a DLL called "X.DLL" which I have no original code for, just the
> DLL.
> I have created a wrapper C file for the calls in X.DLL, and have
> successfully (I think) created a wrapper DLL for X called, lets say,
> WRAPX.DLL.
>
> On performing:
>
>> dyn.load("WRAPX.dll")
>
> in the Rgui terminal, I then received this warning:
>
> Warning message:
> DLL attempted to change FPU control word from 8001f to 9001f
>
> Getting rid of this error was part of the reason for writing WRAPX.DLL,  
> as
> X.DLL seems to play about with this register.
>
> So having another look at the manual entry, I then used the function
> Rwin_fpset() (in gnuwin32/extra.c) to reset the FPU control register when
> I leave all the functions in WRAPX.DLL.  But the problem persists.  In  
> the
> Delphi example in the manual, which I have put at the end of this  
> message,
> ( and I have never programmed in Delphi before so I am guessing ) there  
> is
> the opportunity on loading the dynamic library to set this register, but  
> I
> am wondering where in the C file I can put this command so that when
> dyn.load is called it is not upset by X.DLL changing this register.  I
> think I need the following passage of play to occur:
> 	
> USER		: > dyn.load("WRAPX.DLL");
> R   		: Calls WRAPX.DLL
> WRAPX.DLL   : WRAPX.DLL initialises X.DLL which interferes with FPU
> register
> WRAPX.DLL	: Calls Rwin_fpset() to reset FPU register
> R		: R tests FPU register and is happy
> USER		: Sees "Success library is loaded!" or something to that effect :)
>
> Any ideas on how to achieve this?
>
> Many thanks
>
> Tom
>
> ====DELPHI CODE=====
>
> procedure Rwin_fpset; cdecl; external 'R.dll';
>
> function Get8087CW:word;
> begin
>    asm
>      fstcw result
>    end;
> end;
>
> begin
>    Rwin_fpset();  <============== these lines I think is called on  
> loading
> of the DLL to reset the register
>    Set8087CW(Get8087CW); <========
> end.
>
> ===END DELPHI CODE=====
>
>
>
> --
> Dr. Thomas McCallum
> Systems Architect,
> Level E Limited
> ETTC, The King's Buildings
> Mayfield Road,
> Edinburgh EH9 3JL, UK
> Work  +44 (0) 131 472 4813
> Fax:  +44 (0) 131 472 4719
> http://www.levelelimited.com
> Email: tom at levelelimited.com
>
> Level E is a limited company incorporated in Scotland. The  
> c...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From mdowle at concordiafunds.com  Wed Nov 22 16:17:33 2006
From: mdowle at concordiafunds.com (Matthew Dowle)
Date: Wed, 22 Nov 2006 15:17:33 -0000
Subject: [Rd] c.factor
References: <946928E281E8FD4B91D5B2CC3C91967D6AA9A0@lnex01.CONCORDIAFUNDS.COM><1163526685.4492.20.camel@localhost.localdomain><1163527030.4492.23.camel@localhost.localdomain><Pine.LNX.4.64.0611141809050.25751@gannet.stats.ox.ac.uk><Pine.GSO.4.56.0611141218410.17778@durian.statsci.com>
	<Pine.LNX.4.64.0611150926070.19618@auk.stats>
Message-ID: <ek1pmj$lpk$1@sea.gmane.org>


I noticed that a new feature in R 2.4 is that unlist of a list of factors 
already does the operation that I proposed :

> x = factor(letters[1:5])
> y = factor(letters[4:8])
> unlist(list(x,y))
 [1] a b c d e d e f g h
Levels: a b c d e f g h
>

Therefore, does it not make sense that c(x,y) should return the same as 
unlist(list(x,y))  ?

Also, the specific "if" for factors inside the definition of unlist, not 
surprisingly, uses a very similar method to those previously posted. 
However, it first coerces the factors with as.character, before matching to 
the new level set.  This is inefficient. Here is the c.factor method again 
that I proposed, which avoids the as.character and is therefore more 
efficient.  Leaving aside the discussion about c.factor, or concat, or 
whatever,  could 'unlist' be changed to use this method instead ?   After 
all one of the key advantages of factors is to save main memory,  anything 
which coerces back to character is going to defeat the benefit.

> c.factor = function(...)  {
    args <- list(...)
    if (!all(sapply(args, is.factor))) stop("all arguments must be factor")
    newlevels = unique(unlist(lapply(args,levels)))
    ans = unlist(lapply(args, function(x) {
        m = match(levels(x), newlevels)
        m[as.integer(x)]
    }))
    levels(ans) = newlevels
    class(ans) = "factor"
    ans
}
> identical(c(x,y), unlist(list(x,y)))
[1] TRUE
> version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          4.0
year           2006
month          10
day            03
svn rev        39566
language       R
version.string R version 2.4.0 (2006-10-03)
>


"Brian Ripley" <ripley at stats.ox.ac.uk> wrote in message 
news:Pine.LNX.4.64.0611150926070.19618 at auk.stats...
> On Tue, 14 Nov 2006, Bill Dunlap wrote:
>
>> On Tue, 14 Nov 2006, Prof Brian Ripley wrote:
>>
>>> Well, R has managed without a factor method for c() for most of its 
>>> decade
>>> of existence (not that it originally had factors as we know them).
>>>
>>> I would argue that factors are best viewed as an enumeration type, and
>>> anything which silently changes their level set is a bad idea.  I can 
>>> see
>>> a case for a c() method for factors that combines factors with the same
>>> level sets, but I can also see this is best done by users who know the
>>> level sets are same (c.factor would have to expend a considerable effort
>>> to check).
>>>
>>> You also need to consider the dispatch rules.  c.factor will be called
>>> whenever the first argument is a factor, whatever the others are. S4 (I
>>> think, definitely S4-based versions of S-PLUS) has an alternative 
>>> concat()
>>> that works differently (recursively) and seems a more natural model.
>>
>> In addition, c() has always had a double meaning of
>>  (a) turning an object into a simple "vector" (an object
>>      without "attributes"), as in
>>      > c(factor(c("Cat","Dog","Cat")))
>>      [1] 1 2 1
>>      > c(data.frame(x=1:2,y=c("Dog","Cat")))
>>      $x
>>      [1] 1 2
>>
>>      $y
>>      [1] Dog Cat
>>      Levels: Cat Dog
>
> To my surprise that was not documented at all on the R help page, and I've
> clarified it.  (BTW, at least in R it does not remove names, just all
> other attributes.)
>
>>  (b) concatenating several such vectors into one.
>>
>> The proposed c.factor does only (b).
>
> (Strictly not, as a factor is not a vector.)
>
> But the help page explicitly only describes the default method, and some
> of the other methods do preserve some attributes, AFAIR.
>
>> Should we just
>> throw c() into the ash heap and use as.vector() or
>> concat() instead?
>>
>> The whole concept of concatenating objects of disparate
>> types is suspect.
>
> I think working on a concat() for R would be helpful.  I vaguely recalled
> something like it in the Green Book, but the index does not help (but then
> it is not very complete).
>
> Brian


From si.tour at freenet.de  Wed Nov 22 17:44:16 2006
From: si.tour at freenet.de (Sued Tuerkei.)
Date: Wed, 22 Nov 2006 18:44:16 +0200
Subject: [Rd] Sued Tuerkei.
Message-ID: <392ee2a116894b5236815e210012f34e@freenet.de>

Sehr geehrte Damen und Herren,
Als SI GROUP F?r Herbst und Winter haben wir Ihnen ein preislich
unschlagbares Angebot an die t?rkische Riviera-BELEK Halb Pansion 5 Sterne Hotels anzubieten.
Ab Zuerich und Basel.
INCLUSIV FLUG  Hin und Zur?ck und
8-t?gige Ferien an der T?rkischen Riviera-Antalya-5 Sterne Halb Pansion(Fr?hst?ck und Abendessen)
TERMINE UND PREISE-
06.01. bis 13.01.2007  Euro 295
13.01. bis 20.01.2007  Euro 295
20.01. bis 27.01.2007  Euro 295
27.01. bis 03.02.2007  Euro 295
03.02. bis 10.02.2007  Euro 295
10.02. bis 17.02.2007  Euro 295
17.02. bis 24.02.2007  Euro 295
24.02. bis 03.03.2007  Euro 295
03.03. bis 10.03.2007  Euro 295
10.03. bis 17.03.2007  Euro 295
17.03. bis 24.03.2007  Euro 295
24.03. bis 31.03.2007  Euro 295
31.03. bis 07.04.2007  Euro 295
07.04. bis 14.04.2007  Euro 295
14.04. bis 21.04.2007  Euro 295
21.04. bis 28.04.2007  Euro 395
28.04. bis 05.05.2007  Euro 390
Inklusivleistungen:
6 ?bernachtungen im 5 - Sterne - Hotel im Doppelzimmer.
1 ?bernachtung in einem Thermalhotel in Pamukkale.
7 x Halbpension.
Begr??ungscocktail.
1 eint?giger Ausflug nach Antalya mit Bootsfahrt.
Alle Eintritte w?hrend der Reise.
Klimatisierte Busse f?r 2 Ausfl?ge.
Reiseleitung.

Mit Herzlichen Gr?ssen.
SI GROUP
www.si-groupreisen.com


From mdowle at concordiafunds.com  Wed Nov 22 17:29:00 2006
From: mdowle at concordiafunds.com (Matthew Dowle)
Date: Wed, 22 Nov 2006 16:29:00 -0000
Subject: [Rd] c.factor
Message-ID: <946928E281E8FD4B91D5B2CC3C91967D6AAA16@lnex01.CONCORDIAFUNDS.COM>


I just noticed that a new feature in R 2.4 is that unlist of a list of
factors 
already does the operation that I proposed :

> x = factor(letters[1:5])
> y = factor(letters[4:8])
> unlist(list(x,y))
[1] a b c d e d e f g h
Levels: a b c d e f g h
>

Therefore, does it not make sense that c(x,y) should return the same as 
unlist(list(x,y)) ?

Also, the specific "if" for factors inside the definition of unlist, not

surprisingly, uses a very similar method to those previously posted. 
However, it first coerces the factors with as.character, before matching
to 
the new level set. This is inefficient. Here is the c.factor method
again 
that I proposed, which avoids the as.character and is therefore more 
efficient. Leaving aside the discussion about c.factor, or concat, or 
whatever, could 'unlist' be changed to use this method instead ? After 
all one of the key advantages of factors is to save main memory,
anything 
which coerces back to character is going to defeat the benefit.

> c.factor = function(...) {
args <- list(...)
if (!all(sapply(args, is.factor))) stop("all arguments must be factor")
newlevels = unique(unlist(lapply(args,levels)))
ans = unlist(lapply(args, function(x) {
m = match(levels(x), newlevels)
m[as.integer(x)]
}))
levels(ans) = newlevels
class(ans) = "factor"
ans
}
> identical(c(x,y), unlist(list(x,y)))
[1] TRUE
> version
_
platform i386-pc-mingw32
arch i386
os mingw32
system i386, mingw32
status
major 2
minor 4.0
year 2006
month 10
day 03
svn rev 39566
language R
version.string R version 2.4.0 (2006-10-03)
>


"Brian Ripley" <ripley at stats.ox.ac.uk> wrote in message 
news:Pine.LNX.4.64.0611150926070.19618 at auk.stats...
> On Tue, 14 Nov 2006, Bill Dunlap wrote:
>
>> On Tue, 14 Nov 2006, Prof Brian Ripley wrote:
>>
>>> Well, R has managed without a factor method for c() for most of its 
>>> decade
>>> of existence (not that it originally had factors as we know them).
>>>
>>> I would argue that factors are best viewed as an enumeration type,
and
>>> anything which silently changes their level set is a bad idea. I can

>>> see
>>> a case for a c() method for factors that combines factors with the
same
>>> level sets, but I can also see this is best done by users who know
the
>>> level sets are same (c.factor would have to expend a considerable
effort
>>> to check).
>>>
>>> You also need to consider the dispatch rules. c.factor will be
called
>>> whenever the first argument is a factor, whatever the others are. S4
(I
>>> think, definitely S4-based versions of S-PLUS) has an alternative 
>>> concat()
>>> that works differently (recursively) and seems a more natural model.
>>
>> In addition, c() has always had a double meaning of
>> (a) turning an object into a simple "vector" (an object
>> without "attributes"), as in
>> > c(factor(c("Cat","Dog","Cat")))
>> [1] 1 2 1
>> > c(data.frame(x=1:2,y=c("Dog","Cat")))
>> $x
>> [1] 1 2
>>
>> $y
>> [1] Dog Cat
>> Levels: Cat Dog
>
> To my surprise that was not documented at all on the R help page, and
I've
> clarified it. (BTW, at least in R it does not remove names, just all
> other attributes.)
>
>> (b) concatenating several such vectors into one.
>>
>> The proposed c.factor does only (b).
>
> (Strictly not, as a factor is not a vector.)
>
> But the help page explicitly only describes the default method, and
some
> of the other methods do preserve some attributes, AFAIR.
>
>> Should we just
>> throw c() into the ash heap and use as.vector() or
>> concat() instead?
>>
>> The whole concept of concatenating objects of disparate
>> types is suspect.
>
> I think working on a concat() for R would be helpful. I vaguely
recalled
> something like it in the Green Book, but the index does not help (but
then
> it is not very complete).
>
> Brian


From alfilnegro.sv at gmail.com  Wed Nov 22 21:10:38 2006
From: alfilnegro.sv at gmail.com (Ricardo Rios)
Date: Wed, 22 Nov 2006 14:10:38 -0600
Subject: [Rd] How can I call a function R from C
Message-ID: <50a711930611221210l21bf78d7q29030644006ddeb5@mail.gmail.com>

Hi wizards, I have a function in R for example:
anyfunction<-function(beta0, popsize, maxgen),

but I have a  function in C  for example:

SEXP otherfunction(SEXP beta0, SEXP popsize, SEXP maxgen)

I call it function with .Call but I need to call to anyfunction on
otherfunction. Does somebody know how to do it?


From jeff.horner at vanderbilt.edu  Wed Nov 22 21:38:23 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Wed, 22 Nov 2006 14:38:23 -0600
Subject: [Rd] How can I call a function R from C
In-Reply-To: <50a711930611221210l21bf78d7q29030644006ddeb5@mail.gmail.com>
References: <50a711930611221210l21bf78d7q29030644006ddeb5@mail.gmail.com>
Message-ID: <4564B53F.4050603@vanderbilt.edu>

Ricardo Rios wrote:
> Hi wizards, I have a function in R for example:
> anyfunction<-function(beta0, popsize, maxgen),
> 
> but I have a  function in C  for example:
> 
> SEXP otherfunction(SEXP beta0, SEXP popsize, SEXP maxgen)
> 
> I call it function with .Call but I need to call to anyfunction on
> otherfunction. Does somebody know how to do it?

Scope out tests/Embedding/RNamedCall.c in the R sources. It's got what 
you want.


Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From ripley at stats.ox.ac.uk  Wed Nov 22 22:21:15 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 22 Nov 2006 21:21:15 +0000 (GMT)
Subject: [Rd] Ralloc clash
In-Reply-To: <op.tjfcqia2ffxks9@norisk>
References: <op.tjfcqia2ffxks9@norisk>
Message-ID: <Pine.LNX.4.64.0611222114200.1510@gannet.stats.ox.ac.uk>

Where exactly did you get windows.h from? The recommended source is 
w32api-3.7.tar.gz, and there is no Ralloc in any of its header files, 
including objidl.h.

BTW, do you know about defining WIN32_LEAN_AND_MEAN when including 
windows.h?  If not, it is worth finding out about.


On Wed, 22 Nov 2006, Tom McCallum wrote:

> Hi everyone,
>
> Have been trying to include windows.h (from MinGW) and R.h into a package
> and have found that Ralloc is coming up as a clash no matter which include
> ordering I use.  In windows it has 2 arguments and is defined in objidl.h
> and in R.h it is 3 arguments.  Any ideas of how to work round this?  Have
> checked the web and have not seen anyone else comment on this.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tom.mccallum at levelelimited.com  Thu Nov 23 11:48:09 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Thu, 23 Nov 2006 10:48:09 -0000
Subject: [Rd] Ralloc clash
In-Reply-To: <Pine.LNX.4.64.0611222114200.1510@gannet.stats.ox.ac.uk>
References: <op.tjfcqia2ffxks9@norisk>
	<Pine.LNX.4.64.0611222114200.1510@gannet.stats.ox.ac.uk>
Message-ID: <op.tjgtmjpmffxks9@norisk>

Thank you for your reply.  My mistake - I meant Realloc (missed the 'e').   
This morning I reinstalled MinGW with all the patches suggested by the  
Install R on Windows Help page, including w32api-3.7, just to make sure  
all was as it should be.  I have put

#define WIN32_LEAN_AND_MEAN

at the top of my cpp file (which I did not know about so that was  
interesting) but it is still saying there is a conflict between Realloc in  
objidl.h and windows.h.  Interesting I had a C file which I _did_ manage  
to compile with the R.h and windows.h file in without this error coming  
up.  Could there be something going on with g++ that gcc is ignoring?  I  
am no sure it iss a clash now as I cannot find Realloc in the R includes  
but below is some output I have gathered which may be of assistance.

In objidl.h (line 532):
         STDMETHOD_(void*,Realloc)(THIS_ void*,ULONG) PURE;

In R.h it has the solitary line:
	/* for PROBLEM ... Calloc, Realloc, Free, Memcpy, F77_xxxx */
	Can only find a R_alloc but no Realloc.

======ERROR MSG OUTPUT==============
$ R CMD SHLIB callcdeclcall.cpp
making callcdeclcall.d from callcdeclcall.cpp
In file included from  
c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objbase.h:73,
                  from  
c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/ole2.h:9,
                  from  
c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/windows.h:111,
                  from callcdeclcall.cpp:4:
c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objidl.h:532:45:  
macro "Realloc" requires 3 arguments, but only 2 given
make: *** [callcdeclcall.d] Error 1
======END ERROR MSG OUTPUT==============

Headers in CPP file are:
#include <R.h>
#include <Rinternals.h>
#include <Rdefines.h>
#include <windows.h>
#include <cstdio>

Thanks,

Tom


On Wed, 22 Nov 2006 21:21:15 -0000, Prof Brian Ripley  
<ripley at stats.ox.ac.uk> wrote:

> Where exactly did you get windows.h from? The recommended source is  
> w32api-3.7.tar.gz, and there is no Ralloc in any of its header files,  
> including objidl.h.
>
> BTW, do you know about defining WIN32_LEAN_AND_MEAN when including  
> windows.h?  If not, it is worth finding out about.
>
>
> On Wed, 22 Nov 2006, Tom McCallum wrote:
>
>> Hi everyone,
>>
>> Have been trying to include windows.h (from MinGW) and R.h into a  
>> package
>> and have found that Ralloc is coming up as a clash no matter which  
>> include
>> ordering I use.  In windows it has 2 arguments and is defined in  
>> objidl.h
>> and in R.h it is 3 arguments.  Any ideas of how to work round this?   
>> Have
>> checked the web and have not seen anyone else comment on this.
>


-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From ripley at stats.ox.ac.uk  Thu Nov 23 12:13:44 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 23 Nov 2006 11:13:44 +0000 (GMT)
Subject: [Rd] Ralloc clash
In-Reply-To: <op.tjgtmjpmffxks9@norisk>
References: <op.tjfcqia2ffxks9@norisk>
	<Pine.LNX.4.64.0611222114200.1510@gannet.stats.ox.ac.uk>
	<op.tjgtmjpmffxks9@norisk>
Message-ID: <Pine.LNX.4.64.0611231106510.16220@gannet.stats.ox.ac.uk>

Realloc is defined in R_ext/RS.h, and only if STRICT_R_HEADERS is not 
defined.  This *is* documented in 'Writing R Extensions'.

On Thu, 23 Nov 2006, Tom McCallum wrote:

> Thank you for your reply.  My mistake - I meant Realloc (missed the 'e').
> This morning I reinstalled MinGW with all the patches suggested by the
> Install R on Windows Help page, including w32api-3.7, just to make sure
> all was as it should be.  I have put
>
> #define WIN32_LEAN_AND_MEAN
>
> at the top of my cpp file (which I did not know about so that was
> interesting) but it is still saying there is a conflict between Realloc in
> objidl.h and windows.h.  Interesting I had a C file which I _did_ manage
> to compile with the R.h and windows.h file in without this error coming
> up.  Could there be something going on with g++ that gcc is ignoring?  I
> am no sure it iss a clash now as I cannot find Realloc in the R includes
> but below is some output I have gathered which may be of assistance.
>
> In objidl.h (line 532):
>         STDMETHOD_(void*,Realloc)(THIS_ void*,ULONG) PURE;
>
> In R.h it has the solitary line:
> 	/* for PROBLEM ... Calloc, Realloc, Free, Memcpy, F77_xxxx */
> 	Can only find a R_alloc but no Realloc.
>
> ======ERROR MSG OUTPUT==============
> $ R CMD SHLIB callcdeclcall.cpp
> making callcdeclcall.d from callcdeclcall.cpp
> In file included from
> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objbase.h:73,
>                  from
> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/ole2.h:9,
>                  from
> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/windows.h:111,
>                  from callcdeclcall.cpp:4:
> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objidl.h:532:45:
> macro "Realloc" requires 3 arguments, but only 2 given
> make: *** [callcdeclcall.d] Error 1
> ======END ERROR MSG OUTPUT==============
>
> Headers in CPP file are:
> #include <R.h>
> #include <Rinternals.h>
> #include <Rdefines.h>
> #include <windows.h>
> #include <cstdio>
>
> Thanks,
>
> Tom
>
>
> On Wed, 22 Nov 2006 21:21:15 -0000, Prof Brian Ripley
> <ripley at stats.ox.ac.uk> wrote:
>
>> Where exactly did you get windows.h from? The recommended source is
>> w32api-3.7.tar.gz, and there is no Ralloc in any of its header files,
>> including objidl.h.
>>
>> BTW, do you know about defining WIN32_LEAN_AND_MEAN when including
>> windows.h?  If not, it is worth finding out about.
>>
>>
>> On Wed, 22 Nov 2006, Tom McCallum wrote:
>>
>>> Hi everyone,
>>>
>>> Have been trying to include windows.h (from MinGW) and R.h into a
>>> package
>>> and have found that Ralloc is coming up as a clash no matter which
>>> include
>>> ordering I use.  In windows it has 2 arguments and is defined in
>>> objidl.h
>>> and in R.h it is 3 arguments.  Any ideas of how to work round this?
>>> Have
>>> checked the web and have not seen anyone else comment on this.
>>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tom.mccallum at levelelimited.com  Thu Nov 23 12:52:46 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Thu, 23 Nov 2006 11:52:46 -0000
Subject: [Rd] Ralloc clash
In-Reply-To: <Pine.LNX.4.64.0611231106510.16220@gannet.stats.ox.ac.uk>
References: <op.tjfcqia2ffxks9@norisk>
	<Pine.LNX.4.64.0611222114200.1510@gannet.stats.ox.ac.uk>
	<op.tjgtmjpmffxks9@norisk>
	<Pine.LNX.4.64.0611231106510.16220@gannet.stats.ox.ac.uk>
Message-ID: <op.tjgwl8djffxks9@norisk>

But from R_ext/RS.h  you have (my comments are given by <-- some text):

====================================BEGIN  
EXTRACT====================================================
#ifndef STRICT_R_HEADERS  							<-- fair enough this is defined but it  
ends ...

#define R_PROBLEM_BUFSIZE       4096
/* Parentheses added for FC4 with gcc4 and -D_FORTIFY_SOURCE=2 */
#define PROBLEM                 {char  
R_problem_buf[R_PROBLEM_BUFSIZE];(sprintf)(R_problem_buf,
#define MESSAGE                 {char  
R_problem_buf[R_PROBLEM_BUFSIZE];(sprintf)(R_problem_buf,
#define ERROR                   ),error(R_problem_buf);}
#define RECOVER(x)              ),error(R_problem_buf);}
#define WARNING(x)              ),warning(R_problem_buf);}
#define LOCAL_EVALUATOR         /**/
#define NULL_ENTRY              /**/
#define WARN                    WARNING(NULL)

#endif 												<-- ifndef clause ends here

/* S Like Memory Management */

extern void *R_chk_calloc(size_t, size_t);
extern void *R_chk_realloc(void *, size_t);
extern void R_chk_free(void *);

#define Calloc(n, t)   (t *) R_chk_calloc( (size_t) (n), sizeof(t) )
#define Realloc(p,n,t) (t *) R_chk_realloc( (void *)(p), (size_t)((n) *  
sizeof(t)) ) <-- This is still defined therefore, is it not?

/* S-PLUS 3.x but not 5.x NULLs the pointer in the following */
#ifndef STRICT_R_HEADERS
#define Free(p)        (R_chk_free( (void *)(p) ), (p) = NULL)
#endif
#define R_Free(p)      (R_chk_free( (void *)(p) ), (p) = NULL)

#define Memcpy(p,q,n)  memcpy( p, q, (size_t)( (n) * sizeof(*p) ) )

====================================END  
EXTRACT====================================================

The STRICT_R_HEADERS does not go around the Realloc function so even with  
STRICT_R_HEADERS defined the problem persists.
  To test I placed "#define STRICT_R_HEADERS" at the top of my single cpp  
file before all the include lines as I am not sure how to pass the -D  
function through to the g++ when doing R CMD SHLIB - would putting it in  
one of the PKG_ environment variables work - if so which?

Tom

On Thu, 23 Nov 2006 11:13:44 -0000, Prof Brian Ripley  
<ripley at stats.ox.ac.uk> wrote:

> Realloc is defined in R_ext/RS.h, and only if STRICT_R_HEADERS is not  
> defined.  This *is* documented in 'Writing R Extensions'.
>
> On Thu, 23 Nov 2006, Tom McCallum wrote:
>
>> Thank you for your reply.  My mistake - I meant Realloc (missed the  
>> 'e').
>> This morning I reinstalled MinGW with all the patches suggested by the
>> Install R on Windows Help page, including w32api-3.7, just to make sure
>> all was as it should be.  I have put
>>
>> #define WIN32_LEAN_AND_MEAN
>>
>> at the top of my cpp file (which I did not know about so that was
>> interesting) but it is still saying there is a conflict between Realloc  
>> in
>> objidl.h and windows.h.  Interesting I had a C file which I _did_ manage
>> to compile with the R.h and windows.h file in without this error coming
>> up.  Could there be something going on with g++ that gcc is ignoring?  I
>> am no sure it iss a clash now as I cannot find Realloc in the R includes
>> but below is some output I have gathered which may be of assistance.
>>
>> In objidl.h (line 532):
>>         STDMETHOD_(void*,Realloc)(THIS_ void*,ULONG) PURE;
>>
>> In R.h it has the solitary line:
>> 	/* for PROBLEM ... Calloc, Realloc, Free, Memcpy, F77_xxxx */
>> 	Can only find a R_alloc but no Realloc.
>>
>> ======ERROR MSG OUTPUT==============
>> $ R CMD SHLIB callcdeclcall.cpp
>> making callcdeclcall.d from callcdeclcall.cpp
>> In file included from
>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objbase.h:73,
>>                  from
>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/ole2.h:9,
>>                  from
>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/windows.h:111,
>>                  from callcdeclcall.cpp:4:
>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objidl.h:532:45:
>> macro "Realloc" requires 3 arguments, but only 2 given
>> make: *** [callcdeclcall.d] Error 1
>> ======END ERROR MSG OUTPUT==============
>>
>> Headers in CPP file are:
>> #include <R.h>
>> #include <Rinternals.h>
>> #include <Rdefines.h>
>> #include <windows.h>
>> #include <cstdio>
>>
>> Thanks,
>>
>> Tom
>>
>>
>> On Wed, 22 Nov 2006 21:21:15 -0000, Prof Brian Ripley
>> <ripley at stats.ox.ac.uk> wrote:
>>
>>> Where exactly did you get windows.h from? The recommended source is
>>> w32api-3.7.tar.gz, and there is no Ralloc in any of its header files,
>>> including objidl.h.
>>>
>>> BTW, do you know about defining WIN32_LEAN_AND_MEAN when including
>>> windows.h?  If not, it is worth finding out about.
>>>
>>>
>>> On Wed, 22 Nov 2006, Tom McCallum wrote:
>>>
>>>> Hi everyone,
>>>>
>>>> Have been trying to include windows.h (from MinGW) and R.h into a
>>>> package
>>>> and have found that Ralloc is coming up as a clash no matter which
>>>> include
>>>> ordering I use.  In windows it has 2 arguments and is defined in
>>>> objidl.h
>>>> and in R.h it is 3 arguments.  Any ideas of how to work round this?
>>>> Have
>>>> checked the web and have not seen anyone else comment on this.
>>>
>>
>>
>>
>



-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From ripley at stats.ox.ac.uk  Thu Nov 23 14:06:29 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 23 Nov 2006 13:06:29 +0000 (GMT)
Subject: [Rd] Ralloc clash
In-Reply-To: <Pine.LNX.4.64.0611231106510.16220@gannet.stats.ox.ac.uk>
References: <op.tjfcqia2ffxks9@norisk>
	<Pine.LNX.4.64.0611222114200.1510@gannet.stats.ox.ac.uk>
	<op.tjgtmjpmffxks9@norisk>
	<Pine.LNX.4.64.0611231106510.16220@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0611231258230.18864@gannet.stats.ox.ac.uk>

On Thu, 23 Nov 2006, Prof Brian Ripley wrote:

> Realloc is defined in R_ext/RS.h, and only if STRICT_R_HEADERS is not 
> defined.  This *is* documented in 'Writing R Extensions'.

That was the general intention, but seems not to cover this example. 
Howver,

#include <R.h>
#undef Realloc
#define R_Realloc(p,n,t) (t *) R_chk_realloc( (void *)(p), (size_t)((n) * sizeof(t)) )
#include <windows.h>

seems to work.


> On Thu, 23 Nov 2006, Tom McCallum wrote:
>
>> Thank you for your reply.  My mistake - I meant Realloc (missed the 'e').
>> This morning I reinstalled MinGW with all the patches suggested by the
>> Install R on Windows Help page, including w32api-3.7, just to make sure
>> all was as it should be.  I have put
>> 
>> #define WIN32_LEAN_AND_MEAN
>> 
>> at the top of my cpp file (which I did not know about so that was
>> interesting) but it is still saying there is a conflict between Realloc in
>> objidl.h and windows.h.  Interesting I had a C file which I _did_ manage
>> to compile with the R.h and windows.h file in without this error coming
>> up.  Could there be something going on with g++ that gcc is ignoring?  I
>> am no sure it iss a clash now as I cannot find Realloc in the R includes
>> but below is some output I have gathered which may be of assistance.
>> 
>> In objidl.h (line 532):
>>         STDMETHOD_(void*,Realloc)(THIS_ void*,ULONG) PURE;
>> 
>> In R.h it has the solitary line:
>> 	/* for PROBLEM ... Calloc, Realloc, Free, Memcpy, F77_xxxx */
>> 	Can only find a R_alloc but no Realloc.
>> 
>> ======ERROR MSG OUTPUT==============
>> $ R CMD SHLIB callcdeclcall.cpp
>> making callcdeclcall.d from callcdeclcall.cpp
>> In file included from
>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objbase.h:73,
>>                  from
>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/ole2.h:9,
>>                  from
>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/windows.h:111,
>>                  from callcdeclcall.cpp:4:
>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objidl.h:532:45:
>> macro "Realloc" requires 3 arguments, but only 2 given
>> make: *** [callcdeclcall.d] Error 1
>> ======END ERROR MSG OUTPUT==============
>> 
>> Headers in CPP file are:
>> #include <R.h>
>> #include <Rinternals.h>
>> #include <Rdefines.h>
>> #include <windows.h>
>> #include <cstdio>
>> 
>> Thanks,
>> 
>> Tom
>> 
>> 
>> On Wed, 22 Nov 2006 21:21:15 -0000, Prof Brian Ripley
>> <ripley at stats.ox.ac.uk> wrote:
>> 
>>> Where exactly did you get windows.h from? The recommended source is
>>> w32api-3.7.tar.gz, and there is no Ralloc in any of its header files,
>>> including objidl.h.
>>> 
>>> BTW, do you know about defining WIN32_LEAN_AND_MEAN when including
>>> windows.h?  If not, it is worth finding out about.
>>> 
>>> 
>>> On Wed, 22 Nov 2006, Tom McCallum wrote:
>>> 
>>>> Hi everyone,
>>>> 
>>>> Have been trying to include windows.h (from MinGW) and R.h into a
>>>> package
>>>> and have found that Ralloc is coming up as a clash no matter which
>>>> include
>>>> ordering I use.  In windows it has 2 arguments and is defined in
>>>> objidl.h
>>>> and in R.h it is 3 arguments.  Any ideas of how to work round this?
>>>> Have
>>>> checked the web and have not seen anyone else comment on this.
>>> 
>> 
>> 
>> 
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tom.mccallum at levelelimited.com  Thu Nov 23 14:15:40 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Thu, 23 Nov 2006 13:15:40 -0000
Subject: [Rd] Ralloc clash
In-Reply-To: <Pine.LNX.4.64.0611231258230.18864@gannet.stats.ox.ac.uk>
References: <op.tjfcqia2ffxks9@norisk>
	<Pine.LNX.4.64.0611222114200.1510@gannet.stats.ox.ac.uk>
	<op.tjgtmjpmffxks9@norisk>
	<Pine.LNX.4.64.0611231106510.16220@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.64.0611231258230.18864@gannet.stats.ox.ac.uk>
Message-ID: <op.tjg0gemhffxks9@norisk>

Thank you that did the job.

Tom

On Thu, 23 Nov 2006 13:06:29 -0000, Prof Brian Ripley  
<ripley at stats.ox.ac.uk> wrote:

> On Thu, 23 Nov 2006, Prof Brian Ripley wrote:
>
>> Realloc is defined in R_ext/RS.h, and only if STRICT_R_HEADERS is not  
>> defined.  This *is* documented in 'Writing R Extensions'.
>
> That was the general intention, but seems not to cover this example.  
> Howver,
>
> #include <R.h>
> #undef Realloc
> #define R_Realloc(p,n,t) (t *) R_chk_realloc( (void *)(p), (size_t)((n)  
> * sizeof(t)) )
> #include <windows.h>
>
> seems to work.
>
>
>> On Thu, 23 Nov 2006, Tom McCallum wrote:
>>
>>> Thank you for your reply.  My mistake - I meant Realloc (missed the  
>>> 'e').
>>> This morning I reinstalled MinGW with all the patches suggested by the
>>> Install R on Windows Help page, including w32api-3.7, just to make sure
>>> all was as it should be.  I have put
>>>  #define WIN32_LEAN_AND_MEAN
>>>  at the top of my cpp file (which I did not know about so that was
>>> interesting) but it is still saying there is a conflict between  
>>> Realloc in
>>> objidl.h and windows.h.  Interesting I had a C file which I _did_  
>>> manage
>>> to compile with the R.h and windows.h file in without this error coming
>>> up.  Could there be something going on with g++ that gcc is ignoring?   
>>> I
>>> am no sure it iss a clash now as I cannot find Realloc in the R  
>>> includes
>>> but below is some output I have gathered which may be of assistance.
>>>  In objidl.h (line 532):
>>>         STDMETHOD_(void*,Realloc)(THIS_ void*,ULONG) PURE;
>>>  In R.h it has the solitary line:
>>> 	/* for PROBLEM ... Calloc, Realloc, Free, Memcpy, F77_xxxx */
>>> 	Can only find a R_alloc but no Realloc.
>>>  ======ERROR MSG OUTPUT==============
>>> $ R CMD SHLIB callcdeclcall.cpp
>>> making callcdeclcall.d from callcdeclcall.cpp
>>> In file included from
>>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objbase.h:73,
>>>                  from
>>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/ole2.h:9,
>>>                  from
>>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/windows.h:111,
>>>                  from callcdeclcall.cpp:4:
>>> c:/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/objidl.h:532:45:
>>> macro "Realloc" requires 3 arguments, but only 2 given
>>> make: *** [callcdeclcall.d] Error 1
>>> ======END ERROR MSG OUTPUT==============
>>>  Headers in CPP file are:
>>> #include <R.h>
>>> #include <Rinternals.h>
>>> #include <Rdefines.h>
>>> #include <windows.h>
>>> #include <cstdio>
>>>  Thanks,
>>>  Tom
>>>   On Wed, 22 Nov 2006 21:21:15 -0000, Prof Brian Ripley
>>> <ripley at stats.ox.ac.uk> wrote:
>>>
>>>> Where exactly did you get windows.h from? The recommended source is
>>>> w32api-3.7.tar.gz, and there is no Ralloc in any of its header files,
>>>> including objidl.h.
>>>>  BTW, do you know about defining WIN32_LEAN_AND_MEAN when including
>>>> windows.h?  If not, it is worth finding out about.
>>>>   On Wed, 22 Nov 2006, Tom McCallum wrote:
>>>>
>>>>> Hi everyone,
>>>>>  Have been trying to include windows.h (from MinGW) and R.h into a
>>>>> package
>>>>> and have found that Ralloc is coming up as a clash no matter which
>>>>> include
>>>>> ordering I use.  In windows it has 2 arguments and is defined in
>>>>> objidl.h
>>>>> and in R.h it is 3 arguments.  Any ideas of how to work round this?
>>>>> Have
>>>>> checked the web and have not seen anyone else comment on this.
>>>>
>>>
>>
>>
>



-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From gml4410 at ggr.co.uk  Thu Nov 23 15:19:59 2006
From: gml4410 at ggr.co.uk (gml4410 at ggr.co.uk)
Date: Thu, 23 Nov 2006 15:19:59 +0100 (CET)
Subject: [Rd] configure issue (PR#9379)
Message-ID: <20061123141959.6ED5B2A359@slim.kubism.ku.dk>

Full_Name: Gordon Lack
Version: 2.4.0
OS: Redhat Linux AS2.1
Submission from: (NULL) (198.28.92.5)


Not sure whether this is a configure issue or an R one.

It's only a minor issue, so this is really just FYI.

The code in configure checks for the version of makeinfo by splitting the
version string into a major and minor component.  The tests on these assume they
are numeric.

RHAS2.1 shipped with a makeinfo version of "4.0b"

The result is this:
=====
checking whether makeinfo version is at least 4.7...
 ./configure: test: 0b: integer expression expected
yes
=====

ie: an error reported, but the test passed (4.0b > 4.7!!!).

And there is no command line option to tell configure not to run the makeinfo
commands (you can set r_cv_prog_makeinfo_v4=0 in your environment, but that
isn't "right").


From Kurt.Hornik at wu-wien.ac.at  Thu Nov 23 15:27:48 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Thu, 23 Nov 2006 15:27:48 +0100
Subject: [Rd] configure issue (PR#9379)
In-Reply-To: <20061123141959.6ED5B2A359@slim.kubism.ku.dk>
References: <20061123141959.6ED5B2A359@slim.kubism.ku.dk>
Message-ID: <17765.45028.142959.710306@mithrandir.hornik.net>

>>>>> gml4410  writes:

> Full_Name: Gordon Lack
> Version: 2.4.0
> OS: Redhat Linux AS2.1
> Submission from: (NULL) (198.28.92.5)


> Not sure whether this is a configure issue or an R one.

> It's only a minor issue, so this is really just FYI.

> The code in configure checks for the version of makeinfo by splitting the
> version string into a major and minor component.  The tests on these assume they
> are numeric.

> RHAS2.1 shipped with a makeinfo version of "4.0b"

> The result is this:
> =====
> checking whether makeinfo version is at least 4.7...
>  ./configure: test: 0b: integer expression expected
> yes
> =====

> ie: an error reported, but the test passed (4.0b > 4.7!!!).

> And there is no command line option to tell configure not to run the
> makeinfo commands (you can set r_cv_prog_makeinfo_v4=0 in your
> environment, but that isn't "right").

Did you try configuring with MAKEINFO=false in your envrionment?

-k


From gml4410 at ggr.co.uk  Thu Nov 23 15:30:07 2006
From: gml4410 at ggr.co.uk (gml4410 at ggr.co.uk)
Date: Thu, 23 Nov 2006 15:30:07 +0100 (CET)
Subject: [Rd] OSF1 build fails (PR#9380)
Message-ID: <20061123143007.17A3C57301@slim.kubism.ku.dk>

Full_Name: Gordon Lack
Version: 2.4.0
OS: OSF1 5.1
Submission from: (NULL) (198.28.92.5)


Attempts to build R 2.4.0 on an OSF1 5.1 system result in:

==========
gcc -I. -I../../src/include -I../../src/include ..........
In file included from dynload.c:33:
../../src/include/Defn.h:554: error: parse error before "R_CStackLimit"
../../src/include/Defn.h:554: warning: type defaults to `int' in declaration of
`R_CStackLimit'
../../src/include/Defn.h:554: warning: data definition has no type or storage
class
../../src/include/Defn.h:555: error: parse error before "R_CStackStart"
../../src/include/Defn.h:555: warning: type defaults to `int' in declaration of
`R_CStackStart'
../../src/include/Defn.h:555: warning: data definition has no type or storage
class
==========

This is a result of uintptr_t being undefined at this point.

This is caused by HAVE_DECL_SIZE_MAX not being defined on OSF1 and so
<inttypes.h> is not included.

Moving the inclusion of <inttypes.h> (which is already conditional on having it)
out of the SIZE_MAX test block cures the problem.


From gml4410 at ggr.co.uk  Thu Nov 23 16:19:44 2006
From: gml4410 at ggr.co.uk (Gordon Lack)
Date: Thu, 23 Nov 2006 15:19:44 +0000
Subject: [Rd] configure issue (PR#9379)
In-Reply-To: <17765.45028.142959.710306@mithrandir.hornik.net>
References: <20061123141959.6ED5B2A359@slim.kubism.ku.dk>
	<17765.45028.142959.710306@mithrandir.hornik.net>
Message-ID: <4565BC10.8080605@ggr.co.uk>

Kurt Hornik wrote:
>
> Did you try configuring with MAKEINFO=false in your envrionment?

    No, but I just have and it makes no difference.

    The relevant code in configure is:

===============
echo "$as_me:$LINENO: checking for working makeinfo" >&5
echo $ECHO_N "checking for working makeinfo... $ECHO_C" >&6
if (makeinfo --version) < /dev/null > /dev/null 2>&1; then
   MAKEINFO=makeinfo
   echo "$as_me:$LINENO: result: found" >&5
echo "${ECHO_T}found" >&6
else
   MAKEINFO="\$(SHELL) \$(top_srcdir)/tools/missing makeinfo"
   echo "$as_me:$LINENO: result: missing" >&5
echo "${ECHO_T}missing" >&6
fi
===============

and that is always going to run "makeinfo --version" (which succeeds) 
and hence set MAKEINFO=makeinfo within the script.


From spencer.graves at pdf.com  Fri Nov 24 01:02:41 2006
From: spencer.graves at pdf.com (Spencer Graves)
Date: Thu, 23 Nov 2006 16:02:41 -0800
Subject: [Rd] Writing R Extensions manual?
Message-ID: <456636A1.6000704@pdf.com>

      I got an error message apparently from copying a line in the 
"Writing R Extensions" manual.  Specifically, the sample "DESCRIPTION" 
file includes the following: 

Depends: R (>= 1.8.0), nlme

      When I ran "R CMD check", I got the following message in 
"00install.out": 

installing R.css in 
D:/spencerg/statmtds/RTimeSeries/Durbin/StateSpaceDK.Rcheck

unsupported operator in dependence "R (>=2.4.0), zoo"

---------- Making package StateSpaceDK ------------
  adding build stamp to DESCRIPTION
Error: Invalid DESCRIPTION file

Malformed Depends or Suggests or Imports or Enhances field.
Offending entries:
  R (>=2.4.0)
Entries must be names of packages optionally followed by '<=' or '>=',
white space, and a valid version number in parentheses.

See the information on DESCRIPTION files in section 'Creating R
packages' of the 'Writing R Extensions' manual.
Execution halted
make[2]: *** [frontmatter] Error 1
make[1]: *** [all] Error 2

###########################

      After I removed "R (>=2.4.0)", "R CMD check" moved on to something 
else I haven't yet parsed.  However, either I've misinterpreted 
something here or the manual is inconsistent with what "R CMD check" 
currently does. 

      Thanks for all your hard work in creating this very useful tool. 
      Spencer Graves
###########################
sessionInfo()
R version 2.4.0 (2006-10-03)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United 
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
[7] "base"    
 >


From h.wickham at gmail.com  Fri Nov 24 01:44:12 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 24 Nov 2006 13:44:12 +1300
Subject: [Rd] Writing R Extensions manual?
In-Reply-To: <456636A1.6000704@pdf.com>
References: <456636A1.6000704@pdf.com>
Message-ID: <f8e6ff050611231644s1f3f85aes9cc9943bc87bb366@mail.gmail.com>

It's very particular:

> Malformed Depends or Suggests or Imports or Enhances field.
> Offending entries:
>   R (>=2.4.0)
> Entries must be names of packages optionally followed by '<=' or '>=',
> white space, and a valid version number in parentheses.
   ^^^^^^^^^^^

You need a space after >=

Hadley


From spencer.graves at pdf.com  Fri Nov 24 02:42:17 2006
From: spencer.graves at pdf.com (Spencer Graves)
Date: Thu, 23 Nov 2006 17:42:17 -0800
Subject: [Rd] Writing R Extensions manual?
In-Reply-To: <f8e6ff050611231644s1f3f85aes9cc9943bc87bb366@mail.gmail.com>
References: <456636A1.6000704@pdf.com>
	<f8e6ff050611231644s1f3f85aes9cc9943bc87bb366@mail.gmail.com>
Message-ID: <45664DF9.9000203@pdf.com>

Dear Hadley:  Thanks very much.  Clearly I looked at TFM but failed to 
properly parse it.  Thanks again.  Spencer Graves

hadley wickham wrote:
> It's very particular:
>
>> Malformed Depends or Suggests or Imports or Enhances field.
>> Offending entries:
>>   R (>=2.4.0)
>> Entries must be names of packages optionally followed by '<=' or '>=',
>> white space, and a valid version number in parentheses.
>   ^^^^^^^^^^^
>
> You need a space after >=
>
> Hadley


From gregor.gorjanc at bfro.uni-lj.si  Fri Nov 24 10:17:50 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Fri, 24 Nov 2006 10:17:50 +0100
Subject: [Rd] Wish: add link to Date in date help page
Message-ID: <4566B8BE.5090700@bfro.uni-lj.si>

Hello!

Could someone add Date to see also links in date help page i.e. the
following code in ./src/library/base/man/date.Rd

\seealso{
  \code{\link{Sys.time}} and \code{\link{Date}}
}

I always fire ?date instead of ?Date and I guess a lot of useRs also get
lost in search for the right help pages about date-time classes.

Btw. Perhaps article from RNews about datetime classes by Gabor and
Thomas could also be added to "all?" date-time help pages. That article
really rocks and I guess it would help a lot to provide link from help
pages. This is not the first wish about this issue. I can provide
patches if this wish is accepted!

Thanks!

Gregor


From elagin at wias-berlin.de  Fri Nov 24 17:17:40 2006
From: elagin at wias-berlin.de (Mstislav Elagin)
Date: Fri, 24 Nov 2006 17:17:40 +0100
Subject: [Rd] bin/Shlib overrides the variable PKG_LIBS from Makevars
Message-ID: <45671B24.7060904@wias-berlin.de>

Dear developers,

I have got a problem building my shared library via R CMD SHLIB (R
2.4.0 under WinXP), although it worked on R 2.3.0.

I tracked the problem down to the file $(R_HOME)/bin/Shlib that 
generates the variable PKG_LIBS and passes it to make on the command 
line thus overriding the value specified in Makevars.

I consider this behaviour a bug :), since it is apparently not 
documented and, moreover, "Writing R Extensions" states that PKG_LIBS 
may be used in Makevars to pass additional parameters to the linker.

Of course, it is possible to put my custom parameters in the variable
EXTRA_LIBS, but this way is not documented either.

WBR
Mstislav Elagin


From gml4410 at ggr.co.uk  Fri Nov 24 17:33:37 2006
From: gml4410 at ggr.co.uk (gml4410 at ggr.co.uk)
Date: Fri, 24 Nov 2006 17:33:37 +0100 (CET)
Subject: [Rd] Solaris build produces worrying warning. (PR#9382)
Message-ID: <20061124163337.3D101572A4@slim.kubism.ku.dk>

Full_Name: Gordon Lack
Version: 2.4.0
OS: Solaris8
Submission from: (NULL) (198.28.92.5)


   A 32-bit compile of R-2.4.0 on Solaris8 (using gcc3.4.3) produces this:

==========
make[3]: Entering directory `/var/tmp/gml-R/R-2.4.0/src/extra/pcre'
gcc -I.  -I.  -I../../../src/include -I../../../src/include ... -DHAVE_CONFIG_H
-g -O2 -std=gnu99 -c dftables.c -o dftables.o
In file included from pcre_internal.h:68,
                 from dftables.c:50:
../../../src/include/config.h:903:1: warning: "_FILE_OFFSET_BITS" redefined
In file included from /usr/include/iso/ctype_iso.h:30,
                 from /usr/include/ctype.h:18,
                 from dftables.c:46:
/usr/include/sys/feature_tests.h:96:1: warning: this is the location of the
previous definition
==========

_FILE_OFFSET_BITS is being redefined from 32 to 64 here, which I find slightly
worrying.

The problem is caused by stdio.,h being included before config.h.  The former
sets _FILE_OFFSET_BITS to 32 if it is not set, while the latter sets it to 64
(which it should be) unconditionally.  BUT, by then all of stdio.h has been run
though with it set to 32...

Possible fixes are:

a) include <config.h> as the first #include
b) move the include of pcre_internal.h to be the first one (since it includes
config.h).


From mike.prager at noaa.gov  Fri Nov 24 17:27:39 2006
From: mike.prager at noaa.gov (Mike Prager)
Date: Fri, 24 Nov 2006 11:27:39 -0500
Subject: [Rd] f2c to achieve reentrancy in odesolve?
References: <OF715F43D6.4A6FBB7B-ON8525722D.005242E4-8525722D.00536374@epamail.epa.gov>
Message-ID: <v47em2l1fn6do0d108s5enfohc8i7op694@4ax.com>

Setzer.Woodrow at epamail.epa.gov wrote:

> I am beginning a much-delayed update of odesolve to include several
> ordinary differential equation solvers from the Livermore package
> ODEPACK.  These are much-used and reliable Fortran codes, and I plan (as
> I did for lsoda in the current odesolve package) to make as few changes
> as possible to the Fortran 77 code.  However, recently someone wanted to
> make nested calls to lsoda, which will not work, because Fortran is not
> generally reentrant.  I understand I can use f2c to convert the codes to
> C, which would then gain reentrancy, and that there are parts of R which
> were translated from Fortran to C for just this reason (at least, I read
> that in an earlier R-help message).  My questions to this group are:
> 
> 1) Will this indeed automatically make the solvers reentrant?
> 2) How much do I need to worry about changed numerical behavior of the C
> version of the solvers after translation?
> 3) Are there special considerations not covered in R-exts for code
> translated with f2c?
> 4) Is there a better way to make the Fortran solvers reentrant?
> 
> R. Woodrow Setzer, Ph. D.

Hello, Woodrow.

Fortran 95 may be better than Fortran 77 in that regard (it does
allow recursive calls).  However, it is not an area I have
experience with.  

I suggest that you post your question to Usenet group
comp.lang.fortran.  Many highly experienced Fortran users
populate that group, including several members of the standards
committee.  I can't think of a better place to get advice on
such a question.

Mike

-- 
Mike Prager, NOAA, Beaufort, NC
* Opinions expressed are personal and not represented otherwise.
* Any use of tradenames does not constitute a NOAA endorsement.


From ross at biostat.ucsf.edu  Fri Nov 24 20:23:14 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Fri, 24 Nov 2006 11:23:14 -0800
Subject: [Rd] Missing values for S4 slots
Message-ID: <20061124192314.GA16006@wheat.betterworld.us>

Using R 2.4, the following fails:
setClass("testc", representation(a="ANY"))
makeC <- function(myarg) new("testc", a=myarg)
makeC()
-> Error in initialize(value, ...) : argument "myarg" is missing,
   with no default

On the other hand, this is OK:
f <- function(a) g(b=a)
g <- function(b) if(missing(b)) "missing" else "valid arg"
g()
-> "missing"

By the way, new("testc") succeeds.

Is there a good way around this?  Since my real example has several 4
arguments that might be missing, testing on missingness and calling
"new" with appropriate explicit arguments is not an attractive option.

Passing all the arguments in is also not an option, since my call to
"new" includes an argument not in the constructor (i.e., my equivalent
of makeC). 

I suspect there's something I could do to get the constructor
arguments, modify the list (i.e., delete args that were missing and
insert new ones), and do.call(new, myArgList).  Not only am I unsure
how to do that (or if it would work), I'm hoping there's a better way.

What's the best approach to this problem?


From ross at biostat.ucsf.edu  Fri Nov 24 22:18:55 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Fri, 24 Nov 2006 13:18:55 -0800
Subject: [Rd] Missing values for S4 slots [One Solution]
In-Reply-To: <20061124192314.GA16006@wheat.betterworld.us>
References: <20061124192314.GA16006@wheat.betterworld.us>
Message-ID: <20061124211854.GH4431@wheat.betterworld.us>

On Fri, Nov 24, 2006 at 11:23:14AM -0800, Ross Boylan wrote:
> Using R 2.4, the following fails:
> setClass("testc", representation(a="ANY"))
> makeC <- function(myarg) new("testc", a=myarg)
> makeC()
> -> Error in initialize(value, ...) : argument "myarg" is missing,
>    with no default
....
> 
> I suspect there's something I could do to get the constructor
> arguments, modify the list (i.e., delete args that were missing and
> insert new ones), and do.call(new, myArgList).  Not only am I unsure
> how to do that (or if it would work), I'm hoping there's a better way.

I didn't find a way to get all the arguments easily(*), but manually
constructing the list works.  Here are fragments of the code:

mspathCoefficients <- function(
                   aMatrix,
                   params,
                   offset=0,
                   baseConstrVec, 
                   covLabels # other args omitted
                   ) {
  # innerArgs are used with do.call("new, innerArgs)
  innerArgs <- list(
                    Class = "mspathCoefficients",
                    aMatrix = aMatrix,
                    baseConstrVec = as.integer(baseConstrVec),
                    params = params
                    )

# the next block inserts the covLabels argument
# only if it is non-missing
  if (missing(covLabels)) {
    # ....
  } else {
    innerArgs$covLabels <- covLabels
  }
#...
  map <- list() 
# fill in the map
# add it to the arguments
  innerArgs$map <- map
  do.call("new", innerArgs)
}

This calls new("mspathCoefficients", ...) with just the non-missing
arguments.  The constructed object has appropriately "missing" values
in the slots (e.g., character(0) given a slot of type "character").


(*) Inside the function, arg <- list(...) will capture the unnamed
arguments, but I don't have any.  as.list(sys.frame(sys.nframe()) is
closer to what I was looking for, though all the values are promises.


From mtmorgan at fhcrc.org  Sat Nov 25 08:46:55 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 24 Nov 2006 23:46:55 -0800
Subject: [Rd] Missing values for S4 slots [One Solution]
In-Reply-To: <20061124211854.GH4431@wheat.betterworld.us> (Ross Boylan's
	message of "Fri, 24 Nov 2006 13:18:55 -0800")
References: <20061124192314.GA16006@wheat.betterworld.us>
	<20061124211854.GH4431@wheat.betterworld.us>
Message-ID: <6phd57cge8g.fsf@gopher4.fhcrc.org>

Ross Boylan <ross at biostat.ucsf.edu> writes:

> On Fri, Nov 24, 2006 at 11:23:14AM -0800, Ross Boylan wrote:
>> Using R 2.4, the following fails:
>> setClass("testc", representation(a="ANY"))
>> makeC <- function(myarg) new("testc", a=myarg)
>> makeC()
>> -> Error in initialize(value, ...) : argument "myarg" is missing,
>>    with no default

The following might offer one paradigm:

makeC <- function(myarg) {
    new("testc",
        a=if (missing(myarg)) character(0) else myarg)
    }

A couple of things that come to mind, though: 'ANY' kind of defeats
the purpose of having a class with well-defined slots (I realize this
is a 'toy' example); presenting myarg without a default makes it
obscure to the user what the default value might be, or that a default
value will be used; if 'myarg' is an appropriately descriptive
argument for the user, then perhaps it is also appropriately
descriptive for the slot. Thus:

setClass("testc",
         representation(myarg="character"))

makeC <- function(myarg=character(0)) new("testc", myarg=myarg)

> ....
>> 
>> I suspect there's something I could do to get the constructor
>> arguments, modify the list (i.e., delete args that were missing and
>> insert new ones), and do.call(new, myArgList).  Not only am I unsure
>> how to do that (or if it would work), I'm hoping there's a better way.
>
> I didn't find a way to get all the arguments easily(*), but manually

as.list(match.call()[-1]) might help

> constructing the list works.  Here are fragments of the code:
>
> mspathCoefficients <- function(
>                    aMatrix,
>                    params,
>                    offset=0,
>                    baseConstrVec, 
>                    covLabels # other args omitted
>                    ) {
>   # innerArgs are used with do.call("new, innerArgs)
>   innerArgs <- list(
>                     Class = "mspathCoefficients",
>                     aMatrix = aMatrix,
>                     baseConstrVec = as.integer(baseConstrVec),
>                     params = params
>                     )
>
> # the next block inserts the covLabels argument
> # only if it is non-missing
>   if (missing(covLabels)) {
>     # ....
>   } else {
>     innerArgs$covLabels <- covLabels
>   }
> #...
>   map <- list() 
> # fill in the map
> # add it to the arguments
>   innerArgs$map <- map
>   do.call("new", innerArgs)
> }
>
> This calls new("mspathCoefficients", ...) with just the non-missing
> arguments.  The constructed object has appropriately "missing" values
> in the slots (e.g., character(0) given a slot of type "character").
>
>
> (*) Inside the function, arg <- list(...) will capture the unnamed
> arguments, but I don't have any.  as.list(sys.frame(sys.nframe()) is
> closer to what I was looking for, though all the values are promises.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin T. Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From mailadm at dsi.unifi.it  Sat Nov 25 12:17:15 2006
From: mailadm at dsi.unifi.it (mailadm at dsi.unifi.it)
Date: Sat, 25 Nov 2006 12:17:15 +0100 (CET)
Subject: [Rd] Message modified (PR#9383)
Message-ID: <20061125111715.C7CE2494D3@slim.kubism.ku.dk>

Scanner: MailMonitor for SMTP v1.2.2 

Problem description:
Email data:
MessageID: <200611251116.kAPBG4l08470 at dsi-fe2.dsi.unifi.it>
From: r-bugs at r-project.org
To: cystein at dsi.unifi.it
Cc: 
Subject: Info
Scanning part []

Scanning part [info3.pif]
Attachment validity check: passed.
Virus identity found: W32/Sality-AA

Virus identity found: W32/Sality-AA


From murdoch at stats.uwo.ca  Sat Nov 25 19:51:20 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 25 Nov 2006 13:51:20 -0500
Subject: [Rd] Source references from the parser
Message-ID: <456890A8.2060908@stats.uwo.ca>

I have just committed some changes to R-devel (which will become R 2.5.0 
next spring) to add source references to parsed R code.  Here's a 
description of the scheme:

The design is done through 2 old-style classes.

"srcfile" corresponds to a source file: it contains a filename, the
working directory in which that filename is to be interpreted, the last
modified timestamp of the file at the time the object is created, plus
some internal components.  It is implemented as an environment so that
there can be multiple references to it.

"srcref" is a reference to a particular range of characters (as the
parser sees them; I think that really means bytes, but I haven't tested
with MBCSs) in a source file.  It is implemented as a vector of 4
integers (first line, first column, last line, last column), with the
srcfile as an attribute.

The parser attaches a srcref attribute to each complete statement as it
gets parsed, if option("useSource") is TRUE.  (I've left the old source
attribute in place as well for functions; I think it won't be needed in 
the long run, but it is needed now.)

When printing an object with a srcref attribute, print.default tries to
read the srcfile to obtain the text.  If it fails, it falls back to an
ugly display of the reference.  Using a new argument useSource=FALSE in
printing will stop this attempt:  when printing language, it will
deparse; when printing a srcref, it will print the ugly fallback.

source(echo=T) will echo all the lines of the file including comments
and formatting.  demo() does the same, and I would guess Sweave will do
this too, but I haven't tested that yet.  I think this will improve
Sweave output, but will need changes to the input file:  people may have
comments there that they don't want shown.  Some sort of
"useSource=FALSE" option will need to be added.

The browser used with debug() etc. will display statements as they were
formatted in the original source.  It will not display leading or
following comments, but will display embedded comments.

Parsing errors display the name of the source file that was parsed, and
display verbose error messages describing what's wrong.  This display
could still be improved, e.g. by displaying the whole source line with a
pointer to the error, instead of just the text up to the location of the
error.

I plan to add some sort of equivalent of C "#line" directives, so that
preprocessed source files (e.g. the concatenated source that is
installed) can include references back to the original source files, for
syntax error reporting, and/or debugging.  This will require
modification of the INSTALL process, but I haven't started on this yet.

It would probably be a good idea to have some utility functions to play
with the srcref records for debugging and other purposes, but I haven't
written those yet.  For example, the current source record on a function
could be replaced with a srcref, but only by expanding the srcref to
include some of the surrounding comments.

Comments and problem reports are welcome.

Duncan Murdoch


From deepayan.sarkar at gmail.com  Sat Nov 25 21:12:31 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Sat, 25 Nov 2006 12:12:31 -0800
Subject: [Rd] Source references from the parser
In-Reply-To: <456890A8.2060908@stats.uwo.ca>
References: <456890A8.2060908@stats.uwo.ca>
Message-ID: <eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>

On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> I have just committed some changes to R-devel (which will become R 2.5.0
> next spring) to add source references to parsed R code.  Here's a
> description of the scheme:
>
> The design is done through 2 old-style classes.
>
> "srcfile" corresponds to a source file: it contains a filename, the
> working directory in which that filename is to be interpreted, the last
> modified timestamp of the file at the time the object is created, plus
> some internal components.  It is implemented as an environment so that
> there can be multiple references to it.
>
> "srcref" is a reference to a particular range of characters (as the
> parser sees them; I think that really means bytes, but I haven't tested
> with MBCSs) in a source file.  It is implemented as a vector of 4
> integers (first line, first column, last line, last column), with the
> srcfile as an attribute.
>
> The parser attaches a srcref attribute to each complete statement as it
> gets parsed, if option("useSource") is TRUE.  (I've left the old source
> attribute in place as well for functions; I think it won't be needed in
> the long run, but it is needed now.)
>
> When printing an object with a srcref attribute, print.default tries to
> read the srcfile to obtain the text.  If it fails, it falls back to an
> ugly display of the reference.  Using a new argument useSource=FALSE in
> printing will stop this attempt:  when printing language, it will
> deparse; when printing a srcref, it will print the ugly fallback.
>
> source(echo=T) will echo all the lines of the file including comments
> and formatting.  demo() does the same, and I would guess Sweave will do
> this too, but I haven't tested that yet.  I think this will improve
> Sweave output, but will need changes to the input file:  people may have
> comments there that they don't want shown.  Some sort of
> "useSource=FALSE" option will need to be added.
>
> The browser used with debug() etc. will display statements as they were
> formatted in the original source.  It will not display leading or
> following comments, but will display embedded comments.
>
> Parsing errors display the name of the source file that was parsed, and
> display verbose error messages describing what's wrong.  This display
> could still be improved, e.g. by displaying the whole source line with a
> pointer to the error, instead of just the text up to the location of the
> error.
>
> I plan to add some sort of equivalent of C "#line" directives, so that
> preprocessed source files (e.g. the concatenated source that is
> installed) can include references back to the original source files, for
> syntax error reporting, and/or debugging.  This will require
> modification of the INSTALL process, but I haven't started on this yet.
>
> It would probably be a good idea to have some utility functions to play
> with the srcref records for debugging and other purposes, but I haven't
> written those yet.  For example, the current source record on a function
> could be replaced with a srcref, but only by expanding the srcref to
> include some of the surrounding comments.
>
> Comments and problem reports are welcome.

I haven't tested this, but the idea seems useful. Will this have any
effect on code parsed using parse(text = "...")? Can it be extended to
have some such effect? I ask because this is relevant in the context
of Sweave, where I have always wanted the ability to retain the
original formatting. I'm currently testing a patch that allows me to
do this specifically for Sweave, but a more general solution is
obviously preferable.

-Deepayan


From murdoch at stats.uwo.ca  Sat Nov 25 22:37:16 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 25 Nov 2006 16:37:16 -0500
Subject: [Rd] Source references from the parser
In-Reply-To: <eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>
References: <456890A8.2060908@stats.uwo.ca>
	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>
Message-ID: <4568B78C.1000301@stats.uwo.ca>

On 11/25/2006 3:12 PM, Deepayan Sarkar wrote:
> On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> I have just committed some changes to R-devel (which will become R 2.5.0
>> next spring) to add source references to parsed R code.  Here's a
>> description of the scheme:
>>
>> The design is done through 2 old-style classes.
>>
>> "srcfile" corresponds to a source file: it contains a filename, the
>> working directory in which that filename is to be interpreted, the last
>> modified timestamp of the file at the time the object is created, plus
>> some internal components.  It is implemented as an environment so that
>> there can be multiple references to it.
>>
>> "srcref" is a reference to a particular range of characters (as the
>> parser sees them; I think that really means bytes, but I haven't tested
>> with MBCSs) in a source file.  It is implemented as a vector of 4
>> integers (first line, first column, last line, last column), with the
>> srcfile as an attribute.
>>
>> The parser attaches a srcref attribute to each complete statement as it
>> gets parsed, if option("useSource") is TRUE.  (I've left the old source
>> attribute in place as well for functions; I think it won't be needed in
>> the long run, but it is needed now.)
>>
>> When printing an object with a srcref attribute, print.default tries to
>> read the srcfile to obtain the text.  If it fails, it falls back to an
>> ugly display of the reference.  Using a new argument useSource=FALSE in
>> printing will stop this attempt:  when printing language, it will
>> deparse; when printing a srcref, it will print the ugly fallback.
>>
>> source(echo=T) will echo all the lines of the file including comments
>> and formatting.  demo() does the same, and I would guess Sweave will do
>> this too, but I haven't tested that yet.  I think this will improve
>> Sweave output, but will need changes to the input file:  people may have
>> comments there that they don't want shown.  Some sort of
>> "useSource=FALSE" option will need to be added.
>>
>> The browser used with debug() etc. will display statements as they were
>> formatted in the original source.  It will not display leading or
>> following comments, but will display embedded comments.
>>
>> Parsing errors display the name of the source file that was parsed, and
>> display verbose error messages describing what's wrong.  This display
>> could still be improved, e.g. by displaying the whole source line with a
>> pointer to the error, instead of just the text up to the location of the
>> error.
>>
>> I plan to add some sort of equivalent of C "#line" directives, so that
>> preprocessed source files (e.g. the concatenated source that is
>> installed) can include references back to the original source files, for
>> syntax error reporting, and/or debugging.  This will require
>> modification of the INSTALL process, but I haven't started on this yet.
>>
>> It would probably be a good idea to have some utility functions to play
>> with the srcref records for debugging and other purposes, but I haven't
>> written those yet.  For example, the current source record on a function
>> could be replaced with a srcref, but only by expanding the srcref to
>> include some of the surrounding comments.
>>
>> Comments and problem reports are welcome.
> 
> I haven't tested this, but the idea seems useful. Will this have any
> effect on code parsed using parse(text = "...")? Can it be extended to
> have some such effect? I ask because this is relevant in the context
> of Sweave, where I have always wanted the ability to retain the
> original formatting. I'm currently testing a patch that allows me to
> do this specifically for Sweave, but a more general solution is
> obviously preferable.

It won't currently, but that's on the todo list.

When it will arrive depends on how many other things land on my desk in 
the next few weeks:  if I don't get it done before January, it probably 
won't make 2.5.0.

Duncan Murdoch


From murdoch at stats.uwo.ca  Sun Nov 26 04:24:02 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 25 Nov 2006 22:24:02 -0500
Subject: [Rd] Source references from the parser
In-Reply-To: <eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>
References: <456890A8.2060908@stats.uwo.ca>
	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>
Message-ID: <456908D2.6080409@stats.uwo.ca>

On 11/25/2006 3:12 PM, Deepayan Sarkar wrote:
> On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> I have just committed some changes to R-devel (which will become R 2.5.0
>> next spring) to add source references to parsed R code.  Here's a
>> description of the scheme:
>>
>> The design is done through 2 old-style classes.
>>
>> "srcfile" corresponds to a source file: it contains a filename, the
>> working directory in which that filename is to be interpreted, the last
>> modified timestamp of the file at the time the object is created, plus
>> some internal components.  It is implemented as an environment so that
>> there can be multiple references to it.
>>
>> "srcref" is a reference to a particular range of characters (as the
>> parser sees them; I think that really means bytes, but I haven't tested
>> with MBCSs) in a source file.  It is implemented as a vector of 4
>> integers (first line, first column, last line, last column), with the
>> srcfile as an attribute.
>>
>> The parser attaches a srcref attribute to each complete statement as it
>> gets parsed, if option("useSource") is TRUE.  (I've left the old source
>> attribute in place as well for functions; I think it won't be needed in
>> the long run, but it is needed now.)
>>
>> When printing an object with a srcref attribute, print.default tries to
>> read the srcfile to obtain the text.  If it fails, it falls back to an
>> ugly display of the reference.  Using a new argument useSource=FALSE in
>> printing will stop this attempt:  when printing language, it will
>> deparse; when printing a srcref, it will print the ugly fallback.
>>
>> source(echo=T) will echo all the lines of the file including comments
>> and formatting.  demo() does the same, and I would guess Sweave will do
>> this too, but I haven't tested that yet.  I think this will improve
>> Sweave output, but will need changes to the input file:  people may have
>> comments there that they don't want shown.  Some sort of
>> "useSource=FALSE" option will need to be added.
>>
>> The browser used with debug() etc. will display statements as they were
>> formatted in the original source.  It will not display leading or
>> following comments, but will display embedded comments.
>>
>> Parsing errors display the name of the source file that was parsed, and
>> display verbose error messages describing what's wrong.  This display
>> could still be improved, e.g. by displaying the whole source line with a
>> pointer to the error, instead of just the text up to the location of the
>> error.
>>
>> I plan to add some sort of equivalent of C "#line" directives, so that
>> preprocessed source files (e.g. the concatenated source that is
>> installed) can include references back to the original source files, for
>> syntax error reporting, and/or debugging.  This will require
>> modification of the INSTALL process, but I haven't started on this yet.
>>
>> It would probably be a good idea to have some utility functions to play
>> with the srcref records for debugging and other purposes, but I haven't
>> written those yet.  For example, the current source record on a function
>> could be replaced with a srcref, but only by expanding the srcref to
>> include some of the surrounding comments.
>>
>> Comments and problem reports are welcome.
> 
> I haven't tested this, but the idea seems useful. Will this have any
> effect on code parsed using parse(text = "...")? Can it be extended to
> have some such effect? I ask because this is relevant in the context
> of Sweave, where I have always wanted the ability to retain the
> original formatting. I'm currently testing a patch that allows me to
> do this specifically for Sweave, but a more general solution is
> obviously preferable.

I've just added the capability to Sweave.  I haven't committed yet, 
because I think it's important that authors can choose whether or not to 
turn this on.  Could you let me know your typical workflow with Sweave, 
whether you'd like this to default to on or off, and where you'd expect 
to change the default?

Duncan Murdoch


From deepayan.sarkar at gmail.com  Sun Nov 26 05:00:23 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Sat, 25 Nov 2006 20:00:23 -0800
Subject: [Rd] Source references from the parser
In-Reply-To: <456908D2.6080409@stats.uwo.ca>
References: <456890A8.2060908@stats.uwo.ca>
	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>
	<456908D2.6080409@stats.uwo.ca>
Message-ID: <eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>

On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 11/25/2006 3:12 PM, Deepayan Sarkar wrote:
> > On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> I have just committed some changes to R-devel (which will become R 2.5.0
> >> next spring) to add source references to parsed R code.  Here's a
> >> description of the scheme:
> >>
> >> The design is done through 2 old-style classes.
> >>
> >> "srcfile" corresponds to a source file: it contains a filename, the
> >> working directory in which that filename is to be interpreted, the last
> >> modified timestamp of the file at the time the object is created, plus
> >> some internal components.  It is implemented as an environment so that
> >> there can be multiple references to it.
> >>
> >> "srcref" is a reference to a particular range of characters (as the
> >> parser sees them; I think that really means bytes, but I haven't tested
> >> with MBCSs) in a source file.  It is implemented as a vector of 4
> >> integers (first line, first column, last line, last column), with the
> >> srcfile as an attribute.
> >>
> >> The parser attaches a srcref attribute to each complete statement as it
> >> gets parsed, if option("useSource") is TRUE.  (I've left the old source
> >> attribute in place as well for functions; I think it won't be needed in
> >> the long run, but it is needed now.)
> >>
> >> When printing an object with a srcref attribute, print.default tries to
> >> read the srcfile to obtain the text.  If it fails, it falls back to an
> >> ugly display of the reference.  Using a new argument useSource=FALSE in
> >> printing will stop this attempt:  when printing language, it will
> >> deparse; when printing a srcref, it will print the ugly fallback.
> >>
> >> source(echo=T) will echo all the lines of the file including comments
> >> and formatting.  demo() does the same, and I would guess Sweave will do
> >> this too, but I haven't tested that yet.  I think this will improve
> >> Sweave output, but will need changes to the input file:  people may have
> >> comments there that they don't want shown.  Some sort of
> >> "useSource=FALSE" option will need to be added.
> >>
> >> The browser used with debug() etc. will display statements as they were
> >> formatted in the original source.  It will not display leading or
> >> following comments, but will display embedded comments.
> >>
> >> Parsing errors display the name of the source file that was parsed, and
> >> display verbose error messages describing what's wrong.  This display
> >> could still be improved, e.g. by displaying the whole source line with a
> >> pointer to the error, instead of just the text up to the location of the
> >> error.
> >>
> >> I plan to add some sort of equivalent of C "#line" directives, so that
> >> preprocessed source files (e.g. the concatenated source that is
> >> installed) can include references back to the original source files, for
> >> syntax error reporting, and/or debugging.  This will require
> >> modification of the INSTALL process, but I haven't started on this yet.
> >>
> >> It would probably be a good idea to have some utility functions to play
> >> with the srcref records for debugging and other purposes, but I haven't
> >> written those yet.  For example, the current source record on a function
> >> could be replaced with a srcref, but only by expanding the srcref to
> >> include some of the surrounding comments.
> >>
> >> Comments and problem reports are welcome.
> >
> > I haven't tested this, but the idea seems useful. Will this have any
> > effect on code parsed using parse(text = "...")? Can it be extended to
> > have some such effect? I ask because this is relevant in the context
> > of Sweave, where I have always wanted the ability to retain the
> > original formatting. I'm currently testing a patch that allows me to
> > do this specifically for Sweave, but a more general solution is
> > obviously preferable.
>
> I've just added the capability to Sweave.  I haven't committed yet,
> because I think it's important that authors can choose whether or not to
> turn this on.  Could you let me know your typical workflow with Sweave,
> whether you'd like this to default to on or off, and where you'd expect
> to change the default?

I would like it as an option to the RweaveLatex driver (and perhaps
others). In terms of changing the API, this is as simple as adding an
argument to the 'RweaveLatexSetup' function.

In the case of my patch, the default is off, and is turned on by

<<...,src=TRUE>>
...
@

To make this the global default, one can do

\SweaveOpts{src=TRUE}

etc. (the name 'src' is not necessarily the best, some variant of
'keep.source' might be more intuitive.)

Thanks for getting to this so quickly.

-Deepayan


From murdoch at stats.uwo.ca  Sun Nov 26 06:26:48 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 26 Nov 2006 00:26:48 -0500
Subject: [Rd] Source references from the parser
In-Reply-To: <eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>
References: <456890A8.2060908@stats.uwo.ca>	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>	<456908D2.6080409@stats.uwo.ca>
	<eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>
Message-ID: <45692598.30606@stats.uwo.ca>

On 11/25/2006 11:00 PM, Deepayan Sarkar wrote:
> On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 11/25/2006 3:12 PM, Deepayan Sarkar wrote:
>>> On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>> I have just committed some changes to R-devel (which will become R 2.5.0
>>>> next spring) to add source references to parsed R code.  Here's a
>>>> description of the scheme:
>>>>
>>>> The design is done through 2 old-style classes.
>>>>
>>>> "srcfile" corresponds to a source file: it contains a filename, the
>>>> working directory in which that filename is to be interpreted, the last
>>>> modified timestamp of the file at the time the object is created, plus
>>>> some internal components.  It is implemented as an environment so that
>>>> there can be multiple references to it.
>>>>
>>>> "srcref" is a reference to a particular range of characters (as the
>>>> parser sees them; I think that really means bytes, but I haven't tested
>>>> with MBCSs) in a source file.  It is implemented as a vector of 4
>>>> integers (first line, first column, last line, last column), with the
>>>> srcfile as an attribute.
>>>>
>>>> The parser attaches a srcref attribute to each complete statement as it
>>>> gets parsed, if option("useSource") is TRUE.  (I've left the old source
>>>> attribute in place as well for functions; I think it won't be needed in
>>>> the long run, but it is needed now.)
>>>>
>>>> When printing an object with a srcref attribute, print.default tries to
>>>> read the srcfile to obtain the text.  If it fails, it falls back to an
>>>> ugly display of the reference.  Using a new argument useSource=FALSE in
>>>> printing will stop this attempt:  when printing language, it will
>>>> deparse; when printing a srcref, it will print the ugly fallback.
>>>>
>>>> source(echo=T) will echo all the lines of the file including comments
>>>> and formatting.  demo() does the same, and I would guess Sweave will do
>>>> this too, but I haven't tested that yet.  I think this will improve
>>>> Sweave output, but will need changes to the input file:  people may have
>>>> comments there that they don't want shown.  Some sort of
>>>> "useSource=FALSE" option will need to be added.
>>>>
>>>> The browser used with debug() etc. will display statements as they were
>>>> formatted in the original source.  It will not display leading or
>>>> following comments, but will display embedded comments.
>>>>
>>>> Parsing errors display the name of the source file that was parsed, and
>>>> display verbose error messages describing what's wrong.  This display
>>>> could still be improved, e.g. by displaying the whole source line with a
>>>> pointer to the error, instead of just the text up to the location of the
>>>> error.
>>>>
>>>> I plan to add some sort of equivalent of C "#line" directives, so that
>>>> preprocessed source files (e.g. the concatenated source that is
>>>> installed) can include references back to the original source files, for
>>>> syntax error reporting, and/or debugging.  This will require
>>>> modification of the INSTALL process, but I haven't started on this yet.
>>>>
>>>> It would probably be a good idea to have some utility functions to play
>>>> with the srcref records for debugging and other purposes, but I haven't
>>>> written those yet.  For example, the current source record on a function
>>>> could be replaced with a srcref, but only by expanding the srcref to
>>>> include some of the surrounding comments.
>>>>
>>>> Comments and problem reports are welcome.
>>> I haven't tested this, but the idea seems useful. Will this have any
>>> effect on code parsed using parse(text = "...")? Can it be extended to
>>> have some such effect? I ask because this is relevant in the context
>>> of Sweave, where I have always wanted the ability to retain the
>>> original formatting. I'm currently testing a patch that allows me to
>>> do this specifically for Sweave, but a more general solution is
>>> obviously preferable.
>> I've just added the capability to Sweave.  I haven't committed yet,
>> because I think it's important that authors can choose whether or not to
>> turn this on.  Could you let me know your typical workflow with Sweave,
>> whether you'd like this to default to on or off, and where you'd expect
>> to change the default?
> 
> I would like it as an option to the RweaveLatex driver (and perhaps
> others). In terms of changing the API, this is as simple as adding an
> argument to the 'RweaveLatexSetup' function.
> 
> In the case of my patch, the default is off, and is turned on by
> 
> <<...,src=TRUE>>
> ...
> @
> 
> To make this the global default, one can do
> 
> \SweaveOpts{src=TRUE}
> 
> etc. (the name 'src' is not necessarily the best, some variant of
> 'keep.source' might be more intuitive.)

This is now committed.

I used keep.source, exactly the same as the option() that controls this 
behaviour in other places.

I decided to set the default to TRUE.  This means vignettes will all 
look different in R-devel.  The simplest way to get the previous 
appearance is to put in

\SweaveOpts{keep.source=FALSE}

but in most cases I think people will want the new behaviour.  It's only 
bad if the code was badly formatted or contained comments you don't want 
to show up in the final document.  I looked through the grid package 
vignettes, and only saw about half a dozen places where I thought the 
formatting needed tweaking.

Duncan Murdoch


From deepayan.sarkar at gmail.com  Sun Nov 26 09:02:02 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Sun, 26 Nov 2006 00:02:02 -0800
Subject: [Rd] Source references from the parser
In-Reply-To: <45692598.30606@stats.uwo.ca>
References: <456890A8.2060908@stats.uwo.ca>
	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>
	<456908D2.6080409@stats.uwo.ca>
	<eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>
	<45692598.30606@stats.uwo.ca>
Message-ID: <eb555e660611260002y40151472n3e9fae0eeb3b2c3f@mail.gmail.com>

On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 11/25/2006 11:00 PM, Deepayan Sarkar wrote:
> > On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> On 11/25/2006 3:12 PM, Deepayan Sarkar wrote:
> >>> On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >>>> I have just committed some changes to R-devel (which will become R 2.5.0
> >>>> next spring) to add source references to parsed R code.  Here's a
> >>>> description of the scheme:

[snipped]

> >>>> Comments and problem reports are welcome.
> >>> I haven't tested this, but the idea seems useful. Will this have any
> >>> effect on code parsed using parse(text = "...")? Can it be extended to
> >>> have some such effect? I ask because this is relevant in the context
> >>> of Sweave, where I have always wanted the ability to retain the
> >>> original formatting. I'm currently testing a patch that allows me to
> >>> do this specifically for Sweave, but a more general solution is
> >>> obviously preferable.
> >> I've just added the capability to Sweave.  I haven't committed yet,
> >> because I think it's important that authors can choose whether or not to
> >> turn this on.  Could you let me know your typical workflow with Sweave,
> >> whether you'd like this to default to on or off, and where you'd expect
> >> to change the default?
> >
> > I would like it as an option to the RweaveLatex driver (and perhaps
> > others). In terms of changing the API, this is as simple as adding an
> > argument to the 'RweaveLatexSetup' function.
> >
> > In the case of my patch, the default is off, and is turned on by
> >
> > <<...,src=TRUE>>
> > ...
> > @
> >
> > To make this the global default, one can do
> >
> > \SweaveOpts{src=TRUE}
> >
> > etc. (the name 'src' is not necessarily the best, some variant of
> > 'keep.source' might be more intuitive.)
>
> This is now committed.

Working great, thanks. The behaviour of comments is interesting (and
fortuitous for me), in that top level comments get associated with the
expression that follows it and comments at the end of a chunk are
ignored. Is this intended and can I expect it to remain unchanged? (My
chunks currently tend to end with a blank comment to work around a bug
in ESS, and I would rather not fix them all.)

> I used keep.source, exactly the same as the option() that controls this
> behaviour in other places.
>
> I decided to set the default to TRUE.  This means vignettes will all
> look different in R-devel.  The simplest way to get the previous
> appearance is to put in
>
> \SweaveOpts{keep.source=FALSE}
>
> but in most cases I think people will want the new behaviour.  It's only
> bad if the code was badly formatted or contained comments you don't want
> to show up in the final document.  I looked through the grid package
> vignettes, and only saw about half a dozen places where I thought the
> formatting needed tweaking.

Fine with me (although I suspect R's deparse will often produce more
readable code if the original wasn't written in an editor with smart
indentation).

-Deepayan


From murdoch at stats.uwo.ca  Sun Nov 26 12:30:06 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 26 Nov 2006 06:30:06 -0500
Subject: [Rd] Source references from the parser
In-Reply-To: <eb555e660611260002y40151472n3e9fae0eeb3b2c3f@mail.gmail.com>
References: <456890A8.2060908@stats.uwo.ca>	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>	<456908D2.6080409@stats.uwo.ca>	<eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>	<45692598.30606@stats.uwo.ca>
	<eb555e660611260002y40151472n3e9fae0eeb3b2c3f@mail.gmail.com>
Message-ID: <45697ABE.7070105@stats.uwo.ca>

On 11/26/2006 3:02 AM, Deepayan Sarkar wrote:
> On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 11/25/2006 11:00 PM, Deepayan Sarkar wrote:
>>> On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>> On 11/25/2006 3:12 PM, Deepayan Sarkar wrote:
>>>>> On 11/25/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>>>> I have just committed some changes to R-devel (which will become R 2.5.0
>>>>>> next spring) to add source references to parsed R code.  Here's a
>>>>>> description of the scheme:
> 
> [snipped]
> 
>>>>>> Comments and problem reports are welcome.
>>>>> I haven't tested this, but the idea seems useful. Will this have any
>>>>> effect on code parsed using parse(text = "...")? Can it be extended to
>>>>> have some such effect? I ask because this is relevant in the context
>>>>> of Sweave, where I have always wanted the ability to retain the
>>>>> original formatting. I'm currently testing a patch that allows me to
>>>>> do this specifically for Sweave, but a more general solution is
>>>>> obviously preferable.
>>>> I've just added the capability to Sweave.  I haven't committed yet,
>>>> because I think it's important that authors can choose whether or not to
>>>> turn this on.  Could you let me know your typical workflow with Sweave,
>>>> whether you'd like this to default to on or off, and where you'd expect
>>>> to change the default?
>>> I would like it as an option to the RweaveLatex driver (and perhaps
>>> others). In terms of changing the API, this is as simple as adding an
>>> argument to the 'RweaveLatexSetup' function.
>>>
>>> In the case of my patch, the default is off, and is turned on by
>>>
>>> <<...,src=TRUE>>
>>> ...
>>> @
>>>
>>> To make this the global default, one can do
>>>
>>> \SweaveOpts{src=TRUE}
>>>
>>> etc. (the name 'src' is not necessarily the best, some variant of
>>> 'keep.source' might be more intuitive.)
>> This is now committed.
> 
> Working great, thanks. The behaviour of comments is interesting (and
> fortuitous for me), in that top level comments get associated with the
> expression that follows it and comments at the end of a chunk are
> ignored. Is this intended and can I expect it to remain unchanged? (My
> chunks currently tend to end with a blank comment to work around a bug
> in ESS, and I would rather not fix them all.)

I'd say it's intentional but subject to change in the next few weeks, 
depending on the reaction to it.  It behaves the same when running 
examples in man pages.  As far as I know it suits the comment style used 
in the base packages well.  Since comments haven't been displayed in the 
past, I can't see how it would inconvenience anyone too much, but you 
never know...

browser() behaves differently during debugging:  there neither preceding 
nor following comments are shown.  My hope is that a source browser will 
be made easier by these source references, so I don't intend to change 
that.

Duncan Murdoch

> 
>> I used keep.source, exactly the same as the option() that controls this
>> behaviour in other places.
>>
>> I decided to set the default to TRUE.  This means vignettes will all
>> look different in R-devel.  The simplest way to get the previous
>> appearance is to put in
>>
>> \SweaveOpts{keep.source=FALSE}
>>
>> but in most cases I think people will want the new behaviour.  It's only
>> bad if the code was badly formatted or contained comments you don't want
>> to show up in the final document.  I looked through the grid package
>> vignettes, and only saw about half a dozen places where I thought the
>> formatting needed tweaking.
> 
> Fine with me (although I suspect R's deparse will often produce more
> readable code if the original wasn't written in an editor with smart
> indentation).


From alfilnegro.sv at gmail.com  Mon Nov 27 03:54:13 2006
From: alfilnegro.sv at gmail.com (Ricardo Rios)
Date: Sun, 26 Nov 2006 20:54:13 -0600
Subject: [Rd] Calling R function from C
Message-ID: <50a711930611261854q51ceffat30e1b42e2cbc4f5c@mail.gmail.com>

Hi wizards, I have the following function, I call  R function from C.
I execute this commands

> dyn.load("difficult.so");
> out <- .Call("difficult");
$mean
[1] 0.65

$median
[1] 0.65


However I would like to call difficult.R  but in C , how in the
following code:
> pch <- array(dim=c(2,1));
> pch[1] = 0.5;
> pch[2] = 0.8;
> out <- difficult(pch)$mean;

does somebody know how to do it ? Thanks in advance.



// C function
#include <Rdefines.h>
#include <Rinternals.h>
#include <stdlib.h>

SEXP difficult()
{
    SEXP fun, pch;
    SEXP e;
    SEXP value;

    PROTECT(e = allocVector(LANGSXP, 2));
    fun = findFun(install("difficult"), R_GlobalEnv);
    SETCAR(e, fun);
    pch = allocVector(REALSXP, 2);
    REAL(pch)[0] = 0.5;
    REAL(pch)[1] = 0.8;
    SETCADR(e, pch);
    value = eval(e, R_GlobalEnv);
    UNPROTECT(1);

	return (value);     	
}


difficult <- function(vector)
{
   mean <- mean(vector);
   median <- median(vector);

   return (list(mean=mean,median=median));
}




-- 
personal web site:
http://www.geocities.com/ricardo_rios_sv/index.html


From MOkoniewski at PICR.man.ac.uk  Mon Nov 27 12:10:17 2006
From: MOkoniewski at PICR.man.ac.uk (Michal Okoniewski)
Date: Mon, 27 Nov 2006 11:10:17 -0000
Subject: [Rd] Is there a version of RMySQL for Windows?
Message-ID: <BAA35444B19AD940997ED02A6996AAE0048D747F@sanmail.picr.man.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061127/97b5605b/attachment.pl 

From ripley at stats.ox.ac.uk  Mon Nov 27 12:46:08 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 27 Nov 2006 11:46:08 +0000 (GMT)
Subject: [Rd] Is there a version of RMySQL for Windows?
In-Reply-To: <BAA35444B19AD940997ED02A6996AAE0048D747F@sanmail.picr.man.ac.uk>
References: <BAA35444B19AD940997ED02A6996AAE0048D747F@sanmail.picr.man.ac.uk>
Message-ID: <Pine.LNX.4.64.0611271142380.25501@gannet.stats.ox.ac.uk>

On Mon, 27 Nov 2006, Michal Okoniewski wrote:

> I was trying to email directly the developer, David A. James, but all
> the emails bounce...
> Does anyone know if RMySQL  may be re-compiled under Windows
> and what are the limitations?

It may.  The limitations are that you need to make use of a closely 
matching MySQL to the one you compile the package against: we have in the 
past found even patchlevel differences led to crashes.

Are you using the current gmail address for David James?  He left Bell 
Labs a couple of months ago.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From xiao.gang.fan1 at free.fr  Mon Nov 27 14:08:25 2006
From: xiao.gang.fan1 at free.fr (xiao.gang.fan1 at free.fr)
Date: Mon, 27 Nov 2006 14:08:25 +0100 (CET)
Subject: [Rd] as.Date: conversion pb from POSIXct (PR#9386)
Message-ID: <20061127130825.0CDE33F043@slim.kubism.ku.dk>

Full_Name: Xiao Gang FAN
Version: 2.4.0
OS: Windows
Submission from: (NULL) (159.50.101.9)


> library(chron)
> as.Date(as.POSIXct(strptime("1994-01-24","%Y-%m-%d")))
[1] "1994-01-23"


From ggrothendieck at gmail.com  Mon Nov 27 14:21:03 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 27 Nov 2006 08:21:03 -0500
Subject: [Rd] as.Date: conversion pb from POSIXct (PR#9386)
In-Reply-To: <20061127130825.0CDE33F043@slim.kubism.ku.dk>
References: <20061127130825.0CDE33F043@slim.kubism.ku.dk>
Message-ID: <971536df0611270521x7d88dd0fg8bc0bc7e174edf80@mail.gmail.com>

as.Date is converting your object with respect to GMT time zone and in
that time zone your POSIXct date is the day before.  See ?as.Date and also
suggest you read R News 4/1 help desk article.


On 11/27/06, xiao.gang.fan1 at free.fr <xiao.gang.fan1 at free.fr> wrote:
> Full_Name: Xiao Gang FAN
> Version: 2.4.0
> OS: Windows
> Submission from: (NULL) (159.50.101.9)
>
>
> > library(chron)
> > as.Date(as.POSIXct(strptime("1994-01-24","%Y-%m-%d")))
> [1] "1994-01-23"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From rdpeng at gmail.com  Mon Nov 27 14:33:13 2006
From: rdpeng at gmail.com (Roger D. Peng)
Date: Mon, 27 Nov 2006 08:33:13 -0500
Subject: [Rd] Is there a version of RMySQL for Windows?
In-Reply-To: <BAA35444B19AD940997ED02A6996AAE0048D747F@sanmail.picr.man.ac.uk>
References: <BAA35444B19AD940997ED02A6996AAE0048D747F@sanmail.picr.man.ac.uk>
Message-ID: <456AE919.8070702@gmail.com>

There are some pre-built binaries here:

http://stat.bell-labs.com/RS-DBI/download/index.html

-roger

Michal Okoniewski wrote:
> I was trying to email directly the developer, David A. James, but all
> the emails bounce...
> Does anyone know if RMySQL  may be re-compiled under Windows
> and what are the limitations?
>  
> Cheers, 
> Michal
>  
> --------------------------------------------------------
> 
>  
> This email is confidential and intended solely for the use o...{{dropped}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From ripley at stats.ox.ac.uk  Mon Nov 27 14:46:12 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 27 Nov 2006 14:46:12 +0100 (CET)
Subject: [Rd] as.Date: conversion pb from POSIXct (PR#9386)
Message-ID: <20061127134612.0FDE55730D@slim.kubism.ku.dk>

You have not told us your timezone, but this seems to be as documented if 
you are in CET.  The help page says

      The 'as.Date' methods accept character strings, factors, logical
      'NA' and objects of classes '"POSIXlt"' and '"POSIXct"'.  (The
      last are converted to days by ignoring the time after midnight in
      the representation of the time in UTC.)
                                     ^^^^^^

Probably as.POSIXct(strptime("1994-01-24","%Y-%m-%d") is 1994-01-23 23:00 
in UTC in your timezone.

On Mon, 27 Nov 2006, xiao.gang.fan1 at free.fr wrote:

> Full_Name: Xiao Gang FAN
> Version: 2.4.0
> OS: Windows
> Submission from: (NULL) (159.50.101.9)
>
>
>> library(chron)

Irrelevant.

>> as.Date(as.POSIXct(strptime("1994-01-24","%Y-%m-%d")))
> [1] "1994-01-23"

Not in my timezone.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From xiao.gang.fan1 at libertysurf.fr  Mon Nov 27 17:32:15 2006
From: xiao.gang.fan1 at libertysurf.fr (xiao.gang.fan1 at libertysurf.fr)
Date: Mon, 27 Nov 2006 17:32:15 +0100 (CET)
Subject: [Rd] package tseries: plot.irts() - time axis label pb (PR#9387)
Message-ID: <20061127163215.288DA57311@slim.kubism.ku.dk>

Full_Name: Xiao Gang FAN
Version: 2.4.0
OS: Windows
Submission from: (NULL) (159.50.101.9)


> library(tseries)
> plot(irts(seq(as.POSIXct("1991-01-01"), by="month", length=100),rnorm(100)))

in the x-axix, the label is "Jan 01, Jan 01, Jan 01, ...."

version of tseries: 0.10-7
Date: 2006-10-04
Built: R 2.4.0; i386-pc-mingw32; 2006-10-05 09:46:32; windows
also tried on other versions on CRAN, same pb


From box at dupuislogiciels.com  Mon Nov 27 19:22:41 2006
From: box at dupuislogiciels.com (box at dupuislogiciels.com)
Date: Mon, 27 Nov 2006 19:22:41 +0100
Subject: [Rd] R.DLL mapping by P/Invoke
Message-ID: <courier.456B2CF1.00007A11@wormhole.dupuislogiciels.com>

After a long processing, I was able to create a version of a small C# class 
that was able to emulate the rproxy by P/Invoke. This is mostly to find a 
workaround a performance problem of the StatConnector. 

It's almost work but ... I have strange memory exception when I call the 
print function. The variable seems to not survive from one call to the 
other. 

As there is no debug symbol for the R.DLL (and I don't want to spend my 
youth on the disassembly window of VS), I put there the result of my search. 
If some of you can find the reason of the crash, I will be extremely happy! 

Here is a sample program.cs to invoke the DLL (and crash) : 

using System;
using System.Collections;
using System.Text; 

namespace SharpR
{
   class Program
   {
       static void Main(string[] args)
       {
           RWrapper.EvaluateNoReturn("print(\"Boom!\")");
       }
   }
} 


-------------- next part --------------
#define SUPERCONSOLE

using System;
using System.Collections;
using System.Runtime.InteropServices;
using System.Text;
using Microsoft.Win32;

namespace SharpR
{
    /// <summary>
    /// Class for interp with the R.DLL. All is static as R is mono-threaded.
    /// </summary>
    class RWrapper
    {
        #region <R.DLL interop signatures>
        //- DLL Management/Information
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        [return: MarshalAs(UnmanagedType.LPStr)]
        static extern string getDLLVersion();
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        [return: MarshalAs(UnmanagedType.LPStr)]
        static extern string get_R_HOME();
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        [return: MarshalAs(UnmanagedType.LPStr)]
        static extern string getRUser();

        //- R Start Up
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void R_setStartTime();
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void R_DefParams(ref RStartStruct @params);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void R_SetParams(ref RStartStruct @params);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void R_set_command_line_arguments(int argc, string[] args);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern int GA_initapp(int argc, string[] args);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void readconsolecfg();
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void setup_Rmainloop();
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void R_ReplDLLinit();
        
        //- R SEXP management
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern IntPtr Rf_mkString(string toConvert);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern IntPtr Rf_protect(IntPtr ptr);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void Rf_unprotect(int l);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void Rf_unprotect_ptr(IntPtr ptr);

        //- R Parser/Eval
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern IntPtr R_ParseVector(IntPtr str, int x, out RParseStatus result);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern IntPtr R_tryEval(IntPtr exp, IntPtr env, out int evalError);
        
        //- R Symbols
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern IntPtr Rf_install(string name);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern IntPtr Rf_findVar(IntPtr symbol, IntPtr env);
        [DllImport("R.DLL", /*CallingConvention = CallingConvention.Cdecl,*/ CharSet = CharSet.Ansi)]
        static extern void Rf_setVar(IntPtr symbol, IntPtr value, IntPtr env);

        #endregion

        #region <R.DLL interop types>
        enum RParseStatus
        {
            PARSE_NULL,
            PARSE_OK,
            PARSE_INCOMPLETE,
            PARSE_ERROR,
            PARSE_EOF
        };        
        
        enum SaType
        {
            SA_NORESTORE = 0,/* = 0 */
            SA_RESTORE,
            SA_DEFAULT,/* was === SA_RESTORE */
            SA_NOSAVE,
            SA_SAVE,
            SA_SAVEASK,
            SA_SUICIDE
        };
        enum RBool
        {
            RFalse = 0,
            RTrue
        };
        enum RYesNoCancel
        {
            Yes = 1,
            No = -1,
            Cancel = 0
        };
        enum RUIMode
        {
            RGui = 0, RTerm, LinkDLL
        };
        [StructLayout(LayoutKind.Sequential)]
        struct RStartStruct
        {
            public RBool R_Quiet;
            public RBool R_Slave;
            public RBool R_Interactive;
            public RBool R_Verbose;
            public RBool LoadSiteFile;
            public RBool LoadInitFile;
            public RBool DebugInitFile;
            public SaType RestoreAction;
            public SaType SaveAction;
            public uint vsize;
            public uint nsize;
            public uint max_vsize;
            public uint max_nsize;
            public uint ppsize;
            public int NoRenviron;
            //!! Warning - R will keep theses pointers. See gnuwin32\system.c (line 638)
            public IntPtr home;
            public IntPtr rhome;
            //!!
            [MarshalAs(UnmanagedType.FunctionPtr)]
            public dgReadConsole readConsole;
            [MarshalAs(UnmanagedType.FunctionPtr)]
            public dgWriteConsole writeConsole;
            [MarshalAs(UnmanagedType.FunctionPtr)]
            public dgCallback callback;
            [MarshalAs(UnmanagedType.FunctionPtr)]
            public dgShowMessage showMessage;
            [MarshalAs(UnmanagedType.FunctionPtr)]
            public dgYesNoCancel yesNoCancel;
            [MarshalAs(UnmanagedType.FunctionPtr)]
            public dgBusy busy;
            public RUIMode characterMode;
        };

        //[UnmanagedFunctionPointer(CallingConvention.Cdecl)] < .Net 2.0
        delegate int dgReadConsole(
            [MarshalAs(UnmanagedType.LPStr)]string prompt,
           IntPtr buf, int len,
           int addtohistory
        );
        //[UnmanagedFunctionPointer(CallingConvention.Cdecl)] < .Net 2.0
        delegate void dgWriteConsole(
            [MarshalAs(UnmanagedType.LPStr,SizeParamIndex = 1)]
            string buf, int len);
        //[UnmanagedFunctionPointer(CallingConvention.Cdecl)] < .Net 2.0
        delegate void dgCallback();
        //[UnmanagedFunctionPointer(CallingConvention.Cdecl)] < .Net 2.0
        delegate void dgShowMessage(string msg);
        //[UnmanagedFunctionPointer(CallingConvention.Cdecl)] < .Net 2.0
        [return: MarshalAs(UnmanagedType.I4)]
        delegate RYesNoCancel dgYesNoCancel(string msg);
        //[UnmanagedFunctionPointer(CallingConvention.Cdecl)] < .Net 2.0
        delegate void dgBusy(int which);        
        
        #endregion

        #region <BDX Interops frm RPROXY.DLL>
  /*      const string strBdxGetObject = "BDX_get_vtbl at 8";

        /// <summary>
        /// PInvoke with automatic marshal on GetProcAddress to return dgScProxyGetObject function
        /// </summary>
        /// <param name="hModule">HMODULE of the RPROXY.DLL</param>
        /// <param name="procName">*MUST* be strScProxyGetObject</param>
        /// <returns></returns>
        [DllImport("kernel32.dll", CharSet = CharSet.Ansi, EntryPoint = "GetProcAddress")]
        [return: MarshalAs(UnmanagedType.FunctionPtr)]
        static extern dgBdxGetObject GetPABdxGetObject(IntPtr hModule, string procName);

        delegate int dgBdxGetObject(out IntPtr vtable, uint value);

        delegate void BdxFree(IntPtr bdx);
        delegate void BdxTrace(IntPtr bdx);
        delegate int BdxVariant2BDX([MarshalAs(UnmanagedType.Struct)]object var, out IntPtr bdx);
        delegate int BdxBDX2Variant(IntPtr bdx, [MarshalAs(UnmanagedType.Struct)]out object var);

        [StructLayout(LayoutKind.Sequential)]
        struct RBdxVtable
        {
            public BdxFree free;
            public BdxTrace trace;
            public BdxVariant2BDX v2bdx;
            public BdxBDX2Variant bdx2v;
        } */

        [DllImport("Rproxy.DLL", CallingConvention = CallingConvention.Cdecl)]
        static extern int BDX2SEXP(IntPtr pBDXData, out IntPtr pSEXPData);
        [DllImport("Rproxy.dll", CallingConvention = CallingConvention.Cdecl)]
        static extern int SEXP2BDX(IntPtr pSexp, out IntPtr ppBDXData);
        [DllImport("Rproxy.dll", EntryPoint = "Variant2BDX at 20")]
        static extern int Variant2BDX([MarshalAs(UnmanagedType.Struct)]object var, out IntPtr bdx);
        [DllImport("Rproxy.dll", EntryPoint = "BDX2Variant at 8")]
        static extern int BDX2Variant(IntPtr bdx,[MarshalAs(UnmanagedType.Struct)]out object var);
        [DllImport("Rproxy.dll", EntryPoint = "bdx_free at 4")]
        static extern void bdx_free(IntPtr bdx);
        #endregion


        #region <Win32 interop signatures>
        [DllImport("kernel32.dll")]
        static extern IntPtr LoadLibrary(string lpFileName);
        [DllImport("kernel32.dll", CharSet = CharSet.Ansi, ExactSpelling = true)]
        public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);
        #endregion

        static string sg_dllVersion,sg_RHome,sg_RUsersHome;
        static IntPtr sg_hModR;
        static IntPtr sg_hModRProxy;
        static StringBuilder sg_ConsoleOutput;

        static IntPtr sg_rDll_R_GlobalEnvPtr, sg_rDll_R_UserBreakPtr;
        static IntPtr sg_rDll_R_UnboundValue;

        static GCHandle[] sg_lockDelegates;

        static RWrapper()
        {
            try {
            //- Get the active DLL path from the registry
            string dllPath = Convert.ToString(
                Registry.LocalMachine.OpenSubKey("Software\\R-core\\R", false).GetValue("InstallPath")
             );
            //- Fix the process PATH
            Environment.SetEnvironmentVariable("PATH",
                dllPath + "\\bin;" + Environment.GetEnvironmentVariable("PATH"),
                EnvironmentVariableTarget.Process
            );
            
            //- Load the R.DLL module into the process
            sg_hModR = LoadLibrary(dllPath + "\\bin\\R.dll");
            if (sg_hModR == IntPtr.Zero) throw new Exception("Unable to load R.DLL");
            //- Load the Rproxy.DLL module into the process
            sg_hModRProxy = LoadLibrary(dllPath + "\\bin\\Rproxy.dll");
            if (sg_hModRProxy == IntPtr.Zero) throw new Exception("Unable to load R.DLL");
            
            //- Read the DLL version by Interop
            sg_dllVersion = getDLLVersion();

            //- Get important R global variable pointers from GetProcAddress
            sg_rDll_R_GlobalEnvPtr = GetProcAddress(sg_hModR, "R_GlobalEnv");
            sg_rDll_R_UserBreakPtr = GetProcAddress(sg_hModR, "UserBreak");
            sg_rDll_R_UnboundValue = GetProcAddress(sg_hModR, "R_UnboundValue");

            //- Output DLL
            sg_ConsoleOutput = new StringBuilder();
            
            //- Let's start R
            RStartStruct start = new RStartStruct();

            //- Get Defaults
            R_setStartTime();
            R_DefParams(ref start);

            sg_RHome = get_R_HOME();
            sg_RUsersHome = getRUser();

            //- Inject R Home
            start.home = Marshal.StringToHGlobalAnsi(sg_RHome);
            start.rhome = Marshal.StringToHGlobalAnsi(sg_RUsersHome);

            //- Setup R in embedded/batch mode
            start.characterMode = RUIMode.LinkDLL;
            start.R_Quiet = RBool.RTrue;
            start.R_Interactive = RBool.RTrue;
            start.RestoreAction = SaType.SA_RESTORE;
            start.SaveAction = SaType.SA_NOSAVE;

            //- Setup the callbacks
            start.readConsole = new dgReadConsole(cbReadConsole);
            start.writeConsole = new dgWriteConsole(cbWriteConsole);
            start.busy = new dgBusy(cbBusy);
            start.callback = new dgCallback(cbCallback);
            start.showMessage = new dgShowMessage(cbShowMessage);
            start.yesNoCancel = new dgYesNoCancel(cbYesNoCancel);

            sg_lockDelegates = new GCHandle[7];
            sg_lockDelegates[0] = GCHandle.Alloc(start.readConsole);
            sg_lockDelegates[1] = GCHandle.Alloc(start.writeConsole);
            sg_lockDelegates[2] = GCHandle.Alloc(start.busy);
            sg_lockDelegates[3] = GCHandle.Alloc(start.callback);
            sg_lockDelegates[4] = GCHandle.Alloc(start.showMessage);
            sg_lockDelegates[5] = GCHandle.Alloc(start.yesNoCancel);
            sg_lockDelegates[6] = GCHandle.Alloc(start);
                
            //- Gentleman start your engines !
            R_SetParams(ref start);
            R_set_command_line_arguments(0, new string[] { });
            GA_initapp(0, new string[] { });
            readconsolecfg();
            setup_Rmainloop();
            R_ReplDLLinit();
        } catch(Exception e)
        {
            throw;
        }
        }
        private RWrapper() {}
        
        static int UserBreak
        {
            get
            {
                return Marshal.ReadInt32(sg_rDll_R_UserBreakPtr);
            }
            set
            {
                Marshal.WriteInt32(sg_rDll_R_UserBreakPtr,value);
            }
        }

        static public string RDllVersion { get { return sg_dllVersion; } }
        static public string RHome { get { return sg_RHome; } }
        static public string RUsersHome { get { return sg_RUsersHome; } }

        #region <R Callbacks>
        static int cbReadConsole(string prompt, IntPtr buf, int len, int addtohistory)
        {
            //- We don't use the console to interact with R. The function returns 0
            //  to force R exiting any event loop.
            return 0;
        }

        static void cbWriteConsole(string buf, int len)
        {
           sg_ConsoleOutput.Append(buf);
#if SUPERCONSOLE            
            ConsoleColor c = Console.ForegroundColor;
            Console.ForegroundColor = ConsoleColor.Green;
            Console.Write(buf);
            Console.ForegroundColor = c;
#endif
        }

        static void cbCallback() { /*NoOp*/ }

        static void cbBusy(int which)
        {
#if SUPERCONSOLE            
            int top = Console.CursorTop, left = Console.CursorLeft;
            Console.CursorTop = Console.CursorLeft = 0;
            Console.Write("Busy : {0}", which);
            Console.CursorTop = top; Console.CursorLeft = left;
#endif
        }

        static void cbShowMessage(string msg)
        {
            Console.WriteLine("Message : " + msg);
        }

        static RYesNoCancel cbYesNoCancel(string msg)
        {
            Console.WriteLine("YesNoCancel : " + msg);
            return RYesNoCancel.Cancel;
        }
        #endregion
        
        static IntPtr GetCurrentEnv()
        {
            IntPtr ret =  Marshal.ReadIntPtr(sg_rDll_R_GlobalEnvPtr);
            return ret;
        }
        
        static bool IsUnbound(IntPtr Sexp)
        {
            IntPtr unbound = Marshal.ReadIntPtr(sg_rDll_R_UnboundValue);
            return Sexp == unbound;
        }
        
        static public void EvaluateNoReturn(string statement)
        {
            //- Parse the expresion
            RParseStatus status;
            IntPtr lSexpVect = R_ParseVector(Rf_mkString(statement), 1, out status);
            if(status!=RParseStatus.PARSE_OK)
            {
                throw new Exception("R Parse Error : " + status.ToString());
            }

            Rf_protect(lSexpVect);
            // lSexpVect is a vector of lSexp. We need to read the memory directly to get
            // the lSexp
            int evalError;
            IntPtr lSexp = Marshal.ReadIntPtr(lSexpVect, 24);
            R_tryEval(lSexp, IntPtr.Zero, out evalError);
            Rf_unprotect(1);

            if (evalError != 0) throw new Exception("R Eval Error : " + evalError.ToString());
        }
        
        static public object Evaluate(string statement)
        {
            //- Parse the expresion
            RParseStatus status;
            IntPtr lSexpVect = R_ParseVector(Rf_mkString(statement), 1, out status);
            if (status != RParseStatus.PARSE_OK)
            {
                throw new Exception("R Parse Error : " + status.ToString());
            }

            Rf_protect(lSexpVect);
            // lSexpVect is a vector of lSexp. We need to read the memory directly to get
            // the lSexp
            int evalError;
            IntPtr lSexp = Marshal.ReadIntPtr(lSexpVect, 24);
            Rf_protect(lSexp);
            IntPtr lresult = R_tryEval(lSexp, GetCurrentEnv(), out evalError);
            Rf_unprotect(1);

            if (evalError != 0) throw new Exception("R Eval Error : " + evalError.ToString());

            IntPtr bdxResult;
            object result;
            evalError = SEXP2BDX(lresult, out bdxResult);
            evalError = BDX2Variant(bdxResult, out result);
            bdx_free(bdxResult);

            return result;
        }        
        
        static public object GetSymbol(string name)
        {
            IntPtr lsValue = Rf_findVar(Rf_install(name), GetCurrentEnv());
            if (IsUnbound(lsValue))
            {
                throw new Exception(name + " is an unbound value");
            }
            
            IntPtr bdxResult;
            object result;
            int evalError = SEXP2BDX(lsValue, out bdxResult);
            evalError = BDX2Variant(bdxResult, out result);
            bdx_free(bdxResult);

            return result;
        }
        
        static public void SetSymbol(string name,object value)
        {
            IntPtr bdxData, sexpData;
            int evalError = Variant2BDX(value, out bdxData);
            evalError = BDX2SEXP(bdxData, out sexpData);
            bdx_free(bdxData);
            
            IntPtr lsSymbol = Rf_install(name);
            Rf_setVar(lsSymbol, sexpData, GetCurrentEnv());
        }
        
        static public string CollectConsole()
        {
            string ret = sg_ConsoleOutput.ToString();
            sg_ConsoleOutput = new StringBuilder();
            return ret;
        }
        
    }
}

From mli at emmes.com  Mon Nov 27 19:25:41 2006
From: mli at emmes.com (mli at emmes.com)
Date: Mon, 27 Nov 2006 19:25:41 +0100 (CET)
Subject: [Rd] write.matrix error (PR#9388)
Message-ID: <20061127182541.5F5484BEC2@slim.kubism.ku.dk>

Full_Name: Ming-Chung Li
Version: 2.4.0
OS: windows xp
Submission from: (NULL) (65.125.12.222)


Hi,

My pc has 1gb physical ram and 1.5gb virtual memory. The write.matrix() function
in MASS library gives an error when I try it to output a large matrix to a file.
Please see the follwing code to reproduce the problem. The problem also happends
in R 2.3.1 too. The write.table() does not have any error. Thanks, 

Ming-Chung

> x <- matrix(rnorm(100000*300), 100000, 300)
> library(MASS)
> gc()
           used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells   247519   6.7     467875  12.5   453068  12.1
Vcells 30107442 229.8   90360081 689.4 90227465 688.4
> write.matrix(x, file = "c:/temp/temp.txt")
Error in .Call("R_lazyLoadDBfetch", key, file, compressed, hook, PACKAGE =
"base
") :
        recursive default argument reference
>


From mrufino at cripsul.ipimar.pt  Mon Nov 27 19:27:32 2006
From: mrufino at cripsul.ipimar.pt (mrufino at cripsul.ipimar.pt)
Date: Mon, 27 Nov 2006 19:27:32 +0100 (CET)
Subject: [Rd] error in xYplot from Hmisc. (PR#9389)
Message-ID: <20061127182732.6D3A14BEC2@slim.kubism.ku.dk>

Hello,

I was simply doing a graph, but an error repeatdly occurs. Any idea why?
(this only happens in the latest R version, I am a windows user).

Thank you,
Marta


library(Hmisc)
> example(xYplot)

xYplot> d <- expand.grid(x = seq(0, 2 * pi, length = 150),
    p = 1:3, shift = c(0, pi))

xYplot> xYplot(sin(x + shift)^p ~ x | shift, groups = p, data = d,
    type = "l")
Loading required package: grid
Error in xyplot.formula(formula = sin(x + shift)^p ~ x | shift, data =
list( :
        argument "x" is missing, with no default
>


From deepayan.sarkar at gmail.com  Mon Nov 27 20:07:53 2006
From: deepayan.sarkar at gmail.com (deepayan.sarkar at gmail.com)
Date: Mon, 27 Nov 2006 20:07:53 +0100 (CET)
Subject: [Rd] error in xYplot from Hmisc. (PR#9389)
Message-ID: <20061127190753.C97613F006@slim.kubism.ku.dk>

On 11/27/06, mrufino at cripsul.ipimar.pt <mrufino at cripsul.ipimar.pt> wrote:
> Hello,
>
> I was simply doing a graph, but an error repeatdly occurs. Any idea why?
> (this only happens in the latest R version, I am a windows user).

What version is that exactly? Please give the output of sessionInfo(),
since "the latest R version" means different things to different
people.

> Thank you,
> Marta
>
>
> library(Hmisc)
> > example(xYplot)
>
> xYplot> d <- expand.grid(x = seq(0, 2 * pi, length = 150),
>     p = 1:3, shift = c(0, pi))
>
> xYplot> xYplot(sin(x + shift)^p ~ x | shift, groups = p, data = d,
>     type = "l")
> Loading required package: grid
> Error in xyplot.formula(formula = sin(x + shift)^p ~ x | shift, data =
> list( :
>         argument "x" is missing, with no default

And what made you come to the conclusion that this is a bug in R?

In this case, I'm pretty sure your version of Hmisc is an old one. Run
update.packages() and try again.

-Deepayan


From sfalcon at fhcrc.org  Tue Nov 28 01:56:30 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Mon, 27 Nov 2006 16:56:30 -0800
Subject: [Rd] Source references from the parser
In-Reply-To: <45692598.30606@stats.uwo.ca> (Duncan Murdoch's message of "Sun,
	26 Nov 2006 00:26:48 -0500")
References: <456890A8.2060908@stats.uwo.ca>
	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>
	<456908D2.6080409@stats.uwo.ca>
	<eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>
	<45692598.30606@stats.uwo.ca>
Message-ID: <m2ejro4ce9.fsf@ziti.fhcrc.org>

Hi Duncan, all,

Duncan Murdoch <murdoch at stats.uwo.ca> writes:
> This is now committed.
>
> I used keep.source, exactly the same as the option() that controls this 
> behaviour in other places.
>
> I decided to set the default to TRUE.  This means vignettes will all 
> look different in R-devel.  

I'd really like the default to be FALSE, at least for the upcoming
release.  As you note, the change will cause vignettes to look
different.  There are over 260 vignettes in the BioC source tree and
given that most developers have little extra time, I would rather they
not have to review these docs because of this change.

> The simplest way to get the previous 
> appearance is to put in
>
> \SweaveOpts{keep.source=FALSE}
>
> but in most cases I think people will want the new behaviour.  It's only 
> bad if the code was badly formatted or contained comments you don't want 
> to show up in the final document.

I'm glad the feature is there, I think it is desirable.  I hope to
turn this option on when I write new documents ;-)

+ seth


From murdoch at stats.uwo.ca  Tue Nov 28 04:52:04 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 27 Nov 2006 22:52:04 -0500
Subject: [Rd] Source references from the parser
In-Reply-To: <m2ejro4ce9.fsf@ziti.fhcrc.org>
References: <456890A8.2060908@stats.uwo.ca>	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>	<456908D2.6080409@stats.uwo.ca>	<eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>	<45692598.30606@stats.uwo.ca>
	<m2ejro4ce9.fsf@ziti.fhcrc.org>
Message-ID: <456BB264.7090605@stats.uwo.ca>

On 11/27/2006 7:56 PM, Seth Falcon wrote:
> Hi Duncan, all,
> 
> Duncan Murdoch <murdoch at stats.uwo.ca> writes:
>> This is now committed.
>>
>> I used keep.source, exactly the same as the option() that controls this 
>> behaviour in other places.
>>
>> I decided to set the default to TRUE.  This means vignettes will all 
>> look different in R-devel.  
> 
> I'd really like the default to be FALSE, at least for the upcoming
> release.  As you note, the change will cause vignettes to look
> different.  There are over 260 vignettes in the BioC source tree and
> given that most developers have little extra time, I would rather they
> not have to review these docs because of this change.

The next release hasn't been scheduled, but it's likely to be 2.4.1, 
sometime in December.  These changes won't be in that release.  They're 
in R-devel, which will become 2.5.0 sometime in April.

I'd rather leave the default as TRUE for now, and make a final decision 
on it sometime near when the alpha test period starts in February or 
early March.  If the default is set to FALSE now, then it won't get 
tested, and I'd much rather hear about bugs in the implementation before 
release, rather than after.

I'd also like to know if the \SweaveOpts line below fails on any 
systems, and whether there's an easier way to turn the option off. 
(I've tested it in R 2.4.0 patched, but not in older systems.)  If it is 
compatible with all old versions, then a sed script to insert it into 
all 260 of your vignettes would be pretty easy to write; the main cost 
would then be to replace the current package versions with new versions 
containing this change.  How many packages are we talking about, that 
wouldn't otherwise be updated before April?

My inclination would be to default to TRUE in the long term, on the 
basis that doing nothing to the user's code should be the default, 
rather than the option.  The fact that this changes the look of 
documents from existing packages is obviously an argument in favour of a 
FALSE default.  So the final decision hasn't been made yet.


>> The simplest way to get the previous 
>> appearance is to put in
>>
>> \SweaveOpts{keep.source=FALSE}
>>
>> but in most cases I think people will want the new behaviour.  It's only 
>> bad if the code was badly formatted or contained comments you don't want 
>> to show up in the final document.
> 
> I'm glad the feature is there, I think it is desirable.  I hope to
> turn this option on when I write new documents ;-)

Duncan Murdoch


From ggrothendieck at gmail.com  Tue Nov 28 05:02:15 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 27 Nov 2006 23:02:15 -0500
Subject: [Rd] package tseries: plot.irts() - time axis label pb (PR#9387)
In-Reply-To: <20061127163215.288DA57311@slim.kubism.ku.dk>
References: <20061127163215.288DA57311@slim.kubism.ku.dk>
Message-ID: <971536df0611272002r674ab537u6bf87085be910191@mail.gmail.com>

When I try it with R
"R version 2.4.0 Patched (2006-10-24 r39722)"
on Windows XP and the same version of tseries as yours I get
tick marks labelled 1992, 1994, 1996, 1998.

Try it again with a later version of R.

On 11/27/06, xiao.gang.fan1 at libertysurf.fr
<xiao.gang.fan1 at libertysurf.fr> wrote:
> Full_Name: Xiao Gang FAN
> Version: 2.4.0
> OS: Windows
> Submission from: (NULL) (159.50.101.9)
>
>
> > library(tseries)
> > plot(irts(seq(as.POSIXct("1991-01-01"), by="month", length=100),rnorm(100)))
>
> in the x-axix, the label is "Jan 01, Jan 01, Jan 01, ...."
>
> version of tseries: 0.10-7
> Date: 2006-10-04
> Built: R 2.4.0; i386-pc-mingw32; 2006-10-05 09:46:32; windows
> also tried on other versions on CRAN, same pb
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From erkan77 at gmail.com  Tue Nov 28 12:08:59 2006
From: erkan77 at gmail.com (erkan77 at gmail.com)
Date: Tue, 28 Nov 2006 12:08:59 +0100 (CET)
Subject: [Rd] when loading library tripack entry point "signal" in rgui.exe
	not found (PR#9390)
Message-ID: <20061128110859.0DECE3F006@slim.kubism.ku.dk>

Full_Name: Erkan YILMAZ
Version: 2.4.0
OS: XP
Submission from: (NULL) (85.180.116.228)


Hi,

just installed R 2.4.0 (before there was running 2.2.0).

when loading the library ("library(tripack)"), there appears a pop up, see
following picture:
http://www.skilledtester.de/R/r240_tripack.JPG

-> the entry point "signal" in rgui.exe is not found

in R itself following error is displayed:
Fehler in dyn.load(x, as.logical(local), as.logical(now)) : 
        kann shared library
'I:/PROGRAMME/R_erkan/R-2.4.0/library/tripack/libs/tripack.dll' nicht laden:
 LoadLibrary failure:  Die angegebene Prozedur wurde nicht gefunden.

Fehler in library(tripack) : .First.lib fehlgeschlagen f?r 'tripack'



can somebody help me?

Bye,
Erkan YILMAZ


From erkan77 at gmail.com  Tue Nov 28 12:30:10 2006
From: erkan77 at gmail.com (erkan77 at gmail.com)
Date: Tue, 28 Nov 2006 12:30:10 +0100 (CET)
Subject: [Rd] addition to R-bug (PR#9391)
Message-ID: <20061128113010.BC74E57334@slim.kubism.ku.dk>

Hi,

I created before a bug-entry:
http://bugs.r-project.org/cgi-bin/R/incoming?id=3D9390;expression=3Derkan;u=
ser=3Dguest


here is an addition which I can not add because the interface won't let me:
more info:

tripack_1.2-10.zip:
file version of tripack.dll: 2.10.50418.0

before installing tripack, I installed following packages:
ncf_1.0-8.zip
spdep_0.3-32.zip




original report:
Hi,

just installed R 2.4.0 (before there was running 2.2.0).

when loading the library ("library(tripack)"), there appears a pop up, see
following picture:
http://www.skilledtester.de/R/r240_tripack.JPG

-> the entry point "signal" in rgui.exe is not found

in R itself following error is displayed:
Fehler in dyn.load(x, as.logical(local), as.logical(now)) :
        kann shared library
'I:/PROGRAMME/R_erkan/R-2.4.0/library/tripack/libs/tripack.dll'
nicht laden:
 LoadLibrary failure:  Die angegebene Prozedur wurde nicht gefunden.

Fehler in library(tripack) : .First.lib fehlgeschlagen f=FCr 'tripack'



can somebody help me?

Bye,
Erkan YILMAZ

	[[alternative HTML version deleted]]


From ripley at stats.ox.ac.uk  Tue Nov 28 13:03:47 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 28 Nov 2006 13:03:47 +0100 (CET)
Subject: [Rd] (PR#9390) when loading library tripack entry point "signal"
Message-ID: <20061128120347.F2D8A572B0@slim.kubism.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-1968795515-1164715405=:5670
Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

You need to re-install packages when you update R, as it says in the 
rw-FAQ.  Use update.packages(checkBuilt=TRUE) to do so.

And PLEASE do read the FAQ and not misuse R-bugs to ask questions about 
things in FAQs


On Tue, 28 Nov 2006, erkan77 at gmail.com wrote:

> Full_Name: Erkan YILMAZ
> Version: 2.4.0
> OS: XP
> Submission from: (NULL) (85.180.116.228)
>
>
> Hi,
>
> just installed R 2.4.0 (before there was running 2.2.0).
>
> when loading the library ("library(tripack)"), there appears a pop up, see
> following picture:
> http://www.skilledtester.de/R/r240_tripack.JPG
>
> -> the entry point "signal" in rgui.exe is not found
>
> in R itself following error is displayed:
> Fehler in dyn.load(x, as.logical(local), as.logical(now)) :
>        kann shared library
> 'I:/PROGRAMME/R_erkan/R-2.4.0/library/tripack/libs/tripack.dll' nicht laden:
> LoadLibrary failure:  Die angegebene Prozedur wurde nicht gefunden.
>
> Fehler in library(tripack) : .First.lib fehlgeschlagen f?r 'tripack'
>
>
>
> can somebody help me?
>
> Bye,
> Erkan YILMAZ
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-1968795515-1164715405=:5670--


From ripley at stats.ox.ac.uk  Tue Nov 28 13:38:24 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 28 Nov 2006 13:38:24 +0100 (CET)
Subject: [Rd] (PR#9390) when loading library tripack entry point "signal"
Message-ID: <20061128123824.F18DB57325@slim.kubism.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-1814661816-1164717477=:6146
Content-Type: TEXT/PLAIN; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

This is definitely not reproducible with the tripack.zip on CRAN for R 
2.4.0:

pedump -i tripack.dll

...
imports from msvcrt.dll:
         __dllonexit (36) (thunk:0x16128)
         __mb_cur_max (48) (thunk:0x1612c)
         _assert (111) (thunk:0x16130)
         _chsize (128) (thunk:0x16134)
         _errno (152) (thunk:0x16138)
         _flsbuf (183) (thunk:0x1613c)
         _iob (233) (thunk:0x16140)
         _isctype (235) (thunk:0x16144)
         _pctype (359) (thunk:0x16148)
         abort (533) (thunk:0x1614c)
         atoi (542) (thunk:0x16150)
         exit (554) (thunk:0x16154)
         fclose (557) (thunk:0x16158)
         fflush (560) (thunk:0x1615c)
         fopen (568) (thunk:0x16160)
         fprintf (569) (thunk:0x16164)
         fputs (571) (thunk:0x16168)
         free (575) (thunk:0x1616c)
         freopen (576) (thunk:0x16170)
         fseek (579) (thunk:0x16174)
         ftell (581) (thunk:0x16178)
         fwrite (583) (thunk:0x1617c)
         malloc (626) (thunk:0x16180)
         memset (634) (thunk:0x16184)
         perror (637) (thunk:0x16188)
         remove (649) (thunk:0x1618c)
         signal (656) (thunk:0x16190)
         sprintf (659) (thunk:0x16194)
         strcpy (667) (thunk:0x16198)
         strlen (671) (thunk:0x1619c)
         strncmp (673) (thunk:0x161a0)

so the error is somewhere in your own system.  There is no bug in R here.


On Tue, 28 Nov 2006, Erkan Yilmaz wrote:

> Dear Mr. Ripley,

Sic!

> thank you for your fast feedback.
>
> Unfortunately the update did not help either. I will attach the commands
> from RGui.

Nothing was attached.

> info: I install the R always in different directories (e.g. R 2.2.0 in
> ...\R2.2.0 and R 2.4.0 in ...\R2.4.0), so I think the packages are always
> new.
>
>
> R version 2.4.0 (2006-10-03)
> Copyright (C) 2006 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R ist freie Software und kommt OHNE JEGLICHE GARANTIE.
> Sie sind eingeladen, es unter bestimmten Bedingungen weiter zu verbreiten.
> Tippen Sie 'license()' or 'licence()' f?r Details dazu.
>
> R ist ein Gemeinschaftsprojekt mit vielen Beitragenden.
> Tippen Sie 'contributors()' f?r mehr Information und 'citation()',
> um zu erfahren, wie R oder R packages in Publikationen zitiert werden
> k?nnen.
>
> Tippen Sie 'demo()' f?r einige Demos, 'help()' f?r on-line Hilfe, oder
> 'help.start()' f?r eine HTML Browserschnittstelle zur Hilfe.
> Tippen Sie 'q()', um R zu verlassen.
>
>> utils:::menuInstallLocal()
> updating HTML package descriptions
>> utils:::menuInstallLocal()
> package 'spdep' successfully unpacked and MD5 sums checked
> updating HTML package descriptions
>> utils:::menuInstallLocal()
> package 'tripack' successfully unpacked and MD5 sums checked
> updating HTML package descriptions
>> library(nfc)
> Fehler in library(nfc) : es gibt kein Paket 'nfc'
>> library(spdep)
> Lade n?tiges Paket: tripack
> Fehler in dyn.load(x, as.logical(local), as.logical(now)) :
>       kann shared library
> 'C:/ProgrammeZ/R/R-2.4.0/library/tripack/libs/tripack.dll'
> nicht laden:
> LoadLibrary failure:  Die angegebene Prozedur wurde nicht gefunden.
>
> Fehler: Paket 'tripack' konnte nicht geladen werden
>> update.packages(checkBuilt=TRUE)
> --- Please select a CRAN mirror for use in this session ---
> tripack :
> Version 1.2-10 installed in C:/ProgrammeZ/R/R-2.4.0/library built under R
> 2.1.0
> Version 1.2-10 available at http://cran.miscellaneousmirror.org
> Update (y/N/c)?  y
> versuche URL '
> http://cran.miscellaneousmirror.org/bin/windows/contrib/2.4/tripack_1.2-10.zip
> '
> Content type 'application/zip' length 197252 bytes
> URL ge?ffnet
> downloaded 192Kb
>
> package 'tripack' successfully unpacked and MD5 sums checked
>
> The downloaded packages are in
>       C:\Dokumente und Einstellungen\test\Lokale
> Einstellungen\Temp\RtmpDxbZqb\downloaded_packages
> updating HTML package descriptions
>> library(spdep)
> Lade n?tiges Paket: tripack
> Fehler in dyn.load(x, as.logical(local), as.logical(now)) :
>       kann shared library
> 'C:/ProgrammeZ/R/R-2.4.0/library/tripack/libs/tripack.dll'
> nicht laden:
> LoadLibrary failure:  Die angegebene Prozedur wurde nicht gefunden.
>
> Fehler: Paket 'tripack' konnte nicht geladen werden
>> library(tripack)
> Fehler in dyn.load(x, as.logical(local), as.logical(now)) :
>       kann shared library
> 'C:/ProgrammeZ/R/R-2.4.0/library/tripack/libs/tripack.dll'
> nicht laden:
> LoadLibrary failure:  Die angegebene Prozedur wurde nicht gefunden.
>
> Fehler in library(tripack) : .First.lib fehlgeschlagen f?r 'tripack'
>> update.packages(ask='graphics')
>> library(tripack)
> Fehler in dyn.load(x, as.logical(local), as.logical(now)) :
>       kann shared library
> 'C:/ProgrammeZ/R/R-2.4.0/library/tripack/libs/tripack.dll'
> nicht laden:
> LoadLibrary failure:  Die angegebene Prozedur wurde nicht gefunden.
>
> Fehler in library(tripack) : .First.lib fehlgeschlagen f?r 'tripack'
>> 
>
>
> Sincerely,
> Erkan YILMAZ
>
>
>
>
>
> On 11/28/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> 
>> You need to re-install packages when you update R, as it says in the
>> rw-FAQ.  Use update.packages(checkBuilt=TRUE) to do so.
>> 
>> And PLEASE do read the FAQ and not misuse R-bugs to ask questions about
>> things in FAQs
>> 
>> 
>> On Tue, 28 Nov 2006, erkan77 at gmail.com wrote:
>> 
>> > Full_Name: Erkan YILMAZ
>> > Version: 2.4.0
>> > OS: XP
>> > Submission from: (NULL) (85.180.116.228)
>> >
>> >
>> > Hi,
>> >
>> > just installed R 2.4.0 (before there was running 2.2.0).
>> >
>> > when loading the library ("library(tripack)"), there appears a pop up,
>> see
>> > following picture:
>> > http://www.skilledtester.de/R/r240_tripack.JPG
>> >
>> > -> the entry point "signal" in rgui.exe is not found
>> >
>> > in R itself following error is displayed:
>> > Fehler in dyn.load(x, as.logical(local), as.logical(now)) :
>> >        kann shared library
>> > 'I:/PROGRAMME/R_erkan/R-2.4.0/library/tripack/libs/tripack.dll' nicht
>> laden:
>> > LoadLibrary failure:  Die angegebene Prozedur wurde nicht gefunden.
>> >
>> > Fehler in library(tripack) : .First.lib fehlgeschlagen f?r 'tripack'
>> >
>> >
>> >
>> > can somebody help me?
>> >
>> > Bye,
>> > Erkan YILMAZ
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >
>> 
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-1814661816-1164717477=:6146--


From ligges at statistik.uni-dortmund.de  Tue Nov 28 14:50:45 2006
From: ligges at statistik.uni-dortmund.de (ligges at statistik.uni-dortmund.de)
Date: Tue, 28 Nov 2006 14:50:45 +0100 (CET)
Subject: [Rd] when loading library tripack entry point "signal" in
	rgui.exe (PR#9392)
Message-ID: <20061128135045.B7C453F043@slim.kubism.ku.dk>

This is not a bug in R. Please read the FAQs!

You have got a version of tripack that has been compiled for R < 2.4.0.
Please type

update.packages(checkBuilt = TRUE)

and try again.

Best,
Uwe Ligges



erkan77 at gmail.com wrote:
> Full_Name: Erkan YILMAZ
> Version: 2.4.0
> OS: XP
> Submission from: (NULL) (85.180.116.228)
> 
> 
> Hi,
> 
> just installed R 2.4.0 (before there was running 2.2.0).
> 
> when loading the library ("library(tripack)"), there appears a pop up, see
> following picture:
> http://www.skilledtester.de/R/r240_tripack.JPG
> 
> -> the entry point "signal" in rgui.exe is not found
> 
> in R itself following error is displayed:
> Fehler in dyn.load(x, as.logical(local), as.logical(now)) : 
>         kann shared library
> 'I:/PROGRAMME/R_erkan/R-2.4.0/library/tripack/libs/tripack.dll' nicht laden:
>  LoadLibrary failure:  Die angegebene Prozedur wurde nicht gefunden.
> 
> Fehler in library(tripack) : .First.lib fehlgeschlagen f?r 'tripack'
> 
> 
> 
> can somebody help me?
> 
> Bye,
> Erkan YILMAZ
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From aim at stats.uwo.ca  Tue Nov 28 17:50:20 2006
From: aim at stats.uwo.ca (A.I. McLeod)
Date: Tue, 28 Nov 2006 11:50:20 -0500
Subject: [Rd] ccf documentation bug or suggeston
Message-ID: <000e01c7130d$4d4f3e50$884c6481@stats2.uwo.ca>

Hi Duncan,

ccf(x,y) does not explain whether c(k)=cov(x(t),x(t+k)) or d(k)=cov(x(t),x(t-k)) is calculated.  The following example demonstrates 
that the c(k) definition is used:
ccf(c(-1,1,rep(0,8)),c(1,rep(0,9)))
However S-Plus acf uses the d(k) definition in their acf function.

For interpretive purposes this is a **vital distinction** (the cross-covariance/correlation is not symmetric like the 
autocovariance/autocorrelation).  There is not fixed convention is textbooks or research papers.  Some define it one way and other 
another.

There is no ccf function in S-Plus. Instead there is only acf for the auto/cross computation in multivariate time series.  This is 
more complicated since numerical output is 3D array.

Here is how S-Plus documents it:

VALUE:
a list with the following components:
acf
a three-dimensional array containing the autocovariance or autocorrelation function estimates. acf[i,j,k] is the covariance (or 
correlation) between the j -th series at time t and the k-th series at time t+1-i.
lag
an array the same shape as acf containing the lags (as fractions of the sampling period) at which acf is calculated. If j > k and i 
 > 1, then lag[i,j,k] is negative.

Ian McLeod


From aim at stats.uwo.ca  Tue Nov 28 17:50:44 2006
From: aim at stats.uwo.ca (aim at stats.uwo.ca)
Date: Tue, 28 Nov 2006 17:50:44 +0100 (CET)
Subject: [Rd] ccf documentation bug or suggeston (PR#9393)
Message-ID: <20061128165044.00B37572B2@slim.kubism.ku.dk>

Hi Duncan,

ccf(x,y) does not explain whether c(k)=cov(x(t),x(t+k)) or d(k)=cov(x(t),x(t-k)) is calculated.  The following example demonstrates 
that the c(k) definition is used:
ccf(c(-1,1,rep(0,8)),c(1,rep(0,9)))
However S-Plus acf uses the d(k) definition in their acf function.

For interpretive purposes this is a **vital distinction** (the cross-covariance/correlation is not symmetric like the 
autocovariance/autocorrelation).  There is not fixed convention is textbooks or research papers.  Some define it one way and other 
another.

There is no ccf function in S-Plus. Instead there is only acf for the auto/cross computation in multivariate time series.  This is 
more complicated since numerical output is 3D array.

Here is how S-Plus documents it:

VALUE:
a list with the following components:
acf
a three-dimensional array containing the autocovariance or autocorrelation function estimates. acf[i,j,k] is the covariance (or 
correlation) between the j -th series at time t and the k-th series at time t+1-i.
lag
an array the same shape as acf containing the lags (as fractions of the sampling period) at which acf is calculated. If j > k and i 
 > 1, then lag[i,j,k] is negative.

Ian McLeod


From murdoch at stats.uwo.ca  Tue Nov 28 18:50:35 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Tue, 28 Nov 2006 18:50:35 +0100 (CET)
Subject: [Rd] ccf documentation bug or suggeston (PR#9394)
Message-ID: <20061128175035.AB77B572AA@slim.kubism.ku.dk>

On 11/28/2006 11:50 AM, A.I. McLeod wrote:
> Hi Duncan,

Hi Ian.

> 
> ccf(x,y) does not explain whether c(k)=cov(x(t),x(t+k)) or d(k)=cov(x(t),x(t-k)) is calculated.  The following example demonstrates 
> that the c(k) definition is used:
> ccf(c(-1,1,rep(0,8)),c(1,rep(0,9)))
> However S-Plus acf uses the d(k) definition in their acf function.

I don't think our code looks right, let alone our documentation.  In 
both R-devel and R-patched I get a lag zero value of 1 from ccf(), and I 
think I should get cor(x,y), which in your example, would be -0.74:  and 
that is what I get from 2.4.0.

I hope this isn't a result of my patch to allow length 1 series...

Duncan Murdoch

P.S.  No need to send to more than one of R-devel, R-bugs, or me.  I'll 
see the message on any of them.  It's probably best to default to 
R-devel for suggestions like this, but the lag 0 value really is a bug, 
I think.

> 
> For interpretive purposes this is a **vital distinction** (the cross-covariance/correlation is not symmetric like the 
> autocovariance/autocorrelation).  There is not fixed convention is textbooks or research papers.  Some define it one way and other 
> another.
> 
> There is no ccf function in S-Plus. Instead there is only acf for the auto/cross computation in multivariate time series.  This is 
> more complicated since numerical output is 3D array.
> 
> Here is how S-Plus documents it:
> 
> VALUE:
> a list with the following components:
> acf
> a three-dimensional array containing the autocovariance or autocorrelation function estimates. acf[i,j,k] is the covariance (or 
> correlation) between the j -th series at time t and the k-th series at time t+1-i.
> lag
> an array the same shape as acf containing the lags (as fractions of the sampling period) at which acf is calculated. If j > k and i 
>  > 1, then lag[i,j,k] is negative.
> 
> Ian McLeod
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Tue Nov 28 21:39:49 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Tue, 28 Nov 2006 21:39:49 +0100 (CET)
Subject: [Rd] ccf documentation bug or suggeston (PR#9394)
Message-ID: <20061128203949.5719B5731C@slim.kubism.ku.dk>

On 11/28/2006 12:50 PM, murdoch at stats.uwo.ca wrote:
> On 11/28/2006 11:50 AM, A.I. McLeod wrote:
>> Hi Duncan,
> 
> Hi Ian.
> 
>> 
>> ccf(x,y) does not explain whether c(k)=cov(x(t),x(t+k)) or d(k)=cov(x(t),x(t-k)) is calculated.  The following example demonstrates 
>> that the c(k) definition is used:
>> ccf(c(-1,1,rep(0,8)),c(1,rep(0,9)))
>> However S-Plus acf uses the d(k) definition in their acf function.
> 
> I don't think our code looks right, let alone our documentation.  In 
> both R-devel and R-patched I get a lag zero value of 1 from ccf(), and I 
> think I should get cor(x,y), which in your example, would be -0.74:  and 
> that is what I get from 2.4.0.
> 
> I hope this isn't a result of my patch to allow length 1 series...

It was.  I'll commit a patch to my patch soon, and clarify the docs at 
the same time.

Duncan Murdoch


From vdergachev at rcgardis.com  Tue Nov 28 21:54:54 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Tue, 28 Nov 2006 15:54:54 -0500
Subject: [Rd] data frame subset patch
Message-ID: <200611281554.54593.vdergachev@rcgardis.com>


Hi all, 

   Here is a patch that significantly speeds up `[.data.frame` operator.
It applies cleanly to both 2.4.0 and svn trunk. Make check was OK for 2.40.
(for svn trunk it fails even without this patch.. ).

   What it does - we get rid of class and attr statements that modify incoming 
data frame and use explicit calls to .subset and .subset2 instead.

Test case:

N<-100000
T<-data.frame(a=1:N, b=rnorm(N), c=as.character(round(runif(N)*10)))
system.time({X<-0 ; for(i in 1:1000)X<-X+T[i,2]})

Without patch the output on my system is
[1]  8.488  2.436 10.926  0.000  0.000


With this patch the output is:
[1] 1.084 0.624 1.707 0.000 0.000

                    thank you !

                             Vladimir Dergachev

From xiao.gang.fan1 at libertysurf.fr  Tue Nov 28 22:05:42 2006
From: xiao.gang.fan1 at libertysurf.fr (Fan)
Date: Tue, 28 Nov 2006 22:05:42 +0100
Subject: [Rd] package tseries: plot.irts() - time axis label pb (PR#9387)
In-Reply-To: <971536df0611272002r674ab537u6bf87085be910191@mail.gmail.com>
References: <20061127163215.288DA57311@slim.kubism.ku.dk>
	<971536df0611272002r674ab537u6bf87085be910191@mail.gmail.com>
Message-ID: <456CA4A6.8000706@libertysurf.fr>

Thanks Gabor, tested ok with:
R version 2.4.0 Patched (2006-11-23 r39958)

Gabor Grothendieck wrote:
> When I try it with R
> "R version 2.4.0 Patched (2006-10-24 r39722)"
> on Windows XP and the same version of tseries as yours I get
> tick marks labelled 1992, 1994, 1996, 1998.
> 
> Try it again with a later version of R.
> 
> On 11/27/06, xiao.gang.fan1 at libertysurf.fr
> <xiao.gang.fan1 at libertysurf.fr> wrote:
> 
>> Full_Name: Xiao Gang FAN
>> Version: 2.4.0
>> OS: Windows
>> Submission from: (NULL) (159.50.101.9)
>>
>>
>> > library(tseries)
>> > plot(irts(seq(as.POSIXct("1991-01-01"), by="month", 
>> length=100),rnorm(100)))
>>
>> in the x-axix, the label is "Jan 01, Jan 01, Jan 01, ...."
>>
>> version of tseries: 0.10-7
>> Date: 2006-10-04
>> Built: R 2.4.0; i386-pc-mingw32; 2006-10-05 09:46:32; windows
>> also tried on other versions on CRAN, same pb
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From jhallman at frb.gov  Wed Nov 29 00:40:48 2006
From: jhallman at frb.gov (jhallman at frb.gov)
Date: Wed, 29 Nov 2006 00:40:48 +0100 (CET)
Subject: [Rd] Bug in tkStartGUI in package tcltk (PR#9396)
Message-ID: <20061128234048.8175F1F9A2@slim.kubism.ku.dk>

Full_Name: Jeff Hallman
Version: 2.4.0
OS: Linux
Submission from: (NULL) (132.200.32.34)


When the R Internals manual was added to the list of manuals in tkStartGUI,
whoever did it left an extra comma in the code.  This creates an ugly warning
when tkStartGUI is invoked.  Here is a patch file to fix it:

--- src/library/tcltk/R/tkGUI.R.orig	2006-11-21 15:15:52.000000000 -0500
+++ src/library/tcltk/R/tkGUI.R	2006-11-21 15:16:40.000000000 -0500
@@ -93,7 +93,7 @@
 	"R-data",    "R Data Import/Export",
 	"R-exts",    "Writing R extensions",
 	"R-lang",    "R Language Reference",
-	"refman",    "R Reference Manual",
+	"refman",    "R Reference Manual"
     ), ncol=2, byrow=TRUE)
 
     helpPDFMenu <- tkmenu(helpMenu)


From henric.nilsson at statisticon.se  Wed Nov 29 01:05:28 2006
From: henric.nilsson at statisticon.se (Henric Nilsson)
Date: Wed, 29 Nov 2006 01:05:28 +0100
Subject: [Rd] Is there a version of RMySQL for Windows?
In-Reply-To: <456AE919.8070702@gmail.com>
References: <BAA35444B19AD940997ED02A6996AAE0048D747F@sanmail.picr.man.ac.uk>
	<456AE919.8070702@gmail.com>
Message-ID: <456CCEC8.5020709@statisticon.se>

Den 2006-11-27 14:33, Roger D. Peng skrev:
> There are some pre-built binaries here:
> 
> http://stat.bell-labs.com/RS-DBI/download/index.html

And an even newer one, for the current version of R, is here:
http://bus.cba.utulsa.edu/byersj/Research.asp


HTH,
Henric



> 
> -roger
> 
> Michal Okoniewski wrote:
>> I was trying to email directly the developer, David A. James, but all
>> the emails bounce...
>> Does anyone know if RMySQL  may be re-compiled under Windows
>> and what are the limitations?
>>  
>> Cheers, 
>> Michal
>>  
>> --------------------------------------------------------
>>
>>  
>> This email is confidential and intended solely for the use o...{{dropped}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From p.dalgaard at biostat.ku.dk  Wed Nov 29 01:12:01 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 29 Nov 2006 01:12:01 +0100
Subject: [Rd] Bug in tkStartGUI in package tcltk (PR#9396)
In-Reply-To: <20061128234048.8175F1F9A2@slim.kubism.ku.dk>
References: <20061128234048.8175F1F9A2@slim.kubism.ku.dk>
Message-ID: <456CD051.1010608@biostat.ku.dk>

jhallman at frb.gov wrote:
> Full_Name: Jeff Hallman
> Version: 2.4.0
> OS: Linux
> Submission from: (NULL) (132.200.32.34)
>
>
> When the R Internals manual was added to the list of manuals in tkStartGUI,
> whoever did it left an extra comma in the code.  This creates an ugly warning
> when tkStartGUI is invoked.  Here is a patch file to fix it:
>
> --- src/library/tcltk/R/tkGUI.R.orig	2006-11-21 15:15:52.000000000 -0500
> +++ src/library/tcltk/R/tkGUI.R	2006-11-21 15:16:40.000000000 -0500
> @@ -93,7 +93,7 @@
>  	"R-data",    "R Data Import/Export",
>  	"R-exts",    "Writing R extensions",
>  	"R-lang",    "R Language Reference",
> -	"refman",    "R Reference Manual",
> +	"refman",    "R Reference Manual"
>      ), ncol=2, byrow=TRUE)
>  
>      helpPDFMenu <- tkmenu(helpMenu)
>   
Thanks. I think the extra comma has been there for a while, but c() has 
become more picky about missing args. (Another issue is that the actual 
manuals go walkabout in some binary distributions. E.g. FC6 has them in 
/usr/share/doc/R-2.4.0/ but the GUI looks for them in 
file.path(R.home("doc"), "manual"), which only has the HTML versions)


From murdoch at stats.uwo.ca  Wed Nov 29 04:08:28 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 28 Nov 2006 22:08:28 -0500
Subject: [Rd] Source references from the parser
In-Reply-To: <456BB264.7090605@stats.uwo.ca>
References: <456890A8.2060908@stats.uwo.ca>	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>	<456908D2.6080409@stats.uwo.ca>	<eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>	<45692598.30606@stats.uwo.ca>	<m2ejro4ce9.fsf@ziti.fhcrc.org>
	<456BB264.7090605@stats.uwo.ca>
Message-ID: <456CF9AC.4010605@stats.uwo.ca>

There have been a couple of requests to set the keep.source default to 
FALSE (i.e. not to enable the new behaviour), so I've done that.

Hopefully the code will still be exercised enough that we can have 
confidence in it by April.

Duncan Murdoch


From Julien.Steiner at imd.ch  Wed Nov 29 16:26:30 2006
From: Julien.Steiner at imd.ch (Steiner, Julien)
Date: Wed, 29 Nov 2006 16:26:30 +0100
Subject: [Rd] Error 1 : undefined first referenced symbol
Message-ID: <8B84F82763C82847899FB0346848B8F606482C68@SRVWEXCHP05.int.imd.ch>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061129/70dee831/attachment.pl 

From tpapp at Princeton.EDU  Wed Nov 29 16:33:09 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Wed, 29 Nov 2006 10:33:09 -0500
Subject: [Rd] Matrix*vector: coercing sparse to dense matrix for arithmetic
Message-ID: <20061129153309.GA6836@pu100877.student.princeton.edu>

Hi,

I have a sparse Matrix (kronecker product of spline design matrices),
and I need to multiply each row by a number to get another matrix.  If
the matrix is A and the numbers are stored in a vector k, with plain
vanilla matrices I would do

A*k

But when using the Matrix package (class of A is "dgCMatrix"), I get
the warning "coercing sparse to dense matrix for arithmetic".  The
error message is perfectly reasonable, I am looking for a way to do it
right (keeping operations in the realm of sparse matrices).  Any help
would be appreciated.

Thanks,

Tamas


From P.Dalgaard at biostat.ku.dk  Wed Nov 29 16:49:31 2006
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 29 Nov 2006 16:49:31 +0100
Subject: [Rd] Error 1 : undefined first referenced symbol
In-Reply-To: <8B84F82763C82847899FB0346848B8F606482C68@SRVWEXCHP05.int.imd.ch>
References: <8B84F82763C82847899FB0346848B8F606482C68@SRVWEXCHP05.int.imd.ch>
Message-ID: <456DAC0B.20706@biostat.ku.dk>

Steiner, Julien wrote:
> Hello
>
>  
>
> I'm having trouble building R under Unix. I've searched for information
> about it on google or the R database but I didn't find any answer on my
> problem. I would be thankful if somebody could help me working that out.
>
>  
>
> The version of R I'm trying to build is R-2.4.0 and the architecture of
> solaris is sparc.
>
>  
>
> Here's what I type.
>
>  
>
> PATH=/opt/sfw/bin:$PATH
>
> export PATH
>
> That's for the C compiler
>
>  
>
> ./configure LDFLAGS="-L/opt/sfw/lib:/opt/sfw/lib/sparcv9"
>
>
>   
That doesn't look like correct syntax for LDFLAGS. Should it not be

"-L/opt/sfw/lib -L/opt/sfw/lib/sparcv9"

?

> Then I get : 
>
>  
>
> Source directory:          .
>
>   Installation directory:    /usr/local
>
>  
>
>   C compiler:                gcc  -g -O2 -std=gnu99
>
>   Fortran 77 compiler:       g77  -g -O2
>
>  
>
>   C++ compiler:              g++  -g -O2
>
>   Fortran 90/95 compiler:    g77 -g -O2
>
>  
>
>   Interfaces supported:      X11
>
>   External libraries:        readline
>
>   Additional capabilities:   PNG, JPEG, NLS
>
>   Options enabled:           shared BLAS, R profiling
>
>  
>
>   Recommended packages:      yes
>
>  
>
> configure: WARNING: you cannot build DVI versions of the R manuals
>
> configure: WARNING: you cannot build PDF versions of the R manuals
>
>  
>
> gmake
>
>  
>
> and then I get this error message
>
>  
>
> gmake[3]: Entering directory
>
> `/usr/local/R_HOME/R-2.4.0/src/main'
>
> gcc  -L/opt/sfw/lib:/opt/sfw/lib/sparcv9 -o R.bin Rmain.o CConverters.o
> CommandLineArgs.o Rdynload.o Renviron.o RNG.o apply.o arithmetic.o
> apse.o array.o attrib.o base.o bind.o builtin.o character.o coerce.o
> colors.o complex.o connections.o context.o cov.o cum.o dcf.o datetime.o
> debug.o deparse.o deriv.o dotcode.o dounzip.o dstruct.o duplicate.o
> engine.o envir.o errors.o eval.o format.o fourier.o gevents.o gram.o
> gram-ex.o graphics.o identical.o internet.o iosupport.o lapack.o list.o
> localecharset.o logic.o main.o mapply.o match.o memory.o model.o names.o
> objects.o optim.o optimize.o options.o par.o paste.o pcre.o platform.o
> plot.o plot3d.o plotmath.o print.o printarray.o printvector.o
> printutils.o qsort.o random.o regex.o registration.o relop.o rlocale.o
> saveload.o scan.o seq.o serialize.o size.o sort.o source.o split.o
> sprintf.o startup.o subassign.o subscript.o subset.o summary.o
> sysutils.o unique.o util.o version.o vfonts.o xxxpr.o  mkdtemp.o
> ../unix/libunix.a ./appl/libappl.a ../nmath/libnmath.a -L../../lib
> -lRblas
>
> -L/opt/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.2
>
> -L/usr/ccs/bin -L/opt/sfw/lib -lg2c -lm -lgcc_s ./extra/zlib/libz.a
> ../extra/bzip2/libbz2.a ./extra/pcre/libpcre.a  ../extra/intl/libintl.a
> -lreadline -lncurses  -lnsl -lsocket -ldl -lm
>
> Undefined                       first referenced
>
>  symbol                             in file
>
> __builtin_isnan                     arithmetic.o
>
> ld: fatal: Symbol referencing errors. No output written to R.bin
>
> collect2: ld returned 1 exit status
>
> gmake[3]: *** [R.bin] Error 1
>
> gmake[3]: Leaving directory
>
> `/usr/local/R_HOME/R-2.4.0/src/main'
>
> gmake[2]: *** [R] Error 2
>
> gmake[2]: Leaving directory
>
> `/usr/local/R_HOME/R-2.4.0/src/main'
>
> gmake[1]: *** [R] Error 1
>
> gmake[1]: Leaving directory `/usr/local/R_HOME/R-2.4.0/src'
>
> gmake: *** [R] Error 1
>
>  
>
>  
>
> In advance, thanks a lot if you mind helping me.
>
>  
>
>  
>
> Juien
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Wed Nov 29 17:22:27 2006
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Wed, 29 Nov 2006 17:22:27 +0100
Subject: [Rd] Crash when embedding R X11 windows
In-Reply-To: <200611071526.56966.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <200611071526.56966.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <200611291722.27370.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Dear R developers,

On Tuesday 07 November 2006 15:26, Thomas Friedrichsmeier wrote:
> I've been experimenting with embedding R X11 windows into another
> application using KDE's QXEmbed on linux. Attempting to do so will crash R
> (with R 2.4.0, trunk, and I know the bug has been around in prior
> versions). I used to think this was related to bug #848, but I'm not sure,
> if / how the solution suggested there still applies to current versions of
> R.
>
> After debugging, I came up with the following patch (in src/modules/X11):

shame on me. After further investigation, I found out, that indeed QXEmbed is 
to blame, not R (see 
http://lists.kde.org/?l=kde-devel&m=116448102901184&w=2). The fact that all 
other applications, I had tried to embed, did not crash, led me to believe 
otherwise for a long time.

The patch, I suggested, probably would not do any harm, either way, but should 
not be strictly needed.

Sorry about the noise.

Regards
Thomas Friedrichsmeier
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20061129/f8891348/attachment.bin 

From sfalcon at fhcrc.org  Wed Nov 29 17:26:09 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 29 Nov 2006 08:26:09 -0800
Subject: [Rd] Source references from the parser
In-Reply-To: <456CF9AC.4010605@stats.uwo.ca> (Duncan Murdoch's message of "Tue,
	28 Nov 2006 22:08:28 -0500")
References: <456890A8.2060908@stats.uwo.ca>
	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>
	<456908D2.6080409@stats.uwo.ca>
	<eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>
	<45692598.30606@stats.uwo.ca> <m2ejro4ce9.fsf@ziti.fhcrc.org>
	<456BB264.7090605@stats.uwo.ca> <456CF9AC.4010605@stats.uwo.ca>
Message-ID: <m2fyc2rzha.fsf@ziti.fhcrc.org>

Duncan Murdoch <murdoch at stats.uwo.ca> writes:

> There have been a couple of requests to set the keep.source default to
> FALSE (i.e. not to enable the new behaviour), so I've done that.

Thank you.  That is much appreciated.

> Hopefully the code will still be exercised enough that we can have
> confidence in it by April.

FWIW, I intend to set keep.source=TRUE for the packages that I work on
directly and will speak up if I encounter problems :-)

+ seth


From tpapp at Princeton.EDU  Wed Nov 29 17:29:29 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Wed, 29 Nov 2006 11:29:29 -0500
Subject: [Rd] least squares with solve: leading minor is not positive
	definite
Message-ID: <20061129162929.GA8465@pu100877.student.princeton.edu>

Hi,

I am following the "Comparing Least Squares Calculations" vignette of
the Matrix package to get a least squares solution x for

MM %*% x == mu$utility

I get the following error message:

Error in solve(crossprod(MM), crossprod(MM, mu$utility)) : 
	the leading minor of order 1079 is not positive definite

I thought that the least squares was always defined...  What can I do
about this?

Tamas


From bates at stat.wisc.edu  Wed Nov 29 18:19:52 2006
From: bates at stat.wisc.edu (Douglas Bates)
Date: Wed, 29 Nov 2006 11:19:52 -0600
Subject: [Rd] Matrix*vector: coercing sparse to dense matrix for
	arithmetic
In-Reply-To: <20061129153309.GA6836@pu100877.student.princeton.edu>
References: <20061129153309.GA6836@pu100877.student.princeton.edu>
Message-ID: <40e66e0b0611290919n57ae56d6rd568575179f93b8f@mail.gmail.com>

On 11/29/06, Tamas K Papp <tpapp at princeton.edu> wrote:

> I have a sparse Matrix (kronecker product of spline design matrices),
> and I need to multiply each row by a number to get another matrix.  If
> the matrix is A and the numbers are stored in a vector k, with plain
> vanilla matrices I would do

> A*k

> But when using the Matrix package (class of A is "dgCMatrix"), I get
> the warning "coercing sparse to dense matrix for arithmetic".  The
> error message is perfectly reasonable, I am looking for a way to do it
> right (keeping operations in the realm of sparse matrices).  Any help
> would be appreciated.

I would suggest premultiplying by a diagonal matrix.  However, when I
look at the method dispatch after an example it doesn't appear to be
making a good choice.  What I think should work well (and Martin or I
will make the necessary changes to ensure that it does) is

library(Matrix)
data(KNex); mm <- KNex$mm
system.time(Diagonal(x = rnorm(nrow(mm))) %*% mm)


From murdoch at stats.uwo.ca  Wed Nov 29 19:09:48 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 29 Nov 2006 13:09:48 -0500
Subject: [Rd] Source references from the parser
In-Reply-To: <m2fyc2rzha.fsf@ziti.fhcrc.org>
References: <456890A8.2060908@stats.uwo.ca>	<eb555e660611251212j54441315t3fbb439f724ed3e9@mail.gmail.com>	<456908D2.6080409@stats.uwo.ca>	<eb555e660611252000i453b6c41n6acd697dce9169ff@mail.gmail.com>	<45692598.30606@stats.uwo.ca>
	<m2ejro4ce9.fsf@ziti.fhcrc.org>	<456BB264.7090605@stats.uwo.ca>
	<456CF9AC.4010605@stats.uwo.ca> <m2fyc2rzha.fsf@ziti.fhcrc.org>
Message-ID: <456DCCEC.90307@stats.uwo.ca>

On 11/29/2006 11:26 AM, Seth Falcon wrote:
> Duncan Murdoch <murdoch at stats.uwo.ca> writes:
> 
>> There have been a couple of requests to set the keep.source default to
>> FALSE (i.e. not to enable the new behaviour), so I've done that.
> 
> Thank you.  That is much appreciated.
> 
>> Hopefully the code will still be exercised enough that we can have
>> confidence in it by April.
> 
> FWIW, I intend to set keep.source=TRUE for the packages that I work on
> directly and will speak up if I encounter problems :-)

Thanks, that will really help.

Duncan Murdoch


From hanl2 at wyeth.com  Wed Nov 29 19:35:37 2006
From: hanl2 at wyeth.com (hanl2 at wyeth.com)
Date: Wed, 29 Nov 2006 19:35:37 +0100 (CET)
Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
Message-ID: <20061129183537.0F42D5734F@slim.kubism.ku.dk>

Full_Name: Lixin Han
Version: 2.4.0
OS: Windows 2000
Submission from: (NULL) (155.94.110.222)


A character vector c('a','b') is supplied to rm().  As a result, 'c' is deleted
unintentionally.

> a <- 1:5
> b <- 'abc'
> c <- letters
> ls()
[1] "a" "b" "c"
> rm(c('a','b'))
> ls()
character(0)
>


From smckinney at bccrc.ca  Wed Nov 29 19:44:35 2006
From: smckinney at bccrc.ca (Steven McKinney)
Date: Wed, 29 Nov 2006 10:44:35 -0800
Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
References: <20061129183537.0F42D5734F@slim.kubism.ku.dk>
Message-ID: <0BE438149FF2254DB4199E2682C8DFEB0235F9FA@crcmail1.BCCRC.CA>

Same behaviour seen on Apple Mac OSX 10.4.8 platform:

> sessionInfo()
R version 2.4.0 Patched (2006-10-31 r39758) 
powerpc-apple-darwin8.8.0 

locale:
en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"  "base"     

other attached packages:
    XML 
"1.2-0" 
> 
> ls()
[1] "getMonograph" "last.warning" "myfun"       
> a <- 1
> b <- 2
> c <- letters
> a
[1] 1
> b
[1] 2
> c
 [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"
> rm(c('a', 'b'))
> a
Error: object "a" not found
> b
Error: object "b" not found
> c
.Primitive("c")
> ls()
[1] "getMonograph" "last.warning" "myfun"       
> a <- 1
> b <- 2
> d <- letters
> ls()
[1] "a"            "b"            "d"            "getMonograph" "last.warning" "myfun"       
> rm(c('a', 'b'))
Warning message:
remove: variable "c" was not found 
> ls()
[1] "d"            "getMonograph" "last.warning" "myfun"       
> 

Steven McKinney

Statistician
Molecular Oncology and Breast Cancer Program
British Columbia Cancer Research Centre

email: smckinney at bccrc.ca

tel: 604-675-8000 x7561

BCCRC
Molecular Oncology
675 West 10th Ave, Floor 4
Vancouver B.C. 
V5Z 1L3
Canada




-----Original Message-----
From: r-devel-bounces at r-project.org on behalf of hanl2 at wyeth.com
Sent: Wed 11/29/2006 10:35 AM
To: r-devel at stat.math.ethz.ch
Cc: R-bugs at biostat.ku.dk
Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
 
Full_Name: Lixin Han
Version: 2.4.0
OS: Windows 2000
Submission from: (NULL) (155.94.110.222)


A character vector c('a','b') is supplied to rm().  As a result, 'c' is deleted
unintentionally.

> a <- 1:5
> b <- 'abc'
> c <- letters
> ls()
[1] "a" "b" "c"
> rm(c('a','b'))
> ls()
character(0)
>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From jmacdon at med.umich.edu  Wed Nov 29 20:14:40 2006
From: jmacdon at med.umich.edu (James W. MacDonald)
Date: Wed, 29 Nov 2006 14:14:40 -0500
Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
In-Reply-To: <0BE438149FF2254DB4199E2682C8DFEB0235F9FA@crcmail1.BCCRC.CA>
References: <20061129183537.0F42D5734F@slim.kubism.ku.dk>
	<0BE438149FF2254DB4199E2682C8DFEB0235F9FA@crcmail1.BCCRC.CA>
Message-ID: <456DDC20.3000002@med.umich.edu>

That's because you are not using rm() correctly. From the help page:

Arguments:

      ...: the objects to be removed, supplied individually and/or as a
           character vector

     list: a character vector naming objects to be removed.

So if you pass an unnamed argument, rm() will assume you have some 
objects in the .GlobalEnv with those names that you would like to 
remove. If you want to pass a character vector, you have to name it 
because the first argument is '...'.

 > a <- 1:5
 > b <- 2:10
 > c <- "not a good variable name"
 > rm(list=c("a","b"))
 > c
[1] "not a good variable name"

 > a <- 1:5
 > b <- 2:10
 > c <- "still not a good variable name"
 > rm(a,b)
 > c
[1] "still not a good variable name"

 > a <- 1:5
 > b <- 2:10
 > c <- "still not a good variable name"
 > rm("a","b")
 > c
[1] "still not a good variable name"


NB: 'c' is not a good variable name because you are masking an existing 
function.

An argument could be made that the explanation for the first argument is 
not very exact.

Best,

Jim



Steven McKinney wrote:
> Same behaviour seen on Apple Mac OSX 10.4.8 platform:
> 
> 
>>sessionInfo()
> 
> R version 2.4.0 Patched (2006-10-31 r39758) 
> powerpc-apple-darwin8.8.0 
> 
> locale:
> en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
> 
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"  "base"     
> 
> other attached packages:
>     XML 
> "1.2-0" 
> 
>>ls()
> 
> [1] "getMonograph" "last.warning" "myfun"       
> 
>>a <- 1
>>b <- 2
>>c <- letters
>>a
> 
> [1] 1
> 
>>b
> 
> [1] 2
> 
>>c
> 
>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"
> 
>>rm(c('a', 'b'))
>>a
> 
> Error: object "a" not found
> 
>>b
> 
> Error: object "b" not found
> 
>>c
> 
> .Primitive("c")
> 
>>ls()
> 
> [1] "getMonograph" "last.warning" "myfun"       
> 
>>a <- 1
>>b <- 2
>>d <- letters
>>ls()
> 
> [1] "a"            "b"            "d"            "getMonograph" "last.warning" "myfun"       
> 
>>rm(c('a', 'b'))
> 
> Warning message:
> remove: variable "c" was not found 
> 
>>ls()
> 
> [1] "d"            "getMonograph" "last.warning" "myfun"       
> 
> 
> Steven McKinney
> 
> Statistician
> Molecular Oncology and Breast Cancer Program
> British Columbia Cancer Research Centre
> 
> email: smckinney at bccrc.ca
> 
> tel: 604-675-8000 x7561
> 
> BCCRC
> Molecular Oncology
> 675 West 10th Ave, Floor 4
> Vancouver B.C. 
> V5Z 1L3
> Canada
> 
> 
> 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org on behalf of hanl2 at wyeth.com
> Sent: Wed 11/29/2006 10:35 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at biostat.ku.dk
> Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
>  
> Full_Name: Lixin Han
> Version: 2.4.0
> OS: Windows 2000
> Submission from: (NULL) (155.94.110.222)
> 
> 
> A character vector c('a','b') is supplied to rm().  As a result, 'c' is deleted
> unintentionally.
> 
> 
>>a <- 1:5
>>b <- 'abc'
>>c <- letters
>>ls()
> 
> [1] "a" "b" "c"
> 
>>rm(c('a','b'))
>>ls()
> 
> character(0)
> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
James W. MacDonald, M.S.
Biostatistician
Affymetrix and cDNA Microarray Core
University of Michigan Cancer Center
1500 E. Medical Center Drive
7410 CCGC
Ann Arbor MI 48109
734-647-5623


**********************************************************
Electronic Mail is not secure, may not be read every day, and should not be used for urgent or sensitive issues.


From hanl2 at wyeth.com  Wed Nov 29 20:24:29 2006
From: hanl2 at wyeth.com (Lixin Han)
Date: Wed, 29 Nov 2006 14:24:29 -0500
Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument	(PR#9399)
Message-ID: <s56d982c.031@CE08A07M.ce.us.pri.wyeth.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061129/630253b0/attachment.pl 

From smckinney at bccrc.ca  Wed Nov 29 21:01:14 2006
From: smckinney at bccrc.ca (Steven McKinney)
Date: Wed, 29 Nov 2006 12:01:14 -0800
Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
References: <20061129183537.0F42D5734F@slim.kubism.ku.dk>
	<0BE438149FF2254DB4199E2682C8DFEB0235F9FA@crcmail1.BCCRC.CA>
	<456DDC20.3000002@med.umich.edu>
Message-ID: <0BE438149FF2254DB4199E2682C8DFEB0235F9FB@crcmail1.BCCRC.CA>

The argument should indeed be made.

I think the documentation for rm() needs
to be changed to:

Arguments:

      ...: the object to be removed, supplied individually.  Multiple objects
           must be supplied via the list argument. 



>From the rm() help page:

rm    (..., list = character(0), pos = -1,
       envir = as.environment(pos), inherits = FALSE)
Arguments

...	 the objects to be removed, supplied individually and/or as a character vector




> class(c('a', 'b'))
[1] "character"
> 
> length(c('a', 'b'))
[1] 2
> is.vector(c('a', 'b'))
[1] TRUE
> 

By all appearances, c('a', 'b') seems
to be a character vector.  I'm not the
most knowledgeable R programmer, so I'm not
sure what I'm missing here.

I haven't delved deeply into the rm() source code, but
this looks like a logical bug.  The documentation
needs to be modified to fit the current function
behaviour, or the current function behaviour needs
to be modified to fit the documentation.

> rm(c('a', 'b'))
Warning message:
remove: variable "c" was not found 

Why is "c" ending up in the list of items to remove? 
(see PS: below)

> unlist(list('a', 'b'))
[1] "a" "b"
> class(unlist(list('a', 'b')))
[1] "character"
> is.vector(unlist(list('a', 'b')))
[1] TRUE
> a <- 1
> b <- 2
> rm(unlist(list('a', 'b')))
Warning messages:
1: remove: variable "unlist" was not found 
2: remove: variable "list("a", "b")" was not found 
> ls()
[1] "a"            "b"            "d"            "getMonograph" "last.warning" "myfun"       
> 

Does the rm() doc need modification?

Presently it appears that the doc should read

Arguments:

      ...: the object to be removed, supplied individually.  Multiple objects
           must be supplied via the list argument. 




PS:

Does it have anything to do with this
type of behaviour?  Is this essentially
what is happening in the match.call()
in rm()?

> sapply(substitute(c('a', 'b')), as.character)
[1] "c" "a" "b"

> rm
function (..., list = character(0), pos = -1, envir = as.environment(pos), 
    inherits = FALSE) 
{
    names <- sapply(match.call(expand.dots = FALSE)$..., as.character)
    if (length(names) == 0) 
        names <- character(0)
    list <- .Primitive("c")(list, names)
    .Internal(remove(list, envir, inherits))
}
<environment: namespace:base>
> sapply(c('a', 'b'), as.character)
  a   b 
"a" "b" 
> sapply(substitute(c('a', 'b')), as.character)
[1] "c" "a" "b"
> match.call
function (definition = NULL, call = sys.call(sys.parent()), expand.dots = TRUE) 
.Internal(match.call(definition, call, expand.dots))
<environment: namespace:base>



Steven McKinney

Statistician
Molecular Oncology and Breast Cancer Program
British Columbia Cancer Research Centre

email: smckinney at bccrc.ca

tel: 604-675-8000 x7561

BCCRC
Molecular Oncology
675 West 10th Ave, Floor 4
Vancouver B.C. 
V5Z 1L3
Canada




-----Original Message-----
From: James W. MacDonald [mailto:jmacdon at med.umich.edu]
Sent: Wed 11/29/2006 11:14 AM
To: Steven McKinney
Cc: hanl2 at wyeth.com; r-devel at stat.math.ethz.ch; R-bugs at biostat.ku.dk
Subject: Re: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
 
That's because you are not using rm() correctly. From the help page:

Arguments:

      ...: the objects to be removed, supplied individually and/or as a
           character vector

     list: a character vector naming objects to be removed.

So if you pass an unnamed argument, rm() will assume you have some 
objects in the .GlobalEnv with those names that you would like to 
remove. If you want to pass a character vector, you have to name it 
because the first argument is '...'.

 > a <- 1:5
 > b <- 2:10
 > c <- "not a good variable name"
 > rm(list=c("a","b"))
 > c
[1] "not a good variable name"

 > a <- 1:5
 > b <- 2:10
 > c <- "still not a good variable name"
 > rm(a,b)
 > c
[1] "still not a good variable name"

 > a <- 1:5
 > b <- 2:10
 > c <- "still not a good variable name"
 > rm("a","b")
 > c
[1] "still not a good variable name"


NB: 'c' is not a good variable name because you are masking an existing 
function.

An argument could be made that the explanation for the first argument is 
not very exact.

Best,

Jim



Steven McKinney wrote:
> Same behaviour seen on Apple Mac OSX 10.4.8 platform:
> 
> 
>>sessionInfo()
> 
> R version 2.4.0 Patched (2006-10-31 r39758) 
> powerpc-apple-darwin8.8.0 
> 
> locale:
> en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
> 
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"  "base"     
> 
> other attached packages:
>     XML 
> "1.2-0" 
> 
>>ls()
> 
> [1] "getMonograph" "last.warning" "myfun"       
> 
>>a <- 1
>>b <- 2
>>c <- letters
>>a
> 
> [1] 1
> 
>>b
> 
> [1] 2
> 
>>c
> 
>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"
> 
>>rm(c('a', 'b'))
>>a
> 
> Error: object "a" not found
> 
>>b
> 
> Error: object "b" not found
> 
>>c
> 
> .Primitive("c")
> 
>>ls()
> 
> [1] "getMonograph" "last.warning" "myfun"       
> 
>>a <- 1
>>b <- 2
>>d <- letters
>>ls()
> 
> [1] "a"            "b"            "d"            "getMonograph" "last.warning" "myfun"       
> 
>>rm(c('a', 'b'))
> 
> Warning message:
> remove: variable "c" was not found 
> 
>>ls()
> 
> [1] "d"            "getMonograph" "last.warning" "myfun"       
> 
> 
> Steven McKinney
> 
> Statistician
> Molecular Oncology and Breast Cancer Program
> British Columbia Cancer Research Centre
> 
> email: smckinney at bccrc.ca
> 
> tel: 604-675-8000 x7561
> 
> BCCRC
> Molecular Oncology
> 675 West 10th Ave, Floor 4
> Vancouver B.C. 
> V5Z 1L3
> Canada
> 
> 
> 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org on behalf of hanl2 at wyeth.com
> Sent: Wed 11/29/2006 10:35 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at biostat.ku.dk
> Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
>  
> Full_Name: Lixin Han
> Version: 2.4.0
> OS: Windows 2000
> Submission from: (NULL) (155.94.110.222)
> 
> 
> A character vector c('a','b') is supplied to rm().  As a result, 'c' is deleted
> unintentionally.
> 
> 
>>a <- 1:5
>>b <- 'abc'
>>c <- letters
>>ls()
> 
> [1] "a" "b" "c"
> 
>>rm(c('a','b'))
>>ls()
> 
> character(0)
> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
James W. MacDonald, M.S.
Biostatistician
Affymetrix and cDNA Microarray Core
University of Michigan Cancer Center
1500 E. Medical Center Drive
7410 CCGC
Ann Arbor MI 48109
734-647-5623


**********************************************************
Electronic Mail is not secure, may not be read every day, and should not be used for urgent or sensitive issues.


From p.dalgaard at biostat.ku.dk  Wed Nov 29 21:31:22 2006
From: p.dalgaard at biostat.ku.dk (p.dalgaard at biostat.ku.dk)
Date: Wed, 29 Nov 2006 21:31:22 +0100 (CET)
Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
Message-ID: <20061129203122.5A5CB57355@slim.kubism.ku.dk>

Steven McKinney wrote:
> Same behaviour seen on Apple Mac OSX 10.4.8 platform:
>
>   
>> sessionInfo()
>>     
> R version 2.4.0 Patched (2006-10-31 r39758) 
> powerpc-apple-darwin8.8.0 
>
> locale:
> en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"  "base"     
>
> other attached packages:
>     XML 
> "1.2-0" 
>   
>> ls()
>>     
> [1] "getMonograph" "last.warning" "myfun"       
>   
>> a <- 1
>> b <- 2
>> c <- letters
>> a
>>     
> [1] 1
>   
>> b
>>     
> [1] 2
>   
>> c
>>     
>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"
>   
>> rm(c('a', 'b'))
>> a
>>     
> Error: object "a" not found
>   
>> b
>>     
> Error: object "b" not found
>   
>> c
>>     
> .Primitive("c")
>   
>> ls()
>>     
> [1] "getMonograph" "last.warning" "myfun"       
>   
>> a <- 1
>> b <- 2
>> d <- letters
>> ls()
>>     
> [1] "a"            "b"            "d"            "getMonograph" "last.warning" "myfun"       
>   
>> rm(c('a', 'b'))
>>     
> Warning message:
> remove: variable "c" was not found 
>   
>> ls()
>>     
> [1] "d"            "getMonograph" "last.warning" "myfun"       
>   
>
> Steven McKinney
>
> Statistician
> Molecular Oncology and Breast Cancer Program
> British Columbia Cancer Research Centre
>
> email: smckinney at bccrc.ca
>
> tel: 604-675-8000 x7561
>
> BCCRC
> Molecular Oncology
> 675 West 10th Ave, Floor 4
> Vancouver B.C. 
> V5Z 1L3
> Canada
>
>
>
>
> -----Original Message-----
> From: r-devel-bounces at r-project.org on behalf of hanl2 at wyeth.com
> Sent: Wed 11/29/2006 10:35 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at biostat.ku.dk
> Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
>  
> Full_Name: Lixin Han
> Version: 2.4.0
> OS: Windows 2000
> Submission from: (NULL) (155.94.110.222)
>
>
> A character vector c('a','b') is supplied to rm().  As a result, 'c' is deleted
> unintentionally.
>
>   
>> a <- 1:5
>> b <- 'abc'
>> c <- letters
>> ls()
>>     
> [1] "a" "b" "c"
>   
>> rm(c('a','b'))
>> ls()
>>     
> character(0)
>   
>
>   
The reason is that
 > x <- function(...) sapply(match.call(expand.dots = FALSE)$..., 
as.character)
 > x(c(a,b))
     [,1]
[1,] "c"
[2,] "a"
[3,] "b"

Which in turn happens because
 > as.character(quote(c(a,b)))
[1] "c" "a" "b"

I don't know if it really qualifies as a bug, but it's not documented 
that as.character() is used and I suppose we could be more careful with 
the argument checking.


From murdoch at stats.uwo.ca  Wed Nov 29 21:49:00 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 29 Nov 2006 15:49:00 -0500
Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
In-Reply-To: <20061129203122.5A5CB57355@slim.kubism.ku.dk>
References: <20061129203122.5A5CB57355@slim.kubism.ku.dk>
Message-ID: <456DF23C.3070705@stats.uwo.ca>

On 11/29/2006 3:31 PM, p.dalgaard at biostat.ku.dk wrote:
> Steven McKinney wrote:
>> Same behaviour seen on Apple Mac OSX 10.4.8 platform:
>>
>>   
>>> sessionInfo()
>>>     
>> R version 2.4.0 Patched (2006-10-31 r39758) 
>> powerpc-apple-darwin8.8.0 
>>
>> locale:
>> en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
>>
>> attached base packages:
>> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"  "base"     
>>
>> other attached packages:
>>     XML 
>> "1.2-0" 
>>   
>>> ls()
>>>     
>> [1] "getMonograph" "last.warning" "myfun"       
>>   
>>> a <- 1
>>> b <- 2
>>> c <- letters
>>> a
>>>     
>> [1] 1
>>   
>>> b
>>>     
>> [1] 2
>>   
>>> c
>>>     
>>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"
>>   
>>> rm(c('a', 'b'))
>>> a
>>>     
>> Error: object "a" not found
>>   
>>> b
>>>     
>> Error: object "b" not found
>>   
>>> c
>>>     
>> .Primitive("c")
>>   
>>> ls()
>>>     
>> [1] "getMonograph" "last.warning" "myfun"       
>>   
>>> a <- 1
>>> b <- 2
>>> d <- letters
>>> ls()
>>>     
>> [1] "a"            "b"            "d"            "getMonograph" "last.warning" "myfun"       
>>   
>>> rm(c('a', 'b'))
>>>     
>> Warning message:
>> remove: variable "c" was not found 
>>   
>>> ls()
>>>     
>> [1] "d"            "getMonograph" "last.warning" "myfun"       
>>   
>>
>> Steven McKinney
>>
>> Statistician
>> Molecular Oncology and Breast Cancer Program
>> British Columbia Cancer Research Centre
>>
>> email: smckinney at bccrc.ca
>>
>> tel: 604-675-8000 x7561
>>
>> BCCRC
>> Molecular Oncology
>> 675 West 10th Ave, Floor 4
>> Vancouver B.C. 
>> V5Z 1L3
>> Canada
>>
>>
>>
>>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org on behalf of hanl2 at wyeth.com
>> Sent: Wed 11/29/2006 10:35 AM
>> To: r-devel at stat.math.ethz.ch
>> Cc: R-bugs at biostat.ku.dk
>> Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
>>  
>> Full_Name: Lixin Han
>> Version: 2.4.0
>> OS: Windows 2000
>> Submission from: (NULL) (155.94.110.222)
>>
>>
>> A character vector c('a','b') is supplied to rm().  As a result, 'c' is deleted
>> unintentionally.
>>
>>   
>>> a <- 1:5
>>> b <- 'abc'
>>> c <- letters
>>> ls()
>>>     
>> [1] "a" "b" "c"
>>   
>>> rm(c('a','b'))
>>> ls()
>>>     
>> character(0)
>>   
>>
>>   
> The reason is that
>  > x <- function(...) sapply(match.call(expand.dots = FALSE)$..., 
> as.character)
>  > x(c(a,b))
>      [,1]
> [1,] "c"
> [2,] "a"
> [3,] "b"
> 
> Which in turn happens because
>  > as.character(quote(c(a,b)))
> [1] "c" "a" "b"
> 
> I don't know if it really qualifies as a bug, but it's not documented 
> that as.character() is used and I suppose we could be more careful with 
> the argument checking.

I'd say it qualifies as a bug if we remove something that the user 
didn't ask to have removed.   A user would have a right to be annoyed if

rm( NotNeeded("a", "b") )

(where NotNeeded was a function to give the subset of variables which 
are not needed) went ahead and removed all the variables, *plus* the 
NotNeeded function!

Duncan Murdoch


From rhurlin at gwdg.de  Wed Nov 29 22:05:08 2006
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Wed, 29 Nov 2006 22:05:08 +0100
Subject: [Rd] R-devel does not compile under FreeBSD-7.0 CURRENT
Message-ID: <456DF604.1000306@gwdg.de>

I am not able to compile R-devel 2006-11-28 under FreeBSD-7.0 CURRENT. 
After running ./configure script 'make' stops with the following error 
message:

--------------------------
#make
gcc -I. -I./src/include -I./src/include -I/usr/local/include
-DHAVE_CONFIG_H -g -O2 -c  -o .m.o
gcc: No input files specified
*** Error code 1

Stop in /usr/local/R-devel.
#
--------------------------

I attached configure messages. If wanted I can send complete config.log 
(460 kByte).

Are their any ideas about what is going wrong? If I could help with more 
information or with testing, please let me know.

Thanks,
Rainer Hurling
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: configure.out
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061129/61268153/attachment.pl 

From bill at insightful.com  Wed Nov 29 23:04:17 2006
From: bill at insightful.com (bill at insightful.com)
Date: Wed, 29 Nov 2006 23:04:17 +0100 (CET)
Subject: [Rd] rm() deletes 'c' if c('a','b') is the argument (PR#9399)
Message-ID: <20061129220417.0443C4C98F@slim.kubism.ku.dk>

On Wed, 29 Nov 2006 p.dalgaard at biostat.ku.dk wrote:

> > A character vector c('a','b') is supplied to rm().
> > As a result, 'c' is deleted unintentionally.
> > ...
> >> a <- 1:5
> >> b <- 'abc'
> >> c <- letters
> >> ls()
> > [1] "a" "b" "c"
> >> rm(c('a','b'))
> >> ls()
> > character(0)
> ...
> I don't know if it really qualifies as a bug, but it's not documented
> that as.character() is used and I suppose we could be more careful with
> the argument checking.

I suggest that if any changes are made, then
rm(c('a','b')) should throw an error.

Functions which try to be "user-friendly" by
letting you omit quotes are generally a bad
idea, IMO.  They all need patching up in various
ways to work in all situation (e.g., library's
character.only=TRUE argument and the complicated
code in help to see what the topic really is).

Perhaps rm() should be deprecated in favor of
remove(), which uses standard S syntax rules.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From edd at debian.org  Wed Nov 29 23:19:06 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 29 Nov 2006 16:19:06 -0600
Subject: [Rd] R CMD check warning about boot ?
Message-ID: <17774.1882.621732.219274@basebud.nulle.part>


Running R CMD check on a local package, I get

* checking Rd files ... OK
* checking Rd cross-references ... WARNING
Error in .find.package(package, lib.loc) :
        there is no package called 'boot'
Execution halted
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK

The output is spurious -- I do not use boot, but do have it installed.

This is with R-patched as of Nov 25 as well as Nov 03. Am I overlooking
something, or is this a buglet?

Regards, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From ross at biostat.ucsf.edu  Thu Nov 30 00:11:50 2006
From: ross at biostat.ucsf.edu (ross at biostat.ucsf.edu)
Date: Thu, 30 Nov 2006 00:11:50 +0100 (CET)
Subject: [Rd] Web site link problems (PR#9401)
Message-ID: <20061129231150.3F3BE536A2@slim.kubism.ku.dk>

Full_Name: Ross Boylan
Version: N/A
OS: Linux
Submission from: (NULL) (198.144.201.14)


1. http://www.r-project.org/posting-guide.html includes
"Paul Johnson's R tips page is a organized collection of how to do things in R,
with many questions and tips culled from R-help"
"R tips" is a link to http://www.ku.edu/~pauljohn/R/Rtips.html.  I get a message
the page is no longer there when I try it.

Desired state: delete or point to an active version of the document, unless this
is some transitory problem.

2. http://www.r-project.org/posting-guide.html includes in the section
Surprising behavior and bugs, "make sure you read R Bugs in the R-faq."  The
latter is the link http://cran.r-project.org/doc/FAQ/R-FAQ.html#R%20Bugs, which
takes me to the page but not the section.  The link on the FAQ page to that
section is http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs (i.e., no %20).

Desired state: update the link.

You also might want to consider footers on your web pages saying "to report
problems with this web page do xxxxx".  The pages I looked at didn't have this
info, as far as I can tell.

I hope this is an appropriate place to let you know!

Thanks for your work on R.


From andy_liaw at merck.com  Thu Nov 30 05:16:51 2006
From: andy_liaw at merck.com (Liaw, Andy)
Date: Wed, 29 Nov 2006 23:16:51 -0500
Subject: [Rd] strange error from R CMD check about xaxp
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFA03536179@usctmx1106.merck.com>

Dear R-devel,

Kurt had alerted me to the problem that the randomForest package that I
maintain has been failing checks in R-devel.  However, I just can't see
why or where it's failing.  I'd very much appreciate any pointer.

The failure occur when running the example code in varImpPlot.Rd:

> varImpPlot(mtcars.rf)
Error in par(opar) : invalid value specified for graphical parameter
"xaxp"
Execution halted

However, I do not have "par(opar)" or set xaxp anywhere in any of the
.Rd or .R files in the package.  In varImpPlot(), I used the construct:

    if (nmeas > 1) {
        op <- par(mfrow=c(1, 2), mar=c(4, 5, 4, 1), mgp=c(2, .8, 0),
                  oma=c(0, 0, 2, 0))
        on.exit(par(op))
    }

The weird thing is that even after I commented out the entire section
above, I still get the same error at the same place!  Running the
original code in an interactive session produced no error or warning.
I'm quite at my wit's end.  Would very much appreciate any help!

Best,
Andy



Andy Liaw, PhD
Biometrics Research    PO Box 2000 RY33-300
Merck Research Labs        Rahway, NJ 07065
andy_liaw(a)merck.com          732-594-0820



------------------------------------------------------------------------------
Notice:  This e-mail message, together with any attachments,...{{dropped}}


From rcheng at purdue.edu  Thu Nov 30 06:43:29 2006
From: rcheng at purdue.edu (Riyan Cheng)
Date: Thu, 30 Nov 2006 00:43:29 -0500
Subject: [Rd] data.frame within a function (PR#9294) (cont'd)
Message-ID: <456E6F81.9070508@purdue.edu>

This continues the message "data.frame within a function (PR#9294)" that 
was posted on 2006/10/12. Duncan Murdoch kindly replied. I'm using the 
current version R 2.4.0, but the same issue exists. Just copy and paste 
the following code under R, and compare the output of f1() and f2() and 
the output of f3() and f4(). Does anybody have any idea? Thanks.

###################################################
# R code for demonstration only #
###########################

rmvnorm<- function (n, mean = rep(0, nrow(sigma)), sigma = 
diag(length(mean))){
  if (nrow(sigma) != ncol(sigma)) {
    stop("sigma must be a square matrix")
  }
  if (length(mean) != nrow(sigma)) {
    stop("mean and sigma have non-conforming size")
  }
  ev <- eigen(sigma, sym = TRUE)$values
  if (!all(ev >= -sqrt(.Machine$double.eps) * abs(ev[1])))
    warning("sigma is numerically not positive definite")
  sigsvd <- svd(sigma)
  retval <- t(sigsvd$v %*% (t(sigsvd$u) * sqrt(sigsvd$d)))
  retval <- matrix(rnorm(n * ncol(sigma)), nrow = n) %*% retval
  retval <- sweep(retval, 2, mean, "+")
  retval
}

f<- function(obj){
     update(obj,~ .+x,evaluate=T); cat("also ok\n")
}

#########################
# compare f1() and f2() #
#########################
f1<- function(){
     x<- rnorm(10)
     y<- rmvnorm(10,mean=c(1,2)); colnames(y)<- paste("y",1:2,sep="") 
#c("y1","y2")
     dtf<- data.frame(y,x)
     lm1<- lm(cbind(y1,y2)~1,data=dtf); cat("ok\n")
    
     update(lm1,~ .+x,evaluate=T); cat("also ok\n") # only this line is 
different
}
f2<- function(){
     x<- rnorm(10)
     y<- rmvnorm(10,mean=c(1,2)); colnames(y)<- paste("y",1:2,sep="") 
#c("y1","y2")
     dtf<- data.frame(y,x)
     lm1<- lm(cbind(y1,y2)~1,data=dtf); cat("ok\n")
    
     f(lm1) # only this line is different
}

f1()
f2()

#########################
# compare f3() and f4() #
#########################
f3<- function(){
     x<- rnorm(10)
     y<- rmvnorm(10,mean=c(1,2)); colnames(y)<- paste("y",1:2,sep="") 
#c("y1","y2")
     lm1<- lm(cbind(y1,y2)~1,data=data.frame(y,x)); cat("ok\n")
    
     update(lm1,~ .+x,evaluate=T); cat("also ok\n") # only this line is 
different
}
f4<- function(){
     x<- rnorm(10)
     y<- rmvnorm(10,mean=c(1,2)); colnames(y)<- paste("y",1:2,sep="") 
#c("y1","y2")
     lm1<- lm(cbind(y1,y2)~1,data=data.frame(y,x)); cat("ok\n")
    
     f(lm1) # only this line is different
}

f3()
f4()

#########
# the end #
#########


From ripley at stats.ox.ac.uk  Thu Nov 30 08:14:43 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 30 Nov 2006 07:14:43 +0000 (GMT)
Subject: [Rd] Error 1 : undefined first referenced symbol
In-Reply-To: <8B84F82763C82847899FB0346848B8F606482C68@SRVWEXCHP05.int.imd.ch>
References: <8B84F82763C82847899FB0346848B8F606482C68@SRVWEXCHP05.int.imd.ch>
Message-ID: <Pine.LNX.4.64.0611300707370.19026@gannet.stats.ox.ac.uk>

On Wed, 29 Nov 2006, Steiner, Julien wrote:

> I'm having trouble building R under Unix. I've searched for information
> about it on google or the R database but I didn't find any answer on my
> problem. I would be thankful if somebody could help me working that out.

It has been discussed several times on the R lists.

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/86605.html

is one such discussion.  No one has come back to say they still have a 
problem after checking the compiler in use (and others have reported using 
R 2.4.0 on Solaris 10).

> The version of R I'm trying to build is R-2.4.0 and the architecture of
> solaris is sparc.

And gcc is 3.4.2 (far from current) on Solaris 10, it appears from

> -L/opt/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.2

[...]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From postgateway at blogger.com  Thu Nov 30 09:05:20 2006
From: postgateway at blogger.com (postgateway at blogger.com)
Date: Thu, 30 Nov 2006 09:05:20 +0100 (CET)
Subject: [Rd] Blogger post failed (PR#9402)
Message-ID: <20061130080520.CFAB755E6E@slim.kubism.ku.dk>

Blogger could not process your message at this time.

Error code: 4.1208A26

Original message:
From: "r-bugs at r-project.org"@blogger.com
Date: Thu, 30 Nov 2006 13:37:30 +0000
Subject: Re: Hi
None


From ripley at stats.ox.ac.uk  Thu Nov 30 09:13:40 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 30 Nov 2006 08:13:40 +0000 (GMT)
Subject: [Rd] R-devel does not compile under FreeBSD-7.0 CURRENT
In-Reply-To: <456DF604.1000306@gwdg.de>
References: <456DF604.1000306@gwdg.de>
Message-ID: <Pine.LNX.4.64.0611300809430.8049@gannet.stats.ox.ac.uk>

As I said to you privately, I believe this to be a make issue: does GNU 
make work?  We don't guarantee R to work with other makes (although it 
usually does).

My guess is that the problem is the missing .m in the .SUFFIXES list
in Makeconf.in, but Solaris make and GNU make see no problem and it looks 
like a make bug to me.  I've added the suffix, so please try the current 
version.

(This seems to be related to adding ObjC support which is apparently 
currently incomplete.)

On Wed, 29 Nov 2006, Rainer Hurling wrote:

> I am not able to compile R-devel 2006-11-28 under FreeBSD-7.0 CURRENT. After 
> running ./configure script 'make' stops with the following error message:
>
> --------------------------
> #make
> gcc -I. -I./src/include -I./src/include -I/usr/local/include
> -DHAVE_CONFIG_H -g -O2 -c  -o .m.o
> gcc: No input files specified
> *** Error code 1
>
> Stop in /usr/local/R-devel.
> #
> --------------------------
>
> I attached configure messages. If wanted I can send complete config.log (460 
> kByte).
>
> Are their any ideas about what is going wrong? If I could help with more 
> information or with testing, please let me know.
>
> Thanks,
> Rainer Hurling
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Nov 30 09:14:01 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 30 Nov 2006 08:14:01 +0000 (GMT)
Subject: [Rd] strange error from R CMD check about xaxp
In-Reply-To: <39B6DDB9048D0F4DAD42CB26AAFF0AFA03536179@usctmx1106.merck.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA03536179@usctmx1106.merck.com>
Message-ID: <Pine.LNX.4.64.0611300717410.19026@gannet.stats.ox.ac.uk>

I've also seen this checking randomForest.  It looks like the result of 
memory corruption, so please try with valgrind and/or using gctorture.

On Wed, 29 Nov 2006, Liaw, Andy wrote:

> Dear R-devel,
>
> Kurt had alerted me to the problem that the randomForest package that I
> maintain has been failing checks in R-devel.  However, I just can't see
> why or where it's failing.  I'd very much appreciate any pointer.
>
> The failure occur when running the example code in varImpPlot.Rd:
>
>> varImpPlot(mtcars.rf)
> Error in par(opar) : invalid value specified for graphical parameter
> "xaxp"
> Execution halted
>
> However, I do not have "par(opar)" or set xaxp anywhere in any of the

example has par(opar) in it (although not I think in the case you are 
using), as do several graphics functions.

> .Rd or .R files in the package.  In varImpPlot(), I used the construct:
>
>    if (nmeas > 1) {
>        op <- par(mfrow=c(1, 2), mar=c(4, 5, 4, 1), mgp=c(2, .8, 0),
>                  oma=c(0, 0, 2, 0))
>        on.exit(par(op))
>    }
>
> The weird thing is that even after I commented out the entire section
> above, I still get the same error at the same place!  Running the
> original code in an interactive session produced no error or warning.
> I'm quite at my wit's end.  Would very much appreciate any help!
>
> Best,
> Andy
>
>
>
> Andy Liaw, PhD
> Biometrics Research    PO Box 2000 RY33-300
> Merck Research Labs        Rahway, NJ 07065
> andy_liaw(a)merck.com          732-594-0820
>
>
>
> ------------------------------------------------------------------------------
> Notice:  This e-mail message, together with any attachments,...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.uni-dortmund.de  Thu Nov 30 10:15:20 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Thu, 30 Nov 2006 10:15:20 +0100
Subject: [Rd] R CMD check warning about boot ?
In-Reply-To: <17774.1882.621732.219274@basebud.nulle.part>
References: <17774.1882.621732.219274@basebud.nulle.part>
Message-ID: <456EA128.6050805@statistik.uni-dortmund.de>



Dirk Eddelbuettel wrote:
> Running R CMD check on a local package, I get
> 
> * checking Rd files ... OK
> * checking Rd cross-references ... WARNING
> Error in .find.package(package, lib.loc) :
>         there is no package called 'boot'

Probably the boot installation in one of your libraries is corrupted.

Uwe

> Execution halted
> * checking for missing documentation entries ... OK
> * checking for code/documentation mismatches ... OK
> 
> The output is spurious -- I do not use boot, but do have it installed.
> 
> This is with R-patched as of Nov 25 as well as Nov 03. Am I overlooking
> something, or is this a buglet?
> 
> Regards, Dirk
>


From p.dalgaard at biostat.ku.dk  Thu Nov 30 10:59:13 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 30 Nov 2006 10:59:13 +0100
Subject: [Rd] Web site link problems (PR#9401)
In-Reply-To: <20061129231150.3F3BE536A2@slim.kubism.ku.dk>
References: <20061129231150.3F3BE536A2@slim.kubism.ku.dk>
Message-ID: <456EAB71.20909@biostat.ku.dk>

ross at biostat.ucsf.edu wrote:
> Full_Name: Ross Boylan
> Version: N/A
> OS: Linux
> Submission from: (NULL) (198.144.201.14)
>
>
> 1. http://www.r-project.org/posting-guide.html includes
> "Paul Johnson's R tips page is a organized collection of how to do things in R,
> with many questions and tips culled from R-help"
> "R tips" is a link to http://www.ku.edu/~pauljohn/R/Rtips.html.  I get a message
> the page is no longer there when I try it.
>
> Desired state: delete or point to an active version of the document, unless this
> is some transitory problem.
>
>   
The R tips seem to be found at http://pj.freefaculty.org/R/Rtips.html 
these days (but even PJ's official home page has a link to 
http://www.ku.edu/~pauljohn...).

It might be better to link to the R Wiki, though. E.g., at
http://wiki.r-project.org/rwiki/doku.php?id=tips:tips
> 2. http://www.r-project.org/posting-guide.html includes in the section
> Surprising behavior and bugs, "make sure you read R Bugs in the R-faq."  The
> latter is the link http://cran.r-project.org/doc/FAQ/R-FAQ.html#R%20Bugs, which
> takes me to the page but not the section.  The link on the FAQ page to that
> section is http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs (i.e., no %20).
>
> Desired state: update the link.
>   
Yes. (It's only a half-page scroll plus an extra click though...)
> You also might want to consider footers on your web pages saying "to report
> problems with this web page do xxxxx".  The pages I looked at didn't have this
> info, as far as I can tell.
>   
Maybe, if it is easy. The whole bug repository is overdue for 
replacement, so things that are not critical and/or easy to fix may be 
left alone... 
> I hope this is an appropriate place to let you know!
>   
It'll do. Don't report other website issues to the bug repository though.

> Thanks for your work on R.
>
>
>


From ripley at stats.ox.ac.uk  Thu Nov 30 11:32:14 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 30 Nov 2006 10:32:14 +0000 (GMT)
Subject: [Rd] data.frame within a function (PR#9294) (cont'd)
In-Reply-To: <456E6F81.9070508@purdue.edu>
References: <456E6F81.9070508@purdue.edu>
Message-ID: <Pine.LNX.4.64.0611301021020.4539@gannet.stats.ox.ac.uk>

This is not to do with your subject line, and not a bug (and PR#9294 as 
been closed).  You don't even say what you think the 'issue' is: it seems 
to be your lack of understanding of the scope rules.

I get

> f2()
ok
Error in inherits(x, "data.frame") : object "dtf" not found

which is quite correct: dtf is not visible from the body of f() where you 
call update(evaluate=T) (the default, and use TRUE please).  This is why 
update has an 'evaluate' argument, so you can manage the scope used.


On Thu, 30 Nov 2006, Riyan Cheng wrote:

> This continues the message "data.frame within a function (PR#9294)" that
> was posted on 2006/10/12. Duncan Murdoch kindly replied. I'm using the
> current version R 2.4.0, but the same issue exists. Just copy and paste
> the following code under R, and compare the output of f1() and f2() and
> the output of f3() and f4(). Does anybody have any idea? Thanks.
>
> ###################################################
> # R code for demonstration only #
> ###########################
>
> rmvnorm<- function (n, mean = rep(0, nrow(sigma)), sigma =
> diag(length(mean))){
>  if (nrow(sigma) != ncol(sigma)) {
>    stop("sigma must be a square matrix")
>  }
>  if (length(mean) != nrow(sigma)) {
>    stop("mean and sigma have non-conforming size")
>  }
>  ev <- eigen(sigma, sym = TRUE)$values
>  if (!all(ev >= -sqrt(.Machine$double.eps) * abs(ev[1])))
>    warning("sigma is numerically not positive definite")
>  sigsvd <- svd(sigma)
>  retval <- t(sigsvd$v %*% (t(sigsvd$u) * sqrt(sigsvd$d)))
>  retval <- matrix(rnorm(n * ncol(sigma)), nrow = n) %*% retval
>  retval <- sweep(retval, 2, mean, "+")
>  retval
> }
>
> f<- function(obj){
>     update(obj,~ .+x,evaluate=T); cat("also ok\n")
> }
>
> #########################
> # compare f1() and f2() #
> #########################
> f1<- function(){
>     x<- rnorm(10)
>     y<- rmvnorm(10,mean=c(1,2)); colnames(y)<- paste("y",1:2,sep="")
> #c("y1","y2")
>     dtf<- data.frame(y,x)
>     lm1<- lm(cbind(y1,y2)~1,data=dtf); cat("ok\n")
>
>     update(lm1,~ .+x,evaluate=T); cat("also ok\n") # only this line is
> different
> }
> f2<- function(){
>     x<- rnorm(10)
>     y<- rmvnorm(10,mean=c(1,2)); colnames(y)<- paste("y",1:2,sep="")
> #c("y1","y2")
>     dtf<- data.frame(y,x)
>     lm1<- lm(cbind(y1,y2)~1,data=dtf); cat("ok\n")
>
>     f(lm1) # only this line is different
> }
>
> f1()
> f2()
>
> #########################
> # compare f3() and f4() #
> #########################
> f3<- function(){
>     x<- rnorm(10)
>     y<- rmvnorm(10,mean=c(1,2)); colnames(y)<- paste("y",1:2,sep="")
> #c("y1","y2")
>     lm1<- lm(cbind(y1,y2)~1,data=data.frame(y,x)); cat("ok\n")
>
>     update(lm1,~ .+x,evaluate=T); cat("also ok\n") # only this line is
> different
> }
> f4<- function(){
>     x<- rnorm(10)
>     y<- rmvnorm(10,mean=c(1,2)); colnames(y)<- paste("y",1:2,sep="")
> #c("y1","y2")
>     lm1<- lm(cbind(y1,y2)~1,data=data.frame(y,x)); cat("ok\n")
>
>     f(lm1) # only this line is different
> }
>
> f3()
> f4()
>
> #########
> # the end #
> #########
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Rainer.Hurling at nw-fva.de  Thu Nov 30 12:04:14 2006
From: Rainer.Hurling at nw-fva.de (Rainer Hurling)
Date: Thu, 30 Nov 2006 12:04:14 +0100
Subject: [Rd] R-devel does not compile under FreeBSD-7.0 CURRENT
In-Reply-To: <Pine.LNX.4.64.0611300809430.8049@gannet.stats.ox.ac.uk>
References: <456DF604.1000306@gwdg.de>
	<Pine.LNX.4.64.0611300809430.8049@gannet.stats.ox.ac.uk>
Message-ID: <456EBAAE.5030906@nw-fva.de>

You are right. Yesterday evening I did not understand the context 
between your presumption ('recent ObjC changes') and the make command 
from FreeBSD itself. Sorry.

I started a second try with R-devel (2006-11-29) and was able to compile 
and install with 'gmake && gmake install' instead of 'make && make install'.

If I understand right, I have to wait for next R-devel to try out the 
change with the suffix. I will report if I have tested it with 'make'.

Rainer


Prof Brian Ripley wrote:
> As I said to you privately, I believe this to be a make issue: does GNU 
> make work?  We don't guarantee R to work with other makes (although it 
> usually does).
> 
> My guess is that the problem is the missing .m in the .SUFFIXES list
> in Makeconf.in, but Solaris make and GNU make see no problem and it 
> looks like a make bug to me.  I've added the suffix, so please try the 
> current version.
> 
> (This seems to be related to adding ObjC support which is apparently 
> currently incomplete.)
> 
> On Wed, 29 Nov 2006, Rainer Hurling wrote:
> 
>> I am not able to compile R-devel 2006-11-28 under FreeBSD-7.0 CURRENT. 
>> After running ./configure script 'make' stops with the following error 
>> message:
>>
>> --------------------------
>> #make
>> gcc -I. -I./src/include -I./src/include -I/usr/local/include
>> -DHAVE_CONFIG_H -g -O2 -c  -o .m.o
>> gcc: No input files specified
>> *** Error code 1
>>
>> Stop in /usr/local/R-devel.
>> #
>> --------------------------
>>
>> I attached configure messages. If wanted I can send complete 
>> config.log (460 kByte).
>>
>> Are their any ideas about what is going wrong? If I could help with 
>> more information or with testing, please let me know.


From Kurt.Hornik at wu-wien.ac.at  Thu Nov 30 12:37:37 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Thu, 30 Nov 2006 12:37:37 +0100
Subject: [Rd] R CMD check warning about boot ?
In-Reply-To: <456EA128.6050805@statistik.uni-dortmund.de>
References: <17774.1882.621732.219274@basebud.nulle.part>
	<456EA128.6050805@statistik.uni-dortmund.de>
Message-ID: <17774.49793.503972.781158@mithrandir.hornik.net>

>>>>> Uwe Ligges writes:

> Dirk Eddelbuettel wrote:
>> Running R CMD check on a local package, I get
>> 
>> * checking Rd files ... OK
>> * checking Rd cross-references ... WARNING
>> Error in .find.package(package, lib.loc) :
>> there is no package called 'boot'

> Probably the boot installation in one of your libraries is corrupted.

Actually, the question is where boot is installed.  The code does

    aliases <-
        lapply(unlist(.get_standard_package_names()[c("base",
                                                      "recommended")],
                      use.names = FALSE),
               Rd_aliases, lib.loc = .Library)
                                     ********

-k				     

> Uwe

>> Execution halted
>> * checking for missing documentation entries ... OK
>> * checking for code/documentation mismatches ... OK
>> 
>> The output is spurious -- I do not use boot, but do have it installed.
>> 
>> This is with R-patched as of Nov 25 as well as Nov 03. Am I overlooking
>> something, or is this a buglet?
>> 
>> Regards, Dirk
>> 

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From atp at piskorski.com  Thu Nov 30 14:48:13 2006
From: atp at piskorski.com (Andrew Piskorski)
Date: Thu, 30 Nov 2006 08:48:13 -0500
Subject: [Rd] use one custom package with multiple R versions?
Message-ID: <20061130134813.GA64449@tehun.pair.com>

I'd like to install several different versions of R from source.  I'm
doing this on Ubuntu Linux 6.06 Dapper x86-64, which ships with R
2.2.1, so the versions of R I want to use are (for now) 2.2.1, 2.4.x,
and the development head.

Fetching the sources with Subversion and running configure with
something like "--prefix=/usr/local/R-2.4-branch-20061130" is
straightforward, but are there any other best practices I should be
aware of for using multiple R installs?

In particular, I wonder how to best handle my custom R packages, some
of which contain compiled C or Fortran.  Is it safe to use only ONE
copy of each of my packages for all versions of R, or do I need a
separate version of each package for each R version?

If I do need a separate package per version of R, is it possible (and
advisable?) to manage that from a single source tree, or am I forced
to have multiple source working copies?

(I see that R CMD INSTALL has a "--with-package-versions" option, but
I think that's about using multiple versions of a package with one
version of R, while I want the vice versa.)

Thanks!

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From edd at debian.org  Thu Nov 30 15:06:46 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 30 Nov 2006 08:06:46 -0600
Subject: [Rd] R CMD check warning about boot ?
In-Reply-To: <17774.49793.503972.781158@mithrandir.hornik.net>
References: <17774.1882.621732.219274@basebud.nulle.part>
	<456EA128.6050805@statistik.uni-dortmund.de>
	<17774.49793.503972.781158@mithrandir.hornik.net>
Message-ID: <17774.58742.482456.68184@basebud.nulle.part>


On 30 November 2006 at 12:37, Kurt Hornik wrote:
| >>>>> Uwe Ligges writes:
| 
| > Dirk Eddelbuettel wrote:
| >> Running R CMD check on a local package, I get
| >> 
| >> * checking Rd files ... OK
| >> * checking Rd cross-references ... WARNING
| >> Error in .find.package(package, lib.loc) :
| >> there is no package called 'boot'
| 
| > Probably the boot installation in one of your libraries is corrupted.
| 
| Actually, the question is where boot is installed.  The code does
| 
|     aliases <-
|         lapply(unlist(.get_standard_package_names()[c("base",
|                                                       "recommended")],
|                       use.names = FALSE),
|                Rd_aliases, lib.loc = .Library)
|                                      ********

> LL <- library()
Warning message:
library %G,Ab??(B%@/usr/lib/R/site-library%G,Ab??(B%@ contains no packages in: library() 
> LL$results[ LL$results[,1]=="boot", 2 ]
[1] "/usr/local/lib/R/site-library"
> LL$results[ LL$results[,1]=="boot", 1:2 ]
                        Package                         LibPath 
                         "boot" "/usr/local/lib/R/site-library" 
> dim(LL$results)
[1] 140   3
> .libPaths()
[1] "/usr/local/lib/R/site-library" "/usr/lib/R/site-library"       "/usr/lib/R/library"           
> 

The boot package loads fine, and is current.  Why does R CMD check think it
is an error that boot happens to live in a particular directory, for as long
as that directory is known to .libPaths() ?

Dirk 


-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From tshort at eprisolutions.com  Thu Nov 30 15:09:47 2006
From: tshort at eprisolutions.com (tshort at eprisolutions.com)
Date: Thu, 30 Nov 2006 15:09:47 +0100 (CET)
Subject: [Rd] bug in acosh (win32) (PR#9403)
Message-ID: <20061130140947.48027103EA@slim.kubism.ku.dk>

Full_Name: Tom Short
Version: 2.4.0
OS: Windows XP
Submission from: (NULL) (68.236.159.227)


It looks like there's a bug in acosh with complex number in windows:

> acosh(2)
[1] 1.316958
> acosh(2+0i)
[1] 0+NaNi

This happens for me on Windows XP with the following versions:
R version 2.2.0, 2005-10-06, i386-pc-mingw32 
R version 2.4.0 (2006-10-03) i386-pc-mingw32

It works fine with the following:
R version 2.4.0 (2006-10-03) i386-pc-linux-gnu (debian)
R version 2.1.0, 2005-04-18, i386-pc-linux-gnu (debian)

> acosh(2+0i)
[1] 1.316958+0i

I didn't find any problem with asinh or atanh taking complex numbers. In
src/main/complex.c, there are some #ifdef Win32's in z_asin and z_acos, so it
may be related to that.

- Tom

Tom Short
EPRI Solutions, Inc.


From simon.urbanek at r-project.org  Thu Nov 30 16:39:33 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 30 Nov 2006 10:39:33 -0500
Subject: [Rd] use one custom package with multiple R versions?
In-Reply-To: <20061130134813.GA64449@tehun.pair.com>
References: <20061130134813.GA64449@tehun.pair.com>
Message-ID: <DEE32506-2845-48F0-B56A-0DBF320185AB@r-project.org>


On Nov 30, 2006, at 8:48 AM, Andrew Piskorski wrote:

> I'd like to install several different versions of R from source.   
> I'm doing this on Ubuntu Linux 6.06 Dapper x86-64, which ships with  
> R 2.2.1, so the versions of R I want to use are (for now) 2.2.1,  
> 2.4.x, and the development head.
>
> Fetching the sources with Subversion and running configure with  
> something like "--prefix=/usr/local/R-2.4-branch-20061130" is  
> straightforward, but are there any other best practices I should be  
> aware of for using multiple R installs?
>

Personally, I prefer using default prefix (i.e. the equivalent to -- 
prefix=/usr/local) and then use
make install rhome=/usr/local/R/2.4
The advantage of this is that it will behave as if it was installed  
in the regular prefix and thus handling things like external  
libraries is much less painful. Just make sure you create proper  
symlinks for starting such beasts, because the start script in /usr/ 
local/bin will be overwritten on each install (but the 'real'  one is  
in $rhome/bin anyway).

Note, however, that you don't need to install R in order to use it,  
so many people just run it from the build directory and don't bother  
running make install at all.


> In particular, I wonder how to best handle my custom R packages,  
> some of which contain compiled C or Fortran.  Is it safe to use  
> only ONE copy of each of my packages for all versions of R, or do I  
> need a separate version of each package for each R version?
>

For each R version you should be using separate packages. In practice  
packages sometimes work across versions (patch versions are usually  
safe, minor versions are safe only sometimes - it is still not  
recommended). When working with snapshots, you can usually use the  
same set of packages and re-compile only if things go wrong.


> If I do need a separate package per version of R, is it possible  
> (and advisable?) to manage that from a single source tree, or am I  
> forced to have multiple source working copies?
>

You can always use same source tree - that's not the problem. The  
main reason for keeping separate installations (of the same) packages  
is binary compatibility which is not guaranteed across versions.  
Packages without Fortran/C code can be often shared across versions -  
i.e. you can set R_LIBS such that you have version-specific directory  
first and a common directory second.


> (I see that R CMD INSTALL has a "--with-package-versions" option,  
> but I think that's about using multiple versions of a package with  
> one version of R, while I want the vice versa.)
>

Yes, that's the case.

Cheers,
Simon


From atp at piskorski.com  Thu Nov 30 18:09:49 2006
From: atp at piskorski.com (Andrew Piskorski)
Date: Thu, 30 Nov 2006 12:09:49 -0500
Subject: [Rd] use one custom package with multiple R versions?
In-Reply-To: <DEE32506-2845-48F0-B56A-0DBF320185AB@r-project.org>
References: <20061130134813.GA64449@tehun.pair.com>
	<DEE32506-2845-48F0-B56A-0DBF320185AB@r-project.org>
Message-ID: <20061130170949.GC34804@tehun.pair.com>

On Thu, Nov 30, 2006 at 10:39:33AM -0500, Simon Urbanek wrote:

> Personally, I prefer using default prefix (i.e. the equivalent to -- 
> prefix=/usr/local) and then use
> make install rhome=/usr/local/R/2.4
> The advantage of this is that it will behave as if it was installed  
> in the regular prefix and thus handling things like external  
> libraries is much less painful. Just make sure you create proper  

Simon, I don't understand the distinction, could you explain what
these two methods do differently, please?  And how does this affect
the use of external libraries?

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From ross at biostat.ucsf.edu  Thu Nov 30 19:04:32 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Thu, 30 Nov 2006 10:04:32 -0800
Subject: [Rd] Web site link problems (PR#9401)
In-Reply-To: <456EAB71.20909@biostat.ku.dk>
References: <20061129231150.3F3BE536A2@slim.kubism.ku.dk>
	<456EAB71.20909@biostat.ku.dk>
Message-ID: <20061130180432.GR4431@wheat.betterworld.us>

On Thu, Nov 30, 2006 at 10:59:13AM +0100, Peter Dalgaard wrote:
> ross at biostat.ucsf.edu wrote:
....
> >2. http://www.r-project.org/posting-guide.html includes in the section
> >Surprising behavior and bugs, "make sure you read R Bugs in the R-faq."  
> >The
> >latter is the link http://cran.r-project.org/doc/FAQ/R-FAQ.html#R%20Bugs, 
> >which
> >takes me to the page but not the section.  The link on the FAQ page to that
> >section is http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs (i.e., no 
> >%20).
> >
> >Desired state: update the link.
> >  
> Yes. (It's only a half-page scroll plus an extra click though...)

The risk is that someone will just conclude it's a bad link and stop
there.

> >You also might want to consider footers on your web pages saying "to report
> >problems with this web page do xxxxx".  The pages I looked at didn't have 
> >this
> >info, as far as I can tell.
> >  
> Maybe, if it is easy. The whole bug repository is overdue for 
> replacement, so things that are not critical and/or easy to fix may be 
> left alone... 
> >I hope this is an appropriate place to let you know!
> >  
> It'll do. Don't report other website issues to the bug repository though.
OK.  Where should such reports go?

Ross


From aim at stats.uwo.ca  Thu Nov 30 20:20:13 2006
From: aim at stats.uwo.ca (aim at stats.uwo.ca)
Date: Thu, 30 Nov 2006 20:20:13 +0100 (CET)
Subject: [Rd] bug in arima? (PR#9404)
Message-ID: <20061130192013.C242D41F05@slim.kubism.ku.dk>

I don't think arima works exactly the way one would expect when there is differencing.  What I think should happen is that by 
default the mean of the differenced series is estimated and if include.mean=F, then it is not.  This is not what happens.  Instead 
when there is differencing the include.mean argument is ignored.

Now I guess, someone could argue that the mean of the original series doesn't exist when using a model with differencing.  In this 
case, then the arima function doesn't conveniently estimate models with deterministic drift like the ARIMA(0,1,1) with drift.  Such 
models are occassionally important.

As a workaround, one can do the differencing outside of arima.  But I don't think things should work like that!

Most other time series software doesn't do this.

Ian McLeod


From aim at stats.uwo.ca  Thu Nov 30 20:19:53 2006
From: aim at stats.uwo.ca (A.I. McLeod)
Date: Thu, 30 Nov 2006 14:19:53 -0500
Subject: [Rd] bug in arima?
Message-ID: <000f01c714b4$86e54670$884c6481@stats2.uwo.ca>

I don't think arima works exactly the way one would expect when there is differencing.  What I think should happen is that by 
default the mean of the differenced series is estimated and if include.mean=F, then it is not.  This is not what happens.  Instead 
when there is differencing the include.mean argument is ignored.

Now I guess, someone could argue that the mean of the original series doesn't exist when using a model with differencing.  In this 
case, then the arima function doesn't conveniently estimate models with deterministic drift like the ARIMA(0,1,1) with drift.  Such 
models are occassionally important.

As a workaround, one can do the differencing outside of arima.  But I don't think things should work like that!

Most other time series software doesn't do this.

Ian McLeod


From murdoch at stats.uwo.ca  Thu Nov 30 20:40:52 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Thu, 30 Nov 2006 20:40:52 +0100 (CET)
Subject: [Rd] bug in arima? (PR#9404)
Message-ID: <20061130194052.0A38E572AD@slim.kubism.ku.dk>

On 11/30/2006 2:20 PM, aim at stats.uwo.ca wrote:
> I don't think arima works exactly the way one would expect when there is differencing.  What I think should happen is that by 
> default the mean of the differenced series is estimated and if include.mean=F, then it is not.  This is not what happens.  Instead 
> when there is differencing the include.mean argument is ignored.

But it's working as documented, so this is not a bug.  I'd be very 
reluctant to change the meaning of that parameter.

Duncan

> Now I guess, someone could argue that the mean of the original series doesn't exist when using a model with differencing.  In this 
> case, then the arima function doesn't conveniently estimate models with deterministic drift like the ARIMA(0,1,1) with drift.  Such 
> models are occassionally important.
> 
> As a workaround, one can do the differencing outside of arima.  But I don't think things should work like that!
> 
> Most other time series software doesn't do this.


From mtmorgan at fhcrc.org  Thu Nov 30 21:06:53 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 30 Nov 2006 12:06:53 -0800
Subject: [Rd] viral setClassUnion?
Message-ID: <6phu00g66n6.fsf@gopher4.fhcrc.org>

I'm looking for help with the following warning message:

Subclass "A" of class "numeric" is not local and cannot be updated for
new inheritance information; consider setClassUnion() in:
.checkSubclasses(class1, classDef, class2, classDef2, where1)

I see this with, e.g.,

R CMD INSTALL --clean

in a package with

DESCRIPTION: SaveImage: yes

and a single R file with

setClass("A", contains="numeric")
setClassUnion("B", members="numeric")
setClassUnion("D", members="character")
setClass("C", contains="character")

The order of setClass / setClassUnion, rather than the contains /
members type, is important; there is no message about C / D.

R version 2.5.0 Under development (unstable) (2006-11-30 r40072) 
x86_64-unknown-linux-gnu 

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[7] "base"     

-- 
Martin T. Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From ross at biostat.ucsf.edu  Thu Nov 30 21:17:55 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Thu, 30 Nov 2006 12:17:55 -0800
Subject: [Rd] printing coefficients with text
Message-ID: <20061130201755.GA8201@wheat.betterworld.us>

I want to print the coefficient estimates of a model in a way
as consistent with other output in R as possible. stats provides the
printCoefmat function for doing this, but there is one problem.  I
have an additional piece of textual information I want to put on the
line with the other info on each coefficient.

The documentation for printCoefmat says the first argument must be
numeric, which seems to rule this out.

I just realized I might be able to cheat by inserting the text into
the name of the variable (fortunately there is just one item of
text).  I think that's in the names of the matrix given as the first
argument to the function.

Are there any better solutions?  Obviously I could just copy the
method and modify it, but that creates duplicate code and loses the
ability to track future changes to printCoefmat.

Thanks.
Ross Boylan


From jleecbd at gmail.com  Thu Nov 30 21:51:48 2006
From: jleecbd at gmail.com (jleecbd at gmail.com)
Date: Thu, 30 Nov 2006 21:51:48 +0100 (CET)
Subject: [Rd] Magic Menu library loading error (PR#9405)
Message-ID: <20061130205148.C242C48E79@slim.kubism.ku.dk>

Full_Name: Jeff Lee
Version: 2.4.0
OS: Mac OS X 10.4 (Tiger)
Submission from: (NULL) (12.150.164.100)


Just upgraded to an Intel based Mac.  Upon launch, I receive the following
error:

2006-11-30 12:39:36.870 R[407] *** -[NSBundle load]: Error loading code
/Library/InputManagers/MagicMenuEnabler/MagicMenuEnabler.bundle/Contents/MacOS/MagicMenuEnabler
for bundle /Library/InputManagers/MagicMenuEnabler/MagicMenuEnabler.bundle,
error code 2 (link edit error code 0, error number 0 ())

Functioning of the system seems okay, however.


From deepayan.sarkar at gmail.com  Thu Nov 30 22:25:36 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Thu, 30 Nov 2006 13:25:36 -0800
Subject: [Rd] order of levels in interaction()
Message-ID: <eb555e660611301325o3f255372t4bced4bd0c51e52d@mail.gmail.com>

Hi,

?interaction says:

See Also:

     'factor'; ':' where 'f:g' is the similar to 'interaction(f, g,
     sep=":")' when 'f' and  'g' are factors.

This is not quite true (or maybe 'similar' is the operative word), since:

> f <- factor(1:3); g <- factor(letters[1:3])
> levels(f:g)
[1] "1:a" "1:b" "1:c" "2:a" "2:b" "2:c" "3:a" "3:b" "3:c"
> levels(interaction(f, g, sep = ":"))
[1] "1:a" "2:a" "3:a" "1:b" "2:b" "3:b" "1:c" "2:c" "3:c"

Note the different order of the levels. I like the order in f:g better
(and at least one other person agrees [1] ), but I also want the
flexibility of having a 'sep' argument. Would it be possible to change
interaction to allow this? A simple fix that makes interaction behave
like ":" is to replace

as.vector(outer(l, lvs, paste, sep = sep))

with

as.vector(t(outer(l, lvs, paste, sep = sep)))

in interaction.

-Deepayan

[1] http://tolstoy.newcastle.edu.au/R/help/06/08/32638.html


From ripley at stats.ox.ac.uk  Thu Nov 30 22:48:35 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 30 Nov 2006 21:48:35 +0000 (GMT)
Subject: [Rd] order of levels in interaction()
In-Reply-To: <eb555e660611301325o3f255372t4bced4bd0c51e52d@mail.gmail.com>
References: <eb555e660611301325o3f255372t4bced4bd0c51e52d@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0611302146210.19267@gannet.stats.ox.ac.uk>

On Thu, 30 Nov 2006, Deepayan Sarkar wrote:

> Hi,
>
> ?interaction says:
>
> See Also:
>
>     'factor'; ':' where 'f:g' is the similar to 'interaction(f, g,
>     sep=":")' when 'f' and  'g' are factors.
>
> This is not quite true (or maybe 'similar' is the operative word), since:
>
>> f <- factor(1:3); g <- factor(letters[1:3])
>> levels(f:g)
> [1] "1:a" "1:b" "1:c" "2:a" "2:b" "2:c" "3:a" "3:b" "3:c"
>> levels(interaction(f, g, sep = ":"))
> [1] "1:a" "2:a" "3:a" "1:b" "2:b" "3:b" "1:c" "2:c" "3:c"
>
> Note the different order of the levels. I like the order in f:g better
> (and at least one other person agrees [1] ), but I also want the
> flexibility of having a 'sep' argument. Would it be possible to change
> interaction to allow this? A simple fix that makes interaction behave
> like ":" is to replace

No, for it also says

      The levels are ordered so the level of the first factor varies
      fastest, then the second and so on.  This is the reverse of
      lexicographic ordering, and differs from ':'.  (It is done this
      way for compatibility with S.)

and reversing it would break things.  (It does, I tried it a while back.)

> as.vector(outer(l, lvs, paste, sep = sep))
>
> with
>
> as.vector(t(outer(l, lvs, paste, sep = sep)))
>
> in interaction.
>
> -Deepayan
>
> [1] http://tolstoy.newcastle.edu.au/R/help/06/08/32638.html
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From deepayan.sarkar at gmail.com  Thu Nov 30 22:53:48 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Thu, 30 Nov 2006 13:53:48 -0800
Subject: [Rd] order of levels in interaction()
In-Reply-To: <Pine.LNX.4.64.0611302146210.19267@gannet.stats.ox.ac.uk>
References: <eb555e660611301325o3f255372t4bced4bd0c51e52d@mail.gmail.com>
	<Pine.LNX.4.64.0611302146210.19267@gannet.stats.ox.ac.uk>
Message-ID: <eb555e660611301353w731fd7d9sac960b0b601dbc0d@mail.gmail.com>

On 11/30/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Thu, 30 Nov 2006, Deepayan Sarkar wrote:
>
> > Hi,
> >
> > ?interaction says:
> >
> > See Also:
> >
> >     'factor'; ':' where 'f:g' is the similar to 'interaction(f, g,
> >     sep=":")' when 'f' and  'g' are factors.
> >
> > This is not quite true (or maybe 'similar' is the operative word), since:
> >
> >> f <- factor(1:3); g <- factor(letters[1:3])
> >> levels(f:g)
> > [1] "1:a" "1:b" "1:c" "2:a" "2:b" "2:c" "3:a" "3:b" "3:c"
> >> levels(interaction(f, g, sep = ":"))
> > [1] "1:a" "2:a" "3:a" "1:b" "2:b" "3:b" "1:c" "2:c" "3:c"
> >
> > Note the different order of the levels. I like the order in f:g better
> > (and at least one other person agrees [1] ), but I also want the
> > flexibility of having a 'sep' argument. Would it be possible to change
> > interaction to allow this? A simple fix that makes interaction behave
> > like ":" is to replace
>
> No, for it also says
>
>       The levels are ordered so the level of the first factor varies
>       fastest, then the second and so on.  This is the reverse of
>       lexicographic ordering, and differs from ':'.  (It is done this
>       way for compatibility with S.)
>
> and reversing it would break things.  (It does, I tried it a while back.)

Ah, I should have read the help page more carefully.

I'll just write a custom version for my use, which is a fairly simple case.

-Deepayan

> > as.vector(outer(l, lvs, paste, sep = sep))
> >
> > with
> >
> > as.vector(t(outer(l, lvs, paste, sep = sep)))
> >
> > in interaction.
> >
> > -Deepayan
> >
> > [1] http://tolstoy.newcastle.edu.au/R/help/06/08/32638.html


