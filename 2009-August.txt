From rvaradhan at jhmi.edu  Sun Aug  2 22:25:27 2009
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Sun, 02 Aug 2009 16:25:27 -0400
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
Message-ID: <f5139d6efa66.4a75bdf7@johnshopkins.edu>

Dear All,

Hans Borchers and I have been trying to compute "exact" derivatives in R using the idea of complex-step derivatives that Hans has proposed.  This is a really, really cool idea.  It gives "exact" derivatives with only a minimal effort (same as that involved in computing first-order forward-difference derivative).  

Unfortunately, we cannot implement this in R as the "complex arithmetic" in R appears to be inaccurate.

Here is an example:

#-- Classical Rosenbrock function in n variables
rosen <- function(x) {
n <- length(x)
x1 <- x[2:n]
x2 <- x[1:(n-1)]
sum(100*(x1-x2^2)^2 + (1-x2)^2)
}


x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 0.0849, 0.4147, 0.4540)
h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
xh <- x0 + h

rx <- rosen(xh)
Re(rx)
Im (rx)

#  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect imaginary part in R

However, the imaginary part of the above answer is inaccurate.  The correct imaginary part (from Matlab) is:

190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part from Matlab

This inaccuracy is serious enough to affect the acuracy of the compex-step gradient drastically.

Hans and I were wondering if there is a way to obtain accurate "small" imaginary part for complex arithmetic.  

I am using Windows XP operating system.

Thanks for taking a look at this.

Best regards,
Ravi.


____________________________________________________________________

Ravi Varadhan, Ph.D.
Assistant Professor,
Division of Geriatric Medicine and Gerontology
School of Medicine
Johns Hopkins University

Ph. (410) 502-2619
email: rvaradhan at jhmi.edu


From jan.hattendorf at unibas.ch  Sat Aug  1 22:05:13 2009
From: jan.hattendorf at unibas.ch (jan.hattendorf at unibas.ch)
Date: Sat,  1 Aug 2009 22:05:13 +0200 (CEST)
Subject: [Rd] incorrect result (41/10-1/10)%%1 (PR#13863)
Message-ID: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>

Full_Name: jan hattendorf
Version: 2.9.0
OS: XP
Submission from: (NULL) (213.3.108.185)


I get an incorrect result for

(41/10-1/10)%%1

[1] 1

The error did not occur with other numbers than 41 (1, 11, 21, 31, 51, ...)


test <- rep(NA, 1000)
for(i in 1:1000){
  test[i] <- i/10-1/10
}
test[test%%1==0]


From P.Dalgaard at biostat.ku.dk  Mon Aug  3 09:41:58 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 03 Aug 2009 09:41:58 +0200
Subject: [Rd] incorrect result (41/10-1/10)%%1 (PR#13863)
In-Reply-To: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
References: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
Message-ID: <4A7694C6.8080307@biostat.ku.dk>

jan.hattendorf at unibas.ch wrote:
> Full_Name: jan hattendorf
> Version: 2.9.0
> OS: XP
> Submission from: (NULL) (213.3.108.185)
> 
> 
> I get an incorrect result for
> 
> (41/10-1/10)%%1
> 
> [1] 1
> 
> The error did not occur with other numbers than 41 (1, 11, 21, 31, 51, ...)
> 
> 
> test <- rep(NA, 1000)
> for(i in 1:1000){
>   test[i] <- i/10-1/10
> }
> test[test%%1==0]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

FAQ 7.31

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From sean.oriordain at gmail.com  Mon Aug  3 09:43:57 2009
From: sean.oriordain at gmail.com (Sean O'Riordain)
Date: Mon, 3 Aug 2009 08:43:57 +0100
Subject: [Rd] incorrect result (41/10-1/10)%%1 (PR#13863)
In-Reply-To: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
References: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
Message-ID: <8ed68eed0908030043ib6c93d1u58094fa1dfae87f1@mail.gmail.com>

Good morning Jan,

Could this be covered off by the following?

http://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f

Kind regards,
Sean

On Sat, Aug 1, 2009 at 9:05 PM, <jan.hattendorf at unibas.ch> wrote:
> Full_Name: jan hattendorf
> Version: 2.9.0
> OS: XP
> Submission from: (NULL) (213.3.108.185)
>
>
> I get an incorrect result for
>
> (41/10-1/10)%%1
>
> [1] 1
>
> The error did not occur with other numbers than 41 (1, 11, 21, 31, 51, ...)
>
>
> test <- rep(NA, 1000)
> for(i in 1:1000){
> ?test[i] <- i/10-1/10
> }
> test[test%%1==0]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Achim.Zeileis at wu-wien.ac.at  Mon Aug  3 09:45:09 2009
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Mon, 3 Aug 2009 09:45:09 +0200 (CEST)
Subject: [Rd] incorrect result (41/10-1/10)%%1 (PR#13863)
In-Reply-To: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
References: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
Message-ID: <Pine.LNX.4.64.0908030944140.19820@paninaro.stat-math.wu-wien.ac.at>

Not a bug, just a FAQ (7.31).
http://CRAN.R-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f

On Sat, 1 Aug 2009, jan.hattendorf at unibas.ch wrote:

> Full_Name: jan hattendorf
> Version: 2.9.0
> OS: XP
> Submission from: (NULL) (213.3.108.185)
>
>
> I get an incorrect result for
>
> (41/10-1/10)%%1
>
> [1] 1
>
> The error did not occur with other numbers than 41 (1, 11, 21, 31, 51, ...)
>
>
> test <- rep(NA, 1000)
> for(i in 1:1000){
>  test[i] <- i/10-1/10
> }
> test[test%%1==0]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From Thierry.ONKELINX at inbo.be  Mon Aug  3 09:50:34 2009
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Mon, 3 Aug 2009 09:50:34 +0200
Subject: [Rd] incorrect result (41/10-1/10)%%1 (PR#13863)
In-Reply-To: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
References: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
Message-ID: <2E9C414912813E4EB981326983E0A10406A3BF6B@inboexch.inbo.be>

This is not a bug. It is a case of R FAQ 7.34:
http://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-the
se-numbers-are-equal_003f 


------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to
say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of
data.
~ John Tukey

-----Oorspronkelijk bericht-----
Van: r-devel-bounces at r-project.org
[mailto:r-devel-bounces at r-project.org] Namens jan.hattendorf at unibas.ch
Verzonden: zaterdag 1 augustus 2009 22:05
Aan: r-devel at stat.math.ethz.ch
CC: R-bugs at r-project.org
Onderwerp: [Rd] incorrect result (41/10-1/10)%%1 (PR#13863)

Full_Name: jan hattendorf
Version: 2.9.0
OS: XP
Submission from: (NULL) (213.3.108.185)


I get an incorrect result for

(41/10-1/10)%%1

[1] 1

The error did not occur with other numbers than 41 (1, 11, 21, 31, 51,
...)


test <- rep(NA, 1000)
for(i in 1:1000){
  test[i] <- i/10-1/10
}
test[test%%1==0]

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer 
en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is
door een geldig ondertekend document. The views expressed in  this message 
and any annex are purely those of the writer and may not be regarded as stating 
an official position of INBO, as long as the message is not confirmed by a duly 
signed document.


From martin.becker at mx.uni-saarland.de  Mon Aug  3 11:49:50 2009
From: martin.becker at mx.uni-saarland.de (Martin Becker)
Date: Mon, 03 Aug 2009 11:49:50 +0200
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
Message-ID: <4A76B2BE.1060301@mx.uni-saarland.de>

Dear Ravi,

the inaccuracy seems to creep in when powers are calculated. Apparently, 
some quite general function is called to calculate the squares, and one 
can avoid the error by reformulating the example as follows:

rosen <- function(x) {
  n <- length(x)
  x1 <- x[2:n]
  x2 <- x[1:(n-1)]
  sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2))
}

x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 0.0849, 0.4147, 0.4540)
h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
xh <- x0 + h

rx <- rosen(xh)
Re(rx)
Im (rx)


I don't know which arithmetics are involved in the application you 
mentioned, but writing some auxiliary function for the calculation of 
x^n when x is complex and n is (a not too large) integer may solve some 
of the numerical issues. A simple version is:

powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))

The corresponding summation in 'rosen' would then read:

sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))


HTH,

  Martin


Ravi Varadhan wrote:
> Dear All,
>
> Hans Borchers and I have been trying to compute "exact" derivatives in R using the idea of complex-step derivatives that Hans has proposed.  This is a really, really cool idea.  It gives "exact" derivatives with only a minimal effort (same as that involved in computing first-order forward-difference derivative).  
>
> Unfortunately, we cannot implement this in R as the "complex arithmetic" in R appears to be inaccurate.
>
> Here is an example:
>
> #-- Classical Rosenbrock function in n variables
> rosen <- function(x) {
> n <- length(x)
> x1 <- x[2:n]
> x2 <- x[1:(n-1)]
> sum(100*(x1-x2^2)^2 + (1-x2)^2)
> }
>
>
> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 0.0849, 0.4147, 0.4540)
> h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
> xh <- x0 + h
>
> rx <- rosen(xh)
> Re(rx)
> Im (rx)
>
> #  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect imaginary part in R
>
> However, the imaginary part of the above answer is inaccurate.  The correct imaginary part (from Matlab) is:
>
> 190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part from Matlab
>
> This inaccuracy is serious enough to affect the acuracy of the compex-step gradient drastically.
>
> Hans and I were wondering if there is a way to obtain accurate "small" imaginary part for complex arithmetic.  
>
> I am using Windows XP operating system.
>
> Thanks for taking a look at this.
>
> Best regards,
> Ravi.
>
>
> ____________________________________________________________________
>
> Ravi Varadhan, Ph.D.
> Assistant Professor,
> Division of Geriatric Medicine and Gerontology
> School of Medicine
> Johns Hopkins University
>
> Ph. (410) 502-2619
> email: rvaradhan at jhmi.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
Dr. Martin Becker
Statistics and Econometrics
Saarland University
Campus C3 1, Room 206
66123 Saarbruecken
Germany


From savicky at cs.cas.cz  Mon Aug  3 11:50:01 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Mon, 3 Aug 2009 11:50:01 +0200
Subject: [Rd] incorrect result (41/10-1/10)%%1 (PR#13863)
In-Reply-To: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
References: <20090801200513.EC2A8282EF3D@mail.pubhealth.ku.dk>
Message-ID: <20090803095001.GA22251@cs.cas.cz>

> I get an incorrect result for
> 
> (41/10-1/10)%%1
> 
> [1] 1

Note that due to rounding errors, 41/10-1/10 is
  formatC(41/10-1/10, digits=20) # [1] "3.9999999999999995559"

Besides FAQ 7.31, related information may be found also at
  http://wiki.r-project.org/rwiki/doku.php?id=misc:r_accuracy

Petr.


From rphilosof at health.sdu.dk  Mon Aug  3 14:39:16 2009
From: rphilosof at health.sdu.dk (Rune Schjellerup Philosof)
Date: Mon, 03 Aug 2009 14:39:16 +0200
Subject: [Rd] debug: mtrace(fun, FALSE) doesn't work for me
Message-ID: <4A76DA74.8090107@health.sdu.dk>

Hi

tmp <- function(t=1) t+1
mtrace(tmp)
mtrace(tmp)
#Re-applying trace...
#Error in `[[<-`(`*tmp*`, 1, value = list(t + 1)) :
#  incompatible types (from list to expression) in [[ assignment

I think this used to work on my computer.
A month ago I upgraded R from r-base (2.9.0-4intrepid0) to 2.9.1-2intrepid.

Apparently it would be fixed if unmtrace is changed from
body(f) <- list(body(f)[[3]])
to
body(f) <- body(f)[[3]]

-- 
Regards
Rune Schjellerup Philosof
Ph.d.-studerende, Statistik, IST, SDU

Telefon:  6550 3607
E-mail:   rphilosof at health.sdu.dk
Adresse:  J.B. Winsl?wsvej 9, 5000 Odense C


From hwborchers at googlemail.com  Mon Aug  3 15:15:11 2009
From: hwborchers at googlemail.com (Hans W. Borchers)
Date: Mon, 3 Aug 2009 13:15:11 +0000 (UTC)
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
Message-ID: <loom.20090803T130914-544@post.gmane.org>

>

Thanks for pointing out the weak point in this computation. I tried out your
suggestions and they both deliver the correct and accurate result.

But as a general solution this approach is not feasible. We want to provide
"complex-step derivatives" as a new method for computing exact gradients, for
example in 'numDeriv::grad' as

    grad(fun, x, method="complex-step")

and we can not reasonably assume that a user prepares his function specially 
for calling this method.

I tried out other numerical math software besides Matlab, that is Octave,
Scilab, Euler and others, and they all return the same correct value up to 15
digits. Should we not expect that R is capable of doing the same?

Hans W. Borchers


Martin Becker <martin.becker <at> mx.uni-saarland.de> writes:

> 
> Dear Ravi,
> 
> the inaccuracy seems to creep in when powers are calculated. Apparently, 
> some quite general function is called to calculate the squares, and one 
> can avoid the error by reformulating the example as follows:
> 
> rosen <- function(x) {
>   n <- length(x)
>   x1 <- x[2:n]
>   x2 <- x[1:(n-1)]
>   sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2))
> }
> 
> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 0.0849,
0.4147, 0.4540)
> h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
> xh <- x0 + h
> 
> rx <- rosen(xh)
> Re(rx)
> Im (rx)
> 
> I don't know which arithmetics are involved in the application you 
> mentioned, but writing some auxiliary function for the calculation of 
> x^n when x is complex and n is (a not too large) integer may solve some 
> of the numerical issues. A simple version is:
> 
> powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))
> 
> The corresponding summation in 'rosen' would then read:
> 
> sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
> 
> HTH,
> 
>   Martin
>


From maechler at stat.math.ethz.ch  Mon Aug  3 19:30:24 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 3 Aug 2009 19:30:24 +0200
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <loom.20090803T130914-544@post.gmane.org>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
	<loom.20090803T130914-544@post.gmane.org>
Message-ID: <19063.7856.809632.43723@lynne.math.ethz.ch>

>>>>> "HWB" == Hans W Borchers <hwborchers at googlemail.com>
>>>>>     on Mon, 3 Aug 2009 13:15:11 +0000 (UTC) writes:

    >> 
    HWB> Thanks for pointing out the weak point in this
    HWB> computation. I tried out your suggestions and they both
    HWB> deliver the correct and accurate result.

    HWB> But as a general solution this approach is not
    HWB> feasible. We want to provide "complex-step derivatives"
    HWB> as a new method for computing exact gradients, for
    HWB> example in 'numDeriv::grad' as

    HWB>     grad(fun, x, method="complex-step")

    HWB> and we can not reasonably assume that a user prepares
    HWB> his function specially for calling this method.

    HWB> I tried out other numerical math software besides
    HWB> Matlab, that is Octave, Scilab, Euler and others, and
    HWB> they all return the same correct value up to 15
    HWB> digits. Should we not expect that R is capable of doing
    HWB> the same?

R's  "a ^ b"  on non-Windows typically uses the C library's
'cpow()'  when that is provided  (HAVE_C99_COMPLEX).

Indeed, this seems to use the "general" complex power function
which loses a few bits -- unavoidably.
Our Windows-version of complex  a ^ b  does so as well.

Here's an R version of what (I believe) once was the C library
cpow(); at least I confirm that it has the same slight
inaccuracy [if you are as this very border line case with '1e-15';
	    use  1e-12  and you have no problems !! ]

Cpow <- function(a,b)
{
  ## Purpose: a ^ b  in complex
  ## Find bug in  complex_pow()
  ## -------------------------------------------------------------------------
  ## Author: Martin Maechler, Date: 15 Jan 2000, 21:33

    a <- as.complex(a)
    b <- as.complex(b)

    hypot <- function(x,y)Mod(x + 1i*y)

    logr <- log(hypot(Re(a), Im(a)) );
    logi <- atan2(Im(a), Re(a));
    x <- exp( logr * Re(b) - logi * Im(b) );
    y <- logr * Im(b) + logi * Re(b);

    x * complex(re= cos(y), im= sin(y))
}

----------------

So, yes we could check for the special case of  "^2" and use
multiplication and then for   " ^ n " and ... ...
and only otherwise call cpow(x,y) {or our own C-version of
that}.

I'm looking into implenting that now.
Expect to hear more about it within 24 hours.

Martin Maechler, ETH Zurich


    HWB> Hans W. Borchers


    HWB> Martin Becker <martin.becker <at> mx.uni-saarland.de>
    HWB> writes:

    >> 
    >> Dear Ravi,
    >> 
    >> the inaccuracy seems to creep in when powers are
    >> calculated. Apparently, some quite general function is
    >> called to calculate the squares, and one can avoid the
    >> error by reformulating the example as follows:
    >> 
    >> rosen <- function(x) { n <- length(x) x1 <- x[2:n] x2 <-
    >> x[1:(n-1)] sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2))
    >> }
    >> 
    >> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549,
    >> 0.7136, 0.0849,
    HWB> 0.4147, 0.4540)
    >> h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) xh <- x0 + h
    >> 
    >> rx <- rosen(xh) Re(rx) Im (rx)
    >> 
    >> I don't know which arithmetics are involved in the
    >> application you mentioned, but writing some auxiliary
    >> function for the calculation of x^n when x is complex and
    >> n is (a not too large) integer may solve some of the
    >> numerical issues. A simple version is:
    >> 
    >> powN <- function(x,n) sapply(x,function(x)
    >> prod(rep(x,n)))
    >> 
    >> The corresponding summation in 'rosen' would then read:
    >> 
    >> sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
    >> 
    >> HTH,
    >> 
    >> Martin
    >> 

______________________________________________
    HWB> R-devel at r-project.org mailing list
    HWB> https://stat.ethz.ch/mailman/listinfo/r-devel


From benjamin.hofner at imbe.med.uni-erlangen.de  Tue Aug  4 12:05:11 2009
From: benjamin.hofner at imbe.med.uni-erlangen.de (benjamin.hofner at imbe.med.uni-erlangen.de)
Date: Tue,  4 Aug 2009 12:05:11 +0200 (CEST)
Subject: [Rd] save() does not issue an error if it tries to write on
	overfull hdd (PR#13866)
Message-ID: <20090804100512.042E9282EFF9@mail.pubhealth.ku.dk>

Full_Name: Benjamin Hofner
Version: 2.9.1
OS: Ubuntu 8.04
Submission from: (NULL) (141.67.245.196)


Hi,

if I try to save (via save(...), write.table(...), etc.) some data on a full (!)
disc (free disc space was ~ 20Kb) the save command seems to finish without an
error. However, if you try to load the saved file to R again different errors
(depending on the load routine) occur. I think it would be very helpful for
useRs if an error is returned if the disc is full (similar to the error if the
user has no write permission).


> version
               _                           
platform       i486-pc-linux-gnu           
arch           i486                        
os             linux-gnu                   
system         i486, linux-gnu             
status                                     
major          2                           
minor          9.1                         
year           2009                        
month          06                          
day            26                          
svn rev        48839                       
language       R                           
version.string R version 2.9.1 (2009-06-26)

> setwd("/path_to_full_directory/")
> test <- 1:10

> save("test", file="testdata.RData") # no error is returned here
> load("testdata.RData")
Fehler in if (!grepl("RD[AX]2\n", magic)) { : Argument hat L?nge 0

> write.table(test, "test.csv") # no error is returned here
> read.table("test.csv")
Fehler in read.table("test.csv") : keine Zeilen im Input verf?gbar

Best wishes,
  Benjamin


From murdoch at stats.uwo.ca  Tue Aug  4 12:38:44 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Aug 2009 06:38:44 -0400
Subject: [Rd] What changed in the R Windows interface from v2.6.2 to
	v2.7.0?
In-Reply-To: <FB2B3A529AB544F5A3A396BBD21D4809@civsurvenv.engbe.uncle.newcastle.edu.au>
References: <FB2B3A529AB544F5A3A396BBD21D4809@civsurvenv.engbe.uncle.newcastle.edu.au>
Message-ID: <4A780FB4.3020503@stats.uwo.ca>

Mark Thyer wrote:
> Dear R-devel,
>
>  
>
> I would like to launch the Rgui.exe from a Fortran console application (we
> will call this FortranCon.exe), that I have written myself. To do this, I
> send the command line "C:\Program Files\R\R-X.X.X\Rgui.exe" (where X.X.X is
> the version number) as an argument to the
> Windows API function CreateProcess (see
> http://msdn.microsoft.com/en-us/library/ms682425(VS.85).aspx) 
>
>  
>
> I use the createprocess command because I want the Rgui.exe and the Fortran
> console application to run in parallel. 
>
>  
>
> I have done this before with other executables (e.g. Tinn-R.exe,
> textpad.exe) and there hasn't been a problem.
>
>  
>
> But with the current version of R(v2.9.1), there is a problem. 
>
>  
>
> The problem is that after Rgui.exe is launched by FortranCon.exe, the
> console window for FortanCon.exe does not close properly when it finishes
> running. 
>
> I have to manually close it, by clicking on the topright X on the window.
> When I do this the Rgui.exe window also closes - which again is different to
> normal, and then the Windows EndProgram dialog comes up and asks me whether
> I wish to close FortranCon.exe
>
>  
>
> I have experimented with different versions of R, and this problem only
> occurs in R(>=v2.7.0)
>
>  
>
> If I launch Rgui.exe for v2.6.2, then the FortranCon.exe window closes
> automatically when it finishes and the Rgui.exe window remains open - this
> is the behaviour I expect and want to happen. Indeed, this is what usually
> happens If I launch other executables using the CreateProcess function.
>
>  
>
> This error does not occur if I launch Rgui.exe from a Fortran windows
> application. (as opposed to console application) 
>
>  
>
> I am running R on Windows XP (Service Pack 3) 32-bit (I have also found the
> problem occurs using 64-bit Windows XP). The FortranCon.exe is complied and
> linked by Intel Visual Fortran IVF11.1.035 and Visual Studio 2008.
>
>  
>
> So my query is. What has changed in the R Windows interface from v2.6.2 to
> v2.7.0 to cause this problem. I had a look at the CHANGES for R2.7.0 and I
> couldn't see anything the instantly could cause this problem. 
>   

I don't remember any change that would cause this, though there were a 
lot of changes.  You might need to build some intermediate versions 
(checkout from the Subversion repository and build) in order to narrow 
it down. 2.6.x split from the trunk in revision 42766, and 2.7.0 was 
released in revision 45426, so you've got the unpleasant possibility of 
a search through a few thousand versions.  (I recommend a binary search!)

In future you could avoid problems like this by staying up to date:  If 
you'd noticed this when 2.7.0 was released in April, 2008 (or helped 
during testing before release), our memory would have been fresher.

Duncan Murdoch


>  
>
> Any help on this matter is greatly appreciated. 
>
>  
>
> The ability to launch R from a Fortran application is important for the
> usability of the RFortran software library (www.rfortran.org
> <http://www.rfortran.org/> ) that we are developing. 
>
>  
>
> Cheers,
>
> Mark
>
>  
>
> _________________________________________________
>
> Dr Mark Thyer
>
> Senior Lecturer in Environmental Engineering
>
> Discipline of Civil, Surveying and Environmental Engineering
>
> School of Engineering, University of Newcastle
>
> Callaghan, NSW, Australia 2308
>
> T: 02 4921 6057
>
> F: 02 4921 6991
>
> E: mark.thyer at newcastle.edu.au
>
> W:
> www.newcastle.edu.au/school/engineering/our_staff/profiles/thyer_mark.html
>
>  
>
> "It is easy to lie with statistics, but it is difficult to tell the truth
> without them." Andrejs Dunkels
>
>  
>
>  
>
>  
>
>  
>
>  
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From martin.becker at mx.uni-saarland.de  Tue Aug  4 13:34:17 2009
From: martin.becker at mx.uni-saarland.de (Martin Becker)
Date: Tue, 04 Aug 2009 13:34:17 +0200
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <004001ca1453$929c0520$7c94100a@win.ad.jhu.edu>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
	<004001ca1453$929c0520$7c94100a@win.ad.jhu.edu>
Message-ID: <4A781CB9.8030505@mx.uni-saarland.de>

Dear Ravi,

I suspect that, in general, you may be facing the limitations of machine 
accuracy (more precisely, IEEE 754 arithmetics on [64-bit] doubles) in 
your application. This is not a problem of R itself, but rather a 
problem of standard arithmetics provided by underlying C compilers/CPUs.
In fact, every operation in IEEE arithmetics (so, this is not really a 
problem only for complex numbers) may suffer from inexactness, a 
particularly difficult one is addition/subtraction. Consider the 
following example for real numbers (I know, it is not a very good one...):
The two functions

badfn <- function(x) 1-(1+x)*(1-x)
goodfn <- function(x) x^2

both calculate x^2 (theoretically, given perfect arithmetic). So, as you 
want to allow the user to 'specify the mathematical function ... in 
"any" form the user chooses', both functions should be ok.
But, unfortunately:

 > badfn(1e-8)
[1] 2.220446049250313e-16
 > goodfn(1e-8)
[1] 1e-16

I don't know what happens in matlab/octave/scilab for this example. They 
may do better, but probably at some cost (dropping IEEE arithmetic/do 
"clever" calculations should result in massive speed penalties, try 
evaluating   hypergeom([1,-99.9],[-49.9-24.9*I],(1+1.71*I)/2);   in 
Maple...).
Now, you have some options:

- assume, that the user is aware of the numerical inexactness of ieee 
arithmetics and that he is able to supply some "robust" version of the 
mathematical function.
- use some other software (eg., matlab) for the critical calculations 
(there is a R <-> Matlab interface, see package R.matlab on CRAN), if 
you are sure, that this helps.
- implement/use multiple precision arithmetics within R (Martin 
Maechler's Rmpfr package may be very useful: 
http://r-forge.r-project.org/projects/rmpfr/ , but this will slow down 
calculations considerably)

All in all, I think it is unfair just to blame R here. Of course, it 
would be great if there was a simple trigger to turn on multiple 
precision arithmetics in R. Packages such as Rmpfr may provide a good 
step in this direction, since operator overloading via S4 classes allows 
for easy code adaption. But Rmpfr is still declared "beta", and it 
relies on some external library, which could be problematic on Windows 
systems. Maybe someone else has other/better suggestions, but I do not 
think that there is an easy solution for the "general" problem.

Best wishes,

  Martin
 

Ravi Varadhan wrote:
> Dear Martin,
>
> Thank you for this useful trick.  However, we are interested in a "general"
> approach for exact derivative computation.  This approach should allow the
> user to specify the mathematical function that needs to be differentiated in
> "any" form that the user chooses.  So, your trick will be difficult to
> implement there.  Furthermore, do we know for sure that `exponentiation' is
> the only operation that results in inaccuracy?  Are there other operations
> that also yield inaccurate results for complex arithmetic?  
>
> Hans Borchers also checked the computations with other free numerical
> software, such as Octave, Scilab, Euler, and they all return exactly the
> same results as Matlab.  It would be a shame if R could not do the same.  
>
> It would be great if the R core could address the "fundamental" issue. 
>
> Thank you.
>
> Best regards,
> Ravi.
>
> ----------------------------------------------------------------------------
> -------
>
> Ravi Varadhan, Ph.D.
>
> Assistant Professor, The Center on Aging and Health
>
> Division of Geriatric Medicine and Gerontology 
>
> Johns Hopkins University
>
> Ph: (410) 502-2619
>
> Fax: (410) 614-9625
>
> Email: rvaradhan at jhmi.edu
>
> Webpage:
> http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.h
> tml
>
>  
>
> ----------------------------------------------------------------------------
> --------
>
>
> -----Original Message-----
> From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de] 
> Sent: Monday, August 03, 2009 5:50 AM
> To: Ravi Varadhan
> Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
>
> Dear Ravi,
>
> the inaccuracy seems to creep in when powers are calculated. Apparently,
> some quite general function is called to calculate the squares, and one can
> avoid the error by reformulating the example as follows:
>
> rosen <- function(x) {
>   n <- length(x)
>   x1 <- x[2:n]
>   x2 <- x[1:(n-1)]
>   sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2)) }
>
> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 0.0849,
> 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) xh <- x0 + h
>
> rx <- rosen(xh)
> Re(rx)
> Im (rx)
>
>
> I don't know which arithmetics are involved in the application you
> mentioned, but writing some auxiliary function for the calculation of x^n
> when x is complex and n is (a not too large) integer may solve some of the
> numerical issues. A simple version is:
>
> powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))
>
> The corresponding summation in 'rosen' would then read:
>
> sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
>
>
> HTH,
>
>   Martin
>
>
> Ravi Varadhan wrote:
>   
>> Dear All,
>>
>> Hans Borchers and I have been trying to compute "exact" derivatives in R
>>     
> using the idea of complex-step derivatives that Hans has proposed.  This is
> a really, really cool idea.  It gives "exact" derivatives with only a
> minimal effort (same as that involved in computing first-order
> forward-difference derivative).  
>   
>> Unfortunately, we cannot implement this in R as the "complex arithmetic"
>>     
> in R appears to be inaccurate.
>   
>> Here is an example:
>>
>> #-- Classical Rosenbrock function in n variables rosen <- function(x) 
>> { n <- length(x)
>> x1 <- x[2:n]
>> x2 <- x[1:(n-1)]
>> sum(100*(x1-x2^2)^2 + (1-x2)^2)
>> }
>>
>>
>> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 
>> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) 
>> xh <- x0 + h
>>
>> rx <- rosen(xh)
>> Re(rx)
>> Im (rx)
>>
>> #  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect 
>> imaginary part in R
>>
>> However, the imaginary part of the above answer is inaccurate.  The
>>     
> correct imaginary part (from Matlab) is:
>   
>> 190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part 
>> from Matlab
>>
>> This inaccuracy is serious enough to affect the acuracy of the compex-step
>>     
> gradient drastically.
>   
>> Hans and I were wondering if there is a way to obtain accurate "small"
>>     
> imaginary part for complex arithmetic.  
>   
>> I am using Windows XP operating system.
>>
>> Thanks for taking a look at this.
>>
>> Best regards,
>> Ravi.
>>
>>
>> ____________________________________________________________________
>>
>> Ravi Varadhan, Ph.D.
>> Assistant Professor,
>> Division of Geriatric Medicine and Gerontology School of Medicine 
>> Johns Hopkins University
>>
>> Ph. (410) 502-2619
>> email: rvaradhan at jhmi.edu
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
>>     
>
>
> --
> Dr. Martin Becker
> Statistics and Econometrics
> Saarland University
> Campus C3 1, Room 206
> 66123 Saarbruecken
> Germany
>
>   


-- 
Dr. Martin Becker
Statistics and Econometrics
Saarland University
Campus C3 1, Room 206
66123 Saarbruecken
Germany


From bernd_bischl at gmx.net  Tue Aug  4 15:10:23 2009
From: bernd_bischl at gmx.net (Bernd Bischl)
Date: Tue, 04 Aug 2009 15:10:23 +0200
Subject: [Rd] Inconsistencies in missing names of a list?
Message-ID: <4A78333F.7080208@gmx.net>

Hi,

I would like to discuss whether the following behaviour in lists is 
indeed intended:

###################################################
 > sessionInfo()
R version 2.10.0 Under development (unstable) (2009-07-21 r48968)
i386-pc-mingw32

locale:
[1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252  [3] 
LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                  [5] 
LC_TIME=German_Germany.1252  
attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base 
###################################################

# case 1
x1 <- list(1, 2)
names(x1)[2]
# returns NULL

# case 2
x2 <- list(foo=1, 2)
names(x2)[2]
# returns ""

# case 3
x3 <- list(1, 2)
names(x3)[1] <- "foo"
names(x3)[2]
# returns NA

###################################################

Although I don't find it particularly good that 1) and 2)  behave 
differently, I can very well understand what happens and accept this.

I may also understand (on a technical level) what happens in 3), but I 
find it very disturbing that these lines

x2 <- list(foo=1, 2)
x3 <- list(1, 2)
names(x3)[1] <- "foo"

produce different results.

?names says

" The name |""| is special: it is used to indicate that there is no name 
associated with an element of a (atomic or generic) vector. Subscripting 
by |""| will match nothing (not even elements which have no name).

A name can be character |NA|, but such a name will never be matched and 
is likely to lead to confusion."

If it "likely leads to confusion" why does the implementation use it?

Regards,

Bernd Bischl


From tshort.rlists at gmail.com  Tue Aug  4 16:33:50 2009
From: tshort.rlists at gmail.com (Tom Short)
Date: Tue, 4 Aug 2009 10:33:50 -0400
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <19063.7856.809632.43723@lynne.math.ethz.ch>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
	<loom.20090803T130914-544@post.gmane.org>
	<19063.7856.809632.43723@lynne.math.ethz.ch>
Message-ID: <fd27013a0908040733i24d85418t1f535d0d46c93199@mail.gmail.com>

I checked, and both octave and yorick use multiplication for z^i where
i is an integer, leading to better accuracy. Octave uses an integer
power if it's stored as a double if it's close enough to an integer.
See:

http://hg.savannah.gnu.org/hgweb/octave/file/fb22dd5d6242/src/xpow.cc
http://yorick.sourcearchive.com/documentation/2.1.01cvs20060706/ops2_8c-source.html

- Tom


From hwborchers at googlemail.com  Tue Aug  4 16:35:08 2009
From: hwborchers at googlemail.com (Hans W Borchers)
Date: Tue, 4 Aug 2009 14:35:08 +0000 (UTC)
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
	<004001ca1453$929c0520$7c94100a@win.ad.jhu.edu>
	<4A781CB9.8030505@mx.uni-saarland.de>
Message-ID: <loom.20090804T143109-446@post.gmane.org>

> I suspect that, in general, you may be facing the limitations of machine 
> accuracy (more precisely, IEEE 754 arithmetics on [64-bit] doubles) in 

Dear Martin,

I definitely do not agree with this. Consider your own proposal of
writing the Rosenbrock function:

    rosen2 <- function(x) {
        n <- length(x)
        x1 <- x[2:n]
        x2 <- x[1:(n-1)]
        sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2))
    }

The complex-step derivative approximation suggests to set h <- 1.0e-20
and then to compute the expression  Im(rosen(x+hi))/h , so let's do it:

    h  <- 1.0e-20
    xh <- c(0.0094 + h*1i, 0.7146, 0.2179, 0.6883, 0.5757,
            0.9549,        0.7136, 0.0849, 0.4147, 0.4540)

    Im(rosen2(xh)) / h
    # [1] -4.6677637664000

which is exactly the correct derivative in the first variable, namely
d/dx1 rosen(x). To verify, you could even calculate this by hand on a
"Bierdeckel".

Now look at the former definition, say rosen1(), using '^' instead:

    rosen1 <- function(x) {
        n <- length(x)
        x1 <- x[2:n]
        x2 <- x[1:(n-1)]
        sum(100*(x1-x2^2)^2 + (1-x2)^2)
    }

    Im(rosen1(xh)) / h
    # [1] -747143.8793904837

We find that R is "running wild". And this has nothing to do with IEEE
arithmetics or machine accuracy, as we can see from the first example
where R is able to do it right.

And as I said, the second example is working correctly in free software
such as Octave which I guess does not do any "clever" calculations here.

We do _not_ ask for multiple precision arithmetics here !

Regards
Hans Werner


Martin Becker <martin.becker <at> mx.uni-saarland.de> writes:
> 
> Dear Ravi,
> 
> I suspect that, in general, you may be facing the limitations of machine 
> accuracy (more precisely, IEEE 754 arithmetics on [64-bit] doubles) in 
> your application. This is not a problem of R itself, but rather a 
> problem of standard arithmetics provided by underlying C compilers/CPUs.
> In fact, every operation in IEEE arithmetics (so, this is not really a 
> problem only for complex numbers) may suffer from inexactness, a 
> particularly difficult one is addition/subtraction. Consider the 
> following example for real numbers (I know, it is not a very good one...):
> The two functions
> 
> badfn <- function(x) 1-(1+x)*(1-x)
> goodfn <- function(x) x^2
> 
> both calculate x^2 (theoretically, given perfect arithmetic). So, as you 
> want to allow the user to 'specify the mathematical function ... in 
> "any" form the user chooses', both functions should be ok.
> But, unfortunately:
> 
>  > badfn(1e-8)
> [1] 2.220446049250313e-16
>  > goodfn(1e-8)
> [1] 1e-16
> 
> I don't know what happens in matlab/octave/scilab for this example. They 
> may do better, but probably at some cost (dropping IEEE arithmetic/do 
> "clever" calculations should result in massive speed penalties, try 
> evaluating   hypergeom([1,-99.9],[-49.9-24.9*I],(1+1.71*I)/2);   in 
> Maple...).
> Now, you have some options:
> 
> - assume, that the user is aware of the numerical inexactness of ieee 
> arithmetics and that he is able to supply some "robust" version of the 
> mathematical function.
> - use some other software (eg., matlab) for the critical calculations 
> (there is a R <-> Matlab interface, see package R.matlab on CRAN), if 
> you are sure, that this helps.
> - implement/use multiple precision arithmetics within R (Martin 
> Maechler's Rmpfr package may be very useful: 
> http://r-forge.r-project.org/projects/rmpfr/ , but this will slow down 
> calculations considerably)
> 
> All in all, I think it is unfair just to blame R here. Of course, it 
> would be great if there was a simple trigger to turn on multiple 
> precision arithmetics in R. Packages such as Rmpfr may provide a good 
> step in this direction, since operator overloading via S4 classes allows 
> for easy code adaption. But Rmpfr is still declared "beta", and it 
> relies on some external library, which could be problematic on Windows 
> systems. Maybe someone else has other/better suggestions, but I do not 
> think that there is an easy solution for the "general" problem.
> 
> Best wishes,
> 
>   Martin
>


From murdoch at stats.uwo.ca  Tue Aug  4 17:02:55 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Aug 2009 11:02:55 -0400
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
 specified (PR#13860)
In-Reply-To: <20090728223012.75E272830316@mail.pubhealth.ku.dk>
References: <20090728223012.75E272830316@mail.pubhealth.ku.dk>
Message-ID: <4A784D9F.8050504@stats.uwo.ca>

On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
> Hi all,
> 
> When I install a new package, and don't yet know any function names,
> I have to play the "poor man's game" to get to the standard
> help system "Index" page for the package:

You could complain to the package author or maintainer, who should have 
created a help alias with the package name so that ?survival would give 
you something useful.  But I would guess R 2.10.x or 2.11.x will do that 
automatically.

Duncan Murdoch

> Poor Man's Game -=20
>   Load new package;=20
>   issue search() command;
>   find position (say N) of loaded package;=20
>   issue objects(pos =3D N) command;
>   get name of a random function (san newFunction);=20
>   issue ?newFunction command;
>   scroll to bottom of page;=20
>   click on the "Index" hyperlink
> 
> There are other variations, but they all involve this=20
> long march to the Index page.
> 
> 
> What I'd like to be able to do is enter the command
> 
>> help(package =3D "survival")
> 
> or
> 
>> ?survival::
> 
> and get the usual hyperlinked help page displayed (the "00Index" page)
> instead of the static "text only" display or an error message
> 
> (for example, on Windows, this equates to invoking
> "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> on Apple Mac,
> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Index.ht=
> ml"
> etc.)
> 
> 
> Details:
> ---------------
> 
> The help() function returns an object of
> class "help_files_with_topic".
> The object consists of a character vector
> with several attributes.
> 
> PC:  Windows XP
> 
>> library("survival")
>> foo <- help("aareg", package =3D "survival")
>> class(foo)
> [1] "help_files_with_topic"
>> foo[1]
> [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
>> attributes(foo)
> $call
> help(topic =3D "aareg", package =3D "survival")
> 
> $pager
> [1] "internal"
> 
> $topic
> [1] "aareg"
> 
> $tried_all_packages
> [1] FALSE
> 
> $type
> [1] "chm"
> 
> $class
> [1] "help_files_with_topic"
> 
>> bar <- help("", package =3D "survival")
>> class(bar)
> [1] "help_files_with_topic"
>> bar[1]
> [1] NA
>> attributes(bar)
> $call
> help(topic =3D "", package =3D "survival")
> 
> $pager
> [1] "internal"
> 
> $topic
> [1] ""
> 
> $tried_all_packages
> [1] FALSE
> 
> $type
> [1] "chm"
> 
> $class
> [1] "help_files_with_topic"
> 
> If I alter the character vector to
> point to "00Index"
> 
>> bar[1] <- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>> bar
> 
> I see exactly what I've been attempting to achieve.
> 
> 
> Mac OS X:
> 
>> foo <- help("aareg", package =3D "survival")
>> foo[1]
> [1] "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.=
> html"
>> attributes(foo)
> $call
> help(topic =3D "aareg", package =3D "survival")
> 
> $pager
> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> 
> $topic
> [1] "aareg"
> 
> $tried_all_packages
> [1] FALSE
> 
> $type
> [1] "html"
> 
> $class
> [1] "help_files_with_topic"
> 
>> bar <- help("", package =3D "survival")
>> bar[1]
> [1] NA
>> bar[1] <- "/Library/Frameworks/R.framework/Resources/library/survival/htm=
> l/00Index.html"
>> bar
> 
> Again I see exactly what I've been after.
> 
> Running R in Emacs on Mac OS X:
> 
>> foo <- help(topic =3D "aareg", package =3D "survival")
>> foo[1]
> [1] "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.=
> html"
>> attributes(foo)
> $call
> help(topic =3D "aareg", package =3D "survival")
> 
> $pager
> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> 
> $topic
> [1] "aareg"
> 
> $tried_all_packages
> [1] FALSE
> 
> $type
> [1] "html"
> 
> $class
> [1] "help_files_with_topic"
> 
>> bar <- help(topic =3D "", package =3D "survival")
>> bar[1]
> [1] NA
>> bar[1] <- "/Library/Frameworks/R.framework/Resources/library/survival/htm=
> l/00Index.html"
>> bar
> Help for '' is shown in browser /usr/bin/open ...
> Use
>         help("", htmlhelp =3D FALSE)
> or
>         options(htmlhelp =3D FALSE)
> to revert.
>>
> 
> Again, what I've been trying to achieve.
> 
> When a user loads a new library and doesn't yet know any function names,
> I think
>> help(package =3D "newLibrary")
> or
>> ?newLibrary::
> 
> should perform the above action whenever possible instead of
> producing static help or an error message.
> 
> The "00Index" 'object' should be available for such use
> whenever it exists. =20
> 
> I have not yet worked out all the coding details to make this happen,
> but before I do, am I missing some key point?  Any reasons why this
> would be a Bad Idea?
> 
> 
> 
> Steven McKinney, Ph.D.
> 
> Statistician
> Molecular Oncology and Breast Cancer Program
> British Columbia Cancer Research Centre
> 
> email: smckinney +at+ bccrc +dot+ ca
> 
> tel: 604-675-8000 x7561
> 
> BCCRC
> Molecular Oncology
> 675 West 10th Ave, Floor 4
> Vancouver B.C.
> V5Z 1L3
> Canada
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Tue Aug  4 17:05:10 2009
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Tue,  4 Aug 2009 17:05:10 +0200 (CEST)
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
	(PR#13868)
Message-ID: <20090804150511.1783F2830319@mail.pubhealth.ku.dk>

On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
> Hi all,
> 
> When I install a new package, and don't yet know any function names,
> I have to play the "poor man's game" to get to the standard
> help system "Index" page for the package:

You could complain to the package author or maintainer, who should have 
created a help alias with the package name so that ?survival would give 
you something useful.  But I would guess R 2.10.x or 2.11.x will do that 
automatically.

Duncan Murdoch

> Poor Man's Game -=20
>   Load new package;=20
>   issue search() command;
>   find position (say N) of loaded package;=20
>   issue objects(pos =3D N) command;
>   get name of a random function (san newFunction);=20
>   issue ?newFunction command;
>   scroll to bottom of page;=20
>   click on the "Index" hyperlink
> 
> There are other variations, but they all involve this=20
> long march to the Index page.
> 
> 
> What I'd like to be able to do is enter the command
> 
>> help(package =3D "survival")
> 
> or
> 
>> ?survival::
> 
> and get the usual hyperlinked help page displayed (the "00Index" page)
> instead of the static "text only" display or an error message
> 
> (for example, on Windows, this equates to invoking
> "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> on Apple Mac,
> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Index.ht=
> ml"
> etc.)
> 
> 
> Details:
> ---------------
> 
> The help() function returns an object of
> class "help_files_with_topic".
> The object consists of a character vector
> with several attributes.
> 
> PC:  Windows XP
> 
>> library("survival")
>> foo <- help("aareg", package =3D "survival")
>> class(foo)
> [1] "help_files_with_topic"
>> foo[1]
> [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
>> attributes(foo)
> $call
> help(topic =3D "aareg", package =3D "survival")
> 
> $pager
> [1] "internal"
> 
> $topic
> [1] "aareg"
> 
> $tried_all_packages
> [1] FALSE
> 
> $type
> [1] "chm"
> 
> $class
> [1] "help_files_with_topic"
> 
>> bar <- help("", package =3D "survival")
>> class(bar)
> [1] "help_files_with_topic"
>> bar[1]
> [1] NA
>> attributes(bar)
> $call
> help(topic =3D "", package =3D "survival")
> 
> $pager
> [1] "internal"
> 
> $topic
> [1] ""
> 
> $tried_all_packages
> [1] FALSE
> 
> $type
> [1] "chm"
> 
> $class
> [1] "help_files_with_topic"
> 
> If I alter the character vector to
> point to "00Index"
> 
>> bar[1] <- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>> bar
> 
> I see exactly what I've been attempting to achieve.
> 
> 
> Mac OS X:
> 
>> foo <- help("aareg", package =3D "survival")
>> foo[1]
> [1] "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.=
> html"
>> attributes(foo)
> $call
> help(topic =3D "aareg", package =3D "survival")
> 
> $pager
> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> 
> $topic
> [1] "aareg"
> 
> $tried_all_packages
> [1] FALSE
> 
> $type
> [1] "html"
> 
> $class
> [1] "help_files_with_topic"
> 
>> bar <- help("", package =3D "survival")
>> bar[1]
> [1] NA
>> bar[1] <- "/Library/Frameworks/R.framework/Resources/library/survival/htm=
> l/00Index.html"
>> bar
> 
> Again I see exactly what I've been after.
> 
> Running R in Emacs on Mac OS X:
> 
>> foo <- help(topic =3D "aareg", package =3D "survival")
>> foo[1]
> [1] "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.=
> html"
>> attributes(foo)
> $call
> help(topic =3D "aareg", package =3D "survival")
> 
> $pager
> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> 
> $topic
> [1] "aareg"
> 
> $tried_all_packages
> [1] FALSE
> 
> $type
> [1] "html"
> 
> $class
> [1] "help_files_with_topic"
> 
>> bar <- help(topic =3D "", package =3D "survival")
>> bar[1]
> [1] NA
>> bar[1] <- "/Library/Frameworks/R.framework/Resources/library/survival/htm=
> l/00Index.html"
>> bar
> Help for '' is shown in browser /usr/bin/open ...
> Use
>         help("", htmlhelp =3D FALSE)
> or
>         options(htmlhelp =3D FALSE)
> to revert.
>>
> 
> Again, what I've been trying to achieve.
> 
> When a user loads a new library and doesn't yet know any function names,
> I think
>> help(package =3D "newLibrary")
> or
>> ?newLibrary::
> 
> should perform the above action whenever possible instead of
> producing static help or an error message.
> 
> The "00Index" 'object' should be available for such use
> whenever it exists. =20
> 
> I have not yet worked out all the coding details to make this happen,
> but before I do, am I missing some key point?  Any reasons why this
> would be a Bad Idea?
> 
> 
> 
> Steven McKinney, Ph.D.
> 
> Statistician
> Molecular Oncology and Breast Cancer Program
> British Columbia Cancer Research Centre
> 
> email: smckinney +at+ bccrc +dot+ ca
> 
> tel: 604-675-8000 x7561
> 
> BCCRC
> Molecular Oncology
> 675 West 10th Ave, Floor 4
> Vancouver B.C.
> V5Z 1L3
> Canada
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Tue Aug  4 17:06:26 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 4 Aug 2009 17:06:26 +0200
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <19063.7856.809632.43723@lynne.math.ethz.ch>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
	<loom.20090803T130914-544@post.gmane.org>
	<19063.7856.809632.43723@lynne.math.ethz.ch>
Message-ID: <19064.20082.393089.476960@lynne.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Mon, 3 Aug 2009 19:30:24 +0200 writes:

>>>>> "HWB" == Hans W Borchers <hwborchers at googlemail.com>
>>>>>     on Mon, 3 Aug 2009 13:15:11 +0000 (UTC) writes:

      >>> 
      HWB> Thanks for pointing out the weak point in this
      HWB> computation. I tried out your suggestions and they both
      HWB> deliver the correct and accurate result.

      HWB> But as a general solution this approach is not
      HWB> feasible. We want to provide "complex-step derivatives"
      HWB> as a new method for computing exact gradients, for
      HWB> example in 'numDeriv::grad' as

      HWB> grad(fun, x, method="complex-step")

      HWB> and we can not reasonably assume that a user prepares
      HWB> his function specially for calling this method.

      HWB> I tried out other numerical math software besides
      HWB> Matlab, that is Octave, Scilab, Euler and others, and
      HWB> they all return the same correct value up to 15
      HWB> digits. Should we not expect that R is capable of doing
      HWB> the same?

    MM> R's  "a ^ b"  on non-Windows typically uses the C library's
    MM> 'cpow()'  when that is provided  (HAVE_C99_COMPLEX).

    MM> Indeed, this seems to use the "general" complex power function
    MM> which loses a few bits -- unavoidably.
    MM> Our Windows-version of complex  a ^ b  does so as well.

    MM> Here's an R version of what (I believe) once was the C library
    MM> cpow(); at least I confirm that it has the same slight
    MM> inaccuracy [if you are as this very border line case with '1e-15';
    MM> use  1e-12  and you have no problems !! ]

    MM> Cpow <- function(a,b)
    MM> {
    MM> ## Purpose: a ^ b  in complex
    MM> ## Find bug in  complex_pow()
    MM> ## -------------------------------------------------------------------------
    MM> ## Author: Martin Maechler, Date: 15 Jan 2000, 21:33

    MM> a <- as.complex(a)
    MM> b <- as.complex(b)

    MM> hypot <- function(x,y)Mod(x + 1i*y)

    MM> logr <- log(hypot(Re(a), Im(a)) );
    MM> logi <- atan2(Im(a), Re(a));
    MM> x <- exp( logr * Re(b) - logi * Im(b) );
    MM> y <- logr * Im(b) + logi * Re(b);

    MM> x * complex(re= cos(y), im= sin(y))
    MM> }

    MM> ----------------

    MM> So, yes we could check for the special case of  "^2" and use
    MM> multiplication and then for   " ^ n " and ... ...
    MM> and only otherwise call cpow(x,y) {or our own C-version of
    MM> that}.

    MM> I'm looking into implenting that now.
    MM> Expect to hear more about it within 24 hours.

I have now committed a change to R-devel (not sure if to be
back-ported to R-patched)
which uses  ~ log2(n) multiplications  for  z^n  when
n is integer (and  |n| <= 2^16 ; that cut-off being somewhat arbitrary).

Along the same line, I've looked what we do for  x^y  when x,y
are double. Till now, we had only special cased the cases
y == 0 (, 1), 2; and after some simple tests, I've decided to
use the log(n) #{multiplications} algorithm, whenever |n| <= 256.

Thanks also to Tom Short for investigating what other free
packages use.

Martin Maechler, ETH Zurich




    HWB> Martin Becker <martin.becker <at> mx.uni-saarland.de>
    HWB> writes:

    >>> 
    >>> Dear Ravi,
    >>> 
    >>> the inaccuracy seems to creep in when powers are
    >>> calculated. Apparently, some quite general function is
    >>> called to calculate the squares, and one can avoid the
    >>> error by reformulating the example as follows:
    >>> 
    >>> rosen <- function(x) { n <- length(x) x1 <- x[2:n] x2 <-
    >>> x[1:(n-1)] sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2))
    >>> }
    >>> 
    >>> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549,
    >>> 0.7136, 0.0849,
    HWB> 0.4147, 0.4540)
    >>> h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) xh <- x0 + h
    >>> 
    >>> rx <- rosen(xh) Re(rx) Im (rx)
    >>> 
    >>> I don't know which arithmetics are involved in the
    >>> application you mentioned, but writing some auxiliary
    >>> function for the calculation of x^n when x is complex and
    >>> n is (a not too large) integer may solve some of the
    >>> numerical issues. A simple version is:
    >>> 
    >>> powN <- function(x,n) sapply(x,function(x)
    >>> prod(rep(x,n)))
    >>> 
    >>> The corresponding summation in 'rosen' would then read:
    >>> 
    >>> sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
    >>> 
    >>> HTH,
    >>> 
    >>> Martin
    >>> 

    MM> ______________________________________________
    HWB> R-devel at r-project.org mailing list
    HWB> https://stat.ethz.ch/mailman/listinfo/r-devel

    MM> ______________________________________________
    MM> R-devel at r-project.org mailing list
    MM> https://stat.ethz.ch/mailman/listinfo/r-devel


From totemo22 at gmail.com  Tue Aug  4 17:18:08 2009
From: totemo22 at gmail.com (Hyo Karen Lee)
Date: Tue, 4 Aug 2009 11:18:08 -0400
Subject: [Rd] would like to subscribe...
Message-ID: <9a3dbbff0908040818s4be325b8k7c9396384eac5416@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090804/ca76bb2b/attachment.pl>

From bilel.masmoudi at gmail.com  Tue Aug  4 18:47:00 2009
From: bilel.masmoudi at gmail.com (Bilel MASMOUDI)
Date: Tue, 4 Aug 2009 18:47:00 +0200
Subject: [Rd] can a key of a list be a variable
Message-ID: <e37a704c0908040947i40a02f9eg9bfa8b507ba0b9ef@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090804/966ace7b/attachment.pl>

From bilel.masmoudi at gmail.com  Tue Aug  4 19:07:03 2009
From: bilel.masmoudi at gmail.com (Bilel MASMOUDI)
Date: Tue, 4 Aug 2009 19:07:03 +0200
Subject: [Rd] can a key of a list be a variable
In-Reply-To: <e37a704c0908040947i40a02f9eg9bfa8b507ba0b9ef@mail.gmail.com>
References: <e37a704c0908040947i40a02f9eg9bfa8b507ba0b9ef@mail.gmail.com>
Message-ID: <e37a704c0908041007n2b8900ei1ddaf834c22b83e7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090804/88b95c0b/attachment.pl>

From RVaradhan at jhmi.edu  Mon Aug  3 18:00:50 2009
From: RVaradhan at jhmi.edu (Ravi Varadhan)
Date: Mon, 3 Aug 2009 12:00:50 -0400
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <4A76B2BE.1060301@mx.uni-saarland.de>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
Message-ID: <004001ca1453$929c0520$7c94100a@win.ad.jhu.edu>

Dear Martin,

Thank you for this useful trick.  However, we are interested in a "general"
approach for exact derivative computation.  This approach should allow the
user to specify the mathematical function that needs to be differentiated in
"any" form that the user chooses.  So, your trick will be difficult to
implement there.  Furthermore, do we know for sure that `exponentiation' is
the only operation that results in inaccuracy?  Are there other operations
that also yield inaccurate results for complex arithmetic?  

Hans Borchers also checked the computations with other free numerical
software, such as Octave, Scilab, Euler, and they all return exactly the
same results as Matlab.  It would be a shame if R could not do the same.  

It would be great if the R core could address the "fundamental" issue. 

Thank you.

Best regards,
Ravi.

----------------------------------------------------------------------------
-------

Ravi Varadhan, Ph.D.

Assistant Professor, The Center on Aging and Health

Division of Geriatric Medicine and Gerontology 

Johns Hopkins University

Ph: (410) 502-2619

Fax: (410) 614-9625

Email: rvaradhan at jhmi.edu

Webpage:
http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.h
tml

 

----------------------------------------------------------------------------
--------


-----Original Message-----
From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de] 
Sent: Monday, August 03, 2009 5:50 AM
To: Ravi Varadhan
Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)

Dear Ravi,

the inaccuracy seems to creep in when powers are calculated. Apparently,
some quite general function is called to calculate the squares, and one can
avoid the error by reformulating the example as follows:

rosen <- function(x) {
  n <- length(x)
  x1 <- x[2:n]
  x2 <- x[1:(n-1)]
  sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2)) }

x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 0.0849,
0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) xh <- x0 + h

rx <- rosen(xh)
Re(rx)
Im (rx)


I don't know which arithmetics are involved in the application you
mentioned, but writing some auxiliary function for the calculation of x^n
when x is complex and n is (a not too large) integer may solve some of the
numerical issues. A simple version is:

powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))

The corresponding summation in 'rosen' would then read:

sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))


HTH,

  Martin


Ravi Varadhan wrote:
> Dear All,
>
> Hans Borchers and I have been trying to compute "exact" derivatives in R
using the idea of complex-step derivatives that Hans has proposed.  This is
a really, really cool idea.  It gives "exact" derivatives with only a
minimal effort (same as that involved in computing first-order
forward-difference derivative).  
>
> Unfortunately, we cannot implement this in R as the "complex arithmetic"
in R appears to be inaccurate.
>
> Here is an example:
>
> #-- Classical Rosenbrock function in n variables rosen <- function(x) 
> { n <- length(x)
> x1 <- x[2:n]
> x2 <- x[1:(n-1)]
> sum(100*(x1-x2^2)^2 + (1-x2)^2)
> }
>
>
> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 
> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) 
> xh <- x0 + h
>
> rx <- rosen(xh)
> Re(rx)
> Im (rx)
>
> #  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect 
> imaginary part in R
>
> However, the imaginary part of the above answer is inaccurate.  The
correct imaginary part (from Matlab) is:
>
> 190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part 
> from Matlab
>
> This inaccuracy is serious enough to affect the acuracy of the compex-step
gradient drastically.
>
> Hans and I were wondering if there is a way to obtain accurate "small"
imaginary part for complex arithmetic.  
>
> I am using Windows XP operating system.
>
> Thanks for taking a look at this.
>
> Best regards,
> Ravi.
>
>
> ____________________________________________________________________
>
> Ravi Varadhan, Ph.D.
> Assistant Professor,
> Division of Geriatric Medicine and Gerontology School of Medicine 
> Johns Hopkins University
>
> Ph. (410) 502-2619
> email: rvaradhan at jhmi.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


--
Dr. Martin Becker
Statistics and Econometrics
Saarland University
Campus C3 1, Room 206
66123 Saarbruecken
Germany


From RVaradhan at jhmi.edu  Tue Aug  4 16:59:43 2009
From: RVaradhan at jhmi.edu (Ravi Varadhan)
Date: Tue, 4 Aug 2009 10:59:43 -0400
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <4A781CB9.8030505@mx.uni-saarland.de>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
	<004001ca1453$929c0520$7c94100a@win.ad.jhu.edu>
	<4A781CB9.8030505@mx.uni-saarland.de>
Message-ID: <007701ca1514$33169e50$7c94100a@win.ad.jhu.edu>


Please forgive me for my lack of understanding of IEEE floating-point
arithmetic.  I have a hard time undertsanding why "this is not a problem of
R itself", when "ALL" the other well known computing environments including
Matlab, Octave, S+, and Scilab provide accurate results.  My concern is not
really about the "overall" accuracy of R, but just about the complex
arithmetic.  Is there something idiosyncratic about the complex arithmetic?


I am really hoping that some one from the R core would speak up and address
this issue.  It would be a loss to the R users if this fascinating idea of
"complex-step derivative" could not be implemented in R.

Thanks,
Ravi. 

----------------------------------------------------------------------------
-------

Ravi Varadhan, Ph.D.

Assistant Professor, The Center on Aging and Health

Division of Geriatric Medicine and Gerontology 

Johns Hopkins University

Ph: (410) 502-2619

Fax: (410) 614-9625

Email: rvaradhan at jhmi.edu

Webpage:
http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.h
tml

 

----------------------------------------------------------------------------
--------


-----Original Message-----
From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de] 
Sent: Tuesday, August 04, 2009 7:34 AM
To: Ravi Varadhan
Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)

Dear Ravi,

I suspect that, in general, you may be facing the limitations of machine
accuracy (more precisely, IEEE 754 arithmetics on [64-bit] doubles) in your
application. This is not a problem of R itself, but rather a problem of
standard arithmetics provided by underlying C compilers/CPUs.
In fact, every operation in IEEE arithmetics (so, this is not really a
problem only for complex numbers) may suffer from inexactness, a
particularly difficult one is addition/subtraction. Consider the following
example for real numbers (I know, it is not a very good one...):
The two functions

badfn <- function(x) 1-(1+x)*(1-x)
goodfn <- function(x) x^2

both calculate x^2 (theoretically, given perfect arithmetic). So, as you
want to allow the user to 'specify the mathematical function ... in "any"
form the user chooses', both functions should be ok.
But, unfortunately:

 > badfn(1e-8)
[1] 2.220446049250313e-16
 > goodfn(1e-8)
[1] 1e-16

I don't know what happens in matlab/octave/scilab for this example. They may
do better, but probably at some cost (dropping IEEE arithmetic/do "clever"
calculations should result in massive speed penalties, try 
evaluating   hypergeom([1,-99.9],[-49.9-24.9*I],(1+1.71*I)/2);   in 
Maple...).
Now, you have some options:

- assume, that the user is aware of the numerical inexactness of ieee
arithmetics and that he is able to supply some "robust" version of the
mathematical function.
- use some other software (eg., matlab) for the critical calculations (there
is a R <-> Matlab interface, see package R.matlab on CRAN), if you are sure,
that this helps.
- implement/use multiple precision arithmetics within R (Martin Maechler's
Rmpfr package may be very useful: 
http://r-forge.r-project.org/projects/rmpfr/ , but this will slow down
calculations considerably)

All in all, I think it is unfair just to blame R here. Of course, it would
be great if there was a simple trigger to turn on multiple precision
arithmetics in R. Packages such as Rmpfr may provide a good step in this
direction, since operator overloading via S4 classes allows for easy code
adaption. But Rmpfr is still declared "beta", and it relies on some external
library, which could be problematic on Windows systems. Maybe someone else
has other/better suggestions, but I do not think that there is an easy
solution for the "general" problem.

Best wishes,

  Martin
 

Ravi Varadhan wrote:
> Dear Martin,
>
> Thank you for this useful trick.  However, we are interested in a
"general"
> approach for exact derivative computation.  This approach should allow 
> the user to specify the mathematical function that needs to be 
> differentiated in "any" form that the user chooses.  So, your trick 
> will be difficult to implement there.  Furthermore, do we know for 
> sure that `exponentiation' is the only operation that results in 
> inaccuracy?  Are there other operations that also yield inaccurate results
for complex arithmetic?
>
> Hans Borchers also checked the computations with other free numerical 
> software, such as Octave, Scilab, Euler, and they all return exactly 
> the same results as Matlab.  It would be a shame if R could not do the
same.
>
> It would be great if the R core could address the "fundamental" issue. 
>
> Thank you.
>
> Best regards,
> Ravi.
>
> ----------------------------------------------------------------------
> ------
> -------
>
> Ravi Varadhan, Ph.D.
>
> Assistant Professor, The Center on Aging and Health
>
> Division of Geriatric Medicine and Gerontology
>
> Johns Hopkins University
>
> Ph: (410) 502-2619
>
> Fax: (410) 614-9625
>
> Email: rvaradhan at jhmi.edu
>
> Webpage:
> http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Vara
> dhan.h
> tml
>
>  
>
> ----------------------------------------------------------------------
> ------
> --------
>
>
> -----Original Message-----
> From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de]
> Sent: Monday, August 03, 2009 5:50 AM
> To: Ravi Varadhan
> Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is 
> accurate)
>
> Dear Ravi,
>
> the inaccuracy seems to creep in when powers are calculated. 
> Apparently, some quite general function is called to calculate the 
> squares, and one can avoid the error by reformulating the example as
follows:
>
> rosen <- function(x) {
>   n <- length(x)
>   x1 <- x[2:n]
>   x2 <- x[1:(n-1)]
>   sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2)) }
>
> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 
> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) 
> xh <- x0 + h
>
> rx <- rosen(xh)
> Re(rx)
> Im (rx)
>
>
> I don't know which arithmetics are involved in the application you 
> mentioned, but writing some auxiliary function for the calculation of 
> x^n when x is complex and n is (a not too large) integer may solve 
> some of the numerical issues. A simple version is:
>
> powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))
>
> The corresponding summation in 'rosen' would then read:
>
> sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
>
>
> HTH,
>
>   Martin
>
>
> Ravi Varadhan wrote:
>   
>> Dear All,
>>
>> Hans Borchers and I have been trying to compute "exact" derivatives 
>> in R
>>     
> using the idea of complex-step derivatives that Hans has proposed.  
> This is a really, really cool idea.  It gives "exact" derivatives with 
> only a minimal effort (same as that involved in computing first-order 
> forward-difference derivative).
>   
>> Unfortunately, we cannot implement this in R as the "complex arithmetic"
>>     
> in R appears to be inaccurate.
>   
>> Here is an example:
>>
>> #-- Classical Rosenbrock function in n variables rosen <- function(x) 
>> { n <- length(x)
>> x1 <- x[2:n]
>> x2 <- x[1:(n-1)]
>> sum(100*(x1-x2^2)^2 + (1-x2)^2)
>> }
>>
>>
>> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 
>> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) 
>> xh <- x0 + h
>>
>> rx <- rosen(xh)
>> Re(rx)
>> Im (rx)
>>
>> #  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect 
>> imaginary part in R
>>
>> However, the imaginary part of the above answer is inaccurate.  The
>>     
> correct imaginary part (from Matlab) is:
>   
>> 190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part 
>> from Matlab
>>
>> This inaccuracy is serious enough to affect the acuracy of the 
>> compex-step
>>     
> gradient drastically.
>   
>> Hans and I were wondering if there is a way to obtain accurate "small"
>>     
> imaginary part for complex arithmetic.  
>   
>> I am using Windows XP operating system.
>>
>> Thanks for taking a look at this.
>>
>> Best regards,
>> Ravi.
>>
>>
>> ____________________________________________________________________
>>
>> Ravi Varadhan, Ph.D.
>> Assistant Professor,
>> Division of Geriatric Medicine and Gerontology School of Medicine 
>> Johns Hopkins University
>>
>> Ph. (410) 502-2619
>> email: rvaradhan at jhmi.edu
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
>>     
>
>
> --
> Dr. Martin Becker
> Statistics and Econometrics
> Saarland University
> Campus C3 1, Room 206
> 66123 Saarbruecken
> Germany
>
>   


--
Dr. Martin Becker
Statistics and Econometrics
Saarland University
Campus C3 1, Room 206
66123 Saarbruecken
Germany


From luethman at student.ethz.ch  Tue Aug  4 16:25:09 2009
From: luethman at student.ethz.ch (luethman at student.ethz.ch)
Date: Tue,  4 Aug 2009 16:25:09 +0200 (CEST)
Subject: [Rd] Accuracy (PR#13867)
Message-ID: <20090804142509.A38FA282EFCC@mail.pubhealth.ku.dk>

Full_Name: Manuel Luethi
Version: 2.9.1
OS: Windows XP
Submission from: (NULL) (129.132.128.136)


Hi

I created the following vectors:

p_1=c(0.2,0.2,0.2,0.2,0.1,0.25,0.4,0.1,0.25,0.4,0.1,0.25,0.4,0.1,0.25,0.4,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8)
p_2=c(0,0,0,0,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.4,0.25,0.1,0.4,0.25,0.1,0.4,0.25,0.1,0.4,0.25,0.1)

As these are probabilities, I calculated the remainder as

p_3=1-p_1-p_2

There the values which ought to be 0.1 were lateron not recognised by p_3==0.1,
but only if I used p_3 <= 0.1.

The full calculation is actually bigger but the core issue remains: I used
values input by hand, built a difference and it was wrong.

I know that exactly the value 0.1 is one that can not be represented using
binary rep. Maybe that's it, maybe not. Just wanted to let you know.

With kind regards

Manuel


From tplate at acm.org  Tue Aug  4 20:26:14 2009
From: tplate at acm.org (Tony Plate)
Date: Tue, 04 Aug 2009 12:26:14 -0600
Subject: [Rd] can a key of a list be a variable
In-Reply-To: <e37a704c0908040947i40a02f9eg9bfa8b507ba0b9ef@mail.gmail.com>
References: <e37a704c0908040947i40a02f9eg9bfa8b507ba0b9ef@mail.gmail.com>
Message-ID: <4A787D46.6050207@acm.org>

Patterns like these can help to do what you want:

 > lapply(setNames(1:3, paste("step", 1:3, sep="")), function(i) seq(i))
$step1
[1] 1

$step2
[1] 1 2

$step3
[1] 1 2 3

 > setNames(list("the result"), paste("a", "name"))
$`a name`
[1] "the result"

 >

-- Tony Plate

Bilel MASMOUDI wrote:
> Hi,
>
> I search a solution to record data in dynamic structures in R.
> I have an algorithm that will be executed each step and whose output is an
> array of doubles with unknown size.
>
> The solution I found is to use lists
> 1) I initialise my list
>  l <- list()
> 2) and at a step numbered i I conacatain the new tab to the list
> vect <- algorithm()
> l <<--c( l , list(stepi=vect))
>
> The problem is that the key "stepi" is here a constant, I'd like to use a
> variable like this
> x = paste("step",index,sep="") where index is the last index (i)
> l <<--c( l , list(x=vect)) --> this doesn't function, the key is named "x"
> not "stepi"
> If I write l <<--c( l , list(paste("step",index,sep="") =vect)), I receive
> an error
>
> Many thanks for your help
>


From savicky at cs.cas.cz  Tue Aug  4 20:27:44 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Tue, 4 Aug 2009 20:27:44 +0200
Subject: [Rd] Accuracy (PR#13867)
In-Reply-To: <20090804142509.A38FA282EFCC@mail.pubhealth.ku.dk>
References: <20090804142509.A38FA282EFCC@mail.pubhealth.ku.dk>
Message-ID: <20090804182744.GB29764@cs.cas.cz>

On Tue, Aug 04, 2009 at 04:25:09PM +0200, luethman at student.ethz.ch wrote:
> Hi
> 
> I created the following vectors:
> 
> p_1=c(0.2,0.2,0.2,0.2,0.1,0.25,0.4,0.1,0.25,0.4,0.1,0.25,0.4,0.1,0.25,0.4,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8)
> p_2=c(0,0,0,0,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.4,0.25,0.1,0.4,0.25,0.1,0.4,0.25,0.1,0.4,0.25,0.1)
> 
> As these are probabilities, I calculated the remainder as
> 
> p_3=1-p_1-p_2
> 
> There the values which ought to be 0.1 were lateron not recognised by p_3==0.1,
> but only if I used p_3 <= 0.1.
> 
> The full calculation is actually bigger but the core issue remains: I used
> values input by hand, built a difference and it was wrong.
> 
> I know that exactly the value 0.1 is one that can not be represented using
> binary rep. Maybe that's it, maybe not.

Yes, this is the problem. In this case, one can obtain a correct
result using round()

  p1 <- c(0.2,0.2,0.2,0.2,0.1,0.25,0.4,0.1,0.25,0.4,0.1,0.25,0.4,0.1,
          0.25,0.4,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8)
  p2 <- c(0,0,0,0,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.4,
          0.25,0.1,0.4,0.25,0.1,0.4,0.25,0.1,0.4,0.25,0.1)
  p3 <- 1 - p1 - p2
  round(p3, 2) == 0.1
  #  [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE
  # [13]  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE
  # [25]  TRUE FALSE FALSE  TRUE

Petr.


From Ashlin.Richardson at NRCan-RNCan.gc.ca  Tue Aug  4 19:41:54 2009
From: Ashlin.Richardson at NRCan-RNCan.gc.ca (Richardson, Ash)
Date: Tue, 4 Aug 2009 13:41:54 -0400
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu><4A76B2BE.1060301@mx.uni-saarland.de><004001ca1453$929c0520$7c94100a@win.ad.jhu.edu><4A781CB9.8030505@mx.uni-saarland.de>
	<007701ca1514$33169e50$7c94100a@win.ad.jhu.edu>
Message-ID: <D5789F53873D29489402919BC2F97D7A02AE2A54@S0-OTT-X3.nrn.nrcan.gc.ca>

Dear Ravi,

Here's an idea:  if R uses the C++ library complex.h, then the problem may lie in the C++ library.
(Or how the C++ library is being called: perhaps it's defaulting to single precision floating point).

I recently wrote an eigen-solver for a complex matrix using explicit formula;
using the C++ library I got residuals of 10^-5. 

Using a complex number class I wrote myself using the polar representation, 
the same program got residuals of 10^-15.

The complex functions in standard C don't seem to have the same problem.  
I think there is something wrong with the C++ implementation of complex numbers.
I think matlab uses the standard C implementation of complex numbers, so it doesn't suffer from this problem.

Best regards,

~ Ash

__________________________________________________

Ash Richardson, BSc

Physical Scientist / Sp?cialiste des science physiques
Natural Resources Canada / Ressources naturelles Canada
Canadian Forest Service / Service canadien des for?ts
Pacific Forestry Centre / Centre de foresterie du Pacifique
506 W. Burnside Road / 506 rue Burnside Ouest
Victoria, BC  V8Z 1M5 / Victoria, C-B V8Z 1M5

Tel: (250) 363-6018       Facs: (250) 363-0775
mailto:ashricha at nrcan.gc.ca
___________________________________________________



-----Original Message-----
From: r-devel-bounces at r-project.org on behalf of Ravi Varadhan
Sent: Tue 8/4/2009 7:59 AM
To: 'Martin Becker'
Cc: hwborchers at googlemail.com; r-devel at stat.math.ethz.ch
Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)


Please forgive me for my lack of understanding of IEEE floating-point
arithmetic.  I have a hard time undertsanding why "this is not a problem of
R itself", when "ALL" the other well known computing environments including
Matlab, Octave, S+, and Scilab provide accurate results.  My concern is not
really about the "overall" accuracy of R, but just about the complex
arithmetic.  Is there something idiosyncratic about the complex arithmetic?


I am really hoping that some one from the R core would speak up and address
this issue.  It would be a loss to the R users if this fascinating idea of
"complex-step derivative" could not be implemented in R.

Thanks,
Ravi. 

----------------------------------------------------------------------------
-------

Ravi Varadhan, Ph.D.

Assistant Professor, The Center on Aging and Health

Division of Geriatric Medicine and Gerontology 

Johns Hopkins University

Ph: (410) 502-2619

Fax: (410) 614-9625

Email: rvaradhan at jhmi.edu

Webpage:
http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.h
tml



----------------------------------------------------------------------------
--------


-----Original Message-----
From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de] 
Sent: Tuesday, August 04, 2009 7:34 AM
To: Ravi Varadhan
Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)

Dear Ravi,

I suspect that, in general, you may be facing the limitations of machine
accuracy (more precisely, IEEE 754 arithmetics on [64-bit] doubles) in your
application. This is not a problem of R itself, but rather a problem of
standard arithmetics provided by underlying C compilers/CPUs.
In fact, every operation in IEEE arithmetics (so, this is not really a
problem only for complex numbers) may suffer from inexactness, a
particularly difficult one is addition/subtraction. Consider the following
example for real numbers (I know, it is not a very good one...):
The two functions

badfn <- function(x) 1-(1+x)*(1-x)
goodfn <- function(x) x^2

both calculate x^2 (theoretically, given perfect arithmetic). So, as you
want to allow the user to 'specify the mathematical function ... in "any"
form the user chooses', both functions should be ok.
But, unfortunately:

 > badfn(1e-8)
[1] 2.220446049250313e-16
 > goodfn(1e-8)
[1] 1e-16

I don't know what happens in matlab/octave/scilab for this example. They may
do better, but probably at some cost (dropping IEEE arithmetic/do "clever"
calculations should result in massive speed penalties, try 
evaluating   hypergeom([1,-99.9],[-49.9-24.9*I],(1+1.71*I)/2);   in 
Maple...).
Now, you have some options:

- assume, that the user is aware of the numerical inexactness of ieee
arithmetics and that he is able to supply some "robust" version of the
mathematical function.
- use some other software (eg., matlab) for the critical calculations (there
is a R <-> Matlab interface, see package R.matlab on CRAN), if you are sure,
that this helps.
- implement/use multiple precision arithmetics within R (Martin Maechler's
Rmpfr package may be very useful: 
http://r-forge.r-project.org/projects/rmpfr/ , but this will slow down
calculations considerably)

All in all, I think it is unfair just to blame R here. Of course, it would
be great if there was a simple trigger to turn on multiple precision
arithmetics in R. Packages such as Rmpfr may provide a good step in this
direction, since operator overloading via S4 classes allows for easy code
adaption. But Rmpfr is still declared "beta", and it relies on some external
library, which could be problematic on Windows systems. Maybe someone else
has other/better suggestions, but I do not think that there is an easy
solution for the "general" problem.

Best wishes,

  Martin


Ravi Varadhan wrote:
> Dear Martin,
>
> Thank you for this useful trick.  However, we are interested in a
"general"
> approach for exact derivative computation.  This approach should allow 
> the user to specify the mathematical function that needs to be 
> differentiated in "any" form that the user chooses.  So, your trick 
> will be difficult to implement there.  Furthermore, do we know for 
> sure that `exponentiation' is the only operation that results in 
> inaccuracy?  Are there other operations that also yield inaccurate results
for complex arithmetic?
>
> Hans Borchers also checked the computations with other free numerical 
> software, such as Octave, Scilab, Euler, and they all return exactly 
> the same results as Matlab.  It would be a shame if R could not do the
same.
>
> It would be great if the R core could address the "fundamental" issue. 
>
> Thank you.
>
> Best regards,
> Ravi.
>
> ----------------------------------------------------------------------
> ------
> -------
>
> Ravi Varadhan, Ph.D.
>
> Assistant Professor, The Center on Aging and Health
>
> Division of Geriatric Medicine and Gerontology
>
> Johns Hopkins University
>
> Ph: (410) 502-2619
>
> Fax: (410) 614-9625
>
> Email: rvaradhan at jhmi.edu
>
> Webpage:
> http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Vara
> dhan.h
> tml
>
>  
>
> ----------------------------------------------------------------------
> ------
> --------
>
>
> -----Original Message-----
> From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de]
> Sent: Monday, August 03, 2009 5:50 AM
> To: Ravi Varadhan
> Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is 
> accurate)
>
> Dear Ravi,
>
> the inaccuracy seems to creep in when powers are calculated. 
> Apparently, some quite general function is called to calculate the 
> squares, and one can avoid the error by reformulating the example as
follows:
>
> rosen <- function(x) {
>   n <- length(x)
>   x1 <- x[2:n]
>   x2 <- x[1:(n-1)]
>   sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2)) }
>
> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 
> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) 
> xh <- x0 + h
>
> rx <- rosen(xh)
> Re(rx)
> Im (rx)
>
>
> I don't know which arithmetics are involved in the application you 
> mentioned, but writing some auxiliary function for the calculation of 
> x^n when x is complex and n is (a not too large) integer may solve 
> some of the numerical issues. A simple version is:
>
> powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))
>
> The corresponding summation in 'rosen' would then read:
>
> sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
>
>
> HTH,
>
>   Martin
>
>
> Ravi Varadhan wrote:
>   
>> Dear All,
>>
>> Hans Borchers and I have been trying to compute "exact" derivatives 
>> in R
>>     
> using the idea of complex-step derivatives that Hans has proposed.  
> This is a really, really cool idea.  It gives "exact" derivatives with 
> only a minimal effort (same as that involved in computing first-order 
> forward-difference derivative).
>   
>> Unfortunately, we cannot implement this in R as the "complex arithmetic"
>>     
> in R appears to be inaccurate.
>   
>> Here is an example:
>>
>> #-- Classical Rosenbrock function in n variables rosen <- function(x) 
>> { n <- length(x)
>> x1 <- x[2:n]
>> x2 <- x[1:(n-1)]
>> sum(100*(x1-x2^2)^2 + (1-x2)^2)
>> }
>>
>>
>> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 
>> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) 
>> xh <- x0 + h
>>
>> rx <- rosen(xh)
>> Re(rx)
>> Im (rx)
>>
>> #  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect 
>> imaginary part in R
>>
>> However, the imaginary part of the above answer is inaccurate.  The
>>     
> correct imaginary part (from Matlab) is:
>   
>> 190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part 
>> from Matlab
>>
>> This inaccuracy is serious enough to affect the acuracy of the 
>> compex-step
>>     
> gradient drastically.
>   
>> Hans and I were wondering if there is a way to obtain accurate "small"
>>     
> imaginary part for complex arithmetic.  
>   
>> I am using Windows XP operating system.
>>
>> Thanks for taking a look at this.
>>
>> Best regards,
>> Ravi.
>>
>>
>> ____________________________________________________________________
>>
>> Ravi Varadhan, Ph.D.
>> Assistant Professor,
>> Division of Geriatric Medicine and Gerontology School of Medicine 
>> Johns Hopkins University
>>
>> Ph. (410) 502-2619
>> email: rvaradhan at jhmi.edu
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
>>     
>
>
> --
> Dr. Martin Becker
> Statistics and Econometrics
> Saarland University
> Campus C3 1, Room 206
> 66123 Saarbruecken
> Germany
>
>   


--
Dr. Martin Becker
Statistics and Econometrics
Saarland University
Campus C3 1, Room 206
66123 Saarbruecken
Germany

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From cbeleites at units.it  Tue Aug  4 23:00:37 2009
From: cbeleites at units.it (Claudia Beleites)
Date: Tue, 4 Aug 2009 23:00:37 +0200
Subject: [Rd] Sweave errors during package building
Message-ID: <200908042300.37398.cbeleites@units.it>

Dear all,

I just spent quite a while fixing a weird error in my vignettes while doing
R CMD build and R CMD check
R CMD Sweave ran fine, though.

The cause turned out to be:

1. I have a data set flu,
2. and  a corresponding vignette explaining things one can do with that 
object. This vignette creates another object flu (which masks the packages 
one). 
3. Now when the next vignette is processed, this object created by the first 
vignette still exists, and still masks the packaged data set.

I was assuming that the building and checking processes are like R CMD Sweave, 
but this is not the case: they are like Sweave inside R, which will also 
change objects in the workspace (as I now know, see the example).

Maybe I didn't enough RTFM, but I was completely unaware of that before.

Would it be a good idea to have a few words about this in the FAQ and in the 
help page? 

Claudia


file testsweave.Rnw:
<<test>>=
a <- 3
b <- 1
@ 

now in R:
> a <- 4
> a
[1] 4
> b
Error: object 'b' not found
> Sweave ("testsweave.Rnw")
Writing to file testsweave.tex
Processing code chunks ...
 1 : echo term verbatim (label=test)

You can now run LaTeX on 'testsweave.tex'
> a
[1] 3
> b
[1] 1
> 



-- 
Claudia Beleites
Dipartimento dei Materiali e delle Risorse Naturali 
Universit? degli Studi di Trieste 
Via Alfonso Valerio 6/a 
I-34127 Trieste

phone: +39 0 40 5 58-37 68 
email: cbeleites at units.it


From richcalaway at revolution-computing.com  Wed Aug  5 00:05:12 2009
From: richcalaway at revolution-computing.com (richcalaway at revolution-computing.com)
Date: Wed,  5 Aug 2009 00:05:12 +0200 (CEST)
Subject: [Rd] Alt-F4 leaves RGUI console in wait state when closing some
	dialog boxes (PR#13870)
Message-ID: <20090804220513.0B274282EFFB@mail.pubhealth.ku.dk>

Full_Name: Rich Calaway
Version: R 2.7.2; R 2.10.0 r48968 2009-07-21
OS: Windows Vista Ultimate SP1, Windows XP SP3
Submission from: (NULL) (65.47.30.18)


Various dialog boxes have different responses to Alt-F4; all of those launched
from the File menu behave correctly--the dialog box closes and the R Console
window responds to input. 

In the Edit menu, when you select Data editor..., and use Alt+F4 to try to close
the dialog box that prompts for the name of a matrix or data frame, the dialog
box closes, the R Console seems unresponsive, but the cursor does not change,
and all menu items are available. If you do the following, however, you see that
all is not well. Choose New script from the File menu, then enter the following
lines:

search()
ls()

If you then try to Run all from the Edit menu, nothing appears to happen. Now
choose Data editor... again, and type in a name, such as state.x77. The data
editor opens, and all of the commands you tried to run in the interim now go
through the R Console. When you exit the data editor, it opens again with the
same data set. When you exit a second time, you should be back to normal.

In the Packages menu, the Load package..., Set CRAN mirror..., Select
Repositories..., and Install packages... dialog boxes all behave the same
way--if you press Alt+F4 after opening these dialog boxes, the dialog box
closes, the cursor becomes a wait cursor while over the R Console, and clicking
Stop returns you to the R prompt.


From murdoch at stats.uwo.ca  Wed Aug  5 01:14:59 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Aug 2009 19:14:59 -0400
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <D5789F53873D29489402919BC2F97D7A02AE2A54@S0-OTT-X3.nrn.nrcan.gc.ca>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu><4A76B2BE.1060301@mx.uni-saarland.de><004001ca1453$929c0520$7c94100a@win.ad.jhu.edu><4A781CB9.8030505@mx.uni-saarland.de>	<007701ca1514$33169e50$7c94100a@win.ad.jhu.edu>
	<D5789F53873D29489402919BC2F97D7A02AE2A54@S0-OTT-X3.nrn.nrcan.gc.ca>
Message-ID: <4A78C0F3.8060408@stats.uwo.ca>

On 04/08/2009 1:41 PM, Richardson, Ash wrote:
> Dear Ravi,
> 
> Here's an idea:  if R uses the C++ library complex.h, then the problem may lie in the C++ library.
> (Or how the C++ library is being called: perhaps it's defaulting to single precision floating point).
> 
> I recently wrote an eigen-solver for a complex matrix using explicit formula;
> using the C++ library I got residuals of 10^-5. 
> 
> Using a complex number class I wrote myself using the polar representation, 
> the same program got residuals of 10^-15.
> 
> The complex functions in standard C don't seem to have the same problem.  
> I think there is something wrong with the C++ implementation of complex numbers.
> I think matlab uses the standard C implementation of complex numbers, so it doesn't suffer from this problem.

R uses the C runtime, not C++.  But the cpow function was not very good. 
  Blame Microsoft for that on Windows, some other scapegoat on whatever 
other platform you use.

Martin M. has now committed some changes to R-devel that give these 
results on Windows:

 > #-- Classical Rosenbrock function in n variables
 > rosen <- function(x) {
+ n <- length(x)
+ x1 <- x[2:n]
+ x2 <- x[1:(n-1)]
+ sum(100*(x1-x2^2)^2 + (1-x2)^2)
+ }
 >
 >
 > x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 
0.0849, 0.4147, 0.4540)
 > h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
 > xh <- x0 + h
 >
 > rx <- rosen(xh)
 > Re(rx)
[1] 190.3080
 > Im (rx)
[1] -4.667764e-15

These seem to agree with the desired numbers.

Duncan Murdoch


> 
> Best regards,
> 
> ~ Ash
> 
> __________________________________________________
> 
> Ash Richardson, BSc
> 
> Physical Scientist / Sp?cialiste des science physiques
> Natural Resources Canada / Ressources naturelles Canada
> Canadian Forest Service / Service canadien des for?ts
> Pacific Forestry Centre / Centre de foresterie du Pacifique
> 506 W. Burnside Road / 506 rue Burnside Ouest
> Victoria, BC  V8Z 1M5 / Victoria, C-B V8Z 1M5
> 
> Tel: (250) 363-6018       Facs: (250) 363-0775
> mailto:ashricha at nrcan.gc.ca
> ___________________________________________________
> 
> 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org on behalf of Ravi Varadhan
> Sent: Tue 8/4/2009 7:59 AM
> To: 'Martin Becker'
> Cc: hwborchers at googlemail.com; r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
> 
> 
> Please forgive me for my lack of understanding of IEEE floating-point
> arithmetic.  I have a hard time undertsanding why "this is not a problem of
> R itself", when "ALL" the other well known computing environments including
> Matlab, Octave, S+, and Scilab provide accurate results.  My concern is not
> really about the "overall" accuracy of R, but just about the complex
> arithmetic.  Is there something idiosyncratic about the complex arithmetic?
> 
> 
> I am really hoping that some one from the R core would speak up and address
> this issue.  It would be a loss to the R users if this fascinating idea of
> "complex-step derivative" could not be implemented in R.
> 
> Thanks,
> Ravi. 
> 
> ----------------------------------------------------------------------------
> -------
> 
> Ravi Varadhan, Ph.D.
> 
> Assistant Professor, The Center on Aging and Health
> 
> Division of Geriatric Medicine and Gerontology 
> 
> Johns Hopkins University
> 
> Ph: (410) 502-2619
> 
> Fax: (410) 614-9625
> 
> Email: rvaradhan at jhmi.edu
> 
> Webpage:
> http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.h
> tml
> 
> 
> 
> ----------------------------------------------------------------------------
> --------
> 
> 
> -----Original Message-----
> From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de] 
> Sent: Tuesday, August 04, 2009 7:34 AM
> To: Ravi Varadhan
> Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
> 
> Dear Ravi,
> 
> I suspect that, in general, you may be facing the limitations of machine
> accuracy (more precisely, IEEE 754 arithmetics on [64-bit] doubles) in your
> application. This is not a problem of R itself, but rather a problem of
> standard arithmetics provided by underlying C compilers/CPUs.
> In fact, every operation in IEEE arithmetics (so, this is not really a
> problem only for complex numbers) may suffer from inexactness, a
> particularly difficult one is addition/subtraction. Consider the following
> example for real numbers (I know, it is not a very good one...):
> The two functions
> 
> badfn <- function(x) 1-(1+x)*(1-x)
> goodfn <- function(x) x^2
> 
> both calculate x^2 (theoretically, given perfect arithmetic). So, as you
> want to allow the user to 'specify the mathematical function ... in "any"
> form the user chooses', both functions should be ok.
> But, unfortunately:
> 
>  > badfn(1e-8)
> [1] 2.220446049250313e-16
>  > goodfn(1e-8)
> [1] 1e-16
> 
> I don't know what happens in matlab/octave/scilab for this example. They may
> do better, but probably at some cost (dropping IEEE arithmetic/do "clever"
> calculations should result in massive speed penalties, try 
> evaluating   hypergeom([1,-99.9],[-49.9-24.9*I],(1+1.71*I)/2);   in 
> Maple...).
> Now, you have some options:
> 
> - assume, that the user is aware of the numerical inexactness of ieee
> arithmetics and that he is able to supply some "robust" version of the
> mathematical function.
> - use some other software (eg., matlab) for the critical calculations (there
> is a R <-> Matlab interface, see package R.matlab on CRAN), if you are sure,
> that this helps.
> - implement/use multiple precision arithmetics within R (Martin Maechler's
> Rmpfr package may be very useful: 
> http://r-forge.r-project.org/projects/rmpfr/ , but this will slow down
> calculations considerably)
> 
> All in all, I think it is unfair just to blame R here. Of course, it would
> be great if there was a simple trigger to turn on multiple precision
> arithmetics in R. Packages such as Rmpfr may provide a good step in this
> direction, since operator overloading via S4 classes allows for easy code
> adaption. But Rmpfr is still declared "beta", and it relies on some external
> library, which could be problematic on Windows systems. Maybe someone else
> has other/better suggestions, but I do not think that there is an easy
> solution for the "general" problem.
> 
> Best wishes,
> 
>   Martin
> 
> 
> Ravi Varadhan wrote:
>> Dear Martin,
>>
>> Thank you for this useful trick.  However, we are interested in a
> "general"
>> approach for exact derivative computation.  This approach should allow 
>> the user to specify the mathematical function that needs to be 
>> differentiated in "any" form that the user chooses.  So, your trick 
>> will be difficult to implement there.  Furthermore, do we know for 
>> sure that `exponentiation' is the only operation that results in 
>> inaccuracy?  Are there other operations that also yield inaccurate results
> for complex arithmetic?
>> Hans Borchers also checked the computations with other free numerical 
>> software, such as Octave, Scilab, Euler, and they all return exactly 
>> the same results as Matlab.  It would be a shame if R could not do the
> same.
>> It would be great if the R core could address the "fundamental" issue. 
>>
>> Thank you.
>>
>> Best regards,
>> Ravi.
>>
>> ----------------------------------------------------------------------
>> ------
>> -------
>>
>> Ravi Varadhan, Ph.D.
>>
>> Assistant Professor, The Center on Aging and Health
>>
>> Division of Geriatric Medicine and Gerontology
>>
>> Johns Hopkins University
>>
>> Ph: (410) 502-2619
>>
>> Fax: (410) 614-9625
>>
>> Email: rvaradhan at jhmi.edu
>>
>> Webpage:
>> http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Vara
>> dhan.h
>> tml
>>
>>  
>>
>> ----------------------------------------------------------------------
>> ------
>> --------
>>
>>
>> -----Original Message-----
>> From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de]
>> Sent: Monday, August 03, 2009 5:50 AM
>> To: Ravi Varadhan
>> Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
>> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is 
>> accurate)
>>
>> Dear Ravi,
>>
>> the inaccuracy seems to creep in when powers are calculated. 
>> Apparently, some quite general function is called to calculate the 
>> squares, and one can avoid the error by reformulating the example as
> follows:
>> rosen <- function(x) {
>>   n <- length(x)
>>   x1 <- x[2:n]
>>   x2 <- x[1:(n-1)]
>>   sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2)) }
>>
>> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 
>> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) 
>> xh <- x0 + h
>>
>> rx <- rosen(xh)
>> Re(rx)
>> Im (rx)
>>
>>
>> I don't know which arithmetics are involved in the application you 
>> mentioned, but writing some auxiliary function for the calculation of 
>> x^n when x is complex and n is (a not too large) integer may solve 
>> some of the numerical issues. A simple version is:
>>
>> powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))
>>
>> The corresponding summation in 'rosen' would then read:
>>
>> sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
>>
>>
>> HTH,
>>
>>   Martin
>>
>>
>> Ravi Varadhan wrote:
>>   
>>> Dear All,
>>>
>>> Hans Borchers and I have been trying to compute "exact" derivatives 
>>> in R
>>>     
>> using the idea of complex-step derivatives that Hans has proposed.  
>> This is a really, really cool idea.  It gives "exact" derivatives with 
>> only a minimal effort (same as that involved in computing first-order 
>> forward-difference derivative).
>>   
>>> Unfortunately, we cannot implement this in R as the "complex arithmetic"
>>>     
>> in R appears to be inaccurate.
>>   
>>> Here is an example:
>>>
>>> #-- Classical Rosenbrock function in n variables rosen <- function(x) 
>>> { n <- length(x)
>>> x1 <- x[2:n]
>>> x2 <- x[1:(n-1)]
>>> sum(100*(x1-x2^2)^2 + (1-x2)^2)
>>> }
>>>
>>>
>>> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 
>>> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0) 
>>> xh <- x0 + h
>>>
>>> rx <- rosen(xh)
>>> Re(rx)
>>> Im (rx)
>>>
>>> #  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect 
>>> imaginary part in R
>>>
>>> However, the imaginary part of the above answer is inaccurate.  The
>>>     
>> correct imaginary part (from Matlab) is:
>>   
>>> 190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part 
>>> from Matlab
>>>
>>> This inaccuracy is serious enough to affect the acuracy of the 
>>> compex-step
>>>     
>> gradient drastically.
>>   
>>> Hans and I were wondering if there is a way to obtain accurate "small"
>>>     
>> imaginary part for complex arithmetic.  
>>   
>>> I am using Windows XP operating system.
>>>
>>> Thanks for taking a look at this.
>>>
>>> Best regards,
>>> Ravi.
>>>
>>>
>>> ____________________________________________________________________
>>>
>>> Ravi Varadhan, Ph.D.
>>> Assistant Professor,
>>> Division of Geriatric Medicine and Gerontology School of Medicine 
>>> Johns Hopkins University
>>>
>>> Ph. (410) 502-2619
>>> email: rvaradhan at jhmi.edu
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>   
>>>     
>>
>> --
>> Dr. Martin Becker
>> Statistics and Econometrics
>> Saarland University
>> Campus C3 1, Room 206
>> 66123 Saarbruecken
>> Germany
>>
>>   
> 
> 
> --
> Dr. Martin Becker
> Statistics and Econometrics
> Saarland University
> Campus C3 1, Room 206
> 66123 Saarbruecken
> Germany
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Greg.Snow at imail.org  Wed Aug  5 01:25:42 2009
From: Greg.Snow at imail.org (Greg Snow)
Date: Tue, 4 Aug 2009 17:25:42 -0600
Subject: [Rd] Accuracy (PR#13867)
In-Reply-To: <20090804142509.A38FA282EFCC@mail.pubhealth.ku.dk>
References: <20090804142509.A38FA282EFCC@mail.pubhealth.ku.dk>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC6212E38046@LP-EXMBVS10.CO.IHC.COM>

What research into this problem did you do that failed to turn up FAQ 7.31?

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
801.408.8111


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of luethman at student.ethz.ch
> Sent: Tuesday, August 04, 2009 8:25 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at r-project.org
> Subject: [Rd] Accuracy (PR#13867)
> 
> Full_Name: Manuel Luethi
> Version: 2.9.1
> OS: Windows XP
> Submission from: (NULL) (129.132.128.136)
> 
> 
> Hi
> 
> I created the following vectors:
> 
> p_1=c(0.2,0.2,0.2,0.2,0.1,0.25,0.4,0.1,0.25,0.4,0.1,0.25,0.4,0.1,0.25,0
> .4,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8)
> p_2=c(0,0,0,0,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.4,0.25,
> 0.1,0.4,0.25,0.1,0.4,0.25,0.1,0.4,0.25,0.1)
> 
> As these are probabilities, I calculated the remainder as
> 
> p_3=1-p_1-p_2
> 
> There the values which ought to be 0.1 were lateron not recognised by
> p_3==0.1,
> but only if I used p_3 <= 0.1.
> 
> The full calculation is actually bigger but the core issue remains: I
> used
> values input by hand, built a difference and it was wrong.
> 
> I know that exactly the value 0.1 is one that can not be represented
> using
> binary rep. Maybe that's it, maybe not. Just wanted to let you know.
> 
> With kind regards
> 
> Manuel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Greg.Snow at imail.org  Wed Aug  5 01:30:35 2009
From: Greg.Snow at imail.org (Greg.Snow at imail.org)
Date: Wed,  5 Aug 2009 01:30:35 +0200 (CEST)
Subject: [Rd] Accuracy (PR#13867)
Message-ID: <20090804233036.3B921282EFFB@mail.pubhealth.ku.dk>

What research into this problem did you do that failed to turn up FAQ 7.31?

--=20
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
801.408.8111


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of luethman at student.ethz.ch
> Sent: Tuesday, August 04, 2009 8:25 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at r-project.org
> Subject: [Rd] Accuracy (PR#13867)
>=20
> Full_Name: Manuel Luethi
> Version: 2.9.1
> OS: Windows XP
> Submission from: (NULL) (129.132.128.136)
>=20
>=20
> Hi
>=20
> I created the following vectors:
>=20
> p_1=3Dc(0.2,0.2,0.2,0.2,0.1,0.25,0.4,0.1,0.25,0.4,0.1,0.25,0.4,0.1,0.25,0
> .4,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8,0.2,0.5,0.8)
> p_2=3Dc(0,0,0,0,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.4,0.25,
> 0.1,0.4,0.25,0.1,0.4,0.25,0.1,0.4,0.25,0.1)
>=20
> As these are probabilities, I calculated the remainder as
>=20
> p_3=3D1-p_1-p_2
>=20
> There the values which ought to be 0.1 were lateron not recognised by
> p_3=3D=3D0.1,
> but only if I used p_3 <=3D 0.1.
>=20
> The full calculation is actually bigger but the core issue remains: I
> used
> values input by hand, built a difference and it was wrong.
>=20
> I know that exactly the value 0.1 is one that can not be represented
> using
> binary rep. Maybe that's it, maybe not. Just wanted to let you know.
>=20
> With kind regards
>=20
> Manuel
>=20
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From smckinney at bccrc.ca  Wed Aug  5 01:33:32 2009
From: smckinney at bccrc.ca (Steven McKinney)
Date: Tue, 4 Aug 2009 16:33:32 -0700
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
 specified (PR#13860)
In-Reply-To: <4A784D9F.8050504@stats.uwo.ca>
References: <20090728223012.75E272830316@mail.pubhealth.ku.dk>
	<4A784D9F.8050504@stats.uwo.ca>
Message-ID: <DCE81E14EB74504B971DAD4D2DB0356B0210B84D@crcmail4.BCCRC.CA>


> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
> Sent: Tuesday, August 04, 2009 8:03 AM
> To: Steven McKinney
> Cc: r-devel at stat.math.ethz.ch; R-bugs at r-project.org
> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
> topic specified (PR#13860)
> 
> On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
> > Hi all,
> >
> > When I install a new package, and don't yet know any function names,
> > I have to play the "poor man's game" to get to the standard
> > help system "Index" page for the package:
> 
> You could complain to the package author or maintainer, who should have
> created a help alias with the package name so that ?survival would give
> you something useful.  But I would guess R 2.10.x or 2.11.x will do
> that
> automatically.
> 
> Duncan Murdoch

Unfortunately it happens frequently - hopefully I
don't have to complain so much - I'd rather figure
out code to get to the index page!  

When you say "I would guess R 2.10.x or 2.11.x will do
that automatically" do you mean
?survival::
or some similar incantation
will take me to the Index or 00Index page?

Do I need to propose code or is it already
known how to do this within the R core group?

Best
Steve McKinney


> 
> > Poor Man's Game -=20
> >   Load new package;=20
> >   issue search() command;
> >   find position (say N) of loaded package;=20
> >   issue objects(pos =3D N) command;
> >   get name of a random function (san newFunction);=20
> >   issue ?newFunction command;
> >   scroll to bottom of page;=20
> >   click on the "Index" hyperlink
> >
> > There are other variations, but they all involve this=20
> > long march to the Index page.
> >
> >
> > What I'd like to be able to do is enter the command
> >
> >> help(package =3D "survival")
> >
> > or
> >
> >> ?survival::
> >
> > and get the usual hyperlinked help page displayed (the "00Index"
> page)
> > instead of the static "text only" display or an error message
> >
> > (for example, on Windows, this equates to invoking
> > "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> > on Apple Mac,
> >
> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Inde
> x.ht=
> > ml"
> > etc.)
> >
> >
> > Details:
> > ---------------
> >
> > The help() function returns an object of
> > class "help_files_with_topic".
> > The object consists of a character vector
> > with several attributes.
> >
> > PC:  Windows XP
> >
> >> library("survival")
> >> foo <- help("aareg", package =3D "survival")
> >> class(foo)
> > [1] "help_files_with_topic"
> >> foo[1]
> > [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
> >> attributes(foo)
> > $call
> > help(topic =3D "aareg", package =3D "survival")
> >
> > $pager
> > [1] "internal"
> >
> > $topic
> > [1] "aareg"
> >
> > $tried_all_packages
> > [1] FALSE
> >
> > $type
> > [1] "chm"
> >
> > $class
> > [1] "help_files_with_topic"
> >
> >> bar <- help("", package =3D "survival")
> >> class(bar)
> > [1] "help_files_with_topic"
> >> bar[1]
> > [1] NA
> >> attributes(bar)
> > $call
> > help(topic =3D "", package =3D "survival")
> >
> > $pager
> > [1] "internal"
> >
> > $topic
> > [1] ""
> >
> > $tried_all_packages
> > [1] FALSE
> >
> > $type
> > [1] "chm"
> >
> > $class
> > [1] "help_files_with_topic"
> >
> > If I alter the character vector to
> > point to "00Index"
> >
> >> bar[1] <- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> >> bar
> >
> > I see exactly what I've been attempting to achieve.
> >
> >
> > Mac OS X:
> >
> >> foo <- help("aareg", package =3D "survival")
> >> foo[1]
> > [1]
> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
> =
> > html"
> >> attributes(foo)
> > $call
> > help(topic =3D "aareg", package =3D "survival")
> >
> > $pager
> > [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> >
> > $topic
> > [1] "aareg"
> >
> > $tried_all_packages
> > [1] FALSE
> >
> > $type
> > [1] "html"
> >
> > $class
> > [1] "help_files_with_topic"
> >
> >> bar <- help("", package =3D "survival")
> >> bar[1]
> > [1] NA
> >> bar[1] <-
> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
> > l/00Index.html"
> >> bar
> >
> > Again I see exactly what I've been after.
> >
> > Running R in Emacs on Mac OS X:
> >
> >> foo <- help(topic =3D "aareg", package =3D "survival")
> >> foo[1]
> > [1]
> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
> =
> > html"
> >> attributes(foo)
> > $call
> > help(topic =3D "aareg", package =3D "survival")
> >
> > $pager
> > [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> >
> > $topic
> > [1] "aareg"
> >
> > $tried_all_packages
> > [1] FALSE
> >
> > $type
> > [1] "html"
> >
> > $class
> > [1] "help_files_with_topic"
> >
> >> bar <- help(topic =3D "", package =3D "survival")
> >> bar[1]
> > [1] NA
> >> bar[1] <-
> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
> > l/00Index.html"
> >> bar
> > Help for '' is shown in browser /usr/bin/open ...
> > Use
> >         help("", htmlhelp =3D FALSE)
> > or
> >         options(htmlhelp =3D FALSE)
> > to revert.
> >>
> >
> > Again, what I've been trying to achieve.
> >
> > When a user loads a new library and doesn't yet know any function
> names,
> > I think
> >> help(package =3D "newLibrary")
> > or
> >> ?newLibrary::
> >
> > should perform the above action whenever possible instead of
> > producing static help or an error message.
> >
> > The "00Index" 'object' should be available for such use
> > whenever it exists. =20
> >
> > I have not yet worked out all the coding details to make this happen,
> > but before I do, am I missing some key point?  Any reasons why this
> > would be a Bad Idea?
> >
> >
> >
> > Steven McKinney, Ph.D.
> >
> > Statistician
> > Molecular Oncology and Breast Cancer Program
> > British Columbia Cancer Research Centre
> >
> > email: smckinney +at+ bccrc +dot+ ca
> >
> > tel: 604-675-8000 x7561
> >
> > BCCRC
> > Molecular Oncology
> > 675 West 10th Ave, Floor 4
> > Vancouver B.C.
> > V5Z 1L3
> > Canada
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel


From smckinney at bccrc.ca  Wed Aug  5 01:35:11 2009
From: smckinney at bccrc.ca (smckinney at bccrc.ca)
Date: Wed,  5 Aug 2009 01:35:11 +0200 (CEST)
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
	(PR#13871)
Message-ID: <20090804233511.EE27D282EFFB@mail.pubhealth.ku.dk>


> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
> Sent: Tuesday, August 04, 2009 8:03 AM
> To: Steven McKinney
> Cc: r-devel at stat.math.ethz.ch; R-bugs at r-project.org
> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
> topic specified (PR#13860)
>=20
> On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
> > Hi all,
> >
> > When I install a new package, and don't yet know any function names,
> > I have to play the "poor man's game" to get to the standard
> > help system "Index" page for the package:
>=20
> You could complain to the package author or maintainer, who should have
> created a help alias with the package name so that ?survival would give
> you something useful.  But I would guess R 2.10.x or 2.11.x will do
> that
> automatically.
>=20
> Duncan Murdoch

Unfortunately it happens frequently - hopefully I
don't have to complain so much - I'd rather figure
out code to get to the index page! =20

When you say "I would guess R 2.10.x or 2.11.x will do
that automatically" do you mean
?survival::
or some similar incantation
will take me to the Index or 00Index page?

Do I need to propose code or is it already
known how to do this within the R core group?

Best
Steve McKinney


>=20
> > Poor Man's Game -=3D20
> >   Load new package;=3D20
> >   issue search() command;
> >   find position (say N) of loaded package;=3D20
> >   issue objects(pos =3D3D N) command;
> >   get name of a random function (san newFunction);=3D20
> >   issue ?newFunction command;
> >   scroll to bottom of page;=3D20
> >   click on the "Index" hyperlink
> >
> > There are other variations, but they all involve this=3D20
> > long march to the Index page.
> >
> >
> > What I'd like to be able to do is enter the command
> >
> >> help(package =3D3D "survival")
> >
> > or
> >
> >> ?survival::
> >
> > and get the usual hyperlinked help page displayed (the "00Index"
> page)
> > instead of the static "text only" display or an error message
> >
> > (for example, on Windows, this equates to invoking
> > "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> > on Apple Mac,
> >
> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Inde
> x.ht=3D
> > ml"
> > etc.)
> >
> >
> > Details:
> > ---------------
> >
> > The help() function returns an object of
> > class "help_files_with_topic".
> > The object consists of a character vector
> > with several attributes.
> >
> > PC:  Windows XP
> >
> >> library("survival")
> >> foo <- help("aareg", package =3D3D "survival")
> >> class(foo)
> > [1] "help_files_with_topic"
> >> foo[1]
> > [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
> >> attributes(foo)
> > $call
> > help(topic =3D3D "aareg", package =3D3D "survival")
> >
> > $pager
> > [1] "internal"
> >
> > $topic
> > [1] "aareg"
> >
> > $tried_all_packages
> > [1] FALSE
> >
> > $type
> > [1] "chm"
> >
> > $class
> > [1] "help_files_with_topic"
> >
> >> bar <- help("", package =3D3D "survival")
> >> class(bar)
> > [1] "help_files_with_topic"
> >> bar[1]
> > [1] NA
> >> attributes(bar)
> > $call
> > help(topic =3D3D "", package =3D3D "survival")
> >
> > $pager
> > [1] "internal"
> >
> > $topic
> > [1] ""
> >
> > $tried_all_packages
> > [1] FALSE
> >
> > $type
> > [1] "chm"
> >
> > $class
> > [1] "help_files_with_topic"
> >
> > If I alter the character vector to
> > point to "00Index"
> >
> >> bar[1] <- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> >> bar
> >
> > I see exactly what I've been attempting to achieve.
> >
> >
> > Mac OS X:
> >
> >> foo <- help("aareg", package =3D3D "survival")
> >> foo[1]
> > [1]
> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
> =3D
> > html"
> >> attributes(foo)
> > $call
> > help(topic =3D3D "aareg", package =3D3D "survival")
> >
> > $pager
> > [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> >
> > $topic
> > [1] "aareg"
> >
> > $tried_all_packages
> > [1] FALSE
> >
> > $type
> > [1] "html"
> >
> > $class
> > [1] "help_files_with_topic"
> >
> >> bar <- help("", package =3D3D "survival")
> >> bar[1]
> > [1] NA
> >> bar[1] <-
> "/Library/Frameworks/R.framework/Resources/library/survival/htm=3D
> > l/00Index.html"
> >> bar
> >
> > Again I see exactly what I've been after.
> >
> > Running R in Emacs on Mac OS X:
> >
> >> foo <- help(topic =3D3D "aareg", package =3D3D "survival")
> >> foo[1]
> > [1]
> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
> =3D
> > html"
> >> attributes(foo)
> > $call
> > help(topic =3D3D "aareg", package =3D3D "survival")
> >
> > $pager
> > [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> >
> > $topic
> > [1] "aareg"
> >
> > $tried_all_packages
> > [1] FALSE
> >
> > $type
> > [1] "html"
> >
> > $class
> > [1] "help_files_with_topic"
> >
> >> bar <- help(topic =3D3D "", package =3D3D "survival")
> >> bar[1]
> > [1] NA
> >> bar[1] <-
> "/Library/Frameworks/R.framework/Resources/library/survival/htm=3D
> > l/00Index.html"
> >> bar
> > Help for '' is shown in browser /usr/bin/open ...
> > Use
> >         help("", htmlhelp =3D3D FALSE)
> > or
> >         options(htmlhelp =3D3D FALSE)
> > to revert.
> >>
> >
> > Again, what I've been trying to achieve.
> >
> > When a user loads a new library and doesn't yet know any function
> names,
> > I think
> >> help(package =3D3D "newLibrary")
> > or
> >> ?newLibrary::
> >
> > should perform the above action whenever possible instead of
> > producing static help or an error message.
> >
> > The "00Index" 'object' should be available for such use
> > whenever it exists. =3D20
> >
> > I have not yet worked out all the coding details to make this happen,
> > but before I do, am I missing some key point?  Any reasons why this
> > would be a Bad Idea?
> >
> >
> >
> > Steven McKinney, Ph.D.
> >
> > Statistician
> > Molecular Oncology and Breast Cancer Program
> > British Columbia Cancer Research Centre
> >
> > email: smckinney +at+ bccrc +dot+ ca
> >
> > tel: 604-675-8000 x7561
> >
> > BCCRC
> > Molecular Oncology
> > 675 West 10th Ave, Floor 4
> > Vancouver B.C.
> > V5Z 1L3
> > Canada
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Wed Aug  5 02:05:46 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Aug 2009 20:05:46 -0400
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
 specified (PR#13860)
In-Reply-To: <DCE81E14EB74504B971DAD4D2DB0356B0210B84D@crcmail4.BCCRC.CA>
References: <20090728223012.75E272830316@mail.pubhealth.ku.dk>
	<4A784D9F.8050504@stats.uwo.ca>
	<DCE81E14EB74504B971DAD4D2DB0356B0210B84D@crcmail4.BCCRC.CA>
Message-ID: <4A78CCDA.1080802@stats.uwo.ca>

On 04/08/2009 7:33 PM, Steven McKinney wrote:
>> -----Original Message-----
>> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
>> Sent: Tuesday, August 04, 2009 8:03 AM
>> To: Steven McKinney
>> Cc: r-devel at stat.math.ethz.ch; R-bugs at r-project.org
>> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
>> topic specified (PR#13860)
>>
>> On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
>>> Hi all,
>>>
>>> When I install a new package, and don't yet know any function names,
>>> I have to play the "poor man's game" to get to the standard
>>> help system "Index" page for the package:
>> You could complain to the package author or maintainer, who should have
>> created a help alias with the package name so that ?survival would give
>> you something useful.  But I would guess R 2.10.x or 2.11.x will do
>> that
>> automatically.
>>
>> Duncan Murdoch
> 
> Unfortunately it happens frequently - hopefully I
> don't have to complain so much - I'd rather figure
> out code to get to the index page!  
> 
> When you say "I would guess R 2.10.x or 2.11.x will do
> that automatically" do you mean
> ?survival::
> or some similar incantation
> will take me to the Index or 00Index page?

I would guess package?survival will take you to a help page that is 
similar to what you get now in the flat display from 
library(help=survival).  Ideally it will have a link on it to the index 
page.  It is possible that ?survival will work too; that may be more 
controversial, because for many packages (e.g. boot) an alias like that 
is already defined, pointing to something other than the package main page.

> Do I need to propose code or is it already
> known how to do this within the R core group?

I doubt if code to do that would be accepted (since it will be redundant 
once the above changes are in place), but posting it to r-devel might 
help people in the meantime.  You should look at the tools package, 
which has a number of functions that are used by R for constructing the 
help pages; there's probably something there that will let you construct 
a link to the index fairly easily.

Duncan Murdoch

> Best
> Steve McKinney
> 
> 
>>> Poor Man's Game -=20
>>>   Load new package;=20
>>>   issue search() command;
>>>   find position (say N) of loaded package;=20
>>>   issue objects(pos =3D N) command;
>>>   get name of a random function (san newFunction);=20
>>>   issue ?newFunction command;
>>>   scroll to bottom of page;=20
>>>   click on the "Index" hyperlink
>>>
>>> There are other variations, but they all involve this=20
>>> long march to the Index page.
>>>
>>>
>>> What I'd like to be able to do is enter the command
>>>
>>>> help(package =3D "survival")
>>> or
>>>
>>>> ?survival::
>>> and get the usual hyperlinked help page displayed (the "00Index"
>> page)
>>> instead of the static "text only" display or an error message
>>>
>>> (for example, on Windows, this equates to invoking
>>> "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>>> on Apple Mac,
>>>
>> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Inde
>> x.ht=
>>> ml"
>>> etc.)
>>>
>>>
>>> Details:
>>> ---------------
>>>
>>> The help() function returns an object of
>>> class "help_files_with_topic".
>>> The object consists of a character vector
>>> with several attributes.
>>>
>>> PC:  Windows XP
>>>
>>>> library("survival")
>>>> foo <- help("aareg", package =3D "survival")
>>>> class(foo)
>>> [1] "help_files_with_topic"
>>>> foo[1]
>>> [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
>>>> attributes(foo)
>>> $call
>>> help(topic =3D "aareg", package =3D "survival")
>>>
>>> $pager
>>> [1] "internal"
>>>
>>> $topic
>>> [1] "aareg"
>>>
>>> $tried_all_packages
>>> [1] FALSE
>>>
>>> $type
>>> [1] "chm"
>>>
>>> $class
>>> [1] "help_files_with_topic"
>>>
>>>> bar <- help("", package =3D "survival")
>>>> class(bar)
>>> [1] "help_files_with_topic"
>>>> bar[1]
>>> [1] NA
>>>> attributes(bar)
>>> $call
>>> help(topic =3D "", package =3D "survival")
>>>
>>> $pager
>>> [1] "internal"
>>>
>>> $topic
>>> [1] ""
>>>
>>> $tried_all_packages
>>> [1] FALSE
>>>
>>> $type
>>> [1] "chm"
>>>
>>> $class
>>> [1] "help_files_with_topic"
>>>
>>> If I alter the character vector to
>>> point to "00Index"
>>>
>>>> bar[1] <- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>>>> bar
>>> I see exactly what I've been attempting to achieve.
>>>
>>>
>>> Mac OS X:
>>>
>>>> foo <- help("aareg", package =3D "survival")
>>>> foo[1]
>>> [1]
>> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
>> =
>>> html"
>>>> attributes(foo)
>>> $call
>>> help(topic =3D "aareg", package =3D "survival")
>>>
>>> $pager
>>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
>>>
>>> $topic
>>> [1] "aareg"
>>>
>>> $tried_all_packages
>>> [1] FALSE
>>>
>>> $type
>>> [1] "html"
>>>
>>> $class
>>> [1] "help_files_with_topic"
>>>
>>>> bar <- help("", package =3D "survival")
>>>> bar[1]
>>> [1] NA
>>>> bar[1] <-
>> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
>>> l/00Index.html"
>>>> bar
>>> Again I see exactly what I've been after.
>>>
>>> Running R in Emacs on Mac OS X:
>>>
>>>> foo <- help(topic =3D "aareg", package =3D "survival")
>>>> foo[1]
>>> [1]
>> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
>> =
>>> html"
>>>> attributes(foo)
>>> $call
>>> help(topic =3D "aareg", package =3D "survival")
>>>
>>> $pager
>>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
>>>
>>> $topic
>>> [1] "aareg"
>>>
>>> $tried_all_packages
>>> [1] FALSE
>>>
>>> $type
>>> [1] "html"
>>>
>>> $class
>>> [1] "help_files_with_topic"
>>>
>>>> bar <- help(topic =3D "", package =3D "survival")
>>>> bar[1]
>>> [1] NA
>>>> bar[1] <-
>> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
>>> l/00Index.html"
>>>> bar
>>> Help for '' is shown in browser /usr/bin/open ...
>>> Use
>>>         help("", htmlhelp =3D FALSE)
>>> or
>>>         options(htmlhelp =3D FALSE)
>>> to revert.
>>> Again, what I've been trying to achieve.
>>>
>>> When a user loads a new library and doesn't yet know any function
>> names,
>>> I think
>>>> help(package =3D "newLibrary")
>>> or
>>>> ?newLibrary::
>>> should perform the above action whenever possible instead of
>>> producing static help or an error message.
>>>
>>> The "00Index" 'object' should be available for such use
>>> whenever it exists. =20
>>>
>>> I have not yet worked out all the coding details to make this happen,
>>> but before I do, am I missing some key point?  Any reasons why this
>>> would be a Bad Idea?
>>>
>>>
>>>
>>> Steven McKinney, Ph.D.
>>>
>>> Statistician
>>> Molecular Oncology and Breast Cancer Program
>>> British Columbia Cancer Research Centre
>>>
>>> email: smckinney +at+ bccrc +dot+ ca
>>>
>>> tel: 604-675-8000 x7561
>>>
>>> BCCRC
>>> Molecular Oncology
>>> 675 West 10th Ave, Floor 4
>>> Vancouver B.C.
>>> V5Z 1L3
>>> Canada
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Wed Aug  5 02:10:12 2009
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Wed,  5 Aug 2009 02:10:12 +0200 (CEST)
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
	(PR#13872)
Message-ID: <20090805001012.9BA51282EFFB@mail.pubhealth.ku.dk>

On 04/08/2009 7:33 PM, Steven McKinney wrote:
>> -----Original Message-----
>> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
>> Sent: Tuesday, August 04, 2009 8:03 AM
>> To: Steven McKinney
>> Cc: r-devel at stat.math.ethz.ch; R-bugs at r-project.org
>> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
>> topic specified (PR#13860)
>>
>> On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
>>> Hi all,
>>>
>>> When I install a new package, and don't yet know any function names,
>>> I have to play the "poor man's game" to get to the standard
>>> help system "Index" page for the package:
>> You could complain to the package author or maintainer, who should have
>> created a help alias with the package name so that ?survival would give
>> you something useful.  But I would guess R 2.10.x or 2.11.x will do
>> that
>> automatically.
>>
>> Duncan Murdoch
> 
> Unfortunately it happens frequently - hopefully I
> don't have to complain so much - I'd rather figure
> out code to get to the index page!  
> 
> When you say "I would guess R 2.10.x or 2.11.x will do
> that automatically" do you mean
> ?survival::
> or some similar incantation
> will take me to the Index or 00Index page?

I would guess package?survival will take you to a help page that is 
similar to what you get now in the flat display from 
library(help=survival).  Ideally it will have a link on it to the index 
page.  It is possible that ?survival will work too; that may be more 
controversial, because for many packages (e.g. boot) an alias like that 
is already defined, pointing to something other than the package main page.

> Do I need to propose code or is it already
> known how to do this within the R core group?

I doubt if code to do that would be accepted (since it will be redundant 
once the above changes are in place), but posting it to r-devel might 
help people in the meantime.  You should look at the tools package, 
which has a number of functions that are used by R for constructing the 
help pages; there's probably something there that will let you construct 
a link to the index fairly easily.

Duncan Murdoch

> Best
> Steve McKinney
> 
> 
>>> Poor Man's Game -=20
>>>   Load new package;=20
>>>   issue search() command;
>>>   find position (say N) of loaded package;=20
>>>   issue objects(pos =3D N) command;
>>>   get name of a random function (san newFunction);=20
>>>   issue ?newFunction command;
>>>   scroll to bottom of page;=20
>>>   click on the "Index" hyperlink
>>>
>>> There are other variations, but they all involve this=20
>>> long march to the Index page.
>>>
>>>
>>> What I'd like to be able to do is enter the command
>>>
>>>> help(package =3D "survival")
>>> or
>>>
>>>> ?survival::
>>> and get the usual hyperlinked help page displayed (the "00Index"
>> page)
>>> instead of the static "text only" display or an error message
>>>
>>> (for example, on Windows, this equates to invoking
>>> "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>>> on Apple Mac,
>>>
>> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Inde
>> x.ht=
>>> ml"
>>> etc.)
>>>
>>>
>>> Details:
>>> ---------------
>>>
>>> The help() function returns an object of
>>> class "help_files_with_topic".
>>> The object consists of a character vector
>>> with several attributes.
>>>
>>> PC:  Windows XP
>>>
>>>> library("survival")
>>>> foo <- help("aareg", package =3D "survival")
>>>> class(foo)
>>> [1] "help_files_with_topic"
>>>> foo[1]
>>> [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
>>>> attributes(foo)
>>> $call
>>> help(topic =3D "aareg", package =3D "survival")
>>>
>>> $pager
>>> [1] "internal"
>>>
>>> $topic
>>> [1] "aareg"
>>>
>>> $tried_all_packages
>>> [1] FALSE
>>>
>>> $type
>>> [1] "chm"
>>>
>>> $class
>>> [1] "help_files_with_topic"
>>>
>>>> bar <- help("", package =3D "survival")
>>>> class(bar)
>>> [1] "help_files_with_topic"
>>>> bar[1]
>>> [1] NA
>>>> attributes(bar)
>>> $call
>>> help(topic =3D "", package =3D "survival")
>>>
>>> $pager
>>> [1] "internal"
>>>
>>> $topic
>>> [1] ""
>>>
>>> $tried_all_packages
>>> [1] FALSE
>>>
>>> $type
>>> [1] "chm"
>>>
>>> $class
>>> [1] "help_files_with_topic"
>>>
>>> If I alter the character vector to
>>> point to "00Index"
>>>
>>>> bar[1] <- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>>>> bar
>>> I see exactly what I've been attempting to achieve.
>>>
>>>
>>> Mac OS X:
>>>
>>>> foo <- help("aareg", package =3D "survival")
>>>> foo[1]
>>> [1]
>> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
>> =
>>> html"
>>>> attributes(foo)
>>> $call
>>> help(topic =3D "aareg", package =3D "survival")
>>>
>>> $pager
>>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
>>>
>>> $topic
>>> [1] "aareg"
>>>
>>> $tried_all_packages
>>> [1] FALSE
>>>
>>> $type
>>> [1] "html"
>>>
>>> $class
>>> [1] "help_files_with_topic"
>>>
>>>> bar <- help("", package =3D "survival")
>>>> bar[1]
>>> [1] NA
>>>> bar[1] <-
>> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
>>> l/00Index.html"
>>>> bar
>>> Again I see exactly what I've been after.
>>>
>>> Running R in Emacs on Mac OS X:
>>>
>>>> foo <- help(topic =3D "aareg", package =3D "survival")
>>>> foo[1]
>>> [1]
>> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
>> =
>>> html"
>>>> attributes(foo)
>>> $call
>>> help(topic =3D "aareg", package =3D "survival")
>>>
>>> $pager
>>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
>>>
>>> $topic
>>> [1] "aareg"
>>>
>>> $tried_all_packages
>>> [1] FALSE
>>>
>>> $type
>>> [1] "html"
>>>
>>> $class
>>> [1] "help_files_with_topic"
>>>
>>>> bar <- help(topic =3D "", package =3D "survival")
>>>> bar[1]
>>> [1] NA
>>>> bar[1] <-
>> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
>>> l/00Index.html"
>>>> bar
>>> Help for '' is shown in browser /usr/bin/open ...
>>> Use
>>>         help("", htmlhelp =3D FALSE)
>>> or
>>>         options(htmlhelp =3D FALSE)
>>> to revert.
>>> Again, what I've been trying to achieve.
>>>
>>> When a user loads a new library and doesn't yet know any function
>> names,
>>> I think
>>>> help(package =3D "newLibrary")
>>> or
>>>> ?newLibrary::
>>> should perform the above action whenever possible instead of
>>> producing static help or an error message.
>>>
>>> The "00Index" 'object' should be available for such use
>>> whenever it exists. =20
>>>
>>> I have not yet worked out all the coding details to make this happen,
>>> but before I do, am I missing some key point?  Any reasons why this
>>> would be a Bad Idea?
>>>
>>>
>>>
>>> Steven McKinney, Ph.D.
>>>
>>> Statistician
>>> Molecular Oncology and Breast Cancer Program
>>> British Columbia Cancer Research Centre
>>>
>>> email: smckinney +at+ bccrc +dot+ ca
>>>
>>> tel: 604-675-8000 x7561
>>>
>>> BCCRC
>>> Molecular Oncology
>>> 675 West 10th Ave, Floor 4
>>> Vancouver B.C.
>>> V5Z 1L3
>>> Canada
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jpnolan at american.edu  Wed Aug  5 00:05:47 2009
From: jpnolan at american.edu (John Nolan)
Date: Tue, 4 Aug 2009 18:05:47 -0400
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <007701ca1514$33169e50$7c94100a@win.ad.jhu.edu>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>	<4A76B2BE.1060301@mx.uni-saarland.de>
	<004001ca1453$929c0520$7c94100a@win.ad.jhu.edu>	<4A781CB9.8030505@mx.uni-saarland.de>,
	<007701ca1514$33169e50$7c94100a@win.ad.jhu.edu>
Message-ID: <OF99A54C31.A5EDECCA-ON85257608.0079614A-85257608.0079616B@american.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090804/6e34a5eb/attachment.pl>

From smckinney at bccrc.ca  Wed Aug  5 02:44:18 2009
From: smckinney at bccrc.ca (Steven McKinney)
Date: Tue, 4 Aug 2009 17:44:18 -0700
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
 specified (PR#13860)
In-Reply-To: <4A78CCDA.1080802@stats.uwo.ca>
References: <20090728223012.75E272830316@mail.pubhealth.ku.dk>
	<4A784D9F.8050504@stats.uwo.ca>
	<DCE81E14EB74504B971DAD4D2DB0356B0210B84D@crcmail4.BCCRC.CA>
	<4A78CCDA.1080802@stats.uwo.ca>
Message-ID: <DCE81E14EB74504B971DAD4D2DB0356B0210B84F@crcmail4.BCCRC.CA>

> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
> Sent: Tuesday, August 04, 2009 5:06 PM
> To: Steven McKinney
> Cc: 'r-devel at stat.math.ethz.ch'; 'R-bugs at r-project.org'
> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
> topic specified (PR#13860)
> 
> On 04/08/2009 7:33 PM, Steven McKinney wrote:
> >> -----Original Message-----
> >> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
> >> Sent: Tuesday, August 04, 2009 8:03 AM
> >> To: Steven McKinney
> >> Cc: r-devel at stat.math.ethz.ch; R-bugs at r-project.org
> >> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
> >> topic specified (PR#13860)
> >>
> >> On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
> >>> Hi all,
> >>>
> >>> When I install a new package, and don't yet know any function
> names,
> >>> I have to play the "poor man's game" to get to the standard
> >>> help system "Index" page for the package:
> >> You could complain to the package author or maintainer, who should
> have
> >> created a help alias with the package name so that ?survival would
> give
> >> you something useful.  But I would guess R 2.10.x or 2.11.x will do
> >> that
> >> automatically.
> >>
> >> Duncan Murdoch
> >
> > Unfortunately it happens frequently - hopefully I
> > don't have to complain so much - I'd rather figure
> > out code to get to the index page!
> >
> > When you say "I would guess R 2.10.x or 2.11.x will do
> > that automatically" do you mean
> > ?survival::
> > or some similar incantation
> > will take me to the Index or 00Index page?
> 
> I would guess package?survival will take you to a help page that is
> similar to what you get now in the flat display from
> library(help=survival).  Ideally it will have a link on it to the index
> page.  It is possible that ?survival will work too; that may be more
> controversial, because for many packages (e.g. boot) an alias like that
> is already defined, pointing to something other than the package main
> page.

Yes, package?survival and help(package = survival) and ?survival
all are currently in use which is why I propose
?survival::
with no topic after the "::" as an incantation to go to the 00Index page.

> 
> > Do I need to propose code or is it already
> > known how to do this within the R core group?
> 
> I doubt if code to do that would be accepted (since it will be
> redundant
> once the above changes are in place), but posting it to r-devel might
> help people in the meantime.  You should look at the tools package,
> which has a number of functions that are used by R for constructing the
> help pages; there's probably something there that will let you
> construct
> a link to the index fairly easily.

Thanks for the information.  I'll review package tools and
work out some demonstrative code.

> 
> Duncan Murdoch
> 
> > Best
> > Steve McKinney
> >
> >
> >>> Poor Man's Game -=20
> >>>   Load new package;=20
> >>>   issue search() command;
> >>>   find position (say N) of loaded package;=20
> >>>   issue objects(pos =3D N) command;
> >>>   get name of a random function (san newFunction);=20
> >>>   issue ?newFunction command;
> >>>   scroll to bottom of page;=20
> >>>   click on the "Index" hyperlink
> >>>
> >>> There are other variations, but they all involve this=20
> >>> long march to the Index page.
> >>>
> >>>
> >>> What I'd like to be able to do is enter the command
> >>>
> >>>> help(package =3D "survival")
> >>> or
> >>>
> >>>> ?survival::
> >>> and get the usual hyperlinked help page displayed (the "00Index"
> >> page)
> >>> instead of the static "text only" display or an error message
> >>>
> >>> (for example, on Windows, this equates to invoking
> >>> "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> >>> on Apple Mac,
> >>>
> >>
> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Inde
> >> x.ht=
> >>> ml"
> >>> etc.)
> >>>
> >>>
> >>> Details:
> >>> ---------------
> >>>
> >>> The help() function returns an object of
> >>> class "help_files_with_topic".
> >>> The object consists of a character vector
> >>> with several attributes.
> >>>
> >>> PC:  Windows XP
> >>>
> >>>> library("survival")
> >>>> foo <- help("aareg", package =3D "survival")
> >>>> class(foo)
> >>> [1] "help_files_with_topic"
> >>>> foo[1]
> >>> [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
> >>>> attributes(foo)
> >>> $call
> >>> help(topic =3D "aareg", package =3D "survival")
> >>>
> >>> $pager
> >>> [1] "internal"
> >>>
> >>> $topic
> >>> [1] "aareg"
> >>>
> >>> $tried_all_packages
> >>> [1] FALSE
> >>>
> >>> $type
> >>> [1] "chm"
> >>>
> >>> $class
> >>> [1] "help_files_with_topic"
> >>>
> >>>> bar <- help("", package =3D "survival")
> >>>> class(bar)
> >>> [1] "help_files_with_topic"
> >>>> bar[1]
> >>> [1] NA
> >>>> attributes(bar)
> >>> $call
> >>> help(topic =3D "", package =3D "survival")
> >>>
> >>> $pager
> >>> [1] "internal"
> >>>
> >>> $topic
> >>> [1] ""
> >>>
> >>> $tried_all_packages
> >>> [1] FALSE
> >>>
> >>> $type
> >>> [1] "chm"
> >>>
> >>> $class
> >>> [1] "help_files_with_topic"
> >>>
> >>> If I alter the character vector to
> >>> point to "00Index"
> >>>
> >>>> bar[1] <- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> >>>> bar
> >>> I see exactly what I've been attempting to achieve.
> >>>
> >>>
> >>> Mac OS X:
> >>>
> >>>> foo <- help("aareg", package =3D "survival")
> >>>> foo[1]
> >>> [1]
> >>
> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
> >> =
> >>> html"
> >>>> attributes(foo)
> >>> $call
> >>> help(topic =3D "aareg", package =3D "survival")
> >>>
> >>> $pager
> >>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> >>>
> >>> $topic
> >>> [1] "aareg"
> >>>
> >>> $tried_all_packages
> >>> [1] FALSE
> >>>
> >>> $type
> >>> [1] "html"
> >>>
> >>> $class
> >>> [1] "help_files_with_topic"
> >>>
> >>>> bar <- help("", package =3D "survival")
> >>>> bar[1]
> >>> [1] NA
> >>>> bar[1] <-
> >> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
> >>> l/00Index.html"
> >>>> bar
> >>> Again I see exactly what I've been after.
> >>>
> >>> Running R in Emacs on Mac OS X:
> >>>
> >>>> foo <- help(topic =3D "aareg", package =3D "survival")
> >>>> foo[1]
> >>> [1]
> >>
> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
> >> =
> >>> html"
> >>>> attributes(foo)
> >>> $call
> >>> help(topic =3D "aareg", package =3D "survival")
> >>>
> >>> $pager
> >>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> >>>
> >>> $topic
> >>> [1] "aareg"
> >>>
> >>> $tried_all_packages
> >>> [1] FALSE
> >>>
> >>> $type
> >>> [1] "html"
> >>>
> >>> $class
> >>> [1] "help_files_with_topic"
> >>>
> >>>> bar <- help(topic =3D "", package =3D "survival")
> >>>> bar[1]
> >>> [1] NA
> >>>> bar[1] <-
> >> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
> >>> l/00Index.html"
> >>>> bar
> >>> Help for '' is shown in browser /usr/bin/open ...
> >>> Use
> >>>         help("", htmlhelp =3D FALSE)
> >>> or
> >>>         options(htmlhelp =3D FALSE)
> >>> to revert.
> >>> Again, what I've been trying to achieve.
> >>>
> >>> When a user loads a new library and doesn't yet know any function
> >> names,
> >>> I think
> >>>> help(package =3D "newLibrary")
> >>> or
> >>>> ?newLibrary::
> >>> should perform the above action whenever possible instead of
> >>> producing static help or an error message.
> >>>
> >>> The "00Index" 'object' should be available for such use
> >>> whenever it exists. =20
> >>>
> >>> I have not yet worked out all the coding details to make this
> happen,
> >>> but before I do, am I missing some key point?  Any reasons why this
> >>> would be a Bad Idea?
> >>>
> >>>
> >>>
> >>> Steven McKinney, Ph.D.
> >>>
> >>> Statistician
> >>> Molecular Oncology and Breast Cancer Program
> >>> British Columbia Cancer Research Centre
> >>>
> >>> email: smckinney +at+ bccrc +dot+ ca
> >>>
> >>> tel: 604-675-8000 x7561
> >>>
> >>> BCCRC
> >>> Molecular Oncology
> >>> 675 West 10th Ave, Floor 4
> >>> Vancouver B.C.
> >>> V5Z 1L3
> >>> Canada
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >


From murdoch at stats.uwo.ca  Wed Aug  5 02:45:37 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Aug 2009 20:45:37 -0400
Subject: [Rd] Advice sought about Rd versions
In-Reply-To: <Zen-1MVqMR-0000Yo-9s@smarthost01.mail.zen.net.uk>
References: <Zen-1MVqMR-0000Yo-9s@smarthost01.mail.zen.net.uk>
Message-ID: <4A78D631.30109@stats.uwo.ca>

On 28/07/2009 1:21 PM, Michael Dewey wrote:
>  From R 2.9.0 we have the concept of versions for Rd files. The 
> manual is clear about the differences but I am unsure as to what I 
> should do about my existing packages. Is it recommended that I set 
> the version to 1.1 and then fix the errors R CMD check helpfully 
> points out and then subsequently do the same for later versions (the 
> manual mentions version 2 is coming)? What benefit will I gain?

This is currently somewhat in flux.  Ask again in a couple of weeks.

(My preference is that \Rdversion specifies a minimum version needed, so 
it's mostly redundant:  the DESCRIPTION file could be used to say the 
version of R needed, and Rd versions are going to change more slowly 
than R versions.  But as I said, this is in flux.)

Duncan Murdoch


From smckinney at bccrc.ca  Wed Aug  5 02:50:12 2009
From: smckinney at bccrc.ca (smckinney at bccrc.ca)
Date: Wed,  5 Aug 2009 02:50:12 +0200 (CEST)
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
	(PR#13873)
Message-ID: <20090805005012.79931282EFFB@mail.pubhealth.ku.dk>

> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
> Sent: Tuesday, August 04, 2009 5:06 PM
> To: Steven McKinney
> Cc: 'r-devel at stat.math.ethz.ch'; 'R-bugs at r-project.org'
> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
> topic specified (PR#13860)
>=20
> On 04/08/2009 7:33 PM, Steven McKinney wrote:
> >> -----Original Message-----
> >> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
> >> Sent: Tuesday, August 04, 2009 8:03 AM
> >> To: Steven McKinney
> >> Cc: r-devel at stat.math.ethz.ch; R-bugs at r-project.org
> >> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
> >> topic specified (PR#13860)
> >>
> >> On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
> >>> Hi all,
> >>>
> >>> When I install a new package, and don't yet know any function
> names,
> >>> I have to play the "poor man's game" to get to the standard
> >>> help system "Index" page for the package:
> >> You could complain to the package author or maintainer, who should
> have
> >> created a help alias with the package name so that ?survival would
> give
> >> you something useful.  But I would guess R 2.10.x or 2.11.x will do
> >> that
> >> automatically.
> >>
> >> Duncan Murdoch
> >
> > Unfortunately it happens frequently - hopefully I
> > don't have to complain so much - I'd rather figure
> > out code to get to the index page!
> >
> > When you say "I would guess R 2.10.x or 2.11.x will do
> > that automatically" do you mean
> > ?survival::
> > or some similar incantation
> > will take me to the Index or 00Index page?
>=20
> I would guess package?survival will take you to a help page that is
> similar to what you get now in the flat display from
> library(help=3Dsurvival).  Ideally it will have a link on it to the index
> page.  It is possible that ?survival will work too; that may be more
> controversial, because for many packages (e.g. boot) an alias like that
> is already defined, pointing to something other than the package main
> page.

Yes, package?survival and help(package =3D survival) and ?survival
all are currently in use which is why I propose
?survival::
with no topic after the "::" as an incantation to go to the 00Index page.

>=20
> > Do I need to propose code or is it already
> > known how to do this within the R core group?
>=20
> I doubt if code to do that would be accepted (since it will be
> redundant
> once the above changes are in place), but posting it to r-devel might
> help people in the meantime.  You should look at the tools package,
> which has a number of functions that are used by R for constructing the
> help pages; there's probably something there that will let you
> construct
> a link to the index fairly easily.

Thanks for the information.  I'll review package tools and
work out some demonstrative code.

>=20
> Duncan Murdoch
>=20
> > Best
> > Steve McKinney
> >
> >
> >>> Poor Man's Game -=3D20
> >>>   Load new package;=3D20
> >>>   issue search() command;
> >>>   find position (say N) of loaded package;=3D20
> >>>   issue objects(pos =3D3D N) command;
> >>>   get name of a random function (san newFunction);=3D20
> >>>   issue ?newFunction command;
> >>>   scroll to bottom of page;=3D20
> >>>   click on the "Index" hyperlink
> >>>
> >>> There are other variations, but they all involve this=3D20
> >>> long march to the Index page.
> >>>
> >>>
> >>> What I'd like to be able to do is enter the command
> >>>
> >>>> help(package =3D3D "survival")
> >>> or
> >>>
> >>>> ?survival::
> >>> and get the usual hyperlinked help page displayed (the "00Index"
> >> page)
> >>> instead of the static "text only" display or an error message
> >>>
> >>> (for example, on Windows, this equates to invoking
> >>> "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> >>> on Apple Mac,
> >>>
> >>
> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Inde
> >> x.ht=3D
> >>> ml"
> >>> etc.)
> >>>
> >>>
> >>> Details:
> >>> ---------------
> >>>
> >>> The help() function returns an object of
> >>> class "help_files_with_topic".
> >>> The object consists of a character vector
> >>> with several attributes.
> >>>
> >>> PC:  Windows XP
> >>>
> >>>> library("survival")
> >>>> foo <- help("aareg", package =3D3D "survival")
> >>>> class(foo)
> >>> [1] "help_files_with_topic"
> >>>> foo[1]
> >>> [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
> >>>> attributes(foo)
> >>> $call
> >>> help(topic =3D3D "aareg", package =3D3D "survival")
> >>>
> >>> $pager
> >>> [1] "internal"
> >>>
> >>> $topic
> >>> [1] "aareg"
> >>>
> >>> $tried_all_packages
> >>> [1] FALSE
> >>>
> >>> $type
> >>> [1] "chm"
> >>>
> >>> $class
> >>> [1] "help_files_with_topic"
> >>>
> >>>> bar <- help("", package =3D3D "survival")
> >>>> class(bar)
> >>> [1] "help_files_with_topic"
> >>>> bar[1]
> >>> [1] NA
> >>>> attributes(bar)
> >>> $call
> >>> help(topic =3D3D "", package =3D3D "survival")
> >>>
> >>> $pager
> >>> [1] "internal"
> >>>
> >>> $topic
> >>> [1] ""
> >>>
> >>> $tried_all_packages
> >>> [1] FALSE
> >>>
> >>> $type
> >>> [1] "chm"
> >>>
> >>> $class
> >>> [1] "help_files_with_topic"
> >>>
> >>> If I alter the character vector to
> >>> point to "00Index"
> >>>
> >>>> bar[1] <- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
> >>>> bar
> >>> I see exactly what I've been attempting to achieve.
> >>>
> >>>
> >>> Mac OS X:
> >>>
> >>>> foo <- help("aareg", package =3D3D "survival")
> >>>> foo[1]
> >>> [1]
> >>
> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
> >> =3D
> >>> html"
> >>>> attributes(foo)
> >>> $call
> >>> help(topic =3D3D "aareg", package =3D3D "survival")
> >>>
> >>> $pager
> >>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> >>>
> >>> $topic
> >>> [1] "aareg"
> >>>
> >>> $tried_all_packages
> >>> [1] FALSE
> >>>
> >>> $type
> >>> [1] "html"
> >>>
> >>> $class
> >>> [1] "help_files_with_topic"
> >>>
> >>>> bar <- help("", package =3D3D "survival")
> >>>> bar[1]
> >>> [1] NA
> >>>> bar[1] <-
> >> "/Library/Frameworks/R.framework/Resources/library/survival/htm=3D
> >>> l/00Index.html"
> >>>> bar
> >>> Again I see exactly what I've been after.
> >>>
> >>> Running R in Emacs on Mac OS X:
> >>>
> >>>> foo <- help(topic =3D3D "aareg", package =3D3D "survival")
> >>>> foo[1]
> >>> [1]
> >>
> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
> >> =3D
> >>> html"
> >>>> attributes(foo)
> >>> $call
> >>> help(topic =3D3D "aareg", package =3D3D "survival")
> >>>
> >>> $pager
> >>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
> >>>
> >>> $topic
> >>> [1] "aareg"
> >>>
> >>> $tried_all_packages
> >>> [1] FALSE
> >>>
> >>> $type
> >>> [1] "html"
> >>>
> >>> $class
> >>> [1] "help_files_with_topic"
> >>>
> >>>> bar <- help(topic =3D3D "", package =3D3D "survival")
> >>>> bar[1]
> >>> [1] NA
> >>>> bar[1] <-
> >> "/Library/Frameworks/R.framework/Resources/library/survival/htm=3D
> >>> l/00Index.html"
> >>>> bar
> >>> Help for '' is shown in browser /usr/bin/open ...
> >>> Use
> >>>         help("", htmlhelp =3D3D FALSE)
> >>> or
> >>>         options(htmlhelp =3D3D FALSE)
> >>> to revert.
> >>> Again, what I've been trying to achieve.
> >>>
> >>> When a user loads a new library and doesn't yet know any function
> >> names,
> >>> I think
> >>>> help(package =3D3D "newLibrary")
> >>> or
> >>>> ?newLibrary::
> >>> should perform the above action whenever possible instead of
> >>> producing static help or an error message.
> >>>
> >>> The "00Index" 'object' should be available for such use
> >>> whenever it exists. =3D20
> >>>
> >>> I have not yet worked out all the coding details to make this
> happen,
> >>> but before I do, am I missing some key point?  Any reasons why this
> >>> would be a Bad Idea?
> >>>
> >>>
> >>>
> >>> Steven McKinney, Ph.D.
> >>>
> >>> Statistician
> >>> Molecular Oncology and Breast Cancer Program
> >>> British Columbia Cancer Research Centre
> >>>
> >>> email: smckinney +at+ bccrc +dot+ ca
> >>>
> >>> tel: 604-675-8000 x7561
> >>>
> >>> BCCRC
> >>> Molecular Oncology
> >>> 675 West 10th Ave, Floor 4
> >>> Vancouver B.C.
> >>> V5Z 1L3
> >>> Canada
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >


From romain.francois at dbmail.com  Wed Aug  5 08:24:13 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Wed, 05 Aug 2009 08:24:13 +0200
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
 (PR#13872)
In-Reply-To: <20090805001012.9BA51282EFFB@mail.pubhealth.ku.dk>
References: <20090805001012.9BA51282EFFB@mail.pubhealth.ku.dk>
Message-ID: <4A79258D.5030207@dbmail.com>

Hello,

I'm jumping a bit late on this, but what about something like:

index?survival

or more generally

foo?bar

with the ability for the user/package to define what the combination 
"foo"/"bar" means. At the moment, the way "package?survival" is handled 
is to :
- create the string "package-survival"
- call help with it

Romain



On 08/05/2009 02:10 AM, murdoch at stats.uwo.ca wrote:
> On 04/08/2009 7:33 PM, Steven McKinney wrote:
>>> -----Original Message-----
>>> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
>>> Sent: Tuesday, August 04, 2009 8:03 AM
>>> To: Steven McKinney
>>> Cc: r-devel at stat.math.ethz.ch; R-bugs at r-project.org
>>> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
>>> topic specified (PR#13860)
>>>
>>> On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
>>>> Hi all,
>>>>
>>>> When I install a new package, and don't yet know any function names,
>>>> I have to play the "poor man's game" to get to the standard
>>>> help system "Index" page for the package:
>>> You could complain to the package author or maintainer, who should have
>>> created a help alias with the package name so that ?survival would give
>>> you something useful.  But I would guess R 2.10.x or 2.11.x will do
>>> that
>>> automatically.
>>>
>>> Duncan Murdoch
>> Unfortunately it happens frequently - hopefully I
>> don't have to complain so much - I'd rather figure
>> out code to get to the index page!
>>
>> When you say "I would guess R 2.10.x or 2.11.x will do
>> that automatically" do you mean
>> ?survival::
>> or some similar incantation
>> will take me to the Index or 00Index page?
>
> I would guess package?survival will take you to a help page that is
> similar to what you get now in the flat display from
> library(help=survival).  Ideally it will have a link on it to the index
> page.  It is possible that ?survival will work too; that may be more
> controversial, because for many packages (e.g. boot) an alias like that
> is already defined, pointing to something other than the package main page.
>
>> Do I need to propose code or is it already
>> known how to do this within the R core group?
>
> I doubt if code to do that would be accepted (since it will be redundant
> once the above changes are in place), but posting it to r-devel might
> help people in the meantime.  You should look at the tools package,
> which has a number of functions that are used by R for constructing the
> help pages; there's probably something there that will let you construct
> a link to the index fairly easily.
>
> Duncan Murdoch
>
>> Best
>> Steve McKinney
>>
>>
>>>> Poor Man's Game -=20
>>>>    Load new package;=20
>>>>    issue search() command;
>>>>    find position (say N) of loaded package;=20
>>>>    issue objects(pos =3D N) command;
>>>>    get name of a random function (san newFunction);=20
>>>>    issue ?newFunction command;
>>>>    scroll to bottom of page;=20
>>>>    click on the "Index" hyperlink
>>>>
>>>> There are other variations, but they all involve this=20
>>>> long march to the Index page.
>>>>
>>>>
>>>> What I'd like to be able to do is enter the command
>>>>
>>>>> help(package =3D "survival")
>>>> or
>>>>
>>>>> ?survival::
>>>> and get the usual hyperlinked help page displayed (the "00Index"
>>> page)
>>>> instead of the static "text only" display or an error message
>>>>
>>>> (for example, on Windows, this equates to invoking
>>>> "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>>>> on Apple Mac,
>>>>
>>> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Inde
>>> x.ht=
>>>> ml"
>>>> etc.)
>>>>
>>>>
>>>> Details:
>>>> ---------------
>>>>
>>>> The help() function returns an object of
>>>> class "help_files_with_topic".
>>>> The object consists of a character vector
>>>> with several attributes.
>>>>
>>>> PC:  Windows XP
>>>>
>>>>> library("survival")
>>>>> foo<- help("aareg", package =3D "survival")
>>>>> class(foo)
>>>> [1] "help_files_with_topic"
>>>>> foo[1]
>>>> [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
>>>>> attributes(foo)
>>>> $call
>>>> help(topic =3D "aareg", package =3D "survival")
>>>>
>>>> $pager
>>>> [1] "internal"
>>>>
>>>> $topic
>>>> [1] "aareg"
>>>>
>>>> $tried_all_packages
>>>> [1] FALSE
>>>>
>>>> $type
>>>> [1] "chm"
>>>>
>>>> $class
>>>> [1] "help_files_with_topic"
>>>>
>>>>> bar<- help("", package =3D "survival")
>>>>> class(bar)
>>>> [1] "help_files_with_topic"
>>>>> bar[1]
>>>> [1] NA
>>>>> attributes(bar)
>>>> $call
>>>> help(topic =3D "", package =3D "survival")
>>>>
>>>> $pager
>>>> [1] "internal"
>>>>
>>>> $topic
>>>> [1] ""
>>>>
>>>> $tried_all_packages
>>>> [1] FALSE
>>>>
>>>> $type
>>>> [1] "chm"
>>>>
>>>> $class
>>>> [1] "help_files_with_topic"
>>>>
>>>> If I alter the character vector to
>>>> point to "00Index"
>>>>
>>>>> bar[1]<- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>>>>> bar
>>>> I see exactly what I've been attempting to achieve.
>>>>
>>>>
>>>> Mac OS X:
>>>>
>>>>> foo<- help("aareg", package =3D "survival")
>>>>> foo[1]
>>>> [1]
>>> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
>>> =
>>>> html"
>>>>> attributes(foo)
>>>> $call
>>>> help(topic =3D "aareg", package =3D "survival")
>>>>
>>>> $pager
>>>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
>>>>
>>>> $topic
>>>> [1] "aareg"
>>>>
>>>> $tried_all_packages
>>>> [1] FALSE
>>>>
>>>> $type
>>>> [1] "html"
>>>>
>>>> $class
>>>> [1] "help_files_with_topic"
>>>>
>>>>> bar<- help("", package =3D "survival")
>>>>> bar[1]
>>>> [1] NA
>>>>> bar[1]<-
>>> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
>>>> l/00Index.html"
>>>>> bar
>>>> Again I see exactly what I've been after.
>>>>
>>>> Running R in Emacs on Mac OS X:
>>>>
>>>>> foo<- help(topic =3D "aareg", package =3D "survival")
>>>>> foo[1]
>>>> [1]
>>> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
>>> =
>>>> html"
>>>>> attributes(foo)
>>>> $call
>>>> help(topic =3D "aareg", package =3D "survival")
>>>>
>>>> $pager
>>>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
>>>>
>>>> $topic
>>>> [1] "aareg"
>>>>
>>>> $tried_all_packages
>>>> [1] FALSE
>>>>
>>>> $type
>>>> [1] "html"
>>>>
>>>> $class
>>>> [1] "help_files_with_topic"
>>>>
>>>>> bar<- help(topic =3D "", package =3D "survival")
>>>>> bar[1]
>>>> [1] NA
>>>>> bar[1]<-
>>> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
>>>> l/00Index.html"
>>>>> bar
>>>> Help for '' is shown in browser /usr/bin/open ...
>>>> Use
>>>>          help("", htmlhelp =3D FALSE)
>>>> or
>>>>          options(htmlhelp =3D FALSE)
>>>> to revert.
>>>> Again, what I've been trying to achieve.
>>>>
>>>> When a user loads a new library and doesn't yet know any function
>>> names,
>>>> I think
>>>>> help(package =3D "newLibrary")
>>>> or
>>>>> ?newLibrary::
>>>> should perform the above action whenever possible instead of
>>>> producing static help or an error message.
>>>>
>>>> The "00Index" 'object' should be available for such use
>>>> whenever it exists. =20
>>>>
>>>> I have not yet worked out all the coding details to make this happen,
>>>> but before I do, am I missing some key point?  Any reasons why this
>>>> would be a Bad Idea?
>>>>
>>>>
>>>>
>>>> Steven McKinney, Ph.D.
>>>>
>>>> Statistician
>>>> Molecular Oncology and Breast Cancer Program
>>>> British Columbia Cancer Research Centre
>>>>
>>>> email: smckinney +at+ bccrc +dot+ ca
>>>>
>>>> tel: 604-675-8000 x7561
>>>>
>>>> BCCRC
>>>> Molecular Oncology
>>>> 675 West 10th Ave, Floor 4
>>>> Vancouver B.C.
>>>> V5Z 1L3
>>>> Canada


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/vsK1 : R parser package on CRAN
|- http://tr.im/vshK : Transfer files through Rserve
`- http://tr.im/vfxe : R GUI page on the R wiki


From maechler at stat.math.ethz.ch  Wed Aug  5 09:34:38 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 5 Aug 2009 09:34:38 +0200
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <OF99A54C31.A5EDECCA-ON85257608.0079614A-85257608.0079616B@american.edu>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
	<004001ca1453$929c0520$7c94100a@win.ad.jhu.edu>
	<4A781CB9.8030505@mx.uni-saarland.de>
	<007701ca1514$33169e50$7c94100a@win.ad.jhu.edu>
	<OF99A54C31.A5EDECCA-ON85257608.0079614A-85257608.0079616B@american.edu>
Message-ID: <19065.13838.892579.558430@lynne.math.ethz.ch>

>>>>> "JN" == John Nolan <jpnolan at american.edu>
>>>>>     on Tue, 4 Aug 2009 18:05:47 -0400 writes:

    JN> Ravi,

    JN> There has been a lot of chatter about this, and people don't seem to be
    JN> reading carefully.  Perhaps this will help clarify things.

Yes, I hope so;   thanks a lot, John!!
{Indeed, I've been appalled too about the amount of proclaiming
 without listening, and even more about the no-bug report... }


    JN> The problem appears to be that R was evaluating x^2 not as multiplication
    JN> x*x, but as x^2.0=exp(2.0*log(x)), using standard C functions for the
    JN> complex log and exponentiation.  Apparently the C library functions for
    JN> this have some inaccuracies in it, which showed up in your calculations.

    JN> One of the other responders said that matlab, octave, etc. detect the case
    JN> when there is a positive integer power and use multiplication to evaluate.
    JN> It appears that Martin Maechler has now submitted a change to R to detect
    JN> integer powers and evaluate them via repeated multiplication, which should
    JN> eliminate your problem.

Yes;  note however that -- exactly for the reason John has given
(and Martin Becker and I had tried to explain earlier in this
thread!) --
that your problem (*yours* indeed, not R's !!) will resurface if
you change "^2" by "^2.01" in your original problem.

    JN> There is no guarantee that R or matlab or any other
    JN> program will evaluate every expression correctly.
    JN> matlab has many years of use and evaluation that have
    JN> guided them in correct problems.  R is catching up, but
    JN> not there yet.

hhmm, hmm,... are you sure that the catching up is only on our side?
I dare say that I'm pretty sure R does quite a few computations
better than e.g., matlab...  But let's not get into more unproductive
chattering...

    JN> We are all part of improving R; your question led to a careful
    JN> examination of the issue and a fix within a few days.  No commercial
    JN> company responds so quickly!

    JN> HTH, John

it did, thank you very much!
Martin

    JN> ...........................................................................

    JN> John P. Nolan
    JN> Math/Stat Department
    JN> 227 Gray Hall
    JN> American University
    JN> 4400 Massachusetts Avenue, NW
    JN> Washington, DC 20016-8050

    JN> jpnolan at american.edu
    JN> 202.885.3140 voice
    JN> 202.885.3155 fax
    JN> http://academic2.american.edu/~jpnolan
    JN> ...........................................................................



    JN> -----r-devel-bounces at r-project.org wrote: -----


    JN> To: "'Martin Becker'" <martin.becker at mx.uni-saarland.de>
    JN> From: "Ravi Varadhan" <RVaradhan at jhmi.edu>
    JN> Sent by: r-devel-bounces at r-project.org
    JN> Date: 08/04/2009 10:59AM
    JN> cc: hwborchers at googlemail.com, r-devel at stat.math.ethz.ch
    JN> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)

    JN> Please forgive me for my lack of understanding of IEEE floating-point
    JN> arithmetic.  I have a hard time undertsanding why "this is not a problem of
    JN> R itself", when "ALL" the other well known computing environments including
    JN> Matlab, Octave, S+, and Scilab provide accurate results.  My concern is not
    JN> really about the "overall" accuracy of R, but just about the complex
    JN> arithmetic.  Is there something idiosyncratic about the complex arithmetic?


    JN> I am really hoping that some one from the R core would speak up and address
    JN> this issue.  It would be a loss to the R users if this fascinating idea of
    JN> "complex-step derivative" could not be implemented in R.

    JN> Thanks,
    JN> Ravi.

    JN> ----------------------------------------------------------------------------

    JN> -------

    JN> Ravi Varadhan, Ph.D.

    JN> Assistant Professor, The Center on Aging and Health

    JN> Division of Geriatric Medicine and Gerontology

    JN> Johns Hopkins University

    JN> Ph: (410) 502-2619

    JN> Fax: (410) 614-9625

    JN> Email: rvaradhan at jhmi.edu

    JN> Webpage:
    JN> http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.h

    JN> tml



    JN> ----------------------------------------------------------------------------

    JN> --------


    JN> -----Original Message-----
    JN> From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de]
    JN> Sent: Tuesday, August 04, 2009 7:34 AM
    JN> To: Ravi Varadhan
    JN> Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
    JN> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)

    JN> Dear Ravi,

    JN> I suspect that, in general, you may be facing the limitations of machine
    JN> accuracy (more precisely, IEEE 754 arithmetics on [64-bit] doubles) in your
    JN> application. This is not a problem of R itself, but rather a problem of
    JN> standard arithmetics provided by underlying C compilers/CPUs.
    JN> In fact, every operation in IEEE arithmetics (so, this is not really a
    JN> problem only for complex numbers) may suffer from inexactness, a
    JN> particularly difficult one is addition/subtraction. Consider the following
    JN> example for real numbers (I know, it is not a very good one...):
    JN> The two functions

    JN> badfn <- function(x) 1-(1+x)*(1-x)
    JN> goodfn <- function(x) x^2

    JN> both calculate x^2 (theoretically, given perfect arithmetic). So, as you
    JN> want to allow the user to 'specify the mathematical function ... in "any"
    JN> form the user chooses', both functions should be ok.
    JN> But, unfortunately:

    >> badfn(1e-8)
    JN> [1] 2.220446049250313e-16
    >> goodfn(1e-8)
    JN> [1] 1e-16

    JN> I don't know what happens in matlab/octave/scilab for this example. They
    JN> may
    JN> do better, but probably at some cost (dropping IEEE arithmetic/do "clever"
    JN> calculations should result in massive speed penalties, try
    JN> evaluating   hypergeom([1,-99.9],[-49.9-24.9*I],(1+1.71*I)/2);   in
    JN> Maple...).
    JN> Now, you have some options:

    JN> - assume, that the user is aware of the numerical inexactness of ieee
    JN> arithmetics and that he is able to supply some "robust" version of the
    JN> mathematical function.
    JN> - use some other software (eg., matlab) for the critical calculations
    JN> (there
    JN> is a R <-> Matlab interface, see package R.matlab on CRAN), if you are
    JN> sure,
    JN> that this helps.
    JN> - implement/use multiple precision arithmetics within R (Martin Maechler's
    JN> Rmpfr package may be very useful:
    JN> http://r-forge.r-project.org/projects/rmpfr/ , but this will slow down
    JN> calculations considerably)

    JN> All in all, I think it is unfair just to blame R here. Of course, it would
    JN> be great if there was a simple trigger to turn on multiple precision
    JN> arithmetics in R. Packages such as Rmpfr may provide a good step in this
    JN> direction, since operator overloading via S4 classes allows for easy code
    JN> adaption. But Rmpfr is still declared "beta", and it relies on some
    JN> external
    JN> library, which could be problematic on Windows systems. Maybe someone else
    JN> has other/better suggestions, but I do not think that there is an easy
    JN> solution for the "general" problem.

    JN> Best wishes,

    JN> Martin


    JN> Ravi Varadhan wrote:
    >> Dear Martin,
    >> 
    >> Thank you for this useful trick.  However, we are interested in a
    JN> "general"
    >> approach for exact derivative computation.  This approach should allow
    >> the user to specify the mathematical function that needs to be
    >> differentiated in "any" form that the user chooses.  So, your trick
    >> will be difficult to implement there.  Furthermore, do we know for
    >> sure that `exponentiation' is the only operation that results in
    >> inaccuracy?  Are there other operations that also yield inaccurate
    JN> results
    JN> for complex arithmetic?
    >> 
    >> Hans Borchers also checked the computations with other free numerical
    >> software, such as Octave, Scilab, Euler, and they all return exactly
    >> the same results as Matlab.  It would be a shame if R could not do the
    JN> same.
    >> 
    >> It would be great if the R core could address the "fundamental" issue.
    >> 
    >> Thank you.
    >> 
    >> Best regards,
    >> Ravi.
    >> 
    >> ----------------------------------------------------------------------
    >> ------
    >> -------
    >> 
    >> Ravi Varadhan, Ph.D.
    >> 
    >> Assistant Professor, The Center on Aging and Health
    >> 
    >> Division of Geriatric Medicine and Gerontology
    >> 
    >> Johns Hopkins University
    >> 
    >> Ph: (410) 502-2619
    >> 
    >> Fax: (410) 614-9625
    >> 
    >> Email: rvaradhan at jhmi.edu
    >> 
    >> Webpage:
    >> http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Vara
    >> dhan.h
    >> tml
    >> 
    >> 
    >> 
    >> ----------------------------------------------------------------------
    >> ------
    >> --------
    >> 
    >> 
    >> -----Original Message-----
    >> From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de]
    >> Sent: Monday, August 03, 2009 5:50 AM
    >> To: Ravi Varadhan
    >> Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
    >> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is
    >> accurate)
    >> 
    >> Dear Ravi,
    >> 
    >> the inaccuracy seems to creep in when powers are calculated.
    >> Apparently, some quite general function is called to calculate the
    >> squares, and one can avoid the error by reformulating the example as
    JN> follows:
    >> 
    >> rosen <- function(x) {
    >> n <- length(x)
    >> x1 <- x[2:n]
    >> x2 <- x[1:(n-1)]
    >> sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2)) }
    >> 
    >> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136,
    >> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
    >> xh <- x0 + h
    >> 
    >> rx <- rosen(xh)
    >> Re(rx)
    >> Im (rx)
    >> 
    >> 
    >> I don't know which arithmetics are involved in the application you
    >> mentioned, but writing some auxiliary function for the calculation of
    >> x^n when x is complex and n is (a not too large) integer may solve
    >> some of the numerical issues. A simple version is:
    >> 
    >> powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))
    >> 
    >> The corresponding summation in 'rosen' would then read:
    >> 
    >> sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
    >> 
    >> 
    >> HTH,
    >> 
    >> Martin
    >> 
    >> 
    >> Ravi Varadhan wrote:
    >> 
    >>> Dear All,
    >>> 
    >>> Hans Borchers and I have been trying to compute "exact" derivatives
    >>> in R
    >>> 
    >> using the idea of complex-step derivatives that Hans has proposed.
    >> This is a really, really cool idea.  It gives "exact" derivatives with
    >> only a minimal effort (same as that involved in computing first-order
    >> forward-difference derivative).
    >> 
    >>> Unfortunately, we cannot implement this in R as the "complex arithmetic"
    >>> 
    >> in R appears to be inaccurate.
    >> 
    >>> Here is an example:
    >>> 
    >>> #-- Classical Rosenbrock function in n variables rosen <- function(x)
    >>> { n <- length(x)
    >>> x1 <- x[2:n]
    >>> x2 <- x[1:(n-1)]
    >>> sum(100*(x1-x2^2)^2 + (1-x2)^2)
    >>> }
    >>> 
    >>> 
    >>> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136,
    >>> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
    >>> xh <- x0 + h
    >>> 
    >>> rx <- rosen(xh)
    >>> Re(rx)
    >>> Im (rx)
    >>> 
    >>> #  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect
    >>> imaginary part in R
    >>> 
    >>> However, the imaginary part of the above answer is inaccurate.  The
    >>> 
    >> correct imaginary part (from Matlab) is:
    >> 
    >>> 190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part
    >>> from Matlab
    >>> 
    >>> This inaccuracy is serious enough to affect the acuracy of the
    >>> compex-step
    >>> 
    >> gradient drastically.
    >> 
    >>> Hans and I were wondering if there is a way to obtain accurate "small"
    >>> 
    >> imaginary part for complex arithmetic.
    >> 
    >>> I am using Windows XP operating system.
    >>> 
    >>> Thanks for taking a look at this.
    >>> 
    >>> Best regards,
    >>> Ravi.
    >>> 
    >>> 
    >>> ____________________________________________________________________
    >>> 
    >>> Ravi Varadhan, Ph.D.
    >>> Assistant Professor,
    >>> Division of Geriatric Medicine and Gerontology School of Medicine
    >>> Johns Hopkins University
    >>> 
    >>> Ph. (410) 502-2619
    >>> email: rvaradhan at jhmi.edu
    >>> 
    >>> ______________________________________________
    >>> R-devel at r-project.org mailing list
    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>> 
    >>> 
    >> 
    >> 
    >> --
    >> Dr. Martin Becker
    >> Statistics and Econometrics
    >> Saarland University
    >> Campus C3 1, Room 206
    >> 66123 Saarbruecken
    >> Germany
    >> 
    >> 


    JN> --
    JN> Dr. Martin Becker
    JN> Statistics and Econometrics
    JN> Saarland University
    JN> Campus C3 1, Room 206
    JN> 66123 Saarbruecken
    JN> Germany

    JN> ______________________________________________
    JN> R-devel at r-project.org mailing list
    JN> https://stat.ethz.ch/mailman/listinfo/r-devel
    JN> [[alternative HTML version deleted]]

    JN> ______________________________________________
    JN> R-devel at r-project.org mailing list
    JN> https://stat.ethz.ch/mailman/listinfo/r-devel


From RVaradhan at jhmi.edu  Tue Aug  4 20:45:16 2009
From: RVaradhan at jhmi.edu (RVaradhan at jhmi.edu)
Date: Tue,  4 Aug 2009 20:45:16 +0200 (CEST)
Subject: [Rd] Error (or inaccuracy) in complex arithmetic (PR#13869)
Message-ID: <20090804184516.A6A91283031B@mail.pubhealth.ku.dk>

Dear All,

I have been trying to compute "exact" derivatives in R using the idea of
complex-step derivatives.  This is a really, really cool idea.  It gives
"exact" derivatives by using a very small, complex step (e.g. 1.e-15i).  

Unfortunately, I cannot implement this in R as the "complex arithmetic" in R
is inaccurate.

Here is an example:

#-- Classical Rosenbrock function in n variables
rosen <- function(x) {
n <- length(x)
x1 <- x[2:n]
x2 <- x[1:(n-1)]
sum(100*(x1-x2^2)^2 + (1-x2)^2)
}

x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136, 0.0849,
0.4147, 0.4540)
h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
xh <- x0 + h

rx <- rosen(xh)
Re(rx)
Im (rx)

#  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect imaginary
part in R

However, the imaginary part of the above answer is inaccurate.  The correct
imaginary part (from Matlab, S+, Scilab) is:

190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part

This inaccuracy is serious enough to affect the acuracy of the compex-step
gradient drastically.


I am wondering whether his problem might be related to the C++ complex.h
library.
 
I am using Windows XP operating system.

Thanks for taking a look at this.

Best regards,
Ravi.


 
----------------------------------------------------------------------------
-------

Ravi Varadhan, Ph.D.

Assistant Professor, The Center on Aging and Health

Division of Geriatric Medicine and Gerontology 

Johns Hopkins University

Ph: (410) 502-2619

Fax: (410) 614-9625

Email: rvaradhan at jhmi.edu

Webpage:
http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.h
tml

 

----------------------------------------------------------------------------
--------

 

	[[alternative HTML version deleted]]


From rvaradhan at jhmi.edu  Wed Aug  5 05:20:14 2009
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Tue, 04 Aug 2009 23:20:14 -0400
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <OF99A54C31.A5EDECCA-ON85257608.0079614A-85257608.0079616B@american.edu>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
	<004001ca1453$929c0520$7c94100a@win.ad.jhu.edu>
	<4A781CB9.8030505@mx.uni-saarland.de>
	<007701ca1514$33169e50$7c94100a@win.ad.jhu.edu>
	<OF99A54C31.A5EDECCA-ON85257608.0079614A-85257608.0079616B@american.edu>
Message-ID: <fbded4c1de95.4a78c22e@johnshopkins.edu>

Dear John,

Thank you.

I am amazed at the insightful responses of people in the R-devel group and even more so amazed at the rapdity with which the R core group and other knowledgeable R folks respond to and fix the problems.  

Big thanks to Martin Becker, Ash Richardson, Duncan Murdoch and Martin Maechler!

My frustration was only due to my impatience in having to wait a few days (!) to experiment with this marvellous idea of analytic continuation for computing numerical derivatives that are "exact", but with only minimal computation.

Best regards,
Ravi.

____________________________________________________________________

Ravi Varadhan, Ph.D.
Assistant Professor,
Division of Geriatric Medicine and Gerontology
School of Medicine
Johns Hopkins University

Ph. (410) 502-2619
email: rvaradhan at jhmi.edu


----- Original Message -----
From: John Nolan <jpnolan at american.edu>
Date: Tuesday, August 4, 2009 8:36 pm
Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
To: Ravi Varadhan <rvaradhan at jhmi.edu>
Cc: 'Martin Becker' <martin.becker at mx.uni-saarland.de>, hwborchers at googlemail.com, r-devel at stat.math.ethz.ch


>  Ravi,
>  
>  There has been a lot of chatter about this, and people don't seem to 
> be
>  reading carefully.  Perhaps this will help clarify things.
>  
>  The problem appears to be that R was evaluating x^2 not as multiplication
>  x*x, but as x^2.0=exp(2.0*log(x)), using standard C functions for the
>  complex log and exponentiation.  Apparently the C library functions for
>  this have some inaccuracies in it, which showed up in your calculations.
>  
>  One of the other responders said that matlab, octave, etc. detect the 
> case
>  when there is a positive integer power and use multiplication to evaluate.
>  It appears that Martin Maechler has now submitted a change to R to detect
>  integer powers and evaluate them via repeated multiplication, which should
>  eliminate your problem.
>  
>  There is no guarantee that R or matlab or any other program will evaluate
>  every expression correctly.  matlab has many years of use and evaluation
>  that have guided them in correct problems.  R is catching up, but not 
> there
>  yet.  We are all part of improving R; your question led to a careful
>  examination of the issue and a fix within a few days.  No commercial
>  company responds so quickly!
>  
>  HTH, John
>  
>  ...........................................................................
>  
>  John P. Nolan
>  Math/Stat Department
>  227 Gray Hall
>  American University
>  4400 Massachusetts Avenue, NW
>  Washington, DC 20016-8050
>  
>  jpnolan at american.edu
>  202.885.3140 voice
>  202.885.3155 fax
>  
>  ...........................................................................
>  
>  
>  
>  -----r-devel-bounces at r-project.org wrote: -----
>  
>  
>  To: "'Martin Becker'" <martin.becker at mx.uni-saarland.de>
>  From: "Ravi Varadhan" <RVaradhan at jhmi.edu>
>  Sent by: r-devel-bounces at r-project.org
>  Date: 08/04/2009 10:59AM
>  cc: hwborchers at googlemail.com, r-devel at stat.math.ethz.ch
>  Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
>  
>  Please forgive me for my lack of understanding of IEEE floating-point
>  arithmetic.  I have a hard time undertsanding why "this is not a 
> problem of
>  R itself", when "ALL" the other well known computing environments including
>  Matlab, Octave, S+, and Scilab provide accurate results.  My concern 
> is not
>  really about the "overall" accuracy of R, but just about the complex
>  arithmetic.  Is there something idiosyncratic about the complex arithmetic?
>  
>  
>  I am really hoping that some one from the R core would speak up and address
>  this issue.  It would be a loss to the R users if this fascinating 
> idea of
>  "complex-step derivative" could not be implemented in R.
>  
>  Thanks,
>  Ravi.
>  
>  ----------------------------------------------------------------------------
>  
>  -------
>  
>  Ravi Varadhan, Ph.D.
>  
>  Assistant Professor, The Center on Aging and Health
>  
>  Division of Geriatric Medicine and Gerontology
>  
>  Johns Hopkins University
>  
>  Ph: (410) 502-2619
>  
>  Fax: (410) 614-9625
>  
>  Email: rvaradhan at jhmi.edu
>  
>  Webpage:
>  
>  
>  tml
>  
>  
>  
>  ----------------------------------------------------------------------------
>  
>  --------
>  
>  
>  -----Original Message-----
>  From: Martin Becker [
>  Sent: Tuesday, August 04, 2009 7:34 AM
>  To: Ravi Varadhan
>  Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
>  Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
>  
>  Dear Ravi,
>  
>  I suspect that, in general, you may be facing the limitations of machine
>  accuracy (more precisely, IEEE 754 arithmetics on [64-bit] doubles) 
> in your
>  application. This is not a problem of R itself, but rather a problem 
> of
>  standard arithmetics provided by underlying C compilers/CPUs.
>  In fact, every operation in IEEE arithmetics (so, this is not really 
> a
>  problem only for complex numbers) may suffer from inexactness, a
>  particularly difficult one is addition/subtraction. Consider the following
>  example for real numbers (I know, it is not a very good one...):
>  The two functions
>  
>  badfn <- function(x) 1-(1+x)*(1-x)
>  goodfn <- function(x) x^2
>  
>  both calculate x^2 (theoretically, given perfect arithmetic). So, as 
> you
>  want to allow the user to 'specify the mathematical function ... in "any"
>  form the user chooses', both functions should be ok.
>  But, unfortunately:
>  
>   > badfn(1e-8)
>  [1] 2.220446049250313e-16
>   > goodfn(1e-8)
>  [1] 1e-16
>  
>  I don't know what happens in matlab/octave/scilab for this example. They
>  may
>  do better, but probably at some cost (dropping IEEE arithmetic/do "clever"
>  calculations should result in massive speed penalties, try
>  evaluating   hypergeom([1,-99.9],[-49.9-24.9*I],(1+1.71*I)/2);   in
>  Maple...).
>  Now, you have some options:
>  
>  - assume, that the user is aware of the numerical inexactness of ieee
>  arithmetics and that he is able to supply some "robust" version of the
>  mathematical function.
>  - use some other software (eg., matlab) for the critical calculations
>  (there
>  is a R <-> Matlab interface, see package R.matlab on CRAN), if you are
>  sure,
>  that this helps.
>  - implement/use multiple precision arithmetics within R (Martin Maechler's
>  Rmpfr package may be very useful:
>   , but this will slow down
>  calculations considerably)
>  
>  All in all, I think it is unfair just to blame R here. Of course, it 
> would
>  be great if there was a simple trigger to turn on multiple precision
>  arithmetics in R. Packages such as Rmpfr may provide a good step in this
>  direction, since operator overloading via S4 classes allows for easy 
> code
>  adaption. But Rmpfr is still declared "beta", and it relies on some
>  external
>  library, which could be problematic on Windows systems. Maybe someone 
> else
>  has other/better suggestions, but I do not think that there is an easy
>  solution for the "general" problem.
>  
>  Best wishes,
>  
>    Martin
>  
>  
>  Ravi Varadhan wrote:
>  > Dear Martin,
>  >
>  > Thank you for this useful trick.  However, we are interested in a
>  "general"
>  > approach for exact derivative computation.  This approach should allow
>  > the user to specify the mathematical function that needs to be
>  > differentiated in "any" form that the user chooses.  So, your trick
>  > will be difficult to implement there.  Furthermore, do we know for
>  > sure that `exponentiation' is the only operation that results in
>  > inaccuracy?  Are there other operations that also yield inaccurate
>  results
>  for complex arithmetic?
>  >
>  > Hans Borchers also checked the computations with other free numerical
>  > software, such as Octave, Scilab, Euler, and they all return exactly
>  > the same results as Matlab.  It would be a shame if R could not do 
> the
>  same.
>  >
>  > It would be great if the R core could address the "fundamental" issue.
>  >
>  > Thank you.
>  >
>  > Best regards,
>  > Ravi.
>  >
>  > ----------------------------------------------------------------------
>  > ------
>  > -------
>  >
>  > Ravi Varadhan, Ph.D.
>  >
>  > Assistant Professor, The Center on Aging and Health
>  >
>  > Division of Geriatric Medicine and Gerontology
>  >
>  > Johns Hopkins University
>  >
>  > Ph: (410) 502-2619
>  >
>  > Fax: (410) 614-9625
>  >
>  > Email: rvaradhan at jhmi.edu
>  >
>  > Webpage:
>  > 
>  > dhan.h
>  > tml
>  >
>  >
>  >
>  > ----------------------------------------------------------------------
>  > ------
>  > --------
>  >
>  >
>  > -----Original Message-----
>  > From: Martin Becker [
>  > Sent: Monday, August 03, 2009 5:50 AM
>  > To: Ravi Varadhan
>  > Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
>  > Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is
>  > accurate)
>  >
>  > Dear Ravi,
>  >
>  > the inaccuracy seems to creep in when powers are calculated.
>  > Apparently, some quite general function is called to calculate the
>  > squares, and one can avoid the error by reformulating the example as
>  follows:
>  >
>  > rosen <- function(x) {
>  >   n <- length(x)
>  >   x1 <- x[2:n]
>  >   x2 <- x[1:(n-1)]
>  >   sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2)) }
>  >
>  > x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136,
>  > 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
>  > xh <- x0 + h
>  >
>  > rx <- rosen(xh)
>  > Re(rx)
>  > Im (rx)
>  >
>  >
>  > I don't know which arithmetics are involved in the application you
>  > mentioned, but writing some auxiliary function for the calculation 
> of
>  > x^n when x is complex and n is (a not too large) integer may solve
>  > some of the numerical issues. A simple version is:
>  >
>  > powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))
>  >
>  > The corresponding summation in 'rosen' would then read:
>  >
>  > sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
>  >
>  >
>  > HTH,
>  >
>  >   Martin
>  >
>  >
>  > Ravi Varadhan wrote:
>  >
>  >> Dear All,
>  >>
>  >> Hans Borchers and I have been trying to compute "exact" derivatives
>  >> in R
>  >>
>  > using the idea of complex-step derivatives that Hans has proposed.
>  > This is a really, really cool idea.  It gives "exact" derivatives with
>  > only a minimal effort (same as that involved in computing first-order
>  > forward-difference derivative).
>  >
>  >> Unfortunately, we cannot implement this in R as the "complex arithmetic"
>  >>
>  > in R appears to be inaccurate.
>  >
>  >> Here is an example:
>  >>
>  >> #-- Classical Rosenbrock function in n variables rosen <- function(x)
>  >> { n <- length(x)
>  >> x1 <- x[2:n]
>  >> x2 <- x[1:(n-1)]
>  >> sum(100*(x1-x2^2)^2 + (1-x2)^2)
>  >> }
>  >>
>  >>
>  >> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136,
>  >> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 
> 0)
>  >> xh <- x0 + h
>  >>
>  >> rx <- rosen(xh)
>  >> Re(rx)
>  >> Im (rx)
>  >>
>  >> #  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect
>  >> imaginary part in R
>  >>
>  >> However, the imaginary part of the above answer is inaccurate.  The
>  >>
>  > correct imaginary part (from Matlab) is:
>  >
>  >> 190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part
>  >> from Matlab
>  >>
>  >> This inaccuracy is serious enough to affect the acuracy of the
>  >> compex-step
>  >>
>  > gradient drastically.
>  >
>  >> Hans and I were wondering if there is a way to obtain accurate "small"
>  >>
>  > imaginary part for complex arithmetic.
>  >
>  >> I am using Windows XP operating system.
>  >>
>  >> Thanks for taking a look at this.
>  >>
>  >> Best regards,
>  >> Ravi.
>  >>
>  >>
>  >> ____________________________________________________________________
>  >>
>  >> Ravi Varadhan, Ph.D.
>  >> Assistant Professor,
>  >> Division of Geriatric Medicine and Gerontology School of Medicine
>  >> Johns Hopkins University
>  >>
>  >> Ph. (410) 502-2619
>  >> email: rvaradhan at jhmi.edu
>  >>
>  >> ______________________________________________
>  >> R-devel at r-project.org mailing list
>  >> 
>  >>
>  >>
>  >
>  >
>  > --
>  > Dr. Martin Becker
>  > Statistics and Econometrics
>  > Saarland University
>  > Campus C3 1, Room 206
>  > 66123 Saarbruecken
>  > Germany
>  >
>  >
>  
>  
>  --
>  Dr. Martin Becker
>  Statistics and Econometrics
>  Saarland University
>  Campus C3 1, Room 206
>  66123 Saarbruecken
>  Germany
>  
>  ______________________________________________
>  R-devel at r-project.org mailing list


From thomas.mang at fiwi.at  Wed Aug  5 11:08:22 2009
From: thomas.mang at fiwi.at (Thomas Mang)
Date: Wed, 05 Aug 2009 11:08:22 +0200
Subject: [Rd] compiling DLL under Visual Studio IDE
Message-ID: <h5bi69$h5g$1@ger.gmane.org>

Hi,

I have successfully compiled DLLs and invoked the functions using the R 
toolset. I would also like to compile the DLL using Microsof Visual 
Studio compiler (2005, if that matters). The FAQ tells how to do that 
from the command line; however I'd also like to do that from within the 
IDE.
So far I failed: The DLL was built, and actually the function of 
interest was put under export category; but apparently something did not 
work out because R couldn't locate the function (loading the DLL worked 
fine). I know this question is only marginally R related, so :

a) is it simple to set up a virgin (empty) project using the MSVC IDE?
Any hints would be much appreciated.
b) otherwise, shall I transfer the question to a MSVC newsgroup and ask 
for helping translating the command-line options into the project 
settings I have to set in the IDE ? Is there a 1:1 mapping ?

Thanks,
Thomas


From romain.francois at dbmail.com  Wed Aug  5 11:32:51 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Wed, 05 Aug 2009 11:32:51 +0200
Subject: [Rd] exec subdirectory of a package
Message-ID: <4A7951C3.4010902@dbmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090805/dab93b99/attachment.pl>

From therneau at mayo.edu  Wed Aug  5 18:29:12 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Wed, 05 Aug 2009 11:29:12 -0500
Subject: [Rd] inheriting C symbols
Message-ID: <1249489752.18439.14.camel@punchbuggy>

The package coxme depends heavily on bdsmatrix, to the point of needing
access to some of its C calls.  The kinship package (in progress) uses
the R level functions in bdsmatrix, but not the C calls.  That is, I
don't want to always export the symbols.

For testing I can use an explicit dyn.load('somepath/bsdmatrix.so',
local=F).  How do I incorporate such a dependency in the DESCRIPTION
file for coxme, so that it happens in general?

Terry T.


From jeff.a.ryan at gmail.com  Wed Aug  5 18:54:28 2009
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Wed, 5 Aug 2009 11:54:28 -0500
Subject: [Rd] inheriting C symbols
In-Reply-To: <1249489752.18439.14.camel@punchbuggy>
References: <1249489752.18439.14.camel@punchbuggy>
Message-ID: <e8e755250908050954k50d85712vf8cf310a145f9360@mail.gmail.com>

This has been discussed before:

http://www.nabble.com/Dynamic-linking-to-binary-code-from-other-packages---td20167535.html#a20474561

Take a look at 'xts' on cran, or R-forge.  Specifically:

http://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/pkg/inst/api_example/README?rev=386&root=xts&view=markup

HTH
Jeff

On Wed, Aug 5, 2009 at 11:29 AM, Terry Therneau<therneau at mayo.edu> wrote:
> The package coxme depends heavily on bdsmatrix, to the point of needing
> access to some of its C calls. ?The kinship package (in progress) uses
> the R level functions in bdsmatrix, but not the C calls. ?That is, I
> don't want to always export the symbols.
>
> For testing I can use an explicit dyn.load('somepath/bsdmatrix.so',
> local=F). ?How do I incorporate such a dependency in the DESCRIPTION
> file for coxme, so that it happens in general?
>
> Terry T.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From therneau at mayo.edu  Wed Aug  5 21:24:48 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Wed, 05 Aug 2009 14:24:48 -0500
Subject: [Rd] inheriting C symbols
In-Reply-To: <e8e755250908050954k50d85712vf8cf310a145f9360@mail.gmail.com>
References: <1249489752.18439.14.camel@punchbuggy>
	<e8e755250908050954k50d85712vf8cf310a145f9360@mail.gmail.com>
Message-ID: <1249500288.18439.24.camel@punchbuggy>

Thanks for the information.  I'd looked through the manual but missed
this.  Follow-up questions

1. I'd never paid much attention to that whole "register routines"
section of the manual because a) it didn't seem necessary (my code
worked anyway) and b) it's quite complex.  Your answer is that if I dig
into it, there is a way to export routines.  Is there any other real
advantage to registration?

2. The simpler method is to use a local=FALSE argument to dyn.load.
Since it wasn't mentioned, I'll assume that there is no way to add text
to the DESCRIPTION file saying "and load the symbols too"?  It would be
much simpler.  Also a bit more dangerous of course, since function
prototypes are not being exported via a header.

  Terry T


On Wed, 2009-08-05 at 11:54 -0500, Jeff Ryan wrote:
> This has been discussed before:
> 
> http://www.nabble.com/Dynamic-linking-to-binary-code-from-other-packages---td20167535.html#a20474561
> 
> Take a look at 'xts' on cran, or R-forge.  Specifically:
> 
> http://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/pkg/inst/api_example/README?rev=386&root=xts&view=markup
> 
> HTH
> Jeff
> 
> On Wed, Aug 5, 2009 at 11:29 AM, Terry Therneau<therneau at mayo.edu> wrote:
> > The package coxme depends heavily on bdsmatrix, to the point of needing
> > access to some of its C calls.  The kinship package (in progress) uses
> > the R level functions in bdsmatrix, but not the C calls.  That is, I
> > don't want to always export the symbols.
> >
> > For testing I can use an explicit dyn.load('somepath/bsdmatrix.so',
> > local=F).  How do I incorporate such a dependency in the DESCRIPTION
> > file for coxme, so that it happens in general?
> >
> > Terry T.
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> 
>


From jeff.a.ryan at gmail.com  Wed Aug  5 22:14:01 2009
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Wed, 5 Aug 2009 15:14:01 -0500
Subject: [Rd] inheriting C symbols
In-Reply-To: <1249500288.18439.24.camel@punchbuggy>
References: <1249489752.18439.14.camel@punchbuggy>
	<e8e755250908050954k50d85712vf8cf310a145f9360@mail.gmail.com>
	<1249500288.18439.24.camel@punchbuggy>
Message-ID: <e8e755250908051314t717b126by2b40c18bfb889de8@mail.gmail.com>

Terry,

I think I don't quite follow what you want to do.

You have a package that needs to access the R level functions in
another, or the C level functions?

Do you need access *from R* for the above, or *from new C code*?

If you are just looking to call .Call("other_package", ...) I think
your only strategy is to list it as a dependency.  Is there some
reason you don't want to do that?

Once it is a dependency you can simply call the C routines like they
are called within the package's R code.

Jeff

On Wed, Aug 5, 2009 at 2:24 PM, Terry Therneau<therneau at mayo.edu> wrote:
> Thanks for the information. ?I'd looked through the manual but missed
> this. ?Follow-up questions
>
> 1. I'd never paid much attention to that whole "register routines"
> section of the manual because a) it didn't seem necessary (my code
> worked anyway) and b) it's quite complex. ?Your answer is that if I dig
> into it, there is a way to export routines. ?Is there any other real
> advantage to registration?
>
> 2. The simpler method is to use a local=FALSE argument to dyn.load.
> Since it wasn't mentioned, I'll assume that there is no way to add text
> to the DESCRIPTION file saying "and load the symbols too"? ?It would be
> much simpler. ?Also a bit more dangerous of course, since function
> prototypes are not being exported via a header.
>
> ?Terry T
>
>
> On Wed, 2009-08-05 at 11:54 -0500, Jeff Ryan wrote:
>> This has been discussed before:
>>
>> http://www.nabble.com/Dynamic-linking-to-binary-code-from-other-packages---td20167535.html#a20474561
>>
>> Take a look at 'xts' on cran, or R-forge. ?Specifically:
>>
>> http://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/pkg/inst/api_example/README?rev=386&root=xts&view=markup
>>
>> HTH
>> Jeff
>>
>> On Wed, Aug 5, 2009 at 11:29 AM, Terry Therneau<therneau at mayo.edu> wrote:
>> > The package coxme depends heavily on bdsmatrix, to the point of needing
>> > access to some of its C calls. ?The kinship package (in progress) uses
>> > the R level functions in bdsmatrix, but not the C calls. ?That is, I
>> > don't want to always export the symbols.
>> >
>> > For testing I can use an explicit dyn.load('somepath/bsdmatrix.so',
>> > local=F). ?How do I incorporate such a dependency in the DESCRIPTION
>> > file for coxme, so that it happens in general?
>> >
>> > Terry T.
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >
>>
>>
>>
>
>



-- 
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From smckinney at bccrc.ca  Wed Aug  5 23:46:37 2009
From: smckinney at bccrc.ca (Steven McKinney)
Date: Wed, 5 Aug 2009 14:46:37 -0700
Subject: [Rd] Wishlist: Navigate to "Index" page of help when no topic
 (PR#13872)
In-Reply-To: <6601_1249453736_1249453736_4A79258D.5030207@dbmail.com>
References: <20090805001012.9BA51282EFFB@mail.pubhealth.ku.dk>,
	<6601_1249453736_1249453736_4A79258D.5030207@dbmail.com>
Message-ID: <DCE81E14EB74504B971DAD4D2DB0356B01F9E867@crcmail4.BCCRC.CA>


Thanks Romain, 

I find

index?survival

more intuitive than my proposed

?survival::

Steven McKinney

________________________________________
From: r-devel-bounces at r-project.org [r-devel-bounces at r-project.org] On Behalf Of Romain Francois [romain.francois at dbmail.com]
Sent: August 4, 2009 11:24 PM
To: murdoch at stats.uwo.ca
Cc: r-devel at stat.math.ethz.ch
Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no topic (PR#13872)

Hello,

I'm jumping a bit late on this, but what about something like:

index?survival

or more generally

foo?bar

with the ability for the user/package to define what the combination
"foo"/"bar" means. At the moment, the way "package?survival" is handled
is to :
- create the string "package-survival"
- call help with it

Romain



On 08/05/2009 02:10 AM, murdoch at stats.uwo.ca wrote:
> On 04/08/2009 7:33 PM, Steven McKinney wrote:
>>> -----Original Message-----
>>> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
>>> Sent: Tuesday, August 04, 2009 8:03 AM
>>> To: Steven McKinney
>>> Cc: r-devel at stat.math.ethz.ch; R-bugs at r-project.org
>>> Subject: Re: [Rd] Wishlist: Navigate to "Index" page of help when no
>>> topic specified (PR#13860)
>>>
>>> On 7/28/2009 6:30 PM, smckinney at bccrc.ca wrote:
>>>> Hi all,
>>>>
>>>> When I install a new package, and don't yet know any function names,
>>>> I have to play the "poor man's game" to get to the standard
>>>> help system "Index" page for the package:
>>> You could complain to the package author or maintainer, who should have
>>> created a help alias with the package name so that ?survival would give
>>> you something useful.  But I would guess R 2.10.x or 2.11.x will do
>>> that
>>> automatically.
>>>
>>> Duncan Murdoch
>> Unfortunately it happens frequently - hopefully I
>> don't have to complain so much - I'd rather figure
>> out code to get to the index page!
>>
>> When you say "I would guess R 2.10.x or 2.11.x will do
>> that automatically" do you mean
>> ?survival::
>> or some similar incantation
>> will take me to the Index or 00Index page?
>
> I would guess package?survival will take you to a help page that is
> similar to what you get now in the flat display from
> library(help=survival).  Ideally it will have a link on it to the index
> page.  It is possible that ?survival will work too; that may be more
> controversial, because for many packages (e.g. boot) an alias like that
> is already defined, pointing to something other than the package main page.
>
>> Do I need to propose code or is it already
>> known how to do this within the R core group?
>
> I doubt if code to do that would be accepted (since it will be redundant
> once the above changes are in place), but posting it to r-devel might
> help people in the meantime.  You should look at the tools package,
> which has a number of functions that are used by R for constructing the
> help pages; there's probably something there that will let you construct
> a link to the index fairly easily.
>
> Duncan Murdoch
>
>> Best
>> Steve McKinney
>>
>>
>>>> Poor Man's Game -=20
>>>>    Load new package;=20
>>>>    issue search() command;
>>>>    find position (say N) of loaded package;=20
>>>>    issue objects(pos =3D N) command;
>>>>    get name of a random function (san newFunction);=20
>>>>    issue ?newFunction command;
>>>>    scroll to bottom of page;=20
>>>>    click on the "Index" hyperlink
>>>>
>>>> There are other variations, but they all involve this=20
>>>> long march to the Index page.
>>>>
>>>>
>>>> What I'd like to be able to do is enter the command
>>>>
>>>>> help(package =3D "survival")
>>>> or
>>>>
>>>>> ?survival::
>>>> and get the usual hyperlinked help page displayed (the "00Index"
>>> page)
>>>> instead of the static "text only" display or an error message
>>>>
>>>> (for example, on Windows, this equates to invoking
>>>> "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>>>> on Apple Mac,
>>>>
>>> "/Library/Frameworks/R.framework/Resources/library/survival/html/00Inde
>>> x.ht=
>>>> ml"
>>>> etc.)
>>>>
>>>>
>>>> Details:
>>>> ---------------
>>>>
>>>> The help() function returns an object of
>>>> class "help_files_with_topic".
>>>> The object consists of a character vector
>>>> with several attributes.
>>>>
>>>> PC:  Windows XP
>>>>
>>>>> library("survival")
>>>>> foo<- help("aareg", package =3D "survival")
>>>>> class(foo)
>>>> [1] "help_files_with_topic"
>>>>> foo[1]
>>>> [1] "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/aareg"
>>>>> attributes(foo)
>>>> $call
>>>> help(topic =3D "aareg", package =3D "survival")
>>>>
>>>> $pager
>>>> [1] "internal"
>>>>
>>>> $topic
>>>> [1] "aareg"
>>>>
>>>> $tried_all_packages
>>>> [1] FALSE
>>>>
>>>> $type
>>>> [1] "chm"
>>>>
>>>> $class
>>>> [1] "help_files_with_topic"
>>>>
>>>>> bar<- help("", package =3D "survival")
>>>>> class(bar)
>>>> [1] "help_files_with_topic"
>>>>> bar[1]
>>>> [1] NA
>>>>> attributes(bar)
>>>> $call
>>>> help(topic =3D "", package =3D "survival")
>>>>
>>>> $pager
>>>> [1] "internal"
>>>>
>>>> $topic
>>>> [1] ""
>>>>
>>>> $tried_all_packages
>>>> [1] FALSE
>>>>
>>>> $type
>>>> [1] "chm"
>>>>
>>>> $class
>>>> [1] "help_files_with_topic"
>>>>
>>>> If I alter the character vector to
>>>> point to "00Index"
>>>>
>>>>> bar[1]<- "C:/PROGRA~1/R/R-29~1.1/library/survival/chm/00Index"
>>>>> bar
>>>> I see exactly what I've been attempting to achieve.
>>>>
>>>>
>>>> Mac OS X:
>>>>
>>>>> foo<- help("aareg", package =3D "survival")
>>>>> foo[1]
>>>> [1]
>>> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
>>> =
>>>> html"
>>>>> attributes(foo)
>>>> $call
>>>> help(topic =3D "aareg", package =3D "survival")
>>>>
>>>> $pager
>>>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
>>>>
>>>> $topic
>>>> [1] "aareg"
>>>>
>>>> $tried_all_packages
>>>> [1] FALSE
>>>>
>>>> $type
>>>> [1] "html"
>>>>
>>>> $class
>>>> [1] "help_files_with_topic"
>>>>
>>>>> bar<- help("", package =3D "survival")
>>>>> bar[1]
>>>> [1] NA
>>>>> bar[1]<-
>>> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
>>>> l/00Index.html"
>>>>> bar
>>>> Again I see exactly what I've been after.
>>>>
>>>> Running R in Emacs on Mac OS X:
>>>>
>>>>> foo<- help(topic =3D "aareg", package =3D "survival")
>>>>> foo[1]
>>>> [1]
>>> "/Library/Frameworks/R.framework/Resources/library/survival/html/aareg.
>>> =
>>>> html"
>>>>> attributes(foo)
>>>> $call
>>>> help(topic =3D "aareg", package =3D "survival")
>>>>
>>>> $pager
>>>> [1] "/Library/Frameworks/R.framework/Resources/bin/pager"
>>>>
>>>> $topic
>>>> [1] "aareg"
>>>>
>>>> $tried_all_packages
>>>> [1] FALSE
>>>>
>>>> $type
>>>> [1] "html"
>>>>
>>>> $class
>>>> [1] "help_files_with_topic"
>>>>
>>>>> bar<- help(topic =3D "", package =3D "survival")
>>>>> bar[1]
>>>> [1] NA
>>>>> bar[1]<-
>>> "/Library/Frameworks/R.framework/Resources/library/survival/htm=
>>>> l/00Index.html"
>>>>> bar
>>>> Help for '' is shown in browser /usr/bin/open ...
>>>> Use
>>>>          help("", htmlhelp =3D FALSE)
>>>> or
>>>>          options(htmlhelp =3D FALSE)
>>>> to revert.
>>>> Again, what I've been trying to achieve.
>>>>
>>>> When a user loads a new library and doesn't yet know any function
>>> names,
>>>> I think
>>>>> help(package =3D "newLibrary")
>>>> or
>>>>> ?newLibrary::
>>>> should perform the above action whenever possible instead of
>>>> producing static help or an error message.
>>>>
>>>> The "00Index" 'object' should be available for such use
>>>> whenever it exists. =20
>>>>
>>>> I have not yet worked out all the coding details to make this happen,
>>>> but before I do, am I missing some key point?  Any reasons why this
>>>> would be a Bad Idea?
>>>>
>>>>
>>>>
>>>> Steven McKinney, Ph.D.
>>>>
>>>> Statistician
>>>> Molecular Oncology and Breast Cancer Program
>>>> British Columbia Cancer Research Centre
>>>>
>>>> email: smckinney +at+ bccrc +dot+ ca
>>>>
>>>> tel: 604-675-8000 x7561
>>>>
>>>> BCCRC
>>>> Molecular Oncology
>>>> 675 West 10th Ave, Floor 4
>>>> Vancouver B.C.
>>>> V5Z 1L3
>>>> Canada


--
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/vsK1 : R parser package on CRAN
|- http://tr.im/vshK : Transfer files through Rserve
`- http://tr.im/vfxe : R GUI page on the R wiki

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From derek.eder at lungall.gu.se  Thu Aug  6 14:55:12 2009
From: derek.eder at lungall.gu.se (derek.eder at lungall.gu.se)
Date: Thu,  6 Aug 2009 14:55:12 +0200 (CEST)
Subject: [Rd] tk_choose.filesn () (tcltk) intolerant of whitespace (PR#13875)
Message-ID: <20090806125512.601B52831FE1@mail.pubhealth.ku.dk>

Full_Name: Derek Eder
Version: 2.9.1
OS: x86_64-pc-linux-gnu 
Submission from: (NULL) (130.241.91.3)


Function "tk_choose.files" (tcltk) is intolerant of filenames which contain
whitespace.
In that case, the return value is character vector of whitespace separated
chunks. See example below.


Thank you,


Derek Eder



>     myChoice <- tk_choose.files(filter = Filters, multi=FALSE)


      # select file: "tk_choose.files test _file .r"   # note white space!



> myChoice
[1] "/home/derek/projects/VINKLA/STUDIES/Opanayiko/R/tk_choose.files"
[2] "test"                                                            
[3] "_file"                                                           
[4] ".r"  



# OK, I can work around this
> paste(myChoice,collapse=" ")
[1] "{/home/derek/projects/VINKLA/STUDIES/Opanayiko/R/tk_choose.files test _file
.r}"



 


> version
               _                           
platform       x86_64-pc-linux-gnu         
arch           x86_64                      
os             linux-gnu                   
system         x86_64, linux-gnu           
status                                     
major          2                           
minor          9.1                         
year           2009                        
month          06                          
day            26                          
svn rev        48839                       
language       R                           
version.string R version 2.9.1 (2009-06-26)


Package: tcltk
Version: 2.9.1
Priority: base
Title: Tcl/Tk Interface
Author: R Development Core Team
Maintainer: R Core Team <R-core at r-project.org>
Description: Interface and language bindings to Tcl/Tk GUI elements
License: Part of R 2.9.1
Built: R 2.9.1; x86_64-pc-linux-gnu; 2009-06-30 19:02:28 UTC; unix


From art27 at cantab.net  Thu Aug  6 16:00:11 2009
From: art27 at cantab.net (art27 at cantab.net)
Date: Thu,  6 Aug 2009 16:00:11 +0200 (CEST)
Subject: [Rd] Section 1.3.1 of R-Ext Documentation lists
	tests/Examples/pkg-Rex-Rout.save incorrectly (PR#13877)
Message-ID: <20090806140011.266432831FE0@mail.pubhealth.ku.dk>

Full_Name: Andrew Thornton
Version: Webpage
OS: Linux
Submission from: (NULL) (81.154.9.63)


The Writing R Extensions documentation at:

http://cran.r-project.org/doc/manuals/R-exts.html

lists two different filenames for making the example's Rout.save a test result.

Section 1.1.3 says:

"If tests has a subdirectory Examples containing a file pkg-Ex.Rout.save, this
is compared to the output file for running the examples when the latter are
checked."

I.e. tests/Example/pkg-Ex.Rout.save

Section 1.3.1 says:

"16. The examples provided by the package's documentation are run. (see Writing
R documentation files, for information on using \examples to create executable
example code.) If there is a file tests/Examples/pkg-Ex-Rout.save, the output of
running the examples is compared to that file. "

i.e. tests/Example/pkg-Ex-Rout.save

Section 1.3.1 is incorrect and will not work


From Brandon.J.Whitcher at gsk.com  Thu Aug  6 15:50:09 2009
From: Brandon.J.Whitcher at gsk.com (Brandon.J.Whitcher at gsk.com)
Date: Thu,  6 Aug 2009 15:50:09 +0200 (CEST)
Subject: [Rd] Inconsistent documentation in Writing R Extensions (PR#13876)
Message-ID: <20090806135009.777592831FE0@mail.pubhealth.ku.dk>

Greetings,

I think there is an inconsistency in the Writing R Extensions document. 
Please let me know if I am right or wrong on this one.

Working from the PDF document (R-exts-2.9.1.pdf)

  - page 9 states that the file <pkg>-Ex.Rout.save should be placed in 
tests/Examples in order to check against the current set of examples.
  - page 17 (item 16) states that the file <pkg>-Ex-Rout.save should be 
placed in tests/Examples.

I have checked in one of my packages, and I believe the first case 
<pkg>-Ex.Rout.save is correct.  Is this true?

cheers...

Brandon


-----------------------------------------------------------
This e-mail was sent by GlaxoSmithKline Services Unlimited 
(registered in England and Wales No. 1047315), which is a 
member of the GlaxoSmithKline group of companies. The 
registered address of GlaxoSmithKline Services Unlimited 
is 980 Great West Road, Brentford, Middlesex TW8 9GS.
-----------------------------------------------------------

	[[alternative HTML version deleted]]


From ripley at stats.ox.ac.uk  Thu Aug  6 18:56:37 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 6 Aug 2009 17:56:37 +0100 (BST)
Subject: [Rd] Inconsistent documentation in Writing R Extensions
 (PR#13876)
In-Reply-To: <20090806135009.777592831FE0@mail.pubhealth.ku.dk>
References: <20090806135009.777592831FE0@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0908061756310.18269@auk.stats.ox.ac.uk>

On Thu, 6 Aug 2009, Brandon.J.Whitcher at gsk.com wrote:

> Greetings,
>
> I think there is an inconsistency in the Writing R Extensions document.
> Please let me know if I am right or wrong on this one.
>
> Working from the PDF document (R-exts-2.9.1.pdf)
>
>  - page 9 states that the file <pkg>-Ex.Rout.save should be placed in
> tests/Examples in order to check against the current set of examples.
>  - page 17 (item 16) states that the file <pkg>-Ex-Rout.save should be
> placed in tests/Examples.
>
> I have checked in one of my packages, and I believe the first case
> <pkg>-Ex.Rout.save is correct.  Is this true?

Yes.
>
> cheers...
>
> Brandon
>
>
> -----------------------------------------------------------
> This e-mail was sent by GlaxoSmithKline Services Unlimited
> (registered in England and Wales No. 1047315), which is a
> member of the GlaxoSmithKline group of companies. The
> registered address of GlaxoSmithKline Services Unlimited
> is 980 Great West Road, Brentford, Middlesex TW8 9GS.
> -----------------------------------------------------------
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Aug  6 19:00:16 2009
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu,  6 Aug 2009 19:00:16 +0200 (CEST)
Subject: [Rd] Inconsistent documentation in Writing R Extensions
	(PR#13878)
Message-ID: <20090806170016.EAE422831FE0@mail.pubhealth.ku.dk>

On Thu, 6 Aug 2009, Brandon.J.Whitcher at gsk.com wrote:

> Greetings,
>
> I think there is an inconsistency in the Writing R Extensions document.
> Please let me know if I am right or wrong on this one.
>
> Working from the PDF document (R-exts-2.9.1.pdf)
>
>  - page 9 states that the file <pkg>-Ex.Rout.save should be placed in
> tests/Examples in order to check against the current set of examples.
>  - page 17 (item 16) states that the file <pkg>-Ex-Rout.save should be
> placed in tests/Examples.
>
> I have checked in one of my packages, and I believe the first case
> <pkg>-Ex.Rout.save is correct.  Is this true?

Yes.
>
> cheers...
>
> Brandon
>
>
> -----------------------------------------------------------
> This e-mail was sent by GlaxoSmithKline Services Unlimited
> (registered in England and Wales No. 1047315), which is a
> member of the GlaxoSmithKline group of companies. The
> registered address of GlaxoSmithKline Services Unlimited
> is 980 Great West Road, Brentford, Middlesex TW8 9GS.
> -----------------------------------------------------------
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Aug  6 18:57:24 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 6 Aug 2009 17:57:24 +0100 (BST)
Subject: [Rd] Section 1.3.1 of R-Ext Documentation lists
 tests/Examples/pkg-Rex-Rout.save incorrectly (PR#13877)
In-Reply-To: <20090806140011.266432831FE0@mail.pubhealth.ku.dk>
References: <20090806140011.266432831FE0@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0908061756580.18269@auk.stats.ox.ac.uk>

Same as 13876!

On Thu, 6 Aug 2009, art27 at cantab.net wrote:

> Full_Name: Andrew Thornton
> Version: Webpage
> OS: Linux
> Submission from: (NULL) (81.154.9.63)
>
>
> The Writing R Extensions documentation at:
>
> http://cran.r-project.org/doc/manuals/R-exts.html
>
> lists two different filenames for making the example's Rout.save a test result.
>
> Section 1.1.3 says:
>
> "If tests has a subdirectory Examples containing a file pkg-Ex.Rout.save, this
> is compared to the output file for running the examples when the latter are
> checked."
>
> I.e. tests/Example/pkg-Ex.Rout.save
>
> Section 1.3.1 says:
>
> "16. The examples provided by the package's documentation are run. (see Writing
> R documentation files, for information on using \examples to create executable
> example code.) If there is a file tests/Examples/pkg-Ex-Rout.save, the output of
> running the examples is compared to that file. "
>
> i.e. tests/Example/pkg-Ex-Rout.save
>
> Section 1.3.1 is incorrect and will not work
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From RVaradhan at jhmi.edu  Thu Aug  6 21:04:58 2009
From: RVaradhan at jhmi.edu (Ravi Varadhan)
Date: Thu, 6 Aug 2009 15:04:58 -0400
Subject: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)
In-Reply-To: <19065.13838.892579.558430@lynne.math.ethz.ch>
References: <f5139d6efa66.4a75bdf7@johnshopkins.edu>
	<4A76B2BE.1060301@mx.uni-saarland.de>
	<004001ca1453$929c0520$7c94100a@win.ad.jhu.edu>
	<4A781CB9.8030505@mx.uni-saarland.de>
	<007701ca1514$33169e50$7c94100a@win.ad.jhu.edu>
	<OF99A54C31.A5EDECCA-ON85257608.0079614A-85257608.0079616B@american.edu>
	<19065.13838.892579.558430@lynne.math.ethz.ch>
Message-ID: <000d01ca16c8$cb1bfdc0$6153f940$@edu>

Dear All,

I just tested the complex-step derivative method on the latest windows
binary version: R 2.10.0 pre-release.

The complex-step derivatives are "exact" to within machine epsilon, with
very little additional computational effort compared to the simple,
first-order forward difference scheme.  

Thanks very much to all, especially to, Martin Maechler.

Best,
Ravi.

-----Original Message-----
From: Martin Maechler [mailto:maechler at stat.math.ethz.ch] 
Sent: Wednesday, August 05, 2009 3:35 AM
To: John Nolan
Cc: Ravi Varadhan; hwborchers at googlemail.com; r-devel at stat.math.ethz.ch
Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is accurate)

>>>>> "JN" == John Nolan <jpnolan at american.edu>
>>>>>     on Tue, 4 Aug 2009 18:05:47 -0400 writes:

    JN> Ravi,

    JN> There has been a lot of chatter about this, and people don't seem to
be
    JN> reading carefully.  Perhaps this will help clarify things.

Yes, I hope so;   thanks a lot, John!!
{Indeed, I've been appalled too about the amount of proclaiming
 without listening, and even more about the no-bug report... }


    JN> The problem appears to be that R was evaluating x^2 not as
multiplication
    JN> x*x, but as x^2.0=exp(2.0*log(x)), using standard C functions for
the
    JN> complex log and exponentiation.  Apparently the C library functions
for
    JN> this have some inaccuracies in it, which showed up in your
calculations.

    JN> One of the other responders said that matlab, octave, etc. detect
the case
    JN> when there is a positive integer power and use multiplication to
evaluate.
    JN> It appears that Martin Maechler has now submitted a change to R to
detect
    JN> integer powers and evaluate them via repeated multiplication, which
should
    JN> eliminate your problem.

Yes;  note however that -- exactly for the reason John has given
(and Martin Becker and I had tried to explain earlier in this
thread!) --
that your problem (*yours* indeed, not R's !!) will resurface if
you change "^2" by "^2.01" in your original problem.

    JN> There is no guarantee that R or matlab or any other
    JN> program will evaluate every expression correctly.
    JN> matlab has many years of use and evaluation that have
    JN> guided them in correct problems.  R is catching up, but
    JN> not there yet.

hhmm, hmm,... are you sure that the catching up is only on our side?
I dare say that I'm pretty sure R does quite a few computations
better than e.g., matlab...  But let's not get into more unproductive
chattering...

    JN> We are all part of improving R; your question led to a careful
    JN> examination of the issue and a fix within a few days.  No commercial
    JN> company responds so quickly!

    JN> HTH, John

it did, thank you very much!
Martin

    JN>
...........................................................................

    JN> John P. Nolan
    JN> Math/Stat Department
    JN> 227 Gray Hall
    JN> American University
    JN> 4400 Massachusetts Avenue, NW
    JN> Washington, DC 20016-8050

    JN> jpnolan at american.edu
    JN> 202.885.3140 voice
    JN> 202.885.3155 fax
    JN> http://academic2.american.edu/~jpnolan
    JN>
...........................................................................



    JN> -----r-devel-bounces at r-project.org wrote: -----


    JN> To: "'Martin Becker'" <martin.becker at mx.uni-saarland.de>
    JN> From: "Ravi Varadhan" <RVaradhan at jhmi.edu>
    JN> Sent by: r-devel-bounces at r-project.org
    JN> Date: 08/04/2009 10:59AM
    JN> cc: hwborchers at googlemail.com, r-devel at stat.math.ethz.ch
    JN> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is
accurate)

    JN> Please forgive me for my lack of understanding of IEEE
floating-point
    JN> arithmetic.  I have a hard time undertsanding why "this is not a
problem of
    JN> R itself", when "ALL" the other well known computing environments
including
    JN> Matlab, Octave, S+, and Scilab provide accurate results.  My concern
is not
    JN> really about the "overall" accuracy of R, but just about the complex
    JN> arithmetic.  Is there something idiosyncratic about the complex
arithmetic?


    JN> I am really hoping that some one from the R core would speak up and
address
    JN> this issue.  It would be a loss to the R users if this fascinating
idea of
    JN> "complex-step derivative" could not be implemented in R.

    JN> Thanks,
    JN> Ravi.

    JN>
----------------------------------------------------------------------------

    JN> -------

    JN> Ravi Varadhan, Ph.D.

    JN> Assistant Professor, The Center on Aging and Health

    JN> Division of Geriatric Medicine and Gerontology

    JN> Johns Hopkins University

    JN> Ph: (410) 502-2619

    JN> Fax: (410) 614-9625

    JN> Email: rvaradhan at jhmi.edu

    JN> Webpage:
    JN>
http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.h

    JN> tml



    JN>
----------------------------------------------------------------------------

    JN> --------


    JN> -----Original Message-----
    JN> From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de]
    JN> Sent: Tuesday, August 04, 2009 7:34 AM
    JN> To: Ravi Varadhan
    JN> Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
    JN> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is
accurate)

    JN> Dear Ravi,

    JN> I suspect that, in general, you may be facing the limitations of
machine
    JN> accuracy (more precisely, IEEE 754 arithmetics on [64-bit] doubles)
in your
    JN> application. This is not a problem of R itself, but rather a problem
of
    JN> standard arithmetics provided by underlying C compilers/CPUs.
    JN> In fact, every operation in IEEE arithmetics (so, this is not really
a
    JN> problem only for complex numbers) may suffer from inexactness, a
    JN> particularly difficult one is addition/subtraction. Consider the
following
    JN> example for real numbers (I know, it is not a very good one...):
    JN> The two functions

    JN> badfn <- function(x) 1-(1+x)*(1-x)
    JN> goodfn <- function(x) x^2

    JN> both calculate x^2 (theoretically, given perfect arithmetic). So, as
you
    JN> want to allow the user to 'specify the mathematical function ... in
"any"
    JN> form the user chooses', both functions should be ok.
    JN> But, unfortunately:

    >> badfn(1e-8)
    JN> [1] 2.220446049250313e-16
    >> goodfn(1e-8)
    JN> [1] 1e-16

    JN> I don't know what happens in matlab/octave/scilab for this example.
They
    JN> may
    JN> do better, but probably at some cost (dropping IEEE arithmetic/do
"clever"
    JN> calculations should result in massive speed penalties, try
    JN> evaluating   hypergeom([1,-99.9],[-49.9-24.9*I],(1+1.71*I)/2);   in
    JN> Maple...).
    JN> Now, you have some options:

    JN> - assume, that the user is aware of the numerical inexactness of
ieee
    JN> arithmetics and that he is able to supply some "robust" version of
the
    JN> mathematical function.
    JN> - use some other software (eg., matlab) for the critical
calculations
    JN> (there
    JN> is a R <-> Matlab interface, see package R.matlab on CRAN), if you
are
    JN> sure,
    JN> that this helps.
    JN> - implement/use multiple precision arithmetics within R (Martin
Maechler's
    JN> Rmpfr package may be very useful:
    JN> http://r-forge.r-project.org/projects/rmpfr/ , but this will slow
down
    JN> calculations considerably)

    JN> All in all, I think it is unfair just to blame R here. Of course, it
would
    JN> be great if there was a simple trigger to turn on multiple precision
    JN> arithmetics in R. Packages such as Rmpfr may provide a good step in
this
    JN> direction, since operator overloading via S4 classes allows for easy
code
    JN> adaption. But Rmpfr is still declared "beta", and it relies on some
    JN> external
    JN> library, which could be problematic on Windows systems. Maybe
someone else
    JN> has other/better suggestions, but I do not think that there is an
easy
    JN> solution for the "general" problem.

    JN> Best wishes,

    JN> Martin


    JN> Ravi Varadhan wrote:
    >> Dear Martin,
    >> 
    >> Thank you for this useful trick.  However, we are interested in a
    JN> "general"
    >> approach for exact derivative computation.  This approach should
allow
    >> the user to specify the mathematical function that needs to be
    >> differentiated in "any" form that the user chooses.  So, your trick
    >> will be difficult to implement there.  Furthermore, do we know for
    >> sure that `exponentiation' is the only operation that results in
    >> inaccuracy?  Are there other operations that also yield inaccurate
    JN> results
    JN> for complex arithmetic?
    >> 
    >> Hans Borchers also checked the computations with other free numerical
    >> software, such as Octave, Scilab, Euler, and they all return exactly
    >> the same results as Matlab.  It would be a shame if R could not do
the
    JN> same.
    >> 
    >> It would be great if the R core could address the "fundamental"
issue.
    >> 
    >> Thank you.
    >> 
    >> Best regards,
    >> Ravi.
    >> 
    >>
----------------------------------------------------------------------
    >> ------
    >> -------
    >> 
    >> Ravi Varadhan, Ph.D.
    >> 
    >> Assistant Professor, The Center on Aging and Health
    >> 
    >> Division of Geriatric Medicine and Gerontology
    >> 
    >> Johns Hopkins University
    >> 
    >> Ph: (410) 502-2619
    >> 
    >> Fax: (410) 614-9625
    >> 
    >> Email: rvaradhan at jhmi.edu
    >> 
    >> Webpage:
    >>
http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Vara
    >> dhan.h
    >> tml
    >> 
    >> 
    >> 
    >>
----------------------------------------------------------------------
    >> ------
    >> --------
    >> 
    >> 
    >> -----Original Message-----
    >> From: Martin Becker [mailto:martin.becker at mx.uni-saarland.de]
    >> Sent: Monday, August 03, 2009 5:50 AM
    >> To: Ravi Varadhan
    >> Cc: r-devel at stat.math.ethz.ch; hwborchers at googlemail.com
    >> Subject: Re: [Rd] Inaccurate complex arithmetic of R (Matlab is
    >> accurate)
    >> 
    >> Dear Ravi,
    >> 
    >> the inaccuracy seems to creep in when powers are calculated.
    >> Apparently, some quite general function is called to calculate the
    >> squares, and one can avoid the error by reformulating the example as
    JN> follows:
    >> 
    >> rosen <- function(x) {
    >> n <- length(x)
    >> x1 <- x[2:n]
    >> x2 <- x[1:(n-1)]
    >> sum(100*(x1-x2*x2)*(x1-x2*x2) + (1-x2)*(1-x2)) }
    >> 
    >> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136,
    >> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
    >> xh <- x0 + h
    >> 
    >> rx <- rosen(xh)
    >> Re(rx)
    >> Im (rx)
    >> 
    >> 
    >> I don't know which arithmetics are involved in the application you
    >> mentioned, but writing some auxiliary function for the calculation of
    >> x^n when x is complex and n is (a not too large) integer may solve
    >> some of the numerical issues. A simple version is:
    >> 
    >> powN <- function(x,n) sapply(x,function(x) prod(rep(x,n)))
    >> 
    >> The corresponding summation in 'rosen' would then read:
    >> 
    >> sum(100*powN(x1-powN(x2,2),2) + powN(1-x2,2))
    >> 
    >> 
    >> HTH,
    >> 
    >> Martin
    >> 
    >> 
    >> Ravi Varadhan wrote:
    >> 
    >>> Dear All,
    >>> 
    >>> Hans Borchers and I have been trying to compute "exact" derivatives
    >>> in R
    >>> 
    >> using the idea of complex-step derivatives that Hans has proposed.
    >> This is a really, really cool idea.  It gives "exact" derivatives
with
    >> only a minimal effort (same as that involved in computing first-order
    >> forward-difference derivative).
    >> 
    >>> Unfortunately, we cannot implement this in R as the "complex
arithmetic"
    >>> 
    >> in R appears to be inaccurate.
    >> 
    >>> Here is an example:
    >>> 
    >>> #-- Classical Rosenbrock function in n variables rosen <-
function(x)
    >>> { n <- length(x)
    >>> x1 <- x[2:n]
    >>> x2 <- x[1:(n-1)]
    >>> sum(100*(x1-x2^2)^2 + (1-x2)^2)
    >>> }
    >>> 
    >>> 
    >>> x0 <- c(0.0094, 0.7146, 0.2179, 0.6883, 0.5757, 0.9549, 0.7136,
    >>> 0.0849, 0.4147, 0.4540) h <- c(1.e-15*1i, 0, 0, 0, 0, 0, 0, 0, 0, 0)
    >>> xh <- x0 + h
    >>> 
    >>> rx <- rosen(xh)
    >>> Re(rx)
    >>> Im (rx)
    >>> 
    >>> #  rx = 190.3079796814885 - 12.13915588266717e-15 i  # incorrect
    >>> imaginary part in R
    >>> 
    >>> However, the imaginary part of the above answer is inaccurate.  The
    >>> 
    >> correct imaginary part (from Matlab) is:
    >> 
    >>> 190.3079796814886 - 4.66776376640000e-15 i  # correct imaginary part
    >>> from Matlab
    >>> 
    >>> This inaccuracy is serious enough to affect the acuracy of the
    >>> compex-step
    >>> 
    >> gradient drastically.
    >> 
    >>> Hans and I were wondering if there is a way to obtain accurate
"small"
    >>> 
    >> imaginary part for complex arithmetic.
    >> 
    >>> I am using Windows XP operating system.
    >>> 
    >>> Thanks for taking a look at this.
    >>> 
    >>> Best regards,
    >>> Ravi.
    >>> 
    >>> 
    >>> ____________________________________________________________________
    >>> 
    >>> Ravi Varadhan, Ph.D.
    >>> Assistant Professor,
    >>> Division of Geriatric Medicine and Gerontology School of Medicine
    >>> Johns Hopkins University
    >>> 
    >>> Ph. (410) 502-2619
    >>> email: rvaradhan at jhmi.edu
    >>> 
    >>> ______________________________________________
    >>> R-devel at r-project.org mailing list
    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >>> 
    >>> 
    >> 
    >> 
    >> --
    >> Dr. Martin Becker
    >> Statistics and Econometrics
    >> Saarland University
    >> Campus C3 1, Room 206
    >> 66123 Saarbruecken
    >> Germany
    >> 
    >> 


    JN> --
    JN> Dr. Martin Becker
    JN> Statistics and Econometrics
    JN> Saarland University
    JN> Campus C3 1, Room 206
    JN> 66123 Saarbruecken
    JN> Germany

    JN> ______________________________________________
    JN> R-devel at r-project.org mailing list
    JN> https://stat.ethz.ch/mailman/listinfo/r-devel
    JN> [[alternative HTML version deleted]]

    JN> ______________________________________________
    JN> R-devel at r-project.org mailing list
    JN> https://stat.ethz.ch/mailman/listinfo/r-devel


From pauljohn32 at gmail.com  Thu Aug  6 21:17:00 2009
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Thu, 6 Aug 2009 14:17:00 -0500
Subject: [Rd] About numerical accuracy: should there be a rational number
	class for fractions?
Message-ID: <13e802630908061217ya704679k53d719ad9a1bad7e@mail.gmail.com>

Hello, useRs.

I was monitoring the recent thread about the numerical (in)accuracy of
the C pow function and the apparent mismatch between R and matlab.

That particular problem has been addressed, but it seems there are
many others awaiting. I'm wondering if there is advice for package
writers & prospective R contributors about avoiding the most common
sorts of numerical mistakes.   Has this been discussed here?  I've
googled, finding naught, but perhaps I do not know the magic words.

I have seen two approaches to the numerical accuracy problem
associated with fractions.  I'm not a computer scientist, so perhaps I
over-simplify in interpreting the result.  Both of these approaches
seem to recommend we put off doing division until the last possible
moment.

One is  associated with a computer simulation article

Luis R. Izquierdo and J. Gary Polhill (2006)
Is Your Model Susceptible to Floating-Point Errors?
Journal of Artificial Societies and Social Simulation vol. 9, no. 4
<http://jasss.soc.surrey.ac.uk/9/4/4.html>

 J. Gary Polhill, Luis R. Izquierdo and Nicholas M. Gotts (2005)
The Ghost in the Model (and Other Effects of Floating Point Arithmetic)
Journal of Artificial Societies and Social Simulation vol. 8, no. 1
<http://jasss.soc.surrey.ac.uk/8/1/5.html>

And the other approach can be found in the Gambit program, which is a
tool for use in computing Nash (and other types of) equilibria in game
theory. (http://gambit.sourceforge.net/). Gambit was an NSF funded
project led by Dr. Richard McKelvey, who was one of the leading
mathematical political scientists in the US (before his untimely
death). It has been continued by his students, primarily Ted Turocy.

In Gambit, great care is taken to avoid any floating point
calculations involving fractions until the latest possible step. There
is a rational number class and fractions are added and subtracted in a
more exact way.  I think it "lowest common denominator" or similar
concept. (I remember that detail mainly because the switch from 32 bit
to 64 bit integers caused memory allocation troubles).

(Come to think of it, I believe the famous problem of poor variance
calculation in Microsoft Excel falls into the same category:

A. Talha Yalta, "The accuracy of statistical distributions in
Microsoft? Excel 2007"
Computational Statistics & Data Analysis
Volume 52, Issue 10, 15 June 2008, Pages 4579-4586

Use of Excel for Statistical Analysis
Neil Cox, Statistician, AgResearch Ruakura
http://www.agresearch.co.nz/Science/Statistics/exceluse1.htm

avoid division until the last possible moment!)


In R, we could protect ourselves somewhat if there were a class for
handling rational numbers.  Instead of taking a value like 2/3 and
letting the floating point calculation occur, a function could create
a "rational number object"

myfrac <- rational(2, 3)

And if I'm understanding the inheritance logic of objects in S 4
classes, then the rational class could implement +, -, / .

Well, I'm just wondering what you think about this question. I don't
think I could write this class, but I might be able to help somebody
refine and test such a thing if it existed.


-- 
Paul E. Johnson
Professor, Political Science
1541 Lilac Lane, Room 504
University of Kansas


From murdoch at stats.uwo.ca  Thu Aug  6 22:45:14 2009
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Thu,  6 Aug 2009 22:45:14 +0200 (CEST)
Subject: [Rd] [R] Repeatable, But Time Varying R GUI Crash (PR#13880)
Message-ID: <20090806204514.8DAE5282EF3D@mail.pubhealth.ku.dk>

On 8/6/2009 4:11 PM, Marilyn & Rich Short wrote:
> Hello,
> 
> I'm having a problem in R. The R GUI is crashing with a message to 
> contact Microsoft for the solution. I've contacted Microsoft and they 
> are of no help. Below is a distilled set of code that will cause the 
> crash. As you will see, there are two do-loops within which is a "load" 
> command. The crash usually occurs after 200*400 (=80,000) to 
> 2,000*400(=800,000) iterations.
> 
> Do you have any suggestions on work-arounds?

I can confirm it in R-patched as well.  It happens on the very first 
time through if you set gctorture() on, so it looks like somewhere in 
there is a missing PROTECT, and the garbage collector is reclaiming 
something that it shouldn't.

I'll try to track it down, but I'm not sure how quick I'll be.  (My 
house is full of contractors right now, so not a very nice place to work.)

I don't know any workaround other than "avoid doing the buggy thing". 
But I can't tell you what that is....

Duncan Murdoch

> Once you start the function with the  "problem2()" command, the function 
> will print to the screen once every 400 iterations. You can monitor the 
> progress by clicking the scroll button. The R GUI should crash somewhere 
> between i=200 and i=2000. Although the problem is repeatable, the time 
> at which the crash occurs is random.
> 
> Thanks in advance for your attention,
> 
> Rich Short
> 
> I'm using Windows XP, SP3 and R 2.9.1.
> Here is my session info:
> 
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> (The problem occurs on my Vista machine as well.)
> *******************************************
> 
> # This script induces the R GUI to crash.
> 
> problem2 = function(){
> 
> junk = mat.or.vec(8,40)
> 
> junk[] = 1
> 
> mjunk = mat.or.vec(8,40)
> 
> mjunk[] = -1
> 
> PathA = tempdir()
> 
> conX = paste(PathA,"junkx",sep="\\")
> 
> conY = paste(PathA,"junky",sep="\\")
> 
> outJunk = file(conX, open="wb")
> 
> save(junk, file=outJunk)
> 
> close(outJunk)
> 
> outJunkY = file(conY, open="wb")
> 
> save(mjunk, file=outJunkY)
> 
> close(outJunkY)
> 
> sign = 1
> 
> for(i in 1:4000){
> 
> for(ii in 1:400){
> 
> sign = -sign
> 
> if(sign<0){
> 
> load(file=conX)
> 
> }else{
> 
> load(file=conY)
> 
> }
> 
> sum = junk[1,5] + mjunk[3,30]
> 
> }
> 
> cat(" junk = ",junk[1,5],sep="")
> 
> cat(" mjunk = ",mjunk[3,30],sep="")
> 
> cat(" sum = ",sum,sep="")
> 
> cat(" i = ",i,"\n",sep="")
> 
> }
> 
> }
> 
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From wdunlap at tibco.com  Thu Aug  6 23:36:40 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Thu, 6 Aug 2009 14:36:40 -0700
Subject: [Rd] [R] Repeatable, But Time Varying R GUI Crash (PR#13880)
In-Reply-To: <20090806204514.8DAE5282EF3D@mail.pubhealth.ku.dk>
References: <20090806204514.8DAE5282EF3D@mail.pubhealth.ku.dk>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000195E46E@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of 
> murdoch at stats.uwo.ca
> Sent: Thursday, August 06, 2009 1:45 PM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at r-project.org
> Subject: Re: [Rd] [R] Repeatable, But Time Varying R GUI 
> Crash (PR#13880)
> 
> On 8/6/2009 4:11 PM, Marilyn & Rich Short wrote:
> > Hello,
> > 
> > I'm having a problem in R. The R GUI is crashing with a message to 
> > contact Microsoft for the solution. I've contacted 
> Microsoft and they 
> > are of no help. Below is a distilled set of code that will 
> cause the 
> > crash. As you will see, there are two do-loops within which 
> is a "load" 
> > command. The crash usually occurs after 200*400 (=80,000) to 
> > 2,000*400(=800,000) iterations.
> > 
> > Do you have any suggestions on work-arounds?
> 
> I can confirm it in R-patched as well.  It happens on the very first 
> time through if you set gctorture() on, so it looks like somewhere in 
> there is a missing PROTECT, and the garbage collector is reclaiming 
> something that it shouldn't.
> 
> I'll try to track it down, but I'm not sure how quick I'll be.

On Linux with R-2.10.0(devel) valgrind shows:
> gctorture()
> problem2()
==9777== Invalid read of size 1
==9777==    at 0x805DD5C: SETCAR (memory.c:2712)
==9777==    by 0x8156463: Rf_defineVar (envir.c:1353)
==9777==    by 0x80B3B16: RestoreToEnv (saveload.c:2022)
==9777==    by 0x80B4913: do_loadFromConn2 (saveload.c:2346)
==9777==    by 0x8065CF4: do_internal (names.c:1160)
==9777==    by 0x816629F: Rf_eval (eval.c:464)
==9777==    by 0x816815D: do_begin (eval.c:1244)
==9777==    by 0x816629F: Rf_eval (eval.c:464)
==9777==    by 0x8169853: Rf_applyClosure (eval.c:698)
==9777==    by 0x81661D7: Rf_eval (eval.c:508)
==9777==    by 0x816815D: do_begin (eval.c:1244)
==9777==    by 0x816629F: Rf_eval (eval.c:464)
==9777==  Address 0x4516A1B is 3 bytes inside a block of size 2,584
free'd
==9777==    at 0x40052A3: free (vg_replace_malloc.c:233)
==9777==    by 0x805B121: R_gc_internal (memory.c:784)
==9777==    by 0x805C1CF: Rf_allocVector (memory.c:2022)
==9777==    by 0x80B3AD2: RestoreToEnv (saveload.c:2017)
==9777==    by 0x80B4913: do_loadFromConn2 (saveload.c:2346)
==9777==    by 0x8065CF4: do_internal (names.c:1160)
==9777==    by 0x816629F: Rf_eval (eval.c:464)
==9777==    by 0x816815D: do_begin (eval.c:1244)
==9777==    by 0x816629F: Rf_eval (eval.c:464)
==9777==    by 0x8169853: Rf_applyClosure (eval.c:698)
==9777==    by 0x81661D7: Rf_eval (eval.c:508)
==9777==    by 0x816815D: do_begin (eval.c:1244)
==9777==
==9777== ---- Attach to debugger ? --- [Return/N/n/Y/y/C/c] ---- y
starting debugger
==9777== starting debugger with cmd: /usr/bin/gdb -nw /proc/9802/fd/1014
9802
GNU gdb Red Hat Linux (6.3.0.0-1.96rh)
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i386-redhat-linux-gnu"...Using host
libthread_db library "/lib/tls/libthread_db.so.1".

Attaching to program: /proc/9802/fd/1014, process 9802
SETCAR (x=0x5565da0, y=0x4516a18) at memory.c:2712
2712        CHECK_OLD_TO_NEW(x, y);
(gdb) up
#1  0x08156464 in Rf_defineVar (symbol=0x4f5eee0, value=0x4516a18,
    rho=0x559a77c) at envir.c:1353
1353                        SET_BINDING_VALUE(frame, value);
(gdb) list
1348            if (HASHTAB(rho) == R_NilValue) {
1349                /* First check for an existing binding */
1350                frame = FRAME(rho);
1351                while (frame != R_NilValue) {
1352                    if (TAG(frame) == symbol) {
1353                        SET_BINDING_VALUE(frame, value);
1354                        SET_MISSING(frame, 0);      /* Over-ride */
1355                        return;
1356                    }
1357                    frame = CDR(frame);
(gdb) up
#2  0x080b3b17 in RestoreToEnv (ans=0x54876b4, aenv=0x559a77c)
    at saveload.c:2022
2022            defineVar(TAG(a), CAR(a), aenv);
(gdb) list
2017        PROTECT(names = allocVector(STRSXP, cnt));
2018        cnt = 0;
2019        PROTECT(a = ans);
2020        while (a != R_NilValue) {
2021            SET_STRING_ELT(names, cnt++, PRINTNAME(TAG(a)));
2022            defineVar(TAG(a), CAR(a), aenv);
2023            if(R_seemsOldStyleS4Object(CAR(a)))
2024                warningcall(R_NilValue,
2025                            _("'%s' looks like a pre-2.4.0 S4
object: please recreate it"),
2026                            CHAR(PRINTNAME(TAG(a))));

It again complains about the call to R_seemsOldStyleS4Object().

Memory in 'a' may have been freed.  Shouldn't the
    PROTECT(a=ans)
be done earlier, when ans is allocated, instead of when
the pointer is copied?


Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com 

>  (My 
> house is full of contractors right now, so not a very nice 
> place to work.)
> 
> I don't know any workaround other than "avoid doing the buggy thing". 
> But I can't tell you what that is....
> 
> Duncan Murdoch
> 
> > Once you start the function with the  "problem2()" command, 
> the function 
> > will print to the screen once every 400 iterations. You can 
> monitor the 
> > progress by clicking the scroll button. The R GUI should 
> crash somewhere 
> > between i=200 and i=2000. Although the problem is 
> repeatable, the time 
> > at which the crash occurs is random.
> > 
> > Thanks in advance for your attention,
> > 
> > Rich Short
> > 
> > I'm using Windows XP, SP3 and R 2.9.1.
> > Here is my session info:
> > 
> >> sessionInfo()
> > R version 2.9.1 (2009-06-26)
> > i386-pc-mingw32
> > 
> > locale:
> > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> > States.1252;LC_MONETARY=English_United
> > States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> > 
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> > 
> > (The problem occurs on my Vista machine as well.)
> > *******************************************
> > 
> > # This script induces the R GUI to crash.
> > 
> > problem2 = function(){
> > 
> > junk = mat.or.vec(8,40)
> > 
> > junk[] = 1
> > 
> > mjunk = mat.or.vec(8,40)
> > 
> > mjunk[] = -1
> > 
> > PathA = tempdir()
> > 
> > conX = paste(PathA,"junkx",sep="\\")
> > 
> > conY = paste(PathA,"junky",sep="\\")
> > 
> > outJunk = file(conX, open="wb")
> > 
> > save(junk, file=outJunk)
> > 
> > close(outJunk)
> > 
> > outJunkY = file(conY, open="wb")
> > 
> > save(mjunk, file=outJunkY)
> > 
> > close(outJunkY)
> > 
> > sign = 1
> > 
> > for(i in 1:4000){
> > 
> > for(ii in 1:400){
> > 
> > sign = -sign
> > 
> > if(sign<0){
> > 
> > load(file=conX)
> > 
> > }else{
> > 
> > load(file=conY)
> > 
> > }
> > 
> > sum = junk[1,5] + mjunk[3,30]
> > 
> > }
> > 
> > cat(" junk = ",junk[1,5],sep="")
> > 
> > cat(" mjunk = ",mjunk[3,30],sep="")
> > 
> > cat(" sum = ",sum,sep="")
> > 
> > cat(" i = ",i,"\n",sep="")
> > 
> > }
> > 
> > }
> > 
> > ______________________________________________
> > R-help at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From wdunlap at tibco.com  Thu Aug  6 23:57:34 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Thu, 6 Aug 2009 14:57:34 -0700
Subject: [Rd] [R] Repeatable, But Time Varying R GUI Crash (PR#13880)
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000195E46E@NA-PA-VBE03.na.tibco.com>
References: <20090806204514.8DAE5282EF3D@mail.pubhealth.ku.dk>
	<77EB52C6DD32BA4D87471DCD70C8D7000195E46E@NA-PA-VBE03.na.tibco.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000195E47D@NA-PA-VBE03.na.tibco.com>

The following change to src/main/saveload.c seems to fix
the problem.  (I think problem2() has gotten past the place where
valgrind first complained, but it will be quite a while before it
is done.)  It just protects 'ans' before 'names' is allocated instead
of afterwards.

===================================================================
--- saveload.c  (revision 49063)
+++ saveload.c  (working copy)
@@ -2012,11 +2012,12 @@
     if (! isList(ans))
        error(_("loaded data is not in pair list form"));

+    PROTECT(ans);
     a = ans;
     while (a != R_NilValue) {a = CDR(a); cnt++;}
     PROTECT(names = allocVector(STRSXP, cnt));
     cnt = 0;
-    PROTECT(a = ans);
+    a = ans;
     while (a != R_NilValue) {
        SET_STRING_ELT(names, cnt++, PRINTNAME(TAG(a)));
        defineVar(TAG(a), CAR(a), aenv);

Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of William Dunlap
> Sent: Thursday, August 06, 2009 2:37 PM
> To: murdoch at stats.uwo.ca; r-devel at stat.math.ethz.ch
> Cc: R-bugs at r-project.org
> Subject: Re: [Rd] [R] Repeatable, But Time Varying R GUI 
> Crash (PR#13880)
> 
> > -----Original Message-----
> > From: r-devel-bounces at r-project.org 
> > [mailto:r-devel-bounces at r-project.org] On Behalf Of 
> > murdoch at stats.uwo.ca
> > Sent: Thursday, August 06, 2009 1:45 PM
> > To: r-devel at stat.math.ethz.ch
> > Cc: R-bugs at r-project.org
> > Subject: Re: [Rd] [R] Repeatable, But Time Varying R GUI 
> > Crash (PR#13880)
> > 
> > On 8/6/2009 4:11 PM, Marilyn & Rich Short wrote:
> > > Hello,
> > > 
> > > I'm having a problem in R. The R GUI is crashing with a 
> message to 
> > > contact Microsoft for the solution. I've contacted 
> > Microsoft and they 
> > > are of no help. Below is a distilled set of code that will 
> > cause the 
> > > crash. As you will see, there are two do-loops within which 
> > is a "load" 
> > > command. The crash usually occurs after 200*400 (=80,000) to 
> > > 2,000*400(=800,000) iterations.
> > > 
> > > Do you have any suggestions on work-arounds?
> > 
> > I can confirm it in R-patched as well.  It happens on the 
> very first 
> > time through if you set gctorture() on, so it looks like 
> somewhere in 
> > there is a missing PROTECT, and the garbage collector is reclaiming 
> > something that it shouldn't.
> > 
> > I'll try to track it down, but I'm not sure how quick I'll be.
> 
> On Linux with R-2.10.0(devel) valgrind shows:
> > gctorture()
> > problem2()
> ==9777== Invalid read of size 1
> ==9777==    at 0x805DD5C: SETCAR (memory.c:2712)
> ==9777==    by 0x8156463: Rf_defineVar (envir.c:1353)
> ==9777==    by 0x80B3B16: RestoreToEnv (saveload.c:2022)
> ==9777==    by 0x80B4913: do_loadFromConn2 (saveload.c:2346)
> ==9777==    by 0x8065CF4: do_internal (names.c:1160)
> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
> ==9777==    by 0x816815D: do_begin (eval.c:1244)
> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
> ==9777==    by 0x8169853: Rf_applyClosure (eval.c:698)
> ==9777==    by 0x81661D7: Rf_eval (eval.c:508)
> ==9777==    by 0x816815D: do_begin (eval.c:1244)
> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
> ==9777==  Address 0x4516A1B is 3 bytes inside a block of size 2,584
> free'd
> ==9777==    at 0x40052A3: free (vg_replace_malloc.c:233)
> ==9777==    by 0x805B121: R_gc_internal (memory.c:784)
> ==9777==    by 0x805C1CF: Rf_allocVector (memory.c:2022)
> ==9777==    by 0x80B3AD2: RestoreToEnv (saveload.c:2017)
> ==9777==    by 0x80B4913: do_loadFromConn2 (saveload.c:2346)
> ==9777==    by 0x8065CF4: do_internal (names.c:1160)
> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
> ==9777==    by 0x816815D: do_begin (eval.c:1244)
> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
> ==9777==    by 0x8169853: Rf_applyClosure (eval.c:698)
> ==9777==    by 0x81661D7: Rf_eval (eval.c:508)
> ==9777==    by 0x816815D: do_begin (eval.c:1244)
> ==9777==
> ==9777== ---- Attach to debugger ? --- [Return/N/n/Y/y/C/c] ---- y
> starting debugger
> ==9777== starting debugger with cmd: /usr/bin/gdb -nw 
> /proc/9802/fd/1014
> 9802
> GNU gdb Red Hat Linux (6.3.0.0-1.96rh)
> Copyright 2004 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public 
> License, and you
> are
> welcome to change it and/or distribute copies of it under certain
> conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for
> details.
> This GDB was configured as "i386-redhat-linux-gnu"...Using host
> libthread_db library "/lib/tls/libthread_db.so.1".
> 
> Attaching to program: /proc/9802/fd/1014, process 9802
> SETCAR (x=0x5565da0, y=0x4516a18) at memory.c:2712
> 2712        CHECK_OLD_TO_NEW(x, y);
> (gdb) up
> #1  0x08156464 in Rf_defineVar (symbol=0x4f5eee0, value=0x4516a18,
>     rho=0x559a77c) at envir.c:1353
> 1353                        SET_BINDING_VALUE(frame, value);
> (gdb) list
> 1348            if (HASHTAB(rho) == R_NilValue) {
> 1349                /* First check for an existing binding */
> 1350                frame = FRAME(rho);
> 1351                while (frame != R_NilValue) {
> 1352                    if (TAG(frame) == symbol) {
> 1353                        SET_BINDING_VALUE(frame, value);
> 1354                        SET_MISSING(frame, 0);      /* 
> Over-ride */
> 1355                        return;
> 1356                    }
> 1357                    frame = CDR(frame);
> (gdb) up
> #2  0x080b3b17 in RestoreToEnv (ans=0x54876b4, aenv=0x559a77c)
>     at saveload.c:2022
> 2022            defineVar(TAG(a), CAR(a), aenv);
> (gdb) list
> 2017        PROTECT(names = allocVector(STRSXP, cnt));
> 2018        cnt = 0;
> 2019        PROTECT(a = ans);
> 2020        while (a != R_NilValue) {
> 2021            SET_STRING_ELT(names, cnt++, PRINTNAME(TAG(a)));
> 2022            defineVar(TAG(a), CAR(a), aenv);
> 2023            if(R_seemsOldStyleS4Object(CAR(a)))
> 2024                warningcall(R_NilValue,
> 2025                            _("'%s' looks like a pre-2.4.0 S4
> object: please recreate it"),
> 2026                            CHAR(PRINTNAME(TAG(a))));
> 
> It again complains about the call to R_seemsOldStyleS4Object().
> 
> Memory in 'a' may have been freed.  Shouldn't the
>     PROTECT(a=ans)
> be done earlier, when ans is allocated, instead of when
> the pointer is copied?
> 
> 
> Bill Dunlap
> TIBCO Software Inc - Spotfire Division
> wdunlap tibco.com 
> 
> >  (My 
> > house is full of contractors right now, so not a very nice 
> > place to work.)
> > 
> > I don't know any workaround other than "avoid doing the 
> buggy thing". 
> > But I can't tell you what that is....
> > 
> > Duncan Murdoch
> > 
> > > Once you start the function with the  "problem2()" command, 
> > the function 
> > > will print to the screen once every 400 iterations. You can 
> > monitor the 
> > > progress by clicking the scroll button. The R GUI should 
> > crash somewhere 
> > > between i=200 and i=2000. Although the problem is 
> > repeatable, the time 
> > > at which the crash occurs is random.
> > > 
> > > Thanks in advance for your attention,
> > > 
> > > Rich Short
> > > 
> > > I'm using Windows XP, SP3 and R 2.9.1.
> > > Here is my session info:
> > > 
> > >> sessionInfo()
> > > R version 2.9.1 (2009-06-26)
> > > i386-pc-mingw32
> > > 
> > > locale:
> > > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> > > States.1252;LC_MONETARY=English_United
> > > States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> > > 
> > > attached base packages:
> > > [1] stats     graphics  grDevices utils     datasets  
> methods   base
> > > 
> > > (The problem occurs on my Vista machine as well.)
> > > *******************************************
> > > 
> > > # This script induces the R GUI to crash.
> > > 
> > > problem2 = function(){
> > > 
> > > junk = mat.or.vec(8,40)
> > > 
> > > junk[] = 1
> > > 
> > > mjunk = mat.or.vec(8,40)
> > > 
> > > mjunk[] = -1
> > > 
> > > PathA = tempdir()
> > > 
> > > conX = paste(PathA,"junkx",sep="\\")
> > > 
> > > conY = paste(PathA,"junky",sep="\\")
> > > 
> > > outJunk = file(conX, open="wb")
> > > 
> > > save(junk, file=outJunk)
> > > 
> > > close(outJunk)
> > > 
> > > outJunkY = file(conY, open="wb")
> > > 
> > > save(mjunk, file=outJunkY)
> > > 
> > > close(outJunkY)
> > > 
> > > sign = 1
> > > 
> > > for(i in 1:4000){
> > > 
> > > for(ii in 1:400){
> > > 
> > > sign = -sign
> > > 
> > > if(sign<0){
> > > 
> > > load(file=conX)
> > > 
> > > }else{
> > > 
> > > load(file=conY)
> > > 
> > > }
> > > 
> > > sum = junk[1,5] + mjunk[3,30]
> > > 
> > > }
> > > 
> > > cat(" junk = ",junk[1,5],sep="")
> > > 
> > > cat(" mjunk = ",mjunk[3,30],sep="")
> > > 
> > > cat(" sum = ",sum,sep="")
> > > 
> > > cat(" i = ",i,"\n",sep="")
> > > 
> > > }
> > > 
> > > }
> > > 
> > > ______________________________________________
> > > R-help at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide 
> > http://www.R-project.org/posting-guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From murdoch at stats.uwo.ca  Fri Aug  7 01:50:01 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 06 Aug 2009 19:50:01 -0400
Subject: [Rd] [R] Repeatable, But Time Varying R GUI Crash (PR#13880)
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000195E47D@NA-PA-VBE03.na.tibco.com>
References: <20090806204514.8DAE5282EF3D@mail.pubhealth.ku.dk>	<77EB52C6DD32BA4D87471DCD70C8D7000195E46E@NA-PA-VBE03.na.tibco.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000195E47D@NA-PA-VBE03.na.tibco.com>
Message-ID: <4A7B6C29.7060907@stats.uwo.ca>

William Dunlap wrote:
> The following change to src/main/saveload.c seems to fix
> the problem.  (I think problem2() has gotten past the place where
> valgrind first complained, but it will be quite a while before it
> is done.)  It just protects 'ans' before 'names' is allocated instead
> of afterwards.
>   

Thanks Bill!  I'll commit the fix in a few minutes, to R-devel and 
R-patched.

Duncan
> ===================================================================
> --- saveload.c  (revision 49063)
> +++ saveload.c  (working copy)
> @@ -2012,11 +2012,12 @@
>      if (! isList(ans))
>         error(_("loaded data is not in pair list form"));
>
> +    PROTECT(ans);
>      a = ans;
>      while (a != R_NilValue) {a = CDR(a); cnt++;}
>      PROTECT(names = allocVector(STRSXP, cnt));
>      cnt = 0;
> -    PROTECT(a = ans);
> +    a = ans;
>      while (a != R_NilValue) {
>         SET_STRING_ELT(names, cnt++, PRINTNAME(TAG(a)));
>         defineVar(TAG(a), CAR(a), aenv);
>
> Bill Dunlap
> TIBCO Software Inc - Spotfire Division
> wdunlap tibco.com  
>
>   
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org 
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of William Dunlap
>> Sent: Thursday, August 06, 2009 2:37 PM
>> To: murdoch at stats.uwo.ca; r-devel at stat.math.ethz.ch
>> Cc: R-bugs at r-project.org
>> Subject: Re: [Rd] [R] Repeatable, But Time Varying R GUI 
>> Crash (PR#13880)
>>
>>     
>>> -----Original Message-----
>>> From: r-devel-bounces at r-project.org 
>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of 
>>> murdoch at stats.uwo.ca
>>> Sent: Thursday, August 06, 2009 1:45 PM
>>> To: r-devel at stat.math.ethz.ch
>>> Cc: R-bugs at r-project.org
>>> Subject: Re: [Rd] [R] Repeatable, But Time Varying R GUI 
>>> Crash (PR#13880)
>>>
>>> On 8/6/2009 4:11 PM, Marilyn & Rich Short wrote:
>>>       
>>>> Hello,
>>>>
>>>> I'm having a problem in R. The R GUI is crashing with a 
>>>>         
>> message to 
>>     
>>>> contact Microsoft for the solution. I've contacted 
>>>>         
>>> Microsoft and they 
>>>       
>>>> are of no help. Below is a distilled set of code that will 
>>>>         
>>> cause the 
>>>       
>>>> crash. As you will see, there are two do-loops within which 
>>>>         
>>> is a "load" 
>>>       
>>>> command. The crash usually occurs after 200*400 (=80,000) to 
>>>> 2,000*400(=800,000) iterations.
>>>>
>>>> Do you have any suggestions on work-arounds?
>>>>         
>>> I can confirm it in R-patched as well.  It happens on the 
>>>       
>> very first 
>>     
>>> time through if you set gctorture() on, so it looks like 
>>>       
>> somewhere in 
>>     
>>> there is a missing PROTECT, and the garbage collector is reclaiming 
>>> something that it shouldn't.
>>>
>>> I'll try to track it down, but I'm not sure how quick I'll be.
>>>       
>> On Linux with R-2.10.0(devel) valgrind shows:
>>     
>>> gctorture()
>>> problem2()
>>>       
>> ==9777== Invalid read of size 1
>> ==9777==    at 0x805DD5C: SETCAR (memory.c:2712)
>> ==9777==    by 0x8156463: Rf_defineVar (envir.c:1353)
>> ==9777==    by 0x80B3B16: RestoreToEnv (saveload.c:2022)
>> ==9777==    by 0x80B4913: do_loadFromConn2 (saveload.c:2346)
>> ==9777==    by 0x8065CF4: do_internal (names.c:1160)
>> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
>> ==9777==    by 0x816815D: do_begin (eval.c:1244)
>> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
>> ==9777==    by 0x8169853: Rf_applyClosure (eval.c:698)
>> ==9777==    by 0x81661D7: Rf_eval (eval.c:508)
>> ==9777==    by 0x816815D: do_begin (eval.c:1244)
>> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
>> ==9777==  Address 0x4516A1B is 3 bytes inside a block of size 2,584
>> free'd
>> ==9777==    at 0x40052A3: free (vg_replace_malloc.c:233)
>> ==9777==    by 0x805B121: R_gc_internal (memory.c:784)
>> ==9777==    by 0x805C1CF: Rf_allocVector (memory.c:2022)
>> ==9777==    by 0x80B3AD2: RestoreToEnv (saveload.c:2017)
>> ==9777==    by 0x80B4913: do_loadFromConn2 (saveload.c:2346)
>> ==9777==    by 0x8065CF4: do_internal (names.c:1160)
>> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
>> ==9777==    by 0x816815D: do_begin (eval.c:1244)
>> ==9777==    by 0x816629F: Rf_eval (eval.c:464)
>> ==9777==    by 0x8169853: Rf_applyClosure (eval.c:698)
>> ==9777==    by 0x81661D7: Rf_eval (eval.c:508)
>> ==9777==    by 0x816815D: do_begin (eval.c:1244)
>> ==9777==
>> ==9777== ---- Attach to debugger ? --- [Return/N/n/Y/y/C/c] ---- y
>> starting debugger
>> ==9777== starting debugger with cmd: /usr/bin/gdb -nw 
>> /proc/9802/fd/1014
>> 9802
>> GNU gdb Red Hat Linux (6.3.0.0-1.96rh)
>> Copyright 2004 Free Software Foundation, Inc.
>> GDB is free software, covered by the GNU General Public 
>> License, and you
>> are
>> welcome to change it and/or distribute copies of it under certain
>> conditions.
>> Type "show copying" to see the conditions.
>> There is absolutely no warranty for GDB.  Type "show warranty" for
>> details.
>> This GDB was configured as "i386-redhat-linux-gnu"...Using host
>> libthread_db library "/lib/tls/libthread_db.so.1".
>>
>> Attaching to program: /proc/9802/fd/1014, process 9802
>> SETCAR (x=0x5565da0, y=0x4516a18) at memory.c:2712
>> 2712        CHECK_OLD_TO_NEW(x, y);
>> (gdb) up
>> #1  0x08156464 in Rf_defineVar (symbol=0x4f5eee0, value=0x4516a18,
>>     rho=0x559a77c) at envir.c:1353
>> 1353                        SET_BINDING_VALUE(frame, value);
>> (gdb) list
>> 1348            if (HASHTAB(rho) == R_NilValue) {
>> 1349                /* First check for an existing binding */
>> 1350                frame = FRAME(rho);
>> 1351                while (frame != R_NilValue) {
>> 1352                    if (TAG(frame) == symbol) {
>> 1353                        SET_BINDING_VALUE(frame, value);
>> 1354                        SET_MISSING(frame, 0);      /* 
>> Over-ride */
>> 1355                        return;
>> 1356                    }
>> 1357                    frame = CDR(frame);
>> (gdb) up
>> #2  0x080b3b17 in RestoreToEnv (ans=0x54876b4, aenv=0x559a77c)
>>     at saveload.c:2022
>> 2022            defineVar(TAG(a), CAR(a), aenv);
>> (gdb) list
>> 2017        PROTECT(names = allocVector(STRSXP, cnt));
>> 2018        cnt = 0;
>> 2019        PROTECT(a = ans);
>> 2020        while (a != R_NilValue) {
>> 2021            SET_STRING_ELT(names, cnt++, PRINTNAME(TAG(a)));
>> 2022            defineVar(TAG(a), CAR(a), aenv);
>> 2023            if(R_seemsOldStyleS4Object(CAR(a)))
>> 2024                warningcall(R_NilValue,
>> 2025                            _("'%s' looks like a pre-2.4.0 S4
>> object: please recreate it"),
>> 2026                            CHAR(PRINTNAME(TAG(a))));
>>
>> It again complains about the call to R_seemsOldStyleS4Object().
>>
>> Memory in 'a' may have been freed.  Shouldn't the
>>     PROTECT(a=ans)
>> be done earlier, when ans is allocated, instead of when
>> the pointer is copied?
>>
>>
>> Bill Dunlap
>> TIBCO Software Inc - Spotfire Division
>> wdunlap tibco.com 
>>
>>     
>>>  (My 
>>> house is full of contractors right now, so not a very nice 
>>> place to work.)
>>>
>>> I don't know any workaround other than "avoid doing the 
>>>       
>> buggy thing". 
>>     
>>> But I can't tell you what that is....
>>>
>>> Duncan Murdoch
>>>
>>>       
>>>> Once you start the function with the  "problem2()" command, 
>>>>         
>>> the function 
>>>       
>>>> will print to the screen once every 400 iterations. You can 
>>>>         
>>> monitor the 
>>>       
>>>> progress by clicking the scroll button. The R GUI should 
>>>>         
>>> crash somewhere 
>>>       
>>>> between i=200 and i=2000. Although the problem is 
>>>>         
>>> repeatable, the time 
>>>       
>>>> at which the crash occurs is random.
>>>>
>>>> Thanks in advance for your attention,
>>>>
>>>> Rich Short
>>>>
>>>> I'm using Windows XP, SP3 and R 2.9.1.
>>>> Here is my session info:
>>>>
>>>>         
>>>>> sessionInfo()
>>>>>           
>>>> R version 2.9.1 (2009-06-26)
>>>> i386-pc-mingw32
>>>>
>>>> locale:
>>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>>> States.1252;LC_MONETARY=English_United
>>>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>>>
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  
>>>>         
>> methods   base
>>     
>>>> (The problem occurs on my Vista machine as well.)
>>>> *******************************************
>>>>
>>>> # This script induces the R GUI to crash.
>>>>
>>>> problem2 = function(){
>>>>
>>>> junk = mat.or.vec(8,40)
>>>>
>>>> junk[] = 1
>>>>
>>>> mjunk = mat.or.vec(8,40)
>>>>
>>>> mjunk[] = -1
>>>>
>>>> PathA = tempdir()
>>>>
>>>> conX = paste(PathA,"junkx",sep="\\")
>>>>
>>>> conY = paste(PathA,"junky",sep="\\")
>>>>
>>>> outJunk = file(conX, open="wb")
>>>>
>>>> save(junk, file=outJunk)
>>>>
>>>> close(outJunk)
>>>>
>>>> outJunkY = file(conY, open="wb")
>>>>
>>>> save(mjunk, file=outJunkY)
>>>>
>>>> close(outJunkY)
>>>>
>>>> sign = 1
>>>>
>>>> for(i in 1:4000){
>>>>
>>>> for(ii in 1:400){
>>>>
>>>> sign = -sign
>>>>
>>>> if(sign<0){
>>>>
>>>> load(file=conX)
>>>>
>>>> }else{
>>>>
>>>> load(file=conY)
>>>>
>>>> }
>>>>
>>>> sum = junk[1,5] + mjunk[3,30]
>>>>
>>>> }
>>>>
>>>> cat(" junk = ",junk[1,5],sep="")
>>>>
>>>> cat(" mjunk = ",mjunk[3,30],sep="")
>>>>
>>>> cat(" sum = ",sum,sep="")
>>>>
>>>> cat(" i = ",i,"\n",sep="")
>>>>
>>>> }
>>>>
>>>> }
>>>>
>>>> ______________________________________________
>>>> R-help at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide 
>>>>         
>>> http://www.R-project.org/posting-guide.html
>>>       
>>>> and provide commented, minimal, self-contained, reproducible code.
>>>>         
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>       
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>     
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From mdowle at mdowle.plus.com  Fri Aug  7 08:43:16 2009
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Fri, 7 Aug 2009 07:43:16 +0100
Subject: [Rd] Using svSocket with data.table
References: <h4eb3j$eji$1@ger.gmane.org> <1248555172-sup-4306@bloxx.local>
Message-ID: <h5gii5$2kc$1@ger.gmane.org>

Hi Olaf,

Thanks for your feedback, much appreciated.

> Don't be fooled. R does not handle multiple requests in parallel
> internally.
I wasn't fooled, but I've added some annotations to the video at the place
I might have given the impression I was (at 4min 39sec).  Later, at 
5min30sec I did already point out that the 'graph
stopped while the R server processed this clients request' but that is 
later.
http://www.youtube.com/watch?v=rvT8XThGA8o

> Also I suspect that, depending on what you do on the CLI, this will
> interact badly with svSocket.
Can you give an example to try out?

Regards, Matthew



"Olaf Mersmann" <olafm at kimberly.tako.de> wrote in message 
news:1248555172-sup-4306 at bloxx.local...
> Hi Matthew,
>
> Excerpts from Matthew Dowle's message of Sat Jul 25 09:07:44 +0200 2009:
>> So I'm looking to do the same as the demo,  but with a binary socket. 
>> Does
>> anyone have any ideas?  I've looked a bit at  Rserve, bigmemory, biocep, 
>> nws
>> but although all those packages are great,  I didn't find anything that
>> worked in exactly this way i.e.  i) R to R ii) CLI non-blocking and iii) 
>> no
>> need to startup R in a special way
>
> Don't be fooled. R does not handle multiple requests in parallel
> internally. Also I suspect that, depending on what you do on the CLI,
> this will interact badly with svSocket.
>
> As far as binary transfer of R objects goes, you are probably looking
> for serialize() and unserialize(). Not sure if these are guaranteed to
> work across differen versions of R and different word sizes. See the
> Warnings section in the serialize manual page.
>
> Cheers
> Olaf
>


From maechler at stat.math.ethz.ch  Fri Aug  7 09:29:51 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 7 Aug 2009 09:29:51 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000195E482@NA-PA-VBE03.na.tibco.com>
References: <AD9D63E5376FD84F89F5B2D3E32B4001166F17@MSGMROCLB2WIN.DMN1.FMR.COM>
	<3aaf1a030908061445r29235545i224e1acce3ffcd69@mail.gmail.com>
	<200908062200.n76M0Q19023996@definetti.ddns.uark.edu>
	<77EB52C6DD32BA4D87471DCD70C8D7000195E482@NA-PA-VBE03.na.tibco.com>
Message-ID: <19067.55279.295410.685264@stat.math.ethz.ch>

>>>>> William Dunlap <wdunlap at tibco.com>
>>>>>     on Thu, 6 Aug 2009 15:06:08 -0700 writes:

    >> -----Original Message----- From:
    >> r-help-bounces at r-project.org
    >> [mailto:r-help-bounces at r-project.org] On Behalf Of
    >> Giovanni Petris Sent: Thursday, August 06, 2009 3:00 PM
    >> To: milton.ruser at gmail.com Cc: r-help at r-project.org;
    >> Daniel.Gerlanc at geodecapital.com Subject: Re: [R] Why is 0
    >> not an integer?
    >> 
    >> 
    >> I ran an instant experiment...
    >> 
    >> > typeof(0) [1] "double" > typeof(-0) [1] "double" >
    >> identical(0, -0) [1] TRUE
    >> 
    >> Best, Giovanni

    > But 0.0 and -0.0 have different reciprocals

    >> 1.0/0.0
    >    [1] Inf
    >> 1.0/-0.0
    >    [1] -Inf

    > Bill Dunlap TIBCO Software Inc - Spotfire Division wdunlap
    > tibco.com

yes.  {finally something interesting in this boring thread !}
---> diverting to R-devel

In April, I've had a private e-mail communication with John
Chambers [father of S, notably S4, which also brought identical()]
and Bill about the topic,
where I had started suggesting that  R  should be changed such
that
    identical(-0. , +0.)
would return FALSE.
Bill did mention that it does so for (newish versions of) S+
and that he'd prefer that, too,
and John said

 >> I agree on having a preference for a bitwise comparison for
 >> identical()---that's what the name means after all.  But since
 >> someone implemented the numerical case as the C == it's probably
 >> going to be more hassle than it's worth to change it.  But we
 >> should make the implementation clear in the documentation.

so in principle, we all agreed that R's identical() should be
changed here, namely by using something like  memcmp() instead
of simple '==' ,  however we haven't bothered to actually 
*implement* this change.

I am currently testing a patch  which would lead to
identical(0, -0)  return FALSE.

Martin Maechler, ETH Zurich
	    
    >> > By the way:
    >> > 
    >> > Are there difference between -0 and 0?


From abhibera at gmail.com  Fri Aug  7 09:34:31 2009
From: abhibera at gmail.com (Abhijit Bera)
Date: Fri, 7 Aug 2009 13:04:31 +0530
Subject: [Rd] Help with embedding R
Message-ID: <fc212e850908070034xb837ce9nf0e0c52ca8de45@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090807/5c4c2870/attachment.ksh>

From romain.francois at dbmail.com  Fri Aug  7 11:33:58 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Fri, 07 Aug 2009 11:33:58 +0200
Subject: [Rd] options( "menu" )
Message-ID: <4A7BF506.60302@dbmail.com>

Hello,

The current implementation of the menu function (in utils) makes it 
difficult for front-ends to hook in and propose an alternative display.

Can there be something like options( "menu" ) to give control over it in 
case graphics = TRUE. The default could be then be factored out of the 
current menu :

default.menu <- function( choices, multiple = FALSE, title ){
	if(.Platform$OS.type == "windows" || .Platform$GUI == "AQUA") {
             res <- select.list(choices = choices, multiple=multiple, 
title=title)
             return(match(res, choices, nomatch = 0L))
         } else if(.Platform$OS.type == "unix"
                 && capabilities("tcltk") && capabilities("X11")
                 && nzchar(Sys.getenv("DISPLAY"))) {
             res <- tcltk::tk_select.list(choices, multiple=multiple, 
title=title)
             return(match(res, choices, nomatch = 0L))
         }
options( menu = default.menu )

... or maybe this should be done at the select.list level

Romain

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/vzip : Code Snippet : List of CRAN packages
|- http://tr.im/vsK1 : R parser package on CRAN
`- http://tr.im/vshK : Transfer files through Rserve


From murdoch at stats.uwo.ca  Fri Aug  7 13:07:08 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Aug 2009 07:07:08 -0400
Subject: [Rd] identical(0, -0)
In-Reply-To: <19067.55279.295410.685264@stat.math.ethz.ch>
References: <AD9D63E5376FD84F89F5B2D3E32B4001166F17@MSGMROCLB2WIN.DMN1.FMR.COM>	<3aaf1a030908061445r29235545i224e1acce3ffcd69@mail.gmail.com>	<200908062200.n76M0Q19023996@definetti.ddns.uark.edu>	<77EB52C6DD32BA4D87471DCD70C8D7000195E482@NA-PA-VBE03.na.tibco.com>
	<19067.55279.295410.685264@stat.math.ethz.ch>
Message-ID: <4A7C0ADC.8020105@stats.uwo.ca>

Martin Maechler wrote:
>>>>>> William Dunlap <wdunlap at tibco.com>
>>>>>>     on Thu, 6 Aug 2009 15:06:08 -0700 writes:
>>>>>>             
>
>     >> -----Original Message----- From:
>     >> r-help-bounces at r-project.org
>     >> [mailto:r-help-bounces at r-project.org] On Behalf Of
>     >> Giovanni Petris Sent: Thursday, August 06, 2009 3:00 PM
>     >> To: milton.ruser at gmail.com Cc: r-help at r-project.org;
>     >> Daniel.Gerlanc at geodecapital.com Subject: Re: [R] Why is 0
>     >> not an integer?
>     >> 
>     >> 
>     >> I ran an instant experiment...
>     >> 
>     >> > typeof(0) [1] "double" > typeof(-0) [1] "double" >
>     >> identical(0, -0) [1] TRUE
>     >> 
>     >> Best, Giovanni
>
>     > But 0.0 and -0.0 have different reciprocals
>
>     >> 1.0/0.0
>     >    [1] Inf
>     >> 1.0/-0.0
>     >    [1] -Inf
>
>     > Bill Dunlap TIBCO Software Inc - Spotfire Division wdunlap
>     > tibco.com
>
> yes.  {finally something interesting in this boring thread !}
> ---> diverting to R-devel
>
> In April, I've had a private e-mail communication with John
> Chambers [father of S, notably S4, which also brought identical()]
> and Bill about the topic,
> where I had started suggesting that  R  should be changed such
> that
>     identical(-0. , +0.)
> would return FALSE.
> Bill did mention that it does so for (newish versions of) S+
> and that he'd prefer that, too,
> and John said
>
>  >> I agree on having a preference for a bitwise comparison for
>  >> identical()---that's what the name means after all.  But since
>  >> someone implemented the numerical case as the C == it's probably
>  >> going to be more hassle than it's worth to change it.  But we
>  >> should make the implementation clear in the documentation.
>
> so in principle, we all agreed that R's identical() should be
> changed here, namely by using something like  memcmp() instead
> of simple '==' ,  however we haven't bothered to actually 
> *implement* this change.
>
> I am currently testing a patch  which would lead to
> identical(0, -0)  return FALSE.
>   
I don't think that would be a good idea.  Other expressions besides "-0" 
calculate the zero with the negative sign bit, e.g. the following sequence:

pos <- 1
neg <- -1
zero <- 0
y <- zero*pos
z <- zero*neg
identical(y, z)

I think most R users would expect the last expression there to be TRUE 
based on the previous two lines, given that pos and neg both have finite 
values.  In a simple case like this y == z would be a better test to 
use, but if those were components of a larger structure, identical() is 
all we've got, and people would waste a lot of time tracking down why 
structures differing only in the sign of zero were not identical, even 
though every element tested equal.

Duncan Murdoch
> Martin Maechler, ETH Zurich
> 	    
>     >> > By the way:
>     >> > 
>     >> > Are there difference between -0 and 0?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From romain.francois at dbmail.com  Fri Aug  7 15:15:13 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Fri, 07 Aug 2009 15:15:13 +0200
Subject: [Rd] exec subdirectory of a package
In-Reply-To: <4A7951C3.4010902@dbmail.com>
References: <4A7951C3.4010902@dbmail.com>
Message-ID: <4A7C28E1.2030800@dbmail.com>

Anyone ?

I guess I'll have to make a package that ships the execute script

Romain

On 08/05/2009 11:32 AM, Romain Francois wrote:
> Hello,
>
> WRE contains the following information about the "exec" subdirectory of
> a package :
>
> "Subdirectory exec could contain additional executables the package
> needs, typically scripts for interpreters such as the shell, Perl, or
> Tcl. This mechanism is currently used only by a very few packages, and
> still experimental."
>
> I think it would be useful to expand "very few". For example "tcltk"
> uses it.
>
> But the real questions are;
> - can this be used in conjunction with "R CMD", something like
>
> $ R CMD execute package script parameters
>
> The alternative used in a few packages (Rserve, Roxygen, ...) is to add
> a file in ${R_HOME}/bin, but I am not sure this works with binary builds
> of packages
>
> - can the script be an R script, in that case would a shebang like this
> be enough :
>
> #!/bin/env Rscript
>
> definitely works on (at least my) linux
>
> A very naive "execute" written in R follows.
>
> Romain
>
>
>
>
> #!/bin/env Rscript
>
> args<- commandArgs(TRUE)
> if( length(args)<  2 ){
>           stop( "usage : R CMD execute package script [parameters]\n" )
> }
>
> package<- args[1]
> script<- args[2]
> scriptfile<- file.path( system.file( "exec", script, package = package ) )
> if( !file.exists( scriptfile ) ){
>           stop( sprintf( "file not found: '%s' ", scriptfile  ) )
> }
>
> trail<- if( length(args)>  2 ) paste( tail( args, -2 ), sep = " " ) else ""
> cmd<- sprintf( '"%s" %s', scriptfile, trail )
> system( cmd )


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/vzip : Code Snippet : List of CRAN packages
|- http://tr.im/vsK1 : R parser package on CRAN
`- http://tr.im/vshK : Transfer files through Rserve


From fabio.ufla at yahoo.com.br  Fri Aug  7 15:43:43 2009
From: fabio.ufla at yahoo.com.br (=?iso-8859-1?Q?Fabio_Mathias_Corr=EAa?=)
Date: Fri, 7 Aug 2009 06:43:43 -0700 (PDT)
Subject: [Rd] Changing the compiler gfortran to ifort
Message-ID: <813414.13125.qm@web59716.mail.ac4.yahoo.com>

I tried the manual R Installation and Administration to change the gcc compiler to icc and ifort for gfotran. However I could not find the correct path for the R to identify the icc and ifort.
In which file I define the change of compiler?

Thanks very much!!!

       ? F?bio Mathias Corr?a
Estat?stica e Experimenta??o Agropecu?ria/UFLA
                Brazil


      ____________________________________________________________________________________
Veja quais s?o os assuntos do momento no Yahoo! +Buscados
http://br.maisbuscados.yahoo.com


From Ted.Harding at manchester.ac.uk  Fri Aug  7 15:49:54 2009
From: Ted.Harding at manchester.ac.uk ( (Ted Harding))
Date: Fri, 07 Aug 2009 14:49:54 +0100 (BST)
Subject: [Rd] identical(0, -0)
In-Reply-To: <4A7C0ADC.8020105@stats.uwo.ca>
Message-ID: <XFMail.090807144954.Ted.Harding@manchester.ac.uk>

On 07-Aug-09 11:07:08, Duncan Murdoch wrote:
> Martin Maechler wrote:
>>>>>>> William Dunlap <wdunlap at tibco.com>
>>>>>>>     on Thu, 6 Aug 2009 15:06:08 -0700 writes:
>>     >> -----Original Message----- From:
>>     >> r-help-bounces at r-project.org
>>     >> [mailto:r-help-bounces at r-project.org] On Behalf Of
>>     >> Giovanni Petris Sent: Thursday, August 06, 2009 3:00 PM
>>     >> To: milton.ruser at gmail.com Cc: r-help at r-project.org;
>>     >> Daniel.Gerlanc at geodecapital.com Subject: Re: [R] Why is 0
>>     >> not an integer?
>>     >> 
>>     >> 
>>     >> I ran an instant experiment...
>>     >> 
>>     >> > typeof(0) [1] "double" > typeof(-0) [1] "double" >
>>     >> identical(0, -0) [1] TRUE
>>     >> 
>>     >> Best, Giovanni
>>
>>     > But 0.0 and -0.0 have different reciprocals
>>
>>     >> 1.0/0.0
>>     >    [1] Inf
>>     >> 1.0/-0.0
>>     >    [1] -Inf
>>
>>     > Bill Dunlap TIBCO Software Inc - Spotfire Division wdunlap
>>     > tibco.com
>>
>> yes.  {finally something interesting in this boring thread !}
>> ---> diverting to R-devel
>>
>> In April, I've had a private e-mail communication with John
>> Chambers [father of S, notably S4, which also brought identical()]
>> and Bill about the topic,
>> where I had started suggesting that  R  should be changed such
>> that
>>     identical(-0. , +0.)
>> would return FALSE.
>> Bill did mention that it does so for (newish versions of) S+
>> and that he'd prefer that, too,
>> and John said
>>
>>  >> I agree on having a preference for a bitwise comparison for
>>  >> identical()---that's what the name means after all.  But since
>>  >> someone implemented the numerical case as the C == it's probably
>>  >> going to be more hassle than it's worth to change it.  But we
>>  >> should make the implementation clear in the documentation.
>>
>> so in principle, we all agreed that R's identical() should be
>> changed here, namely by using something like  memcmp() instead
>> of simple '==' ,  however we haven't bothered to actually 
>> *implement* this change.
>>
>> I am currently testing a patch  which would lead to
>> identical(0, -0)  return FALSE.
>>   
> I don't think that would be a good idea.  Other expressions besides
> "-0" 
> calculate the zero with the negative sign bit, e.g. the following
> sequence:
> 
> pos <- 1
> neg <- -1
> zero <- 0
> y <- zero*pos
> z <- zero*neg
> identical(y, z)
> 
> I think most R users would expect the last expression there to be
> TRUE based on the previous two lines, given that pos and neg both
> have finite values. In a simple case like this y == z would be a
> better test to use, but if those were components of a larger
> structure, identical() is all we've got, and people would waste a
> lot of time tracking down why structures differing only in the
> sign of zero were not identical, even though every element tested
> equal.
> 
> Duncan Murdoch
>> Martin Maechler, ETH Zurich

My own view of this is that there may in certain cirumstances be an
interest in distinguishing between 0 and (-0), yet normally most
users will simply want to compare the numerical values.

Therefore I am in favour of revising identical() so that it can so
distinguish; but also of taking the opportunity to give it a parameter
say

  identical(x,y,sign.bit=FALSE)

so that the default behaviour would be to see 0 and (-0) as identical,
but with sign.bit=TRUE it would see the difference.

However, I put this forward in ignorance of
a) Any difficulties that this may present in re-coding identical();
b) Any complications that may arise when applying this new form
   to complex objects.

Ted.

--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 07-Aug-09                                       Time: 14:49:51
------------------------------ XFMail ------------------------------


From murdoch at stats.uwo.ca  Fri Aug  7 16:17:21 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Aug 2009 10:17:21 -0400
Subject: [Rd] Changing the compiler gfortran to ifort
In-Reply-To: <813414.13125.qm@web59716.mail.ac4.yahoo.com>
References: <813414.13125.qm@web59716.mail.ac4.yahoo.com>
Message-ID: <4A7C3771.6070902@stats.uwo.ca>

On 8/7/2009 9:43 AM, Fabio Mathias Corr?a wrote:
> I tried the manual R Installation and Administration to change the gcc compiler to icc and ifort for gfotran. However I could not find the correct path for the R to identify the icc and ifort.
> In which file I define the change of compiler?

That depends on the platform.  In Windows, the file to edit is 
src/gnuwin32/MkRules, where you would need to change the F77 and FLIBS 
definitions (and perhaps others).  Notice that this is not in the 
"user-customizable" section, so if you do this, you may be on your own 
to track down the problems it causes.  (Revolution Computing has changed 
compilers successfully, and they might be able to help you, or may 
already have done what you are thinking of doing.)

Other platforms use configure scripts to set all of these things; 
running ./configure --help in the home directory will tell you lots of 
options and environment variables to play with.

Duncan Murdoch

> 
> Thanks very much!!!
> 
>          F?bio Mathias Corr?a
> Estat?stica e Experimenta??o Agropecu?ria/UFLA
>                 Brazil
> 
> 
>       ____________________________________________________________________________________
> Veja quais s?o os assuntos do momento no Yahoo! +Buscados
> http://br.maisbuscados.yahoo.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Fri Aug  7 16:42:24 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 7 Aug 2009 15:42:24 +0100 (BST)
Subject: [Rd] options( "menu" )
In-Reply-To: <4A7BF506.60302@dbmail.com>
References: <4A7BF506.60302@dbmail.com>
Message-ID: <alpine.LFD.2.00.0908071541331.23986@gannet.stats.ox.ac.uk>

There are plans for more wide-ranging GUI hooks, so please be patient.
(They are likely to make 2.10.0.)

On Fri, 7 Aug 2009, Romain Francois wrote:

> Hello,
>
> The current implementation of the menu function (in utils) makes it difficult 
> for front-ends to hook in and propose an alternative display.
>
> Can there be something like options( "menu" ) to give control over it in case 
> graphics = TRUE. The default could be then be factored out of the current 
> menu :
>
> default.menu <- function( choices, multiple = FALSE, title ){
> 	if(.Platform$OS.type == "windows" || .Platform$GUI == "AQUA") {
>            res <- select.list(choices = choices, multiple=multiple, 
> title=title)
>            return(match(res, choices, nomatch = 0L))
>        } else if(.Platform$OS.type == "unix"
>                && capabilities("tcltk") && capabilities("X11")
>                && nzchar(Sys.getenv("DISPLAY"))) {
>            res <- tcltk::tk_select.list(choices, multiple=multiple, 
> title=title)
>            return(match(res, choices, nomatch = 0L))
>        }
> options( menu = default.menu )
>
> ... or maybe this should be done at the select.list level
>
> Romain
>
> -- 
> Romain Francois
> Professional R Enthusiast
> +33(0) 6 28 91 30 30
> http://romainfrancois.blog.free.fr
> |- http://tr.im/vzip : Code Snippet : List of CRAN packages
> |- http://tr.im/vsK1 : R parser package on CRAN
> `- http://tr.im/vshK : Transfer files through Rserve
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Fri Aug  7 16:46:23 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 7 Aug 2009 16:46:23 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <XFMail.090807144954.Ted.Harding@manchester.ac.uk>
References: <4A7C0ADC.8020105@stats.uwo.ca>
	<XFMail.090807144954.Ted.Harding@manchester.ac.uk>
Message-ID: <19068.15935.722489.739608@stat.math.ethz.ch>

>>>>> "TH" == Ted Harding <Ted.Harding at manchester.ac.uk>
>>>>>     on Fri, 07 Aug 2009 14:49:54 +0100 (BST) writes:

    TH> On 07-Aug-09 11:07:08, Duncan Murdoch wrote:
    >> Martin Maechler wrote:
    >>>>>>>> William Dunlap <wdunlap at tibco.com>
    >>>>>>>> on Thu, 6 Aug 2009 15:06:08 -0700 writes:
    >>> >> -----Original Message----- From:
    >>> >> r-help-bounces at r-project.org
    >>> >> [mailto:r-help-bounces at r-project.org] On Behalf Of
    >>> >> Giovanni Petris Sent: Thursday, August 06, 2009 3:00 PM
    >>> >> To: milton.ruser at gmail.com Cc: r-help at r-project.org;
    >>> >> Daniel.Gerlanc at geodecapital.com Subject: Re: [R] Why is 0
    >>> >> not an integer?
    >>> >> 
    >>> >> 
    >>> >> I ran an instant experiment...
    >>> >> 
    >>> >> > typeof(0) [1] "double" > typeof(-0) [1] "double" >
    >>> >> identical(0, -0) [1] TRUE
    >>> >> 
    >>> >> Best, Giovanni
    >>> 
    >>> > But 0.0 and -0.0 have different reciprocals
    >>> 
    >>> >> 1.0/0.0
    >>> >    [1] Inf
    >>> >> 1.0/-0.0
    >>> >    [1] -Inf
    >>> 
    >>> > Bill Dunlap TIBCO Software Inc - Spotfire Division wdunlap
    >>> > tibco.com
    >>> 
    >>> yes.  {finally something interesting in this boring thread !}
    ---> diverting to R-devel
    >>> 
    >>> In April, I've had a private e-mail communication with John
    >>> Chambers [father of S, notably S4, which also brought identical()]
    >>> and Bill about the topic,
    >>> where I had started suggesting that  R  should be changed such
    >>> that
    >>> identical(-0. , +0.)
    >>> would return FALSE.
    >>> Bill did mention that it does so for (newish versions of) S+
    >>> and that he'd prefer that, too,
    >>> and John said
    >>> 
    >>> >> I agree on having a preference for a bitwise comparison for
    >>> >> identical()---that's what the name means after all.  But since
    >>> >> someone implemented the numerical case as the C == it's probably
    >>> >> going to be more hassle than it's worth to change it.  But we
    >>> >> should make the implementation clear in the documentation.
    >>> 
    >>> so in principle, we all agreed that R's identical() should be
    >>> changed here, namely by using something like  memcmp() instead
    >>> of simple '==' ,  however we haven't bothered to actually 
    >>> *implement* this change.
    >>> 
    >>> I am currently testing a patch  which would lead to
    >>> identical(0, -0)  return FALSE.
    >>> 
    >> I don't think that would be a good idea.  Other expressions besides
    >> "-0" 
    >> calculate the zero with the negative sign bit, e.g. the following
    >> sequence:
    >> 
    >> pos <- 1
    >> neg <- -1
    >> zero <- 0
    >> y <- zero*pos
    >> z <- zero*neg
    >> identical(y, z)
    >> 
    >> I think most R users would expect the last expression there to be
    >> TRUE based on the previous two lines, given that pos and neg both
    >> have finite values. In a simple case like this y == z would be a
    >> better test to use, but if those were components of a larger
    >> structure, identical() is all we've got, and people would waste a
    >> lot of time tracking down why structures differing only in the
    >> sign of zero were not identical, even though every element tested
    >> equal.

identical()  *is* not the same as '=='  even if you think of a
generalized '==',
and your example is not convincing to me.

Further note that help(identical)  has always said

 > Description:

 >    The safe and reliable way to test two objects for being _exactly_
 >    equal.  It returns 'TRUE' in this case, 'FALSE' in every other case.

which really should distinguish  -0 and +0


    >> Duncan Murdoch
    >>> Martin Maechler, ETH Zurich

    TH> My own view of this is that there may in certain cirumstances be an
    TH> interest in distinguishing between 0 and (-0), yet normally most
    TH> users will simply want to compare the numerical values.

    TH> Therefore I am in favour of revising identical() so that it can so
    TH> distinguish; but also of taking the opportunity to give it a parameter
    TH> say

    TH> identical(x,y,sign.bit=FALSE)

    TH> so that the default behaviour would be to see 0 and (-0) as identical,
    TH> but with sign.bit=TRUE it would see the difference.

    TH> However, I put this forward in ignorance of
    TH> a) Any difficulties that this may present in re-coding identical();
    TH> b) Any complications that may arise when applying this new form
    TH> to complex objects.

Your proposal would actually need to special case this one case,
rather than my patch  which  replaces  using  '=='   (in C) for
double by using  memcmp() instead,  something which is already
used for several other cases there, and hence seems more
consequent and in that way natural.

The one thing even the new code would not differentiate is the
different  NaN's (apart from NA) but they are not differentiable
on the R level either, AFAIK, at least AFAIU our language
specifications, we only want two things: NA and NaN

Martin


From murdoch at stats.uwo.ca  Fri Aug  7 17:25:11 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Aug 2009 11:25:11 -0400
Subject: [Rd] identical(0, -0)
In-Reply-To: <19068.15935.722489.739608@stat.math.ethz.ch>
References: <4A7C0ADC.8020105@stats.uwo.ca>	<XFMail.090807144954.Ted.Harding@manchester.ac.uk>
	<19068.15935.722489.739608@stat.math.ethz.ch>
Message-ID: <4A7C4757.7030909@stats.uwo.ca>

On 8/7/2009 10:46 AM, Martin Maechler wrote:
>>>>>> "TH" == Ted Harding <Ted.Harding at manchester.ac.uk>
>>>>>>     on Fri, 07 Aug 2009 14:49:54 +0100 (BST) writes:
> 
>     TH> On 07-Aug-09 11:07:08, Duncan Murdoch wrote:
>     >> Martin Maechler wrote:
>     >>>>>>>> William Dunlap <wdunlap at tibco.com>
>     >>>>>>>> on Thu, 6 Aug 2009 15:06:08 -0700 writes:
>     >>> >> -----Original Message----- From:
>     >>> >> r-help-bounces at r-project.org
>     >>> >> [mailto:r-help-bounces at r-project.org] On Behalf Of
>     >>> >> Giovanni Petris Sent: Thursday, August 06, 2009 3:00 PM
>     >>> >> To: milton.ruser at gmail.com Cc: r-help at r-project.org;
>     >>> >> Daniel.Gerlanc at geodecapital.com Subject: Re: [R] Why is 0
>     >>> >> not an integer?
>     >>> >> 
>     >>> >> 
>     >>> >> I ran an instant experiment...
>     >>> >> 
>     >>> >> > typeof(0) [1] "double" > typeof(-0) [1] "double" >
>     >>> >> identical(0, -0) [1] TRUE
>     >>> >> 
>     >>> >> Best, Giovanni
>     >>> 
>     >>> > But 0.0 and -0.0 have different reciprocals
>     >>> 
>     >>> >> 1.0/0.0
>     >>> >    [1] Inf
>     >>> >> 1.0/-0.0
>     >>> >    [1] -Inf
>     >>> 
>     >>> > Bill Dunlap TIBCO Software Inc - Spotfire Division wdunlap
>     >>> > tibco.com
>     >>> 
>     >>> yes.  {finally something interesting in this boring thread !}
>     ---> diverting to R-devel
>     >>> 
>     >>> In April, I've had a private e-mail communication with John
>     >>> Chambers [father of S, notably S4, which also brought identical()]
>     >>> and Bill about the topic,
>     >>> where I had started suggesting that  R  should be changed such
>     >>> that
>     >>> identical(-0. , +0.)
>     >>> would return FALSE.
>     >>> Bill did mention that it does so for (newish versions of) S+
>     >>> and that he'd prefer that, too,
>     >>> and John said
>     >>> 
>     >>> >> I agree on having a preference for a bitwise comparison for
>     >>> >> identical()---that's what the name means after all.  But since
>     >>> >> someone implemented the numerical case as the C == it's probably
>     >>> >> going to be more hassle than it's worth to change it.  But we
>     >>> >> should make the implementation clear in the documentation.
>     >>> 
>     >>> so in principle, we all agreed that R's identical() should be
>     >>> changed here, namely by using something like  memcmp() instead
>     >>> of simple '==' ,  however we haven't bothered to actually 
>     >>> *implement* this change.
>     >>> 
>     >>> I am currently testing a patch  which would lead to
>     >>> identical(0, -0)  return FALSE.
>     >>> 
>     >> I don't think that would be a good idea.  Other expressions besides
>     >> "-0" 
>     >> calculate the zero with the negative sign bit, e.g. the following
>     >> sequence:
>     >> 
>     >> pos <- 1
>     >> neg <- -1
>     >> zero <- 0
>     >> y <- zero*pos
>     >> z <- zero*neg
>     >> identical(y, z)
>     >> 
>     >> I think most R users would expect the last expression there to be
>     >> TRUE based on the previous two lines, given that pos and neg both
>     >> have finite values. In a simple case like this y == z would be a
>     >> better test to use, but if those were components of a larger
>     >> structure, identical() is all we've got, and people would waste a
>     >> lot of time tracking down why structures differing only in the
>     >> sign of zero were not identical, even though every element tested
>     >> equal.
> 
> identical()  *is* not the same as '=='  even if you think of a
> generalized '==',
> and your example is not convincing to me.

Fair enough, but after your change, how would one do what 
identical(list(pos, neg, zero, y), list(pos, neg, zero, z)) does now? 
That seems to me to be a more useful comparison than one that declares 
those to be unequal because the signs of y and z differ.

> 
> Further note that help(identical)  has always said
> 
>  > Description:
> 
>  >    The safe and reliable way to test two objects for being _exactly_
>  >    equal.  It returns 'TRUE' in this case, 'FALSE' in every other case.
> 
> which really should distinguish  -0 and +0
> 
> 
>     >> Duncan Murdoch
>     >>> Martin Maechler, ETH Zurich
> 
>     TH> My own view of this is that there may in certain cirumstances be an
>     TH> interest in distinguishing between 0 and (-0), yet normally most
>     TH> users will simply want to compare the numerical values.
> 
>     TH> Therefore I am in favour of revising identical() so that it can so
>     TH> distinguish; but also of taking the opportunity to give it a parameter
>     TH> say
> 
>     TH> identical(x,y,sign.bit=FALSE)
> 
>     TH> so that the default behaviour would be to see 0 and (-0) as identical,
>     TH> but with sign.bit=TRUE it would see the difference.
> 
>     TH> However, I put this forward in ignorance of
>     TH> a) Any difficulties that this may present in re-coding identical();
>     TH> b) Any complications that may arise when applying this new form
>     TH> to complex objects.
> 
> Your proposal would actually need to special case this one case,
> rather than my patch  which  replaces  using  '=='   (in C) for
> double by using  memcmp() instead,  something which is already
> used for several other cases there, and hence seems more
> consequent and in that way natural.
> 
> The one thing even the new code would not differentiate is the
> different  NaN's (apart from NA) but they are not differentiable
> on the R level either, AFAIK, at least AFAIU our language
> specifications, we only want two things: NA and NaN

I don't understand what you are proposing now.  The different NaN's have 
different bit patterns, so wouldn't memcmp() see a difference?  And 
taking your literalist point of view, the fact that it is hard to detect 
the difference at the R level (requiring C code support to do it) 
doesn't mean there is no difference, there's just a very subtle, rarely 
detectable difference, like the one between +0 and -0.

Duncan Murdoch

> 
> Martin
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Fri Aug  7 17:41:08 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 7 Aug 2009 17:41:08 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <4A7C4757.7030909@stats.uwo.ca>
References: <4A7C0ADC.8020105@stats.uwo.ca>
	<XFMail.090807144954.Ted.Harding@manchester.ac.uk>
	<19068.15935.722489.739608@stat.math.ethz.ch>
	<4A7C4757.7030909@stats.uwo.ca>
Message-ID: <19068.19220.371101.466743@stat.math.ethz.ch>

>>>>> "DM" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>     on Fri, 07 Aug 2009 11:25:11 -0400 writes:

    DM> On 8/7/2009 10:46 AM, Martin Maechler wrote:
    >>>>>>> "TH" == Ted Harding <Ted.Harding at manchester.ac.uk>
    >>>>>>> on Fri, 07 Aug 2009 14:49:54 +0100 (BST) writes:
    >> 
    TH> On 07-Aug-09 11:07:08, Duncan Murdoch wrote:
    >> >> Martin Maechler wrote:
    >> >>>>>>>> William Dunlap <wdunlap at tibco.com>
    >> >>>>>>>> on Thu, 6 Aug 2009 15:06:08 -0700 writes:
    >> >>> >> -----Original Message----- From:
    >> >>> >> r-help-bounces at r-project.org
    >> >>> >> [mailto:r-help-bounces at r-project.org] On Behalf Of
    >> >>> >> Giovanni Petris Sent: Thursday, August 06, 2009 3:00 PM
    >> >>> >> To: milton.ruser at gmail.com Cc: r-help at r-project.org;
    >> >>> >> Daniel.Gerlanc at geodecapital.com Subject: Re: [R] Why is 0
    >> >>> >> not an integer?
    >> >>> >> 
    >> >>> >> 
    >> >>> >> I ran an instant experiment...
    >> >>> >> 
    >> >>> >> > typeof(0) [1] "double" > typeof(-0) [1] "double" >
    >> >>> >> identical(0, -0) [1] TRUE
    >> >>> >> 
    >> >>> >> Best, Giovanni
    >> >>> 
    >> >>> > But 0.0 and -0.0 have different reciprocals
    >> >>> 
    >> >>> >> 1.0/0.0
    >> >>> >    [1] Inf
    >> >>> >> 1.0/-0.0
    >> >>> >    [1] -Inf
    >> >>> 
    >> >>> > Bill Dunlap TIBCO Software Inc - Spotfire Division wdunlap
    >> >>> > tibco.com
    >> >>> 
    >> >>> yes.  {finally something interesting in this boring thread !}
    ---> diverting to R-devel
    >> >>> 
    >> >>> In April, I've had a private e-mail communication with John
    >> >>> Chambers [father of S, notably S4, which also brought identical()]
    >> >>> and Bill about the topic,
    >> >>> where I had started suggesting that  R  should be changed such
    >> >>> that
    >> >>> identical(-0. , +0.)
    >> >>> would return FALSE.
    >> >>> Bill did mention that it does so for (newish versions of) S+
    >> >>> and that he'd prefer that, too,
    >> >>> and John said
    >> >>> 
    >> >>> >> I agree on having a preference for a bitwise comparison for
    >> >>> >> identical()---that's what the name means after all.  But since
    >> >>> >> someone implemented the numerical case as the C == it's probably
    >> >>> >> going to be more hassle than it's worth to change it.  But we
    >> >>> >> should make the implementation clear in the documentation.
    >> >>> 
    >> >>> so in principle, we all agreed that R's identical() should be
    >> >>> changed here, namely by using something like  memcmp() instead
    >> >>> of simple '==' ,  however we haven't bothered to actually 
    >> >>> *implement* this change.
    >> >>> 
    >> >>> I am currently testing a patch  which would lead to
    >> >>> identical(0, -0)  return FALSE.
    >> >>> 
    >> >> I don't think that would be a good idea.  Other expressions besides
    >> >> "-0" 
    >> >> calculate the zero with the negative sign bit, e.g. the following
    >> >> sequence:
    >> >> 
    >> >> pos <- 1
    >> >> neg <- -1
    >> >> zero <- 0
    >> >> y <- zero*pos
    >> >> z <- zero*neg
    >> >> identical(y, z)
    >> >> 
    >> >> I think most R users would expect the last expression there to be
    >> >> TRUE based on the previous two lines, given that pos and neg both
    >> >> have finite values. In a simple case like this y == z would be a
    >> >> better test to use, but if those were components of a larger
    >> >> structure, identical() is all we've got, and people would waste a
    >> >> lot of time tracking down why structures differing only in the
    >> >> sign of zero were not identical, even though every element tested
    >> >> equal.
    >> 
    >> identical()  *is* not the same as '=='  even if you think of a
    >> generalized '==',
    >> and your example is not convincing to me.

    DM> Fair enough, but after your change, how would one do what 
    DM> identical(list(pos, neg, zero, y), list(pos, neg, zero, z)) does now? 
    DM> That seems to me to be a more useful comparison than one that declares 
    DM> those to be unequal because the signs of y and z differ.

Maybe something like

all(mapply(`==`,  list(pos, neg, zero, y), list(pos, neg, zero, z)))

## or even

isTRUE(all.equal( list(pos, neg, zero, y), list(pos, neg, zero, z),
                 tol = 0))

the latter of which is more flexible adaptable at what the user
is really wanting to test.

    >> Further note that help(identical)  has always said
    >> 
    >> > Description:
    >> 
    >> >    The safe and reliable way to test two objects for being _exactly_
    >> >    equal.  It returns 'TRUE' in this case, 'FALSE' in every other case.
    >> 
    >> which really should distinguish  -0 and +0
    >> 
    >> 
    >> >> Duncan Murdoch
    >> >>> Martin Maechler, ETH Zurich
    >> 
    TH> My own view of this is that there may in certain cirumstances be an
    TH> interest in distinguishing between 0 and (-0), yet normally most
    TH> users will simply want to compare the numerical values.
    >> 
    TH> Therefore I am in favour of revising identical() so that it can so
    TH> distinguish; but also of taking the opportunity to give it a parameter
    TH> say
    >> 
    TH> identical(x,y,sign.bit=FALSE)
    >> 
    TH> so that the default behaviour would be to see 0 and (-0) as identical,
    TH> but with sign.bit=TRUE it would see the difference.
    >> 
    TH> However, I put this forward in ignorance of
    TH> a) Any difficulties that this may present in re-coding identical();
    TH> b) Any complications that may arise when applying this new form
    TH> to complex objects.
    >> 
    >> Your proposal would actually need to special case this one case,
    >> rather than my patch  which  replaces  using  '=='   (in C) for
    >> double by using  memcmp() instead,  something which is already
    >> used for several other cases there, and hence seems more
    >> consequent and in that way natural.
    >> 
    >> The one thing even the new code would not differentiate is the
    >> different  NaN's (apart from NA) but they are not differentiable
    >> on the R level either, AFAIK, at least AFAIU our language
    >> specifications, we only want two things: NA and NaN

    DM> I don't understand what you are proposing now.  The different NaN's have 
    DM> different bit patterns, so wouldn't memcmp() see a difference?  And 
    DM> taking your literalist point of view, the fact that it is hard to detect 
    DM> the difference at the R level (requiring C code support to do it) 
    DM> doesn't mean there is no difference, there's just a very subtle, rarely 
    DM> detectable difference, like the one between +0 and -0.

    DM> Duncan Murdoch

    >> 
    >> Martin
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Fri Aug  7 18:55:50 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Aug 2009 12:55:50 -0400
Subject: [Rd] identical(0, -0)
In-Reply-To: <19068.19220.371101.466743@stat.math.ethz.ch>
References: <4A7C0ADC.8020105@stats.uwo.ca>	<XFMail.090807144954.Ted.Harding@manchester.ac.uk>	<19068.15935.722489.739608@stat.math.ethz.ch>	<4A7C4757.7030909@stats.uwo.ca>
	<19068.19220.371101.466743@stat.math.ethz.ch>
Message-ID: <4A7C5C96.8010709@stats.uwo.ca>

On 8/7/2009 11:41 AM, Martin Maechler wrote:
>>>>>> "DM" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>     on Fri, 07 Aug 2009 11:25:11 -0400 writes:
> 
>     DM> On 8/7/2009 10:46 AM, Martin Maechler wrote:
>     >>>>>>> "TH" == Ted Harding <Ted.Harding at manchester.ac.uk>
>     >>>>>>> on Fri, 07 Aug 2009 14:49:54 +0100 (BST) writes:
>     >> 
>     TH> On 07-Aug-09 11:07:08, Duncan Murdoch wrote:
>     >> >> Martin Maechler wrote:
>     >> >>>>>>>> William Dunlap <wdunlap at tibco.com>
>     >> >>>>>>>> on Thu, 6 Aug 2009 15:06:08 -0700 writes:
>     >> >>> >> -----Original Message----- From:
>     >> >>> >> r-help-bounces at r-project.org
>     >> >>> >> [mailto:r-help-bounces at r-project.org] On Behalf Of
>     >> >>> >> Giovanni Petris Sent: Thursday, August 06, 2009 3:00 PM
>     >> >>> >> To: milton.ruser at gmail.com Cc: r-help at r-project.org;
>     >> >>> >> Daniel.Gerlanc at geodecapital.com Subject: Re: [R] Why is 0
>     >> >>> >> not an integer?
>     >> >>> >> 
>     >> >>> >> 
>     >> >>> >> I ran an instant experiment...
>     >> >>> >> 
>     >> >>> >> > typeof(0) [1] "double" > typeof(-0) [1] "double" >
>     >> >>> >> identical(0, -0) [1] TRUE
>     >> >>> >> 
>     >> >>> >> Best, Giovanni
>     >> >>> 
>     >> >>> > But 0.0 and -0.0 have different reciprocals
>     >> >>> 
>     >> >>> >> 1.0/0.0
>     >> >>> >    [1] Inf
>     >> >>> >> 1.0/-0.0
>     >> >>> >    [1] -Inf
>     >> >>> 
>     >> >>> > Bill Dunlap TIBCO Software Inc - Spotfire Division wdunlap
>     >> >>> > tibco.com
>     >> >>> 
>     >> >>> yes.  {finally something interesting in this boring thread !}
>     ---> diverting to R-devel
>     >> >>> 
>     >> >>> In April, I've had a private e-mail communication with John
>     >> >>> Chambers [father of S, notably S4, which also brought identical()]
>     >> >>> and Bill about the topic,
>     >> >>> where I had started suggesting that  R  should be changed such
>     >> >>> that
>     >> >>> identical(-0. , +0.)
>     >> >>> would return FALSE.
>     >> >>> Bill did mention that it does so for (newish versions of) S+
>     >> >>> and that he'd prefer that, too,
>     >> >>> and John said
>     >> >>> 
>     >> >>> >> I agree on having a preference for a bitwise comparison for
>     >> >>> >> identical()---that's what the name means after all.  But since
>     >> >>> >> someone implemented the numerical case as the C == it's probably
>     >> >>> >> going to be more hassle than it's worth to change it.  But we
>     >> >>> >> should make the implementation clear in the documentation.
>     >> >>> 
>     >> >>> so in principle, we all agreed that R's identical() should be
>     >> >>> changed here, namely by using something like  memcmp() instead
>     >> >>> of simple '==' ,  however we haven't bothered to actually 
>     >> >>> *implement* this change.
>     >> >>> 
>     >> >>> I am currently testing a patch  which would lead to
>     >> >>> identical(0, -0)  return FALSE.
>     >> >>> 
>     >> >> I don't think that would be a good idea.  Other expressions besides
>     >> >> "-0" 
>     >> >> calculate the zero with the negative sign bit, e.g. the following
>     >> >> sequence:
>     >> >> 
>     >> >> pos <- 1
>     >> >> neg <- -1
>     >> >> zero <- 0
>     >> >> y <- zero*pos
>     >> >> z <- zero*neg
>     >> >> identical(y, z)
>     >> >> 
>     >> >> I think most R users would expect the last expression there to be
>     >> >> TRUE based on the previous two lines, given that pos and neg both
>     >> >> have finite values. In a simple case like this y == z would be a
>     >> >> better test to use, but if those were components of a larger
>     >> >> structure, identical() is all we've got, and people would waste a
>     >> >> lot of time tracking down why structures differing only in the
>     >> >> sign of zero were not identical, even though every element tested
>     >> >> equal.
>     >> 
>     >> identical()  *is* not the same as '=='  even if you think of a
>     >> generalized '==',
>     >> and your example is not convincing to me.
> 
>     DM> Fair enough, but after your change, how would one do what 
>     DM> identical(list(pos, neg, zero, y), list(pos, neg, zero, z)) does now? 
>     DM> That seems to me to be a more useful comparison than one that declares 
>     DM> those to be unequal because the signs of y and z differ.
> 
> Maybe something like
> 
> all(mapply(`==`,  list(pos, neg, zero, y), list(pos, neg, zero, z)))
> 
> ## or even
> 
> isTRUE(all.equal( list(pos, neg, zero, y), list(pos, neg, zero, z),
>                  tol = 0))

I think I didn't make my point clearly.  I'm not particularly worried 
about lists of numbers, I'm worried about signed zeros buried in complex 
structures.  identical(struc1, struc2) works nicely now for that sort of 
comparison; indeed the man page for it says:

      A call to 'identical' is the way to test exact equality in 'if'
      and 'while' statements, as well as in logical expressions that use
      '&&' or '||'.  In all these applications you need to be assured of
      getting a single logical value.

The description you quote below does contradict this, and it also 
contradicts the statement

      'identical' sees 'NaN' as different from 'NA_real_', but all
      'NaN's are equal (and all 'NA' of the same type are equal).

I think the solution is to fix the man page, not the function.  For 
example, the "_exactly_" seems to be what is upsetting you; I'd suggest 
instead

"The safe and reliable way to test two objects for being equal in 
structure and content.  It returns 'TRUE' in this case, 'FALSE' in every 
other case."

Duncan Murdoch


> 
> the latter of which is more flexible adaptable at what the user
> is really wanting to test.
> 
>     >> Further note that help(identical)  has always said
>     >> 
>     >> > Description:
>     >> 
>     >> >    The safe and reliable way to test two objects for being _exactly_
>     >> >    equal.  It returns 'TRUE' in this case, 'FALSE' in every other case.
>     >> 
>     >> which really should distinguish  -0 and +0
>     >> 
>     >> 
>     >> >> Duncan Murdoch
>     >> >>> Martin Maechler, ETH Zurich
>     >> 
>     TH> My own view of this is that there may in certain cirumstances be an
>     TH> interest in distinguishing between 0 and (-0), yet normally most
>     TH> users will simply want to compare the numerical values.
>     >> 
>     TH> Therefore I am in favour of revising identical() so that it can so
>     TH> distinguish; but also of taking the opportunity to give it a parameter
>     TH> say
>     >> 
>     TH> identical(x,y,sign.bit=FALSE)
>     >> 
>     TH> so that the default behaviour would be to see 0 and (-0) as identical,
>     TH> but with sign.bit=TRUE it would see the difference.
>     >> 
>     TH> However, I put this forward in ignorance of
>     TH> a) Any difficulties that this may present in re-coding identical();
>     TH> b) Any complications that may arise when applying this new form
>     TH> to complex objects.
>     >> 
>     >> Your proposal would actually need to special case this one case,
>     >> rather than my patch  which  replaces  using  '=='   (in C) for
>     >> double by using  memcmp() instead,  something which is already
>     >> used for several other cases there, and hence seems more
>     >> consequent and in that way natural.
>     >> 
>     >> The one thing even the new code would not differentiate is the
>     >> different  NaN's (apart from NA) but they are not differentiable
>     >> on the R level either, AFAIK, at least AFAIU our language
>     >> specifications, we only want two things: NA and NaN
> 
>     DM> I don't understand what you are proposing now.  The different NaN's have 
>     DM> different bit patterns, so wouldn't memcmp() see a difference?  And 
>     DM> taking your literalist point of view, the fact that it is hard to detect 
>     DM> the difference at the R level (requiring C code support to do it) 
>     DM> doesn't mean there is no difference, there's just a very subtle, rarely 
>     DM> detectable difference, like the one between +0 and -0.
> 
>     DM> Duncan Murdoch
> 
>     >> 
>     >> Martin
>     >> 
>     >> ______________________________________________
>     >> R-devel at r-project.org mailing list
>     >> https://stat.ethz.ch/mailman/listinfo/r-devel


From adik at ilovebacon.org  Fri Aug  7 20:10:16 2009
From: adik at ilovebacon.org (adik at ilovebacon.org)
Date: Fri,  7 Aug 2009 20:10:16 +0200 (CEST)
Subject: [Rd] Bug in nlm, found using sem;
	failure in several flavors (PR#13881)
Message-ID: <20090807181017.540BD282EF29@mail.pubhealth.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--1660387551-1458482416-1249639718=:2997
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII; FORMAT=flowed
Content-ID: <Pine.LNX.4.64.0908071039211.2997 at parser.ilovebacon.org>

Hello,

 	There appears to be a bug in the nlm function, which I discovered
when trying to run an SEM.  The SEM is not bizarre; the covariance matrix is
solve-able and the eigenvalues are greater than zero, and I do not believe
the "sem" package per se to be the problem (as nlm keeps being the part that
fails, though I can't replicate this with other nlm tasks).  I apologize if
I have put too many much information in this message; I'm not a programmer
by trade so I don't really know what's going on here, which hampers my
ability to write consise bug reports.

Here is the code I use:

library(sem)
ice.S <- read.csv("iceS.csv") # attached
rownames(ice.S) <- ice.S[,1]
ice.S[,1] <- NULL
ice.S <- as.matrix(ice.S)
ice.ram <- specify.model("ice.ram") # attached
ice.N <- 342
ice.sem <- sem(ram=ice.ram, S=ice.S, N=ice.N)

...at this point, any number of problems could occur. I have seen the
following.

1) Simple lack of convergence. (might be my model's fault.)
2) Error in nlm(if (analytic.gradient) objective.2 else objective.1, start,
:
   type 31 is unimplemented in 'type2char'
3)  *** caught segfault ***
address 0xc019c87b, cause 'memory not mapped'

Traceback:
  1: nlm(if (analytic.gradient) objective.2 else objective.1, start,
hessian = TRUE, iterlim = maxiter, print.level = if (debug) 2 else 0,
typsize = typsize, ...)
  2: sem.default(ram = ram, S = S, N = N, param.names = pars, var.names =
vars,     fixed.x = fixed.x, debug = debug, ...)
  3: sem(ram = ram, S = S, N = N, param.names = pars, var.names = vars,
fixed.x = fixed.x, debug = debug, ...)
  4: sem.mod(ram = ice.ram, S = ice.S, N = ice.N)
  5: sem(ram = ice.ram, S = ice.S, N = ice.N)

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection: 1
aborting ...
Segmentation fault
swiss:data$

(no core was dumped).

Trying with debug mode provides other interesting errors:

> ice.sem <- sem(ram=ice.ram, S=ice.S, N=ice.N, debug=TRUE)

...gets up to some iteration (not always 15), and then R dies ungracefully,
and exits to the shell:

iteration = 15
Step:
  [1]  1.253132e-02  1.183343e-02 -7.651342e-03 -2.490800e-03  2.278938e-03
  [6]  3.197431e-04  6.137849e-04 -2.496882e-03 -1.065829e-03 -2.118179e-03
[11]  2.942936e-03 -1.335936e-03 -3.665618e-03  3.090566e-03  8.534956e-04
[16] -1.440421e-03 -5.230877e-04 -1.053686e-04 -9.771005e-04 -4.269216e-04
[21]  7.261694e-05 -1.039668e-03 -8.409151e-03 -3.497456e-03  2.216899e-03
[26] -4.633520e-03 -4.052130e-03 -4.746537e-03 -1.589622e-03 -2.523766e-04
Parameter:
  [1] -0.76604614 -1.19639662  0.83456888  0.72540413  0.08482452  0.56180393
  [7]  0.50615814  0.55728015  0.83796696  0.88371335 -0.70465116  0.85251098
[13] -0.18346956  0.66857787  0.57012481  0.39116561  0.91237990  0.63951482
[19]  0.26601566  0.29240836  0.44710919  0.94734056  6.52039015  0.02524762
[25] -0.01614603  2.88198219  0.03442452  3.52272237  1.44698423 -0.72964745
Function Value
[1] -15175.94
Gradient:
  [1] -2.085412e+07 -3.819717e+07  3.883989e+07  1.352594e+00 -4.283329e+00
  [6] -1.437250e+00 -6.558913e-01  1.358276e+00  7.930865e+05 -1.293853e+06
[11] -5.816627e+03  5.908197e+05 -2.705742e+08 -1.194400e+07 -4.007083e+07
[16] -4.143068e+07 -6.159782e-01  1.044274e-01 -8.591048e+00 -2.083471e+00
[21] -7.548753e-01 -5.418994e-01 -2.799228e+02 -1.321739e+07 -3.517728e+07
[26] -7.106654e+02 -7.335293e+06 -7.335285e+05  3.117764e-01 -2.234989e+04

Abort trap
swiss:data$

...I have also seen convergence reached, and nlm then die with this message:

Error in nlm(if (analytic.gradient) objective.2 else objective.1, start,
:
   type 27 is unimplemented in 'type2char'

(similar to above, but now referring to type 27)

I have shown this effect (or something similar...never know how it'll fail
next) on the following platforms:

> version
                _ 
platform       i386-apple-darwin9.7.0 
arch           i386 
os             darwin9.7.0 
system         i386, darwin9.7.0 
status 
major          2 
minor          9.1 
year           2009 
month          06 
day            26 
svn rev        48839 
language       R 
version.string R version 2.9.1 (2009-06-26)

> sessionInfo()
R version 2.9.1 (2009-06-26) 
i386-apple-darwin9.8.0

locale:
en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sem_0.9-17

loaded via a namespace (and not attached):
[1] tcltk_2.9.1 tools_2.9.1

(I admit to having compiled this version of R myself (to link to a
hand-compiled ATLAS), though no errors were thrown in the compilation stage. 
I compiled using this config string, at first...

./configure --prefix=/usr/local --with-x --disable-R-framework --enable-threads=posix --with-blas="/usr/local/lib/libptf77blas.a /usr/local/lib/libptcblas.a /usr/local/lib/libatlas.a -lpthread" --with-lapack="/usr/local/lib/liblapack.a /usr/local/lib/libptf77blas.a /usr/local/lib/libptcblas.a /usr/local/lib/libatlas.a -lpthread" --without-aqua CFLAGS="-O3 -mtune=nocona -m32" CXXFLAGS="-O3 -mtune=nocona -m32" FFLAGS="-O3 -mtune=nocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" F77FLAGS="-O3 -mtune=nocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" FCFLAGS="-O3 -mtune=nocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" LDFLAGS="-m32 -L/sw/lib" CPPFLAGS="-I/sw/include" CC=gcc-4.2 F77=gfortran-4.2 FC=gfortran-4.2 CXX=g++-4.2 OBJC=gcc-4.2

...though I have also recompiled using simply this:

./configure --prefix=/usr/local --with-x --disable-R-framework

...and then re-installed SEM, and I got a few other, different error
messages and core dumps, "including type 11 is unimplemented in 'type2char'"
and "cannot coerce type 'weakref' to vector of type 'double'".  Running with
debug=TRUE also segfaults sometimes, even after achieving "Current iterate
is probably solution" status.)

> version
                _ 
platform       x86_64-unknown-linux-gnu 
arch           x86_64 
os             linux-gnu 
system         x86_64, linux-gnu 
status 
major          2 
minor          9.1 
year           2009 
month          06 
day            26 
svn rev        48839 
language       R 
version.string R version 2.9.1 (2009-06-26)

> sessionInfo()
R version 2.9.1 (2009-06-26) 
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=C;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sem_0.9-17

...however, THIS platform does NOT show the bug:

> version
                _ 
platform       powerpc-unknown-linux-gnu 
arch           powerpc 
os             linux-gnu 
system         powerpc, linux-gnu 
status 
major          2 
minor          9.1 
year           2009 
month          06 
day            26 
svn rev        48839 
language       R 
version.string R version 2.9.1 (2009-06-26)
> sessionInfo()
R version 2.9.1 (2009-06-26) 
powerpc-unknown-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sem_0.9-17
>

...for this system, the model simply repeatedly fails to converge, whether
debug is set or not.

I have also tried altering my model. This has resulted in the same bugs, but
instead of "every so often simply not converging," it actually converges and
appears to be the model I asked R to solve...but this is rare.

Please let me know if I can provide any other info.

Cordially,
Adam D. I. Kramer
--1660387551-1458482416-1249639718=:2997
Content-Type: AUDIO/X-PN-REALAUDIO; NAME=ice.ram
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.64.0908070308380.2997 at parser.ilovebacon.org>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME=ice.ram

aW1wb3J0YW50IDwtLSBjaGFsbGVuZ2UsIE5BLCAxCmNvbXBsZXggIDwtLSBj
aGFsbGVuZ2UsIGMuY29tcGxleCwgTkEKZGlmZmljdWx0IDwtLSBjaGFsbGVu
Z2UsIGMuZGlmZmljdWx0LCBOQQptYW55ZGltZW5zaW9ucyA8LS0gY2hhbGxl
bmdlLCBjLm1hbnlkaW1lbnNpb25zLCBOQQpjb3VsZGF2b2lkIDwtLSBjaGFs
bGVuZ2UsIGMuY291bGRhdm9pZCwgTkEKb25seXNlbGYgPC0tIGNoYWxsZW5n
ZSwgYy5vbmx5c2VsZiwgTkEKCndhc3JpZ2h0Y2hvaWNlIDwtLSBldmFsLCBO
QSwgMQp0ZWxsZ29vZCA8LS0gZXZhbCwgZS50ZWxsZ29vZCwgTkEKdGVsbGJl
c3QgPC0tIGV2YWwsIGUudGVsbGJlc3QsIE5BCm5lZ291dGNvbWUgPC0tIGV2
YWwsIGUubmVnb3V0Y29tZSwgTkEKCmVxdWFsaW5mbyA8LS0gaW5mb3JtZWQs
IE5BLCAxCmNvbnRyb2wgPC0tIGluZm9ybWVkLCBpLmNvbnRyb2wsIE5BCmRl
c2lyZWQgPC0tIGluZm9ybWVkLCBpLmRlc2lyZWQsIE5BCmhvd211Y2hpbmZv
IDwtLSBpbmZvcm1lZCwgaS5ob3dtdWNoaW5mbywgTkEKcG9zb3V0Y29tZSA8
LS0gaW5mb3JtZWQsIGkucG9zb3V0Y29tZSwgTkEKCndhc3JpZ2h0Y2hvaWNl
IDwtPiB3YXNyaWdodGNob2ljZSwgd2FzcmlnaHRjaG9pY2VWLCBOQQp0ZWxs
Z29vZCA8LT4gdGVsbGdvb2QsIHRlbGxnb29kViwgTkEKdGVsbGJlc3QgPC0+
IHRlbGxiZXN0LCB0ZWxsYmVzdFYsIE5BCm5lZ291dGNvbWUgPC0+IG5lZ291
dGNvbWUsIG5lZ291dGNvbWVWLCBOQQoKb25seXNlbGYgPC0+IG9ubHlzZWxm
LCBvbmx5c2VsZlYsIE5BCmltcG9ydGFudCA8LT4gaW1wb3J0YW50LCBpbXBv
cnRhbnRWLCBOQQpjb21wbGV4IDwtPiBjb21wbGV4LCBjb21wbGV4ViwgTkEK
ZGlmZmljdWx0IDwtPiBkaWZmaWN1bHQsIGRpZmZpY3VsdFYsIE5BCm1hbnlk
aW1lbnNpb25zIDwtPiBtYW55ZGltZW5zaW9ucywgbWFueWRpbWVuc2lvbnNW
LCBOQQpjb3VsZGF2b2lkIDwtPiBjb3VsZGF2b2lkLCBjb3VsZGF2b2lkViwg
TkEKCmVxdWFsaW5mbyA8LT4gZXF1YWxpbmZvLCBlcXVhbGluZm9WLCBOQQpj
b250cm9sIDwtPiBjb250cm9sLCBjb250cm9sViwgTkEKZGVzaXJlZCA8LT4g
ZGVzaXJlZCwgZGVzaXJlZFYsIE5BCmhvd211Y2hpbmZvIDwtPiBob3dtdWNo
aW5mbywgaG93bXVjaGluZm9WLCBOQQpwb3NvdXRjb21lIDwtPiBwb3NvdXRj
b21lLCBwb3NvdXRjb21lViwgTkEKCmV2YWwgPC0+IGV2YWwsIGV2YWxWLCBO
QQpjaGFsbGVuZ2UgPC0+IGNoYWxsZW5nZSwgY2hhbGxlbmdlViwgTkEKaW5m
b3JtZWQgPC0+IGluZm9ybWVkLCBpbmZvcm1lZFYsIE5BCg==

--1660387551-1458482416-1249639718=:2997
Content-Type: TEXT/CSV; CHARSET=US-ASCII; NAME=iceS.csv
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.64.0908070308381.2997 at parser.ilovebacon.org>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME=iceS.csv

IiIsIndhc3JpZ2h0Y2hvaWNlIiwidGVsbGdvb2QiLCJ0ZWxsYmVzdCIsImlt
cG9ydGFudCIsImNvbXBsZXgiLCJkaWZmaWN1bHQiLCJvbmx5c2VsZiIsIm1h
bnlkaW1lbnNpb25zIiwiaG93bXVjaGluZm8iLCJlcXVhbGluZm8iLCJjb3Vs
ZGF2b2lkIiwicG9zb3V0Y29tZSIsIm5lZ291dGNvbWUiLCJjb250cm9sIiwi
ZGVzaXJlZCINCiJ3YXNyaWdodGNob2ljZSIsMC45NjM2OTc3MzE3ODk2Myww
LjI5MjczNjMyMTIyOTY0NywwLjI4OTg1MjgwODQ4OTExNywwLjM4NTI2Njk2
NTM2Mjc2MSwwLjE5NzY0NDgyNDY5NjMyMCwwLjE4MzA0MTMyNDA2MjI5OCwt
MC4xNDY2MjYzNDcyMTk4NzksMC4xNDYzNTQwMjc3OTcxMDEsLTAuMTMyODg3
NTk2OTAyNTA2LC0wLjE3Mzk2NTA2OTExMTAyNSwtMC4yNjg0NTkxNjI5MzA1
NjcsLTAuMDY3ODA5NTM3NTA3NjIyMiwwLjE4MDU0OTkyNTAyNDM3NywtMC4w
NDIwODQ0MzY0MDM3ODc0LC0wLjA3MzA1Nzc4OTY5MDI5NjcNCiJ0ZWxsZ29v
ZCIsMC4yOTI3MzYzMjEyMjk2NDcsMC45NTU0OTQyNDYyMTA4NTYsMC43NTc1
NDQxOTMzMzk1NjYsMC4xOTEyNDExODMyMDMxMjksMC4wMDAxNzQ2MzA0MTc1
NjQ2ODgsMC4wMDM0MDg4NzExODA3MTI4NywwLjAwOTYzMDUwNDc0MzU4MDM0
LDAuMDI4Mzg5NDM3MzMxNjY4NCwwLjAxODgwMjc1Mzk0NjMyOTksLTAuMDE1
NzAyNjM4MTUxNTk4NSwtMC4xNDU3OTUwMDY3NDE4ODQsMC4xNDIwMzQzOTY5
MDY4NzksMC4wMDk4MTUzODM5ODQzNDg1MSwwLjA3MDU4Njg3NTY1Mzk3MzIs
MC4xMDgwMDA0NDkzMjgzMTMNCiJ0ZWxsYmVzdCIsMC4yODk4NTI4MDg0ODkx
MTcsMC43NTc1NDQxOTMzMzk1NjYsMC45NDg1OTM1OTA5MTI0MDgsMC4yMzA1
OTg5NTg1OTc1MjgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuMDE1NTQ0NzA1NTc4
MzEyMiwwLjAzMjE2OTMyODE5ODg2NjksMC4wNjQ2MzEyMzI2MTg3MDk2LDAu
MDEwMjk0NTA4NTY1MTI0NiwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE3ODc2
NTU2MzM1NDgyOCwwLjE1MTM0MzU2Nzc2MTg1OSwtMC4wMzM2NTU5MDYzMzA3
ODM1LDAuMDkyOTA2MjI3OTMzNDg5OCwwLjE1OTczNTYxODQyMzMzNQ0KImlt
cG9ydGFudCIsMC4zODUyNjY5NjUzNjI3NjEsMC4xOTEyNDExODMyMDMxMjks
MC4yMzA1OTg5NTg1OTc1MjgsMC45NjQ0OTc4ODAzNDM2MSwwLjY0NzY1NzE0
MTQ4ODM3NSwwLjUxNDE3NTk3NDU1NDExNCwtMC4xOTc1MDY3MDU5MTcxMjMs
MC40NzQ3MjMzMzI0Njk4NzUsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE4OTIy
OTEyMzcwNTM0MSwtMC40NjIxOTU4MzkyNjUwMzUsMC4xMjQxNTgzMzk1Mjcz
MjIsMC4xNjA2NjEzMDc0ODY1NTksLTAuMDg2NDU3MzcyNzQ2NjI2NSwtMC4w
NjgzNjc0ODQyNDk4ODAxDQoiY29tcGxleCIsMC4xOTc2NDQ4MjQ2OTYzMjAs
MC4wMDAxNzQ2MzA0MTc1NjQ2ODgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuNjQ3
NjU3MTQxNDg4Mzc1LDAuOTc2MzIxNjU1NzYyOTY4LDAuNzU0OTc4Nzc3MzA5
NTUzLC0wLjI2MjM0MDQyNTgyNDA1MiwwLjY1NjcxNzUzMzM2MTE3NiwtMC4x
NjA0MjcxMzk2NzMwMTgsLTAuMjM2MjEwODU2MDgzOTAyLC0wLjM4NTQ1MjEw
MDA0NjYyMywwLjAyMzg3NzU3MjgyNzcxNTcsMC4zMjQ1MjU2NTMxNjQ1MDgs
LTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzMzY5NjU1NDE4OTE2NA0KImRpZmZp
Y3VsdCIsMC4xODMwNDEzMjQwNjIyOTgsMC4wMDM0MDg4NzExODA3MTI4Nyww
LjAxNTU0NDcwNTU3ODMxMjIsMC41MTQxNzU5NzQ1NTQxMTQsMC43NTQ5Nzg3
NzczMDk1NTMsMC45NTczMjQzNDE2NjE5NzIsLTAuMTgzMDA1NTg3NTUxNjI0
LDAuNTIzMTgzOTkzODk3NjMyLC0wLjE5NzgzMzM1NDQzMDkwNywtMC4yMjg0
MzQ3MTMwNjE3NzYsLTAuMjYzNTg3NzQ2MDIxMTc0LC0wLjA0NTM5NzEzNzc3
MDA4NDUsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMjM0NzA3NTE3Njc3NTg2LC0w
LjIzOTEyNjk3MTQ4MDYyNQ0KIm9ubHlzZWxmIiwtMC4xNDY2MjYzNDcyMTk4
NzksMC4wMDk2MzA1MDQ3NDM1ODAzNCwwLjAzMjE2OTMyODE5ODg2NjksLTAu
MTk3NTA2NzA1OTE3MTIzLC0wLjI2MjM0MDQyNTgyNDA1MiwtMC4xODMwMDU1
ODc1NTE2MjQsMC45NDc4NTI0MTU0NDM2NjMsLTAuMjY4MzMzOTc5Mjk1NjEy
LDAuMDc4NzE5MTg3OTIxNTY1NCwwLjA4MDA1NTQ0MzA5MzgwMzYsMC4xNjM1
OTUyNzc0OTg3NTgsLTAuMDA1MDcyNjg2MDg0MTc3MDQsLTAuMTYwMTM3NTQ1
ODcxNDQ4LDAuMjExMjU3MjUyMjg3OTc5LDAuMTQ3ODg0MzUyNTg4NDk5DQoi
bWFueWRpbWVuc2lvbnMiLDAuMTQ2MzU0MDI3Nzk3MTAxLDAuMDI4Mzg5NDM3
MzMxNjY4NCwwLjA2NDYzMTIzMjYxODcwOTYsMC40NzQ3MjMzMzI0Njk4NzUs
MC42NTY3MTc1MzMzNjExNzYsMC41MjMxODM5OTM4OTc2MzIsLTAuMjY4MzMz
OTc5Mjk1NjEyLDAuOTQ5OTE3NjYyNjE2MTYsLTAuMTEzMjk1NjY3NDA4MTc3
LC0wLjE4MTU3NjQ3MzE3MDc4NCwtMC4yNzkyOTg0MTcxNzcyNjEsMC4wNDQy
NDgxMjM1MDgyNTI4LDAuMjU4MzQ5NzAyNDYwNjYzLC0wLjE5Njk5MzM0NjMz
NzIxNCwtMC4yMjI1MzM5NTI2MzM0ODINCiJob3dtdWNoaW5mbyIsLTAuMTMy
ODg3NTk2OTAyNTA2LDAuMDE4ODAyNzUzOTQ2MzI5OSwwLjAxMDI5NDUwODU2
NTEyNDYsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE2MDQyNzEzOTY3MzAxOCwt
MC4xOTc4MzMzNTQ0MzA5MDcsMC4wNzg3MTkxODc5MjE1NjU0LC0wLjExMzI5
NTY2NzQwODE3NywwLjk0NjcyMjc0NjEzNzQxNSwwLjcwNjk3NjAxNTU4MjIx
OCwwLjA5MjMxOTI3MDQ0Mzk5MzQsMC4yMTMwMzIyNDI0NzMzMTUsLTAuMjA5
ODgyNDMxNzY1MTEwLDAuMjM5MTI0NTUxNjI5NTU5LDAuMjE5MDc4MzUyODkw
NjU3DQoiZXF1YWxpbmZvIiwtMC4xNzM5NjUwNjkxMTEwMjUsLTAuMDE1NzAy
NjM4MTUxNTk4NSwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE4OTIyOTEyMzcw
NTM0MSwtMC4yMzYyMTA4NTYwODM5MDIsLTAuMjI4NDM0NzEzMDYxNzc2LDAu
MDgwMDU1NDQzMDkzODAzNiwtMC4xODE1NzY0NzMxNzA3ODQsMC43MDY5NzYw
MTU1ODIyMTgsMC45NjQ1MTc1NjI3NzgzMjgsMC4xODA1MTczMjU3NTIzODcs
MC4xNjM4NDQ2NDA0OTU5ODMsLTAuMjEzODA0NTUwMDQzMjM5LDAuMjU4MDMy
MzIyODI0NTk5LDAuMTkxODIwNDQ3NDA0MzM1DQoiY291bGRhdm9pZCIsLTAu
MjY4NDU5MTYyOTMwNTY3LC0wLjE0NTc5NTAwNjc0MTg4NCwtMC4xNzg3NjU1
NjMzNTQ4MjgsLTAuNDYyMTk1ODM5MjY1MDM1LC0wLjM4NTQ1MjEwMDA0NjYy
MywtMC4yNjM1ODc3NDYwMjExNzQsMC4xNjM1OTUyNzc0OTg3NTgsLTAuMjc5
Mjk4NDE3MTc3MjYxLDAuMDkyMzE5MjcwNDQzOTkzNCwwLjE4MDUxNzMyNTc1
MjM4NywwLjk2MzIzNzMwOTczMDcyNiwtMC4xMjAxMzAxOTYzOTI0MDYsLTAu
MDY4OTY1OTY1NzA1NzA5MSwwLjE2NTUzMzIwODc0MzU0NywwLjE5MTQyMTEz
NDE4OTY4Mg0KInBvc291dGNvbWUiLC0wLjA2NzgwOTUzNzUwNzYyMjIsMC4x
NDIwMzQzOTY5MDY4NzksMC4xNTEzNDM1Njc3NjE4NTksMC4xMjQxNTgzMzk1
MjczMjIsMC4wMjM4Nzc1NzI4Mjc3MTU3LC0wLjA0NTM5NzEzNzc3MDA4NDUs
LTAuMDA1MDcyNjg2MDg0MTc3MDQsMC4wNDQyNDgxMjM1MDgyNTI4LDAuMjEz
MDMyMjQyNDczMzE1LDAuMTYzODQ0NjQwNDk1OTgzLC0wLjEyMDEzMDE5NjM5
MjQwNiwwLjkzOTEwNzcxNzE4NjM4NSwtMC4yOTEyNjIzOTE4Mjc2NzEsMC4y
NTYyNzQxOTU5ODMwMDQsMC4zNDY0NDE0MTExMTYxNDcNCiJuZWdvdXRjb21l
IiwwLjE4MDU0OTkyNTAyNDM3NywwLjAwOTgxNTM4Mzk4NDM0ODUxLC0wLjAz
MzY1NTkwNjMzMDc4MzUsMC4xNjA2NjEzMDc0ODY1NTksMC4zMjQ1MjU2NTMx
NjQ1MDgsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMTYwMTM3NTQ1ODcxNDQ4LDAu
MjU4MzQ5NzAyNDYwNjYzLC0wLjIwOTg4MjQzMTc2NTExMCwtMC4yMTM4MDQ1
NTAwNDMyMzksLTAuMDY4OTY1OTY1NzA1NzA5MSwtMC4yOTEyNjIzOTE4Mjc2
NzEsMC45NTI1NTI5NjU3OTY0MjEsLTAuMjIxOTE3MjIyOTMwMTksLTAuMjMx
MDMyMDE0OTI3Mzk3DQoiY29udHJvbCIsLTAuMDQyMDg0NDM2NDAzNzg3NCww
LjA3MDU4Njg3NTY1Mzk3MzIsMC4wOTI5MDYyMjc5MzM0ODk4LC0wLjA4NjQ1
NzM3Mjc0NjYyNjUsLTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzNDcwNzUxNzY3
NzU4NiwwLjIxMTI1NzI1MjI4Nzk3OSwtMC4xOTY5OTMzNDYzMzcyMTQsMC4y
MzkxMjQ1NTE2Mjk1NTksMC4yNTgwMzIzMjI4MjQ1OTksMC4xNjU1MzMyMDg3
NDM1NDcsMC4yNTYyNzQxOTU5ODMwMDQsLTAuMjIxOTE3MjIyOTMwMTksMC45
Mzc2MDc1MzMxODY1NzYsMC4zMTI2NjQxOTk2MzE2MjANCiJkZXNpcmVkIiwt
MC4wNzMwNTc3ODk2OTAyOTY3LDAuMTA4MDAwNDQ5MzI4MzEzLDAuMTU5NzM1
NjE4NDIzMzM1LC0wLjA2ODM2NzQ4NDI0OTg4MDEsLTAuMjMzNjk2NTU0MTg5
MTY0LC0wLjIzOTEyNjk3MTQ4MDYyNSwwLjE0Nzg4NDM1MjU4ODQ5OSwtMC4y
MjI1MzM5NTI2MzM0ODIsMC4yMTkwNzgzNTI4OTA2NTcsMC4xOTE4MjA0NDc0
MDQzMzUsMC4xOTE0MjExMzQxODk2ODIsMC4zNDY0NDE0MTExMTYxNDcsLTAu
MjMxMDMyMDE0OTI3Mzk3LDAuMzEyNjY0MTk5NjMxNjIwLDAuOTYzMTMxNjM5
NTYwMTA4DQo=

--1660387551-1458482416-1249639718=:2997--


From hwborchers at googlemail.com  Fri Aug  7 21:35:10 2009
From: hwborchers at googlemail.com (Hans W Borchers)
Date: Fri, 7 Aug 2009 19:35:10 +0000 (UTC)
Subject: [Rd] R patched & devel versions as portable ZIP files
Message-ID: <loom.20090807T192617-914@post.gmane.org>

I wonder if it would be possible to provide R patched and development versions
for Windows as simple zip files without using any installers.

There are more and more free and open source software projects providing
such portable versions, among them Python (since V2.5), the new MikTex 2.8,
OpenOffice 3, Firefox and Thunderbird, to name a few. Many smaller Windows
utilities do the same.

When regularly following patched and development version, the installation
procedures and writing into the Windows registry all the time makes me
feel uneasy. And even with the installation procedure there are subsequent
tasks, for example changing the path in the shortcut.

Zip files are much better for those running R from an USB stick because
otherwise you have to install it on the disk---what maybe you don't want to
do---and then copy it over to the stick.

I know there are some concerns with R-(D)COM interface and i assume those using
it know which versions to install.

Thanks
Hans Werner Borchers


From jeff.a.ryan at gmail.com  Fri Aug  7 21:35:34 2009
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Fri, 7 Aug 2009 14:35:34 -0500
Subject: [Rd] Bug in nlm, found using sem;
	failure in several flavors 	(PR#13881)
In-Reply-To: <20090807181017.540BD282EF29@mail.pubhealth.ku.dk>
References: <20090807181017.540BD282EF29@mail.pubhealth.ku.dk>
Message-ID: <e8e755250908071235v221bdc20v48363bb4b58d6af7@mail.gmail.com>

Adam,

It seems that your attachment didn't make it through.

That aside, my experience with strange errors like those (random type
not implemented ones) has been that you may be looking at a memory
problem on you machine. Given that you can't replicate on another
platform (and the .csv file didn't come through), I would think it
wise to start there.

My 2c.  And I love bacon too :)

Jeff

On Fri, Aug 7, 2009 at 1:10 PM, <adik at ilovebacon.org> wrote:
> ?This message is in MIME format. ?The first part should be readable text,
> ?while the remaining parts are likely unreadable without MIME-aware tools.
>
> --1660387551-1458482416-1249639718=:2997
> Content-Type: TEXT/PLAIN; CHARSET=US-ASCII; FORMAT=flowed
> Content-ID: <Pine.LNX.4.64.0908071039211.2997 at parser.ilovebacon.org>
>
> Hello,
>
> ? ? ? ?There appears to be a bug in the nlm function, which I discovered
> when trying to run an SEM. ?The SEM is not bizarre; the covariance matrix is
> solve-able and the eigenvalues are greater than zero, and I do not believe
> the "sem" package per se to be the problem (as nlm keeps being the part that
> fails, though I can't replicate this with other nlm tasks). ?I apologize if
> I have put too many much information in this message; I'm not a programmer
> by trade so I don't really know what's going on here, which hampers my
> ability to write consise bug reports.
>
> Here is the code I use:
>
> library(sem)
> ice.S <- read.csv("iceS.csv") # attached
> rownames(ice.S) <- ice.S[,1]
> ice.S[,1] <- NULL
> ice.S <- as.matrix(ice.S)
> ice.ram <- specify.model("ice.ram") # attached
> ice.N <- 342
> ice.sem <- sem(ram=ice.ram, S=ice.S, N=ice.N)
>
> ...at this point, any number of problems could occur. I have seen the
> following.
>
> 1) Simple lack of convergence. (might be my model's fault.)
> 2) Error in nlm(if (analytic.gradient) objective.2 else objective.1, start,
> :
> ? type 31 is unimplemented in 'type2char'
> 3) ?*** caught segfault ***
> address 0xc019c87b, cause 'memory not mapped'
>
> Traceback:
> ?1: nlm(if (analytic.gradient) objective.2 else objective.1, start,
> hessian = TRUE, iterlim = maxiter, print.level = if (debug) 2 else 0,
> typsize = typsize, ...)
> ?2: sem.default(ram = ram, S = S, N = N, param.names = pars, var.names =
> vars, ? ? fixed.x = fixed.x, debug = debug, ...)
> ?3: sem(ram = ram, S = S, N = N, param.names = pars, var.names = vars,
> fixed.x = fixed.x, debug = debug, ...)
> ?4: sem.mod(ram = ice.ram, S = ice.S, N = ice.N)
> ?5: sem(ram = ice.ram, S = ice.S, N = ice.N)
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection: 1
> aborting ...
> Segmentation fault
> swiss:data$
>
> (no core was dumped).
>
> Trying with debug mode provides other interesting errors:
>
>> ice.sem <- sem(ram=ice.ram, S=ice.S, N=ice.N, debug=TRUE)
>
> ...gets up to some iteration (not always 15), and then R dies ungracefully,
> and exits to the shell:
>
> iteration = 15
> Step:
> ?[1] ?1.253132e-02 ?1.183343e-02 -7.651342e-03 -2.490800e-03 ?2.278938e-03
> ?[6] ?3.197431e-04 ?6.137849e-04 -2.496882e-03 -1.065829e-03 -2.118179e-03
> [11] ?2.942936e-03 -1.335936e-03 -3.665618e-03 ?3.090566e-03 ?8.534956e-04
> [16] -1.440421e-03 -5.230877e-04 -1.053686e-04 -9.771005e-04 -4.269216e-04
> [21] ?7.261694e-05 -1.039668e-03 -8.409151e-03 -3.497456e-03 ?2.216899e-03
> [26] -4.633520e-03 -4.052130e-03 -4.746537e-03 -1.589622e-03 -2.523766e-04
> Parameter:
> ?[1] -0.76604614 -1.19639662 ?0.83456888 ?0.72540413 ?0.08482452 ?0.56180393
> ?[7] ?0.50615814 ?0.55728015 ?0.83796696 ?0.88371335 -0.70465116 ?0.85251098
> [13] -0.18346956 ?0.66857787 ?0.57012481 ?0.39116561 ?0.91237990 ?0.63951482
> [19] ?0.26601566 ?0.29240836 ?0.44710919 ?0.94734056 ?6.52039015 ?0.02524762
> [25] -0.01614603 ?2.88198219 ?0.03442452 ?3.52272237 ?1.44698423 -0.72964745
> Function Value
> [1] -15175.94
> Gradient:
> ?[1] -2.085412e+07 -3.819717e+07 ?3.883989e+07 ?1.352594e+00 -4.283329e+00
> ?[6] -1.437250e+00 -6.558913e-01 ?1.358276e+00 ?7.930865e+05 -1.293853e+06
> [11] -5.816627e+03 ?5.908197e+05 -2.705742e+08 -1.194400e+07 -4.007083e+07
> [16] -4.143068e+07 -6.159782e-01 ?1.044274e-01 -8.591048e+00 -2.083471e+00
> [21] -7.548753e-01 -5.418994e-01 -2.799228e+02 -1.321739e+07 -3.517728e+07
> [26] -7.106654e+02 -7.335293e+06 -7.335285e+05 ?3.117764e-01 -2.234989e+04
>
> Abort trap
> swiss:data$
>
> ...I have also seen convergence reached, and nlm then die with this message:
>
> Error in nlm(if (analytic.gradient) objective.2 else objective.1, start,
> :
> ? type 27 is unimplemented in 'type2char'
>
> (similar to above, but now referring to type 27)
>
> I have shown this effect (or something similar...never know how it'll fail
> next) on the following platforms:
>
>> version
> ? ? ? ? ? ? ? ?_
> platform ? ? ? i386-apple-darwin9.7.0
> arch ? ? ? ? ? i386
> os ? ? ? ? ? ? darwin9.7.0
> system ? ? ? ? i386, darwin9.7.0
> status
> major ? ? ? ? ?2
> minor ? ? ? ? ?9.1
> year ? ? ? ? ? 2009
> month ? ? ? ? ?06
> day ? ? ? ? ? ?26
> svn rev ? ? ? ?48839
> language ? ? ? R
> version.string R version 2.9.1 (2009-06-26)
>
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> i386-apple-darwin9.8.0
>
> locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> other attached packages:
> [1] sem_0.9-17
>
> loaded via a namespace (and not attached):
> [1] tcltk_2.9.1 tools_2.9.1
>
> (I admit to having compiled this version of R myself (to link to a
> hand-compiled ATLAS), though no errors were thrown in the compilation stage.
> I compiled using this config string, at first...
>
> ./configure --prefix=/usr/local --with-x --disable-R-framework --enable-threads=posix --with-blas="/usr/local/lib/libptf77blas.a /usr/local/lib/libptcblas.a /usr/local/lib/libatlas.a -lpthread" --with-lapack="/usr/local/lib/liblapack.a /usr/local/lib/libptf77blas.a /usr/local/lib/libptcblas.a /usr/local/lib/libatlas.a -lpthread" --without-aqua CFLAGS="-O3 -mtune=nocona -m32" CXXFLAGS="-O3 -mtune=nocona -m32" FFLAGS="-O3 -mtune=nocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" F77FLAGS="-O3 -mtune=nocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" FCFLAGS="-O3 -mtune=nocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" LDFLAGS="-m32 -L/sw/lib" CPPFLAGS="-I/sw/include" CC=gcc-4.2 F77=gfortran-4.2 FC=gfortran-4.2 CXX=g++-4.2 OBJC=gcc-4.2
>
> ...though I have also recompiled using simply this:
>
> ./configure --prefix=/usr/local --with-x --disable-R-framework
>
> ...and then re-installed SEM, and I got a few other, different error
> messages and core dumps, "including type 11 is unimplemented in 'type2char'"
> and "cannot coerce type 'weakref' to vector of type 'double'". ?Running with
> debug=TRUE also segfaults sometimes, even after achieving "Current iterate
> is probably solution" status.)
>
>> version
> ? ? ? ? ? ? ? ?_
> platform ? ? ? x86_64-unknown-linux-gnu
> arch ? ? ? ? ? x86_64
> os ? ? ? ? ? ? linux-gnu
> system ? ? ? ? x86_64, linux-gnu
> status
> major ? ? ? ? ?2
> minor ? ? ? ? ?9.1
> year ? ? ? ? ? 2009
> month ? ? ? ? ?06
> day ? ? ? ? ? ?26
> svn rev ? ? ? ?48839
> language ? ? ? R
> version.string R version 2.9.1 (2009-06-26)
>
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> x86_64-unknown-linux-gnu
>
> locale:
> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=C;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> other attached packages:
> [1] sem_0.9-17
>
> ...however, THIS platform does NOT show the bug:
>
>> version
> ? ? ? ? ? ? ? ?_
> platform ? ? ? powerpc-unknown-linux-gnu
> arch ? ? ? ? ? powerpc
> os ? ? ? ? ? ? linux-gnu
> system ? ? ? ? powerpc, linux-gnu
> status
> major ? ? ? ? ?2
> minor ? ? ? ? ?9.1
> year ? ? ? ? ? 2009
> month ? ? ? ? ?06
> day ? ? ? ? ? ?26
> svn rev ? ? ? ?48839
> language ? ? ? R
> version.string R version 2.9.1 (2009-06-26)
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> powerpc-unknown-linux-gnu
>
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> other attached packages:
> [1] sem_0.9-17
>>
>
> ...for this system, the model simply repeatedly fails to converge, whether
> debug is set or not.
>
> I have also tried altering my model. This has resulted in the same bugs, but
> instead of "every so often simply not converging," it actually converges and
> appears to be the model I asked R to solve...but this is rare.
>
> Please let me know if I can provide any other info.
>
> Cordially,
> Adam D. I. Kramer
> --1660387551-1458482416-1249639718=:2997
> Content-Type: AUDIO/X-PN-REALAUDIO; NAME=ice.ram
> Content-Transfer-Encoding: BASE64
> Content-ID: <Pine.LNX.4.64.0908070308380.2997 at parser.ilovebacon.org>
> Content-Description:
> Content-Disposition: ATTACHMENT; FILENAME=ice.ram
>
> aW1wb3J0YW50IDwtLSBjaGFsbGVuZ2UsIE5BLCAxCmNvbXBsZXggIDwtLSBj
> aGFsbGVuZ2UsIGMuY29tcGxleCwgTkEKZGlmZmljdWx0IDwtLSBjaGFsbGVu
> Z2UsIGMuZGlmZmljdWx0LCBOQQptYW55ZGltZW5zaW9ucyA8LS0gY2hhbGxl
> bmdlLCBjLm1hbnlkaW1lbnNpb25zLCBOQQpjb3VsZGF2b2lkIDwtLSBjaGFs
> bGVuZ2UsIGMuY291bGRhdm9pZCwgTkEKb25seXNlbGYgPC0tIGNoYWxsZW5n
> ZSwgYy5vbmx5c2VsZiwgTkEKCndhc3JpZ2h0Y2hvaWNlIDwtLSBldmFsLCBO
> QSwgMQp0ZWxsZ29vZCA8LS0gZXZhbCwgZS50ZWxsZ29vZCwgTkEKdGVsbGJl
> c3QgPC0tIGV2YWwsIGUudGVsbGJlc3QsIE5BCm5lZ291dGNvbWUgPC0tIGV2
> YWwsIGUubmVnb3V0Y29tZSwgTkEKCmVxdWFsaW5mbyA8LS0gaW5mb3JtZWQs
> IE5BLCAxCmNvbnRyb2wgPC0tIGluZm9ybWVkLCBpLmNvbnRyb2wsIE5BCmRl
> c2lyZWQgPC0tIGluZm9ybWVkLCBpLmRlc2lyZWQsIE5BCmhvd211Y2hpbmZv
> IDwtLSBpbmZvcm1lZCwgaS5ob3dtdWNoaW5mbywgTkEKcG9zb3V0Y29tZSA8
> LS0gaW5mb3JtZWQsIGkucG9zb3V0Y29tZSwgTkEKCndhc3JpZ2h0Y2hvaWNl
> IDwtPiB3YXNyaWdodGNob2ljZSwgd2FzcmlnaHRjaG9pY2VWLCBOQQp0ZWxs
> Z29vZCA8LT4gdGVsbGdvb2QsIHRlbGxnb29kViwgTkEKdGVsbGJlc3QgPC0+
> IHRlbGxiZXN0LCB0ZWxsYmVzdFYsIE5BCm5lZ291dGNvbWUgPC0+IG5lZ291
> dGNvbWUsIG5lZ291dGNvbWVWLCBOQQoKb25seXNlbGYgPC0+IG9ubHlzZWxm
> LCBvbmx5c2VsZlYsIE5BCmltcG9ydGFudCA8LT4gaW1wb3J0YW50LCBpbXBv
> cnRhbnRWLCBOQQpjb21wbGV4IDwtPiBjb21wbGV4LCBjb21wbGV4ViwgTkEK
> ZGlmZmljdWx0IDwtPiBkaWZmaWN1bHQsIGRpZmZpY3VsdFYsIE5BCm1hbnlk
> aW1lbnNpb25zIDwtPiBtYW55ZGltZW5zaW9ucywgbWFueWRpbWVuc2lvbnNW
> LCBOQQpjb3VsZGF2b2lkIDwtPiBjb3VsZGF2b2lkLCBjb3VsZGF2b2lkViwg
> TkEKCmVxdWFsaW5mbyA8LT4gZXF1YWxpbmZvLCBlcXVhbGluZm9WLCBOQQpj
> b250cm9sIDwtPiBjb250cm9sLCBjb250cm9sViwgTkEKZGVzaXJlZCA8LT4g
> ZGVzaXJlZCwgZGVzaXJlZFYsIE5BCmhvd211Y2hpbmZvIDwtPiBob3dtdWNo
> aW5mbywgaG93bXVjaGluZm9WLCBOQQpwb3NvdXRjb21lIDwtPiBwb3NvdXRj
> b21lLCBwb3NvdXRjb21lViwgTkEKCmV2YWwgPC0+IGV2YWwsIGV2YWxWLCBO
> QQpjaGFsbGVuZ2UgPC0+IGNoYWxsZW5nZSwgY2hhbGxlbmdlViwgTkEKaW5m
> b3JtZWQgPC0+IGluZm9ybWVkLCBpbmZvcm1lZFYsIE5BCg==
>
> --1660387551-1458482416-1249639718=:2997
> Content-Type: TEXT/CSV; CHARSET=US-ASCII; NAME=iceS.csv
> Content-Transfer-Encoding: BASE64
> Content-ID: <Pine.LNX.4.64.0908070308381.2997 at parser.ilovebacon.org>
> Content-Description:
> Content-Disposition: ATTACHMENT; FILENAME=iceS.csv
>
> IiIsIndhc3JpZ2h0Y2hvaWNlIiwidGVsbGdvb2QiLCJ0ZWxsYmVzdCIsImlt
> cG9ydGFudCIsImNvbXBsZXgiLCJkaWZmaWN1bHQiLCJvbmx5c2VsZiIsIm1h
> bnlkaW1lbnNpb25zIiwiaG93bXVjaGluZm8iLCJlcXVhbGluZm8iLCJjb3Vs
> ZGF2b2lkIiwicG9zb3V0Y29tZSIsIm5lZ291dGNvbWUiLCJjb250cm9sIiwi
> ZGVzaXJlZCINCiJ3YXNyaWdodGNob2ljZSIsMC45NjM2OTc3MzE3ODk2Myww
> LjI5MjczNjMyMTIyOTY0NywwLjI4OTg1MjgwODQ4OTExNywwLjM4NTI2Njk2
> NTM2Mjc2MSwwLjE5NzY0NDgyNDY5NjMyMCwwLjE4MzA0MTMyNDA2MjI5OCwt
> MC4xNDY2MjYzNDcyMTk4NzksMC4xNDYzNTQwMjc3OTcxMDEsLTAuMTMyODg3
> NTk2OTAyNTA2LC0wLjE3Mzk2NTA2OTExMTAyNSwtMC4yNjg0NTkxNjI5MzA1
> NjcsLTAuMDY3ODA5NTM3NTA3NjIyMiwwLjE4MDU0OTkyNTAyNDM3NywtMC4w
> NDIwODQ0MzY0MDM3ODc0LC0wLjA3MzA1Nzc4OTY5MDI5NjcNCiJ0ZWxsZ29v
> ZCIsMC4yOTI3MzYzMjEyMjk2NDcsMC45NTU0OTQyNDYyMTA4NTYsMC43NTc1
> NDQxOTMzMzk1NjYsMC4xOTEyNDExODMyMDMxMjksMC4wMDAxNzQ2MzA0MTc1
> NjQ2ODgsMC4wMDM0MDg4NzExODA3MTI4NywwLjAwOTYzMDUwNDc0MzU4MDM0
> LDAuMDI4Mzg5NDM3MzMxNjY4NCwwLjAxODgwMjc1Mzk0NjMyOTksLTAuMDE1
> NzAyNjM4MTUxNTk4NSwtMC4xNDU3OTUwMDY3NDE4ODQsMC4xNDIwMzQzOTY5
> MDY4NzksMC4wMDk4MTUzODM5ODQzNDg1MSwwLjA3MDU4Njg3NTY1Mzk3MzIs
> MC4xMDgwMDA0NDkzMjgzMTMNCiJ0ZWxsYmVzdCIsMC4yODk4NTI4MDg0ODkx
> MTcsMC43NTc1NDQxOTMzMzk1NjYsMC45NDg1OTM1OTA5MTI0MDgsMC4yMzA1
> OTg5NTg1OTc1MjgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuMDE1NTQ0NzA1NTc4
> MzEyMiwwLjAzMjE2OTMyODE5ODg2NjksMC4wNjQ2MzEyMzI2MTg3MDk2LDAu
> MDEwMjk0NTA4NTY1MTI0NiwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE3ODc2
> NTU2MzM1NDgyOCwwLjE1MTM0MzU2Nzc2MTg1OSwtMC4wMzM2NTU5MDYzMzA3
> ODM1LDAuMDkyOTA2MjI3OTMzNDg5OCwwLjE1OTczNTYxODQyMzMzNQ0KImlt
> cG9ydGFudCIsMC4zODUyNjY5NjUzNjI3NjEsMC4xOTEyNDExODMyMDMxMjks
> MC4yMzA1OTg5NTg1OTc1MjgsMC45NjQ0OTc4ODAzNDM2MSwwLjY0NzY1NzE0
> MTQ4ODM3NSwwLjUxNDE3NTk3NDU1NDExNCwtMC4xOTc1MDY3MDU5MTcxMjMs
> MC40NzQ3MjMzMzI0Njk4NzUsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE4OTIy
> OTEyMzcwNTM0MSwtMC40NjIxOTU4MzkyNjUwMzUsMC4xMjQxNTgzMzk1Mjcz
> MjIsMC4xNjA2NjEzMDc0ODY1NTksLTAuMDg2NDU3MzcyNzQ2NjI2NSwtMC4w
> NjgzNjc0ODQyNDk4ODAxDQoiY29tcGxleCIsMC4xOTc2NDQ4MjQ2OTYzMjAs
> MC4wMDAxNzQ2MzA0MTc1NjQ2ODgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuNjQ3
> NjU3MTQxNDg4Mzc1LDAuOTc2MzIxNjU1NzYyOTY4LDAuNzU0OTc4Nzc3MzA5
> NTUzLC0wLjI2MjM0MDQyNTgyNDA1MiwwLjY1NjcxNzUzMzM2MTE3NiwtMC4x
> NjA0MjcxMzk2NzMwMTgsLTAuMjM2MjEwODU2MDgzOTAyLC0wLjM4NTQ1MjEw
> MDA0NjYyMywwLjAyMzg3NzU3MjgyNzcxNTcsMC4zMjQ1MjU2NTMxNjQ1MDgs
> LTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzMzY5NjU1NDE4OTE2NA0KImRpZmZp
> Y3VsdCIsMC4xODMwNDEzMjQwNjIyOTgsMC4wMDM0MDg4NzExODA3MTI4Nyww
> LjAxNTU0NDcwNTU3ODMxMjIsMC41MTQxNzU5NzQ1NTQxMTQsMC43NTQ5Nzg3
> NzczMDk1NTMsMC45NTczMjQzNDE2NjE5NzIsLTAuMTgzMDA1NTg3NTUxNjI0
> LDAuNTIzMTgzOTkzODk3NjMyLC0wLjE5NzgzMzM1NDQzMDkwNywtMC4yMjg0
> MzQ3MTMwNjE3NzYsLTAuMjYzNTg3NzQ2MDIxMTc0LC0wLjA0NTM5NzEzNzc3
> MDA4NDUsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMjM0NzA3NTE3Njc3NTg2LC0w
> LjIzOTEyNjk3MTQ4MDYyNQ0KIm9ubHlzZWxmIiwtMC4xNDY2MjYzNDcyMTk4
> NzksMC4wMDk2MzA1MDQ3NDM1ODAzNCwwLjAzMjE2OTMyODE5ODg2NjksLTAu
> MTk3NTA2NzA1OTE3MTIzLC0wLjI2MjM0MDQyNTgyNDA1MiwtMC4xODMwMDU1
> ODc1NTE2MjQsMC45NDc4NTI0MTU0NDM2NjMsLTAuMjY4MzMzOTc5Mjk1NjEy
> LDAuMDc4NzE5MTg3OTIxNTY1NCwwLjA4MDA1NTQ0MzA5MzgwMzYsMC4xNjM1
> OTUyNzc0OTg3NTgsLTAuMDA1MDcyNjg2MDg0MTc3MDQsLTAuMTYwMTM3NTQ1
> ODcxNDQ4LDAuMjExMjU3MjUyMjg3OTc5LDAuMTQ3ODg0MzUyNTg4NDk5DQoi
> bWFueWRpbWVuc2lvbnMiLDAuMTQ2MzU0MDI3Nzk3MTAxLDAuMDI4Mzg5NDM3
> MzMxNjY4NCwwLjA2NDYzMTIzMjYxODcwOTYsMC40NzQ3MjMzMzI0Njk4NzUs
> MC42NTY3MTc1MzMzNjExNzYsMC41MjMxODM5OTM4OTc2MzIsLTAuMjY4MzMz
> OTc5Mjk1NjEyLDAuOTQ5OTE3NjYyNjE2MTYsLTAuMTEzMjk1NjY3NDA4MTc3
> LC0wLjE4MTU3NjQ3MzE3MDc4NCwtMC4yNzkyOTg0MTcxNzcyNjEsMC4wNDQy
> NDgxMjM1MDgyNTI4LDAuMjU4MzQ5NzAyNDYwNjYzLC0wLjE5Njk5MzM0NjMz
> NzIxNCwtMC4yMjI1MzM5NTI2MzM0ODINCiJob3dtdWNoaW5mbyIsLTAuMTMy
> ODg3NTk2OTAyNTA2LDAuMDE4ODAyNzUzOTQ2MzI5OSwwLjAxMDI5NDUwODU2
> NTEyNDYsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE2MDQyNzEzOTY3MzAxOCwt
> MC4xOTc4MzMzNTQ0MzA5MDcsMC4wNzg3MTkxODc5MjE1NjU0LC0wLjExMzI5
> NTY2NzQwODE3NywwLjk0NjcyMjc0NjEzNzQxNSwwLjcwNjk3NjAxNTU4MjIx
> OCwwLjA5MjMxOTI3MDQ0Mzk5MzQsMC4yMTMwMzIyNDI0NzMzMTUsLTAuMjA5
> ODgyNDMxNzY1MTEwLDAuMjM5MTI0NTUxNjI5NTU5LDAuMjE5MDc4MzUyODkw
> NjU3DQoiZXF1YWxpbmZvIiwtMC4xNzM5NjUwNjkxMTEwMjUsLTAuMDE1NzAy
> NjM4MTUxNTk4NSwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE4OTIyOTEyMzcw
> NTM0MSwtMC4yMzYyMTA4NTYwODM5MDIsLTAuMjI4NDM0NzEzMDYxNzc2LDAu
> MDgwMDU1NDQzMDkzODAzNiwtMC4xODE1NzY0NzMxNzA3ODQsMC43MDY5NzYw
> MTU1ODIyMTgsMC45NjQ1MTc1NjI3NzgzMjgsMC4xODA1MTczMjU3NTIzODcs
> MC4xNjM4NDQ2NDA0OTU5ODMsLTAuMjEzODA0NTUwMDQzMjM5LDAuMjU4MDMy
> MzIyODI0NTk5LDAuMTkxODIwNDQ3NDA0MzM1DQoiY291bGRhdm9pZCIsLTAu
> MjY4NDU5MTYyOTMwNTY3LC0wLjE0NTc5NTAwNjc0MTg4NCwtMC4xNzg3NjU1
> NjMzNTQ4MjgsLTAuNDYyMTk1ODM5MjY1MDM1LC0wLjM4NTQ1MjEwMDA0NjYy
> MywtMC4yNjM1ODc3NDYwMjExNzQsMC4xNjM1OTUyNzc0OTg3NTgsLTAuMjc5
> Mjk4NDE3MTc3MjYxLDAuMDkyMzE5MjcwNDQzOTkzNCwwLjE4MDUxNzMyNTc1
> MjM4NywwLjk2MzIzNzMwOTczMDcyNiwtMC4xMjAxMzAxOTYzOTI0MDYsLTAu
> MDY4OTY1OTY1NzA1NzA5MSwwLjE2NTUzMzIwODc0MzU0NywwLjE5MTQyMTEz
> NDE4OTY4Mg0KInBvc291dGNvbWUiLC0wLjA2NzgwOTUzNzUwNzYyMjIsMC4x
> NDIwMzQzOTY5MDY4NzksMC4xNTEzNDM1Njc3NjE4NTksMC4xMjQxNTgzMzk1
> MjczMjIsMC4wMjM4Nzc1NzI4Mjc3MTU3LC0wLjA0NTM5NzEzNzc3MDA4NDUs
> LTAuMDA1MDcyNjg2MDg0MTc3MDQsMC4wNDQyNDgxMjM1MDgyNTI4LDAuMjEz
> MDMyMjQyNDczMzE1LDAuMTYzODQ0NjQwNDk1OTgzLC0wLjEyMDEzMDE5NjM5
> MjQwNiwwLjkzOTEwNzcxNzE4NjM4NSwtMC4yOTEyNjIzOTE4Mjc2NzEsMC4y
> NTYyNzQxOTU5ODMwMDQsMC4zNDY0NDE0MTExMTYxNDcNCiJuZWdvdXRjb21l
> IiwwLjE4MDU0OTkyNTAyNDM3NywwLjAwOTgxNTM4Mzk4NDM0ODUxLC0wLjAz
> MzY1NTkwNjMzMDc4MzUsMC4xNjA2NjEzMDc0ODY1NTksMC4zMjQ1MjU2NTMx
> NjQ1MDgsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMTYwMTM3NTQ1ODcxNDQ4LDAu
> MjU4MzQ5NzAyNDYwNjYzLC0wLjIwOTg4MjQzMTc2NTExMCwtMC4yMTM4MDQ1
> NTAwNDMyMzksLTAuMDY4OTY1OTY1NzA1NzA5MSwtMC4yOTEyNjIzOTE4Mjc2
> NzEsMC45NTI1NTI5NjU3OTY0MjEsLTAuMjIxOTE3MjIyOTMwMTksLTAuMjMx
> MDMyMDE0OTI3Mzk3DQoiY29udHJvbCIsLTAuMDQyMDg0NDM2NDAzNzg3NCww
> LjA3MDU4Njg3NTY1Mzk3MzIsMC4wOTI5MDYyMjc5MzM0ODk4LC0wLjA4NjQ1
> NzM3Mjc0NjYyNjUsLTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzNDcwNzUxNzY3
> NzU4NiwwLjIxMTI1NzI1MjI4Nzk3OSwtMC4xOTY5OTMzNDYzMzcyMTQsMC4y
> MzkxMjQ1NTE2Mjk1NTksMC4yNTgwMzIzMjI4MjQ1OTksMC4xNjU1MzMyMDg3
> NDM1NDcsMC4yNTYyNzQxOTU5ODMwMDQsLTAuMjIxOTE3MjIyOTMwMTksMC45
> Mzc2MDc1MzMxODY1NzYsMC4zMTI2NjQxOTk2MzE2MjANCiJkZXNpcmVkIiwt
> MC4wNzMwNTc3ODk2OTAyOTY3LDAuMTA4MDAwNDQ5MzI4MzEzLDAuMTU5NzM1
> NjE4NDIzMzM1LC0wLjA2ODM2NzQ4NDI0OTg4MDEsLTAuMjMzNjk2NTU0MTg5
> MTY0LC0wLjIzOTEyNjk3MTQ4MDYyNSwwLjE0Nzg4NDM1MjU4ODQ5OSwtMC4y
> MjI1MzM5NTI2MzM0ODIsMC4yMTkwNzgzNTI4OTA2NTcsMC4xOTE4MjA0NDc0
> MDQzMzUsMC4xOTE0MjExMzQxODk2ODIsMC4zNDY0NDE0MTExMTYxNDcsLTAu
> MjMxMDMyMDE0OTI3Mzk3LDAuMzEyNjY0MTk5NjMxNjIwLDAuOTYzMTMxNjM5
> NTYwMTA4DQo=
>
> --1660387551-1458482416-1249639718=:2997--
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From jeff.a.ryan at gmail.com  Fri Aug  7 21:40:18 2009
From: jeff.a.ryan at gmail.com (jeff.a.ryan at gmail.com)
Date: Fri,  7 Aug 2009 21:40:18 +0200 (CEST)
Subject: [Rd] Bug in nlm, found using sem;
	failure in several flavors (PR#13882)
Message-ID: <20090807194018.D0B5C282EF4C@mail.pubhealth.ku.dk>

Adam,

It seems that your attachment didn't make it through.

That aside, my experience with strange errors like those (random type
not implemented ones) has been that you may be looking at a memory
problem on you machine. Given that you can't replicate on another
platform (and the .csv file didn't come through), I would think it
wise to start there.

My 2c.  And I love bacon too :)

Jeff

On Fri, Aug 7, 2009 at 1:10 PM, <adik at ilovebacon.org> wrote:
> =A0This message is in MIME format. =A0The first part should be readable t=
ext,
> =A0while the remaining parts are likely unreadable without MIME-aware too=
ls.
>
> --1660387551-1458482416-1249639718=3D:2997
> Content-Type: TEXT/PLAIN; CHARSET=3DUS-ASCII; FORMAT=3Dflowed
> Content-ID: <Pine.LNX.4.64.0908071039211.2997 at parser.ilovebacon.org>
>
> Hello,
>
> =A0 =A0 =A0 =A0There appears to be a bug in the nlm function, which I dis=
covered
> when trying to run an SEM. =A0The SEM is not bizarre; the covariance matr=
ix is
> solve-able and the eigenvalues are greater than zero, and I do not believ=
e
> the "sem" package per se to be the problem (as nlm keeps being the part t=
hat
> fails, though I can't replicate this with other nlm tasks). =A0I apologiz=
e if
> I have put too many much information in this message; I'm not a programme=
r
> by trade so I don't really know what's going on here, which hampers my
> ability to write consise bug reports.
>
> Here is the code I use:
>
> library(sem)
> ice.S <- read.csv("iceS.csv") # attached
> rownames(ice.S) <- ice.S[,1]
> ice.S[,1] <- NULL
> ice.S <- as.matrix(ice.S)
> ice.ram <- specify.model("ice.ram") # attached
> ice.N <- 342
> ice.sem <- sem(ram=3Dice.ram, S=3Dice.S, N=3Dice.N)
>
> ...at this point, any number of problems could occur. I have seen the
> following.
>
> 1) Simple lack of convergence. (might be my model's fault.)
> 2) Error in nlm(if (analytic.gradient) objective.2 else objective.1, star=
t,
> :
> =A0 type 31 is unimplemented in 'type2char'
> 3) =A0*** caught segfault ***
> address 0xc019c87b, cause 'memory not mapped'
>
> Traceback:
> =A01: nlm(if (analytic.gradient) objective.2 else objective.1, start,
> hessian =3D TRUE, iterlim =3D maxiter, print.level =3D if (debug) 2 else =
0,
> typsize =3D typsize, ...)
> =A02: sem.default(ram =3D ram, S =3D S, N =3D N, param.names =3D pars, va=
r.names =3D
> vars, =A0 =A0 fixed.x =3D fixed.x, debug =3D debug, ...)
> =A03: sem(ram =3D ram, S =3D S, N =3D N, param.names =3D pars, var.names =
=3D vars,
> fixed.x =3D fixed.x, debug =3D debug, ...)
> =A04: sem.mod(ram =3D ice.ram, S =3D ice.S, N =3D ice.N)
> =A05: sem(ram =3D ice.ram, S =3D ice.S, N =3D ice.N)
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection: 1
> aborting ...
> Segmentation fault
> swiss:data$
>
> (no core was dumped).
>
> Trying with debug mode provides other interesting errors:
>
>> ice.sem <- sem(ram=3Dice.ram, S=3Dice.S, N=3Dice.N, debug=3DTRUE)
>
> ...gets up to some iteration (not always 15), and then R dies ungracefull=
y,
> and exits to the shell:
>
> iteration =3D 15
> Step:
> =A0[1] =A01.253132e-02 =A01.183343e-02 -7.651342e-03 -2.490800e-03 =A02.2=
78938e-03
> =A0[6] =A03.197431e-04 =A06.137849e-04 -2.496882e-03 -1.065829e-03 -2.118=
179e-03
> [11] =A02.942936e-03 -1.335936e-03 -3.665618e-03 =A03.090566e-03 =A08.534=
956e-04
> [16] -1.440421e-03 -5.230877e-04 -1.053686e-04 -9.771005e-04 -4.269216e-0=
4
> [21] =A07.261694e-05 -1.039668e-03 -8.409151e-03 -3.497456e-03 =A02.21689=
9e-03
> [26] -4.633520e-03 -4.052130e-03 -4.746537e-03 -1.589622e-03 -2.523766e-0=
4
> Parameter:
> =A0[1] -0.76604614 -1.19639662 =A00.83456888 =A00.72540413 =A00.08482452 =
=A00.56180393
> =A0[7] =A00.50615814 =A00.55728015 =A00.83796696 =A00.88371335 -0.7046511=
6 =A00.85251098
> [13] -0.18346956 =A00.66857787 =A00.57012481 =A00.39116561 =A00.91237990 =
=A00.63951482
> [19] =A00.26601566 =A00.29240836 =A00.44710919 =A00.94734056 =A06.5203901=
5 =A00.02524762
> [25] -0.01614603 =A02.88198219 =A00.03442452 =A03.52272237 =A01.44698423 =
-0.72964745
> Function Value
> [1] -15175.94
> Gradient:
> =A0[1] -2.085412e+07 -3.819717e+07 =A03.883989e+07 =A01.352594e+00 -4.283=
329e+00
> =A0[6] -1.437250e+00 -6.558913e-01 =A01.358276e+00 =A07.930865e+05 -1.293=
853e+06
> [11] -5.816627e+03 =A05.908197e+05 -2.705742e+08 -1.194400e+07 -4.007083e=
+07
> [16] -4.143068e+07 -6.159782e-01 =A01.044274e-01 -8.591048e+00 -2.083471e=
+00
> [21] -7.548753e-01 -5.418994e-01 -2.799228e+02 -1.321739e+07 -3.517728e+0=
7
> [26] -7.106654e+02 -7.335293e+06 -7.335285e+05 =A03.117764e-01 -2.234989e=
+04
>
> Abort trap
> swiss:data$
>
> ...I have also seen convergence reached, and nlm then die with this messa=
ge:
>
> Error in nlm(if (analytic.gradient) objective.2 else objective.1, start,
> :
> =A0 type 27 is unimplemented in 'type2char'
>
> (similar to above, but now referring to type 27)
>
> I have shown this effect (or something similar...never know how it'll fai=
l
> next) on the following platforms:
>
>> version
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
> platform =A0 =A0 =A0 i386-apple-darwin9.7.0
> arch =A0 =A0 =A0 =A0 =A0 i386
> os =A0 =A0 =A0 =A0 =A0 =A0 darwin9.7.0
> system =A0 =A0 =A0 =A0 i386, darwin9.7.0
> status
> major =A0 =A0 =A0 =A0 =A02
> minor =A0 =A0 =A0 =A0 =A09.1
> year =A0 =A0 =A0 =A0 =A0 2009
> month =A0 =A0 =A0 =A0 =A006
> day =A0 =A0 =A0 =A0 =A0 =A026
> svn rev =A0 =A0 =A0 =A048839
> language =A0 =A0 =A0 R
> version.string R version 2.9.1 (2009-06-26)
>
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> i386-apple-darwin9.8.0
>
> locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets =A0methods=
 =A0 base
>
> other attached packages:
> [1] sem_0.9-17
>
> loaded via a namespace (and not attached):
> [1] tcltk_2.9.1 tools_2.9.1
>
> (I admit to having compiled this version of R myself (to link to a
> hand-compiled ATLAS), though no errors were thrown in the compilation sta=
ge.
> I compiled using this config string, at first...
>
> ./configure --prefix=3D/usr/local --with-x --disable-R-framework --enable=
-threads=3Dposix --with-blas=3D"/usr/local/lib/libptf77blas.a /usr/local/li=
b/libptcblas.a /usr/local/lib/libatlas.a -lpthread" --with-lapack=3D"/usr/l=
ocal/lib/liblapack.a /usr/local/lib/libptf77blas.a /usr/local/lib/libptcbla=
s.a /usr/local/lib/libatlas.a -lpthread" --without-aqua CFLAGS=3D"-O3 -mtun=
e=3Dnocona -m32" CXXFLAGS=3D"-O3 -mtune=3Dnocona -m32" FFLAGS=3D"-O3 -mtune=
=3Dnocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" F77FLAG=
S=3D"-O3 -mtune=3Dnocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gf=
ortran" FCFLAGS=3D"-O3 -mtune=3Dnocona -m32 -L/usr/lib/gcc/i686-apple-darwi=
n9/4.2.1 -l gfortran" LDFLAGS=3D"-m32 -L/sw/lib" CPPFLAGS=3D"-I/sw/include"=
 CC=3Dgcc-4.2 F77=3Dgfortran-4.2 FC=3Dgfortran-4.2 CXX=3Dg++-4.2 OBJC=3Dgcc=
-4.2
>
> ...though I have also recompiled using simply this:
>
> ./configure --prefix=3D/usr/local --with-x --disable-R-framework
>
> ...and then re-installed SEM, and I got a few other, different error
> messages and core dumps, "including type 11 is unimplemented in 'type2cha=
r'"
> and "cannot coerce type 'weakref' to vector of type 'double'". =A0Running=
 with
> debug=3DTRUE also segfaults sometimes, even after achieving "Current iter=
ate
> is probably solution" status.)
>
>> version
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
> platform =A0 =A0 =A0 x86_64-unknown-linux-gnu
> arch =A0 =A0 =A0 =A0 =A0 x86_64
> os =A0 =A0 =A0 =A0 =A0 =A0 linux-gnu
> system =A0 =A0 =A0 =A0 x86_64, linux-gnu
> status
> major =A0 =A0 =A0 =A0 =A02
> minor =A0 =A0 =A0 =A0 =A09.1
> year =A0 =A0 =A0 =A0 =A0 2009
> month =A0 =A0 =A0 =A0 =A006
> day =A0 =A0 =A0 =A0 =A0 =A026
> svn rev =A0 =A0 =A0 =A048839
> language =A0 =A0 =A0 R
> version.string R version 2.9.1 (2009-06-26)
>
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> x86_64-unknown-linux-gnu
>
> locale:
> LC_CTYPE=3Den_US;LC_NUMERIC=3DC;LC_TIME=3Den_US;LC_COLLATE=3Den_US;LC_MON=
ETARY=3DC;LC_MESSAGES=3Den_US;LC_PAPER=3Den_US;LC_NAME=3DC;LC_ADDRESS=3DC;L=
C_TELEPHONE=3DC;LC_MEASUREMENT=3Den_US;LC_IDENTIFICATION=3DC
>
> attached base packages:
> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets =A0methods=
 =A0 base
>
> other attached packages:
> [1] sem_0.9-17
>
> ...however, THIS platform does NOT show the bug:
>
>> version
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
> platform =A0 =A0 =A0 powerpc-unknown-linux-gnu
> arch =A0 =A0 =A0 =A0 =A0 powerpc
> os =A0 =A0 =A0 =A0 =A0 =A0 linux-gnu
> system =A0 =A0 =A0 =A0 powerpc, linux-gnu
> status
> major =A0 =A0 =A0 =A0 =A02
> minor =A0 =A0 =A0 =A0 =A09.1
> year =A0 =A0 =A0 =A0 =A0 2009
> month =A0 =A0 =A0 =A0 =A006
> day =A0 =A0 =A0 =A0 =A0 =A026
> svn rev =A0 =A0 =A0 =A048839
> language =A0 =A0 =A0 R
> version.string R version 2.9.1 (2009-06-26)
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> powerpc-unknown-linux-gnu
>
> locale:
> LC_CTYPE=3Den_US.UTF-8;LC_NUMERIC=3DC;LC_TIME=3Den_US.UTF-8;LC_COLLATE=3D=
en_US.UTF-8;LC_MONETARY=3DC;LC_MESSAGES=3Den_US.UTF-8;LC_PAPER=3Den_US.UTF-=
8;LC_NAME=3DC;LC_ADDRESS=3DC;LC_TELEPHONE=3DC;LC_MEASUREMENT=3Den_US.UTF-8;=
LC_IDENTIFICATION=3DC
>
> attached base packages:
> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets =A0methods=
 =A0 base
>
> other attached packages:
> [1] sem_0.9-17
>>
>
> ...for this system, the model simply repeatedly fails to converge, whethe=
r
> debug is set or not.
>
> I have also tried altering my model. This has resulted in the same bugs, =
but
> instead of "every so often simply not converging," it actually converges =
and
> appears to be the model I asked R to solve...but this is rare.
>
> Please let me know if I can provide any other info.
>
> Cordially,
> Adam D. I. Kramer
> --1660387551-1458482416-1249639718=3D:2997
> Content-Type: AUDIO/X-PN-REALAUDIO; NAME=3Dice.ram
> Content-Transfer-Encoding: BASE64
> Content-ID: <Pine.LNX.4.64.0908070308380.2997 at parser.ilovebacon.org>
> Content-Description:
> Content-Disposition: ATTACHMENT; FILENAME=3Dice.ram
>
> aW1wb3J0YW50IDwtLSBjaGFsbGVuZ2UsIE5BLCAxCmNvbXBsZXggIDwtLSBj
> aGFsbGVuZ2UsIGMuY29tcGxleCwgTkEKZGlmZmljdWx0IDwtLSBjaGFsbGVu
> Z2UsIGMuZGlmZmljdWx0LCBOQQptYW55ZGltZW5zaW9ucyA8LS0gY2hhbGxl
> bmdlLCBjLm1hbnlkaW1lbnNpb25zLCBOQQpjb3VsZGF2b2lkIDwtLSBjaGFs
> bGVuZ2UsIGMuY291bGRhdm9pZCwgTkEKb25seXNlbGYgPC0tIGNoYWxsZW5n
> ZSwgYy5vbmx5c2VsZiwgTkEKCndhc3JpZ2h0Y2hvaWNlIDwtLSBldmFsLCBO
> QSwgMQp0ZWxsZ29vZCA8LS0gZXZhbCwgZS50ZWxsZ29vZCwgTkEKdGVsbGJl
> c3QgPC0tIGV2YWwsIGUudGVsbGJlc3QsIE5BCm5lZ291dGNvbWUgPC0tIGV2
> YWwsIGUubmVnb3V0Y29tZSwgTkEKCmVxdWFsaW5mbyA8LS0gaW5mb3JtZWQs
> IE5BLCAxCmNvbnRyb2wgPC0tIGluZm9ybWVkLCBpLmNvbnRyb2wsIE5BCmRl
> c2lyZWQgPC0tIGluZm9ybWVkLCBpLmRlc2lyZWQsIE5BCmhvd211Y2hpbmZv
> IDwtLSBpbmZvcm1lZCwgaS5ob3dtdWNoaW5mbywgTkEKcG9zb3V0Y29tZSA8
> LS0gaW5mb3JtZWQsIGkucG9zb3V0Y29tZSwgTkEKCndhc3JpZ2h0Y2hvaWNl
> IDwtPiB3YXNyaWdodGNob2ljZSwgd2FzcmlnaHRjaG9pY2VWLCBOQQp0ZWxs
> Z29vZCA8LT4gdGVsbGdvb2QsIHRlbGxnb29kViwgTkEKdGVsbGJlc3QgPC0+
> IHRlbGxiZXN0LCB0ZWxsYmVzdFYsIE5BCm5lZ291dGNvbWUgPC0+IG5lZ291
> dGNvbWUsIG5lZ291dGNvbWVWLCBOQQoKb25seXNlbGYgPC0+IG9ubHlzZWxm
> LCBvbmx5c2VsZlYsIE5BCmltcG9ydGFudCA8LT4gaW1wb3J0YW50LCBpbXBv
> cnRhbnRWLCBOQQpjb21wbGV4IDwtPiBjb21wbGV4LCBjb21wbGV4ViwgTkEK
> ZGlmZmljdWx0IDwtPiBkaWZmaWN1bHQsIGRpZmZpY3VsdFYsIE5BCm1hbnlk
> aW1lbnNpb25zIDwtPiBtYW55ZGltZW5zaW9ucywgbWFueWRpbWVuc2lvbnNW
> LCBOQQpjb3VsZGF2b2lkIDwtPiBjb3VsZGF2b2lkLCBjb3VsZGF2b2lkViwg
> TkEKCmVxdWFsaW5mbyA8LT4gZXF1YWxpbmZvLCBlcXVhbGluZm9WLCBOQQpj
> b250cm9sIDwtPiBjb250cm9sLCBjb250cm9sViwgTkEKZGVzaXJlZCA8LT4g
> ZGVzaXJlZCwgZGVzaXJlZFYsIE5BCmhvd211Y2hpbmZvIDwtPiBob3dtdWNo
> aW5mbywgaG93bXVjaGluZm9WLCBOQQpwb3NvdXRjb21lIDwtPiBwb3NvdXRj
> b21lLCBwb3NvdXRjb21lViwgTkEKCmV2YWwgPC0+IGV2YWwsIGV2YWxWLCBO
> QQpjaGFsbGVuZ2UgPC0+IGNoYWxsZW5nZSwgY2hhbGxlbmdlViwgTkEKaW5m
> b3JtZWQgPC0+IGluZm9ybWVkLCBpbmZvcm1lZFYsIE5BCg=3D=3D
>
> --1660387551-1458482416-1249639718=3D:2997
> Content-Type: TEXT/CSV; CHARSET=3DUS-ASCII; NAME=3DiceS.csv
> Content-Transfer-Encoding: BASE64
> Content-ID: <Pine.LNX.4.64.0908070308381.2997 at parser.ilovebacon.org>
> Content-Description:
> Content-Disposition: ATTACHMENT; FILENAME=3DiceS.csv
>
> IiIsIndhc3JpZ2h0Y2hvaWNlIiwidGVsbGdvb2QiLCJ0ZWxsYmVzdCIsImlt
> cG9ydGFudCIsImNvbXBsZXgiLCJkaWZmaWN1bHQiLCJvbmx5c2VsZiIsIm1h
> bnlkaW1lbnNpb25zIiwiaG93bXVjaGluZm8iLCJlcXVhbGluZm8iLCJjb3Vs
> ZGF2b2lkIiwicG9zb3V0Y29tZSIsIm5lZ291dGNvbWUiLCJjb250cm9sIiwi
> ZGVzaXJlZCINCiJ3YXNyaWdodGNob2ljZSIsMC45NjM2OTc3MzE3ODk2Myww
> LjI5MjczNjMyMTIyOTY0NywwLjI4OTg1MjgwODQ4OTExNywwLjM4NTI2Njk2
> NTM2Mjc2MSwwLjE5NzY0NDgyNDY5NjMyMCwwLjE4MzA0MTMyNDA2MjI5OCwt
> MC4xNDY2MjYzNDcyMTk4NzksMC4xNDYzNTQwMjc3OTcxMDEsLTAuMTMyODg3
> NTk2OTAyNTA2LC0wLjE3Mzk2NTA2OTExMTAyNSwtMC4yNjg0NTkxNjI5MzA1
> NjcsLTAuMDY3ODA5NTM3NTA3NjIyMiwwLjE4MDU0OTkyNTAyNDM3NywtMC4w
> NDIwODQ0MzY0MDM3ODc0LC0wLjA3MzA1Nzc4OTY5MDI5NjcNCiJ0ZWxsZ29v
> ZCIsMC4yOTI3MzYzMjEyMjk2NDcsMC45NTU0OTQyNDYyMTA4NTYsMC43NTc1
> NDQxOTMzMzk1NjYsMC4xOTEyNDExODMyMDMxMjksMC4wMDAxNzQ2MzA0MTc1
> NjQ2ODgsMC4wMDM0MDg4NzExODA3MTI4NywwLjAwOTYzMDUwNDc0MzU4MDM0
> LDAuMDI4Mzg5NDM3MzMxNjY4NCwwLjAxODgwMjc1Mzk0NjMyOTksLTAuMDE1
> NzAyNjM4MTUxNTk4NSwtMC4xNDU3OTUwMDY3NDE4ODQsMC4xNDIwMzQzOTY5
> MDY4NzksMC4wMDk4MTUzODM5ODQzNDg1MSwwLjA3MDU4Njg3NTY1Mzk3MzIs
> MC4xMDgwMDA0NDkzMjgzMTMNCiJ0ZWxsYmVzdCIsMC4yODk4NTI4MDg0ODkx
> MTcsMC43NTc1NDQxOTMzMzk1NjYsMC45NDg1OTM1OTA5MTI0MDgsMC4yMzA1
> OTg5NTg1OTc1MjgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuMDE1NTQ0NzA1NTc4
> MzEyMiwwLjAzMjE2OTMyODE5ODg2NjksMC4wNjQ2MzEyMzI2MTg3MDk2LDAu
> MDEwMjk0NTA4NTY1MTI0NiwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE3ODc2
> NTU2MzM1NDgyOCwwLjE1MTM0MzU2Nzc2MTg1OSwtMC4wMzM2NTU5MDYzMzA3
> ODM1LDAuMDkyOTA2MjI3OTMzNDg5OCwwLjE1OTczNTYxODQyMzMzNQ0KImlt
> cG9ydGFudCIsMC4zODUyNjY5NjUzNjI3NjEsMC4xOTEyNDExODMyMDMxMjks
> MC4yMzA1OTg5NTg1OTc1MjgsMC45NjQ0OTc4ODAzNDM2MSwwLjY0NzY1NzE0
> MTQ4ODM3NSwwLjUxNDE3NTk3NDU1NDExNCwtMC4xOTc1MDY3MDU5MTcxMjMs
> MC40NzQ3MjMzMzI0Njk4NzUsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE4OTIy
> OTEyMzcwNTM0MSwtMC40NjIxOTU4MzkyNjUwMzUsMC4xMjQxNTgzMzk1Mjcz
> MjIsMC4xNjA2NjEzMDc0ODY1NTksLTAuMDg2NDU3MzcyNzQ2NjI2NSwtMC4w
> NjgzNjc0ODQyNDk4ODAxDQoiY29tcGxleCIsMC4xOTc2NDQ4MjQ2OTYzMjAs
> MC4wMDAxNzQ2MzA0MTc1NjQ2ODgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuNjQ3
> NjU3MTQxNDg4Mzc1LDAuOTc2MzIxNjU1NzYyOTY4LDAuNzU0OTc4Nzc3MzA5
> NTUzLC0wLjI2MjM0MDQyNTgyNDA1MiwwLjY1NjcxNzUzMzM2MTE3NiwtMC4x
> NjA0MjcxMzk2NzMwMTgsLTAuMjM2MjEwODU2MDgzOTAyLC0wLjM4NTQ1MjEw
> MDA0NjYyMywwLjAyMzg3NzU3MjgyNzcxNTcsMC4zMjQ1MjU2NTMxNjQ1MDgs
> LTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzMzY5NjU1NDE4OTE2NA0KImRpZmZp
> Y3VsdCIsMC4xODMwNDEzMjQwNjIyOTgsMC4wMDM0MDg4NzExODA3MTI4Nyww
> LjAxNTU0NDcwNTU3ODMxMjIsMC41MTQxNzU5NzQ1NTQxMTQsMC43NTQ5Nzg3
> NzczMDk1NTMsMC45NTczMjQzNDE2NjE5NzIsLTAuMTgzMDA1NTg3NTUxNjI0
> LDAuNTIzMTgzOTkzODk3NjMyLC0wLjE5NzgzMzM1NDQzMDkwNywtMC4yMjg0
> MzQ3MTMwNjE3NzYsLTAuMjYzNTg3NzQ2MDIxMTc0LC0wLjA0NTM5NzEzNzc3
> MDA4NDUsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMjM0NzA3NTE3Njc3NTg2LC0w
> LjIzOTEyNjk3MTQ4MDYyNQ0KIm9ubHlzZWxmIiwtMC4xNDY2MjYzNDcyMTk4
> NzksMC4wMDk2MzA1MDQ3NDM1ODAzNCwwLjAzMjE2OTMyODE5ODg2NjksLTAu
> MTk3NTA2NzA1OTE3MTIzLC0wLjI2MjM0MDQyNTgyNDA1MiwtMC4xODMwMDU1
> ODc1NTE2MjQsMC45NDc4NTI0MTU0NDM2NjMsLTAuMjY4MzMzOTc5Mjk1NjEy
> LDAuMDc4NzE5MTg3OTIxNTY1NCwwLjA4MDA1NTQ0MzA5MzgwMzYsMC4xNjM1
> OTUyNzc0OTg3NTgsLTAuMDA1MDcyNjg2MDg0MTc3MDQsLTAuMTYwMTM3NTQ1
> ODcxNDQ4LDAuMjExMjU3MjUyMjg3OTc5LDAuMTQ3ODg0MzUyNTg4NDk5DQoi
> bWFueWRpbWVuc2lvbnMiLDAuMTQ2MzU0MDI3Nzk3MTAxLDAuMDI4Mzg5NDM3
> MzMxNjY4NCwwLjA2NDYzMTIzMjYxODcwOTYsMC40NzQ3MjMzMzI0Njk4NzUs
> MC42NTY3MTc1MzMzNjExNzYsMC41MjMxODM5OTM4OTc2MzIsLTAuMjY4MzMz
> OTc5Mjk1NjEyLDAuOTQ5OTE3NjYyNjE2MTYsLTAuMTEzMjk1NjY3NDA4MTc3
> LC0wLjE4MTU3NjQ3MzE3MDc4NCwtMC4yNzkyOTg0MTcxNzcyNjEsMC4wNDQy
> NDgxMjM1MDgyNTI4LDAuMjU4MzQ5NzAyNDYwNjYzLC0wLjE5Njk5MzM0NjMz
> NzIxNCwtMC4yMjI1MzM5NTI2MzM0ODINCiJob3dtdWNoaW5mbyIsLTAuMTMy
> ODg3NTk2OTAyNTA2LDAuMDE4ODAyNzUzOTQ2MzI5OSwwLjAxMDI5NDUwODU2
> NTEyNDYsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE2MDQyNzEzOTY3MzAxOCwt
> MC4xOTc4MzMzNTQ0MzA5MDcsMC4wNzg3MTkxODc5MjE1NjU0LC0wLjExMzI5
> NTY2NzQwODE3NywwLjk0NjcyMjc0NjEzNzQxNSwwLjcwNjk3NjAxNTU4MjIx
> OCwwLjA5MjMxOTI3MDQ0Mzk5MzQsMC4yMTMwMzIyNDI0NzMzMTUsLTAuMjA5
> ODgyNDMxNzY1MTEwLDAuMjM5MTI0NTUxNjI5NTU5LDAuMjE5MDc4MzUyODkw
> NjU3DQoiZXF1YWxpbmZvIiwtMC4xNzM5NjUwNjkxMTEwMjUsLTAuMDE1NzAy
> NjM4MTUxNTk4NSwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE4OTIyOTEyMzcw
> NTM0MSwtMC4yMzYyMTA4NTYwODM5MDIsLTAuMjI4NDM0NzEzMDYxNzc2LDAu
> MDgwMDU1NDQzMDkzODAzNiwtMC4xODE1NzY0NzMxNzA3ODQsMC43MDY5NzYw
> MTU1ODIyMTgsMC45NjQ1MTc1NjI3NzgzMjgsMC4xODA1MTczMjU3NTIzODcs
> MC4xNjM4NDQ2NDA0OTU5ODMsLTAuMjEzODA0NTUwMDQzMjM5LDAuMjU4MDMy
> MzIyODI0NTk5LDAuMTkxODIwNDQ3NDA0MzM1DQoiY291bGRhdm9pZCIsLTAu
> MjY4NDU5MTYyOTMwNTY3LC0wLjE0NTc5NTAwNjc0MTg4NCwtMC4xNzg3NjU1
> NjMzNTQ4MjgsLTAuNDYyMTk1ODM5MjY1MDM1LC0wLjM4NTQ1MjEwMDA0NjYy
> MywtMC4yNjM1ODc3NDYwMjExNzQsMC4xNjM1OTUyNzc0OTg3NTgsLTAuMjc5
> Mjk4NDE3MTc3MjYxLDAuMDkyMzE5MjcwNDQzOTkzNCwwLjE4MDUxNzMyNTc1
> MjM4NywwLjk2MzIzNzMwOTczMDcyNiwtMC4xMjAxMzAxOTYzOTI0MDYsLTAu
> MDY4OTY1OTY1NzA1NzA5MSwwLjE2NTUzMzIwODc0MzU0NywwLjE5MTQyMTEz
> NDE4OTY4Mg0KInBvc291dGNvbWUiLC0wLjA2NzgwOTUzNzUwNzYyMjIsMC4x
> NDIwMzQzOTY5MDY4NzksMC4xNTEzNDM1Njc3NjE4NTksMC4xMjQxNTgzMzk1
> MjczMjIsMC4wMjM4Nzc1NzI4Mjc3MTU3LC0wLjA0NTM5NzEzNzc3MDA4NDUs
> LTAuMDA1MDcyNjg2MDg0MTc3MDQsMC4wNDQyNDgxMjM1MDgyNTI4LDAuMjEz
> MDMyMjQyNDczMzE1LDAuMTYzODQ0NjQwNDk1OTgzLC0wLjEyMDEzMDE5NjM5
> MjQwNiwwLjkzOTEwNzcxNzE4NjM4NSwtMC4yOTEyNjIzOTE4Mjc2NzEsMC4y
> NTYyNzQxOTU5ODMwMDQsMC4zNDY0NDE0MTExMTYxNDcNCiJuZWdvdXRjb21l
> IiwwLjE4MDU0OTkyNTAyNDM3NywwLjAwOTgxNTM4Mzk4NDM0ODUxLC0wLjAz
> MzY1NTkwNjMzMDc4MzUsMC4xNjA2NjEzMDc0ODY1NTksMC4zMjQ1MjU2NTMx
> NjQ1MDgsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMTYwMTM3NTQ1ODcxNDQ4LDAu
> MjU4MzQ5NzAyNDYwNjYzLC0wLjIwOTg4MjQzMTc2NTExMCwtMC4yMTM4MDQ1
> NTAwNDMyMzksLTAuMDY4OTY1OTY1NzA1NzA5MSwtMC4yOTEyNjIzOTE4Mjc2
> NzEsMC45NTI1NTI5NjU3OTY0MjEsLTAuMjIxOTE3MjIyOTMwMTksLTAuMjMx
> MDMyMDE0OTI3Mzk3DQoiY29udHJvbCIsLTAuMDQyMDg0NDM2NDAzNzg3NCww
> LjA3MDU4Njg3NTY1Mzk3MzIsMC4wOTI5MDYyMjc5MzM0ODk4LC0wLjA4NjQ1
> NzM3Mjc0NjYyNjUsLTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzNDcwNzUxNzY3
> NzU4NiwwLjIxMTI1NzI1MjI4Nzk3OSwtMC4xOTY5OTMzNDYzMzcyMTQsMC4y
> MzkxMjQ1NTE2Mjk1NTksMC4yNTgwMzIzMjI4MjQ1OTksMC4xNjU1MzMyMDg3
> NDM1NDcsMC4yNTYyNzQxOTU5ODMwMDQsLTAuMjIxOTE3MjIyOTMwMTksMC45
> Mzc2MDc1MzMxODY1NzYsMC4zMTI2NjQxOTk2MzE2MjANCiJkZXNpcmVkIiwt
> MC4wNzMwNTc3ODk2OTAyOTY3LDAuMTA4MDAwNDQ5MzI4MzEzLDAuMTU5NzM1
> NjE4NDIzMzM1LC0wLjA2ODM2NzQ4NDI0OTg4MDEsLTAuMjMzNjk2NTU0MTg5
> MTY0LC0wLjIzOTEyNjk3MTQ4MDYyNSwwLjE0Nzg4NDM1MjU4ODQ5OSwtMC4y
> MjI1MzM5NTI2MzM0ODIsMC4yMTkwNzgzNTI4OTA2NTcsMC4xOTE4MjA0NDc0
> MDQzMzUsMC4xOTE0MjExMzQxODk2ODIsMC4zNDY0NDE0MTExMTYxNDcsLTAu
> MjMxMDMyMDE0OTI3Mzk3LDAuMzEyNjY0MTk5NjMxNjIwLDAuOTYzMTMxNjM5
> NTYwMTA4DQo=3D
>
> --1660387551-1458482416-1249639718=3D:2997--
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



--=20
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From ligges at statistik.tu-dortmund.de  Fri Aug  7 22:01:08 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 07 Aug 2009 22:01:08 +0200
Subject: [Rd] R patched & devel versions as portable ZIP files
In-Reply-To: <loom.20090807T192617-914@post.gmane.org>
References: <loom.20090807T192617-914@post.gmane.org>
Message-ID: <4A7C8804.4000505@statistik.tu-dortmund.de>


- You can tell the installer not to use the registry.
- You can install to a fixed location (e.g. also to the USB stick)
Using both options mentioned above means the same as unpacking a zip 
file over there.

Uwe Ligges


Hans W Borchers wrote:
> I wonder if it would be possible to provide R patched and development versions
> for Windows as simple zip files without using any installers.
> 
> There are more and more free and open source software projects providing
> such portable versions, among them Python (since V2.5), the new MikTex 2.8,
> OpenOffice 3, Firefox and Thunderbird, to name a few. Many smaller Windows
> utilities do the same.
> 
> When regularly following patched and development version, the installation
> procedures and writing into the Windows registry all the time makes me
> feel uneasy. And even with the installation procedure there are subsequent
> tasks, for example changing the path in the shortcut.
> 
> Zip files are much better for those running R from an USB stick because
> otherwise you have to install it on the disk---what maybe you don't want to
> do---and then copy it over to the stick.
> 
> I know there are some concerns with R-(D)COM interface and i assume those using
> it know which versions to install.
> 
> Thanks
> Hans Werner Borchers
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Fri Aug  7 22:06:28 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Aug 2009 16:06:28 -0400
Subject: [Rd] R patched & devel versions as portable ZIP files
In-Reply-To: <loom.20090807T192617-914@post.gmane.org>
References: <loom.20090807T192617-914@post.gmane.org>
Message-ID: <4A7C8944.6030902@stats.uwo.ca>

On 8/7/2009 3:35 PM, Hans W Borchers wrote:
> I wonder if it would be possible to provide R patched and development versions
> for Windows as simple zip files without using any installers.

Yes, it would be quite easy to do.  I'll set R-devel to do it as of 
tomorrow's build; let me know if the format is fine for you, and I'll do 
it for R-patched once the bugs are worked out.

Duncan Murdoch

> 
> There are more and more free and open source software projects providing
> such portable versions, among them Python (since V2.5), the new MikTex 2.8,
> OpenOffice 3, Firefox and Thunderbird, to name a few. Many smaller Windows
> utilities do the same.
> 
> When regularly following patched and development version, the installation
> procedures and writing into the Windows registry all the time makes me
> feel uneasy. And even with the installation procedure there are subsequent
> tasks, for example changing the path in the shortcut.
> 
> Zip files are much better for those running R from an USB stick because
> otherwise you have to install it on the disk---what maybe you don't want to
> do---and then copy it over to the stick.
> 
> I know there are some concerns with R-(D)COM interface and i assume those using
> it know which versions to install.
> 
> Thanks
> Hans Werner Borchers
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From adik at ilovebacon.org  Sat Aug  8 00:32:29 2009
From: adik at ilovebacon.org (Adam D. I. Kramer)
Date: Fri, 7 Aug 2009 15:32:29 -0700 (PDT)
Subject: [Rd] Bug in nlm, found using sem;
 failure in several flavors  (PR#13881)
In-Reply-To: <e8e755250908071235v221bdc20v48363bb4b58d6af7@mail.gmail.com>
References: <20090807181017.540BD282EF29@mail.pubhealth.ku.dk>
	<e8e755250908071235v221bdc20v48363bb4b58d6af7@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0908071525410.2997@parser.ilovebacon.org>

Hi Jeff,

 	As mentioned in my message, I *did* replicate on another platform. 
One platform was running linux in a VM, the other running MacOSX, on two
different physical machines.  The problem did not replicate on a PowerPC
box, so if it is a bug with intel chips, I think it's also appropriate to
report here given that the problem seems to cross the OS boundary.  I do not
have access to a Windows machine.

 	Also, I have spent a decent amount of time running memory testers on
the first machine's memory, to ensure that physical memory is not a
problem...the classic "memcheck" program finds no trouble.

 	The CSV and .ram files both came through as base-64-encoded
attachments, which you actually quoted back to me in your response,
below...but in case your mail client can't read those and/or you are
interested in this bug, I have pasted them at the end of this message (since
they're quite small).

 	And thanks for the shout-out for bacon. I bought this domain name in
undergrad many years ago, and I must say, I've never regretted it!

--Adam

On Fri, 7 Aug 2009, Jeff Ryan wrote:

> Adam,
>
> It seems that your attachment didn't make it through.
>
> That aside, my experience with strange errors like those (random type
> not implemented ones) has been that you may be looking at a memory
> problem on you machine. Given that you can't replicate on another
> platform (and the .csv file didn't come through), I would think it
> wise to start there.
>
> My 2c.  And I love bacon too :)
>
> Jeff
>
> On Fri, Aug 7, 2009 at 1:10 PM, <adik at ilovebacon.org> wrote:
>> ?This message is in MIME format. ?The first part should be readable text,
>> ?while the remaining parts are likely unreadable without MIME-aware tools.
>>
>> --1660387551-1458482416-1249639718=:2997
>> Content-Type: TEXT/PLAIN; CHARSET=US-ASCII; FORMAT=flowed
>> Content-ID: <Pine.LNX.4.64.0908071039211.2997 at parser.ilovebacon.org>
>>
>> Hello,
>>
>> ? ? ? ?There appears to be a bug in the nlm function, which I discovered
>> when trying to run an SEM. ?The SEM is not bizarre; the covariance matrix is
>> solve-able and the eigenvalues are greater than zero, and I do not believe
>> the "sem" package per se to be the problem (as nlm keeps being the part that
>> fails, though I can't replicate this with other nlm tasks). ?I apologize if
>> I have put too many much information in this message; I'm not a programmer
>> by trade so I don't really know what's going on here, which hampers my
>> ability to write consise bug reports.
>>
>> Here is the code I use:
>>
>> library(sem)
>> ice.S <- read.csv("iceS.csv") # attached
>> rownames(ice.S) <- ice.S[,1]
>> ice.S[,1] <- NULL
>> ice.S <- as.matrix(ice.S)
>> ice.ram <- specify.model("ice.ram") # attached
>> ice.N <- 342
>> ice.sem <- sem(ram=ice.ram, S=ice.S, N=ice.N)
>>
>> ...at this point, any number of problems could occur. I have seen the
>> following.
>>
>> 1) Simple lack of convergence. (might be my model's fault.)
>> 2) Error in nlm(if (analytic.gradient) objective.2 else objective.1, start,
>> :
>> ? type 31 is unimplemented in 'type2char'
>> 3) ?*** caught segfault ***
>> address 0xc019c87b, cause 'memory not mapped'
>>
>> Traceback:
>> ?1: nlm(if (analytic.gradient) objective.2 else objective.1, start,
>> hessian = TRUE, iterlim = maxiter, print.level = if (debug) 2 else 0,
>> typsize = typsize, ...)
>> ?2: sem.default(ram = ram, S = S, N = N, param.names = pars, var.names =
>> vars, ? ? fixed.x = fixed.x, debug = debug, ...)
>> ?3: sem(ram = ram, S = S, N = N, param.names = pars, var.names = vars,
>> fixed.x = fixed.x, debug = debug, ...)
>> ?4: sem.mod(ram = ice.ram, S = ice.S, N = ice.N)
>> ?5: sem(ram = ice.ram, S = ice.S, N = ice.N)
>>
>> Possible actions:
>> 1: abort (with core dump, if enabled)
>> 2: normal R exit
>> 3: exit R without saving workspace
>> 4: exit R saving workspace
>> Selection: 1
>> aborting ...
>> Segmentation fault
>> swiss:data$
>>
>> (no core was dumped).
>>
>> Trying with debug mode provides other interesting errors:
>>
>>> ice.sem <- sem(ram=ice.ram, S=ice.S, N=ice.N, debug=TRUE)
>>
>> ...gets up to some iteration (not always 15), and then R dies ungracefully,
>> and exits to the shell:
>>
>> iteration = 15
>> Step:
>> ?[1] ?1.253132e-02 ?1.183343e-02 -7.651342e-03 -2.490800e-03 ?2.278938e-03
>> ?[6] ?3.197431e-04 ?6.137849e-04 -2.496882e-03 -1.065829e-03 -2.118179e-03
>> [11] ?2.942936e-03 -1.335936e-03 -3.665618e-03 ?3.090566e-03 ?8.534956e-04
>> [16] -1.440421e-03 -5.230877e-04 -1.053686e-04 -9.771005e-04 -4.269216e-04
>> [21] ?7.261694e-05 -1.039668e-03 -8.409151e-03 -3.497456e-03 ?2.216899e-03
>> [26] -4.633520e-03 -4.052130e-03 -4.746537e-03 -1.589622e-03 -2.523766e-04
>> Parameter:
>> ?[1] -0.76604614 -1.19639662 ?0.83456888 ?0.72540413 ?0.08482452 ?0.56180393
>> ?[7] ?0.50615814 ?0.55728015 ?0.83796696 ?0.88371335 -0.70465116 ?0.85251098
>> [13] -0.18346956 ?0.66857787 ?0.57012481 ?0.39116561 ?0.91237990 ?0.63951482
>> [19] ?0.26601566 ?0.29240836 ?0.44710919 ?0.94734056 ?6.52039015 ?0.02524762
>> [25] -0.01614603 ?2.88198219 ?0.03442452 ?3.52272237 ?1.44698423 -0.72964745
>> Function Value
>> [1] -15175.94
>> Gradient:
>> ?[1] -2.085412e+07 -3.819717e+07 ?3.883989e+07 ?1.352594e+00 -4.283329e+00
>> ?[6] -1.437250e+00 -6.558913e-01 ?1.358276e+00 ?7.930865e+05 -1.293853e+06
>> [11] -5.816627e+03 ?5.908197e+05 -2.705742e+08 -1.194400e+07 -4.007083e+07
>> [16] -4.143068e+07 -6.159782e-01 ?1.044274e-01 -8.591048e+00 -2.083471e+00
>> [21] -7.548753e-01 -5.418994e-01 -2.799228e+02 -1.321739e+07 -3.517728e+07
>> [26] -7.106654e+02 -7.335293e+06 -7.335285e+05 ?3.117764e-01 -2.234989e+04
>>
>> Abort trap
>> swiss:data$
>>
>> ...I have also seen convergence reached, and nlm then die with this message:
>>
>> Error in nlm(if (analytic.gradient) objective.2 else objective.1, start,
>> :
>> ? type 27 is unimplemented in 'type2char'
>>
>> (similar to above, but now referring to type 27)
>>
>> I have shown this effect (or something similar...never know how it'll fail
>> next) on the following platforms:
>>
>>> version
>> ? ? ? ? ? ? ? ?_
>> platform ? ? ? i386-apple-darwin9.7.0
>> arch ? ? ? ? ? i386
>> os ? ? ? ? ? ? darwin9.7.0
>> system ? ? ? ? i386, darwin9.7.0
>> status
>> major ? ? ? ? ?2
>> minor ? ? ? ? ?9.1
>> year ? ? ? ? ? 2009
>> month ? ? ? ? ?06
>> day ? ? ? ? ? ?26
>> svn rev ? ? ? ?48839
>> language ? ? ? R
>> version.string R version 2.9.1 (2009-06-26)
>>
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26)
>> i386-apple-darwin9.8.0
>>
>> locale:
>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] sem_0.9-17
>>
>> loaded via a namespace (and not attached):
>> [1] tcltk_2.9.1 tools_2.9.1
>>
>> (I admit to having compiled this version of R myself (to link to a
>> hand-compiled ATLAS), though no errors were thrown in the compilation stage.
>> I compiled using this config string, at first...
>>
>> ./configure --prefix=/usr/local --with-x --disable-R-framework --enable-threads=posix --with-blas="/usr/local/lib/libptf77blas.a /usr/local/lib/libptcblas.a /usr/local/lib/libatlas.a -lpthread" --with-lapack="/usr/local/lib/liblapack.a /usr/local/lib/libptf77blas.a /usr/local/lib/libptcblas.a /usr/local/lib/libatlas.a -lpthread" --without-aqua CFLAGS="-O3 -mtune=nocona -m32" CXXFLAGS="-O3 -mtune=nocona -m32" FFLAGS="-O3 -mtune=nocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" F77FLAGS="-O3 -mtune=nocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" FCFLAGS="-O3 -mtune=nocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" LDFLAGS="-m32 -L/sw/lib" CPPFLAGS="-I/sw/include" CC=gcc-4.2 F77=gfortran-4.2 FC=gfortran-4.2 CXX=g++-4.2 OBJC=gcc-4.2
>>
>> ...though I have also recompiled using simply this:
>>
>> ./configure --prefix=/usr/local --with-x --disable-R-framework
>>
>> ...and then re-installed SEM, and I got a few other, different error
>> messages and core dumps, "including type 11 is unimplemented in 'type2char'"
>> and "cannot coerce type 'weakref' to vector of type 'double'". ?Running with
>> debug=TRUE also segfaults sometimes, even after achieving "Current iterate
>> is probably solution" status.)
>>
>>> version
>> ? ? ? ? ? ? ? ?_
>> platform ? ? ? x86_64-unknown-linux-gnu
>> arch ? ? ? ? ? x86_64
>> os ? ? ? ? ? ? linux-gnu
>> system ? ? ? ? x86_64, linux-gnu
>> status
>> major ? ? ? ? ?2
>> minor ? ? ? ? ?9.1
>> year ? ? ? ? ? 2009
>> month ? ? ? ? ?06
>> day ? ? ? ? ? ?26
>> svn rev ? ? ? ?48839
>> language ? ? ? R
>> version.string R version 2.9.1 (2009-06-26)
>>
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26)
>> x86_64-unknown-linux-gnu
>>
>> locale:
>> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=C;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] sem_0.9-17
>>
>> ...however, THIS platform does NOT show the bug:
>>
>>> version
>> ? ? ? ? ? ? ? ?_
>> platform ? ? ? powerpc-unknown-linux-gnu
>> arch ? ? ? ? ? powerpc
>> os ? ? ? ? ? ? linux-gnu
>> system ? ? ? ? powerpc, linux-gnu
>> status
>> major ? ? ? ? ?2
>> minor ? ? ? ? ?9.1
>> year ? ? ? ? ? 2009
>> month ? ? ? ? ?06
>> day ? ? ? ? ? ?26
>> svn rev ? ? ? ?48839
>> language ? ? ? R
>> version.string R version 2.9.1 (2009-06-26)
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26)
>> powerpc-unknown-linux-gnu
>>
>> locale:
>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] sem_0.9-17
>>>
>>
>> ...for this system, the model simply repeatedly fails to converge, whether
>> debug is set or not.
>>
>> I have also tried altering my model. This has resulted in the same bugs, but
>> instead of "every so often simply not converging," it actually converges and
>> appears to be the model I asked R to solve...but this is rare.
>>
>> Please let me know if I can provide any other info.
>>
>> Cordially,
>> Adam D. I. Kramer
>> --1660387551-1458482416-1249639718=:2997
>> Content-Type: AUDIO/X-PN-REALAUDIO; NAME=ice.ram
>> Content-Transfer-Encoding: BASE64
>> Content-ID: <Pine.LNX.4.64.0908070308380.2997 at parser.ilovebacon.org>
>> Content-Description:
>> Content-Disposition: ATTACHMENT; FILENAME=ice.ram
>>
>> aW1wb3J0YW50IDwtLSBjaGFsbGVuZ2UsIE5BLCAxCmNvbXBsZXggIDwtLSBj
>> aGFsbGVuZ2UsIGMuY29tcGxleCwgTkEKZGlmZmljdWx0IDwtLSBjaGFsbGVu
>> Z2UsIGMuZGlmZmljdWx0LCBOQQptYW55ZGltZW5zaW9ucyA8LS0gY2hhbGxl
>> bmdlLCBjLm1hbnlkaW1lbnNpb25zLCBOQQpjb3VsZGF2b2lkIDwtLSBjaGFs
>> bGVuZ2UsIGMuY291bGRhdm9pZCwgTkEKb25seXNlbGYgPC0tIGNoYWxsZW5n
>> ZSwgYy5vbmx5c2VsZiwgTkEKCndhc3JpZ2h0Y2hvaWNlIDwtLSBldmFsLCBO
>> QSwgMQp0ZWxsZ29vZCA8LS0gZXZhbCwgZS50ZWxsZ29vZCwgTkEKdGVsbGJl
>> c3QgPC0tIGV2YWwsIGUudGVsbGJlc3QsIE5BCm5lZ291dGNvbWUgPC0tIGV2
>> YWwsIGUubmVnb3V0Y29tZSwgTkEKCmVxdWFsaW5mbyA8LS0gaW5mb3JtZWQs
>> IE5BLCAxCmNvbnRyb2wgPC0tIGluZm9ybWVkLCBpLmNvbnRyb2wsIE5BCmRl
>> c2lyZWQgPC0tIGluZm9ybWVkLCBpLmRlc2lyZWQsIE5BCmhvd211Y2hpbmZv
>> IDwtLSBpbmZvcm1lZCwgaS5ob3dtdWNoaW5mbywgTkEKcG9zb3V0Y29tZSA8
>> LS0gaW5mb3JtZWQsIGkucG9zb3V0Y29tZSwgTkEKCndhc3JpZ2h0Y2hvaWNl
>> IDwtPiB3YXNyaWdodGNob2ljZSwgd2FzcmlnaHRjaG9pY2VWLCBOQQp0ZWxs
>> Z29vZCA8LT4gdGVsbGdvb2QsIHRlbGxnb29kViwgTkEKdGVsbGJlc3QgPC0+
>> IHRlbGxiZXN0LCB0ZWxsYmVzdFYsIE5BCm5lZ291dGNvbWUgPC0+IG5lZ291
>> dGNvbWUsIG5lZ291dGNvbWVWLCBOQQoKb25seXNlbGYgPC0+IG9ubHlzZWxm
>> LCBvbmx5c2VsZlYsIE5BCmltcG9ydGFudCA8LT4gaW1wb3J0YW50LCBpbXBv
>> cnRhbnRWLCBOQQpjb21wbGV4IDwtPiBjb21wbGV4LCBjb21wbGV4ViwgTkEK
>> ZGlmZmljdWx0IDwtPiBkaWZmaWN1bHQsIGRpZmZpY3VsdFYsIE5BCm1hbnlk
>> aW1lbnNpb25zIDwtPiBtYW55ZGltZW5zaW9ucywgbWFueWRpbWVuc2lvbnNW
>> LCBOQQpjb3VsZGF2b2lkIDwtPiBjb3VsZGF2b2lkLCBjb3VsZGF2b2lkViwg
>> TkEKCmVxdWFsaW5mbyA8LT4gZXF1YWxpbmZvLCBlcXVhbGluZm9WLCBOQQpj
>> b250cm9sIDwtPiBjb250cm9sLCBjb250cm9sViwgTkEKZGVzaXJlZCA8LT4g
>> ZGVzaXJlZCwgZGVzaXJlZFYsIE5BCmhvd211Y2hpbmZvIDwtPiBob3dtdWNo
>> aW5mbywgaG93bXVjaGluZm9WLCBOQQpwb3NvdXRjb21lIDwtPiBwb3NvdXRj
>> b21lLCBwb3NvdXRjb21lViwgTkEKCmV2YWwgPC0+IGV2YWwsIGV2YWxWLCBO
>> QQpjaGFsbGVuZ2UgPC0+IGNoYWxsZW5nZSwgY2hhbGxlbmdlViwgTkEKaW5m
>> b3JtZWQgPC0+IGluZm9ybWVkLCBpbmZvcm1lZFYsIE5BCg==
>>
>> --1660387551-1458482416-1249639718=:2997
>> Content-Type: TEXT/CSV; CHARSET=US-ASCII; NAME=iceS.csv
>> Content-Transfer-Encoding: BASE64
>> Content-ID: <Pine.LNX.4.64.0908070308381.2997 at parser.ilovebacon.org>
>> Content-Description:
>> Content-Disposition: ATTACHMENT; FILENAME=iceS.csv
>>
>> IiIsIndhc3JpZ2h0Y2hvaWNlIiwidGVsbGdvb2QiLCJ0ZWxsYmVzdCIsImlt
>> cG9ydGFudCIsImNvbXBsZXgiLCJkaWZmaWN1bHQiLCJvbmx5c2VsZiIsIm1h
>> bnlkaW1lbnNpb25zIiwiaG93bXVjaGluZm8iLCJlcXVhbGluZm8iLCJjb3Vs
>> ZGF2b2lkIiwicG9zb3V0Y29tZSIsIm5lZ291dGNvbWUiLCJjb250cm9sIiwi
>> ZGVzaXJlZCINCiJ3YXNyaWdodGNob2ljZSIsMC45NjM2OTc3MzE3ODk2Myww
>> LjI5MjczNjMyMTIyOTY0NywwLjI4OTg1MjgwODQ4OTExNywwLjM4NTI2Njk2
>> NTM2Mjc2MSwwLjE5NzY0NDgyNDY5NjMyMCwwLjE4MzA0MTMyNDA2MjI5OCwt
>> MC4xNDY2MjYzNDcyMTk4NzksMC4xNDYzNTQwMjc3OTcxMDEsLTAuMTMyODg3
>> NTk2OTAyNTA2LC0wLjE3Mzk2NTA2OTExMTAyNSwtMC4yNjg0NTkxNjI5MzA1
>> NjcsLTAuMDY3ODA5NTM3NTA3NjIyMiwwLjE4MDU0OTkyNTAyNDM3NywtMC4w
>> NDIwODQ0MzY0MDM3ODc0LC0wLjA3MzA1Nzc4OTY5MDI5NjcNCiJ0ZWxsZ29v
>> ZCIsMC4yOTI3MzYzMjEyMjk2NDcsMC45NTU0OTQyNDYyMTA4NTYsMC43NTc1
>> NDQxOTMzMzk1NjYsMC4xOTEyNDExODMyMDMxMjksMC4wMDAxNzQ2MzA0MTc1
>> NjQ2ODgsMC4wMDM0MDg4NzExODA3MTI4NywwLjAwOTYzMDUwNDc0MzU4MDM0
>> LDAuMDI4Mzg5NDM3MzMxNjY4NCwwLjAxODgwMjc1Mzk0NjMyOTksLTAuMDE1
>> NzAyNjM4MTUxNTk4NSwtMC4xNDU3OTUwMDY3NDE4ODQsMC4xNDIwMzQzOTY5
>> MDY4NzksMC4wMDk4MTUzODM5ODQzNDg1MSwwLjA3MDU4Njg3NTY1Mzk3MzIs
>> MC4xMDgwMDA0NDkzMjgzMTMNCiJ0ZWxsYmVzdCIsMC4yODk4NTI4MDg0ODkx
>> MTcsMC43NTc1NDQxOTMzMzk1NjYsMC45NDg1OTM1OTA5MTI0MDgsMC4yMzA1
>> OTg5NTg1OTc1MjgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuMDE1NTQ0NzA1NTc4
>> MzEyMiwwLjAzMjE2OTMyODE5ODg2NjksMC4wNjQ2MzEyMzI2MTg3MDk2LDAu
>> MDEwMjk0NTA4NTY1MTI0NiwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE3ODc2
>> NTU2MzM1NDgyOCwwLjE1MTM0MzU2Nzc2MTg1OSwtMC4wMzM2NTU5MDYzMzA3
>> ODM1LDAuMDkyOTA2MjI3OTMzNDg5OCwwLjE1OTczNTYxODQyMzMzNQ0KImlt
>> cG9ydGFudCIsMC4zODUyNjY5NjUzNjI3NjEsMC4xOTEyNDExODMyMDMxMjks
>> MC4yMzA1OTg5NTg1OTc1MjgsMC45NjQ0OTc4ODAzNDM2MSwwLjY0NzY1NzE0
>> MTQ4ODM3NSwwLjUxNDE3NTk3NDU1NDExNCwtMC4xOTc1MDY3MDU5MTcxMjMs
>> MC40NzQ3MjMzMzI0Njk4NzUsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE4OTIy
>> OTEyMzcwNTM0MSwtMC40NjIxOTU4MzkyNjUwMzUsMC4xMjQxNTgzMzk1Mjcz
>> MjIsMC4xNjA2NjEzMDc0ODY1NTksLTAuMDg2NDU3MzcyNzQ2NjI2NSwtMC4w
>> NjgzNjc0ODQyNDk4ODAxDQoiY29tcGxleCIsMC4xOTc2NDQ4MjQ2OTYzMjAs
>> MC4wMDAxNzQ2MzA0MTc1NjQ2ODgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuNjQ3
>> NjU3MTQxNDg4Mzc1LDAuOTc2MzIxNjU1NzYyOTY4LDAuNzU0OTc4Nzc3MzA5
>> NTUzLC0wLjI2MjM0MDQyNTgyNDA1MiwwLjY1NjcxNzUzMzM2MTE3NiwtMC4x
>> NjA0MjcxMzk2NzMwMTgsLTAuMjM2MjEwODU2MDgzOTAyLC0wLjM4NTQ1MjEw
>> MDA0NjYyMywwLjAyMzg3NzU3MjgyNzcxNTcsMC4zMjQ1MjU2NTMxNjQ1MDgs
>> LTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzMzY5NjU1NDE4OTE2NA0KImRpZmZp
>> Y3VsdCIsMC4xODMwNDEzMjQwNjIyOTgsMC4wMDM0MDg4NzExODA3MTI4Nyww
>> LjAxNTU0NDcwNTU3ODMxMjIsMC41MTQxNzU5NzQ1NTQxMTQsMC43NTQ5Nzg3
>> NzczMDk1NTMsMC45NTczMjQzNDE2NjE5NzIsLTAuMTgzMDA1NTg3NTUxNjI0
>> LDAuNTIzMTgzOTkzODk3NjMyLC0wLjE5NzgzMzM1NDQzMDkwNywtMC4yMjg0
>> MzQ3MTMwNjE3NzYsLTAuMjYzNTg3NzQ2MDIxMTc0LC0wLjA0NTM5NzEzNzc3
>> MDA4NDUsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMjM0NzA3NTE3Njc3NTg2LC0w
>> LjIzOTEyNjk3MTQ4MDYyNQ0KIm9ubHlzZWxmIiwtMC4xNDY2MjYzNDcyMTk4
>> NzksMC4wMDk2MzA1MDQ3NDM1ODAzNCwwLjAzMjE2OTMyODE5ODg2NjksLTAu
>> MTk3NTA2NzA1OTE3MTIzLC0wLjI2MjM0MDQyNTgyNDA1MiwtMC4xODMwMDU1
>> ODc1NTE2MjQsMC45NDc4NTI0MTU0NDM2NjMsLTAuMjY4MzMzOTc5Mjk1NjEy
>> LDAuMDc4NzE5MTg3OTIxNTY1NCwwLjA4MDA1NTQ0MzA5MzgwMzYsMC4xNjM1
>> OTUyNzc0OTg3NTgsLTAuMDA1MDcyNjg2MDg0MTc3MDQsLTAuMTYwMTM3NTQ1
>> ODcxNDQ4LDAuMjExMjU3MjUyMjg3OTc5LDAuMTQ3ODg0MzUyNTg4NDk5DQoi
>> bWFueWRpbWVuc2lvbnMiLDAuMTQ2MzU0MDI3Nzk3MTAxLDAuMDI4Mzg5NDM3
>> MzMxNjY4NCwwLjA2NDYzMTIzMjYxODcwOTYsMC40NzQ3MjMzMzI0Njk4NzUs
>> MC42NTY3MTc1MzMzNjExNzYsMC41MjMxODM5OTM4OTc2MzIsLTAuMjY4MzMz
>> OTc5Mjk1NjEyLDAuOTQ5OTE3NjYyNjE2MTYsLTAuMTEzMjk1NjY3NDA4MTc3
>> LC0wLjE4MTU3NjQ3MzE3MDc4NCwtMC4yNzkyOTg0MTcxNzcyNjEsMC4wNDQy
>> NDgxMjM1MDgyNTI4LDAuMjU4MzQ5NzAyNDYwNjYzLC0wLjE5Njk5MzM0NjMz
>> NzIxNCwtMC4yMjI1MzM5NTI2MzM0ODINCiJob3dtdWNoaW5mbyIsLTAuMTMy
>> ODg3NTk2OTAyNTA2LDAuMDE4ODAyNzUzOTQ2MzI5OSwwLjAxMDI5NDUwODU2
>> NTEyNDYsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE2MDQyNzEzOTY3MzAxOCwt
>> MC4xOTc4MzMzNTQ0MzA5MDcsMC4wNzg3MTkxODc5MjE1NjU0LC0wLjExMzI5
>> NTY2NzQwODE3NywwLjk0NjcyMjc0NjEzNzQxNSwwLjcwNjk3NjAxNTU4MjIx
>> OCwwLjA5MjMxOTI3MDQ0Mzk5MzQsMC4yMTMwMzIyNDI0NzMzMTUsLTAuMjA5
>> ODgyNDMxNzY1MTEwLDAuMjM5MTI0NTUxNjI5NTU5LDAuMjE5MDc4MzUyODkw
>> NjU3DQoiZXF1YWxpbmZvIiwtMC4xNzM5NjUwNjkxMTEwMjUsLTAuMDE1NzAy
>> NjM4MTUxNTk4NSwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE4OTIyOTEyMzcw
>> NTM0MSwtMC4yMzYyMTA4NTYwODM5MDIsLTAuMjI4NDM0NzEzMDYxNzc2LDAu
>> MDgwMDU1NDQzMDkzODAzNiwtMC4xODE1NzY0NzMxNzA3ODQsMC43MDY5NzYw
>> MTU1ODIyMTgsMC45NjQ1MTc1NjI3NzgzMjgsMC4xODA1MTczMjU3NTIzODcs
>> MC4xNjM4NDQ2NDA0OTU5ODMsLTAuMjEzODA0NTUwMDQzMjM5LDAuMjU4MDMy
>> MzIyODI0NTk5LDAuMTkxODIwNDQ3NDA0MzM1DQoiY291bGRhdm9pZCIsLTAu
>> MjY4NDU5MTYyOTMwNTY3LC0wLjE0NTc5NTAwNjc0MTg4NCwtMC4xNzg3NjU1
>> NjMzNTQ4MjgsLTAuNDYyMTk1ODM5MjY1MDM1LC0wLjM4NTQ1MjEwMDA0NjYy
>> MywtMC4yNjM1ODc3NDYwMjExNzQsMC4xNjM1OTUyNzc0OTg3NTgsLTAuMjc5
>> Mjk4NDE3MTc3MjYxLDAuMDkyMzE5MjcwNDQzOTkzNCwwLjE4MDUxNzMyNTc1
>> MjM4NywwLjk2MzIzNzMwOTczMDcyNiwtMC4xMjAxMzAxOTYzOTI0MDYsLTAu
>> MDY4OTY1OTY1NzA1NzA5MSwwLjE2NTUzMzIwODc0MzU0NywwLjE5MTQyMTEz
>> NDE4OTY4Mg0KInBvc291dGNvbWUiLC0wLjA2NzgwOTUzNzUwNzYyMjIsMC4x
>> NDIwMzQzOTY5MDY4NzksMC4xNTEzNDM1Njc3NjE4NTksMC4xMjQxNTgzMzk1
>> MjczMjIsMC4wMjM4Nzc1NzI4Mjc3MTU3LC0wLjA0NTM5NzEzNzc3MDA4NDUs
>> LTAuMDA1MDcyNjg2MDg0MTc3MDQsMC4wNDQyNDgxMjM1MDgyNTI4LDAuMjEz
>> MDMyMjQyNDczMzE1LDAuMTYzODQ0NjQwNDk1OTgzLC0wLjEyMDEzMDE5NjM5
>> MjQwNiwwLjkzOTEwNzcxNzE4NjM4NSwtMC4yOTEyNjIzOTE4Mjc2NzEsMC4y
>> NTYyNzQxOTU5ODMwMDQsMC4zNDY0NDE0MTExMTYxNDcNCiJuZWdvdXRjb21l
>> IiwwLjE4MDU0OTkyNTAyNDM3NywwLjAwOTgxNTM4Mzk4NDM0ODUxLC0wLjAz
>> MzY1NTkwNjMzMDc4MzUsMC4xNjA2NjEzMDc0ODY1NTksMC4zMjQ1MjU2NTMx
>> NjQ1MDgsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMTYwMTM3NTQ1ODcxNDQ4LDAu
>> MjU4MzQ5NzAyNDYwNjYzLC0wLjIwOTg4MjQzMTc2NTExMCwtMC4yMTM4MDQ1
>> NTAwNDMyMzksLTAuMDY4OTY1OTY1NzA1NzA5MSwtMC4yOTEyNjIzOTE4Mjc2
>> NzEsMC45NTI1NTI5NjU3OTY0MjEsLTAuMjIxOTE3MjIyOTMwMTksLTAuMjMx
>> MDMyMDE0OTI3Mzk3DQoiY29udHJvbCIsLTAuMDQyMDg0NDM2NDAzNzg3NCww
>> LjA3MDU4Njg3NTY1Mzk3MzIsMC4wOTI5MDYyMjc5MzM0ODk4LC0wLjA4NjQ1
>> NzM3Mjc0NjYyNjUsLTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzNDcwNzUxNzY3
>> NzU4NiwwLjIxMTI1NzI1MjI4Nzk3OSwtMC4xOTY5OTMzNDYzMzcyMTQsMC4y
>> MzkxMjQ1NTE2Mjk1NTksMC4yNTgwMzIzMjI4MjQ1OTksMC4xNjU1MzMyMDg3
>> NDM1NDcsMC4yNTYyNzQxOTU5ODMwMDQsLTAuMjIxOTE3MjIyOTMwMTksMC45
>> Mzc2MDc1MzMxODY1NzYsMC4zMTI2NjQxOTk2MzE2MjANCiJkZXNpcmVkIiwt
>> MC4wNzMwNTc3ODk2OTAyOTY3LDAuMTA4MDAwNDQ5MzI4MzEzLDAuMTU5NzM1
>> NjE4NDIzMzM1LC0wLjA2ODM2NzQ4NDI0OTg4MDEsLTAuMjMzNjk2NTU0MTg5
>> MTY0LC0wLjIzOTEyNjk3MTQ4MDYyNSwwLjE0Nzg4NDM1MjU4ODQ5OSwtMC4y
>> MjI1MzM5NTI2MzM0ODIsMC4yMTkwNzgzNTI4OTA2NTcsMC4xOTE4MjA0NDc0
>> MDQzMzUsMC4xOTE0MjExMzQxODk2ODIsMC4zNDY0NDE0MTExMTYxNDcsLTAu
>> MjMxMDMyMDE0OTI3Mzk3LDAuMzEyNjY0MTk5NjMxNjIwLDAuOTYzMTMxNjM5
>> NTYwMTA4DQo=
>>
>> --1660387551-1458482416-1249639718=:2997--
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>
> -- 
> Jeffrey Ryan
> jeffrey.ryan at insightalgo.com
>
> ia: insight algorithmics
> www.insightalgo.com
>

CSV:

"","wasrightchoice","tellgood","tellbest","important","complex","difficult","onlyself","manydimensions","howmuchinfo","equalinfo","couldavoid","posoutcome","negoutcome","control","desired"
"wasrightchoice",0.96369773178963,0.292736321229647,0.289852808489117,0.385266965362761,0.197644824696320,0.183041324062298,-0.146626347219879,0.146354027797101,-0.132887596902506,-0.173965069111025,-0.268459162930567,-0.0678095375076222,0.180549925024377,-0.0420844364037874,-0.0730577896902967
"tellgood",0.292736321229647,0.955494246210856,0.757544193339566,0.191241183203129,0.000174630417564688,0.00340887118071287,0.00963050474358034,0.0283894373316684,0.0188027539463299,-0.0157026381515985,-0.145795006741884,0.142034396906879,0.00981538398434851,0.0705868756539732,0.108000449328313
"tellbest",0.289852808489117,0.757544193339566,0.948593590912408,0.230598958597528,0.0302692106135439,0.0155447055783122,0.0321693281988669,0.0646312326187096,0.0102945085651246,-0.0196759997923009,-0.178765563354828,0.151343567761859,-0.0336559063307835,0.0929062279334898,0.159735618423335
"important",0.385266965362761,0.191241183203129,0.230598958597528,0.96449788034361,0.647657141488375,0.514175974554114,-0.197506705917123,0.474723332469875,-0.129091329816201,-0.189229123705341,-0.462195839265035,0.124158339527322,0.160661307486559,-0.0864573727466265,-0.0683674842498801
"complex",0.197644824696320,0.000174630417564688,0.0302692106135439,0.647657141488375,0.976321655762968,0.754978777309553,-0.262340425824052,0.656717533361176,-0.160427139673018,-0.236210856083902,-0.385452100046623,0.0238775728277157,0.324525653164508,-0.240634804887055,-0.233696554189164
"difficult",0.183041324062298,0.00340887118071287,0.0155447055783122,0.514175974554114,0.754978777309553,0.957324341661972,-0.183005587551624,0.523183993897632,-0.197833354430907,-0.228434713061776,-0.263587746021174,-0.0453971377700845,0.330075666526761,-0.234707517677586,-0.239126971480625
"onlyself",-0.146626347219879,0.00963050474358034,0.0321693281988669,-0.197506705917123,-0.262340425824052,-0.183005587551624,0.947852415443663,-0.268333979295612,0.0787191879215654,0.0800554430938036,0.163595277498758,-0.00507268608417704,-0.160137545871448,0.211257252287979,0.147884352588499
"manydimensions",0.146354027797101,0.0283894373316684,0.0646312326187096,0.474723332469875,0.656717533361176,0.523183993897632,-0.268333979295612,0.94991766261616,-0.113295667408177,-0.181576473170784,-0.279298417177261,0.0442481235082528,0.258349702460663,-0.196993346337214,-0.222533952633482
"howmuchinfo",-0.132887596902506,0.0188027539463299,0.0102945085651246,-0.129091329816201,-0.160427139673018,-0.197833354430907,0.0787191879215654,-0.113295667408177,0.946722746137415,0.706976015582218,0.0923192704439934,0.213032242473315,-0.209882431765110,0.239124551629559,0.219078352890657
"equalinfo",-0.173965069111025,-0.0157026381515985,-0.0196759997923009,-0.189229123705341,-0.236210856083902,-0.228434713061776,0.0800554430938036,-0.181576473170784,0.706976015582218,0.964517562778328,0.180517325752387,0.163844640495983,-0.213804550043239,0.258032322824599,0.191820447404335
"couldavoid",-0.268459162930567,-0.145795006741884,-0.178765563354828,-0.462195839265035,-0.385452100046623,-0.263587746021174,0.163595277498758,-0.279298417177261,0.0923192704439934,0.180517325752387,0.963237309730726,-0.120130196392406,-0.0689659657057091,0.165533208743547,0.191421134189682
"posoutcome",-0.0678095375076222,0.142034396906879,0.151343567761859,0.124158339527322,0.0238775728277157,-0.0453971377700845,-0.00507268608417704,0.0442481235082528,0.213032242473315,0.163844640495983,-0.120130196392406,0.939107717186385,-0.291262391827671,0.256274195983004,0.346441411116147
"negoutcome",0.180549925024377,0.00981538398434851,-0.0336559063307835,0.160661307486559,0.324525653164508,0.330075666526761,-0.160137545871448,0.258349702460663,-0.209882431765110,-0.213804550043239,-0.0689659657057091,-0.291262391827671,0.952552965796421,-0.22191722293019,-0.231032014927397
"control",-0.0420844364037874,0.0705868756539732,0.0929062279334898,-0.0864573727466265,-0.240634804887055,-0.234707517677586,0.211257252287979,-0.196993346337214,0.239124551629559,0.258032322824599,0.165533208743547,0.256274195983004,-0.22191722293019,0.937607533186576,0.312664199631620
"desired",-0.0730577896902967,0.108000449328313,0.159735618423335,-0.0683674842498801,-0.233696554189164,-0.239126971480625,0.147884352588499,-0.222533952633482,0.219078352890657,0.191820447404335,0.191421134189682,0.346441411116147,-0.231032014927397,0.312664199631620,0.963131639560108

RAM:

important <-- challenge, NA, 1
complex  <-- challenge, c.complex, NA
difficult <-- challenge, c.difficult, NA
manydimensions <-- challenge, c.manydimensions, NA
couldavoid <-- challenge, c.couldavoid, NA
onlyself <-- challenge, c.onlyself, NA

wasrightchoice <-- eval, NA, 1
tellgood <-- eval, e.tellgood, NA
tellbest <-- eval, e.tellbest, NA
negoutcome <-- eval, e.negoutcome, NA

equalinfo <-- informed, NA, 1
control <-- informed, i.control, NA
desired <-- informed, i.desired, NA
howmuchinfo <-- informed, i.howmuchinfo, NA
posoutcome <-- informed, i.posoutcome, NA

wasrightchoice <-> wasrightchoice, wasrightchoiceV, NA
tellgood <-> tellgood, tellgoodV, NA
tellbest <-> tellbest, tellbestV, NA
negoutcome <-> negoutcome, negoutcomeV, NA

onlyself <-> onlyself, onlyselfV, NA
important <-> important, importantV, NA
complex <-> complex, complexV, NA
difficult <-> difficult, difficultV, NA
manydimensions <-> manydimensions, manydimensionsV, NA
couldavoid <-> couldavoid, couldavoidV, NA

equalinfo <-> equalinfo, equalinfoV, NA
control <-> control, controlV, NA
desired <-> desired, desiredV, NA
howmuchinfo <-> howmuchinfo, howmuchinfoV, NA
posoutcome <-> posoutcome, posoutcomeV, NA

eval <-> eval, evalV, NA
challenge <-> challenge, challengeV, NA
informed <-> informed, informedV, NA

From adik at ilovebacon.org  Sat Aug  8 00:35:14 2009
From: adik at ilovebacon.org (adik at ilovebacon.org)
Date: Sat,  8 Aug 2009 00:35:14 +0200 (CEST)
Subject: [Rd] Bug in nlm, found using sem;
	failure in several flavors (PR#13883)
Message-ID: <20090807223514.7C78E282EF4C@mail.pubhealth.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--1660387551-150661043-1249684349=:2997
Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
Content-Transfer-Encoding: QUOTED-PRINTABLE

Hi Jeff,

 =09As mentioned in my message, I *did* replicate on another platform.=20
One platform was running linux in a VM, the other running MacOSX, on two
different physical machines.  The problem did not replicate on a PowerPC
box, so if it is a bug with intel chips, I think it's also appropriate to
report here given that the problem seems to cross the OS boundary.  I do no=
t
have access to a Windows machine.

 =09Also, I have spent a decent amount of time running memory testers on
the first machine's memory, to ensure that physical memory is not a
problem...the classic "memcheck" program finds no trouble.

 =09The CSV and .ram files both came through as base-64-encoded
attachments, which you actually quoted back to me in your response,
below...but in case your mail client can't read those and/or you are
interested in this bug, I have pasted them at the end of this message (sinc=
e
they're quite small).

 =09And thanks for the shout-out for bacon. I bought this domain name in
undergrad many years ago, and I must say, I've never regretted it!

--Adam

On Fri, 7 Aug 2009, Jeff Ryan wrote:

> Adam,
>
> It seems that your attachment didn't make it through.
>
> That aside, my experience with strange errors like those (random type
> not implemented ones) has been that you may be looking at a memory
> problem on you machine. Given that you can't replicate on another
> platform (and the .csv file didn't come through), I would think it
> wise to start there.
>
> My 2c.  And I love bacon too :)
>
> Jeff
>
> On Fri, Aug 7, 2009 at 1:10 PM, <adik at ilovebacon.org> wrote:
>> =A0This message is in MIME format. =A0The first part should be readable =
text,
>> =A0while the remaining parts are likely unreadable without MIME-aware to=
ols.
>>
>> --1660387551-1458482416-1249639718=3D:2997
>> Content-Type: TEXT/PLAIN; CHARSET=3DUS-ASCII; FORMAT=3Dflowed
>> Content-ID: <Pine.LNX.4.64.0908071039211.2997 at parser.ilovebacon.org>
>>
>> Hello,
>>
>> =A0 =A0 =A0 =A0There appears to be a bug in the nlm function, which I di=
scovered
>> when trying to run an SEM. =A0The SEM is not bizarre; the covariance mat=
rix is
>> solve-able and the eigenvalues are greater than zero, and I do not belie=
ve
>> the "sem" package per se to be the problem (as nlm keeps being the part =
that
>> fails, though I can't replicate this with other nlm tasks). =A0I apologi=
ze if
>> I have put too many much information in this message; I'm not a programm=
er
>> by trade so I don't really know what's going on here, which hampers my
>> ability to write consise bug reports.
>>
>> Here is the code I use:
>>
>> library(sem)
>> ice.S <- read.csv("iceS.csv") # attached
>> rownames(ice.S) <- ice.S[,1]
>> ice.S[,1] <- NULL
>> ice.S <- as.matrix(ice.S)
>> ice.ram <- specify.model("ice.ram") # attached
>> ice.N <- 342
>> ice.sem <- sem(ram=3Dice.ram, S=3Dice.S, N=3Dice.N)
>>
>> ...at this point, any number of problems could occur. I have seen the
>> following.
>>
>> 1) Simple lack of convergence. (might be my model's fault.)
>> 2) Error in nlm(if (analytic.gradient) objective.2 else objective.1, sta=
rt,
>> :
>> =A0 type 31 is unimplemented in 'type2char'
>> 3) =A0*** caught segfault ***
>> address 0xc019c87b, cause 'memory not mapped'
>>
>> Traceback:
>> =A01: nlm(if (analytic.gradient) objective.2 else objective.1, start,
>> hessian =3D TRUE, iterlim =3D maxiter, print.level =3D if (debug) 2 else=
 0,
>> typsize =3D typsize, ...)
>> =A02: sem.default(ram =3D ram, S =3D S, N =3D N, param.names =3D pars, v=
ar.names =3D
>> vars, =A0 =A0 fixed.x =3D fixed.x, debug =3D debug, ...)
>> =A03: sem(ram =3D ram, S =3D S, N =3D N, param.names =3D pars, var.names=
 =3D vars,
>> fixed.x =3D fixed.x, debug =3D debug, ...)
>> =A04: sem.mod(ram =3D ice.ram, S =3D ice.S, N =3D ice.N)
>> =A05: sem(ram =3D ice.ram, S =3D ice.S, N =3D ice.N)
>>
>> Possible actions:
>> 1: abort (with core dump, if enabled)
>> 2: normal R exit
>> 3: exit R without saving workspace
>> 4: exit R saving workspace
>> Selection: 1
>> aborting ...
>> Segmentation fault
>> swiss:data$
>>
>> (no core was dumped).
>>
>> Trying with debug mode provides other interesting errors:
>>
>>> ice.sem <- sem(ram=3Dice.ram, S=3Dice.S, N=3Dice.N, debug=3DTRUE)
>>
>> ...gets up to some iteration (not always 15), and then R dies ungraceful=
ly,
>> and exits to the shell:
>>
>> iteration =3D 15
>> Step:
>> =A0[1] =A01.253132e-02 =A01.183343e-02 -7.651342e-03 -2.490800e-03 =A02.=
278938e-03
>> =A0[6] =A03.197431e-04 =A06.137849e-04 -2.496882e-03 -1.065829e-03 -2.11=
8179e-03
>> [11] =A02.942936e-03 -1.335936e-03 -3.665618e-03 =A03.090566e-03 =A08.53=
4956e-04
>> [16] -1.440421e-03 -5.230877e-04 -1.053686e-04 -9.771005e-04 -4.269216e-=
04
>> [21] =A07.261694e-05 -1.039668e-03 -8.409151e-03 -3.497456e-03 =A02.2168=
99e-03
>> [26] -4.633520e-03 -4.052130e-03 -4.746537e-03 -1.589622e-03 -2.523766e-=
04
>> Parameter:
>> =A0[1] -0.76604614 -1.19639662 =A00.83456888 =A00.72540413 =A00.08482452=
 =A00.56180393
>> =A0[7] =A00.50615814 =A00.55728015 =A00.83796696 =A00.88371335 -0.704651=
16 =A00.85251098
>> [13] -0.18346956 =A00.66857787 =A00.57012481 =A00.39116561 =A00.91237990=
 =A00.63951482
>> [19] =A00.26601566 =A00.29240836 =A00.44710919 =A00.94734056 =A06.520390=
15 =A00.02524762
>> [25] -0.01614603 =A02.88198219 =A00.03442452 =A03.52272237 =A01.44698423=
 -0.72964745
>> Function Value
>> [1] -15175.94
>> Gradient:
>> =A0[1] -2.085412e+07 -3.819717e+07 =A03.883989e+07 =A01.352594e+00 -4.28=
3329e+00
>> =A0[6] -1.437250e+00 -6.558913e-01 =A01.358276e+00 =A07.930865e+05 -1.29=
3853e+06
>> [11] -5.816627e+03 =A05.908197e+05 -2.705742e+08 -1.194400e+07 -4.007083=
e+07
>> [16] -4.143068e+07 -6.159782e-01 =A01.044274e-01 -8.591048e+00 -2.083471=
e+00
>> [21] -7.548753e-01 -5.418994e-01 -2.799228e+02 -1.321739e+07 -3.517728e+=
07
>> [26] -7.106654e+02 -7.335293e+06 -7.335285e+05 =A03.117764e-01 -2.234989=
e+04
>>
>> Abort trap
>> swiss:data$
>>
>> ...I have also seen convergence reached, and nlm then die with this mess=
age:
>>
>> Error in nlm(if (analytic.gradient) objective.2 else objective.1, start,
>> :
>> =A0 type 27 is unimplemented in 'type2char'
>>
>> (similar to above, but now referring to type 27)
>>
>> I have shown this effect (or something similar...never know how it'll fa=
il
>> next) on the following platforms:
>>
>>> version
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
>> platform =A0 =A0 =A0 i386-apple-darwin9.7.0
>> arch =A0 =A0 =A0 =A0 =A0 i386
>> os =A0 =A0 =A0 =A0 =A0 =A0 darwin9.7.0
>> system =A0 =A0 =A0 =A0 i386, darwin9.7.0
>> status
>> major =A0 =A0 =A0 =A0 =A02
>> minor =A0 =A0 =A0 =A0 =A09.1
>> year =A0 =A0 =A0 =A0 =A0 2009
>> month =A0 =A0 =A0 =A0 =A006
>> day =A0 =A0 =A0 =A0 =A0 =A026
>> svn rev =A0 =A0 =A0 =A048839
>> language =A0 =A0 =A0 R
>> version.string R version 2.9.1 (2009-06-26)
>>
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26)
>> i386-apple-darwin9.8.0
>>
>> locale:
>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>
>> attached base packages:
>> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets =A0method=
s =A0 base
>>
>> other attached packages:
>> [1] sem_0.9-17
>>
>> loaded via a namespace (and not attached):
>> [1] tcltk_2.9.1 tools_2.9.1
>>
>> (I admit to having compiled this version of R myself (to link to a
>> hand-compiled ATLAS), though no errors were thrown in the compilation st=
age.
>> I compiled using this config string, at first...
>>
>> ./configure --prefix=3D/usr/local --with-x --disable-R-framework --enabl=
e-threads=3Dposix --with-blas=3D"/usr/local/lib/libptf77blas.a /usr/local/l=
ib/libptcblas.a /usr/local/lib/libatlas.a -lpthread" --with-lapack=3D"/usr/=
local/lib/liblapack.a /usr/local/lib/libptf77blas.a /usr/local/lib/libptcbl=
as.a /usr/local/lib/libatlas.a -lpthread" --without-aqua CFLAGS=3D"-O3 -mtu=
ne=3Dnocona -m32" CXXFLAGS=3D"-O3 -mtune=3Dnocona -m32" FFLAGS=3D"-O3 -mtun=
e=3Dnocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran" F77FLA=
GS=3D"-O3 -mtune=3Dnocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l g=
fortran" FCFLAGS=3D"-O3 -mtune=3Dnocona -m32 -L/usr/lib/gcc/i686-apple-darw=
in9/4.2.1 -l gfortran" LDFLAGS=3D"-m32 -L/sw/lib" CPPFLAGS=3D"-I/sw/include=
" CC=3Dgcc-4.2 F77=3Dgfortran-4.2 FC=3Dgfortran-4.2 CXX=3Dg++-4.2 OBJC=3Dgc=
c-4.2
>>
>> ...though I have also recompiled using simply this:
>>
>> ./configure --prefix=3D/usr/local --with-x --disable-R-framework
>>
>> ...and then re-installed SEM, and I got a few other, different error
>> messages and core dumps, "including type 11 is unimplemented in 'type2ch=
ar'"
>> and "cannot coerce type 'weakref' to vector of type 'double'". =A0Runnin=
g with
>> debug=3DTRUE also segfaults sometimes, even after achieving "Current ite=
rate
>> is probably solution" status.)
>>
>>> version
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
>> platform =A0 =A0 =A0 x86_64-unknown-linux-gnu
>> arch =A0 =A0 =A0 =A0 =A0 x86_64
>> os =A0 =A0 =A0 =A0 =A0 =A0 linux-gnu
>> system =A0 =A0 =A0 =A0 x86_64, linux-gnu
>> status
>> major =A0 =A0 =A0 =A0 =A02
>> minor =A0 =A0 =A0 =A0 =A09.1
>> year =A0 =A0 =A0 =A0 =A0 2009
>> month =A0 =A0 =A0 =A0 =A006
>> day =A0 =A0 =A0 =A0 =A0 =A026
>> svn rev =A0 =A0 =A0 =A048839
>> language =A0 =A0 =A0 R
>> version.string R version 2.9.1 (2009-06-26)
>>
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26)
>> x86_64-unknown-linux-gnu
>>
>> locale:
>> LC_CTYPE=3Den_US;LC_NUMERIC=3DC;LC_TIME=3Den_US;LC_COLLATE=3Den_US;LC_MO=
NETARY=3DC;LC_MESSAGES=3Den_US;LC_PAPER=3Den_US;LC_NAME=3DC;LC_ADDRESS=3DC;=
LC_TELEPHONE=3DC;LC_MEASUREMENT=3Den_US;LC_IDENTIFICATION=3DC
>>
>> attached base packages:
>> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets =A0method=
s =A0 base
>>
>> other attached packages:
>> [1] sem_0.9-17
>>
>> ...however, THIS platform does NOT show the bug:
>>
>>> version
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
>> platform =A0 =A0 =A0 powerpc-unknown-linux-gnu
>> arch =A0 =A0 =A0 =A0 =A0 powerpc
>> os =A0 =A0 =A0 =A0 =A0 =A0 linux-gnu
>> system =A0 =A0 =A0 =A0 powerpc, linux-gnu
>> status
>> major =A0 =A0 =A0 =A0 =A02
>> minor =A0 =A0 =A0 =A0 =A09.1
>> year =A0 =A0 =A0 =A0 =A0 2009
>> month =A0 =A0 =A0 =A0 =A006
>> day =A0 =A0 =A0 =A0 =A0 =A026
>> svn rev =A0 =A0 =A0 =A048839
>> language =A0 =A0 =A0 R
>> version.string R version 2.9.1 (2009-06-26)
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26)
>> powerpc-unknown-linux-gnu
>>
>> locale:
>> LC_CTYPE=3Den_US.UTF-8;LC_NUMERIC=3DC;LC_TIME=3Den_US.UTF-8;LC_COLLATE=
=3Den_US.UTF-8;LC_MONETARY=3DC;LC_MESSAGES=3Den_US.UTF-8;LC_PAPER=3Den_US.U=
TF-8;LC_NAME=3DC;LC_ADDRESS=3DC;LC_TELEPHONE=3DC;LC_MEASUREMENT=3Den_US.UTF=
-8;LC_IDENTIFICATION=3DC
>>
>> attached base packages:
>> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets =A0method=
s =A0 base
>>
>> other attached packages:
>> [1] sem_0.9-17
>>>
>>
>> ...for this system, the model simply repeatedly fails to converge, wheth=
er
>> debug is set or not.
>>
>> I have also tried altering my model. This has resulted in the same bugs,=
 but
>> instead of "every so often simply not converging," it actually converges=
 and
>> appears to be the model I asked R to solve...but this is rare.
>>
>> Please let me know if I can provide any other info.
>>
>> Cordially,
>> Adam D. I. Kramer
>> --1660387551-1458482416-1249639718=3D:2997
>> Content-Type: AUDIO/X-PN-REALAUDIO; NAME=3Dice.ram
>> Content-Transfer-Encoding: BASE64
>> Content-ID: <Pine.LNX.4.64.0908070308380.2997 at parser.ilovebacon.org>
>> Content-Description:
>> Content-Disposition: ATTACHMENT; FILENAME=3Dice.ram
>>
>> aW1wb3J0YW50IDwtLSBjaGFsbGVuZ2UsIE5BLCAxCmNvbXBsZXggIDwtLSBj
>> aGFsbGVuZ2UsIGMuY29tcGxleCwgTkEKZGlmZmljdWx0IDwtLSBjaGFsbGVu
>> Z2UsIGMuZGlmZmljdWx0LCBOQQptYW55ZGltZW5zaW9ucyA8LS0gY2hhbGxl
>> bmdlLCBjLm1hbnlkaW1lbnNpb25zLCBOQQpjb3VsZGF2b2lkIDwtLSBjaGFs
>> bGVuZ2UsIGMuY291bGRhdm9pZCwgTkEKb25seXNlbGYgPC0tIGNoYWxsZW5n
>> ZSwgYy5vbmx5c2VsZiwgTkEKCndhc3JpZ2h0Y2hvaWNlIDwtLSBldmFsLCBO
>> QSwgMQp0ZWxsZ29vZCA8LS0gZXZhbCwgZS50ZWxsZ29vZCwgTkEKdGVsbGJl
>> c3QgPC0tIGV2YWwsIGUudGVsbGJlc3QsIE5BCm5lZ291dGNvbWUgPC0tIGV2
>> YWwsIGUubmVnb3V0Y29tZSwgTkEKCmVxdWFsaW5mbyA8LS0gaW5mb3JtZWQs
>> IE5BLCAxCmNvbnRyb2wgPC0tIGluZm9ybWVkLCBpLmNvbnRyb2wsIE5BCmRl
>> c2lyZWQgPC0tIGluZm9ybWVkLCBpLmRlc2lyZWQsIE5BCmhvd211Y2hpbmZv
>> IDwtLSBpbmZvcm1lZCwgaS5ob3dtdWNoaW5mbywgTkEKcG9zb3V0Y29tZSA8
>> LS0gaW5mb3JtZWQsIGkucG9zb3V0Y29tZSwgTkEKCndhc3JpZ2h0Y2hvaWNl
>> IDwtPiB3YXNyaWdodGNob2ljZSwgd2FzcmlnaHRjaG9pY2VWLCBOQQp0ZWxs
>> Z29vZCA8LT4gdGVsbGdvb2QsIHRlbGxnb29kViwgTkEKdGVsbGJlc3QgPC0+
>> IHRlbGxiZXN0LCB0ZWxsYmVzdFYsIE5BCm5lZ291dGNvbWUgPC0+IG5lZ291
>> dGNvbWUsIG5lZ291dGNvbWVWLCBOQQoKb25seXNlbGYgPC0+IG9ubHlzZWxm
>> LCBvbmx5c2VsZlYsIE5BCmltcG9ydGFudCA8LT4gaW1wb3J0YW50LCBpbXBv
>> cnRhbnRWLCBOQQpjb21wbGV4IDwtPiBjb21wbGV4LCBjb21wbGV4ViwgTkEK
>> ZGlmZmljdWx0IDwtPiBkaWZmaWN1bHQsIGRpZmZpY3VsdFYsIE5BCm1hbnlk
>> aW1lbnNpb25zIDwtPiBtYW55ZGltZW5zaW9ucywgbWFueWRpbWVuc2lvbnNW
>> LCBOQQpjb3VsZGF2b2lkIDwtPiBjb3VsZGF2b2lkLCBjb3VsZGF2b2lkViwg
>> TkEKCmVxdWFsaW5mbyA8LT4gZXF1YWxpbmZvLCBlcXVhbGluZm9WLCBOQQpj
>> b250cm9sIDwtPiBjb250cm9sLCBjb250cm9sViwgTkEKZGVzaXJlZCA8LT4g
>> ZGVzaXJlZCwgZGVzaXJlZFYsIE5BCmhvd211Y2hpbmZvIDwtPiBob3dtdWNo
>> aW5mbywgaG93bXVjaGluZm9WLCBOQQpwb3NvdXRjb21lIDwtPiBwb3NvdXRj
>> b21lLCBwb3NvdXRjb21lViwgTkEKCmV2YWwgPC0+IGV2YWwsIGV2YWxWLCBO
>> QQpjaGFsbGVuZ2UgPC0+IGNoYWxsZW5nZSwgY2hhbGxlbmdlViwgTkEKaW5m
>> b3JtZWQgPC0+IGluZm9ybWVkLCBpbmZvcm1lZFYsIE5BCg=3D=3D
>>
>> --1660387551-1458482416-1249639718=3D:2997
>> Content-Type: TEXT/CSV; CHARSET=3DUS-ASCII; NAME=3DiceS.csv
>> Content-Transfer-Encoding: BASE64
>> Content-ID: <Pine.LNX.4.64.0908070308381.2997 at parser.ilovebacon.org>
>> Content-Description:
>> Content-Disposition: ATTACHMENT; FILENAME=3DiceS.csv
>>
>> IiIsIndhc3JpZ2h0Y2hvaWNlIiwidGVsbGdvb2QiLCJ0ZWxsYmVzdCIsImlt
>> cG9ydGFudCIsImNvbXBsZXgiLCJkaWZmaWN1bHQiLCJvbmx5c2VsZiIsIm1h
>> bnlkaW1lbnNpb25zIiwiaG93bXVjaGluZm8iLCJlcXVhbGluZm8iLCJjb3Vs
>> ZGF2b2lkIiwicG9zb3V0Y29tZSIsIm5lZ291dGNvbWUiLCJjb250cm9sIiwi
>> ZGVzaXJlZCINCiJ3YXNyaWdodGNob2ljZSIsMC45NjM2OTc3MzE3ODk2Myww
>> LjI5MjczNjMyMTIyOTY0NywwLjI4OTg1MjgwODQ4OTExNywwLjM4NTI2Njk2
>> NTM2Mjc2MSwwLjE5NzY0NDgyNDY5NjMyMCwwLjE4MzA0MTMyNDA2MjI5OCwt
>> MC4xNDY2MjYzNDcyMTk4NzksMC4xNDYzNTQwMjc3OTcxMDEsLTAuMTMyODg3
>> NTk2OTAyNTA2LC0wLjE3Mzk2NTA2OTExMTAyNSwtMC4yNjg0NTkxNjI5MzA1
>> NjcsLTAuMDY3ODA5NTM3NTA3NjIyMiwwLjE4MDU0OTkyNTAyNDM3NywtMC4w
>> NDIwODQ0MzY0MDM3ODc0LC0wLjA3MzA1Nzc4OTY5MDI5NjcNCiJ0ZWxsZ29v
>> ZCIsMC4yOTI3MzYzMjEyMjk2NDcsMC45NTU0OTQyNDYyMTA4NTYsMC43NTc1
>> NDQxOTMzMzk1NjYsMC4xOTEyNDExODMyMDMxMjksMC4wMDAxNzQ2MzA0MTc1
>> NjQ2ODgsMC4wMDM0MDg4NzExODA3MTI4NywwLjAwOTYzMDUwNDc0MzU4MDM0
>> LDAuMDI4Mzg5NDM3MzMxNjY4NCwwLjAxODgwMjc1Mzk0NjMyOTksLTAuMDE1
>> NzAyNjM4MTUxNTk4NSwtMC4xNDU3OTUwMDY3NDE4ODQsMC4xNDIwMzQzOTY5
>> MDY4NzksMC4wMDk4MTUzODM5ODQzNDg1MSwwLjA3MDU4Njg3NTY1Mzk3MzIs
>> MC4xMDgwMDA0NDkzMjgzMTMNCiJ0ZWxsYmVzdCIsMC4yODk4NTI4MDg0ODkx
>> MTcsMC43NTc1NDQxOTMzMzk1NjYsMC45NDg1OTM1OTA5MTI0MDgsMC4yMzA1
>> OTg5NTg1OTc1MjgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuMDE1NTQ0NzA1NTc4
>> MzEyMiwwLjAzMjE2OTMyODE5ODg2NjksMC4wNjQ2MzEyMzI2MTg3MDk2LDAu
>> MDEwMjk0NTA4NTY1MTI0NiwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE3ODc2
>> NTU2MzM1NDgyOCwwLjE1MTM0MzU2Nzc2MTg1OSwtMC4wMzM2NTU5MDYzMzA3
>> ODM1LDAuMDkyOTA2MjI3OTMzNDg5OCwwLjE1OTczNTYxODQyMzMzNQ0KImlt
>> cG9ydGFudCIsMC4zODUyNjY5NjUzNjI3NjEsMC4xOTEyNDExODMyMDMxMjks
>> MC4yMzA1OTg5NTg1OTc1MjgsMC45NjQ0OTc4ODAzNDM2MSwwLjY0NzY1NzE0
>> MTQ4ODM3NSwwLjUxNDE3NTk3NDU1NDExNCwtMC4xOTc1MDY3MDU5MTcxMjMs
>> MC40NzQ3MjMzMzI0Njk4NzUsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE4OTIy
>> OTEyMzcwNTM0MSwtMC40NjIxOTU4MzkyNjUwMzUsMC4xMjQxNTgzMzk1Mjcz
>> MjIsMC4xNjA2NjEzMDc0ODY1NTksLTAuMDg2NDU3MzcyNzQ2NjI2NSwtMC4w
>> NjgzNjc0ODQyNDk4ODAxDQoiY29tcGxleCIsMC4xOTc2NDQ4MjQ2OTYzMjAs
>> MC4wMDAxNzQ2MzA0MTc1NjQ2ODgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuNjQ3
>> NjU3MTQxNDg4Mzc1LDAuOTc2MzIxNjU1NzYyOTY4LDAuNzU0OTc4Nzc3MzA5
>> NTUzLC0wLjI2MjM0MDQyNTgyNDA1MiwwLjY1NjcxNzUzMzM2MTE3NiwtMC4x
>> NjA0MjcxMzk2NzMwMTgsLTAuMjM2MjEwODU2MDgzOTAyLC0wLjM4NTQ1MjEw
>> MDA0NjYyMywwLjAyMzg3NzU3MjgyNzcxNTcsMC4zMjQ1MjU2NTMxNjQ1MDgs
>> LTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzMzY5NjU1NDE4OTE2NA0KImRpZmZp
>> Y3VsdCIsMC4xODMwNDEzMjQwNjIyOTgsMC4wMDM0MDg4NzExODA3MTI4Nyww
>> LjAxNTU0NDcwNTU3ODMxMjIsMC41MTQxNzU5NzQ1NTQxMTQsMC43NTQ5Nzg3
>> NzczMDk1NTMsMC45NTczMjQzNDE2NjE5NzIsLTAuMTgzMDA1NTg3NTUxNjI0
>> LDAuNTIzMTgzOTkzODk3NjMyLC0wLjE5NzgzMzM1NDQzMDkwNywtMC4yMjg0
>> MzQ3MTMwNjE3NzYsLTAuMjYzNTg3NzQ2MDIxMTc0LC0wLjA0NTM5NzEzNzc3
>> MDA4NDUsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMjM0NzA3NTE3Njc3NTg2LC0w
>> LjIzOTEyNjk3MTQ4MDYyNQ0KIm9ubHlzZWxmIiwtMC4xNDY2MjYzNDcyMTk4
>> NzksMC4wMDk2MzA1MDQ3NDM1ODAzNCwwLjAzMjE2OTMyODE5ODg2NjksLTAu
>> MTk3NTA2NzA1OTE3MTIzLC0wLjI2MjM0MDQyNTgyNDA1MiwtMC4xODMwMDU1
>> ODc1NTE2MjQsMC45NDc4NTI0MTU0NDM2NjMsLTAuMjY4MzMzOTc5Mjk1NjEy
>> LDAuMDc4NzE5MTg3OTIxNTY1NCwwLjA4MDA1NTQ0MzA5MzgwMzYsMC4xNjM1
>> OTUyNzc0OTg3NTgsLTAuMDA1MDcyNjg2MDg0MTc3MDQsLTAuMTYwMTM3NTQ1
>> ODcxNDQ4LDAuMjExMjU3MjUyMjg3OTc5LDAuMTQ3ODg0MzUyNTg4NDk5DQoi
>> bWFueWRpbWVuc2lvbnMiLDAuMTQ2MzU0MDI3Nzk3MTAxLDAuMDI4Mzg5NDM3
>> MzMxNjY4NCwwLjA2NDYzMTIzMjYxODcwOTYsMC40NzQ3MjMzMzI0Njk4NzUs
>> MC42NTY3MTc1MzMzNjExNzYsMC41MjMxODM5OTM4OTc2MzIsLTAuMjY4MzMz
>> OTc5Mjk1NjEyLDAuOTQ5OTE3NjYyNjE2MTYsLTAuMTEzMjk1NjY3NDA4MTc3
>> LC0wLjE4MTU3NjQ3MzE3MDc4NCwtMC4yNzkyOTg0MTcxNzcyNjEsMC4wNDQy
>> NDgxMjM1MDgyNTI4LDAuMjU4MzQ5NzAyNDYwNjYzLC0wLjE5Njk5MzM0NjMz
>> NzIxNCwtMC4yMjI1MzM5NTI2MzM0ODINCiJob3dtdWNoaW5mbyIsLTAuMTMy
>> ODg3NTk2OTAyNTA2LDAuMDE4ODAyNzUzOTQ2MzI5OSwwLjAxMDI5NDUwODU2
>> NTEyNDYsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE2MDQyNzEzOTY3MzAxOCwt
>> MC4xOTc4MzMzNTQ0MzA5MDcsMC4wNzg3MTkxODc5MjE1NjU0LC0wLjExMzI5
>> NTY2NzQwODE3NywwLjk0NjcyMjc0NjEzNzQxNSwwLjcwNjk3NjAxNTU4MjIx
>> OCwwLjA5MjMxOTI3MDQ0Mzk5MzQsMC4yMTMwMzIyNDI0NzMzMTUsLTAuMjA5
>> ODgyNDMxNzY1MTEwLDAuMjM5MTI0NTUxNjI5NTU5LDAuMjE5MDc4MzUyODkw
>> NjU3DQoiZXF1YWxpbmZvIiwtMC4xNzM5NjUwNjkxMTEwMjUsLTAuMDE1NzAy
>> NjM4MTUxNTk4NSwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE4OTIyOTEyMzcw
>> NTM0MSwtMC4yMzYyMTA4NTYwODM5MDIsLTAuMjI4NDM0NzEzMDYxNzc2LDAu
>> MDgwMDU1NDQzMDkzODAzNiwtMC4xODE1NzY0NzMxNzA3ODQsMC43MDY5NzYw
>> MTU1ODIyMTgsMC45NjQ1MTc1NjI3NzgzMjgsMC4xODA1MTczMjU3NTIzODcs
>> MC4xNjM4NDQ2NDA0OTU5ODMsLTAuMjEzODA0NTUwMDQzMjM5LDAuMjU4MDMy
>> MzIyODI0NTk5LDAuMTkxODIwNDQ3NDA0MzM1DQoiY291bGRhdm9pZCIsLTAu
>> MjY4NDU5MTYyOTMwNTY3LC0wLjE0NTc5NTAwNjc0MTg4NCwtMC4xNzg3NjU1
>> NjMzNTQ4MjgsLTAuNDYyMTk1ODM5MjY1MDM1LC0wLjM4NTQ1MjEwMDA0NjYy
>> MywtMC4yNjM1ODc3NDYwMjExNzQsMC4xNjM1OTUyNzc0OTg3NTgsLTAuMjc5
>> Mjk4NDE3MTc3MjYxLDAuMDkyMzE5MjcwNDQzOTkzNCwwLjE4MDUxNzMyNTc1
>> MjM4NywwLjk2MzIzNzMwOTczMDcyNiwtMC4xMjAxMzAxOTYzOTI0MDYsLTAu
>> MDY4OTY1OTY1NzA1NzA5MSwwLjE2NTUzMzIwODc0MzU0NywwLjE5MTQyMTEz
>> NDE4OTY4Mg0KInBvc291dGNvbWUiLC0wLjA2NzgwOTUzNzUwNzYyMjIsMC4x
>> NDIwMzQzOTY5MDY4NzksMC4xNTEzNDM1Njc3NjE4NTksMC4xMjQxNTgzMzk1
>> MjczMjIsMC4wMjM4Nzc1NzI4Mjc3MTU3LC0wLjA0NTM5NzEzNzc3MDA4NDUs
>> LTAuMDA1MDcyNjg2MDg0MTc3MDQsMC4wNDQyNDgxMjM1MDgyNTI4LDAuMjEz
>> MDMyMjQyNDczMzE1LDAuMTYzODQ0NjQwNDk1OTgzLC0wLjEyMDEzMDE5NjM5
>> MjQwNiwwLjkzOTEwNzcxNzE4NjM4NSwtMC4yOTEyNjIzOTE4Mjc2NzEsMC4y
>> NTYyNzQxOTU5ODMwMDQsMC4zNDY0NDE0MTExMTYxNDcNCiJuZWdvdXRjb21l
>> IiwwLjE4MDU0OTkyNTAyNDM3NywwLjAwOTgxNTM4Mzk4NDM0ODUxLC0wLjAz
>> MzY1NTkwNjMzMDc4MzUsMC4xNjA2NjEzMDc0ODY1NTksMC4zMjQ1MjU2NTMx
>> NjQ1MDgsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMTYwMTM3NTQ1ODcxNDQ4LDAu
>> MjU4MzQ5NzAyNDYwNjYzLC0wLjIwOTg4MjQzMTc2NTExMCwtMC4yMTM4MDQ1
>> NTAwNDMyMzksLTAuMDY4OTY1OTY1NzA1NzA5MSwtMC4yOTEyNjIzOTE4Mjc2
>> NzEsMC45NTI1NTI5NjU3OTY0MjEsLTAuMjIxOTE3MjIyOTMwMTksLTAuMjMx
>> MDMyMDE0OTI3Mzk3DQoiY29udHJvbCIsLTAuMDQyMDg0NDM2NDAzNzg3NCww
>> LjA3MDU4Njg3NTY1Mzk3MzIsMC4wOTI5MDYyMjc5MzM0ODk4LC0wLjA4NjQ1
>> NzM3Mjc0NjYyNjUsLTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzNDcwNzUxNzY3
>> NzU4NiwwLjIxMTI1NzI1MjI4Nzk3OSwtMC4xOTY5OTMzNDYzMzcyMTQsMC4y
>> MzkxMjQ1NTE2Mjk1NTksMC4yNTgwMzIzMjI4MjQ1OTksMC4xNjU1MzMyMDg3
>> NDM1NDcsMC4yNTYyNzQxOTU5ODMwMDQsLTAuMjIxOTE3MjIyOTMwMTksMC45
>> Mzc2MDc1MzMxODY1NzYsMC4zMTI2NjQxOTk2MzE2MjANCiJkZXNpcmVkIiwt
>> MC4wNzMwNTc3ODk2OTAyOTY3LDAuMTA4MDAwNDQ5MzI4MzEzLDAuMTU5NzM1
>> NjE4NDIzMzM1LC0wLjA2ODM2NzQ4NDI0OTg4MDEsLTAuMjMzNjk2NTU0MTg5
>> MTY0LC0wLjIzOTEyNjk3MTQ4MDYyNSwwLjE0Nzg4NDM1MjU4ODQ5OSwtMC4y
>> MjI1MzM5NTI2MzM0ODIsMC4yMTkwNzgzNTI4OTA2NTcsMC4xOTE4MjA0NDc0
>> MDQzMzUsMC4xOTE0MjExMzQxODk2ODIsMC4zNDY0NDE0MTExMTYxNDcsLTAu
>> MjMxMDMyMDE0OTI3Mzk3LDAuMzEyNjY0MTk5NjMxNjIwLDAuOTYzMTMxNjM5
>> NTYwMTA4DQo=3D
>>
>> --1660387551-1458482416-1249639718=3D:2997--
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>
> --=20
> Jeffrey Ryan
> jeffrey.ryan at insightalgo.com
>
> ia: insight algorithmics
> www.insightalgo.com
>

CSV:

"","wasrightchoice","tellgood","tellbest","important","complex","difficult"=
,"onlyself","manydimensions","howmuchinfo","equalinfo","couldavoid","posout=
come","negoutcome","control","desired"
"wasrightchoice",0.96369773178963,0.292736321229647,0.289852808489117,0.385=
266965362761,0.197644824696320,0.183041324062298,-0.146626347219879,0.14635=
4027797101,-0.132887596902506,-0.173965069111025,-0.268459162930567,-0.0678=
095375076222,0.180549925024377,-0.0420844364037874,-0.0730577896902967
"tellgood",0.292736321229647,0.955494246210856,0.757544193339566,0.19124118=
3203129,0.000174630417564688,0.00340887118071287,0.00963050474358034,0.0283=
894373316684,0.0188027539463299,-0.0157026381515985,-0.145795006741884,0.14=
2034396906879,0.00981538398434851,0.0705868756539732,0.108000449328313
"tellbest",0.289852808489117,0.757544193339566,0.948593590912408,0.23059895=
8597528,0.0302692106135439,0.0155447055783122,0.0321693281988669,0.06463123=
26187096,0.0102945085651246,-0.0196759997923009,-0.178765563354828,0.151343=
567761859,-0.0336559063307835,0.0929062279334898,0.159735618423335
"important",0.385266965362761,0.191241183203129,0.230598958597528,0.9644978=
8034361,0.647657141488375,0.514175974554114,-0.197506705917123,0.4747233324=
69875,-0.129091329816201,-0.189229123705341,-0.462195839265035,0.1241583395=
27322,0.160661307486559,-0.0864573727466265,-0.0683674842498801
"complex",0.197644824696320,0.000174630417564688,0.0302692106135439,0.64765=
7141488375,0.976321655762968,0.754978777309553,-0.262340425824052,0.6567175=
33361176,-0.160427139673018,-0.236210856083902,-0.385452100046623,0.0238775=
728277157,0.324525653164508,-0.240634804887055,-0.233696554189164
"difficult",0.183041324062298,0.00340887118071287,0.0155447055783122,0.5141=
75974554114,0.754978777309553,0.957324341661972,-0.183005587551624,0.523183=
993897632,-0.197833354430907,-0.228434713061776,-0.263587746021174,-0.04539=
71377700845,0.330075666526761,-0.234707517677586,-0.239126971480625
"onlyself",-0.146626347219879,0.00963050474358034,0.0321693281988669,-0.197=
506705917123,-0.262340425824052,-0.183005587551624,0.947852415443663,-0.268=
333979295612,0.0787191879215654,0.0800554430938036,0.163595277498758,-0.005=
07268608417704,-0.160137545871448,0.211257252287979,0.147884352588499
"manydimensions",0.146354027797101,0.0283894373316684,0.0646312326187096,0.=
474723332469875,0.656717533361176,0.523183993897632,-0.268333979295612,0.94=
991766261616,-0.113295667408177,-0.181576473170784,-0.279298417177261,0.044=
2481235082528,0.258349702460663,-0.196993346337214,-0.222533952633482
"howmuchinfo",-0.132887596902506,0.0188027539463299,0.0102945085651246,-0.1=
29091329816201,-0.160427139673018,-0.197833354430907,0.0787191879215654,-0.=
113295667408177,0.946722746137415,0.706976015582218,0.0923192704439934,0.21=
3032242473315,-0.209882431765110,0.239124551629559,0.219078352890657
"equalinfo",-0.173965069111025,-0.0157026381515985,-0.0196759997923009,-0.1=
89229123705341,-0.236210856083902,-0.228434713061776,0.0800554430938036,-0.=
181576473170784,0.706976015582218,0.964517562778328,0.180517325752387,0.163=
844640495983,-0.213804550043239,0.258032322824599,0.191820447404335
"couldavoid",-0.268459162930567,-0.145795006741884,-0.178765563354828,-0.46=
2195839265035,-0.385452100046623,-0.263587746021174,0.163595277498758,-0.27=
9298417177261,0.0923192704439934,0.180517325752387,0.963237309730726,-0.120=
130196392406,-0.0689659657057091,0.165533208743547,0.191421134189682
"posoutcome",-0.0678095375076222,0.142034396906879,0.151343567761859,0.1241=
58339527322,0.0238775728277157,-0.0453971377700845,-0.00507268608417704,0.0=
442481235082528,0.213032242473315,0.163844640495983,-0.120130196392406,0.93=
9107717186385,-0.291262391827671,0.256274195983004,0.346441411116147
"negoutcome",0.180549925024377,0.00981538398434851,-0.0336559063307835,0.16=
0661307486559,0.324525653164508,0.330075666526761,-0.160137545871448,0.2583=
49702460663,-0.209882431765110,-0.213804550043239,-0.0689659657057091,-0.29=
1262391827671,0.952552965796421,-0.22191722293019,-0.231032014927397
"control",-0.0420844364037874,0.0705868756539732,0.0929062279334898,-0.0864=
573727466265,-0.240634804887055,-0.234707517677586,0.211257252287979,-0.196=
993346337214,0.239124551629559,0.258032322824599,0.165533208743547,0.256274=
195983004,-0.22191722293019,0.937607533186576,0.312664199631620
"desired",-0.0730577896902967,0.108000449328313,0.159735618423335,-0.068367=
4842498801,-0.233696554189164,-0.239126971480625,0.147884352588499,-0.22253=
3952633482,0.219078352890657,0.191820447404335,0.191421134189682,0.34644141=
1116147,-0.231032014927397,0.312664199631620,0.963131639560108

RAM:

important <-- challenge, NA, 1
complex  <-- challenge, c.complex, NA
difficult <-- challenge, c.difficult, NA
manydimensions <-- challenge, c.manydimensions, NA
couldavoid <-- challenge, c.couldavoid, NA
onlyself <-- challenge, c.onlyself, NA

wasrightchoice <-- eval, NA, 1
tellgood <-- eval, e.tellgood, NA
tellbest <-- eval, e.tellbest, NA
negoutcome <-- eval, e.negoutcome, NA

equalinfo <-- informed, NA, 1
control <-- informed, i.control, NA
desired <-- informed, i.desired, NA
howmuchinfo <-- informed, i.howmuchinfo, NA
posoutcome <-- informed, i.posoutcome, NA

wasrightchoice <-> wasrightchoice, wasrightchoiceV, NA
tellgood <-> tellgood, tellgoodV, NA
tellbest <-> tellbest, tellbestV, NA
negoutcome <-> negoutcome, negoutcomeV, NA

onlyself <-> onlyself, onlyselfV, NA
important <-> important, importantV, NA
complex <-> complex, complexV, NA
difficult <-> difficult, difficultV, NA
manydimensions <-> manydimensions, manydimensionsV, NA
couldavoid <-> couldavoid, couldavoidV, NA

equalinfo <-> equalinfo, equalinfoV, NA
control <-> control, controlV, NA
desired <-> desired, desiredV, NA
howmuchinfo <-> howmuchinfo, howmuchinfoV, NA
posoutcome <-> posoutcome, posoutcomeV, NA

eval <-> eval, evalV, NA
challenge <-> challenge, challengeV, NA
informed <-> informed, informedV, NA
--1660387551-150661043-1249684349=:2997--


From maechler at stat.math.ethz.ch  Sat Aug  8 15:04:07 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 8 Aug 2009 15:04:07 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <4A7C5C96.8010709@stats.uwo.ca>
References: <4A7C0ADC.8020105@stats.uwo.ca>
	<XFMail.090807144954.Ted.Harding@manchester.ac.uk>
	<19068.15935.722489.739608@stat.math.ethz.ch>
	<4A7C4757.7030909@stats.uwo.ca>
	<19068.19220.371101.466743@stat.math.ethz.ch>
	<4A7C5C96.8010709@stats.uwo.ca>
Message-ID: <19069.30663.477401.478473@stat.math.ethz.ch>

>>>>> "DM" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>     on Fri, 07 Aug 2009 12:55:50 -0400 writes:

    DM> On 8/7/2009 11:41 AM, Martin Maechler wrote:
    >>>>>>> "DM" == Duncan Murdoch <murdoch at stats.uwo.ca>
    >>>>>>> on Fri, 07 Aug 2009 11:25:11 -0400 writes:
    >> 
    DM> On 8/7/2009 10:46 AM, Martin Maechler wrote:
    >> >>>>>>> "TH" == Ted Harding <Ted.Harding at manchester.ac.uk>
    >> >>>>>>> on Fri, 07 Aug 2009 14:49:54 +0100 (BST) writes:
    >> >> 
    TH> On 07-Aug-09 11:07:08, Duncan Murdoch wrote:
    >> >> >> Martin Maechler wrote:
    >> >> >>>>>>>> William Dunlap <wdunlap at tibco.com>
    >> >> >>>>>>>> on Thu, 6 Aug 2009 15:06:08 -0700 writes:
    >> >> >>> >> -----Original Message----- From:
    >> >> >>> >> r-help-bounces at r-project.org
    >> >> >>> >> [mailto:r-help-bounces at r-project.org] On Behalf Of
    >> >> >>> >> Giovanni Petris Sent: Thursday, August 06, 2009 3:00 PM
    >> >> >>> >> To: milton.ruser at gmail.com Cc: r-help at r-project.org;
    >> >> >>> >> Daniel.Gerlanc at geodecapital.com Subject: Re: [R] Why is 0
    >> >> >>> >> not an integer?
    >> >> >>> >> 
    >> >> >>> >> 
    >> >> >>> >> I ran an instant experiment...
    >> >> >>> >> 
    >> >> >>> >> > typeof(0) [1] "double" > typeof(-0) [1] "double" >
    >> >> >>> >> identical(0, -0) [1] TRUE
    >> >> >>> >> 
    >> >> >>> >> Best, Giovanni
    >> >> >>> 
    >> >> >>> > But 0.0 and -0.0 have different reciprocals
    >> >> >>> 
    >> >> >>> >> 1.0/0.0
    >> >> >>> >    [1] Inf
    >> >> >>> >> 1.0/-0.0
    >> >> >>> >    [1] -Inf
    >> >> >>> 
    >> >> >>> > Bill Dunlap TIBCO Software Inc - Spotfire Division wdunlap
    >> >> >>> > tibco.com
    >> >> >>> 
    >> >> >>> yes.  {finally something interesting in this boring thread !}
    ---> diverting to R-devel
    >> >> >>> 
    >> >> >>> In April, I've had a private e-mail communication with John
    >> >> >>> Chambers [father of S, notably S4, which also brought identical()]
    >> >> >>> and Bill about the topic,
    >> >> >>> where I had started suggesting that  R  should be changed such
    >> >> >>> that
    >> >> >>> identical(-0. , +0.)
    >> >> >>> would return FALSE.
    >> >> >>> Bill did mention that it does so for (newish versions of) S+
    >> >> >>> and that he'd prefer that, too,
    >> >> >>> and John said
    >> >> >>> 
    >> >> >>> >> I agree on having a preference for a bitwise comparison for
    >> >> >>> >> identical()---that's what the name means after all.  But since
    >> >> >>> >> someone implemented the numerical case as the C == it's probably
    >> >> >>> >> going to be more hassle than it's worth to change it.  But we
    >> >> >>> >> should make the implementation clear in the documentation.
    >> >> >>> 
    >> >> >>> so in principle, we all agreed that R's identical() should be
    >> >> >>> changed here, namely by using something like  memcmp() instead
    >> >> >>> of simple '==' ,  however we haven't bothered to actually 
    >> >> >>> *implement* this change.
    >> >> >>> 
    >> >> >>> I am currently testing a patch  which would lead to
    >> >> >>> identical(0, -0)  return FALSE.
    >> >> >>> 
    >> >> >> I don't think that would be a good idea.  Other expressions besides
    >> >> >> "-0" 
    >> >> >> calculate the zero with the negative sign bit, e.g. the following
    >> >> >> sequence:
    >> >> >> 
    >> >> >> pos <- 1
    >> >> >> neg <- -1
    >> >> >> zero <- 0
    >> >> >> y <- zero*pos
    >> >> >> z <- zero*neg
    >> >> >> identical(y, z)
    >> >> >> 
    >> >> >> I think most R users would expect the last expression there to be
    >> >> >> TRUE based on the previous two lines, given that pos and neg both
    >> >> >> have finite values. In a simple case like this y == z would be a
    >> >> >> better test to use, but if those were components of a larger
    >> >> >> structure, identical() is all we've got, and people would waste a
    >> >> >> lot of time tracking down why structures differing only in the
    >> >> >> sign of zero were not identical, even though every element tested
    >> >> >> equal.
    >> >> 
    >> >> identical()  *is* not the same as '=='  even if you think of a
    >> >> generalized '==',
    >> >> and your example is not convincing to me.
    >> 
    DM> Fair enough, but after your change, how would one do what 
    DM> identical(list(pos, neg, zero, y), list(pos, neg, zero, z)) does now? 
    DM> That seems to me to be a more useful comparison than one that declares 
    DM> those to be unequal because the signs of y and z differ.
    >> 
    >> Maybe something like
    >> 
    >> all(mapply(`==`,  list(pos, neg, zero, y), list(pos, neg, zero, z)))
    >> 
    >> ## or even
    >> 
    >> isTRUE(all.equal( list(pos, neg, zero, y), list(pos, neg, zero, z),
    >> tol = 0))

    DM> I think I didn't make my point clearly.  I'm not particularly worried 
    DM> about lists of numbers, I'm worried about signed zeros buried in complex 
    DM> structures.  identical(struc1, struc2) works nicely now for that sort of 
    DM> comparison; indeed the man page for it says:

and so does isTRUE(all.equal(..)) as given above.

For me, all your arguments point to all.equal(..., tol=0)

    DM> indeed the man page for it says:

    DM> A call to 'identical' is the way to test exact equality in 'if'
    DM> and 'while' statements, as well as in logical expressions that use
    DM> '&&' or '||'.  In all these applications you need to be assured of
    DM> getting a single logical value.

Yes, note the word "exact" ..
but see below

    DM> The description you quote below does contradict this, and it also 
    DM> contradicts the statement

    DM> 'identical' sees 'NaN' as different from 'NA_real_', but all
    DM> 'NaN's are equal (and all 'NA' of the same type are equal).

which makes sense as I think they cannot be distinguished by R,
but even here, I could think of case where I'd like identical()
to be less lenient....  
Maybe we should think of a 3rd optional argument, along the
lines Ted suggested (but with a different default than his..).

    DM> I think the solution is to fix the man page, not the
    DM> function.  

NO !!!!!

As I said very early:

identical() was introduced with S4, ca. 1998, by John Chambers.
The DESCRIPTION above is really what it should do !

In Splus 5.1 { 1999 }, one of the earliest publicly available
versions of S4,
    identical(0. , -0.)    already gives FALSE.

identical() was introduced into R for 1.4.0, spring 2002,
and given the above, it just always never did what it should
have, and of course, that bug / problem  *is*  very rare and
typically not very consequential and so we all have lived with
that buglet for 7 years...

Can you give a *real* {not contrived} example where the old use
was important?  Do you know of cases where users used
identical()  in cases they should have used  all.equal(*, tol=0)?

Maybe we should introduce a function that's basically
isTRUE(all.equal(..., tol=0))  {but faster},  or
do you want a 3rd argument to identical, say 'method'
with default  c("oneNaN", "use.==", "strict")

oneNaN: my proposal of using  memcmp() on doubles as its used for
       other types already  (and hence distinguishing +0 and -0;
     otherwise keeping the feature that there's just one NaN
     which differs from 'NA' (and there's just one 'NA').

use.==: the previous R behaviour, using '==' on doubles 
	(and the "oneNaN" behavior)

strict: be even stricter than oneNaN:  Use  memcmp()
	unconditionally for doubles.  This would be the fastest
	version of all three.

    DM> For 
    DM> example, the "_exactly_" seems to be what is upsetting you; I'd suggest 
    DM> instead

    DM> "The safe and reliable way to test two objects for being equal in 
    DM> structure and content.  It returns 'TRUE' in this case, 'FALSE' in every 
    DM> other case."

I don't think so, not at all.
That would rather be a description of   isTRUE(all.equal(..., tol=0))

    DM> Duncan Murdoch


    >> 
    >> the latter of which is more flexible adaptable at what the user
    >> is really wanting to test.
    >> 
    >> >> Further note that help(identical)  has always said
    >> >> 
    >> >> > Description:
    >> >> 
    >> >> >    The safe and reliable way to test two objects for being _exactly_
    >> >> >    equal.  It returns 'TRUE' in this case, 'FALSE' in every other case.
    >> >> 
    >> >> which really should distinguish  -0 and +0
    >> >> 
    >> >> 
    >> >> >> Duncan Murdoch
    >> >> >>> Martin Maechler, ETH Zurich
    >> >> 
    TH> My own view of this is that there may in certain cirumstances be an
    TH> interest in distinguishing between 0 and (-0), yet normally most
    TH> users will simply want to compare the numerical values.
    >> >> 
    TH> Therefore I am in favour of revising identical() so that it can so
    TH> distinguish; but also of taking the opportunity to give it a parameter
    TH> say
    >> >> 
    TH> identical(x,y,sign.bit=FALSE)
    >> >> 
    TH> so that the default behaviour would be to see 0 and (-0) as identical,
    TH> but with sign.bit=TRUE it would see the difference.
    >> >> 
    TH> However, I put this forward in ignorance of
    TH> a) Any difficulties that this may present in re-coding identical();
    TH> b) Any complications that may arise when applying this new form
    TH> to complex objects.
    >> >> 
    >> >> Your proposal would actually need to special case this one case,
    >> >> rather than my patch  which  replaces  using  '=='   (in C) for
    >> >> double by using  memcmp() instead,  something which is already
    >> >> used for several other cases there, and hence seems more
    >> >> consequent and in that way natural.
    >> >> 
    >> >> The one thing even the new code would not differentiate is the
    >> >> different  NaN's (apart from NA) but they are not differentiable
    >> >> on the R level either, AFAIK, at least AFAIU our language
    >> >> specifications, we only want two things: NA and NaN
    >> 
    DM> I don't understand what you are proposing now.  The different NaN's have 
    DM> different bit patterns, so wouldn't memcmp() see a difference?  And 
    DM> taking your literalist point of view, the fact that it is hard to detect 
    DM> the difference at the R level (requiring C code support to do it) 
    DM> doesn't mean there is no difference, there's just a very subtle, rarely 
    DM> detectable difference, like the one between +0 and -0.
    >> 
    DM> Duncan Murdoch
    >> 
    >> >> 
    >> >> Martin
    >> >> 
    >> >> ______________________________________________
    >> >> R-devel at r-project.org mailing list
    >> >> https://stat.ethz.ch/mailman/listinfo/r-devel

    DM> ______________________________________________
    DM> R-devel at r-project.org mailing list
    DM> https://stat.ethz.ch/mailman/listinfo/r-devel


From nashjc at uottawa.ca  Sat Aug  8 16:39:04 2009
From: nashjc at uottawa.ca (Prof. John C Nash)
Date: Sat, 08 Aug 2009 10:39:04 -0400
Subject: [Rd] identical(0, -0)
In-Reply-To: <mailman.23.1249725606.24224.r-devel@r-project.org>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>
Message-ID: <4A7D8E08.2070300@uottawa.ca>

I'll save space and not include previous messages.

My 2 cents: At the very least the documentation needs a fix. If it is 
easy to do, then Ted Harding's suggestion of a switch (default OFF) to 
check for sign difference would be sensible.

I would urge inclusion in the documentation of the +0, -0 example(s) if 
there is NOT a way in R to distinguish these. There are occasions where 
it is useful to be able to detect things like this (and NaN and Inf and 
-Inf etc.). They are usually not of interest to users, but sometimes are 
needed for developers to check edge effects. For those cases it may be 
time to consider a package FPIEEE754 or some similar name to allow 
testing and possibly setting of flags for some of the fancier features. 
Likely used by just a few of us in extreme situations.  Unfortunately, 
some of the nice exception handling that was suggested in the standard 
is apparently rarely implemented in compilers.

For info, I was actually a voting member of IEEE 754 because I found a 
nice "feature" in the IBM Fortran G arithmetic, though I never sat in on 
any of the meetings.

JN


From ggrothendieck at gmail.com  Sat Aug  8 18:19:19 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 8 Aug 2009 12:19:19 -0400
Subject: [Rd] identical(0, -0)
In-Reply-To: <4A7D8E08.2070300@uottawa.ca>
References: <mailman.23.1249725606.24224.r-devel@r-project.org> 
	<4A7D8E08.2070300@uottawa.ca>
Message-ID: <971536df0908080919k57678041m199fa4c94ee2d7@mail.gmail.com>

On Sat, Aug 8, 2009 at 10:39 AM, Prof. John C Nash<nashjc at uottawa.ca> wrote:
> I would urge inclusion in the documentation of the +0, -0 example(s) if
> there is NOT a way in R to distinguish these. There are occasions where it

For single numbers try this:

x <- +0
y <- -0
identical(x, y) && identical(1/x, 1/y) # FALSE


From gavin.simpson at ucl.ac.uk  Sat Aug  8 20:31:33 2009
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Sat, 08 Aug 2009 19:31:33 +0100
Subject: [Rd] Problem using model.frame with argument subset in own function
Message-ID: <1249756293.2242.15.camel@graptoleberis.geog.ucl.ac.uk>

Dear List,

I am writing a formula method for a function in a package I maintain. I
want the method to return a data.frame that potentially only contains
some of the variables in 'data', as specified by the formula.

The problem I am having is in writing the function and wrapping it
around model.frame. Consider the following data frame:

dat <- data.frame(A = runif(10), B = runif(10), C = runif(10))

And the wrapper function:

foo <- function(formula, data = NULL, ..., subset = NULL,
                na.action = na.pass) {
    mt <- terms(formula, data = data, simplify = TRUE)
    mf <- model.frame(formula(mt), data = data, subset = subset,
                      na.action = na.action)
    ## real function would do more stuff here and pass mf on to
    ## other functions
    mf
}

This is how I envisage the function being called. The real world use
would have a data.frame with tens or hundreds of components where only a
few need to be excluded. Hence wanting formulas of the form below to
work.

foo(~ . - B, data = dat)

The aim is to return only columns A and C in an object returned by
model.frame. However, when I run the above, I get the following error:

> foo(~ A + B, data = dat)
Error in xj[i] : invalid subscript type 'closure'

I've tracked this down to the line in model.frame.default

    subset <- eval(substitute(subset), data, env)

After evaluating this line, subset contains:

Browse[1]> subset
function (x, ...) 
UseMethod("subset")
<environment: namespace:base>

Not NULL, and hence the error later on when calling the internal
model.frame code.

So the question is, what am I doing wrong?

If I leave the subset argument out of the definition of foo and rely
upon the default in model.frame.default, the function works as
expected. 

Perhaps the question should be, how do I modify foo() to allow it to
have a formal subset argument, passed to model.frame?

Any other suggestions gratefully accepted.

Thanks in advance,

G
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From lgautier at gmail.com  Sun Aug  9 16:20:38 2009
From: lgautier at gmail.com (laurent)
Date: Sun, 09 Aug 2009 16:20:38 +0200
Subject: [Rd] Why is strptime always returning a vector of length 9 ?
Message-ID: <1249827638.4877.15.camel@hot-spring>

Dear List,


I am having an issue with strptime (see below).
I can reproduce it on R-2.8, R-2.9, and R-2.10-dev, I tempted to see
either a bug or my misunderstanding (and then I just don't currently see
where).

# setup:
x <- c("March 09, 2007", "May 31, 2007", "November 12, 2008", "November
12, 2008", "July 30, 2009", "July 30, 2009" )

# showing the problem
> length(x)
6
> xd <- strptime(x, format = "%B %d, %Y")
> length(xd)
9
> xd[1:9]
[1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
[6] "2009-07-30" NA           NA           NA   
> length(strptime(rep(x, 2), format="%B %d, %Y"))
[1] 9
> strptime(rep(x, 2), format="%B %d, %Y")[1:12]
 [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
 [6] "2009-07-30" "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12"
[11] "2009-07-30" "2009-07-30

Any pointer would be appreciated.



L.


From ggrothendieck at gmail.com  Sun Aug  9 17:35:01 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 9 Aug 2009 11:35:01 -0400
Subject: [Rd] Why is strptime always returning a vector of length 9 ?
In-Reply-To: <1249827638.4877.15.camel@hot-spring>
References: <1249827638.4877.15.camel@hot-spring>
Message-ID: <971536df0908090835i3b6048a5h961920de644278cb@mail.gmail.com>

Try this to see its components:

> str(unclass(xd))
List of 9
 $ sec  : num [1:6] 0 0 0 0 0 0
 $ min  : int [1:6] 0 0 0 0 0 0
 $ hour : int [1:6] 0 0 0 0 0 0
 $ mday : int [1:6] 9 31 12 12 30 30
 $ mon  : int [1:6] 2 4 10 10 6 6
 $ year : int [1:6] 107 107 108 108 109 109
 $ wday : int [1:6] 5 4 3 3 4 4
 $ yday : int [1:6] 67 150 316 316 210 210
 $ isdst: int [1:6] 0 1 0 0 1 1

and read R News 4/1 for more.

On Sun, Aug 9, 2009 at 10:20 AM, laurent<lgautier at gmail.com> wrote:
> Dear List,
>
>
> I am having an issue with strptime (see below).
> I can reproduce it on R-2.8, R-2.9, and R-2.10-dev, I tempted to see
> either a bug or my misunderstanding (and then I just don't currently see
> where).
>
> # setup:
> x <- c("March 09, 2007", "May 31, 2007", "November 12, 2008", "November
> 12, 2008", "July 30, 2009", "July 30, 2009" )
>
> # showing the problem
>> length(x)
> 6
>> xd <- strptime(x, format = "%B %d, %Y")
>> length(xd)
> 9
>> xd[1:9]
> [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
> [6] "2009-07-30" NA ? ? ? ? ? NA ? ? ? ? ? NA
>> length(strptime(rep(x, 2), format="%B %d, %Y"))
> [1] 9
>> strptime(rep(x, 2), format="%B %d, %Y")[1:12]
> ?[1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
> ?[6] "2009-07-30" "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12"
> [11] "2009-07-30" "2009-07-30
>
> Any pointer would be appreciated.
>
>
>
> L.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From bates at stat.wisc.edu  Sun Aug  9 18:32:15 2009
From: bates at stat.wisc.edu (Douglas Bates)
Date: Sun, 9 Aug 2009 11:32:15 -0500
Subject: [Rd] Problem using model.frame with argument subset in own
	function
In-Reply-To: <1249756293.2242.15.camel@graptoleberis.geog.ucl.ac.uk>
References: <1249756293.2242.15.camel@graptoleberis.geog.ucl.ac.uk>
Message-ID: <40e66e0b0908090932i615dea16tf64c8015d30d05b3@mail.gmail.com>

On Sat, Aug 8, 2009 at 1:31 PM, Gavin Simpson<gavin.simpson at ucl.ac.uk> wrote:
> Dear List,

> I am writing a formula method for a function in a package I maintain. I
> want the method to return a data.frame that potentially only contains
> some of the variables in 'data', as specified by the formula.

The usual way to call model.frame (the method that Thomas Lumley has
called "the standard, non-standard evaluation) is to match the call to
foo, replace the name of the function being called with
as.name("model.frame") and force an evaluation in the parent frame.
it looks like

    mf <- match.call()
    if (missing(data)) data <- environment(formula)
    ## evaluate and install the model frame
    m <- match(c("formula", "data", "subset", "weights", "na.action", "offset"),
               names(mf), 0)
    mf <- mf[c(1, m)]
    mf$drop.unused.levels <- TRUE
    mf[[1]] <- as.name("model.frame")
    fr <- eval(mf, parent.frame())

The point of all of this manipulation is to achieve the kind of result
you need where the subset argument is evaluated in the correct
environmnent.

> The problem I am having is in writing the function and wrapping it
> around model.frame. Consider the following data frame:
>
> dat <- data.frame(A = runif(10), B = runif(10), C = runif(10))
>
> And the wrapper function:
>
> foo <- function(formula, data = NULL, ..., subset = NULL,
> ? ? ? ? ? ? ? ?na.action = na.pass) {
> ? ?mt <- terms(formula, data = data, simplify = TRUE)
> ? ?mf <- model.frame(formula(mt), data = data, subset = subset,
> ? ? ? ? ? ? ? ? ? ? ?na.action = na.action)
> ? ?## real function would do more stuff here and pass mf on to
> ? ?## other functions
> ? ?mf
> }
>
> This is how I envisage the function being called. The real world use
> would have a data.frame with tens or hundreds of components where only a
> few need to be excluded. Hence wanting formulas of the form below to
> work.
>
> foo(~ . - B, data = dat)
>
> The aim is to return only columns A and C in an object returned by
> model.frame. However, when I run the above, I get the following error:
>
>> foo(~ A + B, data = dat)
> Error in xj[i] : invalid subscript type 'closure'
>
> I've tracked this down to the line in model.frame.default
>
> ? ?subset <- eval(substitute(subset), data, env)
>
> After evaluating this line, subset contains:
>
> Browse[1]> subset
> function (x, ...)
> UseMethod("subset")
> <environment: namespace:base>
>
> Not NULL, and hence the error later on when calling the internal
> model.frame code.
>
> So the question is, what am I doing wrong?
>
> If I leave the subset argument out of the definition of foo and rely
> upon the default in model.frame.default, the function works as
> expected.
>
> Perhaps the question should be, how do I modify foo() to allow it to
> have a formal subset argument, passed to model.frame?
>
> Any other suggestions gratefully accepted.
>
> Thanks in advance,
>
> G
> --
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> ?Dr. Gavin Simpson ? ? ? ? ? ? [t] +44 (0)20 7679 0522
> ?ECRC, UCL Geography, ? ? ? ? ?[f] +44 (0)20 7679 0565
> ?Pearson Building, ? ? ? ? ? ? [e] gavin.simpsonATNOSPAMucl.ac.uk
> ?Gower Street, London ? ? ? ? ?[w] http://www.ucl.ac.uk/~ucfagls/
> ?UK. WC1E 6BT. ? ? ? ? ? ? ? ? [w] http://www.freshwaters.org.uk
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jeff.a.ryan at gmail.com  Sun Aug  9 18:45:55 2009
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Sun, 9 Aug 2009 11:45:55 -0500
Subject: [Rd] Why is strptime always returning a vector of length 9 ?
In-Reply-To: <971536df0908090835i3b6048a5h961920de644278cb@mail.gmail.com>
References: <1249827638.4877.15.camel@hot-spring>
	<971536df0908090835i3b6048a5h961920de644278cb@mail.gmail.com>
Message-ID: <e8e755250908090945v55c10432xda597826452b301f@mail.gmail.com>

The reason is in the ?strptime under value:

'strptime' turns character representations into an object of class
     '"POSIXlt"'.  The timezone is used to set the 'isdst' component
     and to set the '"tzone"' attribute if 'tz != ""'.

And POSIXlt is a list of length 9.


HTH
Jeff

On Sun, Aug 9, 2009 at 10:35 AM, Gabor
Grothendieck<ggrothendieck at gmail.com> wrote:
> Try this to see its components:
>
>> str(unclass(xd))
> List of 9
> ?$ sec ?: num [1:6] 0 0 0 0 0 0
> ?$ min ?: int [1:6] 0 0 0 0 0 0
> ?$ hour : int [1:6] 0 0 0 0 0 0
> ?$ mday : int [1:6] 9 31 12 12 30 30
> ?$ mon ?: int [1:6] 2 4 10 10 6 6
> ?$ year : int [1:6] 107 107 108 108 109 109
> ?$ wday : int [1:6] 5 4 3 3 4 4
> ?$ yday : int [1:6] 67 150 316 316 210 210
> ?$ isdst: int [1:6] 0 1 0 0 1 1
>
> and read R News 4/1 for more.
>
> On Sun, Aug 9, 2009 at 10:20 AM, laurent<lgautier at gmail.com> wrote:
>> Dear List,
>>
>>
>> I am having an issue with strptime (see below).
>> I can reproduce it on R-2.8, R-2.9, and R-2.10-dev, I tempted to see
>> either a bug or my misunderstanding (and then I just don't currently see
>> where).
>>
>> # setup:
>> x <- c("March 09, 2007", "May 31, 2007", "November 12, 2008", "November
>> 12, 2008", "July 30, 2009", "July 30, 2009" )
>>
>> # showing the problem
>>> length(x)
>> 6
>>> xd <- strptime(x, format = "%B %d, %Y")
>>> length(xd)
>> 9
>>> xd[1:9]
>> [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
>> [6] "2009-07-30" NA ? ? ? ? ? NA ? ? ? ? ? NA
>>> length(strptime(rep(x, 2), format="%B %d, %Y"))
>> [1] 9
>>> strptime(rep(x, 2), format="%B %d, %Y")[1:12]
>> ?[1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
>> ?[6] "2009-07-30" "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12"
>> [11] "2009-07-30" "2009-07-30
>>
>> Any pointer would be appreciated.
>>
>>
>>
>> L.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From spencer.graves at prodsyse.com  Sun Aug  9 19:04:28 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Sun, 09 Aug 2009 12:04:28 -0500
Subject: [Rd] odbcConnectExcel on non-Windows?
Message-ID: <4A7F019C.9040804@prodsyse.com>

Hello: 


      What should I do regarding code to write an Excel file in a 
non-Windows platform? 


      The "sos" package [new version of "RSiteSearch"] on R-Forge 
includes "writeFindFn2xls", which starts with "require(RODBC)".  The 
next line calls "odbcConnectExcel".  This works under Windows but fails 
under Linux and MacOS. 


      What would you suggest we do about this? 


      It currently tests (.Platform$OS.type == "windows");  if(FALSE), 
it issues an error, saying that it only works under Windows.  Also, the 
help page skips those tests if the the platform is not Windows. 


      If there is a better way to handle this, I would like to know. 


      Thanks,
      Spencer


From edd at debian.org  Sun Aug  9 19:15:38 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 9 Aug 2009 12:15:38 -0500
Subject: [Rd] odbcConnectExcel on non-Windows?
In-Reply-To: <4A7F019C.9040804@prodsyse.com>
References: <4A7F019C.9040804@prodsyse.com>
Message-ID: <19071.1082.186884.123257@ron.nulle.part>


On 9 August 2009 at 12:04, spencerg wrote:
|       What should I do regarding code to write an Excel file in a 
| non-Windows platform? 
[...]
|       What would you suggest we do about this? 
[...] 
|       If there is a better way to handle this, I would like to know. 

http://cran.r-project.org/web/packages/WriteXLS/index.html

Portable (in the sense of used by Perl, Python, ... or other scripting
engines) solutions have existed for a dozen years.  We have a wrapper to Perl
code for a long time too (having been of the initial discussions that lead to
Greg's initial read.xls from the gdata package).

Dirk

-- 
Three out of two people have difficulties with fractions.


From ggrothendieck at gmail.com  Sun Aug  9 19:22:13 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 9 Aug 2009 13:22:13 -0400
Subject: [Rd] odbcConnectExcel on non-Windows?
In-Reply-To: <4A7F019C.9040804@prodsyse.com>
References: <4A7F019C.9040804@prodsyse.com>
Message-ID: <971536df0908091022j36e32232w420f70a01e728513@mail.gmail.com>

Instead of writing out an xls file you could write out a file
in any format that Excel can read, e.g. csv, with a suitable
renaming of your function.

On Sun, Aug 9, 2009 at 1:04 PM, spencerg<spencer.graves at prodsyse.com> wrote:
> Hello:
>
> ? ? What should I do regarding code to write an Excel file in a non-Windows
> platform?
>
> ? ? The "sos" package [new version of "RSiteSearch"] on R-Forge includes
> "writeFindFn2xls", which starts with "require(RODBC)". ?The next line calls
> "odbcConnectExcel". ?This works under Windows but fails under Linux and
> MacOS.
>
> ? ? What would you suggest we do about this?
>
> ? ? It currently tests (.Platform$OS.type == "windows"); ?if(FALSE), it
> issues an error, saying that it only works under Windows. ?Also, the help
> page skips those tests if the the platform is not Windows.
>
> ? ? If there is a better way to handle this, I would like to know.
>
> ? ? Thanks,
> ? ? Spencer
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From spencer.graves at prodsyse.com  Sun Aug  9 20:09:09 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Sun, 09 Aug 2009 13:09:09 -0500
Subject: [Rd] odbcConnectExcel on non-Windows?
In-Reply-To: <19071.1082.186884.123257@ron.nulle.part>
References: <4A7F019C.9040804@prodsyse.com>
	<19071.1082.186884.123257@ron.nulle.part>
Message-ID: <4A7F10C5.6060300@prodsyse.com>

Dear Marc: 


      In spite of your efforts to help me, I still get an "F" in your 
"WriteXLS" class.  Consider the following: 


 > library(WriteXLS)
 > help(pac=WriteXLS)
 > testPerl()
Perl found.

The following Perl modules were not found on this system:

Text::CSV_XS

If you have more than one Perl installation, be sure the correct one was 
used here.

Otherwise, please install the missing modules. See the package INSTALL 
file for more information.

##########################

      Might it be feasible to include the required Perl modules with the 
"WriteXLS" package?  Then you would not have to rely on fools like me 
not knowing how to get the preferred copy of any required Perl modules. 


      On my Windows platform (Vista), I got RODBC to work for 
"writeFindFn2xls" in the "sos" package.  Unfortunately, the "daily 
checks" on R-Forge failed on non-Windows platforms.  When I saw that, I 
asked R-Devel for help.  Dirk suggested I try "WriteXLS";  see below. 


      What do you suggest? 


      If I don't hear an answer, I propose to NOT add "WriteXLS" to the 
"DESCRIPTION" file but rather to modify the code for "writeFindFn2xls" 
so that on non-Windows platforms, it tests to see if "WriteXLS" is 
installed.  If no, it will issue an appropriate error message.  If it 
finds "WriteXLS", it will try to use it. 


      However, if you have other suggestions, I'd be pleased to hear them. 


      Best Wishes,
      Spencer Graves


 > sessionInfo()
R version 2.9.1 (2009-06-26)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United 
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

other attached packages:
[1] sos_1.0-5      brew_1.0-3     WriteXLS_1.8.1
#######################################

Dirk Eddelbuettel wrote:
> On 9 August 2009 at 12:04, spencerg wrote:
> |       What should I do regarding code to write an Excel file in a 
> | non-Windows platform? 
> [...]
> |       What would you suggest we do about this? 
> [...] 
> |       If there is a better way to handle this, I would like to know. 
>
> http://cran.r-project.org/web/packages/WriteXLS/index.html
>
> Portable (in the sense of used by Perl, Python, ... or other scripting
> engines) solutions have existed for a dozen years.  We have a wrapper to Perl
> code for a long time too (having been of the initial discussions that lead to
> Greg's initial read.xls from the gdata package).
>
> Dirk
>
>


From spencer.graves at prodsyse.com  Sun Aug  9 20:12:43 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Sun, 09 Aug 2009 13:12:43 -0500
Subject: [Rd] odbcConnectExcel on non-Windows?
In-Reply-To: <971536df0908091022j36e32232w420f70a01e728513@mail.gmail.com>
References: <4A7F019C.9040804@prodsyse.com>
	<971536df0908091022j36e32232w420f70a01e728513@mail.gmail.com>
Message-ID: <4A7F119B.1010404@prodsyse.com>

Dear Gabor: 

      Good suggestion.  I will probably do that if "WriteXLS" is not 
installed or if it is but "testPerl()" is FALSE. 

      Thanks,
      Spencer

Gabor Grothendieck wrote:
> Instead of writing out an xls file you could write out a file
> in any format that Excel can read, e.g. csv, with a suitable
> renaming of your function.
>
> On Sun, Aug 9, 2009 at 1:04 PM, spencerg<spencer.graves at prodsyse.com> wrote:
>   
>> Hello:
>>
>>     What should I do regarding code to write an Excel file in a non-Windows
>> platform?
>>
>>     The "sos" package [new version of "RSiteSearch"] on R-Forge includes
>> "writeFindFn2xls", which starts with "require(RODBC)".  The next line calls
>> "odbcConnectExcel".  This works under Windows but fails under Linux and
>> MacOS.
>>
>>     What would you suggest we do about this?
>>
>>     It currently tests (.Platform$OS.type == "windows");  if(FALSE), it
>> issues an error, saying that it only works under Windows.  Also, the help
>> page skips those tests if the the platform is not Windows.
>>
>>     If there is a better way to handle this, I would like to know.
>>
>>     Thanks,
>>     Spencer
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>     
>
>


From marc_schwartz at me.com  Sun Aug  9 21:26:00 2009
From: marc_schwartz at me.com (Marc Schwartz)
Date: Sun, 09 Aug 2009 14:26:00 -0500
Subject: [Rd] odbcConnectExcel on non-Windows?
In-Reply-To: <4A7F10C5.6060300@prodsyse.com>
References: <4A7F019C.9040804@prodsyse.com>
	<19071.1082.186884.123257@ron.nulle.part>
	<4A7F10C5.6060300@prodsyse.com>
Message-ID: <85E3F003-B3B5-4D1A-86E3-471A21A1BC26@me.com>

Hi Spencer,

Unfortunately, the two Perl modules in question, Text::CSV_XS and  
Encode, are not pure Perl modules as they contain C code.

This means that the modules need to be compiled either beforehand as a  
pre-packaged binary or during installation, both for the Perl version  
that is installed on the user's system and for the operating system in  
use. The modules are binary specific to the Perl minor version being  
used (eg. 5.6 is not compatible with 5.8, which is not compatible with  
5.10), which further complicates matters.

As a consequence, I cannot include them in the package and reasonably  
expect them to work for a given Perl version/OS combination.

For folks on Windows, there are essentially two options:

1. Install the ActiveState Perl distribution, which includes all  
required modules, without having to install anything extra. That is  
the easiest method today.

2. Install Duncan's Perl distribution as included in RTools, which at  
present does not include at least Text::CSV_XS. If one could convince  
Duncan to add that module to his offering, it would make that option  
easier, so as to not require users to separately install the module  
from CPAN or to install AS Perl. I have cc'd Duncan here to solicit  
his comments on that. It might also reduce the potential for confusion  
relative to having more than one Perl installation and dealing with  
setting $PATH, but that is not an overly complicated issue and why I  
have the 'perl' argument in the functions.


For folks on OSX, there seems to be the potential for Text::CSV_XS to  
be or not to be installed, possibly depending upon when they got their  
Mac and what updates have been installed. It was installed on my  
spring 2009 unibody MBP, but not on Prof. Ripley's MB Air, for  
example. If it is not, one can install XCode Tools to install a C  
compiler and then install/compile the module from CPAN or from  
MacPorts. One can also use the AS Perl installation to achieve the  
same simple approach as on Windows.

On most recent Linux distributions, the modules are either already  
present with the default Perl install or can be easily installed via  
the distribution's package management system (eg. yum or apt-get). Of  
course, AS Perl is also available here as yet another option if for  
some reason, folks don't want to use their Linux distribution's  
existing tools.

The above information is contained in the package INSTALL file. If  
things there are unclear, I welcome comments and content that might  
help to clarify things.

Regards,

Marc


On Aug 9, 2009, at 1:09 PM, spencerg wrote:

> Dear Marc:
>
>     In spite of your efforts to help me, I still get an "F" in your  
> "WriteXLS" class.  Consider the following:
>
> > library(WriteXLS)
> > help(pac=WriteXLS)
> > testPerl()
> Perl found.
>
> The following Perl modules were not found on this system:
>
> Text::CSV_XS
>
> If you have more than one Perl installation, be sure the correct one  
> was used here.
>
> Otherwise, please install the missing modules. See the package  
> INSTALL file for more information.
>
> ##########################
>
>     Might it be feasible to include the required Perl modules with  
> the "WriteXLS" package?  Then you would not have to rely on fools  
> like me not knowing how to get the preferred copy of any required  
> Perl modules.
>
>     On my Windows platform (Vista), I got RODBC to work for  
> "writeFindFn2xls" in the "sos" package.  Unfortunately, the "daily  
> checks" on R-Forge failed on non-Windows platforms.  When I saw  
> that, I asked R-Devel for help.  Dirk suggested I try "WriteXLS";   
> see below.
>
>     What do you suggest?
>
>     If I don't hear an answer, I propose to NOT add "WriteXLS" to  
> the "DESCRIPTION" file but rather to modify the code for  
> "writeFindFn2xls" so that on non-Windows platforms, it tests to see  
> if "WriteXLS" is installed.  If no, it will issue an appropriate  
> error message.  If it finds "WriteXLS", it will try to use it.
>
>     However, if you have other suggestions, I'd be pleased to hear  
> them.
>
>     Best Wishes,
>     Spencer Graves
>
>
> > sessionInfo()
> R version 2.9.1 (2009-06-26)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States. 
> 1252;LC_MONETARY=English_United States. 
> 1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> other attached packages:
> [1] sos_1.0-5      brew_1.0-3     WriteXLS_1.8.1
> #######################################
>
> Dirk Eddelbuettel wrote:
>> On 9 August 2009 at 12:04, spencerg wrote:
>> |       What should I do regarding code to write an Excel file in a  
>> | non-Windows platform? [...]
>> |       What would you suggest we do about this? [...] |       If  
>> there is a better way to handle this, I would like to know.
>> http://cran.r-project.org/web/packages/WriteXLS/index.html
>>
>> Portable (in the sense of used by Perl, Python, ... or other  
>> scripting
>> engines) solutions have existed for a dozen years.  We have a  
>> wrapper to Perl
>> code for a long time too (having been of the initial discussions  
>> that lead to
>> Greg's initial read.xls from the gdata package).
>>
>> Dirk
>>
>>
>


From lgautier at gmail.com  Sun Aug  9 21:45:07 2009
From: lgautier at gmail.com (laurent)
Date: Sun, 09 Aug 2009 21:45:07 +0200
Subject: [Rd] Why is strptime always returning a vector of length 9 ?
In-Reply-To: <e8e755250908090945v55c10432xda597826452b301f@mail.gmail.com>
References: <1249827638.4877.15.camel@hot-spring>
	<971536df0908090835i3b6048a5h961920de644278cb@mail.gmail.com>
	<e8e755250908090945v55c10432xda597826452b301f@mail.gmail.com>
Message-ID: <1249847107.6040.23.camel@hot-spring>

Thanks.

It seems that the source of my confusion comes from using first using
str() (and then once on the wrong track, it is easier to miss the
information a man page that also describes POSIXct that is itself a
vector of length equal to the number of entries it contains).

With the current example:
> str(xd)
 POSIXlt[1:9], format: "2007-03-09" "2007-05-31" "2008-11-12"
"2008-11-12" ...

A quick inspection of the output does indicate a something with nine
elements, but the elements appear to be "2007-03-09", "2007-05-31",
etc... possibly creating confusion.

To make it even more confusing I have:
> x[1]
[1] "March 09, 2007"
> str(x[1])
 chr "March 09, 2007"

For what it is worth, I think that the behavior of the extract operator
"[" (defined as a S3 method "[.POSIXlt()") is inconsistent with the
output of length() (default method for lists).


L.




On Sun, 2009-08-09 at 11:45 -0500, Jeff Ryan wrote:
> The reason is in the ?strptime under value:
> 
> 'strptime' turns character representations into an object of class
>      '"POSIXlt"'.  The timezone is used to set the 'isdst' component
>      and to set the '"tzone"' attribute if 'tz != ""'.
> 
> And POSIXlt is a list of length 9.
> 
> 
> HTH
> Jeff
> 
> On Sun, Aug 9, 2009 at 10:35 AM, Gabor
> Grothendieck<ggrothendieck at gmail.com> wrote:
> > Try this to see its components:
> >
> >> str(unclass(xd))
> > List of 9
> >  $ sec  : num [1:6] 0 0 0 0 0 0
> >  $ min  : int [1:6] 0 0 0 0 0 0
> >  $ hour : int [1:6] 0 0 0 0 0 0
> >  $ mday : int [1:6] 9 31 12 12 30 30
> >  $ mon  : int [1:6] 2 4 10 10 6 6
> >  $ year : int [1:6] 107 107 108 108 109 109
> >  $ wday : int [1:6] 5 4 3 3 4 4
> >  $ yday : int [1:6] 67 150 316 316 210 210
> >  $ isdst: int [1:6] 0 1 0 0 1 1
> >
> > and read R News 4/1 for more.
> >
> > On Sun, Aug 9, 2009 at 10:20 AM, laurent<lgautier at gmail.com> wrote:
> >> Dear List,
> >>
> >>
> >> I am having an issue with strptime (see below).
> >> I can reproduce it on R-2.8, R-2.9, and R-2.10-dev, I tempted to see
> >> either a bug or my misunderstanding (and then I just don't currently see
> >> where).
> >>
> >> # setup:
> >> x <- c("March 09, 2007", "May 31, 2007", "November 12, 2008", "November
> >> 12, 2008", "July 30, 2009", "July 30, 2009" )
> >>
> >> # showing the problem
> >>> length(x)
> >> 6
> >>> xd <- strptime(x, format = "%B %d, %Y")
> >>> length(xd)
> >> 9
> >>> xd[1:9]
> >> [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
> >> [6] "2009-07-30" NA           NA           NA
> >>> length(strptime(rep(x, 2), format="%B %d, %Y"))
> >> [1] 9
> >>> strptime(rep(x, 2), format="%B %d, %Y")[1:12]
> >>  [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
> >>  [6] "2009-07-30" "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12"
> >> [11] "2009-07-30" "2009-07-30
> >>
> >> Any pointer would be appreciated.
> >>
> >>
> >>
> >> L.
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> 
>


From gavin.simpson at ucl.ac.uk  Sun Aug  9 22:18:12 2009
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Sun, 09 Aug 2009 21:18:12 +0100
Subject: [Rd] Problem using model.frame with argument subset in own
 function
In-Reply-To: <40e66e0b0908090932i615dea16tf64c8015d30d05b3@mail.gmail.com>
References: <1249756293.2242.15.camel@graptoleberis.geog.ucl.ac.uk>
	<40e66e0b0908090932i615dea16tf64c8015d30d05b3@mail.gmail.com>
Message-ID: <1249849092.2371.28.camel@graptoleberis.geog.ucl.ac.uk>

On Sun, 2009-08-09 at 11:32 -0500, Douglas Bates wrote:
> On Sat, Aug 8, 2009 at 1:31 PM, Gavin Simpson<gavin.simpson at ucl.ac.uk> wrote:
> > Dear List,
> 
> > I am writing a formula method for a function in a package I maintain. I
> > want the method to return a data.frame that potentially only contains
> > some of the variables in 'data', as specified by the formula.
> 
> The usual way to call model.frame (the method that Thomas Lumley has
> called "the standard, non-standard evaluation) is to match the call to
> foo, replace the name of the function being called with
> as.name("model.frame") and force an evaluation in the parent frame.
> it looks like
> 

Thanks Doug. I also received an off-list reply from Brian Ripley
suggesting two alternative approaches.

The bit I was missing was how to manipulate other aspects of the call -
it hadn't clicked that the arguments of the function can be manipulated
by altering the components of the matched call.

In the end I came up with something like:

    mf <- match.call()
    mf[[1]] <- as.name("model.frame")
    mt <- terms(formula, data = data, simplify = TRUE)
    mf[[2]] <- formula(mt, data = data)
    mf$na.action <- substitute(na.action)
    dots <- list(...)
    mf[[names(dots)]] <- NULL
    mf <- eval(mf,parent.frame())
    tran.default(mf, ...)

which seems to be working in the tests I have been running, allowing me
to pass along some components of the call to model.frame, whilst
reserving ... for the default methods arguments, and also get the
simplified formula.

All the best,

G

>     mf <- match.call()
>     if (missing(data)) data <- environment(formula)
>     ## evaluate and install the model frame
>     m <- match(c("formula", "data", "subset", "weights", "na.action", "offset"),
>                names(mf), 0)
>     mf <- mf[c(1, m)]
>     mf$drop.unused.levels <- TRUE
>     mf[[1]] <- as.name("model.frame")
>     fr <- eval(mf, parent.frame())
> 
> The point of all of this manipulation is to achieve the kind of result
> you need where the subset argument is evaluated in the correct
> environmnent.
> 
> > The problem I am having is in writing the function and wrapping it
> > around model.frame. Consider the following data frame:
> >
> > dat <- data.frame(A = runif(10), B = runif(10), C = runif(10))
> >
> > And the wrapper function:
> >
> > foo <- function(formula, data = NULL, ..., subset = NULL,
> >                na.action = na.pass) {
> >    mt <- terms(formula, data = data, simplify = TRUE)
> >    mf <- model.frame(formula(mt), data = data, subset = subset,
> >                      na.action = na.action)
> >    ## real function would do more stuff here and pass mf on to
> >    ## other functions
> >    mf
> > }
> >
> > This is how I envisage the function being called. The real world use
> > would have a data.frame with tens or hundreds of components where only a
> > few need to be excluded. Hence wanting formulas of the form below to
> > work.
> >
> > foo(~ . - B, data = dat)
> >
> > The aim is to return only columns A and C in an object returned by
> > model.frame. However, when I run the above, I get the following error:
> >
> >> foo(~ A + B, data = dat)
> > Error in xj[i] : invalid subscript type 'closure'
> >
> > I've tracked this down to the line in model.frame.default
> >
> >    subset <- eval(substitute(subset), data, env)
> >
> > After evaluating this line, subset contains:
> >
> > Browse[1]> subset
> > function (x, ...)
> > UseMethod("subset")
> > <environment: namespace:base>
> >
> > Not NULL, and hence the error later on when calling the internal
> > model.frame code.
> >
> > So the question is, what am I doing wrong?
> >
> > If I leave the subset argument out of the definition of foo and rely
> > upon the default in model.frame.default, the function works as
> > expected.
> >
> > Perhaps the question should be, how do I modify foo() to allow it to
> > have a formal subset argument, passed to model.frame?
> >
> > Any other suggestions gratefully accepted.
> >
> > Thanks in advance,
> >
> > G
> > --
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >  Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> >  ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> >  Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> >  Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> >  UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From bolker at ufl.edu  Mon Aug 10 02:30:13 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Sun, 09 Aug 2009 20:30:13 -0400
Subject: [Rd] model.matrix evaluation challenges
Message-ID: <4A7F6A15.7090102@ufl.edu>

  I am having difficulty with evaluation/environment construction
for a formula to be evaluated by model.matrix().  Basically, I
want to construct a model matrix that first looks in "newdata"
for the values of the model parameters, then in "object at data".
Here's what I've tried:

  1. model.matrix(~f,data=c(newdata,object at data)) -- fails because
something (terms()?) within model.matrix() tries to coerce "data"
to a data frame -- but newdata and object at data have different
numbers of rows.

  2. with(c(newdata,object at data),model.matrix(~f))   works --
BUT not when ~f is assigned to another object (as it will be
when it is being dug out of a previously fit model).

  3. If "f" exists as a column within newdata and/or object at data,
but the formula is assigned to another object (see below), then
with(c(newdata,object at data),model.matrix(z))  fails -- because
model.matrix() is explicitly evaluating the variables in the formula
in the environment of z (i.e., ignoring the first argument of "with" ...)


  Any advice on how to solve this without making a bigger mess?

  sincerely
    Ben Bolker


## set up a data frame for prediction

set.seed(1001)
f = factor(rep(letters[1:4],each=20))
x = runif(80)
u = rnorm(4)
y = rnorm(80,mean=2+x*(3+u[f]),sd=0.1)
dat = data.frame(f,x,y)

## fit a model ... could easily do by lm() but want to
##   demonstrate the problem

library(bbmle)
m1 = mle2(y~dnorm(a+b*x,sd=exp(logs)),parameters=list(b~f),data=dat,
  start=list(a=0,b=2,logs=-3))

## data frame for prediction
pp0 = expand.grid(x=seq(0,1,length=11),
  f=levels(dat$f))

## combine frame and model data: have to keep the model data
##  around, because it contain other information needed for
##  prediction.

cc = c(pp0,m1 at data)
try(mm <- model.matrix(~f,cc))  ## fails -- different number of rows
  ## (at some point R tries to coerce cc to a data frame)
nrow(with(cc,model.matrix(~f))) ## works ... but ...

## here's what happens within predict.mle2()
## extract information about parameter models
params <- eval(m1 at call$parameters)
params <- params[[1]]
params[[2]] <- NULL

nrow(with(cc,model.matrix(params)))
rm(f)
## object "f" not found -- because model.matrix
##  evaluates in the parent environment of params ...
try(nrow(with(cc,model.matrix(params))))



-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
bolker at ufl.edu / www.zoology.ufl.edu/bolker
GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090809/5c009c7b/attachment.bin>

From maechler at stat.math.ethz.ch  Mon Aug 10 08:55:52 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 10 Aug 2009 08:55:52 +0200
Subject: [Rd] Why is strptime always returning a vector of length 9 ?
In-Reply-To: <1249847107.6040.23.camel@hot-spring>
References: <1249827638.4877.15.camel@hot-spring>
	<971536df0908090835i3b6048a5h961920de644278cb@mail.gmail.com>
	<e8e755250908090945v55c10432xda597826452b301f@mail.gmail.com>
	<1249847107.6040.23.camel@hot-spring>
Message-ID: <19071.50296.530055.626176@stat.math.ethz.ch>

>>>>> "l" == laurent  <lgautier at gmail.com>
>>>>>     on Sun, 09 Aug 2009 21:45:07 +0200 writes:

    l> Thanks.  It seems that the source of my confusion comes
    l> from using first using str() (and then once on the wrong
    l> track, it is easier to miss the information a man page
    l> that also describes POSIXct that is itself a vector of
    l> length equal to the number of entries it contains).

    l> With the current example:
    >> str(xd)
    l>  POSIXlt[1:9], format: "2007-03-09" "2007-05-31"
    l> "2008-11-12" "2008-11-12" ...

    l> A quick inspection of the output does indicate a
    l> something with nine elements, but the elements appear to
    l> be "2007-03-09", "2007-05-31", etc... possibly creating
    l> confusion.

    l> To make it even more confusing I have:
    >> x[1]
    l> [1] "March 09, 2007"
    >> str(x[1])
    l>  chr "March 09, 2007"

    l> For what it is worth, I think that the behavior of the
    l> extract operator "[" (defined as a S3 method
    l> "[.POSIXlt()") is inconsistent with the output of
    l> length() (default method for lists).

Yes, exactly;  these two have beeb defined inconsistently,
exactly in the respect you mention.

Many months ago, when I came to the same conclusion, 
I vaguely remember that I had wanted / proposed to change this
(namely, change [.POSIXlt, the  length() method for  "POSIXlt") ,
but IIRC had been vetoed by others.
... another frustrating experience for me ...

Martin Maechler, ETH Zurich



    l> On Sun, 2009-08-09 at 11:45 -0500, Jeff Ryan wrote:
    >> The reason is in the ?strptime under value:
    >> 
    >> 'strptime' turns character representations into an object of class
    >> '"POSIXlt"'.  The timezone is used to set the 'isdst' component
    >> and to set the '"tzone"' attribute if 'tz != ""'.
    >> 
    >> And POSIXlt is a list of length 9.
    >> 
    >> 
    >> HTH
    >> Jeff
    >> 
    >> On Sun, Aug 9, 2009 at 10:35 AM, Gabor
    >> Grothendieck<ggrothendieck at gmail.com> wrote:
    >> > Try this to see its components:
    >> >
    >> >> str(unclass(xd))
    >> > List of 9
    >> >  $ sec  : num [1:6] 0 0 0 0 0 0
    >> >  $ min  : int [1:6] 0 0 0 0 0 0
    >> >  $ hour : int [1:6] 0 0 0 0 0 0
    >> >  $ mday : int [1:6] 9 31 12 12 30 30
    >> >  $ mon  : int [1:6] 2 4 10 10 6 6
    >> >  $ year : int [1:6] 107 107 108 108 109 109
    >> >  $ wday : int [1:6] 5 4 3 3 4 4
    >> >  $ yday : int [1:6] 67 150 316 316 210 210
    >> >  $ isdst: int [1:6] 0 1 0 0 1 1
    >> >
    >> > and read R News 4/1 for more.
    >> >
    >> > On Sun, Aug 9, 2009 at 10:20 AM, laurent<lgautier at gmail.com> wrote:
    >> >> Dear List,
    >> >>
    >> >>
    >> >> I am having an issue with strptime (see below).
    >> >> I can reproduce it on R-2.8, R-2.9, and R-2.10-dev, I tempted to see
    >> >> either a bug or my misunderstanding (and then I just don't currently see
    >> >> where).
    >> >>
    >> >> # setup:
    >> >> x <- c("March 09, 2007", "May 31, 2007", "November 12, 2008", "November
    >> >> 12, 2008", "July 30, 2009", "July 30, 2009" )
    >> >>
    >> >> # showing the problem
    >> >>> length(x)
    >> >> 6
    >> >>> xd <- strptime(x, format = "%B %d, %Y")
    >> >>> length(xd)
    >> >> 9
    >> >>> xd[1:9]
    >> >> [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
    >> >> [6] "2009-07-30" NA           NA           NA
    >> >>> length(strptime(rep(x, 2), format="%B %d, %Y"))
    >> >> [1] 9
    >> >>> strptime(rep(x, 2), format="%B %d, %Y")[1:12]
    >> >>  [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
    >> >>  [6] "2009-07-30" "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12"
    >> >> [11] "2009-07-30" "2009-07-30
    >> >>
    >> >> Any pointer would be appreciated.
    >> >>
    >> >> L.


From maechler at stat.math.ethz.ch  Mon Aug 10 09:12:49 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 10 Aug 2009 09:12:49 +0200
Subject: [Rd] Why is strptime always returning a vector of length 9 ?
In-Reply-To: <19071.50296.530055.626176@stat.math.ethz.ch>
References: <1249827638.4877.15.camel@hot-spring>
	<971536df0908090835i3b6048a5h961920de644278cb@mail.gmail.com>
	<e8e755250908090945v55c10432xda597826452b301f@mail.gmail.com>
	<1249847107.6040.23.camel@hot-spring>
	<19071.50296.530055.626176@stat.math.ethz.ch>
Message-ID: <19071.51313.935077.384605@stat.math.ethz.ch>

{Correcting  thinko  below .. }

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Mon, 10 Aug 2009 08:55:52 +0200 writes:

>>>>> "l" == laurent  <lgautier at gmail.com>
>>>>>     on Sun, 09 Aug 2009 21:45:07 +0200 writes:

    l> Thanks.  It seems that the source of my confusion comes
    l> from using first using str() (and then once on the wrong
    l> track, it is easier to miss the information a man page
    l> that also describes POSIXct that is itself a vector of
    l> length equal to the number of entries it contains).

    l> With the current example:
    >>> str(xd)
    l> POSIXlt[1:9], format: "2007-03-09" "2007-05-31"
    l> "2008-11-12" "2008-11-12" ...

    l> A quick inspection of the output does indicate a
    l> something with nine elements, but the elements appear to
    l> be "2007-03-09", "2007-05-31", etc... possibly creating
    l> confusion.

    l> To make it even more confusing I have:
    >>> x[1]
    l> [1] "March 09, 2007"
    >>> str(x[1])
    l> chr "March 09, 2007"

    l> For what it is worth, I think that the behavior of the
    l> extract operator "[" (defined as a S3 method
    l> "[.POSIXlt()") is inconsistent with the output of
    l> length() (default method for lists).

    MM> Yes, exactly;  these two have beeb defined inconsistently,
    MM> exactly in the respect you mention.

    MM> Many months ago, when I came to the same conclusion, 
    MM> I vaguely remember that I had wanted / proposed to change this
    MM> (namely, change [.POSIXlt, the  length() method for  "POSIXlt") ,
    		 	^^^^^^^^^^
 "length.POSIXlt"  was what I meant to write ...

    MM> but IIRC had been vetoed by others.
    MM> ... another frustrating experience for me ...

    MM> Martin Maechler, ETH Zurich



    l> On Sun, 2009-08-09 at 11:45 -0500, Jeff Ryan wrote:
    >>> The reason is in the ?strptime under value:
    >>> 
    >>> 'strptime' turns character representations into an object of class
    >>> '"POSIXlt"'.  The timezone is used to set the 'isdst' component
    >>> and to set the '"tzone"' attribute if 'tz != ""'.
    >>> 
    >>> And POSIXlt is a list of length 9.
    >>> 
    >>> 
    >>> HTH
    >>> Jeff
    >>> 
    >>> On Sun, Aug 9, 2009 at 10:35 AM, Gabor
    >>> Grothendieck<ggrothendieck at gmail.com> wrote:
    >>> > Try this to see its components:
    >>> >
    >>> >> str(unclass(xd))
    >>> > List of 9
    >>> >  $ sec  : num [1:6] 0 0 0 0 0 0
    >>> >  $ min  : int [1:6] 0 0 0 0 0 0
    >>> >  $ hour : int [1:6] 0 0 0 0 0 0
    >>> >  $ mday : int [1:6] 9 31 12 12 30 30
    >>> >  $ mon  : int [1:6] 2 4 10 10 6 6
    >>> >  $ year : int [1:6] 107 107 108 108 109 109
    >>> >  $ wday : int [1:6] 5 4 3 3 4 4
    >>> >  $ yday : int [1:6] 67 150 316 316 210 210
    >>> >  $ isdst: int [1:6] 0 1 0 0 1 1
    >>> >
    >>> > and read R News 4/1 for more.
    >>> >
    >>> > On Sun, Aug 9, 2009 at 10:20 AM, laurent<lgautier at gmail.com> wrote:
    >>> >> Dear List,
    >>> >>
    >>> >>
    >>> >> I am having an issue with strptime (see below).
    >>> >> I can reproduce it on R-2.8, R-2.9, and R-2.10-dev, I tempted to see
    >>> >> either a bug or my misunderstanding (and then I just don't currently see
    >>> >> where).
    >>> >>
    >>> >> # setup:
    >>> >> x <- c("March 09, 2007", "May 31, 2007", "November 12, 2008", "November
    >>> >> 12, 2008", "July 30, 2009", "July 30, 2009" )
    >>> >>
    >>> >> # showing the problem
    >>> >>> length(x)
    >>> >> 6
    >>> >>> xd <- strptime(x, format = "%B %d, %Y")
    >>> >>> length(xd)
    >>> >> 9
    >>> >>> xd[1:9]
    >>> >> [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
    >>> >> [6] "2009-07-30" NA           NA           NA
    >>> >>> length(strptime(rep(x, 2), format="%B %d, %Y"))
    >>> >> [1] 9
    >>> >>> strptime(rep(x, 2), format="%B %d, %Y")[1:12]
    >>> >>  [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
    >>> >>  [6] "2009-07-30" "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12"
    >>> >> [11] "2009-07-30" "2009-07-30
    >>> >>
    >>> >> Any pointer would be appreciated.
    >>> >>
    >>> >> L.

    MM> ______________________________________________
    MM> R-devel at r-project.org mailing list
    MM> https://stat.ethz.ch/mailman/listinfo/r-devel


From savicky at cs.cas.cz  Mon Aug 10 11:21:41 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Mon, 10 Aug 2009 11:21:41 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <4A7D8E08.2070300@uottawa.ca>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>
	<4A7D8E08.2070300@uottawa.ca>
Message-ID: <20090810092141.GC10119@cs.cas.cz>

On Sat, Aug 08, 2009 at 10:39:04AM -0400, Prof. John C Nash wrote:
> I'll save space and not include previous messages.
> 
> My 2 cents: At the very least the documentation needs a fix. If it is 
> easy to do, then Ted Harding's suggestion of a switch (default OFF) to 
> check for sign difference would be sensible.
> 
> I would urge inclusion in the documentation of the +0, -0 example(s) if 
> there is NOT a way in R to distinguish these.

It is possible to distinguish 0 and -0 in R, since 1/0 == Inf and
1/(-0) == -Inf.

I do not know, whether there are also other such situations. In particular
  (0)^(-1) == (-0)^(-1) # [1] TRUE
  log(0) == log(-0) # [1] TRUE

> There are occasions where 
> it is useful to be able to detect things like this (and NaN and Inf and 
> -Inf etc.). They are usually not of interest to users, but sometimes are 
> needed for developers to check edge effects. For those cases it may be 
> time to consider a package FPIEEE754 or some similar name to allow 
> testing and possibly setting of flags for some of the fancier features. 
> Likely used by just a few of us in extreme situations.

I think that distinguishing 0 and -0 may be useful even for nonexpert
users for debugging purposes. Mainly, because x == y does not imply
that x and y behave equally as demonstrated above or by
  x <- 0
  y <-  - 0
  x == y # [1] TRUE
  1/x == 1/y # [1] FALSE

I would like to recall the suggestion
  On Sat, Aug 08, 2009 at 03:04:07PM +0200, Martin Maechler wrote:
  > Maybe we should introduce a function that's basically
  > isTRUE(all.equal(..., tol=0))  {but faster},  or
  > do you want a 3rd argument to identical, say 'method'
  > with default  c("oneNaN", "use.==", "strict")
  > 
  > oneNaN: my proposal of using  memcmp() on doubles as its used for
  >        other types already  (and hence distinguishing +0 and -0;
  >      otherwise keeping the feature that there's just one NaN
  >      which differs from 'NA' (and there's just one 'NA').
  > 
  > use.==: the previous R behaviour, using '==' on doubles 
  >   (and the "oneNaN" behavior)
  > 
  > strict: be even stricter than oneNaN:  Use  memcmp()
  >   unconditionally for doubles.  This would be the fastest
  >   version of all three.

In my opinion, for debugging purposes, the option identical(x,y,method="strict"),
which implies that x and y behave equally, could be useful, if it is available
in R base, 

At the R interactive level, negative zero as the value of -0 could possibly
be avoided. However, negative zero may also occur in numerical calculations,
since it may be obtained as x * 0, where x is negative. So, i think, negative
zero cannot be eliminated from consideration as something too infrequent.

Petr.


From rory.winston at gmail.com  Mon Aug 10 11:30:25 2009
From: rory.winston at gmail.com (rory.winston at gmail.com)
Date: Mon, 10 Aug 2009 09:30:25 +0000
Subject: [Rd] Duplicated lines in configure
Message-ID: <0016368e1c2f5e7a3e0470c63cd0@google.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090810/a380a04a/attachment.pl>

From murdoch at stats.uwo.ca  Mon Aug 10 11:47:57 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Aug 2009 05:47:57 -0400
Subject: [Rd] identical(0, -0)
In-Reply-To: <20090810092141.GC10119@cs.cas.cz>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>	<4A7D8E08.2070300@uottawa.ca>
	<20090810092141.GC10119@cs.cas.cz>
Message-ID: <4A7FECCD.2010208@stats.uwo.ca>

Petr Savicky wrote:
> On Sat, Aug 08, 2009 at 10:39:04AM -0400, Prof. John C Nash wrote:
>   
>> I'll save space and not include previous messages.
>>
>> My 2 cents: At the very least the documentation needs a fix. If it is 
>> easy to do, then Ted Harding's suggestion of a switch (default OFF) to 
>> check for sign difference would be sensible.
>>
>> I would urge inclusion in the documentation of the +0, -0 example(s) if 
>> there is NOT a way in R to distinguish these.
>>     
>
> It is possible to distinguish 0 and -0 in R, since 1/0 == Inf and
> 1/(-0) == -Inf.
>
> I do not know, whether there are also other such situations. In particular
>   (0)^(-1) == (-0)^(-1) # [1] TRUE
>   log(0) == log(-0) # [1] TRUE
>
>   
>> There are occasions where 
>> it is useful to be able to detect things like this (and NaN and Inf and 
>> -Inf etc.). They are usually not of interest to users, but sometimes are 
>> needed for developers to check edge effects. For those cases it may be 
>> time to consider a package FPIEEE754 or some similar name to allow 
>> testing and possibly setting of flags for some of the fancier features. 
>> Likely used by just a few of us in extreme situations.
>>     
>
> I think that distinguishing 0 and -0 may be useful even for nonexpert
> users for debugging purposes. Mainly, because x == y does not imply
> that x and y behave equally as demonstrated above or by
>   x <- 0
>   y <-  - 0
>   x == y # [1] TRUE
>   1/x == 1/y # [1] FALSE
>
> I would like to recall the suggestion
>   On Sat, Aug 08, 2009 at 03:04:07PM +0200, Martin Maechler wrote:
>   > Maybe we should introduce a function that's basically
>   > isTRUE(all.equal(..., tol=0))  {but faster},  or
>   > do you want a 3rd argument to identical, say 'method'
>   > with default  c("oneNaN", "use.==", "strict")
>   > 
>   > oneNaN: my proposal of using  memcmp() on doubles as its used for
>   >        other types already  (and hence distinguishing +0 and -0;
>   >      otherwise keeping the feature that there's just one NaN
>   >      which differs from 'NA' (and there's just one 'NA').
>   > 
>   > use.==: the previous R behaviour, using '==' on doubles 
>   >   (and the "oneNaN" behavior)
>   > 
>   > strict: be even stricter than oneNaN:  Use  memcmp()
>   >   unconditionally for doubles.  This would be the fastest
>   >   version of all three.
>
> In my opinion, for debugging purposes, the option identical(x,y,method="strict"),
> which implies that x and y behave equally, could be useful, if it is available
> in R base, 
>
> At the R interactive level, negative zero as the value of -0 could possibly
> be avoided. However, negative zero may also occur in numerical calculations,
> since it may be obtained as x * 0, where x is negative. So, i think, negative
> zero cannot be eliminated from consideration as something too infrequent.

I wouldn't mind a "strict" option.   It would compare bit patterns, so 
would distinguish +0 from -0, and different NaN values. But having the 
value of  identical(x-y, -(y-x)) depend on whether x and y are equal or 
not would just lead to confusion.W

Duncan Murdoch


From rphilosof at health.sdu.dk  Mon Aug 10 12:02:34 2009
From: rphilosof at health.sdu.dk (Rune Schjellerup Philosof)
Date: Mon, 10 Aug 2009 12:02:34 +0200
Subject: [Rd] multicore mclapply hangs
Message-ID: <4A7FF03A.7050106@health.sdu.dk>

When I execute mclapply it creates the needed processes, but these
processes never begin computing anything, they just wait indefinitely.
I recently upgraded to version 2.9.1, which might have caused the problem.

-- 
Med venlig hilsen
Rune Schjellerup Philosof
Ph.d.-studerende, Statistik, IST, SDU

Telefon:  6550 3607
E-mail:   rphilosof at health.sdu.dk
Adresse:  J.B. Winsl?wsvej 9, 5000 Odense C


From rory.winston at gmail.com  Mon Aug 10 12:09:44 2009
From: rory.winston at gmail.com (rory.winston at gmail.com)
Date: Mon, 10 Aug 2009 10:09:44 +0000
Subject: [Rd] Error Building R + X11 on SuSe 10
Message-ID: <0015174c369af594000470c6c888@google.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090810/83f65079/attachment.pl>

From schmidb at ibe.med.uni-muenchen.de  Mon Aug 10 12:17:42 2009
From: schmidb at ibe.med.uni-muenchen.de (Markus Schmidberger)
Date: Mon, 10 Aug 2009 12:17:42 +0200
Subject: [Rd] multicore mclapply hangs
In-Reply-To: <4A7FF03A.7050106@health.sdu.dk>
References: <4A7FF03A.7050106@health.sdu.dk>
Message-ID: <4A7FF3C6.3080807@ibe.med.uni-muenchen.de>

Hello Rune,

please use the mailinglist 'R-sig-hpc' 
(https://stat.ethz.ch/mailman/listinfo/r-sig-hpc, do not forget to 
register!) for this topic.

And please provide some more information:
* in R: sessionInfo()
* and your used operation system

Best
Markus



Rune Schjellerup Philosof schrieb:
> When I execute mclapply it creates the needed processes, but these
> processes never begin computing anything, they just wait indefinitely.
> I recently upgraded to version 2.9.1, which might have caused the problem.
>
>   


-- 
Dipl.-Tech. Math. Markus Schmidberger

Ludwig-Maximilians-Universit?t M?nchen
IBE - Institut f?r medizinische Informationsverarbeitung,
Biometrie und Epidemiologie
Marchioninistr. 15, D-81377 Muenchen
URL: http://www.ibe.med.uni-muenchen.de 
Mail: Markus.Schmidberger [at] ibe.med.uni-muenchen.de
Tel: +49 (089) 7095 - 4497


From rory.winston at gmail.com  Mon Aug 10 12:31:44 2009
From: rory.winston at gmail.com (rory.winston at gmail.com)
Date: Mon, 10 Aug 2009 10:31:44 +0000
Subject: [Rd] Error Building R + X11 on SuSe 10S
Message-ID: <001636163e73a399830470c71721@google.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090810/2bba7987/attachment.pl>

From murdoch at stats.uwo.ca  Mon Aug 10 13:54:26 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Aug 2009 07:54:26 -0400
Subject: [Rd] Error Building R + X11 on SuSe 10S
In-Reply-To: <001636163e73a399830470c71721@google.com>
References: <001636163e73a399830470c71721@google.com>
Message-ID: <4A800A72.2050401@stats.uwo.ca>

rory.winston at gmail.com wrote:
> Following on...
>
> Sorry folks, it looks like I have misdiagnosed the issue. When I connect to  
> the server using an X client and start up the
> newly built R instance, I see capabilities() shows X11 support as expected.  
> So this changes the character of my query
> somewhat: As I was hoping to run R in non-interactive mode (hence not using  
> an X client in the
> first instance), is there any way to run R in "headless" mode, so that  
> graphical output works, even in contexts
> where DISPLAY may not be set? (eg Java has an equivalent headless
> option that allows its graphical libraries to operate in such a situation,  
> so I guess it must be possible, in theory
> at least).
I'm not an X11 user, but I believe the test systems do this using Xvfb, 
the "virtual" X server.

Duncan Murdoch


From rory.winston at gmail.com  Mon Aug 10 13:56:50 2009
From: rory.winston at gmail.com (rory.winston at gmail.com)
Date: Mon, 10 Aug 2009 11:56:50 +0000
Subject: [Rd] Error Building R + X11 on SuSe 10S
In-Reply-To: <4A800A72.2050401@stats.uwo.ca>
Message-ID: <0016367f96ecf964db0470c84731@google.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090810/418b5d0a/attachment.pl>

From simon.urbanek at r-project.org  Mon Aug 10 15:55:08 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 10 Aug 2009 09:55:08 -0400
Subject: [Rd] identical(0, -0)
In-Reply-To: <4A7FECCD.2010208@stats.uwo.ca>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>	<4A7D8E08.2070300@uottawa.ca>
	<20090810092141.GC10119@cs.cas.cz> <4A7FECCD.2010208@stats.uwo.ca>
Message-ID: <353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>


On Aug 10, 2009, at 5:47 , Duncan Murdoch wrote:

> Petr Savicky wrote:
>> On Sat, Aug 08, 2009 at 10:39:04AM -0400, Prof. John C Nash wrote:
>>
>>> I'll save space and not include previous messages.
>>>
>>> My 2 cents: At the very least the documentation needs a fix. If it  
>>> is easy to do, then Ted Harding's suggestion of a switch (default  
>>> OFF) to check for sign difference would be sensible.
>>>
>>> I would urge inclusion in the documentation of the +0, -0  
>>> example(s) if there is NOT a way in R to distinguish these.
>>>
>>
>> It is possible to distinguish 0 and -0 in R, since 1/0 == Inf and
>> 1/(-0) == -Inf.
>>
>> I do not know, whether there are also other such situations. In  
>> particular
>>  (0)^(-1) == (-0)^(-1) # [1] TRUE
>>  log(0) == log(-0) # [1] TRUE
>>
>>
>>> There are occasions where it is useful to be able to detect things  
>>> like this (and NaN and Inf and -Inf etc.). They are usually not of  
>>> interest to users, but sometimes are needed for developers to  
>>> check edge effects. For those cases it may be time to consider a  
>>> package FPIEEE754 or some similar name to allow testing and  
>>> possibly setting of flags for some of the fancier features. Likely  
>>> used by just a few of us in extreme situations.
>>>
>>
>> I think that distinguishing 0 and -0 may be useful even for nonexpert
>> users for debugging purposes. Mainly, because x == y does not imply
>> that x and y behave equally as demonstrated above or by
>>  x <- 0
>>  y <-  - 0
>>  x == y # [1] TRUE
>>  1/x == 1/y # [1] FALSE
>>
>> I would like to recall the suggestion
>>  On Sat, Aug 08, 2009 at 03:04:07PM +0200, Martin Maechler wrote:
>>  > Maybe we should introduce a function that's basically
>>  > isTRUE(all.equal(..., tol=0))  {but faster},  or
>>  > do you want a 3rd argument to identical, say 'method'
>>  > with default  c("oneNaN", "use.==", "strict")
>>  >   > oneNaN: my proposal of using  memcmp() on doubles as its  
>> used for
>>  >        other types already  (and hence distinguishing +0 and -0;
>>  >      otherwise keeping the feature that there's just one NaN
>>  >      which differs from 'NA' (and there's just one 'NA').
>>  >   > use.==: the previous R behaviour, using '==' on doubles    
>> >   (and the "oneNaN" behavior)
>>  >   > strict: be even stricter than oneNaN:  Use  memcmp()
>>  >   unconditionally for doubles.  This would be the fastest
>>  >   version of all three.
>>
>> In my opinion, for debugging purposes, the option  
>> identical(x,y,method="strict"),
>> which implies that x and y behave equally, could be useful, if it  
>> is available
>> in R base,
>> At the R interactive level, negative zero as the value of -0 could  
>> possibly
>> be avoided. However, negative zero may also occur in numerical  
>> calculations,
>> since it may be obtained as x * 0, where x is negative. So, i  
>> think, negative
>> zero cannot be eliminated from consideration as something too  
>> infrequent.
>
> I wouldn't mind a "strict" option.   It would compare bit patterns,  
> so would distinguish +0 from -0, and different NaN values. But  
> having the value of  identical(x-y, -(y-x)) depend on whether x and  
> y are equal or not would just lead to confusion.

... but so do other things routinely such as floating point  
arithmetics so I don't think this is a strong argument here. IMHO  
identical(0, -0) should return FALSE, because they are simply not the  
same objects and that's what identical is supposed test for. If you  
want to test equality of elements there are other means you should be  
using that were mentioned in this thread.

Cheers,
Simon


From simon.urbanek at r-project.org  Mon Aug 10 15:56:41 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 10 Aug 2009 09:56:41 -0400
Subject: [Rd] multicore mclapply hangs
In-Reply-To: <4A7FF3C6.3080807@ibe.med.uni-muenchen.de>
References: <4A7FF03A.7050106@health.sdu.dk>
	<4A7FF3C6.3080807@ibe.med.uni-muenchen.de>
Message-ID: <492D56BD-063F-4696-B4DD-67D4C2D1FB8B@r-project.org>


On Aug 10, 2009, at 6:17 , Markus Schmidberger wrote:

> Hello Rune,
>
> please use the mailinglist 'R-sig-hpc' (https://stat.ethz.ch/mailman/listinfo/r-sig-hpc 
> , do not forget to register!) for this topic.
>

.. or even better ask the package maintainer (with more precise  
details such as the exact code and sessionInfo()).

Cheers,
Simon


> And please provide some more information:
> * in R: sessionInfo()
> * and your used operation system
>
> Best
> Markus
>
>
>
> Rune Schjellerup Philosof schrieb:
>> When I execute mclapply it creates the needed processes, but these
>> processes never begin computing anything, they just wait  
>> indefinitely.
>> I recently upgraded to version 2.9.1, which might have caused the  
>> problem.
>>
>>
>
>
> -- 
> Dipl.-Tech. Math. Markus Schmidberger
>
> Ludwig-Maximilians-Universit?t M?nchen
> IBE - Institut f?r medizinische Informationsverarbeitung,
> Biometrie und Epidemiologie
> Marchioninistr. 15, D-81377 Muenchen
> URL: http://www.ibe.med.uni-muenchen.de Mail: Markus.Schmidberger  
> [at] ibe.med.uni-muenchen.de
> Tel: +49 (089) 7095 - 4497
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From murdoch at stats.uwo.ca  Mon Aug 10 16:20:39 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Aug 2009 10:20:39 -0400
Subject: [Rd] identical(0, -0)
In-Reply-To: <353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>	<4A7D8E08.2070300@uottawa.ca>
	<20090810092141.GC10119@cs.cas.cz> <4A7FECCD.2010208@stats.uwo.ca>
	<353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
Message-ID: <4A802CB7.3030806@stats.uwo.ca>

On 8/10/2009 9:55 AM, Simon Urbanek wrote:
> On Aug 10, 2009, at 5:47 , Duncan Murdoch wrote:
> 
>> Petr Savicky wrote:
>>> On Sat, Aug 08, 2009 at 10:39:04AM -0400, Prof. John C Nash wrote:
>>>
>>>> I'll save space and not include previous messages.
>>>>
>>>> My 2 cents: At the very least the documentation needs a fix. If it  
>>>> is easy to do, then Ted Harding's suggestion of a switch (default  
>>>> OFF) to check for sign difference would be sensible.
>>>>
>>>> I would urge inclusion in the documentation of the +0, -0  
>>>> example(s) if there is NOT a way in R to distinguish these.
>>>>
>>>
>>> It is possible to distinguish 0 and -0 in R, since 1/0 == Inf and
>>> 1/(-0) == -Inf.
>>>
>>> I do not know, whether there are also other such situations. In  
>>> particular
>>>  (0)^(-1) == (-0)^(-1) # [1] TRUE
>>>  log(0) == log(-0) # [1] TRUE
>>>
>>>
>>>> There are occasions where it is useful to be able to detect things  
>>>> like this (and NaN and Inf and -Inf etc.). They are usually not of  
>>>> interest to users, but sometimes are needed for developers to  
>>>> check edge effects. For those cases it may be time to consider a  
>>>> package FPIEEE754 or some similar name to allow testing and  
>>>> possibly setting of flags for some of the fancier features. Likely  
>>>> used by just a few of us in extreme situations.
>>>>
>>>
>>> I think that distinguishing 0 and -0 may be useful even for nonexpert
>>> users for debugging purposes. Mainly, because x == y does not imply
>>> that x and y behave equally as demonstrated above or by
>>>  x <- 0
>>>  y <-  - 0
>>>  x == y # [1] TRUE
>>>  1/x == 1/y # [1] FALSE
>>>
>>> I would like to recall the suggestion
>>>  On Sat, Aug 08, 2009 at 03:04:07PM +0200, Martin Maechler wrote:
>>>  > Maybe we should introduce a function that's basically
>>>  > isTRUE(all.equal(..., tol=0))  {but faster},  or
>>>  > do you want a 3rd argument to identical, say 'method'
>>>  > with default  c("oneNaN", "use.==", "strict")
>>>  >   > oneNaN: my proposal of using  memcmp() on doubles as its  
>>> used for
>>>  >        other types already  (and hence distinguishing +0 and -0;
>>>  >      otherwise keeping the feature that there's just one NaN
>>>  >      which differs from 'NA' (and there's just one 'NA').
>>>  >   > use.==: the previous R behaviour, using '==' on doubles    
>>> >   (and the "oneNaN" behavior)
>>>  >   > strict: be even stricter than oneNaN:  Use  memcmp()
>>>  >   unconditionally for doubles.  This would be the fastest
>>>  >   version of all three.
>>>
>>> In my opinion, for debugging purposes, the option  
>>> identical(x,y,method="strict"),
>>> which implies that x and y behave equally, could be useful, if it  
>>> is available
>>> in R base,
>>> At the R interactive level, negative zero as the value of -0 could  
>>> possibly
>>> be avoided. However, negative zero may also occur in numerical  
>>> calculations,
>>> since it may be obtained as x * 0, where x is negative. So, i  
>>> think, negative
>>> zero cannot be eliminated from consideration as something too  
>>> infrequent.
>>
>> I wouldn't mind a "strict" option.   It would compare bit patterns,  
>> so would distinguish +0 from -0, and different NaN values. But  
>> having the value of  identical(x-y, -(y-x)) depend on whether x and  
>> y are equal or not would just lead to confusion.
> 
> ... but so do other things routinely such as floating point  
> arithmetics so I don't think this is a strong argument here. IMHO  
> identical(0, -0) should return FALSE, because they are simply not the  
> same objects and that's what identical is supposed test for. If you  
> want to test equality of elements there are other means you should be  
> using that were mentioned in this thread.

+0 and -0 are exactly equal, which is what identical is documented to be 
testing.  They are not indistinguishable, and not identical in the 
English meaning of the word, but they are identical in the sense of what 
the identical() function is documented to test.

The cases where you want to distinguish between them are rare.  They 
should not be distinguished in the default identical() test, any more 
than different values of NaN should be distinguished (and identical() is 
explicitly documented *not* to distinguish those).

Of the 1600 uses of identical() in the R base plus recommended packages, 
there are lots of cases where equality of elements is clearly the 
intention.  There are almost no uses of the all.equal(..., tol=0) idiom 
in base R, and among the recommended packages, only Matrix uses it (but 
uses identical() for values as well, I think.)

Distinguishing between different NaN values might be harmless, because 
we probably only generate one.  (I'm not sure about that, the literal 
NaN might be different from sqrt(-1) or 0/0.  But I'd guess only one 
comes up in normal usage.)  But we definitely generate both +0 and -0 
all the time, and distinguishing between them would mean identical() 
would be useless for value-based comparison.  Do you want to evaluate 
all 1600 uses in the base and recommended package, and who knows how 
many on CRAN, to figure out which ones should be changed to 
all.equal(..., tol=0)?  I don't.

Duncan Murdoch


From dasmailinglists at gmail.com  Mon Aug 10 16:56:33 2009
From: dasmailinglists at gmail.com (David Scherrer)
Date: Mon, 10 Aug 2009 16:56:33 +0200
Subject: [Rd] Rcpp and variable protection
Message-ID: <1a3e78310908100756l3eecce02i7b7bea49c4ecd604@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090810/3e92bf67/attachment.pl>

From murdoch at stats.uwo.ca  Mon Aug 10 17:51:53 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Aug 2009 11:51:53 -0400
Subject: [Rd] identical(0, -0)
In-Reply-To: <4A802CB7.3030806@stats.uwo.ca>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>	<4A7D8E08.2070300@uottawa.ca>	<20090810092141.GC10119@cs.cas.cz>
	<4A7FECCD.2010208@stats.uwo.ca>	<353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
	<4A802CB7.3030806@stats.uwo.ca>
Message-ID: <4A804219.3080803@stats.uwo.ca>

For people who want to play with these, here are some functions that let 
you get or set the "payload" value in a NaN.  NaN and NA, Inf and -Inf 
are stored quite similarly; these functions don't distinguish which of 
those you're working with.  Regular finite values give NA for the 
payload value, and elements of x are unchanged if you try to set their 
payload to NA.

By the way, this also shows that R *can* distinguish different NaN 
values, but you need some byte-level manipulations.

Duncan Murdoch

showBytes <- function(x) {
     bytes <- rawConnection(raw(0), "w")
     on.exit(close(bytes))
     writeBin(x, bytes)
     rawConnectionValue(bytes)
}

NaNpayload <- function(x) {
     if (typeof(x) != "double") stop("Can only handle doubles")
     bytes <- as.integer(showBytes(x))
     base <- 1 + (seq_along(x)-1)*8
     S <- bytes[base + 7] %/% 128
     E <- (bytes[base + 7] %% 128)*16 + bytes[base + 6] %/% 16
     F <- bytes[base + 6] %% 16
     for (i in 5:0) {
     	F <- F*256 + bytes[base + i]
     }
     nan <- E == 2047 # Add " & F != 0 " if you don't want to include 
infinities
     ifelse(nan, (1-2*S)*F/2^52, NA)
}

"NaNpayload<-" <- function(x, value) {
     x <- as.double(x)
     payload <- value
     new <- payload[!is.na(payload)]
     if (any( new <= -1 | new >= 1 )) stop("The payload values must be 
between -1 and 1")
     payload <- rep(payload, len=max(length(x), length(payload)))
     x <- rep(x, len=length(payload))

     bytes <- as.integer(showBytes(x))
     base <- 1 + (seq_along(x)-1)*8
     base[is.na(payload)] <- NA
     F <- trunc(abs(payload)*2^52)
     for (i in 0:5) {
     	bytes[base + i] <- F %% 256
     	F <- F %/% 256
     }
     bytes[base + 6] <- F + 0xF0
     bytes[base + 7] <- (payload < 0)*128 + 0x7F
     con <- rawConnection(as.raw(bytes), "r")
     on.exit(close(con))
     readBin(con, "double", length(x))
}

Example:

 > x <- c(NA, NaN, 0, 1, Inf)
 > NaNpayload(x)
[1]  0.5 -0.5   NA   NA  0.0
 > NaNpayload(x) <- -0.4
 > x
[1] NaN NaN NaN NaN NaN
 > y <- x
 > NaNpayload(y) <- 0.6
 > y
[1] NaN NaN NaN NaN NaN
 > NaNpayload(x)
[1] -0.4 -0.4 -0.4 -0.4 -0.4
 > NaNpayload(y)
[1] 0.6 0.6 0.6 0.6 0.6
 > identical(x, y)
[1] TRUE


From savicky at cs.cas.cz  Mon Aug 10 19:31:49 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Mon, 10 Aug 2009 19:31:49 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <4A7FECCD.2010208@stats.uwo.ca>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>
	<4A7D8E08.2070300@uottawa.ca> <20090810092141.GC10119@cs.cas.cz>
	<4A7FECCD.2010208@stats.uwo.ca>
Message-ID: <20090810173149.GB17502@cs.cas.cz>

On Mon, Aug 10, 2009 at 05:47:57AM -0400, Duncan Murdoch wrote:
> I wouldn't mind a "strict" option.   It would compare bit patterns, so 
> would distinguish +0 from -0, and different NaN values.

I think that a logical option "strict" in the above meaning could be
useful for debugging. The default may be FALSE.

On Mon, Aug 10, 2009 at 10:20:39AM -0400, Duncan Murdoch wrote:
> +0 and -0 are exactly equal, which is what identical is documented to be 
> testing.  They are not indistinguishable, and not identical in the 
> English meaning of the word, but they are identical in the sense of what 
> the identical() function is documented to test.
> 
> The cases where you want to distinguish between them are rare.  They 
> should not be distinguished in the default identical() test, any more 
> than different values of NaN should be distinguished (and identical() is 
> explicitly documented *not* to distinguish those).
[...]

The question, whether 0 and -0 are equal or not, is not clear, since
they have different reciprocals. However, i agree that distinguishing
the signs of zero is rarely useful. From this point of view, the
default FALSE seems to be acceptable.

For completeness, let me also add an argument that it would not be too
harmful, if the default is TRUE. I think that it is quite rare to have
two larger numerical structures, which match up to the last bits in all
numbers, but have a different sign of some zero. Matching all bits
almost requires that the two structures are obtained using the same
expressions for all components. Then, also the signs of zeros will
match. However, i may be wrong.

Petr.


From bolker at ufl.edu  Mon Aug 10 21:52:24 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Mon, 10 Aug 2009 12:52:24 -0700 (PDT)
Subject: [Rd] Bug in nlm, found using sem;
 failure in several flavors (PR#13883)
In-Reply-To: <20090807223514.7C78E282EF4C@mail.pubhealth.ku.dk>
References: <20090807223514.7C78E282EF4C@mail.pubhealth.ku.dk>
Message-ID: <24906063.post@talk.nabble.com>



   A wild guess, based on some recent "non-deterministic" behavior in
lme4: could this be driven by a bug in optimized linear algebra libraries
(BLAS/LAPACK)?  (Unfortunately, I'm not clear on how to check the versions
of BLAS/LAPACK being used and whether they are subject to bugs,
but perhaps someone else can comment ...)

   Ben Bolker



Adam D. I. Kramer-2 wrote:
> 
>   This message is in MIME format.  The first part should be readable text,
>   while the remaining parts are likely unreadable without MIME-aware
> tools.
> 
> --1660387551-150661043-1249684349=:2997
> Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
> Content-Transfer-Encoding: QUOTED-PRINTABLE
> 
> Hi Jeff,
> 
>  =09As mentioned in my message, I *did* replicate on another platform.=20
> One platform was running linux in a VM, the other running MacOSX, on two
> different physical machines.  The problem did not replicate on a PowerPC
> box, so if it is a bug with intel chips, I think it's also appropriate to
> report here given that the problem seems to cross the OS boundary.  I do
> no=
> t
> have access to a Windows machine.
> 
>  =09Also, I have spent a decent amount of time running memory testers on
> the first machine's memory, to ensure that physical memory is not a
> problem...the classic "memcheck" program finds no trouble.
> 
>  =09The CSV and .ram files both came through as base-64-encoded
> attachments, which you actually quoted back to me in your response,
> below...but in case your mail client can't read those and/or you are
> interested in this bug, I have pasted them at the end of this message
> (sinc=
> e
> they're quite small).
> 
>  =09And thanks for the shout-out for bacon. I bought this domain name in
> undergrad many years ago, and I must say, I've never regretted it!
> 
> --Adam
> 
> On Fri, 7 Aug 2009, Jeff Ryan wrote:
> 
>> Adam,
>>
>> It seems that your attachment didn't make it through.
>>
>> That aside, my experience with strange errors like those (random type
>> not implemented ones) has been that you may be looking at a memory
>> problem on you machine. Given that you can't replicate on another
>> platform (and the .csv file didn't come through), I would think it
>> wise to start there.
>>
>> My 2c.  And I love bacon too :)
>>
>> Jeff
>>
>> On Fri, Aug 7, 2009 at 1:10 PM, <adik at ilovebacon.org> wrote:
>>> =A0This message is in MIME format. =A0The first part should be readable
>>> =
> text,
>>> =A0while the remaining parts are likely unreadable without MIME-aware
>>> to=
> ols.
>>>
>>> --1660387551-1458482416-1249639718=3D:2997
>>> Content-Type: TEXT/PLAIN; CHARSET=3DUS-ASCII; FORMAT=3Dflowed
>>> Content-ID: <Pine.LNX.4.64.0908071039211.2997 at parser.ilovebacon.org>
>>>
>>> Hello,
>>>
>>> =A0 =A0 =A0 =A0There appears to be a bug in the nlm function, which I
>>> di=
> scovered
>>> when trying to run an SEM. =A0The SEM is not bizarre; the covariance
>>> mat=
> rix is
>>> solve-able and the eigenvalues are greater than zero, and I do not
>>> belie=
> ve
>>> the "sem" package per se to be the problem (as nlm keeps being the part
>>> =
> that
>>> fails, though I can't replicate this with other nlm tasks). =A0I
>>> apologi=
> ze if
>>> I have put too many much information in this message; I'm not a
>>> programm=
> er
>>> by trade so I don't really know what's going on here, which hampers my
>>> ability to write consise bug reports.
>>>
>>> Here is the code I use:
>>>
>>> library(sem)
>>> ice.S <- read.csv("iceS.csv") # attached
>>> rownames(ice.S) <- ice.S[,1]
>>> ice.S[,1] <- NULL
>>> ice.S <- as.matrix(ice.S)
>>> ice.ram <- specify.model("ice.ram") # attached
>>> ice.N <- 342
>>> ice.sem <- sem(ram=3Dice.ram, S=3Dice.S, N=3Dice.N)
>>>
>>> ...at this point, any number of problems could occur. I have seen the
>>> following.
>>>
>>> 1) Simple lack of convergence. (might be my model's fault.)
>>> 2) Error in nlm(if (analytic.gradient) objective.2 else objective.1,
>>> sta=
> rt,
>>> :
>>> =A0 type 31 is unimplemented in 'type2char'
>>> 3) =A0*** caught segfault ***
>>> address 0xc019c87b, cause 'memory not mapped'
>>>
>>> Traceback:
>>> =A01: nlm(if (analytic.gradient) objective.2 else objective.1, start,
>>> hessian =3D TRUE, iterlim =3D maxiter, print.level =3D if (debug) 2
>>> else=
>  0,
>>> typsize =3D typsize, ...)
>>> =A02: sem.default(ram =3D ram, S =3D S, N =3D N, param.names =3D pars,
>>> v=
> ar.names =3D
>>> vars, =A0 =A0 fixed.x =3D fixed.x, debug =3D debug, ...)
>>> =A03: sem(ram =3D ram, S =3D S, N =3D N, param.names =3D pars,
>>> var.names=
>  =3D vars,
>>> fixed.x =3D fixed.x, debug =3D debug, ...)
>>> =A04: sem.mod(ram =3D ice.ram, S =3D ice.S, N =3D ice.N)
>>> =A05: sem(ram =3D ice.ram, S =3D ice.S, N =3D ice.N)
>>>
>>> Possible actions:
>>> 1: abort (with core dump, if enabled)
>>> 2: normal R exit
>>> 3: exit R without saving workspace
>>> 4: exit R saving workspace
>>> Selection: 1
>>> aborting ...
>>> Segmentation fault
>>> swiss:data$
>>>
>>> (no core was dumped).
>>>
>>> Trying with debug mode provides other interesting errors:
>>>
>>>> ice.sem <- sem(ram=3Dice.ram, S=3Dice.S, N=3Dice.N, debug=3DTRUE)
>>>
>>> ...gets up to some iteration (not always 15), and then R dies
>>> ungraceful=
> ly,
>>> and exits to the shell:
>>>
>>> iteration =3D 15
>>> Step:
>>> =A0[1] =A01.253132e-02 =A01.183343e-02 -7.651342e-03 -2.490800e-03
>>> =A02.=
> 278938e-03
>>> =A0[6] =A03.197431e-04 =A06.137849e-04 -2.496882e-03 -1.065829e-03
>>> -2.11=
> 8179e-03
>>> [11] =A02.942936e-03 -1.335936e-03 -3.665618e-03 =A03.090566e-03
>>> =A08.53=
> 4956e-04
>>> [16] -1.440421e-03 -5.230877e-04 -1.053686e-04 -9.771005e-04
>>> -4.269216e-=
> 04
>>> [21] =A07.261694e-05 -1.039668e-03 -8.409151e-03 -3.497456e-03
>>> =A02.2168=
> 99e-03
>>> [26] -4.633520e-03 -4.052130e-03 -4.746537e-03 -1.589622e-03
>>> -2.523766e-=
> 04
>>> Parameter:
>>> =A0[1] -0.76604614 -1.19639662 =A00.83456888 =A00.72540413
>>> =A00.08482452=
>  =A00.56180393
>>> =A0[7] =A00.50615814 =A00.55728015 =A00.83796696 =A00.88371335
>>> -0.704651=
> 16 =A00.85251098
>>> [13] -0.18346956 =A00.66857787 =A00.57012481 =A00.39116561
>>> =A00.91237990=
>  =A00.63951482
>>> [19] =A00.26601566 =A00.29240836 =A00.44710919 =A00.94734056
>>> =A06.520390=
> 15 =A00.02524762
>>> [25] -0.01614603 =A02.88198219 =A00.03442452 =A03.52272237
>>> =A01.44698423=
>  -0.72964745
>>> Function Value
>>> [1] -15175.94
>>> Gradient:
>>> =A0[1] -2.085412e+07 -3.819717e+07 =A03.883989e+07 =A01.352594e+00
>>> -4.28=
> 3329e+00
>>> =A0[6] -1.437250e+00 -6.558913e-01 =A01.358276e+00 =A07.930865e+05
>>> -1.29=
> 3853e+06
>>> [11] -5.816627e+03 =A05.908197e+05 -2.705742e+08 -1.194400e+07
>>> -4.007083=
> e+07
>>> [16] -4.143068e+07 -6.159782e-01 =A01.044274e-01 -8.591048e+00
>>> -2.083471=
> e+00
>>> [21] -7.548753e-01 -5.418994e-01 -2.799228e+02 -1.321739e+07
>>> -3.517728e+=
> 07
>>> [26] -7.106654e+02 -7.335293e+06 -7.335285e+05 =A03.117764e-01
>>> -2.234989=
> e+04
>>>
>>> Abort trap
>>> swiss:data$
>>>
>>> ...I have also seen convergence reached, and nlm then die with this
>>> mess=
> age:
>>>
>>> Error in nlm(if (analytic.gradient) objective.2 else objective.1, start,
>>> :
>>> =A0 type 27 is unimplemented in 'type2char'
>>>
>>> (similar to above, but now referring to type 27)
>>>
>>> I have shown this effect (or something similar...never know how it'll
>>> fa=
> il
>>> next) on the following platforms:
>>>
>>>> version
>>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
>>> platform =A0 =A0 =A0 i386-apple-darwin9.7.0
>>> arch =A0 =A0 =A0 =A0 =A0 i386
>>> os =A0 =A0 =A0 =A0 =A0 =A0 darwin9.7.0
>>> system =A0 =A0 =A0 =A0 i386, darwin9.7.0
>>> status
>>> major =A0 =A0 =A0 =A0 =A02
>>> minor =A0 =A0 =A0 =A0 =A09.1
>>> year =A0 =A0 =A0 =A0 =A0 2009
>>> month =A0 =A0 =A0 =A0 =A006
>>> day =A0 =A0 =A0 =A0 =A0 =A026
>>> svn rev =A0 =A0 =A0 =A048839
>>> language =A0 =A0 =A0 R
>>> version.string R version 2.9.1 (2009-06-26)
>>>
>>>> sessionInfo()
>>> R version 2.9.1 (2009-06-26)
>>> i386-apple-darwin9.8.0
>>>
>>> locale:
>>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>>
>>> attached base packages:
>>> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets
>>> =A0method=
> s =A0 base
>>>
>>> other attached packages:
>>> [1] sem_0.9-17
>>>
>>> loaded via a namespace (and not attached):
>>> [1] tcltk_2.9.1 tools_2.9.1
>>>
>>> (I admit to having compiled this version of R myself (to link to a
>>> hand-compiled ATLAS), though no errors were thrown in the compilation
>>> st=
> age.
>>> I compiled using this config string, at first...
>>>
>>> ./configure --prefix=3D/usr/local --with-x --disable-R-framework
>>> --enabl=
> e-threads=3Dposix --with-blas=3D"/usr/local/lib/libptf77blas.a
> /usr/local/l=
> ib/libptcblas.a /usr/local/lib/libatlas.a -lpthread"
> --with-lapack=3D"/usr/=
> local/lib/liblapack.a /usr/local/lib/libptf77blas.a
> /usr/local/lib/libptcbl=
> as.a /usr/local/lib/libatlas.a -lpthread" --without-aqua CFLAGS=3D"-O3
> -mtu=
> ne=3Dnocona -m32" CXXFLAGS=3D"-O3 -mtune=3Dnocona -m32" FFLAGS=3D"-O3
> -mtun=
> e=3Dnocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran"
> F77FLA=
> GS=3D"-O3 -mtune=3Dnocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l
> g=
> fortran" FCFLAGS=3D"-O3 -mtune=3Dnocona -m32
> -L/usr/lib/gcc/i686-apple-darw=
> in9/4.2.1 -l gfortran" LDFLAGS=3D"-m32 -L/sw/lib"
> CPPFLAGS=3D"-I/sw/include=
> " CC=3Dgcc-4.2 F77=3Dgfortran-4.2 FC=3Dgfortran-4.2 CXX=3Dg++-4.2
> OBJC=3Dgc=
> c-4.2
>>>
>>> ...though I have also recompiled using simply this:
>>>
>>> ./configure --prefix=3D/usr/local --with-x --disable-R-framework
>>>
>>> ...and then re-installed SEM, and I got a few other, different error
>>> messages and core dumps, "including type 11 is unimplemented in
>>> 'type2ch=
> ar'"
>>> and "cannot coerce type 'weakref' to vector of type 'double'".
>>> =A0Runnin=
> g with
>>> debug=3DTRUE also segfaults sometimes, even after achieving "Current
>>> ite=
> rate
>>> is probably solution" status.)
>>>
>>>> version
>>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
>>> platform =A0 =A0 =A0 x86_64-unknown-linux-gnu
>>> arch =A0 =A0 =A0 =A0 =A0 x86_64
>>> os =A0 =A0 =A0 =A0 =A0 =A0 linux-gnu
>>> system =A0 =A0 =A0 =A0 x86_64, linux-gnu
>>> status
>>> major =A0 =A0 =A0 =A0 =A02
>>> minor =A0 =A0 =A0 =A0 =A09.1
>>> year =A0 =A0 =A0 =A0 =A0 2009
>>> month =A0 =A0 =A0 =A0 =A006
>>> day =A0 =A0 =A0 =A0 =A0 =A026
>>> svn rev =A0 =A0 =A0 =A048839
>>> language =A0 =A0 =A0 R
>>> version.string R version 2.9.1 (2009-06-26)
>>>
>>>> sessionInfo()
>>> R version 2.9.1 (2009-06-26)
>>> x86_64-unknown-linux-gnu
>>>
>>> locale:
>>> LC_CTYPE=3Den_US;LC_NUMERIC=3DC;LC_TIME=3Den_US;LC_COLLATE=3Den_US;LC_MO=
> NETARY=3DC;LC_MESSAGES=3Den_US;LC_PAPER=3Den_US;LC_NAME=3DC;LC_ADDRESS=3DC;=
> LC_TELEPHONE=3DC;LC_MEASUREMENT=3Den_US;LC_IDENTIFICATION=3DC
>>>
>>> attached base packages:
>>> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets
>>> =A0method=
> s =A0 base
>>>
>>> other attached packages:
>>> [1] sem_0.9-17
>>>
>>> ...however, THIS platform does NOT show the bug:
>>>
>>>> version
>>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
>>> platform =A0 =A0 =A0 powerpc-unknown-linux-gnu
>>> arch =A0 =A0 =A0 =A0 =A0 powerpc
>>> os =A0 =A0 =A0 =A0 =A0 =A0 linux-gnu
>>> system =A0 =A0 =A0 =A0 powerpc, linux-gnu
>>> status
>>> major =A0 =A0 =A0 =A0 =A02
>>> minor =A0 =A0 =A0 =A0 =A09.1
>>> year =A0 =A0 =A0 =A0 =A0 2009
>>> month =A0 =A0 =A0 =A0 =A006
>>> day =A0 =A0 =A0 =A0 =A0 =A026
>>> svn rev =A0 =A0 =A0 =A048839
>>> language =A0 =A0 =A0 R
>>> version.string R version 2.9.1 (2009-06-26)
>>>> sessionInfo()
>>> R version 2.9.1 (2009-06-26)
>>> powerpc-unknown-linux-gnu
>>>
>>> locale:
>>> LC_CTYPE=3Den_US.UTF-8;LC_NUMERIC=3DC;LC_TIME=3Den_US.UTF-8;LC_COLLATE=
> =3Den_US.UTF-8;LC_MONETARY=3DC;LC_MESSAGES=3Den_US.UTF-8;LC_PAPER=3Den_US.U=
> TF-8;LC_NAME=3DC;LC_ADDRESS=3DC;LC_TELEPHONE=3DC;LC_MEASUREMENT=3Den_US.UTF=
> -8;LC_IDENTIFICATION=3DC
>>>
>>> attached base packages:
>>> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets
>>> =A0method=
> s =A0 base
>>>
>>> other attached packages:
>>> [1] sem_0.9-17
>>>>
>>>
>>> ...for this system, the model simply repeatedly fails to converge,
>>> wheth=
> er
>>> debug is set or not.
>>>
>>> I have also tried altering my model. This has resulted in the same
>>> bugs,=
>  but
>>> instead of "every so often simply not converging," it actually
>>> converges=
>  and
>>> appears to be the model I asked R to solve...but this is rare.
>>>
>>> Please let me know if I can provide any other info.
>>>
>>> Cordially,
>>> Adam D. I. Kramer
>>> --1660387551-1458482416-1249639718=3D:2997
>>> Content-Type: AUDIO/X-PN-REALAUDIO; NAME=3Dice.ram
>>> Content-Transfer-Encoding: BASE64
>>> Content-ID: <Pine.LNX.4.64.0908070308380.2997 at parser.ilovebacon.org>
>>> Content-Description:
>>> Content-Disposition: ATTACHMENT; FILENAME=3Dice.ram
>>>
>>> aW1wb3J0YW50IDwtLSBjaGFsbGVuZ2UsIE5BLCAxCmNvbXBsZXggIDwtLSBj
>>> aGFsbGVuZ2UsIGMuY29tcGxleCwgTkEKZGlmZmljdWx0IDwtLSBjaGFsbGVu
>>> Z2UsIGMuZGlmZmljdWx0LCBOQQptYW55ZGltZW5zaW9ucyA8LS0gY2hhbGxl
>>> bmdlLCBjLm1hbnlkaW1lbnNpb25zLCBOQQpjb3VsZGF2b2lkIDwtLSBjaGFs
>>> bGVuZ2UsIGMuY291bGRhdm9pZCwgTkEKb25seXNlbGYgPC0tIGNoYWxsZW5n
>>> ZSwgYy5vbmx5c2VsZiwgTkEKCndhc3JpZ2h0Y2hvaWNlIDwtLSBldmFsLCBO
>>> QSwgMQp0ZWxsZ29vZCA8LS0gZXZhbCwgZS50ZWxsZ29vZCwgTkEKdGVsbGJl
>>> c3QgPC0tIGV2YWwsIGUudGVsbGJlc3QsIE5BCm5lZ291dGNvbWUgPC0tIGV2
>>> YWwsIGUubmVnb3V0Y29tZSwgTkEKCmVxdWFsaW5mbyA8LS0gaW5mb3JtZWQs
>>> IE5BLCAxCmNvbnRyb2wgPC0tIGluZm9ybWVkLCBpLmNvbnRyb2wsIE5BCmRl
>>> c2lyZWQgPC0tIGluZm9ybWVkLCBpLmRlc2lyZWQsIE5BCmhvd211Y2hpbmZv
>>> IDwtLSBpbmZvcm1lZCwgaS5ob3dtdWNoaW5mbywgTkEKcG9zb3V0Y29tZSA8
>>> LS0gaW5mb3JtZWQsIGkucG9zb3V0Y29tZSwgTkEKCndhc3JpZ2h0Y2hvaWNl
>>> IDwtPiB3YXNyaWdodGNob2ljZSwgd2FzcmlnaHRjaG9pY2VWLCBOQQp0ZWxs
>>> Z29vZCA8LT4gdGVsbGdvb2QsIHRlbGxnb29kViwgTkEKdGVsbGJlc3QgPC0+
>>> IHRlbGxiZXN0LCB0ZWxsYmVzdFYsIE5BCm5lZ291dGNvbWUgPC0+IG5lZ291
>>> dGNvbWUsIG5lZ291dGNvbWVWLCBOQQoKb25seXNlbGYgPC0+IG9ubHlzZWxm
>>> LCBvbmx5c2VsZlYsIE5BCmltcG9ydGFudCA8LT4gaW1wb3J0YW50LCBpbXBv
>>> cnRhbnRWLCBOQQpjb21wbGV4IDwtPiBjb21wbGV4LCBjb21wbGV4ViwgTkEK
>>> ZGlmZmljdWx0IDwtPiBkaWZmaWN1bHQsIGRpZmZpY3VsdFYsIE5BCm1hbnlk
>>> aW1lbnNpb25zIDwtPiBtYW55ZGltZW5zaW9ucywgbWFueWRpbWVuc2lvbnNW
>>> LCBOQQpjb3VsZGF2b2lkIDwtPiBjb3VsZGF2b2lkLCBjb3VsZGF2b2lkViwg
>>> TkEKCmVxdWFsaW5mbyA8LT4gZXF1YWxpbmZvLCBlcXVhbGluZm9WLCBOQQpj
>>> b250cm9sIDwtPiBjb250cm9sLCBjb250cm9sViwgTkEKZGVzaXJlZCA8LT4g
>>> ZGVzaXJlZCwgZGVzaXJlZFYsIE5BCmhvd211Y2hpbmZvIDwtPiBob3dtdWNo
>>> aW5mbywgaG93bXVjaGluZm9WLCBOQQpwb3NvdXRjb21lIDwtPiBwb3NvdXRj
>>> b21lLCBwb3NvdXRjb21lViwgTkEKCmV2YWwgPC0+IGV2YWwsIGV2YWxWLCBO
>>> QQpjaGFsbGVuZ2UgPC0+IGNoYWxsZW5nZSwgY2hhbGxlbmdlViwgTkEKaW5m
>>> b3JtZWQgPC0+IGluZm9ybWVkLCBpbmZvcm1lZFYsIE5BCg=3D=3D
>>>
>>> --1660387551-1458482416-1249639718=3D:2997
>>> Content-Type: TEXT/CSV; CHARSET=3DUS-ASCII; NAME=3DiceS.csv
>>> Content-Transfer-Encoding: BASE64
>>> Content-ID: <Pine.LNX.4.64.0908070308381.2997 at parser.ilovebacon.org>
>>> Content-Description:
>>> Content-Disposition: ATTACHMENT; FILENAME=3DiceS.csv
>>>
>>> IiIsIndhc3JpZ2h0Y2hvaWNlIiwidGVsbGdvb2QiLCJ0ZWxsYmVzdCIsImlt
>>> cG9ydGFudCIsImNvbXBsZXgiLCJkaWZmaWN1bHQiLCJvbmx5c2VsZiIsIm1h
>>> bnlkaW1lbnNpb25zIiwiaG93bXVjaGluZm8iLCJlcXVhbGluZm8iLCJjb3Vs
>>> ZGF2b2lkIiwicG9zb3V0Y29tZSIsIm5lZ291dGNvbWUiLCJjb250cm9sIiwi
>>> ZGVzaXJlZCINCiJ3YXNyaWdodGNob2ljZSIsMC45NjM2OTc3MzE3ODk2Myww
>>> LjI5MjczNjMyMTIyOTY0NywwLjI4OTg1MjgwODQ4OTExNywwLjM4NTI2Njk2
>>> NTM2Mjc2MSwwLjE5NzY0NDgyNDY5NjMyMCwwLjE4MzA0MTMyNDA2MjI5OCwt
>>> MC4xNDY2MjYzNDcyMTk4NzksMC4xNDYzNTQwMjc3OTcxMDEsLTAuMTMyODg3
>>> NTk2OTAyNTA2LC0wLjE3Mzk2NTA2OTExMTAyNSwtMC4yNjg0NTkxNjI5MzA1
>>> NjcsLTAuMDY3ODA5NTM3NTA3NjIyMiwwLjE4MDU0OTkyNTAyNDM3NywtMC4w
>>> NDIwODQ0MzY0MDM3ODc0LC0wLjA3MzA1Nzc4OTY5MDI5NjcNCiJ0ZWxsZ29v
>>> ZCIsMC4yOTI3MzYzMjEyMjk2NDcsMC45NTU0OTQyNDYyMTA4NTYsMC43NTc1
>>> NDQxOTMzMzk1NjYsMC4xOTEyNDExODMyMDMxMjksMC4wMDAxNzQ2MzA0MTc1
>>> NjQ2ODgsMC4wMDM0MDg4NzExODA3MTI4NywwLjAwOTYzMDUwNDc0MzU4MDM0
>>> LDAuMDI4Mzg5NDM3MzMxNjY4NCwwLjAxODgwMjc1Mzk0NjMyOTksLTAuMDE1
>>> NzAyNjM4MTUxNTk4NSwtMC4xNDU3OTUwMDY3NDE4ODQsMC4xNDIwMzQzOTY5
>>> MDY4NzksMC4wMDk4MTUzODM5ODQzNDg1MSwwLjA3MDU4Njg3NTY1Mzk3MzIs
>>> MC4xMDgwMDA0NDkzMjgzMTMNCiJ0ZWxsYmVzdCIsMC4yODk4NTI4MDg0ODkx
>>> MTcsMC43NTc1NDQxOTMzMzk1NjYsMC45NDg1OTM1OTA5MTI0MDgsMC4yMzA1
>>> OTg5NTg1OTc1MjgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuMDE1NTQ0NzA1NTc4
>>> MzEyMiwwLjAzMjE2OTMyODE5ODg2NjksMC4wNjQ2MzEyMzI2MTg3MDk2LDAu
>>> MDEwMjk0NTA4NTY1MTI0NiwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE3ODc2
>>> NTU2MzM1NDgyOCwwLjE1MTM0MzU2Nzc2MTg1OSwtMC4wMzM2NTU5MDYzMzA3
>>> ODM1LDAuMDkyOTA2MjI3OTMzNDg5OCwwLjE1OTczNTYxODQyMzMzNQ0KImlt
>>> cG9ydGFudCIsMC4zODUyNjY5NjUzNjI3NjEsMC4xOTEyNDExODMyMDMxMjks
>>> MC4yMzA1OTg5NTg1OTc1MjgsMC45NjQ0OTc4ODAzNDM2MSwwLjY0NzY1NzE0
>>> MTQ4ODM3NSwwLjUxNDE3NTk3NDU1NDExNCwtMC4xOTc1MDY3MDU5MTcxMjMs
>>> MC40NzQ3MjMzMzI0Njk4NzUsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE4OTIy
>>> OTEyMzcwNTM0MSwtMC40NjIxOTU4MzkyNjUwMzUsMC4xMjQxNTgzMzk1Mjcz
>>> MjIsMC4xNjA2NjEzMDc0ODY1NTksLTAuMDg2NDU3MzcyNzQ2NjI2NSwtMC4w
>>> NjgzNjc0ODQyNDk4ODAxDQoiY29tcGxleCIsMC4xOTc2NDQ4MjQ2OTYzMjAs
>>> MC4wMDAxNzQ2MzA0MTc1NjQ2ODgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuNjQ3
>>> NjU3MTQxNDg4Mzc1LDAuOTc2MzIxNjU1NzYyOTY4LDAuNzU0OTc4Nzc3MzA5
>>> NTUzLC0wLjI2MjM0MDQyNTgyNDA1MiwwLjY1NjcxNzUzMzM2MTE3NiwtMC4x
>>> NjA0MjcxMzk2NzMwMTgsLTAuMjM2MjEwODU2MDgzOTAyLC0wLjM4NTQ1MjEw
>>> MDA0NjYyMywwLjAyMzg3NzU3MjgyNzcxNTcsMC4zMjQ1MjU2NTMxNjQ1MDgs
>>> LTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzMzY5NjU1NDE4OTE2NA0KImRpZmZp
>>> Y3VsdCIsMC4xODMwNDEzMjQwNjIyOTgsMC4wMDM0MDg4NzExODA3MTI4Nyww
>>> LjAxNTU0NDcwNTU3ODMxMjIsMC41MTQxNzU5NzQ1NTQxMTQsMC43NTQ5Nzg3
>>> NzczMDk1NTMsMC45NTczMjQzNDE2NjE5NzIsLTAuMTgzMDA1NTg3NTUxNjI0
>>> LDAuNTIzMTgzOTkzODk3NjMyLC0wLjE5NzgzMzM1NDQzMDkwNywtMC4yMjg0
>>> MzQ3MTMwNjE3NzYsLTAuMjYzNTg3NzQ2MDIxMTc0LC0wLjA0NTM5NzEzNzc3
>>> MDA4NDUsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMjM0NzA3NTE3Njc3NTg2LC0w
>>> LjIzOTEyNjk3MTQ4MDYyNQ0KIm9ubHlzZWxmIiwtMC4xNDY2MjYzNDcyMTk4
>>> NzksMC4wMDk2MzA1MDQ3NDM1ODAzNCwwLjAzMjE2OTMyODE5ODg2NjksLTAu
>>> MTk3NTA2NzA1OTE3MTIzLC0wLjI2MjM0MDQyNTgyNDA1MiwtMC4xODMwMDU1
>>> ODc1NTE2MjQsMC45NDc4NTI0MTU0NDM2NjMsLTAuMjY4MzMzOTc5Mjk1NjEy
>>> LDAuMDc4NzE5MTg3OTIxNTY1NCwwLjA4MDA1NTQ0MzA5MzgwMzYsMC4xNjM1
>>> OTUyNzc0OTg3NTgsLTAuMDA1MDcyNjg2MDg0MTc3MDQsLTAuMTYwMTM3NTQ1
>>> ODcxNDQ4LDAuMjExMjU3MjUyMjg3OTc5LDAuMTQ3ODg0MzUyNTg4NDk5DQoi
>>> bWFueWRpbWVuc2lvbnMiLDAuMTQ2MzU0MDI3Nzk3MTAxLDAuMDI4Mzg5NDM3
>>> MzMxNjY4NCwwLjA2NDYzMTIzMjYxODcwOTYsMC40NzQ3MjMzMzI0Njk4NzUs
>>> MC42NTY3MTc1MzMzNjExNzYsMC41MjMxODM5OTM4OTc2MzIsLTAuMjY4MzMz
>>> OTc5Mjk1NjEyLDAuOTQ5OTE3NjYyNjE2MTYsLTAuMTEzMjk1NjY3NDA4MTc3
>>> LC0wLjE4MTU3NjQ3MzE3MDc4NCwtMC4yNzkyOTg0MTcxNzcyNjEsMC4wNDQy
>>> NDgxMjM1MDgyNTI4LDAuMjU4MzQ5NzAyNDYwNjYzLC0wLjE5Njk5MzM0NjMz
>>> NzIxNCwtMC4yMjI1MzM5NTI2MzM0ODINCiJob3dtdWNoaW5mbyIsLTAuMTMy
>>> ODg3NTk2OTAyNTA2LDAuMDE4ODAyNzUzOTQ2MzI5OSwwLjAxMDI5NDUwODU2
>>> NTEyNDYsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE2MDQyNzEzOTY3MzAxOCwt
>>> MC4xOTc4MzMzNTQ0MzA5MDcsMC4wNzg3MTkxODc5MjE1NjU0LC0wLjExMzI5
>>> NTY2NzQwODE3NywwLjk0NjcyMjc0NjEzNzQxNSwwLjcwNjk3NjAxNTU4MjIx
>>> OCwwLjA5MjMxOTI3MDQ0Mzk5MzQsMC4yMTMwMzIyNDI0NzMzMTUsLTAuMjA5
>>> ODgyNDMxNzY1MTEwLDAuMjM5MTI0NTUxNjI5NTU5LDAuMjE5MDc4MzUyODkw
>>> NjU3DQoiZXF1YWxpbmZvIiwtMC4xNzM5NjUwNjkxMTEwMjUsLTAuMDE1NzAy
>>> NjM4MTUxNTk4NSwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE4OTIyOTEyMzcw
>>> NTM0MSwtMC4yMzYyMTA4NTYwODM5MDIsLTAuMjI4NDM0NzEzMDYxNzc2LDAu
>>> MDgwMDU1NDQzMDkzODAzNiwtMC4xODE1NzY0NzMxNzA3ODQsMC43MDY5NzYw
>>> MTU1ODIyMTgsMC45NjQ1MTc1NjI3NzgzMjgsMC4xODA1MTczMjU3NTIzODcs
>>> MC4xNjM4NDQ2NDA0OTU5ODMsLTAuMjEzODA0NTUwMDQzMjM5LDAuMjU4MDMy
>>> MzIyODI0NTk5LDAuMTkxODIwNDQ3NDA0MzM1DQoiY291bGRhdm9pZCIsLTAu
>>> MjY4NDU5MTYyOTMwNTY3LC0wLjE0NTc5NTAwNjc0MTg4NCwtMC4xNzg3NjU1
>>> NjMzNTQ4MjgsLTAuNDYyMTk1ODM5MjY1MDM1LC0wLjM4NTQ1MjEwMDA0NjYy
>>> MywtMC4yNjM1ODc3NDYwMjExNzQsMC4xNjM1OTUyNzc0OTg3NTgsLTAuMjc5
>>> Mjk4NDE3MTc3MjYxLDAuMDkyMzE5MjcwNDQzOTkzNCwwLjE4MDUxNzMyNTc1
>>> MjM4NywwLjk2MzIzNzMwOTczMDcyNiwtMC4xMjAxMzAxOTYzOTI0MDYsLTAu
>>> MDY4OTY1OTY1NzA1NzA5MSwwLjE2NTUzMzIwODc0MzU0NywwLjE5MTQyMTEz
>>> NDE4OTY4Mg0KInBvc291dGNvbWUiLC0wLjA2NzgwOTUzNzUwNzYyMjIsMC4x
>>> NDIwMzQzOTY5MDY4NzksMC4xNTEzNDM1Njc3NjE4NTksMC4xMjQxNTgzMzk1
>>> MjczMjIsMC4wMjM4Nzc1NzI4Mjc3MTU3LC0wLjA0NTM5NzEzNzc3MDA4NDUs
>>> LTAuMDA1MDcyNjg2MDg0MTc3MDQsMC4wNDQyNDgxMjM1MDgyNTI4LDAuMjEz
>>> MDMyMjQyNDczMzE1LDAuMTYzODQ0NjQwNDk1OTgzLC0wLjEyMDEzMDE5NjM5
>>> MjQwNiwwLjkzOTEwNzcxNzE4NjM4NSwtMC4yOTEyNjIzOTE4Mjc2NzEsMC4y
>>> NTYyNzQxOTU5ODMwMDQsMC4zNDY0NDE0MTExMTYxNDcNCiJuZWdvdXRjb21l
>>> IiwwLjE4MDU0OTkyNTAyNDM3NywwLjAwOTgxNTM4Mzk4NDM0ODUxLC0wLjAz
>>> MzY1NTkwNjMzMDc4MzUsMC4xNjA2NjEzMDc0ODY1NTksMC4zMjQ1MjU2NTMx
>>> NjQ1MDgsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMTYwMTM3NTQ1ODcxNDQ4LDAu
>>> MjU4MzQ5NzAyNDYwNjYzLC0wLjIwOTg4MjQzMTc2NTExMCwtMC4yMTM4MDQ1
>>> NTAwNDMyMzksLTAuMDY4OTY1OTY1NzA1NzA5MSwtMC4yOTEyNjIzOTE4Mjc2
>>> NzEsMC45NTI1NTI5NjU3OTY0MjEsLTAuMjIxOTE3MjIyOTMwMTksLTAuMjMx
>>> MDMyMDE0OTI3Mzk3DQoiY29udHJvbCIsLTAuMDQyMDg0NDM2NDAzNzg3NCww
>>> LjA3MDU4Njg3NTY1Mzk3MzIsMC4wOTI5MDYyMjc5MzM0ODk4LC0wLjA4NjQ1
>>> NzM3Mjc0NjYyNjUsLTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzNDcwNzUxNzY3
>>> NzU4NiwwLjIxMTI1NzI1MjI4Nzk3OSwtMC4xOTY5OTMzNDYzMzcyMTQsMC4y
>>> MzkxMjQ1NTE2Mjk1NTksMC4yNTgwMzIzMjI4MjQ1OTksMC4xNjU1MzMyMDg3
>>> NDM1NDcsMC4yNTYyNzQxOTU5ODMwMDQsLTAuMjIxOTE3MjIyOTMwMTksMC45
>>> Mzc2MDc1MzMxODY1NzYsMC4zMTI2NjQxOTk2MzE2MjANCiJkZXNpcmVkIiwt
>>> MC4wNzMwNTc3ODk2OTAyOTY3LDAuMTA4MDAwNDQ5MzI4MzEzLDAuMTU5NzM1
>>> NjE4NDIzMzM1LC0wLjA2ODM2NzQ4NDI0OTg4MDEsLTAuMjMzNjk2NTU0MTg5
>>> MTY0LC0wLjIzOTEyNjk3MTQ4MDYyNSwwLjE0Nzg4NDM1MjU4ODQ5OSwtMC4y
>>> MjI1MzM5NTI2MzM0ODIsMC4yMTkwNzgzNTI4OTA2NTcsMC4xOTE4MjA0NDc0
>>> MDQzMzUsMC4xOTE0MjExMzQxODk2ODIsMC4zNDY0NDE0MTExMTYxNDcsLTAu
>>> MjMxMDMyMDE0OTI3Mzk3LDAuMzEyNjY0MTk5NjMxNjIwLDAuOTYzMTMxNjM5
>>> NTYwMTA4DQo=3D
>>>
>>> --1660387551-1458482416-1249639718=3D:2997--
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>
>> --=20
>> Jeffrey Ryan
>> jeffrey.ryan at insightalgo.com
>>
>> ia: insight algorithmics
>> www.insightalgo.com
>>
> 
> CSV:
> 
> "","wasrightchoice","tellgood","tellbest","important","complex","difficult"=
> ,"onlyself","manydimensions","howmuchinfo","equalinfo","couldavoid","posout=
> come","negoutcome","control","desired"
> "wasrightchoice",0.96369773178963,0.292736321229647,0.289852808489117,0.385=
> 266965362761,0.197644824696320,0.183041324062298,-0.146626347219879,0.14635=
> 4027797101,-0.132887596902506,-0.173965069111025,-0.268459162930567,-0.0678=
> 095375076222,0.180549925024377,-0.0420844364037874,-0.0730577896902967
> "tellgood",0.292736321229647,0.955494246210856,0.757544193339566,0.19124118=
> 3203129,0.000174630417564688,0.00340887118071287,0.00963050474358034,0.0283=
> 894373316684,0.0188027539463299,-0.0157026381515985,-0.145795006741884,0.14=
> 2034396906879,0.00981538398434851,0.0705868756539732,0.108000449328313
> "tellbest",0.289852808489117,0.757544193339566,0.948593590912408,0.23059895=
> 8597528,0.0302692106135439,0.0155447055783122,0.0321693281988669,0.06463123=
> 26187096,0.0102945085651246,-0.0196759997923009,-0.178765563354828,0.151343=
> 567761859,-0.0336559063307835,0.0929062279334898,0.159735618423335
> "important",0.385266965362761,0.191241183203129,0.230598958597528,0.9644978=
> 8034361,0.647657141488375,0.514175974554114,-0.197506705917123,0.4747233324=
> 69875,-0.129091329816201,-0.189229123705341,-0.462195839265035,0.1241583395=
> 27322,0.160661307486559,-0.0864573727466265,-0.0683674842498801
> "complex",0.197644824696320,0.000174630417564688,0.0302692106135439,0.64765=
> 7141488375,0.976321655762968,0.754978777309553,-0.262340425824052,0.6567175=
> 33361176,-0.160427139673018,-0.236210856083902,-0.385452100046623,0.0238775=
> 728277157,0.324525653164508,-0.240634804887055,-0.233696554189164
> "difficult",0.183041324062298,0.00340887118071287,0.0155447055783122,0.5141=
> 75974554114,0.754978777309553,0.957324341661972,-0.183005587551624,0.523183=
> 993897632,-0.197833354430907,-0.228434713061776,-0.263587746021174,-0.04539=
> 71377700845,0.330075666526761,-0.234707517677586,-0.239126971480625
> "onlyself",-0.146626347219879,0.00963050474358034,0.0321693281988669,-0.197=
> 506705917123,-0.262340425824052,-0.183005587551624,0.947852415443663,-0.268=
> 333979295612,0.0787191879215654,0.0800554430938036,0.163595277498758,-0.005=
> 07268608417704,-0.160137545871448,0.211257252287979,0.147884352588499
> "manydimensions",0.146354027797101,0.0283894373316684,0.0646312326187096,0.=
> 474723332469875,0.656717533361176,0.523183993897632,-0.268333979295612,0.94=
> 991766261616,-0.113295667408177,-0.181576473170784,-0.279298417177261,0.044=
> 2481235082528,0.258349702460663,-0.196993346337214,-0.222533952633482
> "howmuchinfo",-0.132887596902506,0.0188027539463299,0.0102945085651246,-0.1=
> 29091329816201,-0.160427139673018,-0.197833354430907,0.0787191879215654,-0.=
> 113295667408177,0.946722746137415,0.706976015582218,0.0923192704439934,0.21=
> 3032242473315,-0.209882431765110,0.239124551629559,0.219078352890657
> "equalinfo",-0.173965069111025,-0.0157026381515985,-0.0196759997923009,-0.1=
> 89229123705341,-0.236210856083902,-0.228434713061776,0.0800554430938036,-0.=
> 181576473170784,0.706976015582218,0.964517562778328,0.180517325752387,0.163=
> 844640495983,-0.213804550043239,0.258032322824599,0.191820447404335
> "couldavoid",-0.268459162930567,-0.145795006741884,-0.178765563354828,-0.46=
> 2195839265035,-0.385452100046623,-0.263587746021174,0.163595277498758,-0.27=
> 9298417177261,0.0923192704439934,0.180517325752387,0.963237309730726,-0.120=
> 130196392406,-0.0689659657057091,0.165533208743547,0.191421134189682
> "posoutcome",-0.0678095375076222,0.142034396906879,0.151343567761859,0.1241=
> 58339527322,0.0238775728277157,-0.0453971377700845,-0.00507268608417704,0.0=
> 442481235082528,0.213032242473315,0.163844640495983,-0.120130196392406,0.93=
> 9107717186385,-0.291262391827671,0.256274195983004,0.346441411116147
> "negoutcome",0.180549925024377,0.00981538398434851,-0.0336559063307835,0.16=
> 0661307486559,0.324525653164508,0.330075666526761,-0.160137545871448,0.2583=
> 49702460663,-0.209882431765110,-0.213804550043239,-0.0689659657057091,-0.29=
> 1262391827671,0.952552965796421,-0.22191722293019,-0.231032014927397
> "control",-0.0420844364037874,0.0705868756539732,0.0929062279334898,-0.0864=
> 573727466265,-0.240634804887055,-0.234707517677586,0.211257252287979,-0.196=
> 993346337214,0.239124551629559,0.258032322824599,0.165533208743547,0.256274=
> 195983004,-0.22191722293019,0.937607533186576,0.312664199631620
> "desired",-0.0730577896902967,0.108000449328313,0.159735618423335,-0.068367=
> 4842498801,-0.233696554189164,-0.239126971480625,0.147884352588499,-0.22253=
> 3952633482,0.219078352890657,0.191820447404335,0.191421134189682,0.34644141=
> 1116147,-0.231032014927397,0.312664199631620,0.963131639560108
> 
> RAM:
> 
> important <-- challenge, NA, 1
> complex  <-- challenge, c.complex, NA
> difficult <-- challenge, c.difficult, NA
> manydimensions <-- challenge, c.manydimensions, NA
> couldavoid <-- challenge, c.couldavoid, NA
> onlyself <-- challenge, c.onlyself, NA
> 
> wasrightchoice <-- eval, NA, 1
> tellgood <-- eval, e.tellgood, NA
> tellbest <-- eval, e.tellbest, NA
> negoutcome <-- eval, e.negoutcome, NA
> 
> equalinfo <-- informed, NA, 1
> control <-- informed, i.control, NA
> desired <-- informed, i.desired, NA
> howmuchinfo <-- informed, i.howmuchinfo, NA
> posoutcome <-- informed, i.posoutcome, NA
> 
> wasrightchoice <-> wasrightchoice, wasrightchoiceV, NA
> tellgood <-> tellgood, tellgoodV, NA
> tellbest <-> tellbest, tellbestV, NA
> negoutcome <-> negoutcome, negoutcomeV, NA
> 
> onlyself <-> onlyself, onlyselfV, NA
> important <-> important, importantV, NA
> complex <-> complex, complexV, NA
> difficult <-> difficult, difficultV, NA
> manydimensions <-> manydimensions, manydimensionsV, NA
> couldavoid <-> couldavoid, couldavoidV, NA
> 
> equalinfo <-> equalinfo, equalinfoV, NA
> control <-> control, controlV, NA
> desired <-> desired, desiredV, NA
> howmuchinfo <-> howmuchinfo, howmuchinfoV, NA
> posoutcome <-> posoutcome, posoutcomeV, NA
> 
> eval <-> eval, evalV, NA
> challenge <-> challenge, challengeV, NA
> informed <-> informed, informedV, NA
> --1660387551-150661043-1249684349=:2997--
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
View this message in context: http://www.nabble.com/Re%3A-Bug-in-nlm%2C-found-using-sem--failure-in-several-flavors-%28PR-13883%29-tp24875708p24906063.html
Sent from the R devel mailing list archive at Nabble.com.


From wdunlap at tibco.com  Mon Aug 10 23:07:27 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Mon, 10 Aug 2009 14:07:27 -0700
Subject: [Rd] Bug in nlm, found using sem;
	failure in several flavors (PR#13883)
In-Reply-To: <24906063.post@talk.nabble.com>
References: <20090807223514.7C78E282EF4C@mail.pubhealth.ku.dk>
	<24906063.post@talk.nabble.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D70001A18B3C@NA-PA-VBE03.na.tibco.com>

> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Ben Bolker
> Sent: Monday, August 10, 2009 12:52 PM
> To: r-devel at r-project.org
> Subject: Re: [Rd] Bug in nlm, found using sem; failure in 
> several flavors (PR#13883)
> 
> 
> 
>    A wild guess, based on some recent "non-deterministic" behavior in
> lme4: could this be driven by a bug in optimized linear 
> algebra libraries
> (BLAS/LAPACK)?  (Unfortunately, I'm not clear on how to check 
> the versions
> of BLAS/LAPACK being used and whether they are subject to bugs,
> but perhaps someone else can comment ...)
> 
>    Ben Bolker
> 

Running his example under valgrind (a memory misuse checker on Linux)
does show it using memory it should not be using in the optimization C
code
around where it is copying the gradient vector.  The 

==10916== Invalid read of size 1
==10916==    at 0x400686D: memcpy (mc_replace_strmem.c:406)
==10916==    by 0x8072BC1: FT_store (optimize.c:319)
==10916==    by 0x8072F92: fcn (optimize.c:408)
==10916==    by 0x81039DF: lnsrch (uncmin.c:678)
==10916==    by 0x8107564: optdrv (uncmin.c:2351)
==10916==    by 0x8107E23: optif9 (uncmin.c:2605)
==10916==    by 0x8073BC4: do_nlm (optimize.c:711)
==10916==    by 0x8068C27: do_internal (names.c:1160)
==10916==    by 0x8188C0B: Rf_eval (eval.c:464)
==10916==    by 0x818ABFA: do_begin (eval.c:1244)
==10916==    by 0x8188C0B: Rf_eval (eval.c:464)
==10916==    by 0x81894D8: Rf_applyClosure (eval.c:698)
==10916==  Address 0x524090D is 1 bytes after a block of size 1,996
alloc'd
==10916==    at 0x40046EE: malloc (vg_replace_malloc.c:149)
==10916==    by 0x805999C: GetNewPage (memory.c:638)
==10916==    by 0x805F684: Rf_cons (memory.c:1804)
==10916==    by 0x818B9A6: Rf_evalList (eval.c:1594)
==10916==    by 0x8068BAC: do_internal (names.c:1156)
==10916==    by 0x8188C0B: Rf_eval (eval.c:464)
==10916==    by 0x81894D8: Rf_applyClosure (eval.c:698)
==10916==    by 0x8188E22: Rf_eval (eval.c:508)
==10916==    by 0x818A6E1: do_for (eval.c:1133)
==10916==    by 0x8188C0B: Rf_eval (eval.c:464)
==10916==    by 0x818ABFA: do_begin (eval.c:1244)
==10916==    by 0x8188C0B: Rf_eval (eval.c:464)
==10916==

The details depend on whether gctorture(TRUE) has been called or not,
(and whether the compiler flag -02 has been set or not, as that messes
up the line numbers a bit) but valgrind finds the first memory misuse in
this area.  With gctorture it takes quite a long time to get to this
point.

> 
> Adam D. I. Kramer-2 wrote:
> > 
> >   This message is in MIME format.  The first part should be 
> readable text,
> >   while the remaining parts are likely unreadable without MIME-aware
> > tools.
> > 
> > --1660387551-150661043-1249684349=:2997
> > Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
> > Content-Transfer-Encoding: QUOTED-PRINTABLE
> > 
> > Hi Jeff,
> > 
> >  =09As mentioned in my message, I *did* replicate on 
> another platform.=20
> > One platform was running linux in a VM, the other running 
> MacOSX, on two
> > different physical machines.  The problem did not replicate 
> on a PowerPC
> > box, so if it is a bug with intel chips, I think it's also 
> appropriate to
> > report here given that the problem seems to cross the OS 
> boundary.  I do
> > no=
> > t
> > have access to a Windows machine.
> > 
> >  =09Also, I have spent a decent amount of time running 
> memory testers on
> > the first machine's memory, to ensure that physical memory is not a
> > problem...the classic "memcheck" program finds no trouble.
> > 
> >  =09The CSV and .ram files both came through as base-64-encoded
> > attachments, which you actually quoted back to me in your response,
> > below...but in case your mail client can't read those and/or you are
> > interested in this bug, I have pasted them at the end of 
> this message
> > (sinc=
> > e
> > they're quite small).
> > 
> >  =09And thanks for the shout-out for bacon. I bought this 
> domain name in
> > undergrad many years ago, and I must say, I've never regretted it!
> > 
> > --Adam
> > 
> > On Fri, 7 Aug 2009, Jeff Ryan wrote:
> > 
> >> Adam,
> >>
> >> It seems that your attachment didn't make it through.
> >>
> >> That aside, my experience with strange errors like those 
> (random type
> >> not implemented ones) has been that you may be looking at a memory
> >> problem on you machine. Given that you can't replicate on another
> >> platform (and the .csv file didn't come through), I would think it
> >> wise to start there.
> >>
> >> My 2c.  And I love bacon too :)
> >>
> >> Jeff
> >>
> >> On Fri, Aug 7, 2009 at 1:10 PM, <adik at ilovebacon.org> wrote:
> >>> =A0This message is in MIME format. =A0The first part 
> should be readable
> >>> =
> > text,
> >>> =A0while the remaining parts are likely unreadable 
> without MIME-aware
> >>> to=
> > ols.
> >>>
> >>> --1660387551-1458482416-1249639718=3D:2997
> >>> Content-Type: TEXT/PLAIN; CHARSET=3DUS-ASCII; FORMAT=3Dflowed
> >>> Content-ID: 
> <Pine.LNX.4.64.0908071039211.2997 at parser.ilovebacon.org>
> >>>
> >>> Hello,
> >>>
> >>> =A0 =A0 =A0 =A0There appears to be a bug in the nlm 
> function, which I
> >>> di=
> > scovered
> >>> when trying to run an SEM. =A0The SEM is not bizarre; the 
> covariance
> >>> mat=
> > rix is
> >>> solve-able and the eigenvalues are greater than zero, and I do not
> >>> belie=
> > ve
> >>> the "sem" package per se to be the problem (as nlm keeps 
> being the part
> >>> =
> > that
> >>> fails, though I can't replicate this with other nlm tasks). =A0I
> >>> apologi=
> > ze if
> >>> I have put too many much information in this message; I'm not a
> >>> programm=
> > er
> >>> by trade so I don't really know what's going on here, 
> which hampers my
> >>> ability to write consise bug reports.
> >>>
> >>> Here is the code I use:
> >>>
> >>> library(sem)
> >>> ice.S <- read.csv("iceS.csv") # attached
> >>> rownames(ice.S) <- ice.S[,1]
> >>> ice.S[,1] <- NULL
> >>> ice.S <- as.matrix(ice.S)
> >>> ice.ram <- specify.model("ice.ram") # attached
> >>> ice.N <- 342
> >>> ice.sem <- sem(ram=3Dice.ram, S=3Dice.S, N=3Dice.N)
> >>>
> >>> ...at this point, any number of problems could occur. I 
> have seen the
> >>> following.
> >>>
> >>> 1) Simple lack of convergence. (might be my model's fault.)
> >>> 2) Error in nlm(if (analytic.gradient) objective.2 else 
> objective.1,
> >>> sta=
> > rt,
> >>> :
> >>> =A0 type 31 is unimplemented in 'type2char'
> >>> 3) =A0*** caught segfault ***
> >>> address 0xc019c87b, cause 'memory not mapped'
> >>>
> >>> Traceback:
> >>> =A01: nlm(if (analytic.gradient) objective.2 else 
> objective.1, start,
> >>> hessian =3D TRUE, iterlim =3D maxiter, print.level =3D if 
> (debug) 2
> >>> else=
> >  0,
> >>> typsize =3D typsize, ...)
> >>> =A02: sem.default(ram =3D ram, S =3D S, N =3D N, 
> param.names =3D pars,
> >>> v=
> > ar.names =3D
> >>> vars, =A0 =A0 fixed.x =3D fixed.x, debug =3D debug, ...)
> >>> =A03: sem(ram =3D ram, S =3D S, N =3D N, param.names =3D pars,
> >>> var.names=
> >  =3D vars,
> >>> fixed.x =3D fixed.x, debug =3D debug, ...)
> >>> =A04: sem.mod(ram =3D ice.ram, S =3D ice.S, N =3D ice.N)
> >>> =A05: sem(ram =3D ice.ram, S =3D ice.S, N =3D ice.N)
> >>>
> >>> Possible actions:
> >>> 1: abort (with core dump, if enabled)
> >>> 2: normal R exit
> >>> 3: exit R without saving workspace
> >>> 4: exit R saving workspace
> >>> Selection: 1
> >>> aborting ...
> >>> Segmentation fault
> >>> swiss:data$
> >>>
> >>> (no core was dumped).
> >>>
> >>> Trying with debug mode provides other interesting errors:
> >>>
> >>>> ice.sem <- sem(ram=3Dice.ram, S=3Dice.S, N=3Dice.N, debug=3DTRUE)
> >>>
> >>> ...gets up to some iteration (not always 15), and then R dies
> >>> ungraceful=
> > ly,
> >>> and exits to the shell:
> >>>
> >>> iteration =3D 15
> >>> Step:
> >>> =A0[1] =A01.253132e-02 =A01.183343e-02 -7.651342e-03 -2.490800e-03
> >>> =A02.=
> > 278938e-03
> >>> =A0[6] =A03.197431e-04 =A06.137849e-04 -2.496882e-03 -1.065829e-03
> >>> -2.11=
> > 8179e-03
> >>> [11] =A02.942936e-03 -1.335936e-03 -3.665618e-03 =A03.090566e-03
> >>> =A08.53=
> > 4956e-04
> >>> [16] -1.440421e-03 -5.230877e-04 -1.053686e-04 -9.771005e-04
> >>> -4.269216e-=
> > 04
> >>> [21] =A07.261694e-05 -1.039668e-03 -8.409151e-03 -3.497456e-03
> >>> =A02.2168=
> > 99e-03
> >>> [26] -4.633520e-03 -4.052130e-03 -4.746537e-03 -1.589622e-03
> >>> -2.523766e-=
> > 04
> >>> Parameter:
> >>> =A0[1] -0.76604614 -1.19639662 =A00.83456888 =A00.72540413
> >>> =A00.08482452=
> >  =A00.56180393
> >>> =A0[7] =A00.50615814 =A00.55728015 =A00.83796696 =A00.88371335
> >>> -0.704651=
> > 16 =A00.85251098
> >>> [13] -0.18346956 =A00.66857787 =A00.57012481 =A00.39116561
> >>> =A00.91237990=
> >  =A00.63951482
> >>> [19] =A00.26601566 =A00.29240836 =A00.44710919 =A00.94734056
> >>> =A06.520390=
> > 15 =A00.02524762
> >>> [25] -0.01614603 =A02.88198219 =A00.03442452 =A03.52272237
> >>> =A01.44698423=
> >  -0.72964745
> >>> Function Value
> >>> [1] -15175.94
> >>> Gradient:
> >>> =A0[1] -2.085412e+07 -3.819717e+07 =A03.883989e+07 =A01.352594e+00
> >>> -4.28=
> > 3329e+00
> >>> =A0[6] -1.437250e+00 -6.558913e-01 =A01.358276e+00 =A07.930865e+05
> >>> -1.29=
> > 3853e+06
> >>> [11] -5.816627e+03 =A05.908197e+05 -2.705742e+08 -1.194400e+07
> >>> -4.007083=
> > e+07
> >>> [16] -4.143068e+07 -6.159782e-01 =A01.044274e-01 -8.591048e+00
> >>> -2.083471=
> > e+00
> >>> [21] -7.548753e-01 -5.418994e-01 -2.799228e+02 -1.321739e+07
> >>> -3.517728e+=
> > 07
> >>> [26] -7.106654e+02 -7.335293e+06 -7.335285e+05 =A03.117764e-01
> >>> -2.234989=
> > e+04
> >>>
> >>> Abort trap
> >>> swiss:data$
> >>>
> >>> ...I have also seen convergence reached, and nlm then die 
> with this
> >>> mess=
> > age:
> >>>
> >>> Error in nlm(if (analytic.gradient) objective.2 else 
> objective.1, start,
> >>> :
> >>> =A0 type 27 is unimplemented in 'type2char'
> >>>
> >>> (similar to above, but now referring to type 27)
> >>>
> >>> I have shown this effect (or something similar...never 
> know how it'll
> >>> fa=
> > il
> >>> next) on the following platforms:
> >>>
> >>>> version
> >>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
> >>> platform =A0 =A0 =A0 i386-apple-darwin9.7.0
> >>> arch =A0 =A0 =A0 =A0 =A0 i386
> >>> os =A0 =A0 =A0 =A0 =A0 =A0 darwin9.7.0
> >>> system =A0 =A0 =A0 =A0 i386, darwin9.7.0
> >>> status
> >>> major =A0 =A0 =A0 =A0 =A02
> >>> minor =A0 =A0 =A0 =A0 =A09.1
> >>> year =A0 =A0 =A0 =A0 =A0 2009
> >>> month =A0 =A0 =A0 =A0 =A006
> >>> day =A0 =A0 =A0 =A0 =A0 =A026
> >>> svn rev =A0 =A0 =A0 =A048839
> >>> language =A0 =A0 =A0 R
> >>> version.string R version 2.9.1 (2009-06-26)
> >>>
> >>>> sessionInfo()
> >>> R version 2.9.1 (2009-06-26)
> >>> i386-apple-darwin9.8.0
> >>>
> >>> locale:
> >>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> >>>
> >>> attached base packages:
> >>> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets
> >>> =A0method=
> > s =A0 base
> >>>
> >>> other attached packages:
> >>> [1] sem_0.9-17
> >>>
> >>> loaded via a namespace (and not attached):
> >>> [1] tcltk_2.9.1 tools_2.9.1
> >>>
> >>> (I admit to having compiled this version of R myself (to link to a
> >>> hand-compiled ATLAS), though no errors were thrown in the 
> compilation
> >>> st=
> > age.
> >>> I compiled using this config string, at first...
> >>>
> >>> ./configure --prefix=3D/usr/local --with-x --disable-R-framework
> >>> --enabl=
> > e-threads=3Dposix --with-blas=3D"/usr/local/lib/libptf77blas.a
> > /usr/local/l=
> > ib/libptcblas.a /usr/local/lib/libatlas.a -lpthread"
> > --with-lapack=3D"/usr/=
> > local/lib/liblapack.a /usr/local/lib/libptf77blas.a
> > /usr/local/lib/libptcbl=
> > as.a /usr/local/lib/libatlas.a -lpthread" --without-aqua 
> CFLAGS=3D"-O3
> > -mtu=
> > ne=3Dnocona -m32" CXXFLAGS=3D"-O3 -mtune=3Dnocona -m32" 
> FFLAGS=3D"-O3
> > -mtun=
> > e=3Dnocona -m32 -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l gfortran"
> > F77FLA=
> > GS=3D"-O3 -mtune=3Dnocona -m32 
> -L/usr/lib/gcc/i686-apple-darwin9/4.2.1 -l
> > g=
> > fortran" FCFLAGS=3D"-O3 -mtune=3Dnocona -m32
> > -L/usr/lib/gcc/i686-apple-darw=
> > in9/4.2.1 -l gfortran" LDFLAGS=3D"-m32 -L/sw/lib"
> > CPPFLAGS=3D"-I/sw/include=
> > " CC=3Dgcc-4.2 F77=3Dgfortran-4.2 FC=3Dgfortran-4.2 CXX=3Dg++-4.2
> > OBJC=3Dgc=
> > c-4.2
> >>>
> >>> ...though I have also recompiled using simply this:
> >>>
> >>> ./configure --prefix=3D/usr/local --with-x --disable-R-framework
> >>>
> >>> ...and then re-installed SEM, and I got a few other, 
> different error
> >>> messages and core dumps, "including type 11 is unimplemented in
> >>> 'type2ch=
> > ar'"
> >>> and "cannot coerce type 'weakref' to vector of type 'double'".
> >>> =A0Runnin=
> > g with
> >>> debug=3DTRUE also segfaults sometimes, even after 
> achieving "Current
> >>> ite=
> > rate
> >>> is probably solution" status.)
> >>>
> >>>> version
> >>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
> >>> platform =A0 =A0 =A0 x86_64-unknown-linux-gnu
> >>> arch =A0 =A0 =A0 =A0 =A0 x86_64
> >>> os =A0 =A0 =A0 =A0 =A0 =A0 linux-gnu
> >>> system =A0 =A0 =A0 =A0 x86_64, linux-gnu
> >>> status
> >>> major =A0 =A0 =A0 =A0 =A02
> >>> minor =A0 =A0 =A0 =A0 =A09.1
> >>> year =A0 =A0 =A0 =A0 =A0 2009
> >>> month =A0 =A0 =A0 =A0 =A006
> >>> day =A0 =A0 =A0 =A0 =A0 =A026
> >>> svn rev =A0 =A0 =A0 =A048839
> >>> language =A0 =A0 =A0 R
> >>> version.string R version 2.9.1 (2009-06-26)
> >>>
> >>>> sessionInfo()
> >>> R version 2.9.1 (2009-06-26)
> >>> x86_64-unknown-linux-gnu
> >>>
> >>> locale:
> >>> 
> LC_CTYPE=3Den_US;LC_NUMERIC=3DC;LC_TIME=3Den_US;LC_COLLATE=3De
n_US;LC_MO=
> > 
> NETARY=3DC;LC_MESSAGES=3Den_US;LC_PAPER=3Den_US;LC_NAME=3DC;LC
> _ADDRESS=3DC;=
> > LC_TELEPHONE=3DC;LC_MEASUREMENT=3Den_US;LC_IDENTIFICATION=3DC
> >>>
> >>> attached base packages:
> >>> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets
> >>> =A0method=
> > s =A0 base
> >>>
> >>> other attached packages:
> >>> [1] sem_0.9-17
> >>>
> >>> ...however, THIS platform does NOT show the bug:
> >>>
> >>>> version
> >>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0_
> >>> platform =A0 =A0 =A0 powerpc-unknown-linux-gnu
> >>> arch =A0 =A0 =A0 =A0 =A0 powerpc
> >>> os =A0 =A0 =A0 =A0 =A0 =A0 linux-gnu
> >>> system =A0 =A0 =A0 =A0 powerpc, linux-gnu
> >>> status
> >>> major =A0 =A0 =A0 =A0 =A02
> >>> minor =A0 =A0 =A0 =A0 =A09.1
> >>> year =A0 =A0 =A0 =A0 =A0 2009
> >>> month =A0 =A0 =A0 =A0 =A006
> >>> day =A0 =A0 =A0 =A0 =A0 =A026
> >>> svn rev =A0 =A0 =A0 =A048839
> >>> language =A0 =A0 =A0 R
> >>> version.string R version 2.9.1 (2009-06-26)
> >>>> sessionInfo()
> >>> R version 2.9.1 (2009-06-26)
> >>> powerpc-unknown-linux-gnu
> >>>
> >>> locale:
> >>> 
> LC_CTYPE=3Den_US.UTF-8;LC_NUMERIC=3DC;LC_TIME=3Den_US.UTF-8;LC
_COLLATE=
> > 
> =3Den_US.UTF-8;LC_MONETARY=3DC;LC_MESSAGES=3Den_US.UTF-8;LC_PA
PER=3Den_US.U=
> > 
> TF-8;LC_NAME=3DC;LC_ADDRESS=3DC;LC_TELEPHONE=3DC;LC_MEASUREMEN
> T=3Den_US.UTF=
> > -8;LC_IDENTIFICATION=3DC
> >>>
> >>> attached base packages:
> >>> [1] stats =A0 =A0 graphics =A0grDevices utils =A0 =A0 datasets
> >>> =A0method=
> > s =A0 base
> >>>
> >>> other attached packages:
> >>> [1] sem_0.9-17
> >>>>
> >>>
> >>> ...for this system, the model simply repeatedly fails to converge,
> >>> wheth=
> > er
> >>> debug is set or not.
> >>>
> >>> I have also tried altering my model. This has resulted in the same
> >>> bugs,=
> >  but
> >>> instead of "every so often simply not converging," it actually
> >>> converges=
> >  and
> >>> appears to be the model I asked R to solve...but this is rare.
> >>>
> >>> Please let me know if I can provide any other info.
> >>>
> >>> Cordially,
> >>> Adam D. I. Kramer
> >>> --1660387551-1458482416-1249639718=3D:2997
> >>> Content-Type: AUDIO/X-PN-REALAUDIO; NAME=3Dice.ram
> >>> Content-Transfer-Encoding: BASE64
> >>> Content-ID: 
> <Pine.LNX.4.64.0908070308380.2997 at parser.ilovebacon.org>
> >>> Content-Description:
> >>> Content-Disposition: ATTACHMENT; FILENAME=3Dice.ram
> >>>
> >>> aW1wb3J0YW50IDwtLSBjaGFsbGVuZ2UsIE5BLCAxCmNvbXBsZXggIDwtLSBj
> >>> aGFsbGVuZ2UsIGMuY29tcGxleCwgTkEKZGlmZmljdWx0IDwtLSBjaGFsbGVu
> >>> Z2UsIGMuZGlmZmljdWx0LCBOQQptYW55ZGltZW5zaW9ucyA8LS0gY2hhbGxl
> >>> bmdlLCBjLm1hbnlkaW1lbnNpb25zLCBOQQpjb3VsZGF2b2lkIDwtLSBjaGFs
> >>> bGVuZ2UsIGMuY291bGRhdm9pZCwgTkEKb25seXNlbGYgPC0tIGNoYWxsZW5n
> >>> ZSwgYy5vbmx5c2VsZiwgTkEKCndhc3JpZ2h0Y2hvaWNlIDwtLSBldmFsLCBO
> >>> QSwgMQp0ZWxsZ29vZCA8LS0gZXZhbCwgZS50ZWxsZ29vZCwgTkEKdGVsbGJl
> >>> c3QgPC0tIGV2YWwsIGUudGVsbGJlc3QsIE5BCm5lZ291dGNvbWUgPC0tIGV2
> >>> YWwsIGUubmVnb3V0Y29tZSwgTkEKCmVxdWFsaW5mbyA8LS0gaW5mb3JtZWQs
> >>> IE5BLCAxCmNvbnRyb2wgPC0tIGluZm9ybWVkLCBpLmNvbnRyb2wsIE5BCmRl
> >>> c2lyZWQgPC0tIGluZm9ybWVkLCBpLmRlc2lyZWQsIE5BCmhvd211Y2hpbmZv
> >>> IDwtLSBpbmZvcm1lZCwgaS5ob3dtdWNoaW5mbywgTkEKcG9zb3V0Y29tZSA8
> >>> LS0gaW5mb3JtZWQsIGkucG9zb3V0Y29tZSwgTkEKCndhc3JpZ2h0Y2hvaWNl
> >>> IDwtPiB3YXNyaWdodGNob2ljZSwgd2FzcmlnaHRjaG9pY2VWLCBOQQp0ZWxs
> >>> Z29vZCA8LT4gdGVsbGdvb2QsIHRlbGxnb29kViwgTkEKdGVsbGJlc3QgPC0+
> >>> IHRlbGxiZXN0LCB0ZWxsYmVzdFYsIE5BCm5lZ291dGNvbWUgPC0+IG5lZ291
> >>> dGNvbWUsIG5lZ291dGNvbWVWLCBOQQoKb25seXNlbGYgPC0+IG9ubHlzZWxm
> >>> LCBvbmx5c2VsZlYsIE5BCmltcG9ydGFudCA8LT4gaW1wb3J0YW50LCBpbXBv
> >>> cnRhbnRWLCBOQQpjb21wbGV4IDwtPiBjb21wbGV4LCBjb21wbGV4ViwgTkEK
> >>> ZGlmZmljdWx0IDwtPiBkaWZmaWN1bHQsIGRpZmZpY3VsdFYsIE5BCm1hbnlk
> >>> aW1lbnNpb25zIDwtPiBtYW55ZGltZW5zaW9ucywgbWFueWRpbWVuc2lvbnNW
> >>> LCBOQQpjb3VsZGF2b2lkIDwtPiBjb3VsZGF2b2lkLCBjb3VsZGF2b2lkViwg
> >>> TkEKCmVxdWFsaW5mbyA8LT4gZXF1YWxpbmZvLCBlcXVhbGluZm9WLCBOQQpj
> >>> b250cm9sIDwtPiBjb250cm9sLCBjb250cm9sViwgTkEKZGVzaXJlZCA8LT4g
> >>> ZGVzaXJlZCwgZGVzaXJlZFYsIE5BCmhvd211Y2hpbmZvIDwtPiBob3dtdWNo
> >>> aW5mbywgaG93bXVjaGluZm9WLCBOQQpwb3NvdXRjb21lIDwtPiBwb3NvdXRj
> >>> b21lLCBwb3NvdXRjb21lViwgTkEKCmV2YWwgPC0+IGV2YWwsIGV2YWxWLCBO
> >>> QQpjaGFsbGVuZ2UgPC0+IGNoYWxsZW5nZSwgY2hhbGxlbmdlViwgTkEKaW5m
> >>> b3JtZWQgPC0+IGluZm9ybWVkLCBpbmZvcm1lZFYsIE5BCg=3D=3D
> >>>
> >>> --1660387551-1458482416-1249639718=3D:2997
> >>> Content-Type: TEXT/CSV; CHARSET=3DUS-ASCII; NAME=3DiceS.csv
> >>> Content-Transfer-Encoding: BASE64
> >>> Content-ID: 
> <Pine.LNX.4.64.0908070308381.2997 at parser.ilovebacon.org>
> >>> Content-Description:
> >>> Content-Disposition: ATTACHMENT; FILENAME=3DiceS.csv
> >>>
> >>> IiIsIndhc3JpZ2h0Y2hvaWNlIiwidGVsbGdvb2QiLCJ0ZWxsYmVzdCIsImlt
> >>> cG9ydGFudCIsImNvbXBsZXgiLCJkaWZmaWN1bHQiLCJvbmx5c2VsZiIsIm1h
> >>> bnlkaW1lbnNpb25zIiwiaG93bXVjaGluZm8iLCJlcXVhbGluZm8iLCJjb3Vs
> >>> ZGF2b2lkIiwicG9zb3V0Y29tZSIsIm5lZ291dGNvbWUiLCJjb250cm9sIiwi
> >>> ZGVzaXJlZCINCiJ3YXNyaWdodGNob2ljZSIsMC45NjM2OTc3MzE3ODk2Myww
> >>> LjI5MjczNjMyMTIyOTY0NywwLjI4OTg1MjgwODQ4OTExNywwLjM4NTI2Njk2
> >>> NTM2Mjc2MSwwLjE5NzY0NDgyNDY5NjMyMCwwLjE4MzA0MTMyNDA2MjI5OCwt
> >>> MC4xNDY2MjYzNDcyMTk4NzksMC4xNDYzNTQwMjc3OTcxMDEsLTAuMTMyODg3
> >>> NTk2OTAyNTA2LC0wLjE3Mzk2NTA2OTExMTAyNSwtMC4yNjg0NTkxNjI5MzA1
> >>> NjcsLTAuMDY3ODA5NTM3NTA3NjIyMiwwLjE4MDU0OTkyNTAyNDM3NywtMC4w
> >>> NDIwODQ0MzY0MDM3ODc0LC0wLjA3MzA1Nzc4OTY5MDI5NjcNCiJ0ZWxsZ29v
> >>> ZCIsMC4yOTI3MzYzMjEyMjk2NDcsMC45NTU0OTQyNDYyMTA4NTYsMC43NTc1
> >>> NDQxOTMzMzk1NjYsMC4xOTEyNDExODMyMDMxMjksMC4wMDAxNzQ2MzA0MTc1
> >>> NjQ2ODgsMC4wMDM0MDg4NzExODA3MTI4NywwLjAwOTYzMDUwNDc0MzU4MDM0
> >>> LDAuMDI4Mzg5NDM3MzMxNjY4NCwwLjAxODgwMjc1Mzk0NjMyOTksLTAuMDE1
> >>> NzAyNjM4MTUxNTk4NSwtMC4xNDU3OTUwMDY3NDE4ODQsMC4xNDIwMzQzOTY5
> >>> MDY4NzksMC4wMDk4MTUzODM5ODQzNDg1MSwwLjA3MDU4Njg3NTY1Mzk3MzIs
> >>> MC4xMDgwMDA0NDkzMjgzMTMNCiJ0ZWxsYmVzdCIsMC4yODk4NTI4MDg0ODkx
> >>> MTcsMC43NTc1NDQxOTMzMzk1NjYsMC45NDg1OTM1OTA5MTI0MDgsMC4yMzA1
> >>> OTg5NTg1OTc1MjgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuMDE1NTQ0NzA1NTc4
> >>> MzEyMiwwLjAzMjE2OTMyODE5ODg2NjksMC4wNjQ2MzEyMzI2MTg3MDk2LDAu
> >>> MDEwMjk0NTA4NTY1MTI0NiwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE3ODc2
> >>> NTU2MzM1NDgyOCwwLjE1MTM0MzU2Nzc2MTg1OSwtMC4wMzM2NTU5MDYzMzA3
> >>> ODM1LDAuMDkyOTA2MjI3OTMzNDg5OCwwLjE1OTczNTYxODQyMzMzNQ0KImlt
> >>> cG9ydGFudCIsMC4zODUyNjY5NjUzNjI3NjEsMC4xOTEyNDExODMyMDMxMjks
> >>> MC4yMzA1OTg5NTg1OTc1MjgsMC45NjQ0OTc4ODAzNDM2MSwwLjY0NzY1NzE0
> >>> MTQ4ODM3NSwwLjUxNDE3NTk3NDU1NDExNCwtMC4xOTc1MDY3MDU5MTcxMjMs
> >>> MC40NzQ3MjMzMzI0Njk4NzUsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE4OTIy
> >>> OTEyMzcwNTM0MSwtMC40NjIxOTU4MzkyNjUwMzUsMC4xMjQxNTgzMzk1Mjcz
> >>> MjIsMC4xNjA2NjEzMDc0ODY1NTksLTAuMDg2NDU3MzcyNzQ2NjI2NSwtMC4w
> >>> NjgzNjc0ODQyNDk4ODAxDQoiY29tcGxleCIsMC4xOTc2NDQ4MjQ2OTYzMjAs
> >>> MC4wMDAxNzQ2MzA0MTc1NjQ2ODgsMC4wMzAyNjkyMTA2MTM1NDM5LDAuNjQ3
> >>> NjU3MTQxNDg4Mzc1LDAuOTc2MzIxNjU1NzYyOTY4LDAuNzU0OTc4Nzc3MzA5
> >>> NTUzLC0wLjI2MjM0MDQyNTgyNDA1MiwwLjY1NjcxNzUzMzM2MTE3NiwtMC4x
> >>> NjA0MjcxMzk2NzMwMTgsLTAuMjM2MjEwODU2MDgzOTAyLC0wLjM4NTQ1MjEw
> >>> MDA0NjYyMywwLjAyMzg3NzU3MjgyNzcxNTcsMC4zMjQ1MjU2NTMxNjQ1MDgs
> >>> LTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzMzY5NjU1NDE4OTE2NA0KImRpZmZp
> >>> Y3VsdCIsMC4xODMwNDEzMjQwNjIyOTgsMC4wMDM0MDg4NzExODA3MTI4Nyww
> >>> LjAxNTU0NDcwNTU3ODMxMjIsMC41MTQxNzU5NzQ1NTQxMTQsMC43NTQ5Nzg3
> >>> NzczMDk1NTMsMC45NTczMjQzNDE2NjE5NzIsLTAuMTgzMDA1NTg3NTUxNjI0
> >>> LDAuNTIzMTgzOTkzODk3NjMyLC0wLjE5NzgzMzM1NDQzMDkwNywtMC4yMjg0
> >>> MzQ3MTMwNjE3NzYsLTAuMjYzNTg3NzQ2MDIxMTc0LC0wLjA0NTM5NzEzNzc3
> >>> MDA4NDUsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMjM0NzA3NTE3Njc3NTg2LC0w
> >>> LjIzOTEyNjk3MTQ4MDYyNQ0KIm9ubHlzZWxmIiwtMC4xNDY2MjYzNDcyMTk4
> >>> NzksMC4wMDk2MzA1MDQ3NDM1ODAzNCwwLjAzMjE2OTMyODE5ODg2NjksLTAu
> >>> MTk3NTA2NzA1OTE3MTIzLC0wLjI2MjM0MDQyNTgyNDA1MiwtMC4xODMwMDU1
> >>> ODc1NTE2MjQsMC45NDc4NTI0MTU0NDM2NjMsLTAuMjY4MzMzOTc5Mjk1NjEy
> >>> LDAuMDc4NzE5MTg3OTIxNTY1NCwwLjA4MDA1NTQ0MzA5MzgwMzYsMC4xNjM1
> >>> OTUyNzc0OTg3NTgsLTAuMDA1MDcyNjg2MDg0MTc3MDQsLTAuMTYwMTM3NTQ1
> >>> ODcxNDQ4LDAuMjExMjU3MjUyMjg3OTc5LDAuMTQ3ODg0MzUyNTg4NDk5DQoi
> >>> bWFueWRpbWVuc2lvbnMiLDAuMTQ2MzU0MDI3Nzk3MTAxLDAuMDI4Mzg5NDM3
> >>> MzMxNjY4NCwwLjA2NDYzMTIzMjYxODcwOTYsMC40NzQ3MjMzMzI0Njk4NzUs
> >>> MC42NTY3MTc1MzMzNjExNzYsMC41MjMxODM5OTM4OTc2MzIsLTAuMjY4MzMz
> >>> OTc5Mjk1NjEyLDAuOTQ5OTE3NjYyNjE2MTYsLTAuMTEzMjk1NjY3NDA4MTc3
> >>> LC0wLjE4MTU3NjQ3MzE3MDc4NCwtMC4yNzkyOTg0MTcxNzcyNjEsMC4wNDQy
> >>> NDgxMjM1MDgyNTI4LDAuMjU4MzQ5NzAyNDYwNjYzLC0wLjE5Njk5MzM0NjMz
> >>> NzIxNCwtMC4yMjI1MzM5NTI2MzM0ODINCiJob3dtdWNoaW5mbyIsLTAuMTMy
> >>> ODg3NTk2OTAyNTA2LDAuMDE4ODAyNzUzOTQ2MzI5OSwwLjAxMDI5NDUwODU2
> >>> NTEyNDYsLTAuMTI5MDkxMzI5ODE2MjAxLC0wLjE2MDQyNzEzOTY3MzAxOCwt
> >>> MC4xOTc4MzMzNTQ0MzA5MDcsMC4wNzg3MTkxODc5MjE1NjU0LC0wLjExMzI5
> >>> NTY2NzQwODE3NywwLjk0NjcyMjc0NjEzNzQxNSwwLjcwNjk3NjAxNTU4MjIx
> >>> OCwwLjA5MjMxOTI3MDQ0Mzk5MzQsMC4yMTMwMzIyNDI0NzMzMTUsLTAuMjA5
> >>> ODgyNDMxNzY1MTEwLDAuMjM5MTI0NTUxNjI5NTU5LDAuMjE5MDc4MzUyODkw
> >>> NjU3DQoiZXF1YWxpbmZvIiwtMC4xNzM5NjUwNjkxMTEwMjUsLTAuMDE1NzAy
> >>> NjM4MTUxNTk4NSwtMC4wMTk2NzU5OTk3OTIzMDA5LC0wLjE4OTIyOTEyMzcw
> >>> NTM0MSwtMC4yMzYyMTA4NTYwODM5MDIsLTAuMjI4NDM0NzEzMDYxNzc2LDAu
> >>> MDgwMDU1NDQzMDkzODAzNiwtMC4xODE1NzY0NzMxNzA3ODQsMC43MDY5NzYw
> >>> MTU1ODIyMTgsMC45NjQ1MTc1NjI3NzgzMjgsMC4xODA1MTczMjU3NTIzODcs
> >>> MC4xNjM4NDQ2NDA0OTU5ODMsLTAuMjEzODA0NTUwMDQzMjM5LDAuMjU4MDMy
> >>> MzIyODI0NTk5LDAuMTkxODIwNDQ3NDA0MzM1DQoiY291bGRhdm9pZCIsLTAu
> >>> MjY4NDU5MTYyOTMwNTY3LC0wLjE0NTc5NTAwNjc0MTg4NCwtMC4xNzg3NjU1
> >>> NjMzNTQ4MjgsLTAuNDYyMTk1ODM5MjY1MDM1LC0wLjM4NTQ1MjEwMDA0NjYy
> >>> MywtMC4yNjM1ODc3NDYwMjExNzQsMC4xNjM1OTUyNzc0OTg3NTgsLTAuMjc5
> >>> Mjk4NDE3MTc3MjYxLDAuMDkyMzE5MjcwNDQzOTkzNCwwLjE4MDUxNzMyNTc1
> >>> MjM4NywwLjk2MzIzNzMwOTczMDcyNiwtMC4xMjAxMzAxOTYzOTI0MDYsLTAu
> >>> MDY4OTY1OTY1NzA1NzA5MSwwLjE2NTUzMzIwODc0MzU0NywwLjE5MTQyMTEz
> >>> NDE4OTY4Mg0KInBvc291dGNvbWUiLC0wLjA2NzgwOTUzNzUwNzYyMjIsMC4x
> >>> NDIwMzQzOTY5MDY4NzksMC4xNTEzNDM1Njc3NjE4NTksMC4xMjQxNTgzMzk1
> >>> MjczMjIsMC4wMjM4Nzc1NzI4Mjc3MTU3LC0wLjA0NTM5NzEzNzc3MDA4NDUs
> >>> LTAuMDA1MDcyNjg2MDg0MTc3MDQsMC4wNDQyNDgxMjM1MDgyNTI4LDAuMjEz
> >>> MDMyMjQyNDczMzE1LDAuMTYzODQ0NjQwNDk1OTgzLC0wLjEyMDEzMDE5NjM5
> >>> MjQwNiwwLjkzOTEwNzcxNzE4NjM4NSwtMC4yOTEyNjIzOTE4Mjc2NzEsMC4y
> >>> NTYyNzQxOTU5ODMwMDQsMC4zNDY0NDE0MTExMTYxNDcNCiJuZWdvdXRjb21l
> >>> IiwwLjE4MDU0OTkyNTAyNDM3NywwLjAwOTgxNTM4Mzk4NDM0ODUxLC0wLjAz
> >>> MzY1NTkwNjMzMDc4MzUsMC4xNjA2NjEzMDc0ODY1NTksMC4zMjQ1MjU2NTMx
> >>> NjQ1MDgsMC4zMzAwNzU2NjY1MjY3NjEsLTAuMTYwMTM3NTQ1ODcxNDQ4LDAu
> >>> MjU4MzQ5NzAyNDYwNjYzLC0wLjIwOTg4MjQzMTc2NTExMCwtMC4yMTM4MDQ1
> >>> NTAwNDMyMzksLTAuMDY4OTY1OTY1NzA1NzA5MSwtMC4yOTEyNjIzOTE4Mjc2
> >>> NzEsMC45NTI1NTI5NjU3OTY0MjEsLTAuMjIxOTE3MjIyOTMwMTksLTAuMjMx
> >>> MDMyMDE0OTI3Mzk3DQoiY29udHJvbCIsLTAuMDQyMDg0NDM2NDAzNzg3NCww
> >>> LjA3MDU4Njg3NTY1Mzk3MzIsMC4wOTI5MDYyMjc5MzM0ODk4LC0wLjA4NjQ1
> >>> NzM3Mjc0NjYyNjUsLTAuMjQwNjM0ODA0ODg3MDU1LC0wLjIzNDcwNzUxNzY3
> >>> NzU4NiwwLjIxMTI1NzI1MjI4Nzk3OSwtMC4xOTY5OTMzNDYzMzcyMTQsMC4y
> >>> MzkxMjQ1NTE2Mjk1NTksMC4yNTgwMzIzMjI4MjQ1OTksMC4xNjU1MzMyMDg3
> >>> NDM1NDcsMC4yNTYyNzQxOTU5ODMwMDQsLTAuMjIxOTE3MjIyOTMwMTksMC45
> >>> Mzc2MDc1MzMxODY1NzYsMC4zMTI2NjQxOTk2MzE2MjANCiJkZXNpcmVkIiwt
> >>> MC4wNzMwNTc3ODk2OTAyOTY3LDAuMTA4MDAwNDQ5MzI4MzEzLDAuMTU5NzM1
> >>> NjE4NDIzMzM1LC0wLjA2ODM2NzQ4NDI0OTg4MDEsLTAuMjMzNjk2NTU0MTg5
> >>> MTY0LC0wLjIzOTEyNjk3MTQ4MDYyNSwwLjE0Nzg4NDM1MjU4ODQ5OSwtMC4y
> >>> MjI1MzM5NTI2MzM0ODIsMC4yMTkwNzgzNTI4OTA2NTcsMC4xOTE4MjA0NDc0
> >>> MDQzMzUsMC4xOTE0MjExMzQxODk2ODIsMC4zNDY0NDE0MTExMTYxNDcsLTAu
> >>> MjMxMDMyMDE0OTI3Mzk3LDAuMzEyNjY0MTk5NjMxNjIwLDAuOTYzMTMxNjM5
> >>> NTYwMTA4DQo=3D
> >>>
> >>> --1660387551-1458482416-1249639718=3D:2997--
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>
> >>
> >>
> >> --=20
> >> Jeffrey Ryan
> >> jeffrey.ryan at insightalgo.com
> >>
> >> ia: insight algorithmics
> >> www.insightalgo.com
> >>
> > 
> > CSV:
> > 
> > 
> "","wasrightchoice","tellgood","tellbest","important","complex
> ","difficult"=
> > 
> ,"onlyself","manydimensions","howmuchinfo","equalinfo","coulda
> void","posout=
> > come","negoutcome","control","desired"
> > 
> "wasrightchoice",0.96369773178963,0.292736321229647,0.28985280
> 8489117,0.385=
> > 
> 266965362761,0.197644824696320,0.183041324062298,-0.1466263472
> 19879,0.14635=
> > 
> 4027797101,-0.132887596902506,-0.173965069111025,-0.2684591629
> 30567,-0.0678=
> > 
> 095375076222,0.180549925024377,-0.0420844364037874,-0.0730577896902967
> > 
> "tellgood",0.292736321229647,0.955494246210856,0.7575441933395
> 66,0.19124118=
> > 
> 3203129,0.000174630417564688,0.00340887118071287,0.00963050474
> 358034,0.0283=
> > 
> 894373316684,0.0188027539463299,-0.0157026381515985,-0.1457950
> 06741884,0.14=
> > 
> 2034396906879,0.00981538398434851,0.0705868756539732,0.108000449328313
> > 
> "tellbest",0.289852808489117,0.757544193339566,0.9485935909124
> 08,0.23059895=
> > 
> 8597528,0.0302692106135439,0.0155447055783122,0.03216932819886
> 69,0.06463123=
> > 
> 26187096,0.0102945085651246,-0.0196759997923009,-0.17876556335
> 4828,0.151343=
> > 567761859,-0.0336559063307835,0.0929062279334898,0.159735618423335
> > 
> "important",0.385266965362761,0.191241183203129,0.230598958597
> 528,0.9644978=
> > 
> 8034361,0.647657141488375,0.514175974554114,-0.197506705917123
> ,0.4747233324=
> > 
> 69875,-0.129091329816201,-0.189229123705341,-0.462195839265035
> ,0.1241583395=
> > 27322,0.160661307486559,-0.0864573727466265,-0.0683674842498801
> > 
> "complex",0.197644824696320,0.000174630417564688,0.03026921061
> 35439,0.64765=
> > 
> 7141488375,0.976321655762968,0.754978777309553,-0.262340425824
> 052,0.6567175=
> > 
> 33361176,-0.160427139673018,-0.236210856083902,-0.385452100046
> 623,0.0238775=
> > 728277157,0.324525653164508,-0.240634804887055,-0.233696554189164
> > 
> "difficult",0.183041324062298,0.00340887118071287,0.0155447055
> 783122,0.5141=
> > 
> 75974554114,0.754978777309553,0.957324341661972,-0.18300558755
> 1624,0.523183=
> > 
> 993897632,-0.197833354430907,-0.228434713061776,-0.26358774602
> 1174,-0.04539=
> > 71377700845,0.330075666526761,-0.234707517677586,-0.239126971480625
> > 
> "onlyself",-0.146626347219879,0.00963050474358034,0.0321693281
> 988669,-0.197=
> > 
> 506705917123,-0.262340425824052,-0.183005587551624,0.947852415
> 443663,-0.268=
> > 
> 333979295612,0.0787191879215654,0.0800554430938036,0.163595277
> 498758,-0.005=
> > 
> 07268608417704,-0.160137545871448,0.211257252287979,0.147884352588499
> > 
> "manydimensions",0.146354027797101,0.0283894373316684,0.064631
> 2326187096,0.=
> > 
> 474723332469875,0.656717533361176,0.523183993897632,-0.2683339
> 79295612,0.94=
> > 
> 991766261616,-0.113295667408177,-0.181576473170784,-0.27929841
> 7177261,0.044=
> > 
> 2481235082528,0.258349702460663,-0.196993346337214,-0.222533952633482
> > 
> "howmuchinfo",-0.132887596902506,0.0188027539463299,0.01029450
> 85651246,-0.1=
> > 
> 29091329816201,-0.160427139673018,-0.197833354430907,0.0787191
> 879215654,-0.=
> > 
> 113295667408177,0.946722746137415,0.706976015582218,0.09231927
> 04439934,0.21=
> > 3032242473315,-0.209882431765110,0.239124551629559,0.219078352890657
> > 
> "equalinfo",-0.173965069111025,-0.0157026381515985,-0.01967599
> 97923009,-0.1=
> > 
> 89229123705341,-0.236210856083902,-0.228434713061776,0.0800554
> 430938036,-0.=
> > 
> 181576473170784,0.706976015582218,0.964517562778328,0.18051732
> 5752387,0.163=
> > 844640495983,-0.213804550043239,0.258032322824599,0.191820447404335
> > 
> "couldavoid",-0.268459162930567,-0.145795006741884,-0.17876556
> 3354828,-0.46=
> > 
> 2195839265035,-0.385452100046623,-0.263587746021174,0.16359527
> 7498758,-0.27=
> > 
> 9298417177261,0.0923192704439934,0.180517325752387,0.963237309
> 730726,-0.120=
> > 130196392406,-0.0689659657057091,0.165533208743547,0.191421134189682
> > 
> "posoutcome",-0.0678095375076222,0.142034396906879,0.151343567
> 761859,0.1241=
> > 
> 58339527322,0.0238775728277157,-0.0453971377700845,-0.00507268
> 608417704,0.0=
> > 
> 442481235082528,0.213032242473315,0.163844640495983,-0.1201301
> 96392406,0.93=
> > 9107717186385,-0.291262391827671,0.256274195983004,0.346441411116147
> > 
> "negoutcome",0.180549925024377,0.00981538398434851,-0.03365590
> 63307835,0.16=
> > 
> 0661307486559,0.324525653164508,0.330075666526761,-0.160137545
> 871448,0.2583=
> > 
> 49702460663,-0.209882431765110,-0.213804550043239,-0.068965965
> 7057091,-0.29=
> > 1262391827671,0.952552965796421,-0.22191722293019,-0.231032014927397
> > 
> "control",-0.0420844364037874,0.0705868756539732,0.09290622793
> 34898,-0.0864=
> > 
> 573727466265,-0.240634804887055,-0.234707517677586,0.211257252
> 287979,-0.196=
> > 
> 993346337214,0.239124551629559,0.258032322824599,0.16553320874
> 3547,0.256274=
> > 195983004,-0.22191722293019,0.937607533186576,0.312664199631620
> > 
> "desired",-0.0730577896902967,0.108000449328313,0.159735618423
> 335,-0.068367=
> > 
> 4842498801,-0.233696554189164,-0.239126971480625,0.14788435258
> 8499,-0.22253=
> > 
> 3952633482,0.219078352890657,0.191820447404335,0.1914211341896
> 82,0.34644141=
> > 1116147,-0.231032014927397,0.312664199631620,0.963131639560108
> > 
> > RAM:
> > 
> > important <-- challenge, NA, 1
> > complex  <-- challenge, c.complex, NA
> > difficult <-- challenge, c.difficult, NA
> > manydimensions <-- challenge, c.manydimensions, NA
> > couldavoid <-- challenge, c.couldavoid, NA
> > onlyself <-- challenge, c.onlyself, NA
> > 
> > wasrightchoice <-- eval, NA, 1
> > tellgood <-- eval, e.tellgood, NA
> > tellbest <-- eval, e.tellbest, NA
> > negoutcome <-- eval, e.negoutcome, NA
> > 
> > equalinfo <-- informed, NA, 1
> > control <-- informed, i.control, NA
> > desired <-- informed, i.desired, NA
> > howmuchinfo <-- informed, i.howmuchinfo, NA
> > posoutcome <-- informed, i.posoutcome, NA
> > 
> > wasrightchoice <-> wasrightchoice, wasrightchoiceV, NA
> > tellgood <-> tellgood, tellgoodV, NA
> > tellbest <-> tellbest, tellbestV, NA
> > negoutcome <-> negoutcome, negoutcomeV, NA
> > 
> > onlyself <-> onlyself, onlyselfV, NA
> > important <-> important, importantV, NA
> > complex <-> complex, complexV, NA
> > difficult <-> difficult, difficultV, NA
> > manydimensions <-> manydimensions, manydimensionsV, NA
> > couldavoid <-> couldavoid, couldavoidV, NA
> > 
> > equalinfo <-> equalinfo, equalinfoV, NA
> > control <-> control, controlV, NA
> > desired <-> desired, desiredV, NA
> > howmuchinfo <-> howmuchinfo, howmuchinfoV, NA
> > posoutcome <-> posoutcome, posoutcomeV, NA
> > 
> > eval <-> eval, evalV, NA
> > challenge <-> challenge, challengeV, NA
> > informed <-> informed, informedV, NA
> > --1660387551-150661043-1249684349=:2997--
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
> > 
> 
> -- 
> View this message in context: 
> http://www.nabble.com/Re%3A-Bug-in-nlm%2C-found-using-sem--fai
> lure-in-several-flavors-%28PR-13883%29-tp24875708p24906063.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From p.dalgaard at biostat.ku.dk  Tue Aug 11 00:17:34 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 11 Aug 2009 00:17:34 +0200
Subject: [Rd] Bug in nlm, found using sem;
 failure in several flavors (PR#13883)
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D70001A18B3C@NA-PA-VBE03.na.tibco.com>
References: <20090807223514.7C78E282EF4C@mail.pubhealth.ku.dk>	<24906063.post@talk.nabble.com>
	<77EB52C6DD32BA4D87471DCD70C8D70001A18B3C@NA-PA-VBE03.na.tibco.com>
Message-ID: <4A809C7E.5030509@biostat.ku.dk>

William Dunlap wrote:
>> From: r-devel-bounces at r-project.org 
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Ben Bolker
>> Sent: Monday, August 10, 2009 12:52 PM
>> To: r-devel at r-project.org
>> Subject: Re: [Rd] Bug in nlm, found using sem; failure in 
>> several flavors (PR#13883)
>>
>>
>>
>>    A wild guess, based on some recent "non-deterministic" behavior in
>> lme4: could this be driven by a bug in optimized linear 
>> algebra libraries
>> (BLAS/LAPACK)?  (Unfortunately, I'm not clear on how to check 
>> the versions
>> of BLAS/LAPACK being used and whether they are subject to bugs,
>> but perhaps someone else can comment ...)
>>
>>    Ben Bolker
>>
> 
> Running his example under valgrind (a memory misuse checker on Linux)
> does show it using memory it should not be using in the optimization C
> code
> around where it is copying the gradient vector.  The 
> 
> ==10916== Invalid read of size 1
> ==10916==    at 0x400686D: memcpy (mc_replace_strmem.c:406)
> ==10916==    by 0x8072BC1: FT_store (optimize.c:319)
> ==10916==    by 0x8072F92: fcn (optimize.c:408)
...

Mmmm... This comes from this code inside fcn()

     if (state->have_gradient) {
         g = REAL(coerceVector(getAttrib(s, install("gradient")),
                  REALSXP));
         if (state->have_hessian) {
             h = REAL(coerceVector(getAttrib(s, install("hessian")),
                                   REALSXP));
         }
     }
     FT_store(n, *f, x, g, h, state);

I suppose that if the function being optimized returns a value that has 
a "gradient" attribute, then that is being used. It is coerced to 
double; but otherwise, no questions asked.

I wonder if it would not be a good idea to at least check that 
getAttrib(....) returns something of the right length.



-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From felix at nfrac.org  Tue Aug 11 01:31:36 2009
From: felix at nfrac.org (Felix Andrews)
Date: Tue, 11 Aug 2009 09:31:36 +1000
Subject: [Rd] model.matrix evaluation challenges
In-Reply-To: <4A7F6A15.7090102@ufl.edu>
References: <4A7F6A15.7090102@ufl.edu>
Message-ID: <94730b8a0908101631r95dc903lcfd7031e5f6f3d21@mail.gmail.com>

how about...

nrow(with(cc, model.matrix(params, data=environment())))

cheers
-Felix

2009/8/10 Ben Bolker <bolker at ufl.edu>:
> ?I am having difficulty with evaluation/environment construction
> for a formula to be evaluated by model.matrix(). ?Basically, I
> want to construct a model matrix that first looks in "newdata"
> for the values of the model parameters, then in "object at data".
> Here's what I've tried:
>
> ?1. model.matrix(~f,data=c(newdata,object at data)) -- fails because
> something (terms()?) within model.matrix() tries to coerce "data"
> to a data frame -- but newdata and object at data have different
> numbers of rows.
>
> ?2. with(c(newdata,object at data),model.matrix(~f)) ? works --
> BUT not when ~f is assigned to another object (as it will be
> when it is being dug out of a previously fit model).
>
> ?3. If "f" exists as a column within newdata and/or object at data,
> but the formula is assigned to another object (see below), then
> with(c(newdata,object at data),model.matrix(z)) ?fails -- because
> model.matrix() is explicitly evaluating the variables in the formula
> in the environment of z (i.e., ignoring the first argument of "with" ...)
>
>
> ?Any advice on how to solve this without making a bigger mess?
>
> ?sincerely
> ? ?Ben Bolker
>
>
> ## set up a data frame for prediction
>
> set.seed(1001)
> f = factor(rep(letters[1:4],each=20))
> x = runif(80)
> u = rnorm(4)
> y = rnorm(80,mean=2+x*(3+u[f]),sd=0.1)
> dat = data.frame(f,x,y)
>
> ## fit a model ... could easily do by lm() but want to
> ## ? demonstrate the problem
>
> library(bbmle)
> m1 = mle2(y~dnorm(a+b*x,sd=exp(logs)),parameters=list(b~f),data=dat,
> ?start=list(a=0,b=2,logs=-3))
>
> ## data frame for prediction
> pp0 = expand.grid(x=seq(0,1,length=11),
> ?f=levels(dat$f))
>
> ## combine frame and model data: have to keep the model data
> ## ?around, because it contain other information needed for
> ## ?prediction.
>
> cc = c(pp0,m1 at data)
> try(mm <- model.matrix(~f,cc)) ?## fails -- different number of rows
> ?## (at some point R tries to coerce cc to a data frame)
> nrow(with(cc,model.matrix(~f))) ## works ... but ...
>
> ## here's what happens within predict.mle2()
> ## extract information about parameter models
> params <- eval(m1 at call$parameters)
> params <- params[[1]]
> params[[2]] <- NULL
>
> nrow(with(cc,model.matrix(params)))
> rm(f)
> ## object "f" not found -- because model.matrix
> ## ?evaluates in the parent environment of params ...
> try(nrow(with(cc,model.matrix(params))))
>
>
>
> --
> Ben Bolker
> Associate professor, Biology Dep't, Univ. of Florida
> bolker at ufl.edu / www.zoology.ufl.edu/bolker
> GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



-- 
Felix Andrews / ???
Postdoctoral Fellow
Integrated Catchment Assessment and Management (iCAM) Centre
Fenner School of Environment and Society [Bldg 48a]
The Australian National University
Canberra ACT 0200 Australia
M: +61 410 400 963
T: + 61 2 6125 1670
E: felix.andrews at anu.edu.au
CRICOS Provider No. 00120C
-- 
http://www.neurofractal.org/felix/


From maechler at stat.math.ethz.ch  Tue Aug 11 10:04:20 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 11 Aug 2009 10:04:20 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <4A804219.3080803@stats.uwo.ca>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>
	<4A7D8E08.2070300@uottawa.ca> <20090810092141.GC10119@cs.cas.cz>
	<4A7FECCD.2010208@stats.uwo.ca>
	<353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
	<4A802CB7.3030806@stats.uwo.ca> <4A804219.3080803@stats.uwo.ca>
Message-ID: <19073.9732.319993.862295@lynne.math.ethz.ch>

>>>>> "DM" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>     on Mon, 10 Aug 2009 11:51:53 -0400 writes:

    DM> For people who want to play with these, here are some functions that let 
    DM> you get or set the "payload" value in a NaN.  NaN and NA, Inf and -Inf 
    DM> are stored quite similarly; these functions don't distinguish which of 
    DM> those you're working with.  Regular finite values give NA for the 
    DM> payload value, and elements of x are unchanged if you try to set their 
    DM> payload to NA.

    DM> By the way, this also shows that R *can* distinguish different NaN 
    DM> values, but you need some byte-level manipulations.

yes;  very nice code, indeed!

I propose a version of the  showBytes()  utility should be added 
either as an example e.g. in  writeBin() or even an exported
function in package 'utils'

 [.........]

    > Example:

    >> x <- c(NA, NaN, 0, 1, Inf)
    >> NaNpayload(x)
    > [1]  0.5 -0.5   NA   NA  0.0

Interestingly, on 64-bit, I get a slightly different answer above, 
(when all the following code gives exactly the same results,
 and of course, that was your main point !), namely
4.338752e-13 instead of 0.5  for 'NA', 
see below.

.. and your nice tools also let me detect an even simpler way
to get *two* versions of NA, and NaN, each :  
Conclusion:  Both  NaN  and  NA (well NA_real_) have a sign, too !

NaNpayload(NA_real_)
##[1] 4.338752e-13
NaNpayload(-NA_real_)
##[1] -4.338752e-13   ## !! different

str(NApm <- c(1[2], -1[2]))
t(sapply(NApm, showBytes))
## [1,]   a2   07   00   00   00   00   f0*   7f
## [2,]   a2   07   00   00   00   00   f0*   ff

## or summarizing things :

## Or, "in summary" -- Duncan's original example slightly extended:
x <- c(NaN, -NaN, NA, -NA_real_, 0, 0.1, Inf, -Inf)
x
names(x) <- format(x)
sapply(x, showBytes)
##       NaN  NaN   NA   NA  0.0  0.1  Inf -Inf
## [1,]   00   00   a2   a2   00   9a   00   00
## [2,]   00   00   07   07   00   99   00   00
## [3,]   00   00   00   00   00   99   00   00
## [4,]   00   00   00   00   00   99   00   00
## [5,]   00   00   00   00   00   99   00   00
## [6,]   00   00   00   00   00   99   00   00
## [7,]   f8   f8   f8*  f8*  00   b9   f0   f0
## [8,]   ff   7f   7f   ff   00   3f   7f   ff

## (*) NOTE: the  'f0*' or 'f8*' above  are
## ---       'f8' on 32-bit,  'f0' on 64-bit



    >> NaNpayload(x) <- -0.4
    >> x
    > [1] NaN NaN NaN NaN NaN
    >> y <- x
    >> NaNpayload(y) <- 0.6
    >> y
    > [1] NaN NaN NaN NaN NaN
    >> NaNpayload(x)
    > [1] -0.4 -0.4 -0.4 -0.4 -0.4
    >> NaNpayload(y)
    > [1] 0.6 0.6 0.6 0.6 0.6
    >> identical(x, y)
    > [1] TRUE

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From savicky at cs.cas.cz  Tue Aug 11 12:02:01 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Tue, 11 Aug 2009 12:02:01 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <19073.9732.319993.862295@lynne.math.ethz.ch>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>
	<4A7D8E08.2070300@uottawa.ca> <20090810092141.GC10119@cs.cas.cz>
	<4A7FECCD.2010208@stats.uwo.ca>
	<353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
	<4A802CB7.3030806@stats.uwo.ca> <4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch>
Message-ID: <20090811100201.GA19381@cs.cas.cz>

On Tue, Aug 11, 2009 at 10:04:20AM +0200, Martin Maechler wrote:
> >>>>> "DM" == Duncan Murdoch <murdoch at stats.uwo.ca>
> >>>>>     on Mon, 10 Aug 2009 11:51:53 -0400 writes:
> 
>     DM> For people who want to play with these, here are some functions that let 
>     DM> you get or set the "payload" value in a NaN.  NaN and NA, Inf and -Inf 
>     DM> are stored quite similarly; these functions don't distinguish which of 
>     DM> those you're working with.  Regular finite values give NA for the 
>     DM> payload value, and elements of x are unchanged if you try to set their 
>     DM> payload to NA.
> 
>     DM> By the way, this also shows that R *can* distinguish different NaN 
>     DM> values, but you need some byte-level manipulations.
> 
> yes;  very nice code, indeed!
> 
> I propose a version of the  showBytes()  utility should be added 
> either as an example e.g. in  writeBin() or even an exported
> function in package 'utils'
> 
>  [.........]
> 
>     > Example:
> 
>     >> x <- c(NA, NaN, 0, 1, Inf)
>     >> NaNpayload(x)
>     > [1]  0.5 -0.5   NA   NA  0.0
> 
> Interestingly, on 64-bit, I get a slightly different answer above, 
> (when all the following code gives exactly the same results,
>  and of course, that was your main point !), namely
> 4.338752e-13 instead of 0.5  for 'NA', 
> see below.
> 
> .. and your nice tools also let me detect an even simpler way
> to get *two* versions of NA, and NaN, each :  
> Conclusion:  Both  NaN  and  NA (well NA_real_) have a sign, too !
> 
> NaNpayload(NA_real_)
> ##[1] 4.338752e-13
> NaNpayload(-NA_real_)
> ##[1] -4.338752e-13   ## !! different
> 
> str(NApm <- c(1[2], -1[2]))
> t(sapply(NApm, showBytes))
> ## [1,]   a2   07   00   00   00   00   f0*   7f
> ## [2,]   a2   07   00   00   00   00   f0*   ff
> 
> ## or summarizing things :
> 
> ## Or, "in summary" -- Duncan's original example slightly extended:
> x <- c(NaN, -NaN, NA, -NA_real_, 0, 0.1, Inf, -Inf)
> x
> names(x) <- format(x)
> sapply(x, showBytes)
> ##       NaN  NaN   NA   NA  0.0  0.1  Inf -Inf
> ## [1,]   00   00   a2   a2   00   9a   00   00
> ## [2,]   00   00   07   07   00   99   00   00
> ## [3,]   00   00   00   00   00   99   00   00
> ## [4,]   00   00   00   00   00   99   00   00
> ## [5,]   00   00   00   00   00   99   00   00
> ## [6,]   00   00   00   00   00   99   00   00
> ## [7,]   f8   f8   f8*  f8*  00   b9   f0   f0
> ## [8,]   ff   7f   7f   ff   00   3f   7f   ff
> 
> ## (*) NOTE: the  'f0*' or 'f8*' above  are
> ## ---       'f8' on 32-bit,  'f0' on 64-bit
> 
> 
> 
>     >> NaNpayload(x) <- -0.4
>     >> x
>     > [1] NaN NaN NaN NaN NaN
>     >> y <- x
>     >> NaNpayload(y) <- 0.6
>     >> y
>     > [1] NaN NaN NaN NaN NaN
>     >> NaNpayload(x)
>     > [1] -0.4 -0.4 -0.4 -0.4 -0.4
>     >> NaNpayload(y)
>     > [1] 0.6 0.6 0.6 0.6 0.6
>     >> identical(x, y)
>     > [1] TRUE
> 

The above examples convince me that the default behavior of identical()
should not be based on bit patterns, since the differences between 
different NaN's or even different NA's are irrelevant except if we
use the bit manipulations explicitly.

Let me suggest the following short description in ?identical

  The safe and reliable way to test two objects for being equal in
  structure, types of components and their values. It returns 'TRUE' in
  this case, 'FALSE' in every other case.

and replacing the paragraph

   'identical' sees 'NaN' as different from 'NA_real_', but all
   'NaN's are equal (and all 'NA' of the same type are equal).

in ?identical by

  Comparison of objects of numeric type uses '==' for comparison of their
  components. This means that the values of the components rather
  than their machine representation is compared. In particular,
  '0' and '-0' are considered equal, all 'NA's of the same type are
  equal and all 'NaN's are equal, although their bit patterns may 
  differ in some cases. 'NA' and 'NaN' are always different. Note 
  also that 1/0 and 1/(-0) are different.

Petr.


From bolker at ufl.edu  Tue Aug 11 16:22:31 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 11 Aug 2009 10:22:31 -0400
Subject: [Rd] model.matrix evaluation challenges
In-Reply-To: <94730b8a0908101631r95dc903lcfd7031e5f6f3d21@mail.gmail.com>
References: <4A7F6A15.7090102@ufl.edu>
	<94730b8a0908101631r95dc903lcfd7031e5f6f3d21@mail.gmail.com>
Message-ID: <4A817EA7.5000903@ufl.edu>

  that seems to work, thank you.
  would anyone care to explain *why* it works ... ? or where
I could go to read more about why it works ... ?

  cheers
    Ben Bolker


Felix Andrews wrote:
> how about...
> 
> nrow(with(cc, model.matrix(params, data=environment())))
> 
> cheers
> -Felix
> 
> 2009/8/10 Ben Bolker <bolker at ufl.edu>:
>>  I am having difficulty with evaluation/environment construction
>> for a formula to be evaluated by model.matrix().  Basically, I
>> want to construct a model matrix that first looks in "newdata"
>> for the values of the model parameters, then in "object at data".
>> Here's what I've tried:
>>
>>  1. model.matrix(~f,data=c(newdata,object at data)) -- fails because
>> something (terms()?) within model.matrix() tries to coerce "data"
>> to a data frame -- but newdata and object at data have different
>> numbers of rows.
>>
>>  2. with(c(newdata,object at data),model.matrix(~f))   works --
>> BUT not when ~f is assigned to another object (as it will be
>> when it is being dug out of a previously fit model).
>>
>>  3. If "f" exists as a column within newdata and/or object at data,
>> but the formula is assigned to another object (see below), then
>> with(c(newdata,object at data),model.matrix(z))  fails -- because
>> model.matrix() is explicitly evaluating the variables in the formula
>> in the environment of z (i.e., ignoring the first argument of "with" ...)
>>
>>
>>  Any advice on how to solve this without making a bigger mess?
>>
>>  sincerely
>>    Ben Bolker
>>
>>
>> ## set up a data frame for prediction
>>
>> set.seed(1001)
>> f = factor(rep(letters[1:4],each=20))
>> x = runif(80)
>> u = rnorm(4)
>> y = rnorm(80,mean=2+x*(3+u[f]),sd=0.1)
>> dat = data.frame(f,x,y)
>>
>> ## fit a model ... could easily do by lm() but want to
>> ##   demonstrate the problem
>>
>> library(bbmle)
>> m1 = mle2(y~dnorm(a+b*x,sd=exp(logs)),parameters=list(b~f),data=dat,
>>  start=list(a=0,b=2,logs=-3))
>>
>> ## data frame for prediction
>> pp0 = expand.grid(x=seq(0,1,length=11),
>>  f=levels(dat$f))
>>
>> ## combine frame and model data: have to keep the model data
>> ##  around, because it contain other information needed for
>> ##  prediction.
>>
>> cc = c(pp0,m1 at data)
>> try(mm <- model.matrix(~f,cc))  ## fails -- different number of rows
>>  ## (at some point R tries to coerce cc to a data frame)
>> nrow(with(cc,model.matrix(~f))) ## works ... but ...
>>
>> ## here's what happens within predict.mle2()
>> ## extract information about parameter models
>> params <- eval(m1 at call$parameters)
>> params <- params[[1]]
>> params[[2]] <- NULL
>>
>> nrow(with(cc,model.matrix(params)))
>> rm(f)
>> ## object "f" not found -- because model.matrix
>> ##  evaluates in the parent environment of params ...
>> try(nrow(with(cc,model.matrix(params))))
>>
>>
>>
>> --
>> Ben Bolker
>> Associate professor, Biology Dep't, Univ. of Florida
>> bolker at ufl.edu / www.zoology.ufl.edu/bolker
>> GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
> 
> 


-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
bolker at ufl.edu / www.zoology.ufl.edu/bolker
GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090811/5705b1d1/attachment.bin>

From asr at ufl.edu  Tue Aug 11 17:28:56 2009
From: asr at ufl.edu (Allen S. Rout)
Date: Tue, 11 Aug 2009 11:28:56 -0400
Subject: [Rd] FIFO on windows, redux
Message-ID: <44wpf1vnifjyf.fsf@crepe.osg.ufl.edu>


Are FIFOs supported in modern windowsen?  The help() for connections
that discusses fifos suggests that they are not 

>  (They do work on most Unix platforms, and all but 'fifo' on
>  Windows.)

and that they are

> On platforms where 'vsnprintf' does not return the needed length of
> output (e.g., Windows) there is a 100,000 character output limit on
> the length of line for 'fifo', 'gzfile' and 'bzfile' connections:
> longer lines will be truncated with a warning.


and the discussions about FIFO support I've found online talk about
support existing on "NT descendants" but not '98 or ME.

http://article.gmane.org/gmane.comp.lang.r.devel/4458/match=fifo+windows




My apologies for not just installing a windows box and trying it; I
don't own any licenses at the moment, and I kind of like it that
way. :)

It seemed like a doc clarification was in order, whichever way it went. 


- Allen S. Rout


From lgautier at gmail.com  Sun Aug  9 21:45:07 2009
From: lgautier at gmail.com (laurent)
Date: Sun, 09 Aug 2009 21:45:07 +0200
Subject: [Rd] Why is strptime always returning a vector of length 9 ?
In-Reply-To: <e8e755250908090945v55c10432xda597826452b301f@mail.gmail.com>
References: <1249827638.4877.15.camel@hot-spring>
	<971536df0908090835i3b6048a5h961920de644278cb@mail.gmail.com>
	<e8e755250908090945v55c10432xda597826452b301f@mail.gmail.com>
Message-ID: <1249847107.6040.23.camel@hot-spring>

Thanks.

It seems that the source of my confusion comes from using first using
str() (and then once on the wrong track, it is easier to miss the
information a man page that also describes POSIXct that is itself a
vector of length equal to the number of entries it contains).

With the current example:
> str(xd)
 POSIXlt[1:9], format: "2007-03-09" "2007-05-31" "2008-11-12"
"2008-11-12" ...

A quick inspection of the output does indicate a something with nine
elements, but the elements appear to be "2007-03-09", "2007-05-31",
etc... possibly creating confusion.

To make it even more confusing I have:
> x[1]
[1] "March 09, 2007"
> str(x[1])
 chr "March 09, 2007"

For what it is worth, I think that the behavior of the extract operator
"[" (defined as a S3 method "[.POSIXlt()") is inconsistent with the
output of length() (default method for lists).


L.




On Sun, 2009-08-09 at 11:45 -0500, Jeff Ryan wrote:
> The reason is in the ?strptime under value:
> 
> 'strptime' turns character representations into an object of class
>      '"POSIXlt"'.  The timezone is used to set the 'isdst' component
>      and to set the '"tzone"' attribute if 'tz != ""'.
> 
> And POSIXlt is a list of length 9.
> 
> 
> HTH
> Jeff
> 
> On Sun, Aug 9, 2009 at 10:35 AM, Gabor
> Grothendieck<ggrothendieck at gmail.com> wrote:
> > Try this to see its components:
> >
> >> str(unclass(xd))
> > List of 9
> >  $ sec  : num [1:6] 0 0 0 0 0 0
> >  $ min  : int [1:6] 0 0 0 0 0 0
> >  $ hour : int [1:6] 0 0 0 0 0 0
> >  $ mday : int [1:6] 9 31 12 12 30 30
> >  $ mon  : int [1:6] 2 4 10 10 6 6
> >  $ year : int [1:6] 107 107 108 108 109 109
> >  $ wday : int [1:6] 5 4 3 3 4 4
> >  $ yday : int [1:6] 67 150 316 316 210 210
> >  $ isdst: int [1:6] 0 1 0 0 1 1
> >
> > and read R News 4/1 for more.
> >
> > On Sun, Aug 9, 2009 at 10:20 AM, laurent<lgautier at gmail.com> wrote:
> >> Dear List,
> >>
> >>
> >> I am having an issue with strptime (see below).
> >> I can reproduce it on R-2.8, R-2.9, and R-2.10-dev, I tempted to see
> >> either a bug or my misunderstanding (and then I just don't currently see
> >> where).
> >>
> >> # setup:
> >> x <- c("March 09, 2007", "May 31, 2007", "November 12, 2008", "November
> >> 12, 2008", "July 30, 2009", "July 30, 2009" )
> >>
> >> # showing the problem
> >>> length(x)
> >> 6
> >>> xd <- strptime(x, format = "%B %d, %Y")
> >>> length(xd)
> >> 9
> >>> xd[1:9]
> >> [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
> >> [6] "2009-07-30" NA           NA           NA
> >>> length(strptime(rep(x, 2), format="%B %d, %Y"))
> >> [1] 9
> >>> strptime(rep(x, 2), format="%B %d, %Y")[1:12]
> >>  [1] "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12" "2009-07-30"
> >>  [6] "2009-07-30" "2007-03-09" "2007-05-31" "2008-11-12" "2008-11-12"
> >> [11] "2009-07-30" "2009-07-30
> >>
> >> Any pointer would be appreciated.
> >>
> >>
> >>
> >> L.
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> 
>


From osklyar at maninvestments.com  Tue Aug 11 18:49:45 2009
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 11 Aug 2009 17:49:45 +0100
Subject: [Rd] Changing the compiler gfortran to ifort
In-Reply-To: <813414.13125.qm@web59716.mail.ac4.yahoo.com>
References: <813414.13125.qm@web59716.mail.ac4.yahoo.com>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43047DFB6D@mildnpexmb01.maninvestments.ad.man.com>

on Unix alikes possibly:

env F77=/path/to/ifort ./configure --prefix=/where/to/install

Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Fabio 
> Mathias Corr?a
> Sent: 07 August 2009 14:44
> To: r-devel at r-project.org
> Subject: [Rd] Changing the compiler gfortran to ifort
> 
> I tried the manual R Installation and Administration to 
> change the gcc compiler to icc and ifort for gfotran. However 
> I could not find the correct path for the R to identify the 
> icc and ifort.
> In which file I define the change of compiler?
> 
> Thanks very much!!!
> 
>        ? F?bio Mathias Corr?a
> Estat?stica e Experimenta??o Agropecu?ria/UFLA
>                 Brazil
> 
> 
>       
> ______________________________________________________________
> ______________________
> Veja quais s?o os assuntos do momento no Yahoo! +Buscados
> http://br.maisbuscados.yahoo.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

**********************************************************************
 Please consider the environment before printing this email or its attachments.
The contents of this email are for the named addressees ...{{dropped:19}}


From jon.clayden at gmail.com  Tue Aug 11 18:51:46 2009
From: jon.clayden at gmail.com (Jon Clayden)
Date: Tue, 11 Aug 2009 17:51:46 +0100
Subject: [Rd] readBin() arg check has unnecessary overhead (patch included)
Message-ID: <68e086180908110951j2f684448jbb31707b8e02ad0f@mail.gmail.com>

Dear all,

The version of readBin() in R-devel includes a use of match(), through
`%in%`, which can affect its performance significantly. By using
primitives instead of the rather expensive call to match(), I reduce
the time spent inside readBin() by more than 30% in some of my code
(part of the tractor.base package). A simple patch that does this is
given below. This passes "make check-devel" fine, and I don't see that
it could produce unexpected behaviour -- though I may, of course, be
wrong.

Regards,
Jon

--- R-devel/src/library/base/R/connections.R	2009-08-07 01:52:16.000000000 +0100
+++ R-devel-mod/src/library/base/R/connections.R	2009-08-11
16:22:30.000000000 +0100
@@ -193,6 +193,6 @@
     swap <- endian != .Platform$endian
     if(!is.character(what) || length(what) != 1L
-    	|| !(what %in% c("numeric", "double", "integer", "int", "logical",
-                         "complex", "character", "raw")))
+    	|| !any(what == c("numeric", "double", "integer", "int", "logical",
+                          "complex", "character", "raw")))
         what <- typeof(what)
     .Internal(readBin(con, what, n, size, signed, swap))


--
Jonathan D. Clayden, Ph.D.
Research Fellow
Radiology and Physics Unit
UCL Institute of Child Health
30 Guilford Street
LONDON  WC1N 1EH
United Kingdom

t | +44 (0)20 7905 2708
f | +44 (0)20 7905 2358
w | www.homepages.ucl.ac.uk/~sejjjd2/
w | www.diffusion-mri.org.uk/people/1


From HStaley at aol.com  Tue Aug 11 16:00:17 2009
From: HStaley at aol.com (HStaley at aol.com)
Date: Tue, 11 Aug 2009 16:00:17 +0200 (CEST)
Subject: [Rd] Appendix A problem (PR#13885)
Message-ID: <20090811140017.858942830316@mail.pubhealth.ku.dk>

One of the values assigned to w is zero.  In a later function w^2 is  used 
in a denominator.

	[[alternative HTML version deleted]]


From mikedulrich at gmail.com  Tue Aug 11 18:15:13 2009
From: mikedulrich at gmail.com (mikedulrich at gmail.com)
Date: Tue, 11 Aug 2009 18:15:13 +0200 (CEST)
Subject: [Rd] loadings function (PR#13886)
Message-ID: <20090811161513.3EA9D282EFF1@mail.pubhealth.ku.dk>

Full_Name: Mike Ulrich
Version: 2.9
OS: Mac OSX
Submission from: (NULL) (69.169.178.34)


The help documentation for loadings() lists more then one parameter. The
function call only expects one parameter. The digits, cutoff, and sort
parameters are not used in the function.

## S3 method for class 'loadings':
print(x, digits = 3, cutoff = 0.1, sort = FALSE, ...)

## S3 method for class 'factanal':
print(x, digits = 3, ...)


> loadings
function (x) 
x$loadings
<environment: namespace:stats>


From smckinney at bccrc.ca  Tue Aug 11 21:56:57 2009
From: smckinney at bccrc.ca (Steven McKinney)
Date: Tue, 11 Aug 2009 12:56:57 -0700
Subject: [Rd] loadings function (PR#13886)
In-Reply-To: <21019_1250019405_1250019405_20090811161513.3EA9D282EFF1@mail.pubhealth.ku.dk>
References: <21019_1250019405_1250019405_20090811161513.3EA9D282EFF1@mail.pubhealth.ku.dk>
Message-ID: <DCE81E14EB74504B971DAD4D2DB0356B01F9E87C@crcmail4.BCCRC.CA>

Hi Mike,

Please don't file bug reports without first posing such
questions on R-help or R-devel first, asking if such behaviour
really is a bug.  (This generates extra work for the volunteers
who maintain R).

In this case, it's your misunderstanding of the information
about three different functions on the "loadings" help
page.  The loadings() function is shown with one argument
"x" only.  The other parameters described are for the
print methods also discussed on the loadings() help page.

Looking at the factanal example:

> # A little demonstration, v2 is just v1 with noise,
> # and same for v4 vs. v3 and v6 vs. v5
> # Last four cases are there to add noise
> # and introduce a positive manifold (g factor)
> v1 <- c(1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,4,5,6)
> v2 <- c(1,2,1,1,1,1,2,1,2,1,3,4,3,3,3,4,6,5)
> v3 <- c(3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,5,4,6)
> v4 <- c(3,3,4,3,3,1,1,2,1,1,1,1,2,1,1,5,6,4)
> v5 <- c(1,1,1,1,1,3,3,3,3,3,1,1,1,1,1,6,4,5)
> v6 <- c(1,1,1,2,1,3,3,3,4,3,1,1,1,2,1,6,5,4)
> m1 <- cbind(v1,v2,v3,v4,v5,v6)
> 
> 
> fa <- factanal(m1, factors=3) # varimax is the default
> fa

Call:
factanal(x = m1, factors = 3)

Uniquenesses:
   v1    v2    v3    v4    v5    v6 
0.005 0.101 0.005 0.224 0.084 0.005 

Loadings:
   Factor1 Factor2 Factor3
v1 0.944   0.182   0.267  
v2 0.905   0.235   0.159  
v3 0.236   0.210   0.946  
v4 0.180   0.242   0.828  
v5 0.242   0.881   0.286  
v6 0.193   0.959   0.196  

               Factor1 Factor2 Factor3
SS loadings      1.893   1.886   1.797
Proportion Var   0.316   0.314   0.300
Cumulative Var   0.316   0.630   0.929

The degrees of freedom for the model is 0 and the fit was 0.4755 

### Now extract just the loadings
> loadings(fa)

Loadings:
   Factor1 Factor2 Factor3
v1 0.944   0.182   0.267  
v2 0.905   0.235   0.159  
v3 0.236   0.210   0.946  
v4 0.180   0.242   0.828  
v5 0.242   0.881   0.286  
v6 0.193   0.959   0.196  

               Factor1 Factor2 Factor3
SS loadings      1.893   1.886   1.797
Proportion Var   0.316   0.314   0.300
Cumulative Var   0.316   0.630   0.929

### Now attempt
> loadings(fa, digits = 5)
Error in loadings(fa, digits = 5) : unused argument(s) (digits = 5)

### loadings() takes only one argument.

### The digits and other arguments are for the print methods, e.g.

> print(fa, digits = 5)

Call:
factanal(x = m1, factors = 3)

Uniquenesses:
     v1      v2      v3      v4      v5      v6 
0.00500 0.10090 0.00500 0.22405 0.08429 0.00500 

Loadings:
   Factor1 Factor2 Factor3
v1 0.94384 0.18193 0.26661
v2 0.90472 0.23484 0.15948
v3 0.23564 0.20960 0.94634
v4 0.17998 0.24225 0.82757
v5 0.24211 0.88064 0.28560
v6 0.19277 0.95884 0.19621

               Factor1 Factor2 Factor3
SS loadings    1.89304 1.88576 1.79702
Proportion Var 0.31551 0.31429 0.29950
Cumulative Var 0.31551 0.62980 0.92930

The degrees of freedom for the model is 0 and the fit was 0.4755 

> print(loadings(fa), digits = 5)

Loadings:
   Factor1 Factor2 Factor3
v1 0.94384 0.18193 0.26661
v2 0.90472 0.23484 0.15948
v3 0.23564 0.20960 0.94634
v4 0.17998 0.24225 0.82757
v5 0.24211 0.88064 0.28560
v6 0.19277 0.95884 0.19621

               Factor1 Factor2 Factor3
SS loadings    1.89304 1.88576 1.79702
Proportion Var 0.31551 0.31429 0.29950
Cumulative Var 0.31551 0.62980 0.92930
> 

Best

Steven McKinney

Statistician
Molecular Oncology and Breast Cancer Program
British Columbia Cancer Research Centre

email: smckinney +at+ bccrc +dot+ ca

tel: 604-675-8000 x7561

BCCRC
Molecular Oncology
675 West 10th Ave, Floor 4
Vancouver B.C.
V5Z 1L3
Canada

________________________________________
From: r-devel-bounces at r-project.org [r-devel-bounces at r-project.org] On Behalf Of mikedulrich at gmail.com [mikedulrich at gmail.com]
Sent: August 11, 2009 9:15 AM
To: r-devel at stat.math.ethz.ch
Cc: R-bugs at r-project.org
Subject: [Rd] loadings function (PR#13886)

Full_Name: Mike Ulrich
Version: 2.9
OS: Mac OSX
Submission from: (NULL) (69.169.178.34)


The help documentation for loadings() lists more then one parameter. The
function call only expects one parameter. The digits, cutoff, and sort
parameters are not used in the function.

## S3 method for class 'loadings':
print(x, digits = 3, cutoff = 0.1, sort = FALSE, ...)

## S3 method for class 'factanal':
print(x, digits = 3, ...)


> loadings
function (x)
x$loadings
<environment: namespace:stats>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From smckinney at bccrc.ca  Tue Aug 11 22:00:30 2009
From: smckinney at bccrc.ca (smckinney at bccrc.ca)
Date: Tue, 11 Aug 2009 22:00:30 +0200 (CEST)
Subject: [Rd] loadings function (PR#13886)
Message-ID: <20090811200030.527DA282BEBD@mail.pubhealth.ku.dk>

Hi Mike,

Please don't file bug reports without first posing such
questions on R-help or R-devel first, asking if such behaviour
really is a bug.  (This generates extra work for the volunteers
who maintain R).

In this case, it's your misunderstanding of the information
about three different functions on the "loadings" help
page.  The loadings() function is shown with one argument
"x" only.  The other parameters described are for the
print methods also discussed on the loadings() help page.

Looking at the factanal example:

> # A little demonstration, v2 is just v1 with noise,
> # and same for v4 vs. v3 and v6 vs. v5
> # Last four cases are there to add noise
> # and introduce a positive manifold (g factor)
> v1 <- c(1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,4,5,6)
> v2 <- c(1,2,1,1,1,1,2,1,2,1,3,4,3,3,3,4,6,5)
> v3 <- c(3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,5,4,6)
> v4 <- c(3,3,4,3,3,1,1,2,1,1,1,1,2,1,1,5,6,4)
> v5 <- c(1,1,1,1,1,3,3,3,3,3,1,1,1,1,1,6,4,5)
> v6 <- c(1,1,1,2,1,3,3,3,4,3,1,1,1,2,1,6,5,4)
> m1 <- cbind(v1,v2,v3,v4,v5,v6)
>=20
>=20
> fa <- factanal(m1, factors=3D3) # varimax is the default
> fa

Call:
factanal(x =3D m1, factors =3D 3)

Uniquenesses:
   v1    v2    v3    v4    v5    v6=20
0.005 0.101 0.005 0.224 0.084 0.005=20

Loadings:
   Factor1 Factor2 Factor3
v1 0.944   0.182   0.267 =20
v2 0.905   0.235   0.159 =20
v3 0.236   0.210   0.946 =20
v4 0.180   0.242   0.828 =20
v5 0.242   0.881   0.286 =20
v6 0.193   0.959   0.196 =20

               Factor1 Factor2 Factor3
SS loadings      1.893   1.886   1.797
Proportion Var   0.316   0.314   0.300
Cumulative Var   0.316   0.630   0.929

The degrees of freedom for the model is 0 and the fit was 0.4755=20

### Now extract just the loadings
> loadings(fa)

Loadings:
   Factor1 Factor2 Factor3
v1 0.944   0.182   0.267 =20
v2 0.905   0.235   0.159 =20
v3 0.236   0.210   0.946 =20
v4 0.180   0.242   0.828 =20
v5 0.242   0.881   0.286 =20
v6 0.193   0.959   0.196 =20

               Factor1 Factor2 Factor3
SS loadings      1.893   1.886   1.797
Proportion Var   0.316   0.314   0.300
Cumulative Var   0.316   0.630   0.929

### Now attempt
> loadings(fa, digits =3D 5)
Error in loadings(fa, digits =3D 5) : unused argument(s) (digits =3D 5)

### loadings() takes only one argument.

### The digits and other arguments are for the print methods, e.g.

> print(fa, digits =3D 5)

Call:
factanal(x =3D m1, factors =3D 3)

Uniquenesses:
     v1      v2      v3      v4      v5      v6=20
0.00500 0.10090 0.00500 0.22405 0.08429 0.00500=20

Loadings:
   Factor1 Factor2 Factor3
v1 0.94384 0.18193 0.26661
v2 0.90472 0.23484 0.15948
v3 0.23564 0.20960 0.94634
v4 0.17998 0.24225 0.82757
v5 0.24211 0.88064 0.28560
v6 0.19277 0.95884 0.19621

               Factor1 Factor2 Factor3
SS loadings    1.89304 1.88576 1.79702
Proportion Var 0.31551 0.31429 0.29950
Cumulative Var 0.31551 0.62980 0.92930

The degrees of freedom for the model is 0 and the fit was 0.4755=20

> print(loadings(fa), digits =3D 5)

Loadings:
   Factor1 Factor2 Factor3
v1 0.94384 0.18193 0.26661
v2 0.90472 0.23484 0.15948
v3 0.23564 0.20960 0.94634
v4 0.17998 0.24225 0.82757
v5 0.24211 0.88064 0.28560
v6 0.19277 0.95884 0.19621

               Factor1 Factor2 Factor3
SS loadings    1.89304 1.88576 1.79702
Proportion Var 0.31551 0.31429 0.29950
Cumulative Var 0.31551 0.62980 0.92930
>=20

Best

Steven McKinney

Statistician
Molecular Oncology and Breast Cancer Program
British Columbia Cancer Research Centre

email: smckinney +at+ bccrc +dot+ ca

tel: 604-675-8000 x7561

BCCRC
Molecular Oncology
675 West 10th Ave, Floor 4
Vancouver B.C.
V5Z 1L3
Canada

________________________________________
From: r-devel-bounces at r-project.org [r-devel-bounces at r-project.org] On Beha=
lf Of mikedulrich at gmail.com [mikedulrich at gmail.com]
Sent: August 11, 2009 9:15 AM
To: r-devel at stat.math.ethz.ch
Cc: R-bugs at r-project.org
Subject: [Rd] loadings function (PR#13886)

Full_Name: Mike Ulrich
Version: 2.9
OS: Mac OSX
Submission from: (NULL) (69.169.178.34)


The help documentation for loadings() lists more then one parameter. The
function call only expects one parameter. The digits, cutoff, and sort
parameters are not used in the function.

## S3 method for class 'loadings':
print(x, digits =3D 3, cutoff =3D 0.1, sort =3D FALSE, ...)

## S3 method for class 'factanal':
print(x, digits =3D 3, ...)


> loadings
function (x)
x$loadings
<environment: namespace:stats>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From p.dalgaard at biostat.ku.dk  Tue Aug 11 22:16:31 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 11 Aug 2009 22:16:31 +0200
Subject: [Rd] Appendix A problem (PR#13885)
In-Reply-To: <20090811140017.858942830316@mail.pubhealth.ku.dk>
References: <20090811140017.858942830316@mail.pubhealth.ku.dk>
Message-ID: <4A81D19F.10103@biostat.ku.dk>

HStaley at aol.com wrote:
> One of the values assigned to w is zero.  In a later function w^2 is  used 
> in a denominator.

WHAT on earth are you on about?????

If you are talking about Appendix A of "An Introduction to R", then I'd 
like to know which element of

w <- 1 + sqrt(x)/2

is zero....

-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From pgilbert at bank-banque-canada.ca  Tue Aug 11 22:41:42 2009
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 11 Aug 2009 16:41:42 -0400
Subject: [Rd] loadings function (PR#13886)
In-Reply-To: <20090811161513.3EA9D282EFF1@mail.pubhealth.ku.dk>
References: <20090811161513.3EA9D282EFF1@mail.pubhealth.ku.dk>
Message-ID: <4A81D786.2010604@bank-banque-canada.ca>

In 2.9.1 the documentation says

Usage:

      loadings(x)

      ## S3 method for class 'loadings':
      print(x, digits = 3, cutoff = 0.1, sort = FALSE, ...)

      ## S3 method for class 'factanal':
      print(x, digits = 3, ...)

which indicates one argument as in the function call. The digits, 
cutoff, and sort are arguments to the print methods.

(BTW, if there is a change to loadings() could it please be made a generic.)

Paul

mikedulrich at gmail.com wrote:
> Full_Name: Mike Ulrich
> Version: 2.9
> OS: Mac OSX
> Submission from: (NULL) (69.169.178.34)
> 
> 
> The help documentation for loadings() lists more then one parameter. The
> function call only expects one parameter. The digits, cutoff, and sort
> parameters are not used in the function.
> 
> ## S3 method for class 'loadings':
> print(x, digits = 3, cutoff = 0.1, sort = FALSE, ...)
> 
> ## S3 method for class 'factanal':
> print(x, digits = 3, ...)
> 
> 
> 
>>loadings
> 
> function (x) 
> x$loadings
> <environment: namespace:stats>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From peter.ruckdeschel at web.de  Wed Aug 12 00:05:04 2009
From: peter.ruckdeschel at web.de (Peter Ruckdeschel)
Date: Wed, 12 Aug 2009 00:05:04 +0200
Subject: [Rd] Awkward escaping with five backslashes within \code{ } in new
	parse_Rd
Message-ID: <h5spui$dmq$1@ger.gmane.org>

Hi R-devels,

I noticed that you are working quite actively on the new Rd-parser
and have made it the default renderer in R-2.10.0dev. So I would
like to come back on an issue I have already raised on this list
last November

("Two minor escaping issues using \preformatted{....} in Rd format")

My setting has slightly changed as \preformatted, AFAICS is not
supported within \describe environments, so I have switched to
\code{} ...

The issue is again the correct typesetting of


            \\\\\%

within a \code{}-tag.

This sequence occurs within a string (hence valid R code) in the
documentation to my CRAN package SweaveListingUtils.

So far the new parser cannot swallow such sequences
of 5 backslashes followed by a percent sign correctly, but rather
still throws an error;

as the former parser, it can digest it if I leave a space between the
fourth and fifth backslash, but then also prints this space out what is
not what I want.

Now admittedly this is not an urgent question, but if you are
working on the parser anyway, you might perhaps try to make my
sequence digestible, too.

Best regards,
Peter


From murdoch at stats.uwo.ca  Wed Aug 12 01:40:02 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 11 Aug 2009 19:40:02 -0400
Subject: [Rd] Awkward escaping with five backslashes within \code{ } in
 new	parse_Rd
In-Reply-To: <h5spui$dmq$1@ger.gmane.org>
References: <h5spui$dmq$1@ger.gmane.org>
Message-ID: <4A820152.9060201@stats.uwo.ca>

Peter Ruckdeschel wrote:
> Hi R-devels,
>
> I noticed that you are working quite actively on the new Rd-parser
> and have made it the default renderer in R-2.10.0dev. So I would
> like to come back on an issue I have already raised on this list
> last November
>
> ("Two minor escaping issues using \preformatted{....} in Rd format")
>
> My setting has slightly changed as \preformatted, AFAICS is not
> supported within \describe environments, so I have switched to
> \code{} ...
>
> The issue is again the correct typesetting of
>
>
>             \\\\\%
>
> within a \code{}-tag.
>
> This sequence occurs within a string (hence valid R code) in the
> documentation to my CRAN package SweaveListingUtils.
>   

That's not valid R code within a string, because \% is not a valid escape.

I think this is a case where you are not going to be able to find 
something that is compatible with both the old and new systems.  If you 
want to know how to get particular output in the new system, I'd be 
happy to help:  just tell me exactly what you want.
> So far the new parser cannot swallow such sequences
> of 5 backslashes followed by a percent sign correctly, but rather
> still throws an error;
>
> as the former parser, it can digest it if I leave a space between the
> fourth and fifth backslash, but then also prints this space out what is
> not what I want.
>
> Now admittedly this is not an urgent question, but if you are
> working on the parser anyway, you might perhaps try to make my
> sequence digestible, too.

I need more information about what you want the output to look like, in 
text, for example.  Because the Rd format is so ornate, I need more than 
just the particular string:  please send me the surrounding text, what 
your intentions are, and a large payment in unmarked bills.  Or at least 
the first two.

Duncan Murdoch


From felix at nfrac.org  Wed Aug 12 02:50:42 2009
From: felix at nfrac.org (Felix Andrews)
Date: Wed, 12 Aug 2009 10:50:42 +1000
Subject: [Rd] model.matrix evaluation challenges
In-Reply-To: <4A817EA7.5000903@ufl.edu>
References: <4A7F6A15.7090102@ufl.edu>
	<94730b8a0908101631r95dc903lcfd7031e5f6f3d21@mail.gmail.com> 
	<4A817EA7.5000903@ufl.edu>
Message-ID: <94730b8a0908111750v768c6c16j7e34456ebfb26d73@mail.gmail.com>

Hi,

OK, yes, it does require some explanation...

What is the difference between your examples 2 and 3, where the first
has the formula given explicitly, and the second has the formula
assigned to the object? As you said, case 2 works while case 3 fails.

2. with(c(newdata,object at data),model.matrix(~f))
3. z <- ~f; with(c(newdata,object at data),model.matrix(z))

The difference is that the environment attached to the formula is
different. Its environment defaults to the evaluation frame in which
the formula was defined. This evaluation frame is different inside the
with() statement: in that case the evaluation frame includes the
elements of c(newdata, object at data).

If the 'data' argument is missing, model.matrix() will only look in
the environment of z, which in your example is external to the with()
frame.

So one approach is to redefine the environment of the formula z:

z <- ~f
with(c(newdata,object at data), {
    environment(z) <- environment()
    model.matrix(z)
})

Or, we can force model.matrix() to look in a given environment by
using its 'data' argument:

with(c(newdata,object at data),model.matrix(~f, data = environment()))

Hope that helps
-Felix


2009/8/12 Ben Bolker <bolker at ufl.edu>:
> ?that seems to work, thank you.
> ?would anyone care to explain *why* it works ... ? or where
> I could go to read more about why it works ... ?
>
> ?cheers
> ? ?Ben Bolker
>
>
> Felix Andrews wrote:
>> how about...
>>
>> nrow(with(cc, model.matrix(params, data=environment())))
>>
>> cheers
>> -Felix
>>
>> 2009/8/10 Ben Bolker <bolker at ufl.edu>:
>>> ?I am having difficulty with evaluation/environment construction
>>> for a formula to be evaluated by model.matrix(). ?Basically, I
>>> want to construct a model matrix that first looks in "newdata"
>>> for the values of the model parameters, then in "object at data".
>>> Here's what I've tried:
>>>
>>> ?1. model.matrix(~f,data=c(newdata,object at data)) -- fails because
>>> something (terms()?) within model.matrix() tries to coerce "data"
>>> to a data frame -- but newdata and object at data have different
>>> numbers of rows.
>>>
>>> ?2. with(c(newdata,object at data),model.matrix(~f)) ? works --
>>> BUT not when ~f is assigned to another object (as it will be
>>> when it is being dug out of a previously fit model).
>>>
>>> ?3. If "f" exists as a column within newdata and/or object at data,
>>> but the formula is assigned to another object (see below), then
>>> with(c(newdata,object at data),model.matrix(z)) ?fails -- because
>>> model.matrix() is explicitly evaluating the variables in the formula
>>> in the environment of z (i.e., ignoring the first argument of "with" ...)
>>>
>>>
>>> ?Any advice on how to solve this without making a bigger mess?
>>>
>>> ?sincerely
>>> ? ?Ben Bolker
>>>
>>>
>>> ## set up a data frame for prediction
>>>
>>> set.seed(1001)
>>> f = factor(rep(letters[1:4],each=20))
>>> x = runif(80)
>>> u = rnorm(4)
>>> y = rnorm(80,mean=2+x*(3+u[f]),sd=0.1)
>>> dat = data.frame(f,x,y)
>>>
>>> ## fit a model ... could easily do by lm() but want to
>>> ## ? demonstrate the problem
>>>
>>> library(bbmle)
>>> m1 = mle2(y~dnorm(a+b*x,sd=exp(logs)),parameters=list(b~f),data=dat,
>>> ?start=list(a=0,b=2,logs=-3))
>>>
>>> ## data frame for prediction
>>> pp0 = expand.grid(x=seq(0,1,length=11),
>>> ?f=levels(dat$f))
>>>
>>> ## combine frame and model data: have to keep the model data
>>> ## ?around, because it contain other information needed for
>>> ## ?prediction.
>>>
>>> cc = c(pp0,m1 at data)
>>> try(mm <- model.matrix(~f,cc)) ?## fails -- different number of rows
>>> ?## (at some point R tries to coerce cc to a data frame)
>>> nrow(with(cc,model.matrix(~f))) ## works ... but ...
>>>
>>> ## here's what happens within predict.mle2()
>>> ## extract information about parameter models
>>> params <- eval(m1 at call$parameters)
>>> params <- params[[1]]
>>> params[[2]] <- NULL
>>>
>>> nrow(with(cc,model.matrix(params)))
>>> rm(f)
>>> ## object "f" not found -- because model.matrix
>>> ## ?evaluates in the parent environment of params ...
>>> try(nrow(with(cc,model.matrix(params))))
>>>
>>>
>>>
>>> --
>>> Ben Bolker
>>> Associate professor, Biology Dep't, Univ. of Florida
>>> bolker at ufl.edu / www.zoology.ufl.edu/bolker
>>> GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>>
>>
>
>
> --
> Ben Bolker
> Associate professor, Biology Dep't, Univ. of Florida
> bolker at ufl.edu / www.zoology.ufl.edu/bolker
> GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc
>
>



-- 
Felix Andrews / ???
Postdoctoral Fellow
Integrated Catchment Assessment and Management (iCAM) Centre
Fenner School of Environment and Society [Bldg 48a]
The Australian National University
Canberra ACT 0200 Australia
M: +61 410 400 963
T: + 61 2 6125 1670
E: felix.andrews at anu.edu.au
CRICOS Provider No. 00120C
-- 
http://www.neurofractal.org/felix/


From fabio.ufla at yahoo.com.br  Wed Aug 12 13:32:58 2009
From: fabio.ufla at yahoo.com.br (=?iso-8859-1?Q?Fabio_Mathias_Corr=EAa?=)
Date: Wed, 12 Aug 2009 04:32:58 -0700 (PDT)
Subject: [Rd] Problem with function in fortran 95
Message-ID: <795354.83301.qm@web59705.mail.ac4.yahoo.com>

I am writing a function in fortran 95, but the intrinsic function MATMUL is not working properly. Here's an example.

	SUBROUTINE mymult(x,y,res,m,n)
        IMPLICIT NONE
        INTEGER :: m,n
	REAL :: x, y, res
        DIMENSION :: x(m,n), y(n,m), res(m,m)
        res = MATMUL(x,y)
        END SUBROUTINE mymult

R CMD SHLIB mat.f95

In R:

dyn.load("mat.so")
x   <- matrix(1:20,5)
l   <- nrow(x)
c   <- ncol(x)
y   <- matrix(20:1,c)
res <- matrix(0,l,l)
dim(x)
dim(y)
dim(res)
l
c
.Fortran("mymult", x,y,res,l,c)

[[1]]
     [,1] [,2] [,3] [,4]
[1,]    1    6   11   16
[2,]    2    7   12   17
[3,]    3    8   13   18
[4,]    4    9   14   19
[5,]    5   10   15   20

[[2]]
     [,1] [,2] [,3] [,4] [,5]
[1,]   20   16   12    8    4
[2,]   19   15   11    7    3
[3,]   18   14   10    6    2
[4,]   17   13    9    5    1

[[3]]
     [,1] [,2] [,3] [,4] [,5]
[1,]    0    0    0    0    0
[2,]    0    0    0    0    0
[3,]    0    0    0    0    0
[4,]    0    0    0    0    0
[5,]    0    0    0    0    0

[[4]]
[1] 5

[[5]]
[1] 4


Linux Ubuntu 8.04 and use compiler gfortran 4.2.
The problem is the compiler?

Thanks!

? ???????????? F?bio Mathias Corr?a
Estat?stica e Experimenta??o Agropecu?ria/UFLA
                      Brazil


      ____________________________________________________________________________________
Veja quais s?o os assuntos do momento no Yahoo! +Buscados
http://br.maisbuscados.yahoo.com


From savicky at cs.cas.cz  Wed Aug 12 13:50:46 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Wed, 12 Aug 2009 13:50:46 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <20090811100201.GA19381@cs.cas.cz>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>
	<4A7D8E08.2070300@uottawa.ca> <20090810092141.GC10119@cs.cas.cz>
	<4A7FECCD.2010208@stats.uwo.ca>
	<353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
	<4A802CB7.3030806@stats.uwo.ca> <4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch>
	<20090811100201.GA19381@cs.cas.cz>
Message-ID: <20090812115046.GA17118@cs.cas.cz>

Let me add the following to the discussion of identical(0, -0).

I would like to suggest to replace the paragraph

  'identical' sees 'NaN' as different from 'NA_real_', but all
  'NaN's are equal (and all 'NA' of the same type are equal).

in ?identical by the following text, which is a correction of my previous
suggestion for the same paragraph

  Components of numerical objects are compared as follows. For non-missing
  values, "==" is used. In particular, '0' and '-0' are considered equal. 
  All 'NA's of the same type are equal and all 'NaN's are equal, although 
  their bit patterns may differ in some cases. 'NA' and 'NaN' are always 
  different. Note also that 1/0 and 1/(-0) are different.

The suggestion for the default of identical(0, -0) is TRUE, because the
negative zero is much less important than NA na NaN and, possibly,
distinguishing 0 and -0 could even be deprecated. Moreover, the argument
of efficiency of memcmp cannot be used here, since there are different
variants of NaN and NA, which should not be distinguished by default.

Petr.


From maechler at stat.math.ethz.ch  Wed Aug 12 14:57:27 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 12 Aug 2009 14:57:27 +0200
Subject: [Rd] readBin() arg check has unnecessary overhead (patch
	included)
In-Reply-To: <68e086180908110951j2f684448jbb31707b8e02ad0f@mail.gmail.com>
References: <68e086180908110951j2f684448jbb31707b8e02ad0f@mail.gmail.com>
Message-ID: <19074.48183.102932.170100@lynne.math.ethz.ch>

>>>>> Jon Clayden <jon.clayden at gmail.com>
>>>>>     on Tue, 11 Aug 2009 17:51:46 +0100 writes:

    > Dear all,
    > The version of readBin() in R-devel includes a use of match(), through
    > `%in%`, which can affect its performance significantly. By using
    > primitives instead of the rather expensive call to match(), I reduce
    > the time spent inside readBin() by more than 30% in some of my code
    > (part of the tractor.base package). A simple patch that does this is
    > given below. This passes "make check-devel" fine, and I don't see that
    > it could produce unexpected behaviour -- though I may, of course, be
    > wrong.

actually,  %in%  is liked by programmeRs for its inherent
robustness combined with "expressiveness" (<-> readability)
inspite of its potential efficiency loss wrt to  '=='
... 
and indeed, your patch fails in one case where the original code works:

  readBin(., NA_character_, ...)

However that case can also be checked explicitly,
and I will implement the corresponding patch.

Martin Maechler, ETH Zurich


    > Regards,
    > Jon

    > --- R-devel/src/library/base/R/connections.R	2009-08-07 01:52:16.000000000 +0100
    > +++ R-devel-mod/src/library/base/R/connections.R	2009-08-11
    > 16:22:30.000000000 +0100
    > @@ -193,6 +193,6 @@
    > swap <- endian != .Platform$endian
    > if(!is.character(what) || length(what) != 1L
    > -    	|| !(what %in% c("numeric", "double", "integer", "int", "logical",
    > -                         "complex", "character", "raw")))
    > +    	|| !any(what == c("numeric", "double", "integer", "int", "logical",
    > +                          "complex", "character", "raw")))
    > what <- typeof(what)
    > .Internal(readBin(con, what, n, size, signed, swap))


    > --
    > Jonathan D. Clayden, Ph.D.
    > Research Fellow
    > Radiology and Physics Unit
    > UCL Institute of Child Health
    > 30 Guilford Street
    > LONDON  WC1N 1EH
    > United Kingdom

    > t | +44 (0)20 7905 2708
    > f | +44 (0)20 7905 2358
    > w | www.homepages.ucl.ac.uk/~sejjjd2/
    > w | www.diffusion-mri.org.uk/people/1

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From jon.clayden at gmail.com  Wed Aug 12 15:57:10 2009
From: jon.clayden at gmail.com (Jon Clayden)
Date: Wed, 12 Aug 2009 14:57:10 +0100
Subject: [Rd] readBin() arg check has unnecessary overhead (patch
	included)
In-Reply-To: <19074.48183.102932.170100@lynne.math.ethz.ch>
References: <68e086180908110951j2f684448jbb31707b8e02ad0f@mail.gmail.com>
	<19074.48183.102932.170100@lynne.math.ethz.ch>
Message-ID: <68e086180908120657r47104be7l73f7ebb867143a8e@mail.gmail.com>

> ? ?> Dear all,
> ? ?> The version of readBin() in R-devel includes a use of match(), through
> ? ?> `%in%`, which can affect its performance significantly. By using
> ? ?> primitives instead of the rather expensive call to match(), I reduce
> ? ?> the time spent inside readBin() by more than 30% in some of my code
> ? ?> (part of the tractor.base package). A simple patch that does this is
> ? ?> given below. This passes "make check-devel" fine, and I don't see that
> ? ?> it could produce unexpected behaviour -- though I may, of course, be
> ? ?> wrong.
>
> actually, ?%in% ?is liked by programmeRs for its inherent
> robustness combined with "expressiveness" (<-> readability)
> inspite of its potential efficiency loss wrt to ?'=='

Oh, absolutely. I like it and use it widely. But my feeling was that
in core code, a small loss in expressiveness for a significant
performance improvement is a trade worth making.

> and indeed, your patch fails in one case where the original code works:
>
> ?readBin(., NA_character_, ...)
>
> However that case can also be checked explicitly,
> and I will implement the corresponding patch.

Many thanks.

Regards,
Jon


From maechler at stat.math.ethz.ch  Wed Aug 12 16:02:28 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 12 Aug 2009 16:02:28 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <20090812115046.GA17118@cs.cas.cz>
References: <mailman.23.1249725606.24224.r-devel@r-project.org>
	<4A7D8E08.2070300@uottawa.ca> <20090810092141.GC10119@cs.cas.cz>
	<4A7FECCD.2010208@stats.uwo.ca>
	<353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
	<4A802CB7.3030806@stats.uwo.ca> <4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch>
	<20090811100201.GA19381@cs.cas.cz>
	<20090812115046.GA17118@cs.cas.cz>
Message-ID: <19074.52084.426535.783434@lynne.math.ethz.ch>

>>>>> "PS" == Petr Savicky <savicky at cs.cas.cz>
>>>>>     on Wed, 12 Aug 2009 13:50:46 +0200 writes:

    PS> Let me add the following to the discussion of identical(0, -0).
    PS> I would like to suggest to replace the paragraph

    PS> 'identical' sees 'NaN' as different from 'NA_real_', but all
    PS> 'NaN's are equal (and all 'NA' of the same type are equal).

    PS> in ?identical by the following text, which is a correction of my previous
    PS> suggestion for the same paragraph

    > Components of numerical objects are compared as follows. For non-missing
    > values, "==" is used. In particular, '0' and '-0' are considered equal. 
    > All 'NA's of the same type are equal and all 'NaN's are equal, although 
    > their bit patterns may differ in some cases. 'NA' and 'NaN' are always 
    > different. 
    > Note also that 1/0 and 1/(-0) are different.

the 'numerical' would have to be qualified ('double', 'complex'
via double), as indeed,  memcmp() is used on integers

The last sentence is not necessary and probably even confusing:
Of course, -Inf and Inf are different.


    PS> The suggestion for the default of identical(0, -0) is TRUE, because the
    PS> negative zero is much less important than NA na NaN and, possibly,
    PS> distinguishing 0 and -0 could even be deprecated.

What should that mean??  R *is* using the international floating
point standards, and 0 and -0 exist there and they *are*
different!
If  R  would start --- with a performance penalty, btw ! ---
to explicitly map all internal '-0' into '+0'  we would
explicitly move away from the international FP standards... 
no way!


    PS> Moreover, the argument
    PS> of efficiency of memcmp cannot be used here, since there are different
    PS> variants of NaN and NA, which should not be distinguished by default.

your argument is only partly true... as memcmp() can still be
used instead of '=='  *after* the NA-treatments  {my current
patch does so},
and even more as I have been proposing an option "strict"  which
would only use memcmp()  {and hence also distinguish different
NA, NaN's}.

Martin


From maechler at stat.math.ethz.ch  Wed Aug 12 16:05:46 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 12 Aug 2009 16:05:46 +0200
Subject: [Rd] readBin() arg check has unnecessary overhead (patch
	included)
In-Reply-To: <68e086180908120657r47104be7l73f7ebb867143a8e@mail.gmail.com>
References: <68e086180908110951j2f684448jbb31707b8e02ad0f@mail.gmail.com>
	<19074.48183.102932.170100@lynne.math.ethz.ch>
	<68e086180908120657r47104be7l73f7ebb867143a8e@mail.gmail.com>
Message-ID: <19074.52282.467591.82824@lynne.math.ethz.ch>

>>>>> "JC" == Jon Clayden <jon.clayden at gmail.com>
>>>>>     on Wed, 12 Aug 2009 14:57:10 +0100 writes:

    >> ? ?> Dear all,
    >> ? ?> The version of readBin() in R-devel includes a use of match(), through
    >> ? ?> `%in%`, which can affect its performance significantly. By using
    >> ? ?> primitives instead of the rather expensive call to match(), I reduce
    >> ? ?> the time spent inside readBin() by more than 30% in some of my code
    >> ? ?> (part of the tractor.base package). A simple patch that does this is
    >> ? ?> given below. This passes "make check-devel" fine, and I don't see that
    >> ? ?> it could produce unexpected behaviour -- though I may, of course, be
    >> ? ?> wrong.
    >> 
    >> actually, ?%in% ?is liked by programmeRs for its inherent
    >> robustness combined with "expressiveness" (<-> readability)
    >> inspite of its potential efficiency loss wrt to ?'=='

    JC> Oh, absolutely. I like it and use it widely. But my feeling was that
    JC> in core code, a small loss in expressiveness for a significant
    JC> performance improvement is a trade worth making.

Yes, I agree, and hence the following ...

    >> and indeed, your patch fails in one case where the original code works:
    >> 
    >> ?readBin(., NA_character_, ...)
    >> 
    >> However that case can also be checked explicitly,
    >> and I will implement the corresponding patch.

now in R-devel, revision 49187.

    JC> Many thanks.
    JC> Regards,
    JC> Jon

Thank *you* ! {I forgot to say the first time ..}
Martin


From gb at stat.umu.se  Wed Aug 12 16:59:52 2009
From: gb at stat.umu.se (=?ISO-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Wed, 12 Aug 2009 16:59:52 +0200
Subject: [Rd] Problem with function in fortran 95
In-Reply-To: <795354.83301.qm@web59705.mail.ac4.yahoo.com>
References: <795354.83301.qm@web59705.mail.ac4.yahoo.com>
Message-ID: <4A82D8E8.8020908@stat.umu.se>

Fabio Mathias Corr?a skrev:
> I am writing a function in fortran 95, but the intrinsic function MATMUL is not working properly. Here's an example.
> 
> 	SUBROUTINE mymult(x,y,res,m,n)
>         IMPLICIT NONE
>         INTEGER :: m,n
> 	REAL :: x, y, res

Is REAL in Fortran 95 the same as "double precision" in Fortran 77? It 
should be for this to work.

G?ran

>         DIMENSION :: x(m,n), y(n,m), res(m,m)
>         res = MATMUL(x,y)
>         END SUBROUTINE mymult
> 
> R CMD SHLIB mat.f95
> 
> In R:
> 
> dyn.load("mat.so")
> x   <- matrix(1:20,5)
> l   <- nrow(x)
> c   <- ncol(x)
> y   <- matrix(20:1,c)
> res <- matrix(0,l,l)
> dim(x)
> dim(y)
> dim(res)
> l
> c
> .Fortran("mymult", x,y,res,l,c)
> 
> [[1]]
>      [,1] [,2] [,3] [,4]
> [1,]    1    6   11   16
> [2,]    2    7   12   17
> [3,]    3    8   13   18
> [4,]    4    9   14   19
> [5,]    5   10   15   20
> 
> [[2]]
>      [,1] [,2] [,3] [,4] [,5]
> [1,]   20   16   12    8    4
> [2,]   19   15   11    7    3
> [3,]   18   14   10    6    2
> [4,]   17   13    9    5    1
> 
> [[3]]
>      [,1] [,2] [,3] [,4] [,5]
> [1,]    0    0    0    0    0
> [2,]    0    0    0    0    0
> [3,]    0    0    0    0    0
> [4,]    0    0    0    0    0
> [5,]    0    0    0    0    0
> 
> [[4]]
> [1] 5
> 
> [[5]]
> [1] 4
> 
> 
> Linux Ubuntu 8.04 and use compiler gfortran 4.2.
> The problem is the compiler?
> 
> Thanks!
> 
>                F?bio Mathias Corr?a
> Estat?stica e Experimenta??o Agropecu?ria/UFLA
>                       Brazil
> 
> 
>       ____________________________________________________________________________________
> Veja quais s?o os assuntos do momento no Yahoo! +Buscados
> http://br.maisbuscados.yahoo.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From savicky at cs.cas.cz  Wed Aug 12 18:20:13 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Wed, 12 Aug 2009 18:20:13 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <19074.52084.426535.783434@lynne.math.ethz.ch>
References: <4A7D8E08.2070300@uottawa.ca> <20090810092141.GC10119@cs.cas.cz>
	<4A7FECCD.2010208@stats.uwo.ca>
	<353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
	<4A802CB7.3030806@stats.uwo.ca> <4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch>
	<20090811100201.GA19381@cs.cas.cz>
	<20090812115046.GA17118@cs.cas.cz>
	<19074.52084.426535.783434@lynne.math.ethz.ch>
Message-ID: <20090812162013.GA13341@cs.cas.cz>

On Wed, Aug 12, 2009 at 04:02:28PM +0200, Martin Maechler wrote:
> >>>>> "PS" == Petr Savicky <savicky at cs.cas.cz>
> >>>>>     on Wed, 12 Aug 2009 13:50:46 +0200 writes:
> 
>     PS> Let me add the following to the discussion of identical(0, -0).
>     PS> I would like to suggest to replace the paragraph
> 
>     PS> 'identical' sees 'NaN' as different from 'NA_real_', but all
>     PS> 'NaN's are equal (and all 'NA' of the same type are equal).
> 
>     PS> in ?identical by the following text, which is a correction of my previous
>     PS> suggestion for the same paragraph
> 
>     > Components of numerical objects are compared as follows. For non-missing
>     > values, "==" is used. In particular, '0' and '-0' are considered equal. 
>     > All 'NA's of the same type are equal and all 'NaN's are equal, although 
>     > their bit patterns may differ in some cases. 'NA' and 'NaN' are always 
>     > different. 
>     > Note also that 1/0 and 1/(-0) are different.
> 
> the 'numerical' would have to be qualified ('double', 'complex'
> via double), as indeed,  memcmp() is used on integers
> 
> The last sentence is not necessary and probably even confusing:
> Of course, -Inf and Inf are different.

I agree.

>     PS> The suggestion for the default of identical(0, -0) is TRUE, because the
>     PS> negative zero is much less important than NA na NaN and, possibly,
>     PS> distinguishing 0 and -0 could even be deprecated.
> 
> What should that mean??  R *is* using the international floating
> point standards, and 0 and -0 exist there and they *are*
> different!

I am sorry for being too short. In my opinion, distinguishing 0 and -0 is
not useful enough to make the default behavior of identical() different
from the behavior of == in this case.

> If  R  would start --- with a performance penalty, btw ! ---
> to explicitly map all internal '-0' into '+0'  we would
> explicitly move away from the international FP standards... 
> no way!

Yes, i agree. I did not meant this.

>     PS> Moreover, the argument
>     PS> of efficiency of memcmp cannot be used here, since there are different
>     PS> variants of NaN and NA, which should not be distinguished by default.
> 
> your argument is only partly true... as memcmp() can still be
> used instead of '=='  *after* the NA-treatments  {my current
> patch does so},

OK. In this case, memcmp() could still be faster than ==, although 
this is beyond my knowledge.

> and even more as I have been proposing an option "strict"  which
> would only use memcmp()  {and hence also distinguish different
> NA, NaN's}.

I understand the previous messages in this thread as that there is an
agreement that such an option would be very useful and would lead
to faster comparison.

Petr.


From p.dalgaard at biostat.ku.dk  Wed Aug 12 22:45:07 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 12 Aug 2009 22:45:07 +0200
Subject: [Rd] Bug in nlm, found using sem;
 failure in several flavors (PR#13883)
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D70001A18B3C@NA-PA-VBE03.na.tibco.com>
References: <20090807223514.7C78E282EF4C@mail.pubhealth.ku.dk>	<24906063.post@talk.nabble.com>
	<77EB52C6DD32BA4D87471DCD70C8D70001A18B3C@NA-PA-VBE03.na.tibco.com>
Message-ID: <4A8329D3.1000705@biostat.ku.dk>

William Dunlap wrote:

> Running his example under valgrind (a memory misuse checker on Linux)
> does show it using memory it should not be using in the optimization C
> code
> around where it is copying the gradient vector.  The 
> 
> ==10916== Invalid read of size 1
> ==10916==    at 0x400686D: memcpy (mc_replace_strmem.c:406)
> ==10916==    by 0x8072BC1: FT_store (optimize.c:319)
> ==10916==    by 0x8072F92: fcn (optimize.c:408)

Looks like this does the trick (you do want to protect "s" because 
install() may allocate):

[pd at titmouse2 R]$ svn diff
Index: src/main/optimize.c
===================================================================
--- src/main/optimize.c	(revision 49168)
+++ src/main/optimize.c	(working copy)
@@ -378,7 +378,7 @@
  	if (!R_FINITE(x[i])) error(_("non-finite value supplied by 'nlm'"));
  	REAL(s)[i] = x[i];
      }
-    s = eval(state->R_fcall, state->R_env);
+    s = PROTECT(eval(state->R_fcall, state->R_env));
      switch(TYPEOF(s)) {
      case INTSXP:
  	if (length(s) != 1) goto badvalue;
@@ -400,13 +400,14 @@
  	goto badvalue;
      }
      if (state->have_gradient) {
-	g = REAL(coerceVector(getAttrib(s, install("gradient")), REALSXP));
+	g = REAL(PROTECT(coerceVector(getAttrib(s, install("gradient")), 
REALSXP)));
  	if (state->have_hessian) {
-	    h = REAL(coerceVector(getAttrib(s, install("hessian")), REALSXP));
+	    h = REAL(PROTECT(coerceVector(getAttrib(s, install("hessian")), 
REALSXP)));
  	}
      }
      FT_store(n, *f, x, g, h, state);
-    return;
+    UNPROTECT(1 + state->have_gradient + state->have_hessian);
+    return;

   badvalue:
      error(_("invalid function value in 'nlm' optimizer"));


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From jjdonald at indiana.edu  Thu Aug 13 02:26:59 2009
From: jjdonald at indiana.edu (Justin Donaldson)
Date: Wed, 12 Aug 2009 20:26:59 -0400
Subject: [Rd] eurodist example dataset is malformed
Message-ID: <eda626a30908121726i16cd3455r6ae64ac8702590c7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090812/ce55f341/attachment.pl>

From gavin.simpson at ucl.ac.uk  Thu Aug 13 10:48:47 2009
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Thu, 13 Aug 2009 09:48:47 +0100
Subject: [Rd] eurodist example dataset is malformed
In-Reply-To: <eda626a30908121726i16cd3455r6ae64ac8702590c7@mail.gmail.com>
References: <eda626a30908121726i16cd3455r6ae64ac8702590c7@mail.gmail.com>
Message-ID: <1250153327.2828.12.camel@desktop2.simpson>

On Wed, 2009-08-12 at 20:26 -0400, Justin Donaldson wrote:
> The eurodist dataset (my favorite for mds) is malformed.  Instead of a
> standard distance matrix, it's a data frame.  The rownames have gotten
> 'bumped' to a new anonymous dimension "X".   It's possible to fix the data,
> but it messes up a lot of example code out there.
> 
>           X Athens Barcelona Brussels Calais ...
> 1    Athens      0      3313     2963   3175
> 2 Barcelona   3313         0     1318   1326
> 3  Brussels   2963      1318        0    204
> 4    Calais   3175      1326      204      0
> 5 Cherbourg   3339      1294      583    460
> 6   Cologne   2762      1498      206    409
> ...
> 
> Best,
> -Justin

What version of R, platform, loaded packages etc? This is not what I see
on Linux, 2.9.1-patched r49104.

> class(eurodist)
[1] "dist"
> sessionInfo()
R version 2.9.1 Patched (2009-08-07 r49104) 
x86_64-unknown-linux-gnu 

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;
LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;
LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods
base     

loaded via a namespace (and not attached):
[1] tools_2.9.1

Have you tried this in a clean session to see if it persists there?

If you can reproduce this in a clean session with an up-to-date R or
R-Devel then send details of your R back to the list for further
investigation.

HTH

G
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From kenneth.cater at bankofamerica.com  Wed Aug 12 18:10:16 2009
From: kenneth.cater at bankofamerica.com (kenneth.cater at bankofamerica.com)
Date: Wed, 12 Aug 2009 18:10:16 +0200 (CEST)
Subject: [Rd] Problem with Linux x86_64 RODBC and Netezza (PR#13889)
Message-ID: <20090812161016.2FEAD282EF4F@mail.pubhealth.ku.dk>

Full_Name: Kenneth Cater
Version: 2.9.1
OS: Linux x86_64
Submission from: (NULL) (171.159.192.10)


It appears that R closes my connection to the Netezza device before the Netezza
has completed its return of data, below are two files clean_test.log which
tracks the systems call made when running the test.r file, and clean_test.out
which is the output generated when test.r is executed.  Notice how the second
select systems call times out before all the data has been returned from the
device.  If you need any additional information please feel free to contact me
as this is a major priority for me, thank you for your assistance.

::::::::::::::
clean_test.log
::::::::::::::
socket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 3
setsockopt(3, SOL_TCP, TCP_NODELAY, [1], 4) = 0
fcntl(3, F_GETFL)                       = 0x2 (flags O_RDWR)
fcntl(3, F_SETFL, O_RDWR)               = 0
connect(3, {sa_family=AF_INET, sin_port=htons(5480),
sin_addr=inet_addr("###.###.###.###")}, 16) = 0
sendto(3, "\0\0\0\10\0\1\0\2", 8, 0, NULL, 0) = 8
recvfrom(3, "N", 16384, 0, NULL, NULL)  = 1
sendto(3, "\0\0\0\r\0\2ECR_RND", 13, 0, NULL, 0) = 13
recvfrom(3, "N", 16384, 0, NULL, NULL)  = 1
sendto(3, "\0\0\0\r\0\3#######", 13, 0, NULL, 0) = 13
recvfrom(3, "N", 16384, 0, NULL, NULL)  = 1
sendto(3, "\0\0\0\n\0\t\0\3\0\4", 10, 0, NULL, 0) = 10
recvfrom(3, "N", 16384, 0, NULL, NULL)  = 1
sendto(3, "\0\0\0\n\0\6\0\0A\272", 10, 0, NULL, 0) = 10
recvfrom(3, "N", 16384, 0, NULL, NULL)  = 1
sendto(3, "\0\0\0\10\0\10\0\2", 8, 0, NULL, 0) = 8
recvfrom(3, "N", 16384, 0, NULL, NULL)  = 1
sendto(3, "\0\0\0\6\3\350", 6, 0, NULL, 0) = 6
recvfrom(3, "R\0\0\0\0054V", 16384, 0, NULL, NULL) = 7
sendto(3, "\0\0\0\0333prlIFXmej+6Oj0se6tVkA\0", 27, 0, NULL, 0) = 27
recvfrom(3, "R\0\0\0\0", 16384, 0, NULL, NULL) = 5
recvfrom(3, "K\0\0\0\0\0\0\0\10\0\0 \220\246\266\2151Z\0\0\0\0\0\0\0\0", 16384,
0, NULL, NULL) = 26
sendto(3, "P\0\0\0\1set nz_encoding to \'utf8\'\0", 31, 0, NULL, 0) = 31
recvfrom(3, "C\0\0\0\1\0\0\0\rSET VARIABLE\0Z\0\0\0\1\0\0\0\0", 16384, 0, NULL,
NULL) = 31
sendto(3, "P\0\0\0\2set DateStyle to \'ISO\'\0", 28, 0, NULL, 0) = 28
recvfrom(3, "C\0\0\0\2\0\0\0\rSET VARIABLE\0Z\0\0\0\2\0\0\0\0", 16384, 0, NULL,
NULL) = 31
sendto(3, "P\0\0\0\3select version()\0", 22, 0, NULL, 0) = 22
recvfrom(3, "P\0\0\0\3\0\0\0\6blank\0T\0\0\0\3\0\0\0\25\0\1VERSIO"..., 16384, 0,
NULL, NULL) = 114
sendto(3, "P\0\0\0\4select feature from _v_odbc"..., 66, 0, NULL, 0) = 66
recvfrom(3, "P\0\0\0\4\0\0\0\6blank\0T\0\0\0\4\0\0\0\25\0\1FEATUR"..., 16384, 0,
NULL, NULL) = 146
sendto(3, "P\0\0\0\5select identifier_case, cur"..., 59, 0, NULL, 0) = 59
recvfrom(3, "P\0\0\0\5\0\0\0\6blank\0T\0\0\0\5\0\0\0P\0\3IDENTI"..., 16384, 0,
NULL, NULL) = 174
write(1, "> ", 2)                       = 2
write(1, "conn\n", 5)                   = 5
getrusage(RUSAGE_SELF, {ru_utime={0, 357945}, ru_stime={0, 82987}, ...}) = 0
getrusage(RUSAGE_CHILDREN, {ru_utime={0, 0}, ru_stime={0, 999}, ...}) = 0
write(1, "RODBC Connection ", 17)       = 17
write(1, "1", 1)                        = 1
write(1, "\nDetails:\n  ", 12)          = 12
write(1, "case=nochange", 13)           = 13
write(1, "\n  ", 3)                     = 3
write(1, "DSN=ECR_RND", 11)             = 11
write(1, "\n  ", 3)                     = 3
write(1, "Database=ECR_RND", 16)        = 16
write(1, "\n  ", 3)                     = 3
write(1, "Servername=###.###.###.###", 23) = 23
write(1, "\n  ", 3)                     = 3
write(1, "Username=#######", 16)        = 16
write(1, "\n  ", 3)                     = 3
write(1, "Password=########", 17)       = 17
write(1, "\n  ", 3)                     = 3
write(1, "Port=5480", 9)                = 9
write(1, "\n  ", 3)                     = 3
write(1, "ReadOnly=0", 10)              = 10
write(1, "\n  ", 3)                     = 3
write(1, "SQLBitOneZero=0", 15)         = 15
write(1, "\n  ", 3)                     = 3
write(1, "LegacySQLTables=0", 17)       = 17
write(1, "\n  ", 3)                     = 3
write(1, "NumericAsChar=0", 15)         = 15
write(1, "\n  ", 3)                     = 3
write(1, "ShowSystemTables=0", 18)      = 18
write(1, "\n  ", 3)                     = 3
write(1, "LoginTimeout=0", 14)          = 14
write(1, "\n  ", 3)                     = 3
write(1, "QueryTimeout=200000", 19)     = 19
write(1, "\n  ", 3)                     = 3
write(1, "DateFormat=1", 12)            = 12
write(1, "\n", 1)                       = 1
write(1, "> ", 2)                       = 2
write(1, "SampleData = sqlQuery(conn, \"sel"..., 78) = 78
write(1, "+ ", 2)                       = 2
write(1, "\n", 1)                       = 1
write(1, "+ ", 2)                       = 2
write(1, "            TB_CH_CBSA_CODE_CBSA"..., 46) = 46
write(1, "+ ", 2)                       = 2
write(1, "\n", 1)                       = 1
write(1, "+ ", 2)                       = 2
write(1, "            where a.CBSA_CODE = "..., 45) = 45
write(1, "+ ", 2)                       = 2
write(1, "\n", 1)                       = 1
write(1, "+ ", 2)                       = 2
write(1, "            and a.CBSA_CODE in ("..., 91) = 91
getrusage(RUSAGE_SELF, {ru_utime={0, 359945}, ru_stime={0, 82987}, ...}) = 0
getrusage(RUSAGE_CHILDREN, {ru_utime={0, 0}, ru_stime={0, 999}, ...}) = 0
semop(594378758, 0x7fff36b1e510, 2)     = 0
semop(594378758, 0x7fff36b1e510, 1)     = 0
brk(0x72fb000)                          = 0x72fb000
sendto(3, "P\0\0\0\6select * from TB_CH_LEV_CBS"..., 175, 0, NULL, 0) = 175
select(4, [3], NULL, NULL, {200000, 0}) = 1 (in [3], left {199999, 215000})
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 4344
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 3848
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 4344
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 16384
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 12040
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
write(1, "> ", 2)                       = 2
write(1, "\n", 1)                       = 1
write(1, "> ", 2)                       = 2
write(1, "SampleData\n", 11)            = 11
getrusage(RUSAGE_SELF, {ru_utime={0, 361944}, ru_stime={0, 82987}, ...}) = 0
getrusage(RUSAGE_CHILDREN, {ru_utime={0, 0}, ru_stime={0, 999}, ...}) = 0
write(1, "character(0)\n", 13)          = 13
write(1, "> ", 2)                       = 2
write(1, "summary(SampleData)\n", 20)   = 20
getrusage(RUSAGE_SELF, {ru_utime={0, 361944}, ru_stime={0, 82987}, ...}) = 0
getrusage(RUSAGE_CHILDREN, {ru_utime={0, 0}, ru_stime={0, 999}, ...}) = 0
write(1, "   Length ", 10)              = 10
write(1, "    Class ", 10)              = 10
write(1, "     Mode ", 10)              = 10
write(1, "\n", 1)                       = 1
write(1, "        0 ", 10)              = 10
write(1, "character ", 10)              = 10
write(1, "character ", 10)              = 10
write(1, "\n", 1)                       = 1
write(1, "> ", 2)                       = 2
write(1, "close(conn)\n", 12)           = 12
getrusage(RUSAGE_SELF, {ru_utime={0, 362944}, ru_stime={0, 82987}, ...}) = 0
getrusage(RUSAGE_CHILDREN, {ru_utime={0, 0}, ru_stime={0, 999}, ...}) = 0
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 16384
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8688
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8688
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8648
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
...
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 8192
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 10592
recvfrom(3, "...DATA REDACTED..."..., 16384, 0, NULL, NULL) = 7545
select(4, [3], NULL, NULL, {0, 0})      = 0 (Timeout)
sendto(3, "X", 1, 0, NULL, 0)           = 1
close(3)                                = 0
semop(594378758, 0x7fff36b1e2f0, 2)     = 0
semop(594378758, 0x7fff36b1e2f0, 1)     = 0
write(1, "> ", 2)                       = 2
write(1, "\n", 1)                       = 1
write(1, "> ", 2)                       = 2
read(0, "", 4096)                       = 0
write(1, "\n", 1)                       = 1
rt_sigaction(SIGINT, {SIG_IGN}, {0x2aaaaadb8fa0, [INT], SA_RESTORER|SA_RESTART,
0x2aaaab4770b0}, 8) = 0
rt_sigaction(SIGQUIT, {SIG_IGN}, {SIG_IGN}, 8) = 0
rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0
clone(child_stack=0, flags=CLONE_PARENT_SETTID|SIGCHLD,
parent_tidptr=0x7fff36b20808) = 16828
wait4(16828, [{WIFEXITED(s) && WEXITSTATUS(s) == 0}], 0, NULL) = 16828
rt_sigaction(SIGINT, {0x2aaaaadb8fa0, [INT], SA_RESTORER|SA_RESTART,
0x2aaaab4770b0}, NULL, 8) = 0
rt_sigaction(SIGQUIT, {SIG_IGN}, NULL, 8) = 0
rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
--- SIGCHLD (Child exited) @ 0 (0) ---
close(0)                                = 0
exit_group(0)                           = ?
::::::::::::::
clean_test.out
::::::::::::::

R version 2.9.1 (2009-06-26)
Copyright (C) 2009 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library("RODBC")
> 
> conn = odbcConnect("ECR_RND",uid="#######", pwd="########")
> conn
RODBC Connection 1
Details:
  case=nochange
  DSN=ECR_RND
  Database=ECR_RND
  Servername=###.###.###.###
  Username=#######
  Password=########
  Port=5480
  ReadOnly=0
  SQLBitOneZero=0
  LegacySQLTables=0
  NumericAsChar=0
  ShowSystemTables=0
  LoginTimeout=0
  QueryTimeout=200000
  DateFormat=1
> SampleData = sqlQuery(conn, "select * from TB_CH_LEV_CBSA_PRODUCT_VINTAGE a, 
+ 
+             TB_CH_CBSA_CODE_CBSA_TITLE_XREF b
+ 
+             where a.CBSA_CODE = b.CBSA_CODE 
+ 
+             and a.CBSA_CODE in ('14460', '33100', '35620', '41860');",
believeNRows=FALSE)
> 
> SampleData
character(0)
> summary(SampleData)
   Length     Class      Mode 
        0 character character 
> close(conn)
> 
>


From richard_stahlhut at urmc.rochester.edu  Wed Aug 12 18:25:13 2009
From: richard_stahlhut at urmc.rochester.edu (richard_stahlhut at urmc.rochester.edu)
Date: Wed, 12 Aug 2009 18:25:13 +0200 (CEST)
Subject: [Rd] 10x slower merge in mac 2.9.1 vs. 2.9.0 (PR#13890)
Message-ID: <20090812162513.55224282EF4F@mail.pubhealth.ku.dk>

Full_Name: Rick Stahlhut
Version: 2.9.1
OS: os x 10.5.7
Submission from: (NULL) (128.151.71.23)


I upgraded to 2.9.1 today from 2.9.0.   I work with large CDC (center for
disease control) datasets and start, frequently, with a series of 23 large-ish
merges to create the final dataset I work on.  I do this each time because (a) R
is fast.  why not?   and b) the datasets occasionally get updated by CDC and
it's easier to swap in new files that way.

One such merge is two data.frames with 10 variables and 10,000 rows each.  The
command in question is:

temp = merge (demo.2,ph,by="seqn",all.x=TRUE)

in 2.9.0, this command took 3.3 seconds.
in 2.9.1, it took 35.8 seconds.

I have reverted back to 2.9.0.

Additional packages loaded are:

library(Hmisc)
library(alr3)
library(epicalc)
library(ggplot2)
library(lattice)
library(reshape)
library(survey)
library(car) 

thanks very much for all the effort.  R is wonderful.


From simon.urbanek at r-project.org  Thu Aug 13 17:52:09 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 13 Aug 2009 11:52:09 -0400
Subject: [Rd] 10x slower merge in mac 2.9.1 vs. 2.9.0 (PR#13890)
In-Reply-To: <20090812162513.55224282EF4F@mail.pubhealth.ku.dk>
References: <20090812162513.55224282EF4F@mail.pubhealth.ku.dk>
Message-ID: <93666615-CEB5-42B7-82FE-E6C1B35D5CD0@r-project.org>

Rick,

I'm sorry, but I cannot reproduce it. You didn't supply sessionInfo()  
and the actual data, so all I can do is guess, but according to your  
description this test case shows no difference:

set.seed(1)
n=10000
d1 
= 
data 
.frame 
(seqn 
= 
as 
.integer 
(runif 
(n 
)*n 
),a 
= 
rnorm 
(n 
),b 
= 
rnorm 
(n 
),c 
= 
rnorm 
(n),d=rnorm(n),e=rnorm(n),f=rnorm(n),g=rnorm(n),h=rnorm(n),i=rnorm(n))
d2 
= 
data 
.frame 
(seqn 
= 
as 
.integer 
(runif 
(n 
)*n 
),a 
= 
rnorm 
(n 
),b 
= 
rnorm 
(n 
),c 
= 
rnorm 
(n),d=rnorm(n),e=rnorm(n),f=rnorm(n),g=rnorm(n),h=rnorm(n),i=rnorm(n))
system.time(merge(d1,d2,by="seqn",all.x=TRUE))

R 2.9.1:
 > system.time(merge(d1,d2,by="seqn",all.x=TRUE))
    user  system elapsed
   0.150   0.067   0.217

R 2.9.0:
 > system.time(merge(d1,d2,by="seqn",all.x=TRUE))
    user  system elapsed
   0.148   0.068   0.216

To substantiate your claim, please provide a reproducible example as  
well as sessionInfo() [and details on how you run it - GUI, CLI, ...],  
but I suspect the difference may be in your data, not R.

Thanks,
Simon


On Aug 12, 2009, at 12:25 , richard_stahlhut at urmc.rochester.edu wrote:

> Full_Name: Rick Stahlhut
> Version: 2.9.1
> OS: os x 10.5.7
> Submission from: (NULL) (128.151.71.23)
>
>
> I upgraded to 2.9.1 today from 2.9.0.   I work with large CDC  
> (center for
> disease control) datasets and start, frequently, with a series of 23  
> large-ish
> merges to create the final dataset I work on.  I do this each time  
> because (a) R
> is fast.  why not?   and b) the datasets occasionally get updated by  
> CDC and
> it's easier to swap in new files that way.
>
> One such merge is two data.frames with 10 variables and 10,000 rows  
> each.  The
> command in question is:
>
> temp = merge (demo.2,ph,by="seqn",all.x=TRUE)
>
> in 2.9.0, this command took 3.3 seconds.
> in 2.9.1, it took 35.8 seconds.
>
> I have reverted back to 2.9.0.
>
> Additional packages loaded are:
>
> library(Hmisc)
> library(alr3)
> library(epicalc)
> library(ggplot2)
> library(lattice)
> library(reshape)
> library(survey)
> library(car)
>
> thanks very much for all the effort.  R is wonderful.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From adrian_d at eskimo.com  Thu Aug 13 18:01:54 2009
From: adrian_d at eskimo.com (Adrian Dragulescu)
Date: Thu, 13 Aug 2009 09:01:54 -0700 (PDT)
Subject: [Rd] 10x slower merge in mac 2.9.1 vs. 2.9.0 (PR#13890)
In-Reply-To: <93666615-CEB5-42B7-82FE-E6C1B35D5CD0@r-project.org>
References: <20090812162513.55224282EF4F@mail.pubhealth.ku.dk>
	<93666615-CEB5-42B7-82FE-E6C1B35D5CD0@r-project.org>
Message-ID: <Pine.LNX.4.64.0908130900010.4950@shell.eskimo.com>


This issue has been reported before
http://thread.gmane.org/gmane.comp.lang.r.devel/20945/focus=20959

It happens when data frames contain character strings.

Thanks,
Adrian



On Thu, 13 Aug 2009, Simon Urbanek wrote:

> Rick,
>
> I'm sorry, but I cannot reproduce it. You didn't supply sessionInfo() and the 
> actual data, so all I can do is guess, but according to your description this 
> test case shows no difference:
>
> set.seed(1)
> n=10000
> d1=data.frame(seqn=as.integer(runif(n)*n),a=rnorm(n),b=rnorm(n),c=rnorm(n),d=rnorm(n),e=rnorm(n),f=rnorm(n),g=rnorm(n),h=rnorm(n),i=rnorm(n))
> d2=data.frame(seqn=as.integer(runif(n)*n),a=rnorm(n),b=rnorm(n),c=rnorm(n),d=rnorm(n),e=rnorm(n),f=rnorm(n),g=rnorm(n),h=rnorm(n),i=rnorm(n))
> system.time(merge(d1,d2,by="seqn",all.x=TRUE))
>
> R 2.9.1:
>> system.time(merge(d1,d2,by="seqn",all.x=TRUE))
>  user  system elapsed
> 0.150   0.067   0.217
>
> R 2.9.0:
>> system.time(merge(d1,d2,by="seqn",all.x=TRUE))
>  user  system elapsed
> 0.148   0.068   0.216
>
> To substantiate your claim, please provide a reproducible example as well as 
> sessionInfo() [and details on how you run it - GUI, CLI, ...], but I suspect 
> the difference may be in your data, not R.
>
> Thanks,
> Simon
>
>
> On Aug 12, 2009, at 12:25 , richard_stahlhut at urmc.rochester.edu wrote:
>
>> Full_Name: Rick Stahlhut
>> Version: 2.9.1
>> OS: os x 10.5.7
>> Submission from: (NULL) (128.151.71.23)
>> 
>> 
>> I upgraded to 2.9.1 today from 2.9.0.   I work with large CDC (center for
>> disease control) datasets and start, frequently, with a series of 23 
>> large-ish
>> merges to create the final dataset I work on.  I do this each time because 
>> (a) R
>> is fast.  why not?   and b) the datasets occasionally get updated by CDC 
>> and
>> it's easier to swap in new files that way.
>> 
>> One such merge is two data.frames with 10 variables and 10,000 rows each. 
>> The
>> command in question is:
>> 
>> temp = merge (demo.2,ph,by="seqn",all.x=TRUE)
>> 
>> in 2.9.0, this command took 3.3 seconds.
>> in 2.9.1, it took 35.8 seconds.
>> 
>> I have reverted back to 2.9.0.
>> 
>> Additional packages loaded are:
>> 
>> library(Hmisc)
>> library(alr3)
>> library(epicalc)
>> library(ggplot2)
>> library(lattice)
>> library(reshape)
>> library(survey)
>> library(car)
>> 
>> thanks very much for all the effort.  R is wonderful.
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From adrian_d at eskimo.com  Thu Aug 13 18:05:43 2009
From: adrian_d at eskimo.com (adrian_d at eskimo.com)
Date: Thu, 13 Aug 2009 18:05:43 +0200 (CEST)
Subject: [Rd] 10x slower merge in mac 2.9.1 vs. 2.9.0 (PR#13890)
Message-ID: <20090813160543.C15EB2831FE7@mail.pubhealth.ku.dk>


This issue has been reported before
http://thread.gmane.org/gmane.comp.lang.r.devel/20945/focus=20959

It happens when data frames contain character strings.

Thanks,
Adrian



On Thu, 13 Aug 2009, Simon Urbanek wrote:

> Rick,
>
> I'm sorry, but I cannot reproduce it. You didn't supply sessionInfo() and the 
> actual data, so all I can do is guess, but according to your description this 
> test case shows no difference:
>
> set.seed(1)
> n=10000
> d1=data.frame(seqn=as.integer(runif(n)*n),a=rnorm(n),b=rnorm(n),c=rnorm(n),d=rnorm(n),e=rnorm(n),f=rnorm(n),g=rnorm(n),h=rnorm(n),i=rnorm(n))
> d2=data.frame(seqn=as.integer(runif(n)*n),a=rnorm(n),b=rnorm(n),c=rnorm(n),d=rnorm(n),e=rnorm(n),f=rnorm(n),g=rnorm(n),h=rnorm(n),i=rnorm(n))
> system.time(merge(d1,d2,by="seqn",all.x=TRUE))
>
> R 2.9.1:
>> system.time(merge(d1,d2,by="seqn",all.x=TRUE))
>  user  system elapsed
> 0.150   0.067   0.217
>
> R 2.9.0:
>> system.time(merge(d1,d2,by="seqn",all.x=TRUE))
>  user  system elapsed
> 0.148   0.068   0.216
>
> To substantiate your claim, please provide a reproducible example as well as 
> sessionInfo() [and details on how you run it - GUI, CLI, ...], but I suspect 
> the difference may be in your data, not R.
>
> Thanks,
> Simon
>
>
> On Aug 12, 2009, at 12:25 , richard_stahlhut at urmc.rochester.edu wrote:
>
>> Full_Name: Rick Stahlhut
>> Version: 2.9.1
>> OS: os x 10.5.7
>> Submission from: (NULL) (128.151.71.23)
>> 
>> 
>> I upgraded to 2.9.1 today from 2.9.0.   I work with large CDC (center for
>> disease control) datasets and start, frequently, with a series of 23 
>> large-ish
>> merges to create the final dataset I work on.  I do this each time because 
>> (a) R
>> is fast.  why not?   and b) the datasets occasionally get updated by CDC 
>> and
>> it's easier to swap in new files that way.
>> 
>> One such merge is two data.frames with 10 variables and 10,000 rows each. 
>> The
>> command in question is:
>> 
>> temp = merge (demo.2,ph,by="seqn",all.x=TRUE)
>> 
>> in 2.9.0, this command took 3.3 seconds.
>> in 2.9.1, it took 35.8 seconds.
>> 
>> I have reverted back to 2.9.0.
>> 
>> Additional packages loaded are:
>> 
>> library(Hmisc)
>> library(alr3)
>> library(epicalc)
>> library(ggplot2)
>> library(lattice)
>> library(reshape)
>> library(survey)
>> library(car)
>> 
>> thanks very much for all the effort.  R is wonderful.
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From wavexx at users.sf.net  Thu Aug 13 18:09:27 2009
From: wavexx at users.sf.net (Yuri D'Elia)
Date: Thu, 13 Aug 2009 18:09:27 +0200
Subject: [Rd] memory management
References: <20090705165445.68dae639@abz8111lx.eurac.edu>
	<8ec76080907051259q4744d40bp46b2434b086d5adc@mail.gmail.com>
	<wavexx-F25043.00135406072009@ger.gmane.org>
Message-ID: <20090813180927.29ca988b@abz8111lx.eurac.edu>

Hi everyone. In response to my previous message (Memory management
issues), I've come up with the following patch against R 2.9.1.

To summarize the situation:

- We're hitting the memory barrier in our lab when running concurrent R
  processes due to the large datasets we use.
- We don't want to copy data back-and-forth between our R extension
  and R in order to reduce overall memory usage.

There were some very useful suggestions in the list, but nothing
optimal.

With this patch, I export two new functions from memory.c called
R_RegisterObject and R_UnregisterObject which simply allow to bypass
allocVector. They accept a SEXP node (which needs to be allocated and
initialized externally), protect it from collection by calling
R_ProtectObject, and snap it temporarily into the GC oldest and largest
heap generation until the object is unregistered.

Since these functions require knowledge of the inner workings of the
SEXP object, they are exported only if USE_RINTERNALS is defined.

By using these two functions, we developed a simple R extension which
allows to load data.frames directly from COW memory pages by
using mmap(), resulting in significant memory sharing between
various processes using the same datasets (and instantaneous load
times). This allowed us to program most of our code directly in R
instead or resorting to C for performance or memory constraints.

Could someone review the attached patch and spot any potential
problems? Is a change like this likely to be integrated into the R
sources? We would like to release our current R extension for anyone
to use.

Thanks.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: r-extgc.diff
Type: text/x-patch
Size: 1743 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090813/e1a0ca1c/attachment.bin>

From simon.urbanek at r-project.org  Thu Aug 13 19:42:39 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 13 Aug 2009 13:42:39 -0400
Subject: [Rd] memory management
In-Reply-To: <20090813180927.29ca988b@abz8111lx.eurac.edu>
References: <20090705165445.68dae639@abz8111lx.eurac.edu>
	<8ec76080907051259q4744d40bp46b2434b086d5adc@mail.gmail.com>
	<wavexx-F25043.00135406072009@ger.gmane.org>
	<20090813180927.29ca988b@abz8111lx.eurac.edu>
Message-ID: <061FA083-980C-4A3F-97CA-51E700AB27C8@r-project.org>

Yuri,

I'm not convinced that what you propose is a good idea. First, I don't  
quite understand why you would want to use an existing SEXP - if you  
had a valid SEXP for the current R instance, then there is no need for  
R_RegisterObject. If the SEXP is from a different R instance then you  
can't use it, because it can be anything and may contain references to  
other SEXPs in the other instance which are invalid (including all of  
the internal ones like R_NilValue etc.) - hence I don't see what  
R_RegisterObject would buy you.

What you possibly want (AFAIR) is a special allocVector version for  
primitive types that defines the memory location in advance, so you  
could specify a COW memmapped region used by the SEXP from the other  
instance. Still, in either case you can only share primitive types  
(INTSXP, REALSXP, LGLSXP, CPLXSXP) because anything more complex  
(VECSXP, STRSXP, ...) requires you to re-map the payload as well and  
you're back in the trouble of dependent SEXPs. But maybe I'm missing  
something - describing what you really do with it may help since  
R_RegisterObject in itself doesn't make much sense to me ...

Cheers,
Simon

PS: In addition, I think your implementation of R_UnregisterObject is  
too dangerous and superfluous - AFAICS it will break if there happens  
to exist a reference to the node (which you have no control of) since  
you unsnap it unconditionally. It also makes it impossible to use a  
finalizer, because you're forcefully preserving the object from  
collection (R actually allows double-release but you should not rely  
on it). Normally, you should not need R_UnregisterObject at all,  
because the GC should take care of it once you release it.

On Aug 13, 2009, at 12:09 , Yuri D'Elia wrote:

> Hi everyone. In response to my previous message (Memory management
> issues), I've come up with the following patch against R 2.9.1.
>
> To summarize the situation:
>
> - We're hitting the memory barrier in our lab when running  
> concurrent R
>  processes due to the large datasets we use.
> - We don't want to copy data back-and-forth between our R extension
>  and R in order to reduce overall memory usage.
>
> There were some very useful suggestions in the list, but nothing
> optimal.
>
> With this patch, I export two new functions from memory.c called
> R_RegisterObject and R_UnregisterObject which simply allow to bypass
> allocVector. They accept a SEXP node (which needs to be allocated and
> initialized externally), protect it from collection by calling
> R_ProtectObject, and snap it temporarily into the GC oldest and  
> largest
> heap generation until the object is unregistered.
>
> Since these functions require knowledge of the inner workings of the
> SEXP object, they are exported only if USE_RINTERNALS is defined.
>
> By using these two functions, we developed a simple R extension which
> allows to load data.frames directly from COW memory pages by
> using mmap(), resulting in significant memory sharing between
> various processes using the same datasets (and instantaneous load
> times). This allowed us to program most of our code directly in R
> instead or resorting to C for performance or memory constraints.
>
> Could someone review the attached patch and spot any potential
> problems? Is a change like this likely to be integrated into the R
> sources? We would like to release our current R extension for anyone
> to use.
>
> Thanks.
> <r-extgc.diff>______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From groemp at tfh-berlin.de  Thu Aug 13 17:38:13 2009
From: groemp at tfh-berlin.de (=?UTF-8?Q?Ulrike_Gr=C3=B6mping?=)
Date: Thu, 13 Aug 2009 08:38:13 -0700 (PDT)
Subject: [Rd]  Class design as used in package graphics
Message-ID: <24955121.post@talk.nabble.com>


Dear developeRs,

I just discovered the function plot.design in package graphics that acts as
a method for class design - the second time I come across a class design
outside my own packages. (The first time was in package conf.design, where
Bill Venables encouraged me to ignore it because he does not really use it.) 

Where can I find out more about the nature of the class design for which
function plot.design is written ? 

I am thinking of writing a function for my own packages that allows users to
choose between data frame plotting and the function plot.design from package
graphics; for this, it would be very helpful to understand what class design
consists of.

Thanks and regards,
Ulrike


-- 
View this message in context: http://www.nabble.com/Class-design-as-used-in-package-graphics-tp24955121p24955121.html
Sent from the R devel mailing list archive at Nabble.com.


From nikelski at bic.mni.mcgill.ca  Thu Aug 13 21:27:05 2009
From: nikelski at bic.mni.mcgill.ca (EJ Nikelski)
Date: Thu, 13 Aug 2009 15:27:05 -0400
Subject: [Rd] segfault when unloading a shared library
Message-ID: <e12172550908131227n14988da4r2efcd62d59b8da76@mail.gmail.com>

Hi All,

   I'm still actively researching this problem (reading R-ext manual),
but I hoped that I might be able to get some additional insight from
the list given that I'm fairly new at writing R extension code.

 Problem:  I have some fairly simple code (.Call interface) that makes
a call to another shared library, which, in turn, calls routines in an
HDF5 shared library.  The good news is that everything works (the
expected value is returned from the HDF5 call); the problem is that R
segfaults when I unload the library.

  I initially suspected that the HDF5 function might be corrupting the
stack/heap, however, if it is, it's not obvious to me.  Upon the
successful return from the function, R responds well, and a gc() call
works without event (only when unloading do I see the problem). In
addition, given that the function returns a  single (double) value, I
passed a much larger array in order to see whether the HDF routine
might be writing off the end of the buffer; the pre-initialized buffer
looked OK upon return.  Interestingly, when I comment out the call to
the HDF routine and manually return a double value, the problem
disappears. So, something within that particular HDF function (other
HDF functions work OK) is messing something up, which is only apparent
at unload time.  Any idea where I should be looking?

The abort output and environment details follow (I don't seem to get a
core dump). Please let me know if any other information might be
helpful, and what I might try next.

Thanks,

-Jim


---------------------------------------------------
>
> detach(package:mniMincIO)
Unloading shared library: mniMincIO. Library unload path is
/Users/jnikelski/R_libs/2.9/mniMincIO
now dyn.unload("/Users/jnikelski/R_libs/2.9/mniMincIO/libs/i386/mniMincIO.so")
...
Unloading shared library mniMincIO in R_unload_mniMincIO

 *** caught segfault ***
address 0xcfa5e0, cause 'memory not mapped'

Traceback:
 1: dyn.unload(file)
 2: library.dynam.unload(libName, file.ext = ".so", verbose = TRUE,
 libpath = libpath)
 3: .Last.lib(libpath)
 4: doTryCatch(return(expr), name, parentenv, handler)
 5: tryCatchOne(expr, names, parentenv, handlers[[1L]])
 6: tryCatchList(expr, classes, parentenv, handlers)
 7: tryCatch(expr, error = function(e) {    call <- conditionCall(e)
 if (!is.null(call)) {        if (identical(call[[1L]],
quote(doTryCatch)))             call <- sys.call(-4L)        dcall <-
deparse(call)[1L]        prefix <- paste("Error in", dcall, ": ")
 LONG <- 75L        msg <- conditionMessage(e)        sm <-
strsplit(msg, "\n")[[1L]]        if (14L + nchar(dcall, type = "w") +
nchar(sm[1L], type = "w") >             LONG)             prefix <-
paste(prefix, "\n  ", sep = "")    }    else prefix <- "Error : "
msg <- paste(prefix, conditionMessage(e), "\n", sep = "")
.Internal(seterrmessage(msg[1L]))    if (!silent &&
identical(getOption("show.error.messages"),         TRUE)) {
cat(msg, file = stderr())        .Internal(printDeferredWarnings())
}    invisible(structure(msg, class = "try-error"))})
 8: try(.Last.lib(libpath))
 9: detach(package:mniMincIO)

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection: 1
aborting ...
Segmentation fault

> sessionInfo()
R version 2.9.1 (2009-06-26)
i386-apple-darwin8.11.1

locale:
en_CA.UTF-8/en_CA.UTF-8/C/C/en_CA.UTF-8/en_CA.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

-----------------------------------------------------------------



--
=================================
Jim Nikelski, Ph.D.
Postdoctoral Research Fellow
Bloomfield Centre for Research in Aging
Lady Davis Institute for Medical Research
Sir Mortimer B. Davis - Jewish General Hospital
McGill University


From therneau at mayo.edu  Thu Aug 13 22:54:59 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Thu, 13 Aug 2009 15:54:59 -0500
Subject: [Rd] CMD check error (bug?)
Message-ID: <1250196899.14994.22.camel@punchbuggy>

R version 2.9.0 running on Centos (Red Hat linux).

I have a pair of packages coxme and bdsmatrix.  The latter is installed
in my local library (I don't have permission for global install at
work.)  That is, it is in the location pointed to in R_LIBS_USER. In R,
the command library(bdsmatrix) works fine.

Coxme depends on bdsmatrix, in fact uses some cross-calls to it's C
routines, which have been exported using the R_RegisterCCallable
function.  All works as expected: modules load, tests succeed.

Running R CMD check fails however,

tmt703% R CMD check coxme
* checking for working pdflatex ... OK
* using log directory
'/people/biostat2/therneau/research/surv/Rforge/pkg/coxme.Rcheck'
* using R version 2.9.0 (2009-04-17)
* using session charset: UTF-8
* checking for file 'coxme/DESCRIPTION' ... OK
* this is package 'coxme' version '1.0'
* checking package name space information ... OK
* checking package dependencies ... ERROR
Packages required but not available:
  bsdmatrix

 Is this an oversight in the check routine?

Terry T.


From gb at stat.umu.se  Thu Aug 13 23:01:54 2009
From: gb at stat.umu.se (=?ISO-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Thu, 13 Aug 2009 23:01:54 +0200
Subject: [Rd] CMD check error (bug?)
In-Reply-To: <1250196899.14994.22.camel@punchbuggy>
References: <1250196899.14994.22.camel@punchbuggy>
Message-ID: <4A847F42.4010403@stat.umu.se>

Terry Therneau skrev:
> R version 2.9.0 running on Centos (Red Hat linux).
> 
> I have a pair of packages coxme and bdsmatrix.  The latter is installed
> in my local library (I don't have permission for global install at
> work.)  That is, it is in the location pointed to in R_LIBS_USER. In R,
> the command library(bdsmatrix) works fine.
> 
> Coxme depends on bdsmatrix, in fact uses some cross-calls to it's C
> routines, which have been exported using the R_RegisterCCallable
> function.  All works as expected: modules load, tests succeed.
> 
> Running R CMD check fails however,
> 
> tmt703% R CMD check coxme
> * checking for working pdflatex ... OK
> * using log directory
> '/people/biostat2/therneau/research/surv/Rforge/pkg/coxme.Rcheck'
> * using R version 2.9.0 (2009-04-17)
> * using session charset: UTF-8
> * checking for file 'coxme/DESCRIPTION' ... OK
> * this is package 'coxme' version '1.0'
> * checking package name space information ... OK
> * checking package dependencies ... ERROR
> Packages required but not available:
>   bsdmatrix

Looks like a spelling error somewhere. The name is bdsmatrix (see above).

G?ran
> 
>  Is this an oversight in the check routine?
> 
> Terry T.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From therneau at mayo.edu  Thu Aug 13 23:38:01 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Thu, 13 Aug 2009 16:38:01 -0500
Subject: [Rd] CMD check error (bug?)
In-Reply-To: <4A847F42.4010403@stat.umu.se>
References: <1250196899.14994.22.camel@punchbuggy>
	<4A847F42.4010403@stat.umu.se>
Message-ID: <1250199481.14994.25.camel@punchbuggy>

> Looks like a spelling error somewhere. The name is bdsmatrix (see
above).

  That is so very obvious -- but only after someone else pointed it out.
The eye sometimes sees what it expects to see.

Thanks for the quick response.

Terry T.


From nikelski at bic.mni.mcgill.ca  Fri Aug 14 00:41:10 2009
From: nikelski at bic.mni.mcgill.ca (EJ Nikelski)
Date: Thu, 13 Aug 2009 18:41:10 -0400
Subject: [Rd] segfault when unloading a shared library
In-Reply-To: <4A846D19.4080907@fhcrc.org>
References: <e12172550908131227n14988da4r2efcd62d59b8da76@mail.gmail.com>
	<4A846D19.4080907@fhcrc.org>
Message-ID: <e12172550908131541r16e20514n4a4b75d1b95de2f2@mail.gmail.com>

Dear List,

   Martin, thanks for the extremely useful advice.  As valgrind is not
yet officially available for OS X, I grabbed the 3.5.0 beta from svn,
built it, and gave it a go.  The results were enlightening:

-------------------------------------------------
> # unload the library for updating
> detach(package:mniMincIO)
Unloading shared library: mniMincIO. Library unload path is
/Users/jnikelski/R_libs/2.9/mniMincIO
now dyn.unload("/Users/jnikelski/R_libs/2.9/mniMincIO/libs/i386/mniMincIO.so")
...
Unloading shared library mniMincIO in R_unload_mniMincIO
==3254== Jump to the invalid address stated on the next line
==3254==    at 0x80765E0: ???
==3254==    by 0x8090430: H5_term_library (in
/usr/local/bic/2009.08.10/lib/libhdf5.0.0.0.dylib)
==3254==    by 0x653DC6: __cxa_finalize (in /usr/lib/libSystem.B.dylib)
==3254==    by 0x68983E: dwarf2_unwind_dyld_remove_image_hook (in
/usr/lib/libSystem.B.dylib)
==3254==    by 0x8FE030D4: dyld::removeImage(ImageLoader*) (in /usr/lib/dyld)
==3254==    by 0x8FE031FD: dyld::garbageCollectImages() (in /usr/lib/dyld)
==3254==    by 0x8FE0BE05: dlclose (in /usr/lib/dyld)
==3254==    by 0x685E31: dlclose (in /usr/lib/libSystem.B.dylib)
==3254==    by 0x31ACDC: DeleteDLL (in
/Library/Frameworks/R.framework/Versions/2.9/Resources/lib/libR.dylib)
==3254==    by 0x31BA95: do_dynunload (in
/Library/Frameworks/R.framework/Versions/2.9/Resources/lib/libR.dylib)
==3254==    by 0x3F267E: do_internal (in
/Library/Frameworks/R.framework/Versions/2.9/Resources/lib/libR.dylib)
==3254==    by 0x3B7337: Rf_eval (in
/Library/Frameworks/R.framework/Versions/2.9/Resources/lib/libR.dylib)
==3254==  Address 0x80765e0 is not stack'd, malloc'd or (recently) free'd
==3254==

 *** caught segfault ***
address 0x0, cause 'memory not mapped'
--------------------------------------

   It would appear that during certain read/write operations, the HDF
lib registers its own clean up call via an atexit() routine.  The
unload of the upstream library (mniMincIO, in this case) appears to
trigger the atexit() HDF routine ... however, the HDF library is
already unloaded ... causing a jump into oblivion.

   There are 2 possible solutions that are immediately obvious to me:
(1) use the H5dont_atexit() function to prevent the registering of the
cleanup function, and/or (2) find some way of forcing the HDF library
not to unload.  I would prefer (2), but am not sophisticated enough to
figure out the best way to do this.  Any Mac experts following this
thread?  Simon?

Cheers,

-Jim


On Thu, Aug 13, 2009 at 3:44 PM, Martin Morgan<mtmorgan at fhcrc.org> wrote:
> R -d valgrind -f 'simple_script.R' can be very helpful for this.
>
> Martin
>
> EJ Nikelski wrote:
>> Hi All,
>>
>> ? ?I'm still actively researching this problem (reading R-ext manual),
>> but I hoped that I might be able to get some additional insight from
>> the list given that I'm fairly new at writing R extension code.
>>
>> ?Problem: ?I have some fairly simple code (.Call interface) that makes
>> a call to another shared library, which, in turn, calls routines in an
>> HDF5 shared library. ?The good news is that everything works (the
>> expected value is returned from the HDF5 call); the problem is that R
>> segfaults when I unload the library.
>>
>> ? I initially suspected that the HDF5 function might be corrupting the
>> stack/heap, however, if it is, it's not obvious to me. ?Upon the
>> successful return from the function, R responds well, and a gc() call
>> works without event (only when unloading do I see the problem). In
>> addition, given that the function returns a ?single (double) value, I
>> passed a much larger array in order to see whether the HDF routine
>> might be writing off the end of the buffer; the pre-initialized buffer
>> looked OK upon return. ?Interestingly, when I comment out the call to
>> the HDF routine and manually return a double value, the problem
>> disappears. So, something within that particular HDF function (other
>> HDF functions work OK) is messing something up, which is only apparent
>> at unload time. ?Any idea where I should be looking?
>>
>> The abort output and environment details follow (I don't seem to get a
>> core dump). Please let me know if any other information might be
>> helpful, and what I might try next.
>>
>> Thanks,
>>
>> -Jim
>>
>>
>> ---------------------------------------------------
>>> detach(package:mniMincIO)
>> Unloading shared library: mniMincIO. Library unload path is
>> /Users/jnikelski/R_libs/2.9/mniMincIO
>> now dyn.unload("/Users/jnikelski/R_libs/2.9/mniMincIO/libs/i386/mniMincIO.so")
>> ...
>> Unloading shared library mniMincIO in R_unload_mniMincIO
>>
>> ?*** caught segfault ***
>> address 0xcfa5e0, cause 'memory not mapped'
>>
>> Traceback:
>> ?1: dyn.unload(file)
>> ?2: library.dynam.unload(libName, file.ext = ".so", verbose = TRUE,
>> ?libpath = libpath)
>> ?3: .Last.lib(libpath)
>> ?4: doTryCatch(return(expr), name, parentenv, handler)
>> ?5: tryCatchOne(expr, names, parentenv, handlers[[1L]])
>> ?6: tryCatchList(expr, classes, parentenv, handlers)
>> ?7: tryCatch(expr, error = function(e) { ? ?call <- conditionCall(e)
>> ?if (!is.null(call)) { ? ? ? ?if (identical(call[[1L]],
>> quote(doTryCatch))) ? ? ? ? ? ? call <- sys.call(-4L) ? ? ? ?dcall <-
>> deparse(call)[1L] ? ? ? ?prefix <- paste("Error in", dcall, ": ")
>> ?LONG <- 75L ? ? ? ?msg <- conditionMessage(e) ? ? ? ?sm <-
>> strsplit(msg, "\n")[[1L]] ? ? ? ?if (14L + nchar(dcall, type = "w") +
>> nchar(sm[1L], type = "w") > ? ? ? ? ? ? LONG) ? ? ? ? ? ? prefix <-
>> paste(prefix, "\n ?", sep = "") ? ?} ? ?else prefix <- "Error : "
>> msg <- paste(prefix, conditionMessage(e), "\n", sep = "")
>> .Internal(seterrmessage(msg[1L])) ? ?if (!silent &&
>> identical(getOption("show.error.messages"), ? ? ? ? TRUE)) {
>> cat(msg, file = stderr()) ? ? ? ?.Internal(printDeferredWarnings())
>> } ? ?invisible(structure(msg, class = "try-error"))})
>> ?8: try(.Last.lib(libpath))
>> ?9: detach(package:mniMincIO)
>>
>> Possible actions:
>> 1: abort (with core dump, if enabled)
>> 2: normal R exit
>> 3: exit R without saving workspace
>> 4: exit R saving workspace
>> Selection: 1
>> aborting ...
>> Segmentation fault
>>
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26)
>> i386-apple-darwin8.11.1
>>
>> locale:
>> en_CA.UTF-8/en_CA.UTF-8/C/C/en_CA.UTF-8/en_CA.UTF-8
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> -----------------------------------------------------------------
>>
>>
>>
>> --
>> =================================
>> Jim Nikelski, Ph.D.
>> Postdoctoral Research Fellow
>> Bloomfield Centre for Research in Aging
>> Lady Davis Institute for Medical Research
>> Sir Mortimer B. Davis - Jewish General Hospital
>> McGill University
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



-- 
=================================
Jim Nikelski, Ph.D.
Postdoctoral Research Fellow
Bloomfield Centre for Research in Aging
Lady Davis Institute for Medical Research
Sir Mortimer B. Davis - Jewish General Hospital
McGill University


From saptarshi.guha at gmail.com  Fri Aug 14 03:07:13 2009
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Thu, 13 Aug 2009 21:07:13 -0400
Subject: [Rd] Embed R, and provide a function to user scripts
Message-ID: <1e7471d50908131807w118ce5b9ob0ead3503c9ca4e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090813/d6c93f4c/attachment.pl>

From saptarshi.guha at gmail.com  Fri Aug 14 04:01:30 2009
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Thu, 13 Aug 2009 22:01:30 -0400
Subject: [Rd] Embed R, and provide a function to user scripts
In-Reply-To: <1e7471d50908131807w118ce5b9ob0ead3503c9ca4e@mail.gmail.com>
References: <1e7471d50908131807w118ce5b9ob0ead3503c9ca4e@mail.gmail.com>
Message-ID: <1e7471d50908131901k3d14f07ej6086b99820af5386@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090813/123c1315/attachment.pl>

From saptarshi.guha at gmail.com  Fri Aug 14 04:31:49 2009
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Thu, 13 Aug 2009 22:31:49 -0400
Subject: [Rd] Embed R, and provide a function to user scripts
In-Reply-To: <1e7471d50908131901k3d14f07ej6086b99820af5386@mail.gmail.com>
References: <1e7471d50908131807w118ce5b9ob0ead3503c9ca4e@mail.gmail.com> 
	<1e7471d50908131901k3d14f07ej6086b99820af5386@mail.gmail.com>
Message-ID: <1e7471d50908131931v6aaec73ao83e8501499aa9b8f@mail.gmail.com>

Sorry about the clutter. The answer can be found on Writing R Extensions
"

8.1.3 Registering symbols"


Thank you

Saptarshi Guha


On Thu, Aug 13, 2009 at 10:01 PM, Saptarshi Guha
<saptarshi.guha at gmail.com> wrote:
>
> Essentially I'd like to load the C function into? the load table
> After that, I can create an R function
> rboo=function(x) .Call("boo",x)
>
> then user script cann call rboo
>
> Hope that clarifies things.
> Thanks in advance
>
> Saptarshi Guha
>
>
> On Thu, Aug 13, 2009 at 9:07 PM, Saptarshi Guha <saptarshi.guha at gmail.com> wrote:
>>
>> Hello,
>> I'm not sure how to go about this. Suppose I have a function
>>
>> SEXP boo(SEXP x){
>> //do something
>> }
>>
>> Also, I have an executable which embeds R in itself. I would like to provide a R function to user code to call that calls 'boo' e.g
>>
>> ##user supplied expression that is given to me
>>
>> x<-1
>> boo(x)
>>
>> One way is to create a library with function boo that performs .Call to boo, but is there a way that I can do something like
>>
>> ainstall("rboo", boo)
>>
>> and calls to rboo in the language will be sent to 'boo' ?
>>
>> Thank you
>> Saptarshi
>>
>>
>>
>> Saptarshi Guha
>


From josh.m.ulrich at gmail.com  Fri Aug 14 04:33:09 2009
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 13 Aug 2009 21:33:09 -0500
Subject: [Rd] Embed R, and provide a function to user scripts
In-Reply-To: <1e7471d50908131901k3d14f07ej6086b99820af5386@mail.gmail.com>
References: <1e7471d50908131807w118ce5b9ob0ead3503c9ca4e@mail.gmail.com> 
	<1e7471d50908131901k3d14f07ej6086b99820af5386@mail.gmail.com>
Message-ID: <8cca69990908131933g5b32e0b2v38a65342f4c37d4a@mail.gmail.com>

Hi Saptarshi,

See ?SHLIB and ?dyn.load.

HTH,
Josh
--
http://www.fosstrading.com



On Thu, Aug 13, 2009 at 9:01 PM, Saptarshi Guha<saptarshi.guha at gmail.com> wrote:
> Essentially I'd like to load the C function into ?the load table
> After that, I can create an R function
> rboo=function(x) .Call("boo",x)
>
> then user script cann call rboo
>
> Hope that clarifies things.
> Thanks in advance
>
> Saptarshi Guha
>
>
> On Thu, Aug 13, 2009 at 9:07 PM, Saptarshi Guha <saptarshi.guha at gmail.com>wrote:
>
>> Hello,
>> I'm not sure how to go about this. Suppose I have a function
>>
>> SEXP boo(SEXP x){
>> //do something
>> }
>>
>> Also, I have an executable which embeds R in itself. I would like to
>> provide a R function to user code to call that calls 'boo' e.g
>>
>> ##user supplied expression that is given to me
>>
>> x<-1
>> boo(x)
>>
>> One way is to create a library with function boo that performs .Call to
>> boo, but is there a way that I can do something like
>>
>> ainstall("rboo", boo)
>>
>> and calls to rboo in the language will be sent to 'boo' ?
>>
>> Thank you
>> Saptarshi
>>
>>
>>
>> Saptarshi Guha
>>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From edd at debian.org  Fri Aug 14 04:53:24 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 13 Aug 2009 21:53:24 -0500
Subject: [Rd] Package-level access to Rp->R_Quiet ?
Message-ID: <19076.53668.327171.363843@ron.nulle.part>


I would like to simulate the effect of the command-line option --quiet from
user-level scripts and startup code.  From src/main/CommandLineArgs.c I learn
that Rp->R_Quiet is set, and I see how that is used in main/main.c.

I would use this from code in Rprofile.site. In other words, I want to be
silent when --quiet is used (as e.g. by littler or Rscript) but not by R
itself in normal interactive mode or from ESS.

But it seems that I cannot get to this variable outside of the main
interpreter.  Could this symbol be exported?

Dirk

-- 
Three out of two people have difficulties with fractions.


From sgiannerini at gmail.com  Fri Aug 14 11:19:41 2009
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Fri, 14 Aug 2009 11:19:41 +0200
Subject: [Rd] Problem with function in fortran 95
In-Reply-To: <795354.83301.qm@web59705.mail.ac4.yahoo.com>
References: <795354.83301.qm@web59705.mail.ac4.yahoo.com>
Message-ID: <3c12769c0908140219y2c0f176eqca21d774082078bb@mail.gmail.com>

Fabio,

I see two problems with your code:

1. R type numeric corresponds to FORTRAN Real*8 (or double precision)
so that line 4 of your mat.f95 becomes:

REAL*8 :: x, y, res

2. your R code won't ever succeed because you pass integer matrices
(x,y,res) to a subroutine that expects REAL*8 data.
you need to coerce all your matrices to "double" as follows:

storage.mode(x) <- "double"
storage.mode(y) <- "double"
storage.mode(res) <- "double"

Finally, you can call the corrected function:

.Fortran("mymult", x,y,res,as.integer(l),as.integer(c))
[[1]]
     [,1] [,2] [,3] [,4]
[1,]    1    6   11   16
[2,]    2    7   12   17
[3,]    3    8   13   18
[4,]    4    9   14   19
[5,]    5   10   15   20

[[2]]
     [,1] [,2] [,3] [,4] [,5]
[1,]   20   16   12    8    4
[2,]   19   15   11    7    3
[3,]   18   14   10    6    2
[4,]   17   13    9    5    1

[[3]]
     [,1] [,2] [,3] [,4] [,5]
[1,]  604  468  332  196   60
[2,]  678  526  374  222   70
[3,]  752  584  416  248   80
[4,]  826  642  458  274   90
[5,]  900  700  500  300  100

[[4]]
[1] 5

[[5]]
[1] 4


All these issues are discussed in the "Writing R Extensions" manual,
please read it carefully.

Ciao

Simone



On Wed, Aug 12, 2009 at 1:32 PM, Fabio Mathias
Corr?a<fabio.ufla at yahoo.com.br> wrote:
> I am writing a function in fortran 95, but the intrinsic function MATMUL is not working properly. Here's an example.
>
> ? ? ? ?SUBROUTINE mymult(x,y,res,m,n)
> ? ? ? ?IMPLICIT NONE
> ? ? ? ?INTEGER :: m,n
> ? ? ? ?REAL :: x, y, res
> ? ? ? ?DIMENSION :: x(m,n), y(n,m), res(m,m)
> ? ? ? ?res = MATMUL(x,y)
> ? ? ? ?END SUBROUTINE mymult
>
> R CMD SHLIB mat.f95
>
> In R:
>
> dyn.load("mat.so")
> x ? <- matrix(1:20,5)
> l ? <- nrow(x)
> c ? <- ncol(x)
> y ? <- matrix(20:1,c)
> res <- matrix(0,l,l)
> dim(x)
> dim(y)
> dim(res)
> l
> c
> .Fortran("mymult", x,y,res,l,c)
>
> [[1]]
> ? ? [,1] [,2] [,3] [,4]
> [1,] ? ?1 ? ?6 ? 11 ? 16
> [2,] ? ?2 ? ?7 ? 12 ? 17
> [3,] ? ?3 ? ?8 ? 13 ? 18
> [4,] ? ?4 ? ?9 ? 14 ? 19
> [5,] ? ?5 ? 10 ? 15 ? 20
>
> [[2]]
> ? ? [,1] [,2] [,3] [,4] [,5]
> [1,] ? 20 ? 16 ? 12 ? ?8 ? ?4
> [2,] ? 19 ? 15 ? 11 ? ?7 ? ?3
> [3,] ? 18 ? 14 ? 10 ? ?6 ? ?2
> [4,] ? 17 ? 13 ? ?9 ? ?5 ? ?1
>
> [[3]]
> ? ? [,1] [,2] [,3] [,4] [,5]
> [1,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
> [2,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
> [3,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
> [4,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
> [5,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
>
> [[4]]
> [1] 5
>
> [[5]]
> [1] 4
>
>
> Linux Ubuntu 8.04 and use compiler gfortran 4.2.
> The problem is the compiler?
>
> Thanks!
>
> ? ???????????? F?bio Mathias Corr?a
> Estat?stica e Experimenta??o Agropecu?ria/UFLA
> ? ? ? ? ? ? ? ? ? ? ?Brazil
>
>
> ? ? ?____________________________________________________________________________________
> Veja quais s?o os assuntos do momento no Yahoo! +Buscados
> http://br.maisbuscados.yahoo.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/


From fabio.ufla at yahoo.com.br  Fri Aug 14 11:37:09 2009
From: fabio.ufla at yahoo.com.br (=?iso-8859-1?Q?Fabio_Mathias_Corr=EAa?=)
Date: Fri, 14 Aug 2009 02:37:09 -0700 (PDT)
Subject: [Rd]  Problem with function in fortran 95
In-Reply-To: <3c12769c0908140219y2c0f176eqca21d774082078bb@mail.gmail.com>
Message-ID: <925090.54232.qm@web59711.mail.ac4.yahoo.com>

Thanks very much!!!

? ???????????? F?bio Mathias Corr?a
Estat?stica e Experimenta??o Agropecu?ria/UFLA



--- Em sex, 14/8/09, Simone Giannerini <sgiannerini at gmail.com> escreveu:

> De: Simone Giannerini <sgiannerini at gmail.com>
> Assunto: Re: [Rd] Problem with function in fortran 95
> Para: "Fabio Mathias Corr?a" <fabio.ufla at yahoo.com.br>
> Cc: r-devel at r-project.org
> Data: Sexta-feira, 14 de Agosto de 2009, 9:19
> Fabio,
> 
> I see two problems with your code:
> 
> 1. R type numeric corresponds to FORTRAN Real*8 (or double
> precision)
> so that line 4 of your mat.f95 becomes:
> 
> REAL*8 :: x, y, res
> 
> 2. your R code won't ever succeed because you pass integer
> matrices
> (x,y,res) to a subroutine that expects REAL*8 data.
> you need to coerce all your matrices to "double" as
> follows:
> 
> storage.mode(x) <- "double"
> storage.mode(y) <- "double"
> storage.mode(res) <- "double"
> 
> Finally, you can call the corrected function:
> 
> .Fortran("mymult", x,y,res,as.integer(l),as.integer(c))
> [[1]]
> ? ???[,1] [,2] [,3] [,4]
> [1,]? ? 1? ?
> 6???11???16
> [2,]? ? 2? ?
> 7???12???17
> [3,]? ? 3? ?
> 8???13???18
> [4,]? ? 4? ?
> 9???14???19
> [5,]? ?
> 5???10???15???20
> 
> [[2]]
> ? ???[,1] [,2] [,3] [,4] [,5]
> [1,]???20???16???12?
> ? 8? ? 4
> [2,]???19???15???11?
> ? 7? ? 3
> [3,]???18???14???10?
> ? 6? ? 2
> [4,]???17???13? ?
> 9? ? 5? ? 1
> 
> [[3]]
> ? ???[,1] [,2] [,3] [,4] [,5]
> [1,]? 604? 468? 332?
> 196???60
> [2,]? 678? 526? 374?
> 222???70
> [3,]? 752? 584? 416?
> 248???80
> [4,]? 826? 642? 458?
> 274???90
> [5,]? 900? 700? 500? 300? 100
> 
> [[4]]
> [1] 5
> 
> [[5]]
> [1] 4
> 
> 
> All these issues are discussed in the "Writing R
> Extensions" manual,
> please read it carefully.
> 
> Ciao
> 
> Simone
> 
> 
> 
> On Wed, Aug 12, 2009 at 1:32 PM, Fabio Mathias
> Corr?a<fabio.ufla at yahoo.com.br>
> wrote:
> > I am writing a function in fortran 95, but the
> intrinsic function MATMUL is not working properly. Here's an
> example.
> >
> > ? ? ? ?SUBROUTINE mymult(x,y,res,m,n)
> > ? ? ? ?IMPLICIT NONE
> > ? ? ? ?INTEGER :: m,n
> > ? ? ? ?REAL :: x, y, res
> > ? ? ? ?DIMENSION :: x(m,n), y(n,m), res(m,m)
> > ? ? ? ?res = MATMUL(x,y)
> > ? ? ? ?END SUBROUTINE mymult
> >
> > R CMD SHLIB mat.f95
> >
> > In R:
> >
> > dyn.load("mat.so")
> > x ? <- matrix(1:20,5)
> > l ? <- nrow(x)
> > c ? <- ncol(x)
> > y ? <- matrix(20:1,c)
> > res <- matrix(0,l,l)
> > dim(x)
> > dim(y)
> > dim(res)
> > l
> > c
> > .Fortran("mymult", x,y,res,l,c)
> >
> > [[1]]
> > ? ? [,1] [,2] [,3] [,4]
> > [1,] ? ?1 ? ?6 ? 11 ? 16
> > [2,] ? ?2 ? ?7 ? 12 ? 17
> > [3,] ? ?3 ? ?8 ? 13 ? 18
> > [4,] ? ?4 ? ?9 ? 14 ? 19
> > [5,] ? ?5 ? 10 ? 15 ? 20
> >
> > [[2]]
> > ? ? [,1] [,2] [,3] [,4] [,5]
> > [1,] ? 20 ? 16 ? 12 ? ?8 ? ?4
> > [2,] ? 19 ? 15 ? 11 ? ?7 ? ?3
> > [3,] ? 18 ? 14 ? 10 ? ?6 ? ?2
> > [4,] ? 17 ? 13 ? ?9 ? ?5 ? ?1
> >
> > [[3]]
> > ? ? [,1] [,2] [,3] [,4] [,5]
> > [1,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
> > [2,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
> > [3,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
> > [4,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
> > [5,] ? ?0 ? ?0 ? ?0 ? ?0 ? ?0
> >
> > [[4]]
> > [1] 5
> >
> > [[5]]
> > [1] 4
> >
> >
> > Linux Ubuntu 8.04 and use compiler gfortran 4.2.
> > The problem is the compiler?
> >
> > Thanks!
> >
> > ? ???????????? F?bio Mathias Corr?a
> > Estat?stica e Experimenta??o Agropecu?ria/UFLA
> > ? ? ? ? ? ? ? ? ? ? ?Brazil
> >
> >
> > ? ?
> ?____________________________________________________________________________________
> > Veja quais s?o os assuntos do momento no Yahoo!
> +Buscados
> > http://br.maisbuscados.yahoo.com
> >
> > ______________________________________________
> > R-devel at r-project.org
> mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> 
> 
> -- 
> ______________________________________________________
> 
> Simone Giannerini
> Dipartimento di Scienze Statistiche "Paolo Fortunati"
> Universita' di Bologna
> Via delle belle arti 41 - 40126? Bologna,? ITALY
> Tel: +39 051 2098262? Fax: +39 051 232153
> http://www2.stat.unibo.it/giannerini/
> ______________________________________________________
> 


      ____________________________________________________________________________________
Veja quais s?o os assuntos do momento no Yahoo! +Buscados
http://br.maisbuscados.yahoo.com


From wavexx at users.sf.net  Fri Aug 14 11:45:24 2009
From: wavexx at users.sf.net (Yuri D'Elia)
Date: Fri, 14 Aug 2009 11:45:24 +0200
Subject: [Rd] memory management
References: <20090705165445.68dae639@abz8111lx.eurac.edu>
	<8ec76080907051259q4744d40bp46b2434b086d5adc@mail.gmail.com>
	<wavexx-F25043.00135406072009@ger.gmane.org>
	<20090813180927.29ca988b@abz8111lx.eurac.edu>
	<061FA083-980C-4A3F-97CA-51E700AB27C8@r-project.org>
Message-ID: <20090814114524.075237b3@abz8111lx.eurac.edu>

On Thu, 13 Aug 2009 13:42:39 -0400
Simon Urbanek <simon.urbanek at r-project.org> wrote:

> I'm not convinced that what you propose is a good idea. First, I
> don't quite understand why you would want to use an existing SEXP -
> if you had a valid SEXP for the current R instance, then there is no
> need for R_RegisterObject. If the SEXP is from a different R instance

What I need is being able to map an arbitrary memory region containing
primitive data types to a SEXP. I basically need zero copy.

Maybe the function name is misleading. I don't really care about
sharing the SEXP itself between instances, I just want to share the
content of course.

What I'm doing now is pre-calculating the space needed for the SEXP
header, so that DATA_PTR is exactly at page boundaries. Every process
then gets his own copy of the SEXP structure (which is initialized in
each instance), but shares the content. This wastes a page for every
SEXP structure, but it's worth it considering the size of the array.

> What you possibly want (AFAIR) is a special allocVector version for  
> primitive types that defines the memory location in advance, so you  
> could specify a COW memmapped region used by the SEXP from the other  
> instance. Still, in either case you can only share primitive types  

An allocVector-like interface would be the same for me:

  SEXP* allocVector(type, n, void* ptr)

though I would still need to know the offset from where the data
starts.

Right know, I'm doing the work of allocVector in the extension, and
then calling R_RegisterObject. Using allocVector(type, n, ptr) is
certainly more sane.

> (INTSXP, REALSXP, LGLSXP, CPLXSXP) because anything more complex  
> (VECSXP, STRSXP, ...) requires you to re-map the payload as well and  
> you're back in the trouble of dependent SEXPs. But maybe I'm missing  

I'm aware of this, but that's enough.
I handled strings by normally calling allocVector and creating copies.

> PS: In addition, I think your implementation of R_UnregisterObject
> is too dangerous and superfluous - AFAICS it will break if there
> happens to exist a reference to the node (which you have no control
> of) since you unsnap it unconditionally. It also makes it impossible
> to use a finalizer, because you're forcefully preserving the object
> from collection (R actually allows double-release but you should not
> rely on it). Normally, you should not need R_UnregisterObject at
> all, because the GC should take care of it once you release it.

I see. I don't want the GC to take any action on the node however,
since trying to free() would fail, and re-using the content would
duplicate shared pages.

Would unsnapping the object from a finalizer be a good solution
instead or using R_[Un]ProtectObject?


From ripley at stats.ox.ac.uk  Fri Aug 14 13:03:27 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Aug 2009 12:03:27 +0100 (BST)
Subject: [Rd] (PR#13789) possible agrep bug; R 2.9.1, Mac OS X 10.5
In-Reply-To: <20090630160010.01DF6282C761@mail.pubhealth.ku.dk>
References: <20090630160010.01DF6282C761@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0908141158490.15702@gannet.stats.ox.ac.uk>

It transpires this had nothing to do with 'Mac OS X 10.5' (sic, 'ten 
ten'): it is a 32-bit vs 64-bit issue, and I could not reproduce it 
even on Mac OS 10.5 with a 64-bit build.

The difference is simply the size of 'long' used for internal 
calculations in the apse.c code, and it seems that has a bug in that 
it silently overflows.  I'm not going looking for that bug (patches 
welcome ...) but I will arrange that 64-bit longs are used on 32-bit 
platforms, including in the upcoming 2.9.2.

On Tue, 30 Jun 2009, e.leoni at gmail.com wrote:

> Same behavior was noted on R 2.9.0 OS X and WIndows.
>
>> t(sapply(seq(0.01, .99, length=20), function(x) c(x, length(agrep("Staatssekretar im Bundeskanzleramt","Bundeskanzler",max.distance=x)))))
> [1,] 0.01000000    0
> [2,] 0.06157895    0
> [3,] 0.11315789    0
> [4,] 0.16473684    0
> [5,] 0.21631579    0
> [6,] 0.26789474    0
> [7,] 0.31947368    0
> [8,] 0.37105263    0
> [9,] 0.42263158    0
> [10,] 0.47421053    0
> [11,] 0.52578947    0
> [12,] 0.57736842    0
> [13,] 0.62894737    1
> [14,] 0.68052632    1
> [15,] 0.73210526    1
> [16,] 0.78368421    1
> [17,] 0.83526316    1
> [18,] 0.88684211    0   ## NOTE that there is a match reported with a
> threshold _lower_ than this!
> [19,] 0.93842105    0
> [20,] 0.99000000    1
>
> --please do not edit the information below--
>
> Version:
> platform = i386-apple-darwin8.11.1
> arch = i386
> os = darwin8.11.1
> system = i386, darwin8.11.1
> status =
> major = 2
> minor = 9.1
> year = 2009
> month = 06
> day = 26
> svn rev = 48839
> language = R
> version.string = R version 2.9.1 (2009-06-26)
>
> Locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>
> Search Path:
> .GlobalEnv, package:stats, package:graphics, package:grDevices,
> package:utils, package:datasets, package:methods, Autoloads,
> package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From peter.ruckdeschel at web.de  Fri Aug 14 14:37:52 2009
From: peter.ruckdeschel at web.de (Peter Ruckdeschel)
Date: Fri, 14 Aug 2009 14:37:52 +0200
Subject: [Rd] Awkward escaping with five backslashes within \code{ } in
 new parse_Rd
In-Reply-To: <4A820152.9060201@stats.uwo.ca>
References: <h5spui$dmq$1@ger.gmane.org> <4A820152.9060201@stats.uwo.ca>
Message-ID: <h63lr0$md5$1@ger.gmane.org>

Dear R-devels,
dear Duncan,

just to close this thread...

> Peter Ruckdeschel wrote:
>> Hi R-devels,
>>
>> I noticed that you are working quite actively on the new Rd-parser
>> and have made it the default renderer in R-2.10.0dev. So I would
>> like to come back on an issue I have already raised on this list
>> last November
>>
>> ("Two minor escaping issues using \preformatted{....} in Rd format")
>>
>> My setting has slightly changed as \preformatted, AFAICS is not
>> supported within \describe environments, so I have switched to
>> \code{} ...
>>
>> The issue is again the correct typesetting of
>>
>>
>>             \\\\\%
>>
>> within a \code{}-tag.
>>
>> This sequence occurs within a string (hence valid R code) in the
>> documentation to my CRAN package SweaveListingUtils.
>>   
> 
> That's not valid R code within a string, because \% is not a valid escape.
> 

This was indeed the issue.

Omitting the fifth backslash respectively solved it.


> I think this is a case where you are not going to be able to find
> something that is compatible with both the old and new systems.  If you
> want to know how to get particular output in the new system, I'd be
> happy to help:  just tell me exactly what you want.
>> So far the new parser cannot swallow such sequences
>> of 5 backslashes followed by a percent sign correctly, but rather
>> still throws an error;
>>
>> as the former parser, it can digest it if I leave a space between the
>> fourth and fifth backslash, but then also prints this space out what is
>> not what I want.
>>
>> Now admittedly this is not an urgent question, but if you are
>> working on the parser anyway, you might perhaps try to make my
>> sequence digestible, too.
> 
> I need more information about what you want the output to look like, in
> text, for example.  

In an offline mail, I had sent links to the corresponding .Rd files
directly to Duncan, who then checked that the solution given
produced parsed code as desired.

> Because the Rd format is so ornate, I need more than
> just the particular string:  please send me the surrounding text, what
> your intentions are, and a large payment in unmarked bills.  Or at least
> the first two.

I think I now owe some bills to Duncan ;-)

[thanks to him once again!]

Best, Peter


From murdoch at stats.uwo.ca  Fri Aug 14 15:24:15 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 14 Aug 2009 09:24:15 -0400
Subject: [Rd] Awkward escaping with five backslashes within \code{ } in
 new parse_Rd
In-Reply-To: <h63lr0$md5$1@ger.gmane.org>
References: <h5spui$dmq$1@ger.gmane.org> <4A820152.9060201@stats.uwo.ca>
	<h63lr0$md5$1@ger.gmane.org>
Message-ID: <4A85657F.9090203@stats.uwo.ca>

On 8/14/2009 8:37 AM, Peter Ruckdeschel wrote:
> Dear R-devels,
> dear Duncan,
> 
> just to close this thread...
> 
>> Peter Ruckdeschel wrote:
>>> Hi R-devels,
>>>
>>> I noticed that you are working quite actively on the new Rd-parser
>>> and have made it the default renderer in R-2.10.0dev. So I would
>>> like to come back on an issue I have already raised on this list
>>> last November
>>>
>>> ("Two minor escaping issues using \preformatted{....} in Rd format")
>>>
>>> My setting has slightly changed as \preformatted, AFAICS is not
>>> supported within \describe environments, so I have switched to
>>> \code{} ...
>>>
>>> The issue is again the correct typesetting of
>>>
>>>
>>>             \\\\\%
>>>
>>> within a \code{}-tag.
>>>
>>> This sequence occurs within a string (hence valid R code) in the
>>> documentation to my CRAN package SweaveListingUtils.
>>>   
>> 
>> That's not valid R code within a string, because \% is not a valid escape.
>> 
> 
> This was indeed the issue.
> 
> Omitting the fifth backslash respectively solved it.
> 
> 
>> I think this is a case where you are not going to be able to find
>> something that is compatible with both the old and new systems.  If you
>> want to know how to get particular output in the new system, I'd be
>> happy to help:  just tell me exactly what you want.
>>> So far the new parser cannot swallow such sequences
>>> of 5 backslashes followed by a percent sign correctly, but rather
>>> still throws an error;
>>>
>>> as the former parser, it can digest it if I leave a space between the
>>> fourth and fifth backslash, but then also prints this space out what is
>>> not what I want.
>>>
>>> Now admittedly this is not an urgent question, but if you are
>>> working on the parser anyway, you might perhaps try to make my
>>> sequence digestible, too.
>> 
>> I need more information about what you want the output to look like, in
>> text, for example.  
> 
> In an offline mail, I had sent links to the corresponding .Rd files
> directly to Duncan, who then checked that the solution given
> produced parsed code as desired.
> 
>> Because the Rd format is so ornate, I need more than
>> just the particular string:  please send me the surrounding text, what
>> your intentions are, and a large payment in unmarked bills.  Or at least
>> the first two.
> 
> I think I now owe some bills to Duncan ;-)

It's okay.  Yesterday I came across a bug in the handling of backslashes 
in parse_Rd that didn't cause a lot of harm, but certainly caused 
confusing behaviour.

Duncan Murdoch


From jjdonald at indiana.edu  Sat Aug 15 05:13:24 2009
From: jjdonald at indiana.edu (Justin Donaldson)
Date: Fri, 14 Aug 2009 23:13:24 -0400
Subject: [Rd] eurodist example dataset is malformed
In-Reply-To: <1250153327.2828.12.camel@desktop2.simpson>
References: <eda626a30908121726i16cd3455r6ae64ac8702590c7@mail.gmail.com>
	<1250153327.2828.12.camel@desktop2.simpson>
Message-ID: <eda626a30908142013k1bb67874r83bd215aa8b93790@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090814/fd19c003/attachment.pl>

From groemp at tfh-berlin.de  Fri Aug 14 09:04:10 2009
From: groemp at tfh-berlin.de (=?UTF-8?Q?Ulrike_Gr=C3=B6mping?=)
Date: Fri, 14 Aug 2009 00:04:10 -0700 (PDT)
Subject: [Rd] Class design as used in package graphics
In-Reply-To: <24955121.post@talk.nabble.com>
References: <24955121.post@talk.nabble.com>
Message-ID: <24967188.post@talk.nabble.com>


Just found the answer myself, I thought I had looked in the white book a long
time ago, but apparently didn't or didn't do it right. The class is
documented in the white book.

Regards, Ulrike


Ulrike Gr?mping wrote:
> 
> Dear developeRs,
> 
> I just discovered the function plot.design in package graphics that acts
> as a method for class design - the second time I come across a class
> design outside my own packages. (The first time was in package
> conf.design, where Bill Venables encouraged me to ignore it because he
> does not really use it.) 
> 
> Where can I find out more about the nature of the class design for which
> function plot.design is written ? 
> 
> I am thinking of writing a function for my own packages that allows users
> to choose between data frame plotting and the function plot.design from
> package graphics; for this, it would be very helpful to understand what
> class design consists of.
> 
> Thanks and regards,
> Ulrike
> 
> 
> 

-- 
View this message in context: http://www.nabble.com/Class-design-as-used-in-package-graphics-tp24955121p24967188.html
Sent from the R devel mailing list archive at Nabble.com.


From michaell at unimelb.edu.au  Fri Aug 14 01:35:14 2009
From: michaell at unimelb.edu.au (michaell at unimelb.edu.au)
Date: Fri, 14 Aug 2009 01:35:14 +0200 (CEST)
Subject: [Rd] power.t.test (PR#13891)
Message-ID: <20090813233514.62E9E282EF50@mail.pubhealth.ku.dk>

Full_Name: Michael J. Lew
Version: R version 2.9.1 (2009-06-26)
OS: OS X
Submission from: (NULL) (210.49.195.149)


The default function power.t.test gives inaccurate values, particularly with
large sig.level.
There are two reasons for me to propose that power.t.test is inaccurate: 

1. When sig.level approaches 1, so should the power. However,
power.t.test('n'=5,'d'=1,'sig.level'=1) yields a power of 0.9430769. I've
compared it to the equivalent function in the 'pwr' package, pwr.t.test, and
while power.t.test gives a smooth function with respect to sig.level, it
deivates systematically more and more as sig.level is increased.
pwr.t.test('n'=5,'d'=1,'sig.level'=1) gives the correct power of 1.

2. I've run empirical simulations and found that the power predicted by
pwr.t.test is correct and so it is clear that power.t.test is inaccurate.


From info at aghmed.fsnet.co.uk  Sat Aug 15 14:42:56 2009
From: info at aghmed.fsnet.co.uk (Michael Dewey)
Date: Sat, 15 Aug 2009 13:42:56 +0100
Subject: [Rd] power.t.test (PR#13891)
In-Reply-To: <20090813233514.62E9E282EF50@mail.pubhealth.ku.dk>
References: <20090813233514.62E9E282EF50@mail.pubhealth.ku.dk>
Message-ID: <Zen-1McIbE-0002z8-1r@smarthost03.mail.zen.net.uk>

At 00:35 14/08/2009, michaell at unimelb.edu.au wrote:

>Full_Name: Michael J. Lew
>Version: R version 2.9.1 (2009-06-26)
>OS: OS X
>Submission from: (NULL) (210.49.195.149)
>
>
>The default function power.t.test gives inaccurate values, particularly with
>large sig.level.
>There are two reasons for me to propose that power.t.test is inaccurate:
>
>1. When sig.level approaches 1, so should the power. However,
>power.t.test('n'=5,'d'=1,'sig.level'=1) yields a power of 0.9430769. I've
>compared it to the equivalent function in the 'pwr' package, pwr.t.test, and
>while power.t.test gives a smooth function with respect to sig.level, it
>deivates systematically more and more as sig.level is increased.
>pwr.t.test('n'=5,'d'=1,'sig.level'=1) gives the correct power of 1.

I think you need to set strict=TRUE when your example gives a power of 1 here.


>2. I've run empirical simulations and found that the power predicted by
>pwr.t.test is correct and so it is clear that power.t.test is inaccurate.
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel

Michael Dewey
http://www.aghmed.fsnet.co.uk


From p.dalgaard at biostat.ku.dk  Sat Aug 15 16:14:10 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 15 Aug 2009 16:14:10 +0200
Subject: [Rd] power.t.test (PR#13891)
In-Reply-To: <Zen-1McIbE-0002z8-1r@smarthost03.mail.zen.net.uk>
References: <20090813233514.62E9E282EF50@mail.pubhealth.ku.dk>
	<Zen-1McIbE-0002z8-1r@smarthost03.mail.zen.net.uk>
Message-ID: <4A86C2B2.2060401@biostat.ku.dk>

Michael Dewey wrote:
> At 00:35 14/08/2009, michaell at unimelb.edu.au wrote:
> 
>> Full_Name: Michael J. Lew
>> Version: R version 2.9.1 (2009-06-26)
>> OS: OS X
>> Submission from: (NULL) (210.49.195.149)
>>
>>
>> The default function power.t.test gives inaccurate values, 
>> particularly with
>> large sig.level.
>> There are two reasons for me to propose that power.t.test is inaccurate:
>>
>> 1. When sig.level approaches 1, so should the power. However,
>> power.t.test('n'=5,'d'=1,'sig.level'=1) yields a power of 0.9430769. I've
>> compared it to the equivalent function in the 'pwr' package, 
>> pwr.t.test, and
>> while power.t.test gives a smooth function with respect to sig.level, it
>> deivates systematically more and more as sig.level is increased.
>> pwr.t.test('n'=5,'d'=1,'sig.level'=1) gives the correct power of 1.
> 
> I think you need to set strict=TRUE when your example gives a power of 1 
> here.

Thanks. Yes. strict=TRUE was designed for people bothered by the 
behaviour as d approaches zero, but this is essentially the same issue. 
I do find it somewhat odd that people take Neyman-Pearson theory so 
literally that they insist on counting rejections with the opposite sign 
as the truth as "successes"...




-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From landronimirc at gmail.com  Sun Aug 16 12:38:40 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Sun, 16 Aug 2009 11:38:40 +0100
Subject: [Rd] Printing the null hypothesis
Message-ID: <68b1e2610908160338k3b5634acu675c26144d2bb43e@mail.gmail.com>

Dear R developers,
Currently many (all?) test functions in R describe the alternative
hypothesis, but not the the null hypothesis being tested. For example,
cor.test:
> require(boot)
> data(mtcars)
> with(mtcars, cor.test(mpg, wt, met="kendall"))

	Kendall's rank correlation tau

data:  mpg and wt
z = -5.7981, p-value = 0.000000006706
alternative hypothesis: true tau is not equal to 0
sample estimates:
     tau
-0.72783

Warning message:
In cor.test.default(mpg, wt, met = "kendall") :
  Cannot compute exact p-value with ties


In this example,
H0: (not printed)
Ha: true tau is not equal to 0

This should be fine for the advanced users and expert statisticians,
but not for beginners. The help page will also often not explicitely
state the null hypothesis. Personally, I often find myself in front of
an htest object guessing what the null should have reasonably sounded
like.

Are there compelling reasons for not printing out the null being
tested, along with the rest of the results? Thank you
Liviu





-- 
Do you know how to read?
http://www.alienetworks.com/srtest.cfm
Do you know how to write?
http://garbl.home.comcast.net/~garbl/stylemanual/e.htm#e-mail


From Ted.Harding at manchester.ac.uk  Sun Aug 16 12:55:20 2009
From: Ted.Harding at manchester.ac.uk ( (Ted Harding))
Date: Sun, 16 Aug 2009 11:55:20 +0100 (BST)
Subject: [Rd] Printing the null hypothesis
In-Reply-To: <68b1e2610908160338k3b5634acu675c26144d2bb43e@mail.gmail.com>
Message-ID: <XFMail.090816115520.Ted.Harding@manchester.ac.uk>

On 16-Aug-09 10:38:40, Liviu Andronic wrote:
> Dear R developers,
> Currently many (all?) test functions in R describe the alternative
> hypothesis, but not the the null hypothesis being tested. For example,
> cor.test:
>> require(boot)
>> data(mtcars)
>> with(mtcars, cor.test(mpg, wt, met="kendall"))
> 
>       Kendall's rank correlation tau
> 
> data:  mpg and wt
> z = -5.7981, p-value = 0.000000006706
> alternative hypothesis: true tau is not equal to 0
> sample estimates:
>      tau
> -0.72783
> 
> Warning message:
> In cor.test.default(mpg, wt, met = "kendall") :
>   Cannot compute exact p-value with ties
> 
> 
> In this example,
> H0: (not printed)
> Ha: true tau is not equal to 0
> 
> This should be fine for the advanced users and expert statisticians,
> but not for beginners. The help page will also often not explicitely
> state the null hypothesis. Personally, I often find myself in front of
> an htest object guessing what the null should have reasonably sounded
> like.
> 
> Are there compelling reasons for not printing out the null being
> tested, along with the rest of the results? Thank you
> Liviu

I don't know about *compelling* reasons! But (as a general rule)
if the Alternative Hyptohesis is stated, then the Null Hypothesis
is simply its negation. So, in your example, you can infer

  H0: true tau equals 0
  Ha: true tau is not equal to 0.

I don't think one needs to be an advanced user or expert statistician
to see this -- it is part of the basic understanding of hypothesis
testing.

Some people might regard the "H0" statement as simply redundant!

The "Ha" statement is, however, essential, since different alterntatives
may ne adopted depending on the application such as

  Ha: true tau is greater than 0
  (implicit: true tau <= 0)

or
  Ha: tru tau is less than 0
  (implicit: true tau >= 0)

Hoping this helps,
Ted.

--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 16-Aug-09                                       Time: 11:55:15
------------------------------ XFMail ------------------------------


From landronimirc at gmail.com  Sun Aug 16 16:06:18 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Sun, 16 Aug 2009 15:06:18 +0100
Subject: [Rd] Printing the null hypothesis
In-Reply-To: <XFMail.090816115520.Ted.Harding@manchester.ac.uk>
References: <68b1e2610908160338k3b5634acu675c26144d2bb43e@mail.gmail.com>
	<XFMail.090816115520.Ted.Harding@manchester.ac.uk>
Message-ID: <68b1e2610908160706j5c24c253w7c8fa236ec63e5cc@mail.gmail.com>

Hello,

On 8/16/09, Ted Harding <Ted.Harding at manchester.ac.uk> wrote:
> I don't know about *compelling* reasons! But (as a general rule)
>  if the Alternative Hyptohesis is stated, then the Null Hypothesis
>  is simply its negation. So, in your example, you can infer
>
>   H0: true tau equals 0
>   Ha: true tau is not equal to 0.
>
Oh, I had a slightly different H0 in mind. In the given example,
cor.test(..., met="kendall") would test "H0: x and y are independent",
but cor.test(..., met="pearson") would test: "H0: x and y are not
correlated (or `are linearly independent')" .

To take a different example, a test of normality.
> shapiro.test(mtcars$wt)

	Shapiro-Wilk normality test

data:  mtcars$wt
W = 0.9433, p-value = 0.09265

Here both "H0: x is normal" and "Ha: x is not normal" are missing. At
least to beginners, these things are not always perfectly clear (even
after reading the documentation), and when interpreting the results it
can prove useful to have on-screen information about the null.


Thank you for answering
Liviu


From Ted.Harding at manchester.ac.uk  Sun Aug 16 17:26:52 2009
From: Ted.Harding at manchester.ac.uk ( (Ted Harding))
Date: Sun, 16 Aug 2009 16:26:52 +0100 (BST)
Subject: [Rd] Printing the null hypothesis
In-Reply-To: <68b1e2610908160706j5c24c253w7c8fa236ec63e5cc@mail.gmail.com>
Message-ID: <XFMail.090816162652.Ted.Harding@manchester.ac.uk>

On 16-Aug-09 14:06:18, Liviu Andronic wrote:
> Hello,
> On 8/16/09, Ted Harding <Ted.Harding at manchester.ac.uk> wrote:
>> I don't know about *compelling* reasons! But (as a general rule)
>>  if the Alternative Hyptohesis is stated, then the Null Hypothesis
>>  is simply its negation. So, in your example, you can infer
>>
>>   H0: true tau equals 0
>>   Ha: true tau is not equal to 0.
>>
> Oh, I had a slightly different H0 in mind. In the given example,
> cor.test(..., met="kendall") would test "H0: x and y are independent",
> but cor.test(..., met="pearson") would test: "H0: x and y are not
> correlated (or `are linearly independent')" .

Ah, now you are playing with fire! What the Pearson, Kendall and
Spearman coefficients in cor.test measure is *association*. OK, if
the results clearly indicate association, then the variables are
not independent. But it is possible to have two variables x, y
which are definitely not independent (indeed one is a function of
the other) which yield zero association by any of these measures.

Example:
  x <-  (-10:10) ; y <- x^2 - mean(x^2)
  cor.test(x,y,method="pearson")
  #       Pearson's product-moment correlation
  # t = 0, df = 19, p-value = 1
  # alternative hypothesis: true correlation is not equal to 0 
  # sample estimates: cor 0
  cor.test(x,y,method="kendall")
  #       Kendall's rank correlation tau
  # z = 0, p-value = 1
  # alternative hypothesis: true tau is not equal to 0 
  # sample estimates: tau 0
  # cor.test(x,y,method="spearman")
  #      Spearman's rank correlation rho
  # S = 1540, p-value = 1
  # alternative hypothesis: true rho is not equal to 0 
  # sample estimates: rho 0

If you wanted, for instance, that the "method=kendall" should
announce that it is testing "H0: x and y are independent" then
it would seriously mislead the reader!

> To take a different example, a test of normality.
>> shapiro.test(mtcars$wt)
> 
>       Shapiro-Wilk normality test
> 
> data:  mtcars$wt
> W = 0.9433, p-value = 0.09265
> 
> Here both "H0: x is normal" and "Ha: x is not normal" are missing. At
> least to beginners, these things are not always perfectly clear (even
> after reading the documentation), and when interpreting the results it
> can prove useful to have on-screen information about the null.
> 
> Thank you for answering
> Liviu

This is possibly a more discussable point, in that even if you know
what the Shapiro-Wilk statistic is, it is not obvious what it is
sensitive to, and hence what it might be testing for. But I doubt
that someone would be led to try the Shapiro-Wilk test in the
first place unless they were aware that it was a test for normality,
and indeded this is announced in the first line of the response.
The alternative, therefore, is "non-normality".

As to the contrast between absence of an "Ha" statement for the
Shapiro-Wilk, and its presence in cor,test(), this comes back to
the point I made earlier: cot.test() offers you three alternatives
to choose from: "two-sided" (default), "greater", "less". This
distinction can be important, and when cor.test() reports "Ha" it
tells you which one was used.

On the other hand, as far as Shapiro-Wilk is concerned there is
no choice of alternatives (nor of anything else except the data x).
So there is nothing to tell you! And, further, departure from
normality has so many "dimensions" that alternatives like "two
sided", "greater" or "less" would make no sense. One can think of
tests targeted at specific kinds of alternative such as "Distribution
is excessively skew" or "distribution has excessive kurtosis" or
"distribution is bimodal" or "distribution is multimodal", and so on.
But any of these can be detected by Shapiro-Wilk, so it is not
targeted at any specific alternative.

Best wishes,
Ted.

--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 16-Aug-09                                       Time: 16:26:48
------------------------------ XFMail ------------------------------


From landronimirc at gmail.com  Sun Aug 16 18:30:15 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Sun, 16 Aug 2009 17:30:15 +0100
Subject: [Rd] Printing the null hypothesis
In-Reply-To: <XFMail.090816162652.Ted.Harding@manchester.ac.uk>
References: <68b1e2610908160706j5c24c253w7c8fa236ec63e5cc@mail.gmail.com>
	<XFMail.090816162652.Ted.Harding@manchester.ac.uk>
Message-ID: <68b1e2610908160930j5c3f5157i5ee2f824fb4c9026@mail.gmail.com>

On 8/16/09, Ted Harding <Ted.Harding at manchester.ac.uk> wrote:
>  > Oh, I had a slightly different H0 in mind. In the given example,
>  > cor.test(..., met="kendall") would test "H0: x and y are independent",
>  > but cor.test(..., met="pearson") would test: "H0: x and y are not
>  > correlated (or `are linearly independent')" .
>
>
> Ah, now you are playing with fire! What the Pearson, Kendall and
>  Spearman coefficients in cor.test measure is *association*. OK, if
> the results clearly indicate association, then the variables are
>  not independent. But it is possible to have two variables x, y
>  which are definitely not independent (indeed one is a function of
>  the other) which yield zero association by any of these measures.
>
>  Example:
>   x <-  (-10:10) ; y <- x^2 - mean(x^2)
>   cor.test(x,y,method="pearson")
>   #       Pearson's product-moment correlation
>   # t = 0, df = 19, p-value = 1
>   # alternative hypothesis: true correlation is not equal to 0
>   # sample estimates: cor 0
>   cor.test(x,y,method="kendall")
>
>   #       Kendall's rank correlation tau
>
>   # z = 0, p-value = 1
>   # alternative hypothesis: true tau is not equal to 0
>   # sample estimates: tau 0
>   # cor.test(x,y,method="spearman")
>   #      Spearman's rank correlation rho
>   # S = 1540, p-value = 1
>   # alternative hypothesis: true rho is not equal to 0
>   # sample estimates: rho 0
>
>  If you wanted, for instance, that the "method=kendall" should
>  announce that it is testing "H0: x and y are independent" then
>  it would seriously mislead the reader!
>
I did take the null statement from the description of
Kendall::Kendall() ("Computes the Kendall rank correlation and its
p-value on a two-sided test of H0: x and y are independent."). Here,
perhaps "monotonically independent" (as opposed to "functionally
independent") would have been more appropriate.

Still, this very example seems to support my original idea: users can
easily get confused on what is the exact null of a test. Does it test
for "association" or for "no association", for "normality" or for
"lack of normality" . Printing a precise and appropriate statement of
the null would prove helpful in interpreting the results, and in
avoiding misinterpreting these.



>  > Here both "H0: x is normal" and "Ha: x is not normal" are missing. At
>  > least to beginners, these things are not always perfectly clear (even
>  > after reading the documentation), and when interpreting the results it
>  > can prove useful to have on-screen information about the null.
>
> This is possibly a more discussable point, in that even if you know
>  what the Shapiro-Wilk statistic is, it is not obvious what it is
>  sensitive to, and hence what it might be testing for. But I doubt
>  that someone would be led to try the Shapiro-Wilk test in the
>  first place unless they were aware that it was a test for normality,
>  and indeded this is announced in the first line of the response.
>  The alternative, therefore, is "non-normality".
>
To be particularly picky, as statistics is, this is not so obvious
from the print-out. For the Shapiro-Wilk test one could indeed deduce
that since it is a "test of normality", then the null tested is "H0:
data is normal". This would not hold for, say, the Pearson
correlation. In loose language, it would estimate and test for
"correlation"; in more statistically appropriate language, it will
test for "no correlation" (or for "no association"). It feels to me
that without appropriate indicators, one can easily get playing with
fire.



>  As to the contrast between absence of an "Ha" statement for the
>  Shapiro-Wilk, and its presence in cor,test(), this comes back to
>  the point I made earlier: cot.test() offers you three alternatives
>  to choose from: "two-sided" (default), "greater", "less". This
>  distinction can be important, and when cor.test() reports "Ha" it
>  tells you which one was used.
>
>  On the other hand, as far as Shapiro-Wilk is concerned there is
>  no choice of alternatives (nor of anything else except the data x).
>  So there is nothing to tell you! And, further, departure from
>  normality has so many "dimensions" that alternatives like "two
>  sided", "greater" or "less" would make no sense. One can think of
>  tests targeted at specific kinds of alternative such as "Distribution
>  is excessively skew" or "distribution has excessive kurtosis" or
>  "distribution is bimodal" or "distribution is multimodal", and so on.
>  But any of these can be detected by Shapiro-Wilk, so it is not
>  targeted at any specific alternative.
>
Thank you for these explanations. Best
Liviu


From jari.oksanen at oulu.fi  Sun Aug 16 20:16:53 2009
From: jari.oksanen at oulu.fi (Jari Oksanen)
Date: Sun, 16 Aug 2009 21:16:53 +0300
Subject: [Rd] eurodist example dataset is malformed
In-Reply-To: <eda626a30908142013k1bb67874r83bd215aa8b93790@mail.gmail.com>
Message-ID: <C6AE27C5.2168%jari.oksanen@oulu.fi>

Justin,

I suggest you try to remove your malformed eurodist and use the one in R.
The svn logs show no changes in eurodist since 2005 when 'r' was added to
'Gibralta' (it still has all the wrong distances which perhaps go back to
the poor quality of Cambridge Encyclopaedia). I also installed R 2.9.1 for
MacOS to see that there neither is a change in 'eurodist' in the Mac
distribution. My virgin eurodist in Mac was clean, with all its errors. All
this hints that you have a local copy of malformed eurodist in your
computer. Perhaps

rm(eurodist)
eurodist

will help.

Cheers, Jari Oksanen


On 15/08/09 06:13 AM, "Justin Donaldson" <jjdonald at indiana.edu> wrote:

> Here's my osx data/session info (identical after a re-install):
> 
>> class(eurodist)
> [1] "data.frame"
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> i386-apple-darwin8.11.1
> 
> locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>> 
> 
> -Justin
> 
> 
> 
> On Thu, Aug 13, 2009 at 4:48 AM, Gavin Simpson <gavin.simpson at ucl.ac.uk>wrote:
> 
>> On Wed, 2009-08-12 at 20:26 -0400, Justin Donaldson wrote:
>>> The eurodist dataset (my favorite for mds) is malformed.  Instead of a
>>> standard distance matrix, it's a data frame.  The rownames have gotten
>>> 'bumped' to a new anonymous dimension "X".   It's possible to fix the
>> data,
>>> but it messes up a lot of example code out there.
>>> 
>>>           X Athens Barcelona Brussels Calais ...
>>> 1    Athens      0      3313     2963   3175
>>> 2 Barcelona   3313         0     1318   1326
>>> 3  Brussels   2963      1318        0    204
>>> 4    Calais   3175      1326      204      0
>>> 5 Cherbourg   3339      1294      583    460
>>> 6   Cologne   2762      1498      206    409
>>> ...
>>> 
>>> Best,
>>> -Justin
>> 
>> What version of R, platform, loaded packages etc? This is not what I see
>> on Linux, 2.9.1-patched r49104.
>> 
>>> class(eurodist)
>> [1] "dist"
>>> sessionInfo()
>> R version 2.9.1 Patched (2009-08-07 r49104)
>> x86_64-unknown-linux-gnu
>> 
>> locale:
>> 
>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;
>> LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;
>> LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods
>> base
>> 
>> loaded via a namespace (and not attached):
>> [1] tools_2.9.1
>> 
>> Have you tried this in a clean session to see if it persists there?
>> 
>> If you can reproduce this in a clean session with an up-to-date R or
>> R-Devel then send details of your R back to the list for further
>> investigation.
>> 
>> HTH
>> 
>> G
>> --
>> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>>  Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
>>  ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
>>  Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
>>  Gower Street, London          [w]
>> http://www.ucl.ac.uk/~ucfagls/<http://www.ucl.ac.uk/%7Eucfagls/>
>>  UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
>> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>> 
>> 
>> 
>


From charlie at stat.umn.edu  Mon Aug 17 00:37:49 2009
From: charlie at stat.umn.edu (Charles Geyer)
Date: Sun, 16 Aug 2009 17:37:49 -0500
Subject: [Rd] R CMD check --use-valgrind doesn't run valgrind on tests
In-Reply-To: <mailman.19.1250330405.9562.r-devel@r-project.org>
References: <mailman.19.1250330405.9562.r-devel@r-project.org>
Message-ID: <20090816223749.GA402@stat.umn.edu>

R CMD check --use-valgrind <packagename> used to run valgrind on the
tests in the tests directory of the package.  But it seems to have stopped.
R-2.9.1 doesn't -- at least on my box -- and neither does R-2.10.0 (devel).
I am not sure when this stopped.  I think 2.8.x did this.  The only old
R I have around is 2.6.0 and it certainly does.

R CMD check --help for 2.9.1 says (among other things)

    --use-valgrind    use 'valgrind' when running examples/tests/vignettes

so the documentation seems to say that the old behavior should also be
the current behavior, but it isn't -- at least on my box.

oak$ cat /etc/SuSE-release
openSUSE 11.0 (X86-64)
VERSION = 11.0
oak$ valgrind --version
valgrind-3.3.0
oak$ gcc --version
gcc (SUSE Linux) 4.3.1 20080507 (prerelease) [gcc-4_3-branch revision 135036]

If this is just a stupid user problem and not a bug, how do I get the old
behavior (valgrind is run on tests).  BTW valgrind is run on examples
under 2.9.0, as cat <packagename>.Rcheck/<packagename>-Ex.Rout shows.
-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From ripley at stats.ox.ac.uk  Mon Aug 17 11:34:55 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Aug 2009 10:34:55 +0100 (BST)
Subject: [Rd] R CMD check --use-valgrind doesn't run valgrind on tests
In-Reply-To: <20090816223749.GA402@stat.umn.edu>
References: <mailman.19.1250330405.9562.r-devel@r-project.org>
	<20090816223749.GA402@stat.umn.edu>
Message-ID: <alpine.LFD.2.00.0908171030170.24846@gannet.stats.ox.ac.uk>

This was not implemented in R 2.9.x -- the comments in check.in don't 
agree with the usage, and it seemed unlikely that anyone really wanted 
this (it can be very slow, so perhaps a test at a time?), so this was 
intentional (apart from not altering the reported usage).

I've added it back for 2.9.2.

It also showed up that R CMD BATCH -d valgrind did not work (but 
--debugger=valgrind did): also fixed for 2.9.2.

On Sun, 16 Aug 2009, Charles Geyer wrote:

> R CMD check --use-valgrind <packagename> used to run valgrind on the
> tests in the tests directory of the package.  But it seems to have stopped.
> R-2.9.1 doesn't -- at least on my box -- and neither does R-2.10.0 (devel).
> I am not sure when this stopped.  I think 2.8.x did this.  The only old
> R I have around is 2.6.0 and it certainly does.
>
> R CMD check --help for 2.9.1 says (among other things)
>
>    --use-valgrind    use 'valgrind' when running examples/tests/vignettes
>
> so the documentation seems to say that the old behavior should also be
> the current behavior, but it isn't -- at least on my box.
>
> oak$ cat /etc/SuSE-release
> openSUSE 11.0 (X86-64)
> VERSION = 11.0
> oak$ valgrind --version
> valgrind-3.3.0
> oak$ gcc --version
> gcc (SUSE Linux) 4.3.1 20080507 (prerelease) [gcc-4_3-branch revision 135036]
>
> If this is just a stupid user problem and not a bug, how do I get the old
> behavior (valgrind is run on tests).  BTW valgrind is run on examples
> under 2.9.0, as cat <packagename>.Rcheck/<packagename>-Ex.Rout shows.
> -- 
> Charles Geyer
> Professor, School of Statistics
> University of Minnesota
> charlie at stat.umn.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From chalabi at phys.ethz.ch  Mon Aug 17 13:51:20 2009
From: chalabi at phys.ethz.ch (Yohan Chalabi)
Date: Mon, 17 Aug 2009 13:51:20 +0200
Subject: [Rd] S4 Generics and NAMESPACE : justified warning ?
Message-ID: <20090817135120.16fab862@mimi>

Dear list,

It seems that a package (pkgB) using another package (pkgA) with S4
generics formed by taking existing functions (for example 'plot') must
not import the existing functions ('plot') in its namespace to avoid
the warning "replacing previous import: plot".

Suppose we use the simple 'import' directive in the name space of
pkgB.

pkgA and pkgB files would be

pkgA/NAMESPACE:
    import(graphics)
    import(methods)
    exportClasses("classA")
    exportMethods("plot")

pkgA/R/pkgA.R:
    setClass("classA", contains = "matrix")
    setMethod("plot", "classA", function(x, y, ...) NULL)

pkgB/NAMESPACE:
    import(methods)
    import(garphics)
    import(pkgA)

Loading pkgB would then generate a warning because the generic 'plot'
in pkgA overwrites the 'plot' function imported from graphics name
space :

Loading required package: pkgA
Warning message:
In namespaceImportFrom(self, asNamespace(ns)) :
  replacing previous import: plot

As far as I understood it, one must explicitly import the functions one
needs in pkgB with 'importFrom' to avoid the previous warning. In
our example, one would then take care to not import the 'plot'
function from garphics name space.

This makes the maintenance of packages using S4 packages rather
tedious because one needs to import exactly what one needs rather than
using the simple 'import' directive.

Moreover, the warning "replacing previous import:" is confusing. In this
case we have a generic replacing its existing function like
'setMethod' would do and not a function replacing another function
with the same name.

IMO it is normal that a function in a previous import can be replaced
by its generic. It should not create a warning. But a warning should
be generated when a generic is replaced by another generic.

Does this make sense ?

This could be implemented in 'namespaceImportFrom' with the patch given
bellow.

It would greatly help the maintanance of packages which use S4
packages, because one could use the simple 'import' directive rather
than 'importFrom'.

Looking forward for your comments.

Regards,
Yohan


#################################################################################

Index: src/library/base/R/namespace.R
===================================================================
--- src/library/base/R/namespace.R	(revision 49278)
+++ src/library/base/R/namespace.R	(working copy)
@@ -797,8 +797,12 @@
 	}
     }
     for (n in impnames)
-        if (exists(n, envir = impenv, inherits = FALSE))
-            warning(msg, " ", n)
+        if (exists(n, envir = impenv, inherits = FALSE)) {
+            if (.isMethodsDispatchOn() && methods:::isGeneric(n, ns)) {
+                if (methods:::isGeneric(n, impenv))
+                    warning("replacing previous generic import: ", n)
+            } else warning(msg, " ", n)
+        }
     importIntoEnv(impenv, impnames, ns, impvars)
     if (register) {
         addImports(self, ns,

#################################################################################


-- 
PhD student
Swiss Federal Institute of Technology
Zurich

www.ethz.ch


From chalabi at phys.ethz.ch  Mon Aug 17 14:00:32 2009
From: chalabi at phys.ethz.ch (Yohan Chalabi)
Date: Mon, 17 Aug 2009 14:00:32 +0200
Subject: [Rd] R CMD check --use-valgrind doesn't run valgrind on tests
In-Reply-To: <alpine.LFD.2.00.0908171030170.24846@gannet.stats.ox.ac.uk>
References: <mailman.19.1250330405.9562.r-devel@r-project.org>
	<20090816223749.GA402@stat.umn.edu>
	<alpine.LFD.2.00.0908171030170.24846@gannet.stats.ox.ac.uk>
Message-ID: <20090817140032.1fc2eb14@mimi>

>>>> "PBR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>> on Mon, 17 Aug 2009 10:34:55 +0100 (BST)

   PBR> This was not implemented in R 2.9.x -- the comments in
   PBR> check.in don't
   PBR> agree with the usage, and it seemed unlikely that anyone
   PBR> really wanted
   PBR> this (it can be very slow, so perhaps a test at a time?),
   PBR> so this was
   PBR> intentional (apart from not altering the reported usage).
   PBR>
   PBR> I've added it back for 2.9.2.
   PBR>
   PBR> It also showed up that R CMD BATCH -d valgrind did not work
   PBR> (but
   PBR> --debugger=valgrind did): also fixed for 2.9.2.


It seems that 'R CMD check' uses now by default valgrind on tests with
the recent changes.

Shouldn't valgrind be only used with 'R CMD check --use-valgrind' ?


regards,
Yohan

-- 
PhD student
Swiss Federal Institute of Technology
Zurich

www.ethz.ch


From savicky at cs.cas.cz  Tue Aug 18 08:39:42 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Tue, 18 Aug 2009 08:39:42 +0200
Subject: [Rd] user supplied random number generators
In-Reply-To: <1250537157.10115.67.camel@corn.betterworld.us>
References: <1248934873.18270.83.camel@corn.betterworld.us>
	<20090816192424.GB14615@cs.cas.cz>
	<1250537157.10115.67.camel@corn.betterworld.us>
Message-ID: <20090818063942.GA4531@cs.cas.cz>

On Mon, Aug 17, 2009 at 12:25:57PM -0700, Ross Boylan wrote:
> > Seeding by a vector is also available in the initialization of Mersenne Twister
> > from 2002. See mt19937ar.c (ar for array) at
> >   http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html
> > Unfortunately, seeding by a vector is not available in R base. R uses
> > Mersenne Twister, but with an initialization by a single number.
> I think that one could write to .Random.seed directly to set a vector
> for many of the generators.  ?.Random.seed does not recommend this and
> notes various limits and hazards of this strategy.

Initialization of a generator by writing the initial state into .Random.seed
is possible, but requires to know the exact form of the admissible states
of the generator. An error leads to a corrupted sequence. So, this is indeed
not suggested.

By seeding by a vector, i mean something different. The user provides
a vector of arbitrary length and this vector is used as an input to 
a hash function, which produces a correct initial state. The advantage
over seeding by a single number is that the set of possible initial states
is much larger already if we use a seed of length 2 or 3.

Seeding by a vector is available, for example, in Mersenne Twister from 2002
using the C function init_by_array() in mt19937ar.c.

In the package rngwell19937, the R function set.vector.seed() may be used
for the same purpose.

I will reply to the rest of your message in a private email (as was also
the email you were replying to).

Petr Savicky.


From bolker at ufl.edu  Tue Aug 18 00:03:02 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Mon, 17 Aug 2009 18:03:02 -0400
Subject: [Rd] unnecessary braces?
Message-ID: <4A89D396.9060009@ufl.edu>


  the version 2 parser thinks I have unnecessary braces,
but I can't find any.  False positive or am I missing
something?  If a false positive, is there any way to
work around the warning?

* checking Rd files against version 2 parser ... WARNING
Warning: ./man/dbetabinom.Rd:32-34: Unnecessary braces at ?{p(x) = %
(C(N,x)*Beta(N-x+theta*(1-p),x+theta*p))/%
Beta(theta*(1-p),theta*p)}?

=============
\details{
   The beta-binomial distribution is the result of
compounding a beta distribution of probabilities with
a binomial sampling process.  The density function is
\deqn{p(x) = %
\frac{C(N,x) \mbox{Beta}(N-x+\theta(1-p),x+\theta p)}%
{\mbox{Beta}(\theta(1-p),\theta p)}}%
{p(x) = %
(C(N,x)*Beta(N-x+theta*(1-p),x+theta*p))/%
Beta(theta*(1-p),theta*p)}
The parameters \code{shape1} and \code{shape2} are
the more traditional parameterization in terms of
the parameters of the per-trial probability distribution.
}

-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
bolker at ufl.edu / www.zoology.ufl.edu/bolker
GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090817/fa30dfcf/attachment.bin>

From brechbuehler at gmail.com  Mon Aug 17 22:54:25 2009
From: brechbuehler at gmail.com (=?ISO-8859-1?Q?Christian_Brechb=FChler?=)
Date: Mon, 17 Aug 2009 16:54:25 -0400
Subject: [Rd] Polymorphism of predict
Message-ID: <c0177e5a0908171354y7ad88467n4d58d5cd376ad43d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090817/befb45ea/attachment.pl>

From ross at biostat.ucsf.edu  Mon Aug 17 21:25:57 2009
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Mon, 17 Aug 2009 12:25:57 -0700
Subject: [Rd] user supplied random number generators
In-Reply-To: <20090816192424.GB14615@cs.cas.cz>
References: <1248934873.18270.83.camel@corn.betterworld.us>
	<20090816192424.GB14615@cs.cas.cz>
Message-ID: <1250537157.10115.67.camel@corn.betterworld.us>

On Sun, 2009-08-16 at 21:24 +0200, Petr Savicky wrote:
> Dear Ross Boylan:
> 
> Some time ago, you sent an email to R-devel with the following.
> > I got into this because I'm trying to extend the rsprng code; sprng
> > returns its state as a vector of bytes.  Converting these to a vector of
> > integers depends on the integer length, hence my interest in the exact
> > definiton of integer.  I'm interested in lifetime because I believe
> > those bytes are associated with the stream and become invalid when the
> > stream is freed; furthermore, I probably need to copy them into a buffer
> > that is padded to full wordlength.  This means I allocate the buffer
> > whose address is returned to the core R RNG machinery.  Eventually
> > somebody needs to free the memory.
> > 
> > Far more of my rsprng adventures are on
> > http://wiki.r-project.org/rwiki/doku.php?id=packages:cran:rsprng.  Feel
> > free to read, correct, or extend it.
> 
> I am interested to know, what is the current state of your project.
I did figure out some of the lifetime issues; SPRNG does allocate memory
when you ask it for its state.  I also realized that for several reasons
it would not be appropriate to hand that buffer to R.

I've reworked the page extensively since it had the section you quote.
See particularly the "Getting and Setting Stream State" section near the
bottom.

I submitted patches to hook rsprng into R's standard machinery for
stream state (the user visible part of which is .Random.seed).  The
package developer has reservations about applying them.

As a practical matter, I shifted my package's C code to call back to R
to get random numbers.  If rsprng is loaded and activated, my code will
use it.  I also eliminated all attempts to set the seed in my code.  For
rsprng, in its current form, the R set.seed() function is a no-op and
you have to use an rsprng function to set the seed (generally when
activating the library).
> 
> There is a package rngwell19937 with a random number generator, which i develop
> and use for several parallel processes. Setting a seed may be done by a vector,
> one of whose components is the process number. The initialization then provides
> unrelated sequences for different processes.
That sounds interesting; thanks for pointing it out.
> 
> Seeding by a vector is also available in the initialization of Mersenne Twister
> from 2002. See mt19937ar.c (ar for array) at
>   http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html
> Unfortunately, seeding by a vector is not available in R base. R uses
> Mersenne Twister, but with an initialization by a single number.
I think that one could write to .Random.seed directly to set a vector
for many of the generators.  ?.Random.seed does not recommend this and
notes various limits and hazards of this strategy.

Ross


From charlie at stat.umn.edu  Mon Aug 17 21:05:11 2009
From: charlie at stat.umn.edu (Charles Geyer)
Date: Mon, 17 Aug 2009 14:05:11 -0500
Subject: [Rd] R CMD check --use-valgrind doesn't run valgrind on tests
In-Reply-To: <alpine.LFD.2.00.0908171030170.24846@gannet.stats.ox.ac.uk>
References: <mailman.19.1250330405.9562.r-devel@r-project.org>
	<20090816223749.GA402@stat.umn.edu>
	<alpine.LFD.2.00.0908171030170.24846@gannet.stats.ox.ac.uk>
Message-ID: <20090817190511.GA4952@stat.umn.edu>

On Mon, Aug 17, 2009 at 10:34:55AM +0100, Prof Brian Ripley wrote:
> This was not implemented in R 2.9.x -- the comments in check.in don't 
> agree with the usage, and it seemed unlikely that anyone really wanted 
> this (it can be very slow, so perhaps a test at a time?), so this was 
> intentional (apart from not altering the reported usage).

Well I ran it on all of my packages just before they shipped to CRAN
as well as --use-gct if the package used .Call.  Yes it was very slow
and yes that meant shipping a new version of a package took hours.
But it did catch several bugs before they shipped.  And I thought
the whole point of regression testing was to be automatic.

> I've added it back for 2.9.2.

Thanks.  I think that's a good idea.

> It also showed up that R CMD BATCH -d valgrind did not work (but 
> --debugger=valgrind did): also fixed for 2.9.2.
> 
> On Sun, 16 Aug 2009, Charles Geyer wrote:
> 
> >R CMD check --use-valgrind <packagename> used to run valgrind on the
> >tests in the tests directory of the package.  But it seems to have stopped.
> >R-2.9.1 doesn't -- at least on my box -- and neither does R-2.10.0 (devel).
> >I am not sure when this stopped.  I think 2.8.x did this.  The only old
> >R I have around is 2.6.0 and it certainly does.
> >
> >R CMD check --help for 2.9.1 says (among other things)
> >
> >   --use-valgrind    use 'valgrind' when running examples/tests/vignettes
> >
> >so the documentation seems to say that the old behavior should also be
> >the current behavior, but it isn't -- at least on my box.

[rest deleted]

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From vitosmail at rambler.ru  Mon Aug 17 20:06:44 2009
From: vitosmail at rambler.ru (Vitalie S.)
Date: Mon, 17 Aug 2009 20:06:44 +0200
Subject: [Rd] S4: inheritance of validity methods?
Message-ID: <op.uyti9if2dacko8@tir-070312.staff.few.eur.nl>

Dear Developers,

In current implementation of validity method, objects are first coerced to  
superclass (slots are striped). Thus, it is not possible to write validity  
method which would perform some checks on children slots.

Say, I want to check if number of slots in a class is equal to "n":

setClass("A", representation(a="numeric", n="integer"),
          prototype=list(a=12, n=1L),
          validity=function(object){
              if(length(slotNames(object))!=object at n+1) paste("Number of  
slots must be ", object at n)
              else TRUE
          })


setClass("B", representation(b="numeric"), contains="A",
          prototype=list(a=12, b=14, n=2L))


new("B", a=11, b=33)
Error in validObject(.Object) :
   invalid class "B" object: Number of slots must be  2

Error, because an object of class "A" is passed to validObject with one  
slot "b" removed and n=2.

Is were a work around for this, or I am just doomed to write the same  
validity method for each children class?

Many thanks,
Vitalie.

--


From paboyoun at fhcrc.org  Mon Aug 17 19:52:13 2009
From: paboyoun at fhcrc.org (Patrick Aboyoun)
Date: Mon, 17 Aug 2009 10:52:13 -0700
Subject: [Rd] Base "Object" class to use in S4 slot specification
Message-ID: <4A8998CD.7070708@fhcrc.org>

I am looking to have slot in an S4 class definition that can take any 
(S3 or S4) object. The ANY class seemed to be a good candidate, but the 
is() function definition performs an S3Case test before checking if 
methods:::.identC(class2, "ANY"). The result is the is() function does 
not consider various S3 objects to be of class ANY.

 > is(factor(), "ANY")
[1] FALSE
 > is(lm(I(1:10) ~ rnorm(10)), "ANY")
[1] FALSE
 > sessionInfo()
R version 2.10.0 Under development (unstable) (2009-08-05 r49073)
i386-apple-darwin9.7.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

What is the recommended base "Object" class I should define my slot to 
be so it can accept any object?


Patrick


From jhallman at frb.gov  Mon Aug 17 16:23:47 2009
From: jhallman at frb.gov (Jeffrey J. Hallman)
Date: Mon, 17 Aug 2009 10:23:47 -0400
Subject: [Rd] Calling C functions with value parameters
Message-ID: <xmrws52plho.fsf@mralx1.rsma.frb.gov>

One hassle I could do without is the necessity of writing C wrapper functions
like this:

void fameInit(int *status){
  cfmini(status);
  return;
}

when I want to call a library function (cfmini, in this case) that takes an
int argument.  The .C interface only lets me pass a pointer to an int, rather
than the int itself.

Is there any chanch that .C could be enhanced to allow passing arguments by
value to the compiled code?  It would make some of my stuff much simpler.

-- 
Jeff


From ktr at goldin-rudahl.com  Tue Aug 18 11:30:12 2009
From: ktr at goldin-rudahl.com (ktr at goldin-rudahl.com)
Date: Tue, 18 Aug 2009 11:30:12 +0200 (CEST)
Subject: [Rd] error during build: lstat64 already defined (PR#13894)
Message-ID: <20090818093012.754B1283031D@mail.pubhealth.ku.dk>

Full_Name: Kurt Rudahl
Version: 2.8.1
OS: SuSE Linux 10.2, i586
Submission from: (NULL) (203.209.31.220)


During build, it halted with several errors of general form
   lstat64 already defined

After searches on the web, which revealed many people having 
similar problems in areas other then R, I conclude that:

It is caused by the fact that gcc >= 4.3 includes mpfr library,
so any existing includes of mpfr.h cause a double define.

However, I haven't been able to discover where the ref.
to mpfr is, in the R build, so I just used older (4.2)
gcc.

This appears to be specific to 32-bit compiles


From ggrothendieck at gmail.com  Tue Aug 18 12:27:46 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 18 Aug 2009 06:27:46 -0400
Subject: [Rd] unnecessary braces?
In-Reply-To: <4A89D396.9060009@ufl.edu>
References: <4A89D396.9060009@ufl.edu>
Message-ID: <971536df0908180327o4dee64b8q19bf2cecd0e32348@mail.gmail.com>

Just a guess but try writing it on one line without the % symbols.

On Mon, Aug 17, 2009 at 6:03 PM, Ben Bolker<bolker at ufl.edu> wrote:
>
> ?the version 2 parser thinks I have unnecessary braces,
> but I can't find any. ?False positive or am I missing
> something? ?If a false positive, is there any way to
> work around the warning?
>
> * checking Rd files against version 2 parser ... WARNING
> Warning: ./man/dbetabinom.Rd:32-34: Unnecessary braces at ?{p(x) = %
> (C(N,x)*Beta(N-x+theta*(1-p),x+theta*p))/%
> Beta(theta*(1-p),theta*p)}?
>
> =============
> \details{
> ? The beta-binomial distribution is the result of
> compounding a beta distribution of probabilities with
> a binomial sampling process. ?The density function is
> \deqn{p(x) = %
> \frac{C(N,x) \mbox{Beta}(N-x+\theta(1-p),x+\theta p)}%
> {\mbox{Beta}(\theta(1-p),\theta p)}}%
> {p(x) = %
> (C(N,x)*Beta(N-x+theta*(1-p),x+theta*p))/%
> Beta(theta*(1-p),theta*p)}
> The parameters \code{shape1} and \code{shape2} are
> the more traditional parameterization in terms of
> the parameters of the per-trial probability distribution.
> }
>
> --
> Ben Bolker
> Associate professor, Biology Dep't, Univ. of Florida
> bolker at ufl.edu / www.zoology.ufl.edu/bolker
> GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From murdoch at stats.uwo.ca  Tue Aug 18 12:46:15 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 18 Aug 2009 06:46:15 -0400
Subject: [Rd] unnecessary braces?
In-Reply-To: <4A89D396.9060009@ufl.edu>
References: <4A89D396.9060009@ufl.edu>
Message-ID: <4A8A8677.6070602@stats.uwo.ca>

On 17/08/2009 6:03 PM, Ben Bolker wrote:
 >   the version 2 parser thinks I have unnecessary braces,
 > but I can't find any.  False positive or am I missing
 > something?  If a false positive, is there any way to
 > work around the warning?

The problem is that % in Rd is different than % in LaTeX:  it causes a 
break.  So the comment you have at the end of the first arg to \deqn 
causes the parser to think you have a one argument version of it, 
followed by an unnecessarily braced bit of text.

To fix it, change the two lines

{\mbox{Beta}(\theta(1-p),\theta p)}}%
{p(x) = %

to

{\mbox{Beta}(\theta(1-p),\theta p)}%
}{p(x) = %

Duncan Murdoch

 >
 > * checking Rd files against version 2 parser ... WARNING
 > Warning: ./man/dbetabinom.Rd:32-34: Unnecessary braces at ?{p(x) = %
 > (C(N,x)*Beta(N-x+theta*(1-p),x+theta*p))/%
 > Beta(theta*(1-p),theta*p)}?
 >
 > =============
 > \details{
 >    The beta-binomial distribution is the result of
 > compounding a beta distribution of probabilities with
 > a binomial sampling process.  The density function is
 > \deqn{p(x) = %
 > \frac{C(N,x) \mbox{Beta}(N-x+\theta(1-p),x+\theta p)}%
 > {\mbox{Beta}(\theta(1-p),\theta p)}}%
 > {p(x) = %
 > (C(N,x)*Beta(N-x+theta*(1-p),x+theta*p))/%
 > Beta(theta*(1-p),theta*p)}
 > The parameters \code{shape1} and \code{shape2} are
 > the more traditional parameterization in terms of
 > the parameters of the per-trial probability distribution.
 > }
 >
 >
 >
 > ------------------------------------------------------------------------
 >
 > ______________________________________________
 > R-devel at r-project.org mailing list
 > https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Tue Aug 18 13:50:07 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 18 Aug 2009 07:50:07 -0400
Subject: [Rd] Calling C functions with value parameters
In-Reply-To: <xmrws52plho.fsf@mralx1.rsma.frb.gov>
References: <xmrws52plho.fsf@mralx1.rsma.frb.gov>
Message-ID: <4A8A956F.4020500@stats.uwo.ca>

On 17/08/2009 10:23 AM, Jeffrey J. Hallman wrote:
> One hassle I could do without is the necessity of writing C wrapper functions
> like this:
> 
> void fameInit(int *status){
>   cfmini(status);
>   return;
> }
> 
> when I want to call a library function (cfmini, in this case) that takes an
> int argument.  The .C interface only lets me pass a pointer to an int, rather
> than the int itself.
> 
> Is there any chanch that .C could be enhanced to allow passing arguments by
> value to the compiled code?  It would make some of my stuff much simpler.

What you have above doesn't work (you passed the pointer, not the 
value), but it's hardly complex.  I don't think the effort of extending 
.C in that way would be a worthwhile use of time.

Duncan Murdoch


From bates at stat.wisc.edu  Tue Aug 18 13:56:27 2009
From: bates at stat.wisc.edu (Douglas Bates)
Date: Tue, 18 Aug 2009 06:56:27 -0500
Subject: [Rd] Calling C functions with value parameters
In-Reply-To: <xmrws52plho.fsf@mralx1.rsma.frb.gov>
References: <xmrws52plho.fsf@mralx1.rsma.frb.gov>
Message-ID: <40e66e0b0908180456l7155f307t5eafb23d78e69952@mail.gmail.com>

On Mon, Aug 17, 2009 at 9:23 AM, Jeffrey J. Hallman<jhallman at frb.gov> wrote:
> One hassle I could do without is the necessity of writing C wrapper functions
> like this:
>
> void fameInit(int *status){
> ?cfmini(status);
> ?return;
> }
>
> when I want to call a library function (cfmini, in this case) that takes an
> int argument. ?The .C interface only lets me pass a pointer to an int, rather
> than the int itself.

> Is there any chanch that .C could be enhanced to allow passing arguments by
> value to the compiled code? ?It would make some of my stuff much simpler.

I suppose that if you design a new interface and submit patches to the
code in R that does the interfacing, it could be done.  However, I
imagine you would find it easier to continue to write short interface
functions like that. :-)

(By the way, the "return;" is redundant in a C function that returns void.)

You should remember that internally there are no scalar objects in R -
everything is a vector.  If you use the .Call interface, which
initially is more complicated but eventually helps you simplify your
code, arguments are passed and values returned as SEXPs and you can
use convenient utilities like asInteger which make your R code simpler
because they extract a scalar integer value from an SEXP, coercing if
necessary.

So, if you have a C function that takes two integer arguments and
returns an integer you can write the C interface function as

SEXP R_callable_foo(SEXP a, SEXP b)
{
    return ScalarInteger(foo(asInteger(a), asInteger(b)));
}


It is not surprising that you need to write interface code - it is
remarkable that it works at all.


From simon.urbanek at r-project.org  Tue Aug 18 14:08:42 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 18 Aug 2009 08:08:42 -0400
Subject: [Rd] Calling C functions with value parameters
In-Reply-To: <xmrws52plho.fsf@mralx1.rsma.frb.gov>
References: <xmrws52plho.fsf@mralx1.rsma.frb.gov>
Message-ID: <5C1C84AD-D53C-4000-B94E-BAA4A91DA438@r-project.org>

Jeff,

On Aug 17, 2009, at 10:23 , Jeffrey J. Hallman wrote:

> One hassle I could do without is the necessity of writing C wrapper  
> functions
> like this:
>
> void fameInit(int *status){
>  cfmini(status);
>  return;
> }
>
> when I want to call a library function (cfmini, in this case) that  
> takes an
> int argument.  The .C interface only lets me pass a pointer to an  
> int, rather
> than the int itself.
>
> Is there any chanch that .C could be enhanced to allow passing  
> arguments by value to the compiled code?

IMHO close to 0, because there is not such a thing as "scalar int" in  
R. All objects in R are arrays (in C speak), so in all three:
foo(integer(0)), foo(1L), foo(1:10)
the argument is of the same type: integer vector (analogously C type  
int[]). In fact .C should preferably not be used for wrappers like the  
one you suggested, because it's more prone to errors and much less  
flexible than .Call which gives you all you want including the control  
over duplication and the length of the supplied arguments.

(There are some packages that can generate wrappers from function  
arguments or header files - maybe the authors can comments on that if  
they wish).

Cheers,
Simon


From mtmorgan at fhcrc.org  Tue Aug 18 15:15:50 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 18 Aug 2009 06:15:50 -0700
Subject: [Rd] S4 Generics and NAMESPACE : justified warning ?
In-Reply-To: <20090817135120.16fab862@mimi>
References: <20090817135120.16fab862@mimi>
Message-ID: <4A8AA986.3040702@fhcrc.org>

Yohan Chalabi wrote:
> Dear list,
> 
> It seems that a package (pkgB) using another package (pkgA) with S4
> generics formed by taking existing functions (for example 'plot') must
> not import the existing functions ('plot') in its namespace to avoid
> the warning "replacing previous import: plot".
> 
> Suppose we use the simple 'import' directive in the name space of
> pkgB.
> 
> pkgA and pkgB files would be
> 
> pkgA/NAMESPACE:
>     import(graphics)
>     import(methods)
>     exportClasses("classA")
>     exportMethods("plot")
> 
> pkgA/R/pkgA.R:
>     setClass("classA", contains = "matrix")
>     setMethod("plot", "classA", function(x, y, ...) NULL)
> 
> pkgB/NAMESPACE:
>     import(methods)
>     import(garphics)
>     import(pkgA)
> 
> Loading pkgB would then generate a warning because the generic 'plot'
> in pkgA overwrites the 'plot' function imported from graphics name
> space :
> 
> Loading required package: pkgA
> Warning message:
> In namespaceImportFrom(self, asNamespace(ns)) :
>   replacing previous import: plot
> 
> As far as I understood it, one must explicitly import the functions one
> needs in pkgB with 'importFrom' to avoid the previous warning. In
> our example, one would then take care to not import the 'plot'
> function from garphics name space.
> 
> This makes the maintenance of packages using S4 packages rather
> tedious because one needs to import exactly what one needs rather than
> using the simple 'import' directive.
> 
> Moreover, the warning "replacing previous import:" is confusing. In this
> case we have a generic replacing its existing function like
> 'setMethod' would do and not a function replacing another function
> with the same name.

Hi Yohan --

Commenting as a user, there's no guarantee that the 'plot' generic
defined in pkgA is derived from graphics::plot via setGeneric; pkgA
could define it's own generic, and one would want to be informed of the
collision.

Maintenance of packages that have used simple 'import' to pull in all
dependencies is tedious, but using 'import' in some ways undermines
benefits of name spaces (restricting the symbol lookup table to reduce
the number of symbols and the possibility of name collisions, and to
more carefully isolate code inside the package name space to changes in
imported packages or induced by the user). So I think a 'better
practice' is to explicitly import just those functions, classes, etc
that are required by the package. Maintenance of such selective imports
is much less tedious, even with complicated package dependencies. There
is an unreleased Bioconductor package to identify specific imports,
available for R-2.9.* at

  svn export
https://hedgehog.fhcrc.org/bioconductor/branches/RELEASE_2_4/madman/Rpacks/codetoolsBioC

or for the development version of R at

  svn export
https://hedgehog.fhcrc.org/bioconductor/trunk/madman/Rpacks/codetoolsBioC

with functions findExternalDeps and writeNamespaceImports. These are
fairly thoroughly tested, but perhaps not fool-proof.

Martin

> 
> IMO it is normal that a function in a previous import can be replaced
> by its generic. It should not create a warning. But a warning should
> be generated when a generic is replaced by another generic.
> 
> Does this make sense ?
> 
> This could be implemented in 'namespaceImportFrom' with the patch given
> bellow.
> 
> It would greatly help the maintanance of packages which use S4
> packages, because one could use the simple 'import' directive rather
> than 'importFrom'.
> 
> Looking forward for your comments.
> 
> Regards,
> Yohan
> 
> 
> #################################################################################
> 
> Index: src/library/base/R/namespace.R
> ===================================================================
> --- src/library/base/R/namespace.R	(revision 49278)
> +++ src/library/base/R/namespace.R	(working copy)
> @@ -797,8 +797,12 @@
>  	}
>      }
>      for (n in impnames)
> -        if (exists(n, envir = impenv, inherits = FALSE))
> -            warning(msg, " ", n)
> +        if (exists(n, envir = impenv, inherits = FALSE)) {
> +            if (.isMethodsDispatchOn() && methods:::isGeneric(n, ns)) {
> +                if (methods:::isGeneric(n, impenv))
> +                    warning("replacing previous generic import: ", n)
> +            } else warning(msg, " ", n)
> +        }
>      importIntoEnv(impenv, impnames, ns, impvars)
>      if (register) {
>          addImports(self, ns,
> 
> #################################################################################
> 
>


From mtmorgan at fhcrc.org  Tue Aug 18 15:42:48 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 18 Aug 2009 06:42:48 -0700
Subject: [Rd] S4: inheritance of validity methods?
In-Reply-To: <op.uyti9if2dacko8@tir-070312.staff.few.eur.nl> (Vitalie S.'s
	message of "Mon, 17 Aug 2009 20:06:44 +0200")
References: <op.uyti9if2dacko8@tir-070312.staff.few.eur.nl>
Message-ID: <6phocqdxmp3.fsf@gopher4.fhcrc.org>

"Vitalie S." <vitosmail at rambler.ru> writes:

> Dear Developers,
>
> In current implementation of validity method, objects are first
> coerced to  superclass (slots are striped). Thus, it is not possible
> to write validity  method which would perform some checks on children
> slots.
>
> Say, I want to check if number of slots in a class is equal to "n":
>
> setClass("A", representation(a="numeric", n="integer"),
>           prototype=list(a=12, n=1L),
>           validity=function(object){
>               if(length(slotNames(object))!=object at n+1) paste("Number
>               of  slots must be ", object at n)
>               else TRUE
>           })
>
>
> setClass("B", representation(b="numeric"), contains="A",
>           prototype=list(a=12, b=14, n=2L))
>
>
> new("B", a=11, b=33)
> Error in validObject(.Object) :
>    invalid class "B" object: Number of slots must be  2
>
> Error, because an object of class "A" is passed to validObject with
> one  slot "b" removed and n=2.
>
> Is were a work around for this, or I am just doomed to write the same
> validity method for each children class?

I think you're doomed, but checking the number of slots in an instance
seems like a very unusual validity method -- isn't this the job of the
methods package, not your implementation of particular classes?

Martin

> Many thanks,
> Vitalie.

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From jhallman at frb.gov  Tue Aug 18 15:53:30 2009
From: jhallman at frb.gov (Jeffrey J. Hallman)
Date: Tue, 18 Aug 2009 09:53:30 -0400
Subject: [Rd] Calling C functions with value parameters
References: <xmrws52plho.fsf@mralx1.rsma.frb.gov>
Message-ID: <xmrskfpp6sl.fsf@mralx1.rsma.frb.gov>

replying to myself here, in lieu of replying to several others

jhallman at frb.gov (Jeffrey J. Hallman) writes:

> One hassle I could do without is the necessity of writing C wrapper functions
> like this:
>
> void fameInit(int *status){
>   cfmini(status);
>   return;
> }
>
> when I want to call a library function (cfmini, in this case) that takes an
> int argument.  The .C interface only lets me pass a pointer to an int, rather
> than the int itself.
>
> Is there any chanch that .C could be enhanced to allow passing arguments by
> value to the compiled code?  It would make some of my stuff much simpler.

Of course I realized right after I posted that my example was incorrect.
Since the cfmini() function takes a pointer to an int, all I needed was this:

status <- .C("cfmini", status = as.integer(0))$status

However, I do have functions where this can't be done, because the library
function being called takes one or more parameters by value, not by reference.
For example, I had to write this wrapper:

void fameCloseDatabase(int *status, int *key){
  cfmcldb(status, *key);
  return;
}

where the "key" argument to cfmcldb() is an int, not a pointer.

As you probably realize, cfmcldb() is not something I wrote: it's part of the
FAME Host Language Interface (chli) provided by Sungard, the vendor of the
FAME time series database.

My point, which I clearly did not make very well, since all of the replies so
far have missed it, is that if .C() could pass arguments by value as well as
by reference, I could write the fame package (an interface to the FAME
database) entirely in R, as I'd be able to call any of the chli functions
directly, without having to write C wrappers.  This would make if much easier
to debug the package and get it working correctly on Windows, where I can't
seem to get it to compile correctly any more.  I surely cannot be the only
package writer who has to interface to external libraries and would rather
write the interface in R than in C.

Do we not all see the virtues of doing almost everything in R itself, rather
than writing parts of the system in other languages and systems?  Why else
would Ripley undertake all the recent work to parse .Rd files in R rather than
in Perl, and why do people work on things like gWidgets?

-- 
Jeff


From murdoch at stats.uwo.ca  Tue Aug 18 16:34:44 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 18 Aug 2009 10:34:44 -0400
Subject: [Rd] Calling C functions with value parameters
In-Reply-To: <xmrskfpp6sl.fsf@mralx1.rsma.frb.gov>
References: <xmrws52plho.fsf@mralx1.rsma.frb.gov>
	<xmrskfpp6sl.fsf@mralx1.rsma.frb.gov>
Message-ID: <4A8ABC04.5090602@stats.uwo.ca>

On 18/08/2009 9:53 AM, Jeffrey J. Hallman wrote:
> replying to myself here, in lieu of replying to several others
> 
> jhallman at frb.gov (Jeffrey J. Hallman) writes:
> 
>> One hassle I could do without is the necessity of writing C wrapper functions
>> like this:
>>
>> void fameInit(int *status){
>>   cfmini(status);
>>   return;
>> }
>>
>> when I want to call a library function (cfmini, in this case) that takes an
>> int argument.  The .C interface only lets me pass a pointer to an int, rather
>> than the int itself.
>>
>> Is there any chanch that .C could be enhanced to allow passing arguments by
>> value to the compiled code?  It would make some of my stuff much simpler.
> 
> Of course I realized right after I posted that my example was incorrect.
> Since the cfmini() function takes a pointer to an int, all I needed was this:
> 
> status <- .C("cfmini", status = as.integer(0))$status
> 
> However, I do have functions where this can't be done, because the library
> function being called takes one or more parameters by value, not by reference.
> For example, I had to write this wrapper:
> 
> void fameCloseDatabase(int *status, int *key){
>   cfmcldb(status, *key);
>   return;
> }
> 
> where the "key" argument to cfmcldb() is an int, not a pointer.
> 
> As you probably realize, cfmcldb() is not something I wrote: it's part of the
> FAME Host Language Interface (chli) provided by Sungard, the vendor of the
> FAME time series database.
> 
> My point, which I clearly did not make very well, since all of the replies so
> far have missed it, is that if .C() could pass arguments by value as well as
> by reference, I could write the fame package (an interface to the FAME
> database) entirely in R, as I'd be able to call any of the chli functions
> directly, without having to write C wrappers.  This would make if much easier
> to debug the package and get it working correctly on Windows, where I can't
> seem to get it to compile correctly any more.  I surely cannot be the only
> package writer who has to interface to external libraries and would rather
> write the interface in R than in C.
> 
> Do we not all see the virtues of doing almost everything in R itself, rather
> than writing parts of the system in other languages and systems?  Why else
> would Ripley undertake all the recent work to parse .Rd files in R rather than
> in Perl, and why do people work on things like gWidgets?

Rd files are now parsed in C, not in R, and the parser was written by 
me, not by Brian, but you do have a good point:  reducing our reliance 
on external tools that aren't under our control is generally a good 
thing.  It's inconceivable that anyone will do the work to rewrite R not 
to rely on C, but within a year or two we probably won't rely on Perl.

However, the problem with your suggestion is that it is not at all easy 
to do.  C has a much richer function calling interface than R does. 
Currently .C supports a minimal part of it, and we could support more, 
but it isn't at all easy.  How do you simulate a general argument list 
to a C function in C code?  (I don't know if it's possible in a portable 
way.)  The current .C implementation has a long list of possible calls: 
  zero args, one arg, two args, etc.  If we knew we were working with a 
specific version of gcc on a specific platform, we could simplify it a 
lot, but we don't.  R compiles on all sorts of different platforms, with 
compilers using all sorts of different calling conventions.  It is just 
not feasible to write portable code to do general calls.

We could expand the list of calls that we do support, but it's a lot of 
work, and there would always be someone asking for others.   As Doug 
said, it is not surprising that you need to write interface code - it is
remarkable that it works at all.

Duncan Murdoch

>


From vitosmail at rambler.ru  Tue Aug 18 17:19:17 2009
From: vitosmail at rambler.ru (Vitalie S.)
Date: Tue, 18 Aug 2009 17:19:17 +0200
Subject: [Rd] S4: inheritance of validity methods?
In-Reply-To: <6phocqdxmp3.fsf@gopher4.fhcrc.org>
References: <op.uyti9if2dacko8@tir-070312.staff.few.eur.nl>
	<6phocqdxmp3.fsf@gopher4.fhcrc.org>
Message-ID: <op.uyu56f0mdacko8@tir-070312.staff.few.eur.nl>

On Tue, 18 Aug 2009 15:42:48 +0200, Martin Morgan <mtmorgan at fhcrc.org>  
wrote:

> "Vitalie S." <vitosmail at rambler.ru> writes:
>
>> Dear Developers,
>>
>> In current implementation of validity method, objects are first
>> coerced to  superclass (slots are striped). Thus, it is not possible
>> to write validity  method which would perform some checks on children
>> slots.
>>
>> Say, I want to check if number of slots in a class is equal to "n":
>>
>> setClass("A", representation(a="numeric", n="integer"),
>>           prototype=list(a=12, n=1L),
>>           validity=function(object){
>>               if(length(slotNames(object))!=object at n+1) paste("Number
>>               of  slots must be ", object at n)
>>               else TRUE
>>           })
>>
>>
>> setClass("B", representation(b="numeric"), contains="A",
>>           prototype=list(a=12, b=14, n=2L))
>>
>>
>> new("B", a=11, b=33)
>> Error in validObject(.Object) :
>>    invalid class "B" object: Number of slots must be  2
>>
>> Error, because an object of class "A" is passed to validObject with
>> one  slot "b" removed and n=2.
>>
>> Is were a work around for this, or I am just doomed to write the same
>> validity method for each children class?
>
> I think you're doomed, but checking the number of slots in an instance
> seems like a very unusual validity method -- isn't this the job of the
> methods package, not your implementation of particular classes?
>

That was a toy example. In fact that I need is to ensure that some  
specific slots have the same length. Names of these slots are kept in  
separate slot (@atributes).

I think it's not an insane idea to require a predefined relationship to  
hold between "future" children's slots.

To be honest, I find it hard to think of a compelling reason to convert  
the object before testing the validity. What can possibly go wrong if  
children slots are kept in place?


Vitalie.

> Martin
>
>> Many thanks,
>> Vitalie.
>


--


From mtmorgan at fhcrc.org  Tue Aug 18 18:58:27 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 18 Aug 2009 09:58:27 -0700
Subject: [Rd] S4: inheritance of validity methods?
In-Reply-To: <op.uyu56f0mdacko8@tir-070312.staff.few.eur.nl>
References: <op.uyti9if2dacko8@tir-070312.staff.few.eur.nl>
	<6phocqdxmp3.fsf@gopher4.fhcrc.org>
	<op.uyu56f0mdacko8@tir-070312.staff.few.eur.nl>
Message-ID: <4A8ADDB3.8060908@fhcrc.org>

Vitalie S. wrote:
> On Tue, 18 Aug 2009 15:42:48 +0200, Martin Morgan <mtmorgan at fhcrc.org>
> wrote:
> 
>> "Vitalie S." <vitosmail at rambler.ru> writes:
>>
>>> Dear Developers,
>>>
>>> In current implementation of validity method, objects are first
>>> coerced to  superclass (slots are striped). Thus, it is not possible
>>> to write validity  method which would perform some checks on children
>>> slots.
>>>
>>> Say, I want to check if number of slots in a class is equal to "n":
>>>
>>> setClass("A", representation(a="numeric", n="integer"),
>>>           prototype=list(a=12, n=1L),
>>>           validity=function(object){
>>>               if(length(slotNames(object))!=object at n+1) paste("Number
>>>               of  slots must be ", object at n)
>>>               else TRUE
>>>           })
>>>
>>>
>>> setClass("B", representation(b="numeric"), contains="A",
>>>           prototype=list(a=12, b=14, n=2L))
>>>
>>>
>>> new("B", a=11, b=33)
>>> Error in validObject(.Object) :
>>>    invalid class "B" object: Number of slots must be  2
>>>
>>> Error, because an object of class "A" is passed to validObject with
>>> one  slot "b" removed and n=2.
>>>
>>> Is were a work around for this, or I am just doomed to write the same
>>> validity method for each children class?
>>
>> I think you're doomed, but checking the number of slots in an instance
>> seems like a very unusual validity method -- isn't this the job of the
>> methods package, not your implementation of particular classes?

Perhaps I was too quick in saying you were doomed. First, if A is
VIRTUAL then the class seen by its validity method is, as implied by ?as,

  the object will be from the closest actual class, in particular the
  original object, if that class extends the virtual class directly

so

  .validity <- function(object) {
      cat(class(object), "\n")
      TRUE
  }

  setClass("A",
           representation(a="numeric", n="integer", "VIRTUAL"),
           validity=.validity)

  setClass("B", representation(b="numeric"), contains="A")

leads to

> res <- new("B", b=1)
B

This seems to require some careful thought about how derived classes are
to behave.

Another approach, probably obvious and which does not really bring
anything 'automatic', is to define a helper function that can be called
in each validity method, or itself used as the validity method.

  .validity <- function(object) {
     # TRUE or message
  }

  setClass("A", representation(a="numeric", n="integer"))
  setClass("B", representation(b="numeric"), contains="A",
           validity=.validity)
  setClass("C", representation(c="numeric"), contains="A",
           validity=function(object) .validity(object))

one might make .validity generic, so that one gets inheritance &
dispatch in the validity methods.

 setGeneric(".validity")
 setClass("A", representation(a="numeric", n="integer"))
 setClass("B", representation("A", b="numeric"), validity=.validity)
 setMethod(.validity, "A", function(object) {
    cat(class(object), "\n")
    TRUE
 })


> That was a toy example. In fact that I need is to ensure that some
> specific slots have the same length. Names of these slots are kept in
> separate slot (@atributes).
> 
> I think it's not an insane idea to require a predefined relationship to
> hold between "future" children's slots.
> 
> To be honest, I find it hard to think of a compelling reason to convert
> the object before testing the validity. What can possibly go wrong if
> children slots are kept in place?

I guess this is reflected in 'setIs' / 'setAs', which allow for derived
classes to have and interpret their representation in a way that is
completely different from parent classes.

Martin

> 
> 
> Vitalie.
> 
>> Martin
>>
>>> Many thanks,
>>> Vitalie.
>>
> 
>


From vitosmail at rambler.ru  Tue Aug 18 20:00:49 2009
From: vitosmail at rambler.ru (Vitalie S.)
Date: Tue, 18 Aug 2009 20:00:49 +0200
Subject: [Rd] S4: inheritance of validity methods?
In-Reply-To: <4A8ADDB3.8060908@fhcrc.org>
References: <op.uyti9if2dacko8@tir-070312.staff.few.eur.nl>
	<6phocqdxmp3.fsf@gopher4.fhcrc.org>
	<op.uyu56f0mdacko8@tir-070312.staff.few.eur.nl>
	<4A8ADDB3.8060908@fhcrc.org>
Message-ID: <op.uyvdnnucdacko8@tir-070312.staff.few.eur.nl>

On Tue, 18 Aug 2009 18:58:27 +0200, Martin Morgan <mtmorgan at fhcrc.org>  
wrote:

> Vitalie S. wrote:
>> On Tue, 18 Aug 2009 15:42:48 +0200, Martin Morgan <mtmorgan at fhcrc.org>
>> wrote:
>>
>>> "Vitalie S." <vitosmail at rambler.ru> writes:
>>>
>>>> Dear Developers,
>>>>
>>>> In current implementation of validity method, objects are first
>>>> coerced to  superclass (slots are striped). Thus, it is not possible
>>>> to write validity  method which would perform some checks on children
>>>> slots.
>>>>
>>>> Say, I want to check if number of slots in a class is equal to "n":
>>>>
>>>> setClass("A", representation(a="numeric", n="integer"),
>>>>           prototype=list(a=12, n=1L),
>>>>           validity=function(object){
>>>>               if(length(slotNames(object))!=object at n+1) paste("Number
>>>>               of  slots must be ", object at n)
>>>>               else TRUE
>>>>           })
>>>>
>>>>
>>>> setClass("B", representation(b="numeric"), contains="A",
>>>>           prototype=list(a=12, b=14, n=2L))
>>>>
>>>>
>>>> new("B", a=11, b=33)
>>>> Error in validObject(.Object) :
>>>>    invalid class "B" object: Number of slots must be  2
>>>>
>>>> Error, because an object of class "A" is passed to validObject with
>>>> one  slot "b" removed and n=2.
>>>>
>>>> Is were a work around for this, or I am just doomed to write the same
>>>> validity method for each children class?
>>>
>>> I think you're doomed, but checking the number of slots in an instance
>>> seems like a very unusual validity method -- isn't this the job of the
>>> methods package, not your implementation of particular classes?
>
> Perhaps I was too quick in saying you were doomed. First, if A is
> VIRTUAL then the class seen by its validity method is, as implied by ?as,
>
>   the object will be from the closest actual class, in particular the
>   original object, if that class extends the virtual class directly
>
> so
>
>   .validity <- function(object) {
>       cat(class(object), "\n")
>       TRUE
>   }
>
>   setClass("A",
>            representation(a="numeric", n="integer", "VIRTUAL"),
>            validity=.validity)
>
>   setClass("B", representation(b="numeric"), contains="A")
>
> leads to
>
>> res <- new("B", b=1)
> B
>
> This seems to require some careful thought about how derived classes are
> to behave.
>
   yes, indeed. At first glance seems as a nice trick, but:

>   setClass("C", representation(c="numeric"), contains="B")
[1] "C"
>  res <- new("C", c=1)
B

yah... same story at a different level:(.

> Another approach, probably obvious and which does not really bring
> anything 'automatic', is to define a helper function that can be called
> in each validity method, or itself used as the validity method.
>
>   .validity <- function(object) {
>      # TRUE or message
>   }
>
>   setClass("A", representation(a="numeric", n="integer"))
>   setClass("B", representation(b="numeric"), contains="A",
>            validity=.validity)
>   setClass("C", representation(c="numeric"), contains="A",
>            validity=function(object) .validity(object))
>
> one might make .validity generic, so that one gets inheritance &
> dispatch in the validity methods.
>
>  setGeneric(".validity")
>  setClass("A", representation(a="numeric", n="integer"))
>  setClass("B", representation("A", b="numeric"), validity=.validity)
>  setMethod(.validity, "A", function(object) {
>     cat(class(object), "\n")
>     TRUE
>  })
>
This one has similar problem:


setGeneric(".validity", useAsDefault=function(object) {
     cat(class(object), "\n")
     TRUE
})

  setClass("A", representation(a="numeric", n="integer"),  
validity=.validity)
  setClass("B", representation("A", b="numeric"), validity=.validity)
  setClass("C", representation("B", c="numeric"), validity=.validity)
>  tb <- new("B", b=2)
A
B
>  tc <- new("C", c=3)
A
B
C

?validObject says:

      Validity testing takes place *bottom up*(...)for each of the classes  
that this
      class extends (the ?superclasses?), the explicit validity method
      of that class is called, if one exists.  Finally, the validity
      method of 'object''s class is called, if there is one.

This is ectly what happens above when A,B,C is printed.

It seams like there is no way to implement a general function which would  
be called for validation of each children class. Moreover, if I attempt to  
rewrite manually the validity method for each subclass taht would also not  
work, because validity is tested "bottom up". validObject for A is called  
anyway - and is obviously not valid:


  setClass("A", representation(a="numeric", n="integer"),
           validity=function(object) length(slotNames(object))==object at n+1
           )

  setClass("B", representation(b="numeric"), contains="A",
           validity=function(object) length(slotNames(object))==object at n+1
           )
>  tb <- new("B", b=2, n=2L)
Error in validObject(.Object) : invalid class "B" object: FALSE

So there is no way to validate at all!!!

>
>> That was a toy example. In fact that I need is to ensure that some
>> specific slots have the same length. Names of these slots are kept in
>> separate slot (@atributes).
>>
>> I think it's not an insane idea to require a predefined relationship to
>> hold between "future" children's slots.
>>
>> To be honest, I find it hard to think of a compelling reason to convert
>> the object before testing the validity. What can possibly go wrong if
>> children slots are kept in place?
>
> I guess this is reflected in 'setIs' / 'setAs', which allow for derived
> classes to have and interpret their representation in a way that is
> completely different from parent classes.
>
> Martin
>
>>
>>
>> Vitalie.
>>
>>> Martin
>>>
>>>> Many thanks,
>>>> Vitalie.
>>>
>>
>>
>


--


From bolker at ufl.edu  Tue Aug 18 23:06:39 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 18 Aug 2009 17:06:39 -0400
Subject: [Rd] trouble building 2.10?
Message-ID: <4A8B17DF.5020100@ufl.edu>

  Should I expect to be able to build 2.10 at the moment?

 Ubuntu intrepid
Linux bolker-lap2 2.6.27-14-generic #1 SMP Wed Jul 29 09:01:45 UTC 2009
i686 GNU/Linux

Gnu Make 3.81
gcc 4.3.2

===========
svn update

Restored 'src/library/Makefile.in'
At revision 49309.
============
./configure
[...]

R is now configured for i686-pc-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local

  C compiler:                gcc -std=gnu99  -g -O2
  Fortran 77 compiler:       gfortran  -g -O2

  C++ compiler:              g++  -g -O2
  Fortran 90/95 compiler:    gfortran -g -O2
  Obj-C compiler:	

  Interfaces supported:      X11, tcltk
  External libraries:        readline
  Additional capabilities:   PNG, JPEG, MBCS, NLS, cairo
  Options enabled:           shared BLAS, R profiling, Java

  Recommended packages:      yes
==================
make

[...]

 the only thing that gets built anew is

make[3]: Entering directory `/usr/local/src/R/r-devel/R/src/unix'
gcc -std=gnu99 -I. -I../../src/include -I../../src/include
-I/usr/local/include -DHAVE_CONFIG_H    -g -O2
-DR_HOME='"/usr/local/src/R/r-devel/R"' -o Rscript \
	  ./Rscript.c

[...]

make[2]: Entering directory `/usr/local/src/R/r-devel/R/src/library'
make[2]: *** No rule to make target `Makefile.in', needed by `Makefile'.
 Stop.
make[2]: Leaving directory `/usr/local/src/R/r-devel/R/src/library'
make[1]: *** [docs] Error 2
make[1]: Leaving directory `/usr/local/src/R/r-devel/R/src/library'
make: [docs] Error 2 (ignored)


  any ideas?

 Ben Bolker


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090818/41b95af8/attachment.bin>

From simon.urbanek at r-project.org  Tue Aug 18 23:52:25 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 18 Aug 2009 17:52:25 -0400
Subject: [Rd] trouble building 2.10?
In-Reply-To: <4A8B17DF.5020100@ufl.edu>
References: <4A8B17DF.5020100@ufl.edu>
Message-ID: <F369CEAD-7F79-452F-96F9-BC8515F589BB@r-project.org>


On Aug 18, 2009, at 17:06 , Ben Bolker wrote:

>  Should I expect to be able to build 2.10 at the moment?
>

Yes (it works on my system) - when in doubt pull a fresh checkout (in  
general you cannot expect svn updates to build without full cleanup  
due to possible changes in the build process).

Cheers,
Simon


> Ubuntu intrepid
> Linux bolker-lap2 2.6.27-14-generic #1 SMP Wed Jul 29 09:01:45 UTC  
> 2009
> i686 GNU/Linux
>
> Gnu Make 3.81
> gcc 4.3.2
>
> ===========
> svn update
>
> Restored 'src/library/Makefile.in'
> At revision 49309.
> ============
> ./configure
> [...]
>
> R is now configured for i686-pc-linux-gnu
>
>  Source directory:          .
>  Installation directory:    /usr/local
>
>  C compiler:                gcc -std=gnu99  -g -O2
>  Fortran 77 compiler:       gfortran  -g -O2
>
>  C++ compiler:              g++  -g -O2
>  Fortran 90/95 compiler:    gfortran -g -O2
>  Obj-C compiler:	
>
>  Interfaces supported:      X11, tcltk
>  External libraries:        readline
>  Additional capabilities:   PNG, JPEG, MBCS, NLS, cairo
>  Options enabled:           shared BLAS, R profiling, Java
>
>  Recommended packages:      yes
> ==================
> make
>
> [...]
>
> the only thing that gets built anew is
>
> make[3]: Entering directory `/usr/local/src/R/r-devel/R/src/unix'
> gcc -std=gnu99 -I. -I../../src/include -I../../src/include
> -I/usr/local/include -DHAVE_CONFIG_H    -g -O2
> -DR_HOME='"/usr/local/src/R/r-devel/R"' -o Rscript \
> 	  ./Rscript.c
>
> [...]
>
> make[2]: Entering directory `/usr/local/src/R/r-devel/R/src/library'
> make[2]: *** No rule to make target `Makefile.in', needed by  
> `Makefile'.
> Stop.
> make[2]: Leaving directory `/usr/local/src/R/r-devel/R/src/library'
> make[1]: *** [docs] Error 2
> make[1]: Leaving directory `/usr/local/src/R/r-devel/R/src/library'
> make: [docs] Error 2 (ignored)
>
>
>  any ideas?
>
> Ben Bolker
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ross at biostat.ucsf.edu  Wed Aug 19 05:05:14 2009
From: ross at biostat.ucsf.edu (ross at biostat.ucsf.edu)
Date: Wed, 19 Aug 2009 05:05:14 +0200 (CEST)
Subject: [Rd] ?Random.user slightly out of sync with code (PR#13895)
Message-ID: <20090819030514.5D007282EF4C@mail.pubhealth.ku.dk>

Full_Name: Ross Boylan
Version: 2.7.1
OS: linux
Submission from: (NULL) (38.99.193.74)


The help says
     Optionally,
     functions 'user_unif_nseed' and 'user_unif_seedloc' can be
     supplied which are called with no arguments and should return
     pointers to the number of seeds and to an integer array of seeds.

However, https://svn.r-project.org/R/trunk/src/main/RNG.c has
	    RNG_Table[kind].i_seed = (Int32 *) User_unif_seedloc();
so the precise type that should be returned is a pointer to Int32, not to
integer.  While on most (all?) current platforms these are the same, why invite
future problems?  Correspondingly, nseed is the number of Int32's, not
integers.

Suggested alternative:

Optionally, supply 'user_unif_seedloc', taking no arguments and returning a
pointer to an Int32 array and 'user_unif_nseed', taking no arguments and
returning the size of that array.

It would also be helpful to clarify who is responsible for controlling the
memory user_unif_seedloc points to, and how long it is expected to last.  Might
R write to this memory location?


From ripley at stats.ox.ac.uk  Wed Aug 19 07:52:32 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Aug 2009 06:52:32 +0100 (BST)
Subject: [Rd] trouble building 2.10?
In-Reply-To: <F369CEAD-7F79-452F-96F9-BC8515F589BB@r-project.org>
References: <4A8B17DF.5020100@ufl.edu>
	<F369CEAD-7F79-452F-96F9-BC8515F589BB@r-project.org>
Message-ID: <alpine.LFD.2.00.0908190642220.4332@gannet.stats.ox.ac.uk>

You currently need builddir != srcdir, which is in any case is 
strongly recommended for those building from svn checkouts.

We will either require that (many projects now do) or test building in 
the srcdir before the testing period starts.  Similar comments hold 
about needing GNU make -- it is not intended to require it in the 
released versions, but it may be required during development.

And as the posting guide says, there is no '2.10' (and never will be).

On Tue, 18 Aug 2009, Simon Urbanek wrote:

>
> On Aug 18, 2009, at 17:06 , Ben Bolker wrote:
>
>> Should I expect to be able to build 2.10 at the moment?
>> 
>
> Yes (it works on my system) - when in doubt pull a fresh checkout (in general 
> you cannot expect svn updates to build without full cleanup due to possible 
> changes in the build process).

Yes, you might need 'make distclean' in the builddir: that has 
happened several times recently as we've experimented with help 
storage.  We also do not necessarily support packages installed under 
earlier versions of R-devel.

> Cheers,
> Simon
>
>
>> Ubuntu intrepid
>> Linux bolker-lap2 2.6.27-14-generic #1 SMP Wed Jul 29 09:01:45 UTC 2009
>> i686 GNU/Linux
>> 
>> Gnu Make 3.81
>> gcc 4.3.2
>> 
>> ===========
>> svn update
>> 
>> Restored 'src/library/Makefile.in'
>> At revision 49309.
>> ============
>> ./configure
>> [...]
>> 
>> R is now configured for i686-pc-linux-gnu
>> 
>> Source directory:          .
>> Installation directory:    /usr/local
>> 
>> C compiler:                gcc -std=gnu99  -g -O2
>> Fortran 77 compiler:       gfortran  -g -O2
>> 
>> C++ compiler:              g++  -g -O2
>> Fortran 90/95 compiler:    gfortran -g -O2
>> Obj-C compiler: 
>> 
>> Interfaces supported:      X11, tcltk
>> External libraries:        readline
>> Additional capabilities:   PNG, JPEG, MBCS, NLS, cairo
>> Options enabled:           shared BLAS, R profiling, Java
>> 
>> Recommended packages:      yes
>> ==================
>> make
>> 
>> [...]
>> 
>> the only thing that gets built anew is
>> 
>> make[3]: Entering directory `/usr/local/src/R/r-devel/R/src/unix'
>> gcc -std=gnu99 -I. -I../../src/include -I../../src/include
>> -I/usr/local/include -DHAVE_CONFIG_H    -g -O2
>> -DR_HOME='"/usr/local/src/R/r-devel/R"' -o Rscript \
>> 	  ./Rscript.c
>> 
>> [...]
>> 
>> make[2]: Entering directory `/usr/local/src/R/r-devel/R/src/library'
>> make[2]: *** No rule to make target `Makefile.in', needed by `Makefile'.
>> Stop.
>> make[2]: Leaving directory `/usr/local/src/R/r-devel/R/src/library'
>> make[1]: *** [docs] Error 2
>> make[1]: Leaving directory `/usr/local/src/R/r-devel/R/src/library'
>> make: [docs] Error 2 (ignored)
>> 
>> 
>> any ideas?
>> 
>> Ben Bolker
>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From thothal at sbox.tugraz.at  Wed Aug 19 10:24:02 2009
From: thothal at sbox.tugraz.at (Thorn Thaler)
Date: Wed, 19 Aug 2009 10:24:02 +0200
Subject: [Rd] Lattice: Drawing a single contour line with a negative value
	fails
Message-ID: <4A8BB6A2.1060605@sbox.tugraz.at>

Hi everybody,

I want to add a single contourline to a levelplot. While everything 
works fine if the value at which the line should be drawn is positive, 
there is an error if the value is negative:

library(lattice)
my.panel <- function(..., at, contour=FALSE, labels=NULL) {
    panel.levelplot(..., at=at, contour=contour, labels=labels)
    panel.contourplot(..., contour=TRUE, labels="Contour", lwd=2,
       at=con)
}

x <- y <- 1:100
df <- expand.grid(x=x, y=y)
df$z <- apply(df, 1, function(x)
    (x[1]^2+x[2]^2)*ifelse(x[1]^2+x[2]^2 < 5000, -1,1))
col.regions <- heat.colors(50)

# Works
con <- 1000
levelplot(df$z~df$x+df$y, col.regions=col.regions, panel=my.panel)

# Does not work
con <- -1000
levelplot(df$z~df$x+df$y, col.regions=col.regions, panel=my.panel)

I've tracked down the error to the function "cut.default", which takes 
an argument "breaks", which should be "either a numeric vector of two or 
more cut points or a single number (greater than or equal to 2) giving 
the number of intervals into which 'x' is to be cut."

So it seems to me that a single contourline at a positive value works 
because the value is interpreted as the number of intervals, even though 
there is just this single line in the resulting plot.

What would be the correct way to add just a single contour line to a 
levelplot, or is it indeed a bug?

Thanks,

Thorn


From Greg.Snow at imail.org  Wed Aug 19 21:52:22 2009
From: Greg.Snow at imail.org (Greg Snow)
Date: Wed, 19 Aug 2009 13:52:22 -0600
Subject: [Rd] Polymorphism of predict
In-Reply-To: <c0177e5a0908171354y7ad88467n4d58d5cd376ad43d@mail.gmail.com>
References: <c0177e5a0908171354y7ad88467n4d58d5cd376ad43d@mail.gmail.com>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC621493810C@LP-EXMBVS10.CO.IHC.COM>

Instead of using smooth.spline, use lm with spline terms, e.g.:

> library(splines)
> sp.fit <- lm(y~bs(x,4))

Now both use predict.lm for the predictions and all will be consistent.

Hope this helps,

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
801.408.8111


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Christian Brechb?hler
> Sent: Monday, August 17, 2009 2:54 PM
> To: r-devel at stat.math.ethz.ch
> Subject: [Rd] Polymorphism of predict
> 
> I can fit a line to a set of given points, e.g.,
> 
> > sm.fit <- smooth.spline(1:4,1:4)
> > lm.fit <- lm(y~x, data=list(x=1:4,y=1:4))
> 
> Now I have two objects representing the straight line y(x)=x, of class
> "smooth.spline" and "lm", respectively.
> And as could be expected in object orientation, both have a method
> "predict", which I could use for
> interpolating some new points on the line.  So far so good.  BUT the
> two
> methods require different
> arguments, and return different structures:
> 
> > predict(sm.fit, 1.5:4)
> $x
> [1] 1.5 2.5 3.5
> 
> $y
> [1] 1.5 2.5 3.5
> 
> > predict(lm.fit, list(x=1.5:4))
>   1   2   3
> 1.5 2.5 3.5
> 
> I probably don't understand the motivation behind this design, but it
> seems
> ugly.  If, hoping for nice
> polymorphism, I call predict(lm.fit, 1.5:4), I get an error: "numeric
> 'envir' arg not of length one".
> 
> I expected something like the classic OO example, class Shape:  you can
> call
> area() or paint() on
> any object of the class.
> 
> Questions:
> * Why does "predict" act so inconsistently?
> * Is there a nicer interface that hides it?
> * Are there plans to change the current design?
> 
> Assuming "no" to the latter two -- what are my options?  Create
> as.smooth.spline(...) that would accept an "lm" object?
> My goal is to write OO style code, that doesn't need to know which kind
> it's
> working with.
> Thanks,
> /Christian
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From brechbuehler at gmail.com  Wed Aug 19 22:15:55 2009
From: brechbuehler at gmail.com (=?ISO-8859-1?Q?Christian_Brechb=FChler?=)
Date: Wed, 19 Aug 2009 16:15:55 -0400
Subject: [Rd] Polymorphism of predict
In-Reply-To: <B37C0A15B8FB3C468B5BC7EBC7DA14CC621493810C@LP-EXMBVS10.CO.IHC.COM>
References: <c0177e5a0908171354y7ad88467n4d58d5cd376ad43d@mail.gmail.com>
	<B37C0A15B8FB3C468B5BC7EBC7DA14CC621493810C@LP-EXMBVS10.CO.IHC.COM>
Message-ID: <c0177e5a0908191315p23d9eb7fm534516e524a4e248@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090819/37daad73/attachment.pl>

From m_kempenaar at planet.nl  Thu Aug 20 14:41:27 2009
From: m_kempenaar at planet.nl (MarcelK)
Date: Thu, 20 Aug 2009 05:41:27 -0700 (PDT)
Subject: [Rd] Problem using findVar( ) in combination with R's lazy
 evaluation
Message-ID: <25061253.post@talk.nabble.com>


Hi All,

I have a few small questions about the usage of the C findVar( ) function
when used in C code called with '.Call'. In my case I create an R function
with an argument. This function calls some C code in which I use findVar( )
to retrieve the values from the argument. Ofcourse normally I would just
give the values as argument to .Call, but in my project I need to use
findVar for various reasons (can elaborate if needed, but it's not really
relevant..) Below is a small example of an R function and the C code in
which the problem shows:  (skip to bold 'question' part if this is allready
known)

----------# R function #--------

f <- function(x) {
  .Call("envtest", environment())
}

----------# C function #--------

SEXP envtest(SEXP rho) {
  SEXP data;
  PROTECT(data = allocVector(REALSXP, 1));
  data = findVar(install("x"), rho);
  UNPROTECT(1);
  return(data);
}

----------# END #-----------

The result of this function is that it should print the contents of whatever
is passed to the function f(x). But when executing the function, the result
is:


> f(10)
<promise: 0x142db20>

Ofcourse this is due to lazy-evaluation as I've also read in the thread 
http://www.nabble.com/confusion-about-evaluation.-to18561135.html#a18563086
here . 

To 'fix' it, I would need to do 'something' with 'x', so changing the
function f() to:

f <- function(x) {
   x = x
  .Call("envtest", environment())
}

works as can be shown with:

> f(10)
[1] 10

----------

My question on this subject is, how can I work around this 'x = x' or other
similar statement (print(x) to prevent lazy-evaluation? To summarize, I
would like to use findVar to retrieve values from R objects which are given
as function arguments to the R-function and not to the C-function. 

Other than the above question, I'd also like to know if findVar( ) by
default also checks parent environments (inherits argument?) when the object
can not be found in the given environment (if not, should I look into
passing the environment Hash etc?). 

And, as a last question, how can I retrieve the value from the R-constant
'pi' using findVar? If I try this I receive the error "REAL can only be
applied to 'numeric' not a 'promise'".

Thank you for any solutions or insights in these subjects, if more details
are needed I'm happy to give them!

Marcel Kempenaar

----------------

> sessionInfo()
R version 2.9.1 (2009-06-26)
x86_64-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=nl_NL.UTF-8;LC_COLLATE=C;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=nl_NL.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

-- 
View this message in context: http://www.nabble.com/Problem-using-findVar%28-%29-in-combination-with-R%27s-lazy-evaluation-tp25061253p25061253.html
Sent from the R devel mailing list archive at Nabble.com.


From simon.urbanek at r-project.org  Thu Aug 20 15:06:19 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 20 Aug 2009 09:06:19 -0400
Subject: [Rd] Problem using findVar( ) in combination with R's lazy
	evaluation
In-Reply-To: <25061253.post@talk.nabble.com>
References: <25061253.post@talk.nabble.com>
Message-ID: <113A5FE0-722F-4CBE-9E50-74F2F83E2956@r-project.org>

Marcel,

On Aug 20, 2009, at 8:41 , MarcelK wrote:

> I have a few small questions about the usage of the C findVar( )  
> function when used in C code called with '.Call'. In my case I  
> create an R function with an argument. This function calls some C  
> code in which I use findVar( ) to retrieve the values from the  
> argument. Ofcourse normally I would just give the values as argument  
> to .Call, but in my project I need to use findVar for various  
> reasons (can elaborate if needed, but it's not really relevant..)  
> Below is a small example of an R function and the C code in which  
> the problem shows:  (skip to bold 'question' part if this is  
> allready known)
>
> ----------# R function #--------
>
> f <- function(x) {
>  .Call("envtest", environment())
> }
>
> ----------# C function #--------
>
> SEXP envtest(SEXP rho) {
>  SEXP data;
>  PROTECT(data = allocVector(REALSXP, 1));

Scrap that - you're allocating data and in the next line you're  
discarding it?!?

>  data = findVar(install("x"), rho);

Just add

if (TYPEOF(data) == PROMSXP)
   data = eval(data, rho);

Cheers,
Simon

>  UNPROTECT(1);
>  return(data);
> }
>
> ----------# END #-----------
>
> The result of this function is that it should print the contents of  
> whatever
> is passed to the function f(x). But when executing the function, the  
> result
> is:
>
>
>> f(10)
> <promise: 0x142db20>
>
> Ofcourse this is due to lazy-evaluation as I've also read in the  
> thread
> http://www.nabble.com/confusion-about-evaluation.-to18561135.html#a18563086
> here .
>
> To 'fix' it, I would need to do 'something' with 'x', so changing the
> function f() to:
>
> f <- function(x) {
>   x = x
>  .Call("envtest", environment())
> }
>
> works as can be shown with:
>
>> f(10)
> [1] 10
>
> ----------
>
> My question on this subject is, how can I work around this 'x = x'  
> or other
> similar statement (print(x) to prevent lazy-evaluation? To  
> summarize, I
> would like to use findVar to retrieve values from R objects which  
> are given
> as function arguments to the R-function and not to the C-function.
>
> Other than the above question, I'd also like to know if findVar( ) by
> default also checks parent environments (inherits argument?) when  
> the object
> can not be found in the given environment (if not, should I look into
> passing the environment Hash etc?).
>
> And, as a last question, how can I retrieve the value from the R- 
> constant
> 'pi' using findVar? If I try this I receive the error "REAL can only  
> be
> applied to 'numeric' not a 'promise'".
>
> Thank you for any solutions or insights in these subjects, if more  
> details
> are needed I'm happy to give them!
>
> Marcel Kempenaar
>
> ----------------
>
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> x86_64-pc-linux-gnu
>
> locale:
> LC_CTYPE 
> = 
> en_US 
> .UTF 
> -8 
> ;LC_NUMERIC 
> = 
> C 
> ;LC_TIME 
> = 
> nl_NL 
> .UTF 
> -8 
> ;LC_COLLATE 
> = 
> C 
> ;LC_MONETARY 
> = 
> C 
> ;LC_MESSAGES 
> = 
> en_US 
> .UTF 
> -8 
> ;LC_PAPER 
> = 
> nl_NL 
> .UTF 
> -8 
> ;LC_NAME 
> = 
> C 
> ;LC_ADDRESS 
> =C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> -- 
> View this message in context: http://www.nabble.com/Problem-using-findVar%28-%29-in-combination-with-R%27s-lazy-evaluation-tp25061253p25061253.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From vitosmail at rambler.ru  Thu Aug 20 15:29:41 2009
From: vitosmail at rambler.ru (Vitalie S.)
Date: Thu, 20 Aug 2009 15:29:41 +0200
Subject: [Rd] S4: inheritance of validity methods? + Inconsistency in
 order of validity checks.
In-Reply-To: <op.uyti9if2dacko8@tir-070312.staff.few.eur.nl>
References: <op.uyti9if2dacko8@tir-070312.staff.few.eur.nl>
Message-ID: <op.uyyqfr0sdacko8@tir-070312.staff.few.eur.nl>

With the help of Martin Morgan here is the solution for the above question.

First create VIRTUAL class with all the test for children classes:

setClass("TESTS", validity=function(object) {
     cat("Validity here:", class(object), "\n")
     TRUE
})

.simple <- function(object) {
     cat("No validity -", class(object), "\n")
     TRUE
}
setClass("A", representation(a="numeric", n="integer"),
          validity=.simple)
setClass("B", representation("A", b="numeric"),
          validity=.simple)
setClass("C", representation("B", c="numeric"),
          validity=.simple)

Set each children to inherit from TESTS class:

setIs("B", "TESTS")
setIs("C", "TESTS")

Now we have exactly what we wanted, validity tests are executed only once:
> res <- new("B", b=1)
Validity here: B
No validity - A
No validity - B

> res <- new("C", c=1)
No validity - A
Validity here: C
No validity - B
No validity - C

The order in which validity is called above is somewhat counter intuitive.

For class "C" complete hierarchy is this:
> superClassDepth(getClass("C"))$label
[1] "B"     "TESTS" "A"     "TESTS" "TESTS"

so if validity would start bottomup then TEST should be the first to  
follow. And vector of unique superclasses would be
c("B", "A", "TEST").

Instead validity uses the vector of unique labels constructed *TOPDOWN* :
> getAllSuperClasses(getClass("C"))
[1] "B"     "TESTS" "A"


Apparently this is an inconsistency in implementation, isn't it?

Vitalie.







On Mon, 17 Aug 2009 20:06:44 +0200, Vitalie S. <vitosmail at rambler.ru>  
wrote:

> Dear Developers,
>
> In current implementation of validity method, objects are first coerced  
> to superclass (slots are striped). Thus, it is not possible to write  
> validity method which would perform some checks on children slots.
>
> Say, I want to check if number of slots in a class is equal to "n":
>
> setClass("A", representation(a="numeric", n="integer"),
>           prototype=list(a=12, n=1L),
>           validity=function(object){
>               if(length(slotNames(object))!=object at n+1) paste("Number of  
> slots must be ", object at n)
>               else TRUE
>           })
>
>
> setClass("B", representation(b="numeric"), contains="A",
>           prototype=list(a=12, b=14, n=2L))
>
>
> new("B", a=11, b=33)
> Error in validObject(.Object) :
>    invalid class "B" object: Number of slots must be  2
>
> Error, because an object of class "A" is passed to validObject with one  
> slot "b" removed and n=2.
>
> Is were a work around for this, or I am just doomed to write the same  
> validity method for each children class?
>
> Many thanks,
> Vitalie.
>
> --
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


--


From murdoch at stats.uwo.ca  Thu Aug 20 16:14:24 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 20 Aug 2009 10:14:24 -0400
Subject: [Rd] Problem using findVar( ) in combination with R's lazy
	evaluation
In-Reply-To: <25061253.post@talk.nabble.com>
References: <25061253.post@talk.nabble.com>
Message-ID: <4A8D5A40.2090106@stats.uwo.ca>

On 8/20/2009 8:41 AM, MarcelK wrote:
> Hi All,
> 
> I have a few small questions about the usage of the C findVar( ) function
> when used in C code called with '.Call'. In my case I create an R function
> with an argument. This function calls some C code in which I use findVar( )
> to retrieve the values from the argument. Ofcourse normally I would just
> give the values as argument to .Call, but in my project I need to use
> findVar for various reasons (can elaborate if needed, but it's not really
> relevant..) Below is a small example of an R function and the C code in
> which the problem shows:  (skip to bold 'question' part if this is allready
> known)
> 
> ----------# R function #--------
> 
> f <- function(x) {
>   .Call("envtest", environment())
> }
> 
> ----------# C function #--------
> 
> SEXP envtest(SEXP rho) {
>   SEXP data;
>   PROTECT(data = allocVector(REALSXP, 1));
>   data = findVar(install("x"), rho);
>   UNPROTECT(1);
>   return(data);
> }
> 
> ----------# END #-----------
> 
> The result of this function is that it should print the contents of whatever
> is passed to the function f(x). But when executing the function, the result
> is:
> 
> 
>> f(10)
> <promise: 0x142db20>
> 
> Ofcourse this is due to lazy-evaluation as I've also read in the thread 
> http://www.nabble.com/confusion-about-evaluation.-to18561135.html#a18563086
> here . 
> 
> To 'fix' it, I would need to do 'something' with 'x', so changing the
> function f() to:
> 
> f <- function(x) {
>    x = x
>   .Call("envtest", environment())
> }

The standard thing to do is to call force(), i.e. instead of x = x, call 
force(x).  But Simon's solution is better, especially if you don't know 
in advance which arg you're going to be getting.

Duncan Murdoch

> 
> works as can be shown with:
> 
>> f(10)
> [1] 10
> 
> ----------
> 
> My question on this subject is, how can I work around this 'x = x' or other
> similar statement (print(x) to prevent lazy-evaluation? To summarize, I
> would like to use findVar to retrieve values from R objects which are given
> as function arguments to the R-function and not to the C-function. 
> 
> Other than the above question, I'd also like to know if findVar( ) by
> default also checks parent environments (inherits argument?) when the object
> can not be found in the given environment (if not, should I look into
> passing the environment Hash etc?). 
> 
> And, as a last question, how can I retrieve the value from the R-constant
> 'pi' using findVar? If I try this I receive the error "REAL can only be
> applied to 'numeric' not a 'promise'".
> 
> Thank you for any solutions or insights in these subjects, if more details
> are needed I'm happy to give them!
> 
> Marcel Kempenaar
> 
> ----------------
> 
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> x86_64-pc-linux-gnu
> 
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=nl_NL.UTF-8;LC_COLLATE=C;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=nl_NL.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>


From macrakis at alum.mit.edu  Thu Aug 20 23:51:01 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Thu, 20 Aug 2009 17:51:01 -0400
Subject: [Rd] Documentation of ties.method argument in `rank`
Message-ID: <8b356f880908201451m7700a7e0q65173508da0d7af3@mail.gmail.com>

In R 2.9.1/Windows, ? rank says:

Usage:
     rank(x, na.last = TRUE,
          ties.method = c("average", "first", "random", "max", "min"))
Arguments:
       ...
     ties.method: a character string specifying how ties are treated,
see 'Details'; can be abbreviated.

This appears contradictory -- the default value is a vector of
strings, while the argument specification requires a single string.
Looking at the code for `rank` shows what is going on -- by using
`match.arg`, `rank` is treating this default value as the list of
legal argument values, not as the default value.  The default is in
fact the first value, "average".

I suspect that this convention is documented somewhere (where?), but I
think it would be useful to make it explicit in the documentation for
`rank`.

            -s


From mrg at fhcrc.org  Thu Aug 20 22:00:25 2009
From: mrg at fhcrc.org (mrg at fhcrc.org)
Date: Thu, 20 Aug 2009 22:00:25 +0200 (CEST)
Subject: [Rd] header containing (PR#13834)
Message-ID: <20090820200026.253632831FF8@mail.pubhealth.ku.dk>


This problem arises on Solaris because apparently Solaris 10 returns the 
error "ENOSYS" when you try to make a directory on an automount point 
(translates to "unsupported file system operation").

The R mkdir function invokes do_dircreate in platform.c.  The logic in 
this function, when the recursive option is set, attempts to mkdir() all 
of the antecedent elements of the directory, including directories that 
may already exist.  The function is configured to therefore ignore the 
"eexist" error returned when do_dircreate attempts to create a directory 
that already exists.

The problem thus arises when the directory is, in fact, an automount 
point.  Linux returns "eexist" and works.  Solaris returns "enosys" and 
thus fails.

I was able to get this to work as expected by updating the check on the 
error returned to include enosys as an ignored error:

bash$ diff -C 4 R-2.9.1-orig/src/main/platform.c R-2.9.1/src/main/platform.c

*** R-2.9.1-orig/src/main/platform.c    Sun Mar 22 20:05:03 2009
--- R-2.9.1/src/main/platform.c Thu Aug 20 12:32:15 2009
***************
*** 1960,1968 ****
         p = dir;
         while ((p = Rf_strchr(p+1, '/'))) {
             *p = '\0';
             res = mkdir(dir, mode);
!           if (res && errno != EEXIST) goto end;
             *p = '/';
         }
       }
       res = mkdir(dir, mode);
--- 1960,1968 ----
         p = dir;
         while ((p = Rf_strchr(p+1, '/'))) {
             *p = '\0';
             res = mkdir(dir, mode);
!           if (res && ( errno != EEXIST && errno != ENOSYS )) goto end;
             *p = '/';
         }
       }
       res = mkdir(dir, mode);

I suppose the other way to "fix" this would be to redo the logic to test 
for the existance of the directory before attempting to create it. 
Probably gets clunky.

Anyway, I'm not sure of the appropriate way to include this as a patch. 
I don't know if there's an existing way to "ifdef" this alteration for 
solaris only or if the update is generic enough to not cause problems on 
other platforms.  I saw a couple other projects implementing recursive 
mkdir that just assume enosys isn't fatal and continue on.

Let me know if I can be of further assistance.

Thanks

Michael

---
Michael Gutteridge            Fred Hutchinson CRC
Sr. System Architect          1100 Fairview Ave N
mrg at fhcrc.org                 Mailstop J2-225
                               Seattle, WA 98109


From uwe_f_mayer at yahoo.com  Fri Aug 21 03:00:10 2009
From: uwe_f_mayer at yahoo.com (uwe_f_mayer at yahoo.com)
Date: Fri, 21 Aug 2009 03:00:10 +0200 (CEST)
Subject: [Rd] R compilation problem on 64 bit SunOS (PR#13898)
Message-ID: <20090821010010.E5286282EFC0@mail.pubhealth.ku.dk>

Full_Name: Uwe F. Mayer
Version: 2.9.1
OS: SunOS myhost 5.10 Generic_120012-14 i86pc i386 i86pc Solaris
Submission from: (NULL) (216.113.168.130)


With the change of the NLS handling from 2.9.0 to 2.9.1 the compilation breaks,
even as I do specifically not request nls.

Specifics:

gcc -v 
Using built-in specs.
Target: x86_64-pc-solaris2.10
Configured with: ../../src/gcc-4.4.0/configure
--prefix=/usr/local/opt/x86_64-pc-solaris2.10/gcc-4.4.0
--with-gmp=/usr/local/opt/x86_64-pc-solaris2.10
--with-mpfr=/usr/local/opt/x86_64-pc-solaris2.10 --disable-nls
--enable-languages=c,c++,fortran -with-gnu-as --without-gnu-ld
--with-ld=/usr/ccs/bin/ld --with-as=/usr/sfw/bin/gas CC='gcc -m64' CXX='g++
-m64' CFLAGS='-m64 -g -O2' CXXFLAGS='-m64 -g -O2' LDFLAGS=-m64
Thread model: posix
gcc version 4.4.0 (GCC) 

R version: 2.9.1 (2009-06-29)

R configuration
../../src/R-2.9.1/configure
--prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1
--exec-prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1 --disable-nls
--without-recommended-packages --with-readline --with-gnu-ld CC="gcc -m64
-I/usr/local/opt/x86_64-pc-solaris2.10/include
-L/usr/local/opt/x86_64-pc-solaris2.10/lib" F77="gfortran -m64" CXX="g++ -m64"
FC="gfortran -m64" LIBnn=lib64 LD=/usr/local/opt/x86_64-pc-solaris2.10/bin/ld

The last compilation step throwing the error:

gcc -m64 -I/usr/local/opt/x86_64-pc-solaris2.10/include
-L/usr/local/opt/x86_64-pc-solaris2.10/lib -std=gnu99 -I. -I../../src/include
-I../../../../src/R-2.9.1/src/include -I/usr/openwin/include
-I/usr/local/include -DHAVE_CONFIG_H    -g -O2 -c
../../../../src/R-2.9.1/src/unix/system.c -o system.o
In file included from /usr/include/locale.h:50,
                 from ../../../../src/R-2.9.1/src/unix/system.c:36:
/usr/include/libintl.h:62: error: expected identifier or '(' before 'unsigned'

The contents of /usr/include/libintl.h, line62:

extern char *ngettext(const char *, const char *, unsigned long int);

The same error happens to several other files (datetime.c, main.c, platform.c
util.c), all of which with the exception of the last one have not even changed
since 2.9.0. I compiled 2.9.0. in a parallel tree, copied the corresponding .o
files over, and got the resulting version to run.


From uwe_f_mayer at yahoo.com  Fri Aug 21 05:00:11 2009
From: uwe_f_mayer at yahoo.com (uwe_f_mayer at yahoo.com)
Date: Fri, 21 Aug 2009 05:00:11 +0200 (CEST)
Subject: [Rd] R installation problem with recommended packages (PR#13899)
Message-ID: <20090821030011.9597C282EFC0@mail.pubhealth.ku.dk>

Full_Name: Uwe F. Mayer
Version: 2.9.1
OS: SunOS myhost 5.10 Generic_120012-14 i86pc i386 i86pc Solaris
Submission from: (NULL) (216.113.168.130)


Standard configuration (that is, not specifying --without-recommended-packages)
leads to the following error:

gmake[2]: Leaving directory `/usr/local/opt/build/R-2.9.1/src/library'
gmake[1]: Leaving directory `/usr/local/opt/build/R-2.9.1/src/library'
gmake[1]: Entering directory
`/usr/local/opt/build/R-2.9.1/src/library/Recommended'
gmake[2]: Entering directory
`/usr/local/opt/build/R-2.9.1/src/library/Recommended'
begin installing recommended package VR
ERROR unable to create '/usr/local/opt/build/R-2.9.1/library/MASS'
gmake[2]: *** [VR.ts] Error 1
gmake[2]: Leaving directory
`/usr/local/opt/build/R-2.9.1/src/library/Recommended'
gmake[1]: *** [recommended-packages] Error 2
gmake[1]: Leaving directory
`/usr/local/opt/build/R-2.9.1/src/library/Recommended'
gmake: *** [stamp-recommended] Error 2

I have full write permissions to /usr/local/opt and down the tree, but I do not
have write permissions to /usr/ up the tree.

R does in fact build completely and can be installed otherwise (with some
trickery at other places), this is what it reports:

> version
               _                           
platform       x86_64-pc-solaris2.10       
arch           x86_64                      
os             solaris2.10                 
system         x86_64, solaris2.10         
status                                     
major          2                           
minor          9.1                         
year           2009                        
month          06                          
day            26                          
svn rev        48839                       
language       R                           
version.string R version 2.9.1 (2009-06-26)

A related error can be triggered from within R:

> install.packages("glmpath",
lib="/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1/lib64/R/library")
trying URL 'http://cran.cnr.Berkeley.edu/src/contrib/glmpath_0.94.tar.gz'
Content type 'application/x-gzip' length 265253 bytes (259 Kb)
opened URL
==================================================
downloaded 259 Kb

Warning in dir.create(lockdir, recursive = TRUE) :
  cannot create dir '/usr/local', reason 'Operation not applicable'
ERROR: failed to create lock directory
'/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1/lib64/R/library/00LOCK'

The downloaded packages are in
 '/tmp/RtmppArq4M/downloaded_packages'
Updating HTML index of packages in '.Library'
Warning message:
In install.packages("glmpath", lib =
"/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1/lib64/R/library") :
  installation of package 'glmpath' had non-zero exit status

--------------------------------------------------

This is how R-2.9.1 was configured:

../../src/R-2.9.1/configure
--prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1
--exec-prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1 --disable-nls
--with-readline --with-gnu-ld CC="gcc -m64
-I/usr/local/opt/x86_64-pc-solaris2.10/include
-L/usr/local/opt/x86_64-pc-solaris2.10/lib" F77="gfortran -m64" CXX="g++ -m64"
FC="gfortran -m64" LIBnn=lib64 LD=/usr/local/opt/x86_64-pc-solaris2.10/bin/ld
SHLIB_LDFLAGS="-shared

This is what gcc -v says:

Using built-in specs.
Target: x86_64-pc-solaris2.10
Configured with: ../../src/gcc-4.4.0/configure
--prefix=/usr/local/opt/x86_64-pc-solaris2.10/gcc-4.4.0
--with-gmp=/usr/local/opt/x86_64-pc-solaris2.10
--with-mpfr=/usr/local/opt/x86_64-pc-solaris2.10 --disable-nls
--enable-languages=c,c++,fortran -with-gnu-as --without-gnu-ld
--with-ld=/usr/ccs/bin/ld --with-as=/usr/sfw/bin/gas CC='gcc -m64' CXX='g++
-m64' CFLAGS='-m64 -g -O2' CXXFLAGS='-m64 -g -O2' LDFLAGS=-m64
Thread model: posix
gcc version 4.4.0 (GCC)


From ripley at stats.ox.ac.uk  Fri Aug 21 08:38:44 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 21 Aug 2009 07:38:44 +0100 (BST)
Subject: [Rd] R compilation problem on 64 bit SunOS (PR#13898)
In-Reply-To: <20090821010010.E5286282EFC0@mail.pubhealth.ku.dk>
References: <20090821010010.E5286282EFC0@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0908210729190.9615@gannet.stats.ox.ac.uk>

You are reporting a Solaris error to R-bugs.  If the Solaris libintl.h 
is broken (and it seems yours is), then you need to try one that 
works (e.g. OpenCSW) or force the use of the one in the R sources by

   --with-included-gettext use the GNU gettext library included here

or dlsable NLS (see below).

Please don't use R-bugs for things that are not R problems.


On Fri, 21 Aug 2009, uwe_f_mayer at yahoo.com wrote:

> Full_Name: Uwe F. Mayer
> Version: 2.9.1
> OS: SunOS myhost 5.10 Generic_120012-14 i86pc i386 i86pc Solaris
> Submission from: (NULL) (216.113.168.130)
>
>
> With the change of the NLS handling from 2.9.0 to 2.9.1 the compilation breaks,
> even as I do specifically not request nls.

In fact you did not specifically not request nls: use the flag from 
the gcc specs below to do so (as someone did for gcc).

> Specifics:
>
> gcc -v
> Using built-in specs.
> Target: x86_64-pc-solaris2.10
> Configured with: ../../src/gcc-4.4.0/configure
> --prefix=/usr/local/opt/x86_64-pc-solaris2.10/gcc-4.4.0
> --with-gmp=/usr/local/opt/x86_64-pc-solaris2.10
> --with-mpfr=/usr/local/opt/x86_64-pc-solaris2.10 --disable-nls
> --enable-languages=c,c++,fortran -with-gnu-as --without-gnu-ld
> --with-ld=/usr/ccs/bin/ld --with-as=/usr/sfw/bin/gas CC='gcc -m64' CXX='g++
> -m64' CFLAGS='-m64 -g -O2' CXXFLAGS='-m64 -g -O2' LDFLAGS=-m64
> Thread model: posix
> gcc version 4.4.0 (GCC)
>
> R version: 2.9.1 (2009-06-29)
>
> R configuration
> ../../src/R-2.9.1/configure
> --prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1
> --exec-prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1 --disable-nls
> --without-recommended-packages --with-readline --with-gnu-ld CC="gcc -m64
> -I/usr/local/opt/x86_64-pc-solaris2.10/include
> -L/usr/local/opt/x86_64-pc-solaris2.10/lib" F77="gfortran -m64" CXX="g++ -m64"
> FC="gfortran -m64" LIBnn=lib64 LD=/usr/local/opt/x86_64-pc-solaris2.10/bin/ld
>
> The last compilation step throwing the error:
>
> gcc -m64 -I/usr/local/opt/x86_64-pc-solaris2.10/include
> -L/usr/local/opt/x86_64-pc-solaris2.10/lib -std=gnu99 -I. -I../../src/include
> -I../../../../src/R-2.9.1/src/include -I/usr/openwin/include
> -I/usr/local/include -DHAVE_CONFIG_H    -g -O2 -c
> ../../../../src/R-2.9.1/src/unix/system.c -o system.o
> In file included from /usr/include/locale.h:50,
>                 from ../../../../src/R-2.9.1/src/unix/system.c:36:
> /usr/include/libintl.h:62: error: expected identifier or '(' before 'unsigned'
>
> The contents of /usr/include/libintl.h, line62:
>
> extern char *ngettext(const char *, const char *, unsigned long int);
>
> The same error happens to several other files (datetime.c, main.c, platform.c
> util.c), all of which with the exception of the last one have not even changed
> since 2.9.0. I compiled 2.9.0. in a parallel tree, copied the corresponding .o
> files over, and got the resulting version to run.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From landronimirc at gmail.com  Fri Aug 21 09:50:05 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Fri, 21 Aug 2009 08:50:05 +0100
Subject: [Rd] sessionInfo() fails to correctly detect locale settings
Message-ID: <68b1e2610908210050j70846657k9c900348240800d0@mail.gmail.com>

Dear R devels
Yesterday I was slightly surprised to notice that R incorrectly
detected some of the locale settings. I am not sure whether this is
important, but I preferred to drop a message. In the R output below,
some entries that should have been "en_GB.UTF-8" are presented as "C".
Regards
Liviu

> sessionInfo()
R version 2.9.1 (2009-06-26)
x86_64-pc-linux-gnu

locale:
LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] fortunes_1.3-6 relimp_1.0-1

loaded via a namespace (and not attached):
[1] tcltk_2.9.1


liviu at debian-liv:~$ locale
LANG=en_GB.UTF-8
LC_CTYPE="en_GB.UTF-8"
LC_NUMERIC="en_GB.UTF-8"
LC_TIME="en_GB.UTF-8"
LC_COLLATE="en_GB.UTF-8"
LC_MONETARY="en_GB.UTF-8"
LC_MESSAGES="en_GB.UTF-8"
LC_PAPER="en_GB.UTF-8"
LC_NAME="en_GB.UTF-8"
LC_ADDRESS="en_GB.UTF-8"
LC_TELEPHONE="en_GB.UTF-8"
LC_MEASUREMENT="en_GB.UTF-8"
LC_IDENTIFICATION="en_GB.UTF-8"
LC_ALL=




-- 
Do you know how to read?
http://www.alienetworks.com/srtest.cfm
Do you know how to write?
http://garbl.home.comcast.net/~garbl/stylemanual/e.htm#e-mail


From P.Dalgaard at biostat.ku.dk  Fri Aug 21 10:19:23 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 21 Aug 2009 10:19:23 +0200
Subject: [Rd] sessionInfo() fails to correctly detect locale settings
In-Reply-To: <68b1e2610908210050j70846657k9c900348240800d0@mail.gmail.com>
References: <68b1e2610908210050j70846657k9c900348240800d0@mail.gmail.com>
Message-ID: <4A8E588B.5090803@biostat.ku.dk>

Liviu Andronic wrote:
> Dear R devels
> Yesterday I was slightly surprised to notice that R incorrectly
> detected some of the locale settings. I am not sure whether this is
> important, but I preferred to drop a message. In the R output below,
> some entries that should have been "en_GB.UTF-8" are presented as "C".
> Regards
> Liviu

R only sets the entries it needs. In particular, you most definitely do
not want LC_NUMERIC automatically set to your current locale, as this
may cause system I/O to use "," instead of "." in numbers.


>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> x86_64-pc-linux-gnu
> 
> locale:
> 

LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] fortunes_1.3-6 relimp_1.0-1
> 
> loaded via a namespace (and not attached):
> [1] tcltk_2.9.1
> 
> 
> liviu at debian-liv:~$ locale
> LANG=en_GB.UTF-8
> LC_CTYPE="en_GB.UTF-8"
> LC_NUMERIC="en_GB.UTF-8"
> LC_TIME="en_GB.UTF-8"
> LC_COLLATE="en_GB.UTF-8"
> LC_MONETARY="en_GB.UTF-8"
> LC_MESSAGES="en_GB.UTF-8"
> LC_PAPER="en_GB.UTF-8"
> LC_NAME="en_GB.UTF-8"
> LC_ADDRESS="en_GB.UTF-8"
> LC_TELEPHONE="en_GB.UTF-8"
> LC_MEASUREMENT="en_GB.UTF-8"
> LC_IDENTIFICATION="en_GB.UTF-8"
> LC_ALL=
> 
> 
> 
> 


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From P.Dalgaard at biostat.ku.dk  Fri Aug 21 10:36:44 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 21 Aug 2009 10:36:44 +0200
Subject: [Rd] R compilation problem on 64 bit SunOS (PR#13898)
In-Reply-To: <alpine.LFD.2.00.0908210729190.9615@gannet.stats.ox.ac.uk>
References: <20090821010010.E5286282EFC0@mail.pubhealth.ku.dk>
	<alpine.LFD.2.00.0908210729190.9615@gannet.stats.ox.ac.uk>
Message-ID: <4A8E5C9C.9010800@biostat.ku.dk>

Prof Brian Ripley wrote:
[snip]
> In fact you did not specifically not request nls: use the flag from the
> gcc specs below to do so (as someone did for gcc).

Brian, I see --disable-nls in both places, so you may want to expand on
that. (I could well be missing the point, but then I'd like to know what
it was.)

> 
>> Specifics:
>>
>> gcc -v
>> Using built-in specs.
>> Target: x86_64-pc-solaris2.10
>> Configured with: ../../src/gcc-4.4.0/configure
>> --prefix=/usr/local/opt/x86_64-pc-solaris2.10/gcc-4.4.0
>> --with-gmp=/usr/local/opt/x86_64-pc-solaris2.10
>> --with-mpfr=/usr/local/opt/x86_64-pc-solaris2.10 --disable-nls
>> --enable-languages=c,c++,fortran -with-gnu-as --without-gnu-ld
>> --with-ld=/usr/ccs/bin/ld --with-as=/usr/sfw/bin/gas CC='gcc -m64'
>> CXX='g++
>> -m64' CFLAGS='-m64 -g -O2' CXXFLAGS='-m64 -g -O2' LDFLAGS=-m64
>> Thread model: posix
>> gcc version 4.4.0 (GCC)
>>
>> R version: 2.9.1 (2009-06-29)
>>
>> R configuration
>> ../../src/R-2.9.1/configure
>> --prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1
>> --exec-prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1 --disable-nls
>> --without-recommended-packages --with-readline --with-gnu-ld CC="gcc -m64
>> -I/usr/local/opt/x86_64-pc-solaris2.10/include
>> -L/usr/local/opt/x86_64-pc-solaris2.10/lib" F77="gfortran -m64"
>> CXX="g++ -m64"
>> FC="gfortran -m64" LIBnn=lib64
>> LD=/usr/local/opt/x86_64-pc-solaris2.10/bin/ld
>
[snip]

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Fri Aug 21 10:54:42 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 21 Aug 2009 09:54:42 +0100 (BST)
Subject: [Rd] R compilation problem on 64 bit SunOS (PR#13898)
In-Reply-To: <4A8E5C9C.9010800@biostat.ku.dk>
References: <20090821010010.E5286282EFC0@mail.pubhealth.ku.dk>
	<alpine.LFD.2.00.0908210729190.9615@gannet.stats.ox.ac.uk>
	<4A8E5C9C.9010800@biostat.ku.dk>
Message-ID: <alpine.LFD.2.00.0908210951570.30839@gannet.stats.ox.ac.uk>

On Fri, 21 Aug 2009, Peter Dalgaard wrote:

> Prof Brian Ripley wrote:
> [snip]
>> In fact you did not specifically not request nls: use the flag from the
>> gcc specs below to do so (as someone did for gcc).
>
> Brian, I see --disable-nls in both places, so you may want to expand on
> that. (I could well be missing the point, but then I'd like to know what
> it was.)

The include of libintl.h is inside ENABLE_NLS, and when I tried with 
--disable-nls it was not included.  So I cannot reproduce this if that 
option was actually used.

The point is that Solaris' libintl.h is incompatible with the GNU one.

>
>>
>>> Specifics:
>>>
>>> gcc -v
>>> Using built-in specs.
>>> Target: x86_64-pc-solaris2.10
>>> Configured with: ../../src/gcc-4.4.0/configure
>>> --prefix=/usr/local/opt/x86_64-pc-solaris2.10/gcc-4.4.0
>>> --with-gmp=/usr/local/opt/x86_64-pc-solaris2.10
>>> --with-mpfr=/usr/local/opt/x86_64-pc-solaris2.10 --disable-nls
>>> --enable-languages=c,c++,fortran -with-gnu-as --without-gnu-ld
>>> --with-ld=/usr/ccs/bin/ld --with-as=/usr/sfw/bin/gas CC='gcc -m64'
>>> CXX='g++
>>> -m64' CFLAGS='-m64 -g -O2' CXXFLAGS='-m64 -g -O2' LDFLAGS=-m64
>>> Thread model: posix
>>> gcc version 4.4.0 (GCC)
>>>
>>> R version: 2.9.1 (2009-06-29)
>>>
>>> R configuration
>>> ../../src/R-2.9.1/configure
>>> --prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1
>>> --exec-prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1 --disable-nls
>>> --without-recommended-packages --with-readline --with-gnu-ld CC="gcc -m64
>>> -I/usr/local/opt/x86_64-pc-solaris2.10/include
>>> -L/usr/local/opt/x86_64-pc-solaris2.10/lib" F77="gfortran -m64"
>>> CXX="g++ -m64"
>>> FC="gfortran -m64" LIBnn=lib64
>>> LD=/usr/local/opt/x86_64-pc-solaris2.10/bin/ld
>>
> [snip]
>
> --
>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Fri Aug 21 11:10:11 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 21 Aug 2009 10:10:11 +0100 (BST)
Subject: [Rd] sessionInfo() fails to correctly detect locale settings
In-Reply-To: <4A8E588B.5090803@biostat.ku.dk>
References: <68b1e2610908210050j70846657k9c900348240800d0@mail.gmail.com>
	<4A8E588B.5090803@biostat.ku.dk>
Message-ID: <alpine.LFD.2.00.0908211005530.30839@gannet.stats.ox.ac.uk>

On Fri, 21 Aug 2009, Peter Dalgaard wrote:

> Liviu Andronic wrote:
>> Dear R devels
>> Yesterday I was slightly surprised to notice that R incorrectly
>> detected some of the locale settings. I am not sure whether this is
>> important, but I preferred to drop a message. In the R output below,
>> some entries that should have been "en_GB.UTF-8" are presented as "C".
>> Regards
>> Liviu
>
> R only sets the entries it needs. In particular, you most definitely do
> not want LC_NUMERIC automatically set to your current locale, as this
> may cause system I/O to use "," instead of "." in numbers.

It might be worth pointing out that C programs start in the 'C" 
locale, not the locale of the OS session.  So only when a program 
deliberately set a locale category is the value not 'C".

(That's what the standards say: implementations may differ, of course, 
but apart from some minor difference with MinGW on Windows, I am not 
aware of any.)

>
>
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26)
>> x86_64-pc-linux-gnu
>>
>> locale:
>>
>
> LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] fortunes_1.3-6 relimp_1.0-1
>>
>> loaded via a namespace (and not attached):
>> [1] tcltk_2.9.1
>>
>>
>> liviu at debian-liv:~$ locale
>> LANG=en_GB.UTF-8
>> LC_CTYPE="en_GB.UTF-8"
>> LC_NUMERIC="en_GB.UTF-8"
>> LC_TIME="en_GB.UTF-8"
>> LC_COLLATE="en_GB.UTF-8"
>> LC_MONETARY="en_GB.UTF-8"
>> LC_MESSAGES="en_GB.UTF-8"
>> LC_PAPER="en_GB.UTF-8"
>> LC_NAME="en_GB.UTF-8"
>> LC_ADDRESS="en_GB.UTF-8"
>> LC_TELEPHONE="en_GB.UTF-8"
>> LC_MEASUREMENT="en_GB.UTF-8"
>> LC_IDENTIFICATION="en_GB.UTF-8"
>> LC_ALL=
>>
>>
>>
>>
>
>
> --
>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From romain.francois at dbmail.com  Fri Aug 21 11:21:03 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Fri, 21 Aug 2009 11:21:03 +0200
Subject: [Rd] more special completions
Message-ID: <4A8E66FF.6000201@dbmail.com>

Hi,

Would it be possible to add the capability for functions to register how 
they would like to complete themselves.

Currently, there is the .addFunctionInfo, but it allows only functions 
to register a static list of potential completions, I was thinking of a 
way to register not a fixed list of possible completions, but a 
__function__ that would calculate completions dynamically.

This could be useful for the "new" function in R, if associated with 
something that can retrieve the current list of S4 classes (not sure 
this exists).

Another example of where this could be used would be the .jnew function 
from rJava, where the first argument is a java class, associated with 
something that can complete java class names.

Romain


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/w33B : Completion for java objects
|- http://tr.im/vzip : Code Snippet : List of CRAN packages
`- http://tr.im/vsK1 : R parser package on CRAN


From b.rowlingson at lancaster.ac.uk  Fri Aug 21 14:03:40 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 21 Aug 2009 13:03:40 +0100
Subject: [Rd] Lightweight 'package' idea.
Message-ID: <d8ad40b50908210503xf67354fhfd5f3beede550df0@mail.gmail.com>

I'm often wanting to develop functions whilst manipulating data. But I
don't want to end up with a .RData full of functions and data. It
might be that I have functions that are re-usable but not worth
sticking in a package.

 So I've tried to come up with a paradigm for function development
that more closely follows the way Matlab and Python do it (partly
inspired by a confused Matlab convert over on R-help).

 My requirements were thus:

 * .R files as the master source for R functions
 * Don't see the functions in ls()
 * After editing R, make it easy to update the definitions visible to
R (unlike rebuilding and reloading a package).

 So I wrote these two in a few mins:

loadDir <- function(dir){
  e = attach(NULL,name=dir)
  assign("__path__",dir,envir=e)
  reloadDir(e)
  e
}

reloadDir <- function(e){
  path = get("__path__",e)
  files = list.files(path,".R$",full.names=TRUE,recursive=TRUE,ignore.case=TRUE)
  for(f in files){
    sys.source(f,envir=e)
  }
}

 Usage is something like:

 lib1 = loadDir("/foo/bar/baz/lib1/")

 - it creates a new environment on the search path and sources any .R
it finds in there into that environment. If you edit anything in that
directory, just do reloadDir(lib1) and the updated definitions are
loaded. It's like python's "import foo" and "reload(foo)".

 Sourcing everything on any change seems a bit wasteful, but until R
objects have timestamps I can't think of a better way. Hmm, maybe my
environment could keep a __timestamp__ object... Okay, this is getting
less simple now...

 So anyway, have I done anything wrong or stupid here, or is it a
useful paradigm that seems so obvious someone else has probably done
it (better)?

Barry


From ggrothendieck at gmail.com  Fri Aug 21 14:32:12 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 21 Aug 2009 08:32:12 -0400
Subject: [Rd] Lightweight 'package' idea.
In-Reply-To: <d8ad40b50908210503xf67354fhfd5f3beede550df0@mail.gmail.com>
References: <d8ad40b50908210503xf67354fhfd5f3beede550df0@mail.gmail.com>
Message-ID: <971536df0908210532k1152976al404b94a230f9858e@mail.gmail.com>

That's nifty.  Perhaps it could look into

   /foo/bar/baz/lib1/*/R

in which case one could simply place source
packages in /foo/bar/baz/lib1

In fact it would be nice if R had built into it some way
of running code in source packages possibly with
degraded functionality to ease development, i.e.
if one added /foo/bar/baz/lib1 to .libPaths and if xx
were a source package in /foo/bar/baz/lib1 then
one could use library(xx) and use xx functions directly,
possibly with degraded functionality, e.g. no help files.

On Fri, Aug 21, 2009 at 8:03 AM, Barry
Rowlingson<b.rowlingson at lancaster.ac.uk> wrote:
> I'm often wanting to develop functions whilst manipulating data. But I
> don't want to end up with a .RData full of functions and data. It
> might be that I have functions that are re-usable but not worth
> sticking in a package.
>
> ?So I've tried to come up with a paradigm for function development
> that more closely follows the way Matlab and Python do it (partly
> inspired by a confused Matlab convert over on R-help).
>
> ?My requirements were thus:
>
> ?* .R files as the master source for R functions
> ?* Don't see the functions in ls()
> ?* After editing R, make it easy to update the definitions visible to
> R (unlike rebuilding and reloading a package).
>
> ?So I wrote these two in a few mins:
>
> loadDir <- function(dir){
> ?e = attach(NULL,name=dir)
> ?assign("__path__",dir,envir=e)
> ?reloadDir(e)
> ?e
> }
>
> reloadDir <- function(e){
> ?path = get("__path__",e)
> ?files = list.files(path,".R$",full.names=TRUE,recursive=TRUE,ignore.case=TRUE)
> ?for(f in files){
> ? ?sys.source(f,envir=e)
> ?}
> }
>
> ?Usage is something like:
>
> ?lib1 = loadDir("/foo/bar/baz/lib1/")
>
> ?- it creates a new environment on the search path and sources any .R
> it finds in there into that environment. If you edit anything in that
> directory, just do reloadDir(lib1) and the updated definitions are
> loaded. It's like python's "import foo" and "reload(foo)".
>
> ?Sourcing everything on any change seems a bit wasteful, but until R
> objects have timestamps I can't think of a better way. Hmm, maybe my
> environment could keep a __timestamp__ object... Okay, this is getting
> less simple now...
>
> ?So anyway, have I done anything wrong or stupid here, or is it a
> useful paradigm that seems so obvious someone else has probably done
> it (better)?
>
> Barry
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Fri Aug 21 16:52:43 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 21 Aug 2009 15:52:43 +0100 (BST)
Subject: [Rd] header containing (PR#13834)
In-Reply-To: <20090820200026.253632831FF8@mail.pubhealth.ku.dk>
References: <20090820200026.253632831FF8@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0908211540540.22597@gannet.stats.ox.ac.uk>

Thank you, that's a plausible explanation and probably also explains 
PR#13899.

However, it's not listed by POSIX (not even a 'may fail') at
http://www.opengroup.org/onlinepubs/009695399/functions/mkdir.html
and nor is it described on man -s2 mkdir on my Solaris 10 system, so 
it is not surprising that we didn't know about it.

My slight concern is that ENOSYS might not be defined on some other 
OS, but I've not found one and POSIX requires it.

On Thu, 20 Aug 2009, mrg at fhcrc.org wrote:

>
> This problem arises on Solaris because apparently Solaris 10 returns the
> error "ENOSYS" when you try to make a directory on an automount point
> (translates to "unsupported file system operation").

It is supposed to mean 'function not implemented'.

> The R mkdir function invokes do_dircreate in platform.c.  The logic in
> this function, when the recursive option is set, attempts to mkdir() all
> of the antecedent elements of the directory, including directories that
> may already exist.  The function is configured to therefore ignore the
> "eexist" error returned when do_dircreate attempts to create a directory
> that already exists.
>
> The problem thus arises when the directory is, in fact, an automount
> point.  Linux returns "eexist" and works.  Solaris returns "enosys" and
> thus fails.
>
> I was able to get this to work as expected by updating the check on the
> error returned to include enosys as an ignored error:
>
> bash$ diff -C 4 R-2.9.1-orig/src/main/platform.c R-2.9.1/src/main/platform.c
>
> *** R-2.9.1-orig/src/main/platform.c    Sun Mar 22 20:05:03 2009
> --- R-2.9.1/src/main/platform.c Thu Aug 20 12:32:15 2009
> ***************
> *** 1960,1968 ****
>         p = dir;
>         while ((p = Rf_strchr(p+1, '/'))) {
>             *p = '\0';
>             res = mkdir(dir, mode);
> !           if (res && errno != EEXIST) goto end;
>             *p = '/';
>         }
>       }
>       res = mkdir(dir, mode);
> --- 1960,1968 ----
>         p = dir;
>         while ((p = Rf_strchr(p+1, '/'))) {
>             *p = '\0';
>             res = mkdir(dir, mode);
> !           if (res && ( errno != EEXIST && errno != ENOSYS )) goto end;
>             *p = '/';
>         }
>       }
>       res = mkdir(dir, mode);
>
> I suppose the other way to "fix" this would be to redo the logic to test
> for the existance of the directory before attempting to create it.
> Probably gets clunky.
>
> Anyway, I'm not sure of the appropriate way to include this as a patch.
> I don't know if there's an existing way to "ifdef" this alteration for
> solaris only or if the update is generic enough to not cause problems on
> other platforms.  I saw a couple other projects implementing recursive
> mkdir that just assume enosys isn't fatal and continue on.
>
> Let me know if I can be of further assistance.
>
> Thanks
>
> Michael
>
> ---
> Michael Gutteridge            Fred Hutchinson CRC
> Sr. System Architect          1100 Fairview Ave N
> mrg at fhcrc.org                 Mailstop J2-225
>                               Seattle, WA 98109
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From deepayan.sarkar at gmail.com  Fri Aug 21 18:59:46 2009
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 21 Aug 2009 09:59:46 -0700
Subject: [Rd] more special completions
In-Reply-To: <4A8E66FF.6000201@dbmail.com>
References: <4A8E66FF.6000201@dbmail.com>
Message-ID: <eb555e660908210959j17d554bfj4ecff75934ca91fd@mail.gmail.com>

On 8/21/09, Romain Francois <romain.francois at dbmail.com> wrote:
> Hi,
>
>  Would it be possible to add the capability for functions to register how
> they would like to complete themselves.
>
>  Currently, there is the .addFunctionInfo, but it allows only functions to
> register a static list of potential completions, I was thinking of a way to
> register not a fixed list of possible completions, but a __function__ that
> would calculate completions dynamically.
>
>  This could be useful for the "new" function in R, if associated with
> something that can retrieve the current list of S4 classes (not sure this
> exists).
>
>  Another example of where this could be used would be the .jnew function
> from rJava, where the first argument is a java class, associated with
> something that can complete java class names.

That should be useful (library, data, etc. are already hard-coded to
do special completion, but there is no reason for them to be special).
I'll have to think about how best to implement this.

I should have time to work in this in a couple of weeks (I also hope
to tackle your earlier request on $ completion then).

-Deepayan


From romain.francois at dbmail.com  Fri Aug 21 19:14:30 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Fri, 21 Aug 2009 19:14:30 +0200
Subject: [Rd] more special completions
In-Reply-To: <eb555e660908210959j17d554bfj4ecff75934ca91fd@mail.gmail.com>
References: <4A8E66FF.6000201@dbmail.com>
	<eb555e660908210959j17d554bfj4ecff75934ca91fd@mail.gmail.com>
Message-ID: <4A8ED5F6.3070105@dbmail.com>

On 08/21/2009 06:59 PM, Deepayan Sarkar wrote:
>
> On 8/21/09, Romain Francois<romain.francois at dbmail.com>  wrote:
>> Hi,
>>
>>   Would it be possible to add the capability for functions to register how
>> they would like to complete themselves.
>>
>>   Currently, there is the .addFunctionInfo, but it allows only functions to
>> register a static list of potential completions, I was thinking of a way to
>> register not a fixed list of possible completions, but a __function__ that
>> would calculate completions dynamically.
>>
>>   This could be useful for the "new" function in R, if associated with
>> something that can retrieve the current list of S4 classes (not sure this
>> exists).
>>
>>   Another example of where this could be used would be the .jnew function
>> from rJava, where the first argument is a java class, associated with
>> something that can complete java class names.
>
> That should be useful (library, data, etc. are already hard-coded to
> do special completion, but there is no reason for them to be special).
> I'll have to think about how best to implement this.
>
> I should have time to work in this in a couple of weeks (I also hope
> to tackle your earlier request on $ completion then).
>
> -Deepayan

Great.

I guess there are a few challenges, currently library, etc ... only use 
the special completion feature for their first argument.

it might make sense to expand on this, for example the data argument of 
a lattice call might be interested in the list of available data frames ...

Let me know if I can be of help when you tackle this.

Romain


-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://tr.im/w33B : Completion for java objects
|- http://tr.im/vzip : Code Snippet : List of CRAN packages
`- http://tr.im/vsK1 : R parser package on CRAN


From uwe_f_mayer at yahoo.com  Fri Aug 21 17:55:13 2009
From: uwe_f_mayer at yahoo.com (uwe_f_mayer at yahoo.com)
Date: Fri, 21 Aug 2009 17:55:13 +0200 (CEST)
Subject: [Rd] R installation problem with shared libraries (PR#13900)
Message-ID: <20090821155513.1504B283200A@mail.pubhealth.ku.dk>

Full_Name: Uwe F. Mayer
Version: 2.9.1
OS: SunOS myhost 5.10 Generic_120012-14 i86pc i386 i86pc Solaris
Submission from: (NULL) (216.113.168.130)


Configuration problem with the creation of shared libraries: Compilation only
succeeds if SHLIB_LDFLAGS="-shared" is added to the configure command line. This
is likely due to a wellknown gcc-4 feature, in that gcc requires -shared and not
just the linker flag -G to generate dynamically loaded libraries. However, even
if this variable is set at configuration time, it is not properly propagated to
the installed version, and one needs to patch the final installed version.

Specifics:

gcc -v 
Using built-in specs.
Target: x86_64-pc-solaris2.10
Configured with: ../../src/gcc-4.4.0/configure
--prefix=/usr/local/opt/x86_64-pc-solaris2.10/gcc-4.4.0
--with-gmp=/usr/local/opt/x86_64-pc-solaris2.10
--with-mpfr=/usr/local/opt/x86_64-pc-solaris2.10 --disable-nls
--enable-languages=c,c++,fortran -with-gnu-as --without-gnu-ld
--with-ld=/usr/ccs/bin/ld --with-as=/usr/sfw/bin/gas CC='gcc -m64' CXX='g++
-m64' CFLAGS='-m64 -g -O2' CXXFLAGS='-m64 -g -O2' LDFLAGS=-m64
Thread model: posix
gcc version 4.4.0 (GCC) 

R version: 2.9.1 (2009-06-29)

R configuration
../../src/R-2.9.1/configure
--prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1
--exec-prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1 --disable-nls
--without-recommended-packages --with-readline --with-gnu-ld CC="gcc -m64
-I/usr/local/opt/x86_64-pc-solaris2.10/include
-L/usr/local/opt/x86_64-pc-solaris2.10/lib" F77="gfortran -m64" CXX="g++ -m64"
FC="gfortran -m64" LIBnn=lib64 LD=/usr/local/opt/x86_64-pc-solaris2.10/bin/ld

When the newly built R is called by gmake during the build process, it throws an
error:

gmake[4]: Leaving directory `/usr/local/opt/build/R-2.9.1/src/library/base'
ld.so.1: R: fatal: relocation error: R_AMD64_PC32: file
/usr/local/opt/build/R-2.9.1/lib/libRblas.so: symbol main: value 0x280010fd8f4
does not fit
/bin/bash: line 1: 29055 Done                    cat
../../../../../src/R-2.9.1/src/library/base/makebasedb.R
     29056 Killed                  | R_DEFAULT_PACKAGES=NULL LC_ALL=C
../../../bin/R --vanilla --slave >/dev/null
gmake[3]: *** [all] Error 137

As said, adding SHLIB_LDFLAGS="-shared" to the configure command fixes this
problem.

Even with this fix I also ran into a similar problem down the line when
compiling packages (specifically e1071), and it turns out that even if
specified, the flag is not fully propagated to the final installed version. I
found myself applying the following patch the final installed 2.9.1 version:

patch /usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1/lib64/R/etc/Makeconf <<EOF
71c71
< SHLIB_CXXLDFLAGS = -G
---
> SHLIB_CXXLDFLAGS = -shared -G
EOF

Here is an example that triggers this error (just use any lazy-load package that
depends on another lazy-load package which had used g++ for the final linking
step).

> install.packages("e1071")
[***many lines cut***]
gcc -m64 -I/usr/local/opt/x86_64-pc-solaris2.10/include -L/usr/local
/opt/x86_64-pc-solaris2.10/lib -std=gnu99 -I/usr/local/opt/x86_64-pc-solar
is2.10/R-2.9.1/lib64/R/include  -I/usr/local/include    -fpic  -g -O2 -c
floyd.c
 -o floyd.o
g++ -m64 -I/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1/lib64/R/include  -
I/usr/local/include    -fpic  -g -O2 -c svm.cpp -o svm.o
g++ -m64 -G -L/usr/local/lib64 -o e1071.so Rsvm.o cmeans.o cshell.o floyd.o
svm.
o
** R
** inst
** preparing package for lazy loading
** help
*** installing help indices
 >>> Building/Updating help pages for package 'e1071'
     Formats: text html latex example 
  Discrete                          text    html    latex   example
[***many lines cut***]
  write.svm                         text    html    latex   example
** building package indices ...
* DONE (e1071)
The downloaded packages are in
        '/tmp/Rtmp55ohkF/downloaded_packages'

> install.packages("PSAUR")
trying URL 'http://lib.stat.cmu.edu/R/CRAN/src/contrib/PASWR_1.0.tar.gz'
Content type 'application/x-gzip' length 134976 bytes (131 Kb)
opened URL
==================================================
downloaded 131 Kb

* Installing *source* package 'PASWR' ...
** R
** data
**  moving datasets to lazyload DB
** preparing package for lazy loading
Loading required package: class
Error in dyn.load(file, DLLpath = DLLpath, ...) : 
  unable to load shared library '/home/myuser/R/x86_64-pc-solaris2.10-library/
2.9/e1071/libs/e1071.so':
  ld.so.1: R: fatal: relocation error: R_AMD64_PC32: file /home/myuser/R/x86_6
4-pc-solaris2.10-library/2.9/e1071/libs/e1071.so: symbol main: value
0x2800256b1
a4 does not fit
Error : package 'e1071' could not be loaded
ERROR: lazy loading failed for package 'PASWR'


From vitosmail at rambler.ru  Fri Aug 21 19:55:44 2009
From: vitosmail at rambler.ru (Vitalie S.)
Date: Fri, 21 Aug 2009 19:55:44 +0200
Subject: [Rd] more special completions
In-Reply-To: <4A8E66FF.6000201@dbmail.com>
References: <4A8E66FF.6000201@dbmail.com>
Message-ID: <op.uy0xe6epdacko8@tir-070312.staff.few.eur.nl>

On Fri, 21 Aug 2009 11:21:03 +0200, Romain Francois  
<romain.francois at dbmail.com> wrote:

> Hi,
>
> Would it be possible to add the capability for functions to register how  
> they would like to complete themselves.
>
> Currently, there is the .addFunctionInfo, but it allows only functions  
> to register a static list of potential completions, I was thinking of a  
> way to register not a fixed list of possible completions, but a  
> __function__ that would calculate completions dynamically.
>
> This could be useful for the "new" function in R, if associated with  
> something that can retrieve the current list of S4 classes (not sure  
> this exists).
>
> Another example of where this could be used would be the .jnew function  
> from rJava, where the first argument is a java class, associated with  
> something that can complete java class names.

Not sure, but another example may be a class dependent completion for  
generic functions depending on first argument. Like print(df,... ) where  
df a data.frame to complete, digits = NULL, quote = FALSE, right = TRUE,  
row.names = TRUE instead of only (x,...).

Vitalie.




--


From deepayan.sarkar at gmail.com  Fri Aug 21 20:42:24 2009
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 21 Aug 2009 11:42:24 -0700
Subject: [Rd] more special completions
In-Reply-To: <op.uy0xe6epdacko8@tir-070312.staff.few.eur.nl>
References: <4A8E66FF.6000201@dbmail.com>
	<op.uy0xe6epdacko8@tir-070312.staff.few.eur.nl>
Message-ID: <eb555e660908211142p4c7954b4p4993bfc2fc052b1f@mail.gmail.com>

On 8/21/09, Vitalie S. <vitosmail at rambler.ru> wrote:
> On Fri, 21 Aug 2009 11:21:03 +0200, Romain Francois
> <romain.francois at dbmail.com> wrote:
>
>
> > Hi,
> >
> > Would it be possible to add the capability for functions to register how
> they would like to complete themselves.
> >
> > Currently, there is the .addFunctionInfo, but it allows only functions to
> register a static list of potential completions, I was thinking of a way to
> register not a fixed list of possible completions, but a __function__ that
> would calculate completions dynamically.
> >
> > This could be useful for the "new" function in R, if associated with
> something that can retrieve the current list of S4 classes (not sure this
> exists).
> >
> > Another example of where this could be used would be the .jnew function
> from rJava, where the first argument is a java class, associated with
> something that can complete java class names.
> >
>
>  Not sure, but another example may be a class dependent completion for
> generic functions depending on first argument. Like print(df,... ) where df
> a data.frame to complete, digits = NULL, quote = FALSE, right = TRUE,
> row.names = TRUE instead of only (x,...).

That sort of already happens (have you tried?), but instead of
print.data.frame, it gives you arguments of all print methods (only
for S3 generics though). Finding the right signature needs evaluation
of the right (usually first, but not necessarily) argument, which may
actually involve another function call. Inheritance makes things more
complicated. I'm not sure it's worth the overhead.

-Deepayan


From deepayan.sarkar at gmail.com  Fri Aug 21 20:44:33 2009
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 21 Aug 2009 11:44:33 -0700
Subject: [Rd] more special completions
In-Reply-To: <4A8ED5F6.3070105@dbmail.com>
References: <4A8E66FF.6000201@dbmail.com>
	<eb555e660908210959j17d554bfj4ecff75934ca91fd@mail.gmail.com>
	<4A8ED5F6.3070105@dbmail.com>
Message-ID: <eb555e660908211144l5e1dd544s4c58c7e18186af9d@mail.gmail.com>

On 8/21/09, Romain Francois <romain.francois at dbmail.com> wrote:
> On 08/21/2009 06:59 PM, Deepayan Sarkar wrote:
>
> >
> > On 8/21/09, Romain Francois<romain.francois at dbmail.com>
> wrote:
> >
> > > Hi,
> > >
> > >  Would it be possible to add the capability for functions to register
> how
> > > they would like to complete themselves.
> > >
> > >  Currently, there is the .addFunctionInfo, but it allows only functions
> to
> > > register a static list of potential completions, I was thinking of a way
> to
> > > register not a fixed list of possible completions, but a __function__
> that
> > > would calculate completions dynamically.
> > >
> > >  This could be useful for the "new" function in R, if associated with
> > > something that can retrieve the current list of S4 classes (not sure
> this
> > > exists).
> > >
> > >  Another example of where this could be used would be the .jnew function
> > > from rJava, where the first argument is a java class, associated with
> > > something that can complete java class names.
> > >
> >
> > That should be useful (library, data, etc. are already hard-coded to
> > do special completion, but there is no reason for them to be special).
> > I'll have to think about how best to implement this.
> >
> > I should have time to work in this in a couple of weeks (I also hope
> > to tackle your earlier request on $ completion then).
> >
> > -Deepayan
> >
>
>  Great.
>
>  I guess there are a few challenges, currently library, etc ... only use the
> special completion feature for their first argument.
>
>  it might make sense to expand on this, for example the data argument of a
> lattice call might be interested in the list of available data frames ...

Yes, I'll have to think about it to decide if that's at all feasible
(there are some limitations imposed by backends; readline, ESS, and
the Windows Rgui all do slightly different things).

>  Let me know if I can be of help when you tackle this.

Will do.

-Deepayan


From bcarvalh at jhsph.edu  Fri Aug 21 23:00:33 2009
From: bcarvalh at jhsph.edu (Benilton Carvalho)
Date: Fri, 21 Aug 2009 18:00:33 -0300
Subject: [Rd] problem with plot.lm?
Message-ID: <B9FAFC26-C444-445A-8EC6-9AC81F1E5989@jhsph.edu>

I'm bringing this issue to r-devel as my idea of sending it to r-help  
appears to be wrong.

The following is reproducible in R-patched and R-devel (also in older  
versions).

An outlier is inserted in group E and the last plot by plot.lm  
suggests that the point belongs to D.

It appears to me that:

* (facval, rsp) and
* x$xlevels[[1L]][order(sapply(split(yh,mf[,1]), mean))]

are sorted differently.

set.seed(2)
a <- rnorm(50,0,2)
x <- rep(seq(10, 50, by=10), each=10)
y <- x+a
f <- rep(c("e","a","c","b","d"), rep(10,5))
f <- as.factor(f)
y[1] <- 200
mod1 <- aov(y ~ f)
par(mfrow=c(2,2))
plot(mod1)


My latest attempt was on:

 > sessionInfo()
R version 2.10.0 Under development (unstable) (2009-08-20 r49335)
x86_64-unknown-linux-gnu

locale:
  [1] LC_CTYPE=en_US.iso885915       LC_NUMERIC=C
  [3] LC_TIME=en_US.iso885915        LC_COLLATE=en_US.iso885915
  [5] LC_MONETARY=C                  LC_MESSAGES=en_US.iso885915
  [7] LC_PAPER=en_US.iso885915       LC_NAME=C
  [9] LC_ADDRESS=C                   LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.iso885915 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
 >



thank you,
b


From maechler at stat.math.ethz.ch  Sat Aug 22 00:00:44 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 22 Aug 2009 00:00:44 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <20090812162013.GA13341@cs.cas.cz>
References: <4A7D8E08.2070300@uottawa.ca> <20090810092141.GC10119@cs.cas.cz>
	<4A7FECCD.2010208@stats.uwo.ca>
	<353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
	<4A802CB7.3030806@stats.uwo.ca> <4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch>
	<20090811100201.GA19381@cs.cas.cz>
	<20090812115046.GA17118@cs.cas.cz>
	<19074.52084.426535.783434@lynne.math.ethz.ch>
	<20090812162013.GA13341@cs.cas.cz>
Message-ID: <19087.6412.268313.740003@deb4.math.ethz.ch>

I have taken up the issue now,
and after thinking, studying the source, trying to define a
'method = <string>' argument, came to the conclusion that both
the implementation and documentation (and source code "self-explanation")
are easiest to program, maintain, and understand,
if I introduce explicit binary switches,
so I now  propose the following R-level interface which keeps
the current behavior the default:

>> Usage:
>> 
>>      identical(x, y, num.EQ = TRUE, one.NA = TRUE, attrib.asSet = TRUE)
>> 
>> Arguments:
>> 
>>     x, y: any R objects.
>> 
>>   num.EQ: logical indicating if ('double' and 'complex' non-'NA')
>>           numbers should be compared using '==', or by bitwise
>>           comparison.  The latter (non-default) differentiates between
>>           '-0' and '+0'.
>> 
>>   one.NA: logical indicating if there is conceptually just one numeric
>>           'NA' and one 'NaN';  'one.NA = FALSE' differentiates bit
>>           patterns.
>> 
>> attrib.asSet: logical indicating if 'attributes' of 'x' and 'y' should
>>           be treated as _unordered_ tagged pairlists ("sets"); this
>>           currently also applies to 'slot's of S4 objects.  It may well
>>           be too strict to set 'attrib.asSet = FALSE'. 

I'm open for better names of arguments, but will not accept "_"
in the argument names {just my taste; no reason for argueing...}.

I've practically finished both C- and R- and Rd-code, but can
still adapt to proposals if there are good reasons for it.

Martin Maechler, ETH Zurich


From deepayan.sarkar at gmail.com  Sat Aug 22 10:06:43 2009
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Sat, 22 Aug 2009 01:06:43 -0700
Subject: [Rd] Lattice: Drawing a single contour line with a negative
	value fails
In-Reply-To: <4A8BB6A2.1060605@sbox.tugraz.at>
References: <4A8BB6A2.1060605@sbox.tugraz.at>
Message-ID: <eb555e660908220106ie51fdf7x5a37055f23a22fa3@mail.gmail.com>

On 8/19/09, Thorn Thaler <thothal at sbox.tugraz.at> wrote:
> Hi everybody,
>
>  I want to add a single contourline to a levelplot. While everything works
> fine if the value at which the line should be drawn is positive, there is an
> error if the value is negative:
>
>  library(lattice)
>  my.panel <- function(..., at, contour=FALSE, labels=NULL) {
>    panel.levelplot(..., at=at, contour=contour, labels=labels)
>    panel.contourplot(..., contour=TRUE, labels="Contour", lwd=2,
>       at=con)
>  }
>
>  x <- y <- 1:100
>  df <- expand.grid(x=x, y=y)
>  df$z <- apply(df, 1, function(x)
>    (x[1]^2+x[2]^2)*ifelse(x[1]^2+x[2]^2 < 5000, -1,1))
>  col.regions <- heat.colors(50)
>
>  # Works
>  con <- 1000
>  levelplot(df$z~df$x+df$y, col.regions=col.regions, panel=my.panel)
>
>  # Does not work
>  con <- -1000
>  levelplot(df$z~df$x+df$y, col.regions=col.regions, panel=my.panel)
>
>  I've tracked down the error to the function "cut.default", which takes an
> argument "breaks", which should be "either a numeric vector of two or more
> cut points or a single number (greater than or equal to 2) giving the number
> of intervals into which 'x' is to be cut."
>
>  So it seems to me that a single contourline at a positive value works
> because the value is interpreted as the number of intervals, even though
> there is just this single line in the resulting plot.
>
>  What would be the correct way to add just a single contour line to a
> levelplot, or is it indeed a bug?

Definitely a bug. It should be easy to fix (but I haven't had time to
get to it yet).

Using something like

con <- c(-1000, NA)

seems to work though.

-Deepayan


From savicky at cs.cas.cz  Sat Aug 22 10:22:36 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Sat, 22 Aug 2009 10:22:36 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <19087.6412.268313.740003@deb4.math.ethz.ch>
References: <4A7FECCD.2010208@stats.uwo.ca>
	<353CA09D-6769-4F58-AC2C-B7AD2CF5DE0C@r-project.org>
	<4A802CB7.3030806@stats.uwo.ca> <4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch>
	<20090811100201.GA19381@cs.cas.cz>
	<20090812115046.GA17118@cs.cas.cz>
	<19074.52084.426535.783434@lynne.math.ethz.ch>
	<20090812162013.GA13341@cs.cas.cz>
	<19087.6412.268313.740003@deb4.math.ethz.ch>
Message-ID: <20090822082236.GA11647@cs.cas.cz>

On Sat, Aug 22, 2009 at 12:00:44AM +0200, Martin Maechler wrote:
> I have taken up the issue now,
> and after thinking, studying the source, trying to define a
> 'method = <string>' argument, came to the conclusion that both
> the implementation and documentation (and source code "self-explanation")
> are easiest to program, maintain, and understand,
> if I introduce explicit binary switches,
> so I now  propose the following R-level interface which keeps
> the current behavior the default:
> 
> >> Usage:
> >> 
> >>      identical(x, y, num.EQ = TRUE, one.NA = TRUE, attrib.asSet = TRUE)
> >> 
> >> Arguments:
> >> 
> >>     x, y: any R objects.
> >> 
> >>   num.EQ: logical indicating if ('double' and 'complex' non-'NA')
> >>           numbers should be compared using '==', or by bitwise
> >>           comparison.  The latter (non-default) differentiates between
> >>           '-0' and '+0'.
> >> 
> >>   one.NA: logical indicating if there is conceptually just one numeric
> >>           'NA' and one 'NaN';  'one.NA = FALSE' differentiates bit
> >>           patterns.
> >> 
> >> attrib.asSet: logical indicating if 'attributes' of 'x' and 'y' should
> >>           be treated as _unordered_ tagged pairlists ("sets"); this
> >>           currently also applies to 'slot's of S4 objects.  It may well
> >>           be too strict to set 'attrib.asSet = FALSE'. 

I appreciate having several binary switches. Besides the arguments above,
this is also useful for an interactive use of identical(), for example,
for debugging purposes. If there is a difference between objects, then
the switches allow to get more information concerning what is the type
of the difference.

> I'm open for better names of arguments, but will not accept "_"
> in the argument names {just my taste; no reason for argueing...}.

I would slightly prefere one.NaN instead of one.NA. In IEEE 754 terminology,
R's 'NA's are a subset of 'NaN's. So. NaN is a bit more general notion,
although in R, the sets of 'NA's an 'NaN's are disjoint. Moreover, the
name one.NaN specifies more clearly, that the issue is important only
for numeric types and not, for example, for integer.

Petr.


From vitosmail at rambler.ru  Sat Aug 22 11:28:25 2009
From: vitosmail at rambler.ru (Vitalie S.)
Date: Sat, 22 Aug 2009 11:28:25 +0200
Subject: [Rd] more special completions
In-Reply-To: <eb555e660908211142p4c7954b4p4993bfc2fc052b1f@mail.gmail.com>
References: <4A8E66FF.6000201@dbmail.com>
	<op.uy0xe6epdacko8@tir-070312.staff.few.eur.nl>
	<eb555e660908211142p4c7954b4p4993bfc2fc052b1f@mail.gmail.com>
Message-ID: <op.uy14lngtdacko8@tir-070312.staff.few.eur.nl>


>>  Not sure, but another example may be a class dependent completion for
>> generic functions depending on first argument. Like print(df,... )  
>> where df
>> a data.frame to complete, digits = NULL, quote = FALSE, right = TRUE,
>> row.names = TRUE instead of only (x,...).
>
> That sort of already happens (have you tried?),

Oh, sorry, I have been confusing display of args list in emacs with R  
completions facilities. Emacs implements that directly through  
try(args(function).

>  but instead of
> print.data.frame, it gives you arguments of all print methods (only
> for S3 generics though). Finding the right signature needs evaluation
> of the right (usually first, but not necessarily) argument, which may
> actually involve another function call. Inheritance makes things more
> complicated. I'm not sure it's worth the overhead.
>

If custom function as Romain proposed, had an argument of all names typed  
after "(" (say "fArgs"), a whole range of possibilities opens up. At least  
one case when evaluation is not that demanding is new(); new() could  
generate completions for classes if fArgs is empty and completions for  
slots of class fArgs[1] otherwise.

Not to mention that various RGuis could use this facility to generate the  
list of context dependent arguments for in-line functions. Wouldn't that  
be great?!


What concerns S4 methods, findMethodSignatures is already there:
require("Matrix")
formals(getMethod("*", findMethodSignatures("*")[4, ]))
$e1
$e2

so it seems to me (a simple user) like the main "overhead" would be to  
implement custom functions with fArgs argument.



Vitalie
>-Deepayan


--


From hb at stat.berkeley.edu  Sat Aug 22 17:34:51 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sat, 22 Aug 2009 08:34:51 -0700
Subject: [Rd] identical(0, -0)
In-Reply-To: <20090822082236.GA11647@cs.cas.cz>
References: <4A7FECCD.2010208@stats.uwo.ca> <4A802CB7.3030806@stats.uwo.ca> 
	<4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch> 
	<20090811100201.GA19381@cs.cas.cz> <20090812115046.GA17118@cs.cas.cz> 
	<19074.52084.426535.783434@lynne.math.ethz.ch>
	<20090812162013.GA13341@cs.cas.cz> 
	<19087.6412.268313.740003@deb4.math.ethz.ch>
	<20090822082236.GA11647@cs.cas.cz>
Message-ID: <59d7961d0908220834v6ec48effx7fbc1281d8362094@mail.gmail.com>

On Sat, Aug 22, 2009 at 1:22 AM, Petr Savicky<savicky at cs.cas.cz> wrote:
> On Sat, Aug 22, 2009 at 12:00:44AM +0200, Martin Maechler wrote:
>> I have taken up the issue now,
>> and after thinking, studying the source, trying to define a
>> 'method = <string>' argument, came to the conclusion that both
>> the implementation and documentation (and source code "self-explanation")
>> are easiest to program, maintain, and understand,
>> if I introduce explicit binary switches,
>> so I now ?propose the following R-level interface which keeps
>> the current behavior the default:
>>
>> >> Usage:
>> >>
>> >> ? ? ?identical(x, y, num.EQ = TRUE, one.NA = TRUE, attrib.asSet = TRUE)
>> >>
>> >> Arguments:
>> >>
>> >> ? ? x, y: any R objects.
>> >>
>> >> ? num.EQ: logical indicating if ('double' and 'complex' non-'NA')
>> >> ? ? ? ? ? numbers should be compared using '==', or by bitwise
>> >> ? ? ? ? ? comparison. ?The latter (non-default) differentiates between
>> >> ? ? ? ? ? '-0' and '+0'.
>> >>
>> >> ? one.NA: logical indicating if there is conceptually just one numeric
>> >> ? ? ? ? ? 'NA' and one 'NaN'; ?'one.NA = FALSE' differentiates bit
>> >> ? ? ? ? ? patterns.
>> >>
>> >> attrib.asSet: logical indicating if 'attributes' of 'x' and 'y' should
>> >> ? ? ? ? ? be treated as _unordered_ tagged pairlists ("sets"); this
>> >> ? ? ? ? ? currently also applies to 'slot's of S4 objects. ?It may well
>> >> ? ? ? ? ? be too strict to set 'attrib.asSet = FALSE'.

My only comment is to make the argument notation a bit more consistent:

  (num.Eq, one.NA, attrib.as.set)

or

  (numEq, oneNA, attribAsSet)

Also, maybe "single" instead of "one".

Thanks

Henrik

>
> I appreciate having several binary switches. Besides the arguments above,
> this is also useful for an interactive use of identical(), for example,
> for debugging purposes. If there is a difference between objects, then
> the switches allow to get more information concerning what is the type
> of the difference.
>
>> I'm open for better names of arguments, but will not accept "_"
>> in the argument names {just my taste; no reason for argueing...}.
>
> I would slightly prefere one.NaN instead of one.NA. In IEEE 754 terminology,
> R's 'NA's are a subset of 'NaN's. So. NaN is a bit more general notion,
> although in R, the sets of 'NA's an 'NaN's are disjoint. Moreover, the
> name one.NaN specifies more clearly, that the issue is important only
> for numeric types and not, for example, for integer.
>
> Petr.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From landronimirc at gmail.com  Sat Aug 22 21:45:15 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Sat, 22 Aug 2009 20:45:15 +0100
Subject: [Rd] improving ?RweaveLatex
Message-ID: <68b1e2610908221245i4235549cw908c32e5efbdde95@mail.gmail.com>

Dear developers
Please read below.

On 6/25/09, Marc Schwartz <marc_schwartz at me.com> wrote:
>  You can use the following *after* the \begin{document} directive:
>   \setkeys{Gin}{width=0.8\textwidth}
>
>  The above is the default. Reset it to what you would like.
>
>  Note, as per that manual page, that the Sweave options 'height' and 'width'
> affect the size of the PDF and EPS files created, but it is the above
> command that controls the size of the image in the document itself.
>
Could this information be incorporate into the RweaveLatex help page?
Concerning the sizes of graphs, it contains only the following
information:
"
     width: numeric (6), width of figures in inches.
     height: numeric (6), height of figures in inches.
"
Unfortunately this concise information can easily mislead into
believing that these two options affect the graphs dynamically
produced and included in the final .pdf file. It might help for these
two sentences to specify what figures they're affecting, and also to
include some info about "\setkeys{Gin}{width=0.8\textwidth}".
Thank you
Liviu


From marc_schwartz at me.com  Sat Aug 22 22:03:04 2009
From: marc_schwartz at me.com (Marc Schwartz)
Date: Sat, 22 Aug 2009 15:03:04 -0500
Subject: [Rd] improving ?RweaveLatex
In-Reply-To: <68b1e2610908221245i4235549cw908c32e5efbdde95@mail.gmail.com>
References: <68b1e2610908221245i4235549cw908c32e5efbdde95@mail.gmail.com>
Message-ID: <1A9D0140-202D-40CE-BEC3-58765CB16D46@me.com>

On Aug 22, 2009, at 2:45 PM, Liviu Andronic wrote:

> Dear developers
> Please read below.
>
> On 6/25/09, Marc Schwartz <marc_schwartz at me.com> wrote:
>> You can use the following *after* the \begin{document} directive:
>>  \setkeys{Gin}{width=0.8\textwidth}
>>
>> The above is the default. Reset it to what you would like.
>>
>> Note, as per that manual page, that the Sweave options 'height' and  
>> 'width'
>> affect the size of the PDF and EPS files created, but it is the above
>> command that controls the size of the image in the document itself.
>>
> Could this information be incorporate into the RweaveLatex help page?
> Concerning the sizes of graphs, it contains only the following
> information:
> "
>     width: numeric (6), width of figures in inches.
>     height: numeric (6), height of figures in inches.
> "
> Unfortunately this concise information can easily mislead into
> believing that these two options affect the graphs dynamically
> produced and included in the final .pdf file. It might help for these
> two sentences to specify what figures they're affecting, and also to
> include some info about "\setkeys{Gin}{width=0.8\textwidth}".
> Thank you
> Liviu



It would also be worthwhile to include the information that Frank  
found on disabling the impact of this option, so that the use of the  
width and height arguments do actually define the plot image  
dimensions in the resultant document. Frank noted it here:

   https://stat.ethz.ch/pipermail/r-help/2009-June/202757.html

The key content is:

Regarding the issue of preventing Sweave from issuing the Gin option  
to set all graphics output to have a width of 0.8\textwidth, it's as  
easy as using \usepackage[nogin]{Sweave} ...


After seeing Frank's reference, the only way that one would otherwise  
note it is to read Sweave.sty directly.

In my Sweave template .Rnw file, I am now actually using the [nogin]  
option by default and set the plot dimensions for each figure chunk as  
required.

Thanks Liviu for the above.

HTH,

Marc


From marc_schwartz at me.com  Sat Aug 22 23:30:05 2009
From: marc_schwartz at me.com (Marc Schwartz)
Date: Sat, 22 Aug 2009 16:30:05 -0500
Subject: [Rd] improving ?RweaveLatex
In-Reply-To: <1A9D0140-202D-40CE-BEC3-58765CB16D46@me.com>
References: <68b1e2610908221245i4235549cw908c32e5efbdde95@mail.gmail.com>
	<1A9D0140-202D-40CE-BEC3-58765CB16D46@me.com>
Message-ID: <526F10DE-7048-4AA1-A76D-7D863176DB1F@me.com>

On Aug 22, 2009, at 3:03 PM, Marc Schwartz wrote:

> On Aug 22, 2009, at 2:45 PM, Liviu Andronic wrote:
>
>> Dear developers
>> Please read below.
>>
>> On 6/25/09, Marc Schwartz <marc_schwartz at me.com> wrote:
>>> You can use the following *after* the \begin{document} directive:
>>> \setkeys{Gin}{width=0.8\textwidth}
>>>
>>> The above is the default. Reset it to what you would like.
>>>
>>> Note, as per that manual page, that the Sweave options 'height'  
>>> and 'width'
>>> affect the size of the PDF and EPS files created, but it is the  
>>> above
>>> command that controls the size of the image in the document itself.
>>>
>> Could this information be incorporate into the RweaveLatex help page?
>> Concerning the sizes of graphs, it contains only the following
>> information:
>> "
>>    width: numeric (6), width of figures in inches.
>>    height: numeric (6), height of figures in inches.
>> "
>> Unfortunately this concise information can easily mislead into
>> believing that these two options affect the graphs dynamically
>> produced and included in the final .pdf file. It might help for these
>> two sentences to specify what figures they're affecting, and also to
>> include some info about "\setkeys{Gin}{width=0.8\textwidth}".
>> Thank you
>> Liviu
>
>
>
> It would also be worthwhile to include the information that Frank  
> found on disabling the impact of this option, so that the use of the  
> width and height arguments do actually define the plot image  
> dimensions in the resultant document. Frank noted it here:
>
>  https://stat.ethz.ch/pipermail/r-help/2009-June/202757.html
>
> The key content is:
>
> Regarding the issue of preventing Sweave from issuing the Gin option  
> to set all graphics output to have a width of 0.8\textwidth, it's as  
> easy as using \usepackage[nogin]{Sweave} ...
>
>
> After seeing Frank's reference, the only way that one would  
> otherwise note it is to read Sweave.sty directly.
>
> In my Sweave template .Rnw file, I am now actually using the [nogin]  
> option by default and set the plot dimensions for each figure chunk  
> as required.
>
> Thanks Liviu for the above.


I have some proposed modifications to RweaveLatex.Rd which I include  
here as a patch against the R-devel version of the file from svn. I  
have added comments about the issue that Liviu raised, the use of the  
[nogin] option and while I was at it, the [noae] option as well. There  
are added to the 'details' section of the file.

I hope that this is helpful.

Regards,

Marc


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: patch.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090822/b40707a5/attachment.txt>
-------------- next part --------------




From marc_schwartz at me.com  Sat Aug 22 23:51:31 2009
From: marc_schwartz at me.com (Marc Schwartz)
Date: Sat, 22 Aug 2009 16:51:31 -0500
Subject: [Rd] improving ?RweaveLatex
In-Reply-To: <526F10DE-7048-4AA1-A76D-7D863176DB1F@me.com>
References: <68b1e2610908221245i4235549cw908c32e5efbdde95@mail.gmail.com>
	<1A9D0140-202D-40CE-BEC3-58765CB16D46@me.com>
	<526F10DE-7048-4AA1-A76D-7D863176DB1F@me.com>
Message-ID: <6D6B7156-C847-4039-8D33-FAEFEA49AF5A@me.com>

<snip>

On Aug 22, 2009, at 4:30 PM, Marc Schwartz wrote:
>
> I have some proposed modifications to RweaveLatex.Rd which I include  
> here as a patch against the R-devel version of the file from svn. I  
> have added comments about the issue that Liviu raised, the use of  
> the [nogin] option and while I was at it, the [noae] option as well.  
> There are added to the 'details' section of the file.

OK, once more....

I noted a typo and also neglected to add pointers to the Details  
section in the descriptions of the height and width options.

Here is a corrected version of the patch file.

Marc


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: patch.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090822/c7693649/attachment.txt>
-------------- next part --------------




From uwe_f_mayer at yahoo.com  Sat Aug 22 04:58:00 2009
From: uwe_f_mayer at yahoo.com (Uwe F. Mayer)
Date: Fri, 21 Aug 2009 19:58:00 -0700 (PDT)
Subject: [Rd] R compilation problem on 64 bit SunOS (PR#13898)
In-Reply-To: <alpine.LFD.2.00.0908210951570.30839@gannet.stats.ox.ac.uk>
Message-ID: <674189.45624.qm@web30708.mail.mud.yahoo.com>

A follow-up: I specified --disable-nls, but nevertheless locale.h is included, which then includes libintl.h.

I also install the the GNU gettext package, but I am getting the same error message (obviously now at libintl.h from the GNU package at a different line count), so that did not fix it.

As far as I can tell this is a configuration problem, since locale.h should not be included in the first place if --disable-nls is specified.

--- On Fri, 8/21/09, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:

> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
> Subject: Re: [Rd] R compilation problem on 64 bit SunOS (PR#13898)
> To: "Peter Dalgaard" <P.Dalgaard at biostat.ku.dk>
> Cc: uwe_f_mayer at yahoo.com, R-bugs at r-project.org, r-devel at stat.math.ethz.ch
> Date: Friday, August 21, 2009, 1:54 AM
> On Fri, 21 Aug 2009, Peter Dalgaard
> wrote:
> 
> > Prof Brian Ripley wrote:
> > [snip]
> >> In fact you did not specifically not request nls:
> use the flag from the
> >> gcc specs below to do so (as someone did for
> gcc).
> >
> > Brian, I see --disable-nls in both places, so you may
> want to expand on
> > that. (I could well be missing the point, but then I'd
> like to know what
> > it was.)
> 
> The include of libintl.h is inside ENABLE_NLS, and when I
> tried with 
> --disable-nls it was not included.? So I cannot
> reproduce this if that 
> option was actually used.
> 
> The point is that Solaris' libintl.h is incompatible with
> the GNU one.
> 
> >
> >>
> >>> Specifics:
> >>>
> >>> gcc -v
> >>> Using built-in specs.
> >>> Target: x86_64-pc-solaris2.10
> >>> Configured with:
> ../../src/gcc-4.4.0/configure
> >>>
> --prefix=/usr/local/opt/x86_64-pc-solaris2.10/gcc-4.4.0
> >>>
> --with-gmp=/usr/local/opt/x86_64-pc-solaris2.10
> >>>
> --with-mpfr=/usr/local/opt/x86_64-pc-solaris2.10
> --disable-nls
> >>> --enable-languages=c,c++,fortran -with-gnu-as
> --without-gnu-ld
> >>> --with-ld=/usr/ccs/bin/ld
> --with-as=/usr/sfw/bin/gas CC='gcc -m64'
> >>> CXX='g++
> >>> -m64' CFLAGS='-m64 -g -O2' CXXFLAGS='-m64 -g
> -O2' LDFLAGS=-m64
> >>> Thread model: posix
> >>> gcc version 4.4.0 (GCC)
> >>>
> >>> R version: 2.9.1 (2009-06-29)
> >>>
> >>> R configuration
> >>> ../../src/R-2.9.1/configure
> >>>
> --prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1
> >>>
> --exec-prefix=/usr/local/opt/x86_64-pc-solaris2.10/R-2.9.1
> --disable-nls
> >>> --without-recommended-packages --with-readline
> --with-gnu-ld CC="gcc -m64
> >>>
> -I/usr/local/opt/x86_64-pc-solaris2.10/include
> >>> -L/usr/local/opt/x86_64-pc-solaris2.10/lib"
> F77="gfortran -m64"
> >>> CXX="g++ -m64"
> >>> FC="gfortran -m64" LIBnn=lib64
> >>>
> LD=/usr/local/opt/x86_64-pc-solaris2.10/bin/ld
> >>
> > [snip]
> >
> > --
> >???O__? ---- Peter Dalgaard?
> ? ? ? ? ????ster
> Farimagsgade 5, Entr.B
> >? c/ /'_ --- Dept. of Biostatistics?
> ???PO Box 2099, 1014 Cph. K
> > (*) \(*) -- University of
> Copenhagen???Denmark? ? ?
> Ph:? (+45) 35327918
> > ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)?
> ? ? ? ? ? ? FAX: (+45)
> 35327907
> >
> >
> 
> -- 
> Brian D. Ripley,? ? ? ? ? ?
> ? ? ? ripley at stats.ox.ac.uk
> Professor of Applied Statistics,? http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,? ? ? ? ?
> ???Tel:? +44 1865 272861 (self)
> 1 South Parks Road,? ? ? ? ?
> ? ? ? ? ???+44 1865
> 272866 (PA)
> Oxford OX1 3TG, UK? ? ? ? ? ?
> ? ? Fax:? +44 1865 272595





From saptarshi.guha at gmail.com  Mon Aug 24 05:52:28 2009
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Sun, 23 Aug 2009 23:52:28 -0400
Subject: [Rd] Basic Question regarding PROTECT
Message-ID: <1e7471d50908232052y1f4ae6e5p57ad8c9f213ef611@mail.gmail.com>

Hello,
Suppose I have the function
SEXP foo(){
SEXP s;
PROTECT(s=allocVector(...))

....
UNPROTECT(1);
return(s)
}

y=foo() // foo is a recusrive call

Q: Am i correct in understanding that one does not need to write
PROTECT(y=foo()) ?(and a corresponding unprotect  later on)
since it is the object that is protected , SEXP is an alias for
SEXPREC* and allocVector probably does some memory allocation which
does not get freed
when foo returns.

Thank you for your time
Regards
Saptarshi


From murdoch at stats.uwo.ca  Mon Aug 24 14:18:25 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 24 Aug 2009 08:18:25 -0400
Subject: [Rd] Basic Question regarding PROTECT
In-Reply-To: <1e7471d50908232052y1f4ae6e5p57ad8c9f213ef611@mail.gmail.com>
References: <1e7471d50908232052y1f4ae6e5p57ad8c9f213ef611@mail.gmail.com>
Message-ID: <4A928511.2040607@stats.uwo.ca>

On 8/23/2009 11:52 PM, Saptarshi Guha wrote:
> Hello,
> Suppose I have the function
> SEXP foo(){
> SEXP s;
> PROTECT(s=allocVector(...))
> 
> ....
> UNPROTECT(1);
> return(s)
> }
> 
> y=foo() // foo is a recusrive call
> 
> Q: Am i correct in understanding that one does not need to write
> PROTECT(y=foo()) ?(and a corresponding unprotect  later on)
> since it is the object that is protected , SEXP is an alias for
> SEXPREC* and allocVector probably does some memory allocation which
> does not get freed
> when foo returns.

Whether y needs protecting depends on what happens between the y = foo() 
call and the time you return to R.  If nothing happens, i.e. you just 
return y to R, then you're safe.  If you do any memory allocations after 
that call before returning to R then y will need to be protected.

Duncan Murdoch


From saptarshi.guha at gmail.com  Mon Aug 24 15:10:13 2009
From: saptarshi.guha at gmail.com (Sapsi)
Date: Mon, 24 Aug 2009 09:10:13 -0400
Subject: [Rd] Basic Question regarding PROTECT
In-Reply-To: <4A928511.2040607@stats.uwo.ca>
References: <1e7471d50908232052y1f4ae6e5p57ad8c9f213ef611@mail.gmail.com>
	<4A928511.2040607@stats.uwo.ca>
Message-ID: <A094ED1F-4CF6-46CD-8972-22D57C65D0D2@gmail.com>

Hello
Thank you for the response. So if my call is

y=foo()
z=malloc ( by memory allocations , do you mean via R_alloc and  
allocVector and malloc or just the former two)
Other statements

Then I need  to protect y. And in my case I don't return to R since I  
have embedded it.

Why is this the case I.e if I perform mem allocs , I need to protect y
On Aug 24, 2009, at 8:18 AM, Duncan Murdoch <murdoch at stats.uwo.ca>   
wrote:r
C
> On 8/23/2009 11:52 PM, Saptarshi Guha wrote:
>> Hello,
>> Suppose I have the function
>> SEXP foo(){
>> SEXP s;
>> PROTECT(s=allocVector(...))
>> ....
>> UNPROTECT(1);
>> return(s)
>> }
>> y=foo() // foo is a recusrive call
>> Q: Am i correct in understanding that one does not need to write
>> PROTECT(y=foo()) ?(and a corresponding unprotect  later on)
>> since it is the object that is protected , SEXP is an alias for
>> SEXPREC* and allocVector probably does some memory allocation which
>> does not get freed
>> when foo returns.
>
> Whether y needs protecting depends on what happens between the y =  
> foo() call and the time you return to R.  If nothing happens, i.e.  
> you just return y to R, then you're safe.  If you do any memory  
> allocations after that call before returning to R then y will need  
> to be protected.
>
> Duncan Murdoch


From murdoch at stats.uwo.ca  Mon Aug 24 15:24:27 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 24 Aug 2009 09:24:27 -0400
Subject: [Rd] Basic Question regarding PROTECT
In-Reply-To: <A094ED1F-4CF6-46CD-8972-22D57C65D0D2@gmail.com>
References: <1e7471d50908232052y1f4ae6e5p57ad8c9f213ef611@mail.gmail.com>
	<4A928511.2040607@stats.uwo.ca>
	<A094ED1F-4CF6-46CD-8972-22D57C65D0D2@gmail.com>
Message-ID: <4A92948B.8000908@stats.uwo.ca>

On 8/24/2009 9:10 AM, Sapsi wrote:
> Hello
> Thank you for the response. So if my call is
> 
> y=foo()
> z=malloc ( by memory allocations , do you mean via R_alloc and  
> allocVector and malloc or just the former two)

Any allocation which is managed by R's memory manager, so that includes 
the former two, and many other kinds of calls which do allocations, i.e. 
essentially any call to the R API unless it's documented not to do 
allocations. In most cases calling PROTECT is quite cheap, so it is 
worth doing if you're not sure.  (There are exceptions:  because the 
PROTECT stack is finite, you can overflow it if you PROTECT too much. 
That could happen in a loop or a deep recursion.)


> Other statements
> 
> Then I need  to protect y. And in my case I don't return to R since I  
> have embedded it.
> 
> Why is this the case I.e if I perform mem allocs , I need to protect y

Because R's memory manager does automatic garbage collection.  If you 
don't protect y, then the memory manager will not know that it is still 
in use.  The next time it needs some memory it may decide to free y and 
re-use that space.

Duncan Murdoch


> On Aug 24, 2009, at 8:18 AM, Duncan Murdoch <murdoch at stats.uwo.ca>   
> wrote:r
> C
>> On 8/23/2009 11:52 PM, Saptarshi Guha wrote:
>>> Hello,
>>> Suppose I have the function
>>> SEXP foo(){
>>> SEXP s;
>>> PROTECT(s=allocVector(...))
>>> ....
>>> UNPROTECT(1);
>>> return(s)
>>> }
>>> y=foo() // foo is a recusrive call
>>> Q: Am i correct in understanding that one does not need to write
>>> PROTECT(y=foo()) ?(and a corresponding unprotect  later on)
>>> since it is the object that is protected , SEXP is an alias for
>>> SEXPREC* and allocVector probably does some memory allocation which
>>> does not get freed
>>> when foo returns.
>>
>> Whether y needs protecting depends on what happens between the y =  
>> foo() call and the time you return to R.  If nothing happens, i.e.  
>> you just return y to R, then you're safe.  If you do any memory  
>> allocations after that call before returning to R then y will need  
>> to be protected.
>>
>> Duncan Murdoch


From saptarshi.guha at gmail.com  Mon Aug 24 15:33:14 2009
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Mon, 24 Aug 2009 09:33:14 -0400
Subject: [Rd] Basic Question regarding PROTECT
In-Reply-To: <4A92948B.8000908@stats.uwo.ca>
References: <1e7471d50908232052y1f4ae6e5p57ad8c9f213ef611@mail.gmail.com> 
	<4A928511.2040607@stats.uwo.ca>
	<A094ED1F-4CF6-46CD-8972-22D57C65D0D2@gmail.com> 
	<4A92948B.8000908@stats.uwo.ca>
Message-ID: <1e7471d50908240633u5db73463u3dc31a45e25d2656@mail.gmail.com>

Thank you. So the reason I wouldnt need to protect y had I returned to
R, is because
had i had done something like

h<-.Call("boo",a)
where "boo" contains y=foo()

the assignment "<-" to h would have a PROTECT somewhere, i.e R's
assignment is doing the protection for me.
Had I not returned to R, I would have to do it myself.

Yes PROTECT is quite cheap, I had thought it to be costly but 1MM
PROTECT/UNPROTECT calls, takes <1 second  (on a macbook 2.16ghz)

Thanks for the explanation.
Regards
Saptarshi

On Mon, Aug 24, 2009 at 9:24 AM, Duncan Murdoch<murdoch at stats.uwo.ca> wrote:
> On 8/24/2009 9:10 AM, Sapsi wrote:
>>
>> Hello
>> Thank you for the response. So if my call is
>>
>> y=foo()
>> z=malloc ( by memory allocations , do you mean via R_alloc and
>> ?allocVector and malloc or just the former two)
>
> Any allocation which is managed by R's memory manager, so that includes the
> former two, and many other kinds of calls which do allocations, i.e.
> essentially any call to the R API unless it's documented not to do
> allocations. In most cases calling PROTECT is quite cheap, so it is worth
> doing if you're not sure. ?(There are exceptions: ?because the PROTECT stack
> is finite, you can overflow it if you PROTECT too much. That could happen in
> a loop or a deep recursion.)
>
>
>> Other statements
>>
>> Then I need ?to protect y. And in my case I don't return to R since I
>> ?have embedded it.
>>
>> Why is this the case I.e if I perform mem allocs , I need to protect y
>
> Because R's memory manager does automatic garbage collection. ?If you don't
> protect y, then the memory manager will not know that it is still in use.
> ?The next time it needs some memory it may decide to free y and re-use that
> space.
>
> Duncan Murdoch
>
>
>> On Aug 24, 2009, at 8:18 AM, Duncan Murdoch <murdoch at stats.uwo.ca>
>> wrote:r
>> C
>>>
>>> On 8/23/2009 11:52 PM, Saptarshi Guha wrote:
>>>>
>>>> Hello,
>>>> Suppose I have the function
>>>> SEXP foo(){
>>>> SEXP s;
>>>> PROTECT(s=allocVector(...))
>>>> ....
>>>> UNPROTECT(1);
>>>> return(s)
>>>> }
>>>> y=foo() // foo is a recusrive call
>>>> Q: Am i correct in understanding that one does not need to write
>>>> PROTECT(y=foo()) ?(and a corresponding unprotect ?later on)
>>>> since it is the object that is protected , SEXP is an alias for
>>>> SEXPREC* and allocVector probably does some memory allocation which
>>>> does not get freed
>>>> when foo returns.
>>>
>>> Whether y needs protecting depends on what happens between the y = ?foo()
>>> call and the time you return to R. ?If nothing happens, i.e. ?you just
>>> return y to R, then you're safe. ?If you do any memory ?allocations after
>>> that call before returning to R then y will need ?to be protected.
>>>
>>> Duncan Murdoch
>
>


From murdoch at stats.uwo.ca  Mon Aug 24 15:39:54 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 24 Aug 2009 09:39:54 -0400
Subject: [Rd] Basic Question regarding PROTECT
In-Reply-To: <1e7471d50908240633u5db73463u3dc31a45e25d2656@mail.gmail.com>
References: <1e7471d50908232052y1f4ae6e5p57ad8c9f213ef611@mail.gmail.com>
	<4A928511.2040607@stats.uwo.ca>
	<A094ED1F-4CF6-46CD-8972-22D57C65D0D2@gmail.com>
	<4A92948B.8000908@stats.uwo.ca>
	<1e7471d50908240633u5db73463u3dc31a45e25d2656@mail.gmail.com>
Message-ID: <4A92982A.3060201@stats.uwo.ca>

On 8/24/2009 9:33 AM, Saptarshi Guha wrote:
> Thank you. So the reason I wouldnt need to protect y had I returned to
> R, is because
> had i had done something like
> 
> h<-.Call("boo",a)
> where "boo" contains y=foo()
> 
> the assignment "<-" to h would have a PROTECT somewhere, i.e R's
> assignment is doing the protection for me.

Once the object is assigned to h, then it is stored in the global 
environment, so it is safe from garbage collection without needing to be 
PROTECTed.  It's just in the short time after creation before storage 
where it's at risk.

One general rule in R is that things are in use if they are part of 
something that is in use (and the global environment is always in use). 
  PROTECT is another way to mark something as being in use.  When 
something is in use the garbage collector will leave it alone.

Duncan Murdoch


> Had I not returned to R, I would have to do it myself.
> 
> Yes PROTECT is quite cheap, I had thought it to be costly but 1MM
> PROTECT/UNPROTECT calls, takes <1 second  (on a macbook 2.16ghz)
> 
> Thanks for the explanation.
> Regards
> Saptarshi
> 
> On Mon, Aug 24, 2009 at 9:24 AM, Duncan Murdoch<murdoch at stats.uwo.ca> wrote:
>> On 8/24/2009 9:10 AM, Sapsi wrote:
>>>
>>> Hello
>>> Thank you for the response. So if my call is
>>>
>>> y=foo()
>>> z=malloc ( by memory allocations , do you mean via R_alloc and
>>>  allocVector and malloc or just the former two)
>>
>> Any allocation which is managed by R's memory manager, so that includes the
>> former two, and many other kinds of calls which do allocations, i.e.
>> essentially any call to the R API unless it's documented not to do
>> allocations. In most cases calling PROTECT is quite cheap, so it is worth
>> doing if you're not sure.  (There are exceptions:  because the PROTECT stack
>> is finite, you can overflow it if you PROTECT too much. That could happen in
>> a loop or a deep recursion.)
>>
>>
>>> Other statements
>>>
>>> Then I need  to protect y. And in my case I don't return to R since I
>>>  have embedded it.
>>>
>>> Why is this the case I.e if I perform mem allocs , I need to protect y
>>
>> Because R's memory manager does automatic garbage collection.  If you don't
>> protect y, then the memory manager will not know that it is still in use.
>>  The next time it needs some memory it may decide to free y and re-use that
>> space.
>>
>> Duncan Murdoch
>>
>>
>>> On Aug 24, 2009, at 8:18 AM, Duncan Murdoch <murdoch at stats.uwo.ca>
>>> wrote:r
>>> C
>>>>
>>>> On 8/23/2009 11:52 PM, Saptarshi Guha wrote:
>>>>>
>>>>> Hello,
>>>>> Suppose I have the function
>>>>> SEXP foo(){
>>>>> SEXP s;
>>>>> PROTECT(s=allocVector(...))
>>>>> ....
>>>>> UNPROTECT(1);
>>>>> return(s)
>>>>> }
>>>>> y=foo() // foo is a recusrive call
>>>>> Q: Am i correct in understanding that one does not need to write
>>>>> PROTECT(y=foo()) ?(and a corresponding unprotect  later on)
>>>>> since it is the object that is protected , SEXP is an alias for
>>>>> SEXPREC* and allocVector probably does some memory allocation which
>>>>> does not get freed
>>>>> when foo returns.
>>>>
>>>> Whether y needs protecting depends on what happens between the y =  foo()
>>>> call and the time you return to R.  If nothing happens, i.e.  you just
>>>> return y to R, then you're safe.  If you do any memory  allocations after
>>>> that call before returning to R then y will need  to be protected.
>>>>
>>>> Duncan Murdoch
>>
>>


From saptarshi.guha at gmail.com  Mon Aug 24 15:45:59 2009
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Mon, 24 Aug 2009 09:45:59 -0400
Subject: [Rd] Basic Question regarding PROTECT
In-Reply-To: <4A92982A.3060201@stats.uwo.ca>
References: <1e7471d50908232052y1f4ae6e5p57ad8c9f213ef611@mail.gmail.com> 
	<4A928511.2040607@stats.uwo.ca>
	<A094ED1F-4CF6-46CD-8972-22D57C65D0D2@gmail.com> 
	<4A92948B.8000908@stats.uwo.ca>
	<1e7471d50908240633u5db73463u3dc31a45e25d2656@mail.gmail.com> 
	<4A92982A.3060201@stats.uwo.ca>
Message-ID: <1e7471d50908240645u2431d24aw5d4c34554f7d14ad@mail.gmail.com>

Oh! Yes, this is the GC at work, "root objects" and everything
referenced from them.
I think I'm understanding the need for PROTECT better.

Thank you
Saptarshi


On Mon, Aug 24, 2009 at 9:39 AM, Duncan Murdoch<murdoch at stats.uwo.ca> wrote:
> On 8/24/2009 9:33 AM, Saptarshi Guha wrote:
>>
>> Thank you. So the reason I wouldnt need to protect y had I returned to
>> R, is because
>> had i had done something like
>>
>> h<-.Call("boo",a)
>> where "boo" contains y=foo()
>>
>> the assignment "<-" to h would have a PROTECT somewhere, i.e R's
>> assignment is doing the protection for me.
>
> Once the object is assigned to h, then it is stored in the global
> environment, so it is safe from garbage collection without needing to be
> PROTECTed. ?It's just in the short time after creation before storage where
> it's at risk.
>
> One general rule in R is that things are in use if they are part of
> something that is in use (and the global environment is always in use).
> ?PROTECT is another way to mark something as being in use. ?When something
> is in use the garbage collector will leave it alone.
>
> Duncan Murdoch
>
>
>> Had I not returned to R, I would have to do it myself.
>>
>> Yes PROTECT is quite cheap, I had thought it to be costly but 1MM
>> PROTECT/UNPROTECT calls, takes <1 second ?(on a macbook 2.16ghz)
>>
>> Thanks for the explanation.
>> Regards
>> Saptarshi
>>
>> On Mon, Aug 24, 2009 at 9:24 AM, Duncan Murdoch<murdoch at stats.uwo.ca>
>> wrote:
>>>
>>> On 8/24/2009 9:10 AM, Sapsi wrote:
>>>>
>>>> Hello
>>>> Thank you for the response. So if my call is
>>>>
>>>> y=foo()
>>>> z=malloc ( by memory allocations , do you mean via R_alloc and
>>>> ?allocVector and malloc or just the former two)
>>>
>>> Any allocation which is managed by R's memory manager, so that includes
>>> the
>>> former two, and many other kinds of calls which do allocations, i.e.
>>> essentially any call to the R API unless it's documented not to do
>>> allocations. In most cases calling PROTECT is quite cheap, so it is worth
>>> doing if you're not sure. ?(There are exceptions: ?because the PROTECT
>>> stack
>>> is finite, you can overflow it if you PROTECT too much. That could happen
>>> in
>>> a loop or a deep recursion.)
>>>
>>>
>>>> Other statements
>>>>
>>>> Then I need ?to protect y. And in my case I don't return to R since I
>>>> ?have embedded it.
>>>>
>>>> Why is this the case I.e if I perform mem allocs , I need to protect y
>>>
>>> Because R's memory manager does automatic garbage collection. ?If you
>>> don't
>>> protect y, then the memory manager will not know that it is still in use.
>>> ?The next time it needs some memory it may decide to free y and re-use
>>> that
>>> space.
>>>
>>> Duncan Murdoch
>>>
>>>
>>>> On Aug 24, 2009, at 8:18 AM, Duncan Murdoch <murdoch at stats.uwo.ca>
>>>> wrote:r
>>>> C
>>>>>
>>>>> On 8/23/2009 11:52 PM, Saptarshi Guha wrote:
>>>>>>
>>>>>> Hello,
>>>>>> Suppose I have the function
>>>>>> SEXP foo(){
>>>>>> SEXP s;
>>>>>> PROTECT(s=allocVector(...))
>>>>>> ....
>>>>>> UNPROTECT(1);
>>>>>> return(s)
>>>>>> }
>>>>>> y=foo() // foo is a recusrive call
>>>>>> Q: Am i correct in understanding that one does not need to write
>>>>>> PROTECT(y=foo()) ?(and a corresponding unprotect ?later on)
>>>>>> since it is the object that is protected , SEXP is an alias for
>>>>>> SEXPREC* and allocVector probably does some memory allocation which
>>>>>> does not get freed
>>>>>> when foo returns.
>>>>>
>>>>> Whether y needs protecting depends on what happens between the y =
>>>>> ?foo()
>>>>> call and the time you return to R. ?If nothing happens, i.e. ?you just
>>>>> return y to R, then you're safe. ?If you do any memory ?allocations
>>>>> after
>>>>> that call before returning to R then y will need ?to be protected.
>>>>>
>>>>> Duncan Murdoch
>>>
>>>
>
>


From tlumley at u.washington.edu  Mon Aug 24 17:20:44 2009
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 24 Aug 2009 08:20:44 -0700 (PDT)
Subject: [Rd] Basic Question regarding PROTECT
In-Reply-To: <1e7471d50908240633u5db73463u3dc31a45e25d2656@mail.gmail.com>
Message-ID: <Pine.LNX.4.43.0908240820440.26977@hymn14.u.washington.edu>

On Mon, 24 Aug 2009, Saptarshi Guha wrote:

> Thank you. So the reason I wouldnt need to protect y had I returned to
> R, is because had i had done something like
> 
> h<-.Call("boo",a)
> where "boo" contains y=foo()
> 
> the assignment "<-" to h would have a PROTECT somewhere, i.e R's
> assignment is doing the protection for me.
> Had I not returned to R, I would have to do it myself.
> 
> Yes PROTECT is quite cheap, I had thought it to be costly but 1MM
> PROTECT/UNPROTECT calls, takes <1 second  (on a macbook 2.16ghz)

That's not where the cost would be.   PROTECT/UNPROTECT calls themselves are very cheap, since they just push and pop pointers from a stack. Any real impact of different strategies in using PROTECT would be seen in the garbage collector.  

     -thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From edd at debian.org  Mon Aug 24 17:36:27 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 24 Aug 2009 10:36:27 -0500
Subject: [Rd] Package-level access to Rp->R_Quiet ?
In-Reply-To: <19076.53668.327171.363843@ron.nulle.part>
References: <19076.53668.327171.363843@ron.nulle.part>
Message-ID: <19090.45947.517288.391342@ron.nulle.part>


On 13 August 2009 at 21:53, Dirk Eddelbuettel wrote:
| I would like to simulate the effect of the command-line option --quiet from
| user-level scripts and startup code.  From src/main/CommandLineArgs.c I learn
| that Rp->R_Quiet is set, and I see how that is used in main/main.c.
| 
| I would use this from code in Rprofile.site. In other words, I want to be
| silent when --quiet is used (as e.g. by littler or Rscript) but not by R
| itself in normal interactive mode or from ESS.
| 
| But it seems that I cannot get to this variable outside of the main
| interpreter.  Could this symbol be exported?

Apparently one cannot from user-space at the R level. But by poking into the
not-exported-and-susceptible-to-changes R_ext/RStartup.h header, one can. So
here is a quick littler script using Oleg's inline package:

  #!/usr/bin/r

  suppressMessages(library(inline))

  fn <- cfunction(signature(x="integer"),   # can't we have void functions?
                  body="structRstart rp;
                        Rstart Rp = &rp;
                        R_DefParams(Rp);
                        if (Rp->R_Quiet) Rprintf(\"(quiet) Hello, world!\\n\"); 
                        if (!Rp->R_Quiet) Rprintf(\"(not quiet) Hello, world!\\n\"); ",
                  includes="#include <R_ext/RStartup.h>",
                  convention=".C")
  fn(1)

which runs as expected:

  ~/R/misc$ ./inline_Rprintf.r
  (not quiet) Hello, world!
  ~/R/misc$ 

I still see use for a variant of cat() or warning() or something that could
this test from userspace.  If anyone at R Core agrees, I could submit a
modest patch

Dirk

-- 
Three out of two people have difficulties with fractions.


From ct529 at york.ac.uk  Mon Aug 24 18:02:11 2009
From: ct529 at york.ac.uk (Corrado)
Date: Mon, 24 Aug 2009 17:02:11 +0100
Subject: [Rd] Formulas in gam function of mgcv package
Message-ID: <200908241702.12132.ct529@york.ac.uk>

Dear R-experts,

I have a question on the formulas used in the gam function of the mgcv 
package.

I am trying to understand the relationships between:

y~s(x1)+s(x2)+s(x3)+s(x4)

and 

y~s(x1,x2,x3,x4)

Does the latter contain the former? what about the smoothers of all 
interaction terms? 

I have (tried to) read the manual pages of gam, formula.gam, smooth.terms, 
linear.functional.terms but could not understand properly.

Regards
-- 
Corrado Topi

Global Climate Change & Biodiversity Indicators
Area 18,Department of Biology
University of York, York, YO10 5YW, UK
Phone: + 44 (0) 1904 328645, E-mail: ct529 at york.ac.uk


From therneau at mayo.edu  Mon Aug 24 22:38:08 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Mon, 24 Aug 2009 15:38:08 -0500
Subject: [Rd] CRAN and noweb
Message-ID: <1251146288.6215.25.camel@punchbuggy>

his is a query for suggestions on how best to setup the package for
coxme.  This should be ready for CRAN in about a week - I'm working out
documentation details and some last test cases.

The R CMD check and INSTALL processes work great on my computer.  The
rub is that they depend on noweb.  Both algorithmicly and statistically
this is the most complex bit of code I have done, and after some reading
I decided to give the "literal programming" approach a try.  It turns
out to be one of the better ideas I've ever tried. 

The current package directory (on r-forge.r-progject.org) has a
configure script of
        (cd R; make fun)
which causes most of the R files to be built from the parent .Rnw files
in inst/noweb.  The cleanup script is (cd R; make clean) to remove them.
This follows the Rforge suggestion that derived files not be under
version control. Sweave is not able to extract files from the Rnw source
since there are cascading definitions: chunk <<a>> references chunk
<<b>> defined at a later (or earlier) point in the document.

I don't have to retain "autosubmit" from Rforge.  Perhaps the best I can
do is to make a local copy, create the .R files there, delete the config
and cleanup scripts, and submit that?  Any ideas are appreciated.

Terry Therneau


From macrakis at alum.mit.edu  Mon Aug 24 23:19:22 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Mon, 24 Aug 2009 17:19:22 -0400
Subject: [Rd] nchar on factors
Message-ID: <8b356f880908241419w53a6c85ej37cfc39660265071@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090824/aec9c676/attachment.pl>

From p.dalgaard at biostat.ku.dk  Mon Aug 24 23:36:56 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 24 Aug 2009 23:36:56 +0200
Subject: [Rd] nchar on factors
In-Reply-To: <8b356f880908241419w53a6c85ej37cfc39660265071@mail.gmail.com>
References: <8b356f880908241419w53a6c85ej37cfc39660265071@mail.gmail.com>
Message-ID: <4A9307F8.8080406@biostat.ku.dk>

Stavros Macrakis wrote:
> In R 2.9.1 Windows:
> 
>> nchar(factor(paste('sdf',1:10)))
>  [1] 1 1 1 1 1 1 1 1 2 1
> 
> so it appears that nchar is counting the number of characters in the numeric
> representation, just like:
> 
>> nchar(as.numeric(factor(paste('sdf',1:10))))
>  [1] 1 1 1 1 1 1 1 1 2 1
> 
> but ?nchar says explicitly:
> 
>      x: character vector, or a vector to be coerced to a character
>           vector.
>      ...
>      The internal equivalent of the default method of 'as.character' is
>      performed on 'x' (so there is no method dispatch).
> 
> This would seem to say that nchar should behave the same as:
> 
>> nchar(as.character(factor(paste('sdf',1:10))))
>  [1] 5 5 5 5 5 5 5 5 5 6
> 
> Either the documentation or the code should be corrected.  Personally, I'd
> find the documented behavior much more useful, but I suppose that there is
> existing code that depends on the implementation's behavior rather than the
> specification.

The documentation has:

 >>
The internal equivalent of the default method of as.character is 
performed on x (so there is no method dispatch). If you want to operate 
on non-vector objects passing them through deparse first will be required.
<<

and (notice the no method dispatch bit)

 > as.character(unclass(factor(LETTERS)))
  [1] "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12" "13" 
"14" "15"
[16] "16" "17" "18" "19" "20" "21" "22" "23" "24" "25" "26"

So, the documentation does appear to be in sync with the code (useful or 
not).


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From macrakis at alum.mit.edu  Tue Aug 25 00:10:00 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Mon, 24 Aug 2009 18:10:00 -0400
Subject: [Rd] nchar on factors
In-Reply-To: <4A9307F8.8080406@biostat.ku.dk>
References: <8b356f880908241419w53a6c85ej37cfc39660265071@mail.gmail.com>
	<4A9307F8.8080406@biostat.ku.dk>
Message-ID: <8b356f880908241510i5ee5c8c0vf913e971f4fe0178@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090824/94745f1f/attachment.pl>

From maechler at stat.math.ethz.ch  Tue Aug 25 13:38:59 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 25 Aug 2009 13:38:59 +0200
Subject: [Rd] identical(0, -0)
In-Reply-To: <59d7961d0908220834v6ec48effx7fbc1281d8362094@mail.gmail.com>
References: <4A7FECCD.2010208@stats.uwo.ca> <4A802CB7.3030806@stats.uwo.ca>
	<4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch>
	<20090811100201.GA19381@cs.cas.cz>
	<20090812115046.GA17118@cs.cas.cz>
	<19074.52084.426535.783434@lynne.math.ethz.ch>
	<20090812162013.GA13341@cs.cas.cz>
	<19087.6412.268313.740003@deb4.math.ethz.ch>
	<20090822082236.GA11647@cs.cas.cz>
	<59d7961d0908220834v6ec48effx7fbc1281d8362094@mail.gmail.com>
Message-ID: <200908251138.n7PBcxJT010786@lynne.math.ethz.ch>

>>>>> "HenrikB" == Henrik Bengtsson <hb at stat.berkeley.edu>
>>>>>     on Sat, 22 Aug 2009 08:34:51 -0700 writes:

    HenrikB> On Sat, Aug 22, 2009 at 1:22 AM, Petr Savicky<savicky at cs.cas.cz> wrote:
    >> On Sat, Aug 22, 2009 at 12:00:44AM +0200, Martin Maechler wrote:
    >>> I have taken up the issue now,
    >>> and after thinking, studying the source, trying to define a
    >>> 'method = <string>' argument, came to the conclusion that both
    >>> the implementation and documentation (and source code "self-explanation")
    >>> are easiest to program, maintain, and understand,
    >>> if I introduce explicit binary switches,
    >>> so I now ?propose the following R-level interface which keeps
    >>> the current behavior the default:
    >>> 
    >>> >> Usage:
    >>> >>
    >>> >> ? ? ?identical(x, y, num.EQ = TRUE, one.NA = TRUE, attrib.asSet = TRUE)
    >>> >>
    >>> >> Arguments:
    >>> >>
    >>> >> ? ? x, y: any R objects.
    >>> >>
    >>> >> ? num.EQ: logical indicating if ('double' and 'complex' non-'NA')
    >>> >> ? ? ? ? ? numbers should be compared using '==', or by bitwise
    >>> >> ? ? ? ? ? comparison. ?The latter (non-default) differentiates between
    >>> >> ? ? ? ? ? '-0' and '+0'.
    >>> >>
    >>> >> ? one.NA: logical indicating if there is conceptually just one numeric
    >>> >> ? ? ? ? ? 'NA' and one 'NaN'; ?'one.NA = FALSE' differentiates bit
    >>> >> ? ? ? ? ? patterns.
    >>> >>
    >>> >> attrib.asSet: logical indicating if 'attributes' of 'x' and 'y' should
    >>> >> ? ? ? ? ? be treated as _unordered_ tagged pairlists ("sets"); this
    >>> >> ? ? ? ? ? currently also applies to 'slot's of S4 objects. ?It may well
    >>> >> ? ? ? ? ? be too strict to set 'attrib.asSet = FALSE'.

    HenrikB> My only comment is to make the argument notation a bit more consistent:

    HenrikB> (num.Eq, one.NA, attrib.as.set)

    HenrikB> or

    HenrikB> (numEq, oneNA, attribAsSet)

thank you.  I think I'd prefer the (older style) with "."
{and I had only one "." in all options},
and yes, I agree that these are a bit more consistent.

    HenrikB> Also, maybe "single" instead of "one".

yeaah.. that's possibly better...  
Other votes (on this part)?


    >> I appreciate having several binary switches. Besides the arguments above,
    >> this is also useful for an interactive use of identical(), for example,
    >> for debugging purposes. If there is a difference between objects, then
    >> the switches allow to get more information concerning what is the type
    >> of the difference.

exactly, thanks..

    >>> I'm open for better names of arguments, but will not accept "_"
    >>> in the argument names {just my taste; no reason for argueing...}.
    >> 
    >> I would slightly prefere one.NaN instead of one.NA. 

    >> In IEEE 754 terminology, R's 'NA's are a subset of
    >> 'NaN's. So. NaN is a bit more general notion, although in
    >> R, the sets of 'NA's an 'NaN's are disjoint. Moreover,
    >> the name one.NaN specifies more clearly, that the issue
    >> is important only for numeric types and not, for example,
    >> for integer.
    >> 
    >> Petr.

You are right of course  about  IEEE NaN's,
and also the fact that there *are* non-numeric NAs in R.

However, in the R world,  'NA' is much more known to users,
and much more importantly,

  > is.na(NaN)
  [1] TRUE
  > is.nan(NA)
  [1] FALSE

so in R,  (the) NaN is rather a special case of NA.
Additionally, 'NA' is considerably faster to type than 'NaN'..
Consequently, I'd rather keep that.

Thanks again, Petr and Henrik, for your feedback!
Martin


From abhibera at gmail.com  Tue Aug 25 14:41:16 2009
From: abhibera at gmail.com (Abhijit Bera)
Date: Tue, 25 Aug 2009 18:11:16 +0530
Subject: [Rd] Clarifications please.
Message-ID: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090825/b570c78e/attachment.pl>

From abhibera at gmail.com  Tue Aug 25 14:52:59 2009
From: abhibera at gmail.com (Abhijit Bera)
Date: Tue, 25 Aug 2009 18:22:59 +0530
Subject: [Rd] R command line behaving funny
Message-ID: <fc212e850908250552i40e54bbfpe8c75e8b93a28580@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090825/294c97a8/attachment.pl>

From groemping at bht-berlin.de  Tue Aug 25 17:13:59 2009
From: groemping at bht-berlin.de (Ulrike Groemping)
Date: Tue, 25 Aug 2009 08:13:59 -0700 (PDT)
Subject: [Rd]  Problem with correct usage of formula environment
Message-ID: <25136335.post@talk.nabble.com>


Dear all, 

I am working on a function formula.design that should automatically generate
reasonable lm formulae for a number of different designs. All works well as
long as all variables used are columns of the design data frame. For one
function, I would like to incorporate a dummy variable for center points
that is not a column of the design. Without this function, it would work
like this (at least version 0.97 of package FrF2):

require(FrF2)
plan <- FrF2(8,4,ncenter=6)
y <- rnorm(14)
r.plan<-add.response(plan,y)
lm(y~A+B+C+D+!iscube(r.plan), r.plan)

Building the formula from within function formula.design works OK at first
sight:
> formula(r.plan)
y ~ A + B + C + D + (!iscube(r.plan))

However, using the formula in a linear model call does not work in this
case: 
> lm(r.plan)
Fehler in inherits(x, "factor") : Objekt 'object' nicht gefunden
> traceback()
12: inherits(x, "factor")
11: is.factor(table)
10: match(x, table, nomatch = 0L)
9: "design" %in% class(design)
8: iscube(object)
7: eval(expr, envir, enclos)
6: eval(predvars, data, env)
5: model.frame.default(formula = r.plan, drop.unused.levels = TRUE)
4: model.frame(formula = r.plan, drop.unused.levels = TRUE)
3: eval(expr, envir, enclos)
2: eval(mf, parent.frame())
1: lm(r.plan)

9: of the traceback is the first line of function iscube, and it seems that
the object r.plan cannot be found here. I have no idea how to fix this. In
case it helps: The expression generating the formula in function
formula.design is

as.formula(paste(response, paste(c(names(factor.names),
paste("!iscube(",xnam,")",sep="")), collapse="+"),sep="~"))

I am grateful for any pointers that direct me to a fix for this problem
and/or to a better understanding of its root cause.

Thanks and regards,
Ulrike
-- 
View this message in context: http://www.nabble.com/Problem-with-correct-usage-of-formula-environment-tp25136335p25136335.html
Sent from the R devel mailing list archive at Nabble.com.


From lists at revelle.net  Tue Aug 25 17:59:36 2009
From: lists at revelle.net (William Revelle)
Date: Tue, 25 Aug 2009 10:59:36 -0500
Subject: [Rd] \code{\link{foo}} fails in 2.10.0
In-Reply-To: <200908251138.n7PBcxJT010786@lynne.math.ethz.ch>
References: <4A7FECCD.2010208@stats.uwo.ca>
	<4A802CB7.3030806@stats.uwo.ca>	<4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch>
	<20090811100201.GA19381@cs.cas.cz>	<20090812115046.GA17118@cs.cas.cz>
	<19074.52084.426535.783434@lynne.math.ethz.ch>
	<20090812162013.GA13341@cs.cas.cz>
	<19087.6412.268313.740003@deb4.math.ethz.ch>
	<20090822082236.GA11647@cs.cas.cz>
	<59d7961d0908220834v6ec48effx7fbc1281d8362094@mail.gmail.com>
	<200908251138.n7PBcxJT010786@lynne.math.ethz.ch>
Message-ID: <p0624080bc6b9b6dfbbed@[10.0.1.200]>

I have noticed that many cross references  in the help files using 
the   \code{\link{foo}}  command in the .Rd file fail to work in 
2.10.0. Unfortunately, it fails only some of the time.

As an example, consider the lines in the factanal help file:
Using 2.10.0

See Also
, , , ability.cov, Harman23.cor, Harman74.cor


when done in 2.9.1, this reads

See Also
print.loadings, varimax, princomp, ability.cov, Harman23.cor, Harman74.cor


I do not know if this is just a Mac issue, but it is troublesome.





For 2.10.0 (development)  I am using:

R version 2.10.0 Under development (unstable) (2009-08-25 r49420)
i386-apple-darwin9.8.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

other attached packages:
[1] psych_1.0-79


For 2.9.1 I am using

R version 2.9.1 (2009-06-26)
i386-apple-darwin8.11.1

locale:
en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

other attached packages:
[1] psych_1.0-79

Thanks to all the developers of such a great program.

Bill

-- 
William Revelle		http://personality-project.org/revelle.html
Professor			http://personality-project.org/personality.html
Department of Psychology             http://www.wcas.northwestern.edu/psych/
Northwestern University	http://www.northwestern.edu/
Use R for psychology                       http://personality-project.org/r
It is 5 minutes to midnight	http://www.thebulletin.org


From murdoch at stats.uwo.ca  Tue Aug 25 18:23:35 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 25 Aug 2009 12:23:35 -0400
Subject: [Rd] \code{\link{foo}} fails in 2.10.0
In-Reply-To: <p0624080bc6b9b6dfbbed@[10.0.1.200]>
References: <4A7FECCD.2010208@stats.uwo.ca>	<4A802CB7.3030806@stats.uwo.ca>	<4A804219.3080803@stats.uwo.ca>	<19073.9732.319993.862295@lynne.math.ethz.ch>	<20090811100201.GA19381@cs.cas.cz>	<20090812115046.GA17118@cs.cas.cz>	<19074.52084.426535.783434@lynne.math.ethz.ch>	<20090812162013.GA13341@cs.cas.cz>	<19087.6412.268313.740003@deb4.math.ethz.ch>	<20090822082236.GA11647@cs.cas.cz>	<59d7961d0908220834v6ec48effx7fbc1281d8362094@mail.gmail.com>	<200908251138.n7PBcxJT010786@lynne.math.ethz.ch>
	<p0624080bc6b9b6dfbbed@[10.0.1.200]>
Message-ID: <4A941007.1090807@stats.uwo.ca>

On 8/25/2009 11:59 AM, William Revelle wrote:
> I have noticed that many cross references  in the help files using 
> the   \code{\link{foo}}  command in the .Rd file fail to work in 
> 2.10.0. Unfortunately, it fails only some of the time.
> 
> As an example, consider the lines in the factanal help file:


> Using 2.10.0
> 
> See Also
> , , , ability.cov, Harman23.cor, Harman74.cor

Note that you may need to reinstall packages from source in R-devel, as 
the internal format of help pages has changed recently.  If that doesn't 
help, then I'd like to track it down, but factanal doesn't appear to be 
on CRAN or Bioconductor, so I can't even start to reproduce the problem.

Duncan Murdoch

> 
> when done in 2.9.1, this reads
> 
> See Also
> print.loadings, varimax, princomp, ability.cov, Harman23.cor, Harman74.cor
> 
> 
> I do not know if this is just a Mac issue, but it is troublesome.
> 
> 
> 
> 
> 
> For 2.10.0 (development)  I am using:
> 
> R version 2.10.0 Under development (unstable) (2009-08-25 r49420)
> i386-apple-darwin9.8.0
> 
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base    
> 
> other attached packages:
> [1] psych_1.0-79
> 
> 
> For 2.9.1 I am using
> 
> R version 2.9.1 (2009-06-26)
> i386-apple-darwin8.11.1
> 
> locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base    
> 
> other attached packages:
> [1] psych_1.0-79
> 
> Thanks to all the developers of such a great program.
> 
> Bill
>


From ligges at statistik.tu-dortmund.de  Tue Aug 25 18:26:27 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 25 Aug 2009 18:26:27 +0200
Subject: [Rd] problem with plot.lm?
In-Reply-To: <B9FAFC26-C444-445A-8EC6-9AC81F1E5989@jhsph.edu>
References: <B9FAFC26-C444-445A-8EC6-9AC81F1E5989@jhsph.edu>
Message-ID: <4A9410B3.10703@statistik.tu-dortmund.de>

Hi,

yes, this looks like a bug. Will investiagte.

Best wishes,
Uwe Ligges





Benilton Carvalho wrote:
> I'm bringing this issue to r-devel as my idea of sending it to r-help 
> appears to be wrong.
> 
> The following is reproducible in R-patched and R-devel (also in older 
> versions).
> 
> An outlier is inserted in group E and the last plot by plot.lm suggests 
> that the point belongs to D.
> 
> It appears to me that:
> 
> * (facval, rsp) and
> * x$xlevels[[1L]][order(sapply(split(yh,mf[,1]), mean))]
> 
> are sorted differently.
> 
> set.seed(2)
> a <- rnorm(50,0,2)
> x <- rep(seq(10, 50, by=10), each=10)
> y <- x+a
> f <- rep(c("e","a","c","b","d"), rep(10,5))
> f <- as.factor(f)
> y[1] <- 200
> mod1 <- aov(y ~ f)
> par(mfrow=c(2,2))
> plot(mod1)
> 
> 
> My latest attempt was on:
> 
>  > sessionInfo()
> R version 2.10.0 Under development (unstable) (2009-08-20 r49335)
> x86_64-unknown-linux-gnu
> 
> locale:
>  [1] LC_CTYPE=en_US.iso885915       LC_NUMERIC=C
>  [3] LC_TIME=en_US.iso885915        LC_COLLATE=en_US.iso885915
>  [5] LC_MONETARY=C                  LC_MESSAGES=en_US.iso885915
>  [7] LC_PAPER=en_US.iso885915       LC_NAME=C
>  [9] LC_ADDRESS=C                   LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.iso885915 LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>  >
> 
> 
> 
> thank you,
> b
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pleydell at supagro.inra.fr  Tue Aug 25 18:31:31 2009
From: pleydell at supagro.inra.fr (pleydell at supagro.inra.fr)
Date: Tue, 25 Aug 2009 18:31:31 +0200
Subject: [Rd] Cannot make 3 different R installations for 3
	different	valgrind-instrumentation levels
Message-ID: <20090825183131.19kjcomatupco0wg@web.supagro.inra.fr>

"R Installation and Administration", section 2.5 "Sub-architectures" describes
calling specific builds of R using the call "R --arch=name". I am trying to
build and install three versions of R-2.9.1, each configured with a different
valgrind-instrumentation level ("Writing R Extensions", section 4.3.2 "Using
valgrind"). My goal is to be able to choose which install I launch so that I
can
choose among the valgrind levels with commands such as

R --arch=valgrind0 -d valgrind --vanilla < myPkg.R
or
R --arch=valgrind1 -d valgrind --vanilla < myPkg.R
or
R --arch=valgrind2 -d valgrind --vanilla < myPkg.R

R-2.9.1.tar.gz is unzipped to /usr/local/src/R-2.9.1 and I have tried executing
(several variations of) the following code from that directory

sudo ./configure --enable-memory-profiling --with-valgrind-instrumentation=2
r_arch=vg2 --with-recommended-packages=no
sudo make
sudo make install rhome=/usr/local/lib/R-2.9.1_vg2
sudo ./configure --enable-memory-profiling --with-valgrind-instrumentation=1
r_arch=vg1 --with-recommended-packages=no
sudo make
sudo make install rhome=/usr/local/lib/R-2.9.1_vg1
sudo ./configure --enable-memory-profiling --with-valgrind-instrumentation=0
r_arch=vg0 --with-recommended-packages=no
sudo make
sudo make install rhome=/usr/local/lib/R-2.9.1_vg0

using this approach the second "sudo make" results in error.

I also tried installing from three seperate copies of the R-2.9.1 directory i.e.
from

/usr/local/src/R-2.9.1_valgrind0
/usr/local/src/R-2.9.1_valgrind1
/usr/local/src/R-2.9.1_valgrind2

with this set up the above code runs without error and the shell command "R
--arch=valgrind0" works (level zero being the level used in the most recent
install) but the shell commands "R --arch=valgrind1" and "R --arch=valgrind2"
result in error messages.

I can't figure out how to get this working, although it seems perfectly natural
to want to do this. It would be great if someone could point me in the right
direction and perhaps a workable example could be added to the "R Installation
and Administration" document too.

I am running a recent install of Ubuntu (Jaunty) on a 32 bit laptop with all
previous R installations removed / uninstalled.

thanks
David


From murdoch at stats.uwo.ca  Tue Aug 25 18:44:05 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 25 Aug 2009 12:44:05 -0400
Subject: [Rd] \code{\link{foo}} fails in 2.10.0
In-Reply-To: <p0624080bc6b9b6dfbbed@[10.0.1.200]>
References: <4A7FECCD.2010208@stats.uwo.ca>	<4A802CB7.3030806@stats.uwo.ca>	<4A804219.3080803@stats.uwo.ca>	<19073.9732.319993.862295@lynne.math.ethz.ch>	<20090811100201.GA19381@cs.cas.cz>	<20090812115046.GA17118@cs.cas.cz>	<19074.52084.426535.783434@lynne.math.ethz.ch>	<20090812162013.GA13341@cs.cas.cz>	<19087.6412.268313.740003@deb4.math.ethz.ch>	<20090822082236.GA11647@cs.cas.cz>	<59d7961d0908220834v6ec48effx7fbc1281d8362094@mail.gmail.com>	<200908251138.n7PBcxJT010786@lynne.math.ethz.ch>
	<p0624080bc6b9b6dfbbed@[10.0.1.200]>
Message-ID: <4A9414D5.6060807@stats.uwo.ca>

On 8/25/2009 11:59 AM, William Revelle wrote:
> I have noticed that many cross references  in the help files using 
> the   \code{\link{foo}}  command in the .Rd file fail to work in 
> 2.10.0. Unfortunately, it fails only some of the time.
> 
> As an example, consider the lines in the factanal help file:
> Using 2.10.0

Sorry, please ignore the "can't find factanal" part of my previous 
message, you're talking about the factanal man page in stats (as Michael 
Dewey pointed out to me).

But the advice still stands:  you may need to rebuild from source to get 
all the help working.  If you're working with a binary build, try again 
with a newer one when it is available.  r49420 isn't very old, but it 
might be old enough so that something like this has been fixed.

Duncan Murdoch

> 
> See Also
> , , , ability.cov, Harman23.cor, Harman74.cor
> 
> 
> when done in 2.9.1, this reads
> 
> See Also
> print.loadings, varimax, princomp, ability.cov, Harman23.cor, Harman74.cor
> 
> 
> I do not know if this is just a Mac issue, but it is troublesome.
> 
> 
> 
> 
> 
> For 2.10.0 (development)  I am using:
> 
> R version 2.10.0 Under development (unstable) (2009-08-25 r49420)
> i386-apple-darwin9.8.0
> 
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base    
> 
> other attached packages:
> [1] psych_1.0-79
> 
> 
> For 2.9.1 I am using
> 
> R version 2.9.1 (2009-06-26)
> i386-apple-darwin8.11.1
> 
> locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base    
> 
> other attached packages:
> [1] psych_1.0-79
> 
> Thanks to all the developers of such a great program.
> 
> Bill
>


From christos.hatzis at nuverabio.com  Tue Aug 25 19:54:06 2009
From: christos.hatzis at nuverabio.com (Christos Hatzis)
Date: Tue, 25 Aug 2009 13:54:06 -0400
Subject: [Rd] package dependencies specification
Message-ID: <EC5E05CAC02145E7BEE087E2A3629A28@headquarters.silicoinsights>

 
Hello,

After running R CMD check on my package I received the following error on
package dependencies:

* using log directory 'C:/z-zBackup/Nuvera Bio on
Iatros01/Development/RPackages/nvNormalize/nvNormalize.Rcheck'
* using R version 2.9.1 (2009-06-26)
* using session charset: ISO8859-1
* checking for file 'nvNormalize/DESCRIPTION' ... OK
* checking extension type ... Package
* this is package 'nvNormalize' version '1.0'
* checking package name space information ... OK
* checking package dependencies ... ERROR
Namespace dependencies not required:
  affy affyio hgu133acdf hgu133plus2cdf simpleaffy

See the information on DESCRIPTION files in the chapter 'Creating R
packages' of the 'Writing R Extensions' manual.

I've looked at the manual but cannot figure out if the problem is in the way
I have specified dependencies in NAMESPACE or DESCRIPTION.  It appears that
dependecies need to be specified in both. 
These two files are shown below.

------------------------------
NAMESPACE

export(nv.batch.normalize, norm.options, combine.norm.esets,
subset.norm.eset, update.sampleNames)

import(affy, simpleaffy, hgu133acdf, hgu133plus2cdf) 
importFrom(affyio, read.celfile, read.celfile.header) 
 
DESCRIPTION
...
Depends: R (>= 2.5.0), Biobase
Imports: affy, affyio, simpleaffy, hgu133acdf, hgu133plus2cdf
--------------------------------

I'd appreciate any help.
Thank you.

-Christos

Christos Hatzis, Ph.D.
Nuvera Biosciences, Inc.


From lists at revelle.net  Tue Aug 25 20:37:53 2009
From: lists at revelle.net (William Revelle)
Date: Tue, 25 Aug 2009 13:37:53 -0500
Subject: [Rd] \code{\link{foo}} fails in 2.10.0
In-Reply-To: <4A9414D5.6060807@stats.uwo.ca>
References: <4A7FECCD.2010208@stats.uwo.ca>
	<4A802CB7.3030806@stats.uwo.ca>	<4A804219.3080803@stats.uwo.ca>
	<19073.9732.319993.862295@lynne.math.ethz.ch>
	<20090811100201.GA19381@cs.cas.cz>	<20090812115046.GA17118@cs.cas.cz>
	<19074.52084.426535.783434@lynne.math.ethz.ch>
	<20090812162013.GA13341@cs.cas.cz>
	<19087.6412.268313.740003@deb4.math.ethz.ch>
	<20090822082236.GA11647@cs.cas.cz>
	<59d7961d0908220834v6ec48effx7fbc1281d8362094@mail.gmail.com>
	<200908251138.n7PBcxJT010786@lynne.math.ethz.ch>
	<p0624080bc6b9b6dfbbed@[10.0.1.200]> <4A9414D5.6060807@stats.uwo.ca>
Message-ID: <p06240810c6b9dabb237b@[10.0.1.200]>

Duncan,
   Actually, I had this problem building a package of mine (psych) 
from source.  It also happens with one of the core installations 
(methods in the util package) which I downloaded from the development 
site for the Mac.

Using 2.9.1
See Also
S3Methods, class, getS3method.
For S4, showMethods, Methods.

but using
2.10.0
See Also
S3Methods, class, .
For S4, showMethods, Methods.


(note that the getS3method is missing following the comma).

I first noticed this problem when I installed 2.10.0 using the  08-19 
build.  I am sorry, but I do not have that version number.)
I can use the 05-22 build  and it is not a problem.

I also note that when compiling from source, in the 5-22 build, the 
help files are built for  text, html, latex, and examples
  00.psych-package                  text    html    latex   example
   Harman                            text    html    latex   example
   ICC                               text    html    latex   example
...

but, when using the most recent build I get
*** installing help indices
   converting help for package 'psych'
     finding HTML links ... done
     00.psych-package                        html
     Harman                                  html


My sessionInfo() is
R version 2.10.0 Under development (unstable) (2009-08-25 r49420)
i386-apple-darwin9.8.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

other attached packages:
[1] psych_1.0-79


Bill




At 12:44 PM -0400 8/25/09, Duncan Murdoch wrote:
>On 8/25/2009 11:59 AM, William Revelle wrote:
>>I have noticed that many cross references  in the help files using 
>>the   \code{\link{foo}}  command in the .Rd file fail to work in 
>>2.10.0. Unfortunately, it fails only some of the time.
>>
>>As an example, consider the lines in the factanal help file:
>>Using 2.10.0
>
>Sorry, please ignore the "can't find factanal" part of my previous 
>message, you're talking about the factanal man page in stats (as 
>Michael Dewey pointed out to me).
>
>But the advice still stands:  you may need to rebuild from source to 
>get all the help working.  If you're working with a binary build, 
>try again with a newer one when it is available.  r49420 isn't very 
>old, but it might be old enough so that something like this has been 
>fixed.
>
>Duncan Murdoch
>
>>
>>See Also
>>, , , ability.cov, Harman23.cor, Harman74.cor
>>
>>
>>when done in 2.9.1, this reads
>>
>>See Also
>>print.loadings, varimax, princomp, ability.cov, Harman23.cor, Harman74.cor
>>
>>
>>I do not know if this is just a Mac issue, but it is troublesome.
>>
>>
>>
>>
>>
>>For 2.10.0 (development)  I am using:
>>
>>R version 2.10.0 Under development (unstable) (2009-08-25 r49420)
>>i386-apple-darwin9.8.0
>>
>>locale:
>>[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>
>>attached base packages:
>>[1] stats     graphics  grDevices utils     datasets  methods   base   
>>
>>other attached packages:
>>[1] psych_1.0-79
>>
>>
>>For 2.9.1 I am using
>>
>>R version 2.9.1 (2009-06-26)
>>i386-apple-darwin8.11.1
>>
>>locale:
>>en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>
>>attached base packages:
>>[1] stats     graphics  grDevices utils     datasets  methods   base   
>>
>>other attached packages:
>>[1] psych_1.0-79
>>
>>Thanks to all the developers of such a great program.
>>
>>Bill


-- 
William Revelle		http://personality-project.org/revelle.html
Professor			http://personality-project.org/personality.html
Department of Psychology             http://www.wcas.northwestern.edu/psych/
Northwestern University	http://www.northwestern.edu/
Use R for psychology                       http://personality-project.org/r
It is 5 minutes to midnight	http://www.thebulletin.org


From r.hijmans at gmail.com  Tue Aug 25 21:45:58 2009
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 25 Aug 2009 12:45:58 -0700
Subject: [Rd] R CMD on windows 7
Message-ID: <dc22b2570908251245h1c57d31ey14abcd4e7323456e@mail.gmail.com>

I had difficulties running R CMD check and build on windows 7.

The problem seems to be that the script creates folders to which
nobody has any access permissions (not even read). So the script can
not delete these folders or open files.

This worked for me:

Go to the properties of the root folder of your R project (e.g. "D:\R").
Change the settings so that this folder and its sub-folders do not
inherit permissions.
I wanted to next remove the "system" user (but that happened by
itself); and I added myself as a user (not sure if necessary, but
that's what I did).
You probably need admin privileges to do this.


> sessionInfo()
R version 2.9.1 (2009-06-26)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
>


From simon.urbanek at r-project.org  Wed Aug 26 03:20:31 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 25 Aug 2009 21:20:31 -0400
Subject: [Rd] Cannot make 3 different R installations for 3
	different	valgrind-instrumentation levels
In-Reply-To: <20090825183131.19kjcomatupco0wg@web.supagro.inra.fr>
References: <20090825183131.19kjcomatupco0wg@web.supagro.inra.fr>
Message-ID: <D30ADD33-3339-409D-B2E2-9090B4E14CD8@r-project.org>


On Aug 25, 2009, at 12:31 PM, pleydell at supagro.inra.fr wrote:

> "R Installation and Administration", section 2.5 "Sub-architectures"  
> describes
> calling specific builds of R using the call "R --arch=name". I am  
> trying to
> build and install three versions of R-2.9.1, each configured with a  
> different
> valgrind-instrumentation level ("Writing R Extensions", section  
> 4.3.2 "Using
> valgrind"). My goal is to be able to choose which install I launch  
> so that I
> can
> choose among the valgrind levels with commands such as
>
> R --arch=valgrind0 -d valgrind --vanilla < myPkg.R
> or
> R --arch=valgrind1 -d valgrind --vanilla < myPkg.R
> or
> R --arch=valgrind2 -d valgrind --vanilla < myPkg.R
>
> R-2.9.1.tar.gz is unzipped to /usr/local/src/R-2.9.1 and I have  
> tried executing
> (several variations of) the following code from that directory
>
> sudo ./configure --enable-memory-profiling --with-valgrind- 
> instrumentation=2
> r_arch=vg2 --with-recommended-packages=no
> sudo make
> sudo make install rhome=/usr/local/lib/R-2.9.1_vg2
> sudo ./configure --enable-memory-profiling --with-valgrind- 
> instrumentation=1
> r_arch=vg1 --with-recommended-packages=no
> sudo make
> sudo make install rhome=/usr/local/lib/R-2.9.1_vg1
> sudo ./configure --enable-memory-profiling --with-valgrind- 
> instrumentation=0
> r_arch=vg0 --with-recommended-packages=no
> sudo make
> sudo make install rhome=/usr/local/lib/R-2.9.1_vg0
>
> using this approach the second "sudo make" results in error.
>

You're confusing rhome and arch - the above makes no sense. Let rhome  
alone and you should be fine. (And make sure you're not building in  
the source tree - you should be using something like mkdir obj_vg0 &&  
cd obj_vg0 && ../R-2.9.1/configure ...)

Cheers,
Simon


> I also tried installing from three seperate copies of the R-2.9.1  
> directory i.e.
> from
>
> /usr/local/src/R-2.9.1_valgrind0
> /usr/local/src/R-2.9.1_valgrind1
> /usr/local/src/R-2.9.1_valgrind2
>
> with this set up the above code runs without error and the shell  
> command "R
> --arch=valgrind0" works (level zero being the level used in the most  
> recent
> install) but the shell commands "R --arch=valgrind1" and "R -- 
> arch=valgrind2"
> result in error messages.
>
> I can't figure out how to get this working, although it seems  
> perfectly natural
> to want to do this. It would be great if someone could point me in  
> the right
> direction and perhaps a workable example could be added to the "R  
> Installation
> and Administration" document too.
>
> I am running a recent install of Ubuntu (Jaunty) on a 32 bit laptop  
> with all
> previous R installations removed / uninstalled.
>
> thanks
> David
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From mtmorgan at fhcrc.org  Wed Aug 26 04:15:48 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 25 Aug 2009 19:15:48 -0700
Subject: [Rd] package dependencies specification
In-Reply-To: <EC5E05CAC02145E7BEE087E2A3629A28@headquarters.silicoinsights>
References: <EC5E05CAC02145E7BEE087E2A3629A28@headquarters.silicoinsights>
Message-ID: <4A949AD4.5000805@fhcrc.org>

Hi Christos --

Christos Hatzis wrote:
>  
> Hello,
> 
> After running R CMD check on my package I received the following error on
> package dependencies:
> 
> * using log directory 'C:/z-zBackup/Nuvera Bio on
> Iatros01/Development/RPackages/nvNormalize/nvNormalize.Rcheck'
> * using R version 2.9.1 (2009-06-26)
> * using session charset: ISO8859-1
> * checking for file 'nvNormalize/DESCRIPTION' ... OK
> * checking extension type ... Package
> * this is package 'nvNormalize' version '1.0'
> * checking package name space information ... OK
> * checking package dependencies ... ERROR
> Namespace dependencies not required:
>   affy affyio hgu133acdf hgu133plus2cdf simpleaffy

this confusingly worded message is saying that these packages are
import'ed by NAMESPACE, but not listed in Imports: or Depends: in
DESCRIPTION, but...

> 
> See the information on DESCRIPTION files in the chapter 'Creating R
> packages' of the 'Writing R Extensions' manual.
> 
> I've looked at the manual but cannot figure out if the problem is in the way
> I have specified dependencies in NAMESPACE or DESCRIPTION.  It appears that
> dependecies need to be specified in both. 
> These two files are shown below.
> 
> ------------------------------
> NAMESPACE
> 
> export(nv.batch.normalize, norm.options, combine.norm.esets,
> subset.norm.eset, update.sampleNames)
> 
> import(affy, simpleaffy, hgu133acdf, hgu133plus2cdf) 
> importFrom(affyio, read.celfile, read.celfile.header) 
>  
> DESCRIPTION
> ...
> Depends: R (>= 2.5.0), Biobase
> Imports: affy, affyio, simpleaffy, hgu133acdf, hgu133plus2cdf

I don't see anything wrong with what you list here. Perhaps the file is
malformed, or contains non-ASCII characters (tools::showNonASCII might
help) or is otherwise not processed properly (base::read.dcf)? In
addition I am not sure of the consequences of using charset ISO8859-1.

Martin

> --------------------------------
> 
> I'd appreciate any help.
> Thank you.
> 
> -Christos
> 
> Christos Hatzis, Ph.D.
> Nuvera Biosciences, Inc.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From christos.hatzis at nuverabio.com  Wed Aug 26 05:30:48 2009
From: christos.hatzis at nuverabio.com (Christos Hatzis)
Date: Tue, 25 Aug 2009 23:30:48 -0400
Subject: [Rd] package dependencies specification
In-Reply-To: <4A949AD4.5000805@fhcrc.org>
References: <EC5E05CAC02145E7BEE087E2A3629A28@headquarters.silicoinsights>
	<4A949AD4.5000805@fhcrc.org>
Message-ID: <14704F1369354135A07D5CAF88DBF1F7@headquarters.silicoinsights>

Hi Martin,

Thanks for taking a look and for the explanation of the error message.  
The problem seems to have been the space in R (>= 2.5.0) in the Depends
statement.  Removing that space resolved the error.  The parser seems to be
quite unforgiving.

Then I got the error that packages hgu133acdf, hgu133plus2cdf cannot be
imported because they do not have a namespace.  Moving those to the Depdends
statement seems to have resolved the package dependencies issues.

Thanks again.
-Christos   

> -----Original Message-----
> From: Martin Morgan [mailto:mtmorgan at fhcrc.org] 
> Sent: Tuesday, August 25, 2009 10:16 PM
> To: christos.hatzis at nuverabio.com
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] package dependencies specification
> 
> Hi Christos --
> 
> Christos Hatzis wrote:
> >  
> > Hello,
> > 
> > After running R CMD check on my package I received the 
> following error 
> > on package dependencies:
> > 
> > * using log directory 'C:/z-zBackup/Nuvera Bio on 
> > Iatros01/Development/RPackages/nvNormalize/nvNormalize.Rcheck'
> > * using R version 2.9.1 (2009-06-26)
> > * using session charset: ISO8859-1
> > * checking for file 'nvNormalize/DESCRIPTION' ... OK
> > * checking extension type ... Package
> > * this is package 'nvNormalize' version '1.0'
> > * checking package name space information ... OK
> > * checking package dependencies ... ERROR Namespace 
> dependencies not 
> > required:
> >   affy affyio hgu133acdf hgu133plus2cdf simpleaffy
> 
> this confusingly worded message is saying that these packages 
> are import'ed by NAMESPACE, but not listed in Imports: or 
> Depends: in DESCRIPTION, but...
> 
> > 
> > See the information on DESCRIPTION files in the chapter 'Creating R 
> > packages' of the 'Writing R Extensions' manual.
> > 
> > I've looked at the manual but cannot figure out if the 
> problem is in 
> > the way I have specified dependencies in NAMESPACE or 
> DESCRIPTION.  It 
> > appears that dependecies need to be specified in both.
> > These two files are shown below.
> > 
> > ------------------------------
> > NAMESPACE
> > 
> > export(nv.batch.normalize, norm.options, combine.norm.esets, 
> > subset.norm.eset, update.sampleNames)
> > 
> > import(affy, simpleaffy, hgu133acdf, hgu133plus2cdf) 
> > importFrom(affyio, read.celfile, read.celfile.header)
> >  
> > DESCRIPTION
> > ...
> > Depends: R (>= 2.5.0), Biobase
> > Imports: affy, affyio, simpleaffy, hgu133acdf, hgu133plus2cdf
> 
> I don't see anything wrong with what you list here. Perhaps 
> the file is malformed, or contains non-ASCII characters 
> (tools::showNonASCII might
> help) or is otherwise not processed properly 
> (base::read.dcf)? In addition I am not sure of the 
> consequences of using charset ISO8859-1.
> 
> Martin
> 
> > --------------------------------
> > 
> > I'd appreciate any help.
> > Thank you.
> > 
> > -Christos
> > 
> > Christos Hatzis, Ph.D.
> > Nuvera Biosciences, Inc.
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
>


From ripley at stats.ox.ac.uk  Wed Aug 26 07:00:07 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Aug 2009 06:00:07 +0100 (BST)
Subject: [Rd] package dependencies specification
In-Reply-To: <4A949AD4.5000805@fhcrc.org>
References: <EC5E05CAC02145E7BEE087E2A3629A28@headquarters.silicoinsights>
	<4A949AD4.5000805@fhcrc.org>
Message-ID: <alpine.OSX.1.00.0908260554550.48882@tystie.local>

On Tue, 25 Aug 2009, Martin Morgan wrote:

[...]

> In addition I am not sure of the consequences of using charset 
> ISO8859-1.

It is not portable: the manual says only 'latin1', 'latin2' and 
'UTF-8' are known to be.

Versions of iconv think the name is ISO8859-1 or ISO-8859-1 or 
ISO_8859-1 or 8859-1: there is no variant that all those in use (at 
least 3, possibly two more -- see ?iconv in R-devel) accept apart for 
latin1.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From chalabi at phys.ethz.ch  Wed Aug 26 07:53:44 2009
From: chalabi at phys.ethz.ch (Yohan Chalabi)
Date: Wed, 26 Aug 2009 07:53:44 +0200
Subject: [Rd] R command line behaving funny
In-Reply-To: <fc212e850908250552i40e54bbfpe8c75e8b93a28580@mail.gmail.com>
References: <fc212e850908250552i40e54bbfpe8c75e8b93a28580@mail.gmail.com>
Message-ID: <20090826075344.381c62a7@mimi>

>>>> "AB" == Abhijit Bera <abhibera at gmail.com>
>>>> on Tue, 25 Aug 2009 18:22:59 +0530

   AB> Hi
   AB>
   AB> I am unable to try out examples from the Rmetrics Ebook from
   AB> the R command
   AB> prompt. Below is an example of what happens:
   AB>
   AB> > Covariance<-cov(SWX.RET)
   AB> Error in cov.timeSeries(SWX.RET) :
   AB> no slot of name Data for this object of class timeSeries
   AB>
   AB> I have loaded Rmetrics and fPortfolio using the library function
   AB> but still I
   AB> get these errors.


Hi Abhijit,

It looks like you are using an old version of timeSeries. Please update
your packages as described in the preface of the ebook.

Please note that R devel mailing list is not the right list to post
questions regarding the ebook. You should rather send them to
ebooks_at_rmetrics.org .


Regards,
Yohan

-- 
PhD student
Swiss Federal Institute of Technology
Zurich

www.ethz.ch


From sumantamukherjee at hotmail.com  Mon Aug 24 22:25:35 2009
From: sumantamukherjee at hotmail.com (bappai)
Date: Mon, 24 Aug 2009 13:25:35 -0700 (PDT)
Subject: [Rd]  Tk question
Message-ID: <25123066.post@talk.nabble.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090824/9af31bc1/attachment.pl>

From lisazang at caltech.edu  Tue Aug 25 22:10:15 2009
From: lisazang at caltech.edu (lisazang at caltech.edu)
Date: Tue, 25 Aug 2009 22:10:15 +0200 (CEST)
Subject: [Rd] Problems opening R (PR#13908)
Message-ID: <20090825201015.A1F9C282EFC8@mail.pubhealth.ku.dk>

Hi,

I'm having problems opening R on MAC OSX. It was working fine, then I  
tried using the fix() command on one of my data sources. R froze, so I  
re-started it. R would not open, the icon kept bouncing in the dock. I  
have tried reinstalling the program, but every time the installer says  
it is "updating" instead of installing - I'm not sure how to  
completely erase R from the system. What should I do?

Thanks,
Lisa


From ligges at statistik.tu-dortmund.de  Wed Aug 26 10:12:28 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 26 Aug 2009 10:12:28 +0200
Subject: [Rd] R CMD on windows 7
In-Reply-To: <dc22b2570908251245h1c57d31ey14abcd4e7323456e@mail.gmail.com>
References: <dc22b2570908251245h1c57d31ey14abcd4e7323456e@mail.gmail.com>
Message-ID: <4A94EE6C.20109@statistik.tu-dortmund.de>

As far as I know, nobody of the developers who also work under Windows 
has access to Windows 7 these days. Patches are welcome, of course!

Best wishes,
Uwe Ligges



Robert J. Hijmans wrote:
> I had difficulties running R CMD check and build on windows 7.
> 
> The problem seems to be that the script creates folders to which
> nobody has any access permissions (not even read). So the script can
> not delete these folders or open files.
> 
> This worked for me:
> 
> Go to the properties of the root folder of your R project (e.g. "D:\R").
> Change the settings so that this folder and its sub-folders do not
> inherit permissions.
> I wanted to next remove the "system" user (but that happened by
> itself); and I added myself as a user (not sure if necessary, but
> that's what I did).
> You probably need admin privileges to do this.
> 
> 
>> sessionInfo()
> R version 2.9.1 (2009-06-26)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Wed Aug 26 10:21:37 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 26 Aug 2009 10:21:37 +0200
Subject: [Rd] improving ?RweaveLatex
In-Reply-To: <6D6B7156-C847-4039-8D33-FAEFEA49AF5A@me.com>
References: <68b1e2610908221245i4235549cw908c32e5efbdde95@mail.gmail.com>
	<1A9D0140-202D-40CE-BEC3-58765CB16D46@me.com>
	<526F10DE-7048-4AA1-A76D-7D863176DB1F@me.com>
	<6D6B7156-C847-4039-8D33-FAEFEA49AF5A@me.com>
Message-ID: <19092.61585.672018.417345@lynne.math.ethz.ch>

>>>>> Marc Schwartz <marc_schwartz at me.com>
>>>>>     on Sat, 22 Aug 2009 16:51:31 -0500 writes:

    > <snip>
    > On Aug 22, 2009, at 4:30 PM, Marc Schwartz wrote:
    >> 
    >> I have some proposed modifications to RweaveLatex.Rd which I include  
    >> here as a patch against the R-devel version of the file from svn. I  
    >> have added comments about the issue that Liviu raised, the use of  
    >> the [nogin] option and while I was at it, the [noae] option as well.  
    >> There are added to the 'details' section of the file.

    > OK, once more....

    > I noted a typo and also neglected to add pointers to the Details  
    > section in the descriptions of the height and width options.

    > Here is a corrected version of the patch file.

Thank you very much, Marc.

I was going to commit a version of this
(using \samp{..} in a few places where you had \code{..}:
 Note that \code{..} is meant to be for  R - code only),

but then I started reading more carefully what you've proposed,
and I think it needs to be clarified even further
(see inline below):


    > --- RweaveLatexOld.Rd	2009-08-22 15:45:29.000000000 -0500
    > +++ RweaveLatex.Rd	2009-08-22 16:49:00.000000000 -0500
    > @@ -49,6 +49,30 @@
    > \env{SWEAVE_STYLEPATH_DEFAULT}, or is \code{FALSE} it that is unset or
    > empty.  If set, it should be exactly \code{TRUE} or \code{FALSE}: any
    > other values are taken as \code{FALSE}.
    > +
    > +  By default, \file{Sweave.sty} sets the width of all included graphics to:
    > +
    > +  \code{\\setkeys{Gin}{width=0.8\\textwidth}}
    > +
    > +  You can adjust this by including the above in your .Rnw file after the
    > +  \code{\\begin{document}} directive and adjust the \code{width}
    > +  parameter above accordingly. Note that this parameter determines the actual
    > +  graphic dimensions in your final document and therefore overrides the
    > +  \code{height} and \code{width} options that you may use in each
    > +  figure chunk or have set globally. The \code{height} and \code{width}
    > +  options will determine the dimensions of the runtime generated
    > +  PDF and EPS files created in this setting.

I  think the above is not entirely correct (or then, still
enough confusing to confuse me ;-) :

The 'Gin' setting is about how  LaTeX's \includegraphics{}
works and how that *scales* the  PDF and EPS files.
And as you say above, the  'height' and 'width' determine how
the PDF and EPS files are generated.

Consequently, I would not say that the 'Gin' ``overrides''  the 
(width, height) settings of the graphic file, but rather 
influences how these  (width, height) ranges are further
transformed into the final document.   But e.g. font and plot
symbol sizes are *scaled* dependent on both the (width/height)
and the 'Gin' setting.

In short,  Gin, width, height, are three related but different
"knobs" you can turn.

Marc, I'll send you my version of your improved Rweavelatex.Rd,
so if you want you can make it even better..

    > +  If you wish to override this default behavior, you can use
    > +  \code{\\usepackage[nogin]{Sweave}} in your preamble. In this case, the
    > +  \code{height} and \code{width} options will determine the runtime
    > +  generated graphic file sizes and the size of the graphics in your
    > +  final document.

I'd also change the above: Along the following point:

 In *any* case,  (height,width) determines the dimension of the
 graphic file.
 In the case of 'nogin', the graphic files are not scaled *any
 further* for latex inclusion.


Thanks a lot, to Marc, once again!
Martin

    > +  \file{Sweave.sty} also supports the \code{[noae]} option, which
    > +  suppresses the use of the \code{ae} package, the use of which may
    > +  interfere with certain encoding and typeface selections. If you have
    > +  problems in the rendering of certain character sets, try this option.  
    > }
    > \section{Supported Options}{
    > \code{RweaveLatex} supports the following options for code chunks (the values
    > @@ -101,8 +125,8 @@
    > generated. Ignored if \code{fig = FALSE}.}
    > \item{pdf.version, pdf.encoding:}{passed to \code{\link{pdf}} to set
    > the version and encoding.  Defaults taken from \code{pdf.options()}.}
    > -    \item{width:}{numeric (6), width of figures in inches.}
    > -    \item{height:}{numeric (6), height of figures in inches.}
    > +    \item{width:}{numeric (6), width of figures in inches. See \sQuote{Details}.}
    > +    \item{height:}{numeric (6), height of figures in inches. See \sQuote{Details}.}
    > \item{expand:}{logical (\code{TRUE}).  Expand references to other chunks
    > so that only R code appears in the output file.  If \code{FALSE}, the
    > chunk reference (e.g. \code{<<chunkname>>}) will appear.  The


From ripley at stats.ox.ac.uk  Wed Aug 26 11:01:45 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Aug 2009 10:01:45 +0100 (BST)
Subject: [Rd] R CMD on windows 7
In-Reply-To: <4A94EE6C.20109@statistik.tu-dortmund.de>
References: <dc22b2570908251245h1c57d31ey14abcd4e7323456e@mail.gmail.com>
	<4A94EE6C.20109@statistik.tu-dortmund.de>
Message-ID: <alpine.LFD.2.00.0908260957510.32062@gannet.stats.ox.ac.uk>

On Wed, 26 Aug 2009, Uwe Ligges wrote:

> As far as I know, nobody of the developers who also work under Windows has 
> access to Windows 7 these days. Patches are welcome, of course!

But the described behaviour seems identical to Vista, and the 
workarounds the same as those in the rw-FAQ.

I've not seen any report elsewhere of a change in permissions 
behaviour in Windows 7, and before we consider any changes we would 
need references to Microsoft documentation of such a change.

>
> Best wishes,
> Uwe Ligges
>
>
>
> Robert J. Hijmans wrote:
>> I had difficulties running R CMD check and build on windows 7.
>> 
>> The problem seems to be that the script creates folders to which
>> nobody has any access permissions (not even read). So the script can
>> not delete these folders or open files.
>> 
>> This worked for me:
>> 
>> Go to the properties of the root folder of your R project (e.g. "D:\R").
>> Change the settings so that this folder and its sub-folders do not
>> inherit permissions.
>> I wanted to next remove the "system" user (but that happened by
>> itself); and I added myself as a user (not sure if necessary, but
>> that's what I did).
>> You probably need admin privileges to do this.
>> 
>> 
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26)
>> i386-pc-mingw32
>> 
>> locale:
>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>> States.1252;LC_MONETARY=English_United
>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Aug 26 11:07:46 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Aug 2009 10:07:46 +0100 (BST)
Subject: [Rd] Problems opening R (PR#13908)
In-Reply-To: <20090825201015.A1F9C282EFC8@mail.pubhealth.ku.dk>
References: <20090825201015.A1F9C282EFC8@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0908261002180.32062@gannet.stats.ox.ac.uk>

Please use R-sig-mac to ask questions about Mac OS X.

In particular do not use R-bugs to ask questions.  There may be a bug 
here, but there is nothing to reproduce and it may not be in R (it may 
be in R.app, the GUI).

How about uninstalling R (not re-installing)?  See the R-MacOS FAQ, 
e.g.
http://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#How-can-R-for-Mac-OS-X-be-uninstalled_003f

You might also want to remove any startup files (.RData in particular) 
or your preferences (in case they got trashed).

On Tue, 25 Aug 2009, lisazang at caltech.edu wrote:

> Hi,
>
> I'm having problems opening R on MAC OSX. It was working fine, then I
> tried using the fix() command on one of my data sources. R froze, so I
> re-started it. R would not open, the icon kept bouncing in the dock. I
> have tried reinstalling the program, but every time the installer says
> it is "updating" instead of installing - I'm not sure how to
> completely erase R from the system. What should I do?

Read the FAQ ....

> Thanks,
> Lisa
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sloiseau at limsi.fr  Wed Aug 26 09:37:34 2009
From: sloiseau at limsi.fr (sloiseau at limsi.fr)
Date: Wed, 26 Aug 2009 09:37:34 +0200 (CEST)
Subject: [Rd] Problem with standard generic methods in Matrix package
Message-ID: <37353.193.51.130.16.1251272254.squirrel@keo.limsi.fr>

I have posted this message on r-lang, but it is perhaps more appropriate
on r-devel:



---



Hello,



I'm puzzled by a problem with call to diag(), rowSums(), rownames() on
objects of class "dgtMatrix", created by sparseMatrix() or spMatrix().



I use Matrix 0.999375-30.



The weird thing is that I don't encounter any problem when I use this
functions on the R prompt, or source()-ing a script file; I encounter
problems when the code is in a package, installed with R CMD INSTALL, and
loaded with library().



I have tried to reduce the package to the bare minimum in order to
discover the problem, but it continue even when reduced up to a single

method, no dependency other than Matrix. The method is defined as:



---

getAdjacentAsSparseMatrix <- function() {

     adjacents <- sparseMatrix(i=1:10, j=1:10, x=1:10)

     print(class(adjacents));

     diagonal <- as.vector(diag(adjacents));

     if (any(diagonal != 0)) {

       diagonal[diagonal > 1] <- 1;

       diag(adjacents) <- diagonal;

      }

     return(adjacents);

}

---



And the Depends field in ./DESCRIPTION :



---

Depends: R (>= 2.5.0), Matrix

---



I have this outputs:



[1] "dgTMatrix"

Erreur dans y[1L + 0L:(m - 1L) * (n + 1L)] <- x :

     types (de S4 a double) incompatibles dans l'ajustement d'affectation de

type

> traceback()

3: diag(adjacents)

2: as.vector(diag(adjacents))

1: getAdjacentAsSparseMatrix(white3)



The same thing happens with the method rowSums(), colnames() and
rownames(). In brief, it looks as if the generic functions were called,

and not the overloaded ones. I can't figure out how to fix that, and will
be interested in any pointers.



Best,

Sylvain


From pleydell at supagro.inra.fr  Wed Aug 26 12:47:29 2009
From: pleydell at supagro.inra.fr (pleydell at supagro.inra.fr)
Date: Wed, 26 Aug 2009 12:47:29 +0200
Subject: [Rd] Cannot make 3 different R installations for 3
	different	valgrind-instrumentation levels
In-Reply-To: <D30ADD33-3339-409D-B2E2-9090B4E14CD8@r-project.org>
References: <20090825183131.19kjcomatupco0wg@web.supagro.inra.fr>
	<D30ADD33-3339-409D-B2E2-9090B4E14CD8@r-project.org>
Message-ID: <20090826124729.ad1ilt691u880w0w@web.supagro.inra.fr>

> You're confusing rhome and arch - the above makes no sense. Let rhome 
>  alone and you should be fine. (And make sure you're not building in  
> the source tree - you should be using something like mkdir obj_vg0 && 
>  cd obj_vg0 && ../R-2.9.1/configure ...)

Thanks Simon. I'd already tried various variations with rhome and arch, but I
think my biggest error was that I was always compiling from within the source
tree. However, the following script still doesn't quite do the job

cd /usr/local/lib
mkdir R-2.9.2_vg0
mkdir R-2.9.2_vg1
mkdir R-2.9.2_vg2
cd /usr/local/lib/R-2.9.2_vg2
sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
--with-valgrind-instrumentation=2 r_arch=vg2
sudo make
sudo make install
cd /usr/local/lib/R-2.9.2_vg1
sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
--with-valgrind-instrumentation=1 r_arch=vg1
sudo make
sudo make install
cd /usr/local/lib/R-2.9.2_vg0
sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
--with-valgrind-instrumentation=0 r_arch=vg0
sudo make
sudo make latex
sudo make dvi
sudo make pdf
sudo make info
sudo make help
sudo make html
sudo make uninstall
sudo make install

Now the command "R --arch=vg0" executes fine, but...

david at david > R --arch=vg1
/usr/local/bin/R: line 230: /usr/local/lib/R/bin/exec/vg1/R: No such file or
directory
/usr/local/bin/R: line 230: exec: /usr/local/lib/R/bin/exec/vg1/R: cannot
execute: No such file or directory

david at david > R --arch=vg2
/usr/local/bin/R: line 230: /usr/local/lib/R/bin/exec/vg2/R: No such file or
directory
/usr/local/bin/R: line 230: exec: /usr/local/lib/R/bin/exec/vg2/R: cannot
execute: No such file or directory

is suspect installing to seperate _vg0, _vg1 and _vg2 directories could be the
problem. I'll retry and post the results.

David


From pleydell at supagro.inra.fr  Wed Aug 26 13:26:51 2009
From: pleydell at supagro.inra.fr (pleydell at supagro.inra.fr)
Date: Wed, 26 Aug 2009 13:26:51 +0200
Subject: [Rd] Cannot make 3 different R installations for 3
	different	valgrind-instrumentation levels
In-Reply-To: <20090826124729.ad1ilt691u880w0w@web.supagro.inra.fr>
References: <20090825183131.19kjcomatupco0wg@web.supagro.inra.fr>
	<D30ADD33-3339-409D-B2E2-9090B4E14CD8@r-project.org>
	<20090826124729.ad1ilt691u880w0w@web.supagro.inra.fr>
Message-ID: <20090826132651.t2m1ls0bsyokow0c@web.supagro.inra.fr>

> is suspect installing to seperate _vg0, _vg1 and _vg2 directories 
> could be the problem. I'll retry and post the results.

Well, the following script didn't work

cd /usr/local/lib
sudo mkdir R
cd /usr/local/lib/R
sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
--with-valgrind-instrumentation=2 r_arch=vg2
sudo make
sudo make install
sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
--with-valgrind-instrumentation=1 r_arch=vg1
sudo make
sudo make install
sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
--with-valgrind-instrumentation=0 r_arch=vg0
sudo make
sudo make latex
sudo make dvi
sudo make pdf
sudo make info
sudo make help
sudo make html
sudo make install

the relevent lines of config.log appear to be

configure:5546: gcc -E -I/usr/local/include conftest.c
conftest.c:16:28: error: ac_nonexistent.h: No such file or directory
configure:5552: $? = 1
configure: failed program was:
| /* confdefs.h.  */
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.9.2"
| #define PACKAGE_STRING "R 2.9.2"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.9.2"
| #define R_PLATFORM "i686-pc-linux-gnu"
| #define R_CPU "i686"
| #define R_VENDOR "pc"
| #define R_OS "linux-gnu"
| #define Unix 1
| #define R_ARCH "vg2"
| /* end confdefs.h.  */
| #include <ac_nonexistent.h>
configure:5585: result: gcc -E
configure:5614: gcc -E -I/usr/local/include conftest.c
configure:5620: $? = 0
configure:5651: gcc -E -I/usr/local/include conftest.c
conftest.c:16:28: error: ac_nonexistent.h: No such file or directory
configure:5657: $? = 1
configure: failed program was:
| /* confdefs.h.  */

any ideas?
David


From friedrich.leisch at stat.uni-muenchen.de  Wed Aug 26 14:59:45 2009
From: friedrich.leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Wed, 26 Aug 2009 14:59:45 +0200
Subject: [Rd] improving ?RweaveLatex
In-Reply-To: <6D6B7156-C847-4039-8D33-FAEFEA49AF5A@me.com>
References: <68b1e2610908221245i4235549cw908c32e5efbdde95@mail.gmail.com>
	<1A9D0140-202D-40CE-BEC3-58765CB16D46@me.com>
	<526F10DE-7048-4AA1-A76D-7D863176DB1F@me.com>
	<6D6B7156-C847-4039-8D33-FAEFEA49AF5A@me.com>
Message-ID: <19093.12737.173872.597154@lxh5.stat.uni-muenchen.de>

>>>>> On Sat, 22 Aug 2009 16:51:31 -0500,
>>>>> Marc Schwartz (MS) wrote:

  > <snip>
  > On Aug 22, 2009, at 4:30 PM, Marc Schwartz wrote:
  >> 
  >> I have some proposed modifications to RweaveLatex.Rd which I include  
  >> here as a patch against the R-devel version of the file from svn. I  
  >> have added comments about the issue that Liviu raised, the use of  
  >> the [nogin] option and while I was at it, the [noae] option as well.  
  >> There are added to the 'details' section of the file.

  > OK, once more....

  > I noted a typo and also neglected to add pointers to the Details  
  > section in the descriptions of the height and width options.

  > Here is a corrected version of the patch file.

Thanks a lot, will apply the patch in a minute.

Best,
Fritz


From marc_schwartz at me.com  Wed Aug 26 15:23:29 2009
From: marc_schwartz at me.com (Marc Schwartz)
Date: Wed, 26 Aug 2009 08:23:29 -0500
Subject: [Rd] improving ?RweaveLatex
In-Reply-To: <19093.12737.173872.597154@lxh5.stat.uni-muenchen.de>
References: <68b1e2610908221245i4235549cw908c32e5efbdde95@mail.gmail.com>
	<1A9D0140-202D-40CE-BEC3-58765CB16D46@me.com>
	<526F10DE-7048-4AA1-A76D-7D863176DB1F@me.com>
	<6D6B7156-C847-4039-8D33-FAEFEA49AF5A@me.com>
	<19093.12737.173872.597154@lxh5.stat.uni-muenchen.de>
Message-ID: <61679DA0-E669-4A8B-A03B-F3566F105630@me.com>

On Aug 26, 2009, at 7:59 AM, Friedrich Leisch wrote:

>>>>>> On Sat, 22 Aug 2009 16:51:31 -0500,
>>>>>> Marc Schwartz (MS) wrote:
>
>> <snip>
>> On Aug 22, 2009, at 4:30 PM, Marc Schwartz wrote:
>>>
>>> I have some proposed modifications to RweaveLatex.Rd which I include
>>> here as a patch against the R-devel version of the file from svn. I
>>> have added comments about the issue that Liviu raised, the use of
>>> the [nogin] option and while I was at it, the [noae] option as well.
>>> There are added to the 'details' section of the file.
>
>> OK, once more....
>
>> I noted a typo and also neglected to add pointers to the Details
>> section in the descriptions of the height and width options.
>
>> Here is a corrected version of the patch file.
>
> Thanks a lot, will apply the patch in a minute.
>
> Best,
> Fritz



Fritz,

You may want to hold off for a bit, as I am just getting a chance to  
look at Martin's recommendations for some fine tuning of the language.

I have to run to a meeting in a little while and probably won't get to  
generate an updated patch until after I return.

Look for an updated patch from me in the next few hours, if you don't  
mind.

Thanks for your consideration.

Marc


From simon.urbanek at r-project.org  Wed Aug 26 16:11:11 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 26 Aug 2009 10:11:11 -0400
Subject: [Rd] Cannot make 3 different R installations for 3 different
	valgrind-instrumentation levels
In-Reply-To: <20090826124729.ad1ilt691u880w0w@web.supagro.inra.fr>
References: <20090825183131.19kjcomatupco0wg@web.supagro.inra.fr>
	<D30ADD33-3339-409D-B2E2-9090B4E14CD8@r-project.org>
	<20090826124729.ad1ilt691u880w0w@web.supagro.inra.fr>
Message-ID: <1AC73CC3-67A9-4800-9B9C-E65525D35152@r-project.org>


On Aug 26, 2009, at 6:47 , pleydell at supagro.inra.fr wrote:

>> You're confusing rhome and arch - the above makes no sense. Let  
>> rhome  alone and you should be fine. (And make sure you're not  
>> building in  the source tree - you should be using something like  
>> mkdir obj_vg0 &&  cd obj_vg0 && ../R-2.9.1/configure ...)
>
> Thanks Simon. I'd already tried various variations with rhome and  
> arch, but I
> think my biggest error was that I was always compiling from within  
> the source
> tree. However, the following script still doesn't quite do the job
>
> cd /usr/local/lib
> mkdir R-2.9.2_vg0
> mkdir R-2.9.2_vg1
> mkdir R-2.9.2_vg2
> cd /usr/local/lib/R-2.9.2_vg2
> sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
> --with-valgrind-instrumentation=2 r_arch=vg2

^^-- this is really bad form - you should never build/compile software  
as root. The location of the build directory is irrelevant so use /tmp  
or you home or something like that ... (usualy the fastest disk ;))


> sudo make
> sudo make install
> cd /usr/local/lib/R-2.9.2_vg1
> sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
> --with-valgrind-instrumentation=1 r_arch=vg1
> sudo make
> sudo make install
> cd /usr/local/lib/R-2.9.2_vg0
> sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
> --with-valgrind-instrumentation=0 r_arch=vg0
> sudo make
> sudo make latex
> sudo make dvi
> sudo make pdf
> sudo make info
> sudo make help
> sudo make html
> sudo make uninstall
> sudo make install
>

Why would you do all that? It should work if you do just make && make  
install on the subsequent archs. Note that docs etc. are all shared so  
it's sufficient to build them in the first arch.

Cheers,
Simon

PS: the config.log entry you sent is entirely irrelevant - it's header  
handling test


> Now the command "R --arch=vg0" executes fine, but...
>
> david at david > R --arch=vg1
> /usr/local/bin/R: line 230: /usr/local/lib/R/bin/exec/vg1/R: No such  
> file or
> directory
> /usr/local/bin/R: line 230: exec: /usr/local/lib/R/bin/exec/vg1/R:  
> cannot
> execute: No such file or directory
>
> david at david > R --arch=vg2
> /usr/local/bin/R: line 230: /usr/local/lib/R/bin/exec/vg2/R: No such  
> file or
> directory
> /usr/local/bin/R: line 230: exec: /usr/local/lib/R/bin/exec/vg2/R:  
> cannot
> execute: No such file or directory
>
> is suspect installing to seperate _vg0, _vg1 and _vg2 directories  
> could be the
> problem. I'll retry and post the results.
>
> David
>
>
>


From abhibera at gmail.com  Wed Aug 26 16:15:59 2009
From: abhibera at gmail.com (Abhijit Bera)
Date: Wed, 26 Aug 2009 19:45:59 +0530
Subject: [Rd] Clarifications please.
In-Reply-To: <fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>
	<6phd46km2gl.fsf@gopher4.fhcrc.org>
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
Message-ID: <fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090826/19857884/attachment.pl>

From pleydell at supagro.inra.fr  Wed Aug 26 16:43:58 2009
From: pleydell at supagro.inra.fr (pleydell at supagro.inra.fr)
Date: Wed, 26 Aug 2009 16:43:58 +0200
Subject: [Rd] Cannot make 3 different R installations for 3
	different	valgrind-instrumentation levels
In-Reply-To: <1AC73CC3-67A9-4800-9B9C-E65525D35152@r-project.org>
References: <20090825183131.19kjcomatupco0wg@web.supagro.inra.fr>
	<D30ADD33-3339-409D-B2E2-9090B4E14CD8@r-project.org>
	<20090826124729.ad1ilt691u880w0w@web.supagro.inra.fr>
	<1AC73CC3-67A9-4800-9B9C-E65525D35152@r-project.org>
Message-ID: <20090826164358.sxwe3xawyw00ow4k@web.supagro.inra.fr>


> ^^-- this is really bad form - you should never build/compile 
> software  as root. The location of the build directory is irrelevant 
> so use /tmp  or you home or something like that ... (usualy the 
> fastest disk ;))

OK, thanks for the tip, although I don't understand the configure - make -
install cycle enough to see how compiling as non-root and installing as 
root is
any safer than just doing both as root.

> Why would you do all that?

Well, when you've been trying for hours to get something to work and it 
doesn't
and there are no workable examples on the net... is it too much to ask that a
workable example be placed in the documentation? Finally I have a script that
has worked for me (writen before I saw Simon's comment about root)

cd /usr/local/lib
umask 022
mkdir R-2.9.2
mkdir build_vg0
mkdir build_vg1
mkdir build_vg2
cd /usr/local/lib/build_vg2
sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
--with-valgrind-instrumentation=2 r_arch=vg2
sudo make
sudo make prefix=/usr/local/lib/R-2.9.2 install
cd /usr/local/lib/build_vg1
sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
--with-valgrind-instrumentation=1 r_arch=vg1
sudo make
sudo make prefix=/usr/local/lib/R-2.9.2 install
cd /usr/local/lib/build_vg0
sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
--with-valgrind-instrumentation=0 r_arch=vg0
sudo make
sudo make latex
sudo make dvi
sudo make pdf
sudo make info
sudo make help
sudo make html
sudo make prefix=/usr/local/lib/R-2.9.2 install
sudo cp /usr/local/lib/R-2.9.2/bin/R /usr/local/bin/R

IMHO, if the surpless newbie chaff was whittled off this example might 
be useful
to others in the official documentation.

David


From simon.urbanek at r-project.org  Wed Aug 26 17:23:32 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 26 Aug 2009 11:23:32 -0400
Subject: [Rd] Cannot make 3 different R installations for 3 different
	valgrind-instrumentation levels
In-Reply-To: <20090826164358.sxwe3xawyw00ow4k@web.supagro.inra.fr>
References: <20090825183131.19kjcomatupco0wg@web.supagro.inra.fr>
	<D30ADD33-3339-409D-B2E2-9090B4E14CD8@r-project.org>
	<20090826124729.ad1ilt691u880w0w@web.supagro.inra.fr>
	<1AC73CC3-67A9-4800-9B9C-E65525D35152@r-project.org>
	<20090826164358.sxwe3xawyw00ow4k@web.supagro.inra.fr>
Message-ID: <002BCEC3-F5A4-4735-8A18-ACB3CA7D29F1@r-project.org>


On Aug 26, 2009, at 10:43 , pleydell at supagro.inra.fr wrote:

>
>> ^^-- this is really bad form - you should never build/compile  
>> software  as root. The location of the build directory is  
>> irrelevant so use /tmp  or you home or something like that ...  
>> (usualy the fastest disk ;))
>
> OK, thanks for the tip, although I don't understand the configure -  
> make -
> install cycle enough to see how compiling as non-root and installing  
> as root is
> any safer than just doing both as root.
>

configure and make are compiling the product which means compiling and  
running a lot of various code. Since that whole process does various  
probes and is inherently very complex you don't want to expose your  
entire system to it (in the process files are deleted etc. so a bug in  
it could wipe your system for example ...). There is no need to run it  
as root, because you don't need any special privileges to compile it.  
In addition, the root environment is usually different from the user  
environment so it's in general easier to setup your user environment  
if needed (and even temporarily).

The only part that needs root access potentially is installation if  
you decide to install to a system-wide location. That part is just  
copying so it in generally safe to run as root (in fact even that can  
be used in a more safe way without root using DESTDIR instead but  
that's for more paranoid people like me ;)).


>> Why would you do all that?
>
> Well, when you've been trying for hours to get something to work and  
> it doesn't
> and there are no workable examples on the net... is it too much to  
> ask that a
> workable example be placed in the documentation?

Well, you're using an advanced feature (multi-arch support) in a way  
that it was not designed for, so you better really know what you're  
doing ;). But even so - the example from the docs (slightly  
abbreviated by removing the compiler-specific args) says:


tar fxz R-2.9.2.tar.gz
mkdir R-ppc
cd R-ppc
../R-2.9.2/configure r_arch=ppc ...
make
make install
cd ..
# Depending on your permissions, you may need to run sudo make install.

mkdir R-i386
cd R-i386
../R-2.9.2/configure r_arch=i386 ...
make
make install
cd ..

That is known to work  - replace ppc/i386 by your vg names and you're  
all set...



> Finally I have a script that
> has worked for me (writen before I saw Simon's comment about root)
>
> cd /usr/local/lib
> umask 022
> mkdir R-2.9.2
> mkdir build_vg0
> mkdir build_vg1
> mkdir build_vg2
> cd /usr/local/lib/build_vg2
> sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
> --with-valgrind-instrumentation=2 r_arch=vg2
> sudo make
> sudo make prefix=/usr/local/lib/R-2.9.2 install
> cd /usr/local/lib/build_vg1
> sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
> --with-valgrind-instrumentation=1 r_arch=vg1
> sudo make
> sudo make prefix=/usr/local/lib/R-2.9.2 install
> cd /usr/local/lib/build_vg0
> sudo /usr/local/src/R-2.9.2/configure --enable-memory-profiling
> --with-valgrind-instrumentation=0 r_arch=vg0
> sudo make
> sudo make latex
> sudo make dvi
> sudo make pdf
> sudo make info
> sudo make help
> sudo make html
> sudo make prefix=/usr/local/lib/R-2.9.2 install
> sudo cp /usr/local/lib/R-2.9.2/bin/R /usr/local/bin/R
>
> IMHO, if the surpless newbie chaff was whittled off this example  
> might be useful
> to others in the official documentation.
>

I still don't understand why you are running all the doc makes at the  
end and why you set a prefix and then copy things manually ...

Cheers,
Simon


From mtmorgan at fhcrc.org  Wed Aug 26 18:55:42 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 26 Aug 2009 09:55:42 -0700
Subject: [Rd] Clarifications please.
In-Reply-To: <fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>	
	<6phd46km2gl.fsf@gopher4.fhcrc.org>	
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
Message-ID: <4A95690E.1070806@fhcrc.org>

Hi Abhijit --

Abhijit Bera wrote:
> Hi Martin
> 
> Thanks. I think I got it! Read the R extensions documentation again. I
> don't even need to convert to a list. This is what I did (just a demo):
> 
> #include <R.h>
> #include <Rinternals.h>
> #include <Rdefines.h>
> #include <Rembedded.h>
> 
> int main (int argc, char** argv)  {
>    
>     SEXP e,t1,t2,val;
>     int errorOccurred,nx,ny,i,j;
>     double *v;
> 
>     Rf_initEmbeddedR(argc, argv);
>    
>     PROTECT(e = lang2(install("library"), mkString("fPortfolio")));
>     R_tryEval(e, R_GlobalEnv, NULL);
>     UNPROTECT(1);
>    
>     /* We try to evaluate the R expression:
>     *  round(cov(100 * SWX.RET), digits = 4)
>     *  we shall split it as:
>     *  t1<-100*SWX.RET
>     *  t2<-cov(t1)
>     *  val<-round(t2,4)
>     */
>    
>     PROTECT(e = lang3(install("*"),ScalarInteger(100), install("SWX.RET")));
>     PROTECT(t1 = (R_tryEval(e, NULL, &errorOccurred)));

For what it's worth, and realizing that this is sloppiness in my
original code, ScalarInteger(100) (and mkString("fPortfolio")) returns
an unprotected SEXP, so it could in principle be garbage collected while
lang3 is being evaluated...

>    
>     PROTECT(e = lang2(install("cov"),t1));
>     PROTECT(t2 = (R_tryEval(e, NULL, &errorOccurred)));
>    
>     PROTECT(e = lang3(install("round"),t2, ScalarInteger(4)));
>     PROTECT(val = (R_tryEval(e, NULL, &errorOccurred)));
>    
>     Rf_PrintValue(val);
>    
>    /* This isn't required, is extraneous.
>     PROTECT(e = lang2(install("as.list"),val));
>     PROTECT(t2 = (R_tryEval(e, NULL, &errorOccurred)));
>    
>     Rf_PrintValue(t2);*/

the reason I recommended using as.list (for example) was to respect the
implied abstraction between the object (of class 'timeSeries') and it's
representation. Apparently there is a method as.list.timeSeries, and a
list is something that I am allowed to know about. Your code below
works, but doesn't respect the (R-level) abstraction the class author
wants. I don't know whether this is regular practice in the R community,
but it seems like the right thing to do.

Martin

>    
>     v=REAL(val);
>    
>     PROTECT(t2=getAttrib(val,R_DimSymbol));
>    
>     nx=INTEGER(t2)[0];
>     ny=INTEGER(t2)[1];
>    
>     /* Just printing out the matrix
>    *  To understand how I can convert
>    *  data types b/w R and C
>    */
> 
>     printf("Matrix:\n");
>    
>     for(i=0,j=0;i<(nx*ny);i++,j++) {
>        
>         printf("%.4f ",v[i]);
>        
>         if(j==ny-1) {
>             printf("\n");
>             j=0;
>         }
>        
>     }
>    
>     UNPROTECT(6);
>    
>     return 0;
>    
> }
> 
> Regards
> 
> Abhijit Bera
> 
> 
> On Wed, Aug 26, 2009 at 12:37 PM, Abhijit Bera <abhibera at gmail.com
> <mailto:abhibera at gmail.com>> wrote:
> 
>     Hi Martin
> 
>     Thanks. I think I got the hang of it. I will try it out and post any
>     more queries I have regarding handling data types onto the mailing list.
> 
>     Regards
> 
>     Abhijit Bera
> 
> 
>     On Tue, Aug 25, 2009 at 7:15 PM, Martin Morgan <mtmorgan at fhcrc.org
>     <mailto:mtmorgan at fhcrc.org>> wrote:
> 
>         Abhijit Bera <abhibera at gmail.com <mailto:abhibera at gmail.com>>
>         writes:
> 
>         > Hi
>         >
>         > I think I have asked these questions earlier, but I been able
>         to find
>         > answers from the documentation (which I found poorly written
>         in several
>         > places). Will someone be kind enough to give me answers and
>         enlighten me?
>         > (as in explain with CODE?)
>         >
>         > I want to embed R in my application and use the fPortfolio
>         package for
>         > carrying out risk management computations. Right now I'm
>         reading the
>         > Rmetrics Ebook and trying to convert the various examples into
>         embedded C
>         > code.
>         >
>         > Coming from a strictly C background, I have slight difficulty in
>         > comprehending a functional language like R and it gets worse
>         when I try to
>         > embed R into a procedural language like C. So here is a list
>         of my doubts:
>         >
>         > 1) I am very confused on how the lang 1 2 3 4 ... set of
>         functions work. I
>         > haven't found any relevant documentation explaining it
>         clearly. I have a
>         > vague idea but still I cannot understand how I would evaluate an R
>         > expression like Covariance <- round(cov(100 * SWX.RET), digits
>         = 4) using
>         > lang, install and R_tryEval.
> 
>         unroll this as
> 
>          tmp0 <- 100 * SWX.RET
>          tmp1 <- cov(tmp0)
>          result <- round(tmp2, 4L)
> 
>         so (untested)
> 
>          PROTECT(expr =
>            lang3(install("*"), scalarNumeric(100), install("SWX.RET")));
>          PROTECT(tmp0 = tryEval(expr, R_GlobalEnv, &errorOccurred));
>          if (errorOccurred)
>            exit(1);
> 
>          PROTECT(expr = lang2(install("cov"), tmp0));
>          PROTECT(tmp1 = tryEval(expr, R_GlobalEnv, &errorOccurred));
>          if (errorOccurred)
>            exit(1);
> 
>          PROTECT(expr = lang3(install("round"), tmp1, scalarInteger(4)));
>          PROTECT(result = tryEval(expr, R_GlobalEnv, &errorOccurred));
>          if (errorOccurred)
>            exit(1);
> 
>          Rf_PrintValue(result);
>          UNPROTECT(6);
> 
> 
> 
>         > 2) What exactly does install do?
> 
>         creates or locates a symbol in the global symbol table. Every unique
>         symbol is recorded and stored in the 'global symbol table'. An
>         environment is then a mapping between a symbol from this table,
>         and a
>         value unique to the environment. The symbols are being reused across
>         environments.
> 
>         In R
> 
>          x <- 10
> 
>         creates a symbol x in the global symbol table, and in the global
>         environment associates the value 10 with that symbol.
> 
>          env = new.env()
>          env$x <- 20
> 
>         uses the same symbol 'x' from the same global symbol table, but
>         associates the value 20 with it in the environment 'env'.
> 
>         In C
> 
>          install("foo");
> 
>         creates a symbol and returns the appropriate SEXP. And then
> 
>          install("foo")
> 
>         again finds the already-defined symbol and returns the same SEXP.
> 
>         > 3) I wrote the following code:
>         >
>         > #include <Rinternals.h>
>         > #include <Rembedded.h>
>         >
>         > int main (int argc, char** argv) {
>         >
>         >     SEXP e,val;
>         >     int errorOccurred;
>         >
>         >     Rf_initEmbeddedR(argc, argv);
>         >
>         >     // library("fPortfolio")
>         >     PROTECT(e = lang2(install("library"),
>         mkString("fPortfolio")));
>         >     R_tryEval(e, R_GlobalEnv, NULL);
>         >     UNPROTECT(1);
>         >
>         >    // colMeans(SWX.RET)
>         >     PROTECT(e = lang2(install("colMeans"), install("SWX.RET")));
>         >     val = (R_tryEval(e, NULL, &errorOccurred));
>         >
>         >     Rf_PrintValue(val);
>         >
>         >     return 0;
>         >
>         > }
>         >
>         > When I tried :
>         >
>         >>mean(SWX.RET)
>         >
>         > in the R prompt I got the following output:
>         >
>         >          SBI          SPI          SII         LP25         LP40
>         > LP60
>         > 4.660521e-06 2.153198e-04 2.033869e-04 1.388886e-04 1.349041e-04
>         > 1.226859e-04
>         >
>         >
>         > However when I replaced colMeans with mean in the C code above
>         I got a mean
>         > of the means (0.0001366410) of all the columns when
>         Rf_PrintValue was
>         > called. Using colMeans gave me the output as shown above. Why
>         does this
>         > happen? How do I get the above output using mean?
> 
>         Guessing a little; I don't know what class SWX.RET is, but perhaps
>         there is a method mean.class_of_SWX.RET defined in a package that is
>         loaded in your R session, but not your C session. In a new R I see
> 
>         > library(fPortfolio)
>         > mean(SWX.RET)
>         [1] 0.0001366410
> 
>         > 4) From the above code segment, how can I deal with the
>         SEXPREC val which is
>         > returned by R_tryEval in the above code and convert it to my
>         own local
>         > vector datatype? How do I access the values of val? val will
>         now be a
>         > timeseries so how do i convert it?
> 
>         Convert it to a 'standard' R object using appropriate R
>         functions and
>         access it using C, e.g.,
> 
>         > lst <- as.list(SWX.RET)
>         > str(lst)
>         List of 6
>         $ SBI : num [1:1916] -0.002088 -0.000105 -0.00136 0.000419 0 ...
>         $ SPI : num [1:1916] -0.03439 -0.01041 0.01212 0.02246 0.00211 ...
>         $ SII : num [1:1916] 1.37e-05 -4.96e-03 3.81e-03 -6.16e-04
>         2.38e-03 ...
>         $ LP25: num [1:1916] -0.01199 -0.00366 -0.00132 0.00771 0.00303 ...
>         $ LP40: num [1:1916] -0.01801 -0.00584 -0.00164 0.01166 0.00457 ...
>         $ LP60: num [1:1916] -0.02616 -0.00901 -0.0024 0.01706 0.00695 ...
> 
>         so in C, once I have lst, I could
> 
>          sbi = VECTOR_ELT(lst, 0);
>          double *vals = NUMERIC(sbi);
>          printf("%f", vals[0]); # -002088
> 
>         Hope that helps, and is not too misleading, I didn't have time to
>         check carefully.
> 
>         Martin
> 
>         > Thanks
>         >
>         > Abhijit Bera
>         >
>         >       [[alternative HTML version deleted]]
>         >
>         > ______________________________________________
>         > R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>         > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>         --
>         Martin Morgan
>         Computational Biology / Fred Hutchinson Cancer Research Center
>         1100 Fairview Ave. N.
>         PO Box 19024 Seattle, WA 98109
> 
>         Location: Arnold Building M1 B861
>         Phone: (206) 667-2793
> 
> 
>


From mrg at fhcrc.org  Wed Aug 26 19:53:31 2009
From: mrg at fhcrc.org (Michael Gutteridge)
Date: Wed, 26 Aug 2009 10:53:31 -0700 (PDT)
Subject: [Rd] header containing (PR#13834)
In-Reply-To: <alpine.LFD.2.00.0908211540540.22597@gannet.stats.ox.ac.uk>
References: <20090820200026.253632831FF8@mail.pubhealth.ku.dk>
	<alpine.LFD.2.00.0908211540540.22597@gannet.stats.ox.ac.uk>
Message-ID: <alpine.DEB.2.00.0908241032080.12797@godfrey>

On Fri, 21 Aug 2009, Prof Brian Ripley wrote:

> ... nor is it described on man -s2 mkdir on my Solaris 10 system, so it 
> is not surprising that we didn't know about it.

Yep- I see the lack of documentation reported as a bug on opensolaris:

http://bugs.opensolaris.org/bugdatabase/view_bug.do?bug_id=6738185

Though FSM knows when they'll update the manpage.

> My slight concern is that ENOSYS might not be defined on some other OS, 
> but I've not found one and POSIX requires it.

This is sort of why I'd thought it might be best to have this ENOSYS check 
done on Solaris only.  Since it seems to work everywhere else, isolate 
this change to Solaris only.

I've attached a patch I've developed that seems to work in our 
environment.  I do use defines to do platform detection in this patch.

Copy this patch inside the source directory and run:

  solaris$ gpatch -p 1 -i platform.patch"

Michael
-------------- next part --------------
A non-text attachment was scrubbed...
Name: platform.patch
Type: text/x-diff
Size: 1612 bytes
Desc: 
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090826/77523013/attachment.bin>

From groemping at bht-berlin.de  Wed Aug 26 21:58:04 2009
From: groemping at bht-berlin.de (Ulrike Groemping)
Date: Wed, 26 Aug 2009 12:58:04 -0700 (PDT)
Subject: [Rd] Problem with correct usage of formula environment
In-Reply-To: <25136335.post@talk.nabble.com>
References: <25136335.post@talk.nabble.com>
Message-ID: <25156303.post@talk.nabble.com>


I have found a fix now - I define the variable "center" (that takes the role
of the !iscube below) within the function formula.design, and then using
"formula" instead of "as.formula" solves the issue, because it preserves the
calling environment - first time I get an idea what this is good for ...

I would still be grateful for a pointer to a readable source on the
connection between model frames, data=arguments and environments in the
context of models and formulae. 

With best regards, 
Ulrike Gr?mping



Ulrike Groemping wrote:
> 
> Dear all, 
> 
> I am working on a function formula.design that should automatically
> generate reasonable lm formulae for a number of different designs. All
> works well as long as all variables used are columns of the design data
> frame. For one function, I would like to incorporate a dummy variable for
> center points that is not a column of the design. Without this function,
> it would work like this (at least version 0.97 of package FrF2):
> 
> require(FrF2)
> plan <- FrF2(8,4,ncenter=6)
> y <- rnorm(14)
> r.plan<-add.response(plan,y)
> lm(y~A+B+C+D+!iscube(r.plan), r.plan)
> 
> Building the formula from within function formula.design works OK at first
> sight:
>> formula(r.plan)
> y ~ A + B + C + D + (!iscube(r.plan))
> 
> However, using the formula in a linear model call does not work in this
> case: 
>> lm(r.plan)
> Fehler in inherits(x, "factor") : Objekt 'object' nicht gefunden
>> traceback()
> 12: inherits(x, "factor")
> 11: is.factor(table)
> 10: match(x, table, nomatch = 0L)
> 9: "design" %in% class(design)
> 8: iscube(object)
> 7: eval(expr, envir, enclos)
> 6: eval(predvars, data, env)
> 5: model.frame.default(formula = r.plan, drop.unused.levels = TRUE)
> 4: model.frame(formula = r.plan, drop.unused.levels = TRUE)
> 3: eval(expr, envir, enclos)
> 2: eval(mf, parent.frame())
> 1: lm(r.plan)
> 
> 9: of the traceback is the first line of function iscube, and it seems
> that the object r.plan cannot be found here. I have no idea how to fix
> this. In case it helps: The expression generating the formula in function
> formula.design is
> 
> as.formula(paste(response, paste(c(names(factor.names),
> paste("!iscube(",xnam,")",sep="")), collapse="+"),sep="~"))
> 
> I am grateful for any pointers that direct me to a fix for this problem
> and/or to a better understanding of its root cause.
> 
> Thanks and regards,
> Ulrike
> 

-- 
View this message in context: http://www.nabble.com/Problem-with-correct-usage-of-formula-environment-tp25136335p25156303.html
Sent from the R devel mailing list archive at Nabble.com.


From simon.urbanek at r-project.org  Wed Aug 26 22:13:07 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 26 Aug 2009 16:13:07 -0400
Subject: [Rd] Clarifications please.
In-Reply-To: <4A95690E.1070806@fhcrc.org>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>	
	<6phd46km2gl.fsf@gopher4.fhcrc.org>	
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
	<4A95690E.1070806@fhcrc.org>
Message-ID: <2FF10FB5-237F-47FD-A4D4-3E0811C62845@r-project.org>


On Aug 26, 2009, at 12:55 , Martin Morgan wrote:

> Hi Abhijit --
>
> Abhijit Bera wrote:
>> Hi Martin
>>
>> Thanks. I think I got it! Read the R extensions documentation  
>> again. I
>> don't even need to convert to a list. This is what I did (just a  
>> demo):
>>
>> #include <R.h>
>> #include <Rinternals.h>
>> #include <Rdefines.h>
>> #include <Rembedded.h>
>>
>> int main (int argc, char** argv)  {
>>
>>    SEXP e,t1,t2,val;
>>    int errorOccurred,nx,ny,i,j;
>>    double *v;
>>
>>    Rf_initEmbeddedR(argc, argv);
>>
>>    PROTECT(e = lang2(install("library"), mkString("fPortfolio")));
>>    R_tryEval(e, R_GlobalEnv, NULL);
>>    UNPROTECT(1);
>>
>>    /* We try to evaluate the R expression:
>>    *  round(cov(100 * SWX.RET), digits = 4)
>>    *  we shall split it as:
>>    *  t1<-100*SWX.RET
>>    *  t2<-cov(t1)
>>    *  val<-round(t2,4)
>>    */
>>
>>    PROTECT(e = lang3(install("*"),ScalarInteger(100),  
>> install("SWX.RET")));
>>    PROTECT(t1 = (R_tryEval(e, NULL, &errorOccurred)));
>
> For what it's worth, and realizing that this is sloppiness in my
> original code, ScalarInteger(100) (and mkString("fPortfolio")) returns
> an unprotected SEXP, so it could in principle be garbage collected  
> while
> lang3 is being evaluated...
>

Actually, lang3 protects all its arguments, so it's safe (and IMHO the  
main point of having this function).

Cheers,
Simon


>>
>>    PROTECT(e = lang2(install("cov"),t1));
>>    PROTECT(t2 = (R_tryEval(e, NULL, &errorOccurred)));
>>
>>    PROTECT(e = lang3(install("round"),t2, ScalarInteger(4)));
>>    PROTECT(val = (R_tryEval(e, NULL, &errorOccurred)));
>>
>>    Rf_PrintValue(val);
>>
>>   /* This isn't required, is extraneous.
>>    PROTECT(e = lang2(install("as.list"),val));
>>    PROTECT(t2 = (R_tryEval(e, NULL, &errorOccurred)));
>>
>>    Rf_PrintValue(t2);*/
>
> the reason I recommended using as.list (for example) was to respect  
> the
> implied abstraction between the object (of class 'timeSeries') and  
> it's
> representation. Apparently there is a method as.list.timeSeries, and a
> list is something that I am allowed to know about. Your code below
> works, but doesn't respect the (R-level) abstraction the class author
> wants. I don't know whether this is regular practice in the R  
> community,
> but it seems like the right thing to do.
>
> Martin
>
>>
>>    v=REAL(val);
>>
>>    PROTECT(t2=getAttrib(val,R_DimSymbol));
>>
>>    nx=INTEGER(t2)[0];
>>    ny=INTEGER(t2)[1];
>>
>>    /* Just printing out the matrix
>>   *  To understand how I can convert
>>   *  data types b/w R and C
>>   */
>>
>>    printf("Matrix:\n");
>>
>>    for(i=0,j=0;i<(nx*ny);i++,j++) {
>>
>>        printf("%.4f ",v[i]);
>>
>>        if(j==ny-1) {
>>            printf("\n");
>>            j=0;
>>        }
>>
>>    }
>>
>>    UNPROTECT(6);
>>
>>    return 0;
>>
>> }
>>
>> Regards
>>
>> Abhijit Bera
>>
>>
>> On Wed, Aug 26, 2009 at 12:37 PM, Abhijit Bera <abhibera at gmail.com
>> <mailto:abhibera at gmail.com>> wrote:
>>
>>    Hi Martin
>>
>>    Thanks. I think I got the hang of it. I will try it out and post  
>> any
>>    more queries I have regarding handling data types onto the  
>> mailing list.
>>
>>    Regards
>>
>>    Abhijit Bera
>>
>>
>>    On Tue, Aug 25, 2009 at 7:15 PM, Martin Morgan <mtmorgan at fhcrc.org
>>    <mailto:mtmorgan at fhcrc.org>> wrote:
>>
>>        Abhijit Bera <abhibera at gmail.com <mailto:abhibera at gmail.com>>
>>        writes:
>>
>>> Hi
>>>
>>> I think I have asked these questions earlier, but I been able
>>        to find
>>> answers from the documentation (which I found poorly written
>>        in several
>>> places). Will someone be kind enough to give me answers and
>>        enlighten me?
>>> (as in explain with CODE?)
>>>
>>> I want to embed R in my application and use the fPortfolio
>>        package for
>>> carrying out risk management computations. Right now I'm
>>        reading the
>>> Rmetrics Ebook and trying to convert the various examples into
>>        embedded C
>>> code.
>>>
>>> Coming from a strictly C background, I have slight difficulty in
>>> comprehending a functional language like R and it gets worse
>>        when I try to
>>> embed R into a procedural language like C. So here is a list
>>        of my doubts:
>>>
>>> 1) I am very confused on how the lang 1 2 3 4 ... set of
>>        functions work. I
>>> haven't found any relevant documentation explaining it
>>        clearly. I have a
>>> vague idea but still I cannot understand how I would evaluate an R
>>> expression like Covariance <- round(cov(100 * SWX.RET), digits
>>        = 4) using
>>> lang, install and R_tryEval.
>>
>>        unroll this as
>>
>>         tmp0 <- 100 * SWX.RET
>>         tmp1 <- cov(tmp0)
>>         result <- round(tmp2, 4L)
>>
>>        so (untested)
>>
>>         PROTECT(expr =
>>           lang3(install("*"), scalarNumeric(100),  
>> install("SWX.RET")));
>>         PROTECT(tmp0 = tryEval(expr, R_GlobalEnv, &errorOccurred));
>>         if (errorOccurred)
>>           exit(1);
>>
>>         PROTECT(expr = lang2(install("cov"), tmp0));
>>         PROTECT(tmp1 = tryEval(expr, R_GlobalEnv, &errorOccurred));
>>         if (errorOccurred)
>>           exit(1);
>>
>>         PROTECT(expr = lang3(install("round"), tmp1,  
>> scalarInteger(4)));
>>         PROTECT(result = tryEval(expr, R_GlobalEnv, &errorOccurred));
>>         if (errorOccurred)
>>           exit(1);
>>
>>         Rf_PrintValue(result);
>>         UNPROTECT(6);
>>
>>
>>
>>> 2) What exactly does install do?
>>
>>        creates or locates a symbol in the global symbol table.  
>> Every unique
>>        symbol is recorded and stored in the 'global symbol table'. An
>>        environment is then a mapping between a symbol from this  
>> table,
>>        and a
>>        value unique to the environment. The symbols are being  
>> reused across
>>        environments.
>>
>>        In R
>>
>>         x <- 10
>>
>>        creates a symbol x in the global symbol table, and in the  
>> global
>>        environment associates the value 10 with that symbol.
>>
>>         env = new.env()
>>         env$x <- 20
>>
>>        uses the same symbol 'x' from the same global symbol table,  
>> but
>>        associates the value 20 with it in the environment 'env'.
>>
>>        In C
>>
>>         install("foo");
>>
>>        creates a symbol and returns the appropriate SEXP. And then
>>
>>         install("foo")
>>
>>        again finds the already-defined symbol and returns the same  
>> SEXP.
>>
>>> 3) I wrote the following code:
>>>
>>> #include <Rinternals.h>
>>> #include <Rembedded.h>
>>>
>>> int main (int argc, char** argv) {
>>>
>>>    SEXP e,val;
>>>    int errorOccurred;
>>>
>>>    Rf_initEmbeddedR(argc, argv);
>>>
>>>    // library("fPortfolio")
>>>    PROTECT(e = lang2(install("library"),
>>        mkString("fPortfolio")));
>>>    R_tryEval(e, R_GlobalEnv, NULL);
>>>    UNPROTECT(1);
>>>
>>>   // colMeans(SWX.RET)
>>>    PROTECT(e = lang2(install("colMeans"), install("SWX.RET")));
>>>    val = (R_tryEval(e, NULL, &errorOccurred));
>>>
>>>    Rf_PrintValue(val);
>>>
>>>    return 0;
>>>
>>> }
>>>
>>> When I tried :
>>>
>>>> mean(SWX.RET)
>>>
>>> in the R prompt I got the following output:
>>>
>>>         SBI          SPI          SII         LP25         LP40
>>> LP60
>>> 4.660521e-06 2.153198e-04 2.033869e-04 1.388886e-04 1.349041e-04
>>> 1.226859e-04
>>>
>>>
>>> However when I replaced colMeans with mean in the C code above
>>        I got a mean
>>> of the means (0.0001366410) of all the columns when
>>        Rf_PrintValue was
>>> called. Using colMeans gave me the output as shown above. Why
>>        does this
>>> happen? How do I get the above output using mean?
>>
>>        Guessing a little; I don't know what class SWX.RET is, but  
>> perhaps
>>        there is a method mean.class_of_SWX.RET defined in a package  
>> that is
>>        loaded in your R session, but not your C session. In a new R  
>> I see
>>
>>> library(fPortfolio)
>>> mean(SWX.RET)
>>        [1] 0.0001366410
>>
>>> 4) From the above code segment, how can I deal with the
>>        SEXPREC val which is
>>> returned by R_tryEval in the above code and convert it to my
>>        own local
>>> vector datatype? How do I access the values of val? val will
>>        now be a
>>> timeseries so how do i convert it?
>>
>>        Convert it to a 'standard' R object using appropriate R
>>        functions and
>>        access it using C, e.g.,
>>
>>> lst <- as.list(SWX.RET)
>>> str(lst)
>>        List of 6
>>        $ SBI : num [1:1916] -0.002088 -0.000105 -0.00136 0.000419  
>> 0 ...
>>        $ SPI : num [1:1916] -0.03439 -0.01041 0.01212 0.02246  
>> 0.00211 ...
>>        $ SII : num [1:1916] 1.37e-05 -4.96e-03 3.81e-03 -6.16e-04
>>        2.38e-03 ...
>>        $ LP25: num [1:1916] -0.01199 -0.00366 -0.00132 0.00771  
>> 0.00303 ...
>>        $ LP40: num [1:1916] -0.01801 -0.00584 -0.00164 0.01166  
>> 0.00457 ...
>>        $ LP60: num [1:1916] -0.02616 -0.00901 -0.0024 0.01706  
>> 0.00695 ...
>>
>>        so in C, once I have lst, I could
>>
>>         sbi = VECTOR_ELT(lst, 0);
>>         double *vals = NUMERIC(sbi);
>>         printf("%f", vals[0]); # -002088
>>
>>        Hope that helps, and is not too misleading, I didn't have  
>> time to
>>        check carefully.
>>
>>        Martin
>>
>>> Thanks
>>>
>>> Abhijit Bera
>>>
>>>      [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>        --
>>        Martin Morgan
>>        Computational Biology / Fred Hutchinson Cancer Research Center
>>        1100 Fairview Ave. N.
>>        PO Box 19024 Seattle, WA 98109
>>
>>        Location: Arnold Building M1 B861
>>        Phone: (206) 667-2793
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From benjamin.hofner at imbe.med.uni-erlangen.de  Wed Aug 26 23:05:16 2009
From: benjamin.hofner at imbe.med.uni-erlangen.de (benjamin.hofner at imbe.med.uni-erlangen.de)
Date: Wed, 26 Aug 2009 23:05:16 +0200 (CEST)
Subject: [Rd] Errors in manpage of bs() (splines) (PR#13912)
Message-ID: <20090826210516.8841E282EFC9@mail.pubhealth.ku.dk>

Full_Name: Benjamin Hofner
Version: 2.9.1
OS: Ubuntu
Submission from: (NULL) (92.229.82.215)


Hi

I found some mistakes in the documentation of function bs() in package splines
(I use R 2.9.1 but it also holds for the latest SVN Version
https://svn.r-project.org/R/trunk/src/library/splines/man/bs.Rd)

-----------------------------

\item{df}{degrees of freedom; one can specify \code{df} rather than
\code{knots}; \code{bs()} then chooses \code{df-degree-1} knots at
suitable quantiles of \code{x} (which will ignore missing values).}

This should read (or similar):

\item{df}{degrees of freedom; one can specify \code{df} rather than
\code{knots}; \code{bs()} then chooses \code{df-degree-as.numeric(intercept)}
knots at
suitable quantiles of \code{x} (which will ignore missing values).}

The problem here is: we only subtract 1 if we use an intercept! Probably this
becomes more readable if one uses a construction as e.g. \code{df-degree-1} if
\code{intercept=TRUE} and \code{df-degree} if \code{FALSE}.

-----------------------------

The next problematic part is:

A matrix of dimension \code{length(x) * df}, where either \code{df}
was supplied or if \code{knots} were supplied,
\code{df = length(knots) + 3 + intercept}. 	

This should read (or similar):

A matrix of dimension \code{length(x) * df}, where either \code{df}
was supplied or if \code{knots} were supplied,
\code{df = length(knots) + degree + as.numeric(intercept)}. 	

Always adding 3 is not suitable. Furthermore the "+ intercept" is not very
clear. Another issue is the dimension of the matrix: I would rather suggest to
write it in LaTeX style "length(x) \times df".

-----------------------------

I hope this helps to improve the docs a bit.
Cheers,
  Benjamin


From maechler at stat.math.ethz.ch  Thu Aug 27 12:18:28 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 27 Aug 2009 12:18:28 +0200
Subject: [Rd] c(<symbol>, <symbol) |-> expression instead of list
In-Reply-To: <19094.17411.805111.923613@lynne.math.ethz.ch>
References: <1251232240.5919.5.camel@ubuntu.une.net.co>
	<0366B624-A934-4949-98FF-3EAE569C95EC@comcast.net>
	<6F4FD737-25F9-4DE6-98AA-F4185BC34650@comcast.net>
	<1251239164.5919.7.camel@ubuntu.une.net.co>
	<19094.17411.805111.923613@lynne.math.ethz.ch>
Message-ID: <19094.23924.888966.900424@lynne.math.ethz.ch>

Dear programmeRs,

I'm proposing and looking into implementing a small change in
R's  c() handling of 'symbol's aka 'name's, and potentially also
'language' parts.

The main motivation is transparent programmatic construction of
expression()s;  and important use cases are expressions used for
"plot math", typically in 
        axis(.., labels = *)   
or    legend(.., legend = *)

[BTW, Paul,  in  grid.legend(*, labels = *),  labels is *not*
 allowed to be an expression]

Look at this code snippet {where the comments include the
results you see} :

e <- expression(a, gamma, nu == 50, x^2 == 3.14, y <- 17, { x[i] <- sin(y^2 + exp(u[i])) })
length(e)
## 6
## Ok, what are the components like ?
##
sapply(e, is.language)
## [1] TRUE TRUE TRUE TRUE TRUE TRUE
## aha, all are  "language",
##
## and specifically :
sapply(e, typeof)
##[1] "symbol"   "symbol"   "language" "language"   "language" "language"
## or in ``S - compatible'' language  {but S+ slightly differs here}:
sapply(e, mode)
##[1] "name" "name" "call" "call" "call" "call"
sapply(e, class)
##[1] "name" "name" "call" "call" "<-"   "{"

Now, in "plotmath" situations,
you'd often want the '50' , '3.14' or '17'  be the content of
other R variables, and so we need  substitute()  or  bquote(),
and these directly result in "name" or "language" objects :

However, you cannot very easily concatenate them to an
expression:

z <- c(88, 143)
(e1 <- substitute(x[1]^2 == v, list(v = z[1])))
(e2 <- bquote(pi / r[i]^2 == .(z[2])))

## However,
c(e1, e2)  ## is a list, not an expression ...
## but 
plot(1, type="n")
legend("top",    legend= c(e1,e2)) ## is ugly (no super/sub scripts ...)
legend("center", legend=
       c(as.expression(e1),
         as.expression(e2)))# works but is a bit cumbersome

-------------

So now, my proposition is to make the  "as.expression()"
implicit in  c(),
since the  help file for c() does mention that

>      The output type is determined from the highest type of the
>      components in the hierarchy NULL < raw < logical < integer < real
>      < complex < character < list < expression. .....

and implicitly,  "symbol" and "language" are treated  by as.list()
rather than as expression-like.

I would like to change this, i.e.,  c() should  result in
"expression" rather than "list"  when it's applied to symbola
and language types.

Note that S-plus 8.0.4, and 3.4 does this very differently
anyway.

Martin Maechler, ETH Zurich


From ggrothendieck at gmail.com  Thu Aug 27 13:32:42 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 27 Aug 2009 07:32:42 -0400
Subject: [Rd] c(<symbol>, <symbol) |-> expression instead of list
In-Reply-To: <19094.23924.888966.900424@lynne.math.ethz.ch>
References: <1251232240.5919.5.camel@ubuntu.une.net.co>
	<0366B624-A934-4949-98FF-3EAE569C95EC@comcast.net> 
	<6F4FD737-25F9-4DE6-98AA-F4185BC34650@comcast.net>
	<1251239164.5919.7.camel@ubuntu.une.net.co> 
	<19094.17411.805111.923613@lynne.math.ethz.ch>
	<19094.23924.888966.900424@lynne.math.ethz.ch>
Message-ID: <971536df0908270432x69c0daa5oa52d1ee3426c0655@mail.gmail.com>

On Thu, Aug 27, 2009 at 6:18 AM, Martin
Maechler<maechler at stat.math.ethz.ch> wrote:
> Dear programmeRs,
>
> I'm proposing and looking into implementing a small change in
> R's ?c() handling of 'symbol's aka 'name's, and potentially also
> 'language' parts.
>
> The main motivation is transparent programmatic construction of
> expression()s; ?and important use cases are expressions used for
> "plot math", typically in
> ? ? ? ?axis(.., labels = *)
> or ? ?legend(.., legend = *)
>
> [BTW, Paul, ?in ?grid.legend(*, labels = *), ?labels is *not*
> ?allowed to be an expression]
>
> Look at this code snippet {where the comments include the
> results you see} :
>
> e <- expression(a, gamma, nu == 50, x^2 == 3.14, y <- 17, { x[i] <- sin(y^2 + exp(u[i])) })
> length(e)
> ## 6
> ## Ok, what are the components like ?
> ##
> sapply(e, is.language)
> ## [1] TRUE TRUE TRUE TRUE TRUE TRUE
> ## aha, all are ?"language",
> ##
> ## and specifically :
> sapply(e, typeof)
> ##[1] "symbol" ? "symbol" ? "language" "language" ? "language" "language"
> ## or in ``S - compatible'' language ?{but S+ slightly differs here}:
> sapply(e, mode)
> ##[1] "name" "name" "call" "call" "call" "call"
> sapply(e, class)
> ##[1] "name" "name" "call" "call" "<-" ? "{"
>
> Now, in "plotmath" situations,
> you'd often want the '50' , '3.14' or '17' ?be the content of
> other R variables, and so we need ?substitute() ?or ?bquote(),
> and these directly result in "name" or "language" objects :
>
> However, you cannot very easily concatenate them to an
> expression:
>
> z <- c(88, 143)
> (e1 <- substitute(x[1]^2 == v, list(v = z[1])))
> (e2 <- bquote(pi / r[i]^2 == .(z[2])))
>
> ## However,
> c(e1, e2) ?## is a list, not an expression ...

although as.expression(c(e1, e2)) is an expression.

plot(0)
legend("top", as.expression(c(e1, e2)))

in light of which the savings is just one as.expression().

Another possibility would be to add support for
multiple arguments to bquote:

plot(0)
legend("top", bquote(x[1]^2 == .(z[1]), pi / r[i]^2 == .(z[2])))

Then we would not need to use c() in the first place.


From maechler at stat.math.ethz.ch  Thu Aug 27 14:19:50 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 27 Aug 2009 14:19:50 +0200
Subject: [Rd] c(<symbol>, <symbol) |-> expression instead of list
In-Reply-To: <971536df0908270432x69c0daa5oa52d1ee3426c0655@mail.gmail.com>
References: <1251232240.5919.5.camel@ubuntu.une.net.co>
	<0366B624-A934-4949-98FF-3EAE569C95EC@comcast.net>
	<6F4FD737-25F9-4DE6-98AA-F4185BC34650@comcast.net>
	<1251239164.5919.7.camel@ubuntu.une.net.co>
	<19094.17411.805111.923613@lynne.math.ethz.ch>
	<19094.23924.888966.900424@lynne.math.ethz.ch>
	<971536df0908270432x69c0daa5oa52d1ee3426c0655@mail.gmail.com>
Message-ID: <19094.31206.341334.14077@lynne.math.ethz.ch>

>>>>> "GaGr" == Gabor Grothendieck <ggrothendieck at gmail.com>
>>>>>     on Thu, 27 Aug 2009 07:32:42 -0400 writes:

    GaGr> On Thu, Aug 27, 2009 at 6:18 AM, Martin
    GaGr> Maechler<maechler at stat.math.ethz.ch> wrote:
    >> Dear programmeRs,
    >> 
    >> I'm proposing and looking into implementing a small change in
    >> R's ?c() handling of 'symbol's aka 'name's, and potentially also
    >> 'language' parts.
    >> 
    >> The main motivation is transparent programmatic construction of
    >> expression()s; ?and important use cases are expressions used for
    >> "plot math", typically in
    >> ? ? ? ?axis(.., labels = *)
    >> or ? ?legend(.., legend = *)
    >> 
    >> [BTW, Paul, ?in ?grid.legend(*, labels = *), ?labels is *not*
    >> ?allowed to be an expression]
    >> 
    >> Look at this code snippet {where the comments include the
    >> results you see} :
    >> 
    >> e <- expression(a, gamma, nu == 50, x^2 == 3.14, y <- 17, { x[i] <- sin(y^2 + exp(u[i])) })
    >> length(e)
    >> ## 6
    >> ## Ok, what are the components like ?
    >> ##
    >> sapply(e, is.language)
    >> ## [1] TRUE TRUE TRUE TRUE TRUE TRUE
    >> ## aha, all are ?"language",
    >> ##
    >> ## and specifically :
    >> sapply(e, typeof)
    >> ##[1] "symbol" ? "symbol" ? "language" "language" ? "language" "language"
    >> ## or in ``S - compatible'' language ?{but S+ slightly differs here}:
    >> sapply(e, mode)
    >> ##[1] "name" "name" "call" "call" "call" "call"
    >> sapply(e, class)
    >> ##[1] "name" "name" "call" "call" "<-" ? "{"
    >> 
    >> Now, in "plotmath" situations,
    >> you'd often want the '50' , '3.14' or '17' ?be the content of
    >> other R variables, and so we need ?substitute() ?or ?bquote(),
    >> and these directly result in "name" or "language" objects :
    >> 
    >> However, you cannot very easily concatenate them to an
    >> expression:
    >> 
    >> z <- c(88, 143)
    >> (e1 <- substitute(x[1]^2 == v, list(v = z[1])))
    >> (e2 <- bquote(pi / r[i]^2 == .(z[2])))
    >> 
    >> ## However,
    >> c(e1, e2) ?## is a list, not an expression ...

    GaGr> although as.expression(c(e1, e2)) is an expression.

    GaGr> plot(0)
    GaGr> legend("top", as.expression(c(e1, e2)))

    GaGr> in light of which the savings is just one as.expression().

That's correct.
But my main point is that it's unnatural that
an expression is "list-like" with components "language"
and when I use  c() on these language-parts I don't get back the
expression.


    GaGr> Another possibility would be to add support for
    GaGr> multiple arguments to bquote:

    GaGr> plot(0)
    GaGr> legend("top", bquote(x[1]^2 == .(z[1]), pi / r[i]^2 == .(z[2])))

well, that would solve the use case I gave, 
but would actually result in making  bquote() return
*either* a 'language'/'symbol'  *or*  an 'expression';
which is called polymorphic behavior and often can be slightly
confusing/complicating.

    GaGr> Then we would not need to use c() in the first place.

(in that use case, yes)


From ggrothendieck at gmail.com  Thu Aug 27 14:34:09 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 27 Aug 2009 08:34:09 -0400
Subject: [Rd] c(<symbol>, <symbol) |-> expression instead of list
In-Reply-To: <19094.31206.341334.14077@lynne.math.ethz.ch>
References: <1251232240.5919.5.camel@ubuntu.une.net.co>
	<0366B624-A934-4949-98FF-3EAE569C95EC@comcast.net> 
	<6F4FD737-25F9-4DE6-98AA-F4185BC34650@comcast.net>
	<1251239164.5919.7.camel@ubuntu.une.net.co> 
	<19094.17411.805111.923613@lynne.math.ethz.ch>
	<19094.23924.888966.900424@lynne.math.ethz.ch> 
	<971536df0908270432x69c0daa5oa52d1ee3426c0655@mail.gmail.com> 
	<19094.31206.341334.14077@lynne.math.ethz.ch>
Message-ID: <971536df0908270534s615fe80atb5a3ffd959eface4@mail.gmail.com>

On Thu, Aug 27, 2009 at 8:19 AM, Martin
Maechler<maechler at stat.math.ethz.ch> wrote:
>>>>>> "GaGr" == Gabor Grothendieck <ggrothendieck at gmail.com>
>>>>>> ? ? on Thu, 27 Aug 2009 07:32:42 -0400 writes:
>
> ? ?GaGr> On Thu, Aug 27, 2009 at 6:18 AM, Martin
> ? ?GaGr> Maechler<maechler at stat.math.ethz.ch> wrote:
> ? ?>> Dear programmeRs,
> ? ?>>
> ? ?>> I'm proposing and looking into implementing a small change in
> ? ?>> R's ?c() handling of 'symbol's aka 'name's, and potentially also
> ? ?>> 'language' parts.
> ? ?>>
> ? ?>> The main motivation is transparent programmatic construction of
> ? ?>> expression()s; ?and important use cases are expressions used for
> ? ?>> "plot math", typically in
> ? ?>> ? ? ? ?axis(.., labels = *)
> ? ?>> or ? ?legend(.., legend = *)
> ? ?>>
> ? ?>> [BTW, Paul, ?in ?grid.legend(*, labels = *), ?labels is *not*
> ? ?>> ?allowed to be an expression]
> ? ?>>
> ? ?>> Look at this code snippet {where the comments include the
> ? ?>> results you see} :
> ? ?>>
> ? ?>> e <- expression(a, gamma, nu == 50, x^2 == 3.14, y <- 17, { x[i] <- sin(y^2 + exp(u[i])) })
> ? ?>> length(e)
> ? ?>> ## 6
> ? ?>> ## Ok, what are the components like ?
> ? ?>> ##
> ? ?>> sapply(e, is.language)
> ? ?>> ## [1] TRUE TRUE TRUE TRUE TRUE TRUE
> ? ?>> ## aha, all are ?"language",
> ? ?>> ##
> ? ?>> ## and specifically :
> ? ?>> sapply(e, typeof)
> ? ?>> ##[1] "symbol" ? "symbol" ? "language" "language" ? "language" "language"
> ? ?>> ## or in ``S - compatible'' language ?{but S+ slightly differs here}:
> ? ?>> sapply(e, mode)
> ? ?>> ##[1] "name" "name" "call" "call" "call" "call"
> ? ?>> sapply(e, class)
> ? ?>> ##[1] "name" "name" "call" "call" "<-" ? "{"
> ? ?>>
> ? ?>> Now, in "plotmath" situations,
> ? ?>> you'd often want the '50' , '3.14' or '17' ?be the content of
> ? ?>> other R variables, and so we need ?substitute() ?or ?bquote(),
> ? ?>> and these directly result in "name" or "language" objects :
> ? ?>>
> ? ?>> However, you cannot very easily concatenate them to an
> ? ?>> expression:
> ? ?>>
> ? ?>> z <- c(88, 143)
> ? ?>> (e1 <- substitute(x[1]^2 == v, list(v = z[1])))
> ? ?>> (e2 <- bquote(pi / r[i]^2 == .(z[2])))
> ? ?>>
> ? ?>> ## However,
> ? ?>> c(e1, e2) ?## is a list, not an expression ...
>
> ? ?GaGr> although as.expression(c(e1, e2)) is an expression.
>
> ? ?GaGr> plot(0)
> ? ?GaGr> legend("top", as.expression(c(e1, e2)))
>
> ? ?GaGr> in light of which the savings is just one as.expression().
>
> That's correct.
> But my main point is that it's unnatural that
> an expression is "list-like" with components "language"
> and when I use ?c() on these language-parts I don't get back the
> expression.
>
>
> ? ?GaGr> Another possibility would be to add support for
> ? ?GaGr> multiple arguments to bquote:
>
> ? ?GaGr> plot(0)
> ? ?GaGr> legend("top", bquote(x[1]^2 == .(z[1]), pi / r[i]^2 == .(z[2])))
>
> well, that would solve the use case I gave,
> but would actually result in making ?bquote() return
> *either* a 'language'/'symbol' ?*or* ?an 'expression';
> which is called polymorphic behavior and often can be slightly
> confusing/complicating.

But that is already how quote() works, i.e. it can return objects
of different classes so that would not be unexpected.

>
> ? ?GaGr> Then we would not need to use c() in the first place.
>
> (in that use case, yes)
>

Another possibility is to create equote() which would be like a multi-argument
bquote but consistently produces an expression.   That would be more
convenient than writing c(bquote(...), bquote(...))

Note that nothing here prevents the c() enhancement to be done as well.
The two approaches are independent.


From abhibera at gmail.com  Thu Aug 27 15:59:02 2009
From: abhibera at gmail.com (Abhijit Bera)
Date: Thu, 27 Aug 2009 19:29:02 +0530
Subject: [Rd] Clarifications please.
In-Reply-To: <4A95690E.1070806@fhcrc.org>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>
	<6phd46km2gl.fsf@gopher4.fhcrc.org>
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
	<4A95690E.1070806@fhcrc.org>
Message-ID: <fc212e850908270659k192d3b31l22c6d6606bc972a0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090827/492b98ee/attachment.pl>

From jfox at mcmaster.ca  Thu Aug 27 16:15:56 2009
From: jfox at mcmaster.ca (John Fox)
Date: Thu, 27 Aug 2009 10:15:56 -0400
Subject: [Rd] R 2.10.0 devel package check error
Message-ID: <001901ca2720$e4c98810$ae5c9830$@ca>

Dear list members,

I'm getting the following error from R CMD check under Windows only with R
2.10.0 devel:

------------- snip -----------

* installing *source* package 'Rcmdr' ...
** libs
  making DLL ...
gcc -I"c:/R/R-2.10.0dev/include"        -O3 -Wall  -std=gnu99 -c ismdi.c -o
ismdi.o
gcc -shared -s -o Rcmdr.dll tmp.def ismdi.o -lRgraphapp
-Lc:/R/R-2.10.0dev/bin -lR
  ... done
** R
** inst
** help
*** installing help indices
Error in cat("\n<h2><a name=\"", f, "\">-- ", f, " --</a></h2>\n\n", sep =
"",  : 
  object 'outcon' not found
* removing 'C:/eclipse/Rcmdr.Rcheck/Rcmdr'

------------- snip -----------

The package does in fact install properly on this system, including the help
files, and I've been unable to track down the source of the problem.

Version and system information:

------------- snip -----------

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = Under development (unstable)
 major = 2
 minor = 10.0
 year = 2009
 month = 08
 day = 26
 svn rev = 49443
 language = R
 version.string = R version 2.10.0 Under development (unstable) (2009-08-26
r49443)

Windows Vista (build 6002) Service Pack 2

Locale:
LC_COLLATE=English_Canada.1252;LC_CTYPE=English_Canada.1252;LC_MONETARY=Engl
ish_Canada.1252;LC_NUMERIC=C;LC_TIME=English_Canada.1252

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices,
package:utils, package:datasets, package:methods, Autoloads, package:base

------------- snip -----------

The offending package, Rcmdr 2.5-0, is available on R-Forge.

Any help would be appreciated.

Thanks,
 John

------------------------------
John Fox, Professor
Department of Sociology
McMaster University
Hamilton, Ontario, Canada
web: socserv.mcmaster.ca/jfox


From Frederic.Schutz at isb-sib.ch  Thu Aug 27 13:25:16 2009
From: Frederic.Schutz at isb-sib.ch (Frederic.Schutz at isb-sib.ch)
Date: Thu, 27 Aug 2009 13:25:16 +0200 (CEST)
Subject: [Rd] Wishlist: specify the border color of boxes in legend()
	(PR#13913)
Message-ID: <20090827112516.466C42831FEA@mail.pubhealth.ku.dk>

This is a multi-part message in MIME format.
--------------040007030503070307040509
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit

I could not find a way to specify the border color of the boxes drawn in
a legend, so that the legend can match exactly the colors of the actual
plot (e.g. in the case of two superimposed histograms which have
different shading and different borders).

Indeed, the legend function seems to hard code the color "black" for the
borders in this call:

         rect2(left = xt, top = yt + ybox/2, dx = xbox, dy = ybox,
               col = fill, density = density, angle = angle,
                border = "black")

I worked around this by adding a "border" argument to the function
(which defaults to "black"), and changing the call above. It works for
me; I have looked quickly at the rest of the function to see if there
would be a side effect and did not see any (but I haven't checked
carefully).

This could be a useful improvement of the legend() function; in case the
change described above looks usable, I attach two simple diff files (for
the function itself and the manual page).

Cheers,

Fr?d?ric

--------------040007030503070307040509
Content-Type: text/x-patch;
 name="legend.R.diff"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="legend.R.diff"

--- legend.R~	2009-03-20 00:05:18.000000000 +0100
+++ legend.R	2009-08-27 11:52:02.000000000 +0200
@@ -15,8 +15,8 @@
 #  http://www.r-project.org/Licenses/
 
 legend <-
-function(x, y = NULL, legend, fill=NULL, col = par("col"), lty, lwd, pch,
-	 angle = 45, density = NULL, bty = "o", bg = par("bg"),
+function(x, y = NULL, legend, fill=NULL, col = par("col"), border="black",
+         lty, lwd, pch, angle = 45, density = NULL, bty = "o", bg = par("bg"),
          box.lwd = par("lwd"), box.lty = par("lty"), box.col = par("fg"),
 	 pt.bg = NA, cex = 1, pt.cex = cex, pt.lwd = lwd,
 	 xjust = 0, yjust = 1, x.intersp = 1, y.intersp = 1, adj = c(0, 0.5),
@@ -217,7 +217,7 @@
 	    fill <- rep(fill, length.out = n.leg)
 	    rect2(left = xt, top=yt+ybox/2, dx = xbox, dy = ybox,
 		  col = fill,
-		  density = density, angle = angle, border = "black")
+		  density = density, angle = angle, border = border)
 	}
 	xt <- xt + dx.fill
     }

--------------040007030503070307040509
Content-Type: text/x-patch;
 name="legend.Rd.diff"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="legend.Rd.diff"

--- legend.Rd~	2009-03-20 00:05:18.000000000 +0100
+++ legend.Rd	2009-08-27 11:57:28.000000000 +0200
@@ -8,7 +8,7 @@
 \title{Add Legends to Plots}
 \usage{
 legend(x, y = NULL, legend, fill = NULL, col = par("col"),
-       lty, lwd, pch,
+       border="black", lty, lwd, pch,
        angle = 45, density = NULL, bty = "o", bg = par("bg"),
        box.lwd = par("lwd"), box.lty = par("lty"), box.col = par("fg"),
        pt.bg = NA, cex = 1, pt.cex = cex, pt.lwd = lwd,
@@ -34,6 +34,8 @@
     with the specified colors (or shaded in the specified colors)
     to appear beside the legend text.}
   \item{col}{the color of points or lines appearing in the legend.}
+  \item{border}{the border color for the boxes (used only if
+    \code{fill} is specified).}
   \item{lty, lwd}{the line types and widths for lines appearing in the
     legend.  One of these two \emph{must} be specified for line drawing.}
   \item{pch}{the plotting symbols appearing in the legend, either as

--------------040007030503070307040509--


From Frederic.Schutz at isb-sib.ch  Thu Aug 27 13:35:09 2009
From: Frederic.Schutz at isb-sib.ch (Frederic.Schutz at isb-sib.ch)
Date: Thu, 27 Aug 2009 13:35:09 +0200 (CEST)
Subject: [Rd] Backup ( *~ ) files in R 2.9.2 distribution (PR#13914)
Message-ID: <20090827113509.843BA2831FE6@mail.pubhealth.ku.dk>

The R-2.9.2.tar.gz file, when unpacked, contains a small number of files
ending with an "~" -- usually backup files, which should probably not
find their way into an actual release:

schutz at sib-pc45:~/R/upstream/R-2.9.2$ find . -name \*~
./src/library/base/R/eval.R~
./src/library/base/man/expand.grid.Rd~
./src/library/base/man/with.Rd~
./src/library/graphics/R/rect.R~
./src/library/stats/R/mlm.R~
./src/library/utils/R/de.R~
./src/library/utils/man/combn.Rd~
./src/library/stats4/R/mle.R~
./src/library/stats4/man/profile-methods.Rd~

Fr?d?ric


From maechler at stat.math.ethz.ch  Thu Aug 27 17:01:47 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 27 Aug 2009 17:01:47 +0200
Subject: [Rd] Problem with standard generic methods in Matrix package
In-Reply-To: <37353.193.51.130.16.1251272254.squirrel@keo.limsi.fr>
References: <37353.193.51.130.16.1251272254.squirrel@keo.limsi.fr>
Message-ID: <19094.40923.755278.599681@lynne.math.ethz.ch>

Dear Sylvain,

>>>>> "s" == sloiseau  <sloiseau at limsi.fr>
>>>>>     on Wed, 26 Aug 2009 09:37:34 +0200 (CEST) writes:

    s> I have posted this message on r-lang, but it is perhaps more appropriate
    s> on r-devel:

[[ "r-lang"  what's that ???  ]]

    s> ---

    s> Hello,

    s> I'm puzzled by a problem with call to diag(), rowSums(), rownames() on
    s> objects of class "dgtMatrix", created by sparseMatrix() or spMatrix().

    s> I use Matrix 0.999375-30.


    s> The weird thing is that I don't encounter any problem when I use this
    s> functions on the R prompt, or source()-ing a script file; I encounter
    s> problems when the code is in a package, installed with R CMD INSTALL, and
    s> loaded with library().



    s> I have tried to reduce the package to the bare minimum in order to
    s> discover the problem, but it continue even when reduced up to a single

    s> method, no dependency other than Matrix. The method is defined as:


I think it would still be most efficient,
if you  do  'R CMD build <yourpackage>'
and make the   <yourpackage>.tar.gz  file available.

Ideally for every reader of this list, from a "public" URL;
alternatively, send it per e-mail as attachment;
if you use correct MIME type, i.e., one of

application/x-tar
application/x-compressed-tar
application/x-gzip

then the file should *not* be filtered out by the mailing list
software.

Best regards,
Martin Maechler, ETH Zurich  (one of the 'Matrix' authors)

    s> ---

    s> getAdjacentAsSparseMatrix <- function() {

    s> adjacents <- sparseMatrix(i=1:10, j=1:10, x=1:10)

    s> print(class(adjacents));

    s> diagonal <- as.vector(diag(adjacents));

    s> if (any(diagonal != 0)) {

    s> diagonal[diagonal > 1] <- 1;

    s> diag(adjacents) <- diagonal;

    s> }

    s> return(adjacents);

    s> }

    s> ---



    s> And the Depends field in ./DESCRIPTION :



    s> ---

    s> Depends: R (>= 2.5.0), Matrix

    s> ---



    s> I have this outputs:



    s> [1] "dgTMatrix"

    s> Erreur dans y[1L + 0L:(m - 1L) * (n + 1L)] <- x :

    s> types (de S4 a double) incompatibles dans l'ajustement d'affectation de

    s> type

    >> traceback()

    s> 3: diag(adjacents)

    s> 2: as.vector(diag(adjacents))

    s> 1: getAdjacentAsSparseMatrix(white3)



    s> The same thing happens with the method rowSums(), colnames() and
    s> rownames(). In brief, it looks as if the generic functions were called,

    s> and not the overloaded ones. I can't figure out how to fix that, and will
    s> be interested in any pointers.



    s> Best,

    s> Sylvain

    s> ______________________________________________
    s> R-devel at r-project.org mailing list
    s> https://stat.ethz.ch/mailman/listinfo/r-devel


From edd at debian.org  Thu Aug 27 17:43:54 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 27 Aug 2009 10:43:54 -0500
Subject: [Rd] Clarifications please.
In-Reply-To: <fc212e850908270659k192d3b31l22c6d6606bc972a0@mail.gmail.com>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>
	<6phd46km2gl.fsf@gopher4.fhcrc.org>
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
	<4A95690E.1070806@fhcrc.org>
	<fc212e850908270659k192d3b31l22c6d6606bc972a0@mail.gmail.com>
Message-ID: <19094.43450.715424.590651@ron.nulle.part>


Abhijit,

On 27 August 2009 at 19:29, Abhijit Bera wrote:
| Hi Martin
| 
| Sorry, I made a mistake, I wasn't looking at the syntactic correctness of
| your code, I just followed what you suggested.
| 
| Your method is valid when I want to extract data from a class. I was trying
| to get data from a covariance matrix. I'll put up code in my next mail
| showing how to access the different data types using different methods.

Have you looked RInside which covers your use case 

    - accessing an embedded R instance from an outer C++ program
     
    - sending data and/or parameters to R,

    - evaluating R expressesions

    - getting data back from R to the C++ layer

See 

    http://dirk.eddelbuettel.com/code/rinside.html 

for more.  Documentation is still sparse, but there are examples, and the
Rcpp classes are very useful for converting a number of basic R types to and
from C++ representations.

Dirk

-- 
Three out of two people have difficulties with fractions.


From ripley at stats.ox.ac.uk  Thu Aug 27 17:52:30 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 27 Aug 2009 16:52:30 +0100 (BST)
Subject: [Rd] R 2.10.0 devel package check error
In-Reply-To: <001901ca2720$e4c98810$ae5c9830$@ca>
References: <001901ca2720$e4c98810$ae5c9830$@ca>
Message-ID: <alpine.LFD.2.00.0908271643260.13628@gannet.stats.ox.ac.uk>

AFAICS that is already fixed (r49467).

It was a Windows-only problem when building just chm help - I suspect 
the latter did not work in your package.

I should perhaps remind people that R-devel is 'unstable' and as we 
work on the help system it is likely to be particularly unstable on 
Windows (since there are features such as this one that are only 
exercised there).

Reports on R-devel are welcome, but most useful if they are about 
things that have persisted for a few days.

Brian

On Thu, 27 Aug 2009, John Fox wrote:

> Dear list members,
>
> I'm getting the following error from R CMD check under Windows only with R
> 2.10.0 devel:
>
> ------------- snip -----------
>
> * installing *source* package 'Rcmdr' ...
> ** libs
>  making DLL ...
> gcc -I"c:/R/R-2.10.0dev/include"        -O3 -Wall  -std=gnu99 -c ismdi.c -o
> ismdi.o
> gcc -shared -s -o Rcmdr.dll tmp.def ismdi.o -lRgraphapp
> -Lc:/R/R-2.10.0dev/bin -lR
>  ... done
> ** R
> ** inst
> ** help
> *** installing help indices
> Error in cat("\n<h2><a name=\"", f, "\">-- ", f, " --</a></h2>\n\n", sep =
> "",  :
>  object 'outcon' not found
> * removing 'C:/eclipse/Rcmdr.Rcheck/Rcmdr'
>
> ------------- snip -----------
>
> The package does in fact install properly on this system, including the help
> files, and I've been unable to track down the source of the problem.
>
> Version and system information:
>
> ------------- snip -----------
>
> Version:
> platform = i386-pc-mingw32
> arch = i386
> os = mingw32
> system = i386, mingw32
> status = Under development (unstable)
> major = 2
> minor = 10.0
> year = 2009
> month = 08
> day = 26
> svn rev = 49443
> language = R
> version.string = R version 2.10.0 Under development (unstable) (2009-08-26
> r49443)
>
> Windows Vista (build 6002) Service Pack 2
>
> Locale:
> LC_COLLATE=English_Canada.1252;LC_CTYPE=English_Canada.1252;LC_MONETARY=Engl
> ish_Canada.1252;LC_NUMERIC=C;LC_TIME=English_Canada.1252
>
> Search Path:
> .GlobalEnv, package:stats, package:graphics, package:grDevices,
> package:utils, package:datasets, package:methods, Autoloads, package:base
>
> ------------- snip -----------
>
> The offending package, Rcmdr 2.5-0, is available on R-Forge.
>
> Any help would be appreciated.
>
> Thanks,
> John
>
> ------------------------------
> John Fox, Professor
> Department of Sociology
> McMaster University
> Hamilton, Ontario, Canada
> web: socserv.mcmaster.ca/jfox
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sloiseau at ens-lsh.fr  Thu Aug 27 18:06:50 2009
From: sloiseau at ens-lsh.fr (Sylvain Loiseau)
Date: Thu, 27 Aug 2009 18:06:50 +0200
Subject: [Rd] Problem with standard generic methods in Matrix package
In-Reply-To: <19094.40923.755278.599681@lynne.math.ethz.ch>
References: <37353.193.51.130.16.1251272254.squirrel@keo.limsi.fr>
	<19094.40923.755278.599681@lynne.math.ethz.ch>
Message-ID: <op.uzbvvll7ke9egf@l017892.intranet.ens-lsh.fr>

Hello,

> I think it would still be most efficient,
> if you  do  'R CMD build <yourpackage>'
> and make the   <yourpackage>.tar.gz  file available.
>
> Ideally for every reader of this list, from a "public" URL;
> alternatively, send it per e-mail as attachment;
> if you use correct MIME type, i.e., one of

Ok, here is the minimal package producing the error :

http://panini.u-paris10.fr/~sloiseau/test_1.0.tar.gz

I have :

library(test)
> getAdjacentAsSparseMatrix()
[1] "dgCMatrix"
attr(,"package")
[1] "Matrix"
Erreur dans y[1L + 0L:(m - 1L) * (n + 1L)] <- x :
    types (de S4 a double) incompatibles dans l'ajustement d'affectation de
type

Thanks!
Sylvain

-- 
Sylvain Loiseau
sloiseau at ens-lsh.fr


From jfox at mcmaster.ca  Thu Aug 27 18:12:31 2009
From: jfox at mcmaster.ca (John Fox)
Date: Thu, 27 Aug 2009 12:12:31 -0400
Subject: [Rd] R 2.10.0 devel package check error
In-Reply-To: <alpine.LFD.2.00.0908271643260.13628@gannet.stats.ox.ac.uk>
References: <001901ca2720$e4c98810$ae5c9830$@ca>
	<alpine.LFD.2.00.0908271643260.13628@gannet.stats.ox.ac.uk>
Message-ID: <002901ca2731$2e349840$8a9dc8c0$@ca>

Dear Brian,

Because this problem surfaced only with the Rcmdr package, and other
packages checked without error, I thought that the problem was in the
package. Also R CMD INSTALL Rcmdr built the chm help pages correctly, as far
as I can see.

Anyway, I'll try again in a few days.

Thank you for the information (and the admonishment).

John


> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
> Sent: August-27-09 11:53 AM
> To: John Fox
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] R 2.10.0 devel package check error
> 
> AFAICS that is already fixed (r49467).
> 
> It was a Windows-only problem when building just chm help - I suspect
> the latter did not work in your package.
> 
> I should perhaps remind people that R-devel is 'unstable' and as we
> work on the help system it is likely to be particularly unstable on
> Windows (since there are features such as this one that are only
> exercised there).
> 
> Reports on R-devel are welcome, but most useful if they are about
> things that have persisted for a few days.
> 
> Brian
> 
> On Thu, 27 Aug 2009, John Fox wrote:
> 
> > Dear list members,
> >
> > I'm getting the following error from R CMD check under Windows only with
R
> > 2.10.0 devel:
> >
> > ------------- snip -----------
> >
> > * installing *source* package 'Rcmdr' ...
> > ** libs
> >  making DLL ...
> > gcc -I"c:/R/R-2.10.0dev/include"        -O3 -Wall  -std=gnu99 -c ismdi.c
-o
> > ismdi.o
> > gcc -shared -s -o Rcmdr.dll tmp.def ismdi.o -lRgraphapp
> > -Lc:/R/R-2.10.0dev/bin -lR
> >  ... done
> > ** R
> > ** inst
> > ** help
> > *** installing help indices
> > Error in cat("\n<h2><a name=\"", f, "\">-- ", f, " --</a></h2>\n\n", sep
=
> > "",  :
> >  object 'outcon' not found
> > * removing 'C:/eclipse/Rcmdr.Rcheck/Rcmdr'
> >
> > ------------- snip -----------
> >
> > The package does in fact install properly on this system, including the
> help
> > files, and I've been unable to track down the source of the problem.
> >
> > Version and system information:
> >
> > ------------- snip -----------
> >
> > Version:
> > platform = i386-pc-mingw32
> > arch = i386
> > os = mingw32
> > system = i386, mingw32
> > status = Under development (unstable)
> > major = 2
> > minor = 10.0
> > year = 2009
> > month = 08
> > day = 26
> > svn rev = 49443
> > language = R
> > version.string = R version 2.10.0 Under development (unstable)
(2009-08-26
> > r49443)
> >
> > Windows Vista (build 6002) Service Pack 2
> >
> > Locale:
> >
>
LC_COLLATE=English_Canada.1252;LC_CTYPE=English_Canada.1252;LC_MONETARY=Engl
> > ish_Canada.1252;LC_NUMERIC=C;LC_TIME=English_Canada.1252
> >
> > Search Path:
> > .GlobalEnv, package:stats, package:graphics, package:grDevices,
> > package:utils, package:datasets, package:methods, Autoloads,
package:base
> >
> > ------------- snip -----------
> >
> > The offending package, Rcmdr 2.5-0, is available on R-Forge.
> >
> > Any help would be appreciated.
> >
> > Thanks,
> > John
> >
> > ------------------------------
> > John Fox, Professor
> > Department of Sociology
> > McMaster University
> > Hamilton, Ontario, Canada
> > web: socserv.mcmaster.ca/jfox
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jonathan at greenbriardrive.com  Thu Aug 27 23:37:52 2009
From: jonathan at greenbriardrive.com (Jonathan Wilner)
Date: Thu, 27 Aug 2009 16:37:52 -0500 (CDT)
Subject: [Rd] ARM v7/Linux Port/cross-compile?
In-Reply-To: <4818382.101251409018844.JavaMail.SMLJWILNER1$@SMLJWILNER1>
Message-ID: <21294625.121251409071927.JavaMail.SMLJWILNER1$@SMLJWILNER1>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090827/322a2f90/attachment.pl>

From simon.urbanek at r-project.org  Fri Aug 28 00:36:38 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 27 Aug 2009 18:36:38 -0400
Subject: [Rd] ARM v7/Linux Port/cross-compile?
In-Reply-To: <21294625.121251409071927.JavaMail.SMLJWILNER1$@SMLJWILNER1>
References: <21294625.121251409071927.JavaMail.SMLJWILNER1$@SMLJWILNER1>
Message-ID: <A5DA4C50-9D36-4C77-8D40-AEE632FBD939@r-project.org>


On Aug 27, 2009, at 5:37 PM, Jonathan Wilner wrote:

> Hi,
>
> Has anyone succeeded in cross-compiling R to Linux on an ARM CPU?

Yes (although that questions leaves a lot of room for interpretation).


> If so, can you share a little about your toolchain & build process?
>

It was fairly straight-forward to build R (like any other cross- 
compilation). The tricky part is to install packages (if you are truly  
cross-compiling on another architecture) which I solved by using multi- 
arch R (which contains both arm and the host architecture) and cross- 
compiling only the binaries (i.e. only packages with native code).  
That could probably be simplified, but I didn't have the time to do  
that.

Cheers,
Simon


From gjh27 at cornell.edu  Fri Aug 28 03:12:48 2009
From: gjh27 at cornell.edu (Giles Hooker)
Date: Thu, 27 Aug 2009 21:12:48 -0400
Subject: [Rd] R CMD check does not recognize S4 functions inside other
	functions?
Message-ID: <4A972F10.6020606@cornell.edu>

I am developing a new R package and am now checking it for submission to
CRAN.

The some functions in the package make use of the sparse matrix routines
in the package 'Matrix'.

When these are loaded in R, they create no problems.

However, when running R CMD check, I run into the following error in 
executing the examples in a .rd file:

 >   DD = Matrix(diag(1,200),sparse=TRUE)
 >   tDD = t(DD)
 >
 > fres = FitMatchOpt(coefs=coefs,which=2,pars=pars,proc)
Error in t.default(DD) : argument is not a matrix
Calls: FitMatchOpt -> t -> t.default
Execution halted

The first two lines of the function FitMatchOpt are

   DD = Matrix(diag(1,200),sparse=TRUE)
   tDD = t(DD)

These were fine when given in the examples section of the .rd file 
directly. However, when defined within a function in the package, the 
lines cause an error.

Sparse matrices improve the computational efficiency of the routines I 
am developing and I would like to use them. But I'm not sure how I can 
get around this error.

Many thanks,

Giles Hooker


From sloiseau at ens-lsh.fr  Fri Aug 28 09:10:03 2009
From: sloiseau at ens-lsh.fr (Sylvain Loiseau)
Date: Fri, 28 Aug 2009 09:10:03 +0200
Subject: [Rd] R CMD check does not recognize S4 functions inside other
 functions?
In-Reply-To: <4A972F10.6020606@cornell.edu>
References: <4A972F10.6020606@cornell.edu>
Message-ID: <op.uzc161yf67e68g@l017892.intranet.ens-lsh.fr>

It looks as if it is very related to the message I posted just some day  
ago ("Problem with standard generic methods in Matrix package").

Sylvain

On Fri, 28 Aug 2009 03:12:48 +0200, Giles Hooker <gjh27 at cornell.edu> wrote:

> I am developing a new R package and am now checking it for submission to
> CRAN.
>
> The some functions in the package make use of the sparse matrix routines
> in the package 'Matrix'.
>
> When these are loaded in R, they create no problems.
>
> However, when running R CMD check, I run into the following error in  
> executing the examples in a .rd file:
>
>  >   DD = Matrix(diag(1,200),sparse=TRUE)
>  >   tDD = t(DD)
>  >
>  > fres = FitMatchOpt(coefs=coefs,which=2,pars=pars,proc)
> Error in t.default(DD) : argument is not a matrix
> Calls: FitMatchOpt -> t -> t.default
> Execution halted
>
> The first two lines of the function FitMatchOpt are
>
>    DD = Matrix(diag(1,200),sparse=TRUE)
>    tDD = t(DD)
>
> These were fine when given in the examples section of the .rd file  
> directly. However, when defined within a function in the package, the  
> lines cause an error.
>
> Sparse matrices improve the computational efficiency of the routines I  
> am developing and I would like to use them. But I'm not sure how I can  
> get around this error.
>
> Many thanks,
>
> Giles Hooker
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Fri Aug 28 09:58:50 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 28 Aug 2009 09:58:50 +0200
Subject: [Rd] R CMD check does not recognize S4 functions inside other
	functions?
In-Reply-To: <4A972F10.6020606@cornell.edu>
References: <4A972F10.6020606@cornell.edu>
Message-ID: <19095.36410.232192.308326@lynne.math.ethz.ch>

>>>>> "GH" == Giles Hooker <gjh27 at cornell.edu>
>>>>>     on Thu, 27 Aug 2009 21:12:48 -0400 writes:

    GH> I am developing a new R package and am now checking it for submission to
    GH> CRAN.

    GH> The some functions in the package make use of the sparse matrix routines
    GH> in the package 'Matrix'.

    GH> When these are loaded in R, they create no problems.

    GH> However, when running R CMD check, I run into the following error in 
    GH> executing the examples in a .rd file:

    >> DD = Matrix(diag(1,200),sparse=TRUE)
    >> tDD = t(DD)

{{well, the transpose of a diagonal matrix, really ??}}

Just a remark:   For larger values of n=200,
it would be more efficient (and elegant) to directly use

   DD <- Diagonal(200)

See   ?Diagonal,  and e.g.,

  > Diagonal(4)
  4 x 4 diagonal matrix of class "ddiMatrix"
       [,1] [,2] [,3] [,4]
  [1,]    1    .    .    .
  [2,]    .    1    .    .
  [3,]    .    .    1    .
  [4,]    .    .    .    1
  > .symDiagonal(4)
  4 x 4 sparse Matrix of class "dsCMatrix"

  [1,] 1 . . .
  [2,] . 1 . .
  [3,] . . 1 .
  [4,] . . . 1





    >> 
    >> fres = FitMatchOpt(coefs=coefs,which=2,pars=pars,proc)
    GH> Error in t.default(DD) : argument is not a matrix
    GH> Calls: FitMatchOpt -> t -> t.default
    GH> Execution halted

    GH> The first two lines of the function FitMatchOpt are

    GH> DD = Matrix(diag(1,200),sparse=TRUE)
    GH> tDD = t(DD)

    GH> These were fine when given in the examples section of the .rd file 
    GH> directly. However, when defined within a function in the package, the 
    GH> lines cause an error.

How does your package "get Matrix"?

I'm sure there's some problem in requiring Matrix, in either
your DESCRIPTION or your NAMESPACE  (or a .First.library or ...)

Your DESCRIPTION should have

Depends: ...., Matrix
Imports: ...., Matrix

and your NAMESPACE  

either
   importFrom("Matrix", .....)# the things you need

or (if you use many things from the Matrix package, and/or
    in some way just *extend* it ...)

   import("Matrix")



Does that help?

Best regards,
Martin Maechler


    GH> Sparse matrices improve the computational efficiency of the routines I 
    GH> am developing and I would like to use them. But I'm not sure how I can 
    GH> get around this error.

    GH> Many thanks,

    GH> Giles Hooker

    GH> ______________________________________________
    GH> R-devel at r-project.org mailing list
    GH> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Fri Aug 28 10:34:56 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 28 Aug 2009 10:34:56 +0200
Subject: [Rd] Problem with standard generic methods in Matrix package
In-Reply-To: <op.uzbvvll7ke9egf@l017892.intranet.ens-lsh.fr>
References: <37353.193.51.130.16.1251272254.squirrel@keo.limsi.fr>
	<19094.40923.755278.599681@lynne.math.ethz.ch>
	<op.uzbvvll7ke9egf@l017892.intranet.ens-lsh.fr>
Message-ID: <19095.38576.64071.568795@lynne.math.ethz.ch>


>>>>> "SL" == Sylvain Loiseau <sloiseau at ens-lsh.fr>
>>>>>     on Thu, 27 Aug 2009 18:06:50 +0200 writes:

    SL> Hello,
    >> I think it would still be most efficient,
    >> if you  do  'R CMD build <yourpackage>'
    >> and make the   <yourpackage>.tar.gz  file available.
    >> 
    >> Ideally for every reader of this list, from a "public" URL;
    >> alternatively, send it per e-mail as attachment;
    >> if you use correct MIME type, i.e., one of

    SL> Ok, here is the minimal package producing the error :

    SL> http://panini.u-paris10.fr/~sloiseau/test_1.0.tar.gz

    SL> I have :

    SL> library(test)
    >> getAdjacentAsSparseMatrix()
    SL> [1] "dgCMatrix"
    SL> attr(,"package")
    SL> [1] "Matrix"
    SL> Erreur dans y[1L + 0L:(m - 1L) * (n + 1L)] <- x :
    SL> types (de S4 a double) incompatibles dans l'ajustement d'affectation de
    SL> type

Yes, Sylvain, you were right (in the other thread
       "R CMD check does not recognize S4 functions ...")
that your problem is very similar to Giles Hooker's one.

You both need to learn more about namespaces.

As help for you (and other readers),
I append a "fixed up" version (1.0-1) of your test package.

I hope this helps,
Martin Maechler

-------------- next part --------------
A non-text attachment was scrubbed...
Name: test_1.0-1.tar.gz
Type: application/x-compressed-tar
Size: 1246 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090828/cafd31e0/attachment.bin>

From abhibera at gmail.com  Fri Aug 28 13:41:26 2009
From: abhibera at gmail.com (Abhijit Bera)
Date: Fri, 28 Aug 2009 17:11:26 +0530
Subject: [Rd] Clarifications please.
In-Reply-To: <4A95690E.1070806@fhcrc.org>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>
	<6phd46km2gl.fsf@gopher4.fhcrc.org>
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
	<4A95690E.1070806@fhcrc.org>
Message-ID: <fc212e850908280441r7c316b68se9192913e30cdc0d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090828/7b9ccbd6/attachment.pl>

From maechler at stat.math.ethz.ch  Fri Aug 28 14:35:27 2009
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Fri, 28 Aug 2009 14:35:27 +0200 (CEST)
Subject: [Rd] Wishlist: specify the border color of boxes in legend()
	(PR#13913)
Message-ID: <20090828123527.5A5502832005@mail.pubhealth.ku.dk>


>>>>> "FS" == Frederic Schutz <Frederic.Schutz at isb-sib.ch>
>>>>>     on Thu, 27 Aug 2009 13:25:16 +0200 (CEST) writes:

    FS> I could not find a way to specify the border color of the boxes drawn in
    FS> a legend, so that the legend can match exactly the colors of the actual
    FS> plot (e.g. in the case of two superimposed histograms which have
    FS> different shading and different borders).

    FS> Indeed, the legend function seems to hard code the color "black" for the
    FS> borders in this call:

    FS> rect2(left = xt, top = yt + ybox/2, dx = xbox, dy = ybox,
    FS> col = fill, density = density, angle = angle,
    FS> border = "black")

    FS> I worked around this by adding a "border" argument to the function
    FS> (which defaults to "black"), and changing the call above. It works for
    FS> me; I have looked quickly at the rest of the function to see if there
    FS> would be a side effect and did not see any (but I haven't checked
    FS> carefully).

    FS> This could be a useful improvement of the legend() function; in case the
    FS> change described above looks usable, I attach two simple diff files (for
    FS> the function itself and the manual page).

    FS> Cheers,
    FS> Fr?d?ric

Thank you, Fr?d?ric,
indeed, the changes are so minimal that I will apply the two
patches and they should be in "R-devel" (for R 2.10.0) soon.

Best regards,
Martin Maechler, ETH Zurich


    FS> --------------040007030503070307040509
    FS> Content-Type: text/x-patch;
    FS> name="legend.R.diff"
    FS> Content-Transfer-Encoding: 7bit
    FS> Content-Disposition: inline;
    FS> filename="legend.R.diff"

    FS> --- legend.R~	2009-03-20 00:05:18.000000000 +0100
    FS> +++ legend.R	2009-08-27 11:52:02.000000000 +0200
    FS> @@ -15,8 +15,8 @@
    FS> #  http://www.r-project.org/Licenses/
 
    FS> legend <-
    FS> -function(x, y = NULL, legend, fill=NULL, col = par("col"), lty, lwd, pch,
    FS> -	 angle = 45, density = NULL, bty = "o", bg = par("bg"),
    FS> +function(x, y = NULL, legend, fill=NULL, col = par("col"), border="black",
    FS> +         lty, lwd, pch, angle = 45, density = NULL, bty = "o", bg = par("bg"),
    FS> box.lwd = par("lwd"), box.lty = par("lty"), box.col = par("fg"),
    FS> pt.bg = NA, cex = 1, pt.cex = cex, pt.lwd = lwd,
    FS> xjust = 0, yjust = 1, x.intersp = 1, y.intersp = 1, adj = c(0, 0.5),
    FS> @@ -217,7 +217,7 @@
    FS> fill <- rep(fill, length.out = n.leg)
    FS> rect2(left = xt, top=yt+ybox/2, dx = xbox, dy = ybox,
    FS> col = fill,
    FS> -		  density = density, angle = angle, border = "black")
    FS> +		  density = density, angle = angle, border = border)
    FS> }
    FS> xt <- xt + dx.fill
    FS> }

    FS> --------------040007030503070307040509
    FS> Content-Type: text/x-patch;
    FS> name="legend.Rd.diff"
    FS> Content-Transfer-Encoding: 7bit
    FS> Content-Disposition: inline;
    FS> filename="legend.Rd.diff"

    FS> --- legend.Rd~	2009-03-20 00:05:18.000000000 +0100
    FS> +++ legend.Rd	2009-08-27 11:57:28.000000000 +0200
    FS> @@ -8,7 +8,7 @@
    FS> \title{Add Legends to Plots}
    FS> \usage{
    FS> legend(x, y = NULL, legend, fill = NULL, col = par("col"),
    FS> -       lty, lwd, pch,
    FS> +       border="black", lty, lwd, pch,
    FS> angle = 45, density = NULL, bty = "o", bg = par("bg"),
    FS> box.lwd = par("lwd"), box.lty = par("lty"), box.col = par("fg"),
    FS> pt.bg = NA, cex = 1, pt.cex = cex, pt.lwd = lwd,
    FS> @@ -34,6 +34,8 @@
    FS> with the specified colors (or shaded in the specified colors)
    FS> to appear beside the legend text.}
    FS> \item{col}{the color of points or lines appearing in the legend.}
    FS> +  \item{border}{the border color for the boxes (used only if
    FS> +    \code{fill} is specified).}
    FS> \item{lty, lwd}{the line types and widths for lines appearing in the
    FS> legend.  One of these two \emph{must} be specified for line drawing.}
    FS> \item{pch}{the plotting symbols appearing in the legend, either as

    FS> --------------040007030503070307040509--

    FS> ______________________________________________
    FS> R-devel at r-project.org mailing list
    FS> https://stat.ethz.ch/mailman/listinfo/r-devel


From nilsson.henric at gmail.com  Fri Aug 28 15:18:57 2009
From: nilsson.henric at gmail.com (Henric (Nilsson) Winell)
Date: Fri, 28 Aug 2009 15:18:57 +0200
Subject: [Rd] R CMD check does not recognize S4 functions inside other
 functions?
In-Reply-To: <19095.36410.232192.308326@lynne.math.ethz.ch>
References: <4A972F10.6020606@cornell.edu>
	<19095.36410.232192.308326@lynne.math.ethz.ch>
Message-ID: <4A97D941.9020001@gmail.com>

On 2009-08-28 09:58, Martin Maechler wrote:

>>>>>> "GH" == Giles Hooker <gjh27 at cornell.edu>
>>>>>>     on Thu, 27 Aug 2009 21:12:48 -0400 writes:
> 
>     GH> I am developing a new R package and am now checking it for submission to
>     GH> CRAN.
> 
>     GH> The some functions in the package make use of the sparse matrix routines
>     GH> in the package 'Matrix'.
> 
>     GH> When these are loaded in R, they create no problems.
> 
>     GH> However, when running R CMD check, I run into the following error in 
>     GH> executing the examples in a .rd file:
> 
>     >> DD = Matrix(diag(1,200),sparse=TRUE)
>     >> tDD = t(DD)
> 
> {{well, the transpose of a diagonal matrix, really ??}}
> 
> Just a remark:   For larger values of n=200,
> it would be more efficient (and elegant) to directly use
> 
>    DD <- Diagonal(200)
> 
> See   ?Diagonal,  and e.g.,
> 
>   > Diagonal(4)
>   4 x 4 diagonal matrix of class "ddiMatrix"
>        [,1] [,2] [,3] [,4]
>   [1,]    1    .    .    .
>   [2,]    .    1    .    .
>   [3,]    .    .    1    .
>   [4,]    .    .    .    1
>   > .symDiagonal(4)
>   4 x 4 sparse Matrix of class "dsCMatrix"
> 
>   [1,] 1 . . .
>   [2,] . 1 . .
>   [3,] . . 1 .
>   [4,] . . . 1
> 
> 
> 
> 
> 
>     >> 
>     >> fres = FitMatchOpt(coefs=coefs,which=2,pars=pars,proc)
>     GH> Error in t.default(DD) : argument is not a matrix
>     GH> Calls: FitMatchOpt -> t -> t.default
>     GH> Execution halted
> 
>     GH> The first two lines of the function FitMatchOpt are
> 
>     GH> DD = Matrix(diag(1,200),sparse=TRUE)
>     GH> tDD = t(DD)
> 
>     GH> These were fine when given in the examples section of the .rd file 
>     GH> directly. However, when defined within a function in the package, the 
>     GH> lines cause an error.
> 
> How does your package "get Matrix"?
> 
> I'm sure there's some problem in requiring Matrix, in either
> your DESCRIPTION or your NAMESPACE  (or a .First.library or ...)
> 
> Your DESCRIPTION should have
> 
> Depends: ...., Matrix
> Imports: ...., Matrix

Can you please clarify the simultaneous use of `Depends:' and `Imports'. 
The Writing R Extensions manual explicitly says that:

"Packages declared in the 'Depends' field should not also be in the 
'Imports' field."


Thanks,
Henric



> 
> and your NAMESPACE  
> 
> either
>    importFrom("Matrix", .....)# the things you need
> 
> or (if you use many things from the Matrix package, and/or
>     in some way just *extend* it ...)
> 
>    import("Matrix")
> 
> 
> 
> Does that help?
> 
> Best regards,
> Martin Maechler
> 
> 
>     GH> Sparse matrices improve the computational efficiency of the routines I 
>     GH> am developing and I would like to use them. But I'm not sure how I can 
>     GH> get around this error.
> 
>     GH> Many thanks,
> 
>     GH> Giles Hooker
> 
>     GH> ______________________________________________
>     GH> R-devel at r-project.org mailing list
>     GH> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From simon.urbanek at r-project.org  Fri Aug 28 15:19:15 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 28 Aug 2009 09:19:15 -0400
Subject: [Rd] Clarifications please.
In-Reply-To: <fc212e850908280441r7c316b68se9192913e30cdc0d@mail.gmail.com>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>
	<6phd46km2gl.fsf@gopher4.fhcrc.org>
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
	<4A95690E.1070806@fhcrc.org>
	<fc212e850908280441r7c316b68se9192913e30cdc0d@mail.gmail.com>
Message-ID: <E2BDA7E3-D753-4CA9-AB3B-A36755AFCEA0@r-project.org>


On Aug 28, 2009, at 7:41 AM, Abhijit Bera wrote:

> Hi Martin
>
> Here's the code. I'm stuck at one point. I cannot figure out how to  
> print
> the dimnames. I've commented it in my code:
>
> int main (int argc, char** argv) {
>
>    SEXP e,t1,t2,val;
>    int errorOccurred,nx,ny,i,j;
>    double *v;
>    char x[1024],y[1024];
>
>    Rf_initEmbeddedR(argc, argv);
>
>    PROTECT(e = lang2(install("library"), mkString("fPortfolio")));
>    R_tryEval(e, R_GlobalEnv, NULL);
>    UNPROTECT(1);
>
>
>    PROTECT(e = lang2(install("as.matrix"),install("SWX.RET")));
>    PROTECT(t1 = (R_tryEval(e, NULL, &errorOccurred)));
>
>    v=REAL(t1);
>
>    PROTECT(t2=getAttrib(t1,R_DimSymbol));
>

FWIW no need to protect it - t1 is already protected and even more so  
you are blowing t2 away two lines later anyway ...


>    nx=INTEGER(t2)[0];
>    ny=INTEGER(t2)[1];
>
>    PROTECT(t2=getAttrib(t1,R_DimNamesSymbol));
>

Again, no need to protect - you have protected t1 already ...


>    // I'm getting stuck here.
>   // I want to print out the dimnames
>   // so that I can get the dates for the timeseries object.
>    strcpy(x,(CHAR(VECTOR_ELT(t2,0))[0]));

Please read docs about character vectors - what you probably meant is  
something like
const char *x = CHAR(STRING_ELT(VECTOR_ELT(t2,0), 0));
printf("dim 1 = (%s, ...)\n", x);

Cheers,
Simon



>    strcpy(y,(CHAR(VECTOR_ELT(t2,1))[0]));
>
>    printf("%d * %d\n  %s %s \n Matrix:\n",nx,ny,x,y);
>
>    // The matrix is stored in column major order so
>    // we print it in this manner.
>    // my previous code was incorrect.
>    for(i=0;i<nx;i++,j++) {
>
>        for(j=0;j<ny;j++)
>         printf("%f ",v[i+(j*ny)]);
>
>        printf("\n");
>
>    }
>
>    //UNPROTECT(3);
>
>    return 0;
>
> }
>
> On Wed, Aug 26, 2009 at 10:25 PM, Martin Morgan <mtmorgan at fhcrc.org>  
> wrote:
>
>> Hi Abhijit --
>>
>> Abhijit Bera wrote:
>>> Hi Martin
>>>
>>> Thanks. I think I got it! Read the R extensions documentation  
>>> again. I
>>> don't even need to convert to a list. This is what I did (just a  
>>> demo):
>>>
>>> #include <R.h>
>>> #include <Rinternals.h>
>>> #include <Rdefines.h>
>>> #include <Rembedded.h>
>>>
>>> int main (int argc, char** argv)  {
>>>
>>>    SEXP e,t1,t2,val;
>>>    int errorOccurred,nx,ny,i,j;
>>>    double *v;
>>>
>>>    Rf_initEmbeddedR(argc, argv);
>>>
>>>    PROTECT(e = lang2(install("library"), mkString("fPortfolio")));
>>>    R_tryEval(e, R_GlobalEnv, NULL);
>>>    UNPROTECT(1);
>>>
>>>    /* We try to evaluate the R expression:
>>>    *  round(cov(100 * SWX.RET), digits = 4)
>>>    *  we shall split it as:
>>>    *  t1<-100*SWX.RET
>>>    *  t2<-cov(t1)
>>>    *  val<-round(t2,4)
>>>    */
>>>
>>>    PROTECT(e = lang3(install("*"),ScalarInteger(100),
>> install("SWX.RET")));
>>>    PROTECT(t1 = (R_tryEval(e, NULL, &errorOccurred)));
>>
>> For what it's worth, and realizing that this is sloppiness in my
>> original code, ScalarInteger(100) (and mkString("fPortfolio"))  
>> returns
>> an unprotected SEXP, so it could in principle be garbage collected  
>> while
>> lang3 is being evaluated...
>>
>>>
>>>    PROTECT(e = lang2(install("cov"),t1));
>>>    PROTECT(t2 = (R_tryEval(e, NULL, &errorOccurred)));
>>>
>>>    PROTECT(e = lang3(install("round"),t2, ScalarInteger(4)));
>>>    PROTECT(val = (R_tryEval(e, NULL, &errorOccurred)));
>>>
>>>    Rf_PrintValue(val);
>>>
>>>   /* This isn't required, is extraneous.
>>>    PROTECT(e = lang2(install("as.list"),val));
>>>    PROTECT(t2 = (R_tryEval(e, NULL, &errorOccurred)));
>>>
>>>    Rf_PrintValue(t2);*/
>>
>> the reason I recommended using as.list (for example) was to respect  
>> the
>> implied abstraction between the object (of class 'timeSeries') and  
>> it's
>> representation. Apparently there is a method as.list.timeSeries,  
>> and a
>> list is something that I am allowed to know about. Your code below
>> works, but doesn't respect the (R-level) abstraction the class author
>> wants. I don't know whether this is regular practice in the R  
>> community,
>> but it seems like the right thing to do.
>>
>> Martin
>>
>>>
>>>    v=REAL(val);
>>>
>>>    PROTECT(t2=getAttrib(val,R_DimSymbol));
>>>
>>>    nx=INTEGER(t2)[0];
>>>    ny=INTEGER(t2)[1];
>>>
>>>    /* Just printing out the matrix
>>>   *  To understand how I can convert
>>>   *  data types b/w R and C
>>>   */
>>>
>>>    printf("Matrix:\n");
>>>
>>>    for(i=0,j=0;i<(nx*ny);i++,j++) {
>>>
>>>        printf("%.4f ",v[i]);
>>>
>>>        if(j==ny-1) {
>>>            printf("\n");
>>>            j=0;
>>>        }
>>>
>>>    }
>>>
>>>    UNPROTECT(6);
>>>
>>>    return 0;
>>>
>>> }
>>>
>>> Regards
>>>
>>> Abhijit Bera
>>>
>>>
>>> On Wed, Aug 26, 2009 at 12:37 PM, Abhijit Bera <abhibera at gmail.com
>>> <mailto:abhibera at gmail.com>> wrote:
>>>
>>>    Hi Martin
>>>
>>>    Thanks. I think I got the hang of it. I will try it out and  
>>> post any
>>>    more queries I have regarding handling data types onto the  
>>> mailing
>> list.
>>>
>>>    Regards
>>>
>>>    Abhijit Bera
>>>
>>>
>>>    On Tue, Aug 25, 2009 at 7:15 PM, Martin Morgan  
>>> <mtmorgan at fhcrc.org
>>>    <mailto:mtmorgan at fhcrc.org>> wrote:
>>>
>>>        Abhijit Bera <abhibera at gmail.com <mailto:abhibera at gmail.com>>
>>>        writes:
>>>
>>>> Hi
>>>>
>>>> I think I have asked these questions earlier, but I been able
>>>        to find
>>>> answers from the documentation (which I found poorly written
>>>        in several
>>>> places). Will someone be kind enough to give me answers and
>>>        enlighten me?
>>>> (as in explain with CODE?)
>>>>
>>>> I want to embed R in my application and use the fPortfolio
>>>        package for
>>>> carrying out risk management computations. Right now I'm
>>>        reading the
>>>> Rmetrics Ebook and trying to convert the various examples into
>>>        embedded C
>>>> code.
>>>>
>>>> Coming from a strictly C background, I have slight difficulty
>> in
>>>> comprehending a functional language like R and it gets worse
>>>        when I try to
>>>> embed R into a procedural language like C. So here is a list
>>>        of my doubts:
>>>>
>>>> 1) I am very confused on how the lang 1 2 3 4 ... set of
>>>        functions work. I
>>>> haven't found any relevant documentation explaining it
>>>        clearly. I have a
>>>> vague idea but still I cannot understand how I would evaluate
>> an R
>>>> expression like Covariance <- round(cov(100 * SWX.RET), digits
>>>        = 4) using
>>>> lang, install and R_tryEval.
>>>
>>>        unroll this as
>>>
>>>         tmp0 <- 100 * SWX.RET
>>>         tmp1 <- cov(tmp0)
>>>         result <- round(tmp2, 4L)
>>>
>>>        so (untested)
>>>
>>>         PROTECT(expr =
>>>           lang3(install("*"), scalarNumeric(100),  
>>> install("SWX.RET")));
>>>         PROTECT(tmp0 = tryEval(expr, R_GlobalEnv, &errorOccurred));
>>>         if (errorOccurred)
>>>           exit(1);
>>>
>>>         PROTECT(expr = lang2(install("cov"), tmp0));
>>>         PROTECT(tmp1 = tryEval(expr, R_GlobalEnv, &errorOccurred));
>>>         if (errorOccurred)
>>>           exit(1);
>>>
>>>         PROTECT(expr = lang3(install("round"), tmp1,  
>>> scalarInteger(4)));
>>>         PROTECT(result = tryEval(expr, R_GlobalEnv,  
>>> &errorOccurred));
>>>         if (errorOccurred)
>>>           exit(1);
>>>
>>>         Rf_PrintValue(result);
>>>         UNPROTECT(6);
>>>
>>>
>>>
>>>> 2) What exactly does install do?
>>>
>>>        creates or locates a symbol in the global symbol table. Every
>> unique
>>>        symbol is recorded and stored in the 'global symbol table'.  
>>> An
>>>        environment is then a mapping between a symbol from this  
>>> table,
>>>        and a
>>>        value unique to the environment. The symbols are being reused
>> across
>>>        environments.
>>>
>>>        In R
>>>
>>>         x <- 10
>>>
>>>        creates a symbol x in the global symbol table, and in the  
>>> global
>>>        environment associates the value 10 with that symbol.
>>>
>>>         env = new.env()
>>>         env$x <- 20
>>>
>>>        uses the same symbol 'x' from the same global symbol table,  
>>> but
>>>        associates the value 20 with it in the environment 'env'.
>>>
>>>        In C
>>>
>>>         install("foo");
>>>
>>>        creates a symbol and returns the appropriate SEXP. And then
>>>
>>>         install("foo")
>>>
>>>        again finds the already-defined symbol and returns the same  
>>> SEXP.
>>>
>>>> 3) I wrote the following code:
>>>>
>>>> #include <Rinternals.h>
>>>> #include <Rembedded.h>
>>>>
>>>> int main (int argc, char** argv) {
>>>>
>>>>    SEXP e,val;
>>>>    int errorOccurred;
>>>>
>>>>    Rf_initEmbeddedR(argc, argv);
>>>>
>>>>    // library("fPortfolio")
>>>>    PROTECT(e = lang2(install("library"),
>>>        mkString("fPortfolio")));
>>>>    R_tryEval(e, R_GlobalEnv, NULL);
>>>>    UNPROTECT(1);
>>>>
>>>>   // colMeans(SWX.RET)
>>>>    PROTECT(e = lang2(install("colMeans"),
>> install("SWX.RET")));
>>>>    val = (R_tryEval(e, NULL, &errorOccurred));
>>>>
>>>>    Rf_PrintValue(val);
>>>>
>>>>    return 0;
>>>>
>>>> }
>>>>
>>>> When I tried :
>>>>
>>>>> mean(SWX.RET)
>>>>
>>>> in the R prompt I got the following output:
>>>>
>>>>         SBI          SPI          SII         LP25
>> LP40
>>>> LP60
>>>> 4.660521e-06 2.153198e-04 2.033869e-04 1.388886e-04
>> 1.349041e-04
>>>> 1.226859e-04
>>>>
>>>>
>>>> However when I replaced colMeans with mean in the C code above
>>>        I got a mean
>>>> of the means (0.0001366410) of all the columns when
>>>        Rf_PrintValue was
>>>> called. Using colMeans gave me the output as shown above. Why
>>>        does this
>>>> happen? How do I get the above output using mean?
>>>
>>>        Guessing a little; I don't know what class SWX.RET is, but
>> perhaps
>>>        there is a method mean.class_of_SWX.RET defined in a  
>>> package that
>> is
>>>        loaded in your R session, but not your C session. In a new  
>>> R I
>> see
>>>
>>>> library(fPortfolio)
>>>> mean(SWX.RET)
>>>        [1] 0.0001366410
>>>
>>>> 4) From the above code segment, how can I deal with the
>>>        SEXPREC val which is
>>>> returned by R_tryEval in the above code and convert it to my
>>>        own local
>>>> vector datatype? How do I access the values of val? val will
>>>        now be a
>>>> timeseries so how do i convert it?
>>>
>>>        Convert it to a 'standard' R object using appropriate R
>>>        functions and
>>>        access it using C, e.g.,
>>>
>>>> lst <- as.list(SWX.RET)
>>>> str(lst)
>>>        List of 6
>>>        $ SBI : num [1:1916] -0.002088 -0.000105 -0.00136 0.000419  
>>> 0 ...
>>>        $ SPI : num [1:1916] -0.03439 -0.01041 0.01212 0.02246  
>>> 0.00211
>> ...
>>>        $ SII : num [1:1916] 1.37e-05 -4.96e-03 3.81e-03 -6.16e-04
>>>        2.38e-03 ...
>>>        $ LP25: num [1:1916] -0.01199 -0.00366 -0.00132 0.00771  
>>> 0.00303
>> ...
>>>        $ LP40: num [1:1916] -0.01801 -0.00584 -0.00164 0.01166  
>>> 0.00457
>> ...
>>>        $ LP60: num [1:1916] -0.02616 -0.00901 -0.0024 0.01706  
>>> 0.00695
>> ...
>>>
>>>        so in C, once I have lst, I could
>>>
>>>         sbi = VECTOR_ELT(lst, 0);
>>>         double *vals = NUMERIC(sbi);
>>>         printf("%f", vals[0]); # -002088
>>>
>>>        Hope that helps, and is not too misleading, I didn't have  
>>> time to
>>>        check carefully.
>>>
>>>        Martin
>>>
>>>> Thanks
>>>>
>>>> Abhijit Bera
>>>>
>>>>      [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org <mailto:R-devel at r-project.org> mailing
>> list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>        --
>>>        Martin Morgan
>>>        Computational Biology / Fred Hutchinson Cancer Research  
>>> Center
>>>        1100 Fairview Ave. N.
>>>        PO Box 19024 Seattle, WA 98109
>>>
>>>        Location: Arnold Building M1 B861
>>>        Phone: (206) 667-2793
>>>
>>>
>>>
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From abhibera at gmail.com  Fri Aug 28 15:42:50 2009
From: abhibera at gmail.com (Abhijit Bera)
Date: Fri, 28 Aug 2009 19:12:50 +0530
Subject: [Rd] Clarifications please.
In-Reply-To: <E2BDA7E3-D753-4CA9-AB3B-A36755AFCEA0@r-project.org>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>
	<6phd46km2gl.fsf@gopher4.fhcrc.org>
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
	<4A95690E.1070806@fhcrc.org>
	<fc212e850908280441r7c316b68se9192913e30cdc0d@mail.gmail.com>
	<E2BDA7E3-D753-4CA9-AB3B-A36755AFCEA0@r-project.org>
Message-ID: <fc212e850908280642j6c75f749p5961130cc5e1d509@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090828/00ae6b0c/attachment.pl>

From abhibera at gmail.com  Fri Aug 28 16:00:53 2009
From: abhibera at gmail.com (Abhijit Bera)
Date: Fri, 28 Aug 2009 19:30:53 +0530
Subject: [Rd] Clarifications please.
In-Reply-To: <fc212e850908280642j6c75f749p5961130cc5e1d509@mail.gmail.com>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>
	<6phd46km2gl.fsf@gopher4.fhcrc.org>
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
	<4A95690E.1070806@fhcrc.org>
	<fc212e850908280441r7c316b68se9192913e30cdc0d@mail.gmail.com>
	<E2BDA7E3-D753-4CA9-AB3B-A36755AFCEA0@r-project.org>
	<fc212e850908280642j6c75f749p5961130cc5e1d509@mail.gmail.com>
Message-ID: <fc212e850908280700o2e1b5a97p3843561b0e0400da@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090828/12070b29/attachment.pl>

From vitosmail at rambler.ru  Fri Aug 28 16:07:31 2009
From: vitosmail at rambler.ru (Vitalie S.)
Date: Fri, 28 Aug 2009 16:07:31 +0200
Subject: [Rd] S4: names stripped during instantiation of grandchildren of
 numeric class
Message-ID: <op.uzdlitwzdacko8@tir-070312.staff.few.eur.nl>


Dear All,

A small inconsistency (it's probably not even a buglet):


> setClass("A", contains="numeric")
[1] "A"
> names(new("A", c(a=23)))
[1] "a"

> setClass("B", contains="A")
[1] "B"
> names(new("B", c(a=23)))
NULL
>

This is exactly that kind of behavior S4 was invented for, you expect  
names to be there, but they are not :(.

If that behavior is left to be, one would have to implement @names  
manually for children of basic pseudo-classes, which is quite an overhead  
given the functionality is already in base R.

Thanks,
Vitalie.


From simon.urbanek at r-project.org  Fri Aug 28 16:10:44 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 28 Aug 2009 10:10:44 -0400
Subject: [Rd] Clarifications please.
In-Reply-To: <fc212e850908280642j6c75f749p5961130cc5e1d509@mail.gmail.com>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>
	<6phd46km2gl.fsf@gopher4.fhcrc.org>
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
	<4A95690E.1070806@fhcrc.org>
	<fc212e850908280441r7c316b68se9192913e30cdc0d@mail.gmail.com>
	<E2BDA7E3-D753-4CA9-AB3B-A36755AFCEA0@r-project.org>
	<fc212e850908280642j6c75f749p5961130cc5e1d509@mail.gmail.com>
Message-ID: <BFC7DAF8-F59E-4901-B79E-3F3BF593DC73@r-project.org>


On Aug 28, 2009, at 9:42 AM, Abhijit Bera wrote:

> Hi Simon
>
> Thanks. All the confusion between CHAR and STRING. First I read this :
>
> http://www1.cuni.cz/~obo/r_surprises.html
>

Uh, oh, that doc confuses things even more and is not really correct  
(well, the author admits that he has no idea, but that doesn't help).  
Ok, so a quick clarification of the world of strings and character  
vectors.

In R speak string vector is a vector containing 0 or more character  
strings (e.g. c("foo","bar")). It is sometimes also called character  
vector, because it is of type and mode "character". In the R C-level  
API string vectors are represented by the type STRSXP and you can use  
LENGTH(), STRING_ELT(x,i) and SET_STRING_ELT(x,i,a) macros on it to  
get the length and get/set elements. The elements are character  
strings which are represented by CHARSXP (this is not a vector in R  
land) and are always read-only.  They can be created using mkChar*()  
functions and the C-level const char* content (\0-terminated for now)  
can be retrieved using CHAR(x).

The author of the above page is confused about mkString - which  
creates a string vector (STRSXP) and mkChar which creates a character  
string (CHARSXP). Essentially mkString(x) is just a shortcut for  
v=allocVector(STRSXP, 1); SET_STRING_ELT(v, 0, mkChar(x)); x; Users in  
R never see CHARSXP directly - it is never used when interfacing  
another function since there are conceptually no scalars in the R  
language.

I hope this helps to sort out the confusion.

Cheers,
Simon


> In the meantime I got your reply. Then I read the documentation and  
> it made sense!
>
> Regards
>
> Abhijit Bera
>
> [..snip, previously posed code omitted ..]


From chalabi at phys.ethz.ch  Fri Aug 28 16:24:29 2009
From: chalabi at phys.ethz.ch (Yohan Chalabi)
Date: Fri, 28 Aug 2009 16:24:29 +0200
Subject: [Rd] S4 Generics and NAMESPACE : justified warning ?
In-Reply-To: <30312_1250600886_4A8AA7B5_30312_581_1_4A8AA986.3040702@fhcrc.org>
References: <20090817135120.16fab862@mimi>
	<30312_1250600886_4A8AA7B5_30312_581_1_4A8AA986.3040702@fhcrc.org>
Message-ID: <20090828162429.32576c07@mimi>

>>>> "MM" == Martin Morgan <mtmorgan at fhcrc.org>
>>>> on Tue, 18 Aug 2009 06:15:50 -0700

Hi Martin,

Thanks for your response.

   MM> Commenting as a user, there's no guarantee that the 'plot'
   MM> generic
   MM> defined in pkgA is derived from graphics::plot via setGeneric;
   MM> pkgA
   MM> could define it's own generic, and one would want to be informed
   MM> of the
   MM> collision.

This shouldn't be a problem because generics keep track of the function
and package used.

setGeneric(plot)
str(getGeneric(plot))

   MM>
   MM> Maintenance of packages that have used simple 'import' to pull
   MM> in all
   MM> dependencies is tedious, but using 'import' in some ways
   MM> undermines
   MM> benefits of name spaces (restricting the symbol lookup table
   MM> to reduce
   MM> the number of symbols and the possibility of name collisions,
   MM> and to
   MM> more carefully isolate code inside the package name space to
   MM> changes in
   MM> imported packages or induced by the user). So I think a 'better
   MM> practice' is to explicitly import just those functions,
   MM> classes, etc
   MM> that are required by the package. Maintenance of such selective
   MM> imports
   MM> is much less tedious, even with complicated package
   MM> dependencies. There
   MM> is an unreleased Bioconductor package to identify specific
   MM> imports,
   MM> available for R-2.9.* at


I agree with you that 'importFrom' should be the preferred approach. I
have been using it for some time and I have even wrote my own
functions to automatically generate the NAMESPACE. 


But the drawback is that it makes the dependency with other packages
version specific and can become tricky when one has several such
dependencies.

To make the maintenance of packages easier, I would like to use
the suboptimal 'import' so that I do not need to care about this
NAMESPACE/package version issue. But I cannot do that because of an,
IMO, unjustified warning.

regards,
Yohan

-- 
PhD student
Swiss Federal Institute of Technology
Zurich

www.ethz.ch


From atp at piskorski.com  Fri Aug 28 17:18:53 2009
From: atp at piskorski.com (Andrew Piskorski)
Date: Fri, 28 Aug 2009 11:18:53 -0400
Subject: [Rd] ARM v7/Linux Port/cross-compile?
In-Reply-To: <A5DA4C50-9D36-4C77-8D40-AEE632FBD939@r-project.org>
References: <A5DA4C50-9D36-4C77-8D40-AEE632FBD939@r-project.org>
Message-ID: <20090828151853.GB32127@piskorski.com>

On Thu, Aug 27, 2009 at 06:36:38PM -0400, Simon Urbanek wrote:

> It was fairly straight-forward to build R (like any other cross- 
> compilation). The tricky part is to install packages (if you are truly  
> cross-compiling on another architecture) which I solved by using multi- 
> arch R (which contains both arm and the host architecture) and cross- 
> compiling only the binaries (i.e. only packages with native code).  

Simon, could you provide any links to more detailed info on how you
did that, please?  E.g., how did you detect whether a package contains
binaries (native code) or not?  What exactly is a multi-arch R and how
did you build it?

I often need to build R packages for both x86 32 and 64 bit.
Currently, I build both R and all the packages twice in two entirely
separate directory trees, which is both annoying, and overkill for all
the R-code-only packages.  It sounds like you know a better way...

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From edd at debian.org  Fri Aug 28 17:36:31 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 28 Aug 2009 10:36:31 -0500
Subject: [Rd] Simpler example of embedding R in C++ (Was: Clarifications
	please.)
In-Reply-To: <BFC7DAF8-F59E-4901-B79E-3F3BF593DC73@r-project.org>
References: <fc212e850908250541i16b1918h58187248193b4cbf@mail.gmail.com>
	<6phd46km2gl.fsf@gopher4.fhcrc.org>
	<fc212e850908260007w616bc806wccfe5e89d33b3466@mail.gmail.com>
	<fc212e850908260715u749f0c3dtfd8599477cb7c805@mail.gmail.com>
	<4A95690E.1070806@fhcrc.org>
	<fc212e850908280441r7c316b68se9192913e30cdc0d@mail.gmail.com>
	<E2BDA7E3-D753-4CA9-AB3B-A36755AFCEA0@r-project.org>
	<fc212e850908280642j6c75f749p5961130cc5e1d509@mail.gmail.com>
	<BFC7DAF8-F59E-4901-B79E-3F3BF593DC73@r-project.org>
Message-ID: <19095.63871.980598.801338@ron.nulle.part>


Abhijit,

I think you are making your life harder than you need to.  Consider this
simple C++ program implementing your example (of loading fPortfolio,
converting the data in SWX.RET to a matrix M, exporting M to C++ and showing
its content):


  edd at ron:~/svn/rinside/pkg/inst/examples> cat rinside_test2.cpp
  // -*- mode: C++; c-indent-level: 4; c-basic-offset: 4; -*-
  //
  // Simple example for the repeated r-devel mails by Abhijit Bera
  //
  // Copyright (C) 2009 Dirk Eddelbuettel and GPL'ed 
  
  #include "RInside.h"			// for the embedded R via RInside
  #include "Rcpp.h"			// for the R / Cpp interface used for transfer
  
  int main(int argc, char *argv[]) {
  
      RInside R(argc, argv);		// create an embedded R instance 
      SEXP ans;
  
      std::string txt = "suppressMessages(library(fPortfolio))";
      R.parseEvalQ(txt); 		// load library, no return valueassign matrix M to SEXP variable ans
  
      txt = "M <- as.matrix(SWX.RET); print(head(M)); M";
      R.parseEval(txt, ans); 		// assign matrix M to SEXP variable ans
      RcppMatrix<double> M(ans);	// convert SEXP variable to an RcppMatrix
  
      std::cout << "M has " << M.getDim1() << " rows and " << M.getDim2() << " cols" << std::endl;
  
      R.parseEval("colnames(M)", ans); 	// assign columns names of M to ans
      RcppStringVector cnames(ans);	// and into string vector cnames
  
      for (int i=0; i<M.getDim2(); i++) {
  	std::cout << "Column " << cnames(i) << " in row 42 has " << M(42,i) << std::endl;
      }
  
      exit(0);
  }


Compiling and linking against the RInside (for the embedded R) and Rcpp (for
the type conversion) libraries (using a simple 'make rinside_test2' using an
implicit make rule in the examples/ directory), I get this program:


  edd at ron:~/svn/rinside/pkg/inst/examples> ./rinside_test2
  Package 'sn', 0.4-12 (2009-03-21). Type 'help(SN)' for summary information
  Using the GLPK callable library version 4.37
                    SBI       SPI        SII      LP25      LP40      LP60
  2000-01-04 -0.0020881 -0.034390  1.367e-05 -0.011994 -0.018013 -0.026155
  2000-01-05 -0.0001045 -0.010408 -4.955e-03 -0.003657 -0.005837 -0.009011
  2000-01-06 -0.0013598  0.012119  3.813e-03 -0.001324 -0.001645 -0.002396
  2000-01-07  0.0004186  0.022462 -6.162e-04  0.007715  0.011660  0.017063
  2000-01-10  0.0000000  0.002108  2.381e-03  0.003029  0.004566  0.006948
  2000-01-11 -0.0010468 -0.002774 -2.938e-04 -0.002423 -0.003143 -0.004183
  M has 1916 rows and 6 cols
  Column SBI in row 42 has -0.000848356
  Column SPI in row 42 has 0.0129016
  Column SII in row 42 has -0.000141168
  Column LP25 in row 42 has 0.00261833
  Column LP40 in row 42 has 0.00443192
  Column LP60 in row 42 has 0.00694762
  edd at ron:~/svn/rinside/pkg/inst/examples> 


This took literally a few minutes to put together, given the infrastructure
provided by Rcpp and RInside.

Comments welcome.  I know I still need to enhance the installation
instructions for RInside -- it works out of the box for Debian / Ubuntu on 32
and 64 bit, but another user on FC 64bit alerted me to issues he experienced
which I need to fix.

Hth,  Dirk

-- 
Three out of two people have difficulties with fractions.


From simon.urbanek at r-project.org  Fri Aug 28 17:55:51 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 28 Aug 2009 11:55:51 -0400
Subject: [Rd] ARM v7/Linux Port/cross-compile?
In-Reply-To: <20090828151853.GB32127@piskorski.com>
References: <A5DA4C50-9D36-4C77-8D40-AEE632FBD939@r-project.org>
	<20090828151853.GB32127@piskorski.com>
Message-ID: <2E0C743D-C76A-42EF-84AE-0C5CA5232C90@r-project.org>

On Aug 28, 2009, at 11:18 , Andrew Piskorski wrote:

> On Thu, Aug 27, 2009 at 06:36:38PM -0400, Simon Urbanek wrote:
>
>> It was fairly straight-forward to build R (like any other cross-
>> compilation). The tricky part is to install packages (if you are  
>> truly
>> cross-compiling on another architecture) which I solved by using  
>> multi-
>> arch R (which contains both arm and the host architecture) and cross-
>> compiling only the binaries (i.e. only packages with native code).
>
> Simon, could you provide any links to more detailed info on how you  
> did that, please?  E.g., how did you detect whether a package  
> contains binaries (native code) or not?  What exactly is a multi- 
> arch R and how did you build it?
>

See "R Installation and Administration" (R-admin) section 2.5 Sub- 
architectures.

You can build R that has binaries for both 32-bit and 64-bit simply by  
setting r_arch (we use that for quite a while on OS X to build for  
PPC, Intel - both 32 and 64-bit). Subsequently all packages will be  
build for all architectures by default, so there is nothing you have  
to do (except if the packages uses configure script in which case you  
have to install it subsequently with --libs-only for additional  
architectures - see R-admin 2.5 again. This is easy to spot since the  
installed package will have only one directory in "libs").


> I often need to build R packages for both x86 32 and 64 bit.  
> Currently, I build both R and all the packages twice in two entirely  
> separate directory trees, which is both annoying, and overkill for  
> all the R-code-only packages.  It sounds like you know a better way...
>

Yes, the above :).

Cheers,
Simon


From vitosmail at rambler.ru  Fri Aug 28 18:30:14 2009
From: vitosmail at rambler.ru (vitosmail at rambler.ru)
Date: Fri, 28 Aug 2009 18:30:14 +0200 (CEST)
Subject: [Rd] names<- in data.frame (PR#13916)
Message-ID: <20090828163014.C29302831FF2@mail.pubhealth.ku.dk>

Full_Name: Spinu Vitalie
Version: 2.9.0
OS: Windows
Submission from: (NULL) (130.115.113.15)


In assignment of "zero length" names to data.frame:

> tdf <- data.frame(rbind(c(1, 2), c(1, 2)))
> names(tdf) <- c("", "")
> tdf
  structure(c("1", "1"), class = "AsIs") structure(c("2", "2"), class = "AsIs")
1                                      1                                      2
2                                      1                                      2

For vectors it works nicely:

> tv <- c(1, 2)
> names(tv) <- c("", "")
> tv
    
1 2 




> sessionInfo()
R version 2.9.0 (2009-04-17) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  uti


From jmc at r-project.org  Sat Aug 29 21:24:33 2009
From: jmc at r-project.org (John Chambers)
Date: Sat, 29 Aug 2009 15:24:33 -0400
Subject: [Rd] S4: names stripped during instantiation of grandchildren
 of numeric class
In-Reply-To: <op.uzdlitwzdacko8@tir-070312.staff.few.eur.nl>
References: <op.uzdlitwzdacko8@tir-070312.staff.few.eur.nl>
Message-ID: <4A998071.1030903@r-project.org>



Vitalie S. wrote:
>
> Dear All,
>
> A small inconsistency (it's probably not even a buglet):
>
>
>> setClass("A", contains="numeric")
> [1] "A"
>> names(new("A", c(a=23)))
> [1] "a"
>
>> setClass("B", contains="A")
> [1] "B"
>> names(new("B", c(a=23)))
> NULL
>>
>
> This is exactly that kind of behavior S4 was invented for, you expect 
> names to be there, but they are not :(.
You may expect them but you should not:  the  "names" attribute is not a 
slot of class "numeric".

If  you want names to be explicitly required, you have to say so:

 > setClass("A", contains = "numeric", representation(names = "character"))
[1] "A"
 > names(new("A", c(a=23)))
[1] "a"
 > setClass("B", contains="A")
[1] "B"
 > names(new("B", c(a=23)))
[1] "a"

Having said all that, the treatment of "names" is very special and 
buried deep down in the implementation.  While simple treatment of names 
as a slot should work in most cases, it's unlikely that behavior will be 
100% as expected.

Also, the reason you sometimes got  names without specifying them as a 
slot is that the low-level code that assigns names (or other attributes) 
does not check that the S4 class definition has a corresponding slot.  
So the names in the non-S4 vector used as the data part are left in 
place, rather than say producing a warning or error.
>
> If that behavior is left to be, one would have to implement @names 
> manually for children of basic pseudo-classes, which is quite an 
> overhead given the functionality is already in base R.
>
> Thanks,
> Vitalie.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From claus.henry at gmx.de  Sat Aug 29 09:35:11 2009
From: claus.henry at gmx.de (claus.henry at gmx.de)
Date: Sat, 29 Aug 2009 09:35:11 +0200 (CEST)
Subject: [Rd] round off errors? (PR#13918)
Message-ID: <20090829073511.11D28282EF4D@mail.pubhealth.ku.dk>

Full_Name: Claus Pastor
Version: 2.9.2
OS: Windows XP
Submission from: (NULL) (82.113.106.4)


I use the following function to compute MutualInformation Matrix of factorial
members of a dataframe. I use package minet for this:

my.MI = function(test) {
## die Diagonale gibt die Entropien, Teile durch entropy von y und du erh?lst
den Zusammenhang
## kenne X und sage daraus y voraus
	require(minet)
	MI.matrix = matrix(0,nrow=length(test),ncol=length(test),dimnames=list(names(test),names(test)))
	for (i in 1:length(test)) {
		for (j in 1:length(test)) {
			temp = na.omit(test[,c(i,j)])
			MI = build.mim(temp)
			p.i = prop.table(table(temp[,1]))
			p.j = prop.table(table(temp[,2]))
			H.i = sum(-p.i*log(p.i))
			H.j = sum(-p.j*log(p.j))
			MI.matrix[i,j] = MI[1,2]/H.j
			MI.matrix[j,i] = MI[1,2]/H.i
		}
	}
	return(MI.matrix)
}


The function works well under R 2.8.

Under R2.9.2 it produces Mutual Information values (MI) of more than 1 (e.g.
1.000013) which are not allowed. MI is in [0:1]. I suppose there are rounding
errors anywhere in the new R 2.9.2.


From michael.m.spiegel at gmail.com  Fri Aug 28 23:00:15 2009
From: michael.m.spiegel at gmail.com (michael.m.spiegel at gmail.com)
Date: Fri, 28 Aug 2009 23:00:15 +0200 (CEST)
Subject: [Rd] c() poor error reporting (PR#13917)
Message-ID: <20090828210015.7D1E6282EF42@mail.pubhealth.ku.dk>

Full_Name: Michael Spiegel
Version: 2.9.1
OS: linux
Submission from: (NULL) (137.54.6.192)


The function c() gives a cryptic error message if an "empty" argument is
accidentally passed to the function.  The expression c(,,,) yields the error
message "argument is missing, with no default".  For comparison, the expression
sum(,,,) yields the error message "element 1 is empty; the part of the args list
of 'sum' being evaluated was: (, , , )".  This type of error was produced by
accidentally typing an expression similar to "sum(c(,1,2,3))" which was a
sub-expression inside a much larger expression spanning tens of lines.  When the
entire expression was evaluated, the error message "argument is missing, with no
default" provides little context for determining the cause of the error.


From murdoch at stats.uwo.ca  Sat Aug 29 23:47:07 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 29 Aug 2009 17:47:07 -0400
Subject: [Rd] round off errors? (PR#13918)
In-Reply-To: <20090829073511.11D28282EF4D@mail.pubhealth.ku.dk>
References: <20090829073511.11D28282EF4D@mail.pubhealth.ku.dk>
Message-ID: <4A99A1DB.8040504@stats.uwo.ca>

On 29/08/2009 3:35 AM, claus.henry at gmx.de wrote:
> Full_Name: Claus Pastor
> Version: 2.9.2
> OS: Windows XP
> Submission from: (NULL) (82.113.106.4)
> 
> 
> I use the following function to compute MutualInformation Matrix of factorial
> members of a dataframe. I use package minet for this:
> 
> my.MI = function(test) {
> ## die Diagonale gibt die Entropien, Teile durch entropy von y und du erh?lst
> den Zusammenhang
> ## kenne X und sage daraus y voraus
> 	require(minet)
> 	MI.matrix = matrix(0,nrow=length(test),ncol=length(test),dimnames=list(names(test),names(test)))
> 	for (i in 1:length(test)) {
> 		for (j in 1:length(test)) {
> 			temp = na.omit(test[,c(i,j)])
> 			MI = build.mim(temp)
> 			p.i = prop.table(table(temp[,1]))
> 			p.j = prop.table(table(temp[,2]))
> 			H.i = sum(-p.i*log(p.i))
> 			H.j = sum(-p.j*log(p.j))
> 			MI.matrix[i,j] = MI[1,2]/H.j
> 			MI.matrix[j,i] = MI[1,2]/H.i
> 		}
> 	}
> 	return(MI.matrix)
> }
> 
> 
> The function works well under R 2.8.
> 
> Under R2.9.2 it produces Mutual Information values (MI) of more than 1 (e.g.
> 1.000013) which are not allowed. MI is in [0:1]. I suppose there are rounding
> errors anywhere in the new R 2.9.2.

This is not a useful bug report:  you don't give the data that leads to 
the different values.

You should put together an example and work with the maintainer of the 
minet package to see if it's a bug in that package.  If it's not, then 
you should be able to put together an example that only involves the 
base R packages.

Duncan Murdoch


From murdoch at stats.uwo.ca  Sat Aug 29 23:53:38 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 29 Aug 2009 17:53:38 -0400
Subject: [Rd] c() poor error reporting (PR#13917)
In-Reply-To: <20090828210015.7D1E6282EF42@mail.pubhealth.ku.dk>
References: <20090828210015.7D1E6282EF42@mail.pubhealth.ku.dk>
Message-ID: <4A99A362.1030507@stats.uwo.ca>

On 28/08/2009 5:00 PM, michael.m.spiegel at gmail.com wrote:
> Full_Name: Michael Spiegel
> Version: 2.9.1
> OS: linux
> Submission from: (NULL) (137.54.6.192)
> 
> 
> The function c() gives a cryptic error message if an "empty" argument is
> accidentally passed to the function. 

I wouldn't call that cryptic. You put in a blank argument, and it told 
you the argument was missing.

The expression c(,,,) yields the error
> message "argument is missing, with no default".  For comparison, the expression
> sum(,,,) yields the error message "element 1 is empty; the part of the args list
> of 'sum' being evaluated was: (, , , )".  This type of error was produced by
> accidentally typing an expression similar to "sum(c(,1,2,3))" which was a
> sub-expression inside a much larger expression spanning tens of lines.  When the
> entire expression was evaluated, the error message "argument is missing, with no
> default" provides little context for determining the cause of the error.

Yes, sum() is more friendly in its error reporting.  This hardly 
qualifies as a bug, but if you want to submit a patch, it would be 
considered.

Duncan Murdoch


From wdunlap at tibco.com  Sun Aug 30 01:07:39 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Sat, 29 Aug 2009 16:07:39 -0700
Subject: [Rd] round off errors? (PR#13918)
In-Reply-To: <20090829073511.11D28282EF4D@mail.pubhealth.ku.dk>
References: <20090829073511.11D28282EF4D@mail.pubhealth.ku.dk>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D70001B72E05@NA-PA-VBE03.na.tibco.com>


> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of claus.henry at gmx.de
> Sent: Saturday, August 29, 2009 12:35 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at r-project.org
> Subject: [Rd] round off errors? (PR#13918)
> 
> Full_Name: Claus Pastor
> Version: 2.9.2
> OS: Windows XP
> Submission from: (NULL) (82.113.106.4)
> 
> 
> I use the following function to compute MutualInformation 
> Matrix of factorial
> members of a dataframe. I use package minet for this:
> 
> my.MI = function(test) {
> ## die Diagonale gibt die Entropien, Teile durch entropy von 
> y und du erh?lst
> den Zusammenhang
> ## kenne X und sage daraus y voraus
> 	require(minet)
> 	MI.matrix = 
> matrix(0,nrow=length(test),ncol=length(test),dimnames=list(nam
> es(test),names(test)))
> 	for (i in 1:length(test)) {
> 		for (j in 1:length(test)) {
> 			temp = na.omit(test[,c(i,j)])
> 			MI = build.mim(temp)
> 			p.i = prop.table(table(temp[,1]))
> 			p.j = prop.table(table(temp[,2]))
> 			H.i = sum(-p.i*log(p.i))
> 			H.j = sum(-p.j*log(p.j))
> 			MI.matrix[i,j] = MI[1,2]/H.j
> 			MI.matrix[j,i] = MI[1,2]/H.i
> 		}
> 	}
> 	return(MI.matrix)
> }
> 
> 
> The function works well under R 2.8.
> 
> Under R2.9.2 it produces Mutual Information values (MI) of 
> more than 1 (e.g.
> 1.000013) which are not allowed. MI is in [0:1]. I suppose 
> there are rounding
> errors anywhere in the new R 2.9.2.

With the argument
   test = data.frame(x = gl(2, 3), y = gl(3, 2))
minet version 2.0.0 (Date: 2009-08-19) returns diagonals more than 1 and
minet version 1.6.0 (Date: 2007) returns diagonals of 1.  This happens in
both R 2.9.1 and 2.9.2.  I would suspect changes in minet rather than R
are the problem.  Mail to the Maintainer listed in packageDescription("minet").

Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com 

> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From fabio.ufla at yahoo.com.br  Mon Aug 31 07:13:26 2009
From: fabio.ufla at yahoo.com.br (=?iso-8859-1?Q?Fabio_Mathias_Corr=EAa?=)
Date: Sun, 30 Aug 2009 22:13:26 -0700 (PDT)
Subject: [Rd] Problem in matrix definition?
Message-ID: <895394.79925.qm@web59711.mail.ac4.yahoo.com>

I'm implementing a function to compute the moore-penrose inverse, using a code from the article: Fast Computation of Moore-Penrose Inverse Matrices. Neural Information Processing - Letters and Reviews. Vol.8, No.2, August 2005

However, the R presents an error message when I use the geninv.

The odd thing is that the error occurs for some arrays, however they have the same size. And the R indicates the lack of compatibility between the matrix!

Below is an example:
	
Creating the function geninv

geninv <- function(x)
{
 m <- dim(x)[1]
 n <- dim(x)[2]
 tr <- 0
 if(m < n) {
   a <- tcrossprod(x)
   n <- m
   tr <- 1
 }
 else  a <- crossprod(x)
 dA <- diag(a)
 tol=min(dA[dA>0])*1e-9
 L = a*0
 r = 0
 for(k in 1:n){
  r = r+1
  L[k:n,r] = a[k:n,k]-(L[k:n,1:(r-1)]%*%(t(L[k,1:(r-1)])))
  if(L[k,r] > tol){
    L[k,r] <- sqrt(L[k,r])
    if (k < n) L[(k+1):n,r] <- L[(k+1):n,r]/L[k,r]
  }
  else r <- r-1
 }
 L <- L[,1:r]
 M <- solve(crossprod(L))
 if (tr == 1) Y <- t(x)%*%L%*%M%*%M%*%t(L)
 else Y <- L%*%M%*%M%*%t(L)%*%t(x)
 return(Y)
 }
 
# Perfect result! This result is identical of the function ginv!

library(MASS)
mp <- 10
np <- 5
a <- matrix(c(1:mp*np),mp,np)
dim(a) # 10,5
geninv(a)
ginv(a)

# Problem
a <- matrix(c(1:50),mp,np) # The difference is the vector (1:50)
dim(a) # 10,5

geninv(a)
Error in L[k:n, 1:(r - 1)] %*% (t(L[k, 1:(r - 1)])) : 
  arguments are not compatible


The problem this in matrix definition?

Thanks very much!

? ???????????? F?bio Mathias Corr?a
Estat?stica e Experimenta??o Agropecu?ria/UFLA



      ____________________________________________________________________________________
Veja quais s?o os assuntos do momento no Yahoo! +Buscados
http://br.maisbuscados.yahoo.com


From michael.m.spiegel at gmail.com  Mon Aug 31 05:21:52 2009
From: michael.m.spiegel at gmail.com (Michael Spiegel)
Date: Sun, 30 Aug 2009 23:21:52 -0400
Subject: [Rd] c() poor error reporting (PR#13917)
In-Reply-To: <4A99A362.1030507@stats.uwo.ca>
References: <20090828210015.7D1E6282EF42@mail.pubhealth.ku.dk>
	<4A99A362.1030507@stats.uwo.ca>
Message-ID: <1901f69e0908302021r65ddfc24i91d8a92ddbb88331@mail.gmail.com>

Hi,

Thanks.  I think I failed to communicate what I believe should be
corrected.  The error message itself contains correct information, it
is what is missing from the error message that is desired.  The
message "argument is missing, with no default" does not inform the
user in what function the error occured.  I have the good sense to run
traceback() and figure out where the error occured.  But several of
the users in the R package we maintain write horribly nested scripts
"foo(bar(baz(quux(c(,'a','b','c')))))" and don't incrementally test
their programs. I am proposing the error message state "in function
c() an argument is missing, with no default". It's an issue of
usability, but granted not a major issue.  I will not be able to
submit a patch in the near future, but thank you for the reply.

--Michael

On Sat, Aug 29, 2009 at 5:53 PM, Duncan Murdoch<murdoch at stats.uwo.ca> wrote:
> On 28/08/2009 5:00 PM, michael.m.spiegel at gmail.com wrote:
>>
>> Full_Name: Michael Spiegel
>> Version: 2.9.1
>> OS: linux
>> Submission from: (NULL) (137.54.6.192)
>>
>>
>> The function c() gives a cryptic error message if an "empty" argument is
>> accidentally passed to the function.
>
> I wouldn't call that cryptic. You put in a blank argument, and it told you
> the argument was missing.
>
> The expression c(,,,) yields the error
>>
>> message "argument is missing, with no default". ?For comparison, the
>> expression
>> sum(,,,) yields the error message "element 1 is empty; the part of the
>> args list
>> of 'sum' being evaluated was: (, , , )". ?This type of error was produced
>> by
>> accidentally typing an expression similar to "sum(c(,1,2,3))" which was a
>> sub-expression inside a much larger expression spanning tens of lines.
>> ?When the
>> entire expression was evaluated, the error message "argument is missing,
>> with no
>> default" provides little context for determining the cause of the error.
>
> Yes, sum() is more friendly in its error reporting. ?This hardly qualifies
> as a bug, but if you want to submit a patch, it would be considered.
>
> Duncan Murdoch
>


From ligges at statistik.tu-dortmund.de  Mon Aug 31 10:21:34 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 31 Aug 2009 10:21:34 +0200
Subject: [Rd] Problem in matrix definition?
In-Reply-To: <895394.79925.qm@web59711.mail.ac4.yahoo.com>
References: <895394.79925.qm@web59711.mail.ac4.yahoo.com>
Message-ID: <4A9B880E.9000405@statistik.tu-dortmund.de>

Try to learn how to debug.
The following copied from my R session might give you some hints:



 > options(error=recover)
 > geninv(a)
Error in L[k:n, 1:(r - 1)] %*% (t(L[k, 1:(r - 1)])) :
   non-conformable arguments

Enter a frame number, or 0 to exit

1: geninv(a)

Selection: 1
Called from: eval(expr, envir, enclos)
Browse[1]> (t(L[k, 1:(r - 1)]))
          [,1]   [,2]
[1,] 75.68261 29.277
Browse[1]> L[k:n, 1:(r - 1)]
           [,1]    [,2]
[1,]  75.68261 29.2770
[2,] 103.71320 43.9155
[3,] 131.74380 58.5540



Best,
Uwe Ligges




Fabio Mathias Corr?a wrote:
> I'm implementing a function to compute the moore-penrose inverse, using a code from the article: Fast Computation of Moore-Penrose Inverse Matrices. Neural Information Processing - Letters and Reviews. Vol.8, No.2, August 2005
> 
> However, the R presents an error message when I use the geninv.
> 
> The odd thing is that the error occurs for some arrays, however they have the same size. And the R indicates the lack of compatibility between the matrix!
> 
> Below is an example:
> 	
> Creating the function geninv
> 
> geninv <- function(x)
> {
>  m <- dim(x)[1]
>  n <- dim(x)[2]
>  tr <- 0
>  if(m < n) {
>    a <- tcrossprod(x)
>    n <- m
>    tr <- 1
>  }
>  else  a <- crossprod(x)
>  dA <- diag(a)
>  tol=min(dA[dA>0])*1e-9
>  L = a*0
>  r = 0
>  for(k in 1:n){
>   r = r+1
>   L[k:n,r] = a[k:n,k]-(L[k:n,1:(r-1)]%*%(t(L[k,1:(r-1)])))
>   if(L[k,r] > tol){
>     L[k,r] <- sqrt(L[k,r])
>     if (k < n) L[(k+1):n,r] <- L[(k+1):n,r]/L[k,r]
>   }
>   else r <- r-1
>  }
>  L <- L[,1:r]
>  M <- solve(crossprod(L))
>  if (tr == 1) Y <- t(x)%*%L%*%M%*%M%*%t(L)
>  else Y <- L%*%M%*%M%*%t(L)%*%t(x)
>  return(Y)
>  }
>  
> # Perfect result! This result is identical of the function ginv!
> 
> library(MASS)
> mp <- 10
> np <- 5
> a <- matrix(c(1:mp*np),mp,np)
> dim(a) # 10,5
> geninv(a)
> ginv(a)
> 
> # Problem
> a <- matrix(c(1:50),mp,np) # The difference is the vector (1:50)
> dim(a) # 10,5
> 
> geninv(a)
> Error in L[k:n, 1:(r - 1)] %*% (t(L[k, 1:(r - 1)])) : 
>   arguments are not compatible
> 
> 
> The problem this in matrix definition?
> 
> Thanks very much!
> 
>                F?bio Mathias Corr?a
> Estat?stica e Experimenta??o Agropecu?ria/UFLA
> 
> 
> 
>       ____________________________________________________________________________________
> Veja quais s?o os assuntos do momento no Yahoo! +Buscados
> http://br.maisbuscados.yahoo.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Ted.Harding at manchester.ac.uk  Mon Aug 31 11:00:09 2009
From: Ted.Harding at manchester.ac.uk ( (Ted Harding))
Date: Mon, 31 Aug 2009 10:00:09 +0100 (BST)
Subject: [Rd] Problem in matrix definition?
In-Reply-To: <4A9B880E.9000405@statistik.tu-dortmund.de>
Message-ID: <XFMail.090831100009.Ted.Harding@manchester.ac.uk>

Does the following help to clarify things?
>From your original two different definitions of the matrix 'a':

  mp <- 10
  np <- 5
  a <- matrix(c(1:mp*np),mp,np)
  a
  #       [,1] [,2] [,3] [,4] [,5]
  #  [1,]    5    5    5    5    5
  #  [2,]   10   10   10   10   10
  #  [3,]   15   15   15   15   15
  #  [4,]   20   20   20   20   20
  #  [5,]   25   25   25   25   25
  #  [6,]   30   30   30   30   30
  #  [7,]   35   35   35   35   35
  #  [8,]   40   40   40   40   40
  #  [9,]   45   45   45   45   45
  # [10,]   50   50   50   50   50

  a <- matrix(c(1:50),mp,np)
  a
  #       [,1] [,2] [,3] [,4] [,5]
  #  [1,]    1   11   21   31   41
  #  [2,]    2   12   22   32   42
  #  [3,]    3   13   23   33   43
  #  [4,]    4   14   24   34   44
  #  [5,]    5   15   25   35   45
  #  [6,]    6   16   26   36   46
  #  [7,]    7   17   27   37   47
  #  [8,]    8   18   28   38   48
  #  [9,]    9   19   29   39   49
  # [10,]   10   20   30   40   50

Check what is said about precedence in '?Syntax'. The effect of
"c(1:mp*np)" is (1:mp)*np, i.e. first create (1:mp), and then
multiuply each element by np. So, with mp=10, np=5, you first get
c(1,2,3,4,5,6,7,8,9,10) from (1:10), and then
c(5,10,15,20,25,30,35,40,45,50) after multiplying this by 5.

This vector with 10 elements is then recycled 5 times over
when you ask for "a <- matrix(c(1:mp*np),mp,np)", i.e. the
equivalent of

  a <- matrix(c(5,10,15,20,25,30,35,40,45,50),10,5)

On the other hand, a <- matrix(c(1:50),10,5) does what you expected!

Hoping this helps,
Ted.

On 31-Aug-09 08:21:34, Uwe Ligges wrote:
> Try to learn how to debug.
> The following copied from my R session might give you some hints:
> 
>  > options(error=recover)
>  > geninv(a)
> Error in L[k:n, 1:(r - 1)] %*% (t(L[k, 1:(r - 1)])) :
>    non-conformable arguments
> 
> Enter a frame number, or 0 to exit
> 
> 1: geninv(a)
> 
> Selection: 1
> Called from: eval(expr, envir, enclos)
> Browse[1]> (t(L[k, 1:(r - 1)]))
>           [,1]   [,2]
> [1,] 75.68261 29.277
> Browse[1]> L[k:n, 1:(r - 1)]
>            [,1]    [,2]
> [1,]  75.68261 29.2770
> [2,] 103.71320 43.9155
> [3,] 131.74380 58.5540
> 
> 
> 
> Best,
> Uwe Ligges
> 
> 
> 
> 
> Fabio Mathias Corr?a wrote:
>> I'm implementing a function to compute the moore-penrose inverse,
>> using a code from the article: Fast Computation of Moore-Penrose
>> Inverse Matrices. Neural Information Processing - Letters and Reviews.
>> Vol.8, No.2, August 2005
>> 
>> However, the R presents an error message when I use the geninv.
>> 
>> The odd thing is that the error occurs for some arrays, however they
>> have the same size. And the R indicates the lack of compatibility
>> between the matrix!
>> 
>> Below is an example:
>>      
>> Creating the function geninv
>> 
>> geninv <- function(x)
>> {
>>  m <- dim(x)[1]
>>  n <- dim(x)[2]
>>  tr <- 0
>>  if(m < n) {
>>    a <- tcrossprod(x)
>>    n <- m
>>    tr <- 1
>>  }
>>  else  a <- crossprod(x)
>>  dA <- diag(a)
>>  tol=min(dA[dA>0])*1e-9
>>  L = a*0
>>  r = 0
>>  for(k in 1:n){
>>   r = r+1
>>   L[k:n,r] = a[k:n,k]-(L[k:n,1:(r-1)]%*%(t(L[k,1:(r-1)])))
>>   if(L[k,r] > tol){
>>     L[k,r] <- sqrt(L[k,r])
>>     if (k < n) L[(k+1):n,r] <- L[(k+1):n,r]/L[k,r]
>>   }
>>   else r <- r-1
>>  }
>>  L <- L[,1:r]
>>  M <- solve(crossprod(L))
>>  if (tr == 1) Y <- t(x)%*%L%*%M%*%M%*%t(L)
>>  else Y <- L%*%M%*%M%*%t(L)%*%t(x)
>>  return(Y)
>>  }
>>  
>> # Perfect result! This result is identical of the function ginv!
>> 
>> library(MASS)
>> mp <- 10
>> np <- 5
>> a <- matrix(c(1:mp*np),mp,np)
>> dim(a) # 10,5
>> geninv(a)
>> ginv(a)
>> 
>> # Problem
>> a <- matrix(c(1:50),mp,np) # The difference is the vector (1:50)
>> dim(a) # 10,5
>> 
>> geninv(a)
>> Error in L[k:n, 1:(r - 1)] %*% (t(L[k, 1:(r - 1)])) : 
>>   arguments are not compatible
>> 
>> 
>> The problem this in matrix definition?
>> 
>> Thanks very much!
>> 
>>                F?bio Mathias Corr?a
>> Estat?stica e Experimenta??o Agropecu?ria/UFLA
>> 
>> 
>> 
>>       _________________________________________________________________
>>       ___________________
>> Veja quais s?o os assuntos do momento no Yahoo! +Buscados
>> http://br.maisbuscados.yahoo.com
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 31-Aug-09                                       Time: 10:00:04
------------------------------ XFMail ------------------------------


From maechler at stat.math.ethz.ch  Mon Aug 31 14:51:16 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 31 Aug 2009 14:51:16 +0200
Subject: [Rd] S4 Generics and NAMESPACE : justified warning ?
In-Reply-To: <20090828162429.32576c07@mimi>
References: <20090817135120.16fab862@mimi>
	<30312_1250600886_4A8AA7B5_30312_581_1_4A8AA986.3040702@fhcrc.org>
	<20090828162429.32576c07@mimi>
Message-ID: <19099.51012.936944.591938@lynne.math.ethz.ch>

>>>>> "YC" == Yohan Chalabi <chalabi at phys.ethz.ch>
>>>>>     on Fri, 28 Aug 2009 16:24:29 +0200 writes:

    >>>>> "MM" == Martin Morgan <mtmorgan at fhcrc.org>
    >>>>> on Tue, 18 Aug 2009 06:15:50 -0700

    YC> Hi Martin,

    YC> Thanks for your response.

    MM> Commenting as a user, there's no guarantee that the
    MM> 'plot' generic defined in pkgA is derived from
    MM> graphics::plot via setGeneric; pkgA could define it's
    MM> own generic, and one would want to be informed of the
    MM> collision.

    YC> This shouldn't be a problem because generics keep track of the function
    YC> and package used.

    YC> setGeneric(plot)
    YC> str(getGeneric(plot))

yes, but you (Yohan) have provided a patch proposal which made
the warning go away in this one case, and
IIUC Martin Morgan argued that the warning was still needed because
of his case above.


     MM> Maintenance of packages that have used simple 'import'
     MM> to pull in all dependencies is tedious, but using
     MM> 'import' in some ways undermines benefits of name
     MM> spaces (restricting the symbol lookup table to reduce
     MM> the number of symbols and the possibility of name
     MM> collisions, and to more carefully isolate code inside
     MM> the package name space to changes in imported packages
     MM> or induced by the user). So I think a 'better practice'
     MM> is to explicitly import just those functions, classes,
     MM> etc that are required by the package. Maintenance of
     MM> such selective imports is much less tedious, even with
     MM> complicated package dependencies. There is an
     MM> unreleased Bioconductor package to identify specific
     MM> imports, available for R-2.9.* at
     MM>   [...............]

    YC> I agree with you that 'importFrom' should be the preferred approach. I
    YC> have been using it for some time and I have even wrote my own
    YC> functions to automatically generate the NAMESPACE. 


    YC> But the drawback is that it makes the dependency with other packages
    YC> version specific and can become tricky when one has several such
    YC> dependencies.

Yes. 

    YC> To make the maintenance of packages easier, I would like to use
    YC> the suboptimal 'import' so that I do not need to care about this
    YC> NAMESPACE/package version issue. But I cannot do that because of an,
    YC> IMO, unjustified warning.

Yes, I agree, unjustified in your case.
The question is: is there a patch which does differentiate
between your situation and Martin's scenario -- or does your
patch already do that?

Regards,
Martin Maechler, ETH Zurich


From fabio.ufla at yahoo.com.br  Mon Aug 31 19:09:03 2009
From: fabio.ufla at yahoo.com.br (=?iso-8859-1?Q?Fabio_Mathias_Corr=EAa?=)
Date: Mon, 31 Aug 2009 10:09:03 -0700 (PDT)
Subject: [Rd]  Problem in matrix definition?
In-Reply-To: <4A9B880E.9000405@statistik.tu-dortmund.de>
Message-ID: <798421.77107.qm@web59715.mail.ac4.yahoo.com>

The problem is that arrays are the same size. The only difference is how they were built!

The way to build the matrix should not influence in the outcome!

Below is the commented code in MatLab!

Neural Information Processing - Letters and Reviews Vol.8, No.2, August 2005

function Y = geninv(G)
    % Returns the Moore-Penrose inverse of the argument
    % Transpose if m < n
   [m,n]=size(G); transpose=false;
   if m<n
      transpose=true;
      A=G*G';
      n=m;
   else
   A=G'*G;
   end
   % Full rank Cholesky factorization of A
   dA=diag(A); tol= min(dA(dA>0))*1e-9;
   L=zeros(size(A));
   r=0;
   for k=1:n
      r=r+1;
      L(k:n,r)=A(k:n,k)-L(k:n,1:(r-1))*L(k,1:(r-1))';
% Note: for r=1, the substracted vector is zero
      if L(k,r)>tol
         L(k,r)=sqrt(L(k,r));
         if k<n
            L((k+1):n,r)=L((k+1):n,r)/L(k,r);
         end
      else
         r=r-1;
      end
   end
   L=L(:,1:r);
% Computation of the generalized inverse of G
   M=inv(L'*L);
   if transpose
      Y=G'*L*M*M*L';
   else
      Y=L*M*M*L'*G';
   end


Thanks!

? ???????????? F?bio Mathias Corr?a
Estat?stica e Experimenta??o Agropecu?ria/UFLA
                     Brazil


      ____________________________________________________________________________________
Veja quais s?o os assuntos do momento no Yahoo! +Buscados
http://br.maisbuscados.yahoo.com


From mathieu.ribatet at epfl.ch  Mon Aug 31 19:57:24 2009
From: mathieu.ribatet at epfl.ch (Mathieu Ribatet)
Date: Mon, 31 Aug 2009 19:57:24 +0200
Subject: [Rd] Problem in matrix definition?
In-Reply-To: <798421.77107.qm@web59715.mail.ac4.yahoo.com>
References: <798421.77107.qm@web59715.mail.ac4.yahoo.com>
Message-ID: <1251741444.3976.9.camel@ubuntu>

Dear Fabio,

The problem is that L[k,1:(r-1)] is not anymore a matrix but a vector.
Hence when you do t(L[k,1:(r-1)]) you get a matrix with only one row
while I think you expected one column instead. You can see this feature
with a simpler example like the following one:

        x <- runif(10)
        is.vector(x)
        dim(t(x))##1,10
        dim(t(t(x)))##10,1

Getting back to your code, you probably want that L[k,1:(r-1)] is a
matrix with r-1 columns. This is possible by substituting
t(L[k,1:(r-1)]) for t(t(L[k,1:(r-1)])) or matrix(L[k,1:(r-1)], nrow = 1)

Maybe somebody else will find a more elegant fix for your problem.
However, I tried and it did solve your issue.

Cheers,
Mathieu

Le lundi 31 ao?t 2009 ? 19:09 +0200, Fabio Mathias Corr?a a ?crit :
> The problem is that arrays are the same size. The only difference is how they were built!
> 
> The way to build the matrix should not influence in the outcome!
> 
> Below is the commented code in MatLab!
> 
> Neural Information Processing - Letters and Reviews Vol.8, No.2, August 2005
> 
> function Y = geninv(G)
>     % Returns the Moore-Penrose inverse of the argument
>     % Transpose if m < n
>    [m,n]=size(G); transpose=false;
>    if m<n
>       transpose=true;
>       A=G*G';
>       n=m;
>    else
>    A=G'*G;
>    end
>    % Full rank Cholesky factorization of A
>    dA=diag(A); tol= min(dA(dA>0))*1e-9;
>    L=zeros(size(A));
>    r=0;
>    for k=1:n
>       r=r+1;
>       L(k:n,r)=A(k:n,k)-L(k:n,1:(r-1))*L(k,1:(r-1))';
> % Note: for r=1, the substracted vector is zero
>       if L(k,r)>tol
>          L(k,r)=sqrt(L(k,r));
>          if k<n
>             L((k+1):n,r)=L((k+1):n,r)/L(k,r);
>          end
>       else
>          r=r-1;
>       end
>    end
>    L=L(:,1:r);
> % Computation of the generalized inverse of G
>    M=inv(L'*L);
>    if transpose
>       Y=G'*L*M*M*L';
>    else
>       Y=L*M*M*L'*G';
>    end
> 
> 
> Thanks!
> 
>                F?bio Mathias Corr?a
> Estat?stica e Experimenta??o Agropecu?ria/UFLA
>                      Brazil
> 
> 
>       ____________________________________________________________________________________
> Veja quais s?o os assuntos do momento no Yahoo! +Buscados
> http://br.maisbuscados.yahoo.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Institute of Mathematics
Ecole Polytechnique F?d?rale de Lausanne
STAT-IMA-FSB-EPFL, Station 8
CH-1015 Lausanne   Switzerland
http://stat.epfl.ch/
Tel: + 41 (0)21 693 7907


From christos.hatzis at nuverabio.com  Mon Aug 31 20:09:33 2009
From: christos.hatzis at nuverabio.com (Christos Hatzis)
Date: Mon, 31 Aug 2009 14:09:33 -0400
Subject: [Rd] Problem in matrix definition?
In-Reply-To: <1251741444.3976.9.camel@ubuntu>
References: <798421.77107.qm@web59715.mail.ac4.yahoo.com>
	<1251741444.3976.9.camel@ubuntu>
Message-ID: <17E6277E375B4F86B16FCB772452DBE6@headquarters.silicoinsights>

See details on subsetting
?"["
specifically the drop argument.

To prevent the effects of drop() use

L[k, 1:(r-1), drop=FALSE]

-Christos 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Mathieu Ribatet
> Sent: Monday, August 31, 2009 1:57 PM
> To: Fabio Mathias Corr?a
> Cc: r-devel at r-project.org; Uwe Ligges
> Subject: Re: [Rd] Problem in matrix definition?
> 
> Dear Fabio,
> 
> The problem is that L[k,1:(r-1)] is not anymore a matrix but a vector.
> Hence when you do t(L[k,1:(r-1)]) you get a matrix with only 
> one row while I think you expected one column instead. You 
> can see this feature with a simpler example like the following one:
> 
>         x <- runif(10)
>         is.vector(x)
>         dim(t(x))##1,10
>         dim(t(t(x)))##10,1
> 
> Getting back to your code, you probably want that 
> L[k,1:(r-1)] is a matrix with r-1 columns. This is possible 
> by substituting
> t(L[k,1:(r-1)]) for t(t(L[k,1:(r-1)])) or 
> matrix(L[k,1:(r-1)], nrow = 1)
> 
> Maybe somebody else will find a more elegant fix for your problem.
> However, I tried and it did solve your issue.
> 
> Cheers,
> Mathieu
> 
> Le lundi 31 ao?t 2009 ? 19:09 +0200, Fabio Mathias Corr?a a ?crit :
> > The problem is that arrays are the same size. The only 
> difference is how they were built!
> > 
> > The way to build the matrix should not influence in the outcome!
> > 
> > Below is the commented code in MatLab!
> > 
> > Neural Information Processing - Letters and Reviews Vol.8, No.2, 
> > August 2005
> > 
> > function Y = geninv(G)
> >     % Returns the Moore-Penrose inverse of the argument
> >     % Transpose if m < n
> >    [m,n]=size(G); transpose=false;
> >    if m<n
> >       transpose=true;
> >       A=G*G';
> >       n=m;
> >    else
> >    A=G'*G;
> >    end
> >    % Full rank Cholesky factorization of A
> >    dA=diag(A); tol= min(dA(dA>0))*1e-9;
> >    L=zeros(size(A));
> >    r=0;
> >    for k=1:n
> >       r=r+1;
> >       L(k:n,r)=A(k:n,k)-L(k:n,1:(r-1))*L(k,1:(r-1))';
> > % Note: for r=1, the substracted vector is zero
> >       if L(k,r)>tol
> >          L(k,r)=sqrt(L(k,r));
> >          if k<n
> >             L((k+1):n,r)=L((k+1):n,r)/L(k,r);
> >          end
> >       else
> >          r=r-1;
> >       end
> >    end
> >    L=L(:,1:r);
> > % Computation of the generalized inverse of G
> >    M=inv(L'*L);
> >    if transpose
> >       Y=G'*L*M*M*L';
> >    else
> >       Y=L*M*M*L'*G';
> >    end
> > 
> > 
> > Thanks!
> > 
> >                F?bio Mathias Corr?a
> > Estat?stica e Experimenta??o Agropecu?ria/UFLA
> >                      Brazil
> > 
> > 
> >       
> > 
> ______________________________________________________________________
> > ______________ Veja quais s?o os assuntos do momento no Yahoo! 
> > +Buscados http://br.maisbuscados.yahoo.com
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> --
> Institute of Mathematics
> Ecole Polytechnique F?d?rale de Lausanne STAT-IMA-FSB-EPFL, Station 8
> CH-1015 Lausanne   Switzerland
> http://stat.epfl.ch/
> Tel: + 41 (0)21 693 7907
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From fabio.ufla at yahoo.com.br  Mon Aug 31 20:27:46 2009
From: fabio.ufla at yahoo.com.br (=?iso-8859-1?Q?Fabio_Mathias_Corr=EAa?=)
Date: Mon, 31 Aug 2009 11:27:46 -0700 (PDT)
Subject: [Rd] Problem in matrix definition?
Message-ID: <584771.43054.qm@web59703.mail.ac4.yahoo.com>

Thanks very much!!!

? ???????????? F?bio Mathias Corr?a
Estat?stica e Experimenta??o Agropecu?ria/UFLA


      ____________________________________________________________________________________
Veja quais s?o os assuntos do momento no Yahoo! +Buscados
http://br.maisbuscados.yahoo.com


