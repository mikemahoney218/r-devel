From ggrothendieck at gmail.com  Sat Jul  1 01:14:45 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 30 Jun 2006 19:14:45 -0400
Subject: [Rd] foo2Args()
In-Reply-To: <44A593A9.9010802@bank-banque-canada.ca>
References: <44A58747.7080705@bank-banque-canada.ca>
	<44A58CE6.2040903@stats.uwo.ca>
	<44A593A9.9010802@bank-banque-canada.ca>
Message-ID: <971536df0606301614g1dc5f4b5rd8aa55227a3ef305@mail.gmail.com>

On 6/30/06, Paul Gilbert <pgilbert at bank-banque-canada.ca> wrote:
>
>
> Duncan Murdoch wrote:
>
> > On 6/30/2006 4:19 PM, Paul Gilbert wrote:
> >
> >> I was just considering trying to clean up the arguments to a function
> >> that calls other functions,
> >> and was playin with a suggestion Achim made during a conversation at
> >> useR.  The idea is, instead of using list(), use a small function to
> >> construct and check arguments. My hope was to be able to do this
> >> without making it globally visible:
> >>
> >> foo <- function(x, args=foo2Args()) {
> >>   foo2Args <- function(a=1, b=2){list(a,b)}
> >>   # above would actual do more testing of args
> >>   #now I would call foo2 with args, but to test just
> >>   args
> >>   }
> >>
> >> Now,
> >>
> >>  > foo(1)   # should I be surprized that this works
> >> [[1]]
> >> [1] 1
> >>
> >> [[2]]
> >> [1] 2
> >
> >
> > I don't think it really works, it's just a coincidence that the answer
> > matches your expectations:
> >
> > > foo(3)
> > [[1]]
> > [1] 1
> >
> > [[2]]
> > [1] 2
> >
> > Or maybe I am completely misunderstanding your expectations...
> >
> >>
> >>  > foo(1, args=foo2Args(a=2, b=10)) # or that this does not
> >> Error in foo(1, args = foo2Args(a = 2, b = 10)) :
> >>     could not find function "foo2Args"
> >
> >
> > This is a somewhat subtle thing about the way args are evaluated.
> > What is done makes lots of sense once you understand it:
> >
> >  - When you specify an argument in the call, the expression you give
> > is evaluated in the current context.  In the context where you made
> > this call, foo2Args is not defined, hence the error.
> >
> >  - When you specify a default for an argument, it is evaluated in the
> > local context of the function evaluation.  So as a default, foo2Args
> > is recognized, because it's a local variable within foo.
> >
> > You also need to remember "lazy evaluation":  neither of the above
> > actually take place until args is used.
> >
> > R is pretty flexible, so it's probably possible to do whatever you
> > intended here; can you describe exactly what you want to happen?
>
> I guess what I want to happen is that when args is used it it gets
> evaluated in the local context of the function, whether or not I am
> specifying the argument or using the default. Is there a way to do that?
>
> What I expected to happen was that it would always get evaluated either
> in the local context or in the calling context, i.e., it would fail or
> not fail, but that would not depend on whether I am specifying the
> argument or using the default, so your first points explain this.
>

I think its better that a function check its own arguments.  Having the
caller check the arguments by calling foo2Args seems to distribute
the functionality between the function and the caller so I don't think that
that is desirable.


From murdoch at stats.uwo.ca  Sat Jul  1 02:38:19 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 30 Jun 2006 20:38:19 -0400
Subject: [Rd] foo2Args()
In-Reply-To: <44A593A9.9010802@bank-banque-canada.ca>
References: <44A58747.7080705@bank-banque-canada.ca>	<44A58CE6.2040903@stats.uwo.ca>
	<44A593A9.9010802@bank-banque-canada.ca>
Message-ID: <44A5C3FB.1010202@stats.uwo.ca>

On 6/30/2006 5:12 PM, Paul Gilbert wrote:
> 
> Duncan Murdoch wrote:
> 
>> On 6/30/2006 4:19 PM, Paul Gilbert wrote:
>>
>>> I was just considering trying to clean up the arguments to a function 
>>> that calls other functions,
>>> and was playin with a suggestion Achim made during a conversation at 
>>> useR.  The idea is, instead of using list(), use a small function to 
>>> construct and check arguments. My hope was to be able to do this 
>>> without making it globally visible:
>>>
>>> foo <- function(x, args=foo2Args()) {
>>>   foo2Args <- function(a=1, b=2){list(a,b)}
>>>   # above would actual do more testing of args
>>>   #now I would call foo2 with args, but to test just
>>>   args
>>>   }
>>>  
>>> Now,
>>>
>>>  > foo(1)   # should I be surprized that this works
>>> [[1]]
>>> [1] 1
>>>
>>> [[2]]
>>> [1] 2
>>
>> I don't think it really works, it's just a coincidence that the answer 
>> matches your expectations:
>>
>>> foo(3)
>> [[1]]
>> [1] 1
>>
>> [[2]]
>> [1] 2
>>
>> Or maybe I am completely misunderstanding your expectations...
>>
>>>  > foo(1, args=foo2Args(a=2, b=10)) # or that this does not
>>> Error in foo(1, args = foo2Args(a = 2, b = 10)) :
>>>     could not find function "foo2Args"
>>
>> This is a somewhat subtle thing about the way args are evaluated.  
>> What is done makes lots of sense once you understand it:
>>
>>  - When you specify an argument in the call, the expression you give 
>> is evaluated in the current context.  In the context where you made 
>> this call, foo2Args is not defined, hence the error.
>>
>>  - When you specify a default for an argument, it is evaluated in the 
>> local context of the function evaluation.  So as a default, foo2Args 
>> is recognized, because it's a local variable within foo.
>>
>> You also need to remember "lazy evaluation":  neither of the above 
>> actually take place until args is used.
>>
>> R is pretty flexible, so it's probably possible to do whatever you 
>> intended here; can you describe exactly what you want to happen?
> 
> I guess what I want to happen is that when args is used it it gets 
> evaluated in the local context of the function, whether or not I am 
> specifying the argument or using the default. Is there a way to do that?

I think this would work:

  foo <- function(x, args=foo2Args()) {
    foo2Args <- function(a=1, b=2){list(a,b)}
    # above would actual do more testing of args
    #now I would call foo2 with args, but to test just
    args <- eval(substitute(args))
    args
    }

The explanation is this:

substitute(args) gets the expression attached to args without evaluating 
it. eval( substitute(args) ) then evaluates it; since I didn't say which 
environment to work in, it defaults to the current evaluation environment.

HOWEVER, this function is a bad idea.  Users don't expect evaluation 
like this.  For example, this would mess it up:

args <- 2
foo(1, args=foo2Args(a=args, b=10))

because it would try to evaluate "args" in the local environment, rather 
than where the user put it.  You'd get weird behaviour if any of the 
values in foo2Args used variables rather than constants, because they'd 
be evaluated in the function, not in the user's workspace.

Duncan Murdoch

> 
> What I expected to happen was that it would always get evaluated either 
> in the local context or in the calling context, i.e., it would fail or 
> not fail, but that would not depend on whether I am specifying the 
> argument or using the default, so your first points explain this.
> 
> Thanks,
> Paul
> 
>> Duncan Murdoch
> ====================================================================================
> 
> La version fran?aise suit le texte anglais.
> 
> ------------------------------------------------------------------------------------
> 
> This email may contain privileged and/or confidential inform...{{dropped}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pgilbert at bank-banque-canada.ca  Sat Jul  1 03:03:54 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 30 Jun 2006 21:03:54 -0400
Subject: [Rd] foo2Args()
In-Reply-To: <44A5C3FB.1010202@stats.uwo.ca>
References: <44A58747.7080705@bank-banque-canada.ca>	<44A58CE6.2040903@stats.uwo.ca>
	<44A593A9.9010802@bank-banque-canada.ca>
	<44A5C3FB.1010202@stats.uwo.ca>
Message-ID: <44A5C9FA.1010704@bank-banque-canada.ca>



Duncan Murdoch wrote:
> On 6/30/2006 5:12 PM, Paul Gilbert wrote:
>>
>> Duncan Murdoch wrote:
>>
>>> On 6/30/2006 4:19 PM, Paul Gilbert wrote:
>>>
>>>> I was just considering trying to clean up the arguments to a 
>>>> function that calls other functions,
>>>> and was playin with a suggestion Achim made during a conversation at 
>>>> useR.  The idea is, instead of using list(), use a small function to 
>>>> construct and check arguments. My hope was to be able to do this 
>>>> without making it globally visible:
>>>>
>>>> foo <- function(x, args=foo2Args()) {
>>>>   foo2Args <- function(a=1, b=2){list(a,b)}
>>>>   # above would actual do more testing of args
>>>>   #now I would call foo2 with args, but to test just
>>>>   args
>>>>   }
>>>>  
>>>> Now,
>>>>
>>>>  > foo(1)   # should I be surprized that this works
>>>> [[1]]
>>>> [1] 1
>>>>
>>>> [[2]]
>>>> [1] 2
>>>
>>> I don't think it really works, it's just a coincidence that the 
>>> answer matches your expectations:
>>>
>>>> foo(3)
>>> [[1]]
>>> [1] 1
>>>
>>> [[2]]
>>> [1] 2
>>>
>>> Or maybe I am completely misunderstanding your expectations...
>>>
>>>>  > foo(1, args=foo2Args(a=2, b=10)) # or that this does not
>>>> Error in foo(1, args = foo2Args(a = 2, b = 10)) :
>>>>     could not find function "foo2Args"
>>>
>>> This is a somewhat subtle thing about the way args are evaluated.  
>>> What is done makes lots of sense once you understand it:
>>>
>>>  - When you specify an argument in the call, the expression you give 
>>> is evaluated in the current context.  In the context where you made 
>>> this call, foo2Args is not defined, hence the error.
>>>
>>>  - When you specify a default for an argument, it is evaluated in the 
>>> local context of the function evaluation.  So as a default, foo2Args 
>>> is recognized, because it's a local variable within foo.
>>>
>>> You also need to remember "lazy evaluation":  neither of the above 
>>> actually take place until args is used.
>>>
>>> R is pretty flexible, so it's probably possible to do whatever you 
>>> intended here; can you describe exactly what you want to happen?
>>
>> I guess what I want to happen is that when args is used it it gets 
>> evaluated in the local context of the function, whether or not I am 
>> specifying the argument or using the default. Is there a way to do that?
> 
> I think this would work:
> 
>  foo <- function(x, args=foo2Args()) {
>    foo2Args <- function(a=1, b=2){list(a,b)}
>    # above would actual do more testing of args
>    #now I would call foo2 with args, but to test just
>    args <- eval(substitute(args))
>    args
>    }
> 
> The explanation is this:
> 
> substitute(args) gets the expression attached to args without evaluating 
> it. eval( substitute(args) ) then evaluates it; since I didn't say which 
> environment to work in, it defaults to the current evaluation environment.
> 
> HOWEVER, this function is a bad idea.  Users don't expect evaluation 
> like this.  For example, this would mess it up:
> 
> args <- 2
> foo(1, args=foo2Args(a=args, b=10))
> 
> because it would try to evaluate "args" in the local environment, rather 
> than where the user put it.  You'd get weird behaviour if any of the 
> values in foo2Args used variables rather than constants, because they'd 
> be evaluated in the function, not in the user's workspace.

Yes, I realized on the way home that what I want is not what I said, 
because I need the function to be found (thus in the local context) but 
I need the arguments to foo2Args from the calling context, if they are 
supplied.

The general idea is to provide a nice clean way to pass arguments along 
to other functions. If foo is calling a few functions this becomes 
really messy, and even moreso if those functions call other functions 
that need arguments passed along. The way I have always done this is 
with a list, but there may be some advantage to using a function that 
constructs the argument. However, there are likely to be namespace 
conflicts if everyone does this and this constructing function name has 
to be exported, or even visible outside of the call to the function. For 
example, one of the function I want to call is optim. If everyone that 
calls optim wants to do this (supposing it is a good idea), they would 
all probably decide a good name for the function is optimArgs.

Perhaps sticking with a list is the best idea.

Thanks,
Paul
> 
> Duncan Murdoch
> 
>>
>> What I expected to happen was that it would always get evaluated 
>> either in the local context or in the calling context, i.e., it would 
>> fail or not fail, but that would not depend on whether I am specifying 
>> the argument or using the default, so your first points explain this.
>>
>> Thanks,
>> Paul
>>
>>> Duncan Murdoch
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From bill at insightful.com  Sat Jul  1 03:48:48 2006
From: bill at insightful.com (bill at insightful.com)
Date: Sat,  1 Jul 2006 03:48:48 +0200 (CEST)
Subject: [Rd] Rdconv --type=Ssgm drops singleton keywords (PR#9051)
Message-ID: <20060701014848.7BD7753571@slim.kubism.ku.dk>

If an Rd file has only one keyword entry then
the Splus sgm file made with Rdconv --type=SSgm
has no keyword entries.

To reproduce:
   Use prompt() to make a skeleton help file
      R> f<-function(x)log(1+x)-log1p(x)
      R> prompt(f)
      Created file named 'f.Rd'.
      Edit the file and move it to the appropriate directory.
      R> q()
   It has 2 \keyword entries in it
      % grep keyword f.Rd
      \keyword{ ~kwd1 }% at least one, from doc/KEYWORDS
      \keyword{ ~kwd2 }% __ONLY ONE__ keyword per line
   If you convert it to the Splus sgm format you get 2
   <s-keyword> entries, in a <s-keywords> section:
      % R CMD Rdconv --type=Ssgm f.Rd | grep 'keyword'
      <s-keywords>
      <s-keyword>~kwd1</s-keyword>
      <s-keyword>~kwd2</s-keyword>
      </s-keywords>
      %
   That is good.

   If you remove one keyword entry from the Rd file so it has one left
   then the sgm file has no <s-keyword> entries (and no <s-keywords>
   section):
      % grep -v '~kwd2' < f.Rd > f1kw.Rd
      % grep keyword f1kw.Rd
      \keyword{ ~kwd1 }% at least one, from doc/KEYWORDS
      % R CMD Rdconv --type=Ssgm f1kw.Rd | grep s-keyword
      %

The fix:
   The problem is that the line
      if ($#keywords > 0) {
   should use >= 0 to tell if the list @keywords is non-empty.

*** share/perl/R/Rdconv.pm	2006-05-23 08:51:16.000000000 -0700
--- /tmp/Rdconv.pm	2006-06-30 11:51:53.000000000 -0700
***************
*** 2965,2971 ****
      Ssgm_print_block_named("references", "References");
      Ssgm_print_seealso();
      Ssgm_print_examples();
!     if ($#keywords > 0) {
  	print $sgmlout "<s-keywords>\n";
  	while ($#keywords >= 0) {
  	    print $sgmlout "<s-keyword>", shift( @keywords ),
--- 2965,2971 ----
      Ssgm_print_block_named("references", "References");
      Ssgm_print_seealso();
      Ssgm_print_examples();
!     if ($#keywords >= 0) {
  	print $sgmlout "<s-keywords>\n";
  	while ($#keywords >= 0) {
  	    print $sgmlout "<s-keyword>", shift( @keywords ),


--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Under development (unstable)
 major = 2
 minor = 4.0
 year = 2006
 month = 06
 day = 29
 svn rev = 38459
 language = R
 version.string = R version 2.4.0 Under development (unstable) (2006-06-29 r38459)

Locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:methods, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, Autoloads, package:base


From maechler at stat.math.ethz.ch  Sat Jul  1 16:20:54 2006
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Sat,  1 Jul 2006 16:20:54 +0200 (CEST)
Subject: [Rd] Rdconv --type=Ssgm drops singleton keywords (PR#9051)
Message-ID: <20060701142054.C6D3D5091C@slim.kubism.ku.dk>

Thank you Bill,

particularly for not only reporting the bug but also diagnose
and patch it.

I've committed the fix for both R-devel and R-patched.

With regards,
Martin

>> If an Rd file has only one keyword entry then
>> the Splus sgm file made with Rdconv --type=SSgm
>> has no keyword entries.
>> 
>> To reproduce:
>>    Use prompt() to make a skeleton help file
>>       R> f<-function(x)log(1+x)-log1p(x)
>>       R> prompt(f)
>>       Created file named 'f.Rd'.
>>       Edit the file and move it to the appropriate directory.
>>       R> q()
>>    It has 2 \keyword entries in it
>>       % grep keyword f.Rd
>>       \keyword{ ~kwd1 }% at least one, from doc/KEYWORDS
>>       \keyword{ ~kwd2 }% __ONLY ONE__ keyword per line
>>    If you convert it to the Splus sgm format you get 2
>>    <s-keyword> entries, in a <s-keywords> section:
>>       % R CMD Rdconv --type=Ssgm f.Rd | grep 'keyword'
>>       <s-keywords>
>>       <s-keyword>~kwd1</s-keyword>
>>       <s-keyword>~kwd2</s-keyword>
>>       </s-keywords>
>>       %
>>    That is good.
>> 
>>    If you remove one keyword entry from the Rd file so it has one left
>>    then the sgm file has no <s-keyword> entries (and no <s-keywords>
>>    section):
>>       % grep -v '~kwd2' < f.Rd > f1kw.Rd
>>       % grep keyword f1kw.Rd
>>       \keyword{ ~kwd1 }% at least one, from doc/KEYWORDS
>>       % R CMD Rdconv --type=Ssgm f1kw.Rd | grep s-keyword
>>       %
>> 
>> The fix:
>>    The problem is that the line
>>       if ($#keywords > 0) {
>>    should use >= 0 to tell if the list @keywords is non-empty.
>> 
>> *** share/perl/R/Rdconv.pm	2006-05-23 08:51:16.000000000 -0700
>> --- /tmp/Rdconv.pm	2006-06-30 11:51:53.000000000 -0700
>> ***************
>> *** 2965,2971 ****
>>       Ssgm_print_block_named("references", "References");
>>       Ssgm_print_seealso();
>>       Ssgm_print_examples();
>> !     if ($#keywords > 0) {
>>   	print $sgmlout "<s-keywords>\n";
>>   	while ($#keywords >= 0) {
>>   	    print $sgmlout "<s-keyword>", shift( @keywords ),
>> --- 2965,2971 ----
>>       Ssgm_print_block_named("references", "References");
>>       Ssgm_print_seealso();
>>       Ssgm_print_examples();
>> !     if ($#keywords >= 0) {
>>   	print $sgmlout "<s-keywords>\n";
>>   	while ($#keywords >= 0) {
>>   	    print $sgmlout "<s-keyword>", shift( @keywords ),
>> 
>> 
>> --please do not edit the information below--
>> 
>> Version:
>>  platform = i686-pc-linux-gnu
>>  arch = i686
>>  os = linux-gnu
>>  system = i686, linux-gnu
>>  status = Under development (unstable)
>>  major = 2
>>  minor = 4.0
>>  year = 2006
>>  month = 06
>>  day = 29
>>  svn rev = 38459
>>  language = R
>>  version.string = R version 2.4.0 Under development (unstable) (2006-06-29 r38459)
>> 
>> Locale:
>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>> 
>> Search Path:
>>  .GlobalEnv, package:methods, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, Autoloads, package:base
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From jori.mantysalo at uta.fi  Sat Jul  1 19:49:24 2006
From: jori.mantysalo at uta.fi (jori.mantysalo at uta.fi)
Date: Sat,  1 Jul 2006 19:49:24 +0200 (CEST)
Subject: [Rd] Installation, permissions of /usr/local/lib/R (PR#9054)
Message-ID: <20060701174924.BF97750842@slim.kubism.ku.dk>

Full_Name: Jori M?ntysalo
Version: 2.3.1
OS: Linux, GNU/Debian stable
Submission from: (NULL) (81.197.171.182)


I said
./configure --with-readline=no --with-x=no
make
make install

and everything works except that /usr/local/lib/R/etc/ldpaths was not readable
as normal user.


From longor at iastate.edu  Sat Jul  1 21:13:47 2006
From: longor at iastate.edu (longor at iastate.edu)
Date: Sat,  1 Jul 2006 21:13:47 +0200 (CEST)
Subject: [Rd] noncentral F-distributed random numbers (PR#9055)
Message-ID: <20060701191347.47E8950A21@slim.kubism.ku.dk>

Full_Name: Long Qu
Version: 2.3.1
OS: Windows XP
Submission from: (NULL) (64.113.93.235)


The QQ-plot of two versions of simulating noncentral F-distributed random
numbers has quite different scales: 
> qqplot(rf(1000,2,15,3),qf(runif(1000),2,15,3))

The rf() function reads:
> rf
function (n, df1, df2, ncp = 0) 
{
    if (ncp == 0) 
        .Internal(rf(n, df1, df2))
    else rchisq(n, df1, ncp = ncp)/rchisq(n, df2)
}
<environment: namespace:stats>

where I believe both the numerator and the denominator should be divided by
their corresponding degrees of freedom. 


My suggested (slighly augmented) version is:
> rf=
function (n, df1, df2, ncp1 = 0, ncp2=0) 
{
    if (ncp1 == 0 && ncp2==0) 
        .Internal(rf(n, df1, df2))
    else if (ncp2==0) 
          (rchisq(n, df1, ncp = ncp1)/df1)/(rchisq(n, df2)/df2)
    else  (rchisq(n, df1, ncp = ncp1)/df1)/(rchisq(n, df2, ncp=ncp2)/df2)

}

which incorporated both singly and doubly noncentral F-distribution. 


> version
               _                         
platform       i386-pc-mingw32           
arch           i386                      
os             mingw32                   
system         i386, mingw32             
status                                   
major          2                         
minor          3.1                       
year           2006                      
month          06                        
day            01                        
svn rev        38247                     
language       R                         
version.string Version 2.3.1 (2006-06-01)



Regards, 
Long Qu


From gregor.gorjanc at gmail.com  Sun Jul  2 03:00:33 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Sun, 02 Jul 2006 03:00:33 +0200
Subject: [Rd] Test for argument in ...
Message-ID: <44A71AB1.4000804@bfro.uni-lj.si>

Hello!

Say I have a function foo1, which has argument ... to pass various
arguments to foo2 i.e.

foo1 <- function(x, ...)
{
  foo2(x, ...)
}

Say that foo2 accepts argument arg1 and I would like to do the following:
- if foo1 is called as foo1(x) then I would like to assign some value to
arg1 inside foo1 before calling foo2

arg1 <- "some value"
foo2(x, arg1=arg1)

- if foo1 is called foo1(arg1="some other value") do not assign some
value to arg1 and call foo2

foo2(arg1=arg1)

However, I am not able to do this since I do not know how to test/check
if arg1 was given in foo1. Is it possible to test whether some argument
was passed in "..." i.e. something like

foo1 <- function(x, ...)
{
  if(testForArgumentInThreeDots(arg1)) arg1 <- "some value"
  foo2(x, arg1=arg1, ...)
}

Thanks!

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From ggrothendieck at gmail.com  Sun Jul  2 03:56:34 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 1 Jul 2006 21:56:34 -0400
Subject: [Rd] Test for argument in ...
In-Reply-To: <44A71AB1.4000804@bfro.uni-lj.si>
References: <44A71AB1.4000804@bfro.uni-lj.si>
Message-ID: <971536df0607011856m10f64854qd8f42c5de15d7387@mail.gmail.com>

Try this:

> f <- function(...) if (!is.null(list(...)$arg1)) cat("arg1 found\n") else cat("arg1 not found\n")
> f(arg1 = 3)
arg1 found
> f(arg2 = 3)
arg1 not found

On 7/1/06, Gregor Gorjanc <gregor.gorjanc at gmail.com> wrote:
> Hello!
>
> Say I have a function foo1, which has argument ... to pass various
> arguments to foo2 i.e.
>
> foo1 <- function(x, ...)
> {
>  foo2(x, ...)
> }
>
> Say that foo2 accepts argument arg1 and I would like to do the following:
> - if foo1 is called as foo1(x) then I would like to assign some value to
> arg1 inside foo1 before calling foo2
>
> arg1 <- "some value"
> foo2(x, arg1=arg1)
>
> - if foo1 is called foo1(arg1="some other value") do not assign some
> value to arg1 and call foo2
>
> foo2(arg1=arg1)
>
> However, I am not able to do this since I do not know how to test/check
> if arg1 was given in foo1. Is it possible to test whether some argument
> was passed in "..." i.e. something like
>
> foo1 <- function(x, ...)
> {
>  if(testForArgumentInThreeDots(arg1)) arg1 <- "some value"
>  foo2(x, arg1=arg1, ...)
> }
>
> Thanks!
>
> --
> Lep pozdrav / With regards,
>    Gregor Gorjanc
>
> ----------------------------------------------------------------------
> University of Ljubljana     PhD student
> Biotechnical Faculty
> Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
> Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si
>
> SI-1230 Domzale             tel: +386 (0)1 72 17 861
> Slovenia, Europe            fax: +386 (0)1 72 17 888
>
> ----------------------------------------------------------------------
> "One must learn by doing the thing; for though you think you know it,
>  you have no certainty until you try." Sophocles ~ 450 B.C.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From gregor.gorjanc at gmail.com  Sun Jul  2 04:17:42 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Sun, 02 Jul 2006 04:17:42 +0200
Subject: [Rd] Test for argument in ...
In-Reply-To: <971536df0607011856m10f64854qd8f42c5de15d7387@mail.gmail.com>
References: <44A71AB1.4000804@bfro.uni-lj.si>
	<971536df0607011856m10f64854qd8f42c5de15d7387@mail.gmail.com>
Message-ID: <44A72CC6.3080909@bfro.uni-lj.si>

Gabor Grothendieck wrote:
> Try this:
> 
>> f <- function(...) if (!is.null(list(...)$arg1)) cat("arg1 found\n")
>> else cat("arg1 not found\n")
>> f(arg1 = 3)
> arg1 found
>> f(arg2 = 3)
> arg1 not found

Thanks!

Use of list(...) really helps me here.

> On 7/1/06, Gregor Gorjanc <gregor.gorjanc at gmail.com> wrote:
>> Hello!
>>
>> Say I have a function foo1, which has argument ... to pass various
>> arguments to foo2 i.e.
>>
>> foo1 <- function(x, ...)
>> {
>>  foo2(x, ...)
>> }
>>
>> Say that foo2 accepts argument arg1 and I would like to do the following:
>> - if foo1 is called as foo1(x) then I would like to assign some value to
>> arg1 inside foo1 before calling foo2
>>
>> arg1 <- "some value"
>> foo2(x, arg1=arg1)
>>
>> - if foo1 is called foo1(arg1="some other value") do not assign some
>> value to arg1 and call foo2
>>
>> foo2(arg1=arg1)
>>
>> However, I am not able to do this since I do not know how to test/check
>> if arg1 was given in foo1. Is it possible to test whether some argument
>> was passed in "..." i.e. something like
>>
>> foo1 <- function(x, ...)
>> {
>>  if(testForArgumentInThreeDots(arg1)) arg1 <- "some value"
>>  foo2(x, arg1=arg1, ...)
>> }
>>
>> Thanks!
>>
>> -- 
>> Lep pozdrav / With regards,
>>    Gregor Gorjanc
>>
>> ----------------------------------------------------------------------
>> University of Ljubljana     PhD student
>> Biotechnical Faculty
>> Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
>> Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si
>>
>> SI-1230 Domzale             tel: +386 (0)1 72 17 861
>> Slovenia, Europe            fax: +386 (0)1 72 17 888
>>
>> ----------------------------------------------------------------------
>> "One must learn by doing the thing; for though you think you know it,
>>  you have no certainty until you try." Sophocles ~ 450 B.C.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From gregor.gorjanc at gmail.com  Sun Jul  2 04:59:28 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Sun, 02 Jul 2006 04:59:28 +0200
Subject: [Rd] Test for argument in ...
In-Reply-To: <971536df0607011856m10f64854qd8f42c5de15d7387@mail.gmail.com>
References: <44A71AB1.4000804@bfro.uni-lj.si>
	<971536df0607011856m10f64854qd8f42c5de15d7387@mail.gmail.com>
Message-ID: <44A73690.5060205@bfro.uni-lj.si>

Hi,

Gabor Grothendieck wrote:
> Try this:
> 
>> f <- function(...) if (!is.null(list(...)$arg1)) cat("arg1 found\n")
>> else cat("arg1 not found\n")
>> f(arg1 = 3)
> arg1 found
>> f(arg2 = 3)
> arg1 not found

Actually it is not OK. Bellow is simplified example that shows, what I
would like to do:

foo1 <- function(x, ...)
{
  if(is.null(list(...)$decreasing)) {
    decreasing <- TRUE
  } else {
    decreasing <- list(...)$decreasing
  }
  return(order(x, ..., decreasing=decreasing))
}

> foo1(c(5, 2, 3, 4))
[1] 1 4 3 2

>foo1(c(5, 2, 3, 4), decreasing=FALSE)
Error in order(x, ..., decreasing = decreasing) :
        formal argument "decreasing" matched by multiple actual arguments

> On 7/1/06, Gregor Gorjanc <gregor.gorjanc at gmail.com> wrote:
>> Hello!
>>
>> Say I have a function foo1, which has argument ... to pass various
>> arguments to foo2 i.e.
>>
>> foo1 <- function(x, ...)
>> {
>>  foo2(x, ...)
>> }
>>
>> Say that foo2 accepts argument arg1 and I would like to do the following:
>> - if foo1 is called as foo1(x) then I would like to assign some value to
>> arg1 inside foo1 before calling foo2
>>
>> arg1 <- "some value"
>> foo2(x, arg1=arg1)
>>
>> - if foo1 is called foo1(arg1="some other value") do not assign some
>> value to arg1 and call foo2
>>
>> foo2(arg1=arg1)
>>
>> However, I am not able to do this since I do not know how to test/check
>> if arg1 was given in foo1. Is it possible to test whether some argument
>> was passed in "..." i.e. something like
>>
>> foo1 <- function(x, ...)
>> {
>>  if(testForArgumentInThreeDots(arg1)) arg1 <- "some value"
>>  foo2(x, arg1=arg1, ...)
>> }
>>
>> Thanks!
>>
>> -- 
>> Lep pozdrav / With regards,
>>    Gregor Gorjanc
>>
>> ----------------------------------------------------------------------
>> University of Ljubljana     PhD student
>> Biotechnical Faculty
>> Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
>> Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si
>>
>> SI-1230 Domzale             tel: +386 (0)1 72 17 861
>> Slovenia, Europe            fax: +386 (0)1 72 17 888
>>
>> ----------------------------------------------------------------------
>> "One must learn by doing the thing; for though you think you know it,
>>  you have no certainty until you try." Sophocles ~ 450 B.C.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From ggrothendieck at gmail.com  Sun Jul  2 05:19:21 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 1 Jul 2006 23:19:21 -0400
Subject: [Rd] Test for argument in ...
In-Reply-To: <44A73690.5060205@bfro.uni-lj.si>
References: <44A71AB1.4000804@bfro.uni-lj.si>
	<971536df0607011856m10f64854qd8f42c5de15d7387@mail.gmail.com>
	<44A73690.5060205@bfro.uni-lj.si>
Message-ID: <971536df0607012019n183955fen188287d184c9d03e@mail.gmail.com>

That's because you are passing the argument twice.  Try this:

> foo1 <- function(x, ...)
+ {
+  L <- list(...)
+  if (is.null(L$decreasing)) L$decreasing <- TRUE
+  do.call(order, c(list(x), L))
+ }
>
> foo1(c(5, 2, 3, 4), decreasing=FALSE)
[1] 2 3 4 1

On 7/1/06, Gregor Gorjanc <gregor.gorjanc at gmail.com> wrote:
> Hi,
>
> Gabor Grothendieck wrote:
> > Try this:
> >
> >> f <- function(...) if (!is.null(list(...)$arg1)) cat("arg1 found\n")
> >> else cat("arg1 not found\n")
> >> f(arg1 = 3)
> > arg1 found
> >> f(arg2 = 3)
> > arg1 not found
>
> Actually it is not OK. Bellow is simplified example that shows, what I
> would like to do:
>
> foo1 <- function(x, ...)
> {
>  if(is.null(list(...)$decreasing)) {
>    decreasing <- TRUE
>  } else {
>    decreasing <- list(...)$decreasing
>  }
>  return(order(x, ..., decreasing=decreasing))
> }
>
> > foo1(c(5, 2, 3, 4))
> [1] 1 4 3 2
>
> >foo1(c(5, 2, 3, 4), decreasing=FALSE)
> Error in order(x, ..., decreasing = decreasing) :
>        formal argument "decreasing" matched by multiple actual arguments
>
> > On 7/1/06, Gregor Gorjanc <gregor.gorjanc at gmail.com> wrote:
> >> Hello!
> >>
> >> Say I have a function foo1, which has argument ... to pass various
> >> arguments to foo2 i.e.
> >>
> >> foo1 <- function(x, ...)
> >> {
> >>  foo2(x, ...)
> >> }
> >>
> >> Say that foo2 accepts argument arg1 and I would like to do the following:
> >> - if foo1 is called as foo1(x) then I would like to assign some value to
> >> arg1 inside foo1 before calling foo2
> >>
> >> arg1 <- "some value"
> >> foo2(x, arg1=arg1)
> >>
> >> - if foo1 is called foo1(arg1="some other value") do not assign some
> >> value to arg1 and call foo2
> >>
> >> foo2(arg1=arg1)
> >>
> >> However, I am not able to do this since I do not know how to test/check
> >> if arg1 was given in foo1. Is it possible to test whether some argument
> >> was passed in "..." i.e. something like
> >>
> >> foo1 <- function(x, ...)
> >> {
> >>  if(testForArgumentInThreeDots(arg1)) arg1 <- "some value"
> >>  foo2(x, arg1=arg1, ...)
> >> }
> >>
> >> Thanks!
> >>
> >> --
> >> Lep pozdrav / With regards,
> >>    Gregor Gorjanc
> >>
> >> ----------------------------------------------------------------------
> >> University of Ljubljana     PhD student
> >> Biotechnical Faculty
> >> Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
> >> Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si
> >>
> >> SI-1230 Domzale             tel: +386 (0)1 72 17 861
> >> Slovenia, Europe            fax: +386 (0)1 72 17 888
> >>
> >> ----------------------------------------------------------------------
> >> "One must learn by doing the thing; for though you think you know it,
> >>  you have no certainty until you try." Sophocles ~ 450 B.C.
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
>
>
> --
> Lep pozdrav / With regards,
>    Gregor Gorjanc
>
> ----------------------------------------------------------------------
> University of Ljubljana     PhD student
> Biotechnical Faculty
> Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
> Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si
>
> SI-1230 Domzale             tel: +386 (0)1 72 17 861
> Slovenia, Europe            fax: +386 (0)1 72 17 888
>
> ----------------------------------------------------------------------
> "One must learn by doing the thing; for though you think you know it,
>  you have no certainty until you try." Sophocles ~ 450 B.C.
> ----------------------------------------------------------------------
>
>


From btyner at gmail.com  Sun Jul  2 05:21:44 2006
From: btyner at gmail.com (Benjamin Tyner)
Date: Sat, 01 Jul 2006 23:21:44 -0400
Subject: [Rd] prefix 'R_' when calling external code
Message-ID: <44A73BC8.5080901@stat.purdue.edu>

I noticed that in

https://svn.r-project.org/R/trunk/src/library/stats/R/loess.R

that we are now calling R_loess_raw, R_lowesw, R_lowesp, etc. I'm 
interested to know what is the benefit/reason for the 'R_', as I am 
unfamiliar with this prefix and do not see it mentioned in 'Writing R 
Extensions.'

Thanks,
Ben


From znmeb at cesmail.net  Sun Jul  2 10:21:08 2006
From: znmeb at cesmail.net (M. Edward (Ed) Borasky)
Date: Sun, 02 Jul 2006 01:21:08 -0700
Subject: [Rd] An offer: R packages in Gentoo Land?
In-Reply-To: <86k671au2q.fsf@ufl.edu>
References: <86k671au2q.fsf@ufl.edu>
Message-ID: <44A781F4.9050302@cesmail.net>

Allen S. Rout wrote:
> Greetings.  I love R, we run Gentoo.  I want to maintain R packages in
> the same methods I use for the rest of them; in Gentoo this is in "the
> portage tree", or in "a portage overlay".
>
> I am working towards something I consider suitable for production
> release, and wanted to ask if there are conventional blessings which I
> ought to ask of the R-devel folks; How does this usually go, in
> R-land?
>
> Are there other developeRs who run Gentoo who would be willing to
> kibitz?
>   
I'm neither an R nor a Gentoo developer but I run Gentoo and R and would
welcome an integrated Portage/CRAN/Bioconductor package management
system. I would recommend joining the "gentoo-science" mailing list.
Email me off list if you'd like an introduction.

-- 
M. Edward (Ed) Borasky

http://linuxcapacityplanning.com


From jombart at biomserv.univ-lyon1.fr  Sun Jul  2 10:53:24 2006
From: jombart at biomserv.univ-lyon1.fr (Thibaut Jombart)
Date: Sun, 02 Jul 2006 10:53:24 +0200
Subject: [Rd] Installation, permissions of /usr/local/lib/R (PR#9054)
In-Reply-To: <20060701174924.BF97750842@slim.kubism.ku.dk>
References: <20060701174924.BF97750842@slim.kubism.ku.dk>
Message-ID: <44A78984.10606@biomserv.univ-lyon1.fr>

jori.mantysalo at uta.fi wrote:

>Full_Name: Jori M?ntysalo
>Version: 2.3.1
>OS: Linux, GNU/Debian stable
>Submission from: (NULL) (81.197.171.182)
>
>
>I said
>./configure --with-readline=no --with-x=no
>make
>make install
>
>and everything works except that /usr/local/lib/R/etc/ldpaths was not readable
>as normal user.
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
>  
>
You don't say if you installed R as root or as a normal user.
Did you try:
chown your-user-name /usr/local/lib/R/ -R
?

Or, if you intend to make R available to several users, create a R users 
group and then type the previous command replacing "your-user-name" by 
"R-users-group-name". Maybe this would help.

Thibaut.


-- 
######################################
Thibaut JOMBART
CNRS UMR 5558 - Laboratoire de Biom?trie et Biologie Evolutive
Universite Lyon 1
43 bd du 11 novembre 1918
69622 Villeurbanne Cedex
T?l. : 04.72.43.29.35
Fax : 04.72.43.13.88
jombart at biomserv.univ-lyon1.fr
http://biomserv.univ-lyon1.fr/sitelabo/pageperso.php?id_personne=178


From p.dalgaard at biostat.ku.dk  Sun Jul  2 11:13:37 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 02 Jul 2006 11:13:37 +0200
Subject: [Rd] Installation, permissions of /usr/local/lib/R (PR#9054)
In-Reply-To: <44A78984.10606@biomserv.univ-lyon1.fr>
References: <20060701174924.BF97750842@slim.kubism.ku.dk>
	<44A78984.10606@biomserv.univ-lyon1.fr>
Message-ID: <x2lkrctlmm.fsf@turmalin.kubism.ku.dk>

Thibaut Jombart <jombart at biomserv.univ-lyon1.fr> writes:

> jori.mantysalo at uta.fi wrote:
> 
> >I said
> >./configure --with-readline=no --with-x=no
> >make
> >make install
> >
> >and everything works except that /usr/local/lib/R/etc/ldpaths was not readable
> >as normal user.

> You don't say if you installed R as root or as a normal user.
> Did you try:
> chown your-user-name /usr/local/lib/R/ -R
> ?
> 
> Or, if you intend to make R available to several users, create a R users 
> group and then type the previous command replacing "your-user-name" by 
> "R-users-group-name". Maybe this would help.

More likely, the umask setting was too restrictive during make
install. AFAIR, "umask 022" (i.e. no write permission for anyone
except user, but read and execute allowed) is needed to enable
non-root users to run R. Some systems set it differently, and we're
not overriding that since it could be a policy issue. It's not a bug.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From p.dalgaard at biostat.ku.dk  Sun Jul  2 11:13:45 2006
From: p.dalgaard at biostat.ku.dk (p.dalgaard at biostat.ku.dk)
Date: Sun,  2 Jul 2006 11:13:45 +0200 (CEST)
Subject: [Rd] Installation, permissions of /usr/local/lib/R (PR#9054)
Message-ID: <20060702091345.C9B5F539E1@slim.kubism.ku.dk>

Thibaut Jombart <jombart at biomserv.univ-lyon1.fr> writes:

> jori.mantysalo at uta.fi wrote:
> 
> >I said
> >./configure --with-readline=no --with-x=no
> >make
> >make install
> >
> >and everything works except that /usr/local/lib/R/etc/ldpaths was not readable
> >as normal user.

> You don't say if you installed R as root or as a normal user.
> Did you try:
> chown your-user-name /usr/local/lib/R/ -R
> ?
> 
> Or, if you intend to make R available to several users, create a R users 
> group and then type the previous command replacing "your-user-name" by 
> "R-users-group-name". Maybe this would help.

More likely, the umask setting was too restrictive during make
install. AFAIR, "umask 022" (i.e. no write permission for anyone
except user, but read and execute allowed) is needed to enable
non-root users to run R. Some systems set it differently, and we're
not overriding that since it could be a policy issue. It's not a bug.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From gregor.gorjanc at gmail.com  Sun Jul  2 12:43:08 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Sun, 02 Jul 2006 12:43:08 +0200
Subject: [Rd] Test for argument in ...
In-Reply-To: <971536df0607012019n183955fen188287d184c9d03e@mail.gmail.com>
References: <44A71AB1.4000804@bfro.uni-lj.si>	
	<971536df0607011856m10f64854qd8f42c5de15d7387@mail.gmail.com>	
	<44A73690.5060205@bfro.uni-lj.si>
	<971536df0607012019n183955fen188287d184c9d03e@mail.gmail.com>
Message-ID: <44A7A33C.3010402@bfro.uni-lj.si>

Yes, this works.

Thanks Gabor!

Gabor Grothendieck wrote:
> That's because you are passing the argument twice.  Try this:
> 
>> foo1 <- function(x, ...)
> + {
> +  L <- list(...)
> +  if (is.null(L$decreasing)) L$decreasing <- TRUE
> +  do.call(order, c(list(x), L))
> + }
>>
>> foo1(c(5, 2, 3, 4), decreasing=FALSE)
> [1] 2 3 4 1

> 
> On 7/1/06, Gregor Gorjanc <gregor.gorjanc at gmail.com> wrote:
>> Hi,
>>
>> Gabor Grothendieck wrote:
>> > Try this:
>> >
>> >> f <- function(...) if (!is.null(list(...)$arg1)) cat("arg1 found\n")
>> >> else cat("arg1 not found\n")
>> >> f(arg1 = 3)
>> > arg1 found
>> >> f(arg2 = 3)
>> > arg1 not found
>>
>> Actually it is not OK. Bellow is simplified example that shows, what I
>> would like to do:
>>
>> foo1 <- function(x, ...)
>> {
>>  if(is.null(list(...)$decreasing)) {
>>    decreasing <- TRUE
>>  } else {
>>    decreasing <- list(...)$decreasing
>>  }
>>  return(order(x, ..., decreasing=decreasing))
>> }
>>
>> > foo1(c(5, 2, 3, 4))
>> [1] 1 4 3 2
>>
>> >foo1(c(5, 2, 3, 4), decreasing=FALSE)
>> Error in order(x, ..., decreasing = decreasing) :
>>        formal argument "decreasing" matched by multiple actual arguments
>>
>> > On 7/1/06, Gregor Gorjanc <gregor.gorjanc at gmail.com> wrote:
>> >> Hello!
>> >>
>> >> Say I have a function foo1, which has argument ... to pass various
>> >> arguments to foo2 i.e.
>> >>
>> >> foo1 <- function(x, ...)
>> >> {
>> >>  foo2(x, ...)
>> >> }
>> >>
>> >> Say that foo2 accepts argument arg1 and I would like to do the
>> following:
>> >> - if foo1 is called as foo1(x) then I would like to assign some
>> value to
>> >> arg1 inside foo1 before calling foo2
>> >>
>> >> arg1 <- "some value"
>> >> foo2(x, arg1=arg1)
>> >>
>> >> - if foo1 is called foo1(arg1="some other value") do not assign some
>> >> value to arg1 and call foo2
>> >>
>> >> foo2(arg1=arg1)
>> >>
>> >> However, I am not able to do this since I do not know how to
>> test/check
>> >> if arg1 was given in foo1. Is it possible to test whether some
>> argument
>> >> was passed in "..." i.e. something like
>> >>
>> >> foo1 <- function(x, ...)
>> >> {
>> >>  if(testForArgumentInThreeDots(arg1)) arg1 <- "some value"
>> >>  foo2(x, arg1=arg1, ...)
>> >> }
>> >>
>> >> Thanks!

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From gregor.gorjanc at gmail.com  Sun Jul  2 22:21:48 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Sun, 02 Jul 2006 22:21:48 +0200
Subject: [Rd] Test for argument in ...
In-Reply-To: <Pine.GSO.4.56.0607021220220.8511@durian.statsci.com>
References: <44A71AB1.4000804@bfro.uni-lj.si>
	<971536df0607011856m10f64854qd8f42c5de15d7387@mail.gmail.com>
	<44A73690.5060205@bfro.uni-lj.si>
	<971536df0607012019n183955fen188287d184c9d03e@mail.gmail.com>
	<44A7A33C.3010402@bfro.uni-lj.si>
	<Pine.GSO.4.56.0607021220220.8511@durian.statsci.com>
Message-ID: <44A82ADC.1060900@bfro.uni-lj.si>

Bill Dunlap wrote:
> On Sun, 2 Jul 2006, Gregor Gorjanc wrote:
> 
>> Yes, this works.
>>
>> Thanks Gabor!
>>
>> Gabor Grothendieck wrote:
>>> That's because you are passing the argument twice.  Try this:
>>>
>>>> foo1 <- function(x, ...)
>>> + {
>>> +  L <- list(...)
>>> +  if (is.null(L$decreasing)) L$decreasing <- TRUE
>>> +  do.call(order, c(list(x), L))
>>> + }
>>>> foo1(c(5, 2, 3, 4), decreasing=FALSE)
>>> [1] 2 3 4 1
> 
> How does this differ from
>    foo2 <- function(x, ..., decreasing=TRUE)
>       order(x, ..., decreasing = decreasing)
> ?

I agree, but I wanted to learn ... argument in a more general way. That
was just an example - not a good one as you have showed.

>> x<-c(5,2,3,4)
>> identical(foo2(x), foo1(x))
> [1] TRUE
>> identical(foo2(x,decreasing=F), foo1(x,decreasing=F))
> [1] TRUE
>> identical(foo2(x,decreasing=T), foo1(x,decreasing=T))
> [1] TRUE

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From gregor.gorjanc at gmail.com  Mon Jul  3 02:24:02 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Mon, 03 Jul 2006 02:24:02 +0200
Subject: [Rd] "Template" for model.matrix functions
Message-ID: <44A863A2.40502@bfro.uni-lj.si>

Hello!

I would like to write a function that would create a (part) of a model
matrix to be used in lm() like functions i.e

lm(y ~ myFunc(x))

Where can I find a good example or a template for this as well as for
predict method?

Thanks!

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From jjonphl at gmail.com  Mon Jul  3 03:43:12 2006
From: jjonphl at gmail.com (miguel manese)
Date: Mon, 3 Jul 2006 09:43:12 +0800
Subject: [Rd] Package Unit Testing
Message-ID: <d35b9da60607021843j5ec840e5j3b69bde225bfa195@mail.gmail.com>

Hello,

Do we have like an official unit testing framework for packages? Like
we do R CMD check, and say the scripts in <pkg>/test are executed? Or
do we roll out our own outside the package?

Thanks,
M. Manese


From ligges at statistik.uni-dortmund.de  Mon Jul  3 08:52:58 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Mon, 03 Jul 2006 08:52:58 +0200
Subject: [Rd] Package Unit Testing
In-Reply-To: <d35b9da60607021843j5ec840e5j3b69bde225bfa195@mail.gmail.com>
References: <d35b9da60607021843j5ec840e5j3b69bde225bfa195@mail.gmail.com>
Message-ID: <44A8BECA.9070604@statistik.uni-dortmund.de>

miguel manese wrote:
> Hello,
> 
> Do we have like an official unit testing framework for packages? Like
> we do R CMD check, and say the scripts in <pkg>/test are executed?

The scripts are executed with R CMD check. What else do you need?

Uwe Ligges

> Or do we roll out our own outside the package?
> 
> Thanks,
> M. Manese
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Mon Jul  3 09:13:46 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 3 Jul 2006 09:13:46 +0200
Subject: [Rd] Package Unit Testing
In-Reply-To: <d35b9da60607021843j5ec840e5j3b69bde225bfa195@mail.gmail.com>
References: <d35b9da60607021843j5ec840e5j3b69bde225bfa195@mail.gmail.com>
Message-ID: <17576.50090.402802.304218@stat.math.ethz.ch>

>>>>> "miguel" == miguel manese <jjonphl at gmail.com>
>>>>>     on Mon, 3 Jul 2006 09:43:12 +0800 writes:

    miguel> Hello, Do we have like an official unit testing
    miguel> framework for packages? Like we do R CMD check, and
    miguel> say the scripts in <pkg>/test are executed? 

yes.  Just it's  "./tests",  not './test'.

More specifically, all ./tests/*.R are executed and for those
foobar.R for which there's a  foobar.Rout.save  file,
the output is (R CMD Rdiff)ed agains the result of running foobar.R

All this should be pretty obvious from the manual
"Writing R Extensions".  
What was it in there that was not clear enough?

    miguel> Or do we roll out our own outside the package?

Some people use the 'RUnit' package in addition or -- unfortunately --
alternatively to the "official" testing procedures via the
"./tests" directory.

Martin Maechler, ETH Zurich


From Jori.Mantysalo at uta.fi  Mon Jul  3 11:55:14 2006
From: Jori.Mantysalo at uta.fi (Jori Mantysalo)
Date: Mon, 3 Jul 2006 12:55:14 +0300 (EEST)
Subject: [Rd] Installation, permissions of /usr/local/lib/R (PR#9054)
In-Reply-To: <x2lkrctlmm.fsf@turmalin.kubism.ku.dk>
References: <20060701174924.BF97750842@slim.kubism.ku.dk>
	<44A78984.10606@biomserv.univ-lyon1.fr>
	<x2lkrctlmm.fsf@turmalin.kubism.ku.dk>
Message-ID: <Pine.GSO.4.63.0607031253300.4084@kielo.uta.fi>

On Sun, 2 Jul 2006, Peter Dalgaard wrote:

>>> make install
>>>
>>> and everything works except that /usr/local/lib/R/etc/ldpaths was not readable
>>> as normal user.

> More likely, the umask setting was too restrictive during make
> install. AFAIR, "umask 022" (i.e. no write permission for anyone
> except user, but read and execute allowed) is needed to enable
> non-root users to run R. Some systems set it differently, and we're
> not overriding that since it could be a policy issue. It's not a bug.

Yep, umask was 077. Maybe 'make install' might warn about that after 
installation?

-- 
Jori M?ntysalo


From Jori.Mantysalo at uta.fi  Mon Jul  3 11:55:56 2006
From: Jori.Mantysalo at uta.fi (Jori.Mantysalo at uta.fi)
Date: Mon,  3 Jul 2006 11:55:56 +0200 (CEST)
Subject: [Rd] Installation, permissions of /usr/local/lib/R (PR#9054)
Message-ID: <20060703095556.83A4553B61@slim.kubism.ku.dk>

On Sun, 2 Jul 2006, Peter Dalgaard wrote:

>>> make install
>>>
>>> and everything works except that /usr/local/lib/R/etc/ldpaths was not readable
>>> as normal user.

> More likely, the umask setting was too restrictive during make
> install. AFAIR, "umask 022" (i.e. no write permission for anyone
> except user, but read and execute allowed) is needed to enable
> non-root users to run R. Some systems set it differently, and we're
> not overriding that since it could be a policy issue. It's not a bug.

Yep, umask was 077. Maybe 'make install' might warn about that after 
installation?

-- 
Jori M?ntysalo


From maechler at stat.math.ethz.ch  Mon Jul  3 12:00:29 2006
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Mon,  3 Jul 2006 12:00:29 +0200 (CEST)
Subject: [Rd] plot with NAs in x and type="s" (PR#9046)
Message-ID: <20060703100029.D280A53B62@slim.kubism.ku.dk>

>>>>> "ReneL" == Rene Locher <lor at zhwin.ch>
>>>>>     on Fri, 30 Jun 2006 15:26:18 +0200 (CEST) writes:

    ReneL> Full_Name: Ren? Locher Version: Version 2.3.1
    ReneL> (2006-06-01) OS: i386, mingw32 Submission from:
    ReneL> (NULL) (160.85.104.70)

    ReneL> The problem seems to occur only, when you want to
    ReneL> plot a vector containing a NA value at position 2 and
    ReneL> the plotting type is "s" or "S".

Yes, thank you, Ren?.

An even simpler example is

   plot(0 / -1:1, type = "s")

This will be fixed in R-patched and R-devel as of tomorrow's
snapshots.

Martin Maechler, ETH Zurich


    ReneL> ## start of code

    ReneL> O3<-c(0.8,NA,0.7,1.1,0.9,5.5,1.3,1,1.2)

    ReneL> ## The following error is reported with the two commands below:
    ReneL> ## Error in plot.xy(xy, type, ...) : unable to allocate memory (in GPolygon)

    ReneL> plot(O3,type="s")
    ReneL> plot(O3,type="S")

    ReneL> ## The following commands work without problems
    ReneL> plot(O3,type="l")
    ReneL> plot(c(0.6, O3),type="s")
    ReneL> plot(c(0.4,0.6, O3),type="s")
    ReneL> plot(O3[2:length(O3)], type="s")

    ReneL> ## end of code

    ReneL> Kind regards

    ReneL> Ren?


From jmc at r-project.org  Mon Jul  3 17:14:21 2006
From: jmc at r-project.org (John Chambers)
Date: Mon, 03 Jul 2006 11:14:21 -0400
Subject: [Rd] S4 object type available for testing
Message-ID: <44A9344D.5010408@r-project.org>

The default prototype object for an S4 class up to now has been a 
zero-length list (nothing else worked).  This is wrong in principle, 
because it makes the objects look like vectors to low-level C code, and 
they should not.  It may also be the cause of some inefficiency.

A new low-level type has been added for these classes.  It's currently 
available in the r-devel version, but not turned on by default.  If you 
have code that makes use of S4 objects, or C-level code that tries to 
handle all internal types, please try to test out the new feature.

To turn the feature on, set environment variable R_S4_Type to anything 
non-empty, for example in bash

$ export R_S4_Type=TRUE

before starting up R.  You can also turn the new type on and off in R by 
calling methods:::.useS4Prototype(TRUE) or FALSE.  (This is a temporary 
situation, eventually the type will be made the default.)

Note the following points.

1.  The type affects the prototype object for the class.  Therefore what 
matters is whether it's turned on when the call to setClass() takes 
place.  It has NO effect on objects generated from an existing class.  
And turning the type off has no effect until a new setClass() call.

2.  Classes that contain any of the basic R object types ("character", 
"function", etc.) are unaffected by the change.  Their prototype objects 
will still have the inherited basic type, as they should.

3. To see what the current prototype is, use defaultPrototype().  If the 
new type is on you should see:

 > defaultPrototype()
<S4 Type Object>

4. Not directly related, but some changes have been made to make 
automatic printing of S4 objects correspond more closely to a call to 
show(), as per the green book.

John


From xaiowng at yahoo.co.uk  Mon Jul  3 17:32:40 2006
From: xaiowng at yahoo.co.uk (xaiowng at yahoo.co.uk)
Date: Mon,  3 Jul 2006 17:32:40 +0200 (CEST)
Subject: [Rd] Business Offer (PR#9056)
Message-ID: <20060703153240.DDFC95397F@slim.kubism.ku.dk>

--qzsoft_directmail_seperator
Content-Type: text/plain;
	charset="DEFAULT"
Content-Transfer-Encoding: base64

RGVhciBTaXIvTWFkYW0sCiAKSSBhbSBNci5YYWlvIFdhbmcsIERpcmVjdG9yIG9mIFNoZW5nYXJk
IEVudGVycHJpc2UgQ28uLCBMdGQuIFRhaXdhbi4gV2UgYXJlIGV4cG9ydGVycyBhbmQgaW1wb3J0
ZXJzIG9mIGNoZW1pY2FsIHJhdyBtYXRlcmlhbHMgdG8gQ2FuYWRhL0FtZXJpY2EgYW5kIEV1cm9w
ZS4KIApEdWUgdG8gb3VyIGV4cGFuc2lvbiBwcm9ncmFtbWUgYW5kIHdpdGggYSB2aWV3IHRvIHNw
ZWNpYWxpemF0aW9uIGZvciBiZXR0ZXIgZWZmaWNpZW5jeSwgYW1vbmdzdCBvdGhlcnMsIHdlIGFy
ZSBzZWFyY2hpbmcgZm9yIHJlcHJlc2VudGF0aXZlcyB3aG8gY2FuIGhlbHAgdXMgZXN0YWJsaXNo
IGEgbWVkaXVtIG9mIGdldHRpbmcgdG8gb3VyCmN1c3RvbWVycyBpbiB0aGUgQ2FuYWRhL0FtZXJp
Y2EgYW5kIEV1cm9wZSBhcyB3ZWxsIGFzIG1ha2luZyBwYXltZW50cyB0aHJvdWdoIHlvdSB0byB1
cy4KIApQbGVhc2UgaWYgeW91IGFyZSBpbnRlcmVzdGVkIGluIHRyYW5zYWN0aW5nIGJ1c2luZXNz
IHdpdGggdXMgd2Ugd2lsbCBiZSB2ZXJ5IGdsYWQuIFBsZWFzZSBjb250YWN0IHVzIGZvciBtb3Jl
IGluZm9ybWF0aW9uIFN1YmplY3QgdG8geW91ciBzYXRpc2ZhY3Rpb24geW91IHdpbGwgYmUgZ2l2
ZW4gdGhlIG9wcG9ydHVuaXR5IHRvIG5lZ290aWF0ZSB5b3VyIG1vZGUgb2Ygd2hpY2ggd2Ugd2ls
bCBwYXkgZm9yIHlvdXIgc2VydmljZXMgYXMgb3VyIHJlcHJlc2VudGF0aXZlIGluIENhbmFkYS9B
bWVyaWNhIGFuZCBFdXJvcGUgKGluY2x1ZGluZyBVSykuCiAKUGxlYXNlIGlmIHlvdSBhcmUgaW50
ZXJlc3RlZDsgY29udGFjdCB1cyBhdDp4YWlvd25nQHlhaG9vLmNvLnVrICBmb3IgZnVydGhlciBp
bmZvcm1hdGlvbi4KIApUaGFua3MgSW4gYWR2YW5jZS4KIApSZWdhcmRzLApNci4gWGFpbyBXYW5n
CkRpcmVjdG9yClNoZW5nYXJkIEVudGVycHJpc2UgQ28uLCBMdGQuLApOby4gMTMsIExhbmUgMTg1
LCBEYWh1IFJkLiwKWWluZ2dlIEplbiwgVGFpcGVpLCBUYWl3YW4gMjM5LCBSLk8uQy4g

--qzsoft_directmail_seperator--


From tlumley at u.washington.edu  Mon Jul  3 18:21:29 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 3 Jul 2006 09:21:29 -0700 (PDT)
Subject: [Rd] "Template" for model.matrix functions
In-Reply-To: <44A863A2.40502@bfro.uni-lj.si>
References: <44A863A2.40502@bfro.uni-lj.si>
Message-ID: <Pine.LNX.4.64.0607030921110.21683@homer22.u.washington.edu>

On Mon, 3 Jul 2006, Gregor Gorjanc wrote:

> Hello!
>
> I would like to write a function that would create a (part) of a model
> matrix to be used in lm() like functions i.e
>
> lm(y ~ myFunc(x))
>
> Where can I find a good example or a template for this as well as for
> predict method?

I would look at bs() and ns() in the splines package.

 	-thomas


From tlumley at u.washington.edu  Mon Jul  3 20:04:43 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 3 Jul 2006 11:04:43 -0700 (PDT)
Subject: [Rd] noncentral F-distributed random numbers (PR#9055)
In-Reply-To: <20060701191347.47E8950A21@slim.kubism.ku.dk>
References: <20060701191347.47E8950A21@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0607031103200.21683@homer22.u.washington.edu>

On Sat, 1 Jul 2006, longor at iastate.edu wrote:
>
> The rf() function reads:
>> rf
> function (n, df1, df2, ncp = 0)
> {
>    if (ncp == 0)
>        .Internal(rf(n, df1, df2))
>    else rchisq(n, df1, ncp = ncp)/rchisq(n, df2)
> }
> <environment: namespace:stats>
>
> where I believe both the numerator and the denominator should be divided by
> their corresponding degrees of freedom.
>

Yes. Fixed for 2.4.0.

I didn't add a denominator non-centrality parameter, since we don't have 
code for qf, pf, or df for the doubly non-central distribution.

 	-thomas


From jjonphl at gmail.com  Mon Jul  3 23:59:06 2006
From: jjonphl at gmail.com (miguel manese)
Date: Tue, 4 Jul 2006 05:59:06 +0800
Subject: [Rd] Package Unit Testing
In-Reply-To: <17576.50090.402802.304218@stat.math.ethz.ch>
References: <d35b9da60607021843j5ec840e5j3b69bde225bfa195@mail.gmail.com>
	<17576.50090.402802.304218@stat.math.ethz.ch>
Message-ID: <d35b9da60607031459j29e5c2f9x49c7542103fa7723@mail.gmail.com>

Thanks to both of you. I found it in some obscure paragraph  (or maybe
I haven't read good enough, because after reading a couple of
paragraphs you'd think you got it already and skip the remaining) on
chapter 1, creating packages, about directory structure and on R CMD
check.

Cheers,
M. Manese

On 7/3/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> >>>>> "miguel" == miguel manese <jjonphl at gmail.com>
> >>>>>     on Mon, 3 Jul 2006 09:43:12 +0800 writes:
>
>     miguel> Hello, Do we have like an official unit testing
>     miguel> framework for packages? Like we do R CMD check, and
>     miguel> say the scripts in <pkg>/test are executed?
>
> yes.  Just it's  "./tests",  not './test'.
>
> More specifically, all ./tests/*.R are executed and for those
> foobar.R for which there's a  foobar.Rout.save  file,
> the output is (R CMD Rdiff)ed agains the result of running foobar.R
>
> All this should be pretty obvious from the manual
> "Writing R Extensions".
> What was it in there that was not clear enough?
>
>     miguel> Or do we roll out our own outside the package?
>
> Some people use the 'RUnit' package in addition or -- unfortunately --
> alternatively to the "official" testing procedures via the
> "./tests" directory.
>
> Martin Maechler, ETH Zurich
>


From jb at johnbear.net  Tue Jul  4 10:26:17 2006
From: jb at johnbear.net (jb at johnbear.net)
Date: Tue,  4 Jul 2006 10:26:17 +0200 (CEST)
Subject: [Rd] double-quote tab crashes R (PR#9058)
Message-ID: <20060704082617.C7248537E4@slim.kubism.ku.dk>

Hi,

This seems to crash my version of R:
"<TAB>

where I type a double quote, and then hit the <TAB> key.
I was playing with strsplit, and wanted to give it a vector of 
characters including newline, tab, space, and so on.

I've included the trace info from my macBook Pro (intel macintosh).


Date/Time:      2006-07-04 01:07:33.277 -0700
OS Version:     10.4.7 (Build 8J2135a)
Report Version: 4

Command: R
Path:    /Applications/R.app/Contents/MacOS/R
Parent:  WindowServer [90]

Version: 1.16 (3198)

PID:    1698
Thread: 0

Exception:  EXC_BREAKPOINT (0x0006)
Code[0]:    0x00000002
Code[1]:    0x00000000


Thread 0 Crashed:
0   com.apple.Foundation         0x9275c2d3 _NSRaiseError + 227
1   com.apple.Foundation         0x92782fd7 +[NSException raise:format:] 
+ 57
2   com.apple.Foundation         0x9272c08b -[NSString 
substringFromIndex:] + 196
3   org.R-project.R              0x000331a4 +[FileCompletion 
completeAll:cutPrefix:] + 684 (crt.c:305)
4   org.R-project.R              0x00011745 -[RController 
textView:completions:forPartialWordRange:indexOfSelectedItem:] + 586 
(crt.c:305)
5   com.apple.AppKit             0x93808d15 
-[NSTextView(NSKeyBindingCommands) 
completionsForPartialWordRange:indexOfSelectedItem:] + 1002
6   com.apple.AppKit             0x93808202 
-[NSTextView(NSKeyBindingCommands) complete:] + 317
7   org.R-project.R              0x00011f8f -[RController 
textView:doCommandBySelector:] + 1344 (crt.c:305)
8   com.apple.AppKit             0x9346e1bf -[NSTextView 
doCommandBySelector:] + 182
9   com.apple.AppKit             0x93463965 
-[NSKeyBindingManager(NSKeyBindingManager_MultiClients) 
interpretEventAsCommand:forClient:] + 1932
10  com.apple.AppKit             0x93461ed1 -[NSTSMInputContext 
interpretKeyEvents:] + 1157
11  com.apple.AppKit             0x93461276 -[NSView 
interpretKeyEvents:] + 65
12  com.apple.AppKit             0x93461164 -[NSTextView keyDown:] + 1061
13  org.R-project.R              0x0001c2e4 -[RTextView keyDown:] + 150 
(crt.c:305)
14  com.apple.AppKit             0x93460ce9 -[NSWindow sendEvent:] + 7377
15  com.apple.AppKit             0x93452524 -[NSApplication sendEvent:] 
+ 5023
16  org.R-project.R              0x0000dfbe -[RController 
doProcessEvents:] + 278 (crt.c:305)
17  org.R-project.R              0x0000b5be -[RController 
handleReadConsole:] + 84 (crt.c:305)
18  org.R-project.R              0x0002f096 Re_ReadConsole + 423 (crt.c:305)
19  org.R-project.R              0x000355bb run_REngineRmainloop + 516 
(crt.c:305)
20  org.R-project.R              0x0002d9f7 -[REngine runREPL] + 49 
(crt.c:305)
21  org.R-project.R              0x0001f66d main + 616 (crt.c:305)
22  org.R-project.R              0x0000200e _start + 228 (crt.c:272)
23  org.R-project.R              0x00001f29 start + 41

Thread 1:
0   libSystem.B.dylib            0x9000a5c7 mach_msg_trap + 7
1   com.apple.CoreFoundation     0x9082369a CFRunLoopRunSpecific + 2014
2   com.apple.CoreFoundation     0x90822eb5 CFRunLoopRunInMode + 61
3   com.apple.Foundation         0x92778559 -[NSConnection 
sendInvocation:] + 2126
4   com.apple.Foundation         0x9272f324 
-[NSObject(NSForwardInvocation) forward::] + 469
5   libobjc.A.dylib              0x90a51ba1 _objc_msgForward + 49
6   com.apple.Foundation         0x9277798b -[NSDistantObject 
methodSignatureForSelector:] + 211
7   com.apple.Foundation         0x9272f1b0 
-[NSObject(NSForwardInvocation) forward::] + 97
8   libobjc.A.dylib              0x90a51ba1 _objc_msgForward + 49
9   org.R-project.R              0x0000a596 -[RController readThread:] + 
1609 (crt.c:305)
10  com.apple.Foundation         0x927291b0 forkThreadForFunction + 123
11  libSystem.B.dylib            0x90024b07 _pthread_body + 84

Thread 2:
0   libSystem.B.dylib            0x900251a7 semaphore_wait_signal_trap + 7
1   com.apple.Foundation         0x9277f008 -[NSConditionLock 
lockWhenCondition:] + 39
2   com.apple.AppKit             0x9345a374 -[NSUIHeartBeat 
_heartBeatThread:] + 377
3   com.apple.Foundation         0x927291b0 forkThreadForFunction + 123
4   libSystem.B.dylib            0x90024b07 _pthread_body + 84

Thread 0 crashed with i386 Thread State:
eax: 0x0032c000    ebx: 0x9275c1fe ecx:0x90a5b9f8 edx: 0x15c05020
edi: 0x0212f5e0    esi: 0x0212f6f0 ebp:0xbffff528 esp: 0xbffff4c0
 ss: 0x0000002f    efl: 0x00000246 eip:0x9275c2d3  cs: 0x00000027
 ds: 0x0000002f     es: 0x0000002f  fs:0x00000000  gs: 0x00000037

Binary Images Description:
    0x1000 -    0x49fff org.R-project.R 1.16 (3198)    
/Applications/R.app/Contents/MacOS/R
   0x65000 -    0x6cfff libgcc_s.1.0.dylib     
/Library/Frameworks/R.framework/Versions/2.3/Resources/lib/libgcc_s.1.0.dylib
   0x8c000 -    0xa9fff libreadline.5.1.dylib     
/Library/Frameworks/R.framework/Versions/2.3/Resources/lib/libreadline.5.1.dylib
  0x205000 -   0x252fff libgfortran.0.dylib     
/Library/Frameworks/R.framework/Versions/2.3/Resources/lib/libgfortran.0.dylib
 0x1008000 -  0x13dffff libR.dylib     
/Library/Frameworks/R.framework/Versions/2.3/Resources/lib/libR.dylib
0x15dfd000 - 0x15e19fff grDevices.so     
/Library/Frameworks/R.framework/Versions/2.3/Resources/library/grDevices/libs/i386/grDevices.so
0x15f54000 - 0x15f57fff methods.so     
/Library/Frameworks/R.framework/Versions/2.3/Resources/library/methods/libs/i386/methods.so
0x17804000 - 0x1784dfff stats.so     
/Library/Frameworks/R.framework/Versions/2.3/Resources/library/stats/libs/i386/stats.so
0x8fe00000 - 0x8fe4bfff dyld 45.1    /usr/lib/dyld
0x90000000 - 0x9016efff libSystem.B.dylib     /usr/lib/libSystem.B.dylib
0x901be000 - 0x901c0fff libmathCommon.A.dylib     
/usr/lib/system/libmathCommon.A.dylib
0x901c2000 - 0x901fefff com.apple.CoreText 1.1.1 (???)    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/CoreText.framework/Versions/A/CoreText
0x90225000 - 0x902fafff ATS     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ATS.framework/Versions/A/ATS
0x9031a000 - 0x9076afff com.apple.CoreGraphics 1.258.33 (???)    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/CoreGraphics.framework/Versions/A/CoreGraphics
0x90801000 - 0x908c9fff com.apple.CoreFoundation 6.4.6 (368.27)    
/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation
0x90907000 - 0x90907fff com.apple.CoreServices 10.4 (???)    
/System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices
0x90909000 - 0x909fcfff libicucore.A.dylib     /usr/lib/libicucore.A.dylib
0x90a4c000 - 0x90acbfff libobjc.A.dylib     /usr/lib/libobjc.A.dylib
0x90af4000 - 0x90b57fff libstdc++.6.dylib     /usr/lib/libstdc++.6.dylib
0x90bc6000 - 0x90bcdfff libgcc_s.1.dylib     /usr/lib/libgcc_s.1.dylib
0x90bd2000 - 0x90c42fff com.apple.framework.IOKit 1.4.4 (???)    
/System/Library/Frameworks/IOKit.framework/Versions/A/IOKit
0x90c57000 - 0x90c69fff libauto.dylib     /usr/lib/libauto.dylib
0x90c6f000 - 0x90f14fff com.apple.CoreServices.CarbonCore 682.12    
/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/CarbonCore.framework/Versions/A/CarbonCore
0x90f57000 - 0x90fbffff com.apple.CoreServices.OSServices 4.1    
/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/OSServices.framework/Versions/A/OSServices
0x90ff7000 - 0x91035fff com.apple.CFNetwork 129.16    
/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/CFNetwork.framework/Versions/A/CFNetwork
0x91047000 - 0x91057fff com.apple.WebServices 1.1.3 (1.1.0)    
/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/WebServicesCore.framework/Versions/A/WebServicesCore
0x91062000 - 0x910e0fff com.apple.SearchKit 1.0.5    
/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/SearchKit.framework/Versions/A/SearchKit
0x91115000 - 0x91133fff com.apple.Metadata 10.4.4 (121.36)    
/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/Metadata.framework/Versions/A/Metadata
0x9113f000 - 0x9114dfff libz.1.dylib     /usr/lib/libz.1.dylib
0x91150000 - 0x91306fff com.apple.security 4.4.1 (27569)    
/System/Library/Frameworks/Security.framework/Versions/A/Security
0x913f5000 - 0x913fdfff com.apple.DiskArbitration 2.1    
/System/Library/Frameworks/DiskArbitration.framework/Versions/A/DiskArbitration
0x91404000 - 0x9142afff com.apple.SystemConfiguration 1.8.6    
/System/Library/Frameworks/SystemConfiguration.framework/Versions/A/SystemConfiguration
0x9143c000 - 0x91443fff libbsm.dylib     /usr/lib/libbsm.dylib
0x91447000 - 0x914c0fff com.apple.audio.CoreAudio 3.0.4    
/System/Library/Frameworks/CoreAudio.framework/Versions/A/CoreAudio
0x9150e000 - 0x9150efff com.apple.ApplicationServices 10.4 (???)    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/ApplicationServices
0x91510000 - 0x9153bfff com.apple.AE 314 (313)    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/AE.framework/Versions/A/AE
0x9154e000 - 0x91622fff com.apple.ColorSync 4.4.6    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ColorSync.framework/Versions/A/ColorSync
0x9165b000 - 0x916d8fff com.apple.print.framework.PrintCore 4.6 
(177.13)    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/PrintCore.framework/Versions/A/PrintCore
0x91705000 - 0x917affff com.apple.QD 3.10.20 (???)    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/QD.framework/Versions/A/QD
0x917d5000 - 0x91820fff com.apple.HIServices 1.5.2 (???)    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/HIServices.framework/Versions/A/HIServices
0x9183f000 - 0x91855fff com.apple.LangAnalysis 1.6.3    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/LangAnalysis.framework/Versions/A/LangAnalysis
0x91861000 - 0x9187bfff com.apple.FindByContent 1.5    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/FindByContent.framework/Versions/A/FindByContent
0x91885000 - 0x918c2fff com.apple.LaunchServices 180    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/LaunchServices
0x918d6000 - 0x918e1fff com.apple.speech.synthesis.framework 3.4    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/SpeechSynthesis.framework/Versions/A/SpeechSynthesis
0x918e8000 - 0x91920fff com.apple.ImageIO.framework 1.4.7    
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO
0x91932000 - 0x919e4fff libcrypto.0.9.7.dylib     
/usr/lib/libcrypto.0.9.7.dylib
0x91a2a000 - 0x91a40fff libcups.2.dylib     /usr/lib/libcups.2.dylib
0x91a45000 - 0x91a61fff libJPEG.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources/libJPEG.dylib
0x91a66000 - 0x91ac4fff libJP2.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources/libJP2.dylib
0x91ad4000 - 0x91ad8fff libGIF.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources/libGIF.dylib
0x91ada000 - 0x91b35fff libRaw.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources/libRaw.dylib
0x91b39000 - 0x91b76fff libTIFF.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources/libTIFF.dylib
0x91b7c000 - 0x91b96fff libPng.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources/libPng.dylib
0x91b9b000 - 0x91b9dfff libRadiance.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources/libRadiance.dylib
0x91b9f000 - 0x91b9ffff com.apple.Accelerate 1.2.2 (Accelerate 1.2.2)    
/System/Library/Frameworks/Accelerate.framework/Versions/A/Accelerate
0x91ba1000 - 0x91c2bfff com.apple.vImage 2.4    
/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vImage.framework/Versions/A/vImage
0x91c32000 - 0x91c32fff com.apple.Accelerate.vecLib 3.2.2 (vecLib 
3.2.2)    
/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/vecLib
0x91c34000 - 0x91c79fff libvMisc.dylib     
/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libvMisc.dylib
0x91c81000 - 0x91ca6fff libvDSP.dylib     
/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libvDSP.dylib
0x91cad000 - 0x92230fff libBLAS.dylib     
/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
0x9226d000 - 0x9261ffff libLAPACK.dylib     
/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib
0x9264c000 - 0x926d0fff com.apple.DesktopServices 1.3.4    
/System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv
0x9270c000 - 0x9293efff com.apple.Foundation 6.4.6 (567.27)    
/System/Library/Frameworks/Foundation.framework/Versions/C/Foundation
0x92a4a000 - 0x92b28fff libxml2.2.dylib     /usr/lib/libxml2.2.dylib
0x92b45000 - 0x92c32fff libiconv.2.dylib     /usr/lib/libiconv.2.dylib
0x92c42000 - 0x92c59fff libGL.dylib     
/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib
0x92c64000 - 0x92cbbfff libGLU.dylib     
/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGLU.dylib
0x92ccf000 - 0x92ccffff com.apple.Carbon 10.4 (???)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Carbon
0x92cd1000 - 0x92ce1fff com.apple.ImageCapture 3.0.4    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/ImageCapture.framework/Versions/A/ImageCapture
0x92cef000 - 0x92cf7fff com.apple.speech.recognition.framework 3.5    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/SpeechRecognition.framework/Versions/A/SpeechRecognition
0x92cfd000 - 0x92d02fff com.apple.securityhi 2.0.1 (24742)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/SecurityHI.framework/Versions/A/SecurityHI
0x92d08000 - 0x92d99fff com.apple.ink.framework 101.2.1 (71)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/Ink.framework/Versions/A/Ink
0x92dad000 - 0x92db0fff com.apple.help 1.0.3 (32.1)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/Help.framework/Versions/A/Help
0x92db3000 - 0x92dd0fff com.apple.openscripting 1.2.5 (???)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/OpenScripting.framework/Versions/A/OpenScripting
0x92de0000 - 0x92de6fff com.apple.print.framework.Print 5.2 (192.4)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/Print.framework/Versions/A/Print
0x92dec000 - 0x92e4ffff com.apple.htmlrendering 66.1 (1.1.3)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/HTMLRendering.framework/Versions/A/HTMLRendering
0x92e73000 - 0x92eb4fff com.apple.NavigationServices 3.4.4 (3.4.3)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/NavigationServices.framework/Versions/A/NavigationServices
0x92edb000 - 0x92ee8fff com.apple.audio.SoundManager 3.9.1    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/CarbonSound.framework/Versions/A/CarbonSound
0x92eef000 - 0x92ef4fff com.apple.CommonPanels 1.2.3 (73)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/CommonPanels.framework/Versions/A/CommonPanels
0x92ef9000 - 0x931ebfff com.apple.HIToolbox 1.4.8 (???)    
/System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/HIToolbox.framework/Versions/A/HIToolbox
0x932f0000 - 0x932fbfff com.apple.opengl 1.4.10    
/System/Library/Frameworks/OpenGL.framework/Versions/A/OpenGL
0x9336a000 - 0x9336afff com.apple.Cocoa 6.4 (???)    
/System/Library/Frameworks/Cocoa.framework/Versions/A/Cocoa
0x9336c000 - 0x93a25fff com.apple.AppKit 6.4.7 (824.41)    
/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit
0x93da6000 - 0x93e20fff com.apple.CoreData 90    
/System/Library/Frameworks/CoreData.framework/Versions/A/CoreData
0x93e59000 - 0x93f1afff com.apple.audio.toolbox.AudioToolbox 1.4.3    
/System/Library/Frameworks/AudioToolbox.framework/Versions/A/AudioToolbox
0x93f5a000 - 0x93f5afff com.apple.audio.units.AudioUnit 1.4.2    
/System/Library/Frameworks/AudioUnit.framework/Versions/A/AudioUnit
0x93f5c000 - 0x9410afff com.apple.QuartzCore 1.4.8    
/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzCore
0x94158000 - 0x94199fff libsqlite3.0.dylib     /usr/lib/libsqlite3.0.dylib
0x941a1000 - 0x941dbfff libGLImage.dylib     
/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGLImage.dylib
0x94356000 - 0x94365fff libCGATS.A.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/CoreGraphics.framework/Versions/A/Resources/libCGATS.A.dylib
0x9436c000 - 0x94377fff libCSync.A.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/CoreGraphics.framework/Versions/A/Resources/libCSync.A.dylib
0x943c3000 - 0x943ddfff libRIP.A.dylib     
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/CoreGraphics.framework/Versions/A/Resources/libRIP.A.dylib
0x94d98000 - 0x94e2bfff com.apple.WebKit 418.8    
/System/Library/Frameworks/WebKit.framework/Versions/A/WebKit
0x94e85000 - 0x94f07fff com.apple.JavaScriptCore 418.3    
/System/Library/Frameworks/WebKit.framework/Versions/A/Frameworks/JavaScriptCore.framework/Versions/A/JavaScriptCore
0x94f3a000 - 0x95219fff com.apple.WebCore 418.19    
/System/Library/Frameworks/WebKit.framework/Versions/A/Frameworks/WebCore.framework/Versions/A/WebCore
0x95377000 - 0x9539afff libxslt.1.dylib     /usr/lib/libxslt.1.dylib
0x955b7000 - 0x955b9fff com.apple.ExceptionHandling 1.2 (???)    
/System/Library/Frameworks/ExceptionHandling.framework/Versions/A/ExceptionHandling
0x95ab4000 - 0x95ae2fff libncurses.5.4.dylib     
/usr/lib/libncurses.5.4.dylib
0x9ac4c000 - 0x9ac4cfff libmx.A.dylib     /usr/lib/libmx.A.dylib

Model: MacBookPro1,1, BootROM MBP11.0055.B03, 2 processors, Intel Core 
Duo, 2.16 GHz, 2 GB
Graphics: ATI Radeon X1600, ATY,RadeonX1600, PCIe, 256 MB
Memory Module: DIMM0/BANK 0, 1 GB, DDR2 SDRAM, 667 MHz
Memory Module: DIMM1/BANK 1, 1 GB, DDR2 SDRAM, 667 MHz
AirPort: spairport_wireless_card_type_airport_extreme (0x168C, 0x86), 0.1.24
Bluetooth: Version 1.7.5f10, 2 service, 1 devices, 1 incoming serial ports
Network Service: Built-in Ethernet, PPP (PPPoE), ppp0
Network Service: Parallels Host-Guest Adapter, Ethernet, en2
Serial ATA Device: ST910021AS, 93.16 GB
Parallel ATA Device: MATSHITADVD-R   UJ-857
USB Device: Built-in iSight, Micron, Up to 480 Mb/sec, 500 mA
USB Device: Bluetooth HCI, Up to 12 Mb/sec, 500 mA
USB Device: Apple Internal Keyboard / Trackpad, Apple Computer, Up to 12 
Mb/sec, 500 mA
USB Device: ORTEK KH12 USB Hub, ORTEK, Up to 12 Mb/sec, 500 mA
USB Device: USB Mouse, Up to 1.5 Mb/sec, 100 mA
USB Device: USB Hub/Keyboard, ORTEK, Up to 12 Mb/sec, 280 mA
USB Device: IR Receiver, Apple Computer, Inc., Up to 12 Mb/sec, 500 mA


From murdoch at stats.uwo.ca  Tue Jul  4 14:32:08 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Jul 2006 08:32:08 -0400
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
Message-ID: <44AA5FC8.9020106@stats.uwo.ca>

I've just committed a couple of changes to R-devel related to requests 
at userR about the Windows installer.  The first of these affects all 
platforms, but I've only tested it on Windows:

I added an option "quit.with.no.save".  If TRUE, then the default 
q("ask") prompt will not offer to save the workspace.  This is in 
response to the observation that new users who are instructed not to 
save their workspace, get confused when they accidentally answer Yes to 
the prompt to save it.

I'm not sure about the wording of the user prompt question, which is now 
"Quit and discard workspace?".  The problem with this wording is that 
someone who automatically hits "y" will lose their work.  I've tried on 
Windows to make the dialog box look different enough that they should be 
warned.

I haven't made any change to the Mac GUI to support this.  On 
Unix-alikes, the text prompt should respect this option.

The other change is to the Windows installer, to allow the user to 
choose whether to set quit.with.no.save, MDI/SDI display, and help style 
at install time.  The only (intentional) change to the current behaviour 
is to default to CHM help instead of plain text.

These changes will show up in builds based on revision 38480 or later.

Duncan Murdoch


From maechler at stat.math.ethz.ch  Tue Jul  4 17:15:32 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 4 Jul 2006 17:15:32 +0200
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <44AA5FC8.9020106@stats.uwo.ca>
References: <44AA5FC8.9020106@stats.uwo.ca>
Message-ID: <17578.34324.125621.658439@stat.math.ethz.ch>

>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>     on Tue, 04 Jul 2006 08:32:08 -0400 writes:

    Duncan> I've just committed a couple of changes to R-devel related to requests 
    Duncan> at userR about the Windows installer.  The first of these affects all 
    Duncan> platforms, but I've only tested it on Windows:

    Duncan> I added an option "quit.with.no.save".  If TRUE,
    Duncan> then the default q("ask") prompt will not offer to
    Duncan> save the workspace.  This is in response to the
    Duncan> observation that new users who are instructed not to
    Duncan> save their workspace, get confused when they
    Duncan> accidentally answer Yes to the prompt to save it.

Ok...  but I probably misunderstand a bit:

The default has not been   q(save = "ask") but  q(save = "default"),
and that default has depended on startup.

Even now, "R --no-save"  already did have the desired effect,
on Unix at least.  For my ESS setup, I have made this an automatic
default many months ago.

Wouldn't it be easier and sufficient to make "--no-save" a
working option on all platforms ?
Or is the point really about changing the quitting dialog?
For me quitting *without* a dialog is the most important thing
which I use (often several times a day).

    Duncan> I'm not sure about the wording of the user prompt
    Duncan> question, which is now "Quit and discard
    Duncan> workspace?".  The problem with this wording is that
    Duncan> someone who automatically hits "y" will lose their
    Duncan> work.  I've tried on Windows to make the dialog box
    Duncan> look different enough that they should be warned.

good!

    Duncan> I haven't made any change to the Mac GUI to support this.  On 
    Duncan> Unix-alikes, the text prompt should respect this option.

    Duncan> The other change is to the Windows installer, to
    Duncan> allow the user to choose whether to set
    Duncan> quit.with.no.save, MDI/SDI display, and help style
    Duncan> at install time.  The only (intentional) change to
    Duncan> the current behaviour is to default to CHM help
    Duncan> instead of plain text.

People have asked me in private about this, and I didn't know
the answer:
Is it true that this means that people can no longer commit the
"cheap package install trick" on Windows for  R-code-only
packages?
Namely
  1) install a source package on a Linux/Unix/MacOSX machine
     (where it is often simple to have all the necessary tools available)
  2) zip the resulting installed package
  3) unzip it on the target Windows machine into the corresponding
     library (directory).

Of course, this trick will not provide any *.chm help files.
Will the cheap-installed package still work, using the *.txt (or
*.html) help files?


    Duncan> These changes will show up in builds based on
    Duncan> revision 38480 or later.

    Duncan> Duncan Murdoch

Thanks a lot, Duncan!


    Duncan> ______________________________________________
    Duncan> R-devel at r-project.org mailing list
    Duncan> https://stat.ethz.ch/mailman/listinfo/r-devel


From gavin.simpson at ucl.ac.uk  Tue Jul  4 17:26:26 2006
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 04 Jul 2006 16:26:26 +0100
Subject: [Rd] problem getting R 2.3.1 svn r38481 to pass make check-all
Message-ID: <1152026786.31350.9.camel@graptoleberis.geog.ucl.ac.uk>

Hi,

I noticed this problem on my home desktop running FC4 and again on my
laptop running FC5. Both have previously compiled and passed make
check-all on 2.3.1 svn revisions from 10 days ago or so. On both these
machines, make check-all is consistently failing (4 out of 4 attempts on
the FC 4 desktop and 3 out of 3 on the FC 5 laptop) in the
p-r-random-tests tests. This is with both default compiler flags and
extra flags set in config.site.

R is failing make check-all with the following set of messages:

...
make[3]: Entering directory `/home/gavin/R/2.3-patches/build/tests'
running code in '../../tests/p-r-random-tests.R' ... OK
comparing 'p-r-random-tests.Rout' to
'../../tests/p-r-random-tests.Rout.save' ...1a2,16
> R version 2.4.0 Under development (unstable) (2006-06-30 r38463)
> Copyright (C) 2006 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
254a270,274
> > ## regression test for non-central t bug
> > dkwtest("t", df=20, ncp=3)
> t(df = 20, ncp = 3) PASSED
> [1] TRUE
> >
make[3]: *** [p-r-random-tests.Rout] Error 1
make[3]: Leaving directory `/home/gavin/R/2.3-patches/build/tests'
make[2]: *** [test-Random] Error 2
make[2]: Leaving directory `/home/gavin/R/2.3-patches/build/tests'
make[1]: *** [test-all-devel] Error 1
make[1]: Leaving directory `/home/gavin/R/2.3-patches/build/tests'
make: *** [check-all] Error 2

I looked in ./tests/p-r-random-tests.Rout.fail and couldn't see anything
that indicated a failure - everything had PASSED or TRUE as results of
the tests. I append the contents of this file below.

Anyone see what is wrong?

Thanks in advance,

Gavin

## Contents of p-r-random-tests.Rout.fail ##

R : Copyright 2006, The R Foundation for Statistical Computing
Version 2.3.1 Patched (2006-07-03 r38481)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ##
> ## RNG tests using DKW inequality for rate of convergence
> ##
> ## P(sup | F_n - F | > t) < 2 exp(-2nt^2)
> ##
> ## The 2 in front of exp() was derived by Massart. It is the best
possible
> ## constant valid uniformly in t,n,F. For large n*t^2 this agrees with
the
> ## large-sample approximation to the Kolmogorov-Smirnov statistic.
> ## 
> 
> 
> superror <- function(rfoo,pfoo,sample.size,...) {
+     x <- rfoo(sample.size,...)
+     tx <- table(x)
+     xi <- as.numeric(names(tx))
+     f <- pfoo(xi,...)
+     fhat <- cumsum(tx)/sample.size
+     max(abs(fhat-f))
+ }
> 
> pdkwbound <- function(n,t) 2*exp(-2*n*t*t)
> 
> qdkwbound <- function(n,p) sqrt(log(p/2)/(-2*n))
> 
> dkwtest <- function(stub = "norm", ...,
+                     sample.size = 10000, pthreshold = 0.001,
+                     print.result = TRUE, print.detail = FALSE,
+                     stop.on.failure = TRUE)
+ {
+     rfoo <- eval(as.name(paste("r", stub, sep="")))
+     pfoo <- eval(as.name(paste("p", stub, sep="")))
+     s <- superror(rfoo, pfoo, sample.size, ...)
+     if (print.result || print.detail) {
+         printargs <- substitute(list(...))
+         printargs[[1]] <- as.name(stub)
+         cat(deparse(printargs))
+         if (print.detail)
+             cat("\nsupremum error = ",signif(s,2),
+                 " with
p-value=",min(1,round(pdkwbound(sample.size,s),4)),"\n")
+     }
+     rval <- (s < qdkwbound(sample.size,pthreshold))
+     if (print.result)
+         cat(c(" FAILED\n"," PASSED\n",)[rval+1])
+     if (stop.on.failure && !rval)
+         stop("dkwtest failed")
+     rval
+ }
> 
> .proctime00 <- proc.time() # start timing
> 
> 
> dkwtest("binom",size =   1,prob = 0.2)
binom(size = 1, prob = 0.2) PASSED
[1] TRUE
> dkwtest("binom",size =   2,prob = 0.2)
binom(size = 2, prob = 0.2) PASSED
[1] TRUE
> dkwtest("binom",size = 100,prob = 0.2)
binom(size = 100, prob = 0.2) PASSED
[1] TRUE
> dkwtest("binom",size = 1e4,prob = 0.2)
binom(size = 10000, prob = 0.2) PASSED
[1] TRUE
> dkwtest("binom",size =   1,prob = 0.8)
binom(size = 1, prob = 0.8) PASSED
[1] TRUE
> dkwtest("binom",size = 100,prob = 0.8)
binom(size = 100, prob = 0.8) PASSED
[1] TRUE
> dkwtest("binom",size = 100,prob = 0.999)
binom(size = 100, prob = 0.999) PASSED
[1] TRUE
> 
> dkwtest("pois",lambda =  0.095)
pois(lambda = 0.095) PASSED
[1] TRUE
> dkwtest("pois",lambda =  0.95)
pois(lambda = 0.95) PASSED
[1] TRUE
> dkwtest("pois",lambda =  9.5)
pois(lambda = 9.5) PASSED
[1] TRUE
> dkwtest("pois",lambda = 95)
pois(lambda = 95) PASSED
[1] TRUE
> 
> dkwtest("nbinom",size =   1,prob = 0.2)
nbinom(size = 1, prob = 0.2) PASSED
[1] TRUE
> dkwtest("nbinom",size =   2,prob = 0.2)
nbinom(size = 2, prob = 0.2) PASSED
[1] TRUE
> dkwtest("nbinom",size = 100,prob = 0.2)
nbinom(size = 100, prob = 0.2) PASSED
[1] TRUE
> dkwtest("nbinom",size = 1e4,prob = 0.2)
nbinom(size = 10000, prob = 0.2) PASSED
[1] TRUE
> dkwtest("nbinom",size =   1,prob = 0.8)
nbinom(size = 1, prob = 0.8) PASSED
[1] TRUE
> dkwtest("nbinom",size = 100,prob = 0.8)
nbinom(size = 100, prob = 0.8) PASSED
[1] TRUE
> dkwtest("nbinom",size = 100,prob = 0.999)
nbinom(size = 100, prob = 0.999) PASSED
[1] TRUE
> 
> dkwtest("norm")
norm() PASSED
[1] TRUE
> dkwtest("norm",mean = 5,sd = 3)
norm(mean = 5, sd = 3) PASSED
[1] TRUE
> 
> dkwtest("gamma",shape =  0.1)
gamma(shape = 0.1) PASSED
[1] TRUE
> dkwtest("gamma",shape =  0.2)
gamma(shape = 0.2) PASSED
[1] TRUE
> dkwtest("gamma",shape = 10)
gamma(shape = 10) PASSED
[1] TRUE
> dkwtest("gamma",shape = 20)
gamma(shape = 20) PASSED
[1] TRUE
> 
> dkwtest("hyper",m = 40,n = 30,k = 20)
hyper(m = 40, n = 30, k = 20) PASSED
[1] TRUE
> dkwtest("hyper",m = 40,n =  3,k = 20)
hyper(m = 40, n = 3, k = 20) PASSED
[1] TRUE
> dkwtest("hyper",m =  6,n =  3,k =  2)
hyper(m = 6, n = 3, k = 2) PASSED
[1] TRUE
> dkwtest("hyper",m =  5,n =  3,k =  2)
hyper(m = 5, n = 3, k = 2) PASSED
[1] TRUE
> dkwtest("hyper",m =  4,n =  3,k =  2)
hyper(m = 4, n = 3, k = 2) PASSED
[1] TRUE
> 
> 
> dkwtest("signrank",n =  1)
signrank(n = 1) PASSED
[1] TRUE
> dkwtest("signrank",n =  2)
signrank(n = 2) PASSED
[1] TRUE
> dkwtest("signrank",n = 10)
signrank(n = 10) PASSED
[1] TRUE
> dkwtest("signrank",n = 30)
signrank(n = 30) PASSED
[1] TRUE
> 
> dkwtest("wilcox",m = 40,n = 30)
wilcox(m = 40, n = 30) PASSED
[1] TRUE
> dkwtest("wilcox",m = 40,n = 10)
wilcox(m = 40, n = 10) PASSED
[1] TRUE
> dkwtest("wilcox",m =  6,n =  3)
wilcox(m = 6, n = 3) PASSED
[1] TRUE
> dkwtest("wilcox",m =  5,n =  3)
wilcox(m = 5, n = 3) PASSED
[1] TRUE
> dkwtest("wilcox",m =  4,n =  3)
wilcox(m = 4, n = 3) PASSED
[1] TRUE
> 
> dkwtest("chisq",df =  1)
chisq(df = 1) PASSED
[1] TRUE
> dkwtest("chisq",df = 10)
chisq(df = 10) PASSED
[1] TRUE
> 
> dkwtest("logis")
logis() PASSED
[1] TRUE
> dkwtest("logis",location = 4,scale = 2)
logis(location = 4, scale = 2) PASSED
[1] TRUE
> 
> dkwtest("t",df =  1)
t(df = 1) PASSED
[1] TRUE
> dkwtest("t",df = 10)
t(df = 10) PASSED
[1] TRUE
> dkwtest("t",df = 40)
t(df = 40) PASSED
[1] TRUE
> 
> dkwtest("beta",shape1 = 1, shape2 = 1)
beta(shape1 = 1, shape2 = 1) PASSED
[1] TRUE
> dkwtest("beta",shape1 = 2, shape2 = 1)
beta(shape1 = 2, shape2 = 1) PASSED
[1] TRUE
> dkwtest("beta",shape1 = 1, shape2 = 2)
beta(shape1 = 1, shape2 = 2) PASSED
[1] TRUE
> dkwtest("beta",shape1 = 2, shape2 = 2)
beta(shape1 = 2, shape2 = 2) PASSED
[1] TRUE
> dkwtest("beta",shape1 = .2,shape2 = .2)
beta(shape1 = 0.2, shape2 = 0.2) PASSED
[1] TRUE
> 
> dkwtest("cauchy")
cauchy() PASSED
[1] TRUE
> dkwtest("cauchy",location = 4,scale = 2)
cauchy(location = 4, scale = 2) PASSED
[1] TRUE
> 
> dkwtest("f",df1 =  1,df2 =  1)
f(df1 = 1, df2 = 1) PASSED
[1] TRUE
> dkwtest("f",df1 =  1,df2 = 10)
f(df1 = 1, df2 = 10) PASSED
[1] TRUE
> dkwtest("f",df1 = 10,df2 = 10)
f(df1 = 10, df2 = 10) PASSED
[1] TRUE
> dkwtest("f",df1 = 30,df2 =  3)
f(df1 = 30, df2 = 3) PASSED
[1] TRUE
> 
> dkwtest("weibull",shape = 1)
weibull(shape = 1) PASSED
[1] TRUE
> dkwtest("weibull",shape = 4,scale = 4)
weibull(shape = 4, scale = 4) PASSED
[1] TRUE
> 
> ## regression test for PR#7314
> dkwtest("hyper", m=60, n=100, k=50)
hyper(m = 60, n = 100, k = 50) PASSED
[1] TRUE
> dkwtest("hyper", m=6, n=10, k=5)
hyper(m = 6, n = 10, k = 5) PASSED
[1] TRUE
> dkwtest("hyper", m=600, n=1000, k=500)
hyper(m = 600, n = 1000, k = 500) PASSED
[1] TRUE
>         
> cat('Time elapsed: ', proc.time() - .proctime00,'\n')
Time elapsed:  2.404 0.004 2.408 0 0 
>


From maechler at stat.math.ethz.ch  Tue Jul  4 17:40:31 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 4 Jul 2006 17:40:31 +0200
Subject: [Rd] [R] zero.print in print.table after adding margins
In-Reply-To: <17573.16044.463160.287875@stat.math.ethz.ch>
References: <40D3930AC1C8EA469E39536E5BC80835023FB024@EXDKBA021.corp.novocorp.net>
	<x264ik9sey.fsf@viggo.kubism.ku.dk>
	<17573.16044.463160.287875@stat.math.ethz.ch>
Message-ID: <17578.35823.368413.65517@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Fri, 30 Jun 2006 17:09:32 +0200 writes:

>>>>> "PD" == Peter Dalgaard <p.dalgaard at biostat.ku.dk>
>>>>>     on 29 Jun 2006 12:18:13 +0200 writes:

     PD> "BXC (Bendix Carstensen)" <bxc at steno.dk> writes:

     BXC> The function addmargins() adds margins to a table, but returns a matrix.
     BXC> But even after converted to a table the print.zero="." option of
     BXC> print.table() does not work:
     BXC> 
     BXC> > x <- sample( 1:7, 20, replace=T )
     BXC> > y <- sample( 1:7, 20, replace=T )
     BXC> > tt <- table( x, y )
     BXC> > tx <- as.table( addmargins( table( x, y ) ) )
     BXC> > print( tt, zero.print="." )
     BXC>    y
     BXC> x   1 2 3 4 5 6 7
     BXC>   1 1 2 2 . . 1 .
     BXC>   2 1 . . 1 . . .
     BXC>   3 . . . . . . 2
     BXC>   4 1 . . . . 1 .
     BXC>   5 1 . 1 . . 1 .
     BXC>   6 . 1 . 1 . . .
     BXC>   7 . . 1 . 1 1 .
     BXC> > print( tx, zero.print="." )
     BXC>      y
     BXC> x      1  2  3  4  5  6  7 Sum
     BXC>   1    1  2  2  0  0  1  0   6
     BXC>   2    1  0  0  1  0  0  0   2
     BXC>   3    0  0  0  0  0  0  2   2
     BXC>   4    1  0  0  0  0  1  0   2
     BXC>   5    1  0  1  0  0  1  0   3
     BXC>   6    0  1  0  1  0  0  0   2
     BXC>   7    0  0  1  0  1  1  0   3
     BXC>   Sum  4  3  4  2  1  4  2  20
     BXC> 
     BXC> Is this a facility of print.table?
     BXC> The attributes() of tt and tx have identical stucture. 

     PD> It appears to be intentional.
     PD> 
     PD> print.table has
     PD> 
     PD> if (is.integer(x) && zero.print != "0" && any(i0 <- !ina &
     PD> x == 0))
     PD> xx[i0] <- sub("0", zero.print, xx[i0])
     PD> 
     PD> and of course,
     PD> 
     PD> > storage.mode(tx)
     PD> [1] "double"
     PD> > storage.mode(tt)
     PD> [1] "integer"
     PD> 
     PD> The reason could be that it is not entirely clear what to expect for
     PD> values that are zero up to round-off.
     PD> 
     PD> storage.mode(tx) <- "integer" fixes things up.

    MM> On the other hand, I'm pretty sure I was the one who added
    MM> 'zero.print' and I don't oppose at all to change

    MM> is.integer(x)   to   all(x == round(x))

    MM> {and then for efficiency swap the *order* of the tests inside that if(.)}
    MM> which I think would be a bit more convenient and still ok (*)
    MM> here.

    MM> Martin Maechler, ETH Zurich

    MM> (*) yes, one could then construct artificial cases where the
    MM> if(.) test would ``conceptually'' be wrong, but I think that
    MM> would not matter for all practical cases.

In R-devel,  

-  addmargins(x, ...) now returns a "table" when 'x' was one.

-  print.table(x, zero.print = ch) now also ``zero-prints'' when
   'x' is not "integer" but numeric with integer values.

Bendix' original example can now be slightly shortened *and*
works as desired (in R-devel, aka 2.4.0 -- to-be):

> set.seed(1)
> x <- sample( 1:7, 20, replace=TRUE)
> y <- sample( 1:7, 20, replace=TRUE)
> tx <- addmargins( table(x, y) )
> print(tx, zero.print = ".")
     y
x      1  2  3  4  5  6  7 Sum
  1    .  .  1  .  .  .  .   1
  2    .  1  .  1  1  .  1   4
  3    .  2  .  .  .  1  .   3
  4    .  .  .  .  1  .  .   1
  5    .  .  1  1  1  .  1   4
  6    .  .  1  .  .  2  .   3
  7    3  .  1  .  .  .  .   4
  Sum  3  3  4  2  3  3  2  20
> 

Hoping, this will be useful..
Martin Maechler, ETH Zurich


From murdoch at stats.uwo.ca  Tue Jul  4 17:40:42 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Jul 2006 11:40:42 -0400
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <17578.34324.125621.658439@stat.math.ethz.ch>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.34324.125621.658439@stat.math.ethz.ch>
Message-ID: <44AA8BFA.2080502@stats.uwo.ca>

On 7/4/2006 11:15 AM, Martin Maechler wrote:
>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>     on Tue, 04 Jul 2006 08:32:08 -0400 writes:
> 
>     Duncan> I've just committed a couple of changes to R-devel related to requests 
>     Duncan> at userR about the Windows installer.  The first of these affects all 
>     Duncan> platforms, but I've only tested it on Windows:
> 
>     Duncan> I added an option "quit.with.no.save".  If TRUE,
>     Duncan> then the default q("ask") prompt will not offer to
>     Duncan> save the workspace.  This is in response to the
>     Duncan> observation that new users who are instructed not to
>     Duncan> save their workspace, get confused when they
>     Duncan> accidentally answer Yes to the prompt to save it.
> 
> Ok...  but I probably misunderstand a bit:
> 
> The default has not been   q(save = "ask") but  q(save = "default"),
> and that default has depended on startup.
> 
> Even now, "R --no-save"  already did have the desired effect,
> on Unix at least.  For my ESS setup, I have made this an automatic
> default many months ago.
> 
> Wouldn't it be easier and sufficient to make "--no-save" a
> working option on all platforms ?
> Or is the point really about changing the quitting dialog?
> For me quitting *without* a dialog is the most important thing
> which I use (often several times a day).

Yes, that's the point.  In the Windows GUI it's pretty easy to quit by 
mistake (click on the Close button, which sits right next to the 
Maximize button on the window frame).  It would not be a good idea if 
this resulted in the immediate loss of the workspace, so Windows 
programs normally warn if there will be a loss of data when quitting.

> 
>     Duncan> I'm not sure about the wording of the user prompt
>     Duncan> question, which is now "Quit and discard
>     Duncan> workspace?".  The problem with this wording is that
>     Duncan> someone who automatically hits "y" will lose their
>     Duncan> work.  I've tried on Windows to make the dialog box
>     Duncan> look different enough that they should be warned.
> 
> good!
> 
>     Duncan> I haven't made any change to the Mac GUI to support this.  On 
>     Duncan> Unix-alikes, the text prompt should respect this option.
> 
>     Duncan> The other change is to the Windows installer, to
>     Duncan> allow the user to choose whether to set
>     Duncan> quit.with.no.save, MDI/SDI display, and help style
>     Duncan> at install time.  The only (intentional) change to
>     Duncan> the current behaviour is to default to CHM help
>     Duncan> instead of plain text.
> 
> People have asked me in private about this, and I didn't know
> the answer:
> Is it true that this means that people can no longer commit the
> "cheap package install trick" on Windows for  R-code-only
> packages?
> Namely
>   1) install a source package on a Linux/Unix/MacOSX machine
>      (where it is often simple to have all the necessary tools available)
>   2) zip the resulting installed package
>   3) unzip it on the target Windows machine into the corresponding
>      library (directory).

I don't know what currently happens if you do that, but I can't see how 
it would work for anyone who sets options(chmhelp=TRUE).  People who 
build binary packages should use the appropriate tools to do it.

There is something called "chmlib" available for Linux, but I've got no 
idea whether it is usable.

> Of course, this trick will not provide any *.chm help files.
> Will the cheap-installed package still work, using the *.txt (or
> *.html) help files?

Show me one and I'll tell you what happens.  I think it would be 
reasonable behaviour to default to the text help in a case like this, 
but I don't know if that would be easy.  I do tend to think a patch like 
that should come from someone who chooses not to use the tools we 
provide for doing proper package builds.

>     Duncan> These changes will show up in builds based on
>     Duncan> revision 38480 or later.
> 
>     Duncan> Duncan Murdoch
> 
> Thanks a lot, Duncan!
> 
> 
>     Duncan> ______________________________________________
>     Duncan> R-devel at r-project.org mailing list
>     Duncan> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.uni-dortmund.de  Tue Jul  4 17:57:02 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 04 Jul 2006 17:57:02 +0200
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <17578.34324.125621.658439@stat.math.ethz.ch>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.34324.125621.658439@stat.math.ethz.ch>
Message-ID: <44AA8FCE.2070102@statistik.uni-dortmund.de>

Martin Maechler wrote:
>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>     on Tue, 04 Jul 2006 08:32:08 -0400 writes:
> 
>     Duncan> I've just committed a couple of changes to R-devel related to requests 
>     Duncan> at userR about the Windows installer.  The first of these affects all 
>     Duncan> platforms, but I've only tested it on Windows:
> 
>     Duncan> I added an option "quit.with.no.save".  If TRUE,
>     Duncan> then the default q("ask") prompt will not offer to
>     Duncan> save the workspace.  This is in response to the
>     Duncan> observation that new users who are instructed not to
>     Duncan> save their workspace, get confused when they
>     Duncan> accidentally answer Yes to the prompt to save it.
> 
> Ok...  but I probably misunderstand a bit:
> 
> The default has not been   q(save = "ask") but  q(save = "default"),
> and that default has depended on startup.
> 
> Even now, "R --no-save"  already did have the desired effect,
> on Unix at least.  For my ESS setup, I have made this an automatic
> default many months ago.
> 
> Wouldn't it be easier and sufficient to make "--no-save" a
> working option on all platforms ?
> Or is the point really about changing the quitting dialog?
> For me quitting *without* a dialog is the most important thing
> which I use (often several times a day).
> 
>     Duncan> I'm not sure about the wording of the user prompt
>     Duncan> question, which is now "Quit and discard
>     Duncan> workspace?".  The problem with this wording is that
>     Duncan> someone who automatically hits "y" will lose their
>     Duncan> work.  I've tried on Windows to make the dialog box
>     Duncan> look different enough that they should be warned.
> 
> good!
> 
>     Duncan> I haven't made any change to the Mac GUI to support this.  On 
>     Duncan> Unix-alikes, the text prompt should respect this option.
> 
>     Duncan> The other change is to the Windows installer, to
>     Duncan> allow the user to choose whether to set
>     Duncan> quit.with.no.save, MDI/SDI display, and help style
>     Duncan> at install time.  The only (intentional) change to
>     Duncan> the current behaviour is to default to CHM help
>     Duncan> instead of plain text.
> 
> People have asked me in private about this, and I didn't know
> the answer:
> Is it true that this means that people can no longer commit the
> "cheap package install trick" on Windows for  R-code-only
> packages?
> Namely
>   1) install a source package on a Linux/Unix/MacOSX machine
>      (where it is often simple to have all the necessary tools available)
>   2) zip the resulting installed package
>   3) unzip it on the target Windows machine into the corresponding
>      library (directory).
> 
> Of course, this trick will not provide any *.chm help files.
> Will the cheap-installed package still work, using the *.txt (or
> *.html) help files?



Well, the user has to ask
    help(topic, chmhelp = FALSE)
in this case, or (s)he get the message:

              No CHM help for 'foo' in package 'pkg' is available:
      the CHM file for the package is missing

Perhaps it is possible to arrange some fallback to plain text help if 
chmhelp is not available: in print.help_files_with_topic call print() on 
the "help_files_with_topic" object again, but change attribute "type" to 
"help" before that call ...

Uwe Ligges




>     Duncan> These changes will show up in builds based on
>     Duncan> revision 38480 or later.
> 
>     Duncan> Duncan Murdoch
> 
> Thanks a lot, Duncan!
> 
> 
>     Duncan> ______________________________________________
>     Duncan> R-devel at r-project.org mailing list
>     Duncan> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Tue Jul  4 18:02:15 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 4 Jul 2006 12:02:15 -0400
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <17578.34324.125621.658439@stat.math.ethz.ch>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.34324.125621.658439@stat.math.ethz.ch>
Message-ID: <1D457B6B-1F1D-4FC0-929B-323E0E3A8CDB@r-project.org>


On Jul 4, 2006, at 11:15 AM, Martin Maechler wrote:

>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>     on Tue, 04 Jul 2006 08:32:08 -0400 writes:
>
>     Duncan> I've just committed a couple of changes to R-devel  
> related to requests
>     Duncan> at userR about the Windows installer.  The first of  
> these affects all
>     Duncan> platforms, but I've only tested it on Windows:
>
>     Duncan> I added an option "quit.with.no.save".  If TRUE,
>     Duncan> then the default q("ask") prompt will not offer to
>     Duncan> save the workspace.  This is in response to the
>     Duncan> observation that new users who are instructed not to
>     Duncan> save their workspace, get confused when they
>     Duncan> accidentally answer Yes to the prompt to save it.
>
> Ok...  but I probably misunderstand a bit:
>
> The default has not been   q(save = "ask") but  q(save = "default"),
> and that default has depended on startup.
>
> Even now, "R --no-save"  already did have the desired effect,
> on Unix at least.  For my ESS setup, I have made this an automatic
> default many months ago.
>
> Wouldn't it be easier and sufficient to make "--no-save" a working  
> option on all platforms ?
> Or is the point really about changing the quitting dialog?
> For me quitting *without* a dialog is the most important thing  
> which I use (often several times a day).
>

I agree - it would be even nicer if there was a way to enable --no- 
save with some environment variable ...

However, I think Duncan's approach is a very bad idea, because it  
means that with the same answer will give you opposite result. This  
is a big UI no-no. (Windows users may may think it's a valid option,  
because Microsoft tends to do stupid things like that, but that's  
only because they never think about UI).

The correct approach is to change the default button, but definitely  
not the dialog box.

Speaking of default buttons - is there a specific reason why hitting  
<Enter> at the prompt is not a valid answer in the console? It would  
be nice to have let's say Enter=y, ^D=no, ^C=cancel (the last one  
works already).
In the Mac GUI the behavior is well-defined and compatible with all  
Mac applications (Enter=Save, Esc=Cancel, Cmd+D=Don's save) - doesn't  
Windows define something system-wide like that?

BTW: back to the original issue that Duncan raised - isn't the actual  
problem rather the fact that once you saved an image you cannot get  
rid of it? Unless you know the "internals", namely that it's a file  
named .RData, you can't discard it. There is no way to say "discard  
saved workspace". Maybe that's what should be addressed instead...


>     Duncan> I'm not sure about the wording of the user prompt
>     Duncan> question, which is now "Quit and discard
>     Duncan> workspace?".  The problem with this wording is that
>     Duncan> someone who automatically hits "y" will lose their
>     Duncan> work.  I've tried on Windows to make the dialog box
>     Duncan> look different enough that they should be warned.
>
> good!
>

Since when do people read text in dialog boxes ;)? Especially those  
that have been there for ages ;).

Cheers,
Simon


From edd at debian.org  Tue Jul  4 19:26:37 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 4 Jul 2006 12:26:37 -0500
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <44AA5FC8.9020106@stats.uwo.ca>
References: <44AA5FC8.9020106@stats.uwo.ca>
Message-ID: <17578.42189.474730.425415@basebud.nulle.part>


On 4 July 2006 at 08:32, Duncan Murdoch wrote:
| at install time.  The only (intentional) change to the current behaviour 
| is to default to CHM help instead of plain text.

Some people may take offence with the fact that a non-open-source tool is now
required to build GNU R on the Windows platform. I liked the old setting
where you could use the chm compiler, if installed, but could live quite well
without it too.

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From kevin.hendricks at sympatico.ca  Tue Jul  4 20:21:15 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Tue, 4 Jul 2006 14:21:15 -0400
Subject: [Rd] Final patch for bug 8141 - rewriting substituteList
Message-ID: <DFB3A472-78BB-4E99-BCD0-773015EA7A10@sympatico.ca>

Hi,

Attached is both the patch and a gzipped version of the patch that is  
the fix for bug 8141 - rewriting substituteList in coerce.c to use a  
loop instead of recursion to walk the list.

The new version passes all of my tests (make check-all, etc) and I  
have used it with no negative impact to my work (as verified by  
comparing before and after tests) so far.

The new version fixes the C-stack overflow problem documented in the  
8141 bug report.

[kbhend at base3 ~]$ cat test.r
dfn <- rep(list(rep(0,2)),300000)
test <- as.data.frame.list(dfn)

which no longer fails on the development tree with this patch in place.

I realize it is hard to verify this patch as correct since it  
converts recursion back into a loop.  There has been no official code  
review as far as I can tell by anyone so far.

So perhaps it could be introduced into 2.4.0 with an environment  
variable switch to allow users to switch back to the old version to  
add more evidence as to its correctness.

As I said, I have used the patch without problems in my day to day work.

Also, if there are other annoying low level bugs out there people  
would like tracked down and fixed, please point me at them.


Kevin

-------------- next part --------------

-------------- next part --------------
A non-text attachment was scrubbed...
Name: bug_8141.patch.gz
Type: application/x-gzip
Size: 944 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060704/ffd7e14a/attachment.gz 
-------------- next part --------------
  
  

From murdoch at stats.uwo.ca  Tue Jul  4 21:36:17 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Jul 2006 15:36:17 -0400
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <17578.42189.474730.425415@basebud.nulle.part>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.42189.474730.425415@basebud.nulle.part>
Message-ID: <44AAC331.9070603@stats.uwo.ca>

On 7/4/2006 1:26 PM, Dirk Eddelbuettel wrote:
> On 4 July 2006 at 08:32, Duncan Murdoch wrote:
> | at install time.  The only (intentional) change to the current behaviour 
> | is to default to CHM help instead of plain text.
> 
> Some people may take offence with the fact that a non-open-source tool is now
> required to build GNU R on the Windows platform. I liked the old setting
> where you could use the chm compiler, if installed, but could live quite well
> without it too.

There's no change there.  This just gets the installer to set an option 
in the default Rprofile file.  If you don't use the installer, it won't 
be set, and you'll still default to plain text help.

Duncan Murdoch


From murdoch at stats.uwo.ca  Tue Jul  4 21:38:31 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Jul 2006 15:38:31 -0400
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <1D457B6B-1F1D-4FC0-929B-323E0E3A8CDB@r-project.org>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.34324.125621.658439@stat.math.ethz.ch>
	<1D457B6B-1F1D-4FC0-929B-323E0E3A8CDB@r-project.org>
Message-ID: <44AAC3B7.2080801@stats.uwo.ca>

On 7/4/2006 12:02 PM, Simon Urbanek wrote:
> On Jul 4, 2006, at 11:15 AM, Martin Maechler wrote:
> 
>>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>>     on Tue, 04 Jul 2006 08:32:08 -0400 writes:
>>
>>     Duncan> I've just committed a couple of changes to R-devel  
>> related to requests
>>     Duncan> at userR about the Windows installer.  The first of  
>> these affects all
>>     Duncan> platforms, but I've only tested it on Windows:
>>
>>     Duncan> I added an option "quit.with.no.save".  If TRUE,
>>     Duncan> then the default q("ask") prompt will not offer to
>>     Duncan> save the workspace.  This is in response to the
>>     Duncan> observation that new users who are instructed not to
>>     Duncan> save their workspace, get confused when they
>>     Duncan> accidentally answer Yes to the prompt to save it.
>>
>> Ok...  but I probably misunderstand a bit:
>>
>> The default has not been   q(save = "ask") but  q(save = "default"),
>> and that default has depended on startup.
>>
>> Even now, "R --no-save"  already did have the desired effect,
>> on Unix at least.  For my ESS setup, I have made this an automatic
>> default many months ago.
>>
>> Wouldn't it be easier and sufficient to make "--no-save" a working  
>> option on all platforms ?
>> Or is the point really about changing the quitting dialog?
>> For me quitting *without* a dialog is the most important thing  
>> which I use (often several times a day).
>>
> 
> I agree - it would be even nicer if there was a way to enable --no- 
> save with some environment variable ...

Environment variables in Windows are a mess.  Doing things on the 
command line or through option() is a lot easier.

> However, I think Duncan's approach is a very bad idea, because it  
> means that with the same answer will give you opposite result. This  
> is a big UI no-no. (Windows users may may think it's a valid option,  
> because Microsoft tends to do stupid things like that, but that's  
> only because they never think about UI).

I agree that that is a problem.  However, I don't know a better solution:
   - I want to make it hard for the user to accidentally create a saved 
workspace.  Just changing the default will mean that people who 
habitually answer "yes" will still get the wrong result.
   - I want to make it hard for the user to accidentally lose a 
workspace.  Hence --no-save is not an option.

The problem with my solution as it stands is that people who habitually 
answer "yes" will sometimes accidentally lose a workspace.

> The correct approach is to change the default button, but definitely  
> not the dialog box.

I don't think this is sufficient.

> Speaking of default buttons - is there a specific reason why hitting  
> <Enter> at the prompt is not a valid answer in the console? It would  
> be nice to have let's say Enter=y, ^D=no, ^C=cancel (the last one  
> works already).
> In the Mac GUI the behavior is well-defined and compatible with all  
> Mac applications (Enter=Save, Esc=Cancel, Cmd+D=Don's save) - doesn't  
> Windows define something system-wide like that?
> 
> BTW: back to the original issue that Duncan raised - isn't the actual  
> problem rather the fact that once you saved an image you cannot get  
> rid of it? Unless you know the "internals", namely that it's a file  
> named .RData, you can't discard it. There is no way to say "discard  
> saved workspace". Maybe that's what should be addressed instead...

That's a good idea.  Or perhaps instead of quit.with.no.save, we want 
start.with.no.load, i.e. something like the --no-restore option.

Duncan Murdoch

> 
> 
>>     Duncan> I'm not sure about the wording of the user prompt
>>     Duncan> question, which is now "Quit and discard
>>     Duncan> workspace?".  The problem with this wording is that
>>     Duncan> someone who automatically hits "y" will lose their
>>     Duncan> work.  I've tried on Windows to make the dialog box
>>     Duncan> look different enough that they should be warned.
>>
>> good!
>>
> 
> Since when do people read text in dialog boxes ;)? Especially those  
> that have been there for ages ;).
> 
> Cheers,
> Simon


From edd at debian.org  Tue Jul  4 23:56:16 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 4 Jul 2006 16:56:16 -0500
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <44AAC331.9070603@stats.uwo.ca>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.42189.474730.425415@basebud.nulle.part>
	<44AAC331.9070603@stats.uwo.ca>
Message-ID: <17578.58368.775919.642991@basebud.nulle.part>


On 4 July 2006 at 15:36, Duncan Murdoch wrote:
| On 7/4/2006 1:26 PM, Dirk Eddelbuettel wrote:
| > On 4 July 2006 at 08:32, Duncan Murdoch wrote:
| > | at install time.  The only (intentional) change to the current behaviour 
| > | is to default to CHM help instead of plain text.
| > 
| > Some people may take offence with the fact that a non-open-source tool is now
| > required to build GNU R on the Windows platform. I liked the old setting
| > where you could use the chm compiler, if installed, but could live quite well
| > without it too.
| 
| There's no change there.  This just gets the installer to set an option 
| in the default Rprofile file.  If you don't use the installer, it won't 
| be set, and you'll still default to plain text help.

I am sorry. I misread your original mail as affecting the build process, not
the installer.  Please ignore my non-applicable complaint. Not enough coffee.

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From sebastien.durand at umontreal.ca  Wed Jul  5 00:10:50 2006
From: sebastien.durand at umontreal.ca (Sebastien Durand)
Date: Tue, 04 Jul 2006 18:10:50 -0400
Subject: [Rd] Classes and methods
Message-ID: <p06230906c0d092d322b5@[192.168.2.5]>

Dear all,

I have constructed a fairly large package and I 
wish to improve my code through the used of 
adapted classes and methods.

1- Is it a good idea to use S4 methods and classes ?
e.g.: "setClass", "setMethod" and so forth ....

>From what I have read it seems so!

I have ordered J.M. Chambers book  "programming 
with data, 1998" and I have read a very short and 
well writen document 13p. long entitled : Classes 
and Methods in the S Language, 2001.

These documents are old, but based on R help 
definition .Rd files are obviously important 
references!

2- I hope I am still on the wright track... if not please let me know...

Unfortunately, it will take two to six weeks 
before I receive the manual I have ordered.

3- Is there any other relevant and downloadable 
document out there that I could read meanwhile to 
improve my R skill using object-oriented 
techniques.

Sincerly

S?bastien Durand
--


From murdoch at stats.uwo.ca  Wed Jul  5 00:23:39 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Jul 2006 18:23:39 -0400
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <44AA8FCE.2070102@statistik.uni-dortmund.de>
References: <44AA5FC8.9020106@stats.uwo.ca>	<17578.34324.125621.658439@stat.math.ethz.ch>
	<44AA8FCE.2070102@statistik.uni-dortmund.de>
Message-ID: <44AAEA6B.6000604@stats.uwo.ca>

On 7/4/2006 11:57 AM, Uwe Ligges wrote:
> Martin Maechler wrote:
>>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>>     on Tue, 04 Jul 2006 08:32:08 -0400 writes:
>>     Duncan> I've just committed a couple of changes to R-devel related to requests 
>>     Duncan> at userR about the Windows installer.  The first of these affects all 
>>     Duncan> platforms, but I've only tested it on Windows:
>>
>>     Duncan> I added an option "quit.with.no.save".  If TRUE,
>>     Duncan> then the default q("ask") prompt will not offer to
>>     Duncan> save the workspace.  This is in response to the
>>     Duncan> observation that new users who are instructed not to
>>     Duncan> save their workspace, get confused when they
>>     Duncan> accidentally answer Yes to the prompt to save it.
>>
>> Ok...  but I probably misunderstand a bit:
>>
>> The default has not been   q(save = "ask") but  q(save = "default"),
>> and that default has depended on startup.
>>
>> Even now, "R --no-save"  already did have the desired effect,
>> on Unix at least.  For my ESS setup, I have made this an automatic
>> default many months ago.
>>
>> Wouldn't it be easier and sufficient to make "--no-save" a
>> working option on all platforms ?
>> Or is the point really about changing the quitting dialog?
>> For me quitting *without* a dialog is the most important thing
>> which I use (often several times a day).
>>
>>     Duncan> I'm not sure about the wording of the user prompt
>>     Duncan> question, which is now "Quit and discard
>>     Duncan> workspace?".  The problem with this wording is that
>>     Duncan> someone who automatically hits "y" will lose their
>>     Duncan> work.  I've tried on Windows to make the dialog box
>>     Duncan> look different enough that they should be warned.
>>
>> good!
>>
>>     Duncan> I haven't made any change to the Mac GUI to support this.  On 
>>     Duncan> Unix-alikes, the text prompt should respect this option.
>>
>>     Duncan> The other change is to the Windows installer, to
>>     Duncan> allow the user to choose whether to set
>>     Duncan> quit.with.no.save, MDI/SDI display, and help style
>>     Duncan> at install time.  The only (intentional) change to
>>     Duncan> the current behaviour is to default to CHM help
>>     Duncan> instead of plain text.
>>
>> People have asked me in private about this, and I didn't know
>> the answer:
>> Is it true that this means that people can no longer commit the
>> "cheap package install trick" on Windows for  R-code-only
>> packages?
>> Namely
>>   1) install a source package on a Linux/Unix/MacOSX machine
>>      (where it is often simple to have all the necessary tools available)
>>   2) zip the resulting installed package
>>   3) unzip it on the target Windows machine into the corresponding
>>      library (directory).
>>
>> Of course, this trick will not provide any *.chm help files.
>> Will the cheap-installed package still work, using the *.txt (or
>> *.html) help files?
> 
> 
> 
> Well, the user has to ask
>     help(topic, chmhelp = FALSE)
> in this case, or (s)he get the message:
> 
>               No CHM help for 'foo' in package 'pkg' is available:
>       the CHM file for the package is missing
> 
> Perhaps it is possible to arrange some fallback to plain text help if 
> chmhelp is not available: in print.help_files_with_topic call print() on 
> the "help_files_with_topic" object again, but change attribute "type" to 
> "help" before that call ...

Yes, that seems to work.  I'll add that.

Duncan Murdoch


From simon.urbanek at r-project.org  Wed Jul  5 01:43:58 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 4 Jul 2006 19:43:58 -0400
Subject: [Rd] options("quit.with.no.save")
In-Reply-To: <44AAC3B7.2080801@stats.uwo.ca>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.34324.125621.658439@stat.math.ethz.ch>
	<1D457B6B-1F1D-4FC0-929B-323E0E3A8CDB@r-project.org>
	<44AAC3B7.2080801@stats.uwo.ca>
Message-ID: <81A89161-0B7A-4753-8DEB-670CAE80BBCF@r-project.org>


On Jul 4, 2006, at 3:38 PM, Duncan Murdoch wrote:

>> I agree - it would be even nicer if there was a way to enable -- 
>> no- save with some environment variable ...
>
> Environment variables in Windows are a mess.  Doing things on the  
> command line or through option() is a lot easier.
>

Although I disagree (about the mess), I was thinking mainly about  
unix here - I'd simply love to put something in my .profile that will  
prevent the annoying question ;).


>> However, I think Duncan's approach is a very bad idea, because it   
>> means that with the same answer will give you opposite result.  
>> This  is a big UI no-no. (Windows users may may think it's a valid  
>> option,  because Microsoft tends to do stupid things like that,  
>> but that's  only because they never think about UI).
>
> I agree that that is a problem.  However, I don't know a better  
> solution:
>   - I want to make it hard for the user to accidentally create a  
> saved workspace.  Just changing the default will mean that people  
> who habitually answer "yes" will still get the wrong result.

I would argue that if someone 'habitually' ignores the default and  
selects yes, then it's his/her deliberate choice and likely not a new  
user, because a new user doesn't yet have such a habit - to the  
contrary, new users are the one most likely influenced by defaults.


>   - I want to make it hard for the user to accidentally lose a  
> workspace.  Hence --no-save is not an option.
>
> The problem with my solution as it stands is that people who  
> habitually answer "yes" will sometimes accidentally lose a workspace.
>

.. and for the reason you stated I think that's a major problem!


>> The correct approach is to change the default button, but  
>> definitely  not the dialog box.
>
> I don't think this is sufficient.
>


Your solution may possibly be more efficient in solving the problem  
you described, but IMHO it causes a much bigger problem. I'd still  
prefer one save too many that any loss of data.

Cheers,
Simon


From simon.urbanek at r-project.org  Wed Jul  5 02:00:25 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 4 Jul 2006 20:00:25 -0400
Subject: [Rd] double-quote tab crashes R (PR#9058)
In-Reply-To: <20060704082617.C7248537E4@slim.kubism.ku.dk>
References: <20060704082617.C7248537E4@slim.kubism.ku.dk>
Message-ID: <85B3DE87-932F-41A1-960B-CCB7C2F4FD2F@r-project.org>


On Jul 4, 2006, at 4:26 AM, jb at johnbear.net wrote:

> This seems to crash my version of R: "<TAB>
>

Thanks. Now fixed in the GUI rev. 3283.

There's still an open issue about the completion of empty names, but  
I need to dig more to solve that (at least it doesn't crash ;)).

Cheers,
Simon


From murdoch at stats.uwo.ca  Wed Jul  5 02:11:58 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Jul 2006 20:11:58 -0400
Subject: [Rd] options("quit.with.no.save")
In-Reply-To: <81A89161-0B7A-4753-8DEB-670CAE80BBCF@r-project.org>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.34324.125621.658439@stat.math.ethz.ch>
	<1D457B6B-1F1D-4FC0-929B-323E0E3A8CDB@r-project.org>
	<44AAC3B7.2080801@stats.uwo.ca>
	<81A89161-0B7A-4753-8DEB-670CAE80BBCF@r-project.org>
Message-ID: <44AB03CE.6080909@stats.uwo.ca>

On 7/4/2006 7:43 PM, Simon Urbanek wrote:
> On Jul 4, 2006, at 3:38 PM, Duncan Murdoch wrote:
> 
>>> I agree - it would be even nicer if there was a way to enable -- 
>>> no- save with some environment variable ...
>> Environment variables in Windows are a mess.  Doing things on the  
>> command line or through option() is a lot easier.
>>
> 
> Although I disagree (about the mess), I was thinking mainly about  
> unix here - I'd simply love to put something in my .profile that will  
> prevent the annoying question ;).

Put in an alias for R that adds --no-save?

>>> However, I think Duncan's approach is a very bad idea, because it   
>>> means that with the same answer will give you opposite result.  
>>> This  is a big UI no-no. (Windows users may may think it's a valid  
>>> option,  because Microsoft tends to do stupid things like that,  
>>> but that's  only because they never think about UI).
>> I agree that that is a problem.  However, I don't know a better  
>> solution:
>>   - I want to make it hard for the user to accidentally create a  
>> saved workspace.  Just changing the default will mean that people  
>> who habitually answer "yes" will still get the wrong result.
> 
> I would argue that if someone 'habitually' ignores the default and  
> selects yes, then it's his/her deliberate choice and likely not a new  
> user, because a new user doesn't yet have such a habit - to the  
> contrary, new users are the one most likely influenced by defaults.
> 
> 
>>   - I want to make it hard for the user to accidentally lose a  
>> workspace.  Hence --no-save is not an option.
>>
>> The problem with my solution as it stands is that people who  
>> habitually answer "yes" will sometimes accidentally lose a workspace.
>>
> 
> .. and for the reason you stated I think that's a major problem!
> 
> 
>>> The correct approach is to change the default button, but  
>>> definitely  not the dialog box.
>> I don't think this is sufficient.
>>
> 
> 
> Your solution may possibly be more efficient in solving the problem  
> you described, but IMHO it causes a much bigger problem. I'd still  
> prefer one save too many that any loss of data.

I was actually agreeing with you :-).  I'm going to revert the 
quit.with.no.save addition.  I'm not sure what should go in instead, but 
I think it's not just a rewording of the same sort of option.

As you said in your other message, the problem isn't really the 
unnecessary save. That wastes a bit of disk space, but provides some 
insurance against accidental data loss.  The problem is the auto-load on 
startup.

I could have the installer put the --no-restore on the Rgui command 
line, but it would be cleaner to put something in the default Rprofile 
file.  Then the user could override it in their private .Rprofile or by 
putting something on the command line.

At the same time, I could add an option to hold a default value for the 
save parameter of q(), so q() could be q("no") for you.

What do you think of that?  What would you name these two options?

Duncan Murdoch


From ggrothendieck at gmail.com  Wed Jul  5 05:12:11 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 4 Jul 2006 23:12:11 -0400
Subject: [Rd] attributes of environments
Message-ID: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>

In the code below, e is an environment which we copy to f and then
add attributes to e.  Now f winds up with the same attributes.

In other words it seems that the attributes are a property of the
environment itself and not of the variable.  Thus it appears we
cannot have two environment variables that correspond to the
original environment but with different attributes.

I can understand if we changed a component of e then
f would reflect that too but I am not sure that this is also
desirable for attributes as they are not "in" the environment.

Is that desirable?  Is it a bug?  No other class works that way
AFAIK.   Comments?

> e <- new.env()
> f <- e
> attr(e, "X") <- "Y"   # X is an attribute of e
> f  # f gets the same attribute !!!
<environment: 0x01a577f0>
attr(,"X")
[1] "Y"
> R.version.string # Windows XP
[1] "R version 2.4.0 Under development (unstable) (2006-07-04 r38480)"


From ripley at stats.ox.ac.uk  Wed Jul  5 09:22:51 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Jul 2006 08:22:51 +0100 (BST)
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <44AAEA6B.6000604@stats.uwo.ca>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.34324.125621.658439@stat.math.ethz.ch>
	<44AA8FCE.2070102@statistik.uni-dortmund.de>
	<44AAEA6B.6000604@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0607050820360.1149@gannet.stats.ox.ac.uk>

On Tue, 4 Jul 2006, Duncan Murdoch wrote:

> On 7/4/2006 11:57 AM, Uwe Ligges wrote:
>> Martin Maechler wrote:
>>>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>>>     on Tue, 04 Jul 2006 08:32:08 -0400 writes:
>>>     Duncan> I've just committed a couple of changes to R-devel related to requests
>>>     Duncan> at userR about the Windows installer.  The first of these affects all
>>>     Duncan> platforms, but I've only tested it on Windows:
>>>
>>>     Duncan> I added an option "quit.with.no.save".  If TRUE,
>>>     Duncan> then the default q("ask") prompt will not offer to
>>>     Duncan> save the workspace.  This is in response to the
>>>     Duncan> observation that new users who are instructed not to
>>>     Duncan> save their workspace, get confused when they
>>>     Duncan> accidentally answer Yes to the prompt to save it.
>>>
>>> Ok...  but I probably misunderstand a bit:
>>>
>>> The default has not been   q(save = "ask") but  q(save = "default"),
>>> and that default has depended on startup.
>>>
>>> Even now, "R --no-save"  already did have the desired effect,
>>> on Unix at least.  For my ESS setup, I have made this an automatic
>>> default many months ago.
>>>
>>> Wouldn't it be easier and sufficient to make "--no-save" a
>>> working option on all platforms ?
>>> Or is the point really about changing the quitting dialog?
>>> For me quitting *without* a dialog is the most important thing
>>> which I use (often several times a day).
>>>
>>>     Duncan> I'm not sure about the wording of the user prompt
>>>     Duncan> question, which is now "Quit and discard
>>>     Duncan> workspace?".  The problem with this wording is that
>>>     Duncan> someone who automatically hits "y" will lose their
>>>     Duncan> work.  I've tried on Windows to make the dialog box
>>>     Duncan> look different enough that they should be warned.
>>>
>>> good!
>>>
>>>     Duncan> I haven't made any change to the Mac GUI to support this.  On
>>>     Duncan> Unix-alikes, the text prompt should respect this option.
>>>
>>>     Duncan> The other change is to the Windows installer, to
>>>     Duncan> allow the user to choose whether to set
>>>     Duncan> quit.with.no.save, MDI/SDI display, and help style
>>>     Duncan> at install time.  The only (intentional) change to
>>>     Duncan> the current behaviour is to default to CHM help
>>>     Duncan> instead of plain text.
>>>
>>> People have asked me in private about this, and I didn't know
>>> the answer:
>>> Is it true that this means that people can no longer commit the
>>> "cheap package install trick" on Windows for  R-code-only
>>> packages?
>>> Namely
>>>   1) install a source package on a Linux/Unix/MacOSX machine
>>>      (where it is often simple to have all the necessary tools available)
>>>   2) zip the resulting installed package
>>>   3) unzip it on the target Windows machine into the corresponding
>>>      library (directory).
>>>
>>> Of course, this trick will not provide any *.chm help files.
>>> Will the cheap-installed package still work, using the *.txt (or
>>> *.html) help files?
>>
>>
>>
>> Well, the user has to ask
>>     help(topic, chmhelp = FALSE)
>> in this case, or (s)he get the message:
>>
>>               No CHM help for 'foo' in package 'pkg' is available:
>>       the CHM file for the package is missing
>>
>> Perhaps it is possible to arrange some fallback to plain text help if
>> chmhelp is not available: in print.help_files_with_topic call print() on
>> the "help_files_with_topic" object again, but change attribute "type" to
>> "help" before that call ...
>
> Yes, that seems to work.  I'll add that.

Before help() was reorganized to use print() methods it used to fall back 
to text help if other versions were not available (at least on Windows), 
so it does seem sensible to reinstate that.

Brian

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From phgrosjean at sciviews.org  Wed Jul  5 10:02:34 2006
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Wed, 05 Jul 2006 10:02:34 +0200
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <Pine.LNX.4.64.0607050820360.1149@gannet.stats.ox.ac.uk>
References: <44AA5FC8.9020106@stats.uwo.ca>	<17578.34324.125621.658439@stat.math.ethz.ch>	<44AA8FCE.2070102@statistik.uni-dortmund.de>	<44AAEA6B.6000604@stats.uwo.ca>
	<Pine.LNX.4.64.0607050820360.1149@gannet.stats.ox.ac.uk>
Message-ID: <44AB721A.4020407@sciviews.org>

Hello,

Related to Windows installer changes (requests), would it be possible to 
specify whether RGui is installed to run in MDI or SDI mode at start? It 
is as simple as adding a 'Run RGui in SDI mode' option in InnoSetup that 
installs a <Rdir>/etc/Rconsole file containing 'MDI = no' when the 
option is checked.

Explanation: MDI mode is an old-style and it is less in use now (most 
recent multidocuments programs offer either navigation with tabs, and/or 
SDI mode to manipulate multiple documents; even Microsoft that used the 
MDI style in all its applications is now moving to SDI with Word, Excel, 
...). Regarding R, the MDI-style in RGui is problematic, or at least 
suboptimal, with many GUIs under Windows.

Currently, new users that are told to switch to "SDI style in RGui" are 
very intimidated by the procedure: (1) what is SDI versus MDI?, (2) they 
have to open the 'RGui preference' dialog box, make the changes, save 
the file in a particular location, (3) ignore the intimidating warning 
that appears, (4) close RGui and restart it. All this is very, very 
unfriendly for a very first approach to R... and I see it on the face of 
my students!

With the option in InnoSetup installer, everything would be much 
smoother to get RGui in SDI mode from start.

Thanks for considering this proposition.
Best,

Philippe Grosjean

..............................................<?}))><........
  ) ) ) ) )
( ( ( ( (    Prof. Philippe Grosjean
  ) ) ) ) )
( ( ( ( (    Numerical Ecology of Aquatic Systems
  ) ) ) ) )   Mons-Hainaut University, Belgium
( ( ( ( (
..............................................................

Prof Brian Ripley wrote:
> On Tue, 4 Jul 2006, Duncan Murdoch wrote:
> 
> 
>>On 7/4/2006 11:57 AM, Uwe Ligges wrote:
>>
>>>Martin Maechler wrote:
>>>
>>>>>>>>>"Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>>>>    on Tue, 04 Jul 2006 08:32:08 -0400 writes:
>>>>
>>>>    Duncan> I've just committed a couple of changes to R-devel related to requests
>>>>    Duncan> at userR about the Windows installer.  The first of these affects all
>>>>    Duncan> platforms, but I've only tested it on Windows:
>>>>
>>>>    Duncan> I added an option "quit.with.no.save".  If TRUE,
>>>>    Duncan> then the default q("ask") prompt will not offer to
>>>>    Duncan> save the workspace.  This is in response to the
>>>>    Duncan> observation that new users who are instructed not to
>>>>    Duncan> save their workspace, get confused when they
>>>>    Duncan> accidentally answer Yes to the prompt to save it.
>>>>
>>>>Ok...  but I probably misunderstand a bit:
>>>>
>>>>The default has not been   q(save = "ask") but  q(save = "default"),
>>>>and that default has depended on startup.
>>>>
>>>>Even now, "R --no-save"  already did have the desired effect,
>>>>on Unix at least.  For my ESS setup, I have made this an automatic
>>>>default many months ago.
>>>>
>>>>Wouldn't it be easier and sufficient to make "--no-save" a
>>>>working option on all platforms ?
>>>>Or is the point really about changing the quitting dialog?
>>>>For me quitting *without* a dialog is the most important thing
>>>>which I use (often several times a day).
>>>>
>>>>    Duncan> I'm not sure about the wording of the user prompt
>>>>    Duncan> question, which is now "Quit and discard
>>>>    Duncan> workspace?".  The problem with this wording is that
>>>>    Duncan> someone who automatically hits "y" will lose their
>>>>    Duncan> work.  I've tried on Windows to make the dialog box
>>>>    Duncan> look different enough that they should be warned.
>>>>
>>>>good!
>>>>
>>>>    Duncan> I haven't made any change to the Mac GUI to support this.  On
>>>>    Duncan> Unix-alikes, the text prompt should respect this option.
>>>>
>>>>    Duncan> The other change is to the Windows installer, to
>>>>    Duncan> allow the user to choose whether to set
>>>>    Duncan> quit.with.no.save, MDI/SDI display, and help style
>>>>    Duncan> at install time.  The only (intentional) change to
>>>>    Duncan> the current behaviour is to default to CHM help
>>>>    Duncan> instead of plain text.
>>>>
>>>>People have asked me in private about this, and I didn't know
>>>>the answer:
>>>>Is it true that this means that people can no longer commit the
>>>>"cheap package install trick" on Windows for  R-code-only
>>>>packages?
>>>>Namely
>>>>  1) install a source package on a Linux/Unix/MacOSX machine
>>>>     (where it is often simple to have all the necessary tools available)
>>>>  2) zip the resulting installed package
>>>>  3) unzip it on the target Windows machine into the corresponding
>>>>     library (directory).
>>>>
>>>>Of course, this trick will not provide any *.chm help files.
>>>>Will the cheap-installed package still work, using the *.txt (or
>>>>*.html) help files?
>>>
>>>
>>>
>>>Well, the user has to ask
>>>    help(topic, chmhelp = FALSE)
>>>in this case, or (s)he get the message:
>>>
>>>              No CHM help for 'foo' in package 'pkg' is available:
>>>      the CHM file for the package is missing
>>>
>>>Perhaps it is possible to arrange some fallback to plain text help if
>>>chmhelp is not available: in print.help_files_with_topic call print() on
>>>the "help_files_with_topic" object again, but change attribute "type" to
>>>"help" before that call ...
>>
>>Yes, that seems to work.  I'll add that.
> 
> 
> Before help() was reorganized to use print() methods it used to fall back 
> to text help if other versions were not available (at least on Windows), 
> so it does seem sensible to reinstate that.
> 
> Brian
>


From ligges at statistik.uni-dortmund.de  Wed Jul  5 10:16:11 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed, 05 Jul 2006 10:16:11 +0200
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <44AB721A.4020407@sciviews.org>
References: <44AA5FC8.9020106@stats.uwo.ca>	<17578.34324.125621.658439@stat.math.ethz.ch>	<44AA8FCE.2070102@statistik.uni-dortmund.de>	<44AAEA6B.6000604@stats.uwo.ca>	<Pine.LNX.4.64.0607050820360.1149@gannet.stats.ox.ac.uk>
	<44AB721A.4020407@sciviews.org>
Message-ID: <44AB754B.6020405@statistik.uni-dortmund.de>

Philippe Grosjean wrote:
> Hello,
> 
> Related to Windows installer changes (requests), would it be possible to 
> specify whether RGui is installed to run in MDI or SDI mode at start? It 
> is as simple as adding a 'Run RGui in SDI mode' option in InnoSetup that 
> installs a <Rdir>/etc/Rconsole file containing 'MDI = no' when the 
> option is checked.
> 
> Explanation: MDI mode is an old-style and it is less in use now (most 
> recent multidocuments programs offer either navigation with tabs, and/or 
> SDI mode to manipulate multiple documents; even Microsoft that used the 
> MDI style in all its applications is now moving to SDI with Word, Excel, 
> ...). Regarding R, the MDI-style in RGui is problematic, or at least 
> suboptimal, with many GUIs under Windows.
> 
> Currently, new users that are told to switch to "SDI style in RGui" are 
> very intimidated by the procedure: (1) what is SDI versus MDI?, (2) they 
> have to open the 'RGui preference' dialog box, make the changes, save 
> the file in a particular location, (3) ignore the intimidating warning 
> that appears, (4) close RGui and restart it. All this is very, very 
> unfriendly for a very first approach to R... and I see it on the face of 
> my students!
> 
> With the option in InnoSetup installer, everything would be much 
> smoother to get RGui in SDI mode from start.


Yes, that is exactly what Duncan already did!

 From CHANGES:

"The installer can set defaults for MDI/SDI display, help style, and
default action on q().  Custom builds of R can change these defaults."

Uwe Ligges


> Thanks for considering this proposition.
> Best,
> 
> Philippe Grosjean
> 
> ..............................................<?}))><........
>   ) ) ) ) )
> ( ( ( ( (    Prof. Philippe Grosjean
>   ) ) ) ) )
> ( ( ( ( (    Numerical Ecology of Aquatic Systems
>   ) ) ) ) )   Mons-Hainaut University, Belgium
> ( ( ( ( (
> ..............................................................
> 
> Prof Brian Ripley wrote:
>> On Tue, 4 Jul 2006, Duncan Murdoch wrote:
>>
>>
>>> On 7/4/2006 11:57 AM, Uwe Ligges wrote:
>>>
>>>> Martin Maechler wrote:
>>>>
>>>>>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>>>>>    on Tue, 04 Jul 2006 08:32:08 -0400 writes:
>>>>>    Duncan> I've just committed a couple of changes to R-devel related to requests
>>>>>    Duncan> at userR about the Windows installer.  The first of these affects all
>>>>>    Duncan> platforms, but I've only tested it on Windows:
>>>>>
>>>>>    Duncan> I added an option "quit.with.no.save".  If TRUE,
>>>>>    Duncan> then the default q("ask") prompt will not offer to
>>>>>    Duncan> save the workspace.  This is in response to the
>>>>>    Duncan> observation that new users who are instructed not to
>>>>>    Duncan> save their workspace, get confused when they
>>>>>    Duncan> accidentally answer Yes to the prompt to save it.
>>>>>
>>>>> Ok...  but I probably misunderstand a bit:
>>>>>
>>>>> The default has not been   q(save = "ask") but  q(save = "default"),
>>>>> and that default has depended on startup.
>>>>>
>>>>> Even now, "R --no-save"  already did have the desired effect,
>>>>> on Unix at least.  For my ESS setup, I have made this an automatic
>>>>> default many months ago.
>>>>>
>>>>> Wouldn't it be easier and sufficient to make "--no-save" a
>>>>> working option on all platforms ?
>>>>> Or is the point really about changing the quitting dialog?
>>>>> For me quitting *without* a dialog is the most important thing
>>>>> which I use (often several times a day).
>>>>>
>>>>>    Duncan> I'm not sure about the wording of the user prompt
>>>>>    Duncan> question, which is now "Quit and discard
>>>>>    Duncan> workspace?".  The problem with this wording is that
>>>>>    Duncan> someone who automatically hits "y" will lose their
>>>>>    Duncan> work.  I've tried on Windows to make the dialog box
>>>>>    Duncan> look different enough that they should be warned.
>>>>>
>>>>> good!
>>>>>
>>>>>    Duncan> I haven't made any change to the Mac GUI to support this.  On
>>>>>    Duncan> Unix-alikes, the text prompt should respect this option.
>>>>>
>>>>>    Duncan> The other change is to the Windows installer, to
>>>>>    Duncan> allow the user to choose whether to set
>>>>>    Duncan> quit.with.no.save, MDI/SDI display, and help style
>>>>>    Duncan> at install time.  The only (intentional) change to
>>>>>    Duncan> the current behaviour is to default to CHM help
>>>>>    Duncan> instead of plain text.
>>>>>
>>>>> People have asked me in private about this, and I didn't know
>>>>> the answer:
>>>>> Is it true that this means that people can no longer commit the
>>>>> "cheap package install trick" on Windows for  R-code-only
>>>>> packages?
>>>>> Namely
>>>>>  1) install a source package on a Linux/Unix/MacOSX machine
>>>>>     (where it is often simple to have all the necessary tools available)
>>>>>  2) zip the resulting installed package
>>>>>  3) unzip it on the target Windows machine into the corresponding
>>>>>     library (directory).
>>>>>
>>>>> Of course, this trick will not provide any *.chm help files.
>>>>> Will the cheap-installed package still work, using the *.txt (or
>>>>> *.html) help files?
>>>>
>>>>
>>>> Well, the user has to ask
>>>>    help(topic, chmhelp = FALSE)
>>>> in this case, or (s)he get the message:
>>>>
>>>>              No CHM help for 'foo' in package 'pkg' is available:
>>>>      the CHM file for the package is missing
>>>>
>>>> Perhaps it is possible to arrange some fallback to plain text help if
>>>> chmhelp is not available: in print.help_files_with_topic call print() on
>>>> the "help_files_with_topic" object again, but change attribute "type" to
>>>> "help" before that call ...
>>> Yes, that seems to work.  I'll add that.
>>
>> Before help() was reorganized to use print() methods it used to fall back 
>> to text help if other versions were not available (at least on Windows), 
>> so it does seem sensible to reinstate that.
>>
>> Brian
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Wed Jul  5 10:19:50 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Jul 2006 09:19:50 +0100 (BST)
Subject: [Rd] prefix 'R_' when calling external code
In-Reply-To: <44A73BC8.5080901@stat.purdue.edu>
References: <44A73BC8.5080901@stat.purdue.edu>
Message-ID: <Pine.LNX.4.64.0607050914150.11987@gannet.stats.ox.ac.uk>

On Sat, 1 Jul 2006, Benjamin Tyner wrote:

> I noticed that in
>
> https://svn.r-project.org/R/trunk/src/library/stats/R/loess.R
>
> that we are now calling R_loess_raw, R_lowesw, R_lowesp, etc. I'm
> interested to know what is the benefit/reason for the 'R_', as I am
> unfamiliar with this prefix and do not see it mentioned in 'Writing R
> Extensions.'

It is used when mapping external entry points to R symbols in that 
package: the latter must not clash with other R objects in the namespace, 
and this is why the prefix is added (in the NAMESPACE file, at

  # Refer to all C/Fortran routines by their name prefixed by R_
useDynLib(stats, .registration = TRUE, .fixes = "R_")

).

You say 'now': 'we' (R-core) never had loess_raw as an R symbol, rather 
"loess_raw" as a character string.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From phgrosjean at sciviews.org  Wed Jul  5 10:24:55 2006
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Wed, 05 Jul 2006 10:24:55 +0200
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <44AB754B.6020405@statistik.uni-dortmund.de>
References: <44AA5FC8.9020106@stats.uwo.ca>	<17578.34324.125621.658439@stat.math.ethz.ch>	<44AA8FCE.2070102@statistik.uni-dortmund.de>	<44AAEA6B.6000604@stats.uwo.ca>	<Pine.LNX.4.64.0607050820360.1149@gannet.stats.ox.ac.uk>
	<44AB721A.4020407@sciviews.org>
	<44AB754B.6020405@statistik.uni-dortmund.de>
Message-ID: <44AB7757.40605@sciviews.org>

Uwe Ligges wrote:
  [...]
> 
> 
> Yes, that is exactly what Duncan already did!
> 
>  From CHANGES:
> 
> "The installer can set defaults for MDI/SDI display, help style, and
> default action on q().  Custom builds of R can change these defaults."
> 
> Uwe Ligges

Oh, sorry! (I should always read a thread from the beginning ;-)
Best,

Philippe


From ripley at stats.ox.ac.uk  Wed Jul  5 10:49:09 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Jul 2006 09:49:09 +0100 (BST)
Subject: [Rd] problem getting R 2.3.1 svn r38481 to pass make check-all
In-Reply-To: <1152026786.31350.9.camel@graptoleberis.geog.ucl.ac.uk>
References: <1152026786.31350.9.camel@graptoleberis.geog.ucl.ac.uk>
Message-ID: <Pine.LNX.4.64.0607050937450.11987@gannet.stats.ox.ac.uk>

By `R 2.3.1 svn r38481' do you mean R-patched?  (R 2.3.1 is released.)

Looks like r38469 ported the revised test results but not the test: I have 
now done so.


On Tue, 4 Jul 2006, Gavin Simpson wrote:

> Hi,
>
> I noticed this problem on my home desktop running FC4 and again on my
> laptop running FC5. Both have previously compiled and passed make
> check-all on 2.3.1 svn revisions from 10 days ago or so. On both these
> machines, make check-all is consistently failing (4 out of 4 attempts on
> the FC 4 desktop and 3 out of 3 on the FC 5 laptop) in the
> p-r-random-tests tests. This is with both default compiler flags and
> extra flags set in config.site.
>
> R is failing make check-all with the following set of messages:
>
> ...
> make[3]: Entering directory `/home/gavin/R/2.3-patches/build/tests'
> running code in '../../tests/p-r-random-tests.R' ... OK
> comparing 'p-r-random-tests.Rout' to
> '../../tests/p-r-random-tests.Rout.save' ...1a2,16
>> R version 2.4.0 Under development (unstable) (2006-06-30 r38463)
>> Copyright (C) 2006 The R Foundation for Statistical Computing
>> ISBN 3-900051-07-0
>>
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under certain conditions.
>> Type 'license()' or 'licence()' for distribution details.
>>
>> R is a collaborative project with many contributors.
>> Type 'contributors()' for more information and
>> 'citation()' on how to cite R or R packages in publications.
>>
>> Type 'demo()' for some demos, 'help()' for on-line help, or
>> 'help.start()' for an HTML browser interface to help.
>> Type 'q()' to quit R.
> 254a270,274
>>> ## regression test for non-central t bug
>>> dkwtest("t", df=20, ncp=3)
>> t(df = 20, ncp = 3) PASSED
>> [1] TRUE
>>>
> make[3]: *** [p-r-random-tests.Rout] Error 1
> make[3]: Leaving directory `/home/gavin/R/2.3-patches/build/tests'
> make[2]: *** [test-Random] Error 2
> make[2]: Leaving directory `/home/gavin/R/2.3-patches/build/tests'
> make[1]: *** [test-all-devel] Error 1
> make[1]: Leaving directory `/home/gavin/R/2.3-patches/build/tests'
> make: *** [check-all] Error 2
>
> I looked in ./tests/p-r-random-tests.Rout.fail and couldn't see anything
> that indicated a failure - everything had PASSED or TRUE as results of
> the tests. I append the contents of this file below.
>
> Anyone see what is wrong?
>
> Thanks in advance,
>
> Gavin
>
> ## Contents of p-r-random-tests.Rout.fail ##
>
> R : Copyright 2006, The R Foundation for Statistical Computing
> Version 2.3.1 Patched (2006-07-03 r38481)
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>> ##
>> ## RNG tests using DKW inequality for rate of convergence
>> ##
>> ## P(sup | F_n - F | > t) < 2 exp(-2nt^2)
>> ##
>> ## The 2 in front of exp() was derived by Massart. It is the best
> possible
>> ## constant valid uniformly in t,n,F. For large n*t^2 this agrees with
> the
>> ## large-sample approximation to the Kolmogorov-Smirnov statistic.
>> ##
>>
>>
>> superror <- function(rfoo,pfoo,sample.size,...) {
> +     x <- rfoo(sample.size,...)
> +     tx <- table(x)
> +     xi <- as.numeric(names(tx))
> +     f <- pfoo(xi,...)
> +     fhat <- cumsum(tx)/sample.size
> +     max(abs(fhat-f))
> + }
>>
>> pdkwbound <- function(n,t) 2*exp(-2*n*t*t)
>>
>> qdkwbound <- function(n,p) sqrt(log(p/2)/(-2*n))
>>
>> dkwtest <- function(stub = "norm", ...,
> +                     sample.size = 10000, pthreshold = 0.001,
> +                     print.result = TRUE, print.detail = FALSE,
> +                     stop.on.failure = TRUE)
> + {
> +     rfoo <- eval(as.name(paste("r", stub, sep="")))
> +     pfoo <- eval(as.name(paste("p", stub, sep="")))
> +     s <- superror(rfoo, pfoo, sample.size, ...)
> +     if (print.result || print.detail) {
> +         printargs <- substitute(list(...))
> +         printargs[[1]] <- as.name(stub)
> +         cat(deparse(printargs))
> +         if (print.detail)
> +             cat("\nsupremum error = ",signif(s,2),
> +                 " with
> p-value=",min(1,round(pdkwbound(sample.size,s),4)),"\n")
> +     }
> +     rval <- (s < qdkwbound(sample.size,pthreshold))
> +     if (print.result)
> +         cat(c(" FAILED\n"," PASSED\n",)[rval+1])
> +     if (stop.on.failure && !rval)
> +         stop("dkwtest failed")
> +     rval
> + }
>>
>> .proctime00 <- proc.time() # start timing
>>
>>
>> dkwtest("binom",size =   1,prob = 0.2)
> binom(size = 1, prob = 0.2) PASSED
> [1] TRUE
>> dkwtest("binom",size =   2,prob = 0.2)
> binom(size = 2, prob = 0.2) PASSED
> [1] TRUE
>> dkwtest("binom",size = 100,prob = 0.2)
> binom(size = 100, prob = 0.2) PASSED
> [1] TRUE
>> dkwtest("binom",size = 1e4,prob = 0.2)
> binom(size = 10000, prob = 0.2) PASSED
> [1] TRUE
>> dkwtest("binom",size =   1,prob = 0.8)
> binom(size = 1, prob = 0.8) PASSED
> [1] TRUE
>> dkwtest("binom",size = 100,prob = 0.8)
> binom(size = 100, prob = 0.8) PASSED
> [1] TRUE
>> dkwtest("binom",size = 100,prob = 0.999)
> binom(size = 100, prob = 0.999) PASSED
> [1] TRUE
>>
>> dkwtest("pois",lambda =  0.095)
> pois(lambda = 0.095) PASSED
> [1] TRUE
>> dkwtest("pois",lambda =  0.95)
> pois(lambda = 0.95) PASSED
> [1] TRUE
>> dkwtest("pois",lambda =  9.5)
> pois(lambda = 9.5) PASSED
> [1] TRUE
>> dkwtest("pois",lambda = 95)
> pois(lambda = 95) PASSED
> [1] TRUE
>>
>> dkwtest("nbinom",size =   1,prob = 0.2)
> nbinom(size = 1, prob = 0.2) PASSED
> [1] TRUE
>> dkwtest("nbinom",size =   2,prob = 0.2)
> nbinom(size = 2, prob = 0.2) PASSED
> [1] TRUE
>> dkwtest("nbinom",size = 100,prob = 0.2)
> nbinom(size = 100, prob = 0.2) PASSED
> [1] TRUE
>> dkwtest("nbinom",size = 1e4,prob = 0.2)
> nbinom(size = 10000, prob = 0.2) PASSED
> [1] TRUE
>> dkwtest("nbinom",size =   1,prob = 0.8)
> nbinom(size = 1, prob = 0.8) PASSED
> [1] TRUE
>> dkwtest("nbinom",size = 100,prob = 0.8)
> nbinom(size = 100, prob = 0.8) PASSED
> [1] TRUE
>> dkwtest("nbinom",size = 100,prob = 0.999)
> nbinom(size = 100, prob = 0.999) PASSED
> [1] TRUE
>>
>> dkwtest("norm")
> norm() PASSED
> [1] TRUE
>> dkwtest("norm",mean = 5,sd = 3)
> norm(mean = 5, sd = 3) PASSED
> [1] TRUE
>>
>> dkwtest("gamma",shape =  0.1)
> gamma(shape = 0.1) PASSED
> [1] TRUE
>> dkwtest("gamma",shape =  0.2)
> gamma(shape = 0.2) PASSED
> [1] TRUE
>> dkwtest("gamma",shape = 10)
> gamma(shape = 10) PASSED
> [1] TRUE
>> dkwtest("gamma",shape = 20)
> gamma(shape = 20) PASSED
> [1] TRUE
>>
>> dkwtest("hyper",m = 40,n = 30,k = 20)
> hyper(m = 40, n = 30, k = 20) PASSED
> [1] TRUE
>> dkwtest("hyper",m = 40,n =  3,k = 20)
> hyper(m = 40, n = 3, k = 20) PASSED
> [1] TRUE
>> dkwtest("hyper",m =  6,n =  3,k =  2)
> hyper(m = 6, n = 3, k = 2) PASSED
> [1] TRUE
>> dkwtest("hyper",m =  5,n =  3,k =  2)
> hyper(m = 5, n = 3, k = 2) PASSED
> [1] TRUE
>> dkwtest("hyper",m =  4,n =  3,k =  2)
> hyper(m = 4, n = 3, k = 2) PASSED
> [1] TRUE
>>
>>
>> dkwtest("signrank",n =  1)
> signrank(n = 1) PASSED
> [1] TRUE
>> dkwtest("signrank",n =  2)
> signrank(n = 2) PASSED
> [1] TRUE
>> dkwtest("signrank",n = 10)
> signrank(n = 10) PASSED
> [1] TRUE
>> dkwtest("signrank",n = 30)
> signrank(n = 30) PASSED
> [1] TRUE
>>
>> dkwtest("wilcox",m = 40,n = 30)
> wilcox(m = 40, n = 30) PASSED
> [1] TRUE
>> dkwtest("wilcox",m = 40,n = 10)
> wilcox(m = 40, n = 10) PASSED
> [1] TRUE
>> dkwtest("wilcox",m =  6,n =  3)
> wilcox(m = 6, n = 3) PASSED
> [1] TRUE
>> dkwtest("wilcox",m =  5,n =  3)
> wilcox(m = 5, n = 3) PASSED
> [1] TRUE
>> dkwtest("wilcox",m =  4,n =  3)
> wilcox(m = 4, n = 3) PASSED
> [1] TRUE
>>
>> dkwtest("chisq",df =  1)
> chisq(df = 1) PASSED
> [1] TRUE
>> dkwtest("chisq",df = 10)
> chisq(df = 10) PASSED
> [1] TRUE
>>
>> dkwtest("logis")
> logis() PASSED
> [1] TRUE
>> dkwtest("logis",location = 4,scale = 2)
> logis(location = 4, scale = 2) PASSED
> [1] TRUE
>>
>> dkwtest("t",df =  1)
> t(df = 1) PASSED
> [1] TRUE
>> dkwtest("t",df = 10)
> t(df = 10) PASSED
> [1] TRUE
>> dkwtest("t",df = 40)
> t(df = 40) PASSED
> [1] TRUE
>>
>> dkwtest("beta",shape1 = 1, shape2 = 1)
> beta(shape1 = 1, shape2 = 1) PASSED
> [1] TRUE
>> dkwtest("beta",shape1 = 2, shape2 = 1)
> beta(shape1 = 2, shape2 = 1) PASSED
> [1] TRUE
>> dkwtest("beta",shape1 = 1, shape2 = 2)
> beta(shape1 = 1, shape2 = 2) PASSED
> [1] TRUE
>> dkwtest("beta",shape1 = 2, shape2 = 2)
> beta(shape1 = 2, shape2 = 2) PASSED
> [1] TRUE
>> dkwtest("beta",shape1 = .2,shape2 = .2)
> beta(shape1 = 0.2, shape2 = 0.2) PASSED
> [1] TRUE
>>
>> dkwtest("cauchy")
> cauchy() PASSED
> [1] TRUE
>> dkwtest("cauchy",location = 4,scale = 2)
> cauchy(location = 4, scale = 2) PASSED
> [1] TRUE
>>
>> dkwtest("f",df1 =  1,df2 =  1)
> f(df1 = 1, df2 = 1) PASSED
> [1] TRUE
>> dkwtest("f",df1 =  1,df2 = 10)
> f(df1 = 1, df2 = 10) PASSED
> [1] TRUE
>> dkwtest("f",df1 = 10,df2 = 10)
> f(df1 = 10, df2 = 10) PASSED
> [1] TRUE
>> dkwtest("f",df1 = 30,df2 =  3)
> f(df1 = 30, df2 = 3) PASSED
> [1] TRUE
>>
>> dkwtest("weibull",shape = 1)
> weibull(shape = 1) PASSED
> [1] TRUE
>> dkwtest("weibull",shape = 4,scale = 4)
> weibull(shape = 4, scale = 4) PASSED
> [1] TRUE
>>
>> ## regression test for PR#7314
>> dkwtest("hyper", m=60, n=100, k=50)
> hyper(m = 60, n = 100, k = 50) PASSED
> [1] TRUE
>> dkwtest("hyper", m=6, n=10, k=5)
> hyper(m = 6, n = 10, k = 5) PASSED
> [1] TRUE
>> dkwtest("hyper", m=600, n=1000, k=500)
> hyper(m = 600, n = 1000, k = 500) PASSED
> [1] TRUE
>>
>> cat('Time elapsed: ', proc.time() - .proctime00,'\n')
> Time elapsed:  2.404 0.004 2.408 0 0
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From John.Maindonald at anu.edu.au  Wed Jul  5 11:35:01 2006
From: John.Maindonald at anu.edu.au (John.Maindonald at anu.edu.au)
Date: Wed,  5 Jul 2006 11:35:01 +0200 (CEST)
Subject: [Rd] read.table() errors with tab as separator (PR#9061)
Message-ID: <20060705093501.8275353DBA@slim.kubism.ku.dk>

(1) read.table(), with sep="\t", identifies 13 our of 1400 records,
in a file with 1400 records of 3 fields each, as having only 2 fields.
This happens under version 2.3.1 for Windows as well as with
R 2.3.1 for Mac OS X, and with R-devel under Mac OS X.
[R version 2.4.0 Under development (unstable) (2006-07-03 r38478)]

(2) Using read.table() with sep="\t", the first 1569 records only
of a 1821 record file are input.  The file has exactly two fields
in each record, and the minimum length of the second field is
1 character.  If however I extract lines 1561 to 1650 from the
file (the file "short.txt" below), all 90 lines are input.

 > webtwo <- "http://www.maths.anu.edu.au/~johnm/testfiles/twotabs.txt"
 > xy <- read.table(url(webtwo), sep="\t")
Warning message:
number of items read is not a multiple of the number of columns
 > z <- count.fields(url(webtwo), sep="\t")
 > table(z)
z
    2    3
   13 1387
 > table(sapply(strsplit(readLines(url(webtwo)), split="\t"), length))

    3
1400
 > readLines(url(webtwo))[z==2][9:13]  # last 5 as a sample (shorter  
lines)
[1] "865\tlinear model (lm)! Cook's distance\t152"
[2] "1019\tlinear model (lm)! Cook's distance\t177"
[3] "1048\tlinear model (lm)! Cook's distance\t183"
[4] "1082\tlinear model (lm)! Cook's distance\t187"
[5] "1220\tlinear model (lm)! Cook's distance\t214"
 > weblong <- "http://www.maths.anu.edu.au/~johnm/testfiles/long.txt"
 > webshort <- "http://www.maths.anu.edu.au/~johnm/testfiles/short.txt"
 > xyLong <- read.table(url(weblong), sep="\t")
 > dim(xyLong)    # Should be 1821 x 2
[1] 1569    2
 > xyShort <- read.table(url(webshort), sep="\t")
 > dim(xyShort)   # Should be, and will be, 90 x 2
[1] 90  2
 > long <- readLines(url(weblong))
 > short <- readLines(url(webshort))
 > length(long)
[1] 1821
 > length(short)
[1] 90
 > all(long[1561:1650]==short)  # short is lines 1561:1650 of long
[1] TRUE
 > ## Moreover strsplit() can pick up the \t's correctly
 > lsplit <- strsplit(long, "\t")
 > table(sapply(lsplit, length))

    2
1821
 > # Try also table(sapply(lsplit, function(x)x[2]))

--please do not edit the information below--

Version:
platform = powerpc-apple-darwin8.6.0
arch = powerpc
os = darwin8.6.0
system = powerpc, darwin8.6.0
status =
major = 2
minor = 3.1
year = 2006
month = 06
day = 01
svn rev = 38247
language = R
version.string = Version 2.3.1 (2006-06-01)

Locale:
C

Search Path:
.GlobalEnv, package:lattice, package:methods, package:stats,  
package:graphics, package:grDevices, package:utils, package:datasets,  
Autoloads, package:base


From p.dalgaard at biostat.ku.dk  Wed Jul  5 11:50:27 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 05 Jul 2006 11:50:27 +0200
Subject: [Rd] read.table() errors with tab as separator (PR#9061)
In-Reply-To: <20060705093501.8275353DBA@slim.kubism.ku.dk>
References: <20060705093501.8275353DBA@slim.kubism.ku.dk>
Message-ID: <x2veqcmlcs.fsf@viggo.kubism.ku.dk>

John.Maindonald at anu.edu.au writes:

> (1) read.table(), with sep="\t", identifies 13 our of 1400 records,
> in a file with 1400 records of 3 fields each, as having only 2 fields.
> This happens under version 2.3.1 for Windows as well as with
> R 2.3.1 for Mac OS X, and with R-devel under Mac OS X.
> [R version 2.4.0 Under development (unstable) (2006-07-03 r38478)]
> 
> (2) Using read.table() with sep="\t", the first 1569 records only
> of a 1821 record file are input.  The file has exactly two fields
> in each record, and the minimum length of the second field is
> 1 character.  If however I extract lines 1561 to 1650 from the
> file (the file "short.txt" below), all 90 lines are input.

Notice that the single quote is a quote character in read.table (as
opposed to read.delim, which uses only the double quote, to cater for
TAB-separated files from Excel & friends).

> [1] "865\tlinear model (lm)! Cook's distance\t152"
                                   ^
                                 !!!!

(This reminds me that we probably should shift the default for
comment.char too since it leads to similar issues, but it seems not to
be the problem in this case.)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From gavin.simpson at ucl.ac.uk  Wed Jul  5 12:00:56 2006
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 05 Jul 2006 11:00:56 +0100
Subject: [Rd] problem getting R 2.3.1 svn r38481 to pass make check-all
In-Reply-To: <Pine.LNX.4.64.0607050937450.11987@gannet.stats.ox.ac.uk>
References: <1152026786.31350.9.camel@graptoleberis.geog.ucl.ac.uk>
	<Pine.LNX.4.64.0607050937450.11987@gannet.stats.ox.ac.uk>
Message-ID: <1152093656.26672.7.camel@gsimpson.geog.ucl.ac.uk>

On Wed, 2006-07-05 at 09:49 +0100, Prof Brian Ripley wrote:
> By `R 2.3.1 svn r38481' do you mean R-patched?  (R 2.3.1 is released.)

Yes, sorry, I meant R-patched svn r38481. My only excuse is jetlag...

> 
> Looks like r38469 ported the revised test results but not the test: I have 
> now done so.

Thanks for confirming and fixing this.

G

-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/cv/
 London, UK. WC1E 6BT.         [w] http://www.ucl.ac.uk/~ucfagls/
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ripley at stats.ox.ac.uk  Wed Jul  5 12:32:52 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Jul 2006 11:32:52 +0100 (BST)
Subject: [Rd] read.table() errors with tab as separator (PR#9061)
In-Reply-To: <x2veqcmlcs.fsf@viggo.kubism.ku.dk>
References: <20060705093501.8275353DBA@slim.kubism.ku.dk>
	<x2veqcmlcs.fsf@viggo.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0607051128280.8003@gannet.stats.ox.ac.uk>

On Wed, 5 Jul 2006, Peter Dalgaard wrote:

> John.Maindonald at anu.edu.au writes:
>
>> (1) read.table(), with sep="\t", identifies 13 our of 1400 records,
>> in a file with 1400 records of 3 fields each, as having only 2 fields.
>> This happens under version 2.3.1 for Windows as well as with
>> R 2.3.1 for Mac OS X, and with R-devel under Mac OS X.
>> [R version 2.4.0 Under development (unstable) (2006-07-03 r38478)]
>>
>> (2) Using read.table() with sep="\t", the first 1569 records only
>> of a 1821 record file are input.  The file has exactly two fields
>> in each record, and the minimum length of the second field is
>> 1 character.  If however I extract lines 1561 to 1650 from the
>> file (the file "short.txt" below), all 90 lines are input.
>
> Notice that the single quote is a quote character in read.table (as
> opposed to read.delim, which uses only the double quote, to cater for
> TAB-separated files from Excel & friends).
>
>> [1] "865\tlinear model (lm)! Cook's distance\t152"
>                                   ^
>                                 !!!!
>
> (This reminds me that we probably should shift the default for
> comment.char too since it leads to similar issues, but it seems not to
> be the problem in this case.)

This seems to imply that we should change the default for 'quote': to do 
so could break a lot of scripts.  (Given how long the default has been
comment.char="#", I doubt if we should change that either.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Wed Jul  5 12:38:39 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Jul 2006 06:38:39 -0400
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <44AB754B.6020405@statistik.uni-dortmund.de>
References: <44AA5FC8.9020106@stats.uwo.ca>	<17578.34324.125621.658439@stat.math.ethz.ch>	<44AA8FCE.2070102@statistik.uni-dortmund.de>	<44AAEA6B.6000604@stats.uwo.ca>	<Pine.LNX.4.64.0607050820360.1149@gannet.stats.ox.ac.uk>
	<44AB721A.4020407@sciviews.org>
	<44AB754B.6020405@statistik.uni-dortmund.de>
Message-ID: <44AB96AF.8000903@stats.uwo.ca>

On 7/5/2006 4:16 AM, Uwe Ligges wrote:
> Philippe Grosjean wrote:
>> Hello,
>>
>> Related to Windows installer changes (requests), would it be possible to 
>> specify whether RGui is installed to run in MDI or SDI mode at start? It 
>> is as simple as adding a 'Run RGui in SDI mode' option in InnoSetup that 
>> installs a <Rdir>/etc/Rconsole file containing 'MDI = no' when the 
>> option is checked.
>>
>> Explanation: MDI mode is an old-style and it is less in use now (most 
>> recent multidocuments programs offer either navigation with tabs, and/or 
>> SDI mode to manipulate multiple documents; even Microsoft that used the 
>> MDI style in all its applications is now moving to SDI with Word, Excel, 
>> ...). Regarding R, the MDI-style in RGui is problematic, or at least 
>> suboptimal, with many GUIs under Windows.
>>
>> Currently, new users that are told to switch to "SDI style in RGui" are 
>> very intimidated by the procedure: (1) what is SDI versus MDI?, (2) they 
>> have to open the 'RGui preference' dialog box, make the changes, save 
>> the file in a particular location, (3) ignore the intimidating warning 
>> that appears, (4) close RGui and restart it. All this is very, very 
>> unfriendly for a very first approach to R... and I see it on the face of 
>> my students!
>>
>> With the option in InnoSetup installer, everything would be much 
>> smoother to get RGui in SDI mode from start.
> 
> 
> Yes, that is exactly what Duncan already did!
> 
>  From CHANGES:
> 
> "The installer can set defaults for MDI/SDI display, help style, and
> default action on q().  Custom builds of R can change these defaults."

Yes, indeed.  But note that one part of that entry is now wrong: 
currently the installer doesn't do anything about default action on q(), 
as I reverted that change (and have just fixed the CHANGES message).

Hopefully we'll work out something to do with saving/restoring 
workspaces before too long.

Duncan Murdoch

> 
> Uwe Ligges
> 
> 
>> Thanks for considering this proposition.
>> Best,
>>
>> Philippe Grosjean
>>
>> ..............................................<?}))><........
>>   ) ) ) ) )
>> ( ( ( ( (    Prof. Philippe Grosjean
>>   ) ) ) ) )
>> ( ( ( ( (    Numerical Ecology of Aquatic Systems
>>   ) ) ) ) )   Mons-Hainaut University, Belgium
>> ( ( ( ( (
>> ..............................................................
>>
>> Prof Brian Ripley wrote:
>>> On Tue, 4 Jul 2006, Duncan Murdoch wrote:
>>>
>>>
>>>> On 7/4/2006 11:57 AM, Uwe Ligges wrote:
>>>>
>>>>> Martin Maechler wrote:
>>>>>
>>>>>>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>>>>>>    on Tue, 04 Jul 2006 08:32:08 -0400 writes:
>>>>>>    Duncan> I've just committed a couple of changes to R-devel related to requests
>>>>>>    Duncan> at userR about the Windows installer.  The first of these affects all
>>>>>>    Duncan> platforms, but I've only tested it on Windows:
>>>>>>
>>>>>>    Duncan> I added an option "quit.with.no.save".  If TRUE,
>>>>>>    Duncan> then the default q("ask") prompt will not offer to
>>>>>>    Duncan> save the workspace.  This is in response to the
>>>>>>    Duncan> observation that new users who are instructed not to
>>>>>>    Duncan> save their workspace, get confused when they
>>>>>>    Duncan> accidentally answer Yes to the prompt to save it.
>>>>>>
>>>>>> Ok...  but I probably misunderstand a bit:
>>>>>>
>>>>>> The default has not been   q(save = "ask") but  q(save = "default"),
>>>>>> and that default has depended on startup.
>>>>>>
>>>>>> Even now, "R --no-save"  already did have the desired effect,
>>>>>> on Unix at least.  For my ESS setup, I have made this an automatic
>>>>>> default many months ago.
>>>>>>
>>>>>> Wouldn't it be easier and sufficient to make "--no-save" a
>>>>>> working option on all platforms ?
>>>>>> Or is the point really about changing the quitting dialog?
>>>>>> For me quitting *without* a dialog is the most important thing
>>>>>> which I use (often several times a day).
>>>>>>
>>>>>>    Duncan> I'm not sure about the wording of the user prompt
>>>>>>    Duncan> question, which is now "Quit and discard
>>>>>>    Duncan> workspace?".  The problem with this wording is that
>>>>>>    Duncan> someone who automatically hits "y" will lose their
>>>>>>    Duncan> work.  I've tried on Windows to make the dialog box
>>>>>>    Duncan> look different enough that they should be warned.
>>>>>>
>>>>>> good!
>>>>>>
>>>>>>    Duncan> I haven't made any change to the Mac GUI to support this.  On
>>>>>>    Duncan> Unix-alikes, the text prompt should respect this option.
>>>>>>
>>>>>>    Duncan> The other change is to the Windows installer, to
>>>>>>    Duncan> allow the user to choose whether to set
>>>>>>    Duncan> quit.with.no.save, MDI/SDI display, and help style
>>>>>>    Duncan> at install time.  The only (intentional) change to
>>>>>>    Duncan> the current behaviour is to default to CHM help
>>>>>>    Duncan> instead of plain text.
>>>>>>
>>>>>> People have asked me in private about this, and I didn't know
>>>>>> the answer:
>>>>>> Is it true that this means that people can no longer commit the
>>>>>> "cheap package install trick" on Windows for  R-code-only
>>>>>> packages?
>>>>>> Namely
>>>>>>  1) install a source package on a Linux/Unix/MacOSX machine
>>>>>>     (where it is often simple to have all the necessary tools available)
>>>>>>  2) zip the resulting installed package
>>>>>>  3) unzip it on the target Windows machine into the corresponding
>>>>>>     library (directory).
>>>>>>
>>>>>> Of course, this trick will not provide any *.chm help files.
>>>>>> Will the cheap-installed package still work, using the *.txt (or
>>>>>> *.html) help files?
>>>>>
>>>>> Well, the user has to ask
>>>>>    help(topic, chmhelp = FALSE)
>>>>> in this case, or (s)he get the message:
>>>>>
>>>>>              No CHM help for 'foo' in package 'pkg' is available:
>>>>>      the CHM file for the package is missing
>>>>>
>>>>> Perhaps it is possible to arrange some fallback to plain text help if
>>>>> chmhelp is not available: in print.help_files_with_topic call print() on
>>>>> the "help_files_with_topic" object again, but change attribute "type" to
>>>>> "help" before that call ...
>>>> Yes, that seems to work.  I'll add that.
>>> Before help() was reorganized to use print() methods it used to fall back 
>>> to text help if other versions were not available (at least on Windows), 
>>> so it does seem sensible to reinstate that.
>>>
>>> Brian
>>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Wed Jul  5 12:40:41 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Jul 2006 06:40:41 -0400
Subject: [Rd] options("quit.with.no.save"), and Windows installer changes
In-Reply-To: <Pine.LNX.4.64.0607050820360.1149@gannet.stats.ox.ac.uk>
References: <44AA5FC8.9020106@stats.uwo.ca>
	<17578.34324.125621.658439@stat.math.ethz.ch>
	<44AA8FCE.2070102@statistik.uni-dortmund.de>
	<44AAEA6B.6000604@stats.uwo.ca>
	<Pine.LNX.4.64.0607050820360.1149@gannet.stats.ox.ac.uk>
Message-ID: <44AB9729.1060806@stats.uwo.ca>

On 7/5/2006 3:22 AM, Prof Brian Ripley wrote:
> On Tue, 4 Jul 2006, Duncan Murdoch wrote:
> 
>> On 7/4/2006 11:57 AM, Uwe Ligges wrote:
>>> Martin Maechler wrote:
>>>>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>>>>     on Tue, 04 Jul 2006 08:32:08 -0400 writes:
>>>>     Duncan> I've just committed a couple of changes to R-devel related to requests
>>>>     Duncan> at userR about the Windows installer.  The first of these affects all
>>>>     Duncan> platforms, but I've only tested it on Windows:
>>>>
>>>>     Duncan> I added an option "quit.with.no.save".  If TRUE,
>>>>     Duncan> then the default q("ask") prompt will not offer to
>>>>     Duncan> save the workspace.  This is in response to the
>>>>     Duncan> observation that new users who are instructed not to
>>>>     Duncan> save their workspace, get confused when they
>>>>     Duncan> accidentally answer Yes to the prompt to save it.
>>>>
>>>> Ok...  but I probably misunderstand a bit:
>>>>
>>>> The default has not been   q(save = "ask") but  q(save = "default"),
>>>> and that default has depended on startup.
>>>>
>>>> Even now, "R --no-save"  already did have the desired effect,
>>>> on Unix at least.  For my ESS setup, I have made this an automatic
>>>> default many months ago.
>>>>
>>>> Wouldn't it be easier and sufficient to make "--no-save" a
>>>> working option on all platforms ?
>>>> Or is the point really about changing the quitting dialog?
>>>> For me quitting *without* a dialog is the most important thing
>>>> which I use (often several times a day).
>>>>
>>>>     Duncan> I'm not sure about the wording of the user prompt
>>>>     Duncan> question, which is now "Quit and discard
>>>>     Duncan> workspace?".  The problem with this wording is that
>>>>     Duncan> someone who automatically hits "y" will lose their
>>>>     Duncan> work.  I've tried on Windows to make the dialog box
>>>>     Duncan> look different enough that they should be warned.
>>>>
>>>> good!
>>>>
>>>>     Duncan> I haven't made any change to the Mac GUI to support this.  On
>>>>     Duncan> Unix-alikes, the text prompt should respect this option.
>>>>
>>>>     Duncan> The other change is to the Windows installer, to
>>>>     Duncan> allow the user to choose whether to set
>>>>     Duncan> quit.with.no.save, MDI/SDI display, and help style
>>>>     Duncan> at install time.  The only (intentional) change to
>>>>     Duncan> the current behaviour is to default to CHM help
>>>>     Duncan> instead of plain text.
>>>>
>>>> People have asked me in private about this, and I didn't know
>>>> the answer:
>>>> Is it true that this means that people can no longer commit the
>>>> "cheap package install trick" on Windows for  R-code-only
>>>> packages?
>>>> Namely
>>>>   1) install a source package on a Linux/Unix/MacOSX machine
>>>>      (where it is often simple to have all the necessary tools available)
>>>>   2) zip the resulting installed package
>>>>   3) unzip it on the target Windows machine into the corresponding
>>>>      library (directory).
>>>>
>>>> Of course, this trick will not provide any *.chm help files.
>>>> Will the cheap-installed package still work, using the *.txt (or
>>>> *.html) help files?
>>>
>>>
>>> Well, the user has to ask
>>>     help(topic, chmhelp = FALSE)
>>> in this case, or (s)he get the message:
>>>
>>>               No CHM help for 'foo' in package 'pkg' is available:
>>>       the CHM file for the package is missing
>>>
>>> Perhaps it is possible to arrange some fallback to plain text help if
>>> chmhelp is not available: in print.help_files_with_topic call print() on
>>> the "help_files_with_topic" object again, but change attribute "type" to
>>> "help" before that call ...
>> Yes, that seems to work.  I'll add that.
> 
> Before help() was reorganized to use print() methods it used to fall back 
> to text help if other versions were not available (at least on Windows), 
> so it does seem sensible to reinstate that.

It's not completely reinstated:  I only put in the fallback in the 
particular case where the .chm file was not found.  Other failure modes 
still die with an error.

Duncan Murdoch


From murdoch at stats.uwo.ca  Wed Jul  5 12:45:27 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Jul 2006 06:45:27 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
Message-ID: <44AB9847.9030803@stats.uwo.ca>

On 7/4/2006 11:12 PM, Gabor Grothendieck wrote:
> In the code below, e is an environment which we copy to f and then
> add attributes to e.  Now f winds up with the same attributes.
> 
> In other words it seems that the attributes are a property of the
> environment itself and not of the variable.  Thus it appears we
> cannot have two environment variables that correspond to the
> original environment but with different attributes.
> 
> I can understand if we changed a component of e then
> f would reflect that too but I am not sure that this is also
> desirable for attributes as they are not "in" the environment.
> 
> Is that desirable?  Is it a bug?  No other class works that way
> AFAIK.   Comments?

I'm not sure about whether this is desirable or a bug, but environments 
are special, in that they are among the very few objects treated as 
references.  In your example, adding a variable to e will also make it 
visible in f.

Duncan Murdoch

> 
>> e <- new.env()
>> f <- e
>> attr(e, "X") <- "Y"   # X is an attribute of e
>> f  # f gets the same attribute !!!
> <environment: 0x01a577f0>
> attr(,"X")
> [1] "Y"
>> R.version.string # Windows XP
> [1] "R version 2.4.0 Under development (unstable) (2006-07-04 r38480)"
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From p.dalgaard at biostat.ku.dk  Wed Jul  5 13:21:29 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 05 Jul 2006 13:21:29 +0200
Subject: [Rd] read.table() errors with tab as separator (PR#9061)
In-Reply-To: <Pine.LNX.4.64.0607051128280.8003@gannet.stats.ox.ac.uk>
References: <20060705093501.8275353DBA@slim.kubism.ku.dk>
	<x2veqcmlcs.fsf@viggo.kubism.ku.dk>
	<Pine.LNX.4.64.0607051128280.8003@gannet.stats.ox.ac.uk>
Message-ID: <x2mzbomh52.fsf@viggo.kubism.ku.dk>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> On Wed, 5 Jul 2006, Peter Dalgaard wrote:
> 
> > John.Maindonald at anu.edu.au writes:
> >
> >> (1) read.table(), with sep="\t", identifies 13 our of 1400 records,
> >> in a file with 1400 records of 3 fields each, as having only 2 fields.
> >> This happens under version 2.3.1 for Windows as well as with
> >> R 2.3.1 for Mac OS X, and with R-devel under Mac OS X.
> >> [R version 2.4.0 Under development (unstable) (2006-07-03 r38478)]
> >>
> >> (2) Using read.table() with sep="\t", the first 1569 records only
> >> of a 1821 record file are input.  The file has exactly two fields
> >> in each record, and the minimum length of the second field is
> >> 1 character.  If however I extract lines 1561 to 1650 from the
> >> file (the file "short.txt" below), all 90 lines are input.
> >
> > Notice that the single quote is a quote character in read.table (as
> > opposed to read.delim, which uses only the double quote, to cater for
> > TAB-separated files from Excel & friends).
> >
> >> [1] "865\tlinear model (lm)! Cook's distance\t152"
> >                                   ^
> >                                 !!!!
> >
> > (This reminds me that we probably should shift the default for
> > comment.char too since it leads to similar issues, but it seems not to
> > be the problem in this case.)
> 
> This seems to imply that we should change the default for 'quote': to
> do so could break a lot of scripts.  (Given how long the default has
> been
> comment.char="#", I doubt if we should change that either.)

Sorry, unclear. We already change quote= for read.delim and read.csv,
and I was suggesting also to modify the default for comment.char for
those functions, but definitely not for read.table. 

Arguably, those functions are there to handle file formats generated
by other programs, and it is unlikely that such programs will generate
comment lines starting with #, whereas we have learned that Excel will
occasionally generate fields like #NULL#, which mess up the parsing.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Wed Jul  5 13:26:41 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Jul 2006 12:26:41 +0100 (BST)
Subject: [Rd] read.table() errors with tab as separator (PR#9061)
In-Reply-To: <x2mzbomh52.fsf@viggo.kubism.ku.dk>
References: <20060705093501.8275353DBA@slim.kubism.ku.dk>
	<x2veqcmlcs.fsf@viggo.kubism.ku.dk>
	<Pine.LNX.4.64.0607051128280.8003@gannet.stats.ox.ac.uk>
	<x2mzbomh52.fsf@viggo.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0607051225320.14072@gannet.stats.ox.ac.uk>

On Wed, 5 Jul 2006, Peter Dalgaard wrote:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> On Wed, 5 Jul 2006, Peter Dalgaard wrote:
>>
>>> John.Maindonald at anu.edu.au writes:
>>>
>>>> (1) read.table(), with sep="\t", identifies 13 our of 1400 records,
>>>> in a file with 1400 records of 3 fields each, as having only 2 fields.
>>>> This happens under version 2.3.1 for Windows as well as with
>>>> R 2.3.1 for Mac OS X, and with R-devel under Mac OS X.
>>>> [R version 2.4.0 Under development (unstable) (2006-07-03 r38478)]
>>>>
>>>> (2) Using read.table() with sep="\t", the first 1569 records only
>>>> of a 1821 record file are input.  The file has exactly two fields
>>>> in each record, and the minimum length of the second field is
>>>> 1 character.  If however I extract lines 1561 to 1650 from the
>>>> file (the file "short.txt" below), all 90 lines are input.
>>>
>>> Notice that the single quote is a quote character in read.table (as
>>> opposed to read.delim, which uses only the double quote, to cater for
>>> TAB-separated files from Excel & friends).
>>>
>>>> [1] "865\tlinear model (lm)! Cook's distance\t152"
>>>                                   ^
>>>                                 !!!!
>>>
>>> (This reminds me that we probably should shift the default for
>>> comment.char too since it leads to similar issues, but it seems not to
>>> be the problem in this case.)
>>
>> This seems to imply that we should change the default for 'quote': to
>> do so could break a lot of scripts.  (Given how long the default has
>> been
>> comment.char="#", I doubt if we should change that either.)
>
> Sorry, unclear. We already change quote= for read.delim and read.csv,
> and I was suggesting also to modify the default for comment.char for
> those functions, but definitely not for read.table.
>
> Arguably, those functions are there to handle file formats generated
> by other programs, and it is unlikely that such programs will generate
> comment lines starting with #, whereas we have learned that Excel will
> occasionally generate fields like #NULL#, which mess up the parsing.

Ah, that does seem a sensible defensive move.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jul  5 14:22:12 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed,  5 Jul 2006 14:22:12 +0200 (CEST)
Subject: [Rd] write.table does not quote col.names properly (PR#9044)
Message-ID: <20060705122212.74B1953D00@slim.kubism.ku.dk>

As this is documented to quote nothing if quote=FALSE, the patch is 
incorrect.  We need to handle quoting of colunm names separately.

Fixed for 2.3.1 patched.


On Thu, 29 Jun 2006, mwtoews at sfu.ca wrote:

> Full_Name: Michael Toews
> Version: 2.3.1
> OS: Mac OS 10.4.6 and WinXP/SP2
> Submission from: (NULL) (24.80.163.133)
>
>
> This bug also affects related functions (write.csv, etc.), and can be
> demonstrated using either a matrix or data frame:
>
> m <- matrix(1:9,nrow=3,
>       dimnames=list(c("A","B","C"),
>                     c("I","II","III")))
>
> write.table(m)
> write.table(m,col.names=FALSE)
> write.table(m,row.names=FALSE)
>
> Note that the last 'write.table' call has unquoted column headers. A suggested
> fix for this problem is:
>
> Index: write.table.R
> ===================================================================
> --- write.table.R       (revision 38447)
> +++ write.table.R       (working copy)
> @@ -86,9 +86,8 @@
>     if(!is.null(col.names)) {
>        if(append)
>            warning("appending column names to file")
> -       if(length(quote))
> -           col.names <- paste("\"", gsub('"', qstring, col.names),
> -                               "\"", sep = "")
> +       col.names <- paste("\"", gsub('"', qstring, col.names),
> +                           "\"", sep = "")
>         writeLines(paste(col.names, collapse = sep), file, sep = eol)
>     }
>
>
> However, it is unknown why the "if(length(quote))" is used in the original code
> (please check before a commit). The length of quote will be 0 here, since the
> matrix has all numbers.
> This bug does not occur with a data frame with mixed number and factor/character
> columns.
> +mt
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Wed Jul  5 14:48:22 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 05 Jul 2006 14:48:22 +0200
Subject: [Rd] read.table() errors with tab as separator (PR#9061)
In-Reply-To: <Pine.LNX.4.64.0607051225320.14072@gannet.stats.ox.ac.uk>
References: <20060705093501.8275353DBA@slim.kubism.ku.dk>
	<x2veqcmlcs.fsf@viggo.kubism.ku.dk>
	<Pine.LNX.4.64.0607051128280.8003@gannet.stats.ox.ac.uk>
	<x2mzbomh52.fsf@viggo.kubism.ku.dk>
	<Pine.LNX.4.64.0607051225320.14072@gannet.stats.ox.ac.uk>
Message-ID: <x2ejx0md49.fsf@viggo.kubism.ku.dk>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> > Sorry, unclear. We already change quote= for read.delim and read.csv,
> > and I was suggesting also to modify the default for comment.char for
> > those functions, but definitely not for read.table.
> >
> > Arguably, those functions are there to handle file formats generated
> > by other programs, and it is unlikely that such programs will generate
> > comment lines starting with #, whereas we have learned that Excel will
> > occasionally generate fields like #NULL#, which mess up the parsing.
> 
> Ah, that does seem a sensible defensive move.

Committed for r-devel (only). Make check seems happy, but we may need
to watch out for the package checking.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From tlumley at u.washington.edu  Wed Jul  5 18:00:07 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 5 Jul 2006 09:00:07 -0700 (PDT)
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>

On Tue, 4 Jul 2006, Gabor Grothendieck wrote:

> In the code below, e is an environment which we copy to f and then
> add attributes to e.  Now f winds up with the same attributes.
>
> In other words it seems that the attributes are a property of the
> environment itself and not of the variable.  Thus it appears we
> cannot have two environment variables that correspond to the
> original environment but with different attributes.

No, we can't. The two variables are references to the same environment, so 
they are the same.

If you want the attributes to be copies rather than references then create 
a list with the environment as an element and put the attributes on the 
list.

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ggrothendieck at gmail.com  Wed Jul  5 18:10:02 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 12:10:02 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
Message-ID: <971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>

On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> On Tue, 4 Jul 2006, Gabor Grothendieck wrote:
>
> > In the code below, e is an environment which we copy to f and then
> > add attributes to e.  Now f winds up with the same attributes.
> >
> > In other words it seems that the attributes are a property of the
> > environment itself and not of the variable.  Thus it appears we
> > cannot have two environment variables that correspond to the
> > original environment but with different attributes.
>
> No, we can't. The two variables are references to the same environment, so
> they are the same.
>
> If you want the attributes to be copies rather than references then create
> a list with the environment as an element and put the attributes on the
> list.

I realize that that is how it works but what I was really wondering was
should it work that way?


From tlumley at u.washington.edu  Wed Jul  5 18:17:55 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 5 Jul 2006 09:17:55 -0700 (PDT)
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com> 
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>

On Wed, 5 Jul 2006, Gabor Grothendieck wrote:

> On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
>> On Tue, 4 Jul 2006, Gabor Grothendieck wrote:
>> 
>> > In the code below, e is an environment which we copy to f and then
>> > add attributes to e.  Now f winds up with the same attributes.
>> >
>> > In other words it seems that the attributes are a property of the
>> > environment itself and not of the variable.  Thus it appears we
>> > cannot have two environment variables that correspond to the
>> > original environment but with different attributes.
>> 
>> No, we can't. The two variables are references to the same environment, so
>> they are the same.
>> 
>> If you want the attributes to be copies rather than references then create
>> a list with the environment as an element and put the attributes on the
>> list.
>
> I realize that that is how it works but what I was really wondering was
> should it work that way?
>

I think it really should (and this question has come up before).  If you 
do
    e<-environment()
    f<-e

then there is only one object that f and e both point to. Now, since such 
things as S3 class and matrix dimension are implemented as attributes I 
think you really have to consider the attributes as part of the object 
[which is also how they are implemented, of course].  So if e and f are 
the same object they should have the same attributes.

Another reasonable position would be to disallow attributes on 
environments (as we do with NULL, another reference object), but that 
seems extreme.

 	-thomas


From ggrothendieck at gmail.com  Wed Jul  5 18:39:59 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 12:39:59 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
Message-ID: <971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>

On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> On Wed, 5 Jul 2006, Gabor Grothendieck wrote:
>
> > On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> >> On Tue, 4 Jul 2006, Gabor Grothendieck wrote:
> >>
> >> > In the code below, e is an environment which we copy to f and then
> >> > add attributes to e.  Now f winds up with the same attributes.
> >> >
> >> > In other words it seems that the attributes are a property of the
> >> > environment itself and not of the variable.  Thus it appears we
> >> > cannot have two environment variables that correspond to the
> >> > original environment but with different attributes.
> >>
> >> No, we can't. The two variables are references to the same environment, so
> >> they are the same.
> >>
> >> If you want the attributes to be copies rather than references then create
> >> a list with the environment as an element and put the attributes on the
> >> list.
> >
> > I realize that that is how it works but what I was really wondering was
> > should it work that way?
> >
>
> I think it really should (and this question has come up before).  If you
> do
>    e<-environment()
>    f<-e
>
> then there is only one object that f and e both point to. Now, since such
> things as S3 class and matrix dimension are implemented as attributes I
> think you really have to consider the attributes as part of the object
> [which is also how they are implemented, of course].  So if e and f are
> the same object they should have the same attributes.

I don't think this follows since in the other cases modifying the
object also creates a copy.

>
> Another reasonable position would be to disallow attributes on
> environments (as we do with NULL, another reference object), but that
> seems extreme.

I don't think that that would solve it because there is still the issue
of the class attribute which you can't disallow.

In fact consider this:

e <- new.env()
f <- e
class(f) <- c("myenv", "environment")
F <- function(x) UseMethod("F")
F.environment <- function(x) 1
F.myenv <- function(x) 2
F(e) # 2
F(f) # 2

The point is that subclassing does not work properly with environments
yet subclasses of the environment class should be possible since R
is supposed to be OO and I see no valid reason for exclusing environments
for this.  I guess in this discussion I am coming to the realization that
this issue really is a problem with the current way R works.


From murdoch at stats.uwo.ca  Wed Jul  5 18:54:40 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Jul 2006 12:54:40 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
Message-ID: <44ABEED0.7020708@stats.uwo.ca>

On 7/5/2006 12:39 PM, Gabor Grothendieck wrote:
> On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
>> On Wed, 5 Jul 2006, Gabor Grothendieck wrote:
>>
>> > On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
>> >> On Tue, 4 Jul 2006, Gabor Grothendieck wrote:
>> >>
>> >> > In the code below, e is an environment which we copy to f and then
>> >> > add attributes to e.  Now f winds up with the same attributes.
>> >> >
>> >> > In other words it seems that the attributes are a property of the
>> >> > environment itself and not of the variable.  Thus it appears we
>> >> > cannot have two environment variables that correspond to the
>> >> > original environment but with different attributes.
>> >>
>> >> No, we can't. The two variables are references to the same environment, so
>> >> they are the same.
>> >>
>> >> If you want the attributes to be copies rather than references then create
>> >> a list with the environment as an element and put the attributes on the
>> >> list.
>> >
>> > I realize that that is how it works but what I was really wondering was
>> > should it work that way?
>> >
>>
>> I think it really should (and this question has come up before).  If you
>> do
>>    e<-environment()
>>    f<-e
>>
>> then there is only one object that f and e both point to. Now, since such
>> things as S3 class and matrix dimension are implemented as attributes I
>> think you really have to consider the attributes as part of the object
>> [which is also how they are implemented, of course].  So if e and f are
>> the same object they should have the same attributes.
> 
> I don't think this follows since in the other cases modifying the
> object also creates a copy.
> 
>>
>> Another reasonable position would be to disallow attributes on
>> environments (as we do with NULL, another reference object), but that
>> seems extreme.
> 
> I don't think that that would solve it because there is still the issue
> of the class attribute which you can't disallow.
> 
> In fact consider this:
> 
> e <- new.env()
> f <- e
> class(f) <- c("myenv", "environment")
> F <- function(x) UseMethod("F")
> F.environment <- function(x) 1
> F.myenv <- function(x) 2
> F(e) # 2
> F(f) # 2
> 
> The point is that subclassing does not work properly with environments
> yet subclasses of the environment class should be possible since R
> is supposed to be OO and I see no valid reason for exclusing environments
> for this.  I guess in this discussion I am coming to the realization that
> this issue really is a problem with the current way R works.

I don't think subclassing is important here.  The issue is that both e 
and f are references to the same object.  As such, changing the class of 
f will change the class of e, so what you're seeing is what you should 
expect.

You could fairly easily create f as a new environment, and copy all of 
the contents of e and its attributes over to f, and then you'd get the 
  behaviour you're expecting.  But that doesn't give sensible semantics 
for environments in general:  for example,

assign("x", 1, envir = e)

had better make the assignment into e, not into a copy of e.  Similarly,

 > f <- function() {
+   a <- 0
+   local1 <- function() a <<- 1
+   local2 <- function() a
+   list(f1=local1, f2=local2)
+ }
 >
 > fns <- f()
 > fns$f1()
 > fns$f2()
[1] 1

would not work properly if each of local1 and local2 just had copies of 
the evaluation environment of f.  They need references to the same 
environment, so the assignment in local1 will be seen in the environment 
inherited by local2.

Duncan Murdoch


From tlumley at u.washington.edu  Wed Jul  5 19:05:13 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 5 Jul 2006 10:05:13 -0700 (PDT)
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com> 
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu> 
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com> 
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>

On Wed, 5 Jul 2006, Gabor Grothendieck wrote:

> On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
>> On Wed, 5 Jul 2006, Gabor Grothendieck wrote:
>> 
>> > On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
>> >> On Tue, 4 Jul 2006, Gabor Grothendieck wrote:
>> >>
>> >> > In the code below, e is an environment which we copy to f and then
>> >> > add attributes to e.  Now f winds up with the same attributes.
>> >> >
>> >> > In other words it seems that the attributes are a property of the
>> >> > environment itself and not of the variable.  Thus it appears we
>> >> > cannot have two environment variables that correspond to the
>> >> > original environment but with different attributes.
>> >>
>> >> No, we can't. The two variables are references to the same environment, 
>> so
>> >> they are the same.
>> >>
>> >> If you want the attributes to be copies rather than references then 
>> create
>> >> a list with the environment as an element and put the attributes on the
>> >> list.
>> >
>> > I realize that that is how it works but what I was really wondering was
>> > should it work that way?
>> >
>> 
>> I think it really should (and this question has come up before).  If you
>> do
>>    e<-environment()
>>    f<-e
>> 
>> then there is only one object that f and e both point to. Now, since such
>> things as S3 class and matrix dimension are implemented as attributes I
>> think you really have to consider the attributes as part of the object
>> [which is also how they are implemented, of course].  So if e and f are
>> the same object they should have the same attributes.
>
> I don't think this follows since in the other cases modifying the
> object also creates a copy.

In cases other than environments, NULL, external pointers and weak 
references a new object is (from the language definition point of view) 
created on assignment. The fact that sometimes the actual memory 
allocation is deferred is an implementation issue.

That is
   e <- 2
   f <- e

creates two different vectors of length 1, so of course they can have 
different attributes.

For environments (and for NULL, external pointers, and weak references), 
assignment does not create a new object. It creates another reference to 
the same object.  Since it is the same object, it is the same: attributes, 
values, class, etc.


>> 
>> Another reasonable position would be to disallow attributes on
>> environments (as we do with NULL, another reference object), but that
>> seems extreme.
>
> I don't think that that would solve it because there is still the issue
> of the class attribute which you can't disallow.

Of course you can. It might be inconvenient, but it's not difficult.


> In fact consider this:
>
> e <- new.env()
> f <- e
> class(f) <- c("myenv", "environment")
> F <- function(x) UseMethod("F")
> F.environment <- function(x) 1
> F.myenv <- function(x) 2
> F(e) # 2
> F(f) # 2
>
> The point is that subclassing does not work properly with environments

No, subclassing *does* work. f and e are the same object, so they have the 
same class, c("myenv", "environment"). The thing that doesn't "work" the 
way you expect is assignment:
    f <- e
doesn't create a new object, as it would for any other sort of object.

> yet subclasses of the environment class should be possible since R
> is supposed to be OO and I see no valid reason for exclusing environments
> for this.  I guess in this discussion I am coming to the realization that
> this issue really is a problem with the current way R works.

It really is the way R is designed to work. Whether it is a problem or not 
is a separate issue. Environments really are references, not values, and 
they really work differently from the way most other objects work.

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ggrothendieck at gmail.com  Wed Jul  5 19:16:11 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 13:16:11 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
Message-ID: <971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>

On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> On Wed, 5 Jul 2006, Gabor Grothendieck wrote:
>
> > On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> >> On Wed, 5 Jul 2006, Gabor Grothendieck wrote:
> >>
> >> > On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> >> >> On Tue, 4 Jul 2006, Gabor Grothendieck wrote:
> >> >>
> >> >> > In the code below, e is an environment which we copy to f and then
> >> >> > add attributes to e.  Now f winds up with the same attributes.
> >> >> >
> >> >> > In other words it seems that the attributes are a property of the
> >> >> > environment itself and not of the variable.  Thus it appears we
> >> >> > cannot have two environment variables that correspond to the
> >> >> > original environment but with different attributes.
> >> >>
> >> >> No, we can't. The two variables are references to the same environment,
> >> so
> >> >> they are the same.
> >> >>
> >> >> If you want the attributes to be copies rather than references then
> >> create
> >> >> a list with the environment as an element and put the attributes on the
> >> >> list.
> >> >
> >> > I realize that that is how it works but what I was really wondering was
> >> > should it work that way?
> >> >
> >>
> >> I think it really should (and this question has come up before).  If you
> >> do
> >>    e<-environment()
> >>    f<-e
> >>
> >> then there is only one object that f and e both point to. Now, since such
> >> things as S3 class and matrix dimension are implemented as attributes I
> >> think you really have to consider the attributes as part of the object
> >> [which is also how they are implemented, of course].  So if e and f are
> >> the same object they should have the same attributes.
> >
> > I don't think this follows since in the other cases modifying the
> > object also creates a copy.
>
> In cases other than environments, NULL, external pointers and weak
> references a new object is (from the language definition point of view)
> created on assignment. The fact that sometimes the actual memory
> allocation is deferred is an implementation issue.
>
> That is
>   e <- 2
>   f <- e
>
> creates two different vectors of length 1, so of course they can have
> different attributes.
>
> For environments (and for NULL, external pointers, and weak references),
> assignment does not create a new object. It creates another reference to
> the same object.  Since it is the same object, it is the same: attributes,
> values, class, etc.
>
>
> >>
> >> Another reasonable position would be to disallow attributes on
> >> environments (as we do with NULL, another reference object), but that
> >> seems extreme.
> >
> > I don't think that that would solve it because there is still the issue
> > of the class attribute which you can't disallow.
>
> Of course you can. It might be inconvenient, but it's not difficult.

What I meant is that if one wants R to be consistently oo
then you can't disallow them.

Objects are supposed to have classes and subclasses should be readily
definable.

I see no good reason for excluding environments from this.

>
>
> > In fact consider this:
> >
> > e <- new.env()
> > f <- e
> > class(f) <- c("myenv", "environment")
> > F <- function(x) UseMethod("F")
> > F.environment <- function(x) 1
> > F.myenv <- function(x) 2
> > F(e) # 2
> > F(f) # 2
> >
> > The point is that subclassing does not work properly with environments
>
> No, subclassing *does* work. f and e are the same object, so they have the
> same class, c("myenv", "environment"). The thing that doesn't "work" the
> way you expect is assignment:
>    f <- e
> doesn't create a new object, as it would for any other sort of object.

Just because it does not create a new environment does not mean
that attr(f, "X") <- "Y"
could not create a new variable f that also points to e.

>
> > yet subclasses of the environment class should be possible since R
> > is supposed to be OO and I see no valid reason for exclusing environments
> > for this.  I guess in this discussion I am coming to the realization that
> > this issue really is a problem with the current way R works.
>
> It really is the way R is designed to work. Whether it is a problem or not
> is a separate issue. Environments really are references, not values, and
> they really work differently from the way most other objects work.

OK.  Its not a bug but as we discuss this it seems to me that
its current operation is undesirable since
environments don't seem to fit into the scheme that other objects do
yet different design/implement would allow this to occur.


From hb at stat.berkeley.edu  Wed Jul  5 19:44:47 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 5 Jul 2006 19:44:47 +0200
Subject: [Rd] attributes of environments
In-Reply-To: <Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
Message-ID: <59d7961d0607051044x6c15463ckd6cfafd4995c2bbd@mail.gmail.com>

On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> On Wed, 5 Jul 2006, Gabor Grothendieck wrote:
>
> > On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> >> On Wed, 5 Jul 2006, Gabor Grothendieck wrote:
> >>
> >> > On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> >> >> On Tue, 4 Jul 2006, Gabor Grothendieck wrote:
> >> >>
> >> >> > In the code below, e is an environment which we copy to f and then
> >> >> > add attributes to e.  Now f winds up with the same attributes.
> >> >> >
> >> >> > In other words it seems that the attributes are a property of the
> >> >> > environment itself and not of the variable.  Thus it appears we
> >> >> > cannot have two environment variables that correspond to the
> >> >> > original environment but with different attributes.
> >> >>
> >> >> No, we can't. The two variables are references to the same environment,
> >> so
> >> >> they are the same.
> >> >>
> >> >> If you want the attributes to be copies rather than references then
> >> create
> >> >> a list with the environment as an element and put the attributes on the
> >> >> list.
> >> >
> >> > I realize that that is how it works but what I was really wondering was
> >> > should it work that way?
> >> >
> >>
> >> I think it really should (and this question has come up before).  If you
> >> do
> >>    e<-environment()
> >>    f<-e
> >>
> >> then there is only one object that f and e both point to. Now, since such
> >> things as S3 class and matrix dimension are implemented as attributes I
> >> think you really have to consider the attributes as part of the object
> >> [which is also how they are implemented, of course].  So if e and f are
> >> the same object they should have the same attributes.
> >
> > I don't think this follows since in the other cases modifying the
> > object also creates a copy.
>
> In cases other than environments, NULL, external pointers and weak
> references a new object is (from the language definition point of view)
> created on assignment. The fact that sometimes the actual memory
> allocation is deferred is an implementation issue.
>
> That is
>    e <- 2
>    f <- e
>
> creates two different vectors of length 1, so of course they can have
> different attributes.
>
> For environments (and for NULL, external pointers, and weak references),
> assignment does not create a new object. It creates another reference to
> the same object.  Since it is the same object, it is the same: attributes,
> values, class, etc.
>
>
> >>
> >> Another reasonable position would be to disallow attributes on
> >> environments (as we do with NULL, another reference object), but that
> >> seems extreme.
> >
> > I don't think that that would solve it because there is still the issue
> > of the class attribute which you can't disallow.
>
> Of course you can. It might be inconvenient, but it's not difficult.
>
>
> > In fact consider this:
> >
> > e <- new.env()
> > f <- e
> > class(f) <- c("myenv", "environment")
> > F <- function(x) UseMethod("F")
> > F.environment <- function(x) 1
> > F.myenv <- function(x) 2
> > F(e) # 2
> > F(f) # 2
> >
> > The point is that subclassing does not work properly with environments
>
> No, subclassing *does* work. f and e are the same object, so they have the
> same class, c("myenv", "environment"). The thing that doesn't "work" the
> way you expect is assignment:
>     f <- e
> doesn't create a new object, as it would for any other sort of object.
>
> > yet subclasses of the environment class should be possible since R
> > is supposed to be OO and I see no valid reason for exclusing environments
> > for this.  I guess in this discussion I am coming to the realization that
> > this issue really is a problem with the current way R works.
>
> It really is the way R is designed to work. Whether it is a problem or not
> is a separate issue. Environments really are references, not values, and
> they really work differently from the way most other objects work.

Yes, it about how you *try* to look at it and not how it was designed.
 I was also bitten by this a few years ago.  There are two ways to
think of 'e' and 'f' above:

 1) 'e' and 'f' are R objects (reference variables) that refers to a
common object (the environment), and applying attr(e, name) <- value
applies to the R reference object 'e' and attr(f, name) <- value
applies to the 'f' object.

 2) 'e' and 'f' are references to a common object (the environment)
and attr(e, name) <- value applies to the common environment object
and so do attr(f, name) <- value too.

Case 1) is wrong and Case 2) is correct.

If you prefer Case 1) you can wrap up your environment in a list, e.g.

  e <- list(env=new.env())
  f <- list(env=e$env)

This makes 'e' and 'f' two different object that can have different
attributes, but both e$env and f$env refers to the same environment
object.  This is the basics of the Object class in the R.oo packages.

Cheers

Henrik


>         -thomas
>
> Thomas Lumley                   Assoc. Professor, Biostatistics
> tlumley at u.washington.edu        University of Washington, Seattle
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From simon.urbanek at r-project.org  Wed Jul  5 20:05:51 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 5 Jul 2006 14:05:51 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>
Message-ID: <5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>

Gabor,

On Jul 5, 2006, at 1:16 PM, Gabor Grothendieck wrote:

>> It really is the way R is designed to work. Whether it is a  
>> problem or not is a separate issue. Environments really are  
>> references, not values, and they really work differently from the  
>> way most other objects work.
>
> OK.  Its not a bug but as we discuss this it seems to me that its  
> current operation is undesirable

We discuss it only because *you* think it's undesirable...


> since environments don't seem to fit into the scheme that other  
> objects do yet different design/implement would allow this to occur.
>

Environments are different *on purpose*, what environments do cannot  
be achieved using any other 'standard' object. And it's exactly  
environment's behavior on assign that makes it useful, so what you  
are proposing is basically making it into a list (so that it gets  
copied on assign), which makes no sense. What you really want is  
something other than an environment, but you insist on using an  
environment - it's like insisting on using a screwdriver on a nail -  
it's not the screwdriver's fault that it doesn't work ...

.. and since you pounding on OO - environments are the closest you  
can get to an object semantics as implemented in the most popular OO  
languages, so I wonder why you aren't arguing to make all objects  
into references ;).

Cheers,
Simon


From ggrothendieck at gmail.com  Wed Jul  5 20:14:15 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 14:14:15 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <59d7961d0607051044x6c15463ckd6cfafd4995c2bbd@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
	<59d7961d0607051044x6c15463ckd6cfafd4995c2bbd@mail.gmail.com>
Message-ID: <971536df0607051114v5b80b97cnb6ad68cfd0a0a121@mail.gmail.com>

On 7/5/06, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> > On Wed, 5 Jul 2006, Gabor Grothendieck wrote:
> >
> > > On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> > >> On Wed, 5 Jul 2006, Gabor Grothendieck wrote:
> > >>
> > >> > On 7/5/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> > >> >> On Tue, 4 Jul 2006, Gabor Grothendieck wrote:
> > >> >>
> > >> >> > In the code below, e is an environment which we copy to f and then
> > >> >> > add attributes to e.  Now f winds up with the same attributes.
> > >> >> >
> > >> >> > In other words it seems that the attributes are a property of the
> > >> >> > environment itself and not of the variable.  Thus it appears we
> > >> >> > cannot have two environment variables that correspond to the
> > >> >> > original environment but with different attributes.
> > >> >>
> > >> >> No, we can't. The two variables are references to the same environment,
> > >> so
> > >> >> they are the same.
> > >> >>
> > >> >> If you want the attributes to be copies rather than references then
> > >> create
> > >> >> a list with the environment as an element and put the attributes on the
> > >> >> list.
> > >> >
> > >> > I realize that that is how it works but what I was really wondering was
> > >> > should it work that way?
> > >> >
> > >>
> > >> I think it really should (and this question has come up before).  If you
> > >> do
> > >>    e<-environment()
> > >>    f<-e
> > >>
> > >> then there is only one object that f and e both point to. Now, since such
> > >> things as S3 class and matrix dimension are implemented as attributes I
> > >> think you really have to consider the attributes as part of the object
> > >> [which is also how they are implemented, of course].  So if e and f are
> > >> the same object they should have the same attributes.
> > >
> > > I don't think this follows since in the other cases modifying the
> > > object also creates a copy.
> >
> > In cases other than environments, NULL, external pointers and weak
> > references a new object is (from the language definition point of view)
> > created on assignment. The fact that sometimes the actual memory
> > allocation is deferred is an implementation issue.
> >
> > That is
> >    e <- 2
> >    f <- e
> >
> > creates two different vectors of length 1, so of course they can have
> > different attributes.
> >
> > For environments (and for NULL, external pointers, and weak references),
> > assignment does not create a new object. It creates another reference to
> > the same object.  Since it is the same object, it is the same: attributes,
> > values, class, etc.
> >
> >
> > >>
> > >> Another reasonable position would be to disallow attributes on
> > >> environments (as we do with NULL, another reference object), but that
> > >> seems extreme.
> > >
> > > I don't think that that would solve it because there is still the issue
> > > of the class attribute which you can't disallow.
> >
> > Of course you can. It might be inconvenient, but it's not difficult.
> >
> >
> > > In fact consider this:
> > >
> > > e <- new.env()
> > > f <- e
> > > class(f) <- c("myenv", "environment")
> > > F <- function(x) UseMethod("F")
> > > F.environment <- function(x) 1
> > > F.myenv <- function(x) 2
> > > F(e) # 2
> > > F(f) # 2
> > >
> > > The point is that subclassing does not work properly with environments
> >
> > No, subclassing *does* work. f and e are the same object, so they have the
> > same class, c("myenv", "environment"). The thing that doesn't "work" the
> > way you expect is assignment:
> >     f <- e
> > doesn't create a new object, as it would for any other sort of object.
> >
> > > yet subclasses of the environment class should be possible since R
> > > is supposed to be OO and I see no valid reason for exclusing environments
> > > for this.  I guess in this discussion I am coming to the realization that
> > > this issue really is a problem with the current way R works.
> >
> > It really is the way R is designed to work. Whether it is a problem or not
> > is a separate issue. Environments really are references, not values, and
> > they really work differently from the way most other objects work.
>
> Yes, it about how you *try* to look at it and not how it was designed.
>  I was also bitten by this a few years ago.  There are two ways to
> think of 'e' and 'f' above:
>
>  1) 'e' and 'f' are R objects (reference variables) that refers to a
> common object (the environment), and applying attr(e, name) <- value
> applies to the R reference object 'e' and attr(f, name) <- value
> applies to the 'f' object.
>
>  2) 'e' and 'f' are references to a common object (the environment)
> and attr(e, name) <- value applies to the common environment object
> and so do attr(f, name) <- value too.
>
> Case 1) is wrong and Case 2) is correct.

I think what you mean is that case 2 is how it works but from
the viewpoint of desirability in terms of design, case 2 seems
inconsistent with oo principles since subclassing does not work
properly.

>
> If you prefer Case 1) you can wrap up your environment in a list, e.g.
>
>  e <- list(env=new.env())
>  f <- list(env=e$env)

I realize that this is how a number of packages, such as tcltk, work
to circumvent the design problem but what one really wants is the
ability to define a subclass of environment directly -- not create a new
class and then define a subclass of that new class.  In particular, one wants
all the existing environment methods to work on the subclass
and they don't unless you redefine them all.  OO is about reusing
existing functionality via inheritance.

>
> This makes 'e' and 'f' two different object that can have different
> attributes, but both e$env and f$env refers to the same environment
> object.  This is the basics of the Object class in the R.oo packages.


From ggrothendieck at gmail.com  Wed Jul  5 20:23:58 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 14:23:58 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
Message-ID: <971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>

On 7/5/06, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> Gabor,
>
> On Jul 5, 2006, at 1:16 PM, Gabor Grothendieck wrote:
>
> >> It really is the way R is designed to work. Whether it is a
> >> problem or not is a separate issue. Environments really are
> >> references, not values, and they really work differently from the
> >> way most other objects work.
> >
> > OK.  Its not a bug but as we discuss this it seems to me that its
> > current operation is undesirable
>
> We discuss it only because *you* think it's undesirable...
>
>
> > since environments don't seem to fit into the scheme that other
> > objects do yet different design/implement would allow this to occur.
> >
>
> Environments are different *on purpose*, what environments do cannot
> be achieved using any other 'standard' object. And it's exactly
> environment's behavior on assign that makes it useful, so what you
> are proposing is basically making it into a list (so that it gets
> copied on assign), which makes no sense. What you really want is
> something other than an environment, but you insist on using an
> environment - it's like insisting on using a screwdriver on a nail -
> it's not the screwdriver's fault that it doesn't work ...
>
> .. and since you pounding on OO - environments are the closest you
> can get to an object semantics as implemented in the most popular OO
> languages, so I wonder why you aren't arguing to make all objects
> into references ;).
>
> Cheers,
> Simon
>
>

I don't think ad hominem arguments and unsupported statements that
things "make no sense" or analogies to screwdrivers have any relevance
to this discussion.  I think by this time I have shown that subclassing of
environments does not work yet it could if it were designed differently
and furthermore there are significant problems with the workarounds.


From tenney at cse.wustl.edu  Wed Jul  5 20:35:32 2006
From: tenney at cse.wustl.edu (tenney at cse.wustl.edu)
Date: Wed,  5 Jul 2006 20:35:32 +0200 (CEST)
Subject: [Rd] problem with batch mode (PR#9062)
Message-ID: <20060705183532.3BCB95088A@slim.kubism.ku.dk>


I have a perl script that constructs some large R script files and  
runs R in batch mode with the R scripts.  It seems to work ok for a  
while then starts throwing errors like this whenever I try to run R  
in batch mode:

/usr/lib64/R/bin/BATCH: line 52:  7875 Broken pipe             ( echo  
"invisible(options(echo = TRUE))"; cat ${in}; echo ''; echo "proc.time 
()" )
       7876 Segmentation fault      | ${R_HOME}/bin/R ${opts} $ 
{R_BATCH_OPTIONS} >${out} 2>&1

I have had the same problem on the linux and osX versions of R.  Is  
this a known bug?

Thanks,

Aaron Tenney


From simon.urbanek at r-project.org  Wed Jul  5 20:53:31 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 5 Jul 2006 14:53:31 -0400
Subject: [Rd] problem with batch mode (PR#9062)
In-Reply-To: <20060705183532.3BCB95088A@slim.kubism.ku.dk>
References: <20060705183532.3BCB95088A@slim.kubism.ku.dk>
Message-ID: <528E237E-A874-4B95-9AC5-4E3F0DB62087@r-project.org>


On Jul 5, 2006, at 2:35 PM, tenney at cse.wustl.edu wrote:

>
> I have a perl script that constructs some large R script files and  
> runs R in batch mode with the R scripts.  It seems to work ok for a  
> while then starts throwing errors like this whenever I try to run R  
> in batch mode:
>
> /usr/lib64/R/bin/BATCH: line 52:  7875 Broken pipe              
> ( echo "invisible(options(echo = TRUE))"; cat ${in}; echo ''; echo  
> "proc.time ()" )
>        7876 Segmentation fault      | ${R_HOME}/bin/R ${opts} $
> {R_BATCH_OPTIONS} >${out} 2>&1
>
> I have had the same problem on the linux and osX versions of R.  Is  
> this a known bug?
>

You'll have to tell us more than that - at least what it is doing  
when it crashes. Please read the posting guide, we do need details  
before we can help you. Apparently something segfaults in your  
script, so you should attach a debugger to the process that is  
segfaulting and see what exactly crashes.

Cheers,
Simon


From simon.urbanek at r-project.org  Wed Jul  5 21:17:08 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 5 Jul 2006 15:17:08 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
Message-ID: <D06AB424-ECD3-4445-AD55-A4A50563F1AE@r-project.org>


On Jul 5, 2006, at 2:23 PM, Gabor Grothendieck wrote:

> On 7/5/06, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>
> I don't think ad hominem arguments and unsupported statements that  
> things "make no sense" or analogies to screwdrivers have any  
> relevance to this discussion.

I was hoping that it will help you understand the point, apparently I  
was wrong.


> I think by this time I have shown that subclassing of  environments  
> does not work

No, you didn't. Your example demonstrates that subclassing works  
correctly and exactly as expected.

Cheers,
Simon


From murdoch at stats.uwo.ca  Wed Jul  5 21:20:43 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Jul 2006 15:20:43 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
Message-ID: <44AC110B.90306@stats.uwo.ca>

On 7/5/2006 2:23 PM, Gabor Grothendieck wrote:
> On 7/5/06, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>> Gabor,
>>
>> On Jul 5, 2006, at 1:16 PM, Gabor Grothendieck wrote:
>>
>> >> It really is the way R is designed to work. Whether it is a
>> >> problem or not is a separate issue. Environments really are
>> >> references, not values, and they really work differently from the
>> >> way most other objects work.
>> >
>> > OK.  Its not a bug but as we discuss this it seems to me that its
>> > current operation is undesirable
>>
>> We discuss it only because *you* think it's undesirable...

Gabor, I think Simon misread what you wrote above (taking "as we discuss 
this" to mean "because we discuss this", rather than "during our 
discussion of this"), and you misread his reply.  This doesn't look to 
me like an ad hominem.

>> > since environments don't seem to fit into the scheme that other
>> > objects do yet different design/implement would allow this to occur.
>> >
>>
>> Environments are different *on purpose*, what environments do cannot
>> be achieved using any other 'standard' object. And it's exactly
>> environment's behavior on assign that makes it useful, so what you
>> are proposing is basically making it into a list (so that it gets
>> copied on assign), which makes no sense. What you really want is
>> something other than an environment, but you insist on using an
>> environment - it's like insisting on using a screwdriver on a nail -
>> it's not the screwdriver's fault that it doesn't work ...
>>
>> .. and since you pounding on OO - environments are the closest you
>> can get to an object semantics as implemented in the most popular OO
>> languages, so I wonder why you aren't arguing to make all objects
>> into references ;).
>>
>> Cheers,
>> Simon
>>
>>
> 
> I don't think ad hominem arguments and unsupported statements that
> things "make no sense" or analogies to screwdrivers have any relevance
> to this discussion. 

You have ignored my explanation of why things are the way they are. 
Simon's statement is not unsupported in the context of the complete 
discussion.

  I think by this time I have shown that subclassing of
> environments does not work yet it could if it were designed differently
> and furthermore there are significant problems with the workarounds.

I don't think you've shown that subclassing of environments doesn't 
work.  You have an example that shows that shows that R implements 
Henrik's "Case 2" rather than his "Case 1", but as Thomas and I said, 
that really has nothing to do with subclassing.

Subclassing is about defining a new class, not about copying objects. 
You can (and did!) define a new class which inherits from the 
environment class.

There may be problems in UseMethod or NextMethod when the object is an 
environment; if there are, then you're right.  But so far you haven't 
shown that.

Duncan Murdoch
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Wed Jul  5 21:41:07 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 15:41:07 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <D06AB424-ECD3-4445-AD55-A4A50563F1AE@r-project.org>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
	<D06AB424-ECD3-4445-AD55-A4A50563F1AE@r-project.org>
Message-ID: <971536df0607051241h6b3e27aex5d9b91d2bbf8c148@mail.gmail.com>

On 7/5/06, Simon Urbanek <simon.urbanek at r-project.org> wrote:
>
> On Jul 5, 2006, at 2:23 PM, Gabor Grothendieck wrote:
>
> > On 7/5/06, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> >
> > I don't think ad hominem arguments and unsupported statements that
> > things "make no sense" or analogies to screwdrivers have any
> > relevance to this discussion.
>
> I was hoping that it will help you understand the point, apparently I
> was wrong.
>
>
> > I think by this time I have shown that subclassing of  environments
> > does not work
>
> No, you didn't. Your example demonstrates that subclassing works
> correctly and exactly as expected.

I have repeatedly seen people claiming in relation to various topics regarding
R that simply being consistent with the documentation makes it "correct".
Some of these discussions have, in the past, bordered on ridiculous since
everyone who encounters these problems knows there are problems with
the design.

The discussion here is that the current design has an undesirable property
and that an alternate design would remove that problem.


From ggrothendieck at gmail.com  Wed Jul  5 21:47:01 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 15:47:01 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <44AC110B.90306@stats.uwo.ca>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
	<44AC110B.90306@stats.uwo.ca>
Message-ID: <971536df0607051247p7f30412bs45c6cf81dfc16949@mail.gmail.com>

On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 7/5/2006 2:23 PM, Gabor Grothendieck wrote:
> > On 7/5/06, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> >> Gabor,
> >>
> >> On Jul 5, 2006, at 1:16 PM, Gabor Grothendieck wrote:
> >>
> >> >> It really is the way R is designed to work. Whether it is a
> >> >> problem or not is a separate issue. Environments really are
> >> >> references, not values, and they really work differently from the
> >> >> way most other objects work.
> >> >
> >> > OK.  Its not a bug but as we discuss this it seems to me that its
> >> > current operation is undesirable
> >>
> >> We discuss it only because *you* think it's undesirable...
>
> Gabor, I think Simon misread what you wrote above (taking "as we discuss
> this" to mean "because we discuss this", rather than "during our
> discussion of this"), and you misread his reply.  This doesn't look to
> me like an ad hominem.
>
> >> > since environments don't seem to fit into the scheme that other
> >> > objects do yet different design/implement would allow this to occur.
> >> >
> >>
> >> Environments are different *on purpose*, what environments do cannot
> >> be achieved using any other 'standard' object. And it's exactly
> >> environment's behavior on assign that makes it useful, so what you
> >> are proposing is basically making it into a list (so that it gets
> >> copied on assign), which makes no sense. What you really want is
> >> something other than an environment, but you insist on using an
> >> environment - it's like insisting on using a screwdriver on a nail -
> >> it's not the screwdriver's fault that it doesn't work ...
> >>
> >> .. and since you pounding on OO - environments are the closest you
> >> can get to an object semantics as implemented in the most popular OO
> >> languages, so I wonder why you aren't arguing to make all objects
> >> into references ;).
> >>
> >> Cheers,
> >> Simon
> >>
> >>
> >
> > I don't think ad hominem arguments and unsupported statements that
> > things "make no sense" or analogies to screwdrivers have any relevance
> > to this discussion.
>
> You have ignored my explanation of why things are the way they are.
> Simon's statement is not unsupported in the context of the complete
> discussion.
>
>  I think by this time I have shown that subclassing of
> > environments does not work yet it could if it were designed differently
> > and furthermore there are significant problems with the workarounds.
>
> I don't think you've shown that subclassing of environments doesn't
> work.  You have an example that shows that shows that R implements
> Henrik's "Case 2" rather than his "Case 1", but as Thomas and I said,
> that really has nothing to do with subclassing.
>
> Subclassing is about defining a new class, not about copying objects.
> You can (and did!) define a new class which inherits from the
> environment class.

But by subclassing in the way allowed one comes up with something that
is not useful.

That is why tcltk and Henrik's package wrap environments in lists and define
a completely different class but by doing that they are not able to take
advantage of inheritance.


From murdoch at stats.uwo.ca  Wed Jul  5 22:18:21 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Jul 2006 16:18:21 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607051247p7f30412bs45c6cf81dfc16949@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>	
	<Pine.LNX.4.64.0607050857440.32591@homer22.u.washington.edu>	
	<971536df0607050910w2a35e6ecxef5dec5c41a781e3@mail.gmail.com>	
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>	
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>	
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>	
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>	
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>	
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>	
	<44AC110B.90306@stats.uwo.ca>
	<971536df0607051247p7f30412bs45c6cf81dfc16949@mail.gmail.com>
Message-ID: <44AC1E8D.4000602@stats.uwo.ca>

On 7/5/2006 3:47 PM, Gabor Grothendieck wrote:
> On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 7/5/2006 2:23 PM, Gabor Grothendieck wrote:

>>  I think by this time I have shown that subclassing of
>> > environments does not work yet it could if it were designed differently
>> > and furthermore there are significant problems with the workarounds.
>>
>> I don't think you've shown that subclassing of environments doesn't
>> work.  You have an example that shows that shows that R implements
>> Henrik's "Case 2" rather than his "Case 1", but as Thomas and I said,
>> that really has nothing to do with subclassing.
>>
>> Subclassing is about defining a new class, not about copying objects.
>> You can (and did!) define a new class which inherits from the
>> environment class.
> 
> But by subclassing in the way allowed one comes up with something that
> is not useful.

You haven't shown that.  Show an example where you define a new class 
that should inherit from environment but doesn't.

All you've shown so far is that when you try to change the class of an 
object to a new class, it appears that the class of another object also 
changes.  (The explanation being that they are really just different 
names for the same object.)

> That is why tcltk and Henrik's package wrap environments in lists and define
> a completely different class but by doing that they are not able to take
> advantage of inheritance.

I think they did that because they wanted explicit references to 
objects, rather than the built-in implicit ones.  I've wanted explicit 
references to things on a number of occasions too, but that's really 
unrelated to inheritance as far as I can see.

Duncan Murdoch


From ggrothendieck at gmail.com  Wed Jul  5 22:33:25 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 16:33:25 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <44AC1E8D.4000602@stats.uwo.ca>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
	<44AC110B.90306@stats.uwo.ca>
	<971536df0607051247p7f30412bs45c6cf81dfc16949@mail.gmail.com>
	<44AC1E8D.4000602@stats.uwo.ca>
Message-ID: <971536df0607051333s51010444vecb09453717413c2@mail.gmail.com>

On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 7/5/2006 3:47 PM, Gabor Grothendieck wrote:
> > On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> On 7/5/2006 2:23 PM, Gabor Grothendieck wrote:
>
> >>  I think by this time I have shown that subclassing of
> >> > environments does not work yet it could if it were designed differently
> >> > and furthermore there are significant problems with the workarounds.
> >>
> >> I don't think you've shown that subclassing of environments doesn't
> >> work.  You have an example that shows that shows that R implements
> >> Henrik's "Case 2" rather than his "Case 1", but as Thomas and I said,
> >> that really has nothing to do with subclassing.
> >>
> >> Subclassing is about defining a new class, not about copying objects.
> >> You can (and did!) define a new class which inherits from the
> >> environment class.
> >
> > But by subclassing in the way allowed one comes up with something that
> > is not useful.
>
> You haven't shown that.  Show an example where you define a new class
> that should inherit from environment but doesn't.
>
> All you've shown so far is that when you try to change the class of an
> object to a new class, it appears that the class of another object also
> changes.  (The explanation being that they are really just different
> names for the same object.)

But that is not how oo works.  When one defines a child its a
delta to the parent.  It does not change the parent.

Your parenthesized statement discussed why it works that way
under the current design but that is not inevitable.  The current
design is not the only possibility.

>
> > That is why tcltk and Henrik's package wrap environments in lists and define
> > a completely different class but by doing that they are not able to take
> > advantage of inheritance.
>
> I think they did that because they wanted explicit references to
> objects, rather than the built-in implicit ones.  I've wanted explicit
> references to things on a number of occasions too, but that's really
> unrelated to inheritance as far as I can see.

They are defining environments with special features yet they can't make
use of inheritance as they injected the environment object into their object
rather than subclassing it -- understandable given the current limitations.


From murdoch at stats.uwo.ca  Wed Jul  5 22:52:20 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Jul 2006 16:52:20 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607051333s51010444vecb09453717413c2@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>	
	<Pine.LNX.4.64.0607050911380.32591@homer22.u.washington.edu>	
	<971536df0607050939r11dbdb93g6186550477e78d92@mail.gmail.com>	
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>	
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>	
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>	
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>	
	<44AC110B.90306@stats.uwo.ca>	
	<971536df0607051247p7f30412bs45c6cf81dfc16949@mail.gmail.com>	
	<44AC1E8D.4000602@stats.uwo.ca>
	<971536df0607051333s51010444vecb09453717413c2@mail.gmail.com>
Message-ID: <44AC2684.7060104@stats.uwo.ca>

On 7/5/2006 4:33 PM, Gabor Grothendieck wrote:
> On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 7/5/2006 3:47 PM, Gabor Grothendieck wrote:
>> > On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> >> On 7/5/2006 2:23 PM, Gabor Grothendieck wrote:
>>
>> >>  I think by this time I have shown that subclassing of
>> >> > environments does not work yet it could if it were designed differently
>> >> > and furthermore there are significant problems with the workarounds.
>> >>
>> >> I don't think you've shown that subclassing of environments doesn't
>> >> work.  You have an example that shows that shows that R implements
>> >> Henrik's "Case 2" rather than his "Case 1", but as Thomas and I said,
>> >> that really has nothing to do with subclassing.
>> >>
>> >> Subclassing is about defining a new class, not about copying objects.
>> >> You can (and did!) define a new class which inherits from the
>> >> environment class.
>> >
>> > But by subclassing in the way allowed one comes up with something that
>> > is not useful.
>>
>> You haven't shown that.  Show an example where you define a new class
>> that should inherit from environment but doesn't.
>>
>> All you've shown so far is that when you try to change the class of an
>> object to a new class, it appears that the class of another object also
>> changes.  (The explanation being that they are really just different
>> names for the same object.)
> 
> But that is not how oo works.  When one defines a child its a
> delta to the parent.  It does not change the parent.

There are dozens of different definitions of "object oriented", but 
generally in the ones I know about, subclassing is something you do to a 
class, not to an object.  (In some languages classes are objects, but 
not all objects are classes.)

It is possible to have an object with class c('myenv', 'environment'). 
As far as I know, methods applied to that object will dispatch to the 
myenv method if one is defined, or to the environment method or default 
method if not.  That's exactly how things should work, and that's how 
they worked in the example you showed.

Because environments have unusual semantics, it wouldn't surprise me 
very much if there were some errors in the implementation of UseMethod 
or NextMethod.  If there are, then you'd have a valid complaint.  But so 
far you've just made an unsupported claim.

> Your parenthesized statement discussed why it works that way
> under the current design but that is not inevitable.  The current
> design is not the only possibility.
> 
>>
>> > That is why tcltk and Henrik's package wrap environments in lists and define
>> > a completely different class but by doing that they are not able to take
>> > advantage of inheritance.
>>
>> I think they did that because they wanted explicit references to
>> objects, rather than the built-in implicit ones.  I've wanted explicit
>> references to things on a number of occasions too, but that's really
>> unrelated to inheritance as far as I can see.
> 
> They are defining environments with special features yet they can't make
> use of inheritance as they injected the environment object into their object
> rather than subclassing it -- understandable given the current limitations.

I think their worry was that attaching the special features to the 
environment would leave those features at risk of being thrown away by 
some other code that attached its own features to that environment.  But 
this has nothing to do with subclassing, it has everything to do with 
the semantics of references.

If you want to complain about the semantics of references in R, do that, 
but don't bring up the red herring of subclassing (unless you really 
have code that demonstrates that CallMethod or NextMethod don't work as 
expected.)

Duncan Murdoch


From ggrothendieck at gmail.com  Thu Jul  6 02:06:26 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 20:06:26 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <44AC2684.7060104@stats.uwo.ca>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
	<44AC110B.90306@stats.uwo.ca>
	<971536df0607051247p7f30412bs45c6cf81dfc16949@mail.gmail.com>
	<44AC1E8D.4000602@stats.uwo.ca>
	<971536df0607051333s51010444vecb09453717413c2@mail.gmail.com>
	<44AC2684.7060104@stats.uwo.ca>
Message-ID: <971536df0607051706r13dcba67q6773f9e35ddb98f1@mail.gmail.com>

On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 7/5/2006 4:33 PM, Gabor Grothendieck wrote:
> > On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> On 7/5/2006 3:47 PM, Gabor Grothendieck wrote:
> >> > On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> >> On 7/5/2006 2:23 PM, Gabor Grothendieck wrote:
> >>
> >> >>  I think by this time I have shown that subclassing of
> >> >> > environments does not work yet it could if it were designed differently
> >> >> > and furthermore there are significant problems with the workarounds.
> >> >>
> >> >> I don't think you've shown that subclassing of environments doesn't
> >> >> work.  You have an example that shows that shows that R implements
> >> >> Henrik's "Case 2" rather than his "Case 1", but as Thomas and I said,
> >> >> that really has nothing to do with subclassing.
> >> >>
> >> >> Subclassing is about defining a new class, not about copying objects.
> >> >> You can (and did!) define a new class which inherits from the
> >> >> environment class.
> >> >
> >> > But by subclassing in the way allowed one comes up with something that
> >> > is not useful.
> >>
> >> You haven't shown that.  Show an example where you define a new class
> >> that should inherit from environment but doesn't.
> >>
> >> All you've shown so far is that when you try to change the class of an
> >> object to a new class, it appears that the class of another object also
> >> changes.  (The explanation being that they are really just different
> >> names for the same object.)
> >
> > But that is not how oo works.  When one defines a child its a
> > delta to the parent.  It does not change the parent.
>
> There are dozens of different definitions of "object oriented", but
> generally in the ones I know about, subclassing is something you do to a
> class, not to an object.  (In some languages classes are objects, but
> not all objects are classes.)
>
> It is possible to have an object with class c('myenv', 'environment').
> As far as I know, methods applied to that object will dispatch to the
> myenv method if one is defined, or to the environment method or default
> method if not.  That's exactly how things should work, and that's how
> they worked in the example you showed.
>
> Because environments have unusual semantics, it wouldn't surprise me
> very much if there were some errors in the implementation of UseMethod
> or NextMethod.  If there are, then you'd have a valid complaint.  But so
> far you've just made an unsupported claim.
>
> > Your parenthesized statement discussed why it works that way
> > under the current design but that is not inevitable.  The current
> > design is not the only possibility.
> >
> >>
> >> > That is why tcltk and Henrik's package wrap environments in lists and define
> >> > a completely different class but by doing that they are not able to take
> >> > advantage of inheritance.
> >>
> >> I think they did that because they wanted explicit references to
> >> objects, rather than the built-in implicit ones.  I've wanted explicit
> >> references to things on a number of occasions too, but that's really
> >> unrelated to inheritance as far as I can see.
> >
> > They are defining environments with special features yet they can't make
> > use of inheritance as they injected the environment object into their object
> > rather than subclassing it -- understandable given the current limitations.
>
> I think their worry was that attaching the special features to the
> environment would leave those features at risk of being thrown away by
> some other code that attached its own features to that environment.  But
> this has nothing to do with subclassing, it has everything to do with
> the semantics of references.
>
> If you want to complain about the semantics of references in R, do that,
> but don't bring up the red herring of subclassing (unless you really
> have code that demonstrates that CallMethod or NextMethod don't work as
> expected.)

Perhaps the example I gave previously does not adequately
convey the problem.  Lets try another example.

#1 uses R as it currently exists.

1. Define an environment e1 with component A.  Now
suppose we wish to define a "subobject" for which
$ is overridden so that it will upper case the
right arg.  We can do this:

e1 <- new.env()
e1$A <- 1

# now define a "subobject" and override $
e2 <- structure(list(env = e1), class = c("myenvironment", "environment"))
"$.myenvironment" <- function(obj, x) obj[["env"]][[toupper(x)]]

e2$a # 1
e2[["A"]]  # NULL since e2 cannot usefully inherit [[

To really get this to work we would have to
redefine all of environment's methods.  I won't do that
here to keep things small.


2. However, if it were possible to have the class
attached to e2 rather than being attached to the environment itself then
e2 could still inherit all the other methods of "environment" yet
be distinct from e1 even though the two would share the same
environment:

# this assumes a attributes are associated with variables
# does not work as intended in R currently since the class(e2)<-
statement also changes e1:

e1 <- new.env()
e1$A <- 1
e2 <- e1
class(e2) <- c("myenvironment", "environment")
"$.myenvironment" <- function(obj, x) obj[[toupper(x)]]
e2$a # 1
e2[["A"]]  # 1

Now all of environment's methods can be used and e1
can still be used in the usual way.

If we typed the above into R now then e1 would be changed
too.  Thus e2 is no longer a "subobject" of e1.  It is e1.
e1$a # 1  -- oops!

Although this example may seem simple I think it represents the essence
of  the situation that exists in a number of packages.  Any package
that currently uses the list(env=...an.environment...) idiom could
likely usefully
make use of this.  Note that in #1 we had to redefine all the methods of
environment to get access to them but if the functionality assumed in
#2 existed then it would inherit them and no further work need be done.


From murdoch at stats.uwo.ca  Thu Jul  6 04:07:16 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Jul 2006 22:07:16 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607051706r13dcba67q6773f9e35ddb98f1@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>	
	<Pine.LNX.4.64.0607050947290.32591@homer22.u.washington.edu>	
	<971536df0607051016m3ad69f53j3c97ccebf759781d@mail.gmail.com>	
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>	
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>	
	<44AC110B.90306@stats.uwo.ca>	
	<971536df0607051247p7f30412bs45c6cf81dfc16949@mail.gmail.com>	
	<44AC1E8D.4000602@stats.uwo.ca>	
	<971536df0607051333s51010444vecb09453717413c2@mail.gmail.com>	
	<44AC2684.7060104@stats.uwo.ca>
	<971536df0607051706r13dcba67q6773f9e35ddb98f1@mail.gmail.com>
Message-ID: <44AC7054.3070001@stats.uwo.ca>

On 7/5/2006 8:06 PM, Gabor Grothendieck wrote:
> On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 7/5/2006 4:33 PM, Gabor Grothendieck wrote:
>>> On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>> On 7/5/2006 3:47 PM, Gabor Grothendieck wrote:
>>>>> On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>>>> On 7/5/2006 2:23 PM, Gabor Grothendieck wrote:
>>>>>>  I think by this time I have shown that subclassing of
>>>>>>> environments does not work yet it could if it were designed differently
>>>>>>> and furthermore there are significant problems with the workarounds.
>>>>>> I don't think you've shown that subclassing of environments doesn't
>>>>>> work.  You have an example that shows that shows that R implements
>>>>>> Henrik's "Case 2" rather than his "Case 1", but as Thomas and I said,
>>>>>> that really has nothing to do with subclassing.
>>>>>>
>>>>>> Subclassing is about defining a new class, not about copying objects.
>>>>>> You can (and did!) define a new class which inherits from the
>>>>>> environment class.
>>>>> But by subclassing in the way allowed one comes up with something that
>>>>> is not useful.
>>>> You haven't shown that.  Show an example where you define a new class
>>>> that should inherit from environment but doesn't.
>>>>
>>>> All you've shown so far is that when you try to change the class of an
>>>> object to a new class, it appears that the class of another object also
>>>> changes.  (The explanation being that they are really just different
>>>> names for the same object.)
>>> But that is not how oo works.  When one defines a child its a
>>> delta to the parent.  It does not change the parent.
>> There are dozens of different definitions of "object oriented", but
>> generally in the ones I know about, subclassing is something you do to a
>> class, not to an object.  (In some languages classes are objects, but
>> not all objects are classes.)
>>
>> It is possible to have an object with class c('myenv', 'environment').
>> As far as I know, methods applied to that object will dispatch to the
>> myenv method if one is defined, or to the environment method or default
>> method if not.  That's exactly how things should work, and that's how
>> they worked in the example you showed.
>>
>> Because environments have unusual semantics, it wouldn't surprise me
>> very much if there were some errors in the implementation of UseMethod
>> or NextMethod.  If there are, then you'd have a valid complaint.  But so
>> far you've just made an unsupported claim.
>>
>>> Your parenthesized statement discussed why it works that way
>>> under the current design but that is not inevitable.  The current
>>> design is not the only possibility.
>>>
>>>>> That is why tcltk and Henrik's package wrap environments in lists and define
>>>>> a completely different class but by doing that they are not able to take
>>>>> advantage of inheritance.
>>>> I think they did that because they wanted explicit references to
>>>> objects, rather than the built-in implicit ones.  I've wanted explicit
>>>> references to things on a number of occasions too, but that's really
>>>> unrelated to inheritance as far as I can see.
>>> They are defining environments with special features yet they can't make
>>> use of inheritance as they injected the environment object into their object
>>> rather than subclassing it -- understandable given the current limitations.
>> I think their worry was that attaching the special features to the
>> environment would leave those features at risk of being thrown away by
>> some other code that attached its own features to that environment.  But
>> this has nothing to do with subclassing, it has everything to do with
>> the semantics of references.
>>
>> If you want to complain about the semantics of references in R, do that,
>> but don't bring up the red herring of subclassing (unless you really
>> have code that demonstrates that CallMethod or NextMethod don't work as
>> expected.)
> 
> Perhaps the example I gave previously does not adequately
> convey the problem.  Lets try another example.
> 
> #1 uses R as it currently exists.
> 
> 1. Define an environment e1 with component A.  Now
> suppose we wish to define a "subobject" for which
> $ is overridden so that it will upper case the
> right arg.  We can do this:
> 
> e1 <- new.env()
> e1$A <- 1
> 
> # now define a "subobject" and override $
> e2 <- structure(list(env = e1), class = c("myenvironment", "environment"))

I think this shows one of the problems of the S3 object system.  You've 
declared e2 to be an environment, but it's not.  There's nothing in S3 
to stop you from doing that, but the code won't work, as you observed.

> "$.myenvironment" <- function(obj, x) obj[["env"]][[toupper(x)]]
> 
> e2$a # 1
> e2[["A"]]  # NULL since e2 cannot usefully inherit [[
> 
> To really get this to work we would have to
> redefine all of environment's methods.  I won't do that
> here to keep things small.
> 
> 
> 2. However, if it were possible to have the class
> attached to e2 rather than being attached to the environment itself then
> e2 could still inherit all the other methods of "environment" yet
> be distinct from e1 even though the two would share the same
> environment:

That's something different from what I'd expect from an object.  I don't 
expect objects to inherit from other objects, I expect the class of 
objects to inherit from the class of other objects.  This means the 
objects share properties and behaviour, but not necessarily data.

In some languages they can share data too.  In S3 inheritance is almost 
meaningless, so there's really nothing shared, except a claim that any 
method you don't override will still somehow work:  but there's no 
possible way to verify that claim.  That's why John Chambers wrote the 
S4 system.  In S4 objects a descendant class will inherit properties, 
and it will inherite behaviour to some extent, but even S4 doesn't 
really encapsulate behaviour as much as some other object systems (e.g. 
Java) do.
> 
> # this assumes a attributes are associated with variables
> # does not work as intended in R currently since the class(e2)<-
> statement also changes e1:
> 
> e1 <- new.env()
> e1$A <- 1
> e2 <- e1
> class(e2) <- c("myenvironment", "environment")
> "$.myenvironment" <- function(obj, x) obj[[toupper(x)]]
> e2$a # 1
> e2[["A"]]  # 1
> 
> Now all of environment's methods can be used and e1
> can still be used in the usual way.
> 
> If we typed the above into R now then e1 would be changed
> too.  Thus e2 is no longer a "subobject" of e1.  It is e1.
> e1$a # 1  -- oops!
> 
> Although this example may seem simple I think it represents the essence
> of  the situation that exists in a number of packages.  Any package
> that currently uses the list(env=...an.environment...) idiom could
> likely usefully
> make use of this.  Note that in #1 we had to redefine all the methods of
> environment to get access to them but if the functionality assumed in
> #2 existed then it would inherit them and no further work need be done.

But you can still do some of what you want as follows.

Instead of saying e2 <- e1, say e2 <- copy(e1), where copy is a function 
you write that copies the content and attributes of e1.  Changes to e2 
won't affect e1.  Then change the class of e2, and e1 is unaffected.

If you'd like some e2 changes (i.e. content changes) to also affect e1 
but not others (i.e. attribute changes), then you're right, you can't do 
that in the current S3 system.  I'd say that's because R doesn't do 
references as well as it should.  I'd like to have a way to say a 
variable "r" is a reference to something else, so that if you do

s <- r

then s becomes a reference to the same thing.  I had a discussion last 
year with Luke Tierney about this, and he convinced me that it's a 
really good idea to distinguish references from the things they refer 
to, and it's also a good idea not to allow references to named objects.
(If you did an assignment from the thing r refers to directly to another 
variable, you'd get a copy.  Changes to the copy would have no effect on 
the thing r refers to.)

He put together an implementation of this idea using current R 
functions; the only problem was that since the parser didn't know 
anything about it, the syntax was a little clunky.

You couldn't use this to do exactly what you want unless all of R was 
rewritten so that environments were implemented as this new kind of 
reference.  Since environments play such a central role in low level 
processing in R, that's never going to happen.  But you could probably 
accomplish more of what you want to do than now.

Duncan Murdoch


From ggrothendieck at gmail.com  Thu Jul  6 04:28:55 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 5 Jul 2006 22:28:55 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <44AC7054.3070001@stats.uwo.ca>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
	<44AC110B.90306@stats.uwo.ca>
	<971536df0607051247p7f30412bs45c6cf81dfc16949@mail.gmail.com>
	<44AC1E8D.4000602@stats.uwo.ca>
	<971536df0607051333s51010444vecb09453717413c2@mail.gmail.com>
	<44AC2684.7060104@stats.uwo.ca>
	<971536df0607051706r13dcba67q6773f9e35ddb98f1@mail.gmail.com>
	<44AC7054.3070001@stats.uwo.ca>
Message-ID: <971536df0607051928m5017cd35xba788618cc6a36dc@mail.gmail.com>

On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 7/5/2006 8:06 PM, Gabor Grothendieck wrote:
> > On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> On 7/5/2006 4:33 PM, Gabor Grothendieck wrote:
> >>> On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >>>> On 7/5/2006 3:47 PM, Gabor Grothendieck wrote:
> >>>>> On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >>>>>> On 7/5/2006 2:23 PM, Gabor Grothendieck wrote:
> >>>>>>  I think by this time I have shown that subclassing of
> >>>>>>> environments does not work yet it could if it were designed differently
> >>>>>>> and furthermore there are significant problems with the workarounds.
> >>>>>> I don't think you've shown that subclassing of environments doesn't
> >>>>>> work.  You have an example that shows that shows that R implements
> >>>>>> Henrik's "Case 2" rather than his "Case 1", but as Thomas and I said,
> >>>>>> that really has nothing to do with subclassing.
> >>>>>>
> >>>>>> Subclassing is about defining a new class, not about copying objects.
> >>>>>> You can (and did!) define a new class which inherits from the
> >>>>>> environment class.
> >>>>> But by subclassing in the way allowed one comes up with something that
> >>>>> is not useful.
> >>>> You haven't shown that.  Show an example where you define a new class
> >>>> that should inherit from environment but doesn't.
> >>>>
> >>>> All you've shown so far is that when you try to change the class of an
> >>>> object to a new class, it appears that the class of another object also
> >>>> changes.  (The explanation being that they are really just different
> >>>> names for the same object.)
> >>> But that is not how oo works.  When one defines a child its a
> >>> delta to the parent.  It does not change the parent.
> >> There are dozens of different definitions of "object oriented", but
> >> generally in the ones I know about, subclassing is something you do to a
> >> class, not to an object.  (In some languages classes are objects, but
> >> not all objects are classes.)
> >>
> >> It is possible to have an object with class c('myenv', 'environment').
> >> As far as I know, methods applied to that object will dispatch to the
> >> myenv method if one is defined, or to the environment method or default
> >> method if not.  That's exactly how things should work, and that's how
> >> they worked in the example you showed.
> >>
> >> Because environments have unusual semantics, it wouldn't surprise me
> >> very much if there were some errors in the implementation of UseMethod
> >> or NextMethod.  If there are, then you'd have a valid complaint.  But so
> >> far you've just made an unsupported claim.
> >>
> >>> Your parenthesized statement discussed why it works that way
> >>> under the current design but that is not inevitable.  The current
> >>> design is not the only possibility.
> >>>
> >>>>> That is why tcltk and Henrik's package wrap environments in lists and define
> >>>>> a completely different class but by doing that they are not able to take
> >>>>> advantage of inheritance.
> >>>> I think they did that because they wanted explicit references to
> >>>> objects, rather than the built-in implicit ones.  I've wanted explicit
> >>>> references to things on a number of occasions too, but that's really
> >>>> unrelated to inheritance as far as I can see.
> >>> They are defining environments with special features yet they can't make
> >>> use of inheritance as they injected the environment object into their object
> >>> rather than subclassing it -- understandable given the current limitations.
> >> I think their worry was that attaching the special features to the
> >> environment would leave those features at risk of being thrown away by
> >> some other code that attached its own features to that environment.  But
> >> this has nothing to do with subclassing, it has everything to do with
> >> the semantics of references.
> >>
> >> If you want to complain about the semantics of references in R, do that,
> >> but don't bring up the red herring of subclassing (unless you really
> >> have code that demonstrates that CallMethod or NextMethod don't work as
> >> expected.)
> >
> > Perhaps the example I gave previously does not adequately
> > convey the problem.  Lets try another example.
> >
> > #1 uses R as it currently exists.
> >
> > 1. Define an environment e1 with component A.  Now
> > suppose we wish to define a "subobject" for which
> > $ is overridden so that it will upper case the
> > right arg.  We can do this:
> >
> > e1 <- new.env()
> > e1$A <- 1
> >
> > # now define a "subobject" and override $
> > e2 <- structure(list(env = e1), class = c("myenvironment", "environment"))
>
> I think this shows one of the problems of the S3 object system.  You've
> declared e2 to be an environment, but it's not.  There's nothing in S3
> to stop you from doing that, but the code won't work, as you observed.
>
> > "$.myenvironment" <- function(obj, x) obj[["env"]][[toupper(x)]]
> >
> > e2$a # 1
> > e2[["A"]]  # NULL since e2 cannot usefully inherit [[
> >
> > To really get this to work we would have to
> > redefine all of environment's methods.  I won't do that
> > here to keep things small.
> >
> >
> > 2. However, if it were possible to have the class
> > attached to e2 rather than being attached to the environment itself then
> > e2 could still inherit all the other methods of "environment" yet
> > be distinct from e1 even though the two would share the same
> > environment:
>
> That's something different from what I'd expect from an object.  I don't
> expect objects to inherit from other objects, I expect the class of
> objects to inherit from the class of other objects.  This means the
> objects share properties and behaviour, but not necessarily data.


With environments new possibilities become available and this sharing
of data is one of them.   From the viewpoint of S3 the inheritance is
still the usual S3 inheritance but it would allow the same environment
to be used in different objects sharing the same data.  It does not really
extend the inheritance concept with respect to data as the data in e1
cannot be overridden by e2 without changing e1.  It only allows the
methods to be overridden.  Yet it would provide a useful step without
being too drastic. The fact that existing code motivated this example
suggests that it would be useful.

>
> In some languages they can share data too.  In S3 inheritance is almost
> meaningless, so there's really nothing shared, except a claim that any
> method you don't override will still somehow work:  but there's no
> possible way to verify that claim.  That's why John Chambers wrote the
> S4 system.  In S4 objects a descendant class will inherit properties,
> and it will inherite behaviour to some extent, but even S4 doesn't
> really encapsulate behaviour as much as some other object systems (e.g.
> Java) do.
> >
> > # this assumes a attributes are associated with variables
> > # does not work as intended in R currently since the class(e2)<-
> > statement also changes e1:
> >
> > e1 <- new.env()
> > e1$A <- 1
> > e2 <- e1
> > class(e2) <- c("myenvironment", "environment")
> > "$.myenvironment" <- function(obj, x) obj[[toupper(x)]]
> > e2$a # 1
> > e2[["A"]]  # 1
> >
> > Now all of environment's methods can be used and e1
> > can still be used in the usual way.
> >
> > If we typed the above into R now then e1 would be changed
> > too.  Thus e2 is no longer a "subobject" of e1.  It is e1.
> > e1$a # 1  -- oops!
> >
> > Although this example may seem simple I think it represents the essence
> > of  the situation that exists in a number of packages.  Any package
> > that currently uses the list(env=...an.environment...) idiom could
> > likely usefully
> > make use of this.  Note that in #1 we had to redefine all the methods of
> > environment to get access to them but if the functionality assumed in
> > #2 existed then it would inherit them and no further work need be done.
>
> But you can still do some of what you want as follows.
>
> Instead of saying e2 <- e1, say e2 <- copy(e1), where copy is a function
> you write that copies the content and attributes of e1.  Changes to e2
> won't affect e1.  Then change the class of e2, and e1 is unaffected.
>
> If you'd like some e2 changes (i.e. content changes) to also affect e1
> but not others (i.e. attribute changes), then you're right, you can't do
> that in the current S3 system.  I'd say that's because R doesn't do
> references as well as it should.  I'd like to have a way to say a
> variable "r" is a reference to something else, so that if you do
>

If you are going to copy them you might as well use lists.

> s <- r
>
> then s becomes a reference to the same thing.  I had a discussion last
> year with Luke Tierney about this, and he convinced me that it's a
> really good idea to distinguish references from the things they refer
> to, and it's also a good idea not to allow references to named objects.
> (If you did an assignment from the thing r refers to directly to another
> variable, you'd get a copy.  Changes to the copy would have no effect on
> the thing r refers to.)
>
> He put together an implementation of this idea using current R
> functions; the only problem was that since the parser didn't know
> anything about it, the syntax was a little clunky.
>
> You couldn't use this to do exactly what you want unless all of R was
> rewritten so that environments were implemented as this new kind of
> reference.  Since environments play such a central role in low level
> processing in R, that's never going to happen.  But you could probably
> accomplish more of what you want to do than now.
>
> Duncan Murdoch
>

I think the idea here of separating the attributes from the .environment
is less drastic than changing or proposing a new oo system or adding a
new reference facility.  Its more incremental in nature and simply makes
the existing sharing of environments more useful by leveraging the
existing S3 inheritance system in a way which cannot (usefully) be done now.


From maechler at stat.math.ethz.ch  Thu Jul  6 10:17:29 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 6 Jul 2006 10:17:29 +0200
Subject: [Rd] RFC: more generous print.table(*, zero.print = .) behavior
In-Reply-To: <17578.35823.368413.65517@stat.math.ethz.ch>
References: <40D3930AC1C8EA469E39536E5BC80835023FB024@EXDKBA021.corp.novocorp.net>
	<x264ik9sey.fsf@viggo.kubism.ku.dk>
	<17573.16044.463160.287875@stat.math.ethz.ch>
	<17578.35823.368413.65517@stat.math.ethz.ch>
Message-ID: <17580.50969.268861.114149@stat.math.ethz.ch>

Hmm,
I'm replying once more to myself  (as popular wisdom says, "talking to
 oneself" is probably a dangerous sign of increasing mental
 disorder.... ;-()

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Tue, 4 Jul 2006 17:40:31 +0200 writes:

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Fri, 30 Jun 2006 17:09:32 +0200 writes:

>>>>> "PD" == Peter Dalgaard <p.dalgaard at biostat.ku.dk>
>>>>>     on 29 Jun 2006 12:18:13 +0200 writes:

    PD> "BXC (Bendix Carstensen)" <bxc at steno.dk> writes:

    BXC> The function addmargins() adds margins to a table, but returns a matrix.
    BXC> But even after converted to a table the print.zero="." option of
    BXC> print.table() does not work:
    BXC> 
    BXC> > x <- sample( 1:7, 20, replace=T )
    BXC> > y <- sample( 1:7, 20, replace=T )
    BXC> > tt <- table( x, y )
    BXC> > tx <- as.table( addmargins( table( x, y ) ) )
    BXC> > print( tt, zero.print="." )
    BXC> y
    BXC> x   1 2 3 4 5 6 7
    BXC> 1 1 2 2 . . 1 .
    BXC> 2 1 . . 1 . . .
    BXC> 3 . . . . . . 2
    BXC> 4 1 . . . . 1 .
    BXC> 5 1 . 1 . . 1 .
    BXC> 6 . 1 . 1 . . .
    BXC> 7 . . 1 . 1 1 .
    BXC> > print( tx, zero.print="." )
    BXC> y
    BXC> x      1  2  3  4  5  6  7 Sum
    BXC> 1    1  2  2  0  0  1  0   6
    BXC> 2    1  0  0  1  0  0  0   2
    BXC> 3    0  0  0  0  0  0  2   2
    BXC> 4    1  0  0  0  0  1  0   2
    BXC> 5    1  0  1  0  0  1  0   3
    BXC> 6    0  1  0  1  0  0  0   2
    BXC> 7    0  0  1  0  1  1  0   3
    BXC> Sum  4  3  4  2  1  4  2  20
    BXC> 
    BXC> Is this a facility of print.table?
    BXC> The attributes() of tt and tx have identical stucture. 

    PD> It appears to be intentional.
    PD> 
    PD> print.table has
    PD> 
    PD> if (is.integer(x) && zero.print != "0" && any(i0 <- !ina &
    PD> x == 0))
    PD> xx[i0] <- sub("0", zero.print, xx[i0])
    PD> 
    PD> and of course,
    PD> 
    PD> > storage.mode(tx)
    PD> [1] "double"
    PD> > storage.mode(tt)
    PD> [1] "integer"
    PD> 
    PD> The reason could be that it is not entirely clear what to expect for
    PD> values that are zero up to round-off.
    PD> 
    PD> storage.mode(tx) <- "integer" fixes things up.

    MM> On the other hand, I'm pretty sure I was the one who added
    MM> 'zero.print' and I don't oppose at all to change

    MM> is.integer(x)   to   all(x == round(x))

    MM> {and then for efficiency swap the *order* of the tests inside that if(.)}
    MM> which I think would be a bit more convenient and still ok (*)
    MM> here.

    MM> Martin Maechler, ETH Zurich

    MM> (*) yes, one could then construct artificial cases where the
    MM> if(.) test would ``conceptually'' be wrong, but I think that
    MM> would not matter for all practical cases.

    MM> In R-devel,  

    MM> -  addmargins(x, ...) now returns a "table" when 'x' was one.

    MM> -  print.table(x, zero.print = ch) now also ``zero-prints'' when
    MM> 'x' is not "integer" but numeric with integer values.

I still wonder now about the originaly reason why such a test
should be done at all.  If   'zero.print = ch' is explicitly
specified shouldn't it be used in any case, even in those cases
where a value ``accidentally became 0'' ?

I'm currently tending to think that we should drop that test 
[ 'all(x == round(x))'  which originally was 'is.integer(x)' ]
entirely.

What do others think?

    MM> Bendix' original example can now be slightly shortened *and*
    MM> works as desired (in R-devel, aka 2.4.0 -- to-be):

    >> set.seed(1)
    >> x <- sample( 1:7, 20, replace=TRUE)
    >> y <- sample( 1:7, 20, replace=TRUE)
    >> tx <- addmargins( table(x, y) )
    >> print(tx, zero.print = ".")
    MM> y
    MM> x      1  2  3  4  5  6  7 Sum
    MM> 1    .  .  1  .  .  .  .   1
    MM> 2    .  1  .  1  1  .  1   4
    MM> 3    .  2  .  .  .  1  .   3
    MM> 4    .  .  .  .  1  .  .   1
    MM> 5    .  .  1  1  1  .  1   4
    MM> 6    .  .  1  .  .  2  .   3
    MM> 7    3  .  1  .  .  .  .   4
    MM> Sum  3  3  4  2  3  3  2  20
    >> 

    MM> Hoping, this will be useful..
    MM> Martin Maechler, ETH Zurich

    MM> ______________________________________________
    MM> R-devel at r-project.org mailing list
    MM> https://stat.ethz.ch/mailman/listinfo/r-devel


From ben.bob at gmail.com  Thu Jul  6 18:14:02 2006
From: ben.bob at gmail.com (Bo Peng)
Date: Thu, 6 Jul 2006 11:14:02 -0500
Subject: [Rd] R installation glitches.
Message-ID: <6ea7b5430607060914v79db12f8xe13f7713d025ef0a@mail.gmail.com>

Dear list,

I installed R 2.3.1 on a solaris machine. The first time, I used the
wrong option --enable-shlib,  the installation went smoothly (glitch
1), but of course did not generate libR.so. So, I ran ./configure
again with --enable-R-shlib, make and make install went well but still
there was no libR.so generated (glitch 2). Finally, I removed the
build directory and started fresh, and everything went well.

I should have used the correct options, or should have used make
distclean afterwards, but the fact that configure/make did not
complain may be considered as bugs.

Regards,
Bo


From timh at insightful.com  Fri Jul  7 01:35:42 2006
From: timh at insightful.com (timh at insightful.com)
Date: Fri,  7 Jul 2006 01:35:42 +0200 (CEST)
Subject: [Rd] comment causes browser() to exit (PR#9063)
Message-ID: <20060706233542.747E6508C6@slim.kubism.ku.dk>

I'm trying to step through some code using browser(),
executing one line at a time.
Unfortunately, whenever I execute a comment line, the browser exits.

I previously reported a similar problem with blank lines.

These problems are a strong incentive to write poor code 
-- uncommented code with no blank lines to improve readability --
so that I can use browser() without it exiting at inconvenient times.

Additional detail:  
(1) I'm running R inside emacs, with R in one buffer
and a file containing code in another, using a macro to copy and paste
a line at a time from the file to the R buffer.
(2) The browser() call is inside a function.  
Right now the lines I'm sending to the browser are not part of the function,
though usually they are.


--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 3.1
 year = 2006
 month = 06
 day = 01
 svn rev = 38247
 language = R
 version.string = Version 2.3.1 (2006-06-01)

Windows XP Professional (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:methods, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, Autoloads, package:base


From lamp at few.eur.nl  Fri Jul  7 10:55:42 2006
From: lamp at few.eur.nl (lamp at few.eur.nl)
Date: Fri,  7 Jul 2006 10:55:42 +0200 (CEST)
Subject: [Rd] LOESS (PR#9064)
Message-ID: <20060707085542.39EC4549C9@slim.kubism.ku.dk>

Hello,

I found a little BUG in loess <stats>. It does not receive the iterations
parameter.
It can be debugged in the following way:

THIS IS AN EXCERPT FROM THE CODE:

....

fit <- simpleLoess(y, x, w, span, degree, parametric, drop.square,
        normalize, control$statistics, control$surface, control$cell,
        iterations, control$trace.hat)

Replace argument iterations with control$iterations.

I found also remarkable differences when comparing loess with PROC LOESS
(in SAS) using the same parameters and variables. It really confuses me.
Where can I report this?

Best regards,

Felix Lamp


From ripley at stats.ox.ac.uk  Fri Jul  7 11:39:34 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Fri,  7 Jul 2006 11:39:34 +0200 (CEST)
Subject: [Rd] LOESS (PR#9064)
Message-ID: <20060707093934.1693C549A7@slim.kubism.ku.dk>

On Fri, 7 Jul 2006, lamp at few.eur.nl wrote:

> Hello,
>
> I found a little BUG in loess <stats>. It does not receive the iterations
> parameter.

Please provide an example demonstrating this 'BUG', as we do ask you to 
do, along with basic information like your name, the version of R, the 
platform ....

> It can be debugged in the following way:

(Not in any sense of `debugged' that my dictionary mentions.)

> THIS IS AN EXCERPT FROM THE CODE:
>
> ....
>
> fit <- simpleLoess(y, x, w, span, degree, parametric, drop.square,
>        normalize, control$statistics, control$surface, control$cell,
>        iterations, control$trace.hat)
>
> Replace argument iterations with control$iterations.

Why?  The code contains a few lines earlier

     iterations <- if(family=="gaussian") 1 else control$iterations

which is the intention.  ?loess.control does say

iterations: the number of iterations used in robust fitting.
                                              ^^^^^^

> I found also remarkable differences when comparing loess with PROC LOESS
> (in SAS) using the same parameters and variables. It really confuses me.
> Where can I report this?

R-bugs is not a place to ask questions, but bugs in SAS can be reported to 
SAS inc.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From eric.durand at imag.fr  Fri Jul  7 11:50:44 2006
From: eric.durand at imag.fr (eric.durand at imag.fr)
Date: Fri,  7 Jul 2006 11:50:44 +0200 (CEST)
Subject: [Rd] BUG in " == " ? (PR#9065)
Message-ID: <20060707095044.80D4C549AE@slim.kubism.ku.dk>

Hello,
here is the version of R that I use :

> version
               _
platform       i486-pc-linux-gnu
arch           i486
os             linux-gnu
system         i486, linux-gnu
status
major          2
minor          3.1
year           2006
month          06
day            01
svn rev        38247
language       R
version.string Version 2.3.1 (2006-06-01)

And here is one of the sequences of isntruction that returns an abberation : 

> x<-seq(0,1,by=0.01)
> x[71]
[1] 0.7
> which(x == 0.7)
numeric(0)
> x[71] == 0.7
[1] FALSE

Or another version of (maybe) the same bug : 

> x <- 70
> x == 70
[1] TRUE
> x <- x*0
> x <- 70
> x == 70
[1] TRUE
> x<-x*0.01
> x
[1] 0.7
> x == 0.7
[1] FALSE

It seems completely strange ... any help would be greatly appreciated :)

Regards,
Eric Durand


From p.dalgaard at biostat.ku.dk  Fri Jul  7 11:59:04 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 07 Jul 2006 11:59:04 +0200
Subject: [Rd] BUG in " == " ? (PR#9065)
In-Reply-To: <20060707095044.80D4C549AE@slim.kubism.ku.dk>
References: <20060707095044.80D4C549AE@slim.kubism.ku.dk>
Message-ID: <x2irm9u45z.fsf@viggo.kubism.ku.dk>

eric.durand at imag.fr writes:

> Hello,
> here is the version of R that I use :
> 
> > version
>                _
> platform       i486-pc-linux-gnu
> arch           i486
> os             linux-gnu
> system         i486, linux-gnu
> status
> major          2
> minor          3.1
> year           2006
> month          06
> day            01
> svn rev        38247
> language       R
> version.string Version 2.3.1 (2006-06-01)
> 
> And here is one of the sequences of isntruction that returns an abberation : 
> 
> > x<-seq(0,1,by=0.01)
> > x[71]
> [1] 0.7
> > which(x == 0.7)
> numeric(0)
> > x[71] == 0.7
> [1] FALSE
> 
> Or another version of (maybe) the same bug : 
> 
> > x <- 70
> > x == 70
> [1] TRUE
> > x <- x*0
> > x <- 70
> > x == 70
> [1] TRUE
> > x<-x*0.01
> > x
> [1] 0.7
> > x == 0.7
> [1] FALSE
> 
> It seems completely strange ... any help would be greatly appreciated :)

FAQ 7.31

http://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f
-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Fri Jul  7 13:08:09 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Fri,  7 Jul 2006 13:08:09 +0200 (CEST)
Subject: [Rd] User Error (was LOESS (PR#9064))
Message-ID: <20060707110809.4B0AA549E9@slim.kubism.ku.dk>

Please do as we ask (repeatedly) and study the help page before posting.

'family' is a separate argument, not part of loess.control, as the help 
page correctly documents.  If you use

cars.lo2 <- loess(dist ~ speed, cars, family = "symmetric",
  control = loess.control(surface = "direct",  iterations = 20))
cars.lo2$pars$iterations

it prints *20*, as it is documented to do.


On Fri, 7 Jul 2006, lamp at few.eur.nl wrote:

> Dear Mr Ripley,

> Thank you for your help.
>
> Version of R: 2.3.1
> Platform: Windows XP
>
> Example:
>
> cars.lo2 <- loess(dist ~ speed, cars,
>  control = loess.control(surface = "direct" , family = 'symmetric' ,
> iterations = 20))
>  cars.lo2$pars$iterations
>
> Returns 1, where it should return 10.

Why 10? It should and does return 1, but you seem to think you asked for 
20!

> If one makes the alterations this will not happen.

It would then be incorrect on the example on the help page.

>
> Best regards,
>
> Felix Lamp
>
>
>
>
>> On Fri, 7 Jul 2006, lamp at few.eur.nl wrote:
>>
>>> Hello,
>>>
>>> I found a little BUG in loess <stats>. It does not receive the
>>> iterations
>>> parameter.
>>
>> Please provide an example demonstrating this 'BUG', as we do ask you to
>> do, along with basic information like your name, the version of R, the
>> platform ....
>>
>>> It can be debugged in the following way:
>>
>> (Not in any sense of `debugged' that my dictionary mentions.)
>>
>>> THIS IS AN EXCERPT FROM THE CODE:
>>>
>>> ....
>>>
>>> fit <- simpleLoess(y, x, w, span, degree, parametric, drop.square,
>>>        normalize, control$statistics, control$surface, control$cell,
>>>        iterations, control$trace.hat)
>>>
>>> Replace argument iterations with control$iterations.
>>
>> Why?  The code contains a few lines earlier
>>
>>      iterations <- if(family=="gaussian") 1 else control$iterations
>>
>> which is the intention.  ?loess.control does say
>>
>> iterations: the number of iterations used in robust fitting.
>>                                               ^^^^^^
>>
>>> I found also remarkable differences when comparing loess with PROC LOESS
>>> (in SAS) using the same parameters and variables. It really confuses me.
>>> Where can I report this?
>>
>> R-bugs is not a place to ask questions, but bugs in SAS can be reported to
>> SAS inc.
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From gavin.simpson at ucl.ac.uk  Fri Jul  7 13:15:09 2006
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Fri, 07 Jul 2006 12:15:09 +0100
Subject: [Rd] BUG in " == " ? (PR#9065)
In-Reply-To: <20060707095044.80D4C549AE@slim.kubism.ku.dk>
References: <20060707095044.80D4C549AE@slim.kubism.ku.dk>
Message-ID: <1152270910.18259.21.camel@gsimpson.geog.ucl.ac.uk>

On Fri, 2006-07-07 at 11:50 +0200, eric.durand at imag.fr wrote:
> Hello,
> here is the version of R that I use :
> 
> > version
>                _
> platform       i486-pc-linux-gnu
> arch           i486
> os             linux-gnu
> system         i486, linux-gnu
> status
> major          2
> minor          3.1
> year           2006
> month          06
> day            01
> svn rev        38247
> language       R
> version.string Version 2.3.1 (2006-06-01)
> 
> And here is one of the sequences of isntruction that returns an abberation : 
> 
> > x<-seq(0,1,by=0.01)
> > x[71]
> [1] 0.7
> > which(x == 0.7)
> numeric(0)
> > x[71] == 0.7
> [1] FALSE
> 
> Or another version of (maybe) the same bug : 
> 
> > x <- 70
> > x == 70
> [1] TRUE
> > x <- x*0
> > x <- 70
> > x == 70
> [1] TRUE
> > x<-x*0.01
> > x
> [1] 0.7
> > x == 0.7
> [1] FALSE
> 
> It seems completely strange ... any help would be greatly appreciated :)
> 
> Regards,
> Eric Durand

Not a bug. Floating point precision - see
http://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f

E.g.:

x <- seq(0,1,by=0.01)
x[71]
which(x == 0.7) # FALSE
all.equal(0.7, x[71]) # TRUE

all.equal() should be used for this type of comparison. See ?all.equal

You could achieve what you wanted by something like this [ if you have a
real need to use which() ]:

x <- c(0.7, x, 0.7) # more 0.7's
lims <- range(0.7 + .Machine$double.eps^0.5, 0.7 - .Machine$double.eps^0.5)
which(x >= lims[1] & x <= lims[2])

Not sure if this is a good way to do it or not?

If you need to do this kind of comparison with which(), having a
v.all.equal() do a vectorised version of all.equal() would be useful,
returning a vector of TRUE/FALSE for each comparison. Maybe this already
exists somewhere?

E.g.:

v.all.equal <- function(x, y) {
  apply(as.matrix(x), 1, function(x, y) {
    retval <- as.logical(all.equal(x, y))
    retval[is.na(retval)] <- FALSE
    retval
  }, y)
}

which(v.all.equal(x, 0.7)) # 1  72 103

Again, maybe this is a bad thing...? In which case, I guess I'm about to
get told so... ;-)

G
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/cv/
 London, UK. WC1E 6BT.         [w] http://www.ucl.ac.uk/~ucfagls/
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From dimitris.rizopoulos at med.kuleuven.be  Fri Jul  7 13:49:13 2006
From: dimitris.rizopoulos at med.kuleuven.be (Dimitris Rizopoulos)
Date: Fri, 7 Jul 2006 13:49:13 +0200
Subject: [Rd] BUG in " == " ? (PR#9065)
References: <20060707095044.80D4C549AE@slim.kubism.ku.dk>
	<1152270910.18259.21.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <004a01c6a1bb$5de89e00$0540210a@www.domain>


----- Original Message ----- 
From: "Gavin Simpson" <gavin.simpson at ucl.ac.uk>
To: <eric.durand at imag.fr>
Cc: <r-devel at stat.math.ethz.ch>
Sent: Friday, July 07, 2006 1:15 PM
Subject: Re: [Rd] BUG in " == " ? (PR#9065)


> On Fri, 2006-07-07 at 11:50 +0200, eric.durand at imag.fr wrote:
>> Hello,
>> here is the version of R that I use :
>>
>> > version
>>                _
>> platform       i486-pc-linux-gnu
>> arch           i486
>> os             linux-gnu
>> system         i486, linux-gnu
>> status
>> major          2
>> minor          3.1
>> year           2006
>> month          06
>> day            01
>> svn rev        38247
>> language       R
>> version.string Version 2.3.1 (2006-06-01)
>>
>> And here is one of the sequences of isntruction that returns an 
>> abberation :
>>
>> > x<-seq(0,1,by=0.01)
>> > x[71]
>> [1] 0.7
>> > which(x == 0.7)
>> numeric(0)
>> > x[71] == 0.7
>> [1] FALSE
>>
>> Or another version of (maybe) the same bug :
>>
>> > x <- 70
>> > x == 70
>> [1] TRUE
>> > x <- x*0
>> > x <- 70
>> > x == 70
>> [1] TRUE
>> > x<-x*0.01
>> > x
>> [1] 0.7
>> > x == 0.7
>> [1] FALSE
>>
>> It seems completely strange ... any help would be greatly 
>> appreciated :)
>>
>> Regards,
>> Eric Durand
>
> Not a bug. Floating point precision - see
> http://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f
>
> E.g.:
>
> x <- seq(0,1,by=0.01)
> x[71]
> which(x == 0.7) # FALSE
> all.equal(0.7, x[71]) # TRUE
>
> all.equal() should be used for this type of comparison. See 
> ?all.equal
>
> You could achieve what you wanted by something like this [ if you 
> have a
> real need to use which() ]:
>
> x <- c(0.7, x, 0.7) # more 0.7's
> lims <- range(0.7 + .Machine$double.eps^0.5, 0.7 - 
> .Machine$double.eps^0.5)
> which(x >= lims[1] & x <= lims[2])
>
> Not sure if this is a good way to do it or not?
>
> If you need to do this kind of comparison with which(), having a
> v.all.equal() do a vectorised version of all.equal() would be 
> useful,
> returning a vector of TRUE/FALSE for each comparison. Maybe this 
> already
> exists somewhere?
>
> E.g.:
>
> v.all.equal <- function(x, y) {
>  apply(as.matrix(x), 1, function(x, y) {
>    retval <- as.logical(all.equal(x, y))
>    retval[is.na(retval)] <- FALSE
>    retval
>  }, y)
> }
>
> which(v.all.equal(x, 0.7)) # 1  72 103

in this case I think it's simpler to do something like:

which(as.logical(sapply(x, all.equal, target = 0.7)))


Best,
Dimitris

----
Dimitris Rizopoulos
Ph.D. Student
Biostatistical Centre
School of Public Health
Catholic University of Leuven

Address: Kapucijnenvoer 35, Leuven, Belgium
Tel: +32/(0)16/336899
Fax: +32/(0)16/337015
Web: http://med.kuleuven.be/biostat/
     http://www.student.kuleuven.be/~m0390867/dimitris.htm



> Again, maybe this is a bad thing...? In which case, I guess I'm 
> about to
> get told so... ;-)
>
> G
> -- 
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Gavin Simpson                 [t] +44 (0)20 7679 0522
> ECRC & ENSIS, UCL Geography,  [f] +44 (0)20 7679 0565
> Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/cv/
> London, UK. WC1E 6BT.         [w] http://www.ucl.ac.uk/~ucfagls/
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


Disclaimer: http://www.kuleuven.be/cwis/email_disclaimer.htm


From h.wickham at gmail.com  Fri Jul  7 14:08:42 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 7 Jul 2006 13:08:42 +0100
Subject: [Rd] Modifying parsed code
Message-ID: <f8e6ff050607070508h7fe3807fu739763f80a472be0@mail.gmail.com>

I would like to take this:

.img(plot(1:10), filename="a")

and produce

plot(1:10)

ie. whenever .img is used, I want to take the first argument and throw
away everything else.

(I am trying to produce a Sweave like environment in which I can apply
certain functions, but not have them displayed in the output)

I think I should be able to do it using substitute, but I don't know
how to operate on language objects.  Any hints would be appreciated.

Thanks,

Hadley


From mtmorgan at fhcrc.org  Fri Jul  7 14:37:32 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 07 Jul 2006 05:37:32 -0700
Subject: [Rd] often unnecessary duplicate in sapply / as.vector
Message-ID: <6phlkr5lhf7.fsf@gopher1.fhcrc.org>

sapply calls lapply as

    answer <- lapply(as.list(X), FUN, ...)

which, when X is a list, causes X to be duplicated unnecessarily. The
coercion is unnecessary for other mode(X) because in lapply we have

    if (!is.list(X)) X <- as.list(X)

More generally, perhaps as.vector might not duplicate when mode(x) == mode ?

Martin


R version 2.4.0 Under development (unstable) (2006-07-05 r38495) 
x86_64-unknown-linux-gnu 

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] "tools"     "methods"   "stats"     "graphics"  "grDevices" "utils"    
[7] "datasets"  "base"


From murdoch at stats.uwo.ca  Fri Jul  7 14:48:34 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Jul 2006 08:48:34 -0400
Subject: [Rd] Modifying parsed code
In-Reply-To: <f8e6ff050607070508h7fe3807fu739763f80a472be0@mail.gmail.com>
References: <f8e6ff050607070508h7fe3807fu739763f80a472be0@mail.gmail.com>
Message-ID: <44AE5822.4060605@stats.uwo.ca>

On 7/7/2006 8:08 AM, hadley wickham wrote:
> I would like to take this:
> 
> .img(plot(1:10), filename="a")
> 
> and produce
> 
> plot(1:10)
> 
> ie. whenever .img is used, I want to take the first argument and throw
> away everything else.
> 
> (I am trying to produce a Sweave like environment in which I can apply
> certain functions, but not have them displayed in the output)
> 
> I think I should be able to do it using substitute, but I don't know
> how to operate on language objects.  Any hints would be appreciated.

Supposing that .img has a header something like this:

.img <- function(input, filename)

what you would do is this:

expr <- substitute(input)  # now expr is the unevaluated expression
what <- deparse(expr)     # now what is a text representation of it
eval(expr, envir=parent.frame()) # this should produce the same result
				 # as evaluating input

Duncan Murdoch


From xenamaa at yahoo.com  Fri Jul  7 14:50:37 2006
From: xenamaa at yahoo.com (zana adeb)
Date: Fri, 7 Jul 2006 05:50:37 -0700 (PDT)
Subject: [Rd] Call R function from Java
Message-ID: <20060707125037.77447.qmail@web53104.mail.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060707/51743ce7/attachment.pl 

From ggrothendieck at gmail.com  Fri Jul  7 14:51:47 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 7 Jul 2006 08:51:47 -0400
Subject: [Rd] Modifying parsed code
In-Reply-To: <f8e6ff050607070508h7fe3807fu739763f80a472be0@mail.gmail.com>
References: <f8e6ff050607070508h7fe3807fu739763f80a472be0@mail.gmail.com>
Message-ID: <971536df0607070551l6cfe54aar19ce3c4c9850b749@mail.gmail.com>

Assuming the desired output is a character string try:

> f <- function(x) deparse(substitute(x))
> f(3+y)
[1] "3 + y"


On 7/7/06, hadley wickham <h.wickham at gmail.com> wrote:
> I would like to take this:
>
> .img(plot(1:10), filename="a")
>
> and produce
>
> plot(1:10)
>
> ie. whenever .img is used, I want to take the first argument and throw
> away everything else.
>
> (I am trying to produce a Sweave like environment in which I can apply
> certain functions, but not have them displayed in the output)
>
> I think I should be able to do it using substitute, but I don't know
> how to operate on language objects.  Any hints would be appreciated.
>
> Thanks,
>
> Hadley
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From h.wickham at gmail.com  Fri Jul  7 14:59:16 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 7 Jul 2006 13:59:16 +0100
Subject: [Rd] Modifying parsed code
In-Reply-To: <f8e6ff050607070508h7fe3807fu739763f80a472be0@mail.gmail.com>
References: <f8e6ff050607070508h7fe3807fu739763f80a472be0@mail.gmail.com>
Message-ID: <f8e6ff050607070559n5ddb20d1id26446f8e8a0769b@mail.gmail.com>

> I would like to take this:
>
> .img(plot(1:10), filename="a")
>
> and produce
>
> plot(1:10)
>

Peter Dalgaard provided me with this:

f <- function(e) {
 if (!is.recursive(e)) e
 else if (e[[1]] == quote(.img)) e[[2]]
 else as.call(lapply(e, f))
}

> f(quote({a<-1;.img(abc,123)}))
{
   a <- 1
   abc
}

which is exactly what I was looking for.  Thanks Peter!

Hadley


From ripley at stats.ox.ac.uk  Fri Jul  7 15:03:01 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 7 Jul 2006 14:03:01 +0100 (BST)
Subject: [Rd] Modifying parsed code
In-Reply-To: <f8e6ff050607070508h7fe3807fu739763f80a472be0@mail.gmail.com>
References: <f8e6ff050607070508h7fe3807fu739763f80a472be0@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0607071400060.22368@gannet.stats.ox.ac.uk>

On Fri, 7 Jul 2006, hadley wickham wrote:

> I would like to take this:
>
> .img(plot(1:10), filename="a")

I presume from your title that you want to take

foo <- parse(text='.img(plot(1:10), filename="a")')

?  That's an expression.  In which case

> foo[[1]][[2]]
plot(1:10)

(first expression which a call, and calls are symbol, arg1, arg2 ...).

>
> and produce
>
> plot(1:10)
>
> ie. whenever .img is used, I want to take the first argument and throw
> away everything else.
>
> (I am trying to produce a Sweave like environment in which I can apply
> certain functions, but not have them displayed in the output)
>
> I think I should be able to do it using substitute, but I don't know
> how to operate on language objects.  Any hints would be appreciated.
>
> Thanks,
>
> Hadley
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jmc at r-project.org  Fri Jul  7 15:10:52 2006
From: jmc at r-project.org (John Chambers)
Date: Fri, 07 Jul 2006 09:10:52 -0400
Subject: [Rd] attributes of environments
In-Reply-To: <971536df0607051928m5017cd35xba788618cc6a36dc@mail.gmail.com>
References: <971536df0607042012h43eb1581n418e9cddfe3a51bb@mail.gmail.com>
	<5062E054-F56C-42AA-A446-BC53628DC189@r-project.org>
	<971536df0607051123p6f0eaf6chc9e50cfc72b0fe51@mail.gmail.com>
	<44AC110B.90306@stats.uwo.ca>
	<971536df0607051247p7f30412bs45c6cf81dfc16949@mail.gmail.com>
	<44AC1E8D.4000602@stats.uwo.ca>
	<971536df0607051333s51010444vecb09453717413c2@mail.gmail.com>
	<44AC2684.7060104@stats.uwo.ca>
	<971536df0607051706r13dcba67q6773f9e35ddb98f1@mail.gmail.com>
	<44AC7054.3070001@stats.uwo.ca>
	<971536df0607051928m5017cd35xba788618cc6a36dc@mail.gmail.com>
Message-ID: <44AE5D5C.4090403@r-project.org>

Umm, maybe we should step back a bit here.

There are two points being made, both of which I think are reasonable, 
but they just don't happen to work together.

1.  Environments are special objects in R.  In fact they are the 
essential way directly in R to implement reference semantics.  Every 
object that has an environment (say, as a slot), has the same object.  
Much of R depends on this semantic property.

2.  For any "class" in the language, it would be useful to define a 
class that extends (contains) that class, but has additional properties.

The essential reason 2 conflicts with 1 for environments is that slots 
and other properties of objects are implemented as attributes, including 
class(x).  Attributes are implemented inside the struct that holds the 
object itself.  This means you can not have an object of another class 
that contains an environment, in the same way you would with a 
non-reference object, without wiping out properties of the "contained" 
object.

You do get told this, in the  simplest case anyway.  For example, 
suppose I want a class that acts like an environment but also has a slot 
"source" for some extra information:

 > setClass("e2", representation(source="character"), contains = 
"environment")
[1] "e2"
Warning message:
class "environment" cannot be used as the data part of another class in: 
reconcilePropertiesAndPrototype(name, slots, prototype, superClasses, 

and indeed the new class doesn't work as you would expect.

So the question is whether we want to enforce that limitation, in which 
case we probably need a stronger slap on the wrist, or whether we should 
consider a different implementation for this case, to allow the new 
class to inherit the properties of an environment, without violating the 
integrity of environments.  I kind of like the second approach, but only 
if it does not overly mess with the general approach to classes.


Gabor Grothendieck wrote:

>On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>  
>
>>On 7/5/2006 8:06 PM, Gabor Grothendieck wrote:
>>    
>>
>>>On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>      
>>>
>>>>On 7/5/2006 4:33 PM, Gabor Grothendieck wrote:
>>>>        
>>>>
>>>>>On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>>>          
>>>>>
>>>>>>On 7/5/2006 3:47 PM, Gabor Grothendieck wrote:
>>>>>>            
>>>>>>
>>>>>>>On 7/5/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>>>>>              
>>>>>>>
>>>>>>>>On 7/5/2006 2:23 PM, Gabor Grothendieck wrote:
>>>>>>>>
>>>>>>>>                
>>>>>>>>

<etc.>

>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>
>  
>


From simon.urbanek at r-project.org  Fri Jul  7 15:52:40 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 7 Jul 2006 09:52:40 -0400
Subject: [Rd] Call R function from Java
In-Reply-To: <20060707125037.77447.qmail@web53104.mail.yahoo.com>
References: <20060707125037.77447.qmail@web53104.mail.yahoo.com>
Message-ID: <1B6A26B0-3CD6-4B65-8A0E-FE780D06B231@r-project.org>


On Jul 7, 2006, at 8:50 AM, zana adeb wrote:

> Dear All,
>
>   I need to call R functions from Java, I've read on the internet  
> about JRI but there are no exemples, neither tutorials.

There are some basic examples in JRI/examples


>   I'm beginner in Java and in R,
>

JRI is a low-level interface, so may need to learn more about R.  
However, the experimental JRI 0.3 is getting some higher-level API  
and is available from http://www.rosuda.org/R/nightly/

Cheers,
Simon


From andy_liaw at merck.com  Fri Jul  7 16:26:24 2006
From: andy_liaw at merck.com (Liaw, Andy)
Date: Fri, 7 Jul 2006 10:26:24 -0400
Subject: [Rd] comment causes browser() to exit (PR#9063)
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFA02884A54@usctmx1106.merck.com>

If I'm not mistaken, this works as documented.  As an example (typed
directly into the Rgui console on WinXP):

R> f <- function() {
+     browser()
+     cat("I'm here!\n")
+     cat("I'm still here!\n")
+ }
R> f()
Called from: f()
Browse[1]> ## where to?
I'm here!
I'm still here!

which I think is what you saw.  However:

R> f()
Called from: f()
Browse[1]> n
debug: cat("I'm here!\n")
Browse[1]> ##
I'm here!
debug: cat("I'm still here!\n")
Browse[1]> 
I'm still here!

>From ?browser:

c
(or just return) exit the browser and continue execution at the next
statement. 
cont
synonym for c. 
n
enter the step-through debugger. This changes the meaning of c: see the
documentation for debug. 

My interpretation of this is that, if the first thing typed (or pasted) in
is something like a null statement (e.g., return, empty line, or comment),
it's the same as 'c', but if the null statement follows 'n', then it behaves
differently.

               _                         
platform       i386-pc-mingw32           
arch           i386                      
os             mingw32                   
system         i386, mingw32             
status                                   
major          2                         
minor          3.1                       
year           2006                      
month          06                        
day            01                        
svn rev        38247                     
language       R                         
version.string Version 2.3.1 (2006-06-01)


Andy


From: timh at insightful.com
> 
> I'm trying to step through some code using browser(), 
> executing one line at a time.
> Unfortunately, whenever I execute a comment line, the browser exits.
> 
> I previously reported a similar problem with blank lines.
> 
> These problems are a strong incentive to write poor code
> -- uncommented code with no blank lines to improve 
> readability -- so that I can use browser() without it exiting 
> at inconvenient times.
> 
> Additional detail:  
> (1) I'm running R inside emacs, with R in one buffer and a 
> file containing code in another, using a macro to copy and 
> paste a line at a time from the file to the R buffer.
> (2) The browser() call is inside a function.  
> Right now the lines I'm sending to the browser are not part 
> of the function, though usually they are.
> 
> 
> --please do not edit the information below--
> 
> Version:
>  platform = i386-pc-mingw32
>  arch = i386
>  os = mingw32
>  system = i386, mingw32
>  status =
>  major = 2
>  minor = 3.1
>  year = 2006
>  month = 06
>  day = 01
>  svn rev = 38247
>  language = R
>  version.string = Version 2.3.1 (2006-06-01)
> 
> Windows XP Professional (build 2600) Service Pack 2.0
> 
> Locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
> States.1252;LC_MONETARY=English_United 
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> Search Path:
>  .GlobalEnv, package:methods, package:stats, 
> package:graphics, package:grDevices, package:utils, 
> package:datasets, Autoloads, package:base
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From timh at insightful.com  Fri Jul  7 19:22:10 2006
From: timh at insightful.com (Tim Hesterberg)
Date: 7 Jul 2006 10:22:10 -0700
Subject: [Rd] comment causes browser() to exit (PR#9063)
In-Reply-To: <39B6DDB9048D0F4DAD42CB26AAFF0AFA02884A54@usctmx1106.merck.com>
	(andy_liaw@merck.com)
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA02884A54@usctmx1106.merck.com>
Message-ID: <SE2KEXCH012TRqf69aZ0000048f@se2kexch01.insightful.com>

>If I'm not mistaken, this works as documented.  ...

Thanks for the response.

The behavior with <return> is as documented -- hence my earlier
"enhancement" request.
The behavior with <a comment> is contrary to the documentation, hence
this as a "bug" report.

On the second point -- help(browser) says:
     Anything else entered at the browser prompt is interpreted as an R
     expression to be evaluated in the calling environment: ...
whereas the actual behavior is to interpret a comment as equivalent to "c",
and to exit the browser.

On the first point -- I would like to argue that the behavior of
return (and comments) should be changed, at least as a user option.
Here is a typical piece of code from a function; note the use of
comments and blank lines to improve readability:

  # If statistic isn't a function or name of function or expression,
  # store it as an expression to pass to fit.func.
  substitute.stat <- substitute(statistic)
  if(!is.element(mode(substitute.stat), c("name", "function")))
    statistic <- substitute.stat

  # Get name of data.
  data.name <- substitute(data)
  if(!is.name(data.name))
    data.name <- "data"
  is.df.data <- is.data.frame(data)

  # How many observations, or subjects if sampling by subject?
  n <- nObservations <- numRows(data)  # n will change later if by subject

  # Save group or subject arguments?
  if(is.null(save.subject)) save.subject <- (n <= 10000)
  if(is.null(save.group))   save.group   <- (n <= 10000)

If I now stick a browser() in that function, and throw a line at a
time from the source file to R, it exits whenever I throw a blank line
or comment.  I try to remember to skip the blank lines and comments,
but I sometimes forget, and get very annoyed when I have to start over.

I could use "c" in some contexts, but not others:
* I often want to evaluate code that is not part of the
  defined function.
* I sometimes change objects and want to go evaluate some lines
  that were previously evaluated.

In the enhancement request I requested an option to turn off the current
behavior of return.  I personally would just change the default behavior,
and have both blank lines and comments do nothing.  This is simpler, and
people can always use c to quit the browser.

This behavior of browser() is the most annoying thing I've found
about using R.  As I anticipate using R a lot in the future, I would
appreciate very much if it is changed.  I spent a fair amount of time
trying to see if I could change it myself, but gave up.

Tim Hesterberg

Andy Liaw wrote:
>If I'm not mistaken, this works as documented.  As an example (typed
>directly into the Rgui console on WinXP):
>
>R> f <- function() {
>+     browser()
>+     cat("I'm here!\n")
>+     cat("I'm still here!\n")
>+ }
>R> f()
>Called from: f()
>Browse[1]> ## where to?
>I'm here!
>I'm still here!
>
>which I think is what you saw.  However:
>
>R> f()
>Called from: f()
>Browse[1]> n
>debug: cat("I'm here!\n")
>Browse[1]> ##
>I'm here!
>debug: cat("I'm still here!\n")
>Browse[1]> 
>I'm still here!
>
>From ?browser:
>
>c
>(or just return) exit the browser and continue execution at the next
>statement. 
>cont
>synonym for c. 
>n
>enter the step-through debugger. This changes the meaning of c: see the
>documentation for debug. 
>
>My interpretation of this is that, if the first thing typed (or pasted) in
>is something like a null statement (e.g., return, empty line, or comment),
>it's the same as 'c', but if the null statement follows 'n', then it behaves
>differently.
>
>               _                         
>platform       i386-pc-mingw32           
>arch           i386                      
>os             mingw32                   
>system         i386, mingw32             
>status                                   
>major          2                         
>minor          3.1                       
>year           2006                      
>month          06                        
>day            01                        
>svn rev        38247                     
>language       R                         
>version.string Version 2.3.1 (2006-06-01)
>
>
>Andy
>
>
>From: timh at insightful.com
>> 
>> I'm trying to step through some code using browser(), 
>> executing one line at a time.
>> Unfortunately, whenever I execute a comment line, the browser exits.
>> 
>> I previously reported a similar problem with blank lines.
>> 
>> These problems are a strong incentive to write poor code
>> -- uncommented code with no blank lines to improve 
>> readability -- so that I can use browser() without it exiting 
>> at inconvenient times.
>> 
>> Additional detail:  
>> (1) I'm running R inside emacs, with R in one buffer and a 
>> file containing code in another, using a macro to copy and 
>> paste a line at a time from the file to the R buffer.
>> (2) The browser() call is inside a function.  
>> Right now the lines I'm sending to the browser are not part 
>> of the function, though usually they are.
>> 
>> 
>> --please do not edit the information below--
>> 
>> Version:
>>  platform = i386-pc-mingw32
>>  arch = i386
>>  os = mingw32
>>  system = i386, mingw32
>>  status =
>>  major = 2
>>  minor = 3.1
>>  year = 2006
>>  month = 06
>>  day = 01
>>  svn rev = 38247
>>  language = R
>>  version.string = Version 2.3.1 (2006-06-01)
>> 
>> Windows XP Professional (build 2600) Service Pack 2.0
>> 
>> Locale:
>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
>> States.1252;LC_MONETARY=English_United 
>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>> 
>> Search Path:
>>  .GlobalEnv, package:methods, package:stats, 
>> package:graphics, package:grDevices, package:utils, 
>> package:datasets, Autoloads, package:base
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>
>
>------------------------------------------------------------------------------
>Notice:  This e-mail message, together with any attachments...{{dropped}}


From vkwyau at gmail.com  Fri Jul  7 20:05:53 2006
From: vkwyau at gmail.com (Vincent Yau)
Date: Fri, 7 Jul 2006 11:05:53 -0700
Subject: [Rd] Call R function from Java
In-Reply-To: <1B6A26B0-3CD6-4B65-8A0E-FE780D06B231@r-project.org>
References: <20060707125037.77447.qmail@web53104.mail.yahoo.com>
	<1B6A26B0-3CD6-4B65-8A0E-FE780D06B231@r-project.org>
Message-ID: <f20482fc0607071105h618f15aft980a3b09d2e4c267@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060707/2bdb7d5a/attachment.pl 

From deepayan.sarkar at gmail.com  Fri Jul  7 20:58:34 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 7 Jul 2006 13:58:34 -0500
Subject: [Rd] possible bug in grid
Message-ID: <eb555e660607071158t26e7741cwd0bb1fc025f0e156@mail.gmail.com>

Hi,

?gpar says:

     Specifying the value 'NULL' for a parameter is the same as not
     specifying any value for that parameter, except for 'col' and
     'fill', where 'NULL' indicates not to draw a border or not to fill
     an area (respectively).

However, I get

> library(grid)
> grid.points(gp = gpar(font = 1)) # works fine
> grid.points(gp = gpar(font = 1, fontface = NULL))
Error in validGP(list(...)) : Must specify only one of 'font' and 'fontface'

This happens in 2.3.1 as well as r-devel.

Deepayan


From simon.urbanek at r-project.org  Fri Jul  7 21:38:28 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 7 Jul 2006 15:38:28 -0400
Subject: [Rd] Call R function from Java
In-Reply-To: <f20482fc0607071105h618f15aft980a3b09d2e4c267@mail.gmail.com>
References: <20060707125037.77447.qmail@web53104.mail.yahoo.com>
	<1B6A26B0-3CD6-4B65-8A0E-FE780D06B231@r-project.org>
	<f20482fc0607071105h618f15aft980a3b09d2e4c267@mail.gmail.com>
Message-ID: <1D19ABC5-BD9A-4280-BD16-383DD06B862F@r-project.org>


On Jul 7, 2006, at 2:05 PM, Vincent Yau wrote:

> Simon:
>
> Would JRI able to also invoke stuff from R packages that I have  
> installed?
> (e.g  Bioconductor)
>

Of course. JRI starts the same R as the RGUI or R console. R is run  
as one thread in your Java application. Depending on the platform,  
packages or libraries that assume to be run in a single-threaded  
environment may cause problems, but I haven't see such examples in  
practice (yet?).

Cheers,
Simon


From tlumley at u.washington.edu  Sat Jul  8 02:04:40 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Fri, 7 Jul 2006 17:04:40 -0700 (PDT)
Subject: [Rd] often unnecessary duplicate in sapply / as.vector
In-Reply-To: <6phlkr5lhf7.fsf@gopher1.fhcrc.org>
References: <6phlkr5lhf7.fsf@gopher1.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0607071652450.9075@homer23.u.washington.edu>

On Fri, 7 Jul 2006, Martin Morgan wrote:

> sapply calls lapply as
>
>    answer <- lapply(as.list(X), FUN, ...)
>
> which, when X is a list, causes X to be duplicated unnecessarily. The
> coercion is unnecessary for other mode(X) because in lapply we have
>
>    if (!is.list(X)) X <- as.list(X)

That looks reasonable.

> More generally, perhaps as.vector might not duplicate when mode(x) == mode ?
>

This isn't a trivial change, because  mode(x)==mode does not guarantee 
that as.vector(x, mode) has no effect.  For example, with mode="numeric" it 
removes attributes.


         -thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ggrothendieck at gmail.com  Sun Jul  9 19:38:23 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 9 Jul 2006 13:38:23 -0400
Subject: [Rd] [R] string problems with "\\" (Windows)
In-Reply-To: <44B1380C.8080103@stats.uwo.ca>
References: <05bd01c6a378$5f764fb0$6600a8c0@DD4XFW31>
	<44B1380C.8080103@stats.uwo.ca>
Message-ID: <971536df0607091038l29c9d2a2xc518b80eeed71be0@mail.gmail.com>

Moved to r-devel.

Perhaps basename should take an optional separator argument
so that

   basename(x, "\\")

could be used to override the default behavior.

On 7/9/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> basename() works.  If you're on a system that doesn't think \\ is a path
> separator, you could do something like
>
> x <- "C:\\Documents and Settings\\myName\\My
> Documents\\RProjects\\Project1\\file.name.csv"
> basename(gsub('\\\\','/',x))
>
> Duncan Murdoch
>
> Charles Annis, P.E. wrote:
> > Greetings, R-ians:
> >
> > I'm using R 2.3.1 on WindowsXP.
> >
> > I need to find the name of a file at the end of a sting that contains the
> > path + file, with the problematic "\\" as separators.
> >
> > The string looks something like this:
> >
> > "C:\\Documents and Settings\\myName\\My Documents\\R
> > Projects\\Project1\\file.name.csv"
> >
> > What I want is "file.name.csv"
> >
> > Currently I use the name of the project as the splitter in
> >
> > strsplit(string.name, split="Project1", extended = FALSE)
> >
> > This works, of course, but I won't always be using folder Project1, so I
> > need a more universal way to find the name of a file at the end of a string
> > with "\\" separators.
> >
> > Can I get there from here?  (I've looked through previous R-help listing of
> > similar problems but if it's there, I missed it.)
> >
> > Thanks.
> >
> >
> > Charles Annis, P.E.
> >
> > Charles.Annis at StatisticalEngineering.com
> > phone: 561-352-9699
> > eFax:  614-455-3265
> > http://www.StatisticalEngineering.com
> >
> >
> > ______________________________________________
> > R-help at stat.math.ethz.ch mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide! http://www.R-project.org/posting-guide.html
> >
>
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide! http://www.R-project.org/posting-guide.html
>


From chris at psyctc.org  Sun Jul  9 19:40:39 2006
From: chris at psyctc.org (chris at psyctc.org)
Date: Sun,  9 Jul 2006 19:40:39 +0200 (CEST)
Subject: [Rd] vignette("introduction") causes "Error in sprintf(" (PR#9069)
Message-ID: <20060709174039.B9DCC54ACE@slim.kubism.ku.dk>

Full_Name: Chris Evans
Version: 2.3.1
OS: Windoze XP
Submission from: (NULL) (217.34.100.197)


If I give "vignette("introduction")" I get: 
  Error in sprintf(gettext(fmt, domain = domain), ...) : 
        use format %s for character objects

vignette() works for some other vignettes and "vignette()" gets me a list of
vignettes and shows three with the name "introduction" (on my package
collection).  I don't know if that's related to this.  

Happy to try anything you want done (except perhaps trying to install the
bleeding edge version of R!)

Chris


From ggrothendieck at gmail.com  Sun Jul  9 20:02:53 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 9 Jul 2006 14:02:53 -0400
Subject: [Rd] vignette("introduction") causes "Error in sprintf("
	(PR#9069)
In-Reply-To: <20060709174039.B9DCC54ACE@slim.kubism.ku.dk>
References: <20060709174039.B9DCC54ACE@slim.kubism.ku.dk>
Message-ID: <971536df0607091102g27205555m64b8e572ec8c0b6d@mail.gmail.com>

Same for me.  Looking through the output of vignette
I noticed that both the ggplot and reshape packages have
a vignette called "introduction" in my case and either of
the following brings up the associated vignette (as opposed
to the error message):

vignette("introduction", "ggplot")
vignette("introduction", "reshape")


On 7/9/06, chris at psyctc.org <chris at psyctc.org> wrote:
> Full_Name: Chris Evans
> Version: 2.3.1
> OS: Windoze XP
> Submission from: (NULL) (217.34.100.197)
>
>
> If I give "vignette("introduction")" I get:
>  Error in sprintf(gettext(fmt, domain = domain), ...) :
>        use format %s for character objects
>
> vignette() works for some other vignettes and "vignette()" gets me a list of
> vignettes and shows three with the name "introduction" (on my package
> collection).  I don't know if that's related to this.
>
> Happy to try anything you want done (except perhaps trying to install the
> bleeding edge version of R!)
>
> Chris
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From chris at psyctc.org  Sun Jul  9 20:21:25 2006
From: chris at psyctc.org (Chris Evans)
Date: Sun, 09 Jul 2006 19:21:25 +0100
Subject: [Rd] vignette("introduction") causes "Error in sprintf("
	(PR#9069)
In-Reply-To: <971536df0607091102g27205555m64b8e572ec8c0b6d@mail.gmail.com>
References: <20060709174039.B9DCC54ACE@slim.kubism.ku.dk>
	<971536df0607091102g27205555m64b8e572ec8c0b6d@mail.gmail.com>
Message-ID: <44B14925.4020800@psyctc.org>

Gabor Grothendieck sent the following  at 09/07/2006 19:02:
> Same for me.  Looking through the output of vignette
> I noticed that both the ggplot and reshape packages have
> a vignette called "introduction" in my case and either of
> the following brings up the associated vignette (as opposed
> to the error message):
> 
> vignette("introduction", "ggplot")
> vignette("introduction", "reshape")

Aha, works for me too.  Sorry, I probably should have been able to work
that out myself.

So: not so much a bug, more a wish as it might be good if the vignette
code checked for multiple vignettes with the same name and returned a
choice or a message warning you that there are multiples.  Should I do a
follow-up to that bug?

Many thanks to you and all for R: incredible resource.

Chris

-- 
Chris Evans <chris at psyctc.org>
Professor of Psychotherapy, Nottingham University;
Consultant Psychiatrist in Psychotherapy, Rampton Hospital;
Research Programmes Director, Nottinghamshire NHS Trust;
Hon. SL Institute of Psychiatry, Hon. Con., Tavistock & Portman Trust
**If I am writing from one of those roles, it will be clear. Otherwise**

**my views are my own and not representative of those institutions    **


From ggrothendieck at gmail.com  Sun Jul  9 22:27:33 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 9 Jul 2006 16:27:33 -0400
Subject: [Rd] vignette("introduction") causes "Error in sprintf("
	(PR#9069)
In-Reply-To: <44B14925.4020800@psyctc.org>
References: <20060709174039.B9DCC54ACE@slim.kubism.ku.dk>
	<971536df0607091102g27205555m64b8e572ec8c0b6d@mail.gmail.com>
	<44B14925.4020800@psyctc.org>
Message-ID: <971536df0607091327m2a07c8ddi43e1218cc8f818a0@mail.gmail.com>

If there are no other instances of multiple vignettes with the same
name perhaps the fastest solution is just for the author of those
two vignettes to change them to each be unique.

On 7/9/06, Chris Evans <chris at psyctc.org> wrote:
> Gabor Grothendieck sent the following  at 09/07/2006 19:02:
> > Same for me.  Looking through the output of vignette
> > I noticed that both the ggplot and reshape packages have
> > a vignette called "introduction" in my case and either of
> > the following brings up the associated vignette (as opposed
> > to the error message):
> >
> > vignette("introduction", "ggplot")
> > vignette("introduction", "reshape")
>
> Aha, works for me too.  Sorry, I probably should have been able to work
> that out myself.
>
> So: not so much a bug, more a wish as it might be good if the vignette
> code checked for multiple vignettes with the same name and returned a
> choice or a message warning you that there are multiples.  Should I do a
> follow-up to that bug?
>
> Many thanks to you and all for R: incredible resource.
>
> Chris
>
> --
> Chris Evans <chris at psyctc.org>
> Professor of Psychotherapy, Nottingham University;
> Consultant Psychiatrist in Psychotherapy, Rampton Hospital;
> Research Programmes Director, Nottinghamshire NHS Trust;
> Hon. SL Institute of Psychiatry, Hon. Con., Tavistock & Portman Trust
> **If I am writing from one of those roles, it will be clear. Otherwise**
>
> **my views are my own and not representative of those institutions    **
>


From huber at ebi.ac.uk  Sun Jul  9 23:04:29 2006
From: huber at ebi.ac.uk (huber at ebi.ac.uk)
Date: Sun,  9 Jul 2006 23:04:29 +0200 (CEST)
Subject: [Rd] Unexpected difference in Bounding Box of PDF graphics between
	2.3.1p and 2.4 (PR#9070)
Message-ID: <20060709210429.40D63507AF@slim.kubism.ku.dk>

Full_Name: Wolfgang Huber
Version: R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
OS: i686-pc-linux-gnu     
Submission from: (NULL) (62.253.128.15)


There appears to be unintentional behaviour in the size of the bounding box for
PDF graphics produced with the current R2.4, compared to 2.3.1. I posted two PDF
files, both produced with the same R script below, but different versions of R:
http://www.ebi.ac.uk/~huber/pub

The code is here:


pdf(file=sprintf("test-%s.pdf", version$"svn rev"), width=4, height=4)
par(mai=par("mai")[rep(1:2,2)])
x = seq(0, 10*pi, length=3000)
plot(x*cbind(sin(x),cos(x)), type="l", col="mistyrose", lwd=3)

sink(textConnection("s", "w"))
options(width=40)
print(sessionInfo(), width=30)
sink()

text(-30, 30-4*seq(along=s), s, adj=c(0,0.5), cex=0.7) 
dev.off()



and one of the differences between the resulting PDF files is:
test-38323.pdf: /MediaBox [0 0 288 288]
test-38523.pdf: /MediaBox [0 0 595 841]

The former corresponds to 4x4 inches, the latter to 21cm x 29.67cm.


From murdoch at stats.uwo.ca  Mon Jul 10 00:12:12 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 09 Jul 2006 18:12:12 -0400
Subject: [Rd] [R] string problems with "\\" (Windows)
In-Reply-To: <971536df0607091038l29c9d2a2xc518b80eeed71be0@mail.gmail.com>
References: <05bd01c6a378$5f764fb0$6600a8c0@DD4XFW31>	<44B1380C.8080103@stats.uwo.ca>
	<971536df0607091038l29c9d2a2xc518b80eeed71be0@mail.gmail.com>
Message-ID: <44B17F3C.6090206@stats.uwo.ca>

Gabor Grothendieck wrote:
> Moved to r-devel.
>
> Perhaps basename should take an optional separator argument
> so that
>
>    basename(x, "\\")
>
> could be used to override the default behavior.
>   

That seems like a reasonable idea, but not very high priority.  Anyone 
want to contribute a patch (to the source and man page)?

Duncan Murdoch
> On 7/9/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>   
>> basename() works.  If you're on a system that doesn't think \\ is a path
>> separator, you could do something like
>>
>> x <- "C:\\Documents and Settings\\myName\\My
>> Documents\\RProjects\\Project1\\file.name.csv"
>> basename(gsub('\\\\','/',x))
>>
>> Duncan Murdoch
>>
>> Charles Annis, P.E. wrote:
>>     
>>> Greetings, R-ians:
>>>
>>> I'm using R 2.3.1 on WindowsXP.
>>>
>>> I need to find the name of a file at the end of a sting that contains the
>>> path + file, with the problematic "\\" as separators.
>>>
>>> The string looks something like this:
>>>
>>> "C:\\Documents and Settings\\myName\\My Documents\\R
>>> Projects\\Project1\\file.name.csv"
>>>
>>> What I want is "file.name.csv"
>>>
>>> Currently I use the name of the project as the splitter in
>>>
>>> strsplit(string.name, split="Project1", extended = FALSE)
>>>
>>> This works, of course, but I won't always be using folder Project1, so I
>>> need a more universal way to find the name of a file at the end of a string
>>> with "\\" separators.
>>>
>>> Can I get there from here?  (I've looked through previous R-help listing of
>>> similar problems but if it's there, I missed it.)
>>>
>>> Thanks.
>>>
>>>
>>> Charles Annis, P.E.
>>>
>>> Charles.Annis at StatisticalEngineering.com
>>> phone: 561-352-9699
>>> eFax:  614-455-3265
>>> http://www.StatisticalEngineering.com
>>>
>>>
>>> ______________________________________________
>>> R-help at stat.math.ethz.ch mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide! http://www.R-project.org/posting-guide.html
>>>
>>>       
>> ______________________________________________
>> R-help at stat.math.ethz.ch mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide! http://www.R-project.org/posting-guide.html
>>
>>     
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Friedrich.Leisch at stat.uni-muenchen.de  Mon Jul 10 12:28:35 2006
From: Friedrich.Leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Mon, 10 Jul 2006 12:28:35 +0200
Subject: [Rd] vignette("introduction") causes "Error in sprintf("
	(PR#9069)
In-Reply-To: <44B14925.4020800@psyctc.org>
References: <20060709174039.B9DCC54ACE@slim.kubism.ku.dk>
	<971536df0607091102g27205555m64b8e572ec8c0b6d@mail.gmail.com>
	<44B14925.4020800@psyctc.org>
Message-ID: <17586.11219.484965.351102@celebrian.ci.tuwien.ac.at>

>>>>> On Sun, 09 Jul 2006 19:21:25 +0100,
>>>>> Chris Evans (CE) wrote:

  > Gabor Grothendieck sent the following  at 09/07/2006 19:02:
  >> Same for me.  Looking through the output of vignette
  >> I noticed that both the ggplot and reshape packages have
  >> a vignette called "introduction" in my case and either of
  >> the following brings up the associated vignette (as opposed
  >> to the error message):
  >> 
  >> vignette("introduction", "ggplot")
  >> vignette("introduction", "reshape")

  > Aha, works for me too.  Sorry, I probably should have been able to work
  > that out myself.

  > So: not so much a bug, more a wish as it might be good if the vignette
  > code checked for multiple vignettes with the same name and returned a
  > choice or a message warning you that there are multiples.


A simple traceback shows that the bug was actually in code trying
to do exactly what you suggest ;-)

R> vignette("introduction")
Error in sprintf(gettext(fmt, domain = domain), ...) : 
	use format %s for character objects
R> traceback()
4: sprintf(gettext(fmt, domain = domain), ...)
3: gettextf("vignette '%d' found more than once,\nusing the one found in '%s'", 
       topic, dirname(pdf[idx]))
2: warning(gettextf("vignette '%d' found more than once,\nusing the one found in '%s'", 
       topic, dirname(pdf[idx])), call. = FALSE, domain = NA)
1: vignette("introduction")



Fixed now in both r-patched and r-devel.

Fritz


From maechler at stat.math.ethz.ch  Mon Jul 10 12:30:44 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 10 Jul 2006 12:30:44 +0200
Subject: [Rd] validObject() -> slow down ?! [was "package:Matrix handling
	..."]
In-Reply-To: <D91C1AE1-9352-4D87-8D29-210F9AED0060@ysidro.econ.uiuc.edu>
References: <0C6BF3FC506F664F90C8BA3E0160462D04A75890@EXCHANGE3.ad.uams.edu>
	<40e66e0b0607090906u21db4786qcab1b25a37cdcac2@mail.gmail.com>
	<D91C1AE1-9352-4D87-8D29-210F9AED0060@ysidro.econ.uiuc.edu>
Message-ID: <17586.11348.823359.946021@stat.math.ethz.ch>

[Diverted from R-help to R-devel]

>>>>> "roger" == roger koenker <roger at ysidro.econ.uiuc.edu>
>>>>>     on Sun, 9 Jul 2006 12:31:16 -0500 writes:

    >>
    roger> On 7/8/06, Thaden, John J <ThadenJohnJ at uams.edu>
    roger> wrote:

    >> As there is nothing inherent in either compressed,
    >> sparse, format that would prevent recognition and
    >> handling of duplicated index pairs, I'm curious why the
    >> dgCMatrix class doesn't also add x values in those
    >> instances?

    roger> why not multiply them?  or take the larger one, or
    roger> ...?  I would interpret this as a case of user
    roger> negligence -- there is no "natural" default behavior
    roger> for such cases.

    roger> On Jul 9, 2006, at 11:06 AM, Douglas Bates wrote:

    >> Your matrix Mc should be flagged as invalid.  Martin and
    >> I should discuss whether we want to add such a test to
    >> the validity method.  It is not difficult to add the test
    >> but there will be a penalty in that it will slow down all
    >> operations on such matrices 

hmm, maybe "all operations" is slightly pessimistic.
The issue seems to be *when* (under what exact circumstances)
the 'validity' method for a class will be called, i.e., when the
equivalent of  validObject(<obj>) should be called automatically.

We (those from R-core present) discussed this question a
bit last summer in Seattle, and we had a proposal by Robert Gentleman,
that this should both be better defined and documented and also
slightly changed -- such that validObject() is called less
frequently.

IIRC, one consequence of that is the 'complete = FALSE' default
that  validObject() has got in the mean time.  But I don't know
about the other issue, of ensuring (or not) that validObject()
is not called too often.

I wonder if we should consider a new optional argument to
new(..) [ well actuallly,  initialize() ] :

the default  new(.....,  .check.validity = TRUE)
would call {the equivalent of} validObject() after object
creation, but one could always explicitly use
	  new(.....,  .check.validity = FALSE)
for fast "but dangerous" objet creation.
   
    >> and I'm not sure if we want to pay that price to catch a
    >> rather infrequently occuring problem.

    roger> Elaborating the validity procedure to flag such
    roger> instances seems to be well worth the speed penalty in
    roger> my view.  Of course, anticipating every such misstep
    roger> imposes a heavy burden on developers and constitutes
    roger> the real "cost" of more elaborate validity checking.

At the moment I tend to agree with Roger that we (Matrix
authors) should try to add more stringent testing even at some
cost --- particularly if that penalty would only occur at object
creation time. One important "use case" of our sparse matrices
of course are lmer() calls. They shouldn't become slower noticably.

    roger> [My 2cents based on experience with SparseM.]

Martin


From hin-tak.leung at cimr.cam.ac.uk  Mon Jul 10 13:02:33 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 10 Jul 2006 12:02:33 +0100
Subject: [Rd] Unexpected difference in Bounding Box of PDF graphics
 between 2.3.1p and 2.4 (PR#9070)
In-Reply-To: <20060709210429.40D63507AF@slim.kubism.ku.dk>
References: <20060709210429.40D63507AF@slim.kubism.ku.dk>
Message-ID: <44B233C9.1060301@cimr.cam.ac.uk>

huber at ebi.ac.uk wrote:
> Full_Name: Wolfgang Huber
> Version: R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
> OS: i686-pc-linux-gnu     
> Submission from: (NULL) (62.253.128.15)
> 
> 
> There appears to be unintentional behaviour in the size of the bounding box for
> PDF graphics produced with the current R2.4, compared to 2.3.1. I posted two PDF
> files, both produced with the same R script below, but different versions of R:
> http://www.ebi.ac.uk/~huber/pub
> 
> The code is here:
> 
> 
> pdf(file=sprintf("test-%s.pdf", version$"svn rev"), width=4, height=4)
> par(mai=par("mai")[rep(1:2,2)])
> x = seq(0, 10*pi, length=3000)
> plot(x*cbind(sin(x),cos(x)), type="l", col="mistyrose", lwd=3)
> 
> sink(textConnection("s", "w"))
> options(width=40)
> print(sessionInfo(), width=30)
> sink()
> 
> text(-30, 30-4*seq(along=s), s, adj=c(0,0.5), cex=0.7) 
> dev.off()
> 
> 
> 
> and one of the differences between the resulting PDF files is:
> test-38323.pdf: /MediaBox [0 0 288 288]
> test-38523.pdf: /MediaBox [0 0 595 841]
> 
> The former corresponds to 4x4 inches, the latter to 21cm x 29.67cm.

[0 0 595 842] is A4 size. Probably a default taken from something.


From hin-tak.leung at cimr.cam.ac.uk  Mon Jul 10 12:58:36 2006
From: hin-tak.leung at cimr.cam.ac.uk (hin-tak.leung at cimr.cam.ac.uk)
Date: Mon, 10 Jul 2006 12:58:36 +0200 (CEST)
Subject: [Rd] Unexpected difference in Bounding Box of PDF graphics
	between (PR#9072)
Message-ID: <20060710105836.D606854AC7@slim.kubism.ku.dk>

huber at ebi.ac.uk wrote:
> Full_Name: Wolfgang Huber
> Version: R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
> OS: i686-pc-linux-gnu     
> Submission from: (NULL) (62.253.128.15)
> 
> 
> There appears to be unintentional behaviour in the size of the bounding box for
> PDF graphics produced with the current R2.4, compared to 2.3.1. I posted two PDF
> files, both produced with the same R script below, but different versions of R:
> http://www.ebi.ac.uk/~huber/pub
> 
> The code is here:
> 
> 
> pdf(file=sprintf("test-%s.pdf", version$"svn rev"), width=4, height=4)
> par(mai=par("mai")[rep(1:2,2)])
> x = seq(0, 10*pi, length=3000)
> plot(x*cbind(sin(x),cos(x)), type="l", col="mistyrose", lwd=3)
> 
> sink(textConnection("s", "w"))
> options(width=40)
> print(sessionInfo(), width=30)
> sink()
> 
> text(-30, 30-4*seq(along=s), s, adj=c(0,0.5), cex=0.7) 
> dev.off()
> 
> 
> 
> and one of the differences between the resulting PDF files is:
> test-38323.pdf: /MediaBox [0 0 288 288]
> test-38523.pdf: /MediaBox [0 0 595 841]
> 
> The former corresponds to 4x4 inches, the latter to 21cm x 29.67cm.

[0 0 595 842] is A4 size. Probably a default taken from something.


From ripley at stats.ox.ac.uk  Mon Jul 10 13:38:41 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Jul 2006 12:38:41 +0100 (BST)
Subject: [Rd] Unexpected difference in Bounding Box of PDF graphics
 between 2.3.1p and 2.4 (PR#9070)
In-Reply-To: <44B233C9.1060301@cimr.cam.ac.uk>
References: <20060709210429.40D63507AF@slim.kubism.ku.dk>
	<44B233C9.1060301@cimr.cam.ac.uk>
Message-ID: <Pine.LNX.4.64.0607101236200.26846@gannet.stats.ox.ac.uk>

This is already fixed.

There is no such thing as '2.4', nor does PDF have a bounding box!

The issue was that for a short while the paper size of pdf() was 
defaulting to "default", the same as postscript() (and this was 
intentional).  It is now the previous default of "special", and setting
paper="special" always worked.

On Mon, 10 Jul 2006, Hin-Tak Leung wrote:

> huber at ebi.ac.uk wrote:
>> Full_Name: Wolfgang Huber
>> Version: R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
>> OS: i686-pc-linux-gnu
>> Submission from: (NULL) (62.253.128.15)
>>
>>
>> There appears to be unintentional behaviour in the size of the bounding box for
>> PDF graphics produced with the current R2.4, compared to 2.3.1. I posted two PDF
>> files, both produced with the same R script below, but different versions of R:
>> http://www.ebi.ac.uk/~huber/pub
>>
>> The code is here:
>>
>>
>> pdf(file=sprintf("test-%s.pdf", version$"svn rev"), width=4, height=4)
>> par(mai=par("mai")[rep(1:2,2)])
>> x = seq(0, 10*pi, length=3000)
>> plot(x*cbind(sin(x),cos(x)), type="l", col="mistyrose", lwd=3)
>>
>> sink(textConnection("s", "w"))
>> options(width=40)
>> print(sessionInfo(), width=30)
>> sink()
>>
>> text(-30, 30-4*seq(along=s), s, adj=c(0,0.5), cex=0.7)
>> dev.off()
>>
>>
>>
>> and one of the differences between the resulting PDF files is:
>> test-38323.pdf: /MediaBox [0 0 288 288]
>> test-38523.pdf: /MediaBox [0 0 595 841]
>>
>> The former corresponds to 4x4 inches, the latter to 21cm x 29.67cm.
>
> [0 0 595 842] is A4 size. Probably a default taken from something.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Jul 10 13:44:10 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Jul 2006 12:44:10 +0100 (BST)
Subject: [Rd] Unexpected difference in Bounding Box of PDF graphics
 between (PR#9072)
In-Reply-To: <20060710105836.D606854AC7@slim.kubism.ku.dk>
References: <20060710105836.D606854AC7@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0607101238530.26846@gannet.stats.ox.ac.uk>

Please take great care not to start a new bug report when commenting on an 
old one, as you have done here.  It really makes a mess of the records on 
the repository.  (Ensure that the PR# item appears on the first line.)

We do suggest quite strongly that people do not send reports on 
R-devel to R-bugs, as it is often `under development' as here.  If you 
want to comment on R-devel, do make sure you are using the 
up-to-the-minute version, and use the R-devel list.


On Mon, 10 Jul 2006, hin-tak.leung at cimr.cam.ac.uk wrote:

> huber at ebi.ac.uk wrote:
>> Full_Name: Wolfgang Huber
>> Version: R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
>> OS: i686-pc-linux-gnu
>> Submission from: (NULL) (62.253.128.15)
>>
>>
>> There appears to be unintentional behaviour in the size of the bounding box for
>> PDF graphics produced with the current R2.4, compared to 2.3.1. I posted two PDF
>> files, both produced with the same R script below, but different versions of R:
>> http://www.ebi.ac.uk/~huber/pub
>>
>> The code is here:
>>
>>
>> pdf(file=sprintf("test-%s.pdf", version$"svn rev"), width=4, height=4)
>> par(mai=par("mai")[rep(1:2,2)])
>> x = seq(0, 10*pi, length=3000)
>> plot(x*cbind(sin(x),cos(x)), type="l", col="mistyrose", lwd=3)
>>
>> sink(textConnection("s", "w"))
>> options(width=40)
>> print(sessionInfo(), width=30)
>> sink()
>>
>> text(-30, 30-4*seq(along=s), s, adj=c(0,0.5), cex=0.7)
>> dev.off()
>>
>>
>>
>> and one of the differences between the resulting PDF files is:
>> test-38323.pdf: /MediaBox [0 0 288 288]
>> test-38523.pdf: /MediaBox [0 0 595 841]
>>
>> The former corresponds to 4x4 inches, the latter to 21cm x 29.67cm.
>
> [0 0 595 842] is A4 size. Probably a default taken from something.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jmc at r-project.org  Mon Jul 10 14:40:08 2006
From: jmc at r-project.org (John Chambers)
Date: Mon, 10 Jul 2006 08:40:08 -0400
Subject: [Rd] validObject() -> slow down ?! [was "package:Matrix
 handling ..."]
In-Reply-To: <17586.11348.823359.946021@stat.math.ethz.ch>
References: <0C6BF3FC506F664F90C8BA3E0160462D04A75890@EXCHANGE3.ad.uams.edu>
	<40e66e0b0607090906u21db4786qcab1b25a37cdcac2@mail.gmail.com>
	<D91C1AE1-9352-4D87-8D29-210F9AED0060@ysidro.econ.uiuc.edu>
	<17586.11348.823359.946021@stat.math.ethz.ch>
Message-ID: <44B24AA8.6030501@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060710/26549b25/attachment.pl 

From huber at ebi.ac.uk  Mon Jul 10 14:47:44 2006
From: huber at ebi.ac.uk (Wolfgang Huber)
Date: Mon, 10 Jul 2006 13:47:44 +0100
Subject: [Rd] Unexpected difference in Bounding Box of PDF graphics
 between 2.3.1p and 2.4 (PR#9070)
In-Reply-To: <Pine.LNX.4.64.0607101236200.26846@gannet.stats.ox.ac.uk>
References: <20060709210429.40D63507AF@slim.kubism.ku.dk>
	<44B233C9.1060301@cimr.cam.ac.uk>
	<Pine.LNX.4.64.0607101236200.26846@gannet.stats.ox.ac.uk>
Message-ID: <44B24C70.2040405@ebi.ac.uk>

Dear Prof Ripley,

> There is no such thing as '2.4', 

Can we forward this information to the author of "sessionInfo()",
"version", and R's welcome message, this is where I took that from.

nor does PDF have a bounding box!

Yup, sorry for my imprecise language, I don't understand much of PDF,
just noted the different appearance of the plots.

Thanks for the quick fix (and all the other contributions), this really
helps.

Best wishes
 Wolfgang Huber

------------------------------------------------------------------
Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber


From ripley at stats.ox.ac.uk  Mon Jul 10 15:03:45 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Jul 2006 14:03:45 +0100 (BST)
Subject: [Rd] Unexpected difference in Bounding Box of PDF graphics
 between 2.3.1p and 2.4 (PR#9070)
In-Reply-To: <44B24C70.2040405@ebi.ac.uk>
References: <20060709210429.40D63507AF@slim.kubism.ku.dk>
	<44B233C9.1060301@cimr.cam.ac.uk>
	<Pine.LNX.4.64.0607101236200.26846@gannet.stats.ox.ac.uk>
	<44B24C70.2040405@ebi.ac.uk>
Message-ID: <Pine.LNX.4.64.0607101401170.673@gannet.stats.ox.ac.uk>

On Mon, 10 Jul 2006, Wolfgang Huber wrote:

> Dear Prof Ripley,
>
>> There is no such thing as '2.4',
>
> Can we forward this information to the author of "sessionInfo()",
> "version", and R's welcome message, this is where I took that from.

I get

R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
           ^^^^^^^^^^^^^^^^^^^^^^^

and the R posting guide makes the same point: it is 2.3.0, not 2.3.

> nor does PDF have a bounding box!
>
> Yup, sorry for my imprecise language, I don't understand much of PDF,
> just noted the different appearance of the plots.
>
> Thanks for the quick fix (and all the other contributions), this really
> helps.
>
> Best wishes
> Wolfgang Huber
>
> ------------------------------------------------------------------
> Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From chris at psyctc.org  Mon Jul 10 15:44:50 2006
From: chris at psyctc.org (Chris Evans)
Date: Mon, 10 Jul 2006 14:44:50 +0100
Subject: [Rd] vignette("introduction") causes "Error in sprintf("
	(PR#9069)
In-Reply-To: <17586.11219.484965.351102@celebrian.ci.tuwien.ac.at>
References: <20060709174039.B9DCC54ACE@slim.kubism.ku.dk>	<971536df0607091102g27205555m64b8e572ec8c0b6d@mail.gmail.com>	<44B14925.4020800@psyctc.org>
	<17586.11219.484965.351102@celebrian.ci.tuwien.ac.at>
Message-ID: <44B259D2.5060306@psyctc.org>

Friedrich Leisch sent the following  at 10/07/2006 11:28:

... some snipped ...

> Fixed now in both r-patched and r-devel.
> 
> Fritz
> 

Wow, wonderful, thanks.  My first ever R bug report resolved and closed
in a weekend.  Stunning.

C

-- 
Chris Evans <chris at psyctc.org>
Professor of Psychotherapy, Nottingham University;
Consultant Psychiatrist in Psychotherapy, Rampton Hospital;
Research Programmes Director, Nottinghamshire NHS Trust;
Hon. SL Institute of Psychiatry, Hon. Con., Tavistock & Portman Trust
**If I am writing from one of those roles, it will be clear. Otherwise**

**my views are my own and not representative of those institutions    **


From sfalcon at fhcrc.org  Mon Jul 10 21:02:32 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Mon, 10 Jul 2006 12:02:32 -0700
Subject: [Rd] Add .git to SCM excludes for build and INSTALL scripts
Message-ID: <m2irm5th9z.fsf@fhcrc.org>

Git is a source code management system like CVS, svn, arch, and
others.  

It would be nice to add exclude support to R CMD build and INSTALL so
that the .git subdir of an R package is handled appropriately.

Here is a possible patch:

diff --git a/src/scripts/INSTALL.in b/src/scripts/INSTALL.in
index 75da9db..09e5ab5 100644
--- a/src/scripts/INSTALL.in
+++ b/src/scripts/INSTALL.in
@@ -863,7 +863,7 @@ do_install_source () {
   ## When installing from a source directory under version control, we
   ## should really exclude the subdirs CVS, .svn (Subversion) and
   ## .arch-ids (arch).
-  for d in CVS .svn .arch-ids; do
+  for d in CVS .svn .arch-ids .git; do
     find "${R_PACKAGE_DIR}" -name ${d} -type d -prune \
       -exec rm -rf \{\} \; 2>/dev/null
   done
diff --git a/src/scripts/build.in b/src/scripts/build.in
index 15c9e0c..ee880d9 100755
--- a/src/scripts/build.in
+++ b/src/scripts/build.in
@@ -181,6 +181,7 @@ foreach my $pkg (@ARGV) {
        print EXCLUDE "$File::Find::name\n" if(-d $_ && /^CVS$/);
        print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.svn$/);
        print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.arch-ids$/);
+       print EXCLUDE "$File::Find::name\n" if(-d $_ && /^\.git$/);
        ## Windows DLL resource file
        push(@exclude_patterns, "^src/" . $pkgname . "_res\\.rc");
        my $filename = $File::Find::name;






--
 + seth


From r.hankin at noc.soton.ac.uk  Tue Jul 11 09:46:17 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Tue, 11 Jul 2006 08:46:17 +0100
Subject: [Rd] invalid alignment error in R-2.4.0
Message-ID: <83E43F77-928F-4315-B311-0002B276A1F5@soc.soton.ac.uk>

Hi

I  thought I'd  pass one of my package through R CMD check with R-2.4.0
with the following result (it's clean under R-2.3.1):


[snip]
 >
 >   # histogram of the fourth power:
 > hist(out^4, col="gray")

*** caught bus error ***
address 0x12, cause 'invalid alignment'

Traceback:
1: sort(x, partial = c(half, half + 1))
2: sum(sort(x, partial = c(half, half + 1))[c(half, half + 1)])
3: stats::median(diff(breaks))
4: hist.default(out^4, col = "gray")
5: hist(out^4, col = "gray")
aborting ...



Under R-2.4.0, hist(out^4) repeatably gives an error like that above.
Here's a dput() of out:


c(10.4975870476354, 10.3973239490546, 10.9079973318563,  
10.9201457586087,
10.863164987001, 10.8092412328219, 10.3740979640666, 10.3933170416021,
10.1571361926693, 10.7231637475341, 10.8495903667896, 10.2760101321262,
10.3999724625721, 11.1422484374362, 10.1623400428855, 10.9139189812841,
11.1313700266654, 10.4214929867460, 10.9543767973144, 10.2925796047365,
10.3399040002101, 10.5080265067013, 10.4963598344302, 10.5694912655817,
10.9088365086950, 9.67007136377566, 10.4303159857457, 10.6734035266469,
10.3555432530979, 10.9738495753501, 10.3888850313651, 11.2210598170116,
10.8020906590915, 10.7391185468963, 10.3303267171864, 10.7176410493307,
10.3527634000890, 10.6331145125840, 10.7946862157461, 10.6147608946858,
9.85567630738787, 11.0289144282434, 10.742857648964, 10.866630627911,
10.5278318354308, 10.3553983376990, 10.7900270843436, 10.3467961125517,
10.5126782499258, 10.8575135939962, 10.9151746119094, 11.2000951011802,
10.4133108985045, 10.5265186993107, 10.7148111540688, 10.3722159808052,
10.1911424590529, 10.8375326158672, 10.2892046453081, 11.0159788575821,
10.2104834661186, 10.0718751926059, 11.5503607473136, 10.9134877529340,
11.3063246702428, 10.0682022386836, 10.6766007351429, 10.6029531885996,
10.3568338147980, 10.5246512104442, 10.9964827564484, 10.4826791470128,
10.3340980255556, 10.4201862775486, 10.6526293411458, 10.1270181743699,
10.7479561453406, 10.3223366380115, 10.6640317023258, 10.8816465650639,
10.2469734194448, 11.0595077832844, 10.6211764829084, 10.8387020014927,
10.3842712860829, 10.3288969420998, 11.1095936345021, 10.7755741380517,
10.8891163113089, 10.9239878986268, 10.4674437486482, 10.4494516106226,
10.6816375084280, 10.1609470064992, 10.6055689487767, 10.3759153410817,
10.4743618410399, 10.9932886540585, 10.2563007403496, 10.0821264920858,
10.7293259154111, 10.8834112318584, 10.5285102045021, 10.7068278466484,
10.9517121917501, 10.6249671128484, 10.8188751147001, 10.5327448695580,
10.7315642237059, 10.4996799637132)


 > R.version
                _
platform       powerpc-apple-darwin8.7.0
arch           powerpc
os             darwin8.7.0
system         powerpc, darwin8.7.0
status         Under development (unstable)
major          2
minor          4.0
year           2006
month          07
day            09
svn rev        38523
language       R
version.string R version 2.4.0 Under development (unstable)  
(2006-07-09 r38523)
 >

--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From feimingchen at yahoo.com  Sat Jul  8 01:20:06 2006
From: feimingchen at yahoo.com (feimingchen at yahoo.com)
Date: Sat,  8 Jul 2006 01:20:06 +0200 (CEST)
Subject: [Rd] Documentation: add a bit note (PR#9066)
Message-ID: <20060707232006.52D7A5090A@slim.kubism.ku.dk>

Full_Name: Feiming Chen
Version: 2.0.0
OS: Unix
Submission from: (NULL) (216.52.132.10)


Just a note to clarify the document "Writing R Extensions". 

As a beginner, I was a little confused about this paragraph:

Section 1.1.4 Package subdirectories, page 6, the paragraph in the
middle:  "The 'man' subdirectory ... Note that all user-level objects in a
package should be documented; if a package pkg contains user-level objects which
are for 'internal' only, it should provide a file pkg-internal.Rd which
documents all such objects, and clearly states that these are not meant to be
called by the user. See e.g. the sources for package grid in the R distribution
for an example."

I just try to skip writing Rd 
files for numerous small R functions (for "internal" use, that is, called 
by other functions).  I thought the only way is to put them in
pkg-internal.Rd until I read about NAMESPACE in section 1.6. 
I find out I just need to export those R functions that are needed by
the user and then "R CMD check" won't complain not seeing the docs for 
all other functions, along with some error messages. 

So maybe we can add a footnote there that says:

Refer to section 1.6 NAMESPACE.  You can export only a subset of all R
objects to make them on user level. So that you don't need to write
Rd files for un-exported ones. 

Thanks!


From maechler at stat.math.ethz.ch  Tue Jul 11 10:25:28 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 11 Jul 2006 10:25:28 +0200
Subject: [Rd] invalid alignment error in R-2.4.0
In-Reply-To: <83E43F77-928F-4315-B311-0002B276A1F5@soc.soton.ac.uk>
References: <83E43F77-928F-4315-B311-0002B276A1F5@soc.soton.ac.uk>
Message-ID: <17587.24696.569438.600090@stat.math.ethz.ch>

I assume this is specific to your installation of R-devel
(R-2.4.0 "unstable").  If I use your 'out',
   hist(out^4, col = "gray")
works just fine consistently.

Could it be a compiler / linker mismatch
on your Mac?  Also, can you run "under the debugger"
   'R -d gdb' (from a commandline) ?

This should allow a traceback ('backtrace', abbreviated 'bt' in "gdb")
of the C call stack.

Martin

>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Tue, 11 Jul 2006 08:46:17 +0100 writes:

    Robin> Hi
    Robin> I  thought I'd  pass one of my package through R CMD check with R-2.4.0
    Robin> with the following result (it's clean under R-2.3.1):


    Robin> [snip]
    >> 
    >> # histogram of the fourth power:
    >> hist(out^4, col="gray")

    Robin> *** caught bus error ***
    Robin> address 0x12, cause 'invalid alignment'

    Robin> Traceback:
    Robin> 1: sort(x, partial = c(half, half + 1))
    Robin> 2: sum(sort(x, partial = c(half, half + 1))[c(half, half + 1)])
    Robin> 3: stats::median(diff(breaks))
    Robin> 4: hist.default(out^4, col = "gray")
    Robin> 5: hist(out^4, col = "gray")
    Robin> aborting ...



    Robin> Under R-2.4.0, hist(out^4) repeatably gives an error like that above.
    Robin> Here's a dput() of out:


    Robin> c(10.4975870476354, 10.3973239490546, 10.9079973318563,  
    Robin> 10.9201457586087,
    Robin> 10.863164987001, 10.8092412328219, 10.3740979640666, 10.3933170416021,
    Robin> 10.1571361926693, 10.7231637475341, 10.8495903667896, 10.2760101321262,
    Robin> 10.3999724625721, 11.1422484374362, 10.1623400428855, 10.9139189812841,
    Robin> 11.1313700266654, 10.4214929867460, 10.9543767973144, 10.2925796047365,
    Robin> 10.3399040002101, 10.5080265067013, 10.4963598344302, 10.5694912655817,
    Robin> 10.9088365086950, 9.67007136377566, 10.4303159857457, 10.6734035266469,
    Robin> 10.3555432530979, 10.9738495753501, 10.3888850313651, 11.2210598170116,
    Robin> 10.8020906590915, 10.7391185468963, 10.3303267171864, 10.7176410493307,
    Robin> 10.3527634000890, 10.6331145125840, 10.7946862157461, 10.6147608946858,
    Robin> 9.85567630738787, 11.0289144282434, 10.742857648964, 10.866630627911,
    Robin> 10.5278318354308, 10.3553983376990, 10.7900270843436, 10.3467961125517,
    Robin> 10.5126782499258, 10.8575135939962, 10.9151746119094, 11.2000951011802,
    Robin> 10.4133108985045, 10.5265186993107, 10.7148111540688, 10.3722159808052,
    Robin> 10.1911424590529, 10.8375326158672, 10.2892046453081, 11.0159788575821,
    Robin> 10.2104834661186, 10.0718751926059, 11.5503607473136, 10.9134877529340,
    Robin> 11.3063246702428, 10.0682022386836, 10.6766007351429, 10.6029531885996,
    Robin> 10.3568338147980, 10.5246512104442, 10.9964827564484, 10.4826791470128,
    Robin> 10.3340980255556, 10.4201862775486, 10.6526293411458, 10.1270181743699,
    Robin> 10.7479561453406, 10.3223366380115, 10.6640317023258, 10.8816465650639,
    Robin> 10.2469734194448, 11.0595077832844, 10.6211764829084, 10.8387020014927,
    Robin> 10.3842712860829, 10.3288969420998, 11.1095936345021, 10.7755741380517,
    Robin> 10.8891163113089, 10.9239878986268, 10.4674437486482, 10.4494516106226,
    Robin> 10.6816375084280, 10.1609470064992, 10.6055689487767, 10.3759153410817,
    Robin> 10.4743618410399, 10.9932886540585, 10.2563007403496, 10.0821264920858,
    Robin> 10.7293259154111, 10.8834112318584, 10.5285102045021, 10.7068278466484,
    Robin> 10.9517121917501, 10.6249671128484, 10.8188751147001, 10.5327448695580,
    Robin> 10.7315642237059, 10.4996799637132)


    >> R.version
    Robin> _
    Robin> platform       powerpc-apple-darwin8.7.0
    Robin> arch           powerpc
    Robin> os             darwin8.7.0
    Robin> system         powerpc, darwin8.7.0
    Robin> status         Under development (unstable)
    Robin> major          2
    Robin> minor          4.0
    Robin> year           2006
    Robin> month          07
    Robin> day            09
    Robin> svn rev        38523
    Robin> language       R
    Robin> version.string R version 2.4.0 Under development (unstable)  
    Robin> (2006-07-09 r38523)
    >> 

    Robin> --
    Robin> Robin Hankin
    Robin> Uncertainty Analyst
    Robin> National Oceanography Centre, Southampton
    Robin> European Way, Southampton SO14 3ZH, UK
    Robin> tel  023-8059-7743

    Robin> ______________________________________________
    Robin> R-devel at r-project.org mailing list
    Robin> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Tue Jul 11 10:41:55 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 11 Jul 2006 10:41:55 +0200
Subject: [Rd] Add .git to SCM excludes for build and INSTALL scripts
In-Reply-To: <m2irm5th9z.fsf@fhcrc.org>
References: <m2irm5th9z.fsf@fhcrc.org>
Message-ID: <17587.25683.601407.261268@stat.math.ethz.ch>

Thank you Seth,

I've committed the changes
(BTW: for some reason your patch did not cleanly apply to
build.in).

Regards,
Martin

>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>     on Mon, 10 Jul 2006 12:02:32 -0700 writes:

    Seth> Git is a source code management system like CVS, svn, arch, and
    Seth> others.  

    Seth> It would be nice to add exclude support to R CMD build and INSTALL so
    Seth> that the .git subdir of an R package is handled appropriately.

    Seth> Here is a possible patch:

    [ .........]


From r.hankin at noc.soton.ac.uk  Tue Jul 11 11:04:34 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Tue, 11 Jul 2006 10:04:34 +0100
Subject: [Rd] invalid alignment error in R-2.4.0
In-Reply-To: <17587.24696.569438.600090@stat.math.ethz.ch>
References: <83E43F77-928F-4315-B311-0002B276A1F5@soc.soton.ac.uk>
	<17587.24696.569438.600090@stat.math.ethz.ch>
Message-ID: <34CDD1D4-4F13-4411-8638-0E48451100D2@soc.soton.ac.uk>

Hi Martin


On 11 Jul 2006, at 09:25, Martin Maechler wrote:

> I assume this is specific to your installation of R-devel
> (R-2.4.0 "unstable").  If I use your 'out',
>    hist(out^4, col = "gray")
> works just fine consistently.
>
> Could it be a compiler / linker mismatch
> on your Mac?  Also, can you run "under the debugger"
>    'R -d gdb' (from a commandline) ?
>
> This should allow a traceback ('backtrace', abbreviated 'bt' in "gdb")
> of the C call stack.



transcript follows:


octopus:~/scratch% ./Rd/R.framework/Versions/2.4/Resources/bin/R -d gdb
GNU gdb 6.1-20040303 (Apple version gdb-434) (Wed Nov  2 17:28:16 GMT  
2005)
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and  
you are
welcome to change it and/or distribute copies of it under certain  
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for  
details.
This GDB was configured as "powerpc-apple-darwin"...Reading symbols  
for shared libraries ... done

(gdb) R
Starting program: /Users/rksh/scratch/Rd/R.framework/Versions/2.4/ 
Resources/bin/exec/R
Reading symbols for shared libraries ...................+ done

R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

Reading symbols for shared  
libraries ..........................................................  
done
Reading symbols for shared libraries . done
Reading symbols for shared libraries . done
 > load("~/f")
 > hist(out^4)

Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_PROTECTION_FAILURE at address: 0x00000012
R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
126             vt = v[i + 1];
(gdb) bt
#0  R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
#1  0x0111e5d4 in do_qsort (call=0x1d0ed04, op=0x1, args=0x1d0b7f8,  
rho=0x4) at qsort.c:89
#2  0x010c9a1c in do_internal (call=0x1d0b7f8, op=0x1, args=0x0,  
env=0x1d0c494) at names.c:1091
#3  0x01099bb4 in Rf_eval (e=0x1d0ec94, rho=0x1d0c494) at eval.c:425
#4  0x0109ba10 in do_set (call=0x1d0fb78, op=0x180a390,  
args=0x1d0fb94, rho=0x1d0c494) at eval.c:1337
#5  0x01099bb4 in Rf_eval (e=0x1d0fb78, rho=0x1d0c494) at eval.c:425
#6  0x0109bc60 in do_begin (call=0x1d0fb40, op=0x180a2cc,  
args=0x1d0fb5c, rho=0x1d0c494) at eval.c:1101
#7  0x01099bb4 in Rf_eval (e=0x1d0fb40, rho=0x1d0c494) at eval.c:425
#8  0x01099bb4 in Rf_eval (e=0x1d0fa44, rho=0x1d0c494) at eval.c:425
#9  0x0109ba10 in do_set (call=0x1d0f9f0, op=0x180a390,  
args=0x1d0fa0c, rho=0x1d0c494) at eval.c:1337
#10 0x01099bb4 in Rf_eval (e=0x1d0f9f0, rho=0x1d0c494) at eval.c:425
#11 0x0109bc60 in do_begin (call=0x1d0f5e4, op=0x180a2cc,  
args=0x1d0f9d4, rho=0x1d0c494) at eval.c:1101
#12 0x01099bb4 in Rf_eval (e=0x1d0f5e4, rho=0x1d0c494) at eval.c:425
#13 0x01099bb4 in Rf_eval (e=0x1d0f520, rho=0x1d0c494) at eval.c:425
#14 0x0109bc60 in do_begin (call=0x1d10f18, op=0x180a2cc,  
args=0x1d0f504, rho=0x1d0c494) at eval.c:1101
#15 0x01099bb4 in Rf_eval (e=0x1d10f18, rho=0x1d0c494) at eval.c:425
#16 0x0109d0ac in Rf_applyClosure (call=0x1d1353c, op=0x1d10d58,  
arglist=0x1d0d2ec, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
#17 0x01099d94 in Rf_eval (e=0x1d1353c, rho=0x1d13830) at eval.c:456
#18 0x0109b008 in Rf_DispatchOrEval (call=0x1d134cc, op=0x180b978,  
generic=0x11d74d0 "[", args=0x1d13504, rho=0x1d13830, ans=0xbfffa248,  
dropmissing=0, argsevald=0) at eval.c:1758
#19 0x0115a828 in do_subset (call=0x1d134cc, op=0x180b978, args=0x0,  
rho=0x1d13830) at subset.c:527
#20 0x01099bb4 in Rf_eval (e=0x1d134cc, rho=0x1d13830) at eval.c:425
#21 0x01099a5c in Rf_eval (e=0x1d118a0, rho=0x1d1192c) at eval.c:402
#22 0x0109ae04 in Rf_evalList (el=0x1b4f9dc, rho=0x1d1192c) at eval.c: 
1417
#23 0x010c9980 in do_internal (call=0x1b4f9dc, op=0x1,  
args=0x1b4fa14, env=0x1d1192c) at names.c:1087
#24 0x01099bb4 in Rf_eval (e=0x1b4fa30, rho=0x1d1192c) at eval.c:425
#25 0x0109d0ac in Rf_applyClosure (call=0x1d13424, op=0x1b4fa84,  
arglist=0x1d118bc, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
#26 0x01099d94 in Rf_eval (e=0x1d13424, rho=0x1d13830) at eval.c:456
#27 0x0109ae7c in Rf_evalList (el=0x1d13408, rho=0x1d13830) at eval.c: 
1427
#28 0x01099c04 in Rf_eval (e=0x1d143b0, rho=0x1d13830) at eval.c:435
#29 0x0109bc60 in do_begin (call=0x1d14378, op=0x180a2cc,  
args=0x1d14394, rho=0x1d13830) at eval.c:1101
#30 0x01099bb4 in Rf_eval (e=0x1d14378, rho=0x1d13830) at eval.c:425
#31 0x01099bb4 in Rf_eval (e=0x1d140f4, rho=0x1d13830) at eval.c:425
#32 0x0109bc60 in do_begin (call=0x1d14654, op=0x180a2cc,  
args=0x1d140d8, rho=0x1d13830) at eval.c:1101
#33 0x01099bb4 in Rf_eval (e=0x1d14654, rho=0x1d13830) at eval.c:425
#34 0x0109d0ac in Rf_applyClosure (call=0x1fa96bc, op=0x1d15a7c,  
arglist=0x1d137dc, rho=0x1d39024, suppliedenv=0x181d304) at eval.c:615
#35 0x01099d94 in Rf_eval (e=0x1fa96bc, rho=0x1d39024) at eval.c:456
#36 0x0109ae7c in Rf_evalList (el=0x1fa96a0, rho=0x1d39024) at eval.c: 
1427
#37 0x01099c04 in Rf_eval (e=0x1fa9668, rho=0x1d39024) at eval.c:435
#38 0x0109ba10 in do_set (call=0x1fa95c0, op=0x180a390,  
args=0x1fa95dc, rho=0x1d39024) at eval.c:1337
#39 0x01099bb4 in Rf_eval (e=0x1fa95c0, rho=0x1d39024) at eval.c:425
#40 0x0109bc60 in do_begin (call=0x1facdc0, op=0x180a2cc,  
args=0x1fa95a4, rho=0x1d39024) at eval.c:1101
#41 0x01099bb4 in Rf_eval (e=0x1facdc0, rho=0x1d39024) at eval.c:425
#42 0x0109d0ac in Rf_applyClosure (call=0x1d3a2c4, op=0x1fad6f4,  
arglist=0x1d3a040, rho=0x1d3a094, suppliedenv=0x1d3a21c) at eval.c:615
#43 0x010cc7e0 in Rf_usemethod (generic=0x1f69540 "hist",  
obj=0x1fad6f4, call=0x2, args=0x4, rho=0x1d3a094, callrho=0x181d2e8,  
defrho=0x2aa59f8, ans=0xbfffe148) at objects.c:311
#44 0x010ccb20 in do_usemethod (call=0x1d3af24, op=0x1,  
args=0x1d3af40, env=0x1d3a094) at objects.c:395
#45 0x01099bb4 in Rf_eval (e=0x1d3af24, rho=0x1d3a094) at eval.c:425
#46 0x0109d0ac in Rf_applyClosure (call=0x1d3b724, op=0x1d3ab88,  
arglist=0x1d3a040, rho=0x181d2e8, suppliedenv=0x181d304) at eval.c:615
#47 0x01099d94 in Rf_eval (e=0x1d3b724, rho=0x181d2e8) at eval.c:456
#48 0x010b7d30 in Rf_ReplIteration (rho=0x181d2e8, savestack=0,  
browselevel=0, state=0xbfffed88) at main.c:254
#49 0x010b7e88 in R_ReplConsole (rho=0x181d2e8, savestack=0,  
browselevel=0) at main.c:302
#50 0x010b8198 in run_Rmainloop () at main.c:913
#51 0x00002cec in main (ac=42293336, av=0x1) at Rmain.c:33
(gdb)


--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From maechler at stat.math.ethz.ch  Tue Jul 11 11:30:26 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 11 Jul 2006 11:30:26 +0200
Subject: [Rd] invalid alignment error in R-2.4.0
In-Reply-To: <34CDD1D4-4F13-4411-8638-0E48451100D2@soc.soton.ac.uk>
References: <83E43F77-928F-4315-B311-0002B276A1F5@soc.soton.ac.uk>
	<17587.24696.569438.600090@stat.math.ethz.ch>
	<34CDD1D4-4F13-4411-8638-0E48451100D2@soc.soton.ac.uk>
Message-ID: <17587.28594.327548.726315@stat.math.ethz.ch>

Hi Robin,

thanks for the extra info.  I have no clue what the problem
might be.

But from R-level debugging (and the R traceback you wrote
originally),
I assume you could trigger the problem already by a simple

  median(rep(1000, 10))

is that the case? If yes, please follow up on R-devel.

In any case, let's wait for others (Mac specialists and/or other
R-core members) to voice ideas.

Martin



>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Tue, 11 Jul 2006 10:04:34 +0100 writes:

    Robin> Hi Martin
    Robin> On 11 Jul 2006, at 09:25, Martin Maechler wrote:

    >> I assume this is specific to your installation of R-devel
    >> (R-2.4.0 "unstable").  If I use your 'out',
    >> hist(out^4, col = "gray")
    >> works just fine consistently.
    >> 
    >> Could it be a compiler / linker mismatch
    >> on your Mac?  Also, can you run "under the debugger"
    >> 'R -d gdb' (from a commandline) ?
    >> 
    >> This should allow a traceback ('backtrace', abbreviated 'bt' in "gdb")
    >> of the C call stack.



    Robin> transcript follows:


    Robin> octopus:~/scratch% ./Rd/R.framework/Versions/2.4/Resources/bin/R -d gdb
    Robin> GNU gdb 6.1-20040303 (Apple version gdb-434) (Wed Nov  2 17:28:16 GMT  
    Robin> 2005)
    Robin> Copyright 2004 Free Software Foundation, Inc.
    Robin> GDB is free software, covered by the GNU General Public License, and  
    Robin> you are
    Robin> welcome to change it and/or distribute copies of it under certain  
    Robin> conditions.
    Robin> Type "show copying" to see the conditions.
    Robin> There is absolutely no warranty for GDB.  Type "show warranty" for  
    Robin> details.
    Robin> This GDB was configured as "powerpc-apple-darwin"...Reading symbols  
    Robin> for shared libraries ... done

    Robin> (gdb) R
    Robin> Starting program: /Users/rksh/scratch/Rd/R.framework/Versions/2.4/ 
    Robin> Resources/bin/exec/R
    Robin> Reading symbols for shared libraries ...................+ done

    Robin> R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
    Robin> Copyright (C) 2006 The R Foundation for Statistical Computing
    Robin> ISBN 3-900051-07-0

    Robin> R is free software and comes with ABSOLUTELY NO WARRANTY.
    Robin> You are welcome to redistribute it under certain conditions.
    Robin> Type 'license()' or 'licence()' for distribution details.

    Robin> R is a collaborative project with many contributors.
    Robin> Type 'contributors()' for more information and
    Robin> 'citation()' on how to cite R or R packages in publications.

    Robin> Type 'demo()' for some demos, 'help()' for on-line help, or
    Robin> 'help.start()' for an HTML browser interface to help.
    Robin> Type 'q()' to quit R.

    Robin> Reading symbols for shared  
    Robin> libraries ..........................................................  
    Robin> done
    Robin> Reading symbols for shared libraries . done
    Robin> Reading symbols for shared libraries . done
    >> load("~/f")
    >> hist(out^4)

    Robin> Program received signal EXC_BAD_ACCESS, Could not access memory.
    Robin> Reason: KERN_PROTECTION_FAILURE at address: 0x00000012
    Robin> R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
    Robin> 126             vt = v[i + 1];
    Robin> (gdb) bt
    Robin> #0  R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
    Robin> #1  0x0111e5d4 in do_qsort (call=0x1d0ed04, op=0x1, args=0x1d0b7f8,  
    Robin> rho=0x4) at qsort.c:89
    Robin> #2  0x010c9a1c in do_internal (call=0x1d0b7f8, op=0x1, args=0x0,  
    Robin> env=0x1d0c494) at names.c:1091
    Robin> #3  0x01099bb4 in Rf_eval (e=0x1d0ec94, rho=0x1d0c494) at eval.c:425
    Robin> #4  0x0109ba10 in do_set (call=0x1d0fb78, op=0x180a390,  
    Robin> args=0x1d0fb94, rho=0x1d0c494) at eval.c:1337
    Robin> #5  0x01099bb4 in Rf_eval (e=0x1d0fb78, rho=0x1d0c494) at eval.c:425
    Robin> #6  0x0109bc60 in do_begin (call=0x1d0fb40, op=0x180a2cc,  
    Robin> args=0x1d0fb5c, rho=0x1d0c494) at eval.c:1101
    Robin> #7  0x01099bb4 in Rf_eval (e=0x1d0fb40, rho=0x1d0c494) at eval.c:425
    Robin> #8  0x01099bb4 in Rf_eval (e=0x1d0fa44, rho=0x1d0c494) at eval.c:425
    Robin> #9  0x0109ba10 in do_set (call=0x1d0f9f0, op=0x180a390,  
    Robin> args=0x1d0fa0c, rho=0x1d0c494) at eval.c:1337
    Robin> #10 0x01099bb4 in Rf_eval (e=0x1d0f9f0, rho=0x1d0c494) at eval.c:425
    Robin> #11 0x0109bc60 in do_begin (call=0x1d0f5e4, op=0x180a2cc,  
    Robin> args=0x1d0f9d4, rho=0x1d0c494) at eval.c:1101
    Robin> #12 0x01099bb4 in Rf_eval (e=0x1d0f5e4, rho=0x1d0c494) at eval.c:425
    Robin> #13 0x01099bb4 in Rf_eval (e=0x1d0f520, rho=0x1d0c494) at eval.c:425
    Robin> #14 0x0109bc60 in do_begin (call=0x1d10f18, op=0x180a2cc,  
    Robin> args=0x1d0f504, rho=0x1d0c494) at eval.c:1101
    Robin> #15 0x01099bb4 in Rf_eval (e=0x1d10f18, rho=0x1d0c494) at eval.c:425
    Robin> #16 0x0109d0ac in Rf_applyClosure (call=0x1d1353c, op=0x1d10d58,  
    Robin> arglist=0x1d0d2ec, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
    Robin> #17 0x01099d94 in Rf_eval (e=0x1d1353c, rho=0x1d13830) at eval.c:456
    Robin> #18 0x0109b008 in Rf_DispatchOrEval (call=0x1d134cc, op=0x180b978,  
    Robin> generic=0x11d74d0 "[", args=0x1d13504, rho=0x1d13830, ans=0xbfffa248,  
    Robin> dropmissing=0, argsevald=0) at eval.c:1758
    Robin> #19 0x0115a828 in do_subset (call=0x1d134cc, op=0x180b978, args=0x0,  
    Robin> rho=0x1d13830) at subset.c:527
    Robin> #20 0x01099bb4 in Rf_eval (e=0x1d134cc, rho=0x1d13830) at eval.c:425
    Robin> #21 0x01099a5c in Rf_eval (e=0x1d118a0, rho=0x1d1192c) at eval.c:402
    Robin> #22 0x0109ae04 in Rf_evalList (el=0x1b4f9dc, rho=0x1d1192c) at eval.c: 
    Robin> 1417
    Robin> #23 0x010c9980 in do_internal (call=0x1b4f9dc, op=0x1,  
    Robin> args=0x1b4fa14, env=0x1d1192c) at names.c:1087
    Robin> #24 0x01099bb4 in Rf_eval (e=0x1b4fa30, rho=0x1d1192c) at eval.c:425
    Robin> #25 0x0109d0ac in Rf_applyClosure (call=0x1d13424, op=0x1b4fa84,  
    Robin> arglist=0x1d118bc, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
    Robin> #26 0x01099d94 in Rf_eval (e=0x1d13424, rho=0x1d13830) at eval.c:456
    Robin> #27 0x0109ae7c in Rf_evalList (el=0x1d13408, rho=0x1d13830) at eval.c: 
    Robin> 1427
    Robin> #28 0x01099c04 in Rf_eval (e=0x1d143b0, rho=0x1d13830) at eval.c:435
    Robin> #29 0x0109bc60 in do_begin (call=0x1d14378, op=0x180a2cc,  
    Robin> args=0x1d14394, rho=0x1d13830) at eval.c:1101
    Robin> #30 0x01099bb4 in Rf_eval (e=0x1d14378, rho=0x1d13830) at eval.c:425
    Robin> #31 0x01099bb4 in Rf_eval (e=0x1d140f4, rho=0x1d13830) at eval.c:425
    Robin> #32 0x0109bc60 in do_begin (call=0x1d14654, op=0x180a2cc,  
    Robin> args=0x1d140d8, rho=0x1d13830) at eval.c:1101
    Robin> #33 0x01099bb4 in Rf_eval (e=0x1d14654, rho=0x1d13830) at eval.c:425
    Robin> #34 0x0109d0ac in Rf_applyClosure (call=0x1fa96bc, op=0x1d15a7c,  
    Robin> arglist=0x1d137dc, rho=0x1d39024, suppliedenv=0x181d304) at eval.c:615
    Robin> #35 0x01099d94 in Rf_eval (e=0x1fa96bc, rho=0x1d39024) at eval.c:456
    Robin> #36 0x0109ae7c in Rf_evalList (el=0x1fa96a0, rho=0x1d39024) at eval.c: 
    Robin> 1427
    Robin> #37 0x01099c04 in Rf_eval (e=0x1fa9668, rho=0x1d39024) at eval.c:435
    Robin> #38 0x0109ba10 in do_set (call=0x1fa95c0, op=0x180a390,  
    Robin> args=0x1fa95dc, rho=0x1d39024) at eval.c:1337
    Robin> #39 0x01099bb4 in Rf_eval (e=0x1fa95c0, rho=0x1d39024) at eval.c:425
    Robin> #40 0x0109bc60 in do_begin (call=0x1facdc0, op=0x180a2cc,  
    Robin> args=0x1fa95a4, rho=0x1d39024) at eval.c:1101
    Robin> #41 0x01099bb4 in Rf_eval (e=0x1facdc0, rho=0x1d39024) at eval.c:425
    Robin> #42 0x0109d0ac in Rf_applyClosure (call=0x1d3a2c4, op=0x1fad6f4,  
    Robin> arglist=0x1d3a040, rho=0x1d3a094, suppliedenv=0x1d3a21c) at eval.c:615
    Robin> #43 0x010cc7e0 in Rf_usemethod (generic=0x1f69540 "hist",  
    Robin> obj=0x1fad6f4, call=0x2, args=0x4, rho=0x1d3a094, callrho=0x181d2e8,  
    Robin> defrho=0x2aa59f8, ans=0xbfffe148) at objects.c:311
    Robin> #44 0x010ccb20 in do_usemethod (call=0x1d3af24, op=0x1,  
    Robin> args=0x1d3af40, env=0x1d3a094) at objects.c:395
    Robin> #45 0x01099bb4 in Rf_eval (e=0x1d3af24, rho=0x1d3a094) at eval.c:425
    Robin> #46 0x0109d0ac in Rf_applyClosure (call=0x1d3b724, op=0x1d3ab88,  
    Robin> arglist=0x1d3a040, rho=0x181d2e8, suppliedenv=0x181d304) at eval.c:615
    Robin> #47 0x01099d94 in Rf_eval (e=0x1d3b724, rho=0x181d2e8) at eval.c:456
    Robin> #48 0x010b7d30 in Rf_ReplIteration (rho=0x181d2e8, savestack=0,  
    Robin> browselevel=0, state=0xbfffed88) at main.c:254
    Robin> #49 0x010b7e88 in R_ReplConsole (rho=0x181d2e8, savestack=0,  
    Robin> browselevel=0) at main.c:302
    Robin> #50 0x010b8198 in run_Rmainloop () at main.c:913
    Robin> #51 0x00002cec in main (ac=42293336, av=0x1) at Rmain.c:33
    Robin> (gdb)


    Robin> --
    Robin> Robin Hankin
    Robin> Uncertainty Analyst
    Robin> National Oceanography Centre, Southampton
    Robin> European Way, Southampton SO14 3ZH, UK
    Robin> tel  023-8059-7743

    Robin> ______________________________________________
    Robin> R-devel at r-project.org mailing list
    Robin> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Tue Jul 11 11:54:15 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Jul 2006 10:54:15 +0100 (BST)
Subject: [Rd] invalid alignment error in R-2.4.0
In-Reply-To: <17587.28594.327548.726315@stat.math.ethz.ch>
References: <83E43F77-928F-4315-B311-0002B276A1F5@soc.soton.ac.uk>
	<17587.24696.569438.600090@stat.math.ethz.ch>
	<34CDD1D4-4F13-4411-8638-0E48451100D2@soc.soton.ac.uk>
	<17587.28594.327548.726315@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0607111048300.12437@gannet.stats.ox.ac.uk>

On Tue, 11 Jul 2006, Martin Maechler wrote:

> Hi Robin,
> 
> thanks for the extra info.  I have no clue what the problem
> might be.
> 
> But from R-level debugging (and the R traceback you wrote
> originally),
> I assume you could trigger the problem already by a simple
> 
>   median(rep(1000, 10))
> 
> is that the case? If yes, please follow up on R-devel.

I don't see why you assume so: there are multitudinous paths through 
qsort.

> In any case, let's wait for others (Mac specialists and/or other
> R-core members) to voice ideas.

I checked this under valgrind, which normally shows up such errors, and 
found nothing, even with gctorture on (and valgrind instrumentation of 
R's memory management on).

You used the dput and Robin used load(), so presumably on not exactly the 
same object.  I think Robin needs to test what he actually gave us, to be 
sure.  If that is the case, I suspect the compiler.

> 
> Martin
> 
> 
> 
> >>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
> >>>>>     on Tue, 11 Jul 2006 10:04:34 +0100 writes:
> 
>     Robin> Hi Martin
>     Robin> On 11 Jul 2006, at 09:25, Martin Maechler wrote:
> 
>     >> I assume this is specific to your installation of R-devel
>     >> (R-2.4.0 "unstable").  If I use your 'out',
>     >> hist(out^4, col = "gray")
>     >> works just fine consistently.
>     >> 
>     >> Could it be a compiler / linker mismatch
>     >> on your Mac?  Also, can you run "under the debugger"
>     >> 'R -d gdb' (from a commandline) ?
>     >> 
>     >> This should allow a traceback ('backtrace', abbreviated 'bt' in "gdb")
>     >> of the C call stack.
> 
> 
> 
>     Robin> transcript follows:
> 
> 
>     Robin> octopus:~/scratch% ./Rd/R.framework/Versions/2.4/Resources/bin/R -d gdb
>     Robin> GNU gdb 6.1-20040303 (Apple version gdb-434) (Wed Nov  2 17:28:16 GMT  
>     Robin> 2005)
>     Robin> Copyright 2004 Free Software Foundation, Inc.
>     Robin> GDB is free software, covered by the GNU General Public License, and  
>     Robin> you are
>     Robin> welcome to change it and/or distribute copies of it under certain  
>     Robin> conditions.
>     Robin> Type "show copying" to see the conditions.
>     Robin> There is absolutely no warranty for GDB.  Type "show warranty" for  
>     Robin> details.
>     Robin> This GDB was configured as "powerpc-apple-darwin"...Reading symbols  
>     Robin> for shared libraries ... done
> 
>     Robin> (gdb) R
>     Robin> Starting program: /Users/rksh/scratch/Rd/R.framework/Versions/2.4/ 
>     Robin> Resources/bin/exec/R
>     Robin> Reading symbols for shared libraries ...................+ done
> 
>     Robin> R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
>     Robin> Copyright (C) 2006 The R Foundation for Statistical Computing
>     Robin> ISBN 3-900051-07-0
> 
>     Robin> R is free software and comes with ABSOLUTELY NO WARRANTY.
>     Robin> You are welcome to redistribute it under certain conditions.
>     Robin> Type 'license()' or 'licence()' for distribution details.
> 
>     Robin> R is a collaborative project with many contributors.
>     Robin> Type 'contributors()' for more information and
>     Robin> 'citation()' on how to cite R or R packages in publications.
> 
>     Robin> Type 'demo()' for some demos, 'help()' for on-line help, or
>     Robin> 'help.start()' for an HTML browser interface to help.
>     Robin> Type 'q()' to quit R.
> 
>     Robin> Reading symbols for shared  
>     Robin> libraries ..........................................................  
>     Robin> done
>     Robin> Reading symbols for shared libraries . done
>     Robin> Reading symbols for shared libraries . done
>     >> load("~/f")
>     >> hist(out^4)
> 
>     Robin> Program received signal EXC_BAD_ACCESS, Could not access memory.
>     Robin> Reason: KERN_PROTECTION_FAILURE at address: 0x00000012
>     Robin> R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
>     Robin> 126             vt = v[i + 1];
>     Robin> (gdb) bt
>     Robin> #0  R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
>     Robin> #1  0x0111e5d4 in do_qsort (call=0x1d0ed04, op=0x1, args=0x1d0b7f8,  
>     Robin> rho=0x4) at qsort.c:89
>     Robin> #2  0x010c9a1c in do_internal (call=0x1d0b7f8, op=0x1, args=0x0,  
>     Robin> env=0x1d0c494) at names.c:1091
>     Robin> #3  0x01099bb4 in Rf_eval (e=0x1d0ec94, rho=0x1d0c494) at eval.c:425
>     Robin> #4  0x0109ba10 in do_set (call=0x1d0fb78, op=0x180a390,  
>     Robin> args=0x1d0fb94, rho=0x1d0c494) at eval.c:1337
>     Robin> #5  0x01099bb4 in Rf_eval (e=0x1d0fb78, rho=0x1d0c494) at eval.c:425
>     Robin> #6  0x0109bc60 in do_begin (call=0x1d0fb40, op=0x180a2cc,  
>     Robin> args=0x1d0fb5c, rho=0x1d0c494) at eval.c:1101
>     Robin> #7  0x01099bb4 in Rf_eval (e=0x1d0fb40, rho=0x1d0c494) at eval.c:425
>     Robin> #8  0x01099bb4 in Rf_eval (e=0x1d0fa44, rho=0x1d0c494) at eval.c:425
>     Robin> #9  0x0109ba10 in do_set (call=0x1d0f9f0, op=0x180a390,  
>     Robin> args=0x1d0fa0c, rho=0x1d0c494) at eval.c:1337
>     Robin> #10 0x01099bb4 in Rf_eval (e=0x1d0f9f0, rho=0x1d0c494) at eval.c:425
>     Robin> #11 0x0109bc60 in do_begin (call=0x1d0f5e4, op=0x180a2cc,  
>     Robin> args=0x1d0f9d4, rho=0x1d0c494) at eval.c:1101
>     Robin> #12 0x01099bb4 in Rf_eval (e=0x1d0f5e4, rho=0x1d0c494) at eval.c:425
>     Robin> #13 0x01099bb4 in Rf_eval (e=0x1d0f520, rho=0x1d0c494) at eval.c:425
>     Robin> #14 0x0109bc60 in do_begin (call=0x1d10f18, op=0x180a2cc,  
>     Robin> args=0x1d0f504, rho=0x1d0c494) at eval.c:1101
>     Robin> #15 0x01099bb4 in Rf_eval (e=0x1d10f18, rho=0x1d0c494) at eval.c:425
>     Robin> #16 0x0109d0ac in Rf_applyClosure (call=0x1d1353c, op=0x1d10d58,  
>     Robin> arglist=0x1d0d2ec, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
>     Robin> #17 0x01099d94 in Rf_eval (e=0x1d1353c, rho=0x1d13830) at eval.c:456
>     Robin> #18 0x0109b008 in Rf_DispatchOrEval (call=0x1d134cc, op=0x180b978,  
>     Robin> generic=0x11d74d0 "[", args=0x1d13504, rho=0x1d13830, ans=0xbfffa248,  
>     Robin> dropmissing=0, argsevald=0) at eval.c:1758
>     Robin> #19 0x0115a828 in do_subset (call=0x1d134cc, op=0x180b978, args=0x0,  
>     Robin> rho=0x1d13830) at subset.c:527
>     Robin> #20 0x01099bb4 in Rf_eval (e=0x1d134cc, rho=0x1d13830) at eval.c:425
>     Robin> #21 0x01099a5c in Rf_eval (e=0x1d118a0, rho=0x1d1192c) at eval.c:402
>     Robin> #22 0x0109ae04 in Rf_evalList (el=0x1b4f9dc, rho=0x1d1192c) at eval.c: 
>     Robin> 1417
>     Robin> #23 0x010c9980 in do_internal (call=0x1b4f9dc, op=0x1,  
>     Robin> args=0x1b4fa14, env=0x1d1192c) at names.c:1087
>     Robin> #24 0x01099bb4 in Rf_eval (e=0x1b4fa30, rho=0x1d1192c) at eval.c:425
>     Robin> #25 0x0109d0ac in Rf_applyClosure (call=0x1d13424, op=0x1b4fa84,  
>     Robin> arglist=0x1d118bc, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
>     Robin> #26 0x01099d94 in Rf_eval (e=0x1d13424, rho=0x1d13830) at eval.c:456
>     Robin> #27 0x0109ae7c in Rf_evalList (el=0x1d13408, rho=0x1d13830) at eval.c: 
>     Robin> 1427
>     Robin> #28 0x01099c04 in Rf_eval (e=0x1d143b0, rho=0x1d13830) at eval.c:435
>     Robin> #29 0x0109bc60 in do_begin (call=0x1d14378, op=0x180a2cc,  
>     Robin> args=0x1d14394, rho=0x1d13830) at eval.c:1101
>     Robin> #30 0x01099bb4 in Rf_eval (e=0x1d14378, rho=0x1d13830) at eval.c:425
>     Robin> #31 0x01099bb4 in Rf_eval (e=0x1d140f4, rho=0x1d13830) at eval.c:425
>     Robin> #32 0x0109bc60 in do_begin (call=0x1d14654, op=0x180a2cc,  
>     Robin> args=0x1d140d8, rho=0x1d13830) at eval.c:1101
>     Robin> #33 0x01099bb4 in Rf_eval (e=0x1d14654, rho=0x1d13830) at eval.c:425
>     Robin> #34 0x0109d0ac in Rf_applyClosure (call=0x1fa96bc, op=0x1d15a7c,  
>     Robin> arglist=0x1d137dc, rho=0x1d39024, suppliedenv=0x181d304) at eval.c:615
>     Robin> #35 0x01099d94 in Rf_eval (e=0x1fa96bc, rho=0x1d39024) at eval.c:456
>     Robin> #36 0x0109ae7c in Rf_evalList (el=0x1fa96a0, rho=0x1d39024) at eval.c: 
>     Robin> 1427
>     Robin> #37 0x01099c04 in Rf_eval (e=0x1fa9668, rho=0x1d39024) at eval.c:435
>     Robin> #38 0x0109ba10 in do_set (call=0x1fa95c0, op=0x180a390,  
>     Robin> args=0x1fa95dc, rho=0x1d39024) at eval.c:1337
>     Robin> #39 0x01099bb4 in Rf_eval (e=0x1fa95c0, rho=0x1d39024) at eval.c:425
>     Robin> #40 0x0109bc60 in do_begin (call=0x1facdc0, op=0x180a2cc,  
>     Robin> args=0x1fa95a4, rho=0x1d39024) at eval.c:1101
>     Robin> #41 0x01099bb4 in Rf_eval (e=0x1facdc0, rho=0x1d39024) at eval.c:425
>     Robin> #42 0x0109d0ac in Rf_applyClosure (call=0x1d3a2c4, op=0x1fad6f4,  
>     Robin> arglist=0x1d3a040, rho=0x1d3a094, suppliedenv=0x1d3a21c) at eval.c:615
>     Robin> #43 0x010cc7e0 in Rf_usemethod (generic=0x1f69540 "hist",  
>     Robin> obj=0x1fad6f4, call=0x2, args=0x4, rho=0x1d3a094, callrho=0x181d2e8,  
>     Robin> defrho=0x2aa59f8, ans=0xbfffe148) at objects.c:311
>     Robin> #44 0x010ccb20 in do_usemethod (call=0x1d3af24, op=0x1,  
>     Robin> args=0x1d3af40, env=0x1d3a094) at objects.c:395
>     Robin> #45 0x01099bb4 in Rf_eval (e=0x1d3af24, rho=0x1d3a094) at eval.c:425
>     Robin> #46 0x0109d0ac in Rf_applyClosure (call=0x1d3b724, op=0x1d3ab88,  
>     Robin> arglist=0x1d3a040, rho=0x181d2e8, suppliedenv=0x181d304) at eval.c:615
>     Robin> #47 0x01099d94 in Rf_eval (e=0x1d3b724, rho=0x181d2e8) at eval.c:456
>     Robin> #48 0x010b7d30 in Rf_ReplIteration (rho=0x181d2e8, savestack=0,  
>     Robin> browselevel=0, state=0xbfffed88) at main.c:254
>     Robin> #49 0x010b7e88 in R_ReplConsole (rho=0x181d2e8, savestack=0,  
>     Robin> browselevel=0) at main.c:302
>     Robin> #50 0x010b8198 in run_Rmainloop () at main.c:913
>     Robin> #51 0x00002cec in main (ac=42293336, av=0x1) at Rmain.c:33
>     Robin> (gdb)
> 
> 
>     Robin> --
>     Robin> Robin Hankin
>     Robin> Uncertainty Analyst
>     Robin> National Oceanography Centre, Southampton
>     Robin> European Way, Southampton SO14 3ZH, UK
>     Robin> tel  023-8059-7743
> 
>     Robin> ______________________________________________
>     Robin> R-devel at r-project.org mailing list
>     Robin> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Tue Jul 11 12:13:59 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 11 Jul 2006 12:13:59 +0200
Subject: [Rd] invalid alignment error in R-2.4.0
In-Reply-To: <Pine.LNX.4.64.0607111048300.12437@gannet.stats.ox.ac.uk>
References: <83E43F77-928F-4315-B311-0002B276A1F5@soc.soton.ac.uk>
	<17587.24696.569438.600090@stat.math.ethz.ch>
	<34CDD1D4-4F13-4411-8638-0E48451100D2@soc.soton.ac.uk>
	<17587.28594.327548.726315@stat.math.ethz.ch>
	<Pine.LNX.4.64.0607111048300.12437@gannet.stats.ox.ac.uk>
Message-ID: <17587.31207.103793.846045@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Tue, 11 Jul 2006 10:54:15 +0100 (BST) writes:

    BDR> On Tue, 11 Jul 2006, Martin Maechler wrote:
    >> Hi Robin,
    >> 
    >> thanks for the extra info.  I have no clue what the problem
    >> might be.
    >> 
    >> But from R-level debugging (and the R traceback you wrote
    >> originally),
    >> I assume you could trigger the problem already by a simple
    >> 
    >> median(rep(1000, 10))
    >> 
    >> is that the case? If yes, please follow up on R-devel.

    BDR> I don't see why you assume so: 
    BDR> there are multitudinous paths through  qsort.

yes, but I had Robin's data (*) and used debug(hist.default) :
diff(breaks) *was* identical to rep(1000, 10)  for the data
Robin posted.

    >> In any case, let's wait for others (Mac specialists and/or other
    >> R-core members) to voice ideas.

    BDR> I checked this under valgrind, which normally shows up such errors, and 
    BDR> found nothing, even with gctorture on (and valgrind instrumentation of 
    BDR> R's memory management on).

    BDR> You used the dput and Robin used load(), so presumably on not exactly the 
    BDR> same object.  


ahh yes, good point...
(*) hence means I only had the dput() version of his data.

    BDR> I think Robin needs to test what he actually gave us, to be 
    BDR> sure.  If that is the case, I suspect the compiler.



    >> Martin
    >> 
    >> 
    >> 
    >> >>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
    >> >>>>>     on Tue, 11 Jul 2006 10:04:34 +0100 writes:
    >> 
    Robin> Hi Martin
    Robin> On 11 Jul 2006, at 09:25, Martin Maechler wrote:
    >> 
    >> >> I assume this is specific to your installation of R-devel
    >> >> (R-2.4.0 "unstable").  If I use your 'out',
    >> >> hist(out^4, col = "gray")
    >> >> works just fine consistently.
    >> >> 
    >> >> Could it be a compiler / linker mismatch
    >> >> on your Mac?  Also, can you run "under the debugger"
    >> >> 'R -d gdb' (from a commandline) ?
    >> >> 
    >> >> This should allow a traceback ('backtrace', abbreviated 'bt' in "gdb")
    >> >> of the C call stack.
    >> 
    >> 
    >> 
    Robin> transcript follows:
    >> 
    >> 
    Robin> octopus:~/scratch% ./Rd/R.framework/Versions/2.4/Resources/bin/R -d gdb
    Robin> GNU gdb 6.1-20040303 (Apple version gdb-434) (Wed Nov  2 17:28:16 GMT  
    Robin> 2005)
    Robin> Copyright 2004 Free Software Foundation, Inc.
    Robin> GDB is free software, covered by the GNU General Public License, and  
    Robin> you are
    Robin> welcome to change it and/or distribute copies of it under certain  
    Robin> conditions.
    Robin> Type "show copying" to see the conditions.
    Robin> There is absolutely no warranty for GDB.  Type "show warranty" for  
    Robin> details.
    Robin> This GDB was configured as "powerpc-apple-darwin"...Reading symbols  
    Robin> for shared libraries ... done
    >> 
    Robin> (gdb) R
    Robin> Starting program: /Users/rksh/scratch/Rd/R.framework/Versions/2.4/ 
    Robin> Resources/bin/exec/R
    Robin> Reading symbols for shared libraries ...................+ done
    >> 
    Robin> R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
    Robin> Copyright (C) 2006 The R Foundation for Statistical Computing
    Robin> ISBN 3-900051-07-0
    >> 
    Robin> R is free software and comes with ABSOLUTELY NO WARRANTY.
    Robin> You are welcome to redistribute it under certain conditions.
    Robin> Type 'license()' or 'licence()' for distribution details.
    >> 
    Robin> R is a collaborative project with many contributors.
    Robin> Type 'contributors()' for more information and
    Robin> 'citation()' on how to cite R or R packages in publications.
    >> 
    Robin> Type 'demo()' for some demos, 'help()' for on-line help, or
    Robin> 'help.start()' for an HTML browser interface to help.
    Robin> Type 'q()' to quit R.
    >> 
    Robin> Reading symbols for shared  
    Robin> libraries ..........................................................  
    Robin> done
    Robin> Reading symbols for shared libraries . done
    Robin> Reading symbols for shared libraries . done
    >> >> load("~/f")
    >> >> hist(out^4)
    >> 
    Robin> Program received signal EXC_BAD_ACCESS, Could not access memory.
    Robin> Reason: KERN_PROTECTION_FAILURE at address: 0x00000012
    Robin> R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
    Robin> 126             vt = v[i + 1];
    Robin> (gdb) bt
    Robin> #0  R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
    Robin> #1  0x0111e5d4 in do_qsort (call=0x1d0ed04, op=0x1, args=0x1d0b7f8,  
    Robin> rho=0x4) at qsort.c:89
    Robin> #2  0x010c9a1c in do_internal (call=0x1d0b7f8, op=0x1, args=0x0,  
    Robin> env=0x1d0c494) at names.c:1091
    Robin> #3  0x01099bb4 in Rf_eval (e=0x1d0ec94, rho=0x1d0c494) at eval.c:425
    Robin> #4  0x0109ba10 in do_set (call=0x1d0fb78, op=0x180a390,  
    Robin> args=0x1d0fb94, rho=0x1d0c494) at eval.c:1337
    Robin> #5  0x01099bb4 in Rf_eval (e=0x1d0fb78, rho=0x1d0c494) at eval.c:425
    Robin> #6  0x0109bc60 in do_begin (call=0x1d0fb40, op=0x180a2cc,  
    Robin> args=0x1d0fb5c, rho=0x1d0c494) at eval.c:1101
    Robin> #7  0x01099bb4 in Rf_eval (e=0x1d0fb40, rho=0x1d0c494) at eval.c:425
    Robin> #8  0x01099bb4 in Rf_eval (e=0x1d0fa44, rho=0x1d0c494) at eval.c:425
    Robin> #9  0x0109ba10 in do_set (call=0x1d0f9f0, op=0x180a390,  
    Robin> args=0x1d0fa0c, rho=0x1d0c494) at eval.c:1337
    Robin> #10 0x01099bb4 in Rf_eval (e=0x1d0f9f0, rho=0x1d0c494) at eval.c:425
    Robin> #11 0x0109bc60 in do_begin (call=0x1d0f5e4, op=0x180a2cc,  
    Robin> args=0x1d0f9d4, rho=0x1d0c494) at eval.c:1101
    Robin> #12 0x01099bb4 in Rf_eval (e=0x1d0f5e4, rho=0x1d0c494) at eval.c:425
    Robin> #13 0x01099bb4 in Rf_eval (e=0x1d0f520, rho=0x1d0c494) at eval.c:425
    Robin> #14 0x0109bc60 in do_begin (call=0x1d10f18, op=0x180a2cc,  
    Robin> args=0x1d0f504, rho=0x1d0c494) at eval.c:1101
    Robin> #15 0x01099bb4 in Rf_eval (e=0x1d10f18, rho=0x1d0c494) at eval.c:425
    Robin> #16 0x0109d0ac in Rf_applyClosure (call=0x1d1353c, op=0x1d10d58,  
    Robin> arglist=0x1d0d2ec, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
    Robin> #17 0x01099d94 in Rf_eval (e=0x1d1353c, rho=0x1d13830) at eval.c:456
    Robin> #18 0x0109b008 in Rf_DispatchOrEval (call=0x1d134cc, op=0x180b978,  
    Robin> generic=0x11d74d0 "[", args=0x1d13504, rho=0x1d13830, ans=0xbfffa248,  
    Robin> dropmissing=0, argsevald=0) at eval.c:1758
    Robin> #19 0x0115a828 in do_subset (call=0x1d134cc, op=0x180b978, args=0x0,  
    Robin> rho=0x1d13830) at subset.c:527
    Robin> #20 0x01099bb4 in Rf_eval (e=0x1d134cc, rho=0x1d13830) at eval.c:425
    Robin> #21 0x01099a5c in Rf_eval (e=0x1d118a0, rho=0x1d1192c) at eval.c:402
    Robin> #22 0x0109ae04 in Rf_evalList (el=0x1b4f9dc, rho=0x1d1192c) at eval.c: 
    Robin> 1417
    Robin> #23 0x010c9980 in do_internal (call=0x1b4f9dc, op=0x1,  
    Robin> args=0x1b4fa14, env=0x1d1192c) at names.c:1087
    Robin> #24 0x01099bb4 in Rf_eval (e=0x1b4fa30, rho=0x1d1192c) at eval.c:425
    Robin> #25 0x0109d0ac in Rf_applyClosure (call=0x1d13424, op=0x1b4fa84,  
    Robin> arglist=0x1d118bc, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
    Robin> #26 0x01099d94 in Rf_eval (e=0x1d13424, rho=0x1d13830) at eval.c:456
    Robin> #27 0x0109ae7c in Rf_evalList (el=0x1d13408, rho=0x1d13830) at eval.c: 
    Robin> 1427
    Robin> #28 0x01099c04 in Rf_eval (e=0x1d143b0, rho=0x1d13830) at eval.c:435
    Robin> #29 0x0109bc60 in do_begin (call=0x1d14378, op=0x180a2cc,  
    Robin> args=0x1d14394, rho=0x1d13830) at eval.c:1101
    Robin> #30 0x01099bb4 in Rf_eval (e=0x1d14378, rho=0x1d13830) at eval.c:425
    Robin> #31 0x01099bb4 in Rf_eval (e=0x1d140f4, rho=0x1d13830) at eval.c:425
    Robin> #32 0x0109bc60 in do_begin (call=0x1d14654, op=0x180a2cc,  
    Robin> args=0x1d140d8, rho=0x1d13830) at eval.c:1101
    Robin> #33 0x01099bb4 in Rf_eval (e=0x1d14654, rho=0x1d13830) at eval.c:425
    Robin> #34 0x0109d0ac in Rf_applyClosure (call=0x1fa96bc, op=0x1d15a7c,  
    Robin> arglist=0x1d137dc, rho=0x1d39024, suppliedenv=0x181d304) at eval.c:615
    Robin> #35 0x01099d94 in Rf_eval (e=0x1fa96bc, rho=0x1d39024) at eval.c:456
    Robin> #36 0x0109ae7c in Rf_evalList (el=0x1fa96a0, rho=0x1d39024) at eval.c: 
    Robin> 1427
    Robin> #37 0x01099c04 in Rf_eval (e=0x1fa9668, rho=0x1d39024) at eval.c:435
    Robin> #38 0x0109ba10 in do_set (call=0x1fa95c0, op=0x180a390,  
    Robin> args=0x1fa95dc, rho=0x1d39024) at eval.c:1337
    Robin> #39 0x01099bb4 in Rf_eval (e=0x1fa95c0, rho=0x1d39024) at eval.c:425
    Robin> #40 0x0109bc60 in do_begin (call=0x1facdc0, op=0x180a2cc,  
    Robin> args=0x1fa95a4, rho=0x1d39024) at eval.c:1101
    Robin> #41 0x01099bb4 in Rf_eval (e=0x1facdc0, rho=0x1d39024) at eval.c:425
    Robin> #42 0x0109d0ac in Rf_applyClosure (call=0x1d3a2c4, op=0x1fad6f4,  
    Robin> arglist=0x1d3a040, rho=0x1d3a094, suppliedenv=0x1d3a21c) at eval.c:615
    Robin> #43 0x010cc7e0 in Rf_usemethod (generic=0x1f69540 "hist",  
    Robin> obj=0x1fad6f4, call=0x2, args=0x4, rho=0x1d3a094, callrho=0x181d2e8,  
    Robin> defrho=0x2aa59f8, ans=0xbfffe148) at objects.c:311
    Robin> #44 0x010ccb20 in do_usemethod (call=0x1d3af24, op=0x1,  
    Robin> args=0x1d3af40, env=0x1d3a094) at objects.c:395
    Robin> #45 0x01099bb4 in Rf_eval (e=0x1d3af24, rho=0x1d3a094) at eval.c:425
    Robin> #46 0x0109d0ac in Rf_applyClosure (call=0x1d3b724, op=0x1d3ab88,  
    Robin> arglist=0x1d3a040, rho=0x181d2e8, suppliedenv=0x181d304) at eval.c:615
    Robin> #47 0x01099d94 in Rf_eval (e=0x1d3b724, rho=0x181d2e8) at eval.c:456
    Robin> #48 0x010b7d30 in Rf_ReplIteration (rho=0x181d2e8, savestack=0,  
    Robin> browselevel=0, state=0xbfffed88) at main.c:254
    Robin> #49 0x010b7e88 in R_ReplConsole (rho=0x181d2e8, savestack=0,  
    Robin> browselevel=0) at main.c:302
    Robin> #50 0x010b8198 in run_Rmainloop () at main.c:913
    Robin> #51 0x00002cec in main (ac=42293336, av=0x1) at Rmain.c:33
    Robin> (gdb)
    >> 
    >> 
    Robin> --
    Robin> Robin Hankin
    Robin> Uncertainty Analyst
    Robin> National Oceanography Centre, Southampton
    Robin> European Way, Southampton SO14 3ZH, UK
    Robin> tel  023-8059-7743
    >> 
    Robin> ______________________________________________
    Robin> R-devel at r-project.org mailing list
    Robin> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> 

    BDR> -- 
    BDR> Brian D. Ripley,                  ripley at stats.ox.ac.uk
    BDR> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
    BDR> University of Oxford,             Tel:  +44 1865 272861 (self)
    BDR> 1 South Parks Road,                     +44 1865 272866 (PA)
    BDR> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From r.hankin at noc.soton.ac.uk  Tue Jul 11 12:15:33 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Tue, 11 Jul 2006 11:15:33 +0100
Subject: [Rd] invalid alignment error in R-2.4.0
In-Reply-To: <Pine.LNX.4.64.0607111048300.12437@gannet.stats.ox.ac.uk>
References: <83E43F77-928F-4315-B311-0002B276A1F5@soc.soton.ac.uk>
	<17587.24696.569438.600090@stat.math.ethz.ch>
	<34CDD1D4-4F13-4411-8638-0E48451100D2@soc.soton.ac.uk>
	<17587.28594.327548.726315@stat.math.ethz.ch>
	<Pine.LNX.4.64.0607111048300.12437@gannet.stats.ox.ac.uk>
Message-ID: <292F827B-31C4-44C6-A7AC-24F138C3C336@soc.soton.ac.uk>

Hi

median(rep(1000,10)) does indeed give a similar error:


octopus:~/scratch% ./Rd/R.framework/Versions/2.4/Resources/bin/R -d gdb
GNU gdb 6.1-20040303 (Apple version gdb-434) (Wed Nov  2 17:28:16 GMT  
2005)
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and  
you are
welcome to change it and/or distribute copies of it under certain  
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for  
details.
This GDB was configured as "powerpc-apple-darwin"...Reading symbols  
for shared libraries ... done

(gdb) R
Starting program: /Users/rksh/scratch/Rd/R.framework/Versions/2.4/ 
Resources/bin/exec/R
Reading symbols for shared libraries ...................+ done

R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

Reading symbols for shared  
libraries ..........................................................  
done
Reading symbols for shared libraries . done
Reading symbols for shared libraries . done
 > median(rep(1000,10))

Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_PROTECTION_FAILURE at address: 0x00000012
R_qsort (v=0x2891c70, i=1, j=2) at qsort-body.c:126
126             vt = v[i + 1];
(gdb) bt
#0  R_qsort (v=0x2891c70, i=1, j=2) at qsort-body.c:126
#1  0x0111e5d4 in do_qsort (call=0x1d365d4, op=0x1, args=0x1d31de4,  
rho=0x4) at qsort.c:89
#2  0x010c9a1c in do_internal (call=0x1d31de4, op=0x1, args=0x0,  
env=0x1d331f0) at names.c:1091
#3  0x01099bb4 in Rf_eval (e=0x1d3659c, rho=0x1d331f0) at eval.c:425
#4  0x0109ba10 in do_set (call=0x1d36548, op=0x180a390,  
args=0x1d36564, rho=0x1d331f0) at eval.c:1337
#5  0x01099bb4 in Rf_eval (e=0x1d36548, rho=0x1d331f0) at eval.c:425
#6  0x0109bc60 in do_begin (call=0x1d36510, op=0x180a2cc,  
args=0x1d3652c, rho=0x1d331f0) at eval.c:1101
#7  0x01099bb4 in Rf_eval (e=0x1d36510, rho=0x1d331f0) at eval.c:425
#8  0x01099bb4 in Rf_eval (e=0x1d363c0, rho=0x1d331f0) at eval.c:425
#9  0x0109ba10 in do_set (call=0x1d3636c, op=0x180a390,  
args=0x1d36388, rho=0x1d331f0) at eval.c:1337
#10 0x01099bb4 in Rf_eval (e=0x1d3636c, rho=0x1d331f0) at eval.c:425
#11 0x0109bc60 in do_begin (call=0x1d36e44, op=0x180a2cc,  
args=0x1d36350, rho=0x1d331f0) at eval.c:1101
#12 0x01099bb4 in Rf_eval (e=0x1d36e44, rho=0x1d331f0) at eval.c:425
#13 0x01099bb4 in Rf_eval (e=0x1d36d80, rho=0x1d331f0) at eval.c:425
#14 0x0109bc60 in do_begin (call=0x1d385b8, op=0x180a2cc,  
args=0x1d36d48, rho=0x1d331f0) at eval.c:1101
#15 0x01099bb4 in Rf_eval (e=0x1d385b8, rho=0x1d331f0) at eval.c:425
#16 0x0109d0ac in Rf_applyClosure (call=0x1d3d6d0, op=0x1d38318,  
arglist=0x1d330bc, rho=0x1d3ca54, suppliedenv=0x181d304) at eval.c:615
#17 0x01099d94 in Rf_eval (e=0x1d3d6d0, rho=0x1d3ca54) at eval.c:456
#18 0x0109b008 in Rf_DispatchOrEval (call=0x1d3d698, op=0x180b978,  
generic=0x11d74d0 "[", args=0x1d3d6b4, rho=0x1d3ca54, ans=0xbfffc0f8,  
dropmissing=0, argsevald=0) at eval.c:1758
#19 0x0115a828 in do_subset (call=0x1d3d698, op=0x180b978, args=0x0,  
rho=0x1d3ca54) at subset.c:527
#20 0x01099bb4 in Rf_eval (e=0x1d3d698, rho=0x1d3ca54) at eval.c:425
#21 0x01099a5c in Rf_eval (e=0x1d38f5c, rho=0x1d38024) at eval.c:402
#22 0x0109ae04 in Rf_evalList (el=0x1b4f9dc, rho=0x1d38024) at eval.c: 
1417
#23 0x010c9980 in do_internal (call=0x1b4f9dc, op=0x1,  
args=0x1b4fa14, env=0x1d38024) at names.c:1087
#24 0x01099bb4 in Rf_eval (e=0x1b4fa30, rho=0x1d38024) at eval.c:425
#25 0x0109d0ac in Rf_applyClosure (call=0x1d3d660, op=0x1b4fa84,  
arglist=0x1d38f78, rho=0x1d3ca54, suppliedenv=0x181d304) at eval.c:615
#26 0x01099d94 in Rf_eval (e=0x1d3d660, rho=0x1d3ca54) at eval.c:456
#27 0x0109ae7c in Rf_evalList (el=0x1d3d644, rho=0x1d3ca54) at eval.c: 
1427
#28 0x01099c04 in Rf_eval (e=0x1d3d628, rho=0x1d3ca54) at eval.c:435
#29 0x0109bc60 in do_begin (call=0x1d3d5f0, op=0x180a2cc,  
args=0x1d3d60c, rho=0x1d3ca54) at eval.c:1101
#30 0x01099bb4 in Rf_eval (e=0x1d3d5f0, rho=0x1d3ca54) at eval.c:425
#31 0x01099bb4 in Rf_eval (e=0x1d3d2c4, rho=0x1d3ca54) at eval.c:425
#32 0x0109bc60 in do_begin (call=0x1d3dc24, op=0x180a2cc,  
args=0x1d3d2a8, rho=0x1d3ca54) at eval.c:1101
#33 0x01099bb4 in Rf_eval (e=0x1d3dc24, rho=0x1d3ca54) at eval.c:425
#34 0x0109d0ac in Rf_applyClosure (call=0x1d3ee00, op=0x1d3f0a0,  
arglist=0x1d3ca00, rho=0x181d2e8, suppliedenv=0x181d304) at eval.c:615
#35 0x01099d94 in Rf_eval (e=0x1d3ee00, rho=0x181d2e8) at eval.c:456
#36 0x010b7d30 in Rf_ReplIteration (rho=0x181d2e8, savestack=0,  
browselevel=0, state=0xbfffed88) at main.c:254
#37 0x010b7e88 in R_ReplConsole (rho=0x181d2e8, savestack=0,  
browselevel=0) at main.c:302
#38 0x010b8198 in run_Rmainloop () at main.c:913
#39 0x00002cec in main (ac=42540144, av=0x1) at Rmain.c:33
(gdb)





On 11 Jul 2006, at 10:54, Prof Brian Ripley wrote:

> On Tue, 11 Jul 2006, Martin Maechler wrote:
>
>> Hi Robin,
>>
>> thanks for the extra info.  I have no clue what the problem
>> might be.
>>
>> But from R-level debugging (and the R traceback you wrote
>> originally),
>> I assume you could trigger the problem already by a simple
>>
>>   median(rep(1000, 10))
>>
>> is that the case? If yes, please follow up on R-devel.
>
> I don't see why you assume so: there are multitudinous paths through
> qsort.
>
>> In any case, let's wait for others (Mac specialists and/or other
>> R-core members) to voice ideas.
>
> I checked this under valgrind, which normally shows up such errors,  
> and
> found nothing, even with gctorture on (and valgrind instrumentation of
> R's memory management on).
>
> You used the dput and Robin used load(), so presumably on not  
> exactly the
> same object.  I think Robin needs to test what he actually gave us,  
> to be
> sure.  If that is the case, I suspect the compiler.
>
>>
>>

--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From ripley at stats.ox.ac.uk  Tue Jul 11 14:20:17 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Jul 2006 13:20:17 +0100 (BST)
Subject: [Rd] often unnecessary duplicate in sapply / as.vector
In-Reply-To: <Pine.LNX.4.64.0607071652450.9075@homer23.u.washington.edu>
References: <6phlkr5lhf7.fsf@gopher1.fhcrc.org>
	<Pine.LNX.4.64.0607071652450.9075@homer23.u.washington.edu>
Message-ID: <Pine.LNX.4.64.0607111055000.12437@gannet.stats.ox.ac.uk>

On Fri, 7 Jul 2006, Thomas Lumley wrote:

> On Fri, 7 Jul 2006, Martin Morgan wrote:
> 
> > sapply calls lapply as
> >
> >    answer <- lapply(as.list(X), FUN, ...)
> >
> > which, when X is a list, causes X to be duplicated unnecessarily. The
> > coercion is unnecessary for other mode(X) because in lapply we have
> >
> >    if (!is.list(X)) X <- as.list(X)
> 
> That looks reasonable.

And you have made the change.  Unfortunately it is not really reasonable, 
as is.list(X) does not test that X is a list (see its documentation) in 
the same sense as as.list, so pairlists are now passed to the internal 
code.

There's something rather undesirable going on here.  The internal code for 
lapply (in its current version, not the one I wrote) does the internal 
equivalent of

    rval <- vector("list", length(X))
    for(i in seq(along = X))
        rval[i] <- list(FUN(X[[i]], ...))

from the earlier

lapply <- function(X, FUN, ...) {
    FUN <- match.fun(FUN)
    if (!is.list(X))
        X <- as.list(X)
    rval <- vector("list", length(X))
    for(i in seq(along = X))
        rval[i] <- list(FUN(X[[i]], ...))
    names(rval) <- names(X)               # keep `names' !
    return(rval)
}

so all that is needed is that X[[i]] work.

For a pairlist [[i]] done repeatedly is very inefficient (since it starts 
at the beginning each time), so we *do* want to coerce pairlists here.

On the other hand, we do not need to coerce expressions or atomic vectors 
for which [[]] works just fine.

> > More generally, perhaps as.vector might not duplicate when mode(x) == mode ?
> 
> This isn't a trivial change, because  mode(x)==mode does not guarantee 
> that as.vector(x, mode) has no effect.  For example, with mode="numeric" it 
> removes attributes.

And with mode="list" it does not (although that is not as documented).
We can certainly do better.  [This is another of those cases where 'mode' 
is confusing, and in fact it would be typeof(x) == mode.]

However, for now let us concentrate on as.list.default, which does

as.list.default <- function (x, ...)
{
    if (is.function(x))
	return(c(formals(x), list(body(x))))
    if (is.expression(x)) {
	n <- length(x)
	l <- vector("list", n)
	i <- 0
	for (sub in x) l[[i <- i + 1]] <- sub
	return(l)
    }
    .Internal(as.vector(x, "list"))
}

That's a bit strange, as an expression is internally a list, and it loses 
the names on the expression.  I intend to make as.list(x) return 
x unchanged if x is a list (not a pairlist), and to coerce expressions 
internally.

After that I will think about making as.vector and lapply make fewer 
copies.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Tue Jul 11 16:01:01 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 11 Jul 2006 07:01:01 -0700
Subject: [Rd] Add .git to SCM excludes for build and INSTALL scripts
In-Reply-To: <17587.25683.601407.261268@stat.math.ethz.ch> (Martin Maechler's
	message of "Tue, 11 Jul 2006 10:41:55 +0200")
References: <m2irm5th9z.fsf@fhcrc.org>
	<17587.25683.601407.261268@stat.math.ethz.ch>
Message-ID: <m2y7v0p7fm.fsf@ziti.local>

Martin Maechler <maechler at stat.math.ethz.ch> writes:
> I've committed the changes
> (BTW: for some reason your patch did not cleanly apply to
> build.in).

Thanks!  Sorry about the bad patch, not sure what happened; next time
around I will try harder to send something usable.

Best,

+ seth


From krc at mdacc.tmc.edu  Tue Jul 11 16:46:02 2006
From: krc at mdacc.tmc.edu (krc at mdacc.tmc.edu)
Date: Tue, 11 Jul 2006 16:46:02 +0200 (CEST)
Subject: [Rd] Sweave processes comments incorrectly (PR#9073)
Message-ID: <20060711144602.147F354AE1@slim.kubism.ku.dk>

Full_Name: Kevin R. Coombes
Version: 2.1.0
OS: Windows XP
Submission from: (NULL) (143.111.22.24)


I have a source file "devel.Rnw" that uses the LaTeX foils class and ppower4 to
produce a PDF presentation file.  It starts with a commented note to myself as
follows:

%%%% begin source example %%%%
%
%  Remember to update the hypersetup to include individual lecture
%  titles, change the leftheader to include the lecture title, and
%  then start at \begin{document} ....
%  Also, produce a printable (black and white version) according
%  to the cues immediately following \begin{document}.
%  Compile this document with:
%    pdflatex <filename>.tex
%  and then:
%    ppower4pb <filename>.pdf <filename>.pdf
%
\documentclass[Screen4to3,25pt,headrule,footrule]{foils}
\usepackage[pdftex]{color}                  %for colors
\definecolor{Teal}{rgb}{0.0,0.47,0.46}
%% more colors and packages omitted from bug report
\begin{document}
\hypersetup{pdfpagetransition=Replace}

%%%% end source example %%%%

When processed using Sweave, the \begin{document} comments are expanded to
actual LaTeX commands, causing a later latex to fail.  That is, the output of
running Sweave() on this file begins:

%%%% begin source example %%%%
%
%  Remember to update the hypersetup to include individual lecture
%  titles, change the leftheader to include the lecture title, and
%  then start at \usepackage{c:/R/rw2010/share/texmf/Sweave}
\begin{document} ....
%  Also, produce a printable (black and white version) according
%  to the cues immediately following
\usepackage{c:/R/rw2010/share/texmf/Sweave}
\begin{document}.
%  Compile this document with:
%    pdflatex <filename>.tex
%  and then:
%    ppower4pb <filename>.pdf <filename>.pdf
\documentclass[Screen4to3,25pt,headrule,footrule]{foils}
\usepackage[pdftex]{color}                  %for colors


From tlumley at u.washington.edu  Tue Jul 11 17:02:55 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 11 Jul 2006 08:02:55 -0700 (PDT)
Subject: [Rd] often unnecessary duplicate in sapply / as.vector
In-Reply-To: <Pine.LNX.4.64.0607111055000.12437@gannet.stats.ox.ac.uk>
References: <6phlkr5lhf7.fsf@gopher1.fhcrc.org>
	<Pine.LNX.4.64.0607071652450.9075@homer23.u.washington.edu>
	<Pine.LNX.4.64.0607111055000.12437@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0607110757561.15956@homer23.u.washington.edu>

On Tue, 11 Jul 2006, Prof Brian Ripley wrote:

> On Fri, 7 Jul 2006, Thomas Lumley wrote:
>
>> On Fri, 7 Jul 2006, Martin Morgan wrote:
>>
>>> sapply calls lapply as
>>>
>>>    answer <- lapply(as.list(X), FUN, ...)
>>>
>>> which, when X is a list, causes X to be duplicated unnecessarily. The
>>> coercion is unnecessary for other mode(X) because in lapply we have
>>>
>>>    if (!is.list(X)) X <- as.list(X)
>>
>> That looks reasonable.
>
> And you have made the change.  Unfortunately it is not really reasonable,
> as is.list(X) does not test that X is a list (see its documentation) in
> the same sense as as.list, so pairlists are now passed to the internal
> code.

Where do we still get pairlists in interpreted code? I thought they had 
all been hidden.

> There's something rather undesirable going on here.  The internal code for
> lapply (in its current version, not the one I wrote) does the internal
> equivalent of
>
>    rval <- vector("list", length(X))
>    for(i in seq(along = X))
>        rval[i] <- list(FUN(X[[i]], ...))
>
> from the earlier
>
> lapply <- function(X, FUN, ...) {
>    FUN <- match.fun(FUN)
>    if (!is.list(X))
>        X <- as.list(X)
>    rval <- vector("list", length(X))
>    for(i in seq(along = X))
>        rval[i] <- list(FUN(X[[i]], ...))
>    names(rval) <- names(X)               # keep `names' !
>    return(rval)
> }
>
> so all that is needed is that X[[i]] work.
>
> For a pairlist [[i]] done repeatedly is very inefficient (since it starts
> at the beginning each time), so we *do* want to coerce pairlists here.

Or have a separate loop using CDR and CAR rather than [[, which would mean 
not having to copy X.


> On the other hand, we do not need to coerce expressions or atomic vectors
> for which [[]] works just fine.

Indeed.

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ripley at stats.ox.ac.uk  Tue Jul 11 17:25:39 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Jul 2006 16:25:39 +0100 (BST)
Subject: [Rd] often unnecessary duplicate in sapply / as.vector
In-Reply-To: <Pine.LNX.4.64.0607110757561.15956@homer23.u.washington.edu>
References: <6phlkr5lhf7.fsf@gopher1.fhcrc.org>
	<Pine.LNX.4.64.0607071652450.9075@homer23.u.washington.edu>
	<Pine.LNX.4.64.0607111055000.12437@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.64.0607110757561.15956@homer23.u.washington.edu>
Message-ID: <Pine.LNX.4.64.0607111607190.29742@gannet.stats.ox.ac.uk>

On Tue, 11 Jul 2006, Thomas Lumley wrote:

> On Tue, 11 Jul 2006, Prof Brian Ripley wrote:
> 
> > On Fri, 7 Jul 2006, Thomas Lumley wrote:
> >
> > > On Fri, 7 Jul 2006, Martin Morgan wrote:
> > >
> > > > sapply calls lapply as
> > > >
> > > >    answer <- lapply(as.list(X), FUN, ...)
> > > >
> > > > which, when X is a list, causes X to be duplicated unnecessarily. The
> > > > coercion is unnecessary for other mode(X) because in lapply we have
> > > >
> > > >    if (!is.list(X)) X <- as.list(X)
> > >
> > > That looks reasonable.
> >
> > And you have made the change.  Unfortunately it is not really reasonable,
> > as is.list(X) does not test that X is a list (see its documentation) in
> > the same sense as as.list, so pairlists are now passed to the internal
> > code.
> 
> Where do we still get pairlists in interpreted code? I thought they had all
> been hidden.

Not quite all.  You can use pairlist() to create them, and .Options is one 
(fairly long) example.  (I used pairlist to create a very slow example.)

> > There's something rather undesirable going on here.  The internal code for
> > lapply (in its current version, not the one I wrote) does the internal
> > equivalent of
> >
> >    rval <- vector("list", length(X))
> >    for(i in seq(along = X))
> >        rval[i] <- list(FUN(X[[i]], ...))
> >
> > from the earlier
> >
> > lapply <- function(X, FUN, ...) {
> >    FUN <- match.fun(FUN)
> >    if (!is.list(X))
> >        X <- as.list(X)
> >    rval <- vector("list", length(X))
> >    for(i in seq(along = X))
> >        rval[i] <- list(FUN(X[[i]], ...))
> >    names(rval) <- names(X)               # keep `names' !
> >    return(rval)
> > }
> >
> > so all that is needed is that X[[i]] work.
> >
> > For a pairlist [[i]] done repeatedly is very inefficient (since it starts
> > at the beginning each time), so we *do* want to coerce pairlists here.
> 
> Or have a separate loop using CDR and CAR rather than [[, which would mean not
> having to copy X.

If we are going there we should also special-case all the (much more 
common) vector types thereby avoiding [[, which I have so far resisted.

> > On the other hand, we do not need to coerce expressions or atomic vectors
> > for which [[]] works just fine.
> 
> Indeed.

I've just committed a version that is a lot faster, fast enough to shave 
5% off the total time for both the stats and boot examples.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From dsamperi at DecisionSynergy.com  Tue Jul 11 17:44:09 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Tue, 11 Jul 2006 11:44:09 -0400
Subject: [Rd] RcppTemplate 4.0 with data frame support
Message-ID: <44B3C749.8050401@DecisionSynergy.com>

Data frame support has been added to the package
RcppTemplate 4.0, a template/class library that facilitates the
use of C++ libraries from R.

On the C++ side the code might look something like:

RcppFrame frame(fp); // Here fp is the input SEXP corresponding to an R 
data frame.
vector<vector<ColDatum> > table = frame.getTableData();
...
level = table[row][col].getFactorLevel();
name = table[row][col].getFactorName();
...

Thanks to Hin-Tak Leung and other users of this mailing list for
helpful comments.

The RcppTemplate package also contains detailed instructions on
using MinGW and MS Visual C++ under Windows.

ds


From plummer at iarc.fr  Tue Jul 11 19:39:22 2006
From: plummer at iarc.fr (Martyn Plummer)
Date: Tue, 11 Jul 2006 19:39:22 +0200
Subject: [Rd] [R] Date Format
In-Reply-To: <971536df0607110958x3c9596d7w19b2efb06cf25c26@mail.gmail.com>
References: <20060711162357.21469.qmail@web26309.mail.ukl.yahoo.com>
	<971536df0607110958x3c9596d7w19b2efb06cf25c26@mail.gmail.com>
Message-ID: <1152639562.2553.8.camel@seurat.iarc.fr>

I moved this to R-devel because I am wondering why the base package does
not allow you to convert from numeric to Date. Could we not have
something like this?

as.Date.numeric <- function(x, epoch="1970-01-01", ...) {
   if (!is.character(epoch) || length(epoch) != 1)
      stop("invalid epoch")
   as.Date(epoch, ...) + x
}

Martyn

On Tue, 2006-07-11 at 12:58 -0400, Gabor Grothendieck wrote:
> Try this:
> 
> library(zoo)
> as.Date(11328)
> 
> See the Help Desk article in R News 4/1 for more on dates.
> 
> 
> On 7/11/06, pierre clauss <pierreclauss at yahoo.fr> wrote:
> > Hi everybody,
> > I need your precious help for, I think, a simple request, but I do not manage to solve this.
> >
> > When I use a "table" function with dates in the rows, the rows are coerced to number after the table function.
> >
> > So I need to transform the row names into date format. But I do not manage.
> >
> > Therefore, for an example, I manage to write this :
> >
> > datetest<-"06/01/2001"
> > datetest<-as.Date(datetest,"%d/%m/%Y")
> > datetest<-as.numeric(datetest)
> >
> > to get 11328.
> >
> > But I do not obtain the inverse tranformation :
> >
> > datetest<-as.Date(datetest,"%d/%m/%Y")
> >
> > How do we get this please ?
> >
> > Thanks a lot for your solution.
> > Pierre.
> >
> >

-----------------------------------------------------------------------
This message and its attachments are strictly confidential. ...{{dropped}}


From p.dalgaard at biostat.ku.dk  Tue Jul 11 20:05:39 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 11 Jul 2006 20:05:39 +0200
Subject: [Rd] [R] Date Format
In-Reply-To: <1152639562.2553.8.camel@seurat.iarc.fr>
References: <20060711162357.21469.qmail@web26309.mail.ukl.yahoo.com>
	<971536df0607110958x3c9596d7w19b2efb06cf25c26@mail.gmail.com>
	<1152639562.2553.8.camel@seurat.iarc.fr>
Message-ID: <x2k66kxbik.fsf@turmalin.kubism.ku.dk>

Martyn Plummer <plummer at iarc.fr> writes:

> I moved this to R-devel because I am wondering why the base package does
> not allow you to convert from numeric to Date. Could we not have
> something like this?
> 
> as.Date.numeric <- function(x, epoch="1970-01-01", ...) {
>    if (!is.character(epoch) || length(epoch) != 1)
>       stop("invalid epoch")
>    as.Date(epoch, ...) + x
> }

We could, but you might as well do it explicitly. There's something to
be said for not confusing the concept of dates with a particular
implementation, which is effectively what happens if you can convert
them to and from numeric too seamlessly.

I'm more perplexed by the failure of adding difftimes to dates:

> as.Date("2006-1-1") + (as.Date("2006-1-1") - as.Date("2006-1-2"))
[1] "2005-12-31"
Warning message:
Incompatible methods ("+.Date", "Ops.difftime") for "+"

and if you have a difftime in non-days units, you'll  actually get a
wrong result:

> D1 <- as.Date("2006-1-1")
> D2 <- as.Date("2006-1-2")
> difftime(D2,D1,units="hours")
Time difference of 24 hours
> dd <- difftime(D2,D1,units="hours")
> D1+dd
[1] "2006-01-25"
Warning message:
Incompatible methods ("+.Date", "Ops.difftime") for "+"




> On Tue, 2006-07-11 at 12:58 -0400, Gabor Grothendieck wrote:
> > Try this:
> > 
> > library(zoo)
> > as.Date(11328)
> > 
> > See the Help Desk article in R News 4/1 for more on dates.
> > 
> > 
> > On 7/11/06, pierre clauss <pierreclauss at yahoo.fr> wrote:
> > > Hi everybody,
> > > I need your precious help for, I think, a simple request, but I do not manage to solve this.
> > >
> > > When I use a "table" function with dates in the rows, the rows are coerced to number after the table function.
> > >
> > > So I need to transform the row names into date format. But I do not manage.
> > >
> > > Therefore, for an example, I manage to write this :
> > >
> > > datetest<-"06/01/2001"
> > > datetest<-as.Date(datetest,"%d/%m/%Y")
> > > datetest<-as.numeric(datetest)
> > >
> > > to get 11328.
> > >
> > > But I do not obtain the inverse tranformation :
> > >
> > > datetest<-as.Date(datetest,"%d/%m/%Y")
> > >
> > > How do we get this please ?
> > >
> > > Thanks a lot for your solution.
> > > Pierre.
> > >
> > >
> 
> -----------------------------------------------------------------------
> This message and its attachments are strictly confidential. ...{{dropped}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From mbeason at harrahs.com  Tue Jul 11 20:30:35 2006
From: mbeason at harrahs.com (Matthew Beason)
Date: Tue, 11 Jul 2006 11:30:35 -0700
Subject: [Rd] Shared Library Support for AIX?
Message-ID: <E153C65077E0034E97A981C6CE26F1BD06ADAB17@ENTWMAIL1A.harrahs.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060711/910dc64f/attachment.pl 

From mpetrovich at comcast.net  Tue Jul 11 21:04:14 2006
From: mpetrovich at comcast.net (Michael Petrovich)
Date: Tue, 11 Jul 2006 15:04:14 -0400
Subject: [Rd] Converting SEXP to primitive C types
Message-ID: <45511595-A6F9-4230-A759-F5CE29612AEB@comcast.net>

I'm new to R development, so this may be a trivial question.

In C, How do you convert a SEXP value returned by an R function to a  
primitive C type (int, double, char, array, etc.)? I've tried using  
the INTEGER(x), VECTOR_ELT(x,i), and similar functions found in /src/ 
include/Rinternals.h, but doing so results in incorrect results or a  
seg-fault.

For example, I modified /tests/Embedding/Rerror.c so that it tries to  
print the value returned by the function defined in error.R:

val = Test_tryEval(e, &errorOccurred);
printf("Returned: {%d}\n", VECTOR_ELT(val, 0) );

Where error.R is contains:

foo <-
function(x=3, y=6)
{
   z <- x * y
   z
}

But the output is just "0", not the correct "18". Any ideas?

Thanks for your help!


From ripley at stats.ox.ac.uk  Tue Jul 11 21:17:40 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Jul 2006 20:17:40 +0100 (BST)
Subject: [Rd] Converting SEXP to primitive C types
In-Reply-To: <45511595-A6F9-4230-A759-F5CE29612AEB@comcast.net>
References: <45511595-A6F9-4230-A759-F5CE29612AEB@comcast.net>
Message-ID: <Pine.LNX.4.64.0607112013010.15720@gannet.stats.ox.ac.uk>

On Tue, 11 Jul 2006, Michael Petrovich wrote:

> I'm new to R development, so this may be a trivial question.
> 
> In C, How do you convert a SEXP value returned by an R function to a  
> primitive C type (int, double, char, array, etc.)? I've tried using  
> the INTEGER(x), VECTOR_ELT(x,i), and similar functions found in /src/ 
> include/Rinternals.h, but doing so results in incorrect results or a  
> seg-fault.

See `Writing R Extensions', the documentation for that file.  You cannot 
just guess that an object has the appropriate SEXPTYPE: you have to check 
it (or coerce to it).  In your example it is likely to be a REALSXP (it 
could be an INTSXP), so you need to cover all possible cases.

> For example, I modified /tests/Embedding/Rerror.c so that it tries to  
> print the value returned by the function defined in error.R:
> 
> val = Test_tryEval(e, &errorOccurred);
> printf("Returned: {%d}\n", VECTOR_ELT(val, 0) );
> 
> Where error.R is contains:
> 
> foo <-
> function(x=3, y=6)
> {
>    z <- x * y
>    z
> }
> 
> But the output is just "0", not the correct "18". Any ideas?
> 
> Thanks for your help!


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Jul 11 21:32:38 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Jul 2006 20:32:38 +0100 (BST)
Subject: [Rd] often unnecessary duplicate in sapply / as.vector
In-Reply-To: <Pine.LNX.4.64.0607111055000.12437@gannet.stats.ox.ac.uk>
References: <6phlkr5lhf7.fsf@gopher1.fhcrc.org>
	<Pine.LNX.4.64.0607071652450.9075@homer23.u.washington.edu>
	<Pine.LNX.4.64.0607111055000.12437@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0607112018020.15720@gannet.stats.ox.ac.uk>

On Tue, 11 Jul 2006, Prof Brian Ripley wrote:

> On Fri, 7 Jul 2006, Thomas Lumley wrote:

> > On Fri, 7 Jul 2006, Martin Morgan wrote:

[...]

> > > More generally, perhaps as.vector might not duplicate when mode(x) == mode ?
> > 
> > This isn't a trivial change, because  mode(x)==mode does not guarantee 
> > that as.vector(x, mode) has no effect.  For example, with mode="numeric" it 
> > removes attributes.
> 
> And with mode="list" it does not (although that is not as documented).
> We can certainly do better.  [This is another of those cases where 'mode' 
> is confusing, and in fact it would be typeof(x) == mode.]

Aargh: of course I should have guessed that quite a few people have 
written code that assumes that e.g. as.double() duplicates.  The first I 
came across is a .Fortran call in smooth.spline with DUP=FALSE which 
despite all the warnings changes its 'w' argument and hence the return 
result from smooth.spline if as.double is made more efficient.

I really have no desire to spend any more time tracking down problems 
caused by such rogue code, so I am going to leave this as is (with as.list 
somewhat more efficient but the as.vector functions always duplicating).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jh910 at juno.com  Tue Jul 11 22:52:04 2006
From: jh910 at juno.com (J. Hosking)
Date: Tue, 11 Jul 2006 16:52:04 -0400
Subject: [Rd] Dropping unused levels of a factor that has "NA" as a level
Message-ID: <e9131k$acu$1@sea.gmane.org>

Is this a bug?

   > f1 <- factor(c("a", NA), levels = c("a", "NA") )
   > f2 <- f1[, drop = TRUE]
   > f2
   [1] a    <NA>
   Levels: a <NA>

I would have expected f2 to have only one level, "a".  It seems
to me that the code in [.factor does not follow the advice in
help("factor") on how to set factor codes to be missing when
"NA" is a level of the factor.


J. R. M. Hosking


From mtmorgan at fhcrc.org  Tue Jul 11 23:27:54 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 11 Jul 2006 14:27:54 -0700
Subject: [Rd] often unnecessary duplicate in sapply / as.vector
In-Reply-To: <Pine.LNX.4.64.0607112018020.15720@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Tue, 11 Jul 2006 20:32:38 +0100 (BST)")
References: <6phlkr5lhf7.fsf@gopher1.fhcrc.org>
	<Pine.LNX.4.64.0607071652450.9075@homer23.u.washington.edu>
	<Pine.LNX.4.64.0607111055000.12437@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.64.0607112018020.15720@gannet.stats.ox.ac.uk>
Message-ID: <6phfyh7al2d.fsf@gopher1.fhcrc.org>

This is because RObjToCPtr is not quite careful enough with NAMED,
rather than an issue with as.XXX

tmp.c: void tmp(double *x) { x[0]=1; return; }

> f <- function(x) x
> x <- 0
> .C("tmp", f(x), DUP=FALSE)
[[1]]
[1] 1

> x
[1] 1

> x <- 0
> y <- x
> .C("tmp", x, DUP=FALSE)
[[1]]
[1] 1

> y
[1] 1

Martin

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> On Tue, 11 Jul 2006, Prof Brian Ripley wrote:
>
>> On Fri, 7 Jul 2006, Thomas Lumley wrote:
>
>> > On Fri, 7 Jul 2006, Martin Morgan wrote:
>
> [...]
>
>> > > More generally, perhaps as.vector might not duplicate when mode(x) == mode ?
>> > 
>> > This isn't a trivial change, because  mode(x)==mode does not guarantee 
>> > that as.vector(x, mode) has no effect.  For example, with mode="numeric" it 
>> > removes attributes.
>> 
>> And with mode="list" it does not (although that is not as documented).
>> We can certainly do better.  [This is another of those cases where 'mode' 
>> is confusing, and in fact it would be typeof(x) == mode.]
>
> Aargh: of course I should have guessed that quite a few people have 
> written code that assumes that e.g. as.double() duplicates.  The first I 
> came across is a .Fortran call in smooth.spline with DUP=FALSE which 
> despite all the warnings changes its 'w' argument and hence the return 
> result from smooth.spline if as.double is made more efficient.
>
> I really have no desire to spend any more time tracking down problems 
> caused by such rogue code, so I am going to leave this as is (with as.list 
> somewhat more efficient but the as.vector functions always duplicating).
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From tlumley at u.washington.edu  Tue Jul 11 23:51:55 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 11 Jul 2006 14:51:55 -0700 (PDT)
Subject: [Rd] often unnecessary duplicate in sapply / as.vector
In-Reply-To: <6phfyh7al2d.fsf@gopher1.fhcrc.org>
References: <6phlkr5lhf7.fsf@gopher1.fhcrc.org>
	<Pine.LNX.4.64.0607071652450.9075@homer23.u.washington.edu>
	<Pine.LNX.4.64.0607111055000.12437@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.64.0607112018020.15720@gannet.stats.ox.ac.uk>
	<6phfyh7al2d.fsf@gopher1.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0607111448490.11869@homer21.u.washington.edu>

On Tue, 11 Jul 2006, Martin Morgan wrote:

> This is because RObjToCPtr is not quite careful enough with NAMED,
> rather than an issue with as.XXX

But DUP=FALSE is documented to be dangerous for this very reason. It never 
copies, and ?.C makes it clear that .C(,DUP=FALSE) can modify variables 
that it should not have any access to by normal rules.  The example of 
safe use modifies only a newly created, anonymous numeric vector.

 	-thomas

>
> tmp.c: void tmp(double *x) { x[0]=1; return; }
>
>> f <- function(x) x
>> x <- 0
>> .C("tmp", f(x), DUP=FALSE)
> [[1]]
> [1] 1
>
>> x
> [1] 1
>
>> x <- 0
>> y <- x
>> .C("tmp", x, DUP=FALSE)
> [[1]]
> [1] 1
>
>> y
> [1] 1
>
> Martin
>
> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> On Tue, 11 Jul 2006, Prof Brian Ripley wrote:
>>
>>> On Fri, 7 Jul 2006, Thomas Lumley wrote:
>>
>>>> On Fri, 7 Jul 2006, Martin Morgan wrote:
>>
>> [...]
>>
>>>>> More generally, perhaps as.vector might not duplicate when mode(x) == mode ?
>>>>
>>>> This isn't a trivial change, because  mode(x)==mode does not guarantee
>>>> that as.vector(x, mode) has no effect.  For example, with mode="numeric" it
>>>> removes attributes.
>>>
>>> And with mode="list" it does not (although that is not as documented).
>>> We can certainly do better.  [This is another of those cases where 'mode'
>>> is confusing, and in fact it would be typeof(x) == mode.]
>>
>> Aargh: of course I should have guessed that quite a few people have
>> written code that assumes that e.g. as.double() duplicates.  The first I
>> came across is a .Fortran call in smooth.spline with DUP=FALSE which
>> despite all the warnings changes its 'w' argument and hence the return
>> result from smooth.spline if as.double is made more efficient.
>>
>> I really have no desire to spend any more time tracking down problems
>> caused by such rogue code, so I am going to leave this as is (with as.list
>> somewhat more efficient but the as.vector functions always duplicating).
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From p.dalgaard at biostat.ku.dk  Tue Jul 11 23:58:51 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 11 Jul 2006 23:58:51 +0200
Subject: [Rd] Dropping unused levels of a factor that has "NA" as a level
In-Reply-To: <e9131k$acu$1@sea.gmane.org>
References: <e9131k$acu$1@sea.gmane.org>
Message-ID: <x2ac7fls6c.fsf@turmalin.kubism.ku.dk>

"J. Hosking" <jh910 at juno.com> writes:

> Is this a bug?
> 
>    > f1 <- factor(c("a", NA), levels = c("a", "NA") )
>    > f2 <- f1[, drop = TRUE]
>    > f2
>    [1] a    <NA>
>    Levels: a <NA>
> 
> I would have expected f2 to have only one level, "a".  It seems
> to me that the code in [.factor does not follow the advice in
> help("factor") on how to set factor codes to be missing when
> "NA" is a level of the factor.


Something odd is going on, that's for sure...

The problem is also there with factor(f1). And the logic in
as.character.factor seems to be at the root of it:

> as.character.factor
function (x, ...)
{
    cx <- levels(x)[x]
    if ("NA" %in% levels(x))
        cx[is.na(x)] <- "<NA>"
    cx
}
 
This looks like something from before we had character NA values. I
wonder if it is a mistake or there could actually be a reason to
keep it. 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From d.firth at warwick.ac.uk  Wed Jul 12 00:03:32 2006
From: d.firth at warwick.ac.uk (David Firth)
Date: Tue, 11 Jul 2006 23:03:32 +0100
Subject: [Rd] Linux/MacOSX and "X11 protocol error: BadWindow..." warnings
Message-ID: <200607112303.33080.d.firth@warwick.ac.uk>

This concerns behaviour which has been noted previously, for 
example see 

 http://tolstoy.newcastle.edu.au/R/help/05/03/0844.html
 http://tolstoy.newcastle.edu.au/R/help/03b/6873.html

and especially the thread

 http://tolstoy.newcastle.edu.au/R/help/04/08/3025.html

I find that it affects both my Linux and Mac OS X setups.  
It is a feature which has caused some (at least John Fox in 
the Rcmdr package) to make special moves to catch the 
warnings and hide them from users.

In an effort to pin it down, outside of Rcmdr or any 
packages other than tcltk itself, I came up with a simple 
reproducible example.  Essentially, the sequence that gives 
the warnings is
  tktoplevel()
[then close the Tk window using the window controls]
  X11()
  tktoplevel()
[then close the Tk window using the wondow controls]

Closing the second Tk window is the act that seems to 
provoke the warnings (see the two session transcripts 
below).  The number of warnings is different on my two 
systems, but I don't know whather that's to do with OS, or 
X11, or the two different versions of R, or what.

Without the call to X11(), I do not get the warnings.  And 
the call to X11() seemingly needs to come *after* the first 
tktoplevel() call in order for the warnings to be 
generated.

Unfortunately I do not have access to other systems on which 
to test this, or the necessary knowledge of X11, Tk etc to 
be able to debug it.  I am noting it here only in the hope 
that it might be useful to someone else on R-devel who is 
better placed to identify the likely cause(s).

best wishes,
David
-- 
Professor David Firth
http://www.warwick.ac.uk/go/dfirth


********* On Linux (SUSE 10.0) with R 2.3.1 ********
********* and xorg-x11 version 6.8.2-100    ********
david at blackbox2:~> R --vanilla

R : Copyright 2006, The R Foundation for Statistical 
Computing
Version 2.3.1 (2006-06-01)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> options(warn = 1)
> library(tcltk)
Loading Tcl/Tk interface ... done
> tktoplevel()
$ID
[1] ".1"

$env
<environment: 0x899ba30>

attr(,"class")
[1] "tkwin"
##  Now close the Tk window using window controls
> X11()
> tktoplevel()
$ID
[1] ".2"

$env
<environment: 0x86f8ff4>

attr(,"class")
[1] "tkwin"
##  Now close the Tk window using window controls
> Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)

> version
               _
platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status
major          2
minor          3.1
year           2006
month          06
day            01
svn rev        38247
language       R
version.string Version 2.3.1 (2006-06-01)



********* On Mac OS 10.4, using R 2.2.0 ********
david% R --vanilla

R : Copyright 2005, The R Foundation for Statistical 
Computing
Version 2.2.0  (2005-10-06 r35749)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for a HTML browser interface to help.
Type 'q()' to quit R.

> options(warn=1)
> library(tcltk)
Loading Tcl/Tk interface ... done
> tktoplevel()
$ID
[1] ".1"

$env
<environment: 0x28d2578>

attr(,"class")
[1] "tkwin"
##  Now close the Tk window using window controls
> X11()
> tktoplevel()
$ID
[1] ".2"

$env
<environment: 0x28f2a78>

attr(,"class")
[1] "tkwin"
##  Now close the Tk window using window controls
> Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)
Warning: X11 protocol error: BadWindow (invalid Window 
parameter)

> version
         _                        
platform powerpc-apple-darwin8.2.0
arch     powerpc                  
os       darwin8.2.0              
system   powerpc, darwin8.2.0     
status                            
major    2                        
minor    2.0                      
year     2005                     
month    10                       
day      06                       
svn rev  35749                    
language R


From David.Brahm at geodecapital.com  Wed Jul 12 00:19:40 2006
From: David.Brahm at geodecapital.com (Brahm, David)
Date: Tue, 11 Jul 2006 18:19:40 -0400
Subject: [Rd] Dropping unused levels of a factor that has "NA" as a level
Message-ID: <4DD6F8B8782D584FABF50BF3A32B03D806867D8C@MSGBOSCLF2WIN.DMN1.FMR.COM>

I mentioned this in R-help on April 28:
<https://stat.ethz.ch/pipermail/r-help/2006-April/104595.html>

| as.character.factor contains this line (where cx=levels(x)[x]):
|   if ("NA" %in% levels(x)) cx[is.na(x)] <- "<NA>"
|
| Is it possible that this is no longer the desired behavior?  These
| two results don't seem very consistent:
|
| > as.character(as.factor(c("AB", "CD", NA)))
| [1] "AB" "CD" NA  
| > is.na(.Last.value)[3]
| [1] TRUE
|
| > as.character(as.factor(c("NA", "CD", NA)))
| [1] "NA"   "CD"   "<NA>"
| > is.na(.Last.value)[3]
| [1] FALSE
|
| I'm using R-2.3.0 on Redhat Linux, but I don't think the behavior
| is new (maybe since character NA's were introduced?).
|
| -- David Brahm (brahm at alum.mit.edu)


-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Peter Dalgaard
Sent: Tuesday, July 11, 2006 5:59 PM
To: J. Hosking
Cc: r-devel at stat.math.ethz.ch
Subject: Re: [Rd] Dropping unused levels of a factor that has "NA" as a level

"J. Hosking" <jh910 at juno.com> writes:

> Is this a bug?
> 
>    > f1 <- factor(c("a", NA), levels = c("a", "NA") )
>    > f2 <- f1[, drop = TRUE]
>    > f2
>    [1] a    <NA>
>    Levels: a <NA>
> 
> I would have expected f2 to have only one level, "a".  It seems
> to me that the code in [.factor does not follow the advice in
> help("factor") on how to set factor codes to be missing when
> "NA" is a level of the factor.


Something odd is going on, that's for sure...

The problem is also there with factor(f1). And the logic in
as.character.factor seems to be at the root of it:

> as.character.factor
function (x, ...)
{
    cx <- levels(x)[x]
    if ("NA" %in% levels(x))
        cx[is.na(x)] <- "<NA>"
    cx
}
 
This looks like something from before we had character NA values. I
wonder if it is a mistake or there could actually be a reason to
keep it. 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From p.dalgaard at biostat.ku.dk  Wed Jul 12 00:57:02 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 12 Jul 2006 00:57:02 +0200
Subject: [Rd] Linux/MacOSX and "X11 protocol error: BadWindow..."
	warnings
In-Reply-To: <200607112303.33080.d.firth@warwick.ac.uk>
References: <200607112303.33080.d.firth@warwick.ac.uk>
Message-ID: <x264i3lphd.fsf@turmalin.kubism.ku.dk>

David Firth <d.firth at warwick.ac.uk> writes:

> In an effort to pin it down, outside of Rcmdr or any 
> packages other than tcltk itself, I came up with a simple 
> reproducible example.  Essentially, the sequence that gives 
> the warnings is
>   tktoplevel()
> [then close the Tk window using the window controls]
>   X11()
>   tktoplevel()
> [then close the Tk window using the wondow controls]
> 
> Closing the second Tk window is the act that seems to 
> provoke the warnings (see the two session transcripts 
> below).  The number of warnings is different on my two 
> systems, but I don't know whather that's to do with OS, or 
> X11, or the two different versions of R, or what.
> 
> Without the call to X11(), I do not get the warnings.  And 
> the call to X11() seemingly needs to come *after* the first 
> tktoplevel() call in order for the warnings to be 
> generated.
> 
> Unfortunately I do not have access to other systems on which 
> to test this, or the necessary knowledge of X11, Tk etc to 
> be able to debug it.  I am noting it here only in the hope 
> that it might be useful to someone else on R-devel who is 
> better placed to identify the likely cause(s).

I can reproduce this with on Fedora Core 5.

One might guess is that this has to do with the intertwining of the
two event loops. Not unlikely, the X11 event handler is discarding
some events that the Tcl/Tk event handler should have known about.
I've meddled with both, but it was many moons ago...


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From tim.bock at numbers.net.au  Wed Jul 12 07:52:35 2006
From: tim.bock at numbers.net.au (tim.bock at numbers.net.au)
Date: Wed, 12 Jul 2006 07:52:35 +0200 (CEST)
Subject: [Rd] read.spss() cannot import some SPSS files (PR#9074)
Message-ID: <20060712055235.49C1F53573@slim.kubism.ku.dk>

Full_Name: Tim Bock
Version: 2.3.1
OS: Windows XP
Submission from: (NULL) (220.233.111.181)


SPSS v12 on Windows sometimes writes files with a layout_code of 3 instead of
the usual layout_code of 2.  While I don't know what this signifies, R is able
to read these files if I change sfm-read.c to accept 3.

Also, R issues an unnecessary warning when it finds records of type 7 with
sub-type 7.  These records describe multiple-response sets, which can safely be
ignored.

Here are my suggested changes, based on the foreign_0.8-15.tar.gz.  (I'd be
happy to commit these via svn, but I assume that this is not allowed for
non-core developers.)

413a414
>               case 7: /* Multiple-response sets (later versions of 
SPSS). */
580a582
>   R_int32 orig_layout_code;
651c653
<   if (hdr.layout_code == 2)
---
>   if (hdr.layout_code == 2 || hdr.layout_code == 3)
654a657
>       orig_layout_code = hdr.layout_code;
656,658c659,661
<       if (hdr.layout_code != 2)
<       lose ((_("%s: File layout code has unexpected value %d.  Value 
should be 2, in big-endian or little-endian format"),
<              h->fn, hdr.layout_code));
---
>       if (hdr.layout_code != 2 && hdr.layout_code != 3)
>       lose ((_("%s: File layout code has unexpected value %d (or %d, 
endian-reversed).  Value should be 2 or 3, in big-endian or little-endian
format"),
>              h->fn, orig_layout_code, hdr.layout_code));


From ripley at stats.ox.ac.uk  Wed Jul 12 09:43:03 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 12 Jul 2006 08:43:03 +0100 (BST)
Subject: [Rd] Shared Library Support for AIX?
In-Reply-To: <E153C65077E0034E97A981C6CE26F1BD06ADAB17@ENTWMAIL1A.harrahs.org>
References: <E153C65077E0034E97A981C6CE26F1BD06ADAB17@ENTWMAIL1A.harrahs.org>
Message-ID: <Pine.LNX.4.64.0607111951290.15373@gannet.stats.ox.ac.uk>

We are waiting for the community of users of R on AIX to put in the 
resources needed to make this happen. 

We receive little help from AIX users of R (with the shining exception of 
Ei-ji Nakama), for example I cannot recall a single alpha/beta test report 
on that platform, and I would hope to recall several a year.  So it is 
mainly due to inspired guesswork that R compiles on AIX.

Given that apparently we are able to build libRlapack as a shared library 
on AIX, the same recipe should work for libR.  (As far as I recall the 
difficulty is getting a suitable export file from the motly collection of 
objects that make up this shared library.)  But this really needs someone 
with detailed knowledge of AIX linkers to tackle it, as quite possibly 
there is a better approach.

On Tue, 11 Jul 2006, Matthew Beason wrote:

> Fellow R Enthusiasts,
> 
> I noted on the "R Installation and Administration" page, section C.9
> that "--enable-R-shlib" is reported not to work for AIX. Has anyone made
> any further progress with this as of late? I've successfully compiled R
> 2.3.1 on AIX 5.2ML7 and AIX 5.3ML3. However, I'd really like to use
> RSPerl so I can attack R with Perl. Is there a way to do this without
> shared libraries enabled? 
> 
> Any thoughts, advice, pointers would be greatly appreciated. 
> 
> Matthew Beason
> Analyst - Capacity Planning
> Harrah's Entertainment, Inc.
> One Harrah's Court, Las Vegas, NV 89119-4312
> Office: 702-494-4097
> Mobile: 702-622-6902
> mbeason at harrahs.com
> The information contained in this email may be legally privileged and
> confidential. It is intended to be read only by the person to whom it is
> addressed. If you have received this in error or are not the intended
> recipient, please immediately notify the sender and delete all copies of
> this message. Thank you.
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From friedrich.leisch at stat.uni-muenchen.de  Wed Jul 12 11:02:14 2006
From: friedrich.leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Wed, 12 Jul 2006 11:02:14 +0200
Subject: [Rd] Sweave processes comments incorrectly (PR#9073)
In-Reply-To: <20060711144602.147F354AE1@slim.kubism.ku.dk>
References: <20060711144602.147F354AE1@slim.kubism.ku.dk>
Message-ID: <17588.47766.901402.985267@lxh5.stat.uni-muenchen.de>

>>>>> On Tue, 11 Jul 2006 16:46:02 +0200 (CEST),
>>>>> krc  (k) wrote:

  > Full_Name: Kevin R. Coombes
  > Version: 2.1.0
             ^^^^^

Please note that this version of R is very outdated, please only
report bugs which are verified for the most recent version of R (in
this case it was still there, though).


  > OS: Windows XP
  > Submission from: (NULL) (143.111.22.24)

  > I have a source file "devel.Rnw" that uses the LaTeX foils class and ppower4 to
  > produce a PDF presentation file.  It starts with a commented note to myself as
  > follows:

[...]


Thanks a lot for the bug report, fixed in r-patched and
r-devel.

Best,
Fritz


From plummer at iarc.fr  Wed Jul 12 11:10:39 2006
From: plummer at iarc.fr (Martyn Plummer)
Date: Wed, 12 Jul 2006 11:10:39 +0200
Subject: [Rd] [R] Date Format
In-Reply-To: <x2k66kxbik.fsf@turmalin.kubism.ku.dk>
References: <20060711162357.21469.qmail@web26309.mail.ukl.yahoo.com>
	<971536df0607110958x3c9596d7w19b2efb06cf25c26@mail.gmail.com>
	<1152639562.2553.8.camel@seurat.iarc.fr>
	<x2k66kxbik.fsf@turmalin.kubism.ku.dk>
Message-ID: <1152695439.2394.44.camel@seurat.iarc.fr>

On Tue, 2006-07-11 at 20:05 +0200, Peter Dalgaard wrote:
> Martyn Plummer <plummer at iarc.fr> writes:
> 
> > I moved this to R-devel because I am wondering why the base package does
> > not allow you to convert from numeric to Date. Could we not have
> > something like this?
> > 
> > as.Date.numeric <- function(x, epoch="1970-01-01", ...) {
> >    if (!is.character(epoch) || length(epoch) != 1)
> >       stop("invalid epoch")
> >    as.Date(epoch, ...) + x
> > }
> 
> We could, but you might as well do it explicitly. There's something to
> be said for not confusing the concept of dates with a particular
> implementation, which is effectively what happens if you can convert
> them to and from numeric too seamlessly.

Currently you can easily convert one way, but not the other. I just find
that a bit odd.

Pierre's problem was that his Date objects were converted internally by
some function.  His first instinct, to use as.Date to convert them back,
was, I think, correct. But that doesn't work. So now we say "You have to
understand how Date objects are implemented to get your dates back"? I
don't know about that.

> I'm more perplexed by the failure of adding difftimes to dates:
> 
> > as.Date("2006-1-1") + (as.Date("2006-1-1") - as.Date("2006-1-2"))
> [1] "2005-12-31"
> Warning message:
> Incompatible methods ("+.Date", "Ops.difftime") for "+"
> 
> and if you have a difftime in non-days units, you'll  actually get a
> wrong result:
> 
> > D1 <- as.Date("2006-1-1")
> > D2 <- as.Date("2006-1-2")
> > difftime(D2,D1,units="hours")
> Time difference of 24 hours
> > dd <- difftime(D2,D1,units="hours")
> > D1+dd
> [1] "2006-01-25"
> Warning message:
> Incompatible methods ("+.Date", "Ops.difftime") for "+"

[I raised this problem earlier in private discussions with Peter]

It certainly is perplexing. There is code in "+.Date" that correctly
handles the case where the second argument is a difftime. But it will
never get called! I wonder if it ever worked.

The warning is coming from DispatchGroup (in eval.c). When it finds
different methods for two arguments of a binary group generic, it gives
up and the default method is called - in this case R_binary in
arithmetic.c - which is why the results depends on the implementation of
the difftime object.

I guessed that this was a limitation of S3 generics, and I suppose I was
right.  To allow mixing arguments of two classes, you would need code in
Ops.foo to handle objects of class bar *and* vice versa.  It's a bad
idea to have two separate bits of code to do the same job, so I can't
fault the logic of forbidding this, but it does leave us with some
usability problems.

While we are on the topic, is there no function to convert a difftime
object from one time scale to another? I found a couple of private
functions, but nothing public.

Martyn



> > On Tue, 2006-07-11 at 12:58 -0400, Gabor Grothendieck wrote:
> > > Try this:
> > > 
> > > library(zoo)
> > > as.Date(11328)
> > > 
> > > See the Help Desk article in R News 4/1 for more on dates.
> > > 
> > > 
> > > On 7/11/06, pierre clauss <pierreclauss at yahoo.fr> wrote:
> > > > Hi everybody,
> > > > I need your precious help for, I think, a simple request, but I do not manage to solve this.
> > > >
> > > > When I use a "table" function with dates in the rows, the rows are coerced to number after the table function.
> > > >
> > > > So I need to transform the row names into date format. But I do not manage.
> > > >
> > > > Therefore, for an example, I manage to write this :
> > > >
> > > > datetest<-"06/01/2001"
> > > > datetest<-as.Date(datetest,"%d/%m/%Y")
> > > > datetest<-as.numeric(datetest)
> > > >
> > > > to get 11328.
> > > >
> > > > But I do not obtain the inverse tranformation :
> > > >
> > > > datetest<-as.Date(datetest,"%d/%m/%Y")
> > > >
> > > > How do we get this please ?
> > > >
> > > > Thanks a lot for your solution.
> > > > Pierre.
> > > >
> > > >
> > 
> > -----------------------------------------------------------------------
> > This message and its attachments are strictly confidential. ...{{dropped}}
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
> 

-----------------------------------------------------------------------
This message and its attachments are strictly confidential. ...{{dropped}}


From ripley at stats.ox.ac.uk  Wed Jul 12 11:50:54 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 12 Jul 2006 10:50:54 +0100 (BST)
Subject: [Rd] [R] Date Format
In-Reply-To: <1152695439.2394.44.camel@seurat.iarc.fr>
References: <20060711162357.21469.qmail@web26309.mail.ukl.yahoo.com>
	<971536df0607110958x3c9596d7w19b2efb06cf25c26@mail.gmail.com>
	<1152639562.2553.8.camel@seurat.iarc.fr>
	<x2k66kxbik.fsf@turmalin.kubism.ku.dk>
	<1152695439.2394.44.camel@seurat.iarc.fr>
Message-ID: <Pine.LNX.4.64.0607121047480.23402@gannet.stats.ox.ac.uk>

On Wed, 12 Jul 2006, Martyn Plummer wrote:

> On Tue, 2006-07-11 at 20:05 +0200, Peter Dalgaard wrote:
> > Martyn Plummer <plummer at iarc.fr> writes:
> > 
> > > I moved this to R-devel because I am wondering why the base package does
> > > not allow you to convert from numeric to Date. Could we not have
> > > something like this?
> > > 
> > > as.Date.numeric <- function(x, epoch="1970-01-01", ...) {
> > >    if (!is.character(epoch) || length(epoch) != 1)
> > >       stop("invalid epoch")
> > >    as.Date(epoch, ...) + x
> > > }
> > 
> > We could, but you might as well do it explicitly. There's something to
> > be said for not confusing the concept of dates with a particular
> > implementation, which is effectively what happens if you can convert
> > them to and from numeric too seamlessly.
> 
> Currently you can easily convert one way, but not the other. I just find
> that a bit odd.
> 
> Pierre's problem was that his Date objects were converted internally by
> some function.  His first instinct, to use as.Date to convert them back,
> was, I think, correct. But that doesn't work. So now we say "You have to
> understand how Date objects are implemented to get your dates back"? I
> don't know about that.

I agree with what we say: it was deliberate not to interpret plain 
numbers.

> > I'm more perplexed by the failure of adding difftimes to dates:
> > 
> > > as.Date("2006-1-1") + (as.Date("2006-1-1") - as.Date("2006-1-2"))
> > [1] "2005-12-31"
> > Warning message:
> > Incompatible methods ("+.Date", "Ops.difftime") for "+"
> > 
> > and if you have a difftime in non-days units, you'll  actually get a
> > wrong result:
> > 
> > > D1 <- as.Date("2006-1-1")
> > > D2 <- as.Date("2006-1-2")
> > > difftime(D2,D1,units="hours")
> > Time difference of 24 hours
> > > dd <- difftime(D2,D1,units="hours")
> > > D1+dd
> > [1] "2006-01-25"
> > Warning message:
> > Incompatible methods ("+.Date", "Ops.difftime") for "+"
> 
> [I raised this problem earlier in private discussions with Peter]
> 
> It certainly is perplexing. There is code in "+.Date" that correctly
> handles the case where the second argument is a difftime. But it will
> never get called! I wonder if it ever worked.

Yes, it worked before Ops.difftime was added.

> The warning is coming from DispatchGroup (in eval.c). When it finds
> different methods for two arguments of a binary group generic, it gives
> up and the default method is called - in this case R_binary in
> arithmetic.c - which is why the results depends on the implementation of
> the difftime object.
> 
> I guessed that this was a limitation of S3 generics, and I suppose I was
> right.  To allow mixing arguments of two classes, you would need code in
> Ops.foo to handle objects of class bar *and* vice versa.  It's a bad
> idea to have two separate bits of code to do the same job, so I can't
> fault the logic of forbidding this, but it does leave us with some
> usability problems.
> 
> While we are on the topic, is there no function to convert a difftime
> object from one time scale to another? I found a couple of private
> functions, but nothing public.

There is none: the intention is that the user should leave this to the 
functions he uses.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Wed Jul 12 14:49:14 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 12 Jul 2006 08:49:14 -0400
Subject: [Rd] invalid alignment error in R-2.4.0
In-Reply-To: <34CDD1D4-4F13-4411-8638-0E48451100D2@soc.soton.ac.uk>
References: <83E43F77-928F-4315-B311-0002B276A1F5@soc.soton.ac.uk>
	<17587.24696.569438.600090@stat.math.ethz.ch>
	<34CDD1D4-4F13-4411-8638-0E48451100D2@soc.soton.ac.uk>
Message-ID: <2BB25965-A0EA-49D5-882E-EB7C43D2407A@r-project.org>

Robin,

how did you compile your R? I know that old gcc 4 (as supplied by  
Apple) did indeed produce invalid code in quicksort that segfaulted,  
however, that was on an Intel Mac. You may want to use gcc 4.0.3 or  
later instead and see whether the problem is gone - R-devel from  
http://r.research.att.com/ is compiled with gcc 4.0.3 and it doesn't  
exhibit this behavior.

Cheers,
Simon

On Jul 11, 2006, at 5:04 AM, Robin Hankin wrote:

> Hi Martin
>
>
> On 11 Jul 2006, at 09:25, Martin Maechler wrote:
>
>> I assume this is specific to your installation of R-devel
>> (R-2.4.0 "unstable").  If I use your 'out',
>>    hist(out^4, col = "gray")
>> works just fine consistently.
>>
>> Could it be a compiler / linker mismatch
>> on your Mac?  Also, can you run "under the debugger"
>>    'R -d gdb' (from a commandline) ?
>>
>> This should allow a traceback ('backtrace', abbreviated 'bt' in  
>> "gdb")
>> of the C call stack.
>
>
>
> transcript follows:
>
>
> octopus:~/scratch% ./Rd/R.framework/Versions/2.4/Resources/bin/R -d  
> gdb
> GNU gdb 6.1-20040303 (Apple version gdb-434) (Wed Nov  2 17:28:16 GMT
> 2005)
> Copyright 2004 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and
> you are
> welcome to change it and/or distribute copies of it under certain
> conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for
> details.
> This GDB was configured as "powerpc-apple-darwin"...Reading symbols
> for shared libraries ... done
>
> (gdb) R
> Starting program: /Users/rksh/scratch/Rd/R.framework/Versions/2.4/
> Resources/bin/exec/R
> Reading symbols for shared libraries ...................+ done
>
> R version 2.4.0 Under development (unstable) (2006-07-09 r38523)
> Copyright (C) 2006 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
> Reading symbols for shared
> libraries ..........................................................
> done
> Reading symbols for shared libraries . done
> Reading symbols for shared libraries . done
>> load("~/f")
>> hist(out^4)
>
> Program received signal EXC_BAD_ACCESS, Could not access memory.
> Reason: KERN_PROTECTION_FAILURE at address: 0x00000012
> R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
> 126             vt = v[i + 1];
> (gdb) bt
> #0  R_qsort (v=0x2855858, i=1, j=2) at qsort-body.c:126
> #1  0x0111e5d4 in do_qsort (call=0x1d0ed04, op=0x1, args=0x1d0b7f8,
> rho=0x4) at qsort.c:89
> #2  0x010c9a1c in do_internal (call=0x1d0b7f8, op=0x1, args=0x0,
> env=0x1d0c494) at names.c:1091
> #3  0x01099bb4 in Rf_eval (e=0x1d0ec94, rho=0x1d0c494) at eval.c:425
> #4  0x0109ba10 in do_set (call=0x1d0fb78, op=0x180a390,
> args=0x1d0fb94, rho=0x1d0c494) at eval.c:1337
> #5  0x01099bb4 in Rf_eval (e=0x1d0fb78, rho=0x1d0c494) at eval.c:425
> #6  0x0109bc60 in do_begin (call=0x1d0fb40, op=0x180a2cc,
> args=0x1d0fb5c, rho=0x1d0c494) at eval.c:1101
> #7  0x01099bb4 in Rf_eval (e=0x1d0fb40, rho=0x1d0c494) at eval.c:425
> #8  0x01099bb4 in Rf_eval (e=0x1d0fa44, rho=0x1d0c494) at eval.c:425
> #9  0x0109ba10 in do_set (call=0x1d0f9f0, op=0x180a390,
> args=0x1d0fa0c, rho=0x1d0c494) at eval.c:1337
> #10 0x01099bb4 in Rf_eval (e=0x1d0f9f0, rho=0x1d0c494) at eval.c:425
> #11 0x0109bc60 in do_begin (call=0x1d0f5e4, op=0x180a2cc,
> args=0x1d0f9d4, rho=0x1d0c494) at eval.c:1101
> #12 0x01099bb4 in Rf_eval (e=0x1d0f5e4, rho=0x1d0c494) at eval.c:425
> #13 0x01099bb4 in Rf_eval (e=0x1d0f520, rho=0x1d0c494) at eval.c:425
> #14 0x0109bc60 in do_begin (call=0x1d10f18, op=0x180a2cc,
> args=0x1d0f504, rho=0x1d0c494) at eval.c:1101
> #15 0x01099bb4 in Rf_eval (e=0x1d10f18, rho=0x1d0c494) at eval.c:425
> #16 0x0109d0ac in Rf_applyClosure (call=0x1d1353c, op=0x1d10d58,
> arglist=0x1d0d2ec, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
> #17 0x01099d94 in Rf_eval (e=0x1d1353c, rho=0x1d13830) at eval.c:456
> #18 0x0109b008 in Rf_DispatchOrEval (call=0x1d134cc, op=0x180b978,
> generic=0x11d74d0 "[", args=0x1d13504, rho=0x1d13830, ans=0xbfffa248,
> dropmissing=0, argsevald=0) at eval.c:1758
> #19 0x0115a828 in do_subset (call=0x1d134cc, op=0x180b978, args=0x0,
> rho=0x1d13830) at subset.c:527
> #20 0x01099bb4 in Rf_eval (e=0x1d134cc, rho=0x1d13830) at eval.c:425
> #21 0x01099a5c in Rf_eval (e=0x1d118a0, rho=0x1d1192c) at eval.c:402
> #22 0x0109ae04 in Rf_evalList (el=0x1b4f9dc, rho=0x1d1192c) at eval.c:
> 1417
> #23 0x010c9980 in do_internal (call=0x1b4f9dc, op=0x1,
> args=0x1b4fa14, env=0x1d1192c) at names.c:1087
> #24 0x01099bb4 in Rf_eval (e=0x1b4fa30, rho=0x1d1192c) at eval.c:425
> #25 0x0109d0ac in Rf_applyClosure (call=0x1d13424, op=0x1b4fa84,
> arglist=0x1d118bc, rho=0x1d13830, suppliedenv=0x181d304) at eval.c:615
> #26 0x01099d94 in Rf_eval (e=0x1d13424, rho=0x1d13830) at eval.c:456
> #27 0x0109ae7c in Rf_evalList (el=0x1d13408, rho=0x1d13830) at eval.c:
> 1427
> #28 0x01099c04 in Rf_eval (e=0x1d143b0, rho=0x1d13830) at eval.c:435
> #29 0x0109bc60 in do_begin (call=0x1d14378, op=0x180a2cc,
> args=0x1d14394, rho=0x1d13830) at eval.c:1101
> #30 0x01099bb4 in Rf_eval (e=0x1d14378, rho=0x1d13830) at eval.c:425
> #31 0x01099bb4 in Rf_eval (e=0x1d140f4, rho=0x1d13830) at eval.c:425
> #32 0x0109bc60 in do_begin (call=0x1d14654, op=0x180a2cc,
> args=0x1d140d8, rho=0x1d13830) at eval.c:1101
> #33 0x01099bb4 in Rf_eval (e=0x1d14654, rho=0x1d13830) at eval.c:425
> #34 0x0109d0ac in Rf_applyClosure (call=0x1fa96bc, op=0x1d15a7c,
> arglist=0x1d137dc, rho=0x1d39024, suppliedenv=0x181d304) at eval.c:615
> #35 0x01099d94 in Rf_eval (e=0x1fa96bc, rho=0x1d39024) at eval.c:456
> #36 0x0109ae7c in Rf_evalList (el=0x1fa96a0, rho=0x1d39024) at eval.c:
> 1427
> #37 0x01099c04 in Rf_eval (e=0x1fa9668, rho=0x1d39024) at eval.c:435
> #38 0x0109ba10 in do_set (call=0x1fa95c0, op=0x180a390,
> args=0x1fa95dc, rho=0x1d39024) at eval.c:1337
> #39 0x01099bb4 in Rf_eval (e=0x1fa95c0, rho=0x1d39024) at eval.c:425
> #40 0x0109bc60 in do_begin (call=0x1facdc0, op=0x180a2cc,
> args=0x1fa95a4, rho=0x1d39024) at eval.c:1101
> #41 0x01099bb4 in Rf_eval (e=0x1facdc0, rho=0x1d39024) at eval.c:425
> #42 0x0109d0ac in Rf_applyClosure (call=0x1d3a2c4, op=0x1fad6f4,
> arglist=0x1d3a040, rho=0x1d3a094, suppliedenv=0x1d3a21c) at eval.c:615
> #43 0x010cc7e0 in Rf_usemethod (generic=0x1f69540 "hist",
> obj=0x1fad6f4, call=0x2, args=0x4, rho=0x1d3a094, callrho=0x181d2e8,
> defrho=0x2aa59f8, ans=0xbfffe148) at objects.c:311
> #44 0x010ccb20 in do_usemethod (call=0x1d3af24, op=0x1,
> args=0x1d3af40, env=0x1d3a094) at objects.c:395
> #45 0x01099bb4 in Rf_eval (e=0x1d3af24, rho=0x1d3a094) at eval.c:425
> #46 0x0109d0ac in Rf_applyClosure (call=0x1d3b724, op=0x1d3ab88,
> arglist=0x1d3a040, rho=0x181d2e8, suppliedenv=0x181d304) at eval.c:615
> #47 0x01099d94 in Rf_eval (e=0x1d3b724, rho=0x181d2e8) at eval.c:456
> #48 0x010b7d30 in Rf_ReplIteration (rho=0x181d2e8, savestack=0,
> browselevel=0, state=0xbfffed88) at main.c:254
> #49 0x010b7e88 in R_ReplConsole (rho=0x181d2e8, savestack=0,
> browselevel=0) at main.c:302
> #50 0x010b8198 in run_Rmainloop () at main.c:913
> #51 0x00002cec in main (ac=42293336, av=0x1) at Rmain.c:33
> (gdb)
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From hin-tak.leung at cimr.cam.ac.uk  Wed Jul 12 15:59:53 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 12 Jul 2006 14:59:53 +0100
Subject: [Rd] Converting SEXP to primitive C types
In-Reply-To: <45511595-A6F9-4230-A759-F5CE29612AEB@comcast.net>
References: <45511595-A6F9-4230-A759-F5CE29612AEB@comcast.net>
Message-ID: <44B50059.1060101@cimr.cam.ac.uk>

Michael Petrovich wrote:
> I'm new to R development, so this may be a trivial question.
> 
> In C, How do you convert a SEXP value returned by an R function to a  
> primitive C type (int, double, char, array, etc.)? I've tried using  
> the INTEGER(x), VECTOR_ELT(x,i), and similar functions found in /src/ 
> include/Rinternals.h, but doing so results in incorrect results or a  
> seg-fault.
> 
> For example, I modified /tests/Embedding/Rerror.c so that it tries to  
> print the value returned by the function defined in error.R:
> 
> val = Test_tryEval(e, &errorOccurred);
> printf("Returned: {%d}\n", VECTOR_ELT(val, 0) );

Prof Ripley had already pointed you to the "Writing R extensions" 
manual, which explains this stuff in more details, and also hinted
that most probably it is REALSXP instead of yours guesses. So I am just 
going to give a somewhat concrete example - you want to be
doing something like this instead:

val = Test_tryEval(e, &errorOccurred);

switch( TYPEOF(val) ) {
case REALSXP:
printf("Returned: {%f}\n", REAL(val)[0]);
break;
case INTSXP:
printf("Returned: {%d}\n", INTEGER(val)[0]);
break;
case STRSXP:
printf("Returned: {%s}\n", CHAR(STRING_ELT(val, 0)));
break;
default:
printf("Don't know what to do about type %d\n", TYPEOF(val));
}

> 
> Where error.R is contains:
> 
> foo <-
> function(x=3, y=6)
> {
>    z <- x * y
>    z
> }
> 
> But the output is just "0", not the correct "18". Any ideas?
> 
> Thanks for your help!
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jake_f_wilson at hotmail.com  Wed Jul 12 15:56:23 2006
From: jake_f_wilson at hotmail.com (jake wilson)
Date: Wed, 12 Jul 2006 08:56:23 -0500
Subject: [Rd] string-length limitations
Message-ID: <BAY117-F21568A2FDDAC9E7B81D14BAC690@phx.gbl>

Hi,

I'm attempting to "glm" a formula - something that's not caused problems in 
the past.  I've used formulas of the form

    formula( "dependant-variable~independant-variables" )

where the independant variable string is of the form:

    "indvar1+indvar2+...+indvarN"

Now, however, our independant variable strings are quite long (hundreds of 
variables) - R dies with an "input buffer overflow" error.  I've tried 
writing out the code to files and sourcing them, as well as building the 
strings incrementally in R, but these have not worked either.  I have come 
to believe there is a maximum length for char strings - some sort of 
fundamental limitation.  Is there such a max-length and, if so, is there a 
way I can work with long strings of the sort referenced above?

Thank you,
J. Wilson


From tlumley at u.washington.edu  Wed Jul 12 16:37:29 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 12 Jul 2006 07:37:29 -0700 (PDT)
Subject: [Rd] string-length limitations
In-Reply-To: <BAY117-F21568A2FDDAC9E7B81D14BAC690@phx.gbl>
References: <BAY117-F21568A2FDDAC9E7B81D14BAC690@phx.gbl>
Message-ID: <Pine.LNX.4.64.0607120730360.23250@homer22.u.washington.edu>

On Wed, 12 Jul 2006, jake wilson wrote:
> I'm attempting to "glm" a formula - something that's not caused problems in
> the past.  I've used formulas of the form
>
>    formula( "dependant-variable~independant-variables" )
>
> where the independant variable string is of the form:
>
>    "indvar1+indvar2+...+indvarN"
>
> Now, however, our independant variable strings are quite long (hundreds of
> variables) - R dies with an "input buffer overflow" error.  I've tried
> writing out the code to files and sourcing them, as well as building the
> strings incrementally in R, but these have not worked either.  I have come
> to believe there is a maximum length for char strings - some sort of
> fundamental limitation.  Is there such a max-length and, if so, is there a
> way I can work with long strings of the sort referenced above?
>

How long are the strings, and where does the error occur (traceback()) 
will tell you where)?

With
fn <- function(n) formula(paste("y",paste("xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",1:n,collapse="+",sep=""),sep="~"))

I can run terms(fn(500)) with no problems. This is a 15500 character 
string, and produces a terms object over a megabyte in size. This suggests 
that it isn't a string problem, unless you really want formulas larger 
than this.

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ripley at stats.ox.ac.uk  Wed Jul 12 16:38:22 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 12 Jul 2006 15:38:22 +0100 (BST)
Subject: [Rd] string-length limitations
In-Reply-To: <BAY117-F21568A2FDDAC9E7B81D14BAC690@phx.gbl>
References: <BAY117-F21568A2FDDAC9E7B81D14BAC690@phx.gbl>
Message-ID: <Pine.LNX.4.64.0607121527190.6616@gannet.stats.ox.ac.uk>

On Wed, 12 Jul 2006, jake wilson wrote:

> Hi,
> 
> I'm attempting to "glm" a formula - something that's not caused problems in 
> the past.  I've used formulas of the form
> 
>     formula( "dependant-variable~independant-variables" )
> 
> where the independant variable string is of the form:
> 
>     "indvar1+indvar2+...+indvarN"

Why the quotes?: I think that is your problem.

> Now, however, our independant variable strings are quite long (hundreds of 
> variables) - R dies with an "input buffer overflow" error.  

It is normal to use (y ~ ., data=mydata) to avoid such formulae.

>  I've tried writing out the code to files and sourcing them, as well as 
> building the strings incrementally in R, but these have not worked 
> either.  I have come to believe there is a maximum length for char 
> strings - some sort of fundamental limitation.  Is there such a 
> max-length and, if so, is there a way I can work with long strings of 
> the sort referenced above?

The limit is 2^31 -1, not relevant here.

Your message is coming from the parser, and suggests that it is trying to 
parse a piece of text longer than MAXELTSIZE bytes.  The latter depends on 
the platform (unstated: do see the posting guide) and is often 8196 bytes.  
So there is a limit on the length of quoted strings which can be input.

However, what is wrong with say

tmp <- paste(paste("indvar", 1:1000, sep=""), collapse="+")
tmp <- paste("y ~", tmp)
form <- eval(parse(text=tmp))

?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jake_f_wilson at hotmail.com  Wed Jul 12 20:10:48 2006
From: jake_f_wilson at hotmail.com (jake wilson)
Date: Wed, 12 Jul 2006 13:10:48 -0500
Subject: [Rd] string-length limitations
In-Reply-To: <Pine.LNX.4.64.0607121527190.6616@gannet.stats.ox.ac.uk>
Message-ID: <BAY117-F14F61F5908531587CFC19BAC690@phx.gbl>

Thank you - the proposed solution (eliminating quotes) worked.


>From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
>To: jake wilson <jake_f_wilson at hotmail.com>
>CC: r-devel at r-project.org
>Subject: Re: [Rd] string-length limitations
>Date: Wed, 12 Jul 2006 15:38:22 +0100 (BST)
>
>On Wed, 12 Jul 2006, jake wilson wrote:
>
> > Hi,
> >
> > I'm attempting to "glm" a formula - something that's not caused problems 
>in
> > the past.  I've used formulas of the form
> >
> >     formula( "dependant-variable~independant-variables" )
> >
> > where the independant variable string is of the form:
> >
> >     "indvar1+indvar2+...+indvarN"
>
>Why the quotes?: I think that is your problem.
>
> > Now, however, our independant variable strings are quite long (hundreds 
>of
> > variables) - R dies with an "input buffer overflow" error.
>
>It is normal to use (y ~ ., data=mydata) to avoid such formulae.
>
> >  I've tried writing out the code to files and sourcing them, as well as
> > building the strings incrementally in R, but these have not worked
> > either.  I have come to believe there is a maximum length for char
> > strings - some sort of fundamental limitation.  Is there such a
> > max-length and, if so, is there a way I can work with long strings of
> > the sort referenced above?
>
>The limit is 2^31 -1, not relevant here.
>
>Your message is coming from the parser, and suggests that it is trying to
>parse a piece of text longer than MAXELTSIZE bytes.  The latter depends on
>the platform (unstated: do see the posting guide) and is often 8196 bytes.
>So there is a limit on the length of quoted strings which can be input.
>
>However, what is wrong with say
>
>tmp <- paste(paste("indvar", 1:1000, sep=""), collapse="+")
>tmp <- paste("y ~", tmp)
>form <- eval(parse(text=tmp))
>
>?
>
>--
>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kapelner at stanford.edu  Thu Jul 13 04:42:39 2006
From: kapelner at stanford.edu (way4thesub)
Date: Wed, 12 Jul 2006 19:42:39 -0700 (PDT)
Subject: [Rd] Call R function from Java
In-Reply-To: <1D19ABC5-BD9A-4280-BD16-383DD06B862F@r-project.org>
References: <20060707125037.77447.qmail@web53104.mail.yahoo.com>
	<1B6A26B0-3CD6-4B65-8A0E-FE780D06B231@r-project.org>
	<f20482fc0607071105h618f15aft980a3b09d2e4c267@mail.gmail.com>
	<1D19ABC5-BD9A-4280-BD16-383DD06B862F@r-project.org>
Message-ID: <5301125.post@talk.nabble.com>


Hello,

I am currently attempting to use JRI to call data mining functions in R (ie
rpart, lda, etc). I am using Eclipse 3.1.1 and jre1.5.0_06 and jdk1.5.0_07.

I am unsure how to actually import JRI into eclipse. I've downloaded the
JGR, the rJava and the JRI. I've included the jri.jar file in my eclipse
project and eclipse recognized the classes and interfaces. However when I
went to execute the program it gave me an error about the correct libraries
not being there.

I therefore included the following code:
   System.load("C:\\Program Files\\R\\R-2.2.1\\bin\\R.dll");
   System.load("C:\\Program Files\\R\\R-2.2.1\\bin\\Rblas.dll");		
   System.load("C:\\jri\\jri.dll");

(and the 3 files actually exist in those locations)

However, it turns out R.dll depends upon Rblas.dll and vice versa so I can
never actually get it to work without throwing a "UnsatisfiedLinkError."
What am I doing wrong?

I'm sorry this is such an easy question but with the lack of FAQ's and
examples of JRI, I'm forced to ask it.

Adam
		
-- 
View this message in context: http://www.nabble.com/Call-R-function-from-Java-tf1906302.html#a5301125
Sent from the R devel forum at Nabble.com.


From ripley at stats.ox.ac.uk  Thu Jul 13 08:21:09 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 13 Jul 2006 07:21:09 +0100 (BST)
Subject: [Rd] Call R function from Java
In-Reply-To: <5301125.post@talk.nabble.com>
References: <20060707125037.77447.qmail@web53104.mail.yahoo.com>
	<1B6A26B0-3CD6-4B65-8A0E-FE780D06B231@r-project.org>
	<f20482fc0607071105h618f15aft980a3b09d2e4c267@mail.gmail.com>
	<1D19ABC5-BD9A-4280-BD16-383DD06B862F@r-project.org>
	<5301125.post@talk.nabble.com>
Message-ID: <Pine.LNX.4.64.0607130719350.4346@gannet.stats.ox.ac.uk>

Please do study the posting guide and consult the maintainer (as it asked 
you to do) with basic information (such as your OS) and the exact messages 
you received.

As a guess: your PATH does not include the R DLLs and needs to?

On Wed, 12 Jul 2006, way4thesub wrote:

> 
> Hello,
> 
> I am currently attempting to use JRI to call data mining functions in R (ie
> rpart, lda, etc). I am using Eclipse 3.1.1 and jre1.5.0_06 and jdk1.5.0_07.
> 
> I am unsure how to actually import JRI into eclipse. I've downloaded the
> JGR, the rJava and the JRI. I've included the jri.jar file in my eclipse
> project and eclipse recognized the classes and interfaces. However when I
> went to execute the program it gave me an error about the correct libraries
> not being there.
> 
> I therefore included the following code:
>    System.load("C:\\Program Files\\R\\R-2.2.1\\bin\\R.dll");
>    System.load("C:\\Program Files\\R\\R-2.2.1\\bin\\Rblas.dll");		
>    System.load("C:\\jri\\jri.dll");
> 
> (and the 3 files actually exist in those locations)
> 
> However, it turns out R.dll depends upon Rblas.dll and vice versa so I can
> never actually get it to work without throwing a "UnsatisfiedLinkError."
> What am I doing wrong?
> 
> I'm sorry this is such an easy question but with the lack of FAQ's and
> examples of JRI, I'm forced to ask it.
> 
> Adam
> 		
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Weigand.Stephen at mayo.edu  Thu Jul 13 20:48:19 2006
From: Weigand.Stephen at mayo.edu (Stephen Weigand)
Date: Thu, 13 Jul 2006 13:48:19 -0500 (CDT)
Subject: [Rd] writeForeignSAS and potential extensions
Message-ID: <200607131848.k6DImJ629475@epicenter.mayo.edu>

Dear R-devel,

I've made some potential extensions to writeForeignSAS 
in 'foreign' that I wanted to pass along if anyone is 
interested.  I've attached the diff -u output against 
the version found in foreign_0.8-15 and an .R file 
with my changes.  (In this .R file, the function is named 
writeForeignSAS7 to simplify testing/comparisons.)

I've tried to alter the current version as little as
possible while making the following changes:

* Try to convert data.frame names to SAS-legal names and
allow the user to specify an 8- or 32-character limit.

* For factors, try to convert the variable name to a
SAS-legal 8-character name not ending in a digit 

* Read in 'datafile' with DSD specified in the INFILE
statement.  SAS says this "changes how SAS treats
delimiters when list input is used and sets the default
delimiter to a comma.  When you specify DSD, SAS treats
two consecutive delimiters as a missing value and
removes quotation marks from character values."  The
point of this is the added safety of using 'quote=TRUE' 
when writing 'datafile' via write.table

* Functionality to write out Dates and read them in with
an INFORMAT statement

* Functionality to write out datetime variables
(assuming a class of POSIXct) and read them in with an
INFORMAT statement

* In order to handle character variables a bit better,
use a LENGTH statement to tell SAS the maximum character
width of values in the variable. Without this, some
character values can be truncated.

If it'd be helpful to make any changes or add anything, 
I'd be happy try to do so.

Finally, some testing code that works in SAS 6.12, 8.2,
and 9.

d <-
  structure(list(a.b = as.integer(c(1, 2)),
                 alphabetsoup = 
                 structure(as.integer(c(1, 2)),
                   .Label = c("A", "B"), 
                   class = "factor"),
                 datevar1 = structure(c(13342, 12977), 
                                      class = "Date"),
                 datetimevar1 = structure(c(1152802685, 
                                            1152716285),
                   class = c("POSIXt", "POSIXct")),
                 charactervariable = c("L", 
                    "Last, First")),
            .Names = c("a.b", "alphabetsoup",
                "datevar1", "datetimevar1",
                "charactervariable"),
            row.names = c("1", "2"),
            class = "data.frame")

require(foreign)

### adQuote here to (temporarily) avoid ':::'
adQuote <- function (x) paste("\"", x, "\"", sep = "")

dfile <- file.path(tempdir(), "test.dat")
cfile <- file.path(tempdir(), "test.sas")
write.foreign(d, datafile = dfile, codefile = cfile,
              package = "SAS7", validvarname = "V6")
file.show(dfile)
file.show(cfile)

Sincerely,

Stephen

::::::::::::::::::::::::::::::::::  
Stephen Weigand 
Division of Biostatistics 
Mayo Clinic Rochester, Minn., USA 
Phone (507) 266-1650, fax 284-9542
-------------- next part --------------
--- writeForeignSAS.R	Fri Feb 17 03:30:53 2006
+++ /tmp/writeForeignSAS.R	Thu Jul 13 12:24:24 2006
@@ -1,21 +1,52 @@
-writeForeignSAS<-function(df,datafile,codefile,dataname="rdata"){
+make.SAS.names <- function(varnames, validvarname = c("V7", "V6")){
+  validvarname <- match.arg(validvarname)
+  nmax <- if(validvarname == "V7") 32 else 8
   
+  x <- sub("^([0-9])", "_\\1", varnames)
+  x <- gsub("[^a-zA-Z0-9_]", "_", x)
+  x <- abbreviate(x, minlength = nmax)
+  
+  if (any(nchar(x) > nmax) || any(duplicated(x)))
+    stop("Cannot uniquely abbreviate the variable names to ",
+         nmax, " or fewer characters")
+  names(x) <- varnames
+  x
+}
+
+make.SAS.formats <- function(varnames){  
+  x <- sub("^([0-9])", "_\\1", varnames)
+  x <- gsub("[^a-zA-Z0-9_]", "_", x)
+  x <- sub("([0-9])$", "\\1f", x) # can't end in digit so append 'f'
+  x <- abbreviate(x, minlength = 8)
+  
+  if(any(nchar(x) > 8) || any(duplicated(x)))
+    stop("Cannot uniquely abbreviate format names to conform to ",
+         " eight-character limit and not ending in a digit")
+  names(x) <- varnames
+  x  
+}
+
+writeForeignSAS7<-function(df,datafile,codefile,dataname="rdata",
+                          validvarname = c("V7", "V6")){
   factors <- sapply(df, is.factor)
   strings <- sapply(df, is.character)
-
+  dates <- sapply(df, FUN = function(x) inherits(x, "Date"))
+  datetimes <- sapply(df, FUN = function(x) inherits(x, "POSIXct"))
+  
   varlabels <- names(df)
-  varnames <- abbreviate(names(df), 8)
-  if (any(sapply(varnames, nchar) > 8)) 
-    stop("Cannot abbreviate the variable names to eight or fewer letters")
-  if (any(abbreviated <- (varnames != varlabels))) 
-    message("Some variable names were abbreviated.")
+  varnames <- make.SAS.names(names(df), validvarname = validvarname)
+  if (any(varnames != varlabels))
+    message("Some variable names were abbreviated or otherwise altered.")
   
   
   dfn<-df
   if (any(factors))
     dfn[factors]<-lapply(dfn[factors], as.numeric)     
+  if (any(datetimes))
+    dfn[datetimes] <- lapply(dfn[datetimes],
+                             FUN = function(x) format(x, "%d%b%Y %H:%M:%S"))
   write.table(dfn, file = datafile, row = FALSE, col = FALSE, 
-              sep = ",", quote = FALSE, na = ".")
+              sep = ",", quote = TRUE, na = "")
   lrecl<-max(sapply(readLines(datafile),nchar))+4
 
   cat("* Written by R;\n", file=codefile)
@@ -22,24 +53,50 @@
   cat("* ",deparse(sys.call(-2))[1],";\n\n",file=codefile,append=TRUE)
   if (any(factors)){
     cat("PROC FORMAT;\n",file=codefile,append=TRUE)
-    for(v in 1:ncol(df)){
-      if (factors[v]){
-        cat("value ",varnames[v],"\n",file=codefile,append=TRUE)
-        values<-levels(df[[v]])
+    fmtnames <- make.SAS.formats(varnames[factors])
+    fmt.values <- lapply(df[, factors, drop = FALSE], levels)
+    names(fmt.values) <- fmtnames
+    for (f in fmtnames){
+      cat("value",f,"\n",file=codefile,append = TRUE)
+      values<-fmt.values[[f]]
         for(i in 1:length(values)){
           cat("    ",i,"=",adQuote(values[i]),"\n",file=codefile,append=TRUE)
         }
         cat(";\n\n",file=codefile,append=TRUE)
-      }
-      }
+     }
   }
 
   cat("DATA ",dataname,";\n",file=codefile,append=TRUE)
+
+  if (any(strings)){    
+    cat("LENGTH", file = codefile, append = TRUE)
+    lengths <- sapply(df[,strings, drop = FALSE],
+                      FUN = function(x) max(nchar(x)))
+    names(lengths) <- varnames[strings]
+    for(v in varnames[strings])
+      cat("\n", v, "$", lengths[v],file=codefile,append=TRUE)
+    cat("\n;\n\n", file = codefile, append = TRUE)
+  }
+
+  if (any(dates)){    
+    cat("INFORMAT", file = codefile, append = TRUE)
+    for(v in varnames[dates])
+      cat("\n", v, file = codefile, append = TRUE)
+    cat("\n YYMMDD10.\n;\n\n", file = codefile, append = TRUE)
+  }                  
+
+  if (any(datetimes)){    
+    cat("INFORMAT", file = codefile, append = TRUE)
+    for(v in varnames[datetimes])
+      cat("\n", v, file = codefile, append = TRUE)
+    cat("\n DATETIME18.\n;\n\n", file = codefile, append = TRUE)
+  }
+  
   cat("INFILE ",adQuote(datafile),
-      "\n     DELIMITER=','",
+      "\n     DSD", 
       "\n     LRECL=",lrecl,";\n",
       file=codefile,append=TRUE)
-
+  
   cat("INPUT",file=codefile,append=TRUE)
   for(v in 1:ncol(df)){
     cat("\n",varnames[v],file=codefile,append=TRUE)
@@ -49,16 +106,26 @@
   cat("\n;\n",file=codefile,append=TRUE)
 
   for(v in 1:ncol(df)){
-    if (abbreviated[v])
+    if (varnames[v] != names(varnames)[v]) 
       cat("LABEL ",varnames[v],"=",adQuote(varlabels[v]),";\n",
           file=codefile,append=TRUE)
-  } 
-
-  for(v in 1:ncol(df)){
-    if(factors[v])
-      cat("FORMAT ",varnames[v],paste(varnames[v],".",sep=""),";\n",
+  }
+  
+  if (any(factors)){
+    for (f in 1:length(fmtnames)) 
+      cat("FORMAT", names(fmtnames)[f],paste(fmtnames[f],".",sep = ""),";\n",
           file=codefile,append=TRUE)
   }
-
+  
+  if (any(dates)){    
+    for(v in varnames[dates])
+      cat("FORMAT", v, "yymmdd10.;\n", file = codefile, append = TRUE)
+  }        
+  
+  if (any(datetimes)){    
+    for(v in varnames[datetimes])
+      cat("FORMAT", v, "datetime18.;\n", file = codefile, append = TRUE)
+  }
+  
   cat("RUN;\n",file=codefile,append=TRUE)
 } 
-------------- next part --------------
make.SAS.names <- function(varnames, validvarname = c("V7", "V6")){
  validvarname <- match.arg(validvarname)
  nmax <- if(validvarname == "V7") 32 else 8
  
  x <- sub("^([0-9])", "_\\1", varnames)
  x <- gsub("[^a-zA-Z0-9_]", "_", x)
  x <- abbreviate(x, minlength = nmax)
  
  if (any(nchar(x) > nmax) || any(duplicated(x)))
    stop("Cannot uniquely abbreviate the variable names to ",
         nmax, " or fewer characters")
  names(x) <- varnames
  x
}

make.SAS.formats <- function(varnames){  
  x <- sub("^([0-9])", "_\\1", varnames)
  x <- gsub("[^a-zA-Z0-9_]", "_", x)
  x <- sub("([0-9])$", "\\1f", x) # can't end in digit so append 'f'
  x <- abbreviate(x, minlength = 8)
  
  if(any(nchar(x) > 8) || any(duplicated(x)))
    stop("Cannot uniquely abbreviate format names to conform to ",
         " eight-character limit and not ending in a digit")
  names(x) <- varnames
  x  
}

writeForeignSAS7<-function(df,datafile,codefile,dataname="rdata",
                          validvarname = c("V7", "V6")){
  factors <- sapply(df, is.factor)
  strings <- sapply(df, is.character)
  dates <- sapply(df, FUN = function(x) inherits(x, "Date"))
  datetimes <- sapply(df, FUN = function(x) inherits(x, "POSIXct"))
  
  varlabels <- names(df)
  varnames <- make.SAS.names(names(df), validvarname = validvarname)
  if (any(varnames != varlabels))
    message("Some variable names were abbreviated or otherwise altered.")
  
  
  dfn<-df
  if (any(factors))
    dfn[factors]<-lapply(dfn[factors], as.numeric)     
  if (any(datetimes))
    dfn[datetimes] <- lapply(dfn[datetimes],
                             FUN = function(x) format(x, "%d%b%Y %H:%M:%S"))
  write.table(dfn, file = datafile, row = FALSE, col = FALSE, 
              sep = ",", quote = TRUE, na = "")
  lrecl<-max(sapply(readLines(datafile),nchar))+4

  cat("* Written by R;\n", file=codefile)
  cat("* ",deparse(sys.call(-2))[1],";\n\n",file=codefile,append=TRUE)
  if (any(factors)){
    cat("PROC FORMAT;\n",file=codefile,append=TRUE)
    fmtnames <- make.SAS.formats(varnames[factors])
    fmt.values <- lapply(df[, factors, drop = FALSE], levels)
    names(fmt.values) <- fmtnames
    for (f in fmtnames){
      cat("value",f,"\n",file=codefile,append = TRUE)
      values<-fmt.values[[f]]
        for(i in 1:length(values)){
          cat("    ",i,"=",adQuote(values[i]),"\n",file=codefile,append=TRUE)
        }
        cat(";\n\n",file=codefile,append=TRUE)
     }
  }

  cat("DATA ",dataname,";\n",file=codefile,append=TRUE)

  if (any(strings)){    
    cat("LENGTH", file = codefile, append = TRUE)
    lengths <- sapply(df[,strings, drop = FALSE],
                      FUN = function(x) max(nchar(x)))
    names(lengths) <- varnames[strings]
    for(v in varnames[strings])
      cat("\n", v, "$", lengths[v],file=codefile,append=TRUE)
    cat("\n;\n\n", file = codefile, append = TRUE)
  }

  if (any(dates)){    
    cat("INFORMAT", file = codefile, append = TRUE)
    for(v in varnames[dates])
      cat("\n", v, file = codefile, append = TRUE)
    cat("\n YYMMDD10.\n;\n\n", file = codefile, append = TRUE)
  }                  

  if (any(datetimes)){    
    cat("INFORMAT", file = codefile, append = TRUE)
    for(v in varnames[datetimes])
      cat("\n", v, file = codefile, append = TRUE)
    cat("\n DATETIME18.\n;\n\n", file = codefile, append = TRUE)
  }
  
  cat("INFILE ",adQuote(datafile),
      "\n     DSD", 
      "\n     LRECL=",lrecl,";\n",
      file=codefile,append=TRUE)
  
  cat("INPUT",file=codefile,append=TRUE)
  for(v in 1:ncol(df)){
    cat("\n",varnames[v],file=codefile,append=TRUE)
    if(strings[v])
      cat(" $ ",file=codefile,append=TRUE)
  }
  cat("\n;\n",file=codefile,append=TRUE)

  for(v in 1:ncol(df)){
    if (varnames[v] != names(varnames)[v]) 
      cat("LABEL ",varnames[v],"=",adQuote(varlabels[v]),";\n",
          file=codefile,append=TRUE)
  }
  
  if (any(factors)){
    for (f in 1:length(fmtnames)) 
      cat("FORMAT", names(fmtnames)[f],paste(fmtnames[f],".",sep = ""),";\n",
          file=codefile,append=TRUE)
  }
  
  if (any(dates)){    
    for(v in varnames[dates])
      cat("FORMAT", v, "yymmdd10.;\n", file = codefile, append = TRUE)
  }        
  
  if (any(datetimes)){    
    for(v in varnames[datetimes])
      cat("FORMAT", v, "datetime18.;\n", file = codefile, append = TRUE)
  }
  
  cat("RUN;\n",file=codefile,append=TRUE)
} 

From kapelner at stanford.edu  Thu Jul 13 23:28:48 2006
From: kapelner at stanford.edu (Adam Kapelner)
Date: Thu, 13 Jul 2006 14:28:48 -0700
Subject: [Rd] Call R function from Java
In-Reply-To: <ADC02CC0-5BDF-4C5C-89C1-2CB9570CCBB8@r-project.org>
Message-ID: <000001c6a6c3$53ebbe70$0100a8c0@kapelnerquad>

Hey guys,

It worked. All I had to do is set PATH = < R directory > in my system
variables in "My Computer" and that was it!

Oh btw Simon, I couldn't find the run.bat in the JRI_0.2-4.tar.gz file. I
found a "run.in" but that is a unix bash script.

Another question:

When I'm evaluating R expressions:
	REXP
rexp3=r.eval("cancer=read.table(\"CancerCellsTrainingFile.txt\",header=TRUE,
sep=\",\")");
	System.out.println(rexp3);

I sometimes get back form the println:
	RXP[unknown/19, id=1208787616, o=null]

Is there anyway to actually view that output as a string? I know it's not a
graphical object. It's probably a type of error message.

I'm running Windows XP, 1GB RAM, 2 x 1.8GHZ Xeon P4's, Eclipse 3.1.1,
jdk1.5.0_07, and jre1.5.0_06

Thanks,
Adam

-----Original Message-----
From: Simon Urbanek [mailto:simon.urbanek at r-project.org] 
Sent: Thursday, July 13, 2006 11:17 AM
To: way4thesub
Subject: Re: [Rd] Call R function from Java

Adam,

On Jul 12, 2006, at 10:42 PM, way4thesub wrote:

> I am unsure how to actually import JRI into eclipse.

I don't know either, but I'd recommend using the run.bat start script  
supplied with JRI. I bet Brian's guess is correct.


> I'm sorry this is such an easy question but with the lack of FAQ's  
> and examples of JRI, I'm forced to ask it.
>

There are examples in JRI (in the "examples" directory) and JGR is  
probably the best example of the general use of JRI. At your  
suggestion I have now added a FAQ.

Cheers,
Simon


From simon.urbanek at r-project.org  Fri Jul 14 02:27:29 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 13 Jul 2006 20:27:29 -0400
Subject: [Rd] Call R function from Java
In-Reply-To: <000001c6a6c3$53ebbe70$0100a8c0@kapelnerquad>
References: <000001c6a6c3$53ebbe70$0100a8c0@kapelnerquad>
Message-ID: <52C985BB-05CD-4062-851B-99E1019BB11A@r-project.org>

Adam,

[I'm moving this discussion to stat-rosuda-devel, because JRI is  
strictly speaking a contributed package]

On Jul 13, 2006, at 5:28 PM, Adam Kapelner wrote:

> It worked. All I had to do is set PATH = < R directory > in my  
> system variables in "My Computer" and that was it!
>
> Oh btw Simon, I couldn't find the run.bat in the JRI_0.2-4.tar.gz  
> file. I found a "run.in" but that is a unix bash script.
>

run (and run.bat respectively) are created by make, so you should run  
"sh configure.win; make" on Windows or "./configure; make" on unix.  
The script must contain paths to your JRE and R, so it cannot be  
shipped directly in JRI - that's why it is created during the build  
phase instead.


> Another question:
>
> When I'm evaluating R expressions:
> 	REXP
> rexp3=r.eval("cancer=read.table(\"CancerCellsTrainingFile.txt 
> \",header=TRUE,
> sep=\",\")");
> 	System.out.println(rexp3);
>
> I sometimes get back form the println:
> 	RXP[unknown/19, id=1208787616, o=null]
>
> Is there anyway to actually view that output as a string?

It is a generic vector (aka list). If you use JRI 0.3 (from http:// 
www.rosuda.org/R/nightly ), you can use
RVector v=rexp3.asVector()
for (Enumeration e = v.elements() ; e.hasMoreElements() ;)
System.out.println(e.nextElement());

If you are using JRI 0.2 or earlier, you'll have to use something  
like this:
long[] l = r.rniGetVector(rexp3.xp);
int i=0; while(i<l.length) System.out.println(new REXP(r, l[i++]));

Cheers,
Simon


From weigand.stephen at charter.net  Fri Jul 14 07:00:17 2006
From: weigand.stephen at charter.net (Stephen D. Weigand)
Date: Fri, 14 Jul 2006 00:00:17 -0500
Subject: [Rd] writeForeignSAS and potential extensions
In-Reply-To: <200607131848.k6DImJ629475@epicenter.mayo.edu>
References: <200607131848.k6DImJ629475@epicenter.mayo.edu>
Message-ID: <8bc5ab85d987881c8ee9ee36912a4731@charter.net>

Sorry, looks like my work e-mailer put the attachments
in the body. Please e-mail weigand at mayo.edu if interested
and I'll send you a copy of the files.

I think it'll also work to grab the files from:

ftp://mayoftp:''@ftp.mayo.edu/pub/weigand/writeForeignSAS7.R
ftp://mayoftp:''@ftp.mayo.edu/pub/weigand/diff.txt

Thank you,
Stephen

On Jul 13, 2006, at 1:48 PM, Stephen Weigand wrote:

> Dear R-devel,
>
> I've made some potential extensions to writeForeignSAS
> in 'foreign' that I wanted to pass along if anyone is
> interested.  I've attached the diff -u output against
> the version found in foreign_0.8-15 and an .R file
> with my changes.  (In this .R file, the function is named
> writeForeignSAS7 to simplify testing/comparisons.)
>
> I've tried to alter the current version as little as
> possible while making the following changes:
>
> * Try to convert data.frame names to SAS-legal names and
> allow the user to specify an 8- or 32-character limit.
>
> * For factors, try to convert the variable name to a
> SAS-legal 8-character name not ending in a digit
>
> * Read in 'datafile' with DSD specified in the INFILE
> statement.  SAS says this "changes how SAS treats
> delimiters when list input is used and sets the default
> delimiter to a comma.  When you specify DSD, SAS treats
> two consecutive delimiters as a missing value and
> removes quotation marks from character values."  The
> point of this is the added safety of using 'quote=TRUE'
> when writing 'datafile' via write.table
>
> * Functionality to write out Dates and read them in with
> an INFORMAT statement
>
> * Functionality to write out datetime variables
> (assuming a class of POSIXct) and read them in with an
> INFORMAT statement
>
> * In order to handle character variables a bit better,
> use a LENGTH statement to tell SAS the maximum character
> width of values in the variable. Without this, some
> character values can be truncated.
>
> If it'd be helpful to make any changes or add anything,
> I'd be happy try to do so.
>
> Finally, some testing code that works in SAS 6.12, 8.2,
> and 9.
>
> d <-
>   structure(list(a.b = as.integer(c(1, 2)),
>                  alphabetsoup =
>                  structure(as.integer(c(1, 2)),
>                    .Label = c("A", "B"),
>                    class = "factor"),
>                  datevar1 = structure(c(13342, 12977),
>                                       class = "Date"),
>                  datetimevar1 = structure(c(1152802685,
>                                             1152716285),
>                    class = c("POSIXt", "POSIXct")),
>                  charactervariable = c("L",
>                     "Last, First")),
>             .Names = c("a.b", "alphabetsoup",
>                 "datevar1", "datetimevar1",
>                 "charactervariable"),
>             row.names = c("1", "2"),
>             class = "data.frame")
>
> require(foreign)
>
> ### adQuote here to (temporarily) avoid ':::'
> adQuote <- function (x) paste("\"", x, "\"", sep = "")
>
> dfile <- file.path(tempdir(), "test.dat")
> cfile <- file.path(tempdir(), "test.sas")
> write.foreign(d, datafile = dfile, codefile = cfile,
>               package = "SAS7", validvarname = "V6")
> file.show(dfile)
> file.show(cfile)
>
> Sincerely,
>
> Stephen
>
> ::::::::::::::::::::::::::::::::::
> Stephen Weigand
> Division of Biostatistics
> Mayo Clinic Rochester, Minn., USA
> Phone (507) 266-1650, fax 284-9542
> --- writeForeignSAS.R	Fri Feb 17 03:30:53 2006
> +++ /tmp/writeForeignSAS.R	Thu Jul 13 12:24:24 2006
> @@ -1,21 +1,52 @@
> -writeForeignSAS<-function(df,datafile,codefile,dataname="rdata"){
> +make.SAS.names <- function(varnames, validvarname = c("V7", "V6")){
> +  validvarname <- match.arg(validvarname)
> +  nmax <- if(validvarname == "V7") 32 else 8
>
> +  x <- sub("^([0-9])", "_\\1", varnames)
> +  x <- gsub("[^a-zA-Z0-9_]", "_", x)
> +  x <- abbreviate(x, minlength = nmax)
> +
> +  if (any(nchar(x) > nmax) || any(duplicated(x)))
> +    stop("Cannot uniquely abbreviate the variable names to ",
> +         nmax, " or fewer characters")
> +  names(x) <- varnames
> +  x
> +}
> +
> +make.SAS.formats <- function(varnames){
> +  x <- sub("^([0-9])", "_\\1", varnames)
> +  x <- gsub("[^a-zA-Z0-9_]", "_", x)
> +  x <- sub("([0-9])$", "\\1f", x) # can't end in digit so append 'f'
> +  x <- abbreviate(x, minlength = 8)
> +
> +  if(any(nchar(x) > 8) || any(duplicated(x)))
> +    stop("Cannot uniquely abbreviate format names to conform to ",
> +         " eight-character limit and not ending in a digit")
> +  names(x) <- varnames
> +  x
> +}
> +
> +writeForeignSAS7<-function(df,datafile,codefile,dataname="rdata",
> +                          validvarname = c("V7", "V6")){
>    factors <- sapply(df, is.factor)
>    strings <- sapply(df, is.character)
> -
> +  dates <- sapply(df, FUN = function(x) inherits(x, "Date"))
> +  datetimes <- sapply(df, FUN = function(x) inherits(x, "POSIXct"))
> +
>    varlabels <- names(df)
> -  varnames <- abbreviate(names(df), 8)
> -  if (any(sapply(varnames, nchar) > 8))
> -    stop("Cannot abbreviate the variable names to eight or fewer 
> letters")
> -  if (any(abbreviated <- (varnames != varlabels)))
> -    message("Some variable names were abbreviated.")
> +  varnames <- make.SAS.names(names(df), validvarname = validvarname)
> +  if (any(varnames != varlabels))
> +    message("Some variable names were abbreviated or otherwise 
> altered.")
>
>
>    dfn<-df
>    if (any(factors))
>      dfn[factors]<-lapply(dfn[factors], as.numeric)
> +  if (any(datetimes))
> +    dfn[datetimes] <- lapply(dfn[datetimes],
> +                             FUN = function(x) format(x, "%d%b%Y 
> %H:%M:%S"))
>    write.table(dfn, file = datafile, row = FALSE, col = FALSE,
> -              sep = ",", quote = FALSE, na = ".")
> +              sep = ",", quote = TRUE, na = "")
>    lrecl<-max(sapply(readLines(datafile),nchar))+4
>
>    cat("* Written by R;\n", file=codefile)
> @@ -22,24 +53,50 @@
>    cat("* ",deparse(sys.call(-2))[1],";\n\n",file=codefile,append=TRUE)
>    if (any(factors)){
>      cat("PROC FORMAT;\n",file=codefile,append=TRUE)
> -    for(v in 1:ncol(df)){
> -      if (factors[v]){
> -        cat("value ",varnames[v],"\n",file=codefile,append=TRUE)
> -        values<-levels(df[[v]])
> +    fmtnames <- make.SAS.formats(varnames[factors])
> +    fmt.values <- lapply(df[, factors, drop = FALSE], levels)
> +    names(fmt.values) <- fmtnames
> +    for (f in fmtnames){
> +      cat("value",f,"\n",file=codefile,append = TRUE)
> +      values<-fmt.values[[f]]
>          for(i in 1:length(values)){
>            cat("    
> ",i,"=",adQuote(values[i]),"\n",file=codefile,append=TRUE)
>          }
>          cat(";\n\n",file=codefile,append=TRUE)
> -      }
> -      }
> +     }
>    }
>
>    cat("DATA ",dataname,";\n",file=codefile,append=TRUE)
> +
> +  if (any(strings)){
> +    cat("LENGTH", file = codefile, append = TRUE)
> +    lengths <- sapply(df[,strings, drop = FALSE],
> +                      FUN = function(x) max(nchar(x)))
> +    names(lengths) <- varnames[strings]
> +    for(v in varnames[strings])
> +      cat("\n", v, "$", lengths[v],file=codefile,append=TRUE)
> +    cat("\n;\n\n", file = codefile, append = TRUE)
> +  }
> +
> +  if (any(dates)){
> +    cat("INFORMAT", file = codefile, append = TRUE)
> +    for(v in varnames[dates])
> +      cat("\n", v, file = codefile, append = TRUE)
> +    cat("\n YYMMDD10.\n;\n\n", file = codefile, append = TRUE)
> +  }
> +
> +  if (any(datetimes)){
> +    cat("INFORMAT", file = codefile, append = TRUE)
> +    for(v in varnames[datetimes])
> +      cat("\n", v, file = codefile, append = TRUE)
> +    cat("\n DATETIME18.\n;\n\n", file = codefile, append = TRUE)
> +  }
> +
>    cat("INFILE ",adQuote(datafile),
> -      "\n     DELIMITER=','",
> +      "\n     DSD",
>        "\n     LRECL=",lrecl,";\n",
>        file=codefile,append=TRUE)
> -
> +
>    cat("INPUT",file=codefile,append=TRUE)
>    for(v in 1:ncol(df)){
>      cat("\n",varnames[v],file=codefile,append=TRUE)
> @@ -49,16 +106,26 @@
>    cat("\n;\n",file=codefile,append=TRUE)
>
>    for(v in 1:ncol(df)){
> -    if (abbreviated[v])
> +    if (varnames[v] != names(varnames)[v])
>        cat("LABEL ",varnames[v],"=",adQuote(varlabels[v]),";\n",
>            file=codefile,append=TRUE)
> -  }
> -
> -  for(v in 1:ncol(df)){
> -    if(factors[v])
> -      cat("FORMAT ",varnames[v],paste(varnames[v],".",sep=""),";\n",
> +  }
> +
> +  if (any(factors)){
> +    for (f in 1:length(fmtnames))
> +      cat("FORMAT", names(fmtnames)[f],paste(fmtnames[f],".",sep = 
> ""),";\n",
>            file=codefile,append=TRUE)
>    }
> -
> +
> +  if (any(dates)){
> +    for(v in varnames[dates])
> +      cat("FORMAT", v, "yymmdd10.;\n", file = codefile, append = TRUE)
> +  }
> +
> +  if (any(datetimes)){
> +    for(v in varnames[datetimes])
> +      cat("FORMAT", v, "datetime18.;\n", file = codefile, append = 
> TRUE)
> +  }
> +
>    cat("RUN;\n",file=codefile,append=TRUE)
>  }
> make.SAS.names <- function(varnames, validvarname = c("V7", "V6")){
>   validvarname <- match.arg(validvarname)
>   nmax <- if(validvarname == "V7") 32 else 8
>
>   x <- sub("^([0-9])", "_\\1", varnames)
>   x <- gsub("[^a-zA-Z0-9_]", "_", x)
>   x <- abbreviate(x, minlength = nmax)
>
>   if (any(nchar(x) > nmax) || any(duplicated(x)))
>     stop("Cannot uniquely abbreviate the variable names to ",
>          nmax, " or fewer characters")
>   names(x) <- varnames
>   x
> }
>
> make.SAS.formats <- function(varnames){
>   x <- sub("^([0-9])", "_\\1", varnames)
>   x <- gsub("[^a-zA-Z0-9_]", "_", x)
>   x <- sub("([0-9])$", "\\1f", x) # can't end in digit so append 'f'
>   x <- abbreviate(x, minlength = 8)
>
>   if(any(nchar(x) > 8) || any(duplicated(x)))
>     stop("Cannot uniquely abbreviate format names to conform to ",
>          " eight-character limit and not ending in a digit")
>   names(x) <- varnames
>   x
> }
>
> writeForeignSAS7<-function(df,datafile,codefile,dataname="rdata",
>                           validvarname = c("V7", "V6")){
>   factors <- sapply(df, is.factor)
>   strings <- sapply(df, is.character)
>   dates <- sapply(df, FUN = function(x) inherits(x, "Date"))
>   datetimes <- sapply(df, FUN = function(x) inherits(x, "POSIXct"))
>
>   varlabels <- names(df)
>   varnames <- make.SAS.names(names(df), validvarname = validvarname)
>   if (any(varnames != varlabels))
>     message("Some variable names were abbreviated or otherwise 
> altered.")
>
>
>   dfn<-df
>   if (any(factors))
>     dfn[factors]<-lapply(dfn[factors], as.numeric)
>   if (any(datetimes))
>     dfn[datetimes] <- lapply(dfn[datetimes],
>                              FUN = function(x) format(x, "%d%b%Y 
> %H:%M:%S"))
>   write.table(dfn, file = datafile, row = FALSE, col = FALSE,
>               sep = ",", quote = TRUE, na = "")
>   lrecl<-max(sapply(readLines(datafile),nchar))+4
>
>   cat("* Written by R;\n", file=codefile)
>   cat("* ",deparse(sys.call(-2))[1],";\n\n",file=codefile,append=TRUE)
>   if (any(factors)){
>     cat("PROC FORMAT;\n",file=codefile,append=TRUE)
>     fmtnames <- make.SAS.formats(varnames[factors])
>     fmt.values <- lapply(df[, factors, drop = FALSE], levels)
>     names(fmt.values) <- fmtnames
>     for (f in fmtnames){
>       cat("value",f,"\n",file=codefile,append = TRUE)
>       values<-fmt.values[[f]]
>         for(i in 1:length(values)){
>           cat("    
> ",i,"=",adQuote(values[i]),"\n",file=codefile,append=TRUE)
>         }
>         cat(";\n\n",file=codefile,append=TRUE)
>      }
>   }
>
>   cat("DATA ",dataname,";\n",file=codefile,append=TRUE)
>
>   if (any(strings)){
>     cat("LENGTH", file = codefile, append = TRUE)
>     lengths <- sapply(df[,strings, drop = FALSE],
>                       FUN = function(x) max(nchar(x)))
>     names(lengths) <- varnames[strings]
>     for(v in varnames[strings])
>       cat("\n", v, "$", lengths[v],file=codefile,append=TRUE)
>     cat("\n;\n\n", file = codefile, append = TRUE)
>   }
>
>   if (any(dates)){
>     cat("INFORMAT", file = codefile, append = TRUE)
>     for(v in varnames[dates])
>       cat("\n", v, file = codefile, append = TRUE)
>     cat("\n YYMMDD10.\n;\n\n", file = codefile, append = TRUE)
>   }
>
>   if (any(datetimes)){
>     cat("INFORMAT", file = codefile, append = TRUE)
>     for(v in varnames[datetimes])
>       cat("\n", v, file = codefile, append = TRUE)
>     cat("\n DATETIME18.\n;\n\n", file = codefile, append = TRUE)
>   }
>
>   cat("INFILE ",adQuote(datafile),
>       "\n     DSD",
>       "\n     LRECL=",lrecl,";\n",
>       file=codefile,append=TRUE)
>
>   cat("INPUT",file=codefile,append=TRUE)
>   for(v in 1:ncol(df)){
>     cat("\n",varnames[v],file=codefile,append=TRUE)
>     if(strings[v])
>       cat(" $ ",file=codefile,append=TRUE)
>   }
>   cat("\n;\n",file=codefile,append=TRUE)
>
>   for(v in 1:ncol(df)){
>     if (varnames[v] != names(varnames)[v])
>       cat("LABEL ",varnames[v],"=",adQuote(varlabels[v]),";\n",
>           file=codefile,append=TRUE)
>   }
>
>   if (any(factors)){
>     for (f in 1:length(fmtnames))
>       cat("FORMAT", names(fmtnames)[f],paste(fmtnames[f],".",sep = 
> ""),";\n",
>           file=codefile,append=TRUE)
>   }
>
>   if (any(dates)){
>     for(v in varnames[dates])
>       cat("FORMAT", v, "yymmdd10.;\n", file = codefile, append = TRUE)
>   }
>
>   if (any(datetimes)){
>     for(v in varnames[datetimes])
>       cat("FORMAT", v, "datetime18.;\n", file = codefile, append = 
> TRUE)
>   }
>
>   cat("RUN;\n",file=codefile,append=TRUE)
> }
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Fri Jul 14 06:47:48 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 13 Jul 2006 21:47:48 -0700
Subject: [Rd] [R] Continuation and parse
In-Reply-To: <44A282F7.8070901@sciviews.org> (Philippe Grosjean's message of
	"Wed, 28 Jun 2006 15:24:07 +0200")
References: <44A32C5B.3030409@bitwrit.com.au> <44A282F7.8070901@sciviews.org>
Message-ID: <6phlkqw3i8b.fsf@gopher1.fhcrc.org>

[this is from R-help, at the end of June]

Jim Lemon asked about parsing syntactically incorrect versus
incomplete lines, generating a couple of responses.

Philippe's suggestion isn't robust (e.g., "\nls)". Prof. Ripley's
comment lead me to R_ParseVector (the only exposed parse
routine). Unfortunately, this returns from parsing incomplete or
syntactically incorrect text with a PROTECT stack imbalance, so there
is no natural way to return from a .Call.

What I'd like is to have access to multiline console input after
parsing but before evaluation, or to return from a .Call like that
below with either the parsed expression or information about the
reason for failure. Any suggestions?

Thanks in advance,

Martin

SEXP parses(SEXP cmd) {
  ParseStatus status;
  SEXP res;
  res = R_ParseVector(cmd, 1, &status);
  return res;
}

/* > .Call("parses", "ls(") */
/* 25        SEXP res = R_ParseVector(cmd, 1, &status); */
/* (gdb) p R_PPStackTop */
/* $1 = 3 */
/* (gdb) next */
/* 26        return res; */
/* (gdb) p R_PPStackTop */
/* $2 = 5 */

R version 2.4.0 Under development (unstable) (2006-07-11 r38560)
x86_64-unknown-linux-gnu

Philippe Grosjean <phgrosjean at sciviews.org> writes:

> Well, you haven't used the search engines with the right key: the magic 
> words are:
>
>  > RSiteSearch("incomplete line")
>
> With the first document being my query (almost two years ago), and the 
> second one being Peter Dalgaard answer. You must adapt it to cope with 
> internationalization, but basically, you could use something like:
>
>  > grep("\n2:",try(parse(textConnection("ls)")), silent = TRUE))
> numeric(0)
>  > grep("\n2:",try(parse(textConnection("ls(")), silent = TRUE))
> [1] 1

From: Prof Brian Ripley <ripley>
Date: Wed, 28 Jun 2006 13:44:49 +0100 (BST)

On Wed, 28 Jun 2006, Jim Lemon wrote:

> Hi gurus,
>
> After an unsuccessful scrabble through the documentation and Jon's
> excellent search facility, I am no wiser as to how R recognizes an
> incomplete command line and politely raises its hand for more. The help
> page for parse gives no indication that it does anything more than spit
> the dummy when fed an incomplete command line, but something in there
> must recognize such ellipsis. Any hints?

It's internal. Look in src/main/main.c, in particular the R_Repl*
functions. In short, R_Parse1Buffer can return PARSE_INCOMPLETE.


From rmh at temple.edu  Fri Jul 14 15:22:35 2006
From: rmh at temple.edu (rmh at temple.edu)
Date: Fri, 14 Jul 2006 15:22:35 +0200 (CEST)
Subject: [Rd] utils package: .Rd to .dvi (PR#9079)
Message-ID: <20060714132235.4F3A954B47@slim.kubism.ku.dk>

# R for Windows will not send your bug report automatically.
# Please copy the bug report (after finishing it) to
# your favorite email program and send it to
#
#       r-bugs at r-project.org
#
######################################################

I am building a package.  I discovered that all \usage{} and
\examples{} in the .Rd file that are too long to fit on the .dvi page
are left as is.  They run over the edge of the page and just keep on
going.

I propose that a WARNING or ERROR be generated as part of Rcmd check
for such cases.

The "test <-" line and both "test(" lines below are single lines.
My mailer folds at about 100 characters.

Rich


## test/R/test.R
test <- function(this, is, a, very, long, argument, list, designed, to, show, the, difficulty, 
with, .Rd, To, .dvi, conversion) {
  "Hello, World!"
}
## end test/R/test.R


## test/man/test.Rd
\name{test}
\alias{test}
\title{demonstrate a problem}
\description{demonstrate a problem}
\usage{
test(this, is, a, very, long, argument, list, designed, to, show, the, difficulty, with, .Rd, 
To, .dvi, conversion)
}
\arguments{
\item{this}{}
\item{is}{}
\item{a}{}
\item{very}{}
\item{long}{}
\item{argument}{}
\item{list}{}
\item{designed}{}
\item{to}{}
\item{show}{}
\item{the}{}
\item{difficulty}{}
\item{with}{}
\item{.Rd}{}
\item{To}{}
\item{.dvi}{}
\item{conversion}{}
}
\examples{
test(this, is, a, very, long, argument, list, designed, to, show, the, difficulty, with, .Rd, 
To, .dvi, conversion)
}
\keyword{package}
## end test/man/test.Rd


## test/DESCRIPTION
Package: test
Type: Package
Title: demonstrate a problem
Version: 1.0
Date: 2006-05-15
Author: Richard M. Heiberger
Maintainer: Richard M. Heiberger <rmh at temple.edu>
Depends: R (>= 2.3.1)
Description: demonstrate a problem
License: GPL version 2 or newer
## test/DESCRIPTION


--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 3.1
 year = 2006
 month = 06
 day = 01
 svn rev = 38247
 language = R
 version.string = Version 2.3.1 (2006-06-01)

Windows XP Professional (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:methods, package:stats, package:utils, package:datasets, 
file:c:/HOME/rmh/h2/library/H2/.RData, file:c:/HOME/rmh/hh/splus.library/HH/.RData, 
package:multcomp, package:mvtnorm, package:graphics, package:lattice, package:grid, 
package:grDevices, Autoloads, package:base


From jvierine at gmail.com  Fri Jul 14 16:15:01 2006
From: jvierine at gmail.com (Juha Vierinen)
Date: Fri, 14 Jul 2006 17:15:01 +0300
Subject: [Rd] R as shell script
Message-ID: <b96098070607140715hc7ca785xa5ca190348f24aa3@mail.gmail.com>

Hi,

I am considering if I should invest in learning R. Based on the
language definition and introductory documents, it seems nice. But now
I am faced with a problem: I want to be able to run R programs easily
from the unix shell, and write scripts that can automatically select R
as the interpreter:

#!/usr/bin/R
cat("Hello world.\n")

This of course doesn't work, because /usr/bin/R is a shell script.

I have been able to create a binary wrapper that calls R with the
correct arguments, which is documented here:

http://kavaro.fi/mediawiki/index.php/Using_R_from_the_shell

This still lacks eg. standard input (but I have no idea how I can
implement it in R) and full command line argument passing (can be
done), but am I on the right track, or is there already something that
does what I need?

juha


From goran.brostrom at gmail.com  Fri Jul 14 19:08:31 2006
From: goran.brostrom at gmail.com (goran.brostrom at gmail.com)
Date: Fri, 14 Jul 2006 19:08:31 +0200 (CEST)
Subject: [Rd] dweibull retuns NaN instead of Inf (PR#9080)
Message-ID: <20060714170831.5A7BE56F6A@slim.kubism.ku.dk>

Full_Name: G?ran Brostr?m
Version: 2.3.1
OS: Linux, ubuntu
Submission from: (NULL) (85.11.40.53)


> dweibull(0, 0.5, 1)
[1] NaN
Warning message:
NaNs produced in: dweibull(x, shape, scale, log)

should give Inf (and no Warning). Compare with

> dgamma(0, 0.5, 1)
[1] Inf

This happens when 'shape' < 1.


From jeff.horner at vanderbilt.edu  Fri Jul 14 19:31:13 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Fri, 14 Jul 2006 12:31:13 -0500
Subject: [Rd] R as shell script
In-Reply-To: <b96098070607140715hc7ca785xa5ca190348f24aa3@mail.gmail.com>
References: <b96098070607140715hc7ca785xa5ca190348f24aa3@mail.gmail.com>
Message-ID: <44B7D4E1.7030404@vanderbilt.edu>

Juha Vierinen wrote:
> Hi,
> 
> I am considering if I should invest in learning R. Based on the
> language definition and introductory documents, it seems nice. But now
> I am faced with a problem: I want to be able to run R programs easily
> from the unix shell, and write scripts that can automatically select R
> as the interpreter:
> 
> #!/usr/bin/R
> cat("Hello world.\n")
> 
> This of course doesn't work, because /usr/bin/R is a shell script.
> 
> I have been able to create a binary wrapper that calls R with the
> correct arguments, which is documented here:
> 
> http://kavaro.fi/mediawiki/index.php/Using_R_from_the_shell
> 
> This still lacks eg. standard input (but I have no idea how I can
> implement it in R) and full command line argument passing (can be
> done), but am I on the right track, or is there already something that
> does what I need?

If you search the mailing list archives:

http://tolstoy.newcastle.edu.au/R/

you can find entries like the following (searching on "bang"):

http://tolstoy.newcastle.edu.au/R/devel/05/01/1910.html

which implements similar functionality. But I thought this would be a 
fun little (distracting) project, so I created an R wiki page:

http://wiki.r-project.org/rwiki/doku.php?id=developers:rinterp

with source code describing how to solve this problem by embedding R 
within your C program. Here's the main function:

/* rinterp: shebang support for R
  *
  * Usage:
  *
  * From the command line:
  * $ rinterp filename
  *
  * In a file:
  * --------------------
  * #!/path/to/rinterp
  * cat("hello world\n");
  * --------------------
  */
int main(int argc, char **argv){

     /* R embedded arguments */
     char *R_argv[] = {"RINTERP", "--gui=none", "--slave", "--silent", 
"--vanilla","--no-readline"};
     int R_argc = sizeof(R_argv)/sizeof(R_argv[0]);

     struct stat sbuf;

     /* Setenv R_HOME: insert or replace into environment.
      * The RHOME macro is defined during configure
      */
     if (setenv("R_HOME",RHOME,1) != 0){
         perror("ERROR: couldn't set/replace R_HOME");
         exit(1);
     }

     /* Assume last argument is the file we want to source.
      * Ignore other args for now.
      */
     if (argc > 1) {/* don't try and source rinterp binary */
         if (stat(argv[argc-1],&sbuf) != 0){
             perror(argv[argc-1]);
             exit(1);
         }
     } else {
         fprintf(stderr,"Usage: rinterp filename\n");
         exit(1);
     }

     /* Initialize R interpreter */
     Rf_initEmbeddedR(R_argc, R_argv);

     /* Now call R function source(filename) */
     call_fun1str("source",argv[argc-1]);

     exit(0);
}

Feel free to logon to the R wiki and contribute to the page. I think it 
would be interesting to solve this once and for all.

Cheers!
-- 
Jeffrey Horner       Computer Systems Analyst         School of Medicine
615-322-8606         Department of Biostatistics   Vanderbilt University


From plorch at kent.edu  Fri Jul 14 20:08:45 2006
From: plorch at kent.edu (plorch at kent.edu)
Date: Fri, 14 Jul 2006 20:08:45 +0200 (CEST)
Subject: [Rd] dialog box does not go away (PR#9081)
Message-ID: <20060714180845.C7B3F56E22@slim.kubism.ku.dk>

Full_Name: Pat Lorch
Version: Version 2.3.1 (2006-06-01)
OS:  OS X 10.4.7
Submission from: (NULL) (131.123.232.162)


I have noticed that when I save a Quartz graphic and sometimes when I source a
file, the dialog box persists and causes certain functions (Quit and Load/Save
Default Workspace) to be grayed out.  I must then Force quit and I lose changes
made since last save.image().


From spluque at gmail.com  Fri Jul 14 21:38:54 2006
From: spluque at gmail.com (Sebastian Luque)
Date: Fri, 14 Jul 2006 14:38:54 -0500
Subject: [Rd] chron vs. POSIX
Message-ID: <87psg8rn75.fsf@arctocephalus.homelinux.org>

Hi,

One of the big decisions when writing code is how to handle dates and
times.  Gabor Grothendieck provided an excellent overview of the issue in
his R News 4/1 (2004) article, and many users and developers are probably
using it as a guide.  The proposed guideline is to use the simplest class
required; as Gabor put it "use Date if possible, otherwise use chron, and
otherwise use POSIX".

This seems to me a very efficient strategy, judging from my own
experiences and those of others users.  All but the simplest calculations
with POSIX objects demand great care, due to time zone and and daylight
savings considerations.  Therefore, I've always chosen chron for
relatively complex projects, where I don't need to deal with time zones or
daylight savings problems.  The ease with which objects can be switched
from numeric to chron representations is a major advantage IMHO?.

If Gabor's recommendations are to be followed, wouldn't it make sense to
include chron in base R?  Given that flexibility for handling time
variables is so fundamental, the addition of chron to base R would provide
users everything they need to work with time, without the need to rely on
an external package.  What do others think?



+---- *Footnotes* ----+
? This is possible with POSIX classes too by using the structure()
  function, but a post by Brian Ripley to the effect that it may not be
  practical in the long term further convinced me of this.

-- 
Sebastian P. Luque
Department of Biology
Memorial University of Newfoundland
sluque at mun.ca


From edd at debian.org  Fri Jul 14 22:14:23 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 14 Jul 2006 15:14:23 -0500
Subject: [Rd] chron vs. POSIX
In-Reply-To: <87psg8rn75.fsf@arctocephalus.homelinux.org>
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>
Message-ID: <17591.64287.118524.251828@basebud.nulle.part>


On 14 July 2006 at 14:38, Sebastian Luque wrote:
| If Gabor's recommendations are to be followed, wouldn't it make sense to
| include chron in base R?  Given that flexibility for handling time

Future historians will provide a fuller account of the extended debates, but
my reading of these discussions here over the last few years leaves me with
the impression that Gabor is arguing for chron in a manner that is
simultaneously informed, polite, persistent and yet ... utterly isolated.

Date and POSIXt have served me well over the last few years. They are
maintained and being extended [ 1 ]. Chron, to the best of my knowledge, is
dead code so I'd bet against it appearing in core R any time soon.

Regards, Dirk

[ 1 ] I had some pleasant exchanges with Brian Ripley where I was able to
suggest a few extension relative to the new millisecond granularity in POSIXt
and its interfaces. 

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From ggrothendieck at gmail.com  Fri Jul 14 22:32:04 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 14 Jul 2006 16:32:04 -0400
Subject: [Rd] chron vs. POSIX
In-Reply-To: <17591.64287.118524.251828@basebud.nulle.part>
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>
	<17591.64287.118524.251828@basebud.nulle.part>
Message-ID: <971536df0607141332l1d8489adgeeb530efb4668081@mail.gmail.com>

On 7/14/06, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> On 14 July 2006 at 14:38, Sebastian Luque wrote:
> | If Gabor's recommendations are to be followed, wouldn't it make sense to
> | include chron in base R?  Given that flexibility for handling time
>
> Future historians will provide a fuller account of the extended debates, but
> my reading of these discussions here over the last few years leaves me with
> the impression that Gabor is arguing for chron in a manner that is
> simultaneously informed, polite, persistent and yet ... utterly isolated.
>
> Date and POSIXt have served me well over the last few years. They are
> maintained and being extended [ 1 ]. Chron, to the best of my knowledge, is
> dead code so I'd bet against it appearing in core R any time soon.
>
> Regards, Dirk
>
> [ 1 ] I had some pleasant exchanges with Brian Ripley where I was able to
> suggest a few extension relative to the new millisecond granularity in POSIXt
> and its interfaces.

Recent releases of chron include

- July 14th (today!), see
  http://cran.r-project.org/src/contrib/Descriptions/chron.html

- June 23rd (less than one month ago),

- May 9th (two months ago)

(this may not be a complete list of recent releases) so I would characterize
chron as actively maintained and given the occasional question on r-help
its likely that its widely used too.


From spluque at gmail.com  Fri Jul 14 22:53:29 2006
From: spluque at gmail.com (Sebastian Luque)
Date: Fri, 14 Jul 2006 15:53:29 -0500
Subject: [Rd] chron vs. POSIX
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>
	<17591.64287.118524.251828@basebud.nulle.part>
Message-ID: <87hd1jvrg6.fsf@arctocephalus.homelinux.org>

Dirk Eddelbuettel <edd at debian.org> wrote:


On 14 July 2006 at 14:38, Sebastian Luque wrote:
| If Gabor's recommendations are to be followed, wouldn't it make sense to
| include chron in base R?  Given that flexibility for handling time

Future historians will provide a fuller account of the extended debates, but
my reading of these discussions here over the last few years leaves me with
the impression that Gabor is arguing for chron in a manner that is
simultaneously informed, polite, persistent and yet ... utterly isolated.

Date and POSIXt have served me well over the last few years. They are
maintained and being extended [ 1 ]. Chron, to the best of my knowledge, is
dead code so I'd bet against it appearing in core R any time soon.

Regards, Dirk

[ 1 ] I had some pleasant exchanges with Brian Ripley where I was able to
suggest a few extension relative to the new millisecond granularity in POSIXt
and its interfaces. 

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison

-- 
Seb


From edd at debian.org  Fri Jul 14 23:19:08 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 14 Jul 2006 16:19:08 -0500
Subject: [Rd] chron vs. POSIX
In-Reply-To: <971536df0607141332l1d8489adgeeb530efb4668081@mail.gmail.com>
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>
	<17591.64287.118524.251828@basebud.nulle.part>
	<971536df0607141332l1d8489adgeeb530efb4668081@mail.gmail.com>
Message-ID: <17592.2636.185792.282708@basebud.nulle.part>


On 14 July 2006 at 16:32, Gabor Grothendieck wrote:
| On 7/14/06, Dirk Eddelbuettel <edd at debian.org> wrote:
| > Date and POSIXt have served me well over the last few years. They are
| > maintained and being extended [ 1 ]. Chron, to the best of my knowledge, is
| > dead code so I'd bet against it appearing in core R any time soon.

[...]
 
| Recent releases of chron include
| 
| - July 14th (today!), see
|   http://cran.r-project.org/src/contrib/Descriptions/chron.html
| 
| - June 23rd (less than one month ago),
| 
| - May 9th (two months ago)
| 
| (this may not be a complete list of recent releases) so I would characterize
| chron as actively maintained and given the occasional question on r-help
| its likely that its widely used too.

Shows you what 'the best of my knowledge' is worth :)   I must have confused
it with the date package where the sole change in the last 2+ years was the
addition of a file inst/CITATION.  Sorry for spreading misinformation.

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From spluque at gmail.com  Fri Jul 14 23:39:00 2006
From: spluque at gmail.com (Sebastian Luque)
Date: Fri, 14 Jul 2006 16:39:00 -0500
Subject: [Rd] chron vs. POSIX
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>
	<17591.64287.118524.251828@basebud.nulle.part>
Message-ID: <87y7uvuarv.fsf@arctocephalus.homelinux.org>

[Sorry for my previous empty post]

Dirk Eddelbuettel <edd at debian.org> wrote:

> On 14 July 2006 at 14:38, Sebastian Luque wrote:
> | If Gabor's recommendations are to be followed, wouldn't it make sense
> | to include chron in base R?  Given that flexibility for handling time

> Future historians will provide a fuller account of the extended debates,
> but my reading of these discussions here over the last few years leaves
> me with the impression that Gabor is arguing for chron in a manner that
> is simultaneously informed, polite, persistent and yet ... utterly
> isolated.

> Date and POSIXt have served me well over the last few years. They are
> maintained and being extended [ 1 ]. Chron, to the best of my knowledge,
> is dead code so I'd bet against it appearing in core R any time soon.

That is not true, as Gabor pointed out.  At any rate, I can't understand
why there's only a choice between a dates-only class and another one
including every detail of time in R base.  As mentioned in Gabor's R News
article, the latter requires the user to pay attention to time zones and
daylight savings details that are completely irrelevant in some cases.
The drawbacks of using POSIX classes, in cases where TZ and DS are
irrelevant, can be quite serious when writing relatively complex code?.


[...]


Cheers,

+---- *Footnotes* ----+
? In addition to the list in the R News article, there's also issues with
  TZ attribute being lost after operations such as 'sapply' with POSIX
  objects.  Spotting that problem, and how to recover your POSIX object
  after that is not as simple as doing chron('sapply return value').

-- 
Seb


From murdoch at stats.uwo.ca  Sat Jul 15 03:02:27 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 14 Jul 2006 21:02:27 -0400
Subject: [Rd] chron vs. POSIX
In-Reply-To: <87psg8rn75.fsf@arctocephalus.homelinux.org>
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>
Message-ID: <44B83EA3.7020700@stats.uwo.ca>

On 7/14/2006 3:38 PM, Sebastian Luque wrote:
> Hi,
> 
> One of the big decisions when writing code is how to handle dates and
> times.  Gabor Grothendieck provided an excellent overview of the issue in
> his R News 4/1 (2004) article, and many users and developers are probably
> using it as a guide.  The proposed guideline is to use the simplest class
> required; as Gabor put it "use Date if possible, otherwise use chron, and
> otherwise use POSIX".
> 
> This seems to me a very efficient strategy, judging from my own
> experiences and those of others users.  All but the simplest calculations
> with POSIX objects demand great care, due to time zone and and daylight
> savings considerations.  Therefore, I've always chosen chron for
> relatively complex projects, where I don't need to deal with time zones or
> daylight savings problems.  The ease with which objects can be switched
> from numeric to chron representations is a major advantage IMHO?.
> 
> If Gabor's recommendations are to be followed, wouldn't it make sense to
> include chron in base R?  Given that flexibility for handling time
> variables is so fundamental, the addition of chron to base R would provide
> users everything they need to work with time, without the need to rely on
> an external package.  What do others think?

Putting something into base R essentially means that it is to be taken 
over by R core.  I think chron is being adequately maintained now (the R 
maintainer is already a member of R core), so I don't see a need for that.

I don't see a problem having a package on CRAN.  If it's a good package 
and people realize that it's good, and it remains available for others 
to use, then what problem is being solved?

Duncan Murdoch


From ggrothendieck at gmail.com  Sat Jul 15 19:01:51 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 15 Jul 2006 13:01:51 -0400
Subject: [Rd] chron vs. POSIX
In-Reply-To: <44B83EA3.7020700@stats.uwo.ca>
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>
	<44B83EA3.7020700@stats.uwo.ca>
Message-ID: <971536df0607151001l536b65c8t6ad40393fd3e35f3@mail.gmail.com>

On 7/14/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 7/14/2006 3:38 PM, Sebastian Luque wrote:
> > Hi,
> >
> > One of the big decisions when writing code is how to handle dates and
> > times.  Gabor Grothendieck provided an excellent overview of the issue in
> > his R News 4/1 (2004) article, and many users and developers are probably
> > using it as a guide.  The proposed guideline is to use the simplest class
> > required; as Gabor put it "use Date if possible, otherwise use chron, and
> > otherwise use POSIX".
> >
> > This seems to me a very efficient strategy, judging from my own
> > experiences and those of others users.  All but the simplest calculations
> > with POSIX objects demand great care, due to time zone and and daylight
> > savings considerations.  Therefore, I've always chosen chron for
> > relatively complex projects, where I don't need to deal with time zones or
> > daylight savings problems.  The ease with which objects can be switched
> > from numeric to chron representations is a major advantage IMHO?.
> >
> > If Gabor's recommendations are to be followed, wouldn't it make sense to
> > include chron in base R?  Given that flexibility for handling time
> > variables is so fundamental, the addition of chron to base R would provide
> > users everything they need to work with time, without the need to rely on
> > an external package.  What do others think?
>
> Putting something into base R essentially means that it is to be taken
> over by R core.  I think chron is being adequately maintained now (the R
> maintainer is already a member of R core), so I don't see a need for that.
>
> I don't see a problem having a package on CRAN.  If it's a good package
> and people realize that it's good, and it remains available for others
> to use, then what problem is being solved?

I think the problem is that there is nothing to signal its importance.  Perhaps
chron should be added to the "recommended" package list.

> as.vector(installed.packages(priority = "base")[,1])
 [1] "base"      "datasets"  "graphics"  "grDevices" "grid"      "methods"
 [7] "splines"   "stats"     "stats4"    "tcltk"     "tools"     "utils"

> as.vector(installed.packages(priority = "recommended")[,1])
 [1] "boot"       "class"      "cluster"    "foreign"    "KernSmooth"
 [6] "lattice"    "MASS"       "mgcv"       "nlme"       "nnet"
[11] "rpart"      "spatial"    "survival"

Alternately, a new naive datetime class, i.e. a datetime class not utlitizing
time zones and daylight savings time, could be created based on experience
with "chron" and the existing classes such that its internal representation
is like that of chron but its accessor methods are similar to existing core
methods to enhance uniformity of use among the various date and time classes.


From murdoch at stats.uwo.ca  Sat Jul 15 19:14:04 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 15 Jul 2006 13:14:04 -0400
Subject: [Rd] chron vs. POSIX
In-Reply-To: <971536df0607151001l536b65c8t6ad40393fd3e35f3@mail.gmail.com>
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>	<44B83EA3.7020700@stats.uwo.ca>
	<971536df0607151001l536b65c8t6ad40393fd3e35f3@mail.gmail.com>
Message-ID: <44B9225C.8000307@stats.uwo.ca>

On 7/15/2006 1:01 PM, Gabor Grothendieck wrote:
> On 7/14/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 7/14/2006 3:38 PM, Sebastian Luque wrote:
>>> Hi,
>>>
>>> One of the big decisions when writing code is how to handle dates and
>>> times.  Gabor Grothendieck provided an excellent overview of the issue in
>>> his R News 4/1 (2004) article, and many users and developers are probably
>>> using it as a guide.  The proposed guideline is to use the simplest class
>>> required; as Gabor put it "use Date if possible, otherwise use chron, and
>>> otherwise use POSIX".
>>>
>>> This seems to me a very efficient strategy, judging from my own
>>> experiences and those of others users.  All but the simplest calculations
>>> with POSIX objects demand great care, due to time zone and and daylight
>>> savings considerations.  Therefore, I've always chosen chron for
>>> relatively complex projects, where I don't need to deal with time zones or
>>> daylight savings problems.  The ease with which objects can be switched
>>> from numeric to chron representations is a major advantage IMHO?.
>>>
>>> If Gabor's recommendations are to be followed, wouldn't it make sense to
>>> include chron in base R?  Given that flexibility for handling time
>>> variables is so fundamental, the addition of chron to base R would provide
>>> users everything they need to work with time, without the need to rely on
>>> an external package.  What do others think?
>> Putting something into base R essentially means that it is to be taken
>> over by R core.  I think chron is being adequately maintained now (the R
>> maintainer is already a member of R core), so I don't see a need for that.
>>
>> I don't see a problem having a package on CRAN.  If it's a good package
>> and people realize that it's good, and it remains available for others
>> to use, then what problem is being solved?
> 
> I think the problem is that there is nothing to signal its importance.  Perhaps
> chron should be added to the "recommended" package list.

I think that would be preferable to making it a base package, but it's 
not the only way to publicize it.  Why not add something to the  Wiki to 
compare the various possibilities for storing dates and times?

Duncan Murdoch

> 
>> as.vector(installed.packages(priority = "base")[,1])
>  [1] "base"      "datasets"  "graphics"  "grDevices" "grid"      "methods"
>  [7] "splines"   "stats"     "stats4"    "tcltk"     "tools"     "utils"
> 
>> as.vector(installed.packages(priority = "recommended")[,1])
>  [1] "boot"       "class"      "cluster"    "foreign"    "KernSmooth"
>  [6] "lattice"    "MASS"       "mgcv"       "nlme"       "nnet"
> [11] "rpart"      "spatial"    "survival"
> 
> Alternately, a new naive datetime class, i.e. a datetime class not utlitizing
> time zones and daylight savings time, could be created based on experience
> with "chron" and the existing classes such that its internal representation
> is like that of chron but its accessor methods are similar to existing core
> methods to enhance uniformity of use among the various date and time classes.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Sat Jul 15 19:37:23 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 15 Jul 2006 13:37:23 -0400
Subject: [Rd] chron vs. POSIX
In-Reply-To: <44B9225C.8000307@stats.uwo.ca>
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>
	<44B83EA3.7020700@stats.uwo.ca>
	<971536df0607151001l536b65c8t6ad40393fd3e35f3@mail.gmail.com>
	<44B9225C.8000307@stats.uwo.ca>
Message-ID: <971536df0607151037q3ad8d114vb6e050ac8bb6d032@mail.gmail.com>

On 7/15/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 7/15/2006 1:01 PM, Gabor Grothendieck wrote:
> > On 7/14/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> On 7/14/2006 3:38 PM, Sebastian Luque wrote:
> >>> Hi,
> >>>
> >>> One of the big decisions when writing code is how to handle dates and
> >>> times.  Gabor Grothendieck provided an excellent overview of the issue in
> >>> his R News 4/1 (2004) article, and many users and developers are probably
> >>> using it as a guide.  The proposed guideline is to use the simplest class
> >>> required; as Gabor put it "use Date if possible, otherwise use chron, and
> >>> otherwise use POSIX".
> >>>
> >>> This seems to me a very efficient strategy, judging from my own
> >>> experiences and those of others users.  All but the simplest calculations
> >>> with POSIX objects demand great care, due to time zone and and daylight
> >>> savings considerations.  Therefore, I've always chosen chron for
> >>> relatively complex projects, where I don't need to deal with time zones or
> >>> daylight savings problems.  The ease with which objects can be switched
> >>> from numeric to chron representations is a major advantage IMHO?.
> >>>
> >>> If Gabor's recommendations are to be followed, wouldn't it make sense to
> >>> include chron in base R?  Given that flexibility for handling time
> >>> variables is so fundamental, the addition of chron to base R would provide
> >>> users everything they need to work with time, without the need to rely on
> >>> an external package.  What do others think?
> >> Putting something into base R essentially means that it is to be taken
> >> over by R core.  I think chron is being adequately maintained now (the R
> >> maintainer is already a member of R core), so I don't see a need for that.
> >>
> >> I don't see a problem having a package on CRAN.  If it's a good package
> >> and people realize that it's good, and it remains available for others
> >> to use, then what problem is being solved?
> >
> > I think the problem is that there is nothing to signal its importance.  Perhaps
> > chron should be added to the "recommended" package list.
>
> I think that would be preferable to making it a base package, but it's
> not the only way to publicize it.  Why not add something to the  Wiki to
> compare the various possibilities for storing dates and times?

As a recommended package it would be included in all binary releases
ensuring access without a separate install and would provide more
official endorsement.


From murdoch at stats.uwo.ca  Sat Jul 15 22:31:02 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 15 Jul 2006 16:31:02 -0400
Subject: [Rd] chron vs. POSIX
In-Reply-To: <971536df0607151037q3ad8d114vb6e050ac8bb6d032@mail.gmail.com>
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>	
	<44B83EA3.7020700@stats.uwo.ca>	
	<971536df0607151001l536b65c8t6ad40393fd3e35f3@mail.gmail.com>	
	<44B9225C.8000307@stats.uwo.ca>
	<971536df0607151037q3ad8d114vb6e050ac8bb6d032@mail.gmail.com>
Message-ID: <44B95086.1040903@stats.uwo.ca>

On 7/15/2006 1:37 PM, Gabor Grothendieck wrote:
> On 7/15/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 7/15/2006 1:01 PM, Gabor Grothendieck wrote:
>>> On 7/14/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>>>> On 7/14/2006 3:38 PM, Sebastian Luque wrote:
>>>>> Hi,
>>>>>
>>>>> One of the big decisions when writing code is how to handle dates and
>>>>> times.  Gabor Grothendieck provided an excellent overview of the issue in
>>>>> his R News 4/1 (2004) article, and many users and developers are probably
>>>>> using it as a guide.  The proposed guideline is to use the simplest class
>>>>> required; as Gabor put it "use Date if possible, otherwise use chron, and
>>>>> otherwise use POSIX".
>>>>>
>>>>> This seems to me a very efficient strategy, judging from my own
>>>>> experiences and those of others users.  All but the simplest calculations
>>>>> with POSIX objects demand great care, due to time zone and and daylight
>>>>> savings considerations.  Therefore, I've always chosen chron for
>>>>> relatively complex projects, where I don't need to deal with time zones or
>>>>> daylight savings problems.  The ease with which objects can be switched
>>>>> from numeric to chron representations is a major advantage IMHO?.
>>>>>
>>>>> If Gabor's recommendations are to be followed, wouldn't it make sense to
>>>>> include chron in base R?  Given that flexibility for handling time
>>>>> variables is so fundamental, the addition of chron to base R would provide
>>>>> users everything they need to work with time, without the need to rely on
>>>>> an external package.  What do others think?
>>>> Putting something into base R essentially means that it is to be taken
>>>> over by R core.  I think chron is being adequately maintained now (the R
>>>> maintainer is already a member of R core), so I don't see a need for that.
>>>>
>>>> I don't see a problem having a package on CRAN.  If it's a good package
>>>> and people realize that it's good, and it remains available for others
>>>> to use, then what problem is being solved?
>>> I think the problem is that there is nothing to signal its importance.  Perhaps
>>> chron should be added to the "recommended" package list.
>> I think that would be preferable to making it a base package, but it's
>> not the only way to publicize it.  Why not add something to the  Wiki to
>> compare the various possibilities for storing dates and times?
> 
> As a recommended package it would be included in all binary releases
> ensuring access without a separate install and would provide more
> official endorsement.

Yes, but that wasn't my question.  A Wiki entry on dates and times would 
be useful whether chron is a recommended package or not.  Why don't you 
write one based on your R News article, or at least write what you like 
about chron?  The nice thing about wikis is that if you write anything 
inaccurate, someone else will come along and correct you; if you miss 
something, someone will add it.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Sat Jul 15 23:00:52 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Sat, 15 Jul 2006 23:00:52 +0200 (CEST)
Subject: [Rd] dweibull retuns NaN instead of Inf (PR#9080)
Message-ID: <20060715210052.6294254AFC@slim.kubism.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-852712393-1152995865=:29235
Content-Type: TEXT/PLAIN; CHARSET=ISO-8859-1
Content-Transfer-Encoding: 8BIT
Content-ID: <Pine.LNX.4.64.0607152148581.29235 at gannet.stats.ox.ac.uk>

This is debatable: according to ?dweibull and ?dgamma both pdfs are 
defined with support (0, Inf), so in both cases the correct answer would 
appear to be 0.

This is in contrast to ?dexp which has the density defined on x >= 0.

It seems most references have the support as [0, Inf), in which case the 
problem is the evaluation of x log x or equivalent.

It seems we should change both the documentation and the result.

On Fri, 14 Jul 2006, goran.brostrom at gmail.com wrote:

> Full_Name: G?ran Brostr?m
> Version: 2.3.1
> OS: Linux, ubuntu
> Submission from: (NULL) (85.11.40.53)
> 
> 
> > dweibull(0, 0.5, 1)
> [1] NaN
> Warning message:
> NaNs produced in: dweibull(x, shape, scale, log)
> 
> should give Inf (and no Warning). Compare with
> 
> > dgamma(0, 0.5, 1)
> [1] Inf
> 
> This happens when 'shape' < 1.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-852712393-1152995865=:29235--


From ggrothendieck at gmail.com  Sun Jul 16 00:14:35 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 15 Jul 2006 18:14:35 -0400
Subject: [Rd] chron vs. POSIX
In-Reply-To: <44B95086.1040903@stats.uwo.ca>
References: <87psg8rn75.fsf@arctocephalus.homelinux.org>
	<44B83EA3.7020700@stats.uwo.ca>
	<971536df0607151001l536b65c8t6ad40393fd3e35f3@mail.gmail.com>
	<44B9225C.8000307@stats.uwo.ca>
	<971536df0607151037q3ad8d114vb6e050ac8bb6d032@mail.gmail.com>
	<44B95086.1040903@stats.uwo.ca>
Message-ID: <971536df0607151514t1671e4f1s6b2bf703940ecda1@mail.gmail.com>

On 7/15/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 7/15/2006 1:37 PM, Gabor Grothendieck wrote:
> > On 7/15/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> On 7/15/2006 1:01 PM, Gabor Grothendieck wrote:
> >>> On 7/14/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >>>> On 7/14/2006 3:38 PM, Sebastian Luque wrote:
> >>>>> Hi,
> >>>>>
> >>>>> One of the big decisions when writing code is how to handle dates and
> >>>>> times.  Gabor Grothendieck provided an excellent overview of the issue in
> >>>>> his R News 4/1 (2004) article, and many users and developers are probably
> >>>>> using it as a guide.  The proposed guideline is to use the simplest class
> >>>>> required; as Gabor put it "use Date if possible, otherwise use chron, and
> >>>>> otherwise use POSIX".
> >>>>>
> >>>>> This seems to me a very efficient strategy, judging from my own
> >>>>> experiences and those of others users.  All but the simplest calculations
> >>>>> with POSIX objects demand great care, due to time zone and and daylight
> >>>>> savings considerations.  Therefore, I've always chosen chron for
> >>>>> relatively complex projects, where I don't need to deal with time zones or
> >>>>> daylight savings problems.  The ease with which objects can be switched
> >>>>> from numeric to chron representations is a major advantage IMHO?.
> >>>>>
> >>>>> If Gabor's recommendations are to be followed, wouldn't it make sense to
> >>>>> include chron in base R?  Given that flexibility for handling time
> >>>>> variables is so fundamental, the addition of chron to base R would provide
> >>>>> users everything they need to work with time, without the need to rely on
> >>>>> an external package.  What do others think?
> >>>> Putting something into base R essentially means that it is to be taken
> >>>> over by R core.  I think chron is being adequately maintained now (the R
> >>>> maintainer is already a member of R core), so I don't see a need for that.
> >>>>
> >>>> I don't see a problem having a package on CRAN.  If it's a good package
> >>>> and people realize that it's good, and it remains available for others
> >>>> to use, then what problem is being solved?
> >>> I think the problem is that there is nothing to signal its importance.  Perhaps
> >>> chron should be added to the "recommended" package list.
> >> I think that would be preferable to making it a base package, but it's
> >> not the only way to publicize it.  Why not add something to the  Wiki to
> >> compare the various possibilities for storing dates and times?
> >
> > As a recommended package it would be included in all binary releases
> > ensuring access without a separate install and would provide more
> > official endorsement.
>
> Yes, but that wasn't my question.  A Wiki entry on dates and times would
> be useful whether chron is a recommended package or not.  Why don't you
> write one based on your R News article, or at least write what you like
> about chron?  The nice thing about wikis is that if you write anything
> inaccurate, someone else will come along and correct you; if you miss
> something, someone will add it.
>
> Duncan Murdoch
>

I think the R News article already sums up any knowledge I have on
the subject.   If anyone else has anything to add perhaps they could
put that in the wiki.


From pinard at iro.umontreal.ca  Sun Jul 16 03:34:40 2006
From: pinard at iro.umontreal.ca (=?iso-8859-1?Q?Fran=E7ois?= Pinard)
Date: Sat, 15 Jul 2006 21:34:40 -0400
Subject: [Rd] Matrices given to pt? [was: [R] for loops and counters]
Message-ID: <20060716013440.GA7167@phenix.progiciels-bpi.ca>

Hi, people.

I was a bit intrigued by the message quoted below.  Indeed, if pt() is 
given a matrix, it returns a matrix.  Should this feature be documented?
?pt speaks about "a vector of quantiles", and says nothing about the 
type of what it returns.

The same might presumably apply to other distribution-related functions.

----- Forwarded message from Martyn Plummer <plummer at iarc.fr> -----

From: Martyn Plummer <plummer at iarc.fr>
Date: Thu Apr 10 10:07:01 2003
Subject: [R] for loops and counters

Peter, 

You didn't say what goes wrong, but you mind find this version more useful

tstat <- (matrix(means, k,k, byrow=TRUE) - matrix(means, k,k,byrow=FALSE))/rms
pvalue <- 2*(1-pt(abs(tstat), df=df))
pvalue[upper.tri(pvalue)]

S is designed to allow you to work with "whole objects", which means that
for loops can (and should) be avoided.

Martyn

On 05-Oct-99 Peter B. Mandeville wrote:
> I am trying to assign values to a vector (pvalue). Similar code works in C
> but not in R. What am I doing wrong?

>       r <- pvalue <- 0
>       for(i in (1:(k-1))){
>               for(j in (i+1):k){
>                       r <- r+1
>                       tstat <- (means[i]-means[j])/rms
>                       pvalue[r] <- 2*(1-pt(abs(tstat),df))
>               }
>       }
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-help mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-help-request at stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

----- End forwarded message -----

-- 
Fran?ois Pinard   http://pinard.progiciels-bpi.ca


From ggrothendieck at gmail.com  Sun Jul 16 06:03:36 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 16 Jul 2006 00:03:36 -0400
Subject: [Rd] Matrices given to pt? [was: [R] for loops and counters]
In-Reply-To: <20060716013440.GA7167@phenix.progiciels-bpi.ca>
References: <20060716013440.GA7167@phenix.progiciels-bpi.ca>
Message-ID: <971536df0607152103h41897c0ftf3ec214df7bef1fd@mail.gmail.com>

I think what is happening is that it is preserving attributes of the input.
e.g.

> x <- 1:3
> attr(x, "A") <- 23
> pt(x, 3)
[1] 0.8044989 0.9303370 0.9711656
attr(,"A")
[1] 23

Note that attribute A was preserved.  Since matrices are just
vectors with a dim attribute that would imply the result.  I agree
that it would be a good idea to document it if it is intended.

On 7/15/06, Fran?ois Pinard <pinard at iro.umontreal.ca> wrote:
> Hi, people.
>
> I was a bit intrigued by the message quoted below.  Indeed, if pt() is
> given a matrix, it returns a matrix.  Should this feature be documented?
> ?pt speaks about "a vector of quantiles", and says nothing about the
> type of what it returns.
>
> The same might presumably apply to other distribution-related functions.
>
> ----- Forwarded message from Martyn Plummer <plummer at iarc.fr> -----
>
> From: Martyn Plummer <plummer at iarc.fr>
> Date: Thu Apr 10 10:07:01 2003
> Subject: [R] for loops and counters
>
> Peter,
>
> You didn't say what goes wrong, but you mind find this version more useful
>
> tstat <- (matrix(means, k,k, byrow=TRUE) - matrix(means, k,k,byrow=FALSE))/rms
> pvalue <- 2*(1-pt(abs(tstat), df=df))
> pvalue[upper.tri(pvalue)]
>
> S is designed to allow you to work with "whole objects", which means that
> for loops can (and should) be avoided.
>
> Martyn
>
> On 05-Oct-99 Peter B. Mandeville wrote:
> > I am trying to assign values to a vector (pvalue). Similar code works in C
> > but not in R. What am I doing wrong?
>
> >       r <- pvalue <- 0
> >       for(i in (1:(k-1))){
> >               for(j in (i+1):k){
> >                       r <- r+1
> >                       tstat <- (means[i]-means[j])/rms
> >                       pvalue[r] <- 2*(1-pt(abs(tstat),df))
> >               }
> >       }
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-help mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-help-request at stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
>
> ----- End forwarded message -----
>
> --
> Fran?ois Pinard   http://pinard.progiciels-bpi.ca
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hb at stat.berkeley.edu  Sun Jul 16 13:18:43 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 16 Jul 2006 13:18:43 +0200
Subject: [Rd] Fwd: Generating valid R code using R
In-Reply-To: <59d7961d0607160211v5941f05dwd8bc7de1ee5489ab@mail.gmail.com>
References: <59d7961d0607160211v5941f05dwd8bc7de1ee5489ab@mail.gmail.com>
Message-ID: <59d7961d0607160418hfa08022y945091969814577e@mail.gmail.com>

Sorry, this question was supposed to go to r-devel; move it there now. /HB

---------- Forwarded message ----------
From: Henrik Bengtsson <hb at stat.berkeley.edu>
Date: Jul 16, 2006 11:11 AM
Subject: Generating valid R code using R
To: R-help <r-help at stat.math.ethz.ch>


Hi,

I'm trying to generate valid R code using R. Parts of the task is to
read a sequence of characters from file and escape them such that they
can be put in quotation marks to form a valid R code string.  Example:

Let the input file be (four rows containing ASCII 0-255 characters):
abcdef<tab>ghijk\nlmno
second row\t\a\\

fourth and so on...
<EOF>

Now, find escapeString() such that the following piece of code
generates a second file called 'file2.txt' which is identical to
'file1.txt':

inStr <- readChar("file1.txt", nchars=999)
esStr <- escapeString(inStr)
rCode <- sprintf('cat(file="file2.txt", "%s")', esStr)
cat(file="foo.R", rCode)
source("foo.R")

For instance, quotation marks has to be escaped in order for 'rCode'
to be valid, same with newlines etc.  What's the best way to do this?
Currently I use an ad hoc sequence of gsub() substitutions to do this,
but is there a better way to create the 'rCode' string?

Thanks

Henrik


From p.dalgaard at biostat.ku.dk  Sun Jul 16 14:26:30 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 16 Jul 2006 14:26:30 +0200
Subject: [Rd] Fwd: Generating valid R code using R
In-Reply-To: <59d7961d0607160418hfa08022y945091969814577e@mail.gmail.com>
References: <59d7961d0607160211v5941f05dwd8bc7de1ee5489ab@mail.gmail.com>
	<59d7961d0607160418hfa08022y945091969814577e@mail.gmail.com>
Message-ID: <x2d5c5u45l.fsf@turmalin.kubism.ku.dk>

"Henrik Bengtsson" <hb at stat.berkeley.edu> writes:

> Sorry, this question was supposed to go to r-devel; move it there now. /HB
> 
> ---------- Forwarded message ----------
> From: Henrik Bengtsson <hb at stat.berkeley.edu>
> Date: Jul 16, 2006 11:11 AM
> Subject: Generating valid R code using R
> To: R-help <r-help at stat.math.ethz.ch>
> 
> 
> Hi,
> 
> I'm trying to generate valid R code using R. Parts of the task is to
> read a sequence of characters from file and escape them such that they
> can be put in quotation marks to form a valid R code string.  Example:
> 
> Let the input file be (four rows containing ASCII 0-255 characters):
> abcdef<tab>ghijk\nlmno
> second row\t\a\\
> 
> fourth and so on...
> <EOF>
> 
> Now, find escapeString() such that the following piece of code
> generates a second file called 'file2.txt' which is identical to
> 'file1.txt':
> 
> inStr <- readChar("file1.txt", nchars=999)
> esStr <- escapeString(inStr)
> rCode <- sprintf('cat(file="file2.txt", "%s")', esStr)
> cat(file="foo.R", rCode)
> source("foo.R")
> 
> For instance, quotation marks has to be escaped in order for 'rCode'
> to be valid, same with newlines etc.  What's the best way to do this?
> Currently I use an ad hoc sequence of gsub() substitutions to do this,
> but is there a better way to create the 'rCode' string?

I'd look in the direction of deparse/dput, as in

> X
[1] "abc\t\nfoobar\"\n"
> cat(X)
abc
foobar"
> deparse(X)
[1] "\"abc\\t\\nfoobar\\\"\\n\""


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ggrothendieck at gmail.com  Sun Jul 16 20:55:26 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 16 Jul 2006 14:55:26 -0400
Subject: [Rd] [R] put R on a web server
In-Reply-To: <p06002005c0dff4fdcab2@134.214.34.142>
References: <mailman.9.1153044003.7937.r-help@stat.math.ethz.ch>
	<p06002005c0dff4fdcab2@134.214.34.142>
Message-ID: <971536df0607161155l113b5997jee2395a1a0b1d328@mail.gmail.com>

Would be useful to have this list added to www.r-project.org web site or CRAN
or failing that to the wiki.  Sorry if its already there but I googled for the
first URL and www.r-project.org and it came up blank.

On 7/16/06, Jean lobry <lobry at biomserv.univ-lyon1.fr> wrote:
> >Has anyone put R on a web server any time, recently, please?
>
> It depends on what you mean by "recently".
>
> R 2.3.1 and 1054 packages at http://kryton.cc.unt.edu/cgi-bin/R/Rprog
> R 2.3.1 and 1046 packages at http://www.unt.edu/rss/Rinterface.htm
> R 2.3.1 and 499  packages at http://pbil.univ-lyon1.fr/Rweb/
> R 2.3.0 and 85   packages at http://rweb.stat.umn.edu/Rweb/
> R 2.2.1 and 359  packages at http://actin.ucd.ie/Rweb/
> R 2.2.0 and 25   packages at http://www.digitalhermit.com/math/Rweb.html
> R 2.2.0 and 25   packages at http://r.nakama.ne.jp/Rweb-jp/
> R 2.1.0 and 25   packages at http://dssm.unipa.it/R-php/
> R 2.1.0 and 25   packages at
> http://homeworld.rutgers.edu/Rweb/Rweb.general.html
> R 2.0.1 and 526  packages at http://www.ms.uky.edu/~statweb/
> R 1.9.1 and 35   packages at http://origin.scic.ulst.ac.uk/Rweb/
> R 1.9.0 and 106  packages at http://hermes.sdu.dk/cgi-bin/go/
> R 1.9.0 and 48   packages at http://claree.univ-lille1.fr/Rweb/
> R 1.8.1 and 30   packages at http://www.er.uqam.ca/nobel/r17165/Rweb/Rweb.html
> R 1.8.1 and 30   packages at http://bayes.math.montana.edu/Rweb/
> R 1.7.0 and 49   packages at http://bic.uams.edu/Rweb/
> R 1.6.1 and 28   packages at
> http://user.cs.tu-berlin.de/~ulfi/cgi-bin/r-online/r-online.cgi
> R 1.5.0 and 32   packages at http://www.nku.edu/~longa/Rweb/
> R 1.3.0 and 11   packages at http://genome1.beatson.gla.ac.uk/Rweb/
>
> --
> Jean R. Lobry            (lobry at biomserv.univ-lyon1.fr)
> Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - LYON I,
> 43 Bd 11/11/1918, F-69622 VILLEURBANNE CEDEX, FRANCE
> allo  : +33 472 43 12 87     fax    : +33 472 43 13 88
> http://pbil.univ-lyon1.fr/members/lobry/
>
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide! http://www.R-project.org/posting-guide.html
>


From zhuang at moho.ess.ucla.edu  Mon Jul 17 01:57:33 2006
From: zhuang at moho.ess.ucla.edu (zhuang at moho.ess.ucla.edu)
Date: Mon, 17 Jul 2006 01:57:33 +0200 (CEST)
Subject: [Rd] subsetting a matrix by conditions (PR#9082)
Message-ID: <20060716235733.342F154B45@slim.kubism.ku.dk>

Full_Name: Jiancang Zhuang
Version: 2.3.0
OS: Windows XP, BSD, Linux
Submission from: (NULL) (130.195.2.100)


> a<-matrix(scan(), ncol=3, byrow=T)
1: 6 NA 4 
4: 5 3 6
7: 8 2 9 
10: 3 6 NA
13: 
Read 12 items
> a
     [,1] [,2] [,3]
[1,]    6   NA    4
[2,]    5    3    6
[3,]    8    2    9
[4,]    3    6   NA
> a[a[,2]>2,]
     [,1] [,2] [,3]
[1,]   NA   NA   NA
[2,]    5    3    6
[3,]    3    6   NA

We may hope the first row of A removed or keep the same. However, R keeps the
first row and changes all the value in that row into NA.


From ggrothendieck at gmail.com  Mon Jul 17 04:29:42 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 16 Jul 2006 22:29:42 -0400
Subject: [Rd] multiplying multidimensional arrays (was: Re: [R] Manipulation
	involving arrays)
Message-ID: <971536df0607161929x3830b866hec34cb0bf642c175@mail.gmail.com>

I am moving this to r-devel.

The problem and solution below posted on r-help could have been
a bit slicker if %*% worked with multidimensional arrays multiplying
them so that if the first arg is a multidimensional array it is mulitplied
along the last dimension (and first dimension for the second arg).
Then one could have written:

Tbar <- tarray %*% t(wt) / rep(wti, each = 9)

which is a bit nicer than what had to be done, see below, given that %*% only
works with matrices.

I suggest that %*% be so extended to multidimensional arrays.  Note
that this is upwardly compatible and all existing cases would continue
to work unchanged.

On 7/16/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> The double loop is the same as:
>
>  Tbar[] <- matrix(tarray, 9) %*% t(wt) / rep(wti, each = 9)
>
>
> On 7/16/06, RAVI VARADHAN <rvaradhan at jhmi.edu> wrote:
> > Hi,
> >
> > I have the following piece of code that is part of a larger function.  This piece is the most time consuming part of the function, and I would like to make this a bit more efficient.  Could anyone suggest a way to do this faster?
> >
> > In particular, I would like to replace the nested "for" loop with a faster construct.  I tried things like "kronecker" and "outer" combined with apply, but couldn't get it to work.
> >
> >
> > Here is a sample code:
> >
> >  ##########################
> >  n <- 120
> >  sigerr <- 5
> >  covmat <- diag(c(8,6,3.5))
> >  mu <- c(105,12,10)
> >  mcsamp <- 10000
> >
> >  Tbar <- array(0, dim=c(3,3,n))
> >
> >  # theta is a mcsamp x 3 matrix
> >  theta <- mvrnorm(mcsamp, mu = mu, Sigma = covmat)
> >
> >  wt <- matrix(runif(n*mcsamp),n,mcsamp)
> >  wti <- apply(wt,1,sum)
> >
> >  tarray <- array(apply(theta,1,function(x)outer(x,x)),dim=c(3,3,mcsamp))
> >
> >  for (i in 1:n) {
> >  for (k in 1:mcsamp) {
> >  Tbar[,,i] <- Tbar[,,i] + wt[i,k] * tarray[,,k]
> >  }
> >  Tbar[,,i] <- Tbar[,,i] / wti[i]
> >  }
> >
>


From ripley at stats.ox.ac.uk  Mon Jul 17 08:16:25 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 17 Jul 2006 08:16:25 +0200 (CEST)
Subject: [Rd] subsetting a matrix by conditions (PR#9082)
Message-ID: <20060717061625.E8DBB54AC2@slim.kubism.ku.dk>

On Mon, 17 Jul 2006, zhuang at moho.ess.ucla.edu wrote:

> Full_Name: Jiancang Zhuang
> Version: 2.3.0
> OS: Windows XP, BSD, Linux
> Submission from: (NULL) (130.195.2.100)
> 
> 
> > a<-matrix(scan(), ncol=3, byrow=T)
> 1: 6 NA 4 
> 4: 5 3 6
> 7: 8 2 9 
> 10: 3 6 NA
> 13: 
> Read 12 items
> > a
>      [,1] [,2] [,3]
> [1,]    6   NA    4
> [2,]    5    3    6
> [3,]    8    2    9
> [4,]    3    6   NA
> > a[a[,2]>2,]
>      [,1] [,2] [,3]
> [1,]   NA   NA   NA
> [2,]    5    3    6
> [3,]    3    6   NA
> 
> We may hope the first row of A removed or keep the same. However, R keeps the
> first row and changes all the value in that row into NA.

What `we may hope' is not relevant to a bug report.  R works as 
documented.

In your example a[,2] is c(NA, 3, 2, 6) and so the condition is
c(NA, TRUE, FALSE, TRUE).  You do not know if the first row should be 
included or not (the information is missing), and so the correct answer is 
NA.

One reference is the R Language Definitions (R-lang) which says

Indexing with a missing (i.e.@: @code{NA}) value give an @code{NA}
result.  This rule applies also to the case of logical indexing,
i.e.@: the elements of @code{x} that have an @code{NA} selector in
@code{i} get included in the result, but their value will be @code{NA}.

Please do study the R FAQ and not misuse R-bugs to report documented 
behaviour.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mineoeli at unipa.it  Mon Jul 17 11:38:01 2006
From: mineoeli at unipa.it (Elio Mineo)
Date: Mon, 17 Jul 2006 11:38:01 +0200
Subject: [Rd] [R] put R on a web server
In-Reply-To: <971536df0607161155l113b5997jee2395a1a0b1d328@mail.gmail.com>
References: <mailman.9.1153044003.7937.r-help@stat.math.ethz.ch>	<p06002005c0dff4fdcab2@134.214.34.142>
	<971536df0607161155l113b5997jee2395a1a0b1d328@mail.gmail.com>
Message-ID: <44BB5A79.3040602@unipa.it>

A link to some R web server projects was achievable from the web page 
http://www.r-project.org/other-projects.html. The Url of this page was 
the following:
http://franklin.imgen.bcm.tmc.edu/R.web.servers/
but now this link seems down.
Bye,
Elio


Gabor Grothendieck wrote:

>Would be useful to have this list added to www.r-project.org web site or CRAN
>or failing that to the wiki.  Sorry if its already there but I googled for the
>first URL and www.r-project.org and it came up blank.
>
>On 7/16/06, Jean lobry <lobry at biomserv.univ-lyon1.fr> wrote:
>  
>
>>>Has anyone put R on a web server any time, recently, please?
>>>      
>>>
>>It depends on what you mean by "recently".
>>
>>R 2.3.1 and 1054 packages at http://kryton.cc.unt.edu/cgi-bin/R/Rprog
>>R 2.3.1 and 1046 packages at http://www.unt.edu/rss/Rinterface.htm
>>R 2.3.1 and 499  packages at http://pbil.univ-lyon1.fr/Rweb/
>>R 2.3.0 and 85   packages at http://rweb.stat.umn.edu/Rweb/
>>R 2.2.1 and 359  packages at http://actin.ucd.ie/Rweb/
>>R 2.2.0 and 25   packages at http://www.digitalhermit.com/math/Rweb.html
>>R 2.2.0 and 25   packages at http://r.nakama.ne.jp/Rweb-jp/
>>R 2.1.0 and 25   packages at http://dssm.unipa.it/R-php/
>>R 2.1.0 and 25   packages at
>>http://homeworld.rutgers.edu/Rweb/Rweb.general.html
>>R 2.0.1 and 526  packages at http://www.ms.uky.edu/~statweb/
>>R 1.9.1 and 35   packages at http://origin.scic.ulst.ac.uk/Rweb/
>>R 1.9.0 and 106  packages at http://hermes.sdu.dk/cgi-bin/go/
>>R 1.9.0 and 48   packages at http://claree.univ-lille1.fr/Rweb/
>>R 1.8.1 and 30   packages at http://www.er.uqam.ca/nobel/r17165/Rweb/Rweb.html
>>R 1.8.1 and 30   packages at http://bayes.math.montana.edu/Rweb/
>>R 1.7.0 and 49   packages at http://bic.uams.edu/Rweb/
>>R 1.6.1 and 28   packages at
>>http://user.cs.tu-berlin.de/~ulfi/cgi-bin/r-online/r-online.cgi
>>R 1.5.0 and 32   packages at http://www.nku.edu/~longa/Rweb/
>>R 1.3.0 and 11   packages at http://genome1.beatson.gla.ac.uk/Rweb/
>>
>>--
>>Jean R. Lobry            (lobry at biomserv.univ-lyon1.fr)
>>Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - LYON I,
>>43 Bd 11/11/1918, F-69622 VILLEURBANNE CEDEX, FRANCE
>>allo  : +33 472 43 12 87     fax    : +33 472 43 13 88
>>http://pbil.univ-lyon1.fr/members/lobry/
>>
>>______________________________________________
>>R-help at stat.math.ethz.ch mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-help
>>PLEASE do read the posting guide! http://www.R-project.org/posting-guide.html
>>
>>    
>>
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>
>  
>

-- 
----------------------------------------------------------------------------------
Angelo M. Mineo
Dipartimento di Scienze Statistiche e Matematiche "S. Vianelli"
Universit? degli Studi di Palermo
Viale delle Scienze
90128 Palermo
url: http://dssm.unipa.it/elio


From pierreclauss at yahoo.fr  Mon Jul 17 11:45:43 2006
From: pierreclauss at yahoo.fr (pierre clauss)
Date: Mon, 17 Jul 2006 09:45:43 +0000 (GMT)
Subject: [Rd] Re :  [R] Date Format
In-Reply-To: <1152695439.2394.44.camel@seurat.iarc.fr>
Message-ID: <20060717094543.3629.qmail@web26307.mail.ukl.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060717/3d368fa2/attachment.pl 

From rvaradhan at jhmi.edu  Mon Jul 17 15:18:45 2006
From: rvaradhan at jhmi.edu (RAVI VARADHAN)
Date: Mon, 17 Jul 2006 09:18:45 -0400
Subject: [Rd] multiplying multidimensional arrays (was: Re: [R]
 Manipulation involving arrays)
In-Reply-To: <971536df0607161929x3830b866hec34cb0bf642c175@mail.gmail.com>
References: <971536df0607161929x3830b866hec34cb0bf642c175@mail.gmail.com>
Message-ID: <f49eaeca3a05.44bb55f5@johnshopkins.edu>

Dear Gabor,

Thank you very much for your solution.  It speeded calculations by a factor of two.  

Now to your recommendation about making this solution a basic operation.  I completely agree with your suggestion. That is exactly what I would have hoped for.  In fact, my first try was to do:

Tbar <- tarray %*% t(wt)

Since tarray is (3,3,mcsamp) and wt is (n,mcsamp), I figured that the result would be a (3,3,n) array that would sum over mcsamp, as in the case of 2-dim array multiplication.  But obviously that didn't work as "non-conformable".  Your simple trick of forcing the 3-dim array to a 2-dim matrix using matrix(tarray, 3*3) is quite clever.

Thanks again for your help.

Best,
Ravi.

----- Original Message -----
From: Gabor Grothendieck <ggrothendieck at gmail.com>
Date: Sunday, July 16, 2006 10:29 pm
Subject: multiplying multidimensional arrays (was: Re: [R] Manipulation involving arrays)

> I am moving this to r-devel.
> 
> The problem and solution below posted on r-help could have been
> a bit slicker if %*% worked with multidimensional arrays multiplying
> them so that if the first arg is a multidimensional array it is 
> mulitpliedalong the last dimension (and first dimension for the 
> second arg).
> Then one could have written:
> 
> Tbar <- tarray %*% t(wt) / rep(wti, each = 9)
> 
> which is a bit nicer than what had to be done, see below, given 
> that %*% only
> works with matrices.
> 
> I suggest that %*% be so extended to multidimensional arrays.  Note
> that this is upwardly compatible and all existing cases would continue
> to work unchanged.
> 
> On 7/16/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> > The double loop is the same as:
> >
> >  Tbar[] <- matrix(tarray, 9) %*% t(wt) / rep(wti, each = 9)
> >
> >
> > On 7/16/06, RAVI VARADHAN <rvaradhan at jhmi.edu> wrote:
> > > Hi,
> > >
> > > I have the following piece of code that is part of a larger 
> function.  This piece is the most time consuming part of the 
> function, and I would like to make this a bit more efficient.  
> Could anyone suggest a way to do this faster?
> > >
> > > In particular, I would like to replace the nested "for" loop 
> with a faster construct.  I tried things like "kronecker" and 
> "outer" combined with apply, but couldn't get it to work.
> > >
> > >
> > > Here is a sample code:
> > >
> > >  ##########################
> > >  n <- 120
> > >  sigerr <- 5
> > >  covmat <- diag(c(8,6,3.5))
> > >  mu <- c(105,12,10)
> > >  mcsamp <- 10000
> > >
> > >  Tbar <- array(0, dim=c(3,3,n))
> > >
> > >  # theta is a mcsamp x 3 matrix
> > >  theta <- mvrnorm(mcsamp, mu = mu, Sigma = covmat)
> > >
> > >  wt <- matrix(runif(n*mcsamp),n,mcsamp)
> > >  wti <- apply(wt,1,sum)
> > >
> > >  tarray <- 
> array(apply(theta,1,function(x)outer(x,x)),dim=c(3,3,mcsamp))> >
> > >  for (i in 1:n) {
> > >  for (k in 1:mcsamp) {
> > >  Tbar[,,i] <- Tbar[,,i] + wt[i,k] * tarray[,,k]
> > >  }
> > >  Tbar[,,i] <- Tbar[,,i] / wti[i]
> > >  }
> > >
> >
>


From vincent.goulet at act.ulaval.ca  Mon Jul 17 21:03:34 2006
From: vincent.goulet at act.ulaval.ca (Vincent Goulet)
Date: Mon, 17 Jul 2006 15:03:34 -0400
Subject: [Rd] Patch to allow negative argument in head() and tail()
Message-ID: <200607171503.34713.vincent.goulet@act.ulaval.ca>

Dear developeRs (and other abuseRs ;-),

I would like to contribute a patch against functions head() and tail() of 
package utils to allow for a negative 'n' argument. This allows to extract 
all but the first/last 'n' elements/rows/lines of an object, similar to 
the "drop" operator of APL. [1]

I put the patched head.R and head.Rd files, along with diff files in

	http://vgoulet.act.ulaval.ca/pub/R/

The differences were obtained against today's version of r-devel (more 
specifically revision 30277 of head.R and revision 30915 of head.Rd).

Some comments:

- The current version of head() and tail() will accept a vector of length > 1 
for argument 'n' but will silently use the smallest value. This became 
awkward to reproduce in my versions and did not seem interesting anyway. 
Instead, I added an error message if length(n)  > 1.

- I used the word "scalar" in the aforementioned error message to mean a 
vector of length 1. Perhaps is this not the correct R terminology?

- I added a 'addrownums = TRUE' argument to head() used when n < 0, similar to 
tail() with n > 0. This required to write separate methods for 
classes 'data.frame' and 'matrix'.

- The 'function' methods are not modified.

- In the man page, the 'function' method was not documented in the usage 
section. Done now.

- I don't think the patch would break any existing code, except code using the 
(undocumented) "feature" mentioned in my first remark, above.

I hope you will find my (albeit small) contribution useful.

Best regards,

-----
[1] See previous messages to r-devel by myself 
<https://stat.ethz.ch/pipermail/r-devel/2005-April/032881.html>
and Bill Venables 
<https://stat.ethz.ch/pipermail/r-devel/2005-May/033081.html>

-- 
  Vincent Goulet, Associate Professor
  ?cole d'actuariat
  Universit? Laval, Qu?bec 
  Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca


From jvierine at gmail.com  Mon Jul 17 21:21:10 2006
From: jvierine at gmail.com (Juha Vierinen)
Date: Mon, 17 Jul 2006 22:21:10 +0300
Subject: [Rd] R as shell script
In-Reply-To: <44B7D4E1.7030404@vanderbilt.edu>
References: <b96098070607140715hc7ca785xa5ca190348f24aa3@mail.gmail.com>
	<44B7D4E1.7030404@vanderbilt.edu>
Message-ID: <b96098070607171221g40e95af4p469045e4715b9b4f@mail.gmail.com>

Hi Jeffrey!

Great work with rinterp! I had barely read into the R embedded API and
somebody implements exactly what I need. Thank you! I played around
with it a bit and I was able to access stdin() without any
modifications, I have added a stdin example to the wiki. I hope this
can be considered for inclusion to the R distribution.

I took a quick stab at adding making a copy of argc and argv to the R
script, but those macros look quite scary, so I might be doing many
more mistakes than I am aware of (hint: malloc). Now command line
arguments are also passed, and the following also works:

--------args.r:
#!/usr/bin/rinterp

cat("n args: ")
cat(argc)
cat("\n")
for (i in 1:argc)
{
  cat(sprintf("arg %d = %s\n",i,argv[i]))
}
-------------

> ./args.r a b c
n args: 4
arg 1 = ./args.r
arg 2 = a
arg 3 = b
arg 4 = c

The attachment contains the new rinterp.c

juha

On 7/14/06, Jeffrey Horner <jeff.horner at vanderbilt.edu> wrote:
> Juha Vierinen wrote:
> > Hi,
> >
> > I am considering if I should invest in learning R. Based on the
> > language definition and introductory documents, it seems nice. But now
> > I am faced with a problem: I want to be able to run R programs easily
> > from the unix shell, and write scripts that can automatically select R
> > as the interpreter:
> >
> > #!/usr/bin/R
> > cat("Hello world.\n")
> >
> > This of course doesn't work, because /usr/bin/R is a shell script.
> >
> > I have been able to create a binary wrapper that calls R with the
> > correct arguments, which is documented here:
> >
> > http://kavaro.fi/mediawiki/index.php/Using_R_from_the_shell
> >
> > This still lacks eg. standard input (but I have no idea how I can
> > implement it in R) and full command line argument passing (can be
> > done), but am I on the right track, or is there already something that
> > does what I need?
>
> If you search the mailing list archives:
>
> http://tolstoy.newcastle.edu.au/R/
>
> you can find entries like the following (searching on "bang"):
>
> http://tolstoy.newcastle.edu.au/R/devel/05/01/1910.html
>
> which implements similar functionality. But I thought this would be a
> fun little (distracting) project, so I created an R wiki page:
>
> http://wiki.r-project.org/rwiki/doku.php?id=developers:rinterp
>
> with source code describing how to solve this problem by embedding R
> within your C program. Here's the main function:
>
> /* rinterp: shebang support for R
>   *
>   * Usage:
>   *
>   * From the command line:
>   * $ rinterp filename
>   *
>   * In a file:
>   * --------------------
>   * #!/path/to/rinterp
>   * cat("hello world\n");
>   * --------------------
>   */
> int main(int argc, char **argv){
>
>      /* R embedded arguments */
>      char *R_argv[] = {"RINTERP", "--gui=none", "--slave", "--silent",
> "--vanilla","--no-readline"};
>      int R_argc = sizeof(R_argv)/sizeof(R_argv[0]);
>
>      struct stat sbuf;
>
>      /* Setenv R_HOME: insert or replace into environment.
>       * The RHOME macro is defined during configure
>       */
>      if (setenv("R_HOME",RHOME,1) != 0){
>          perror("ERROR: couldn't set/replace R_HOME");
>          exit(1);
>      }
>
>      /* Assume last argument is the file we want to source.
>       * Ignore other args for now.
>       */
>      if (argc > 1) {/* don't try and source rinterp binary */
>          if (stat(argv[argc-1],&sbuf) != 0){
>              perror(argv[argc-1]);
>              exit(1);
>          }
>      } else {
>          fprintf(stderr,"Usage: rinterp filename\n");
>          exit(1);
>      }
>
>      /* Initialize R interpreter */
>      Rf_initEmbeddedR(R_argc, R_argv);
>
>      /* Now call R function source(filename) */
>      call_fun1str("source",argv[argc-1]);
>
>      exit(0);
> }
>
> Feel free to logon to the R wiki and contribute to the page. I think it
> would be interesting to solve this once and for all.
>
> Cheers!
> --
> Jeffrey Horner       Computer Systems Analyst         School of Medicine
> 615-322-8606         Department of Biostatistics   Vanderbilt University
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

From maechler at stat.math.ethz.ch  Tue Jul 18 10:42:22 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 18 Jul 2006 10:42:22 +0200
Subject: [Rd] Patch to allow negative argument in head() and tail()
In-Reply-To: <200607171503.34713.vincent.goulet@act.ulaval.ca>
References: <200607171503.34713.vincent.goulet@act.ulaval.ca>
Message-ID: <17596.40686.710925.321109@stat.math.ethz.ch>

>>>>> "Vincent" == Vincent Goulet <vincent.goulet at act.ulaval.ca>
>>>>>     on Mon, 17 Jul 2006 15:03:34 -0400 writes:

    Vincent> Dear developeRs (and other abuseRs ;-),

    Vincent> I would like to contribute a patch against
    Vincent> functions head() and tail() of package utils to
    Vincent> allow for a negative 'n' argument. This allows to
    Vincent> extract all but the first/last 'n'
    Vincent> elements/rows/lines of an object, similar to the
    Vincent> "drop" operator of APL. [1]

Hmm, if you reread  Bill Venables proposal (URL below), you did
something different : In Bill's (and my!) "book",

  head would always give the *first* few entries and 
  tail would always give the *last*  few entries.

That's different from APL's drop, but for a good reason:
The words 'head' and 'tail' exactly suggest so.

    Vincent> I put the patched head.R and head.Rd files, along with diff files in
    Vincent> http://vgoulet.act.ulaval.ca/pub/R/

    Vincent> The differences were obtained against today's version of r-devel (more 
    Vincent> specifically revision 30277 of head.R and revision 30915 of head.Rd).

That's good (to take the "current" sources for the diffs).

    Vincent> Some comments:

    Vincent> - The current version of head() and tail() will
    Vincent> accept a vector of length > 1 for argument 'n' but
    Vincent> will silently use the smallest value. This became
    Vincent> awkward to reproduce in my versions and did not
    Vincent> seem interesting anyway.  Instead, I added an error
    Vincent> message if length(n) > 1.

that's ok in my view

    Vincent> - I used the word "scalar" in the aforementioned
    Vincent> error message to mean a vector of length 1. Perhaps
    Vincent> is this not the correct R terminology?

indeed, it's rarely used in R terminology; for one reason
because S (and hence R) does not differentiate between length-1
vectors and scalars the way APL does.

    Vincent> - I added a 'addrownums = TRUE' argument to head() used when n < 0, similar to 
    Vincent> tail() with n > 0. This required to write separate methods for 
    Vincent> classes 'data.frame' and 'matrix'.

seems not unreasonable {I did not yet look at your implementation there}

    Vincent> - The 'function' methods are not modified.

    Vincent> - In the man page, the 'function' method was not documented in the usage 
    Vincent> section. Done now.

ok, though not necessary: The recommended approach is to only
   document methods when they have ``surprising arguments'', i.e.,
   arguments not in the generic function.

In our case, 'n = 6' is not part of the generic, so strictly
speaking *is* a "surprising argument". 
Probably it was not made part of the generic, since it's
imaginable to have objects whose "head" is always of a fixed
given size, and where specifying 'n' does not make sense.


    Vincent> - I don't think the patch would break any existing code, except code using the 
    Vincent> (undocumented) "feature" mentioned in my first remark, above.

    Vincent> I hope you will find my (albeit small) contribution useful.

Yes, but can you change it such that head() does give the "head"
and tail() the "tail" also for negative 'n' ?

    Vincent> Best regards,

Bonnes salutations,
Martin

    Vincent> -----
    Vincent> [1] See previous messages to r-devel by myself 
    Vincent> <https://stat.ethz.ch/pipermail/r-devel/2005-April/032881.html>

    Vincent> and Bill Venables 
    Vincent> <https://stat.ethz.ch/pipermail/r-devel/2005-May/033081.html>


From tuechler at gmx.at  Tue Jul 18 11:54:08 2006
From: tuechler at gmx.at (Heinz Tuechler)
Date: Tue, 18 Jul 2006 10:54:08 +0100
Subject: [Rd] raw data documentation
Message-ID: <3.0.6.32.20060718105408.00ace450@pop.gmx.net>

Dear Developers,

after several discussions on r-help I got the impression that the
"standard" R distribution, including the recommended packages, does not
offer much to document raw data, imported into R.
Hmisc has some functionality in this respect, and others like Richard
Heiberger solved some other aspects, but I think there could be a more
unified approach, which, of course needs the support from the core
developers to become "standard".
In particular I am looking for is a possibility to label variables, label
values and add other information. Of course, all this is possible by adding
attributes, but most attributes are lost when indexing/subsetting.
>From many helpful suggestions of others I learned that this can be resolved
by defining a class and corresponding methods, as is done for variable
labels in Hmisc.
For now I drafted something more general for my personal use, but before
continuing on this I want to know, if there is some intention at the core
developer team to work on the question of raw data documentation.

Greetings,

Heinz T?chler


From jarno.tuimala at csc.fi  Tue Jul 18 12:06:07 2006
From: jarno.tuimala at csc.fi (jarno.tuimala at csc.fi)
Date: Tue, 18 Jul 2006 12:06:07 +0200 (CEST)
Subject: [Rd] R-2.3.1.tar.gz does not contain VR bundle (PR#9084)
Message-ID: <20060718100607.77AC354AE2@slim.kubism.ku.dk>

Full_Name: Jarno Tuimala
Version: 2.3.1
OS: Solaris / Linux
Submission from: (NULL) (193.166.2.98)


Today I downloaded the latest source code release R-2.3.1.tar.gz, and it seems
not to contain the VR bundle. After running ./configure I get the following
error message:

checking for recommended packages... ./src/library/Recommended/VR_*.tar.gz: No
such file or directory
no
configure: error: Some of the recommended packages are missing
  Use --without-recommended-packages if this was intentional
39.99u 115.47s 3:02.64 85.1%

There is a soft link to the newest version of bundle under
/src/library/Recommended, but the actual bundle is missing:

drwx------   2 biosci   csc         1024 Jun  1 11:25 ./
drwx------  16 biosci   csc         1024 Jun  1 11:25 ../
-rw-------   1 biosci   csc           20 Apr 10 01:19 .cvsignore
lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 boot.tgz ->
boot_1.2-24.tar.gz
-rw-------   1 biosci   csc       187471 Apr 10 01:29 boot_1.2-24.tar.gz
lrwxrwxrwx   1 biosci   csc           21 Jul 18 12:42 cluster.tgz ->
cluster_1.11.0.tar.gz
-rw-------   1 biosci   csc       210215 May 19 12:30 cluster_1.11.0.tar.gz
lrwxrwxrwx   1 biosci   csc           21 Jul 18 12:42 foreign.tgz ->
foreign_0.8-15.tar.gz
-rw-------   1 biosci   csc       300878 Apr 10 01:29 foreign_0.8-15.tar.gz
lrwxrwxrwx   1 biosci   csc           25 Jul 18 12:42 KernSmooth.tgz ->
KernSmooth_2.22-17.tar.gz
-rw-------   1 biosci   csc        26876 Apr 10 01:29 KernSmooth_2.22-17.tar.gz
lrwxrwxrwx   1 biosci   csc           21 Jul 18 12:42 lattice.tgz ->
lattice_0.13-8.tar.gz
-rw-------   1 biosci   csc       226490 Apr 19 05:05 lattice_0.13-8.tar.gz
-rw-------   1 biosci   csc         2394 Apr 10 01:19 Makefile.in
lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 mgcv.tgz ->
mgcv_1.3-17.tar.gz
-rw-------   1 biosci   csc       263254 May 19 12:30 mgcv_1.3-17.tar.gz
lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 nlme.tgz ->
nlme_3.1-73.tar.gz
-rw-------   1 biosci   csc       709014 May 23 05:05 nlme_3.1-73.tar.gz
lrwxrwxrwx   1 biosci   csc           19 Jul 18 12:42 rpart.tgz ->
rpart_3.1-29.tar.gz
-rw-------   1 biosci   csc       119319 Apr 19 05:05 rpart_3.1-29.tar.gz
lrwxrwxrwx   1 biosci   csc           20 Jul 18 12:42 survival.tgz ->
survival_2.26.tar.gz
-rw-------   1 biosci   csc       862822 May 21 05:05 survival_2.26.tar.gz
lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 VR.tgz ->
VR_7.2-27.1.tar.gz

Of course, this is easy to fix just by downloading and copying the VR bundle to
the correct place. But, maybe it could also be included in the latest source
code release?

Best Regards,
Jarno Tuimala


From ripley at stats.ox.ac.uk  Tue Jul 18 12:29:20 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 18 Jul 2006 11:29:20 +0100 (BST)
Subject: [Rd] Matrices given to pt? [was: [R] for loops and counters]
In-Reply-To: <20060716013440.GA7167@phenix.progiciels-bpi.ca>
References: <20060716013440.GA7167@phenix.progiciels-bpi.ca>
Message-ID: <Pine.LNX.4.64.0607181121390.10130@gannet.stats.ox.ac.uk>

There is a general rule that scalar operations (that is functions 
that work element-by-element and return a scalar result) preserve 
attributes including names, dims and dimnames.

Similarly, there is a general rule about binary operations and attributes.

These things should definitely be in the `R Language Definition', but that 
languishes as a draft.  I am writing up comments on R internals (currently 
an appendix on `Writing R Extensions', and this will go there (the section 
on attributes is current work).

On Sat, 15 Jul 2006, Fran?ois Pinard wrote:

> Hi, people.
> 
> I was a bit intrigued by the message quoted below.  Indeed, if pt() is 
> given a matrix, it returns a matrix.  Should this feature be documented?
> ?pt speaks about "a vector of quantiles", and says nothing about the 
> type of what it returns.
> 
> The same might presumably apply to other distribution-related functions.
> 
> ----- Forwarded message from Martyn Plummer <plummer at iarc.fr> -----
> 
> From: Martyn Plummer <plummer at iarc.fr>
> Date: Thu Apr 10 10:07:01 2003
> Subject: [R] for loops and counters
> 
> Peter, 
> 
> You didn't say what goes wrong, but you mind find this version more useful
> 
> tstat <- (matrix(means, k,k, byrow=TRUE) - matrix(means, k,k,byrow=FALSE))/rms
> pvalue <- 2*(1-pt(abs(tstat), df=df))
> pvalue[upper.tri(pvalue)]
> 
> S is designed to allow you to work with "whole objects", which means that
> for loops can (and should) be avoided.
> 
> Martyn
> 
> On 05-Oct-99 Peter B. Mandeville wrote:
> > I am trying to assign values to a vector (pvalue). Similar code works in C
> > but not in R. What am I doing wrong?
> 
> >       r <- pvalue <- 0
> >       for(i in (1:(k-1))){
> >               for(j in (i+1):k){
> >                       r <- r+1
> >                       tstat <- (means[i]-means[j])/rms
> >                       pvalue[r] <- 2*(1-pt(abs(tstat),df))
> >               }
> >       }
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-help mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-help-request at stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
> 
> ----- End forwarded message -----
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Tue Jul 18 12:36:16 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 18 Jul 2006 12:36:16 +0200 (CEST)
Subject: [Rd] R-2.3.1.tar.gz does not contain VR bundle (PR#9084)
Message-ID: <20060718103616.22C8554AF6@slim.kubism.ku.dk>

Where did you get this file from?

The version on the CRAM master does contain the bundle (and did it not 
seem strange to you that no one had reported this in the 6 weeks that the 
version had been out if there was a problem?).

gannet% wget http://cran.r-project.org/src/base/R-2/R-2.3.1.tar.gz
--11:32:58--  http://cran.r-project.org/src/base/R-2/R-2.3.1.tar.gz
           => `R-2.3.1.tar.gz'
Resolving cran.r-project.org... 137.208.57.37
Connecting to cran.r-project.org|137.208.57.37|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 14,285,120 (14M) [application/x-tar]

100%[====================================>] 14,285,120   700.23K/s    ETA 
00:00

11:33:14 (911.27 KB/s) - `R-2.3.1.tar.gz' saved [14285120/14285120]

gannet% tar ztvf R-2.3.1.tar.gz | grep VR
lrwxrwxrwx pd/bs             0 2006-06-01 09:25:04 
R-2.3.1/src/library/Recommended/VR.tgz -> VR_7.2-27.1.tar.gz
-rwxr-sr-x pd/bs        478191 2006-05-18 10:14:01 
R-2.3.1/src/library/Recommended/VR_7.2-27.1.tar.gz
gannet% md5sum R-2.3.1.tar.gz
a1d6d8081af4c71006a6e5a3ed54e4da  R-2.3.1.tar.gz


It is also possible that there is a bug in your tar, or a problem with 
your disc system when unpacking.


On Tue, 18 Jul 2006, jarno.tuimala at csc.fi wrote:

> Full_Name: Jarno Tuimala
> Version: 2.3.1
> OS: Solaris / Linux
> Submission from: (NULL) (193.166.2.98)
> 
> 
> Today I downloaded the latest source code release R-2.3.1.tar.gz, and it seems
> not to contain the VR bundle. After running ./configure I get the following
> error message:
> 
> checking for recommended packages... ./src/library/Recommended/VR_*.tar.gz: No
> such file or directory
> no
> configure: error: Some of the recommended packages are missing
>   Use --without-recommended-packages if this was intentional
> 39.99u 115.47s 3:02.64 85.1%
> 
> There is a soft link to the newest version of bundle under
> /src/library/Recommended, but the actual bundle is missing:
> 
> drwx------   2 biosci   csc         1024 Jun  1 11:25 ./
> drwx------  16 biosci   csc         1024 Jun  1 11:25 ../
> -rw-------   1 biosci   csc           20 Apr 10 01:19 .cvsignore
> lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 boot.tgz ->
> boot_1.2-24.tar.gz
> -rw-------   1 biosci   csc       187471 Apr 10 01:29 boot_1.2-24.tar.gz
> lrwxrwxrwx   1 biosci   csc           21 Jul 18 12:42 cluster.tgz ->
> cluster_1.11.0.tar.gz
> -rw-------   1 biosci   csc       210215 May 19 12:30 cluster_1.11.0.tar.gz
> lrwxrwxrwx   1 biosci   csc           21 Jul 18 12:42 foreign.tgz ->
> foreign_0.8-15.tar.gz
> -rw-------   1 biosci   csc       300878 Apr 10 01:29 foreign_0.8-15.tar.gz
> lrwxrwxrwx   1 biosci   csc           25 Jul 18 12:42 KernSmooth.tgz ->
> KernSmooth_2.22-17.tar.gz
> -rw-------   1 biosci   csc        26876 Apr 10 01:29 KernSmooth_2.22-17.tar.gz
> lrwxrwxrwx   1 biosci   csc           21 Jul 18 12:42 lattice.tgz ->
> lattice_0.13-8.tar.gz
> -rw-------   1 biosci   csc       226490 Apr 19 05:05 lattice_0.13-8.tar.gz
> -rw-------   1 biosci   csc         2394 Apr 10 01:19 Makefile.in
> lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 mgcv.tgz ->
> mgcv_1.3-17.tar.gz
> -rw-------   1 biosci   csc       263254 May 19 12:30 mgcv_1.3-17.tar.gz
> lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 nlme.tgz ->
> nlme_3.1-73.tar.gz
> -rw-------   1 biosci   csc       709014 May 23 05:05 nlme_3.1-73.tar.gz
> lrwxrwxrwx   1 biosci   csc           19 Jul 18 12:42 rpart.tgz ->
> rpart_3.1-29.tar.gz
> -rw-------   1 biosci   csc       119319 Apr 19 05:05 rpart_3.1-29.tar.gz
> lrwxrwxrwx   1 biosci   csc           20 Jul 18 12:42 survival.tgz ->
> survival_2.26.tar.gz
> -rw-------   1 biosci   csc       862822 May 21 05:05 survival_2.26.tar.gz
> lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 VR.tgz ->
> VR_7.2-27.1.tar.gz
> 
> Of course, this is easy to fix just by downloading and copying the VR bundle to
> the correct place. But, maybe it could also be included in the latest source
> code release?
> 
> Best Regards,
> Jarno Tuimala
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jtuimala at csc.fi  Tue Jul 18 13:46:08 2006
From: jtuimala at csc.fi (jtuimala at csc.fi)
Date: Tue, 18 Jul 2006 13:46:08 +0200 (CEST)
Subject: [Rd] R-2.3.1.tar.gz does not contain VR bundle (PR#9084)
Message-ID: <20060718114608.6AB0C54ACD@slim.kubism.ku.dk>

Dear professor Ripley,

I downloaded the file from the CRAN mirrow at Austria, and it seemed very 
strange that nobody had noticed the same problem. But the same phenomenan 
appeared several times, so I was rather convinced that the file was missing.

I now double-checked this on another system, and the bundle is indeed in 
the source distribution, but for some reason it is not untarred 
successfully in Solaris 5.9. This is funny, because I've not noticed 
anything similar with R source distribution previously.

I'm sorry for any inconvenience, and conclude that the problem that was 
actually non-existenting is now solved.

Thank you for your help!

Jarno



On Tue, 18 Jul 2006, Prof Brian Ripley wrote:

> Where did you get this file from?
>
> The version on the CRAM master does contain the bundle (and did it not
> seem strange to you that no one had reported this in the 6 weeks that the
> version had been out if there was a problem?).
>
> gannet% wget http://cran.r-project.org/src/base/R-2/R-2.3.1.tar.gz
> --11:32:58--  http://cran.r-project.org/src/base/R-2/R-2.3.1.tar.gz
>           => `R-2.3.1.tar.gz'
> Resolving cran.r-project.org... 137.208.57.37
> Connecting to cran.r-project.org|137.208.57.37|:80... connected.
> HTTP request sent, awaiting response... 200 OK
> Length: 14,285,120 (14M) [application/x-tar]
>
> 100%[====================================>] 14,285,120   700.23K/s    ETA
> 00:00
>
> 11:33:14 (911.27 KB/s) - `R-2.3.1.tar.gz' saved [14285120/14285120]
>
> gannet% tar ztvf R-2.3.1.tar.gz | grep VR
> lrwxrwxrwx pd/bs             0 2006-06-01 09:25:04
> R-2.3.1/src/library/Recommended/VR.tgz -> VR_7.2-27.1.tar.gz
> -rwxr-sr-x pd/bs        478191 2006-05-18 10:14:01
> R-2.3.1/src/library/Recommended/VR_7.2-27.1.tar.gz
> gannet% md5sum R-2.3.1.tar.gz
> a1d6d8081af4c71006a6e5a3ed54e4da  R-2.3.1.tar.gz
>
>
> It is also possible that there is a bug in your tar, or a problem with
> your disc system when unpacking.
>
>
> On Tue, 18 Jul 2006, jarno.tuimala at csc.fi wrote:
>
>> Full_Name: Jarno Tuimala
>> Version: 2.3.1
>> OS: Solaris / Linux
>> Submission from: (NULL) (193.166.2.98)
>>
>>
>> Today I downloaded the latest source code release R-2.3.1.tar.gz, and it seems
>> not to contain the VR bundle. After running ./configure I get the following
>> error message:
>>
>> checking for recommended packages... ./src/library/Recommended/VR_*.tar.gz: No
>> such file or directory
>> no
>> configure: error: Some of the recommended packages are missing
>>   Use --without-recommended-packages if this was intentional
>> 39.99u 115.47s 3:02.64 85.1%
>>
>> There is a soft link to the newest version of bundle under
>> /src/library/Recommended, but the actual bundle is missing:
>>
>> drwx------   2 biosci   csc         1024 Jun  1 11:25 ./
>> drwx------  16 biosci   csc         1024 Jun  1 11:25 ../
>> -rw-------   1 biosci   csc           20 Apr 10 01:19 .cvsignore
>> lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 boot.tgz ->
>> boot_1.2-24.tar.gz
>> -rw-------   1 biosci   csc       187471 Apr 10 01:29 boot_1.2-24.tar.gz
>> lrwxrwxrwx   1 biosci   csc           21 Jul 18 12:42 cluster.tgz ->
>> cluster_1.11.0.tar.gz
>> -rw-------   1 biosci   csc       210215 May 19 12:30 cluster_1.11.0.tar.gz
>> lrwxrwxrwx   1 biosci   csc           21 Jul 18 12:42 foreign.tgz ->
>> foreign_0.8-15.tar.gz
>> -rw-------   1 biosci   csc       300878 Apr 10 01:29 foreign_0.8-15.tar.gz
>> lrwxrwxrwx   1 biosci   csc           25 Jul 18 12:42 KernSmooth.tgz ->
>> KernSmooth_2.22-17.tar.gz
>> -rw-------   1 biosci   csc        26876 Apr 10 01:29 KernSmooth_2.22-17.tar.gz
>> lrwxrwxrwx   1 biosci   csc           21 Jul 18 12:42 lattice.tgz ->
>> lattice_0.13-8.tar.gz
>> -rw-------   1 biosci   csc       226490 Apr 19 05:05 lattice_0.13-8.tar.gz
>> -rw-------   1 biosci   csc         2394 Apr 10 01:19 Makefile.in
>> lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 mgcv.tgz ->
>> mgcv_1.3-17.tar.gz
>> -rw-------   1 biosci   csc       263254 May 19 12:30 mgcv_1.3-17.tar.gz
>> lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 nlme.tgz ->
>> nlme_3.1-73.tar.gz
>> -rw-------   1 biosci   csc       709014 May 23 05:05 nlme_3.1-73.tar.gz
>> lrwxrwxrwx   1 biosci   csc           19 Jul 18 12:42 rpart.tgz ->
>> rpart_3.1-29.tar.gz
>> -rw-------   1 biosci   csc       119319 Apr 19 05:05 rpart_3.1-29.tar.gz
>> lrwxrwxrwx   1 biosci   csc           20 Jul 18 12:42 survival.tgz ->
>> survival_2.26.tar.gz
>> -rw-------   1 biosci   csc       862822 May 21 05:05 survival_2.26.tar.gz
>> lrwxrwxrwx   1 biosci   csc           18 Jul 18 12:42 VR.tgz ->
>> VR_7.2-27.1.tar.gz
>>
>> Of course, this is easy to fix just by downloading and copying the VR bundle to
>> the correct place. But, maybe it could also be included in the latest source
>> code release?
>>
>> Best Regards,
>> Jarno Tuimala
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From noah78 at web.de  Tue Jul 18 14:20:18 2006
From: noah78 at web.de (=?UTF-8?Q?J=C3=B6rn_Schulz?=)
Date: Tue, 18 Jul 2006 05:20:18 -0700 (PDT)
Subject: [Rd] send a list from R to C
Message-ID: <5377049.post@talk.nabble.com>


Hello at all !

What is the correct form to give a list form R (e.g. list(c(-1,1),
"TestFile") ) to C. I have no problems, if I don't use character and I have
also no problems to give a character vector form R to C. But,  if I combine
real and strings in a list then I don't know the correct syntax.

I try it with following (an example):

SEXP writeFile(SEXP headerR){
Image *SaveImage;

PROTECT(headerR = AS_VECTOR(headerR));
SaveImage->Xmin = (float) REAL(VECTOR_ELT(headerR, 0))[0];
SaveImage->Ymin = (float) REAL(VECTOR_ELT(headerR, 0))[1];
strcpy(SaveImage->Description, CHAR(STRING_ELT(headerR, 1)));
}

where

typedef struct {
  float Xmin;
  float Ymin;
  char Description[80];
  } Image;

But with this form the characters are doesn't correct (in this case
Description). Perhaps a problem is that I protect the list with AS_VECTOR.
Or is it not possible to comitted a list from R to C that contain numeric
values and characters ?
-- 
View this message in context: http://www.nabble.com/send-a-list-from-R-to-C-tf1960161.html#a5377049
Sent from the R devel forum at Nabble.com.


From ripley at stats.ox.ac.uk  Tue Jul 18 14:37:05 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 18 Jul 2006 13:37:05 +0100 (BST)
Subject: [Rd] send a list from R to C
In-Reply-To: <5377049.post@talk.nabble.com>
References: <5377049.post@talk.nabble.com>
Message-ID: <Pine.LNX.4.64.0607181330280.17158@gannet.stats.ox.ac.uk>

On Tue, 18 Jul 2006, J?rn Schulz wrote:

> 
> Hello at all !
> 
> What is the correct form to give a list form R (e.g. list(c(-1,1),
> "TestFile") ) to C. I have no problems, if I don't use character and I have
> also no problems to give a character vector form R to C. But,  if I combine
> real and strings in a list then I don't know the correct syntax.
> 
> I try it with following (an example):
> 
> SEXP writeFile(SEXP headerR){
> Image *SaveImage;
> 
> PROTECT(headerR = AS_VECTOR(headerR));
> SaveImage->Xmin = (float) REAL(VECTOR_ELT(headerR, 0))[0];
> SaveImage->Ymin = (float) REAL(VECTOR_ELT(headerR, 0))[1];
> strcpy(SaveImage->Description, CHAR(STRING_ELT(headerR, 1)));
> }
> 
> where
> 
> typedef struct {
>   float Xmin;
>   float Ymin;
>   char Description[80];
>   } Image;
> 
> But with this form the characters are doesn't correct (in this case
> Description). Perhaps a problem is that I protect the list with AS_VECTOR.
> Or is it not possible to comitted a list from R to C that contain numeric
> values and characters ?

You intended the second element of the list, so you need

CHAR(STRING_ELT(VECTOR_ELT(headerR, 1), 0)))

that is X[[2]][1], not X[1] (assuming X to be a character vector).

[This is all in `Writing R Extensions', with examples.  The R-devel 
version of R would have given you an informative warning about the misuse 
of SET_VECTOR_ELT.]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From kevin.hendricks at sympatico.ca  Tue Jul 18 14:59:09 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Tue, 18 Jul 2006 08:59:09 -0400
Subject: [Rd] Final patch for bug 8141 - rewriting substituteList
Message-ID: <87988B59-3A15-4F32-A147-B727D2169744@sympatico.ca>

Hi,

Is there anybody interested in this patch to fix bug 8141 - the  
rewriting substituteList in coerce.c?
If so, I have updated it to today's tree.  Testers welcome as well.

If not, please let me know.

Thanks,

Kevin


> Attached is both the patch and a gzipped version of the patch that  
> is the fix for bug 8141 - rewriting substituteList in coerce.c to  
> use a loop instead of recursion to walk the list.
>
> The new version passes all of my tests (make check-all, etc) and I  
> have used it with no negative impact to my work (as verified by  
> comparing before and after tests) so far.
>
> The new version fixes the C-stack overflow problem documented in  
> the 8141 bug report.
>
> [kbhend at base3 ~]$ cat test.r
> dfn <- rep(list(rep(0,2)),300000)
> test <- as.data.frame.list(dfn)
>
> which no longer fails on the development tree with this patch in  
> place.
>
> I realize it is hard to verify this patch as correct since it  
> converts recursion back into a loop.  There has been no official  
> code review as far as I can tell by anyone so far.
>
> So perhaps it could be introduced into 2.4.0 with an environment  
> variable switch to allow users to switch back to the old version to  
> add more evidence as to its correctness.
>
> As I said, I have used the patch without problems in my day to day  
> work.


-------------- next part --------------



From noah78 at web.de  Tue Jul 18 15:16:56 2006
From: noah78 at web.de (=?UTF-8?Q?J=C3=B6rn_Schulz?=)
Date: Tue, 18 Jul 2006 06:16:56 -0700 (PDT)
Subject: [Rd] send a list from R to C
In-Reply-To: <Pine.LNX.4.64.0607181330280.17158@gannet.stats.ox.ac.uk>
References: <5377049.post@talk.nabble.com>
	<Pine.LNX.4.64.0607181330280.17158@gannet.stats.ox.ac.uk>
Message-ID: <5377955.post@talk.nabble.com>


O.k., thanks. I think, I tried your suggesion before I post here, but I made
a mistake in my first approach. Now, it opperate. 

Again, thank you for the reply.
-- 
View this message in context: http://www.nabble.com/send-a-list-from-R-to-C-tf1960161.html#a5377955
Sent from the R devel forum at Nabble.com.


From dgrove at fhcrc.org  Tue Jul 18 16:44:16 2006
From: dgrove at fhcrc.org (dgrove at fhcrc.org)
Date: Tue, 18 Jul 2006 16:44:16 +0200 (CEST)
Subject: [Rd] documentation for argument to screen (PR#9085)
Message-ID: <20060718144416.335552665C@slim.kubism.ku.dk>

Full_Name: Doug Grove
Version: 2.3.1 patched  (2006-07-03 r38485)
OS: Windows
Submission from: (NULL) (24.19.37.159)


A msg. to R-help prompted me to read the help page for split.screen/screen,
etc.
I understand what the function is for, but could not find information that
described how the argument 'n' in screen/erase.screen/close.screen is mapped to
the regions on the device.  All we are told is e.g. screen(1) prepares the first
region for plotting - but which region is region 1??  Obviously this can be
figured out by playing around with the function, but a description of how the
regions are numbered would make a nice addition.

Thanks!
Doug


From ripley at stats.ox.ac.uk  Tue Jul 18 17:35:58 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 18 Jul 2006 16:35:58 +0100 (BST)
Subject: [Rd] documentation for argument to screen (PR#9085)
In-Reply-To: <20060718144416.335552665C@slim.kubism.ku.dk>
References: <20060718144416.335552665C@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0607181635090.23466@gannet.stats.ox.ac.uk>

Patch, please ....

On Tue, 18 Jul 2006, dgrove at fhcrc.org wrote:

> Full_Name: Doug Grove
> Version: 2.3.1 patched  (2006-07-03 r38485)
> OS: Windows
> Submission from: (NULL) (24.19.37.159)
> 
> 
> A msg. to R-help prompted me to read the help page for split.screen/screen,
> etc.
> I understand what the function is for, but could not find information that
> described how the argument 'n' in screen/erase.screen/close.screen is mapped to
> the regions on the device.  All we are told is e.g. screen(1) prepares the first
> region for plotting - but which region is region 1??  Obviously this can be
> figured out by playing around with the function, but a description of how the
> regions are numbered would make a nice addition.
> 
> Thanks!
> Doug
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From dgrove at fhcrc.org  Tue Jul 18 18:19:16 2006
From: dgrove at fhcrc.org (Douglas Grove)
Date: Tue, 18 Jul 2006 09:19:16 -0700 (PDT)
Subject: [Rd] documentation for argument to screen (PR#9085)
In-Reply-To: <Pine.LNX.4.64.0607181635090.23466@gannet.stats.ox.ac.uk>
References: <20060718144416.335552665C@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0607181635090.23466@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.61.0607180915340.15430@echidna.fhcrc.org>

The reason I noticed this is that I do not know how
the screens are numbered.

And for future reference, is there a source that documents
how to create a patch for documentation or source code?
I have never made a patch but I would like to be able
to do this in the future.

Thanks,
Doug 




On Tue, 18 Jul 2006, Prof Brian Ripley wrote:

> Patch, please ....
> 
> On Tue, 18 Jul 2006, dgrove at fhcrc.org wrote:
> 
> > Full_Name: Doug Grove
> > Version: 2.3.1 patched  (2006-07-03 r38485)
> > OS: Windows
> > Submission from: (NULL) (24.19.37.159)
> > 
> > 
> > A msg. to R-help prompted me to read the help page for split.screen/screen,
> > etc.
> > I understand what the function is for, but could not find information that
> > described how the argument 'n' in screen/erase.screen/close.screen is mapped to
> > the regions on the device.  All we are told is e.g. screen(1) prepares the first
> > region for plotting - but which region is region 1??  Obviously this can be
> > figured out by playing around with the function, but a description of how the
> > regions are numbered would make a nice addition.
> > 
> > Thanks!
> > Doug
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
> > 
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From ripley at stats.ox.ac.uk  Tue Jul 18 18:46:00 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 18 Jul 2006 17:46:00 +0100 (BST)
Subject: [Rd] documentation for argument to screen (PR#9085)
In-Reply-To: <Pine.LNX.4.61.0607180915340.15430@echidna.fhcrc.org>
References: <20060718144416.335552665C@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0607181635090.23466@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.61.0607180915340.15430@echidna.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0607181738200.25234@gannet.stats.ox.ac.uk>

On Tue, 18 Jul 2006, Douglas Grove wrote:

> The reason I noticed this is that I do not know how
> the screens are numbered.

Well, the S documentation also does not say, so it is regarded as obvious. 
AFAIK sequentially from the last used number, either in the order of the 
rows of 'figs' or row-major order on the grid.

> And for future reference, is there a source that documents
> how to create a patch for documentation or source code?
> I have never made a patch but I would like to be able
> to do this in the future.

'man patch' tells you all you need to know (and more).  You need to have 
the latest version of the file via svn (see the FAQ): careful saving of 
the display such as 
https://svn.r-project.org/R/trunk/src/library/graphics/man/screen.Rd will 
do equally well.

> 
> Thanks,
> Doug 
> 
> 
> 
> 
> On Tue, 18 Jul 2006, Prof Brian Ripley wrote:
> 
> > Patch, please ....
> > 
> > On Tue, 18 Jul 2006, dgrove at fhcrc.org wrote:
> > 
> > > Full_Name: Doug Grove
> > > Version: 2.3.1 patched  (2006-07-03 r38485)
> > > OS: Windows
> > > Submission from: (NULL) (24.19.37.159)
> > > 
> > > 
> > > A msg. to R-help prompted me to read the help page for split.screen/screen,
> > > etc.
> > > I understand what the function is for, but could not find information that
> > > described how the argument 'n' in screen/erase.screen/close.screen is mapped to
> > > the regions on the device.  All we are told is e.g. screen(1) prepares the first
> > > region for plotting - but which region is region 1??  Obviously this can be
> > > figured out by playing around with the function, but a description of how the
> > > regions are numbered would make a nice addition.
> > > 
> > > Thanks!
> > > Doug
> > > 
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > > 
> > > 
> > 
> > -- 
> > Brian D. Ripley,                  ripley at stats.ox.ac.uk
> > Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> > University of Oxford,             Tel:  +44 1865 272861 (self)
> > 1 South Parks Road,                     +44 1865 272866 (PA)
> > Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> > 
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Tue Jul 18 19:41:23 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 18 Jul 2006 10:41:23 -0700
Subject: [Rd] documentation for argument to screen (PR#9085)
In-Reply-To: <Pine.LNX.4.64.0607181738200.25234@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Tue, 18 Jul 2006 17:46:00 +0100 (BST)")
References: <20060718144416.335552665C@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0607181635090.23466@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.61.0607180915340.15430@echidna.fhcrc.org>
	<Pine.LNX.4.64.0607181738200.25234@gannet.stats.ox.ac.uk>
Message-ID: <m2ac76x130.fsf@ziti.local>

> On Tue, 18 Jul 2006, Douglas Grove wrote:
>> And for future reference, is there a source that documents
>> how to create a patch for documentation or source code?
>> I have never made a patch but I would like to be able
>> to do this in the future.

One way to do this is:

1. Obtain the Subversion client, svn, and create a checkout of the R
   sources.

2. Edit files in your working copy.

3. Create a patch from the top-level dir like this:

      svn diff > myfixes.diff

+ seth


From vincent.goulet at act.ulaval.ca  Tue Jul 18 19:56:06 2006
From: vincent.goulet at act.ulaval.ca (Vincent Goulet)
Date: Tue, 18 Jul 2006 13:56:06 -0400
Subject: [Rd] Patch to allow negative argument in head() and tail()
In-Reply-To: <17596.40686.710925.321109@stat.math.ethz.ch>
References: <200607171503.34713.vincent.goulet@act.ulaval.ca>
	<17596.40686.710925.321109@stat.math.ethz.ch>
Message-ID: <200607181356.06360.vincent.goulet@act.ulaval.ca>

Le Mardi 18 Juillet 2006 04:42, Martin Maechler a ?crit?:
> >>>>> "Vincent" == Vincent Goulet <vincent.goulet at act.ulaval.ca>
> >>>>>     on Mon, 17 Jul 2006 15:03:34 -0400 writes:
>
>     Vincent> Dear developeRs (and other abuseRs ;-),
>
>     Vincent> I would like to contribute a patch against
>     Vincent> functions head() and tail() of package utils to
>     Vincent> allow for a negative 'n' argument. This allows to
>     Vincent> extract all but the first/last 'n'
>     Vincent> elements/rows/lines of an object, similar to the
>     Vincent> "drop" operator of APL. [1]
>
> Hmm, if you reread  Bill Venables proposal (URL below), you did
> something different : In Bill's (and my!) "book",
>
>   head would always give the *first* few entries and
>   tail would always give the *last*  few entries.
>
> That's different from APL's drop, but for a good reason:
> The words 'head' and 'tail' exactly suggest so.

Indeed, I did not pay that much attention to the second paragraph.

For me, this usage of head() and tail() is, at first, completely unintuitive 
since I more used to, say, "start from the beginning (head) of the vector and 
drop the first n elements" than "return the end of the vector except the 
first n elements". But I must agree your convention does make sense!

>     Vincent> I put the patched head.R and head.Rd files, along with diff
> files in Vincent> http://vgoulet.act.ulaval.ca/pub/R/
>
>     Vincent> The differences were obtained against today's version of
> r-devel (more Vincent> specifically revision 30277 of head.R and revision
> 30915 of head.Rd).
>
> That's good (to take the "current" sources for the diffs).
>
>     Vincent> Some comments:
>
>     Vincent> - The current version of head() and tail() will
>     Vincent> accept a vector of length > 1 for argument 'n' but
>     Vincent> will silently use the smallest value. This became
>     Vincent> awkward to reproduce in my versions and did not
>     Vincent> seem interesting anyway.  Instead, I added an error
>     Vincent> message if length(n) > 1.
>
> that's ok in my view
>
>     Vincent> - I used the word "scalar" in the aforementioned
>     Vincent> error message to mean a vector of length 1. Perhaps
>     Vincent> is this not the correct R terminology?
>
> indeed, it's rarely used in R terminology; for one reason
> because S (and hence R) does not differentiate between length-1
> vectors and scalars the way APL does.

So I should rephrase the message as "n should be a vector of length 1", then.

>     Vincent> - I added a 'addrownums = TRUE' argument to head() used when n
> < 0, similar to Vincent> tail() with n > 0. This required to write separate
> methods for Vincent> classes 'data.frame' and 'matrix'.
>
> seems not unreasonable {I did not yet look at your implementation there}

Actually, this will no longer be needed since head() will always return, well, 
the head of an object, hence no need to relabel the lines of a matrix.


>     Vincent> - The 'function' methods are not modified.
>
>     Vincent> - In the man page, the 'function' method was not documented in
> the usage Vincent> section. Done now.
>
> ok, though not necessary: The recommended approach is to only
>    document methods when they have ``surprising arguments'', i.e.,
>    arguments not in the generic function.
>
> In our case, 'n = 6' is not part of the generic, so strictly
> speaking *is* a "surprising argument".
> Probably it was not made part of the generic, since it's
> imaginable to have objects whose "head" is always of a fixed
> given size, and where specifying 'n' does not make sense.
>
>     Vincent> - I don't think the patch would break any existing code,
> except code using the Vincent> (undocumented) "feature" mentioned in my
> first remark, above.
>
>     Vincent> I hope you will find my (albeit small) contribution useful.
>
> Yes, but can you change it such that head() does give the "head"
> and tail() the "tail" also for negative 'n' ?

I'll give it a go in the next couple of days.

Bye!    Vincent

>     Vincent> Best regards,
>
> Bonnes salutations,
> Martin
>
>     Vincent> -----
>     Vincent> [1] See previous messages to r-devel by myself
>     Vincent>
> <https://stat.ethz.ch/pipermail/r-devel/2005-April/032881.html>
>
>     Vincent> and Bill Venables
>     Vincent> <https://stat.ethz.ch/pipermail/r-devel/2005-May/033081.html>

-- 
  Vincent Goulet, Associate Professor
  ?cole d'actuariat
  Universit? Laval, Qu?bec 
  Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca


From pinard at iro.umontreal.ca  Tue Jul 18 23:41:53 2006
From: pinard at iro.umontreal.ca (=?iso-8859-1?Q?Fran=E7ois?= Pinard)
Date: Tue, 18 Jul 2006 17:41:53 -0400
Subject: [Rd] Patch to allow negative argument in head() and tail()
In-Reply-To: <200607181356.06360.vincent.goulet@act.ulaval.ca>
References: <200607171503.34713.vincent.goulet@act.ulaval.ca>
	<17596.40686.710925.321109@stat.math.ethz.ch>
	<200607181356.06360.vincent.goulet@act.ulaval.ca>
Message-ID: <20060718214153.GA5151@alcyon.progiciels-bpi.ca>

[Vincent Goulet]

>For me, this usage of head() and tail() is, at first, completely 
>unintuitive since I more used to, say, "start from the beginning (head) 
>of the vector and drop the first n elements" than "return the end of 
>the vector except the first n elements". But I must agree your 
>convention does make sense!

Vincent -- bonjour!, Martin -- hi! and all others -- hello! :-)

The usual head and tail Unix utilities, as found within GNU Coreutils,
have conventions for negative numbers.  See:

  $ seq 10 | head -n-3
  1
  2
  3
  4
  5
  6
  7
  $ seq 10 | tail -n-3
  8
  9
  10
  $

Of course, these do not rule what R should do in any way.  Yet, it is 
sometimes convenient and even elegant when tools having similar names 
have similar behaviour.  Despite application domains are different, it's 
worth pondering such similarities, when these are easily possible.

-- 
Fran?ois Pinard   http://pinard.progiciels-bpi.ca


From bolker at zoo.ufl.edu  Wed Jul 19 00:32:19 2006
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Tue, 18 Jul 2006 18:32:19 -0400
Subject: [Rd] possibly stupid question about RPM building
Message-ID: <44BD6173.40101@zoo.ufl.edu>


  I'm trying to build an RPM of R 2.3.1 on a very old RedHat system
(specifically, a ROCKS 3.3.0 cluster which is built on RH enterprise
3 (I think??))

  I downloaded R-2.3.1.tgz from CRAN; downloaded the R.spec file
cran.r-project.org/http://cran.r-project.org/bin/linux/redhat/SRPMS/ ;
and ran rpmbuild -ba R.specs.

  Everything goes along fine until ...

make[5]: Entering directory
`/usr/src/redhat/BUILD/R-2.3.1/src/library/tools/src'
gcc -I../../../../include -I../../../../include  -I/usr/local/include
-fpic  -O2 -g -march=i386 -mcpu=i686 -c text.c -o text.o
gcc -I../../../../include -I../../../../include  -I/usr/local/include
-fpic  -O2 -g -march=i386 -mcpu=i686 -c init.c -o init.o
gcc -I../../../../include -I../../../../include  -I/usr/local/include
-fpic  -O2 -g -march=i386 -mcpu=i686 -c Rmd5.c -o Rmd5.o
gcc -I../../../../include -I../../../../include  -I/usr/local/include
-fpic  -O2 -g -march=i386 -mcpu=i686 -c md5.c -o md5.o
gcc -shared -L/usr/local/lib -o tools.so text.o init.o Rmd5.o md5.o
-L../../../../lib -lR
mkdir -p -- ../../../../library/tools/libs
make[5]: Leaving directory
`/usr/src/redhat/BUILD/R-2.3.1/src/library/tools/src'
make[4]: Leaving directory
`/usr/src/redhat/BUILD/R-2.3.1/src/library/tools/src'
Warning message:
package seems to be using lazy loading already in: makeLazyLoading("tools")
Error in lazyLoadDBfetch(key, datafile, compressed, envhook) :
        internal error in R_decompress1
Execution halted


Thereafter, going to /usr/src/redhat/BUILD/R-2.3.1/src/library/tools and
executing "make" gives essentially the same result.

  digging deeper finds the error message within
library/tools/R/makeLazyLoad.R:

  if (file.info(codeFile)["size"] == file.info(loaderFile)["size"])
        warning("package seems to be using lazy loading already")

hacking this file to produce more output identifies codeFile
as /usr/lib/R/library/tools/R/tools and loaderFile as below:


[root at bolker-cluster tools]# ls -l
/usr/src/redhat/BUILD/R-2.3.1/share/R/nspackloader.R
-rw-r--r--    1 root     root          384 Jul 18 18:29
/usr/src/redhat/BUILD/R-2.3.1/share/R/nspackloader.R
[root at bolker-cluster tools]# ls -l /usr/lib/R/library/tools/R/tools
-rw-r--r--    1 root     root          384 Jul 18 17:33
/usr/lib/R/library/tools/R/tools

  ?? I am at the edge of my comprehension here ...

  Searching for "R_decompress1", "internal error", etc., on
Google/RSiteSearch gave nothing

Searching on "package seems to be using lazy loading already" finds
a few old hits, but no solutions.

  I have 252M free space (the first time this happened I had only
50M ...)


  Could this possibly be related to having another (old) instance
of R running at the same time?  Seems unlikely but ...  	


  does anyone have any hints?

  sincerely
    Ben Bolker

-- 
620B Bartram Hall                            bolker at zoo.ufl.edu
Zoology Department, University of Florida    http://www.zoo.ufl.edu/bolker
Box 118525                                   (ph)  352-392-5697
Gainesville, FL 32611-8525                   (fax) 352-392-3704


From smckinney at bccrc.ca  Wed Jul 19 02:15:33 2006
From: smckinney at bccrc.ca (Steven McKinney)
Date: Tue, 18 Jul 2006 17:15:33 -0700
Subject: [Rd] [BioC] Errors using biocLite on Apple OS X
References: <0BE438149FF2254DB4199E2682C8DFEB01D55493@crcmail1.BCCRC.CA>
	<44BD3BC8.9050500@fhcrc.org>
Message-ID: <0BE438149FF2254DB4199E2682C8DFEB01D55497@crcmail1.BCCRC.CA>

The warnings from 

 make.packages.html()

on the Apple Mac OS X platform can be dealt
with as follows:

------------------------------------------------
(1)

make.packages.html() uses the function tempdir()
and attempts to create a temporary
directory in the default location /tmp/
which fails due to the /tmp directory
architecture on the Mac.  

I set up a .Renviron file in my user account directory,

 /Users/stevenmckinney/.Renviron

containing the *nix environment variable

TMPDIR="/Users/stevenmckinney/tmp"

Now the tempdir() function returns a directory
in a location that my user account has write access to:

> tempdir()
[1] "/Users/stevenmckinney/tmp/Rtmp1zKvhp"

--------------------------------------------
(2)

The function make.packages.html() attempts to
create a couple of files, but fails on Mac OS X.
Apparently a directory must already exist for file.create()
to successfully establish a new file in it.

> make.packages.html
function (lib.loc = .libPaths()) 
{
    f.tg <- file.path(tempdir(), ".R/doc/html/packages.html")
    if (!file.create(f.tg)) {
        warning("cannot create HTML package index")
        return(FALSE)
    }
    searchindex <- file.path(tempdir(), ".R/doc/html/search/index.txt")
    if (!file.create(searchindex)) {
        warning("cannot create HTML search index")
        return(FALSE)
    }
    useUTF8 <- capabilities("iconv")


I modified the two file.create() bits to also include
a directory create.  On Mac OS X, you have to specify
the recursive arg to the dir.create() function, or it
will fail to create a subdirectory several levels deep.
First check if the subdirectory exists; if not, create it;
then create the file within it.


make.packages.html <- 
  function (lib.loc = .libPaths()) 
{
    f.tg <- file.path(tempdir(), ".R/doc/html/packages.html")
    if (!((file.exists(dirname(f.tg)) ||
           dir.create(dirname(f.tg), recursive = TRUE)) &&
          file.create(f.tg))) {
      warning("cannot create HTML package index")
      return(FALSE)
    }
    searchindex <- file.path(tempdir(), ".R/doc/html/search/index.txt")
    if (!((file.exists(dirname(searchindex)) ||
           dir.create(dirname(searchindex), recursive = TRUE)) &&
          file.create(searchindex))) {
      warning("cannot create HTML search index")
      return(FALSE)
    }
    useUTF8 <- capabilities("iconv")


When I run this redefined version, it runs to completion
without warning.

However, when biocLite() runs, it does not access my
redefined make.packages.html() in .Globalenv - the
bioclite() call appears to always call the package:utils
copy of this function.

Perhaps such modifications could be done by package:utils
developers?

Thanks to Herve Pages for his excellent
summarization of the issues arising when
running biocLite on the Mac.



Steven McKinney

Statistician
Molecular Oncology and Breast Cancer Program
British Columbia Cancer Research Centre

email: smckinney at bccrc.ca

tel: 604-675-8000 x7561

BCCRC
Molecular Oncology
675 West 10th Ave, Floor 4
Vancouver B.C. 
V5Z 1L3
Canada




-----Original Message-----
From: Herve Pages [mailto:hpages at fhcrc.org]
Sent: Tue 7/18/2006 12:51 PM
To: Steven McKinney
Cc: Bioconductor at stat.math.ethz.ch
Subject: Re: [BioC] Errors using biocLite on Apple OS X
 
Hi Steven,

I can see warnings only in what you reported. These warnings
are well-known issues but are not biocLite problems: they are
Mac OS X install.packages() specific issues.

The first warning:
  1: number of rows of result
       is not a multiple of vector length (arg 2) in: cbind(1, res0, 
Repository = repos)
is issued by install.packages() when it is given a repos vector with 
length >= 4.
You can easily reproduce it with:
  > repos <- c("http://bioconductor.org/packages/1.8/bioc",
     "http://bioconductor.org/packages/1.8/data/annotation",
     "http://bioconductor.org/packages/1.8/data/experiment",
     "http://bioconductor.org/packages/1.8/omegahat",
     "http://bioconductor.org/packages/1.8/lindsey",
     "http://cran.fhcrc.org")
  > install.packages("Biobase", repos=repos)

The second warning is a permission issue specific to Mac OS X.

Anyway, these warnings should not prevent biocLite to install the requested
packages correctly.

Cheers,

H.


Steven McKinney wrote:
> I've recently started using R and Bioconductor
> on an Apple Mac running OS X (10.4). I've been
> installing packages from the *nix command line,
> one by one, no trouble.
>
> I would like to be able to update using
> biocLite from the R gui, but keep getting
> errors.
>
>
>> version
> _
> platform powerpc-apple-darwin8.6.0
> arch powerpc
> os darwin8.6.0
> system powerpc, darwin8.6.0
> status
> major 2
> minor 3.1
> year 2006
> month 06
> day 01
> svn rev 38247
> language R
> version.string Version 2.3.1 (2006-06-01)
>
>
>> source("http://bioconductor.org/biocLite.R")
>> biocLite("Biobase", destdir = 
>> "/Volumes/KilroyHD/kilroy/Software/BioConductor")
> Running getBioC version 0.1.6 with R version 2.3.1
> Running biocinstall version 1.8.4 with R version 2.3.1
> Your version of R requires version 1.8 of Bioconductor.
> trying URL 
> 'http://bioconductor.org/packages/1.8/bioc/bin/macosx/powerpc/contrib/2.3/Biobase_1.10.1.tgz'
> Content type 'application/x-gzip' length 1465858 bytes
> opened URL
> ==================================================
> downloaded 1431Kb
>
> Warning messages:
> 1: number of rows of result
> is not a multiple of vector length (arg 2) in: cbind(1, res0, 
> Repository = repos)
> 2: cannot create HTML package index in: make.packages.html()
>
>
> I am using version 1.10.1 of Biobase, I presume this is the
> version number for Bioconductor.
>
> I see a few others reporting similar errors
> when I google this issue, but I see no posted
> solutions. Can anyone see what I am doing wrong,
> and is there a solution?
>
> Any info appreciated
>
>
> Best regards
>
> Steven McKinney
>
> Statistician
> Molecular Oncology and Breast Cancer Program
> British Columbia Cancer Research Centre
>
> email: smckinney at bccrc.ca
>
>
>
> BCCRC
> Molecular Oncology
> 675 West 10th Ave, Floor 4
> Vancouver B.C.
> V5Z 1L3
> Canada
>
> _______________________________________________
> Bioconductor mailing list
> Bioconductor at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/bioconductor
> Search the archives: 
> http://news.gmane.org/gmane.science.biology.informatics.conductor



-- 
------------------------
Herv? Pag?s
E-mail: hpages at fhcrc.org
Phone: (206) 667-5791
Fax: (206) 667-1319


From kapelner at stanford.edu  Wed Jul 19 04:56:37 2006
From: kapelner at stanford.edu (way4thesub)
Date: Tue, 18 Jul 2006 19:56:37 -0700 (PDT)
Subject: [Rd] ASCII dump from an REXP (JRI)
Message-ID: <5390018.post@talk.nabble.com>


Hi Simon,

Thanks so much for your help. Your advice has been taken to heart. I now
pass in blocks of 100,000 records, and it does 100,000 predictions in
seconds and returns a logical vector with the predictions to an int array.
It works like a charm!

I want to reference what we were talking about earlier. Let?s say we
evaluate an R expression. Is there a way to just print, verbatim, what R
evaluates to the screen (ie just a pure ASCII dump with no regard to the
data type)?

(I?m using Windows XP SP2, 2 x 1.8Ghz Xeon, 1GB RAM, Eclipse 3.1.1, JRI 0.2,
R 2.2.1, jdk1.5.0_07, jre1.5.0_06)

You mentioned earlier doing something as follows:

	rexp=reng.eval("nucleitrain");
	System.out.println("nucleitrain="+rexp);
	long[] l=reng.rniGetVector(rexp.xp);
	for (int i=0;i<l.length;i++)
		System.out.println(new REXP(reng, l[i]));

Now, Java outputs to the screen this: 

	nucleitrain=RXP[unknown/19, id=1218430184, o=null]
	RXP[unknown/19, id=1218430408, o=null]
	RXP[int[], id=1219416784, o=[I at 1b000e7]
	RXP[unknown/6, id=1204356856, o=null]
	RXP[unknown/6, id=1204325140, o=null]
	RXP[int[], id=1203946856, o=[I at b76fa]
	RXP[double[], id=1210952032, o=[D at b01d43]

Which means I have to anticipate each expression type and properly handle
it. If one does not know, a priori, what these expressions are, how can one
do it?

Ideally, I?m looking for something like the following:

	REXP rexp=reng.eval(? . . . . ?);
	rexp.DisplayToScreenAsRGuiDisplays();

I know this function exists because you wrote a Java interface to R. If it
does, it would be an awesome thing to put on an examples page.

Thanks,
Adam




-- 
View this message in context: http://www.nabble.com/ASCII-dump-from-an-REXP-%28JRI%29-tf1964220.html#a5390018
Sent from the R devel forum at Nabble.com.


From ripley at stats.ox.ac.uk  Wed Jul 19 08:32:09 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Jul 2006 07:32:09 +0100 (BST)
Subject: [Rd] possibly stupid question about RPM building
In-Reply-To: <44BD6173.40101@zoo.ufl.edu>
References: <44BD6173.40101@zoo.ufl.edu>
Message-ID: <Pine.LNX.4.64.0607190717530.32733@gannet.stats.ox.ac.uk>

On Tue, 18 Jul 2006, Ben Bolker wrote:

> 
>   I'm trying to build an RPM of R 2.3.1 on a very old RedHat system
> (specifically, a ROCKS 3.3.0 cluster which is built on RH enterprise
> 3 (I think??))

`Very old' to me suggested 7.x or so ....

>   I downloaded R-2.3.1.tgz from CRAN; downloaded the R.spec file
> cran.r-project.org/http://cran.r-project.org/bin/linux/redhat/SRPMS/ ;
> and ran rpmbuild -ba R.specs.

I think the official procedures are to either

1) build the tarball according to the usual instructions
2) download the SRPM and use rpmbuild --rebuild on that

Can you check 1) works and if so try 2)? 

The error message suggests that either the wrong R is being picked up or 
that makeLazyLoading has indeed been run on the tools package. I don't 
know that it matters, but I would check that R_HOME was not set in the 
build environment.


>   Everything goes along fine until ...
> 
> make[5]: Entering directory
> `/usr/src/redhat/BUILD/R-2.3.1/src/library/tools/src'
> gcc -I../../../../include -I../../../../include  -I/usr/local/include
> -fpic  -O2 -g -march=i386 -mcpu=i686 -c text.c -o text.o
> gcc -I../../../../include -I../../../../include  -I/usr/local/include
> -fpic  -O2 -g -march=i386 -mcpu=i686 -c init.c -o init.o
> gcc -I../../../../include -I../../../../include  -I/usr/local/include
> -fpic  -O2 -g -march=i386 -mcpu=i686 -c Rmd5.c -o Rmd5.o
> gcc -I../../../../include -I../../../../include  -I/usr/local/include
> -fpic  -O2 -g -march=i386 -mcpu=i686 -c md5.c -o md5.o
> gcc -shared -L/usr/local/lib -o tools.so text.o init.o Rmd5.o md5.o
> -L../../../../lib -lR
> mkdir -p -- ../../../../library/tools/libs
> make[5]: Leaving directory
> `/usr/src/redhat/BUILD/R-2.3.1/src/library/tools/src'
> make[4]: Leaving directory
> `/usr/src/redhat/BUILD/R-2.3.1/src/library/tools/src'
> Warning message:
> package seems to be using lazy loading already in: makeLazyLoading("tools")
> Error in lazyLoadDBfetch(key, datafile, compressed, envhook) :
>         internal error in R_decompress1
> Execution halted
> 
> 
> Thereafter, going to /usr/src/redhat/BUILD/R-2.3.1/src/library/tools and
> executing "make" gives essentially the same result.
> 
>   digging deeper finds the error message within
> library/tools/R/makeLazyLoad.R:
> 
>   if (file.info(codeFile)["size"] == file.info(loaderFile)["size"])
>         warning("package seems to be using lazy loading already")
> 
> hacking this file to produce more output identifies codeFile
> as /usr/lib/R/library/tools/R/tools and loaderFile as below:
> 
> 
> [root at bolker-cluster tools]# ls -l
> /usr/src/redhat/BUILD/R-2.3.1/share/R/nspackloader.R
> -rw-r--r--    1 root     root          384 Jul 18 18:29
> /usr/src/redhat/BUILD/R-2.3.1/share/R/nspackloader.R
> [root at bolker-cluster tools]# ls -l /usr/lib/R/library/tools/R/tools
> -rw-r--r--    1 root     root          384 Jul 18 17:33
> /usr/lib/R/library/tools/R/tools
> 
>   ?? I am at the edge of my comprehension here ...
> 
>   Searching for "R_decompress1", "internal error", etc., on
> Google/RSiteSearch gave nothing
> 
> Searching on "package seems to be using lazy loading already" finds
> a few old hits, but no solutions.
> 
>   I have 252M free space (the first time this happened I had only
> 50M ...)
> 
> 
>   Could this possibly be related to having another (old) instance
> of R running at the same time?  Seems unlikely but ...  	
> 
> 
>   does anyone have any hints?
> 
>   sincerely
>     Ben Bolker
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Wed Jul 19 09:30:15 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 19 Jul 2006 09:30:15 +0200
Subject: [Rd] Patch to allow negative argument in head() and tail()
In-Reply-To: <20060718214153.GA5151@alcyon.progiciels-bpi.ca>
References: <200607171503.34713.vincent.goulet@act.ulaval.ca>
	<17596.40686.710925.321109@stat.math.ethz.ch>
	<200607181356.06360.vincent.goulet@act.ulaval.ca>
	<20060718214153.GA5151@alcyon.progiciels-bpi.ca>
Message-ID: <17597.57223.151500.824538@stat.math.ethz.ch>

>>>>> "FrPi" == Fran?ois Pinard <pinard at iro.umontreal.ca>
>>>>>     on Tue, 18 Jul 2006 17:41:53 -0400 writes:

    FrPi> [Vincent Goulet]
    >> For me, this usage of head() and tail() is, at first,
    >> completely unintuitive since I more used to, say, "start
    >> from the beginning (head) of the vector and drop the
    >> first n elements" than "return the end of the vector
    >> except the first n elements". But I must agree your
    >> convention does make sense!

    FrPi> Vincent -- bonjour!, Martin -- hi! and all others -- hello! :-)
:-)

    FrPi> The usual head and tail Unix utilities, as found
    FrPi> within GNU Coreutils, have conventions for negative
    FrPi> numbers.  See:

      $ seq 10 | head -n-3
      1
      2
      3
      4
      5
      6
      7
      $ seq 10 | tail -n-3
      8
      9
      10
      $

    FrPi> Of course, these do not rule what R should do in any
    FrPi> way.  Yet, it is sometimes convenient and even elegant
    FrPi> when tools having similar names have similar
    FrPi> behaviour.  Despite application domains are different,
    FrPi> it's worth pondering such similarities, when these are
    FrPi> easily possible.

Thank you for the good suggestion.
However Peter Dalgaard has beaten you here -- in a non-public
mail though.

An excerpt of my answer (of yesterday) to his mail:

  Regarding unix command line compatibility:
  Note that there, 'tail'  is *really* not what we want to imitate:

  "3" is the same as "-3" but different from "+3" :
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  $ for N in 3 -3 +3 ; do echo "  $N :"; echo '  ---' ; tail -n $N /tmp/lib12.txt ; done

    3 :
    ---
  10                  "target")))
  11              if (!res)
  12                  stop(gettextf("This is R %s, package '%s' needs %s %s",
    -3 :
    ---
  10                  "target")))
  11              if (!res)
  12                  stop(gettextf("This is R %s, package '%s' needs %s %s",
    +3 :
    ---
  3       verbose = getOption("verbose"), version)
  4   {
  5       testRversion <- function(pkgInfo, pkgname, pkgpath) {
  6           current <- getRversion()
  7           if (length(Rdeps <- pkgInfo$Rdepends) > 1) {
  8               target <- Rdeps$version
  9               res <- eval(parse(text = paste("current", Rdeps$op,
  10                  "target")))
  11              if (!res)
  12                  stop(gettextf("This is R %s, package '%s' needs %s %s",

----------

I know that there is some "good" reason for the behavior of
'tail' in "Unix" 
  { tail -3 === tail -n  3   and
    tail -3 === tail -n -3      }

but of course, we can't be compatible here, because in S
(and most reasonable languages :-) 
"3 == +3"  and  "3 != -3" !

Martin


From gregor.gorjanc at bfro.uni-lj.si  Wed Jul 19 11:24:49 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Wed, 19 Jul 2006 11:24:49 +0200
Subject: [Rd] Bug?: summary() fails after use of na.action="na.exclude" in
	lm()
Message-ID: <44BDFA61.20500@bfro.uni-lj.si>

Hello!

I have encountered a weird problem and I am wondering if this is a bug.
Here is the example:

n <- 50
x <- runif(n=n)
y1 <- 2 * x + rnorm(n=n)
y2 <- 5 * x + rnorm(n=n)
y2[sample(1:n, size=5)] <- NA

y <- cbind(y1, y2)

fit <- lm(y1 ~ 1, na.action="na.exclude")
summary(fit)

## Goes ok here
fit <- lm(y2 ~ 1, na.action="na.exclude")
summary(fit)

## But fails if we use matrix of response variables
fit <- lm(y ~ 1, na.action="na.exclude")
summary(fit)

## Response y1 :
##
## Call:
## lm(formula = y1 ~ 1, na.action = "na.exclude")
##
## Residuals:
## Error in quantile.default(resid) : missing values and NaN's not
allowed if 'na.rm' is FALSE

Am I doing something wrong here?

----------------------------------------------------------------------

Btw. man page of lm says (in the begining of the details):

"A typical model has the form 'response ~ terms' where 'response' is the
(numeric) response vector ..."
                   ^^^^^^

Should not this part say that repsponse can also be a matrix?

Thanks

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From ripley at stats.ox.ac.uk  Wed Jul 19 12:17:13 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Jul 2006 11:17:13 +0100 (BST)
Subject: [Rd] Dropping unused levels of a factor that has "NA" as a level
In-Reply-To: <4DD6F8B8782D584FABF50BF3A32B03D806867D8C@MSGBOSCLF2WIN.DMN1.FMR.COM>
References: <4DD6F8B8782D584FABF50BF3A32B03D806867D8C@MSGBOSCLF2WIN.DMN1.FMR.COM>
Message-ID: <Pine.LNX.4.64.0607191114420.10902@gannet.stats.ox.ac.uk>

It is history:

r16144 | ripley | 2001-09-28 19:40:28 +0100 (Fri, 28 Sep 2001) | 2 lines

add is.na<-, distinguish NA level and NA codes in factors

so predates having NA character strings distinct from "NA".

On Tue, 11 Jul 2006, Brahm, David wrote:

> I mentioned this in R-help on April 28:
> <https://stat.ethz.ch/pipermail/r-help/2006-April/104595.html>
> 
> | as.character.factor contains this line (where cx=levels(x)[x]):
> |   if ("NA" %in% levels(x)) cx[is.na(x)] <- "<NA>"
> |
> | Is it possible that this is no longer the desired behavior?  These
> | two results don't seem very consistent:
> |
> | > as.character(as.factor(c("AB", "CD", NA)))
> | [1] "AB" "CD" NA  
> | > is.na(.Last.value)[3]
> | [1] TRUE
> |
> | > as.character(as.factor(c("NA", "CD", NA)))
> | [1] "NA"   "CD"   "<NA>"
> | > is.na(.Last.value)[3]
> | [1] FALSE
> |
> | I'm using R-2.3.0 on Redhat Linux, but I don't think the behavior
> | is new (maybe since character NA's were introduced?).
> |
> | -- David Brahm (brahm at alum.mit.edu)
> 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Peter Dalgaard
> Sent: Tuesday, July 11, 2006 5:59 PM
> To: J. Hosking
> Cc: r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Dropping unused levels of a factor that has "NA" as a level
> 
> "J. Hosking" <jh910 at juno.com> writes:
> 
> > Is this a bug?
> > 
> >    > f1 <- factor(c("a", NA), levels = c("a", "NA") )
> >    > f2 <- f1[, drop = TRUE]
> >    > f2
> >    [1] a    <NA>
> >    Levels: a <NA>
> > 
> > I would have expected f2 to have only one level, "a".  It seems
> > to me that the code in [.factor does not follow the advice in
> > help("factor") on how to set factor codes to be missing when
> > "NA" is a level of the factor.
> 
> 
> Something odd is going on, that's for sure...
> 
> The problem is also there with factor(f1). And the logic in
> as.character.factor seems to be at the root of it:
> 
> > as.character.factor
> function (x, ...)
> {
>     cx <- levels(x)[x]
>     if ("NA" %in% levels(x))
>         cx[is.na(x)] <- "<NA>"
>     cx
> }
>  
> This looks like something from before we had character NA values. I
> wonder if it is a mistake or there could actually be a reason to
> keep it. 
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From agustin.perez at umh.es  Wed Jul 19 12:30:56 2006
From: agustin.perez at umh.es (agustin.perez at umh.es)
Date: Wed, 19 Jul 2006 12:30:56 +0200 (CEST)
Subject: [Rd] illegal operation in debian (PR#9086)
Message-ID: <20060719103056.B9C4654B6F@slim.kubism.ku.dk>

Full_Name: Agustin Perez
Version: 2.3.1
OS: Debian 2.6.8-11-amd64-generic
Submission from: (NULL) (193.147.142.6)


First of all excuses for my bad use of english and thanks for read my problem.

Well when I do the following comand in R suddenly crashes and exit me for the
enviroment:

> a<-matrix(1:13500,450,30)
> a%*%t(a)

 *** caught illegal operation ***
address 0x2a9590086f, cause 'illegal operand'

Possible actions:
1: abort (with core dump)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection: 3


I don't know what is the problem.

Agust?n


From ripley at stats.ox.ac.uk  Wed Jul 19 12:48:05 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 19 Jul 2006 12:48:05 +0200 (CEST)
Subject: [Rd] illegal operation in debian (PR#9086)
Message-ID: <20060719104805.1C72E54C38@slim.kubism.ku.dk>

On Wed, 19 Jul 2006, agustin.perez at umh.es wrote:

> Full_Name: Agustin Perez
> Version: 2.3.1
> OS: Debian 2.6.8-11-amd64-generic
> Submission from: (NULL) (193.147.142.6)
> 
> 
> First of all excuses for my bad use of english and thanks for read my problem.
> 
> Well when I do the following comand in R suddenly crashes and exit me for the
> enviroment:
> 
> > a<-matrix(1:13500,450,30)
> > a%*%t(a)
> 
>  *** caught illegal operation ***
> address 0x2a9590086f, cause 'illegal operand'
> 
> Possible actions:
> 1: abort (with core dump)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection: 3
> 
> 
> I don't know what is the problem.

Quite likely using a BLAS inappropriate for the chip in use.

If you choose 1 and examine the core dump with gdb you will be able to 
tell us where the illegal operand occurred.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From edd at debian.org  Wed Jul 19 13:20:22 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 19 Jul 2006 06:20:22 -0500
Subject: [Rd] illegal operation in debian (PR#9086)
In-Reply-To: <20060719104805.1C72E54C38@slim.kubism.ku.dk>
References: <20060719104805.1C72E54C38@slim.kubism.ku.dk>
Message-ID: <17598.5494.568153.893754@basebud.nulle.part>


On 19 July 2006 at 12:48, ripley at stats.ox.ac.uk wrote:
| On Wed, 19 Jul 2006, agustin.perez at umh.es wrote:
| 
| > Full_Name: Agustin Perez
| > Version: 2.3.1
| > OS: Debian 2.6.8-11-amd64-generic
| > Submission from: (NULL) (193.147.142.6)
| > 
| > 
| > First of all excuses for my bad use of english and thanks for read my problem.
| > 
| > Well when I do the following comand in R suddenly crashes and exit me for the
| > enviroment:
| > 
| > > a<-matrix(1:13500,450,30)
| > > a%*%t(a)
| > 
| >  *** caught illegal operation ***
| > address 0x2a9590086f, cause 'illegal operand'
| > 
| > Possible actions:
| > 1: abort (with core dump)
| > 2: normal R exit
| > 3: exit R without saving workspace
| > 4: exit R saving workspace
| > Selection: 3
| > 
| > 
| > I don't know what is the problem.
| 
| Quite likely using a BLAS inappropriate for the chip in use.

Yes, that is very likely -- the command just worked on my Debian
system. Please show us the result of 

$ dpkg -l | grep "blas\|lapack"| cut -c-79

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From agustin.perez at umh.es  Wed Jul 19 13:39:10 2006
From: agustin.perez at umh.es (Perez Martin, Agustin)
Date: Wed, 19 Jul 2006 13:39:10 +0200
Subject: [Rd] illegal operation in debian (PR#9086)
Message-ID: <79C6D1A4DD5E7B46B663C43C0021236507AEB7C1@MAILER-E071.umh.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060719/5d6052b0/attachment.pl 

From ripley at stats.ox.ac.uk  Wed Jul 19 14:22:36 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Jul 2006 13:22:36 +0100 (BST)
Subject: [Rd] illegal operation in debian (PR#9086)
In-Reply-To: <79C6D1A4DD5E7B46B663C43C0021236507AEB7C1@MAILER-E071.umh.es>
References: <79C6D1A4DD5E7B46B663C43C0021236507AEB7C1@MAILER-E071.umh.es>
Message-ID: <Pine.LNX.4.64.0607191248410.17415@gannet.stats.ox.ac.uk>

On Wed, 19 Jul 2006, Perez Martin, Agustin wrote:

> Well, first I?m going to write the output of gdb:

Used incorrectly: you need to use

gdb  /path/to/R/bin/exec/R <corefile>

and perhaps 'where' at the gdb prompt.

(Or run R -d gdb.)

>       agustin.perez at pitagoras:~$ gdb R core
> 
>       GNU gdb 6.3-debian
> 
>       Copyright 2004 Free Software Foundation, Inc.
> 
>       GDB is free software, covered by the GNU General Public License, and
> you are
> 
>       welcome to change it and/or distribute copies of it under certain
> conditions.
> 
>       Type "show copying" to see the conditions.
> 
>       There is absolutely no warranty for GDB.  Type "show warranty" for
> details.
> 
>       This GDB was configured as "x86_64-linux"..."/usr/bin/R": not in
> executable format: No se reconoce el formato del fichero
> 
>       
> 
>       Using host libthread_db library "/lib/libthread_db.so.1".
> 
>       Core was generated by `/home/agustin.perez/R-2.3.1/bin/exec/R'.
> 
>       Program terminated with signal 4, Illegal instruction.
> 
>       #0  0x0000002a9590086f in ?? ()

...

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From simon.urbanek at r-project.org  Wed Jul 19 16:18:13 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 19 Jul 2006 10:18:13 -0400
Subject: [Rd] [BioC] Errors using biocLite on Apple OS X
In-Reply-To: <0BE438149FF2254DB4199E2682C8DFEB01D55497@crcmail1.BCCRC.CA>
References: <0BE438149FF2254DB4199E2682C8DFEB01D55493@crcmail1.BCCRC.CA>
	<44BD3BC8.9050500@fhcrc.org>
	<0BE438149FF2254DB4199E2682C8DFEB01D55497@crcmail1.BCCRC.CA>
Message-ID: <5DA89313-8FAB-4146-8780-624CB2DCCC3E@r-project.org>

Steven,

short story: now fixed in R-devel. The long story:

On Jul 18, 2006, at 8:15 PM, Steven McKinney wrote:

> The warnings from
>
>  make.packages.html()
>
> on the Apple Mac OS X platform can be dealt
> with as follows:
>

The warning appears for a completely different reason -  
make.packages.html() assumes that HTML help was started and created  
all necessary links which is not the case in the R Mac OS X GUI,  
until you request one of the temporarily generated pages. The idea of  
make.packages.html is to update the  temporary copy of HTML  
documentation on installation such that packages list is up-to-date,  
but since the R GUI generates the files only on-demand, there is no  
need for such update if no temporary documentation was requested yet,  
and so updating doesn't make sense (and the warning can be ignored).  
The correct fix is not not run make.packages.html() at all if the  
temporarily generated list doesn't exist and I have fixed that now  
for R-devel.

All your 'work-arounds' are bogus - may have asked on R-SIG-Mac to  
save you the trouble of going in a completely wrong direction -  just  
invoke the main help page (<Cmd><?>) before installing and the  
temporary help files will be created.


> ------------------------------------------------
> (1)
>
> make.packages.html() uses the function tempdir() and attempts to  
> create a temporary directory in the default location /tmp/ which  
> fails due to the /tmp directory architecture on the Mac.
>

This is of course nonsense. Mac OS X uses /tmp as many other unix  
systems do and it is available (tempdir() works as well).


> (2)
>
> The function make.packages.html() attempts to create a couple of  
> files, but fails on Mac OS X. Apparently a directory must already  
> exist for file.create() to successfully establish a new file in it.
>

Yes, it fails because it expects the help system to have created them  
already and you're not supposed to mess with that manually. (Again,  
this is not Mac-specific - until help.start is invoked, the  
directories are not there on any unix).


> However, when biocLite() runs, it does not access my redefined  
> make.packages.html() in .Globalenv - the bioclite() call appears to  
> always call the package:utils copy of this function.
>

Yes, that is intentional, thanks to namespaces.


> Thanks to Herve Pages for his excellent summarization of the issues  
> arising when running biocLite on the Mac.
>

For the record, the other warning mentioned appears when installing  
from empty repositories - it is not Mac specific. (The lindsey  
repository is empty on Bioc, because none of the packages compiles).  
I have now also committed the fix (thanks to Seth for the correct  
analysis and fix).

Cheers,
Simon


> -----Original Message-----
> From: Herve Pages [mailto:hpages at fhcrc.org]
> Sent: Tue 7/18/2006 12:51 PM
> To: Steven McKinney
> Cc: Bioconductor at stat.math.ethz.ch
> Subject: Re: [BioC] Errors using biocLite on Apple OS X
>
> Hi Steven,
>
> I can see warnings only in what you reported. These warnings
> are well-known issues but are not biocLite problems: they are
> Mac OS X install.packages() specific issues.
>
> The first warning:
>   1: number of rows of result
>        is not a multiple of vector length (arg 2) in: cbind(1, res0,
> Repository = repos)
> is issued by install.packages() when it is given a repos vector with
> length >= 4.
> You can easily reproduce it with:
>> repos <- c("http://bioconductor.org/packages/1.8/bioc",
>      "http://bioconductor.org/packages/1.8/data/annotation",
>      "http://bioconductor.org/packages/1.8/data/experiment",
>      "http://bioconductor.org/packages/1.8/omegahat",
>      "http://bioconductor.org/packages/1.8/lindsey",
>      "http://cran.fhcrc.org")
>> install.packages("Biobase", repos=repos)
>
> The second warning is a permission issue specific to Mac OS X.
>
> Anyway, these warnings should not prevent biocLite to install the  
> requested
> packages correctly.
>
> Cheers,
>
> H.
>
>
> Steven McKinney wrote:
>> I've recently started using R and Bioconductor
>> on an Apple Mac running OS X (10.4). I've been
>> installing packages from the *nix command line,
>> one by one, no trouble.
>>
>> I would like to be able to update using
>> biocLite from the R gui, but keep getting
>> errors.
>>
>>
>>> version
>> _
>> platform powerpc-apple-darwin8.6.0
>> arch powerpc
>> os darwin8.6.0
>> system powerpc, darwin8.6.0
>> status
>> major 2
>> minor 3.1
>> year 2006
>> month 06
>> day 01
>> svn rev 38247
>> language R
>> version.string Version 2.3.1 (2006-06-01)
>>
>>
>>> source("http://bioconductor.org/biocLite.R")
>>> biocLite("Biobase", destdir =
>>> "/Volumes/KilroyHD/kilroy/Software/BioConductor")
>> Running getBioC version 0.1.6 with R version 2.3.1
>> Running biocinstall version 1.8.4 with R version 2.3.1
>> Your version of R requires version 1.8 of Bioconductor.
>> trying URL
>> 'http://bioconductor.org/packages/1.8/bioc/bin/macosx/powerpc/ 
>> contrib/2.3/Biobase_1.10.1.tgz'
>> Content type 'application/x-gzip' length 1465858 bytes
>> opened URL
>> ==================================================
>> downloaded 1431Kb
>>
>> Warning messages:
>> 1: number of rows of result
>> is not a multiple of vector length (arg 2) in: cbind(1, res0,
>> Repository = repos)
>> 2: cannot create HTML package index in: make.packages.html()
>>
>>
>> I am using version 1.10.1 of Biobase, I presume this is the
>> version number for Bioconductor.
>>
>> I see a few others reporting similar errors
>> when I google this issue, but I see no posted
>> solutions. Can anyone see what I am doing wrong,
>> and is there a solution?
>>
>> Any info appreciated
>>
>>
>> Best regards
>>
>> Steven McKinney
>>
>> Statistician
>> Molecular Oncology and Breast Cancer Program
>> British Columbia Cancer Research Centre
>>
>> email: smckinney at bccrc.ca
>>
>>
>>
>> BCCRC
>> Molecular Oncology
>> 675 West 10th Ave, Floor 4
>> Vancouver B.C.
>> V5Z 1L3
>> Canada
>>
>> _______________________________________________
>> Bioconductor mailing list
>> Bioconductor at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/bioconductor
>> Search the archives:
>> http://news.gmane.org/gmane.science.biology.informatics.conductor
>
>
>
> -- 
> ------------------------
> Herv? Pag?s
> E-mail: hpages at fhcrc.org
> Phone: (206) 667-5791
> Fax: (206) 667-1319
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From simon.urbanek at r-project.org  Wed Jul 19 16:29:08 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 19 Jul 2006 10:29:08 -0400
Subject: [Rd] ASCII dump from an REXP (JRI)
In-Reply-To: <5390018.post@talk.nabble.com>
References: <5390018.post@talk.nabble.com>
Message-ID: <CF587A7B-86EE-4E72-A85D-B06B486C5C6B@r-project.org>

Adam,

please use stats-rosuda-devel or private mail, your mail ended up on  
R-devel again ...

On Jul 18, 2006, at 10:56 PM, way4thesub wrote:

> evaluate an R expression. Is there a way to just print, verbatim,  
> what R evaluates to the screen (ie just a pure ASCII dump with no  
> regard to the data type)?
>

Probably the easiest is (replace "a" with any expression you want to  
show):

System.out.println(reng.eval("paste(capture.output(print 
(a)),collapse='\n')").asString());

Another alternative is to use callbacks - i.e. create a class that  
implements RMainLoopCallbacks and simple reng.eval("print(a)"); will  
cause rWriteConsole to be called with the output. This approach is  
more suitable for console-like GUIs.

Cheers,
Simon


From pinard at iro.umontreal.ca  Wed Jul 19 16:29:47 2006
From: pinard at iro.umontreal.ca (=?iso-8859-1?Q?Fran=E7ois?= Pinard)
Date: Wed, 19 Jul 2006 10:29:47 -0400
Subject: [Rd] Patch to allow negative argument in head() and tail()
In-Reply-To: <17597.57223.151500.824538@stat.math.ethz.ch>
References: <200607171503.34713.vincent.goulet@act.ulaval.ca>
	<17596.40686.710925.321109@stat.math.ethz.ch>
	<200607181356.06360.vincent.goulet@act.ulaval.ca>
	<20060718214153.GA5151@alcyon.progiciels-bpi.ca>
	<17597.57223.151500.824538@stat.math.ethz.ch>
Message-ID: <20060719142947.GA6942@phenix.progiciels-bpi.ca>

[Martin Maechler]

>  Regarding unix command line compatibility:
>  Note that there, 'tail'  is *really* not what we want to imitate:

>  "3" is the same as "-3" but different from "+3" :

>I know that there is some "good" reason for the behavior of
>'tail' in "Unix" 
>  { tail -3 === tail -n  3   and
>    tail -3 === tail -n -3      }                            ***

>but of course, we can't be compatible here, because in S
>(and most reasonable languages :-) 
>"3 == +3"  and  "3 != -3" !

I'm not sure I understand you fully, or maybe there is a typo on the 
starred line above.  When I speak about GNU "head" and "tail" behaviour,
I'm really meaning the internal behaviour once option values have been 
decoded, but certainly not option representation themselves.

The strange spirit of Unix designers show, where while `-' is only meant 
as an option introducer, by a kind of typographical pun, it is 
temporarily seen a negative sign when the time comes to negate a value, 
and this is the reason `+' was sometimes used, that is, as a humorous 
way to mean a minus sign in option context.  So, `+' really means `-' 
sometimes.  This is a similar kind of humour which later yielded 
a better "more" program to be named "less" :-).

For "head" and "tail", these programs were accepting a number as first 
argument without requiring it to be introduced by the usual `-'.  POSIX 
later came in and got rid of this irregularity.  Moreover, within GNU, 
`+' option introducer was once reserved for so called "long options" and 
consequently unavailable for the above pun, but later freed again when 
the `--' convention was adopted instead of `+' for long options.  Many 
implementations attempted to be compatible to both POSIX and pre-POSIX 
specifications.  GNU implementation also had to cope with their own 
varying option standards, as well as a lot of contradictory pressure 
from users and within.  Even nowadays, as a futile attempt to reconcile 
some incompatible trends that cannot be dismissed, a few environment 
variables can be set to alter how these tools interpret and decode the 
value of the dreaded option.  As you may guess, confusion resulted, and 
those of us who followed it all never fully recovered from all the brain 
damage :-).  [Another tiny corner of Unix where sign confusion blatantly 
existed was "nice", this tool meant to alter process priority.]

*Once* the real value has been decoded out of the option, the current 
convention is as follow, given that N is a positive number:

  Value  "head" tool                    "tail" tool

  N      Show N initial lines           Show N last lines
  -N     Show all but N last lines      Show all but N first lines

Hoping that this clarification may be helpful in the whole thinking! :-)

-- 
Fran?ois Pinard   http://pinard.progiciels-bpi.ca


From tlumley at u.washington.edu  Wed Jul 19 17:30:04 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 19 Jul 2006 08:30:04 -0700 (PDT)
Subject: [Rd] Bug?: summary() fails after use of na.action="na.exclude"
 in lm()
In-Reply-To: <44BDFA61.20500@bfro.uni-lj.si>
References: <44BDFA61.20500@bfro.uni-lj.si>
Message-ID: <Pine.LNX.4.64.0607190823230.6767@homer23.u.washington.edu>

On Wed, 19 Jul 2006, Gregor Gorjanc wrote:
> I have encountered a weird problem and I am wondering if this is a bug.
> Here is the example:
>
> n <- 50
> x <- runif(n=n)
> y1 <- 2 * x + rnorm(n=n)
> y2 <- 5 * x + rnorm(n=n)
> y2[sample(1:n, size=5)] <- NA
>
> y <- cbind(y1, y2)
>
> fit <- lm(y1 ~ 1, na.action="na.exclude")
> summary(fit)
>
> ## Goes ok here
> fit <- lm(y2 ~ 1, na.action="na.exclude")
> summary(fit)
>
> ## But fails if we use matrix of response variables
> fit <- lm(y ~ 1, na.action="na.exclude")
> summary(fit)
>
> ## Response y1 :
> ##
> ## Call:
> ## lm(formula = y1 ~ 1, na.action = "na.exclude")
> ##
> ## Residuals:
> ## Error in quantile.default(resid) : missing values and NaN's not
> allowed if 'na.rm' is FALSE
>

Yes, I think it's a bug.

  summary.mlm() produces an object that is a list of objects of class 
"summary.lm", but these objects get their $resid component from the 
residuals() function and so NAs in their $resid component where a 
"summary.lm"  produced by summary.lm() would not.

 	-thomas


From mschaff at bu.edu  Wed Jul 19 17:30:50 2006
From: mschaff at bu.edu (Mike Schaffer)
Date: Wed, 19 Jul 2006 11:30:50 -0400
Subject: [Rd] Post CGI forms with built-in R function?
Message-ID: <AA5F2F09-B65C-47C5-B7DD-541FCA4956B5@bu.edu>

I wrote a package that requires downloading data from an external  
server based on parameters specified by the user.

I have used RMySQL or Rcurl to accomplish this, but in the interest  
of simplicity for users of this package, I'd like this communication  
to not require installing other packages and their dependencies (e.g.  
RMySQL, Rcurl, etc.).  These dependencies are sometimes a deterrent  
to using my package.

I set up a CGI script on the server to handle data requests.  Now, is  
there a *built-in* R function that could be adapted to post forms or  
otherwise allows long URLs to be passed to this script to retrieve  
the data requested.  I tried using just "scan", but it fails with  
long URLs (sometimes a long list of parameters is required).  I think  
my only option is to use POST, but it doesn't appear it is possible  
without Rcurl.

Can anyone help or suggest a "native" solution to the problem?

Thanks.


From agustin.perez at umh.es  Wed Jul 19 17:54:40 2006
From: agustin.perez at umh.es (Perez Martin, Agustin)
Date: Wed, 19 Jul 2006 17:54:40 +0200
Subject: [Rd] illegal operation in debian (PR#9086)
Message-ID: <79C6D1A4DD5E7B46B663C43C0021236507AEB7C2@MAILER-E071.umh.es>

Program received signal SIGILL, Illegal instruction.
0x0000002a9590086f in ATL_dupKBmm30_1_1_b0 () from
/usr/lib/atlas/libblas.so.3


-----Mensaje original-----
De: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Enviado el: mi?rcoles, 19 de julio de 2006 14:23
Para: Perez Martin, Agustin
CC: 'Dirk Eddelbuettel'; r-devel at stat.math.ethz.ch
Asunto: RE: [Rd] illegal operation in debian (PR#9086)

On Wed, 19 Jul 2006, Perez Martin, Agustin wrote:

> Well, first I?m going to write the output of gdb:

Used incorrectly: you need to use

gdb  /path/to/R/bin/exec/R <corefile>

and perhaps 'where' at the gdb prompt.

(Or run R -d gdb.)

>       agustin.perez at pitagoras:~$ gdb R core
> 
>       GNU gdb 6.3-debian
> 
>       Copyright 2004 Free Software Foundation, Inc.
> 
>       GDB is free software, covered by the GNU General Public License, and
> you are
> 
>       welcome to change it and/or distribute copies of it under certain
> conditions.
> 
>       Type "show copying" to see the conditions.
> 
>       There is absolutely no warranty for GDB.  Type "show warranty" for
> details.
> 
>       This GDB was configured as "x86_64-linux"..."/usr/bin/R": not in
> executable format: No se reconoce el formato del fichero
> 
>       
> 
>       Using host libthread_db library "/lib/libthread_db.so.1".
> 
>       Core was generated by `/home/agustin.perez/R-2.3.1/bin/exec/R'.
> 
>       Program terminated with signal 4, Illegal instruction.
> 
>       #0  0x0000002a9590086f in ?? ()

...

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
No virus found in this incoming message.


 

--


From ripley at stats.ox.ac.uk  Wed Jul 19 18:18:03 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Jul 2006 17:18:03 +0100 (BST)
Subject: [Rd] illegal operation in debian (PR#9086)
In-Reply-To: <79C6D1A4DD5E7B46B663C43C0021236507AEB7C2@MAILER-E071.umh.es>
References: <79C6D1A4DD5E7B46B663C43C0021236507AEB7C2@MAILER-E071.umh.es>
Message-ID: <Pine.LNX.4.64.0607191716240.30709@gannet.stats.ox.ac.uk>

On Wed, 19 Jul 2006, Perez Martin, Agustin wrote:

> Program received signal SIGILL, Illegal instruction.
> 0x0000002a9590086f in ATL_dupKBmm30_1_1_b0 () from
> /usr/lib/atlas/libblas.so.3

OK, that is clearly a debian ATLAS issue, so not an R bug.

> -----Mensaje original-----
> De: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Enviado el: mi?rcoles, 19 de julio de 2006 14:23
> Para: Perez Martin, Agustin
> CC: 'Dirk Eddelbuettel'; r-devel at stat.math.ethz.ch
> Asunto: RE: [Rd] illegal operation in debian (PR#9086)
> 
> On Wed, 19 Jul 2006, Perez Martin, Agustin wrote:
> 
> > Well, first I?m going to write the output of gdb:
> 
> Used incorrectly: you need to use
> 
> gdb  /path/to/R/bin/exec/R <corefile>
> 
> and perhaps 'where' at the gdb prompt.
> 
> (Or run R -d gdb.)
> 
> >       agustin.perez at pitagoras:~$ gdb R core
> > 
> >       GNU gdb 6.3-debian
> > 
> >       Copyright 2004 Free Software Foundation, Inc.
> > 
> >       GDB is free software, covered by the GNU General Public License, and
> > you are
> > 
> >       welcome to change it and/or distribute copies of it under certain
> > conditions.
> > 
> >       Type "show copying" to see the conditions.
> > 
> >       There is absolutely no warranty for GDB.  Type "show warranty" for
> > details.
> > 
> >       This GDB was configured as "x86_64-linux"..."/usr/bin/R": not in
> > executable format: No se reconoce el formato del fichero
> > 
> >       
> > 
> >       Using host libthread_db library "/lib/libthread_db.so.1".
> > 
> >       Core was generated by `/home/agustin.perez/R-2.3.1/bin/exec/R'.
> > 
> >       Program terminated with signal 4, Illegal instruction.
> > 
> >       #0  0x0000002a9590086f in ?? ()
> 
> ...
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From cberry at tajo.ucsd.edu  Wed Jul 19 18:19:47 2006
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Wed, 19 Jul 2006 09:19:47 -0700
Subject: [Rd] Patch to allow negative argument in head() and tail()
In-Reply-To: <17597.57223.151500.824538@stat.math.ethz.ch>
References: <200607171503.34713.vincent.goulet@act.ulaval.ca>
	<17596.40686.710925.321109@stat.math.ethz.ch>
	<200607181356.06360.vincent.goulet@act.ulaval.ca>
	<20060718214153.GA5151@alcyon.progiciels-bpi.ca>
	<17597.57223.151500.824538@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0607190908350.19791@tajo.ucsd.edu>

On Wed, 19 Jul 2006, Martin Maechler wrote:

[most discussion of unix tail behavior deleted]

>
> I know that there is some "good" reason for the behavior of
> 'tail' in "Unix"
>  { tail -3 === tail -n  3   and
>    tail -3 === tail -n -3      }
>
> but of course, we can't be compatible here, because in S
> (and most reasonable languages :-)
> "3 == +3"  and  "3 != -3" !
>


Ahhh. But in R

 	quote( foo( +n ) ) != quote( foo( n ) )

so if one was determined to emulate GNU Coreutils tail's behavior it 
***could*** be done by using match.call to recover the explicit '+' or 
'-'.

But I shudder to think of the confusion that this approach might cause 
when n is an expression whose value is negative.


Chuck

Charles C. Berry                        (858) 534-2098
                                          Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	         UC San Diego
http://biostat.ucsd.edu/~cberry/         La Jolla, San Diego 92093-0717


From duncan at wald.ucdavis.edu  Wed Jul 19 18:21:48 2006
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Wed, 19 Jul 2006 09:21:48 -0700
Subject: [Rd] Post CGI forms with built-in R function?
In-Reply-To: <AA5F2F09-B65C-47C5-B7DD-541FCA4956B5@bu.edu>
References: <AA5F2F09-B65C-47C5-B7DD-541FCA4956B5@bu.edu>
Message-ID: <44BE5C1C.40105@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


Hi Mike

 If you don't want to have to download any packages but stick entirely
within R, then you can mimic the code in httpRequest. But,
as far as I know, there is no function in the standard R distribution to
POST an HTTP request.

  As for using
   scan("http://....")

  what is the string you are using? Are you escaping all the characters
correctly? What's the error message?

 If what you are doing involves only relatively basic HTTP requests,
perhaps the simplest thing to do is use the httpRequest package on CRAN.
It does the basics.  You may have to handle chunked responses yourself
and escaping certain characters. But that is a pure R solution that can
be easily installed via install.packages().



Mike Schaffer wrote:
> I wrote a package that requires downloading data from an external  
> server based on parameters specified by the user.
> 
> I have used RMySQL or Rcurl to accomplish this, but in the interest  
> of simplicity for users of this package, I'd like this communication  
> to not require installing other packages and their dependencies (e.g.  
> RMySQL, Rcurl, etc.).  These dependencies are sometimes a deterrent  
> to using my package.
> 
> I set up a CGI script on the server to handle data requests.  Now, is  
> there a *built-in* R function that could be adapted to post forms or  
> otherwise allows long URLs to be passed to this script to retrieve  
> the data requested.  I tried using just "scan", but it fails with  
> long URLs (sometimes a long list of parameters is required).  I think  
> my only option is to use POST, but it doesn't appear it is possible  
> without Rcurl.
> 
> Can anyone help or suggest a "native" solution to the problem?
> 
> Thanks.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFEvlwb9p/Jzwa2QP4RAvL1AJ9W/ixKDEl0KbH9yrGmTbEWsXoP+ACfXVdW
vxQEDd6UsMXzX0baOPdhMvo=
=uzVj
-----END PGP SIGNATURE-----


From edd at debian.org  Wed Jul 19 18:32:19 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 19 Jul 2006 11:32:19 -0500
Subject: [Rd] illegal operation in debian (PR#9086)
In-Reply-To: <Pine.LNX.4.64.0607191716240.30709@gannet.stats.ox.ac.uk>
References: <79C6D1A4DD5E7B46B663C43C0021236507AEB7C2@MAILER-E071.umh.es>
	<Pine.LNX.4.64.0607191716240.30709@gannet.stats.ox.ac.uk>
Message-ID: <20060719163219.GA19804@eddelbuettel.com>

On Wed, Jul 19, 2006 at 05:18:03PM +0100, Prof Brian Ripley wrote:
> On Wed, 19 Jul 2006, Perez Martin, Agustin wrote:
> 
> > Program received signal SIGILL, Illegal instruction.
> > 0x0000002a9590086f in ATL_dupKBmm30_1_1_b0 () from
> > /usr/lib/atlas/libblas.so.3
> 
> OK, that is clearly a debian ATLAS issue, so not an R bug.

Yup. And I had forgotten to ask you about the atlas libs. What does 
'dpkg -l | grep atlas' say ?

And to go one step ahead, conjecturing that you have a particular tuned
atlas library installed, remove that and try with atlas3-base only. The
error should go away. 

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From duncan at wald.ucdavis.edu  Thu Jul 20 15:49:02 2006
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Thu, 20 Jul 2006 06:49:02 -0700
Subject: [Rd] Post CGI forms with built-in R function?
In-Reply-To: <44BE5C1C.40105@wald.ucdavis.edu>
References: <AA5F2F09-B65C-47C5-B7DD-541FCA4956B5@bu.edu>
	<44BE5C1C.40105@wald.ucdavis.edu>
Message-ID: <44BF89CE.2020006@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


There is a hard coded limit of 4096 characters in
RxmlNanoHTTPScanURL and other ScanURL routines in nanohttp.c
and nanoftp.c.   And your URI is 5138 and so walks past the bounds
of the array of length 4096.

I am not yet convinced that it is worthwhile to increase this limit to
a larger number.  Using POST in this context really is a better
solution.  But we do need to add checks to the code to ensure that
the URI string is smaller than 4096.

I'll try to get an opportunity to do that tomorrow before I take off.

  D.

Duncan Temple Lang wrote:
> 
> Hi Mike
> 
>  If you don't want to have to download any packages but stick entirely
> within R, then you can mimic the code in httpRequest. But,
> as far as I know, there is no function in the standard R distribution to
> POST an HTTP request.
> 
>   As for using
>    scan("http://....")
> 
>   what is the string you are using? Are you escaping all the characters
> correctly? What's the error message?
> 
>  If what you are doing involves only relatively basic HTTP requests,
> perhaps the simplest thing to do is use the httpRequest package on CRAN.
> It does the basics.  You may have to handle chunked responses yourself
> and escaping certain characters. But that is a pure R solution that can
> be easily installed via install.packages().
> 
> 
> 
> Mike Schaffer wrote:
> 
>>>I wrote a package that requires downloading data from an external  
>>>server based on parameters specified by the user.
>>>
>>>I have used RMySQL or Rcurl to accomplish this, but in the interest  
>>>of simplicity for users of this package, I'd like this communication  
>>>to not require installing other packages and their dependencies (e.g.  
>>>RMySQL, Rcurl, etc.).  These dependencies are sometimes a deterrent  
>>>to using my package.
>>>
>>>I set up a CGI script on the server to handle data requests.  Now, is  
>>>there a *built-in* R function that could be adapted to post forms or  
>>>otherwise allows long URLs to be passed to this script to retrieve  
>>>the data requested.  I tried using just "scan", but it fails with  
>>>long URLs (sometimes a long list of parameters is required).  I think  
>>>my only option is to use POST, but it doesn't appear it is possible  
>>>without Rcurl.
>>>
>>>Can anyone help or suggest a "native" solution to the problem?
>>>
>>>Thanks.
>>>
>>>______________________________________________
>>>R-devel at r-project.org mailing list
>>>https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> --
> Duncan Temple Lang                    duncan at wald.ucdavis.edu
> Department of Statistics              work:  (530) 752-4782
> 4210 Mathematical Sciences Building   fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis,
> CA 95616,
> USA

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFEv4nO9p/Jzwa2QP4RAnPnAJ974RMxo/KXfxQjaRHoHB1ZsdIy+QCeNhXg
EDk/WHaFUeH5C2v/607kovo=
=FAGn
-----END PGP SIGNATURE-----


From mschaff at bu.edu  Thu Jul 20 17:01:17 2006
From: mschaff at bu.edu (Mike Schaffer)
Date: Thu, 20 Jul 2006 11:01:17 -0400
Subject: [Rd] Post CGI forms with built-in R function?
In-Reply-To: <44BF89CE.2020006@wald.ucdavis.edu>
References: <AA5F2F09-B65C-47C5-B7DD-541FCA4956B5@bu.edu>
	<44BE5C1C.40105@wald.ucdavis.edu>
	<44BF89CE.2020006@wald.ucdavis.edu>
Message-ID: <13D02FC1-501E-430F-B514-CABC0DDA1C21@bu.edu>

Thanks Duncan.  I figured there was some limit.

Your suggestion to check out the httpRequest code has me headed in  
the right direction, but I am having problems with the data returned  
from the socketConnection.  Some of the returned data appears to  
improperly decoded.  I don't know if I've stumbled on a low-level  
socket bug, or I need to error check the results myself.  Can anyone  
figure out the problem in the code below?

This was run using R version 2.3.1 (2006-06-01) on both Linux and OS  
X with the same results.



# First, the correctly formatted data for comparison is returned by  
the code below.  As we've established, this works fine, but I can't  
use it with long URIs:

full.url<-"http://genomics11.bu.edu/cgi-bin/Tractor_dev/external/ 
get_msa.cgi? 
user_id=0&table=seqs_ucsc_hg18&len=350&gene_set_ids=NM_000029,NM_000064, 
NM_000066&orgs=Hs,mm8,canFam2"
read<-readLines(full.url)


# This returns three tab-delimited lines with a header row.

 > read
[1] "NA\tHs\tmm8\tcanFam2"

[2] "NM_000029\tTAAGCA--AGACTC-TCCCCTGCCCTCTGCCCTCTGCACCTCCGG--- 
CCTGCATGTC----------CCTGTGGCCTCTTGGGGGTACATCTCCCGGGG--- 
CTGGGTCAGAAG---------GCCTGGGTGGTTGGCCTCAGG------------------------ 
CTGTCACACACCTAGGGAGATGCTC------------------ 
CCGTTTCTGGGAACCTTGGCCCCGACTCCTGCA---- 
AACTTCGGTAAATGTGTAACTCGACCCTGCACCGGCTC---------------- 
ACTCTGTTCAGCA----GTGAAACTCTGCATCGATCACTAAGACTTCCTGG- 
AAGAGGTCCCAGCGT----GAGTGTCGCT--- 
TCTGGCATCTGTCCTTCTGG---------------------CCAGCCTGTGGTC-------------- 
TGG-CCAAGTGATGTAACCCTCCTCT---CCAGCCT\tTGCAAGTGAGCCCC- 
CTTCCTG-----------------------------GCATGCC----------CAGAGAGGCTTACG-- 
AGTGCATCACGAGGGGG-CTTTCATCCCAAG--------- 
GTCTGCATGGCTGGCTTCAGG------------------------TTGTCACAACCC----- 
ACTCAATC------------------CTGTGACTG-------TGGTCCTGGCTCCAGGG---- 
AACTGGGGTAAATGTGTAACCCAAGGCCAGCC---------------------- 
TATTTTTGCATGA----GGCT-------CATCTGCCAGTAGGGCTTCCTGG-AAGGGG- 
CCCAGAG-----GAACATCAC----CCTGGCCCTGATCCATCTTGGT------------------- 
CAAGCCTGGATTCTCA-----------TGG-TTCCCTGATCTGGGTCCTCCC----CCAGCCT 
\tCCGG----GGCTCC-TTCCCTG--------------CGCCCTGGGGCCTCAGCACATT---------- 
CTTGGGGACTCTCAGAAGCACACCTCGAGAGG--GCTCTGTCAGAAG---------GCTTG- 
GTGGCTGGCCTCGGC------------------------ 
TTGTCACAGCTCAGGGCAGAGACGCGACACACACACCTACACACAGGTACGGGGCGCTCCGGACCCGGCCCG 
GGCAGGGGAGCTGCGGTCAATGTGTAACTCGGCGGCCCAGCGGCTC---------------- 
GTTCTGCTCAGCA----CAGAAAGTGTGCATCGATCTCCCTGACTTCCTGG- 
AAGGCGTCCCAGCCT----GAGAGTAGCT----CTGGCGCCTGTACCCCCCACC------ 
CCCGTGGGGCCCCCACCCCCATGGTC--------------GGG- 
CCAAGTGATGTCACCTCCCGCCTCCCCAGCCT"

[3] "NM_000064\tC------------------------------------- 
CAAAAGTGAACTGGGG-ATGAG-GTCCAAGACATCTGCGGTGGGGGGTT- 
CTCCAGACCTTAGTGTTCTTC--CACTACAAAGTGGGTCCAACAGAGAAAGG------------ 
TCTGTG----------------TTCACCAGGTGG---CCCTGACCC--- 
TGGGAGAGTCCAGGGCAGGGTGCAGCTGCATTCATGCTGCTGGG----GAACATGC- 
CCTCAGGTTACTCACCCCATGGA----CATGTTGGCC-CCAGGGACTGAAAA-GCTTAG---- 
GAAATGGTATTGAGAAATCTGGGGCAGC-CCCAAAAGGG-GAGAGG--CCATGGGGAGAAGGGG-- 
GGGCTGAG----TGGGGGAAAGGCAGGAGCCAG--ATAAAA----AGCCAGCTCCAGCAGGCGCTGCTCA 
\tATTTAGCAAGACCTTGGGGGTAGGGAGAACCAGCCATCCAGAAGTG--CTGGGTTACTGG- 
GACCCAGCTAAGTGTGGGAGGAGGTCACTCTAGACTTCAATGGTCTCTGGTGTAACCAAGTA---- 
CAACAGGGACCAG------------CCCAGG----------------TTCAGCATCTGG--- 
CCTTGACCC---CAAGAAAAGCCTGAGCCAAG-- 
CAGGTACTTTCAAGCTCCAGGGTAATGGAAATGTGCCTAGGGTTACTCACCCCA-AGG---- 
CTTGTTGCCC-CAGGTTTGTGAAAAAGCTTAG----GAAACTATGTTGCGAAATTTTGGGCAGT- 
CCCTGGTG--------------CAGGAACAGGGAG--GGACCAGA------GAGGA------- 
GAGCCAT--ATAAAG----AGCCAGCGGCTACAGCCCCAGCTCG 
\t---------------------------------------------------------------------- 
--------------------------------------------------------- 
CCACGGGGAAAGG------------T----------------------TCACCAGCTGG--- 
CCTTGACCC---TGAGGGAGGCCATGGCAAGGGGAAGGTGTGTTCATGTTGCAGGA----GGACATGC- 
CCTTGGGTTAGTTACCCCC--GA----CACACTGGCC-CCGGGGATTGAAAA-ACTTAG---- 
GAAATGGTATTGAGTAATCTGGGGCAGC-TGCAGGGAGG-GGGAGG-- 
CTACAGGAGCTGTGGGCTGGGCTGAA---GGTGGGGGGAGGCTGGGGCCAG--ATAAAA---- 
GGCAATCCCCAACAGCCTCTGCTCA"

[4] "NM_000066 
\tAGCTGTTAGGTTGGTGCAAAAGTAATTGTGGTTTTTGCCATTAAAAGCAATGACAA-------------- 
--AAACTG------------- 
CAATTACTTTTGCACCAACCTAGTCAGTGGCAGAGAATGTACTTGAACCCAGGCTGTCTAGACCTAGATCCC 
ACAGTCCTTGCCACCTCA--CTAATAGCCTGTCCAC---TTGGCAGCTTACCCTAAAGTTA----- 
CAGAGGAATAAACACCATGCTGCTACA- 
GATTTTTCATTAT----------------------------------- 
TCTGGTTGGTTTCCAGAGTGACAGG---TAAGTTT-TTGGTC-TGTGCAAAGTCTG----- 
TTTCCAGTCACTAGTGGCTTTCTGTTTACTTTGCAGAGCTATTTGCTCT-TGGGGACAGAAGCTGACAGT 
\t---------------------------------------------------------------------- 
------------------------------------------------------------------------ 
-------------------------------------------------------------- 
GGCTGCTT-CCATGGAATCA--------------------------------- 
CAGTTCTCACTGT-----------------------------------CCTAG--- 
GTGTGCGGTATCACAAG---TGAGTACATTCGTGCTGTGCAAAGCTGA---- 
GGTTCCAGGTACAAGCG----CCTGTTTGCTTTGCTGACCTGTTTGCTCTATGTCAACAGAA- 
CTGAGAGC 
\t---------------------------------------------------------------------- 
------------------------------------------- 
GCAAGTGGCAGAGAAAGGATTTGAACCCAGGCAGTCTGGACCTCGAGCC-------------- 
CCTCATCCTAACAGCTTGTCCTT---TTGGCTGCCT--------CTTT----- 
CTTGTGTAGAA------------------- 
CTTTCCATTGT----------------------------------- 
TCTCCCTGGTGTCCAGAGTCATAGG---TAAGT-T-TCTGTC- 
TGTACAAAGTCTAAGGGGTTTCCGGTCACTGTTGATTTTTTGTTTACTTTGCTGACCTGTTTGCTCTATGGG 
GACAGAAGCTGACAGC"





# Now, if I try to use sockets with a POST request,  I get some of  
the correct data, but some of it is incorrect or improperly decoded:

host<-"genomics11.bu.edu"
path<-"/cgi-bin/Tractor_dev/external/get_msa.cgi"
dat<-"user_id=0&table=seqs_ucsc_hg18&len=350&gene_set_ids=NM_000029,NM_0 
00064,NM_000066&orgs=Hs,mm8,canFam2"

len <- length( strsplit(dat,"")[[1]])
request<-paste("POST ",path," HTTP/1.1\nHost: ",host,"\nReferer:  
\nContent-type: application/x-www-form-urlencoded\nContent-length:  
",len,"\nConnection: Keep-Alive\n\n",dat,sep="")
fp <- socketConnection(host=host,port=80,server=FALSE,blocking=TRUE)
write(request,fp)
socketSelect(list(fp)) # Wait until results are ready
sock<-readLines(fp)
close(fp)


# Returns:

 > sock
[1] "HTTP/1.1 200 OK"

[2] "Date: Thu, 20 Jul 2006 14:27:37 GMT"

[3] "Server: Apache/2.0.53 (Fedora)"

[4] "Connection: close"

[5] "Transfer-Encoding: chunked"

[6] "Content-Type: text/plain; charset=ISO-8859-1"

[7] ""

[8] "fd0"

[9] "NA\tHs\tmm8\tcanFam2"

[10] "NM_000029\tTAAGCA--AGACTC-TCCCCTGCCCTCTGCCCTCTGCACCTCCGG--- 
CCTGCATGTC----------CCTGTGGCCTCTTGGGGGTACATCTCCCGGGG--- 
CTGGGTCAGAAG---------GCCTGGGTGGTTGGCCTCAGG------------------------ 
CTGTCACACACCTAGGGAGATGCTC------------------ 
CCGTTTCTGGGAACCTTGGCCCCGACTCCTGCA---- 
AACTTCGGTAAATGTGTAACTCGACCCTGCACCGGCTC---------------- 
ACTCTGTTCAGCA----GTGAAACTCTGCATCGATCACTAAGACTTCCTGG- 
AAGAGGTCCCAGCGT----GAGTGTCGCT--- 
TCTGGCATCTGTCCTTCTGG---------------------CCAGCCTGTGGTC-------------- 
TGG-CCAAGTGATGTAACCCTCCTCT---CCAGCCT\tTGCAAGTGAGCCCC- 
CTTCCTG-----------------------------GCATGCC----------CAGAGAGGCTTACG-- 
AGTGCATCACGAGGGGG-CTTTCATCCCAAG--------- 
GTCTGCATGGCTGGCTTCAGG------------------------TTGTCACAACCC----- 
ACTCAATC------------------CTGTGACTG-------TGGTCCTGGCTCCAGGG---- 
AACTGGGGTAAATGTGTAACCCAAGGCCAGCC---------------------- 
TATTTTTGCATGA----GGCT-------CATCTGCCAGTAGGGCTTCCTGG-AAGGGG- 
CCCAGAG-----GAACATCAC----CCTGGCCCTGATCCATCTTGGT------------------- 
CAAGCCTGGATTCTCA-----------TGG-TTCCCTGATCTGGGTCCTCCC----CCAGCCT 
\tCCGG----GGCTCC-TTCCCTG--------------CGCCCTGGGGCCTCAGCACATT---------- 
CTTGGGGACTCTCAGAAGCACACCTCGAGAGG--GCTCTGTCAGAAG---------GCTTG- 
GTGGCTGGCCTCGGC------------------------ 
TTGTCACAGCTCAGGGCAGAGACGCGACACACACACCTACACACAGGTACGGGGCGCTCCGGACCCGGCCCG 
GGCAGGGGAGCTGCGGTCAATGTGTAACTCGGCGGCCCAGCGGCTC---------------- 
GTTCTGCTCAGCA----CAGAAAGTGTGCATCGATCTCCCTGACTTCCTGG- 
AAGGCGTCCCAGCCT----GAGAGTAGCT----CTGGCGCCTGTACCCCCCACC------ 
CCCGTGGGGCCCCCACCCCCATGGTC--------------GGG- 
CCAAGTGATGTCACCTCCCGCCTCCCCAGCCT"

[11] "NM_000064\tC------------------------------------- 
CAAAAGTGAACTGGGG-ATGAG-GTCCAAGACATCTGCGGTGGGGGGTT- 
CTCCAGACCTTAGTGTTCTTC--CACTACAAAGTGGGTCCAACAGAGAAAGG------------ 
TCTGTG----------------TTCACCAGGTGG---CCCTGACCC--- 
TGGGAGAGTCCAGGGCAGGGTGCAGCTGCATTCATGCTGCTGGG----GAACATGC- 
CCTCAGGTTACTCACCCCATGGA----CATGTTGGCC-CCAGGGACTGAAAA-GCTTAG---- 
GAAATGGTATTGAGAAATCTGGGGCAGC-CCCAAAAGGG-GAGAGG--CCATGGGGAGAAGGGG-- 
GGGCTGAG----TGGGGGAAAGGCAGGAGCCAG--ATAAAA----AGCCAGCTCCAGCAGGCGCTGCTCA 
\tATTTAGCAAGACCTTGGGGGTAGGGAGAACCAGCCATCCAGAAGTG--CTGGGTTACTGG- 
GACCCAGCTAAGTGTGGGAGGAGGTCACTCTAGACTTCAATGGTCTCTGGTGTAACCAAGTA---- 
CAACAGGGACCAG------------CCCAGG----------------TTCAGCATCTGG--- 
CCTTGACCC---CAAGAAAAGCCTGAGCCAAG-- 
CAGGTACTTTCAAGCTCCAGGGTAATGGAAATGTGCCTAGGGTTACTCACCCCA-AGG---- 
CTTGTTGCCC-CAGGTTTGTGAAAAAGCTTAG----GAAACTATGTTGCGAAATTTTGGGCAGT- 
CCCTGGTG--------------CAGGAACAGGGAG--GGACCAGA------GAGGA------- 
GAGCCAT--ATAAAG----AGCCAGCGGCTACAGCCCCAGCTCG 
\t---------------------------------------------------------------------- 
--------------------------------------------------------- 
CCACGGGGAAAGG------------T----------------------TCACCAGCTGG--- 
CCTTGACCC---TGAGGGAGGCCATGGCAAGGGGAAGGTGTGTTCATGTTGCAGGA----GGACATGC- 
CCTTGGGTTAGTTACCCCC--GA----CACACTGGCC-CCGGGGATTGAAAA-ACTTAG---- 
GAAATGGTATTGAGTAATCTGGGGCAGC-TGCAGGGAGG-GGGAGG-- 
CTACAGGAGCTGTGGGCTGGGCTGAA---GGTGGGGGGAGGCTGGGGCCAG--ATAAAA---- 
GGCAATCCCCAACAGCCTCTGCTCA"

[12] "NM_000066 
\tAGCTGTTAGGTTGGTGCAAAAGTAATTGTGGTTTTTGCCATTAAAAGCAATGACAA-------------- 
--AAACTG------------- 
CAATTACTTTTGCACCAACCTAGTCAGTGGCAGAGAATGTACTTGAACCCAGGCTGTCTAGACCTAGATCCC 
ACAGTCCTTGCCACCTCA--CTAATAGCCTGTCCAC---TTGGCAGCTTACCCTAAAGTTA----- 
CAGAGGAATAAACACCATGCTGCTACA- 
GATTTTTCATTAT----------------------------------- 
TCTGGTTGGTTTCCAGAGTGACAGG---TAAGTTT-TTGGTC-TGTGCAAAGTCTG----- 
TTTCCAGTCACTAGTGGCTTTCTGTTTACTTTGCAGAGCTATTTGCTCT-TGGGGACAGAAGCTGACAGT 
\t---------------------------------------------------------------------- 
------------------------------------------------------------------------ 
-------------------------------------------------------------- 
GGCTGCTT-CCATGGAATCA--------------------------------- 
CAGTTCTCACTGT-----------------------------------CCTAG--- 
GTGTGCGGTATCACAAG---TGAGTACATTCGTGCTGTGCAAAGCTGA---- 
GGTTCCAGGTACAAGCG----CCTGTTTGCTTTGCTGACCTGTTTGCTCTATGTCAACAGAA- 
CTGAGAGC 
\t---------------------------------------------------------------------- 
------------------------------------------- 
GCAAGTGGCAGAGAAAGGATTTGAACCCAGGCAGTCTGGACCTCGAGCC-------------- 
CCTCATCCTAACAGCTTGTCCTT---TTGGCTGCCT--------CTTT----- 
CTTGTGTAGAA-------------------CTTTCCATTGT------"

[13] "a1"

[14] "-----------------------------TCTCCCTGGTGTCCAGAGTCATAGG---TAAGT- 
T-TCTGTC- 
TGTACAAAGTCTAAGGGGTTTCCGGTCACTGTTGATTTTTTGTTTACTTTGCTGACCTGTTTGCTCTATGGG 
GACAGAAGCTGACAGC"

[15] ""

[16] "0"

[17] ""




Element 13 appears to be improperly decoded hexadecimal data.  Can  
anyone shed some light on why this is?  Are the strings too long for  
the readLines command to properly read from the socket?  Thanks for  
any additional help anyone can provide.


--
Mike




On Jul 20, 2006, at 9:49 AM, Duncan Temple Lang wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> There is a hard coded limit of 4096 characters in
> RxmlNanoHTTPScanURL and other ScanURL routines in nanohttp.c
> and nanoftp.c.   And your URI is 5138 and so walks past the bounds
> of the array of length 4096.
>
> I am not yet convinced that it is worthwhile to increase this limit to
> a larger number.  Using POST in this context really is a better
> solution.  But we do need to add checks to the code to ensure that
> the URI string is smaller than 4096.
>
> I'll try to get an opportunity to do that tomorrow before I take off.
>
>   D.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> - --
> Duncan Temple Lang                    duncan at wald.ucdavis.edu
> Department of Statistics              work:  (530) 752-4782
> 4210 Mathematical Sciences Building   fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis,
> CA 95616,
> USA
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.3 (Darwin)
>
> iD8DBQFEv4nO9p/Jzwa2QP4RAnPnAJ974RMxo/KXfxQjaRHoHB1ZsdIy+QCeNhXg
> EDk/WHaFUeH5C2v/607kovo=
> =FAGn
> -----END PGP SIGNATURE-----


From ripley at stats.ox.ac.uk  Thu Jul 20 18:16:25 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Jul 2006 17:16:25 +0100 (BST)
Subject: [Rd] [R] Continuation and parse
In-Reply-To: <6phlkqw3i8b.fsf@gopher1.fhcrc.org>
References: <44A32C5B.3030409@bitwrit.com.au> <44A282F7.8070901@sciviews.org>
	<6phlkqw3i8b.fsf@gopher1.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0607201615150.32007@gannet.stats.ox.ac.uk>

The issue here is that the current expression is still there and 
protected if there is a parse problem.  So you need one more unprotect.

This does not give a problem in source() (the only internal use) as it 
throws an error in those cases.  (It also uses a different branch of the 
code with n < 0.)

Since this seems to be worrying no one else, I am going to add the 
unprotect in the source code for R-devel.

On Thu, 13 Jul 2006, Martin Morgan wrote:

> [this is from R-help, at the end of June]
> 
> Jim Lemon asked about parsing syntactically incorrect versus
> incomplete lines, generating a couple of responses.
> 
> Philippe's suggestion isn't robust (e.g., "\nls)". Prof. Ripley's
> comment lead me to R_ParseVector (the only exposed parse
> routine). Unfortunately, this returns from parsing incomplete or
> syntactically incorrect text with a PROTECT stack imbalance, so there
> is no natural way to return from a .Call.
> 
> What I'd like is to have access to multiline console input after
> parsing but before evaluation, or to return from a .Call like that
> below with either the parsed expression or information about the
> reason for failure. Any suggestions?
> 
> Thanks in advance,
> 
> Martin
> 
> SEXP parses(SEXP cmd) {
>   ParseStatus status;
>   SEXP res;
>   res = R_ParseVector(cmd, 1, &status);
>   return res;
> }
> 
> /* > .Call("parses", "ls(") */
> /* 25        SEXP res = R_ParseVector(cmd, 1, &status); */
> /* (gdb) p R_PPStackTop */
> /* $1 = 3 */
> /* (gdb) next */
> /* 26        return res; */
> /* (gdb) p R_PPStackTop */
> /* $2 = 5 */
> 
> R version 2.4.0 Under development (unstable) (2006-07-11 r38560)
> x86_64-unknown-linux-gnu
> 
> Philippe Grosjean <phgrosjean at sciviews.org> writes:
> 
> > Well, you haven't used the search engines with the right key: the magic 
> > words are:
> >
> >  > RSiteSearch("incomplete line")
> >
> > With the first document being my query (almost two years ago), and the 
> > second one being Peter Dalgaard answer. You must adapt it to cope with 
> > internationalization, but basically, you could use something like:
> >
> >  > grep("\n2:",try(parse(textConnection("ls)")), silent = TRUE))
> > numeric(0)
> >  > grep("\n2:",try(parse(textConnection("ls(")), silent = TRUE))
> > [1] 1
> 
> From: Prof Brian Ripley <ripley>
> Date: Wed, 28 Jun 2006 13:44:49 +0100 (BST)
> 
> On Wed, 28 Jun 2006, Jim Lemon wrote:
> 
> > Hi gurus,
> >
> > After an unsuccessful scrabble through the documentation and Jon's
> > excellent search facility, I am no wiser as to how R recognizes an
> > incomplete command line and politely raises its hand for more. The help
> > page for parse gives no indication that it does anything more than spit
> > the dummy when fed an incomplete command line, but something in there
> > must recognize such ellipsis. Any hints?
> 
> It's internal. Look in src/main/main.c, in particular the R_Repl*
> functions. In short, R_Parse1Buffer can return PARSE_INCOMPLETE.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From asr at ufl.edu  Thu Jul 20 21:47:40 2006
From: asr at ufl.edu (Allen S. Rout)
Date: 20 Jul 2006 15:47:40 -0400
Subject: [Rd] DESCRIPTION and PACKAGES files.
Message-ID: <86lkqoys6b.fsf@ufl.edu>


Greetings; I'm working on translating the heirarchy of R packages into
the Gentoo Ebuild environment, currently working from a 2.3.1 install.

There are several data which it would be nice to see provided
alongside the existing output of available.packages; at the moment I
think I'm going to have to get License and SystemRequirements out of
individual package DESCRIPTIONs.

More generally, it'd be nice to see all the documented fields from
DESCRIPTION files in the output from available.packages(), or at least
collated in PACKAGES.

I have a suggestion to accomplish this which I've hacked up locally
and am happy to build a patch if the suggestion is well-recieved.

available.packages uses read.dcf on the PACKAGES file, accepting only 

flds <- c("Package", "Version", "Priority", "Bundle", "Depends",
  "Imports", "Suggests", "Contains")


If we could optionally accept all of the fields which are mentioned in
'Creating R Extensions', someone who was interested in the broader
data could get at it.

PACKAGES would grow, substantially, but wouldn't be harder to
maintain; in fact PACKAGES could be just a naive concatenation of
everyone's DESCRIPTION files.


For that matter, if you would be willing to add the extra data to
PACKAGES, the current implementation would work, and I could just run
my hacked version and get at what I wanted.  But I know of at least
one other package-heirarchy maintainer who might like this, and
subsuming it in the base function would be nice.



- Allen S. Rout


From smckinney at bccrc.ca  Thu Jul 20 21:49:14 2006
From: smckinney at bccrc.ca (Steven McKinney)
Date: Thu, 20 Jul 2006 12:49:14 -0700
Subject: [Rd] How do I modify an exported function in a locked environment?
Message-ID: <0BE438149FF2254DB4199E2682C8DFEB01D554A2@crcmail1.BCCRC.CA>



Running R.app on Mac OS X 10.4

> version
               _                         
platform       powerpc-apple-darwin8.6.0 
arch           powerpc                   
os             darwin8.6.0               
system         powerpc, darwin8.6.0      
status                                   
major          2                         
minor          3.1                       
year           2006                      
month          06                        
day            01                        
svn rev        38247                     
language       R                         
version.string Version 2.3.1 (2006-06-01)
> 


I am trying to learn how to modify functions
in a locked environment.

For an example, suppose I'm using the package "zoo".

zoo contains function "rollmean.default"

> rollmean.default
function (x, k, na.pad = FALSE, align = c("center", "left", "right"), 
    ...) 
{
    x <- unclass(x)
    n <- length(x)
    y <- x[k:n] - x[c(1, 1:(n - k))]
    y[1] <- sum(x[1:k])
    rval <- cumsum(y)/k
    if (na.pad) {
        rval <- switch(match.arg(align), left = {
            c(rval, rep(NA, k - 1))
        }, center = {
            c(rep(NA, floor((k - 1)/2)), rval, rep(NA, ceiling((k - 
                1)/2)))
        }, right = {
            c(rep(NA, k - 1), rval)
        })
    }
    return(rval)
}
<environment: namespace:zoo>

Suppose for whatever reason I want output to be
in percent, so I'd like to modify the result to be
rval <- 100 * cumsum(y)/k

I cannot just copy the function and change it, as the namespace
mechanism ensures the rollmean.default in 'zoo' continues to be used.

If I use
fixInNamespace("rollmean.default", ns = "zoo")
I can edit the rval <- cumsum(y)/k line to read
rval <- 100 * cumsum(y)/k
save the file and exit the R.app GUI editor.

But this does not update the exported copy of the
function (the documentation for fixInNamespace says
this is the case) - how do I accomplish this last step?

If I list the function after editing, I see the original
copy.  But if I reinvoke the editor via fixInNamespace(),
I do see my modification.
Where is my copy residing?  How do I push it out
to replace the exported copy?

Is this the proper way to modify a package function?
Are there other ways?  I've searched webpages, R news,
help files and have been unable to find out how to
get this process fully completed.

Any guidance appreciated.


Steven McKinney

Statistician
Molecular Oncology and Breast Cancer Program
British Columbia Cancer Research Centre

email: smckinney at bccrc.ca

tel: 604-675-8000 x7561

BCCRC
Molecular Oncology
675 West 10th Ave, Floor 4
Vancouver B.C. 
V5Z 1L3
Canada


From ripley at stats.ox.ac.uk  Thu Jul 20 22:33:48 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Jul 2006 21:33:48 +0100 (BST)
Subject: [Rd] DESCRIPTION and PACKAGES files.
In-Reply-To: <86lkqoys6b.fsf@ufl.edu>
References: <86lkqoys6b.fsf@ufl.edu>
Message-ID: <Pine.LNX.4.64.0607202128260.32650@gannet.stats.ox.ac.uk>

On Thu, 20 Jul 2006, Allen S. Rout wrote:

> 
> Greetings; I'm working on translating the heirarchy of R packages into
> the Gentoo Ebuild environment, currently working from a 2.3.1 install.
> 
> There are several data which it would be nice to see provided
> alongside the existing output of available.packages; at the moment I
> think I'm going to have to get License and SystemRequirements out of
> individual package DESCRIPTIONs.
> 
> More generally, it'd be nice to see all the documented fields from
> DESCRIPTION files in the output from available.packages(), or at least
> collated in PACKAGES.
> 
> I have a suggestion to accomplish this which I've hacked up locally
> and am happy to build a patch if the suggestion is well-recieved.
> 
> available.packages uses read.dcf on the PACKAGES file, accepting only 
> 
> flds <- c("Package", "Version", "Priority", "Bundle", "Depends",
>   "Imports", "Suggests", "Contains")
> 
> 
> If we could optionally accept all of the fields which are mentioned in
> 'Creating R Extensions', someone who was interested in the broader
> data could get at it.
> 
> PACKAGES would grow, substantially, but wouldn't be harder to
> maintain; in fact PACKAGES could be just a naive concatenation of
> everyone's DESCRIPTION files.

And that is the reason: everyone who downloads pays the price for unneeded 
fields in that file.  It was a deliberate decision to minimize download 
times, which are already substantial for people on a dialup connection.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From asr at ufl.edu  Thu Jul 20 22:45:04 2006
From: asr at ufl.edu (Allen S. Rout)
Date: 20 Jul 2006 16:45:04 -0400
Subject: [Rd] DESCRIPTION and PACKAGES files.
References: <86lkqoys6b.fsf@ufl.edu>
	<Pine.LNX.4.64.0607202128260.32650@gannet.stats.ox.ac.uk>
Message-ID: <86d5c0ypin.fsf@ufl.edu>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> And that is the reason: everyone who downloads pays the price for unneeded 
> fields in that file.  It was a deliberate decision to minimize download 
> times, which are already substantial for people on a dialup connection.

OK, that meets the definition of "not well recieved" ;) 

Thanks for your time. 



- Allen S. Rout


From ripley at stats.ox.ac.uk  Thu Jul 20 22:46:58 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Jul 2006 21:46:58 +0100 (BST)
Subject: [Rd] How do I modify an exported function in a locked
	environment?
In-Reply-To: <0BE438149FF2254DB4199E2682C8DFEB01D554A2@crcmail1.BCCRC.CA>
References: <0BE438149FF2254DB4199E2682C8DFEB01D554A2@crcmail1.BCCRC.CA>
Message-ID: <Pine.LNX.4.64.0607202134590.32650@gannet.stats.ox.ac.uk>

Please do not post to multiple lists: I have removed R-help.

On Thu, 20 Jul 2006, Steven McKinney wrote:

> Running R.app on Mac OS X 10.4
> 
> I am trying to learn how to modify functions
> in a locked environment.

This is deliberately hard.

> For an example, suppose I'm using the package "zoo".
> 
> zoo contains function "rollmean.default"
> 
> > rollmean.default
> function (x, k, na.pad = FALSE, align = c("center", "left", "right"), 
>     ...) 
> {
>     x <- unclass(x)
>     n <- length(x)
>     y <- x[k:n] - x[c(1, 1:(n - k))]
>     y[1] <- sum(x[1:k])
>     rval <- cumsum(y)/k
>     if (na.pad) {
>         rval <- switch(match.arg(align), left = {
>             c(rval, rep(NA, k - 1))
>         }, center = {
>             c(rep(NA, floor((k - 1)/2)), rval, rep(NA, ceiling((k - 
>                 1)/2)))
>         }, right = {
>             c(rep(NA, k - 1), rval)
>         })
>     }
>     return(rval)
> }
> <environment: namespace:zoo>
> 
> Suppose for whatever reason I want output to be
> in percent, so I'd like to modify the result to be
> rval <- 100 * cumsum(y)/k
> 
> I cannot just copy the function and change it, as the namespace
> mechanism ensures the rollmean.default in 'zoo' continues to be used.
> 
> If I use
> fixInNamespace("rollmean.default", ns = "zoo")
> I can edit the rval <- cumsum(y)/k line to read
> rval <- 100 * cumsum(y)/k
> save the file and exit the R.app GUI editor.
> 
> But this does not update the exported copy of the
> function (the documentation for fixInNamespace says
> this is the case) - how do I accomplish this last step?

You need to unlock the binding, then assign in package:zoo.
Something like

unlockBinding("rollmean.default", as.environment("package:zoo"))
assign("rollmean.default", zoo:::rollmean.default, pos="package:zoo")

However, it is not usual to export methods, and that is why this case is 
particularly hard.

> If I list the function after editing, I see the original
> copy.  But if I reinvoke the editor via fixInNamespace(),
> I do see my modification.
> Where is my copy residing?  How do I push it out
> to replace the exported copy?
> 
> Is this the proper way to modify a package function?

Many would say it was not proper to `modify a package function'.

> Are there other ways?  I've searched webpages, R news,
> help files and have been unable to find out how to
> get this process fully completed.

> Any guidance appreciated.

You may not like the guidance ....

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Thu Jul 20 23:21:03 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 20 Jul 2006 17:21:03 -0400
Subject: [Rd] How do I modify an exported function in a locked
	environment?
In-Reply-To: <0BE438149FF2254DB4199E2682C8DFEB01D554A2@crcmail1.BCCRC.CA>
References: <0BE438149FF2254DB4199E2682C8DFEB01D554A2@crcmail1.BCCRC.CA>
Message-ID: <971536df0607201421x5f510c9bn167a2842be1ef019@mail.gmail.com>

As others have mentioned its not really a good idea
to modify the namespace of a package and writing
a wrapper as Duncan suggested is much preferable.

An intermediate approach that
is not as good as the wrapper but better than modifying
the namespace is to copy the objects of interest
to your workspace, change their environments
appropriately and then modify their functionality:

library(zoo)

# copy objects of interest and set their environment

rollmean <- zoo:::rollmean
environment(rollmean) <- .GlobalEnv

rollmean.zoo <- zoo:::rollmean.zoo
environment(rollmean.zoo) <- .GlobalEnv

rollmean.default <- zoo:::rollmean.default
environment(rollmean.default) <- .GlobalEnv

# modify functionality

rollmean.default0 <- rollmean.default
rollmean.default <- function(x, ...) 100 * rollmean.default0(x, ...)

# test

rollmean(1:5, 3) # 100* used
rollmean(zoo(1:5), 3)  # 100* used


On 7/20/06, Steven McKinney <smckinney at bccrc.ca> wrote:
>
>
> Running R.app on Mac OS X 10.4
>
> > version
>               _
> platform       powerpc-apple-darwin8.6.0
> arch           powerpc
> os             darwin8.6.0
> system         powerpc, darwin8.6.0
> status
> major          2
> minor          3.1
> year           2006
> month          06
> day            01
> svn rev        38247
> language       R
> version.string Version 2.3.1 (2006-06-01)
> >
>
>
> I am trying to learn how to modify functions
> in a locked environment.
>
> For an example, suppose I'm using the package "zoo".
>
> zoo contains function "rollmean.default"
>
> > rollmean.default
> function (x, k, na.pad = FALSE, align = c("center", "left", "right"),
>    ...)
> {
>    x <- unclass(x)
>    n <- length(x)
>    y <- x[k:n] - x[c(1, 1:(n - k))]
>    y[1] <- sum(x[1:k])
>    rval <- cumsum(y)/k
>    if (na.pad) {
>        rval <- switch(match.arg(align), left = {
>            c(rval, rep(NA, k - 1))
>        }, center = {
>            c(rep(NA, floor((k - 1)/2)), rval, rep(NA, ceiling((k -
>                1)/2)))
>        }, right = {
>            c(rep(NA, k - 1), rval)
>        })
>    }
>    return(rval)
> }
> <environment: namespace:zoo>
>
> Suppose for whatever reason I want output to be
> in percent, so I'd like to modify the result to be
> rval <- 100 * cumsum(y)/k
>
> I cannot just copy the function and change it, as the namespace
> mechanism ensures the rollmean.default in 'zoo' continues to be used.
>
> If I use
> fixInNamespace("rollmean.default", ns = "zoo")
> I can edit the rval <- cumsum(y)/k line to read
> rval <- 100 * cumsum(y)/k
> save the file and exit the R.app GUI editor.
>
> But this does not update the exported copy of the
> function (the documentation for fixInNamespace says
> this is the case) - how do I accomplish this last step?
>
> If I list the function after editing, I see the original
> copy.  But if I reinvoke the editor via fixInNamespace(),
> I do see my modification.
> Where is my copy residing?  How do I push it out
> to replace the exported copy?
>
> Is this the proper way to modify a package function?
> Are there other ways?  I've searched webpages, R news,
> help files and have been unable to find out how to
> get this process fully completed.
>
> Any guidance appreciated.
>
>
> Steven McKinney
>
> Statistician
> Molecular Oncology and Breast Cancer Program
> British Columbia Cancer Research Centre
>
> email: smckinney at bccrc.ca
>
> tel: 604-675-8000 x7561
>
> BCCRC
> Molecular Oncology
> 675 West 10th Ave, Floor 4
> Vancouver B.C.
> V5Z 1L3
> Canada
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From sfalcon at fhcrc.org  Fri Jul 21 03:21:55 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 20 Jul 2006 18:21:55 -0700
Subject: [Rd] DESCRIPTION and PACKAGES files.
In-Reply-To: <86d5c0ypin.fsf@ufl.edu> (Allen S. Rout's message of "20 Jul 2006
	16:45:04 -0400")
References: <86lkqoys6b.fsf@ufl.edu>
	<Pine.LNX.4.64.0607202128260.32650@gannet.stats.ox.ac.uk>
	<86d5c0ypin.fsf@ufl.edu>
Message-ID: <m264hrah1o.fsf@ziti.local>

asr at ufl.edu (Allen S. Rout) writes:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> And that is the reason: everyone who downloads pays the price for unneeded 
>> fields in that file.  It was a deliberate decision to minimize download 
>> times, which are already substantial for people on a dialup connection.
>
> OK, that meets the definition of "not well recieved" ;) 

For the Bioconductor project, we also wanted more information to be
programatically available regarding the packages in a repository.
Instead of bloating the PACKAGES file, we put a separate file, VIEWS
in our repository.  Here is an example:

http://bioconductor.org/packages/1.8/bioc/VIEWS

This file is used to generate the HTML pages that describe our
packages (happy to share the code for generating the VIEWS file if you
like).

So, if you were able to host a CRAN mirror, you could annotate it
similarly.

+ seth


From hb at stat.berkeley.edu  Fri Jul 21 03:55:25 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 20 Jul 2006 18:55:25 -0700
Subject: [Rd] png() and image()
Message-ID: <59d7961d0607201855x37b2fb3bw6d89939e1409287d@mail.gmail.com>

Hi,

I try to create PNG images of a certain size where each pixel
intensity corresponds to exactly one probe signal in an Affymetrix
array.  I try to use png() and image() with zero margins to do this.
Example:

z <- matrix(1:15, nrow=45, ncol=30)
png("large.png", height=nrow(z), width=ncol(z), bg="red")
par(mar=c(0,0,0,0))
image(z, col=gray.colors(16), axes=FALSE)
dev.off()

z <- matrix(1:15, nrow=5, ncol=3)
png("tiny.png", height=nrow(z), width=ncol(z), bg="red")
par(mar=c(0,0,0,0))
image(z, col=gray.colors(16), axes=FALSE)
dev.off()

The problem is that on WinXP the very bottom row and the very right
column of pixels in red.  Trying on Linux, it is only the very right
column that is red.  See attached images (you might have to zoom in to
see it).  I try to do this in R v2.3.1.  The same effect is seen if
the jpeg() device is used.

When rescaling, the same effect is seen (the red border effect is one
pixel wide), e.g.

z <- matrix(1:15, nrow=45, ncol=30)
png("large5.png", height=5*nrow(z), width=5*ncol(z), bg="red")
par(mar=c(0,0,0,0))
image(z, col=gray.colors(16), axes=FALSE)
dev.off()

I might be asking for something that is not supported, but is there a
way around this?  It is a problem, because I wish to tile the images
in an HTML page.

Thanks

Henrik
-------------- next part --------------
A non-text attachment was scrubbed...
Name: WinXP-large.png
Type: image/png
Size: 141 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060720/ca12637e/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: WinXP-tiny.png
Type: image/png
Size: 113 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060720/ca12637e/attachment-0001.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Linux-large.png
Type: image/png
Size: 148 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060720/ca12637e/attachment-0002.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Linux-tiny.png
Type: image/png
Size: 118 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060720/ca12637e/attachment-0003.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: WinXP-large5.png
Type: image/png
Size: 317 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060720/ca12637e/attachment-0004.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: WinXP-tiny5.png
Type: image/png
Size: 173 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060720/ca12637e/attachment-0005.png 

From huber at ebi.ac.uk  Fri Jul 21 09:20:34 2006
From: huber at ebi.ac.uk (Wolfgang Huber)
Date: Fri, 21 Jul 2006 08:20:34 +0100
Subject: [Rd] png() and image()
In-Reply-To: <59d7961d0607201855x37b2fb3bw6d89939e1409287d@mail.gmail.com>
References: <59d7961d0607201855x37b2fb3bw6d89939e1409287d@mail.gmail.com>
Message-ID: <44C08042.5070807@ebi.ac.uk>


Hi Henrik,
this does not directly answer your question, but you might be able to 
use the function write.image in the package EBImage (Bioconductor) to 
write matrices into image files (e.g. PNG or JPEG), this might be more 
flexible and also faster than what you're trying to do.
  Best wishes
  Wolfgang
------------------------------------------------------------------
Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber

Henrik Bengtsson wrote:
> Hi,
> 
> I try to create PNG images of a certain size where each pixel
> intensity corresponds to exactly one probe signal in an Affymetrix
> array.  I try to use png() and image() with zero margins to do this.
> Example:
> 
> z <- matrix(1:15, nrow=45, ncol=30)
> png("large.png", height=nrow(z), width=ncol(z), bg="red")
> par(mar=c(0,0,0,0))
> image(z, col=gray.colors(16), axes=FALSE)
> dev.off()
> 
> z <- matrix(1:15, nrow=5, ncol=3)
> png("tiny.png", height=nrow(z), width=ncol(z), bg="red")
> par(mar=c(0,0,0,0))
> image(z, col=gray.colors(16), axes=FALSE)
> dev.off()
> 
> The problem is that on WinXP the very bottom row and the very right
> column of pixels in red.  Trying on Linux, it is only the very right
> column that is red.  See attached images (you might have to zoom in to
> see it).  I try to do this in R v2.3.1.  The same effect is seen if
> the jpeg() device is used.
> 
> When rescaling, the same effect is seen (the red border effect is one
> pixel wide), e.g.
> 
> z <- matrix(1:15, nrow=45, ncol=30)
> png("large5.png", height=5*nrow(z), width=5*ncol(z), bg="red")
> par(mar=c(0,0,0,0))
> image(z, col=gray.colors(16), axes=FALSE)
> dev.off()
> 
> I might be asking for something that is not supported, but is there a
> way around this?  It is a problem, because I wish to tile the images
> in an HTML page.
> 
> Thanks
> 
> Henrik
>


From ripley at stats.ox.ac.uk  Fri Jul 21 11:00:54 2006
From: ripley at stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 21 Jul 2006 10:00:54 +0100 (GMT Daylight Time)
Subject: [Rd] [R] insert insertRow?
In-Reply-To: <44C08491.9090604@tiscali.nl>
References: <44C08491.9090604@tiscali.nl>
Message-ID: <Pine.WNT.4.64.0607210943150.1248@Petrel>

[Moved to R-devel, the appropriate list for discussing development of R.]

You can do what you ask for (but micEcon does not provide) more easily and 
efficiently by indexing, and learning the power of R's indexing seems an 
important part of mastering the tool.

BTW, as a data frame is thought of as like a table in a RDBMS, so very 
little you do with one depends on the ordering of rows and columns, both of 
which are normally accessed by name.

To insert a row after idx, use something like

NewDF <- OldDF[c(1:idx, idx, (idx+1):nrow(OldDF),]
NewDF[idx+1,] <-  value of new row (as a list)
row.mames(NewDF)[idx+1] <- new row name (length-1 character vector)

On Fri, 21 Jul 2006, Marjo en Edwin wrote:

> Dear all,
>
> In the search for a command to insert a row between other rows in a data
> frame I found that there seems to be no such command in the base R
> package. There is however a very simple function insertRow in the
> micEcon package, that makes use of rbind. I wondered if it would not be
> possible to include the following micEcon functions in the base package:
>
> insertRow
> insertCol

But insertRow is for a *matrix* and not for a *data frame*, and the former 
is a rather easier task.

> Since the functions are already there, I would gather this is not a very
> big effort. It would save people that just want to insert rows and
> columns easily to install another two packages (since micEcon needs
> systemfit) or defining the functions themselves.
>
> I hope my suggestion will be taken into consideration. Whether it will
> be adopted or not, I still think R is a fantastic statistical package
> that I love to use.

We are concerned about bloat, and also the maintenance load of adding 
convenience functions to R.  My view is that they are often just another 
thing for users to learn and possibly misunderstand, as seems to be the 
case here.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Fri Jul 21 18:35:14 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 21 Jul 2006 09:35:14 -0700
Subject: [Rd] png() and image()
In-Reply-To: <44C08042.5070807@ebi.ac.uk>
References: <59d7961d0607201855x37b2fb3bw6d89939e1409287d@mail.gmail.com>
	<44C08042.5070807@ebi.ac.uk>
Message-ID: <59d7961d0607210935i26eb297apf0e4e5981ebb4902@mail.gmail.com>

Hi Wolfgang,

thanks for this - I took a look the EBImage webpage
[http://www.ebi.ac.uk/~osklyar/projects/EBImage/] and it looks very
nice.  Are there any plans for Windows support too?  I am looking for
a cross-platform solution.

Cheers

Henrik

On 7/21/06, Wolfgang Huber <huber at ebi.ac.uk> wrote:
>
> Hi Henrik,
> this does not directly answer your question, but you might be able to
> use the function write.image in the package EBImage (Bioconductor) to
> write matrices into image files (e.g. PNG or JPEG), this might be more
> flexible and also faster than what you're trying to do.
>   Best wishes
>   Wolfgang
> ------------------------------------------------------------------
> Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber
>
> Henrik Bengtsson wrote:
> > Hi,
> >
> > I try to create PNG images of a certain size where each pixel
> > intensity corresponds to exactly one probe signal in an Affymetrix
> > array.  I try to use png() and image() with zero margins to do this.
> > Example:
> >
> > z <- matrix(1:15, nrow=45, ncol=30)
> > png("large.png", height=nrow(z), width=ncol(z), bg="red")
> > par(mar=c(0,0,0,0))
> > image(z, col=gray.colors(16), axes=FALSE)
> > dev.off()
> >
> > z <- matrix(1:15, nrow=5, ncol=3)
> > png("tiny.png", height=nrow(z), width=ncol(z), bg="red")
> > par(mar=c(0,0,0,0))
> > image(z, col=gray.colors(16), axes=FALSE)
> > dev.off()
> >
> > The problem is that on WinXP the very bottom row and the very right
> > column of pixels in red.  Trying on Linux, it is only the very right
> > column that is red.  See attached images (you might have to zoom in to
> > see it).  I try to do this in R v2.3.1.  The same effect is seen if
> > the jpeg() device is used.
> >
> > When rescaling, the same effect is seen (the red border effect is one
> > pixel wide), e.g.
> >
> > z <- matrix(1:15, nrow=45, ncol=30)
> > png("large5.png", height=5*nrow(z), width=5*ncol(z), bg="red")
> > par(mar=c(0,0,0,0))
> > image(z, col=gray.colors(16), axes=FALSE)
> > dev.off()
> >
> > I might be asking for something that is not supported, but is there a
> > way around this?  It is a problem, because I wish to tile the images
> > in an HTML page.
> >
> > Thanks
> >
> > Henrik
> >
>


From hin-tak.leung at cimr.cam.ac.uk  Fri Jul 21 18:45:40 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 21 Jul 2006 17:45:40 +0100
Subject: [Rd] png() and image()
In-Reply-To: <59d7961d0607201855x37b2fb3bw6d89939e1409287d@mail.gmail.com>
References: <59d7961d0607201855x37b2fb3bw6d89939e1409287d@mail.gmail.com>
Message-ID: <44C104B4.50105@cimr.cam.ac.uk>

By changing
   png("large.png", height=nrow(z), width=ncol(z), bg="red")
to
   png("large.png", height=nrow(z), width=ncol(z), bg="blue")
I can get the right column (on linux) to change to blue.

So it seems to be an alignment off-by-one error with the background
colour showing through, so you might be able to work around it
by changing the alignment of the margins.

Incidentally I am working on the AffyMetrix 500k chip as well
(http://www.wtccc.org.uk/) but I have already written a non-R C/C++
tool to dump all the probe signal of a whole array as an image
(not intended for html, obviously, for 6.5 million probes); and
another one for drawing the schematics of the locations of
probes associated with a specific snp as a postscript vector diagram.
I will probably be working on combining the two - i.e. overlaying
an image with a vector diagram next week. (which means I hope to get
an image of intensities with some cicles on top, highlighting the
effect on the intensities to a specific snp due to blemishes).

Hin-Tak Leung

Henrik Bengtsson wrote:
> Hi,
> 
> I try to create PNG images of a certain size where each pixel
> intensity corresponds to exactly one probe signal in an Affymetrix
> array.  I try to use png() and image() with zero margins to do this.
> Example:
> 
> z <- matrix(1:15, nrow=45, ncol=30)
> png("large.png", height=nrow(z), width=ncol(z), bg="red")
> par(mar=c(0,0,0,0))
> image(z, col=gray.colors(16), axes=FALSE)
> dev.off()
> 
> z <- matrix(1:15, nrow=5, ncol=3)
> png("tiny.png", height=nrow(z), width=ncol(z), bg="red")
> par(mar=c(0,0,0,0))
> image(z, col=gray.colors(16), axes=FALSE)
> dev.off()
> 
> The problem is that on WinXP the very bottom row and the very right
> column of pixels in red.  Trying on Linux, it is only the very right
> column that is red.  See attached images (you might have to zoom in to
> see it).  I try to do this in R v2.3.1.  The same effect is seen if
> the jpeg() device is used.
> 
> When rescaling, the same effect is seen (the red border effect is one
> pixel wide), e.g.
> 
> z <- matrix(1:15, nrow=45, ncol=30)
> png("large5.png", height=5*nrow(z), width=5*ncol(z), bg="red")
> par(mar=c(0,0,0,0))
> image(z, col=gray.colors(16), axes=FALSE)
> dev.off()
> 
> I might be asking for something that is not supported, but is there a
> way around this?  It is a problem, because I wish to tile the images
> in an HTML page.
> 
> Thanks
> 
> Henrik
> 
> ------------------------------------------------------------------------
> 
> 
> ------------------------------------------------------------------------
> 
> 
> ------------------------------------------------------------------------
> 
> 
> ------------------------------------------------------------------------
> 
> 
> ------------------------------------------------------------------------
> 
> 
> ------------------------------------------------------------------------
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mschaff at bu.edu  Fri Jul 21 22:24:49 2006
From: mschaff at bu.edu (Mike Schaffer)
Date: Fri, 21 Jul 2006 16:24:49 -0400
Subject: [Rd] Problems Reading from Socket
Message-ID: <017A38B8-7167-4CCA-98DA-4411ADCB1396@bu.edu>

My followup question went unanswered in another thread, so I thought  
I'd start a new one and rephrase it.


I need to use CGI POST to retrieve data from a server, so thanks to  
Duncan's suggestion, I used the httpRequest package as example code  
for doing so.  BUT, I have another problem.  The data retrieved from  
the socket has occasional problems.  I include example code below to  
demonstrate the problem.  The problems occur in R v2.3.1 (2006-06-01)  
on both Linux and OS X.


For comparison, here is code that produces the correct output (I used  
paste on the URL to prevent word-wrapping from clobbering it):

full.url<-paste("http://genomics11.bu.edu/cgi-bin/",
"Tractor_dev/external/get_msa.cgi?user_id=0&",
"table=seqs_ucsc_hg18&len=350&gene_set_ids=",
"NM_000029,NM_000064,NM_000066&orgs=Hs,",
"mm8,canFam2",sep="")

readLines(full.url)




To reproduce the incorrect results, the socket-based code is:

host<-"genomics11.bu.edu"
path<-"/cgi-bin/Tractor_dev/external/get_msa.cgi"
dat<-paste("user_id=0&table=seqs_ucsc_hg18&len=350&",
"gene_set_ids=NM_000029,NM_000064,",
"NM_000066&orgs=Hs,mm8,canFam2",sep="")

len <- length( strsplit(dat,"")[[1]])

request<-paste("POST ",path," HTTP/1.1\nHost: ",host,
"\nReferer:\nContent-type: application/x-www-form-urlencoded\nContent- 
length: ",
len,"\nConnection: Keep-Alive\n\n",dat,sep="")

fp <- socketConnection(host=host,port=80,server=FALSE,blocking=TRUE)
write(request,fp)
socketSelect(list(fp)) # Wait until results are ready
readLines(fp)
close(fp)



So my question is why do I get lines that are split up by hexadecimal  
characters (e.g. element 13 -- 'a1'-- splits what should be one line:  
lines 12 + 14)?  Am I misunderstanding what is needed to correctly  
read from a socket or is this a bug?  Can anyone offer assistance?

Thanks.

--
Mike


From hb at stat.berkeley.edu  Sun Jul 23 02:44:49 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sat, 22 Jul 2006 17:44:49 -0700
Subject: [Rd] file.copy() of non-existing file creates empty file
Message-ID: <59d7961d0607221744y7da9549dr1f5d0f2a500000f7@mail.gmail.com>

Copying a non-existing file using file.copy() creates empty file.  Example:

> file.exists("non-existing-file")
[1] FALSE
> file.copy("non-existing-file", "new-file")
> file.exits("new-file")
[1] TRUE
> file.info("new-file")$size
[1] 0

The reason for this is that file.copy() calls file.create() without
checking if the 'from' file exists;

> file.copy
function (from, to, overwrite = FALSE)
{
    if (!(nf <- length(from)))
        stop("no files to copy from")
    if (!(nt <- length(to)))
        stop("no files to copy to")
    if (nt == 1 && file.exists(to) && file.info(to)$isdir)
        to <- file.path(to, basename(from))
    else if (nf > nt)
        stop("more 'from' files than 'to' files")
    if (nt > nf)
        from <- rep(from, length.out = nt)
    if (!overwrite)
        okay <- !file.exists(to)
    else okay <- rep.int(TRUE, length(to))
    if (any(from[okay] %in% to[okay]))
        stop("file can not be copied both 'from' and 'to'")
    if (any(okay)) {
        okay[okay] <- file.create(to[okay])
        if (any(okay))
            okay[okay] <- file.append(to[okay], from[okay])
    }
    okay
}
<environment: namespace:base>

Adding one line:

    okay <- okay & file.exists(from);

before the last if-statement will do.

/Henrik


From cooch17 at verizon.net  Sun Jul 23 16:13:45 2006
From: cooch17 at verizon.net (Evan Cooch)
Date: Sun, 23 Jul 2006 10:13:45 -0400
Subject: [Rd] compiling R | multi-Opteron | BLAS source
Message-ID: <44C38419.2010209@verizon.net>

Greetings -

A quick perusal of some of the posts to this maillist suggest the level 
of the questions is probably beyond someone working at my level, but at 
the risk of looking foolish publicly (something I find I get 
increasingly comfortable with as I get older), here goes:

My research group recently purchased a multi-Opteron system (bunch of 
880 chips), running 64-bit RHEL 4 (which we have site licensed at our 
university, so it cost us nothing - good price) with SMP support built 
into the kernel (perhaps obviously, for a multi-pro system). Several of 
our user use [R], which I've only used on a few occasions. However, it 
is part of my task to get [R] installed for folks using this system.

While the simple, basic compile sequence (./configure, make, make check, 
make install) went smoothly, its pretty clear from our benchmarks that 
the [R] code isn't running as 'rocket-fast' as it should for a system 
like this. So, I dig a bit deeper. Most of the jobs we want to run could 
benefit from BLAS support (lots of array manipulations and other bits of 
linear algebra), and a few other compilation optimizations - and here is 
where I seek advice.

1) Looks like there are 3-4 flavours: LAPACK, ATLAS, ACML 
(AMD-chips...), and Goto. In reading what I can find, it seems that 
there are reasons not to use ACML (single-thread) despite the AMD chips, 
reasons to avoid ATLAS (some hassles compiling on RHEL 4 boxes), reasons 
to avoid LAPACK (ibid), but apparently no problems with Goto BLAS.

Is that a reasonable summary? At the risk of starting a larger 
discussion, I'm simply looking to get BLAS support, yielding the fastest 
[R] code with the minimum of hassles (while tweaking lines of configure 
fies,  weird linker sequences and all that used to appeal when I was a 
student, I don't have time at this stage). So, any quick recommendation 
for *which* BLAS library? My quick assessment suggests goto BLAS, but 
I'm hoping for some confirmation.

3) compilation of BLAS - I can compile for 32-bit, or 64-bit. 
Presumably, given we've invested in 64-bit chips, and a 64-bit OS, we'd 
like to consider a 64-bit compilation. Which, also presumably, means 
we'd need 64-bit compilation for [R]. While I've read the short blurb on 
CRAN concerning 64-bi vs 32-bit compilations (data size vs speed), I'd 
be happy to have both on our machine. But, I'm not sure how one 
specifies 64-bits in the [R] compilation - what flags to I need to set 
during ./configure, or what config file do I need to edit?

Thanks very much in advance - and, again, apologies for the 'low-level' 
of these questions, but one needs to start somewhere.


From mschaff at bu.edu  Sun Jul 23 23:15:09 2006
From: mschaff at bu.edu (mschaff at bu.edu)
Date: Sun, 23 Jul 2006 17:15:09 -0400
Subject: [Rd] Problems Reading from Socket
In-Reply-To: <017A38B8-7167-4CCA-98DA-4411ADCB1396@bu.edu>
References: <017A38B8-7167-4CCA-98DA-4411ADCB1396@bu.edu>
Message-ID: <20060723171509.icqpilye8qo48sks@www.bu.edu>

To answer my own question (and maybe help someone else), it turns out 
my web server was sending chunked responses and inserting chunk sizes 
before each data chunk.

Changing the line:

request<-paste("POST ",path," HTTP/1.1\nHost: ",host...

to

request<-paste("POST ",path," HTTP/1.0\nHost: ",host...

disables chunked reponses and allows R to read directly from the socket 
without additional parsing.  So this wasn't really an R problem, but I 
thought this detail might help someone else.

--
Mike


From A.Robinson at ms.unimelb.edu.au  Mon Jul 24 00:04:10 2006
From: A.Robinson at ms.unimelb.edu.au (Andrew Robinson)
Date: Mon, 24 Jul 2006 08:04:10 +1000
Subject: [Rd] Making a patch
Message-ID: <20060723220410.GI59927@ms.unimelb.edu.au>

Dear R developers,

is there a preferred format or strategy for making a patch to
contribute to a package that is maintained by R-core?  Berwin Turlach
and I have written a very minor extension to lmeControl to allow it to
pass an argument to nlminb for the maximum number of evaluations of
the objective function.  I've edited the nlme/R/lme.R and
nlme/man/lmeControl.Rd files.  I can diff the files, but the options
seem numerous.  I haven't been able to find any hinst on the preferred
approach.  Any advice would be welcomed.

Cheers

Andrew

-- 
Andrew Robinson  
Department of Mathematics and Statistics            Tel: +61-3-8344-9763
University of Melbourne, VIC 3010 Australia         Fax: +61-3-8344-4599
Email: a.robinson at ms.unimelb.edu.au         http://www.ms.unimelb.edu.au


From gregor.gorjanc at bfro.uni-lj.si  Mon Jul 24 01:37:42 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Sun, 23 Jul 2006 23:37:42 +0000 (UTC)
Subject: [Rd] Making a patch
References: <20060723220410.GI59927@ms.unimelb.edu.au>
Message-ID: <loom.20060724T013432-266@post.gmane.org>

Hi,

Andrew Robinson <A.Robinson <at> ms.unimelb.edu.au> writes:
> 
> Dear R developers,
> 
> is there a preferred format or strategy for making a patch to
> contribute to a package that is maintained by R-core?  Berwin Turlach
> and I have written a very minor extension to lmeControl to allow it to
> pass an argument to nlminb for the maximum number of evaluations of
> the objective function.  I've edited the nlme/R/lme.R and
> nlme/man/lmeControl.Rd files.  I can diff the files, but the options
> seem numerous.  I haven't been able to find any hinst on the preferred
> approach.  Any advice would be welcomed.
> 

look at 

http://article.gmane.org/gmane.comp.lang.r.devel/8858

perhaps this (with modifications if necesarry) could be added to developer page 

http://developer.r-project.org/

Afterall, there is a good guide on posting mails to r-mailing lists and it would
be good to have the same for pacthes.

Gregor


From A.Robinson at ms.unimelb.edu.au  Mon Jul 24 03:39:00 2006
From: A.Robinson at ms.unimelb.edu.au (Andrew Robinson)
Date: Mon, 24 Jul 2006 11:39:00 +1000
Subject: [Rd] Making a patch
In-Reply-To: <loom.20060724T013432-266@post.gmane.org>
References: <20060723220410.GI59927@ms.unimelb.edu.au>
	<loom.20060724T013432-266@post.gmane.org>
Message-ID: <20060724013900.GN59927@ms.unimelb.edu.au>

Thanks Gregor,

I will go ahead with that unless anyone has any other advice or preferences.

Cheers

Andrew

On Sun, Jul 23, 2006 at 11:37:42PM +0000, Gregor Gorjanc wrote:
> Hi,
> 
> Andrew Robinson <A.Robinson <at> ms.unimelb.edu.au> writes:
> > 
> > Dear R developers,
> > 
> > is there a preferred format or strategy for making a patch to
> > contribute to a package that is maintained by R-core?  Berwin Turlach
> > and I have written a very minor extension to lmeControl to allow it to
> > pass an argument to nlminb for the maximum number of evaluations of
> > the objective function.  I've edited the nlme/R/lme.R and
> > nlme/man/lmeControl.Rd files.  I can diff the files, but the options
> > seem numerous.  I haven't been able to find any hinst on the preferred
> > approach.  Any advice would be welcomed.
> > 
> 
> look at 
> 
> http://article.gmane.org/gmane.comp.lang.r.devel/8858
> 
> perhaps this (with modifications if necesarry) could be added to developer page 
> 
> http://developer.r-project.org/
> 
> Afterall, there is a good guide on posting mails to r-mailing lists and it would
> be good to have the same for pacthes.
> 
> Gregor
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Andrew Robinson  
Department of Mathematics and Statistics            Tel: +61-3-8344-9763
University of Melbourne, VIC 3010 Australia         Fax: +61-3-8344-4599
Email: a.robinson at ms.unimelb.edu.au         http://www.ms.unimelb.edu.au


From murdoch at stats.uwo.ca  Mon Jul 24 12:32:03 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 24 Jul 2006 06:32:03 -0400
Subject: [Rd] Making a patch
In-Reply-To: <20060723220410.GI59927@ms.unimelb.edu.au>
References: <20060723220410.GI59927@ms.unimelb.edu.au>
Message-ID: <44C4A1A3.1000905@stats.uwo.ca>

On 7/23/2006 6:04 PM, Andrew Robinson wrote:
> Dear R developers,
> 
> is there a preferred format or strategy for making a patch to
> contribute to a package that is maintained by R-core?  Berwin Turlach
> and I have written a very minor extension to lmeControl to allow it to
> pass an argument to nlminb for the maximum number of evaluations of
> the objective function.  I've edited the nlme/R/lme.R and
> nlme/man/lmeControl.Rd files.  I can diff the files, but the options
> seem numerous.  I haven't been able to find any hinst on the preferred
> approach.  Any advice would be welcomed.

Gregor pointed out a description of the suggested format.  But the 
strategy is also important:  in order for your patch to be incorporated, 
you need to convince someone to accept it.  To do that, you should post 
the following sort of information along with your patch:

  - what the patch does
  - what problem it solves
  - what problems it may cause

You should also make sure your patch is complete, e.g. if it changes 
lmeControl, then you should also include a patch to the documentation 
for lmeControl.

Duncan Murdoch


From maechler at stat.math.ethz.ch  Mon Jul 24 12:46:19 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 24 Jul 2006 12:46:19 +0200
Subject: [Rd] RFC: Redefining length(<POSIXlt>) ?
In-Reply-To: <17604.38621.799499.786355@stat.math.ethz.ch>
References: <44C32276.30800@univ-fcomte.fr>
	<644e1f320607230341v6d4cde82i1eff7881cc36a6ac@mail.gmail.com>
	<44C36849.7070106@univ-fcomte.fr>
	<971536df0607230602u33348346x8093c6b9a9984f97@mail.gmail.com>
	<17604.38621.799499.786355@stat.math.ethz.ch>
Message-ID: <17604.42235.324954.796411@stat.math.ethz.ch>

So I did open a new subject and move the discussion to R-devel
now.

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Mon, 24 Jul 2006 11:46:05 +0200 writes:

  >>>>> "Gabor" == Gabor Grothendieck <ggrothendieck at gmail.com>
  >>>>>     on Sun, 23 Jul 2006 09:02:35 -0400 writes:

      Gabor> Looking at the diff.POSIXt code we see the problem is
      Gabor> that it takes the length of the input using length
      Gabor> which is wrong since in the case of POSIXlt the
      Gabor> length is always 9 (or maybe length should be defined
      Gabor> differently for POSIXlt?).

    MM> Though I agree with Spencer that a user may expect
    MM> length() to behave differently, but I don't think this
    MM> would be a good idea.  Yes, length() is generic, but its
    MM> help() emphasizes that for lists, length() should be the
    MM> number of list elements.  Of course anyone one *can*
    MM> define length() methods that behave differently for
    MM> his/her classes, but then one would also want to make
    MM> sure that e.g.  x[length(x)] or 'x[length(x)] <- value'
    MM> works and -- in a case of simple S3 class built on a
    MM> list, would work differently than if x was a the simple list.

Hmm, after thinking a bit more, and particularly after seeing
all the other methods we already have working for "POSIXlt",
I'm much less sure if  (re)definining  length(<POSIXlt>) 
would be such a bad idea.
Indeed, "[", and "[<-" and "[[" already work with an implicit
length of 'length_of_series' and not length 9, and so does str().

So it seems to me, there is more reasonable momentum *for* a
length.POSIXlt() method than I first considered.

Still not sure what the wisest decision would be, and I am
asking for more opinions or arguments pro / con.
Since Brian Ripley has done the most work on the POSIX[cl]?t
classes, we should also wait on his opinion.

Martin

    MM> In my view, I would only consider redefing length() for
    MM> "non-basic" S4 classes, i.e. those with slots, where no
    MM> confusion is possible, since these objects are
    MM> definitely not simple vectors nor lists (aka "generic"
    MM> vectors).


From huber at ebi.ac.uk  Mon Jul 24 13:49:36 2006
From: huber at ebi.ac.uk (Wolfgang Huber)
Date: Mon, 24 Jul 2006 12:49:36 +0100
Subject: [Rd] png() and image()
In-Reply-To: <59d7961d0607210935i26eb297apf0e4e5981ebb4902@mail.gmail.com>
References: <59d7961d0607201855x37b2fb3bw6d89939e1409287d@mail.gmail.com>	
	<44C08042.5070807@ebi.ac.uk>
	<59d7961d0607210935i26eb297apf0e4e5981ebb4902@mail.gmail.com>
Message-ID: <44C4B3D0.7000000@ebi.ac.uk>

Henrik Bengtsson wrote:
> Hi Wolfgang,
>
> thanks for this - I took a look the EBImage webpage
> [http://www.ebi.ac.uk/~osklyar/projects/EBImage/] and it looks very
> nice.  Are there any plans for Windows support too?  I am looking for
> a cross-platform solution.
>
> Cheers


Hi Henrik,

there are very strong intentions to also make this available as a
Windows precompiled package and/or provide installation instruction for
Windows. Until now however, in spite of some effort, we have failed.

As I understand it, a problem seems to be different dll formats of  MS
Visual C++ (in which ImageMagick is provided) and MinGW.

If anyone is interested in helping with this, they could have a look at
the source package on Bioconductor, and contact us for details.

 Best wishes
 Wolfgang



> On 7/21/06, Wolfgang Huber <huber at ebi.ac.uk> wrote:
>>
>> Hi Henrik,
>> this does not directly answer your question, but you might be able to
>> use the function write.image in the package EBImage (Bioconductor) to
>> write matrices into image files (e.g. PNG or JPEG), this might be more
>> flexible and also faster than what you're trying to do.
>>   Best wishes
>>   Wolfgang
>> ------------------------------------------------------------------
>> Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber
>>
>> Henrik Bengtsson wrote:
>> > Hi,
>> >
>> > I try to create PNG images of a certain size where each pixel
>> > intensity corresponds to exactly one probe signal in an Affymetrix
>> > array.  I try to use png() and image() with zero margins to do this.
>> > Example:
>> >
>> > z <- matrix(1:15, nrow=45, ncol=30)
>> > png("large.png", height=nrow(z), width=ncol(z), bg="red")
>> > par(mar=c(0,0,0,0))
>> > image(z, col=gray.colors(16), axes=FALSE)
>> > dev.off()
>> >
>> > z <- matrix(1:15, nrow=5, ncol=3)
>> > png("tiny.png", height=nrow(z), width=ncol(z), bg="red")
>> > par(mar=c(0,0,0,0))
>> > image(z, col=gray.colors(16), axes=FALSE)
>> > dev.off()
>> >
>> > The problem is that on WinXP the very bottom row and the very right
>> > column of pixels in red.  Trying on Linux, it is only the very right
>> > column that is red.  See attached images (you might have to zoom in to
>> > see it).  I try to do this in R v2.3.1.  The same effect is seen if
>> > the jpeg() device is used.
>> >
>> > When rescaling, the same effect is seen (the red border effect is one
>> > pixel wide), e.g.
>> >
>> > z <- matrix(1:15, nrow=45, ncol=30)
>> > png("large5.png", height=5*nrow(z), width=5*ncol(z), bg="red")
>> > par(mar=c(0,0,0,0))
>> > image(z, col=gray.colors(16), axes=FALSE)
>> > dev.off()
>> >
>> > I might be asking for something that is not supported, but is there a
>> > way around this?  It is a problem, because I wish to tile the images
>> > in an HTML page.
>> >
>> > Thanks
>> >
>> > Henrik
>> >
>>


-- 
------------------------------------------------------------------
Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber


From ggrothendieck at gmail.com  Mon Jul 24 14:37:23 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 24 Jul 2006 08:37:23 -0400
Subject: [Rd] RFC: Redefining length(<POSIXlt>) ?
In-Reply-To: <17604.42235.324954.796411@stat.math.ethz.ch>
References: <44C32276.30800@univ-fcomte.fr>
	<644e1f320607230341v6d4cde82i1eff7881cc36a6ac@mail.gmail.com>
	<44C36849.7070106@univ-fcomte.fr>
	<971536df0607230602u33348346x8093c6b9a9984f97@mail.gmail.com>
	<17604.38621.799499.786355@stat.math.ethz.ch>
	<17604.42235.324954.796411@stat.math.ethz.ch>
Message-ID: <971536df0607240537o2ad63be6v61c50023c7f35b3b@mail.gmail.com>

I think Spencer's point of it likely being compatible with most
current code is important (since it currently always returns
9 so its unlikely to be used meaningfully in existing code).

On 7/24/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> So I did open a new subject and move the discussion to R-devel
> now.
>
> >>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
> >>>>>     on Mon, 24 Jul 2006 11:46:05 +0200 writes:
>
>  >>>>> "Gabor" == Gabor Grothendieck <ggrothendieck at gmail.com>
>  >>>>>     on Sun, 23 Jul 2006 09:02:35 -0400 writes:
>
>      Gabor> Looking at the diff.POSIXt code we see the problem is
>      Gabor> that it takes the length of the input using length
>      Gabor> which is wrong since in the case of POSIXlt the
>      Gabor> length is always 9 (or maybe length should be defined
>      Gabor> differently for POSIXlt?).
>
>    MM> Though I agree with Spencer that a user may expect
>    MM> length() to behave differently, but I don't think this
>    MM> would be a good idea.  Yes, length() is generic, but its
>    MM> help() emphasizes that for lists, length() should be the
>    MM> number of list elements.  Of course anyone one *can*
>    MM> define length() methods that behave differently for
>    MM> his/her classes, but then one would also want to make
>    MM> sure that e.g.  x[length(x)] or 'x[length(x)] <- value'
>    MM> works and -- in a case of simple S3 class built on a
>    MM> list, would work differently than if x was a the simple list.
>
> Hmm, after thinking a bit more, and particularly after seeing
> all the other methods we already have working for "POSIXlt",
> I'm much less sure if  (re)definining  length(<POSIXlt>)
> would be such a bad idea.
> Indeed, "[", and "[<-" and "[[" already work with an implicit
> length of 'length_of_series' and not length 9, and so does str().
>
> So it seems to me, there is more reasonable momentum *for* a
> length.POSIXlt() method than I first considered.
>
> Still not sure what the wisest decision would be, and I am
> asking for more opinions or arguments pro / con.
> Since Brian Ripley has done the most work on the POSIX[cl]?t
> classes, we should also wait on his opinion.
>
> Martin
>
>    MM> In my view, I would only consider redefing length() for
>    MM> "non-basic" S4 classes, i.e. those with slots, where no
>    MM> confusion is possible, since these objects are
>    MM> definitely not simple vectors nor lists (aka "generic"
>    MM> vectors).
>
>


From hin-tak.leung at cimr.cam.ac.uk  Mon Jul 24 14:45:35 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 24 Jul 2006 13:45:35 +0100
Subject: [Rd] png() and image()
In-Reply-To: <44C4B3D0.7000000@ebi.ac.uk>
References: <59d7961d0607201855x37b2fb3bw6d89939e1409287d@mail.gmail.com>		<44C08042.5070807@ebi.ac.uk>	<59d7961d0607210935i26eb297apf0e4e5981ebb4902@mail.gmail.com>
	<44C4B3D0.7000000@ebi.ac.uk>
Message-ID: <44C4C0EF.2010404@cimr.cam.ac.uk>

Wolfgang Huber wrote:
> Henrik Bengtsson wrote:
>> Hi Wolfgang,
>>
>> thanks for this - I took a look the EBImage webpage
>> [http://www.ebi.ac.uk/~osklyar/projects/EBImage/] and it looks very
>> nice.  Are there any plans for Windows support too?  I am looking for
>> a cross-platform solution.
>>
>> Cheers
> 
> 
> Hi Henrik,
> 
> there are very strong intentions to also make this available as a
> Windows precompiled package and/or provide installation instruction for
> Windows. Until now however, in spite of some effort, we have failed.
> 
> As I understand it, a problem seems to be different dll formats of  MS
> Visual C++ (in which ImageMagick is provided) and MinGW.
> 
> If anyone is interested in helping with this, they could have a look at
> the source package on Bioconductor, and contact us for details.

It is probably easier to port ImageMagick to MinGW than to try to
link mingw-compiled EBImage against MSVC++ compiled imagemagick.
(Imagemagick does run under cygwin, I believe, so it is not
entirely hostile to gcc on windows).

HTL

> 
>  Best wishes
>  Wolfgang
> 
> 
> 
>> On 7/21/06, Wolfgang Huber <huber at ebi.ac.uk> wrote:
>>> Hi Henrik,
>>> this does not directly answer your question, but you might be able to
>>> use the function write.image in the package EBImage (Bioconductor) to
>>> write matrices into image files (e.g. PNG or JPEG), this might be more
>>> flexible and also faster than what you're trying to do.
>>>   Best wishes
>>>   Wolfgang
>>> ------------------------------------------------------------------
>>> Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber
>>>
>>> Henrik Bengtsson wrote:
>>>> Hi,
>>>>
>>>> I try to create PNG images of a certain size where each pixel
>>>> intensity corresponds to exactly one probe signal in an Affymetrix
>>>> array.  I try to use png() and image() with zero margins to do this.
>>>> Example:
>>>>
>>>> z <- matrix(1:15, nrow=45, ncol=30)
>>>> png("large.png", height=nrow(z), width=ncol(z), bg="red")
>>>> par(mar=c(0,0,0,0))
>>>> image(z, col=gray.colors(16), axes=FALSE)
>>>> dev.off()
>>>>
>>>> z <- matrix(1:15, nrow=5, ncol=3)
>>>> png("tiny.png", height=nrow(z), width=ncol(z), bg="red")
>>>> par(mar=c(0,0,0,0))
>>>> image(z, col=gray.colors(16), axes=FALSE)
>>>> dev.off()
>>>>
>>>> The problem is that on WinXP the very bottom row and the very right
>>>> column of pixels in red.  Trying on Linux, it is only the very right
>>>> column that is red.  See attached images (you might have to zoom in to
>>>> see it).  I try to do this in R v2.3.1.  The same effect is seen if
>>>> the jpeg() device is used.
>>>>
>>>> When rescaling, the same effect is seen (the red border effect is one
>>>> pixel wide), e.g.
>>>>
>>>> z <- matrix(1:15, nrow=45, ncol=30)
>>>> png("large5.png", height=5*nrow(z), width=5*ncol(z), bg="red")
>>>> par(mar=c(0,0,0,0))
>>>> image(z, col=gray.colors(16), axes=FALSE)
>>>> dev.off()
>>>>
>>>> I might be asking for something that is not supported, but is there a
>>>> way around this?  It is a problem, because I wish to tile the images
>>>> in an HTML page.
>>>>
>>>> Thanks
>>>>
>>>> Henrik
>>>>
> 
>


From gregor.gorjanc at bfro.uni-lj.si  Mon Jul 24 14:48:14 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 24 Jul 2006 12:48:14 +0000 (UTC)
Subject: [Rd] RFC: Redefining length(<POSIXlt>) ?
References: <44C32276.30800@univ-fcomte.fr>
	<644e1f320607230341v6d4cde82i1eff7881cc36a6ac@mail.gmail.com>
	<44C36849.7070106@univ-fcomte.fr>
	<971536df0607230602u33348346x8093c6b9a9984f97@mail.gmail.com>
	<17604.38621.799499.786355@stat.math.ethz.ch>
	<17604.42235.324954.796411@stat.math.ethz.ch>
Message-ID: <loom.20060724T144357-494@post.gmane.org>

Hi,

Martin Maechler <maechler <at> stat.math.ethz.ch> writes:

> 
> So I did open a new subject and move the discussion to R-devel
> now.
> 
> >>>>> "MM" == Martin Maechler <maechler <at> stat.math.ethz.ch>
> >>>>>     on Mon, 24 Jul 2006 11:46:05 +0200 writes:
> 
>   >>>>> "Gabor" == Gabor Grothendieck <ggrothendieck <at> gmail.com>
>   >>>>>     on Sun, 23 Jul 2006 09:02:35 -0400 writes:
> 
>       Gabor> Looking at the diff.POSIXt code we see the problem is
>       Gabor> that it takes the length of the input using length
>       Gabor> which is wrong since in the case of POSIXlt the
>       Gabor> length is always 9 (or maybe length should be defined
>       Gabor> differently for POSIXlt?).
> 
>     MM> Though I agree with Spencer that a user may expect
>     MM> length() to behave differently, but I don't think this
>     MM> would be a good idea.  Yes, length() is generic, but its
>     MM> help() emphasizes that for lists, length() should be the
>     MM> number of list elements.  Of course anyone one *can*
>     MM> define length() methods that behave differently for
>     MM> his/her classes, but then one would also want to make
>     MM> sure that e.g.  x[length(x)] or 'x[length(x)] <- value'
>     MM> works and -- in a case of simple S3 class built on a
>     MM> list, would work differently than if x was a the simple list.

I think that having generic for POSIXlt would be more natural than default
length, which is (as stated by Gabor) always 9. When I see a date or time with
all additions I always think of it as one "element". So it would be naturaly
that length() would return number of dates/times in POSIXlt object.

Gregor


From ripley at stats.ox.ac.uk  Mon Jul 24 15:22:32 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 24 Jul 2006 14:22:32 +0100 (BST)
Subject: [Rd] png() and image()
In-Reply-To: <44C4C0EF.2010404@cimr.cam.ac.uk>
References: <59d7961d0607201855x37b2fb3bw6d89939e1409287d@mail.gmail.com>		<44C08042.5070807@ebi.ac.uk>	<59d7961d0607210935i26eb297apf0e4e5981ebb4902@mail.gmail.com>
	<44C4B3D0.7000000@ebi.ac.uk> <44C4C0EF.2010404@cimr.cam.ac.uk>
Message-ID: <1037.195.205.11.116.1153747352.squirrel@webmail.stats.ox.ac.uk>


> Wolfgang Huber wrote:
>> Henrik Bengtsson wrote:
>>> Hi Wolfgang,
>>>
>>> thanks for this - I took a look the EBImage webpage
>>> [http://www.ebi.ac.uk/~osklyar/projects/EBImage/] and it looks very
>>> nice.  Are there any plans for Windows support too?  I am looking for
>>> a cross-platform solution.
>>>
>>> Cheers
>>
>>
>> Hi Henrik,
>>
>> there are very strong intentions to also make this available as a
>> Windows precompiled package and/or provide installation instruction for
>> Windows. Until now however, in spite of some effort, we have failed.
>>
>> As I understand it, a problem seems to be different dll formats of  MS
>> Visual C++ (in which ImageMagick is provided) and MinGW.

There are no such things: the Windows DLL format is one DLL format, and R
uses VC6-compiled DLLs for Tcl/Tk and iconv, for example.  And other
packages (e.g. RNetCDF, rgdal) take the same route.

The issues are usually to use the correct header files that mark entry
points as stdcall rather than cdecl as needed, and to link directly to
the DLL rather than via a VCC-specific import library (which may often
work, but equally often gets the linkage wrong.

>> If anyone is interested in helping with this, they could have a look at
>> the source package on Bioconductor, and contact us for details.
>
> It is probably easier to port ImageMagick to MinGW than to try to
> link mingw-compiled EBImage against MSVC++ compiled imagemagick.

That would run contrary to most experience with Windows porting.

> (Imagemagick does run under cygwin, I believe, so it is not
> entirely hostile to gcc on windows).
>
> HTL
>
>>
>>  Best wishes
>>  Wolfgang
>>
>>
>>
>>> On 7/21/06, Wolfgang Huber <huber at ebi.ac.uk> wrote:
>>>> Hi Henrik,
>>>> this does not directly answer your question, but you might be able to
>>>> use the function write.image in the package EBImage (Bioconductor) to
>>>> write matrices into image files (e.g. PNG or JPEG), this might be more
>>>> flexible and also faster than what you're trying to do.
>>>>   Best wishes
>>>>   Wolfgang
>>>> ------------------------------------------------------------------
>>>> Wolfgang Huber  EBI/EMBL  Cambridge UK  http://www.ebi.ac.uk/huber
>>>>
>>>> Henrik Bengtsson wrote:
>>>>> Hi,
>>>>>
>>>>> I try to create PNG images of a certain size where each pixel
>>>>> intensity corresponds to exactly one probe signal in an Affymetrix
>>>>> array.  I try to use png() and image() with zero margins to do this.
>>>>> Example:
>>>>>
>>>>> z <- matrix(1:15, nrow=45, ncol=30)
>>>>> png("large.png", height=nrow(z), width=ncol(z), bg="red")
>>>>> par(mar=c(0,0,0,0))
>>>>> image(z, col=gray.colors(16), axes=FALSE)
>>>>> dev.off()
>>>>>
>>>>> z <- matrix(1:15, nrow=5, ncol=3)
>>>>> png("tiny.png", height=nrow(z), width=ncol(z), bg="red")
>>>>> par(mar=c(0,0,0,0))
>>>>> image(z, col=gray.colors(16), axes=FALSE)
>>>>> dev.off()
>>>>>
>>>>> The problem is that on WinXP the very bottom row and the very right
>>>>> column of pixels in red.  Trying on Linux, it is only the very right
>>>>> column that is red.  See attached images (you might have to zoom in
>>>>> to
>>>>> see it).  I try to do this in R v2.3.1.  The same effect is seen if
>>>>> the jpeg() device is used.
>>>>>
>>>>> When rescaling, the same effect is seen (the red border effect is one
>>>>> pixel wide), e.g.
>>>>>
>>>>> z <- matrix(1:15, nrow=45, ncol=30)
>>>>> png("large5.png", height=5*nrow(z), width=5*ncol(z), bg="red")
>>>>> par(mar=c(0,0,0,0))
>>>>> image(z, col=gray.colors(16), axes=FALSE)
>>>>> dev.off()
>>>>>
>>>>> I might be asking for something that is not supported, but is there a
>>>>> way around this?  It is a problem, because I wish to tile the images
>>>>> in an HTML page.
>>>>>
>>>>> Thanks
>>>>>
>>>>> Henrik
>>>>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From andy_liaw at merck.com  Mon Jul 24 17:14:34 2006
From: andy_liaw at merck.com (Liaw, Andy)
Date: Mon, 24 Jul 2006 11:14:34 -0400
Subject: [Rd] compiling R | multi-Opteron | BLAS source
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFA029B17D4@usctmx1106.merck.com>

From: Evan Cooch
> 
> Greetings -
> 
> A quick perusal of some of the posts to this maillist suggest 
> the level of the questions is probably beyond someone working 
> at my level, but at the risk of looking foolish publicly 
> (something I find I get increasingly comfortable with as I 
> get older), here goes:
> 
> My research group recently purchased a multi-Opteron system 
> (bunch of 880 chips), running 64-bit RHEL 4 (which we have 
> site licensed at our university, so it cost us nothing - good 
> price) with SMP support built into the kernel (perhaps 
> obviously, for a multi-pro system). Several of our user use 
> [R], which I've only used on a few occasions. However, it is 
> part of my task to get [R] installed for folks using this system.
> 
> While the simple, basic compile sequence (./configure, make, 
> make check, make install) went smoothly, its pretty clear 
> from our benchmarks that the [R] code isn't running as 
> 'rocket-fast' as it should for a system like this. So, I dig 
> a bit deeper. Most of the jobs we want to run could benefit 
> from BLAS support (lots of array manipulations and other bits 
> of linear algebra), and a few other compilation optimizations 
> - and here is where I seek advice.
> 
> 1) Looks like there are 3-4 flavours: LAPACK, ATLAS, ACML 
> (AMD-chips...), and Goto. In reading what I can find, it 
> seems that there are reasons not to use ACML (single-thread) 
> despite the AMD chips, reasons to avoid ATLAS (some hassles 
> compiling on RHEL 4 boxes), reasons to avoid LAPACK (ibid), 
> but apparently no problems with Goto BLAS.
> 
> Is that a reasonable summary? At the risk of starting a 
> larger discussion, I'm simply looking to get BLAS support, 
> yielding the fastest [R] code with the minimum of hassles 
> (while tweaking lines of configure fies,  weird linker 
> sequences and all that used to appeal when I was a student, I 
> don't have time at this stage). So, any quick recommendation 
> for *which* BLAS library? My quick assessment suggests goto 
> BLAS, but I'm hoping for some confirmation.

I think the early version of ACML lagged behind others, but recent
 versions are competitive.  I've run into precision problem (failing
 make check all) with some Goto BLAS before.  Also, Goto BLAS has 
switched to a more restrictive license (probably not a problem for 
you though).
 
> 3) compilation of BLAS - I can compile for 32-bit, or 64-bit. 
> Presumably, given we've invested in 64-bit chips, and a 
> 64-bit OS, we'd like to consider a 64-bit compilation. Which, 
> also presumably, means we'd need 64-bit compilation for [R]. 
> While I've read the short blurb on CRAN concerning 64-bi vs 
> 32-bit compilations (data size vs speed), I'd be happy to 
> have both on our machine. But, I'm not sure how one specifies 
> 64-bits in the [R] compilation - what flags to I need to set 
> during ./configure, or what config file do I need to edit?

That's up to the compiler(s) you use (unstated).  For GCC, I believe
-m64/-m32 is the flag.  For 64-bit GCC -m64 is the default.

Andy
 
> Thanks very much in advance - and, again, apologies for the 
> 'low-level' 
> of these questions, but one needs to start somewhere.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From cooch17 at verizon.net  Mon Jul 24 17:32:13 2006
From: cooch17 at verizon.net (Evan Cooch)
Date: Mon, 24 Jul 2006 11:32:13 -0400
Subject: [Rd] compiling R | multi-Opteron | BLAS source
In-Reply-To: <39B6DDB9048D0F4DAD42CB26AAFF0AFA029B17D4@usctmx1106.merck.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA029B17D4@usctmx1106.merck.com>
Message-ID: <44C4E7FD.8010302@verizon.net>


>
> I think the early version of ACML lagged behind others, but recent
>  versions are competitive.  I've run into precision problem (failing
>  make check all) with some Goto BLAS before.  Also, Goto BLAS has 
> switched to a more restrictive license (probably not a problem for 
> you though).
>   

No, probably not a problem for us at this end, but good to know. I'm 
happy to give the latest version of ACML a try. In fact, it occurred to 
me that it would probably be worth comparing relative performance. I 
know that benchmarking is a technical issue, but I would be curious to 
see how some of our compute-intensive jobs perform.

>  
>   
>> 3) compilation of BLAS - I can compile for 32-bit, or 64-bit. 
>> Presumably, given we've invested in 64-bit chips, and a 
>> 64-bit OS, we'd like to consider a 64-bit compilation. Which, 
>> also presumably, means we'd need 64-bit compilation for [R]. 
>> While I've read the short blurb on CRAN concerning 64-bi vs 
>> 32-bit compilations (data size vs speed), I'd be happy to 
>> have both on our machine. But, I'm not sure how one specifies 
>> 64-bits in the [R] compilation - what flags to I need to set 
>> during ./configure, or what config file do I need to edit?
>>     
>
> That's up to the compiler(s) you use (unstated).  For GCC, I believe
> -m64/-m32 is the flag.  For 64-bit GCC -m64 is the default.
>
> Andy
>   

Thanks indeed.


From asr at ufl.edu  Mon Jul 24 18:27:39 2006
From: asr at ufl.edu (Allen S. Rout)
Date: 24 Jul 2006 12:27:39 -0400
Subject: [Rd] SystemRequirements (was  DESCRIPTION and PACKAGES files )
References: <86lkqoys6b.fsf@ufl.edu>
	<Pine.LNX.4.64.0607202128260.32650@gannet.stats.ox.ac.uk>
	<86d5c0ypin.fsf@ufl.edu> <m264hrah1o.fsf@ziti.local>
Message-ID: <86d5bvvuh0.fsf_-_@ufl.edu>

Seth Falcon <sfalcon at fhcrc.org> writes:

> For the Bioconductor project, we also wanted more information to be
> programatically available regarding the packages in a repository.
> Instead of bloating the PACKAGES file, we put a separate file, VIEWS
> in our repository.  [...]
> 
> So, if you were able to host a CRAN mirror, you could annotate it
> similarly.


Thanks, Seth; I am hoping that I will be able to avoid introducing any
new data to the PACKAGES stream.  So far, I'm doing all right with
concatenating all the DESCRIPTIONS files from the Descriptions/ subdir
of a CRAN mirror.


I'm wondering about SystemRequirements, though; I ass-u-med from its
mention in 'Writing R Extensions' that it was intended to have a
format similar to Depends.  Some package authors seem to feel the same
way, but many clearly do not.


cran2ebuild $ grep -i systemre descs/PACKAGES
SystemRequirements: currently the only supported OS is Windows, we expect to support Linux in future releases
SystemRequirements: libgd (>= 2.0.28 http://www.boutell.com/gd/), recommended: freetype2, fontconfig and msttcorefonts
SystemRequirements: GNU make
SystemRequirements: WinBUGS 1.4 on Windows
SystemRequirements: Internal files Xba.CQV, Xba.regions (or other regions file)
SystemRequirements: netcdf (>= 3.5.0), udunits (>= 1.11.7)
SystemRequirements: An ODBC driver manager and drivers. See README.
SystemRequirements: QuantLib library from http://quantlib.org, Boost library
SystemRequirements: LamMpi(>= 6.5.9) or Mpich2(>= 1.0.2), BLAS, BLACS, ScaLAPACK 
SystemRequirements: Java 1.4 or later
SystemRequirements: Windows, WinEdt
SystemRequirements: None
SystemRequirements: Platform LSF development libraries
SystemRequirements: linux: libtiff (and libtiff-devel); windows: Tiff (libtiff3.dll), zlib1.dll and jpeg62.dll; see also the topic 'SoPhy' in the documentation
SystemRequirements: libxml2 (>= 2.6.3)
SystemRequirements: gmp (>= 4.1.4)
SystemRequirements: GNOME development libraries, R built as a shared object.
SystemRequirements: ghostscript
SystemRequirements: Gnu Scientific Library version >= 1.5
SystemRequirements: SVMlight
SystemRequirements: mim (>= 3.2.0.6)
SystemRequirements: Will use djmrgl or rgl packages for rendering if present
SystemRequirements: GMP (GNU MP bignum library), cddlib
SystemRequirements:
SystemRequirements: for building from source: GDAL >= 1.3.1 library from http://www.gdal.org/download.html and PROJ.4 (proj >= 4.4.9) from http://www.remotesensing.org/proj/
SystemRequirements: GGobi
SystemRequirements: OpenGL, GLU Library, libpng (optional)
SystemRequirements: libtiff
SystemRequirements: 
SystemRequirements: xgobi must be installed additionally,


So, 30-some out of 788 packages use SystemRequirements.  Clearly, a
'Depends'-esque format is the most popular, though there are several
unparseable variants in the list.

I'm suggesting a tighter formatting to a few authors, (i.e. the
packages I happen to use right now) but I wonder if there is any
central philosophical opinion on how that field ought to look?  If the
Gods of R think that automated parsing of SystemRequirements is
unimportant, I'll have to maintain them by hand.



- Allen S. Rout


From dsamperi at DecisionSynergy.com  Mon Jul 24 19:07:29 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Mon, 24 Jul 2006 13:07:29 -0400
Subject: [Rd] % symbol in .Rd files?
Message-ID: <44C4FE51.1070306@DecisionSynergy.com>

Hello,

I am encountering problems when there is a '%' character in
package .Rd files. More precisely, CRAN is having problems
with these characters when running check, whereas I am not
seeing any problems under Linux and Windows.  I did see
these problems, and found that escaping the %'s fixes the
problem in my testing, but apparently this does not fix the
problem when check is run at CRAN.

I suspect that there are some compatibility problems between shells,
TeX, or perl versions, or perhaps the check on CRAN goes
through more levels of preprocessing?

I can probably fix this problem by removing all '%' chars
from my .Rd files, but this doesn't seem like a very
natural solution.

Any ideas?

Thanks,
ds


From evan.cooch at cornell.edu  Mon Jul 24 19:42:16 2006
From: evan.cooch at cornell.edu (Evan Cooch)
Date: Mon, 24 Jul 2006 13:42:16 -0400
Subject: [Rd] R and ACML
Message-ID: <44C50678.1000009@cornell.edu>

While I recently received some very helpful files and email from Kevin 
Hendricks for compiling with ATLAS, thought I'd first have a stab at 
ACML. Having problems, which I suspect are trivial to solve:

1. machine is running RHEL 4, meaning, it uses gcc 3.4.5 out of the box, 
and g77. In my experience, over-riding RHEL's choice, and manually 
upgrading to gcc 4.x.x (and, as a consequence gfortran) will cause 
problems in other areas (but, if other's have done it successfully, with 
no problems, I'd be willing to try).

2. machine has multiple CPU's (Opteron 880's) - meaning (based on ACML 
docs), I *should* download and install gfortran64 (which has mp 
support). However, I don't have gfortran, so...what about 32-bit? Same 
problem - mp requires gfortran. Hmmm

3. so, download and install gnu64 version of ACML, which is intended for 
a single processor (ok, so I guess this means I won't be threading jobs 
over multiple CPU's...fine). Everything installs into  
opt/acml3.5.0/gnu64...

4. need to fix up library path. Working in a bash shell, so

LD_LIBRARY_PATH/opt/acml3.5.0/gnu64/lib
export LD_LIBRARY_PATH

Check env - everything seems fine - LD_LIBRARY_PATH is there, and 
correctly specified

5. cd to R source dir, and run

./configure --with-blas="-lacml"

configure runs fine, except that ACML isn't built-in to R, based on the 
configure output:

C compiler:     gcc  -g -02  -std=gnu99
Fortran 77 compiler:   g77-g -02

C++ compiler:   g++  -g -02
Fortran 90/95 compiler:   g77 -g -02

Interfaces supported:   X11
External libraries:   readline

etc. etc.

So, readline is the only external library.

6. ok, look at config.log, Following line looks suspicious:

/usr/bin/ld:  cannot find -lacml

7. one final attempt:

./configure --with-blas="-L/opt/acml3.5.0/gnu64/lib -lacml"

No change - readline is still the only




-- 
----------------------------------------------------------------------
 Evan Cooch                          e.mail: evan.cooch at cornell.edu
 Department of Natural Resources     voice: 607-255-1368
 Fernow Hall - Cornell University    FAX: 607-255-0349
 Ithaca, NY    14853                 http://canuck.dnr.cornell.edu
----------------------------------------------------------------------
The English are not very spiritual people, so they invented cricket to give them some idea of eternity. - George Bernard Shaw


From cooch17 at verizon.net  Mon Jul 24 20:29:30 2006
From: cooch17 at verizon.net (Evan Cooch)
Date: Mon, 24 Jul 2006 14:29:30 -0400
Subject: [Rd] R and ACML
In-Reply-To: <44C50678.1000009@cornell.edu>
References: <44C50678.1000009@cornell.edu>
Message-ID: <44C5118A.1040903@verizon.net>

I lie (apparently) - turns out step (7) (below) *did* work.

OK, so why didn't previous attempts at the problem (i.e., using 
LD_LIBRARY_PATH) work? Hmmm....
> 7. one final attempt:
>
> ./configure --with-blas="-L/opt/acml3.5.0/gnu64/lib -lacml"
>
> No change - readline is still the only
>
>
>
>
>


From tpapp at Princeton.EDU  Mon Jul 24 20:50:40 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Mon, 24 Jul 2006 20:50:40 +0200
Subject: [Rd] persistent C++ objects
Message-ID: <20060724185040.GA13211@pu100877.student.princeton.edu>

Hi,

I am trying to create an R interface for Dynare++ [1], a k-order
solver for rational expectation models.  I would like some advice on
how to glue the C++ code to R.

In C++, it works the following way:

- a DynareModelEq object is initialized with the formulas, parses them
  and performs k-order symbolic expansions

- the user calls a member of this object multiple times with parameter
  values (eg for MCMC), the object returns tensors

An R interface could work this way:

modeleq <- dynare_expand(... model description ...)
result1 <- dynare_substitute(modeleq, par1)
result2 <- dynare_substitute(modeleq, par2)
etc.

So the user needs to see something in R that corresponds to a C++
object that remains in the memory between calls.  What is the proper
way to do that?  Pass a pointer?  How do I handle that in the .C()
calls, convert it to long int?  My C++ programming knowledge is pretty
limited, suggestions and examples would be appreciated.

The rest (using extern "C" constructs as described in "Writing R
Extensions") is pretty clear, except how to make R call the destructor
of the object when the garbage collector removes it.

Thanks,

Tamas

[1] http://www.cepremap.cnrs.fr/juillard/mambo/index.php?option=com_content&task=view&id=53&Itemid=86


From Achim.Zeileis at wu-wien.ac.at  Mon Jul 24 21:16:45 2006
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Mon, 24 Jul 2006 21:16:45 +0200 (CEST)
Subject: [Rd] residuals.glm for glm(..., y = FALSE)
Message-ID: <Pine.LNX.4.58.0607242107230.17019@thorin.ci.tuwien.ac.at>

I just ran into a problem with residuals.glm() for GLMs fitted with
  glm(..., y = FALSE)
For such fits, the residuals of type "deviance", "pearson" and "response"
can't be computed (see example below). The reason is that residuals.glm()
uses
  y <- object$y
which obviously can't work for such fits.

I've checked ?glm and ?residuals.glm and did not find it mentioned
explicitely...looks like a bug to me.

Best,
Z

## example for poisson GLM from ?glm
  d.AD <- data.frame(treatment = gl(3,3), outcome = gl(3,1,9),
    counts = c(18,17,15,20,10,20,25,13,12))
  glm.D93 <- glm(counts ~ outcome + treatment, family = poisson,
    data = d.AD, y = FALSE)

## residuals cannot be computed
  residuals(glm.D93, type = "deviance")
  residuals(glm.D93, type = "pearson")
  residuals(glm.D93, type = "response")


From tpapp at Princeton.EDU  Mon Jul 24 21:23:10 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Mon, 24 Jul 2006 21:23:10 +0200
Subject: [Rd] persistent C++ objects
In-Reply-To: <44C518CE.4090106@DecisionSynergy.com>
References: <20060724185040.GA13211@pu100877.student.princeton.edu>
	<44C518CE.4090106@DecisionSynergy.com>
Message-ID: <20060724192310.GA14324@pu100877.student.princeton.edu>

On Mon, Jul 24, 2006 at 03:00:30PM -0400, Dominick Samperi wrote:
> R views the C++ code like a function call, so any persistence will have 
> to be
> implemented through a database, or by passing working storage along with
> the call. The data structures supported by RcppTemplate V4.2 may be helpful
> for this purpose (in particular, data frames). This version of RcppTemplate
> is still in the CRAN queue, so if you decide to take a look definitely wait
> for this latest version (where complete data frame support is available).

Dominick,

I did look at RcppTemplate, but it seems that it only maps certain
objects to R.  The class I need to map is really complex and its
elements have no obvious correspondence to R objects.

Is there any way to return the pointer to a class from a .C call
safely?

Thanks,

Tamas


From tlumley at u.washington.edu  Mon Jul 24 22:38:20 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 24 Jul 2006 13:38:20 -0700 (PDT)
Subject: [Rd] persistent C++ objects
In-Reply-To: <20060724185040.GA13211@pu100877.student.princeton.edu>
References: <20060724185040.GA13211@pu100877.student.princeton.edu>
Message-ID: <Pine.LNX.4.64.0607241328030.27431@homer21.u.washington.edu>

On Mon, 24 Jul 2006, Tamas K Papp wrote:

> Hi,
>
> I am trying to create an R interface for Dynare++ [1], a k-order
> solver for rational expectation models.  I would like some advice on
> how to glue the C++ code to R.
>
> In C++, it works the following way:
>
> - a DynareModelEq object is initialized with the formulas, parses them
>  and performs k-order symbolic expansions
>
> - the user calls a member of this object multiple times with parameter
>  values (eg for MCMC), the object returns tensors
>
> An R interface could work this way:
>
> modeleq <- dynare_expand(... model description ...)
> result1 <- dynare_substitute(modeleq, par1)
> result2 <- dynare_substitute(modeleq, par2)
> etc.
>
> So the user needs to see something in R that corresponds to a C++
> object that remains in the memory between calls.  What is the proper
> way to do that?  Pass a pointer?  How do I handle that in the .C()
> calls, convert it to long int?  My C++ programming knowledge is pretty
> limited, suggestions and examples would be appreciated.

R has an external pointer type for this purpose.

> The rest (using extern "C" constructs as described in "Writing R
> Extensions") is pretty clear, except how to make R call the destructor
> of the object when the garbage collector removes it.

You can register a C finalizer for an external pointer. This is a C 
function that will be called when the object is garbage collected, so you 
can call the destructor from there.

AFAICT the only documentation for this is on the developer page, where 
there is a link to
http://www.stat.uiowa.edu/~luke/R/simpleref.html

I thought I remembered seeing something else, but I can't find anything 
now.


 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From gregor.gorjanc at bfro.uni-lj.si  Tue Jul 25 01:47:18 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 24 Jul 2006 23:47:18 +0000 (UTC)
Subject: [Rd] Package Unit Testing
References: <d35b9da60607021843j5ec840e5j3b69bde225bfa195@mail.gmail.com>
	<17576.50090.402802.304218@stat.math.ethz.ch>
Message-ID: <loom.20060725T013553-801@post.gmane.org>

Martin Maechler <maechler <at> stat.math.ethz.ch> writes:

> 
> >>>>> "miguel" == miguel manese <jjonphl <at> gmail.com>
> >>>>>     on Mon, 3 Jul 2006 09:43:12 +0800 writes:
> 
>     miguel> Hello, Do we have like an official unit testing
>     miguel> framework for packages? Like we do R CMD check, and
>     miguel> say the scripts in <pkg>/test are executed? 
> 
> yes.  Just it's  "./tests",  not './test'.
> 
> More specifically, all ./tests/*.R are executed and for those
> foobar.R for which there's a  foobar.Rout.save  file,
> the output is (R CMD Rdiff)ed agains the result of running foobar.R
> 
> All this should be pretty obvious from the manual
> "Writing R Extensions".  
> What was it in there that was not clear enough?

I just tried to find relevant information and searched the whole Writing R
Extensions manual on word test. I have find information Martin stated above,
but failed to find how *.Rout.save should be created. I think that manual 
should say that. Did I miss something obvious? I am also not able to find 
Rdiff COMMAND in man page of R under Debian.

Browsing a bit in sources reveals that *.Rout.save is copy of R session
(starts with "welcome" text and later one code and output is there).
But how does one generate such a file? Additionally, does testing also 
test the first "welcome" text - different version of R haave a bit different
"welcome" text and that should be an error then or ...

Thanks!

Gregor


From Torsten.Hothorn at rzmail.uni-erlangen.de  Tue Jul 25 10:21:01 2006
From: Torsten.Hothorn at rzmail.uni-erlangen.de (Torsten Hothorn)
Date: Tue, 25 Jul 2006 10:21:01 +0200 (CEST)
Subject: [Rd] Package Unit Testing
In-Reply-To: <loom.20060725T013553-801@post.gmane.org>
References: <d35b9da60607021843j5ec840e5j3b69bde225bfa195@mail.gmail.com>
	<17576.50090.402802.304218@stat.math.ethz.ch>
	<loom.20060725T013553-801@post.gmane.org>
Message-ID: <Pine.LNX.4.64.0607251019510.18625@imbe153.imbe.med.uni-erlangen.de>


On Mon, 24 Jul 2006, Gregor Gorjanc wrote:

> Martin Maechler <maechler <at> stat.math.ethz.ch> writes:
>
>>
>>>>>>> "miguel" == miguel manese <jjonphl <at> gmail.com>
>>>>>>>     on Mon, 3 Jul 2006 09:43:12 +0800 writes:
>>
>>     miguel> Hello, Do we have like an official unit testing
>>     miguel> framework for packages? Like we do R CMD check, and
>>     miguel> say the scripts in <pkg>/test are executed?
>>
>> yes.  Just it's  "./tests",  not './test'.
>>
>> More specifically, all ./tests/*.R are executed and for those
>> foobar.R for which there's a  foobar.Rout.save  file,
>> the output is (R CMD Rdiff)ed agains the result of running foobar.R
>>
>> All this should be pretty obvious from the manual
>> "Writing R Extensions".
>> What was it in there that was not clear enough?
>
> I just tried to find relevant information and searched the whole Writing R
> Extensions manual on word test. I have find information Martin stated above,
> but failed to find how *.Rout.save should be created. I think that manual
> should say that. Did I miss something obvious? I am also not able to find
> Rdiff COMMAND in man page of R under Debian.
>
> Browsing a bit in sources reveals that *.Rout.save is copy of R session
> (starts with "welcome" text and later one code and output is there).
> But how does one generate such a file?

either R CMD BATCH or simply run R CMD check <pkg> once and copy 
<pkg>.Rcheck/tests/*.Rout into <pkg>/tests/*Rout.save

> Additionally, does testing also
> test the first "welcome" text - different version of R haave a bit different
> "welcome" text and that should be an error then or ...

R CMD check takes care of that.

Best,

Torsten

>
> Thanks!
>
> Gregor
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From r.hankin at noc.soton.ac.uk  Tue Jul 25 11:08:32 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Tue, 25 Jul 2006 10:08:32 +0100
Subject: [Rd] pari/gp interface
Message-ID: <996C788E-4632-4BB5-A9F4-83AB02C0CE3D@soc.soton.ac.uk>

Hi

I'm developing an R package that
needs to execute some code written in pari/gp.

I've used this before from an R package (elliptic) but the interface  
is very
basic: the R function creates a string such as the following:

string <- echo ' ellwp ([ 2+0*I , 0+2*I ], 1+0*I )' | gp -q

And then

system(string)

returns the output from gp which then needs to be text processed  
(translating "I"
to "i", etc).

I don't think this approach would work under Windows.

Does anyone have any experience of calling pari/gp from R?

Or any ideas for a more portable method than the one above?




[
PARI/GP is a widely used computer algebra system designed for fast  
computations
in number theory.  It is freely available at

  http://pari.math.u-bordeaux.fr/
]


--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From ggrothendieck at gmail.com  Tue Jul 25 12:35:04 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 25 Jul 2006 06:35:04 -0400
Subject: [Rd] pari/gp interface
In-Reply-To: <996C788E-4632-4BB5-A9F4-83AB02C0CE3D@soc.soton.ac.uk>
References: <996C788E-4632-4BB5-A9F4-83AB02C0CE3D@soc.soton.ac.uk>
Message-ID: <971536df0607250335h41e265f5x32fef746c920886e@mail.gmail.com>

On Windows XP either of these work under R.  Here echo and findstr
are builtin Windows commands but you could substitute others:

   system("cmd /c echo abc | findstr a", intern = TRUE)
   shell("echo abc | findstr a", intern = TRUE)

If its necessary to special case it then note that the
R variable .Platform$OS.type equals "windows" on Windows.

On 7/25/06, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
> Hi
>
> I'm developing an R package that
> needs to execute some code written in pari/gp.
>
> I've used this before from an R package (elliptic) but the interface
> is very
> basic: the R function creates a string such as the following:
>
> string <- echo ' ellwp ([ 2+0*I , 0+2*I ], 1+0*I )' | gp -q
>
> And then
>
> system(string)
>
> returns the output from gp which then needs to be text processed
> (translating "I"
> to "i", etc).
>
> I don't think this approach would work under Windows.
>
> Does anyone have any experience of calling pari/gp from R?
>
> Or any ideas for a more portable method than the one above?
>
>
>
>
> [
> PARI/GP is a widely used computer algebra system designed for fast
> computations
> in number theory.  It is freely available at
>
>  http://pari.math.u-bordeaux.fr/
> ]
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>  tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From gregor.gorjanc at bfro.uni-lj.si  Tue Jul 25 13:04:43 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 25 Jul 2006 13:04:43 +0200
Subject: [Rd] Package Unit Testing
In-Reply-To: <Pine.LNX.4.64.0607251019510.18625@imbe153.imbe.med.uni-erlangen.de>
References: <d35b9da60607021843j5ec840e5j3b69bde225bfa195@mail.gmail.com>
	<17576.50090.402802.304218@stat.math.ethz.ch>
	<loom.20060725T013553-801@post.gmane.org>
	<Pine.LNX.4.64.0607251019510.18625@imbe153.imbe.med.uni-erlangen.de>
Message-ID: <44C5FACB.1080500@bfro.uni-lj.si>

Torsten Hothorn wrote:
...
>> Browsing a bit in sources reveals that *.Rout.save is copy of R session
>> (starts with "welcome" text and later one code and output is there).
>> But how does one generate such a file?
> 
> either R CMD BATCH or simply run R CMD check <pkg> once and copy
> <pkg>.Rcheck/tests/*.Rout into <pkg>/tests/*Rout.save
> 
>> Additionally, does testing also
>> test the first "welcome" text - different version of R haave a bit
>> different
>> "welcome" text and that should be an error then or ...
> 
> R CMD check takes care of that.

Thank you. I am also attaching a small gzipped patch for R-exts.texi. I
did not wrap the lines in the text. If that is necesarry I can do it and
resend the patch.

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.
----------------------------------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: R-exts.texi-tests-patch.gz
Type: application/x-gzip
Size: 435 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060725/dfd8bb28/attachment.gz 

From gregor.gorjanc at bfro.uni-lj.si  Tue Jul 25 13:01:00 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 25 Jul 2006 11:01:00 +0000 (UTC)
Subject: [Rd] Making a patch
References: <20060723220410.GI59927@ms.unimelb.edu.au>
	<loom.20060724T013432-266@post.gmane.org>
Message-ID: <loom.20060725T125923-264@post.gmane.org>

Gregor Gorjanc <gregor.gorjanc <at> bfro.uni-lj.si> writes:

> 
> Hi,
> 
> Andrew Robinson <A.Robinson <at> ms.unimelb.edu.au> writes:
> > 
> > Dear R developers,
> > 
> > is there a preferred format or strategy for making a patch to
> > contribute to a package that is maintained by R-core?  Berwin Turlach
...
> 
> look at 
> 
> http://article.gmane.org/gmane.comp.lang.r.devel/8858

Is there also any strategy in accepting patches in plain text or "somehow
compressed" format? The later due to line wrapping in some mailers, etc.

Thanks!

Gregor


From hin-tak.leung at cimr.cam.ac.uk  Tue Jul 25 14:40:56 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Tue, 25 Jul 2006 13:40:56 +0100
Subject: [Rd] R and ACML
In-Reply-To: <44C5118A.1040903@verizon.net>
References: <44C50678.1000009@cornell.edu> <44C5118A.1040903@verizon.net>
Message-ID: <44C61158.3010003@cimr.cam.ac.uk>

Evan Cooch wrote:
> I lie (apparently) - turns out step (7) (below) *did* work.
> 
> OK, so why didn't previous attempts at the problem (i.e., using 
> LD_LIBRARY_PATH) work? Hmmm....

LD_LIBRARY_PATH affects runtime behavior, ./configure ... affects
compile time behavior. The former can only influence the latter
to the extent that the runtime environment of temporary tools
built during the configure stage (./configure runs the compiler and 
build some small binaries, etc and check stuff by whether the compiler 
was successful and running these small binaries and see the results)
are affected.

Apples and oranges.

HTL

>> 7. one final attempt:
>>
>> ./configure --with-blas="-L/opt/acml3.5.0/gnu64/lib -lacml"
>>
>> No change - readline is still the only
>>
>>
>>
>>
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From cooch17 at verizon.net  Tue Jul 25 15:53:37 2006
From: cooch17 at verizon.net (Evan Cooch)
Date: Tue, 25 Jul 2006 09:53:37 -0400
Subject: [Rd] R and ACML
In-Reply-To: <44C61158.3010003@cimr.cam.ac.uk>
References: <44C50678.1000009@cornell.edu> <44C5118A.1040903@verizon.net>
	<44C61158.3010003@cimr.cam.ac.uk>
Message-ID: <44C62261.2060505@verizon.net>

Hin-Tak Leung wrote:
> Evan Cooch wrote:
>> I lie (apparently) - turns out step (7) (below) *did* work.
>>
>> OK, so why didn't previous attempts at the problem (i.e., using 
>> LD_LIBRARY_PATH) work? Hmmm....
>
> LD_LIBRARY_PATH affects runtime behavior, ./configure ... affects
> compile time behavior. The former can only influence the latter
> to the extent that the runtime environment of temporary tools
> built during the configure stage (./configure runs the compiler and 
> build some small binaries, etc and check stuff by whether the compiler 
> was successful and running these small binaries and see the results)
> are affected.
>
> Apples and oranges.
>
> HTL

Thanks very much for the clarification.


From charlie at stat.umn.edu  Tue Jul 25 17:18:25 2006
From: charlie at stat.umn.edu (charlie at stat.umn.edu)
Date: Tue, 25 Jul 2006 17:18:25 +0200 (CEST)
Subject: [Rd] valgrind complains about save (PR#9096)
Message-ID: <20060725151825.4F1D1DEFA@slim.kubism.ku.dk>

valgrind complains about the save command in R 2.3.1 as shown by the
script included below.  Of course, I don't know whether this "Conditional
jump or move depends on uninitialised value(s)" is really a bug.
Experience with similar issues in my own code says it may be, but it
is also hard to tell.  Having no familiarity with the code cited
in deflate.c, I leave the issue to experts.  Just thought someone
should know.  Note that despite the printout in foo.Rout being a bit
unclear about exactly where the purported bug occurs, there is no error
reported in bar.Rout which does not have the save command.

Irrelevant to the bug, but this was originally spotted when package
checking the aster package, which happened to have a save in tests/predict.R.

Script started on Tue 25 Jul 2006 09:59:59 AM CDT
oak$ cat /etc/SuSE-release
SUSE LINUX 10.1 (X86-64)
VERSION = 10.1
oak$ export VALGRIND_OPTS="--tool=memcheck"
oak$ R CMD BATCH --vanilla --debugger=valgrind foo.R
oak$ R CMD BATCH --vanilla --debugger=valgrind bar.R
oak$ cat foo.R

 foo <- 2
 save(foo, file = "foo.Rdata")

oak$ cat foo.Rout
==13521== Memcheck, a memory error detector.
==13521== Copyright (C) 2002-2005, and GNU GPL'd, by Julian Seward et al.
==13521== Using LibVEX rev 1575, a library for dynamic binary translation.
==13521== Copyright (C) 2004-2005, and GNU GPL'd, by OpenWorks LLP.
==13521== Using valgrind-3.1.1, a dynamic binary instrumentation framework.
==13521== Copyright (C) 2000-2005, and GNU GPL'd, by Julian Seward et al.
==13521== For more details, rerun with: -v
==13521== 

R : Copyright 2006, The R Foundation for Statistical Computing
Version 2.3.1 (2006-06-01)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

==13521== Conditional jump or move depends on uninitialised value(s)
==13521==    at 0x5D2740: longest_match (deflate.c:1121)
==13521==    by 0x5D3BB6: deflate_slow (deflate.c:1595)
==13521==    by 0x5D30EB: deflate (deflate.c:790)
==13521==    by 0x5D4D21: do_flush (gzio.c:757)
==13521==    by 0x5D4F39: gzclose (gzio.c:991)
==13521==    by 0x44AC22: gzfile_close (connections.c:1035)
==13521==    by 0x44A703: con_close1 (connections.c:2256)
==13521==    by 0x44A742: con_close (connections.c:2283)
==13521==    by 0x44D3A3: do_close (connections.c:2303)
==13521==    by 0x4C43BB: do_internal (names.c:1089)
==13521==    by 0x4978F5: Rf_eval (eval.c:398)
==13521==    by 0x497F0D: Rf_evalList (eval.c:1400)
> invisible(options(echo = TRUE))
> 
>  foo <- 2
>  save(foo, file = "foo.Rdata")
> 
> 
> proc.time()
[1] 22.509  0.216 21.774  0.004  0.004
> 
==13521== 
==13521== ERROR SUMMARY: 9 errors from 1 contexts (suppressed: 12 from 1)
==13521== malloc/free: in use at exit: 22,019,365 bytes in 10,911 blocks.
==13521== malloc/free: 37,822 allocs, 26,911 frees, 55,922,125 bytes allocated.
==13521== For counts of detected errors, rerun with: -v
==13521== searching for pointers to 10,911 not-freed blocks.
==13521== checked 18,666,336 bytes.
==13521== 
==13521== LEAK SUMMARY:
==13521==    definitely lost: 667 bytes in 35 blocks.
==13521==      possibly lost: 0 bytes in 0 blocks.
==13521==    still reachable: 22,018,698 bytes in 10,876 blocks.
==13521==         suppressed: 0 bytes in 0 blocks.
==13521== Use --leak-check=full to see details of leaked memory.
oak$ cat bar.R

 foo <- 2

oak$ cat bar.Rout
==13534== Memcheck, a memory error detector.
==13534== Copyright (C) 2002-2005, and GNU GPL'd, by Julian Seward et al.
==13534== Using LibVEX rev 1575, a library for dynamic binary translation.
==13534== Copyright (C) 2004-2005, and GNU GPL'd, by OpenWorks LLP.
==13534== Using valgrind-3.1.1, a dynamic binary instrumentation framework.
==13534== Copyright (C) 2000-2005, and GNU GPL'd, by Julian Seward et al.
==13534== For more details, rerun with: -v
==13534== 

R : Copyright 2006, The R Foundation for Statistical Computing
Version 2.3.1 (2006-06-01)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> invisible(options(echo = TRUE))
> 
>  foo <- 2
> 
> 
> proc.time()
[1] 22.169  0.204 21.422  0.004  0.004
> 
==13534== 
==13534== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 12 from 1)
==13534== malloc/free: in use at exit: 21,998,613 bytes in 10,896 blocks.
==13534== malloc/free: 37,788 allocs, 26,892 frees, 55,576,442 bytes allocated.
==13534== For counts of detected errors, rerun with: -v
==13534== searching for pointers to 10,896 not-freed blocks.
==13534== checked 18,645,696 bytes.
==13534== 
==13534== LEAK SUMMARY:
==13534==    definitely lost: 667 bytes in 35 blocks.
==13534==      possibly lost: 0 bytes in 0 blocks.
==13534==    still reachable: 21,997,946 bytes in 10,861 blocks.
==13534==         suppressed: 0 bytes in 0 blocks.
==13534== Use --leak-check=full to see details of leaked memory.
oak$ exit

Script done on Tue 25 Jul 2006 10:03:20 AM CDT
-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From ripley at stats.ox.ac.uk  Tue Jul 25 17:44:42 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 25 Jul 2006 17:44:42 +0200 (CEST)
Subject: [Rd] valgrind complains about save (PR#9096)
Message-ID: <20060725154442.5CD35EF02@slim.kubism.ku.dk>

Please read the src/extra/zlib/deflate.c from line 1078: this is 
deliberate use of lookahead and explained there.  Valgrind is making a 
correct comment but the report is not of an error.

On Tue, 25 Jul 2006, charlie at stat.umn.edu wrote:

> valgrind complains about the save command in R 2.3.1 as shown by the
> script included below.  Of course, I don't know whether this "Conditional
> jump or move depends on uninitialised value(s)" is really a bug.
> Experience with similar issues in my own code says it may be, but it
> is also hard to tell.  Having no familiarity with the code cited
> in deflate.c, I leave the issue to experts.  Just thought someone
> should know.  Note that despite the printout in foo.Rout being a bit
> unclear about exactly where the purported bug occurs, there is no error
> reported in bar.Rout which does not have the save command.
> 
> Irrelevant to the bug, but this was originally spotted when package
> checking the aster package, which happened to have a save in tests/predict.R.
> 
> Script started on Tue 25 Jul 2006 09:59:59 AM CDT
> oak$ cat /etc/SuSE-release
> SUSE LINUX 10.1 (X86-64)
> VERSION = 10.1
> oak$ export VALGRIND_OPTS="--tool=memcheck"
> oak$ R CMD BATCH --vanilla --debugger=valgrind foo.R
> oak$ R CMD BATCH --vanilla --debugger=valgrind bar.R
> oak$ cat foo.R
> 
>  foo <- 2
>  save(foo, file = "foo.Rdata")
> 
> oak$ cat foo.Rout
> ==13521== Memcheck, a memory error detector.
> ==13521== Copyright (C) 2002-2005, and GNU GPL'd, by Julian Seward et al.
> ==13521== Using LibVEX rev 1575, a library for dynamic binary translation.
> ==13521== Copyright (C) 2004-2005, and GNU GPL'd, by OpenWorks LLP.
> ==13521== Using valgrind-3.1.1, a dynamic binary instrumentation framework.
> ==13521== Copyright (C) 2000-2005, and GNU GPL'd, by Julian Seward et al.
> ==13521== For more details, rerun with: -v
> ==13521== 
> 
> R : Copyright 2006, The R Foundation for Statistical Computing
> Version 2.3.1 (2006-06-01)
> ISBN 3-900051-07-0
> 
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
> 
>   Natural language support but running in an English locale
> 
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
> 
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
> 
> ==13521== Conditional jump or move depends on uninitialised value(s)
> ==13521==    at 0x5D2740: longest_match (deflate.c:1121)
> ==13521==    by 0x5D3BB6: deflate_slow (deflate.c:1595)
> ==13521==    by 0x5D30EB: deflate (deflate.c:790)
> ==13521==    by 0x5D4D21: do_flush (gzio.c:757)
> ==13521==    by 0x5D4F39: gzclose (gzio.c:991)
> ==13521==    by 0x44AC22: gzfile_close (connections.c:1035)
> ==13521==    by 0x44A703: con_close1 (connections.c:2256)
> ==13521==    by 0x44A742: con_close (connections.c:2283)
> ==13521==    by 0x44D3A3: do_close (connections.c:2303)
> ==13521==    by 0x4C43BB: do_internal (names.c:1089)
> ==13521==    by 0x4978F5: Rf_eval (eval.c:398)
> ==13521==    by 0x497F0D: Rf_evalList (eval.c:1400)
> > invisible(options(echo = TRUE))
> > 
> >  foo <- 2
> >  save(foo, file = "foo.Rdata")
> > 
> > 
> > proc.time()
> [1] 22.509  0.216 21.774  0.004  0.004
> > 
> ==13521== 
> ==13521== ERROR SUMMARY: 9 errors from 1 contexts (suppressed: 12 from 1)
> ==13521== malloc/free: in use at exit: 22,019,365 bytes in 10,911 blocks.
> ==13521== malloc/free: 37,822 allocs, 26,911 frees, 55,922,125 bytes allocated.
> ==13521== For counts of detected errors, rerun with: -v
> ==13521== searching for pointers to 10,911 not-freed blocks.
> ==13521== checked 18,666,336 bytes.
> ==13521== 
> ==13521== LEAK SUMMARY:
> ==13521==    definitely lost: 667 bytes in 35 blocks.
> ==13521==      possibly lost: 0 bytes in 0 blocks.
> ==13521==    still reachable: 22,018,698 bytes in 10,876 blocks.
> ==13521==         suppressed: 0 bytes in 0 blocks.
> ==13521== Use --leak-check=full to see details of leaked memory.
> oak$ cat bar.R
> 
>  foo <- 2
> 
> oak$ cat bar.Rout
> ==13534== Memcheck, a memory error detector.
> ==13534== Copyright (C) 2002-2005, and GNU GPL'd, by Julian Seward et al.
> ==13534== Using LibVEX rev 1575, a library for dynamic binary translation.
> ==13534== Copyright (C) 2004-2005, and GNU GPL'd, by OpenWorks LLP.
> ==13534== Using valgrind-3.1.1, a dynamic binary instrumentation framework.
> ==13534== Copyright (C) 2000-2005, and GNU GPL'd, by Julian Seward et al.
> ==13534== For more details, rerun with: -v
> ==13534== 
> 
> R : Copyright 2006, The R Foundation for Statistical Computing
> Version 2.3.1 (2006-06-01)
> ISBN 3-900051-07-0
> 
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
> 
>   Natural language support but running in an English locale
> 
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
> 
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
> 
> > invisible(options(echo = TRUE))
> > 
> >  foo <- 2
> > 
> > 
> > proc.time()
> [1] 22.169  0.204 21.422  0.004  0.004
> > 
> ==13534== 
> ==13534== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 12 from 1)
> ==13534== malloc/free: in use at exit: 21,998,613 bytes in 10,896 blocks.
> ==13534== malloc/free: 37,788 allocs, 26,892 frees, 55,576,442 bytes allocated.
> ==13534== For counts of detected errors, rerun with: -v
> ==13534== searching for pointers to 10,896 not-freed blocks.
> ==13534== checked 18,645,696 bytes.
> ==13534== 
> ==13534== LEAK SUMMARY:
> ==13534==    definitely lost: 667 bytes in 35 blocks.
> ==13534==      possibly lost: 0 bytes in 0 blocks.
> ==13534==    still reachable: 21,997,946 bytes in 10,861 blocks.
> ==13534==         suppressed: 0 bytes in 0 blocks.
> ==13534== Use --leak-check=full to see details of leaked memory.
> oak$ exit
> 
> Script done on Tue 25 Jul 2006 10:03:20 AM CDT
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tplate at acm.org  Tue Jul 25 18:10:25 2006
From: tplate at acm.org (Tony Plate)
Date: Tue, 25 Jul 2006 10:10:25 -0600
Subject: [Rd] Making a patch
In-Reply-To: <44C4A1A3.1000905@stats.uwo.ca>
References: <20060723220410.GI59927@ms.unimelb.edu.au>
	<44C4A1A3.1000905@stats.uwo.ca>
Message-ID: <44C64271.7000209@acm.org>

I've tried to summarize the information in this thread into a Wiki page: 
http://wiki.r-project.org/rwiki/doku.php?id=misc:rpatch

Please make an additions or alterations as appropriate!

-- Tony Plate

Duncan Murdoch wrote:
> On 7/23/2006 6:04 PM, Andrew Robinson wrote:
> 
>>Dear R developers,
>>
>>is there a preferred format or strategy for making a patch to
>>contribute to a package that is maintained by R-core?  Berwin Turlach
>>and I have written a very minor extension to lmeControl to allow it to
>>pass an argument to nlminb for the maximum number of evaluations of
>>the objective function.  I've edited the nlme/R/lme.R and
>>nlme/man/lmeControl.Rd files.  I can diff the files, but the options
>>seem numerous.  I haven't been able to find any hinst on the preferred
>>approach.  Any advice would be welcomed.
> 
> 
> Gregor pointed out a description of the suggested format.  But the 
> strategy is also important:  in order for your patch to be incorporated, 
> you need to convince someone to accept it.  To do that, you should post 
> the following sort of information along with your patch:
> 
>   - what the patch does
>   - what problem it solves
>   - what problems it may cause
> 
> You should also make sure your patch is complete, e.g. if it changes 
> lmeControl, then you should also include a patch to the documentation 
> for lmeControl.
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From tplate at acm.org  Tue Jul 25 19:25:02 2006
From: tplate at acm.org (Tony Plate)
Date: Tue, 25 Jul 2006 11:25:02 -0600
Subject: [Rd] obscure bug in format.default?
Message-ID: <44C653EE.7060008@acm.org>

Output from format.default sometimes has whitespace around it when using 
big.mark="," and trim=TRUE.  E.g.:

 > # works ok as long as big.mark is not actually used:
 > format(c(-1,1,10,999), big.mark=",", trim=TRUE)
[1] "-1"  "1"   "10"  "999"
 > # but if big.mark is used, output is justified and not trimmed:
 > format(c(-1,1,10,999,1e6), big.mark=",", trim=TRUE)
[1] "       -1" "        1" "       10" "      999" "1,000,000"
 >

I am unable to come up with any interpretation of the documentation for 
format.default under which this output could be considered correct, so I 
suspect this behavior should be classified as a bug.

The last call to 'prettyNum' in format.default has the argument

   preserve.width = "common"

If this is changed to

   preserve.width = if (trim) "individual" else "common"

then output is formatted correctly in the case above.

-- Tony Plate

 > sessionInfo()
Version 2.3.1 (2006-06-01)
i386-pc-mingw32

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
[7] "base"
 >


From hb at stat.berkeley.edu  Tue Jul 25 22:33:56 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 25 Jul 2006 13:33:56 -0700
Subject: [Rd] pari/gp interface
In-Reply-To: <996C788E-4632-4BB5-A9F4-83AB02C0CE3D@soc.soton.ac.uk>
References: <996C788E-4632-4BB5-A9F4-83AB02C0CE3D@soc.soton.ac.uk>
Message-ID: <59d7961d0607251333n3f074f9aof1ae28722331f20e@mail.gmail.com>

On 7/25/06, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
> Hi
>
> I'm developing an R package that
> needs to execute some code written in pari/gp.
>
> I've used this before from an R package (elliptic) but the interface
> is very
> basic: the R function creates a string such as the following:
>
> string <- echo ' ellwp ([ 2+0*I , 0+2*I ], 1+0*I )' | gp -q
>
> And then
>
> system(string)
>
> returns the output from gp which then needs to be text processed
> (translating "I"
> to "i", etc).
>
> I don't think this approach would work under Windows.

I know nothing about pari/gp, but I believe it does work on Windows
too.  There is system() command available on the Windows version too,
but with slightly different arguments (than on Linux say).

Piping is available on Windows too, e.g. "dir | sort", although you
should be able to get around that by writing to file instead and using
">" and "<".

You should be careful if your 'string' gets really long.  Then it is
much better to have a BAT file (and an sh file on Linux) to run your
external calls, alternatively you call system() multiple times.
However, I would be suprised if 'ellwp' wouldn't accept files as input
too.

/Henrik

> Does anyone have any experience of calling pari/gp from R?
>
> Or any ideas for a more portable method than the one above?
>
>
>
>
> [
> PARI/GP is a widely used computer algebra system designed for fast
> computations
> in number theory.  It is freely available at
>
>   http://pari.math.u-bordeaux.fr/
> ]
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From btyner at stat.purdue.edu  Wed Jul 26 04:17:21 2006
From: btyner at stat.purdue.edu (btyner at stat.purdue.edu)
Date: Wed, 26 Jul 2006 04:17:21 +0200 (CEST)
Subject: [Rd] mean(NA) returns -(1+.Machine$integer.max) (PR#9097)
Message-ID: <20060726021721.04906183A6@slim.kubism.ku.dk>

Full_Name: Benjamin Tyner
Version: 2.3.0
OS: linux-gnu (debian)
Submission from: (NULL) (71.98.75.54)


> mean(NA)
returns -2147483648 on my system, which is -(1+.Machine$integer.max) 

> sessionInfo()
Version 2.3.0 (2006-04-24)
i686-pc-linux-gnu

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
[7] "base"


From edd at debian.org  Wed Jul 26 06:02:27 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 25 Jul 2006 23:02:27 -0500
Subject: [Rd] mean(NA) returns -(1+.Machine$integer.max) (PR#9097)
In-Reply-To: <20060726021721.04906183A6@slim.kubism.ku.dk>
References: <20060726021721.04906183A6@slim.kubism.ku.dk>
Message-ID: <17606.59731.313821.685414@basebud.nulle.part>


On 26 July 2006 at 04:17, btyner at stat.purdue.edu wrote:
| Full_Name: Benjamin Tyner
| Version: 2.3.0
| OS: linux-gnu (debian)
| Submission from: (NULL) (71.98.75.54)
| 
| 
| > mean(NA)
| returns -2147483648 on my system, which is -(1+.Machine$integer.max) 

There is quite possibly something wrong with your libraries.  Did you build
this yourself, or is it Christian's backport for Debian stable, or is it a
regular Debian build?  What happens if you upgrade to Christian's (from CRAN
and its mirrors) or my (Debian mirrors) build of the current version 2.3.1 ?

edd at basebud:~> dpkg -l r-base-core | grep "^ii" | cut -c-78
ii  r-base-core    2.3.1-1        GNU R core of statistical computing language
edd at basebud:~> R --quiet
> mean(NA)
[1] NA
> q("no")
edd at basebud:~>  

All fine here.

Dirk


| 
| > sessionInfo()
| Version 2.3.0 (2006-04-24)
| i686-pc-linux-gnu
| 
| attached base packages:
| [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
| [7] "base"
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From ripley at stats.ox.ac.uk  Wed Jul 26 06:54:51 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 26 Jul 2006 06:54:51 +0200 (CEST)
Subject: [Rd] mean(NA) returns -(1+.Machine$integer.max) (PR#9097)
Message-ID: <20060726045451.0423A19950@slim.kubism.ku.dk>

That happened in 2.3.0 only, and we do ask people not to report on 
obselete versions of R.

>From the NEWS for 2.3.1

    o	mean() on an integer (or logical) vector was treating NAs as
	actual values (unless na.rm = TRUE).

and the actual value is the largest negative integer, usually -2147483648.

On Tue, 25 Jul 2006, Dirk Eddelbuettel wrote:

> 
> On 26 July 2006 at 04:17, btyner at stat.purdue.edu wrote:
> | Full_Name: Benjamin Tyner
> | Version: 2.3.0
> | OS: linux-gnu (debian)
> | Submission from: (NULL) (71.98.75.54)
> | 
> | 
> | > mean(NA)
> | returns -2147483648 on my system, which is -(1+.Machine$integer.max) 
> 
> There is quite possibly something wrong with your libraries.  Did you build
> this yourself, or is it Christian's backport for Debian stable, or is it a
> regular Debian build?  What happens if you upgrade to Christian's (from CRAN
> and its mirrors) or my (Debian mirrors) build of the current version 2.3.1 ?
> 
> edd at basebud:~> dpkg -l r-base-core | grep "^ii" | cut -c-78
> ii  r-base-core    2.3.1-1        GNU R core of statistical computing language
> edd at basebud:~> R --quiet
> > mean(NA)
> [1] NA
> > q("no")
> edd at basebud:~>  
> 
> All fine here.
> 
> Dirk
> 
> 
> | 
> | > sessionInfo()
> | Version 2.3.0 (2006-04-24)
> | i686-pc-linux-gnu
> | 
> | attached base packages:
> | [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
> | [7] "base"
> | 
> | ______________________________________________
> | R-devel at r-project.org mailing list
> | https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jul 26 07:15:01 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Jul 2006 06:15:01 +0100 (BST)
Subject: [Rd] pari/gp interface
In-Reply-To: <59d7961d0607251333n3f074f9aof1ae28722331f20e@mail.gmail.com>
References: <996C788E-4632-4BB5-A9F4-83AB02C0CE3D@soc.soton.ac.uk>
	<59d7961d0607251333n3f074f9aof1ae28722331f20e@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0607260607170.29157@gannet.stats.ox.ac.uk>

The issue is that system() on Windows does not run a shell, so piping is 
not going to be available: used shell() instead.   Then the problem is 
that the shell available is OS-specific, and pretty minimal on Windows 
95/98/ME.  If you can ignore those (and they are getting rarer), cmd.exe 
can be assumed for use of shell().

echo is not a standard system command on Windows either, and in a shell 
does not do what it does on Unix.

On Tue, 25 Jul 2006, Henrik Bengtsson wrote:

> On 7/25/06, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
> > Hi
> >
> > I'm developing an R package that
> > needs to execute some code written in pari/gp.
> >
> > I've used this before from an R package (elliptic) but the interface
> > is very
> > basic: the R function creates a string such as the following:
> >
> > string <- echo ' ellwp ([ 2+0*I , 0+2*I ], 1+0*I )' | gp -q
> >
> > And then
> >
> > system(string)
> >
> > returns the output from gp which then needs to be text processed
> > (translating "I"
> > to "i", etc).
> >
> > I don't think this approach would work under Windows.
> 
> I know nothing about pari/gp, but I believe it does work on Windows
> too.  There is system() command available on the Windows version too,
> but with slightly different arguments (than on Linux say).
> 
> Piping is available on Windows too, e.g. "dir | sort", although you
> should be able to get around that by writing to file instead and using
> ">" and "<".

Did you try that?  dir is not an executable under Windows (a shell 
command), and it does not work even if you use an executable.  You do need 
to use shell()

> 
> You should be careful if your 'string' gets really long.  Then it is
> much better to have a BAT file (and an sh file on Linux) to run your
> external calls, alternatively you call system() multiple times.
> However, I would be suprised if 'ellwp' wouldn't accept files as input
> too.
> 
> /Henrik
> 
> > Does anyone have any experience of calling pari/gp from R?
> >
> > Or any ideas for a more portable method than the one above?
> >
> >
> >
> >
> > [
> > PARI/GP is a widely used computer algebra system designed for fast
> > computations
> > in number theory.  It is freely available at
> >
> >   http://pari.math.u-bordeaux.fr/
> > ]
> >
> >
> > --
> > Robin Hankin
> > Uncertainty Analyst
> > National Oceanography Centre, Southampton
> > European Way, Southampton SO14 3ZH, UK
> >   tel  023-8059-7743
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ldimitro at wfubmc.edu  Wed Jul 26 07:33:14 2006
From: ldimitro at wfubmc.edu (Latchezar Dimitrov)
Date: Wed, 26 Jul 2006 01:33:14 -0400
Subject: [Rd] Install R-patched_2006-07-13 on i386-pc-solaris2.10 with Sun
	Studio 11
Message-ID: <F160BE32A2E5E04497668BBDFE83FEDF11CF7F6B@EXCHVS1.medctr.ad.wfubmc.edu>

Dear R-developers:

I'm trying to build a 64-bit R-patched_2006-07-24 on SunFire V40z with
on Solaris OS 10 64-bit kernel and using Sun Studio 11 compilers.
Everything runs OK until it gets to building package tools (all.R) where
it fails. Bellow is how I tried it (I can provide any other additional
info if needed). Any help please?

Thank you very much

Latchezar Dimitrov
Wake Forest Univ. School of Medicine



root at Huba #   echo   $PATH
/opt/SUNWspro/bin:/usr/sbin:/usr/bin:/usr/openwin/bin:/usr/ccs/bin:/usr/
openwin/bin:/usr/dt/bin:/usr/platform/i86pc/sbin:/opt/SUNWvts/bin:/opt/S
UNWexplo/bin:/usr/local/bin
root at Huba #   echo   $CC
cc
root at Huba #   echo   $CXX
CC
root at Huba #   echo   $CFLAGS
-xarch=amd64 -xmodel=medium
root at Huba #   echo   $CXXFLAGS
-xarch=amd64 -xmodel=medium
root at Huba #   echo   $FCFLAGS
-xarch=amd64 -xmodel=medium
root at Huba #   echo   $FFLAGS
-xarch=amd64 -xmodel=medium
root at Huba #   echo   $LDFLAGS
-xarch=amd64 -xmodel=medium
root at Huba #   echo   $R_BROWSER
/usr/sfw/bin/mozilla
root at Huba #   echo   $r_arch
amd64
root at Huba #   echo   $LD_LIBRARY_PATH
/usr/openwin/lib:/usr/local/gcc-4.1.1-x86-bootstrap/lib/gcc/i386-pc-sola
ris2.10/4.1.1/amd64:/usr/local/lib:/usr/local/gcc-4.1.1-x86-bootstrap/li
b/gcc/i386-pc-solaris2.10/4.1.1/amd64:/usr/local/lib:/usr/local/gcc-4.1.
1-x86-bootstrap/lib/gcc/i386-pc-solaris2.10/4.1.1/amd64:/usr/local/lib
root at Huba # 


../src/R-patched_2006-07-24/configure
--prefix=/opt/R-2.3.1-patched_2006-07-24-Sun_Studio_11 --with-readline
--disable-mbcs R_PAPERSIZE=letter --disable-rpath --with-bzlib
--with-zlib --with-spcre --with-tcltk --disable-R-profiling
--disable-nls



Error in parseNamespaceFile(package, package.lib, mustExist = FALSE) : 
        subscript out of bounds
Execution halted
*** Error code 1
The following command caused the error:
(cat
../../../../src/R-patched_2006-07-24/src/library/tools/R/makeLazyLoad.R;
\
  echo "makeLazyLoading(\"tools\")") | \
  R_DEFAULT_PACKAGES=NULL LC_COLLATE=C ../../../bin/R --vanilla --slave
> /dev/null
dmake: Fatal error: Command failed for target `all'
Current working directory /export/data/obj-R/src/library/tools
*** Error code 1
The following command caused the error:
for pkg in profile base tools utils grDevices graphics stats datasets
methods grid splines stats4 tcltk; do \
  (cd ${pkg} && dmake) || exit 1; \
done
dmake: Fatal error: Command failed for target `R'
Current working directory /export/data/obj-R/src/library
*** Error code 1
The following command caused the error:
for d in scripts include extra appl nmath unix main modules library; do
\
  (cd ${d} && dmake R) || exit 1; \
done
dmake: Fatal error: Command failed for target `R'
Current working directory /export/data/obj-R/src
*** Error code 1
The following command caused the error:
for d in m4 tools doc etc share src tests; do \
  (cd ${d} && dmake R) || exit 1; \
done
dmake: Fatal error: Command failed for target `R'
root at Huba #


From ripley at stats.ox.ac.uk  Wed Jul 26 08:37:21 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Jul 2006 07:37:21 +0100 (BST)
Subject: [Rd] Install R-patched_2006-07-13 on i386-pc-solaris2.10 with
 Sun Studio 11
In-Reply-To: <F160BE32A2E5E04497668BBDFE83FEDF11CF7F6B@EXCHVS1.medctr.ad.wfubmc.edu>
References: <F160BE32A2E5E04497668BBDFE83FEDF11CF7F6B@EXCHVS1.medctr.ad.wfubmc.edu>
Message-ID: <Pine.LNX.4.64.0607260735570.32047@gannet.stats.ox.ac.uk>

On Wed, 26 Jul 2006, Latchezar Dimitrov wrote:

> Dear R-developers:
> 
> I'm trying to build a 64-bit R-patched_2006-07-24 on SunFire V40z with
> on Solaris OS 10 64-bit kernel and using Sun Studio 11 compilers.
> Everything runs OK until it gets to building package tools (all.R) where
> it fails. Bellow is how I tried it (I can provide any other additional
> info if needed). Any help please?

You seem to have gcc 4.1.1 in your paths, so can you try that instead.

This looks like a fairly fundamental problem with your current build,
possibly a mis-compile.

> 
> Thank you very much
> 
> Latchezar Dimitrov
> Wake Forest Univ. School of Medicine
> 
> 
> 
> root at Huba #   echo   $PATH
> /opt/SUNWspro/bin:/usr/sbin:/usr/bin:/usr/openwin/bin:/usr/ccs/bin:/usr/
> openwin/bin:/usr/dt/bin:/usr/platform/i86pc/sbin:/opt/SUNWvts/bin:/opt/S
> UNWexplo/bin:/usr/local/bin
> root at Huba #   echo   $CC
> cc
> root at Huba #   echo   $CXX
> CC
> root at Huba #   echo   $CFLAGS
> -xarch=amd64 -xmodel=medium
> root at Huba #   echo   $CXXFLAGS
> -xarch=amd64 -xmodel=medium
> root at Huba #   echo   $FCFLAGS
> -xarch=amd64 -xmodel=medium
> root at Huba #   echo   $FFLAGS
> -xarch=amd64 -xmodel=medium
> root at Huba #   echo   $LDFLAGS
> -xarch=amd64 -xmodel=medium
> root at Huba #   echo   $R_BROWSER
> /usr/sfw/bin/mozilla
> root at Huba #   echo   $r_arch
> amd64
> root at Huba #   echo   $LD_LIBRARY_PATH
> /usr/openwin/lib:/usr/local/gcc-4.1.1-x86-bootstrap/lib/gcc/i386-pc-sola
> ris2.10/4.1.1/amd64:/usr/local/lib:/usr/local/gcc-4.1.1-x86-bootstrap/li
> b/gcc/i386-pc-solaris2.10/4.1.1/amd64:/usr/local/lib:/usr/local/gcc-4.1.
> 1-x86-bootstrap/lib/gcc/i386-pc-solaris2.10/4.1.1/amd64:/usr/local/lib
> root at Huba # 
> 
> 
> ../src/R-patched_2006-07-24/configure
> --prefix=/opt/R-2.3.1-patched_2006-07-24-Sun_Studio_11 --with-readline
> --disable-mbcs R_PAPERSIZE=letter --disable-rpath --with-bzlib
> --with-zlib --with-spcre --with-tcltk --disable-R-profiling
> --disable-nls
> 
> 
> 
> Error in parseNamespaceFile(package, package.lib, mustExist = FALSE) : 
>         subscript out of bounds
> Execution halted
> *** Error code 1
> The following command caused the error:
> (cat
> ../../../../src/R-patched_2006-07-24/src/library/tools/R/makeLazyLoad.R;
> \
>   echo "makeLazyLoading(\"tools\")") | \
>   R_DEFAULT_PACKAGES=NULL LC_COLLATE=C ../../../bin/R --vanilla --slave
> > /dev/null
> dmake: Fatal error: Command failed for target `all'
> Current working directory /export/data/obj-R/src/library/tools
> *** Error code 1
> The following command caused the error:
> for pkg in profile base tools utils grDevices graphics stats datasets
> methods grid splines stats4 tcltk; do \
>   (cd ${pkg} && dmake) || exit 1; \
> done
> dmake: Fatal error: Command failed for target `R'
> Current working directory /export/data/obj-R/src/library
> *** Error code 1
> The following command caused the error:
> for d in scripts include extra appl nmath unix main modules library; do
> \
>   (cd ${d} && dmake R) || exit 1; \
> done
> dmake: Fatal error: Command failed for target `R'
> Current working directory /export/data/obj-R/src
> *** Error code 1
> The following command caused the error:
> for d in m4 tools doc etc share src tests; do \
>   (cd ${d} && dmake R) || exit 1; \
> done
> dmake: Fatal error: Command failed for target `R'
> root at Huba #
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From publications at wseas.org  Wed Jul 26 13:52:20 2006
From: publications at wseas.org (WSEAS Publications)
Date: Wed, 26 Jul 2006 14:52:20 +0300
Subject: [Rd] WSEAS
Message-ID: <095f01c6b0a9$f59126d0$0b01a8c0@DIMITRIS>

(write WSEAS in the Subject, when you reply)

Dear Sir,

You have included in your web page:
http://tolstoy.newcastle.edu.au/R/devel/05/01/1989.html#options2
some Information for the site: www.hiest.org
that it is NOT true any longer.

We did not authorize to include
it

Please, remove it and remove whatever information is related
with HIEST
(You can remove the whole web page
http://tolstoy.newcastle.edu.au/R/devel/05/01/1989.html#options2
if you like )
Thanks a lot
P. Betsy


From r.hankin at noc.soton.ac.uk  Wed Jul 26 15:21:21 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Wed, 26 Jul 2006 14:21:21 +0100
Subject: [Rd] largest acceptable lookup table in a package
Message-ID: <F09E2E20-D3AB-4B36-A270-D10E45990B97@soc.soton.ac.uk>

Hi


One of my packages needs a look-up table of pre-calculated
numbers in the data directory.

I would like to have the matrix as large as possible.

What is the largest size matrix that would be an acceptable datafile in
an R package?



[
The table is a square, upper triangular matrix
consisting  of logs of Stirling numbers calculated by Maple.

As discussed on the List a few days ago (thanks again David!)
Stirling numbers  are computationally challenging;
one needs exact integer arithmetic for very large
integers  for their calculation (a 100x100 table requires  ~10^157)
]




--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From sfalcon at fhcrc.org  Wed Jul 26 16:26:30 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 26 Jul 2006 07:26:30 -0700
Subject: [Rd] largest acceptable lookup table in a package
In-Reply-To: <F09E2E20-D3AB-4B36-A270-D10E45990B97@soc.soton.ac.uk> (Robin
	Hankin's message of "Wed, 26 Jul 2006 14:21:21 +0100")
References: <F09E2E20-D3AB-4B36-A270-D10E45990B97@soc.soton.ac.uk>
Message-ID: <m21ws8jvc9.fsf@ziti.local>

Robin Hankin <r.hankin at noc.soton.ac.uk> writes:
> One of my packages needs a look-up table of pre-calculated
> numbers in the data directory.
>
> What is the largest size matrix that would be an acceptable datafile in
> an R package?
>

Do you need the entire lookup table in memory at once?  If not, you
could use RSQLite and put the data there.  Then you would be limited
by file size rather than RAM.

+ seth


From ggrothendieck at gmail.com  Wed Jul 26 16:41:34 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 26 Jul 2006 10:41:34 -0400
Subject: [Rd] largest acceptable lookup table in a package
In-Reply-To: <F09E2E20-D3AB-4B36-A270-D10E45990B97@soc.soton.ac.uk>
References: <F09E2E20-D3AB-4B36-A270-D10E45990B97@soc.soton.ac.uk>
Message-ID: <971536df0607260741x74afc95m7a16199af5d40498@mail.gmail.com>

A frame of reference based on:
   http://cran.r-project.org/src/contrib
is the quantiles of the size distribution of the compressed packages:

      0%       5%      25%      50%      75%      95%     100%
      58     5800    17000    62500   249500  1500000 15000000

On 7/26/06, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
> Hi
>
>
> One of my packages needs a look-up table of pre-calculated
> numbers in the data directory.
>
> I would like to have the matrix as large as possible.
>
> What is the largest size matrix that would be an acceptable datafile in
> an R package?
>
>
>
> [
> The table is a square, upper triangular matrix
> consisting  of logs of Stirling numbers calculated by Maple.
>
> As discussed on the List a few days ago (thanks again David!)
> Stirling numbers  are computationally challenging;
> one needs exact integer arithmetic for very large
> integers  for their calculation (a 100x100 table requires  ~10^157)
> ]
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>  tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From moser.frederic at gmail.com  Wed Jul 26 17:00:05 2006
From: moser.frederic at gmail.com (moser.frederic at gmail.com)
Date: Wed, 26 Jul 2006 17:00:05 +0200 (CEST)
Subject: [Rd] Installation package of R-GUI (PR#9098)
Message-ID: <20060726150005.211D523258@slim.kubism.ku.dk>

Full_Name: Fr?d?ric Moser
Version: R-GUI, the last one
OS: Macosx 10.4.7
Submission from: (NULL) (83.228.155.25)


The installer say that I can't install R-GUI, because I don't have Macosx 10.4.4
installed, but my powerbook g4 1.33ghz run the 10.4.7 ...
Strange :P

Thanks, and R for mac os x looks great !


FXI


From vincent.goulet at act.ulaval.ca  Wed Jul 26 17:45:53 2006
From: vincent.goulet at act.ulaval.ca (Vincent Goulet)
Date: Wed, 26 Jul 2006 11:45:53 -0400
Subject: [Rd] Patch to allow negative argument in head() and tail()
In-Reply-To: <17596.40686.710925.321109@stat.math.ethz.ch>
References: <200607171503.34713.vincent.goulet@act.ulaval.ca>
	<17596.40686.710925.321109@stat.math.ethz.ch>
Message-ID: <200607261145.53538.vincent.goulet@act.ulaval.ca>

Le Mardi 18 Juillet 2006 04:42, Martin Maechler a ?crit?:
> >>>>> "Vincent" == Vincent Goulet <vincent.goulet at act.ulaval.ca>
> >>>>>     on Mon, 17 Jul 2006 15:03:34 -0400 writes:
>
>     Vincent> Dear developeRs (and other abuseRs ;-),
>
>     Vincent> I would like to contribute a patch against
>     Vincent> functions head() and tail() of package utils to
>     Vincent> allow for a negative 'n' argument. This allows to
>     Vincent> extract all but the first/last 'n'
>     Vincent> elements/rows/lines of an object, similar to the
>     Vincent> "drop" operator of APL. [1]
>
> Hmm, if you reread  Bill Venables proposal (URL below), you did
> something different : In Bill's (and my!) "book",
>
>   head would always give the *first* few entries and
>   tail would always give the *last*  few entries.
>
> That's different from APL's drop, but for a good reason:
> The words 'head' and 'tail' exactly suggest so.

I modified my patch to go along these lines. My brain must be wired 
differently since it remains counter intuitive to me but then, who am I to go 
against R Core Team members and Unix itself! ;-)

>     Vincent> I put the patched head.R and head.Rd files, along with diff
> files in Vincent> http://vgoulet.act.ulaval.ca/pub/R/
>
>     Vincent> The differences were obtained against today's version of
> r-devel (more Vincent> specifically revision 30277 of head.R and revision
> 30915 of head.Rd).
>
> That's good (to take the "current" sources for the diffs).

This time I just attached the result of 'svn diff' against revision 38701 of 
r-devel.

Please note that in head.default() and tail.default() I deleted the line

    if(length(dim(x)) == 1) array(ans, n, list(names(ans))) else ans

since I could not find any use for it. Perhaps did this become obsolete with 
the following bug fix in v2.2.0 (from the release notes):

o	Subsetting a matrix or an array as a vector used to attempt to
	use the row names to name the result, even though the
	array might be longer than the row names.  Now this is only
	done for 1D arrays when it is done in all cases, even matrix
	indexing.  (Tidies up after the fix to PR#937.)

But then, even in 2.1.1:

> x <- array(1:10, 10, list(letters[1:10]))
> x
 a  b  c  d  e  f  g  h  i  j 
 1  2  3  4  5  6  7  8  9 10 
> x[1:3]
a b c 
1 2 3 
> identical(x[1:3], array(x[1:3], 3, list(names(x[1:3]))))
[1] TRUE

If the deleted line should remain, please (explain why and) tell me and I'll 
add it back.

>     Vincent> Some comments:
>
>     Vincent> - The current version of head() and tail() will
>     Vincent> accept a vector of length > 1 for argument 'n' but
>     Vincent> will silently use the smallest value. This became
>     Vincent> awkward to reproduce in my versions and did not
>     Vincent> seem interesting anyway.  Instead, I added an error
>     Vincent> message if length(n) > 1.
>
> that's ok in my view

Still there.

>     Vincent> - I used the word "scalar" in the aforementioned
>     Vincent> error message to mean a vector of length 1. Perhaps
>     Vincent> is this not the correct R terminology?
>
> indeed, it's rarely used in R terminology; for one reason
> because S (and hence R) does not differentiate between length-1
> vectors and scalars the way APL does.

Changed for "single integer", as found in another help page.

>     Vincent> - I added a 'addrownums = TRUE' argument to head() used when n
> < 0, similar to Vincent> tail() with n > 0. This required to write separate
> methods for Vincent> classes 'data.frame' and 'matrix'.
>
> seems not unreasonable {I did not yet look at your implementation there}

As mentioned in another message, this is no longer needed.

>     Vincent> - The 'function' methods are not modified.
>
>     Vincent> - In the man page, the 'function' method was not documented in
> the usage Vincent> section. Done now.
>
> ok, though not necessary: The recommended approach is to only
>    document methods when they have ``surprising arguments'', i.e.,
>    arguments not in the generic function.
>
> In our case, 'n = 6' is not part of the generic, so strictly
> speaking *is* a "surprising argument".
> Probably it was not made part of the generic, since it's
> imaginable to have objects whose "head" is always of a fixed
> given size, and where specifying 'n' does not make sense.

For symmetry, I think it should be added.

>     Vincent> - I don't think the patch would break any existing code,
> except code using the Vincent> (undocumented) "feature" mentioned in my
> first remark, above.

This should remain valid.

[...]

Best regards to all,

-- 
  Vincent Goulet, Associate Professor
  ?cole d'actuariat
  Universit? Laval, Qu?bec 
  Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca

From hb at stat.berkeley.edu  Wed Jul 26 19:07:50 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 26 Jul 2006 10:07:50 -0700
Subject: [Rd] pari/gp interface
In-Reply-To: <Pine.LNX.4.64.0607260607170.29157@gannet.stats.ox.ac.uk>
References: <996C788E-4632-4BB5-A9F4-83AB02C0CE3D@soc.soton.ac.uk>
	<59d7961d0607251333n3f074f9aof1ae28722331f20e@mail.gmail.com>
	<Pine.LNX.4.64.0607260607170.29157@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0607261007o1c212b5en351700d328d00337@mail.gmail.com>

On 7/25/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> The issue is that system() on Windows does not run a shell, so piping is
> not going to be available: used shell() instead.   Then the problem is
> that the shell available is OS-specific, and pretty minimal on Windows
> 95/98/ME.  If you can ignore those (and they are getting rarer), cmd.exe
> can be assumed for use of shell().
>
> echo is not a standard system command on Windows either, and in a shell
> does not do what it does on Unix.
>
> On Tue, 25 Jul 2006, Henrik Bengtsson wrote:
>
> > On 7/25/06, Robin Hankin <r.hankin at noc.soton.ac.uk> wrote:
> > > Hi
> > >
> > > I'm developing an R package that
> > > needs to execute some code written in pari/gp.
> > >
> > > I've used this before from an R package (elliptic) but the interface
> > > is very
> > > basic: the R function creates a string such as the following:
> > >
> > > string <- echo ' ellwp ([ 2+0*I , 0+2*I ], 1+0*I )' | gp -q
> > >
> > > And then
> > >
> > > system(string)
> > >
> > > returns the output from gp which then needs to be text processed
> > > (translating "I"
> > > to "i", etc).
> > >
> > > I don't think this approach would work under Windows.
> >
> > I know nothing about pari/gp, but I believe it does work on Windows
> > too.  There is system() command available on the Windows version too,
> > but with slightly different arguments (than on Linux say).
> >
> > Piping is available on Windows too, e.g. "dir | sort", although you
> > should be able to get around that by writing to file instead and using
> > ">" and "<".
>
> Did you try that?  dir is not an executable under Windows (a shell
> command), and it does not work even if you use an executable.  You do need
> to use shell()

Too quick there - I didn't do this using system() but from the Windows
command prompt;

> system("dir | sort")
Warning message:
dir not found

> shell("dir | sort")
              10 Dir(s)   4,458,024,960 bytes free
...
07/26/2006  09:56 AM    <DIR>          .
07/26/2006  09:56 AM    <DIR>          ..
07/26/2006  10:00 AM            15,055 .Rhistory

What I wanted to get through though is that it is possible to obtain
the same thing in Windows.  You might have to modify the code to be
sensitive to .Platform$OS.type.  When I do these kind of things I
often write a BAT script that I call using system("foo.bat").

/Henrik

>
> >
> > You should be careful if your 'string' gets really long.  Then it is
> > much better to have a BAT file (and an sh file on Linux) to run your
> > external calls, alternatively you call system() multiple times.
> > However, I would be suprised if 'ellwp' wouldn't accept files as input
> > too.
> >
> > /Henrik
> >
> > > Does anyone have any experience of calling pari/gp from R?
> > >
> > > Or any ideas for a more portable method than the one above?
> > >
> > >
> > >
> > >
> > > [
> > > PARI/GP is a widely used computer algebra system designed for fast
> > > computations
> > > in number theory.  It is freely available at
> > >
> > >   http://pari.math.u-bordeaux.fr/
> > > ]
> > >
> > >
> > > --
> > > Robin Hankin
> > > Uncertainty Analyst
> > > National Oceanography Centre, Southampton
> > > European Way, Southampton SO14 3ZH, UK
> > >   tel  023-8059-7743
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> > >
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From Peter.Rossi at chicagogsb.edu  Wed Jul 26 22:36:03 2006
From: Peter.Rossi at chicagogsb.edu (Rossi, Peter E.)
Date: Wed, 26 Jul 2006 15:36:03 -0500
Subject: [Rd] .Call question
Message-ID: <1E7B167439290641966EB161D4330798013F4386@GSBEX.gsb.uchicago.edu>

 
Writing R Ext says to treat R objects that are arguments to .Call as
read only (i.e. don't modify). 

I have a long list of lists that and I want to avoid the overhead of a
copy in my C code.  I would just like to modify some of the elements 
of list by replacing them with elements of exactly the same size/type.

below is an example of the essence of the problem.  This seems to work.
Is this dangerous or ok? (of course, I want to do something more
complicated
since I can do this in R, but I hope this illustrates my question).


SEXP modlist(SEXP list, SEXP ind, SEXP element){
   int index;
   index=INTEGER_VALUE(ind);
   SET_ELEMENT(list,index,element);
return(ind);
}

called in R as in 

lst=list("a","b","c")
element="d"
out=.Call("modlist",lst,1,element)

here the .Call is used just for its effect on lst.

thanks!

peter
 

................................
  Peter E. Rossi
 Joseph T. and Bernice S. Lewis Professor of Marketing and Statistics
 Editor, Quantitative Marketing and Economics
 Rm 353, Graduate School of Business, U of Chicago
 5807 S. Woodlawn Ave, Chicago IL 60637, USA
 Tel: (773) 702-7513   |   Fax: (773) 834-2081


From tlumley at u.washington.edu  Thu Jul 27 01:32:02 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 26 Jul 2006 16:32:02 -0700 (PDT)
Subject: [Rd] .Call question
In-Reply-To: <1E7B167439290641966EB161D4330798013F4386@GSBEX.gsb.uchicago.edu>
References: <1E7B167439290641966EB161D4330798013F4386@GSBEX.gsb.uchicago.edu>
Message-ID: <Pine.LNX.4.64.0607261612370.13929@homer23.u.washington.edu>

On Wed, 26 Jul 2006, Rossi, Peter E. wrote:

>
> Writing R Ext says to treat R objects that are arguments to .Call as
> read only (i.e. don't modify).
>
> I have a long list of lists that and I want to avoid the overhead of a
> copy in my C code.  I would just like to modify some of the elements
> of list by replacing them with elements of exactly the same size/type.
>
> below is an example of the essence of the problem.  This seems to work.
> Is this dangerous or ok? (of course, I want to do something more
> complicated
> since I can do this in R, but I hope this illustrates my question).

It is dangerous.

If you do

lst1<-list("a","b","c")
lst2<-lst1
element<-"d"
.Call("modlist",lst1, 1, element)

then both lst1 and lst2 will change. The danger is just that you can 
break the call-by-value illusion that R maintains, in two ways. The first 
is that objects that have shared structure can be modified, the 
second is that you can create shared structure without R knowing: if you 
change "element" subsequently then lst1 and lst2 may change.

 	-thomas

>
> SEXP modlist(SEXP list, SEXP ind, SEXP element){
>   int index;
>   index=INTEGER_VALUE(ind);
>   SET_ELEMENT(list,index,element);
> return(ind);
> }
>
> called in R as in
>
> lst=list("a","b","c")
> element="d"
> out=.Call("modlist",lst,1,element)
>
> here the .Call is used just for its effect on lst.
>
> thanks!
>
> peter
>
>
> ................................
>  Peter E. Rossi
> Joseph T. and Bernice S. Lewis Professor of Marketing and Statistics
> Editor, Quantitative Marketing and Economics
> Rm 353, Graduate School of Business, U of Chicago
> 5807 S. Woodlawn Ave, Chicago IL 60637, USA
> Tel: (773) 702-7513   |   Fax: (773) 834-2081
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From tlumley at u.washington.edu  Thu Jul 27 01:59:16 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 26 Jul 2006 16:59:16 -0700 (PDT)
Subject: [Rd] R CMD SHLIB flags
Message-ID: <Pine.LNX.4.64.0607261632410.13929@homer23.u.washington.edu>


How can one specify multiple extra flags to R CMD SHLIB?  The example in 
R-exts section 5.5
    MAKEFLAGS="CFLAGS=-O3" R CMD SHLIB *.c
works for a single flag, but when I try
    MAKEFLAGS="CFLAGS=-g -O2 -Wall" R CMD SHLIB *.c
only the first flag is used and the rest seem to be ignored (version 
2.3.1, Mac OS X)

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From edd at debian.org  Thu Jul 27 02:47:37 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 26 Jul 2006 19:47:37 -0500
Subject: [Rd] R CMD SHLIB flags
In-Reply-To: <Pine.LNX.4.64.0607261632410.13929@homer23.u.washington.edu>
References: <Pine.LNX.4.64.0607261632410.13929@homer23.u.washington.edu>
Message-ID: <17608.3369.321430.848590@basebud.nulle.part>


On 26 July 2006 at 16:59, Thomas Lumley wrote:
| 
| How can one specify multiple extra flags to R CMD SHLIB?  The example in 
| R-exts section 5.5
|     MAKEFLAGS="CFLAGS=-O3" R CMD SHLIB *.c
| works for a single flag, but when I try
|     MAKEFLAGS="CFLAGS=-g -O2 -Wall" R CMD SHLIB *.c
| only the first flag is used and the rest seem to be ignored (version 
| 2.3.1, Mac OS X)

As it seems to break at the space, escaping those seems to help:

edd at basebud:~/src/debian/CRAN/tseries-0.10-3/src> MAKEFLAGS='CFLAGS=-g\ -O2\ -Wall' R CMD SHLIB *.c
gcc -I/usr/share/R/include -I/usr/share/R/include     -fpic  -g -O2 -Wall -c arma.c -o arma.o
gcc -I/usr/share/R/include -I/usr/share/R/include     -fpic  -g -O2 -Wall -c bdstest.c -o bdstest.o
gcc -I/usr/share/R/include -I/usr/share/R/include     -fpic  -g -O2 -Wall -c boot.c -o boot.o
gcc -I/usr/share/R/include -I/usr/share/R/include     -fpic  -g -O2 -Wall -c garch.c -o garch.o
gcc -I/usr/share/R/include -I/usr/share/R/include     -fpic  -g -O2 -Wall -c ppsum.c -o ppsum.o
gcc -I/usr/share/R/include -I/usr/share/R/include     -fpic  -g -O2 -Wall -c tsutils.c -o tsutils.o
gcc -shared  -o arma.so arma.o bdstest.o boot.o garch.o ppsum.o tsutils.o -lblas-3 -lgfortran -lm -lgcc_s  -L/usr/lib/R/lib -lR
edd at basebud:~/lan/chibud/src/debian/CRAN/tseries-0.10-3/src> MAKEFLAGS='CFLAGS=-g\ -O2\ -Wall' R CMD SHLIB *.c

Using bash on Debian.  Does that work for you on Mac OS X too?

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From simon.urbanek at r-project.org  Thu Jul 27 06:51:36 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 27 Jul 2006 00:51:36 -0400
Subject: [Rd] Installation package of R-GUI (PR#9098)
In-Reply-To: <20060726150005.211D523258@slim.kubism.ku.dk>
References: <20060726150005.211D523258@slim.kubism.ku.dk>
Message-ID: <9156A154-AB98-4E57-84BD-F5FF770339EA@r-project.org>

Frederic,

On Jul 26, 2006, at 11:00 AM, moser.frederic at gmail.com wrote:

> Full_Name: Fr?d?ric Moser
> Version: R-GUI, the last one

^^ What is "the last one"?

> OS: Macosx 10.4.7
> Submission from: (NULL) (83.228.155.25)
>
>
> The installer say that I can't install R-GUI, because I don't have  
> Macosx 10.4.4
> installed, but my powerbook g4 1.33ghz run the 10.4.7 ...
> Strange :P
>

Which R are you trying to install and how? If you really mean R-GUI  
"the last one" i.e. the nightly build then you only have to drag it  
to your Applications folder - there is no installer.

If you use the regular CRAN installer of a released version of R  
(2.3.1) then the GUI is installed as a part of the R installation  
process, so it has no separate check. I have also checked the  
individual package (which usually is not used directly) and it works,  
too, so I fail to see the problem.

Cheers,
Simon


From ldimitro at wfubmc.edu  Wed Jul 26 22:48:17 2006
From: ldimitro at wfubmc.edu (Latchezar Dimitrov)
Date: Wed, 26 Jul 2006 16:48:17 -0400
Subject: [Rd] Install R-patched_2006-07-13 on i386-pc-solaris2.10 with
	Sun Studio 11
Message-ID: <F160BE32A2E5E04497668BBDFE83FEDF11CF7F75@EXCHVS1.medctr.ad.wfubmc.edu>

Dear Prof. Ripley and R-developers:

Thank you very much for the reply. Please see bellow 

> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Sent: Wednesday, July 26, 2006 2:37 AM
> To: Latchezar Dimitrov
> Cc: r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Install R-patched_2006-07-13 on 
> i386-pc-solaris2.10 with Sun Studio 11
> 
> On Wed, 26 Jul 2006, Latchezar Dimitrov wrote:
> 
> > Dear R-developers:
> > 
> > I'm trying to build a 64-bit R-patched_2006-07-24 on 
> SunFire V40z with 
> > on Solaris OS 10 64-bit kernel and using Sun Studio 11 compilers.
> > Everything runs OK until it gets to building package tools (all.R) 
> > where it fails. Bellow is how I tried it (I can provide any other 
> > additional info if needed). Any help please?
> 
> You seem to have gcc 4.1.1 in your paths, so can you try that instead.

True (that's why I gave the env) however that is c/c++ only. I cannot
build gcc fortran right way and since R is on top of my list I switched
to Sun Studio 11. I included the libraries and the path in order to use
makeinfo and readline which I compiled with that gcc (I build most
essential gnu utils with it too as well as some applications and
everything seems ok). To avoid misuse of it I explicitly specified all
the programs that I knew could be mistaken (CC,CXX,etc), gnu ld was
renamed. I as sure as one can that there was not any (mis)use of
/usr/local/ except for readline and makeinfo (I believe the build did
not go that far though). One additional thing that I missed in my prev.
e-mail is that R binary was build seemingly properly, i.e., it starts ok
however with complaints about missing base parts (obviously).

Now to make it clear it has nothing to do with that gcc I removed all
the paths from the environment and to make sure nothing leaks through I
renamed /usr/local so it stays out of the way. Then I set
--with-readline=no and started clean (as you may have already noticed I
build in a separate from src dir (obj-R) completely empty at the
beginning. It failed the very same way.

Further, I decided to give 32-bit build a try. To make things more
interesting I restore /usr/local and the path to /usr/local/bin in order
to be able to use makeinfo (since the only readline I had was a 64-bit
one I gave it up). And voila, it built like a charm. The only tests that
I noticed failed were those involving tcltk (I had only 64-bit ones
installed).

The only problem still remaining is I cannot care less about 32-bit
version.

Please find attached the log of 64-bit try and a little bit of 32
success in the end.

So would someone please help me find out what is wrong and build my
favorite 64-bit R?

Thank you very much,
Latchezar Dimitrov


> 
> This looks like a fairly fundamental problem with your 
> current build, possibly a mis-compile.
> 
> > 
> > Thank you very much
> > 
> > Latchezar Dimitrov
> > Wake Forest Univ. School of Medicine
> > 
> > 
> > 
> > root at Huba #   echo   $PATH
> > 
> /opt/SUNWspro/bin:/usr/sbin:/usr/bin:/usr/openwin/bin:/usr/ccs/bin:/us
> > r/ 
> > 
> openwin/bin:/usr/dt/bin:/usr/platform/i86pc/sbin:/opt/SUNWvts/bin:/opt
> > /S
> > UNWexplo/bin:/usr/local/bin
> > root at Huba #   echo   $CC
> > cc
> > root at Huba #   echo   $CXX
> > CC
> > root at Huba #   echo   $CFLAGS
> > -xarch=amd64 -xmodel=medium
> > root at Huba #   echo   $CXXFLAGS
> > -xarch=amd64 -xmodel=medium
> > root at Huba #   echo   $FCFLAGS
> > -xarch=amd64 -xmodel=medium
> > root at Huba #   echo   $FFLAGS
> > -xarch=amd64 -xmodel=medium
> > root at Huba #   echo   $LDFLAGS
> > -xarch=amd64 -xmodel=medium
> > root at Huba #   echo   $R_BROWSER
> > /usr/sfw/bin/mozilla
> > root at Huba #   echo   $r_arch
> > amd64
> > root at Huba #   echo   $LD_LIBRARY_PATH
> > 
> /usr/openwin/lib:/usr/local/gcc-4.1.1-x86-bootstrap/lib/gcc/i386-pc-so
> > la 
> > 
> ris2.10/4.1.1/amd64:/usr/local/lib:/usr/local/gcc-4.1.1-x86-bootstrap/
> > li 
> > 
> b/gcc/i386-pc-solaris2.10/4.1.1/amd64:/usr/local/lib:/usr/loca
> l/gcc-4.1.
> > 
> 1-x86-bootstrap/lib/gcc/i386-pc-solaris2.10/4.1.1/amd64:/usr/local/lib
> > root at Huba #
> > 
> > 
> > ../src/R-patched_2006-07-24/configure
> > --prefix=/opt/R-2.3.1-patched_2006-07-24-Sun_Studio_11 
> --with-readline 
> > --disable-mbcs R_PAPERSIZE=letter --disable-rpath --with-bzlib 
> > --with-zlib --with-spcre --with-tcltk --disable-R-profiling 
> > --disable-nls
> > 
> > 
> > 
> > Error in parseNamespaceFile(package, package.lib, mustExist 
> = FALSE) : 
> >         subscript out of bounds
> > Execution halted
> > *** Error code 1
> > The following command caused the error:
> > (cat
> > 
> ../../../../src/R-patched_2006-07-24/src/library/tools/R/makeLazyLoad.
> > R;
> > \
> >   echo "makeLazyLoading(\"tools\")") | \
> >   R_DEFAULT_PACKAGES=NULL LC_COLLATE=C ../../../bin/R --vanilla 
> > --slave
> > > /dev/null
> > dmake: Fatal error: Command failed for target `all'
> > Current working directory /export/data/obj-R/src/library/tools
> > *** Error code 1
> > The following command caused the error:
> > for pkg in profile base tools utils grDevices graphics 
> stats datasets 
> > methods grid splines stats4 tcltk; do \
> >   (cd ${pkg} && dmake) || exit 1; \
> > done
> > dmake: Fatal error: Command failed for target `R'
> > Current working directory /export/data/obj-R/src/library
> > *** Error code 1
> > The following command caused the error:
> > for d in scripts include extra appl nmath unix main modules 
> library; 
> > do \
> >   (cd ${d} && dmake R) || exit 1; \
> > done
> > dmake: Fatal error: Command failed for target `R'
> > Current working directory /export/data/obj-R/src
> > *** Error code 1
> > The following command caused the error:
> > for d in m4 tools doc etc share src tests; do \
> >   (cd ${d} && dmake R) || exit 1; \
> > done
> > dmake: Fatal error: Command failed for target `R'
> > root at Huba #
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
> > 
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 

From maechler at stat.math.ethz.ch  Thu Jul 27 11:12:33 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 27 Jul 2006 11:12:33 +0200
Subject: [Rd] % symbol in .Rd files?
In-Reply-To: <44C4FE51.1070306@DecisionSynergy.com>
References: <44C4FE51.1070306@DecisionSynergy.com>
Message-ID: <17608.33665.900040.416162@stat.math.ethz.ch>

>>>>> "Dominick" == Dominick Samperi <dsamperi at decisionsynergy.com>
>>>>>     on Mon, 24 Jul 2006 13:07:29 -0400 writes:

    Dominick> Hello, I am encountering problems when there is a
    Dominick> '%' character in package .Rd files. More
    Dominick> precisely, CRAN is having problems with these
    Dominick> characters when running check, whereas I am not
    Dominick> seeing any problems under Linux and Windows.  I
    Dominick> did see these problems, and found that escaping
    Dominick> the %'s fixes the problem in my testing, but
    Dominick> apparently this does not fix the problem when
    Dominick> check is run at CRAN.

    Dominick> I suspect that there are some compatibility
    Dominick> problems between shells, TeX, or perl versions, or
    Dominick> perhaps the check on CRAN goes through more levels
    Dominick> of preprocessing?

    Dominick> I can probably fix this problem by removing all
    Dominick> '%' chars from my .Rd files, but this doesn't seem
    Dominick> like a very natural solution.

definitely not.  Other packages have them as well,
without giving any CRAN hickups

No, you should find and fix the problem.

    Dominick> Any ideas?

We need examples which -- at least for you -- produce the
problem.  You could post a small tar file (mime-types 'application/x-tar'
or 'application/x-compressed-tar' are accepted for R-devel) if
you want.

Martin Maechler, ETH Zurich


From maechler at stat.math.ethz.ch  Thu Jul 27 11:16:43 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 27 Jul 2006 11:16:43 +0200
Subject: [Rd] SystemRequirements (was  DESCRIPTION and PACKAGES files )
In-Reply-To: <86d5bvvuh0.fsf_-_@ufl.edu>
References: <86lkqoys6b.fsf@ufl.edu>
	<Pine.LNX.4.64.0607202128260.32650@gannet.stats.ox.ac.uk>
	<86d5c0ypin.fsf@ufl.edu> <m264hrah1o.fsf@ziti.local>
	<86d5bvvuh0.fsf_-_@ufl.edu>
Message-ID: <17608.33915.230167.988170@stat.math.ethz.ch>

>>>>> "Allen" == Allen S Rout <asr at ufl.edu>
>>>>>     on 24 Jul 2006 12:27:39 -0400 writes:

    Allen> Seth Falcon <sfalcon at fhcrc.org> writes:
    >> For the Bioconductor project, we also wanted more
    >> information to be programatically available regarding the
    >> packages in a repository.  Instead of bloating the
    >> PACKAGES file, we put a separate file, VIEWS in our
    >> repository.  [...]
    >> 
    >> So, if you were able to host a CRAN mirror, you could
    >> annotate it similarly.


    Allen> Thanks, Seth; I am hoping that I will be able to
    Allen> avoid introducing any new data to the PACKAGES
    Allen> stream.  So far, I'm doing all right with
    Allen> concatenating all the DESCRIPTIONS files from the
    Allen> Descriptions/ subdir of a CRAN mirror.


    Allen> I'm wondering about SystemRequirements, though; I
    Allen> ass-u-med from its mention in 'Writing R Extensions'
    Allen> that it was intended to have a format similar to
    Allen> Depends.  Some package authors seem to feel the same
    Allen> way, but many clearly do not.


    Allen> cran2ebuild $ grep -i systemre descs/PACKAGES

    [.............]

    Allen> So, 30-some out of 788 packages use
    Allen> SystemRequirements.  Clearly, a 'Depends'-esque
    Allen> format is the most popular, though there are several
    Allen> unparseable variants in the list.

    Allen> I'm suggesting a tighter formatting to a few authors,
    Allen> (i.e. the packages I happen to use right now) but I
    Allen> wonder if there is any central philosophical opinion
    Allen> on how that field ought to look?  If the Gods of R
    Allen> think that automated parsing of SystemRequirements is
    Allen> unimportant, I'll have to maintain them by hand.

I think some R-core members would welcome a detailed proposal on
how 'SystemRequirements' should be formatted -- maybe even
accompanied by R code to parse it.
That's a topic also quite well fit to be discussed in "this theatre"
..

Martin Maechler, ETH Zurich


From dsamperi at DecisionSynergy.com  Thu Jul 27 13:52:36 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Thu, 27 Jul 2006 07:52:36 -0400
Subject: [Rd] % symbol in .Rd files?
In-Reply-To: <17608.33665.900040.416162@stat.math.ethz.ch>
References: <44C4FE51.1070306@DecisionSynergy.com>
	<17608.33665.900040.416162@stat.math.ethz.ch>
Message-ID: <44C8A904.2020408@DecisionSynergy.com>

Martin Maechler wrote:
>>>>>> "Dominick" == Dominick Samperi <dsamperi at decisionsynergy.com>
>>>>>>     on Mon, 24 Jul 2006 13:07:29 -0400 writes:
>>>>>>             
>
>     Dominick> Hello, I am encountering problems when there is a
>     Dominick> '%' character in package .Rd files. More
>     Dominick> precisely, CRAN is having problems with these
>     Dominick> characters when running check, whereas I am not
>     Dominick> seeing any problems under Linux and Windows.  I
>     Dominick> did see these problems, and found that escaping
>     Dominick> the %'s fixes the problem in my testing, but
>     Dominick> apparently this does not fix the problem when
>     Dominick> check is run at CRAN.
>
>     Dominick> I suspect that there are some compatibility
>     Dominick> problems between shells, TeX, or perl versions, or
>     Dominick> perhaps the check on CRAN goes through more levels
>     Dominick> of preprocessing?
>
>     Dominick> I can probably fix this problem by removing all
>     Dominick> '%' chars from my .Rd files, but this doesn't seem
>     Dominick> like a very natural solution.
>
> definitely not.  Other packages have them as well,
> without giving any CRAN hickups
>
> No, you should find and fix the problem.
>
>     Dominick> Any ideas?
>
> We need examples which -- at least for you -- produce the
> problem.  You could post a small tar file (mime-types 'application/x-tar'
> or 'application/x-compressed-tar' are accepted for R-devel) if
> you want.
>
> Martin Maechler, ETH Zurich
>
>   
An example of the '% problem' is provided by the RcppExample.Rd file that
is part of the RcppTemplate package (V4.2). There you will find:

# Note that we need to escape the percent sign here...
datestr <- c('2006-6-10', '2006-7-12', '2006-8-10')
datevec <- as.Date(datestr, "\%Y-\%m-\%d") # date vector

Without the escaped '%' signs I get an obscure error message when
I run:
 > example(RcppExample)

Here is the error message:
Error in parse(file, n = -1, NULL, "?") : syntax error at
36:
 
37:
 >

There was another problem with this package (now fixed) that
was showing up on CRAN, but not in my testing. This was due to
the fact that the latest version of r-devel includes some new
type checking, so an error was caught at CRAN, but not in
my testing (I use the standard version of R). This problem was
unrelated to the '% problem'.


ds


From tpapp at Princeton.EDU  Thu Jul 27 14:16:13 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Thu, 27 Jul 2006 14:16:13 +0200
Subject: [Rd] how to start local scope?
Message-ID: <20060727121613.GA4594@pu100877.student.princeton.edu>

How can I start a local scope inside an R function?  Eg in

> b
Error: object "b" not found
> f <- function() {
+   {
+     b <- 1
+   }
+   b+2
+ }
> f()
[1] 3

I would like f() to report an error, not finding b.  I am thinking
about something like let in Scheme/Lisp.

Thanks,

Tamas


From rdpeng at gmail.com  Thu Jul 27 14:28:19 2006
From: rdpeng at gmail.com (Roger D. Peng)
Date: Thu, 27 Jul 2006 08:28:19 -0400
Subject: [Rd] how to start local scope?
In-Reply-To: <20060727121613.GA4594@pu100877.student.princeton.edu>
References: <20060727121613.GA4594@pu100877.student.princeton.edu>
Message-ID: <44C8B163.10501@gmail.com>

Try

f <- function() {
	local({
		b <- 1
	})
	b + 2
}


Tamas K Papp wrote:
> How can I start a local scope inside an R function?  Eg in
> 
>> b
> Error: object "b" not found
>> f <- function() {
> +   {
> +     b <- 1
> +   }
> +   b+2
> + }
>> f()
> [1] 3
> 
> I would like f() to report an error, not finding b.  I am thinking
> about something like let in Scheme/Lisp.
> 
> Thanks,
> 
> Tamas
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From murdoch at stats.uwo.ca  Thu Jul 27 14:34:10 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 27 Jul 2006 08:34:10 -0400
Subject: [Rd] how to start local scope?
In-Reply-To: <20060727121613.GA4594@pu100877.student.princeton.edu>
References: <20060727121613.GA4594@pu100877.student.princeton.edu>
Message-ID: <44C8B2C2.5010104@stats.uwo.ca>

On 7/27/2006 8:16 AM, Tamas K Papp wrote:
> How can I start a local scope inside an R function?  Eg in
> 
>> b
> Error: object "b" not found
>> f <- function() {
> +   {
> +     b <- 1
> +   }
> +   b+2
> + }
>> f()
> [1] 3
> 
> I would like f() to report an error, not finding b.  I am thinking
> about something like let in Scheme/Lisp.

The local() function does this:

 > f <- function() {
+   local({ b <- 1 })
+   b + 2
+ }
 > f()
Error in f() : object "b" not found


From maechler at stat.math.ethz.ch  Thu Jul 27 14:48:30 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 27 Jul 2006 14:48:30 +0200
Subject: [Rd] % symbol in .Rd files?
In-Reply-To: <44C8A904.2020408@DecisionSynergy.com>
References: <44C4FE51.1070306@DecisionSynergy.com>
	<17608.33665.900040.416162@stat.math.ethz.ch>
	<44C8A904.2020408@DecisionSynergy.com>
Message-ID: <17608.46622.450008.260194@stat.math.ethz.ch>

>>>>> "DoSa" == Dominick Samperi <dsamperi at decisionsynergy.com>
>>>>>     on Thu, 27 Jul 2006 07:52:36 -0400 writes:

    DoSa> Martin Maechler wrote:
    >>>>>>> "DoSa" == Dominick Samperi <dsamperi at decisionsynergy.com>
    >>>>>>> on Mon, 24 Jul 2006 13:07:29 -0400 writes:
    >>>>>>> 
    >> 
    DoSa> Hello, I am encountering problems when there is a
    DoSa> '%' character in package .Rd files. More
    DoSa> precisely, CRAN is having problems with these
    DoSa> characters when running check, whereas I am not
    DoSa> seeing any problems under Linux and Windows.  I
    DoSa> did see these problems, and found that escaping
    DoSa> the %'s fixes the problem in my testing, but
    DoSa> apparently this does not fix the problem when
    DoSa> check is run at CRAN.
    >> 
    DoSa> I suspect that there are some compatibility
    DoSa> problems between shells, TeX, or perl versions, or
    DoSa> perhaps the check on CRAN goes through more levels
    DoSa> of preprocessing?
    >> 
    DoSa> I can probably fix this problem by removing all
    DoSa> '%' chars from my .Rd files, but this doesn't seem
    DoSa> like a very natural solution.
    >> 
    >> definitely not.  Other packages have them as well,
    >> without giving any CRAN hickups
    >> 
    >> No, you should find and fix the problem.
    >> 
    DoSa> Any ideas?
    >> 
    >> We need examples which -- at least for you -- produce the
    >> problem.  You could post a small tar file (mime-types 'application/x-tar'
    >> or 'application/x-compressed-tar' are accepted for R-devel) if
    >> you want.
    >> 
    >> Martin Maechler, ETH Zurich
    >> 
    >> 

    DoSa> An example of the '% problem' is provided by the
    DoSa> RcppExample.Rd file that is part of the RcppTemplate
    DoSa> package (V4.2). There you will find:

    DoSa> # Note that we need to escape the percent sign here...
    DoSa> datestr <- c('2006-6-10', '2006-7-12', '2006-8-10')
    DoSa> datevec <- as.Date(datestr, "\%Y-\%m-\%d") # date vector

which is perfect...
"Writing R Extensions" has always said you must escape them...

    DoSa> Without the escaped '%' signs

you really get invalid examples, not just for example()

    DoSa> I get an obscure error message when
    DoSa> I run:
    >> example(RcppExample)

    DoSa> Here is the error message:
    DoSa> Error in parse(file, n = -1, NULL, "?") : syntax error at
    DoSa> 36:
 
    DoSa> 37:

Now if I run  'R CMD check RcppTemplate' I see no problem.
In my eyes, everything is ok there.

So where exactly does CRAN (i.e. the CRAN machine that does the
daily checks) have a problem?
Maybe it's really a problem on that machine, than rather with
your *.Rd files ...  :-)

Hmm, actually I now start wondering: Why did we ever start
talking about this at all?  Isn't this something you have to settle
with Kurt, Fritz, or whomever.. ?

Regards,
Martin Maechler


From dsamperi at DecisionSynergy.com  Thu Jul 27 14:51:34 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Thu, 27 Jul 2006 08:51:34 -0400
Subject: [Rd] % symbol in .Rd files?
In-Reply-To: <17608.46622.450008.260194@stat.math.ethz.ch>
References: <44C4FE51.1070306@DecisionSynergy.com>	<17608.33665.900040.416162@stat.math.ethz.ch>	<44C8A904.2020408@DecisionSynergy.com>
	<17608.46622.450008.260194@stat.math.ethz.ch>
Message-ID: <44C8B6D6.50202@DecisionSynergy.com>

Martin Maechler wrote:
> Hmm, actually I now start wondering: Why did we ever start
> talking about this at all?  Isn't this something you have to settle
> with Kurt, Fritz, or whomever.. ?
> Regards,
> Martin Maechler
Sorry if I was unclear, but yes, it was settled with the help of Kurt. As I
said, the latest r-devel includes some new type checking (to be sure that
STRING_ELT is applied where it makes sense, for example), and this
is why CRAN was picking up problems that I was not seeing.

I guess I missed that fact about the '%' character in the docs.

ds


From maechler at stat.math.ethz.ch  Thu Jul 27 15:15:18 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 27 Jul 2006 15:15:18 +0200
Subject: [Rd] % symbol in .Rd files?
In-Reply-To: <44C8B6D6.50202@DecisionSynergy.com>
References: <44C4FE51.1070306@DecisionSynergy.com>
	<17608.33665.900040.416162@stat.math.ethz.ch>
	<44C8A904.2020408@DecisionSynergy.com>
	<17608.46622.450008.260194@stat.math.ethz.ch>
	<44C8B6D6.50202@DecisionSynergy.com>
Message-ID: <17608.48230.329381.121464@stat.math.ethz.ch>

>>>>> "Dominick" == Dominick Samperi <dsamperi at DecisionSynergy.com>
>>>>>     on Thu, 27 Jul 2006 08:51:34 -0400 writes:

    Dominick> Martin Maechler wrote:
    >> Hmm, actually I now start wondering: Why did we ever start
    >> talking about this at all?  Isn't this something you have to settle
    >> with Kurt, Fritz, or whomever.. ?
    >> Regards,
    >> Martin Maechler
    Dominick> Sorry if I was unclear, but yes, it was settled with the help of Kurt. As I
    Dominick> said, the latest r-devel includes some new type checking (to be sure that
    Dominick> STRING_ELT is applied where it makes sense, for example), and this
    Dominick> is why CRAN was picking up problems that I was not seeing.

but not related to "%" ???

Also, with R-devel "as of last night"
I (i.e., "R-devel CMD check")  don't see any problems in
RcppTemplate or its help files.

    Dominick> I guess I missed that fact about the '%' character in the docs.


From kevin.hendricks at sympatico.ca  Thu Jul 27 15:31:03 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Thu, 27 Jul 2006 09:31:03 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations specifically
	for sorted data?
Message-ID: <07820D54-9DDC-42F7-8F32-C931B2B80DE6@sympatico.ca>

Hi Developers,

I am looking for another new project to help me get more up to speed  
on R and to learn something outside of R internals.   One recent R  
issue I have run into is finding a fast implementations of the  
equivalent to the following SAS code:

/* MDPC is an integer sort key made from two integer columns */
MDPC = (MD * 100000) + PCO;

/* sort the dataset by the key */
PROC SORT;
   BY MDPC;

/* print out count and sum for each unique sort key (subgroup) */
/* use of BY MDPC requires sorting that data set by MDPC first in SAS */
PROC UNIVARIATE NOPRINT;
    VAR MVE;
    BY MDPC;
    OUTPUT OUT=TMP0 N=XN SUM=XSUM;

Easy to do in R but the problem is the data set this is being run on  
has 1,742,201 lines in it and takes up 196,868,713 bytes to store as  
character data.  The sort key has easily has over 200,000 unique keys  
(if not twice that).

My first R attempt was a simple

# sort the data.frame gd and the sort key
sorder <- order(MDPC)
gd  <- gd[sorder,]
MDPC <- MDPC[sorder]
attach(gd)

# find the length and sum for each unique sort key
XN <- by(MVE, MDPC, length)
XSUM <- by(MVE, MDPC, sum)
GRPS <- levels(as.factor(MDPC))

Well the ordering and sorting was reasonably fast but the first "by"  
statement was still running 4 hours later on my machine (a dual 2.6  
gig Opteron with 4 gig of main memory).  This same snippet of code in  
SAS running on a slower machine takes about 5 minutes of system time.

I tried various simple R implementations of a "by_sorted" that I  
thought might help

# walk sorted array once and keep track of beginning
# and ending points for each unique sort key value in p
# and run function fcn on that sub sequence in vector v
# store the results in a vector

by_sorted <- function(v, p, fcn) {
    key <- p[[1]]
    bp <- 1
    r <- NULL
    for (i in 2:length(p)) {
       if (key != p[[i]]) {
           r <- c(r,fcn(v[bp:i-1]))
           bp <- i
           key <- p[[i]]
       }
    }
    r <- c(r,fcn(v[bp:i]))
}

but they took "forever" to run also (read that I killed those  
attempts at 15 minutes of cpu time).

I literally had the same issue when trying with "tapply".

So unless it already exists someplace, I need a really fast  
implementation of "by" for very large sorted data sets (probably  
written in fortran or c) that will do the equivalent of what SAS does  
with its "proc univariate by" approach with close to the same  
performance.  The code should only have to walk the array once (ie.  
be linear in time with the number of rows in the vector).   I have  
similar issues with "merge" as well since merging data frames already  
sorted by the same sort key should be fast as well and does not  
appear to be.

Before I jump into this and create my own "sorted large data set"  
versions of "by" and "merge", I wanted to be sure it would be of  
interest to others.  If they work well and are well implemented (a  
big if since I am really still just learning this - the whole point  
of the project!) would something like this be of any interest for  
internal use of R?  Or is this something too specialized?
Is there an R function implemented in c or fortran that would make a  
good "model" to follow for implementing something like this?
Would/should they be extensions of current implementations of "merge"  
and "by" with an additions of a sorted=TRUE (defaulting to FALSE)  
extra parameter.

Or am I simply barking up the wrong tree here?

Thanks,

Kevin


From dsamperi at DecisionSynergy.com  Thu Jul 27 15:33:39 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Thu, 27 Jul 2006 09:33:39 -0400
Subject: [Rd] % symbol in .Rd files?
In-Reply-To: <17608.48230.329381.121464@stat.math.ethz.ch>
References: <44C4FE51.1070306@DecisionSynergy.com>	<17608.33665.900040.416162@stat.math.ethz.ch>	<44C8A904.2020408@DecisionSynergy.com>	<17608.46622.450008.260194@stat.math.ethz.ch>	<44C8B6D6.50202@DecisionSynergy.com>
	<17608.48230.329381.121464@stat.math.ethz.ch>
Message-ID: <44C8C0B3.6070508@DecisionSynergy.com>

Martin Maechler wrote:
>>>>>> "Dominick" == Dominick Samperi <dsamperi at DecisionSynergy.com>
>>>>>>     on Thu, 27 Jul 2006 08:51:34 -0400 writes:
>>>>>>             
>
>     Dominick> Martin Maechler wrote:
>     >> Hmm, actually I now start wondering: Why did we ever start
>     >> talking about this at all?  Isn't this something you have to settle
>     >> with Kurt, Fritz, or whomever.. ?
>     >> Regards,
>     >> Martin Maechler
>     Dominick> Sorry if I was unclear, but yes, it was settled with the help of Kurt. As I
>     Dominick> said, the latest r-devel includes some new type checking (to be sure that
>     Dominick> STRING_ELT is applied where it makes sense, for example), and this
>     Dominick> is why CRAN was picking up problems that I was not seeing.
>
> but not related to "%" ???
>
> Also, with R-devel "as of last night"
> I (i.e., "R-devel CMD check")  don't see any problems in
> RcppTemplate or its help files.
>
>     Dominick> I guess I missed that fact about the '%' character in the docs.
>   
This is a somewhat old post, and I didn't mean to suggest that there are 
any remaining
problems (the package wouldn't have been released otherwise). The 
trivial topic about
'%' signs never would have come up if it wasn't mixed up with the other 
unrelated
and non-trivial problem that is now resolved.

Thanks for the feedback.

ds


From sfalcon at fhcrc.org  Thu Jul 27 16:20:29 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 27 Jul 2006 07:20:29 -0700
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <07820D54-9DDC-42F7-8F32-C931B2B80DE6@sympatico.ca> (Kevin B.
	Hendricks's message of "Thu, 27 Jul 2006 09:31:03 -0400")
References: <07820D54-9DDC-42F7-8F32-C931B2B80DE6@sympatico.ca>
Message-ID: <m2zmevceoi.fsf@ziti.local>

"Kevin B. Hendricks" <kevin.hendricks at sympatico.ca> writes:
> My first R attempt was a simple
>
> # sort the data.frame gd and the sort key
> sorder <- order(MDPC)
> gd  <- gd[sorder,]
> MDPC <- MDPC[sorder]
> attach(gd)
>
> # find the length and sum for each unique sort key
> XN <- by(MVE, MDPC, length)
> XSUM <- by(MVE, MDPC, sum)
> GRPS <- levels(as.factor(MDPC))
>
> Well the ordering and sorting was reasonably fast but the first "by"  
> statement was still running 4 hours later on my machine (a dual 2.6  
> gig Opteron with 4 gig of main memory).  This same snippet of code in  
> SAS running on a slower machine takes about 5 minutes of system
> time.

I wonder if split() would be of use here.  Once you have sorted the
data frame gd and the sort keys MDPC, you could do:

gdList <- split(gd$MVE, MDPC)

xn <- sapply(gdList, length)
xsum <- sapply(gdList, sum)

+ seth


From dolive at math.siu.edu  Thu Jul 27 19:41:53 2006
From: dolive at math.siu.edu (dolive at math.siu.edu)
Date: Thu, 27 Jul 2006 19:41:53 +0200 (CEST)
Subject: [Rd] bug with rpois (PR#9106)
Message-ID: <20060727174153.D03F23FC98@slim.kubism.ku.dk>


The R poisson random generator rpois appears to have a bug for
theta 10 or larger. The sample mean of the pseudo variates is too
small: sample mean approx theta - 0.5.

I use Version 1.1.1  (August 15, 2000) Of R on a Dell OptiPlex computer 
with the
Windows XP Professional operating system.

Has this bug been fixed in later versions?

(I found another reported rpois bug, but it appears to be different
and to have been fixed :

rpois gives a large number repeatedly
kjetikj at astro.uio.no
Tue, 15 Feb 2000 12:18:28 +0100 (MET))



The following output helps illustrate the bug.

 > zsim
function(nc = 100, nr = 500, theta = 1)
{# check rpois function
  x <- matrix(rpois(nr*nc, theta),nrow=nr,ncol=nc)
  z<-apply(x,2,mean)
  list(z=z)}

 > zsim(theta=10)
$z
   [1] 9.594 9.552 9.538 9.448 9.438 9.544 9.630 9.474 9.568 9.700 9.720 9.642
  [13] 9.624 9.328 9.420 9.492 9.368 9.674 9.528 9.436 9.296 9.502 9.260 9.440
  [25] 9.572 9.698 9.372 9.458 9.532 9.570 9.534 9.528 9.572 9.536 9.234 9.416
  [37] 9.400 9.370 9.438 9.628 9.672 9.738 9.454 9.478 9.438 9.496 9.672 9.308
  [49] 9.632 9.386 9.842 9.452 9.632 9.460 9.660 9.688 9.486 9.492 9.576 9.664
  [61] 9.290 9.300 9.304 9.472 9.618 9.480 9.458 9.558 9.782 9.532 9.198 9.258
  [73] 9.384 9.630 9.520 9.646 9.554 9.406 9.390 9.554 9.610 9.382 9.604 9.638
  [85] 9.304 9.586 9.848 9.434 9.460 9.644 9.450 9.542 9.502 9.446 9.828 9.364
  [97] 9.664 9.628 9.704 9.354

Notice that all 100 sample means of size 500 are less than 10, about
half should be larger.

The following commands also suggest that the rpois function is biased
for theta > 10.

 > hist(zsim(theta=1)$z)
 > hist(zsim(theta=10)$z)
 > hist(zsim(theta=100)$z)
 > hist(zsim(theta=1000)$z)


Best Regards,


David Olive
dolive at math.siu.edu


From rdpeng at gmail.com  Thu Jul 27 19:53:16 2006
From: rdpeng at gmail.com (rdpeng at gmail.com)
Date: Thu, 27 Jul 2006 19:53:16 +0200 (CEST)
Subject: [Rd] bug with rpois (PR#9106)
Message-ID: <20060727175316.6106348E7B@slim.kubism.ku.dk>

Technically speaking, your version of R is from the previous century.  You might 
want to check with a more recent version before reporting a bug.

-roger

dolive at math.siu.edu wrote:
> The R poisson random generator rpois appears to have a bug for
> theta 10 or larger. The sample mean of the pseudo variates is too
> small: sample mean approx theta - 0.5.
> 
> I use Version 1.1.1  (August 15, 2000) Of R on a Dell OptiPlex computer 
> with the
> Windows XP Professional operating system.
> 
> Has this bug been fixed in later versions?
> 
> (I found another reported rpois bug, but it appears to be different
> and to have been fixed :
> 
> rpois gives a large number repeatedly
> kjetikj at astro.uio.no
> Tue, 15 Feb 2000 12:18:28 +0100 (MET))
> 
> 
> 
> The following output helps illustrate the bug.
> 
>  > zsim
> function(nc = 100, nr = 500, theta = 1)
> {# check rpois function
>   x <- matrix(rpois(nr*nc, theta),nrow=nr,ncol=nc)
>   z<-apply(x,2,mean)
>   list(z=z)}
> 
>  > zsim(theta=10)
> $z
>    [1] 9.594 9.552 9.538 9.448 9.438 9.544 9.630 9.474 9.568 9.700 9.720 9.642
>   [13] 9.624 9.328 9.420 9.492 9.368 9.674 9.528 9.436 9.296 9.502 9.260 9.440
>   [25] 9.572 9.698 9.372 9.458 9.532 9.570 9.534 9.528 9.572 9.536 9.234 9.416
>   [37] 9.400 9.370 9.438 9.628 9.672 9.738 9.454 9.478 9.438 9.496 9.672 9.308
>   [49] 9.632 9.386 9.842 9.452 9.632 9.460 9.660 9.688 9.486 9.492 9.576 9.664
>   [61] 9.290 9.300 9.304 9.472 9.618 9.480 9.458 9.558 9.782 9.532 9.198 9.258
>   [73] 9.384 9.630 9.520 9.646 9.554 9.406 9.390 9.554 9.610 9.382 9.604 9.638
>   [85] 9.304 9.586 9.848 9.434 9.460 9.644 9.450 9.542 9.502 9.446 9.828 9.364
>   [97] 9.664 9.628 9.704 9.354
> 
> Notice that all 100 sample means of size 500 are less than 10, about
> half should be larger.
> 
> The following commands also suggest that the rpois function is biased
> for theta > 10.
> 
>  > hist(zsim(theta=1)$z)
>  > hist(zsim(theta=10)$z)
>  > hist(zsim(theta=100)$z)
>  > hist(zsim(theta=1000)$z)
> 
> 
> Best Regards,
> 
> 
> David Olive
> dolive at math.siu.edu
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From bolker at ufl.edu  Thu Jul 27 22:29:12 2006
From: bolker at ufl.edu (Ben Bolker)
Date: Thu, 27 Jul 2006 20:29:12 +0000 (UTC)
Subject: [Rd] bug with rpois (PR#9106)
References: <20060727174153.D03F23FC98@slim.kubism.ku.dk>
Message-ID: <loom.20060727T222708-458@post.gmane.org>

 <dolive <at> math.siu.edu> writes:

> 
> 
> The R poisson random generator rpois appears to have a bug for
> theta 10 or larger. The sample mean of the pseudo variates is too
> small: sample mean approx theta - 0.5.
> 

  Certainly fixed by 2.3.1:

 zsim <- function(nc = 100, nr = 500, theta = 1)
+ {# check rpois function
+   x <- matrix(rpois(nr*nc, theta),nrow=nr,ncol=nc)
+   z<-apply(x,2,mean)
+   list(z=z)}
> zsim(theta=10)
$z
  [1] 10.064 10.084 10.338  9.848  9.740 10.052  9.954  9.960 10.080 10.062
 [11]  9.702  9.936  9.808 10.100  9.982  9.954  9.854 10.226  9.872 10.280
 [21] 10.236 10.116  9.992  9.904 10.116 10.168 10.144 10.018  9.982 10.016
 [31] 10.148 10.128 10.234 10.030  9.882  9.922 10.150 10.062 10.152  9.804
 [41] 10.178 10.106 10.092 10.080 10.112 10.012 10.074 10.276 10.086 10.048
 [51] 10.072 10.086 10.204  9.974 10.020 10.104  9.792 10.154 10.042 10.046
 [61]  9.882 10.014  9.654 10.126 10.068 10.040 10.094 10.250  9.854  9.966
 [71]  9.852  9.974  9.732  9.986  9.912 10.048  9.750 10.068 10.024  9.842
 [81]  9.640 10.114 10.238 10.138  9.876  9.750 10.310 10.026 10.024 10.132
 [91] 10.088  9.970 10.044  9.912  9.850 10.022  9.970 10.052  9.938  9.994

   it's surprising that such a large bug would have persisted
even up to version 1.1.1.  You should certainly upgrade your version,
but in the meantime you might try starting R in "vanilla" mode to
make sure you don't have a wonky local version of rpois or something
else lying around ...


From tlumley at u.washington.edu  Thu Jul 27 22:44:53 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Thu, 27 Jul 2006 13:44:53 -0700 (PDT)
Subject: [Rd] bug with rpois (PR#9106)
In-Reply-To: <loom.20060727T222708-458@post.gmane.org>
References: <20060727174153.D03F23FC98@slim.kubism.ku.dk>
	<loom.20060727T222708-458@post.gmane.org>
Message-ID: <Pine.LNX.4.64.0607271342450.27893@homer22.u.washington.edu>

On Thu, 27 Jul 2006, Ben Bolker wrote:

> <dolive <at> math.siu.edu> writes:
>
>>
>>
>> The R poisson random generator rpois appears to have a bug for
>> theta 10 or larger. The sample mean of the pseudo variates is too
>> small: sample mean approx theta - 0.5.
>>
>
>  Certainly fixed by 2.3.1:
>

In fact, fixed in 1.2.0, in December 2000.

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From hb at stat.berkeley.edu  Fri Jul 28 08:30:33 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 27 Jul 2006 23:30:33 -0700
Subject: [Rd] Package digest broken under R v2.4.0 devel
Message-ID: <59d7961d0607272330m5bb3613bvdef3fb70104cb6b9@mail.gmail.com>

[cc:ing to the maintainer of digest]

FYI, package 'digest' (v0.2.1 2005/11/04 04:45:53) generates the same
output regardless of input with R v2.4.0 devel (2006-07-25 r38698).
Starting a vanilla R session you get:

> library(digest)
> digest(1)
[1] "3416a75f4cea9109507cacd8e2f2aefc"
> digest(2)
[1] "3416a75f4cea9109507cacd8e2f2aefc"
> digest(rnorm(10))
[1] "3416a75f4cea9109507cacd8e2f2aefc"

It works as expected with R v2.3.1 patched (2006-07-25 r38698):
> library(digest)
> digest(1)
[1] "577e0eb2f3253fc5a8c4a287f7c10e7f"
> digest(2)
[1] "75eb91f4559682af50c21212d0dc013b"

digest() uses serialize() internally, but it has nothing to do with
that.  I managed to track it down to the call to .Call("digest", ...).

BTW, thanks for a very useful package.

Henrik


From ripley at stats.ox.ac.uk  Fri Jul 28 09:06:54 2006
From: ripley at stats.ox.ac.uk (Brian D Ripley)
Date: Fri, 28 Jul 2006 08:06:54 +0100 (BST)
Subject: [Rd] Any interest in "merge" and "by" implementations
 specifically for sorted data?
In-Reply-To: <07820D54-9DDC-42F7-8F32-C931B2B80DE6@sympatico.ca>
Message-ID: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>

Which version of R are you looking at?   R-devel has

    o	merge() works more efficiently when there are relatively few
	matches between the data frames (for example, for 1-1
	matching).  The order of the result is changed for 'sort = FALSE'.


On Thu, 27 Jul 2006, Kevin B. Hendricks wrote:

> Hi Developers,
>
> I am looking for another new project to help me get more up to speed
> on R and to learn something outside of R internals.   One recent R
> issue I have run into is finding a fast implementations of the
> equivalent to the following SAS code:
>
> /* MDPC is an integer sort key made from two integer columns */
> MDPC = (MD * 100000) + PCO;
>
> /* sort the dataset by the key */
> PROC SORT;
>    BY MDPC;
>
> /* print out count and sum for each unique sort key (subgroup) */
> /* use of BY MDPC requires sorting that data set by MDPC first in SAS */
> PROC UNIVARIATE NOPRINT;
>     VAR MVE;
>     BY MDPC;
>     OUTPUT OUT=TMP0 N=XN SUM=XSUM;
>
> Easy to do in R but the problem is the data set this is being run on
> has 1,742,201 lines in it and takes up 196,868,713 bytes to store as
> character data.  The sort key has easily has over 200,000 unique keys
> (if not twice that).
>
> My first R attempt was a simple
>
> # sort the data.frame gd and the sort key
> sorder <- order(MDPC)
> gd  <- gd[sorder,]
> MDPC <- MDPC[sorder]
> attach(gd)
>
> # find the length and sum for each unique sort key
> XN <- by(MVE, MDPC, length)
> XSUM <- by(MVE, MDPC, sum)
> GRPS <- levels(as.factor(MDPC))
>
> Well the ordering and sorting was reasonably fast but the first "by"
> statement was still running 4 hours later on my machine (a dual 2.6
> gig Opteron with 4 gig of main memory).  This same snippet of code in
> SAS running on a slower machine takes about 5 minutes of system time.
>
> I tried various simple R implementations of a "by_sorted" that I
> thought might help
>
> # walk sorted array once and keep track of beginning
> # and ending points for each unique sort key value in p
> # and run function fcn on that sub sequence in vector v
> # store the results in a vector
>
> by_sorted <- function(v, p, fcn) {
>     key <- p[[1]]
>     bp <- 1
>     r <- NULL
>     for (i in 2:length(p)) {
>        if (key != p[[i]]) {
>            r <- c(r,fcn(v[bp:i-1]))
>            bp <- i
>            key <- p[[i]]
>        }
>     }
>     r <- c(r,fcn(v[bp:i]))
> }
>
> but they took "forever" to run also (read that I killed those
> attempts at 15 minutes of cpu time).
>
> I literally had the same issue when trying with "tapply".
>
> So unless it already exists someplace, I need a really fast
> implementation of "by" for very large sorted data sets (probably
> written in fortran or c) that will do the equivalent of what SAS does
> with its "proc univariate by" approach with close to the same
> performance.  The code should only have to walk the array once (ie.
> be linear in time with the number of rows in the vector).   I have
> similar issues with "merge" as well since merging data frames already
> sorted by the same sort key should be fast as well and does not
> appear to be.
>
> Before I jump into this and create my own "sorted large data set"
> versions of "by" and "merge", I wanted to be sure it would be of
> interest to others.  If they work well and are well implemented (a
> big if since I am really still just learning this - the whole point
> of the project!) would something like this be of any interest for
> internal use of R?  Or is this something too specialized?
> Is there an R function implemented in c or fortran that would make a
> good "model" to follow for implementing something like this?
> Would/should they be extensions of current implementations of "merge"
> and "by" with an additions of a sorted=TRUE (defaulting to FALSE)
> extra parameter.
>
> Or am I simply barking up the wrong tree here?
>
> Thanks,
>
> Kevin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From quanah at stanford.edu  Fri Jul 28 02:45:44 2006
From: quanah at stanford.edu (quanah at stanford.edu)
Date: Fri, 28 Jul 2006 02:45:44 +0200 (CEST)
Subject: [Rd] R uses private function in libc (PR#9107)
Message-ID: <20060728004544.72A8241EC5@slim.kubism.ku.dk>

Full_Name: Quanah Gibson-Mount
Version: 2.3.0, 2.3.1
OS: Linux
Submission from: (NULL) (171.66.155.86)


libc used to export the symbol:

__libc_stack_end;

however, newer versions of libc no longer export it.  R has some serious
problems around this, because the code has:

# ifdef linux
extern void * __libc_stack_end;
# endif


and

#if defined(linux)
    R_CStackStart = (uintptr_t) __libc_stack_end;
#elif defined(HAVE_KERN_USRSTACK)


in r-2.3.1/src/unix/system.c

This code needs to be fixed.  It is causing all sorts of problems when trying to
run R across multiple systems with different libc versions.

--Quanah


From ripley at stats.ox.ac.uk  Fri Jul 28 10:24:13 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Fri, 28 Jul 2006 10:24:13 +0200 (CEST)
Subject: [Rd] R uses private function in libc (PR#9107)
Message-ID: <20060728082413.3E01E23D20@slim.kubism.ku.dk>

On Fri, 28 Jul 2006, quanah at stanford.edu wrote:

> Full_Name: Quanah Gibson-Mount
> Version: 2.3.0, 2.3.1
> OS: Linux

That's not adequate information: see below.

> Submission from: (NULL) (171.66.155.86)
> 
> 
> libc used to export the symbol:
> 
> __libc_stack_end;
> 
> however, newer versions of libc no longer export it.  R has some serious

Please tell us what these `newer versions of libc' are.
>g<libc does on e.g. 2.3.6 and 2.4, which is AFAICS current.

> problems around this, because the code has:
> 
> # ifdef linux
> extern void * __libc_stack_end;
> # endif
> 
> 
> and
> 
> #if defined(linux)
>     R_CStackStart = (uintptr_t) __libc_stack_end;
> #elif defined(HAVE_KERN_USRSTACK)
> 
> 
> in r-2.3.1/src/unix/system.c
> 
> This code needs to be fixed.  It is causing all sorts of problems when trying to
> run R across multiple systems with different libc versions.

What are the 'all sorts of problems'?  It seems they are affecting no one 
else, and R is very widely used on Linux systems.  So there is nothing 
here we can reproduce.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pkensche at cmbi.ru.nl  Fri Jul 28 13:53:28 2006
From: pkensche at cmbi.ru.nl (pkensche at cmbi.ru.nl)
Date: Fri, 28 Jul 2006 13:53:28 +0200 (CEST)
Subject: [Rd] substitute(INDICES) in by.data.frame returns invalid
	multi-line name (PR#9108)
Message-ID: <20060728115328.DCCEB19A02@slim.kubism.ku.dk>

Full_Name: Philip Kensche
Version: 2.3.0
OS: Redhat Linux
Submission from: (NULL) (131.174.88.204)


Try this:

--
x <- data.frame(the.first.column=c("A"), the.second.column=c("b"),
the.third.column=c("d"), and.many.more.columns=c("e"))

by(x, paste(x$the.first.column, x$the.second.column, x$and.many.more.columns,
sep="."), function (y) { print("Hello!") })
--

The following error message is produced on my system:

Error in "names<-.default"(`*tmp*`, value = c("paste(x$the.first.column,
x$the.second.column, x$and.many.more.columns, ",  :
        'names' attribute [2] must be the same length as the vector [1]

Calling substitute(INDICES) after debug(by.data.frame) returns:
--
paste(x$the.first.column, x$the.second.column, x$and.many.more.columns,
    sep = ".")
--
i.e. the sep = ... is on the next line.

Greetings,

Philip


From murdoch at stats.uwo.ca  Fri Jul 28 14:29:43 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Fri, 28 Jul 2006 14:29:43 +0200 (CEST)
Subject: [Rd] substitute(INDICES) in by.data.frame returns
	invalid	multi-line (PR#9109)
Message-ID: <20060728122943.4C4B93FCD6@slim.kubism.ku.dk>

On 7/28/2006 7:53 AM, pkensche at cmbi.ru.nl wrote:
> Full_Name: Philip Kensche
> Version: 2.3.0

This version is obsolete, but the error does occur in the current R-patched.

> OS: Redhat Linux
> Submission from: (NULL) (131.174.88.204)
> 
> 
> Try this:
> 
> --
> x <- data.frame(the.first.column=c("A"), the.second.column=c("b"),
> the.third.column=c("d"), and.many.more.columns=c("e"))
> 
> by(x, paste(x$the.first.column, x$the.second.column, x$and.many.more.columns,
> sep="."), function (y) { print("Hello!") })
> --
> 
> The following error message is produced on my system:
> 
> Error in "names<-.default"(`*tmp*`, value = c("paste(x$the.first.column,
> x$the.second.column, x$and.many.more.columns, ",  :
>         'names' attribute [2] must be the same length as the vector [1]
> 
> Calling substitute(INDICES) after debug(by.data.frame) returns:
> --
> paste(x$the.first.column, x$the.second.column, x$and.many.more.columns,
>     sep = ".")
> --
> i.e. the sep = ... is on the next line.

The problem is that

  names(IND) <- deparse(substitute(INDICES))

wraps the long expression; a patch is to replace that line with

  names(IND) <- deparse(substitute(INDICES), width=500)

which would need a much longer line to trigger the error, or

  names(IND) <- deparse(substitute(INDICES))[1]

I'll do the latter, and look for other instances of the same sort of thing.

Duncan Murdoch


From murdoch at stats.uwo.ca  Fri Jul 28 14:28:35 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 28 Jul 2006 08:28:35 -0400
Subject: [Rd] substitute(INDICES) in by.data.frame returns
 invalid	multi-line name (PR#9108)
In-Reply-To: <20060728115328.DCCEB19A02@slim.kubism.ku.dk>
References: <20060728115328.DCCEB19A02@slim.kubism.ku.dk>
Message-ID: <44CA02F3.3090100@stats.uwo.ca>

On 7/28/2006 7:53 AM, pkensche at cmbi.ru.nl wrote:
> Full_Name: Philip Kensche
> Version: 2.3.0

This version is obsolete, but the error does occur in the current R-patched.

> OS: Redhat Linux
> Submission from: (NULL) (131.174.88.204)
> 
> 
> Try this:
> 
> --
> x <- data.frame(the.first.column=c("A"), the.second.column=c("b"),
> the.third.column=c("d"), and.many.more.columns=c("e"))
> 
> by(x, paste(x$the.first.column, x$the.second.column, x$and.many.more.columns,
> sep="."), function (y) { print("Hello!") })
> --
> 
> The following error message is produced on my system:
> 
> Error in "names<-.default"(`*tmp*`, value = c("paste(x$the.first.column,
> x$the.second.column, x$and.many.more.columns, ",  :
>         'names' attribute [2] must be the same length as the vector [1]
> 
> Calling substitute(INDICES) after debug(by.data.frame) returns:
> --
> paste(x$the.first.column, x$the.second.column, x$and.many.more.columns,
>     sep = ".")
> --
> i.e. the sep = ... is on the next line.

The problem is that

  names(IND) <- deparse(substitute(INDICES))

wraps the long expression; a patch is to replace that line with

  names(IND) <- deparse(substitute(INDICES), width=500)

which would need a much longer line to trigger the error, or

  names(IND) <- deparse(substitute(INDICES))[1]

I'll do the latter, and look for other instances of the same sort of thing.

Duncan Murdoch


From hb at stat.berkeley.edu  Fri Jul 28 17:52:04 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 28 Jul 2006 08:52:04 -0700
Subject: [Rd] Package digest broken under R v2.4.0 devel
In-Reply-To: <59d7961d0607272330m5bb3613bvdef3fb70104cb6b9@mail.gmail.com>
References: <59d7961d0607272330m5bb3613bvdef3fb70104cb6b9@mail.gmail.com>
Message-ID: <59d7961d0607280852x386bac20tda7ca2d829da179@mail.gmail.com>

Found the reason for the bug.  Patch available online;

  source("http://www.braju.com/R/patches/digest.R")

In digest() the .Call() statement takes the serialized objected
converted to a string as its second argument;

    val <- .Call("digest", as.character(object), as.integer(algoint),
        as.integer(length), PACKAGE = "digest")

This relies on the fact that 'object' is a single character string not
a vector. Try object <- "a" and object <- c("a", "b"), and you'll get
the same result.

To generate the 'object' string, digest() calls serialize() before.
Now, in R v2.3.1 serialize(input, connect=NULL, ascii=TRUE) returns a
single string, but in R v2.4.0 it returns a raw vector.  This is [of
course ;)] document:

>From ?serialize Rv2.3.1:
For 'serialize', 'NULL' unless 'connection=NULL', when the result is
stored in the first element of a character vector (but is not a normal
character string unless 'ascii = TRUE'

>From ?serialze Rv2.4.0:
For serialize, NULL unless connection=NULL, when the result is stored
in a raw vector.

So the quick a dirty fix of digest() is to do:

 object <- serialize(object, connection=NULL, ascii=TRUE)
 object <- paste(object, collapse="")

This should work in either R version.  I've made this patch available
online. Just call:

  source("http://www.braju.com/R/patches/digest.R")

Its possible that it is faster to serialize to a 'textConnection'.
However, it might be even faster if your internal code, i.e.
.Call("digest", ...), accepts vectors so this does not have to be done
at the R level?

Cheers

Henrik

On 7/27/06, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> [cc:ing to the maintainer of digest]
>
> FYI, package 'digest' (v0.2.1 2005/11/04 04:45:53) generates the same
> output regardless of input with R v2.4.0 devel (2006-07-25 r38698).
> Starting a vanilla R session you get:
>
> > library(digest)
> > digest(1)
> [1] "3416a75f4cea9109507cacd8e2f2aefc"
> > digest(2)
> [1] "3416a75f4cea9109507cacd8e2f2aefc"
> > digest(rnorm(10))
> [1] "3416a75f4cea9109507cacd8e2f2aefc"
>
> It works as expected with R v2.3.1 patched (2006-07-25 r38698):
> > library(digest)
> > digest(1)
> [1] "577e0eb2f3253fc5a8c4a287f7c10e7f"
> > digest(2)
> [1] "75eb91f4559682af50c21212d0dc013b"
>
> digest() uses serialize() internally, but it has nothing to do with
> that.  I managed to track it down to the call to .Call("digest", ...).
>
> BTW, thanks for a very useful package.
>
> Henrik
>


From sfalcon at fhcrc.org  Fri Jul 28 18:44:08 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 28 Jul 2006 09:44:08 -0700
Subject: [Rd] [R] HTTP User-Agent header
In-Reply-To: <Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Fri, 28 Jul 2006 15:43:34 +0100 (BST)")
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>
	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>
Message-ID: <m2u051k7c7.fsf@ziti.fhcrc.org>

[moved from R-help to R-devel]

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
> Otherwise, see ?download.file and choose a different download method,
> or look at the source code (src/modules/internet/nanohttp.c) and submit a 
> patch.

I have a rough draft patch, see below, that adds a User-Agent header
to HTTP requests made in R via download.file.  If there is interest, I
will polish it.

Why have R identify itself?  Well, I think it is reasonable behavior
for legitimate "browsers" to identify themselves.  It will help a user
whose institution has a rather harsh web proxy policy (however, silly
it may be).  It will also be of use in tracking use of R, versions,
and OSes on CRAN mirrors.

Here is an example of what the user-agent string will be for an R
running on OSX:

    R (2.4.0 powerpc-apple-darwin8.7.0 powerpc darwin8.7.0)

And here is the patch...

+ seth

Index: src/include/R_ext/R-ftp-http.h
===================================================================
--- src/include/R_ext/R-ftp-http.h	(revision 38709)
+++ src/include/R_ext/R-ftp-http.h	(working copy)
@@ -36,7 +36,7 @@
 int   R_FTPRead(void *ctx, char *dest, int len);
 void  R_FTPClose(void *ctx);
 
-void *	RxmlNanoHTTPOpen(const char *URL, char **contentType, int cacheOK);
+void *	RxmlNanoHTTPOpen(const char *URL, char **contentType, const char *headers, int cacheOK);
 int	RxmlNanoHTTPRead(void *ctx, void *dest, int len);
 void	RxmlNanoHTTPClose(void *ctx);
 int 	RxmlNanoHTTPReturnCode(void *ctx);
Index: src/include/Rmodules/Rinternet.h
===================================================================
--- src/include/Rmodules/Rinternet.h	(revision 38709)
+++ src/include/Rmodules/Rinternet.h	(working copy)
@@ -9,7 +9,7 @@
 typedef Rconnection (*R_NewUrlRoutine)(char *description, char *mode);
 typedef Rconnection (*R_NewSockRoutine)(char *host, int port, int server, char *mode); 
 
-typedef void * (*R_HTTPOpenRoutine)(const char *url, const int cacheOK);
+typedef void * (*R_HTTPOpenRoutine)(const char *url, const char *headers, const int cacheOK);
 typedef int    (*R_HTTPReadRoutine)(void *ctx, char *dest, int len);
 typedef void   (*R_HTTPCloseRoutine)(void *ctx);
 	      
Index: src/main/names.c
===================================================================
--- src/main/names.c	(revision 38709)
+++ src/main/names.c	(working copy)
@@ -885,7 +885,7 @@
 {"sockSelect",do_sockselect,0,	11,     3,      {PP_FUNCALL, PREC_FN,	0}},
 {"getAllConnections",do_getallconnections,0,11, 0,      {PP_FUNCALL, PREC_FN,	0}},
 {"summary.connection",do_sumconnection,0,11,    1,      {PP_FUNCALL, PREC_FN,	0}},
-{"download", 	do_download,	0,      11,     5,      {PP_FUNCALL, PREC_FN,	0}},
+{"download", 	do_download,	0,      11,     6,      {PP_FUNCALL, PREC_FN,	0}},
 {"nsl", 	do_nsl,		0,      11,     1,      {PP_FUNCALL, PREC_FN,	0}},
 {"gzcon", 	do_gzcon,	0,      11,     3,      {PP_FUNCALL, PREC_FN,	0}},
 
Index: src/main/memory.c
===================================================================
--- src/main/memory.c	(revision 38709)
+++ src/main/memory.c	(working copy)
@@ -2478,8 +2478,11 @@
 SEXP (STRING_ELT)(SEXP x, int i) {
 #ifdef USE_TYPE_CHECKING
     if(TYPEOF(x) != STRSXP)
+      x = 1/(1-1);
+    /*
 	error("%s() can only be applied to a '%s', not a '%s'", 
 	      "STRING_ELT", "character vector", type2char(TYPEOF(x)));
+    */
 #endif
     return STRING_ELT(x, i);
 }
Index: src/main/internet.c
===================================================================
--- src/main/internet.c	(revision 38709)
+++ src/main/internet.c	(working copy)
@@ -129,7 +129,7 @@
 {
     if(!initialized) internet_Init();
     if(initialized > 0)
-	return (*ptr->HTTPOpen)(url, 0);
+	return (*ptr->HTTPOpen)(url, NULL, 0);
     else {
 	error(_("internet routines cannot be loaded"));
 	return NULL;
Index: src/library/utils/R/unix/download.file.R
===================================================================
--- src/library/utils/R/unix/download.file.R	(revision 38709)
+++ src/library/utils/R/unix/download.file.R	(working copy)
@@ -1,5 +1,5 @@
-download.file <- function(url, destfile, method,
-                          quiet = FALSE, mode = "w", cacheOK = TRUE)
+download.file <- function(url, destfile, method, quiet = FALSE, mode = "w",
+                          cacheOK = TRUE, headers = NULL)
 {
     method <- if (missing(method))
         ifelse(!is.null(getOption("download.file.method")),
@@ -7,6 +7,8 @@
                "auto")
     else
         match.arg(method, c("auto", "internal", "wget", "lynx"))
+    if (is.null(headers))
+      headers <- httpUserAgent()
 
     if(method == "auto") {
         if(capabilities("http/ftp"))
@@ -22,7 +24,8 @@
             stop("no download method found")
     }
     if(method == "internal")
-        status <- .Internal(download(url, destfile, quiet, mode, cacheOK))
+      status <- .Internal(download(url, destfile, quiet, mode, headers,
+                                   cacheOK))
     else if(method == "wget") {
         extra <- if(quiet) " --quiet" else ""
         if(!cacheOK) extra <- paste(extra, "--cache=off")
Index: src/library/utils/R/windows/download.file.R
===================================================================
--- src/library/utils/R/windows/download.file.R	(revision 38709)
+++ src/library/utils/R/windows/download.file.R	(working copy)
@@ -1,5 +1,5 @@
-download.file <- function(url, destfile, method,
-                          quiet = FALSE, mode = "w", cacheOK = TRUE)
+download.file <- function(url, destfile, method, quiet = FALSE, mode = "w",
+                          cacheOK = TRUE, headers = NULL)
 {
     method <- if (missing(method))
         ifelse(!is.null(getOption("download.file.method")),
@@ -7,6 +7,8 @@
                "auto")
     else
         match.arg(method, c("auto", "internal", "wget", "lynx"))
+    if (is.null(headers))
+      headers <- httpUserAgent()
 
     if(method == "auto") {
         if(capabilities("http/ftp"))
@@ -22,7 +24,8 @@
             stop("no download method found")
     }
     if(method == "internal")
-        status <- .Internal(download(url, destfile, quiet, mode, cacheOK))
+        status <- .Internal(download(url, destfile, quiet, mode, headers,
+                                     cacheOK))
     else if(method == "wget") {
         extra <- if(quiet) " --quiet" else ""
         if(!cacheOK) extra <- paste(extra, "--cache=off")
Index: src/library/utils/R/readhttp.R
===================================================================
--- src/library/utils/R/readhttp.R	(revision 38709)
+++ src/library/utils/R/readhttp.R	(working copy)
@@ -6,3 +6,15 @@
         stop("transfer failure")
     file.show(file, delete.file = delete.file, title = title, ...)
 }
+
+
+httpUserAgent <- function(agent)
+{
+    if (missing(agent)) {
+        Rver <- paste(R.version$major, R.version$minor, sep=".")
+        Rdetails <- paste(Rver, R.version$platform, R.version$arch,
+                          R.version$os)
+        agent <- paste("R (", Rdetails, ")", sep="")
+    }
+    paste("User-Agent: ", agent, "\r\n", sep="")
+}
Index: src/library/utils/man/download.file.Rd
===================================================================
--- src/library/utils/man/download.file.Rd	(revision 38709)
+++ src/library/utils/man/download.file.Rd	(working copy)
@@ -29,6 +29,13 @@
 
   \item{cacheOK}{logical.  Is a server-side cached value acceptable?
     Implemented for the \code{"internal"} and \code{"wget"} methods.}
+
+  \item{headers}{character. Headers to be used in the HTTP request.
+  This should be a character vector of length one formatted correctly
+  for use in the HTTP header.  The default value of \code{NULL}
+  results in a standard user agent header to be added to the HTTP
+  request that identified R as \code{User-Agent: R (X.Y.Z platform
+  arch os)}.  }
 }
 \details{
   The function \code{download.file} can be used to download a single
Index: src/modules/internet/internet.c
===================================================================
--- src/modules/internet/internet.c	(revision 38709)
+++ src/modules/internet/internet.c	(working copy)
@@ -28,7 +28,7 @@
 #include <Rconnections.h>
 #include <R_ext/R-ftp-http.h>
 
-static void *in_R_HTTPOpen(const char *url, const int cacheOK);
+static void *in_R_HTTPOpen(const char *url, const char *headers, const int cacheOK);
 static int   in_R_HTTPRead(void *ctx, char *dest, int len);
 static void  in_R_HTTPClose(void *ctx);
 
@@ -70,7 +70,7 @@
 
     switch(type) {
     case HTTPsh:
-	ctxt = in_R_HTTPOpen(url, 0);
+	ctxt = in_R_HTTPOpen(url, NULL, 0);
 	if(ctxt == NULL) {
 	  /* if we call error() we get a connection leak*/
 	  /* so do_url has to raise the error*/
@@ -238,14 +238,14 @@
 }
 #endif
 
-/* download(url, destfile, quiet, mode, cacheOK) */
+/* download(url, destfile, quiet, mode, headers, cacheOK) */
 
 #define CPBUFSIZE 65536
 #define IBUFSIZE 4096
 static SEXP in_do_download(SEXP call, SEXP op, SEXP args, SEXP env)
 {
-    SEXP ans, scmd, sfile, smode;
-    char *url, *file, *mode;
+    SEXP ans, scmd, sfile, smode, sheaders;
+    char *url, *file, *mode, *headers;
     int quiet, status = 0, cacheOK;
 
     checkArity(op, args);
@@ -268,6 +268,14 @@
     if(!isString(smode) || length(smode) != 1)
 	error(_("invalid '%s' argument"), "mode");
     mode = CHAR(STRING_ELT(smode, 0));
+    sheaders = CAR(args); args = CDR(args);
+    if(TYPEOF(sheaders) == NILSXP)
+        headers = NULL;
+    else {
+        if(!isString(sheaders) || length(sheaders) != 1)
+            error(_("invalid '%s' argument"), "headers");
+        headers = CHAR(STRING_ELT(sheaders, 0));
+    }
     cacheOK = asLogical(CAR(args));
     if(cacheOK == NA_LOGICAL)
 	error(_("invalid '%s' argument"), "cacheOK");
@@ -319,7 +327,7 @@
 #ifdef Win32
 	R_FlushConsole();
 #endif
-	ctxt = in_R_HTTPOpen(url, cacheOK);
+	ctxt = in_R_HTTPOpen(url, headers, cacheOK);
 	if(ctxt == NULL) status = 1;
 	else {
 	    if(!quiet) REprintf(_("opened URL\n"), url);
@@ -473,7 +481,7 @@
 
 #if defined(SUPPORT_LIBXML) && !defined(USE_WININET)
 
-void *in_R_HTTPOpen(const char *url, int cacheOK)
+void *in_R_HTTPOpen(const char *url, const char *headers, const int cacheOK)
 {
     inetconn *con;
     void *ctxt;
@@ -484,15 +492,15 @@
     if(timeout == NA_INTEGER || timeout <= 0) timeout = 60;
 
     RxmlNanoHTTPTimeout(timeout);
-    ctxt = RxmlNanoHTTPOpen(url, NULL, cacheOK);
+    ctxt = RxmlNanoHTTPOpen(url, NULL, headers, cacheOK);
     if(ctxt != NULL) {
 	int rc = RxmlNanoHTTPReturnCode(ctxt);
 	if(rc != 200) {
 	    char *msg;
-	    RxmlNanoHTTPClose(ctxt);
 	    /* bug work-around: it will crash on OS X if passed directly */
 	    msg = _("cannot open: HTTP status was '%d %s'");
 	    warning(msg, rc, RxmlNanoHTTPStatusMsg(ctxt));
+	    RxmlNanoHTTPClose(ctxt);
 	    return NULL;
 	} else {
 	    type = RxmlNanoHTTPContentType(ctxt);
Index: src/modules/internet/nanohttp.c
===================================================================
--- src/modules/internet/nanohttp.c	(revision 38709)
+++ src/modules/internet/nanohttp.c	(working copy)
@@ -1034,6 +1034,9 @@
  * @contentType:  if available the Content-Type information will be
  *                returned at that location
  *
+ * @headers: headers to be used in the HTTP request.  These must be name/value
+ *           pairs separated by ':', each on their own line.
+ *
  * This function try to open a connection to the indicated resource
  * via HTTP GET.
  *
@@ -1042,10 +1045,11 @@
  */
 
 void*
-RxmlNanoHTTPOpen(const char *URL, char **contentType, int cacheOK)
+RxmlNanoHTTPOpen(const char *URL, char **contentType, const char *headers,
+                 int cacheOK)
 {
     if (contentType != NULL) *contentType = NULL;
-    return RxmlNanoHTTPMethod(URL, NULL, NULL, contentType, NULL, cacheOK);
+    return RxmlNanoHTTPMethod(URL, NULL, NULL, contentType, headers, cacheOK);
 }
 
 /**


From jh at jameshoward.us  Fri Jul 28 19:22:44 2006
From: jh at jameshoward.us (James P. Howard, II)
Date: Fri, 28 Jul 2006 13:22:44 -0400
Subject: [Rd] [R] HTTP User-Agent header
In-Reply-To: <m2u051k7c7.fsf@ziti.fhcrc.org>
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>
	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>
	<m2u051k7c7.fsf@ziti.fhcrc.org>
Message-ID: <88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>

On 7/28/06, Seth Falcon <sfalcon at fhcrc.org> wrote:

> I have a rough draft patch, see below, that adds a User-Agent header
> to HTTP requests made in R via download.file.  If there is interest, I
> will polish it.

It looks right, but I am running under Windows without a compiler.

-- 
James P. Howard, II  -  jh at jameshoward.us
http://jameshoward.us/  -  (443)-430-4050


From kevin.hendricks at sympatico.ca  Fri Jul 28 19:23:23 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Fri, 28 Jul 2006 13:23:23 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
Message-ID: <FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>

Hi,

I was using my installed R which is 2.3.1 for the first tests.  I  
moved to the r-devel tree (I svn up and rebuild everyday) for my "by"  
tests to see if it would work any better.  I neglected to retest  
"merge" with the devel version.

So it appears "merge" is already fixed and I just need to worry about  
"by".

On Jul 28, 2006, at 3:06 AM, Brian D Ripley wrote:

> Which version of R are you looking at?   R-devel has
>
>     o	merge() works more efficiently when there are relatively few
> 	matches between the data frames (for example, for 1-1
> 	matching).  The order of the result is changed for 'sort = FALSE'.
>

Thanks,

Kevin


From quanah at stanford.edu  Fri Jul 28 19:35:18 2006
From: quanah at stanford.edu (quanah at stanford.edu)
Date: Fri, 28 Jul 2006 19:35:18 +0200 (CEST)
Subject: [Rd] R uses private function in libc (PR#9107)
Message-ID: <20060728173518.BB42D3F03F@slim.kubism.ku.dk>



--On Friday, July 28, 2006 9:23 AM +0100 Prof Brian Ripley 
<ripley at stats.ox.ac.uk> wrote:

> On Fri, 28 Jul 2006, quanah at stanford.edu wrote:
>
>> Full_Name: Quanah Gibson-Mount
>> Version: 2.3.0, 2.3.1
>> OS: Linux
>
> That's not adequate information: see below.
>
>> Submission from: (NULL) (171.66.155.86)
>>
>>
>> libc used to export the symbol:
>>
>> __libc_stack_end;
>>
>> however, newer versions of libc no longer export it.  R has some serious
>
> Please tell us what these `newer versions of libc' are.
>> g<libc does on e.g. 2.3.6 and 2.4, which is AFAICS current.
>
>> problems around this, because the code has:
>>
>> # ifdef linux
>> extern void * __libc_stack_end;
>> # endif
>>
>>
>> and
>>
>> # if defined(linux)
>>     R_CStackStart = (uintptr_t) __libc_stack_end;
>> # elif defined(HAVE_KERN_USRSTACK)
>>
>>
>> in r-2.3.1/src/unix/system.c
>>
>> This code needs to be fixed.  It is causing all sorts of problems when
>> trying to run R across multiple systems with different libc versions.
>
> What are the 'all sorts of problems'?  It seems they are affecting no one
> else, and R is very widely used on Linux systems.  So there is nothing
> here we can reproduce.

Well, here is a little background:

At Stanford, we build software and then make it available to campus via a 
distributed file system (AFS in our case).  In building "R" for our new 
64-bit Linux tree, we encountered this issue after building R on our 64-bit 
Debian Sarge system, which has libc version 2.3.2, and does export 
__libc_stack_end, although it is marked private, as it should be:

readelf -s /lib/libc.so.6 | grep __libc_stack_end
  1144: 0000000000000000     8 OBJECT  GLOBAL DEFAULT  UND 
__libc_stack_end at GLIBC_PRIVATE (9)

After I released the build to campus, we immediately got reports that it 
didn't work on other systems, and finally tracked that down to the newer 
versions of libc on those systems:

bramble01:~> readelf -s /lib/libc.so.6 | grep __libc_stack_end
bramble01:~> ldd --version
ldd (GNU libc) 2.3.6

yen4:~> readelf -s /lib/libc.so.6 | grep __libc_stack_end
  2148: 00000000     4 OBJECT  GLOBAL DEFAULT  UND 
__libc_stack_end at GLIBC_2.1 (22)
  6010: 00000000     4 OBJECT  GLOBAL DEFAULT  UND __libc_stack_end@@GLIBC_2
yen4:~> ldd --version
ldd (GNU libc) 2.3.4


When running "R" on either the bramble or yen systems, the error one gets 
is:

yen4:~> R
/usr/pubsw/lib/R/2.3.1/R/bin/exec/R: relocation error:
/usr/pubsw/lib/R/2.3.1/R/bin/exec/R: symbol __libc_stack_end, version
GLIBC_PRIVATE not defined in file ld-linux-x86-64.so.2 with link time
reference


bramble01:~> R
/usr/pubsw/lib/R/2.3.1/R/bin/exec/R: relocation error: 
/usr/pubsw/lib/R/2.3.1/R/bin/exec/R: symbol __libc_stack_end, version 
GLIBC_PRIVATE not defined in file ld-linux-x86-64.so.2 with link time 
reference


For now, I've managed to get around this by patching R thusly:

cat libc
--- r-2.3.1/src/unix/system.c.orig      2006-07-27 17:42:10.000000000 -0700
+++ r-2.3.1/src/unix/system.c   2006-07-27 17:46:42.000000000 -0700
@@ -117,9 +117,9 @@
 #  include <sys/time.h>
 # endif
 # include <sys/resource.h>
-# ifdef linux
+/* # ifdef linux
 extern void * __libc_stack_end;
-# endif
+# endif */
 # ifdef HAVE_KERN_USRSTACK
 #  include <unistd.h>
 #  include <sys/types.h>
@@ -157,9 +157,10 @@
        lim2 = (unsigned long) rlim.rlim_max; /* Usually unlimited */
         R_CStackLimit = lim1 < lim2 ? lim1 : lim2;
     }
-#if defined(linux)
+/* #if defined(linux)
     R_CStackStart = (uintptr_t) __libc_stack_end;
-#elif defined(HAVE_KERN_USRSTACK)
+#elif defined(HAVE_KERN_USRSTACK) */
+#if defined(HAVE_KERN_USRSTACK)
     {
        /* Borrowed from mzscheme/gc/os_dep.c */
        int nm[2] = {CTL_KERN, KERN_USRSTACK};


In any case, as you can see, __libc_stack_end goes away completely by libc 
2.3.6, and as noted in the follow-up I sent to this bug yesterday, the 
reasons one shouldn't use this symbol are quite clearly stated here:

<http://www.mail-archive.com/debian-glibc at lists.debian.org/msg28253.html>

--Quanah

--
Quanah Gibson-Mount
Principal Software Developer
ITS/Shared Application Services
Stanford University
GnuPG Public Key: http://www.stanford.edu/~quanah/pgp.html


From tlumley at u.washington.edu  Fri Jul 28 19:48:02 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Fri, 28 Jul 2006 10:48:02 -0700 (PDT)
Subject: [Rd] R uses private function in libc (PR#9107)
In-Reply-To: <20060728173518.BB42D3F03F@slim.kubism.ku.dk>
References: <20060728173518.BB42D3F03F@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0607281039530.29331@homer23.u.washington.edu>

>
>
> In any case, as you can see, __libc_stack_end goes away completely by libc
> 2.3.6, and as noted in the follow-up I sent to this bug yesterday, the
> reasons one shouldn't use this symbol are quite clearly stated here:
>
> <http://www.mail-archive.com/debian-glibc at lists.debian.org/msg28253.html>
>

Only up to a point.  We know that __libc_stack_end is not portable, but it 
is being used to do something that is impossible to do portably: check 
whether the C stack is about to overflow. Since there is no way to recover 
from a C stack overflow, being able to prevent it is valuable.

Your fix disables this facility on all Linux systems, which may be 
appropriate for your systems but is clearly undesirable as a change to R. 
The real question is how to detect systems that do provide 
__libc_stack_end and whether there is another non-portable way to do the 
same thing on glibc versions that don't provide it.

 	-thomas


From ggrothendieck at gmail.com  Fri Jul 28 20:12:15 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 28 Jul 2006 14:12:15 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
Message-ID: <971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>

There was a performance comparison of several moving average
approaches here:
http://tolstoy.newcastle.edu.au/R/help/04/10/5161.html

The author of that message ultimately wrote the caTools R package
which contains some optimized versions.

Not sure if these results suggest anything of interest here but it
would be interesting if various base routines could be sped up
to the point that a simple idiom is competitive with the caTools versions.


On 7/28/06, Kevin B. Hendricks <kevin.hendricks at sympatico.ca> wrote:
> Hi,
>
> I was using my installed R which is 2.3.1 for the first tests.  I
> moved to the r-devel tree (I svn up and rebuild everyday) for my "by"
> tests to see if it would work any better.  I neglected to retest
> "merge" with the devel version.
>
> So it appears "merge" is already fixed and I just need to worry about
> "by".
>
> On Jul 28, 2006, at 3:06 AM, Brian D Ripley wrote:
>
> > Which version of R are you looking at?   R-devel has
> >
> >     o merge() works more efficiently when there are relatively few
> >       matches between the data frames (for example, for 1-1
> >       matching).  The order of the result is changed for 'sort = FALSE'.
> >
>
> Thanks,
>
> Kevin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From kevin.hendricks at sympatico.ca  Fri Jul 28 20:53:57 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Fri, 28 Jul 2006 14:53:57 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
Message-ID: <D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>

Hi,

> There was a performance comparison of several moving average
> approaches here:
> http://tolstoy.newcastle.edu.au/R/help/04/10/5161.html
>

Thanks for that link.  It is not quite the same thing but is very  
similar.

The idea is to somehow make functions that work well over small sub- 
sequences of a much longer vector without resorting to splitting the  
vector into many smaller  vectors.

In my particular case, the problem was my data frame had over 1  
million lines had probably over 500,000 unique sort keys (ie. think  
of it as an R factor with over 500,000 levels).  The implementation  
of "by" uses "tapply" which in turn uses "split".  So "split" simply  
ate up all the time trying to create 500,000 vectors each of short  
length 1, 2, or 3; and the associated garbage collection.

I simple loop that walked the short sequence of values (since the  
data frame was already sorted) calculating what it needed, would work  
much faster than splitting the original vector into so very many  
smaller vectors (and the associated copying of data).

That problem is very similar problem to the calculation of basic  
stats on a short moving window over a very long vector.

> The author of that message ultimately wrote the caTools R package
> which contains some optimized versions.

I will look into that package and maybe use it for a model for what I  
want to do.

Thanks,

Kevin


From rgentlem at fhcrc.org  Fri Jul 28 21:12:32 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Fri, 28 Jul 2006 12:12:32 -0700
Subject: [Rd] [R] HTTP User-Agent header
In-Reply-To: <88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>	<m2u051k7c7.fsf@ziti.fhcrc.org>
	<88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>
Message-ID: <44CA61A0.7090804@fhcrc.org>

I wonder if it would not be better to make the user agent string 
something that is configurable (at the time R is built) rather than at 
run time. This would make Seth's patch about 1% as long. Or this could 
be handled as an option. The patches are pretty extensive and allow for 
setting the agent header by setting parameters in function calls (eg 
download.files). I am not sure there is a good use case for that level 
of flexibility and the additional code is substantial.


The issue that I think arises is that there are potentially other 
systems that will be unhappy with R's identification of itself and so 
some users may also need to turn it off.

Any strong opinions?



James P. Howard, II wrote:
> On 7/28/06, Seth Falcon <sfalcon at fhcrc.org> wrote:
> 
>> I have a rough draft patch, see below, that adds a User-Agent header
>> to HTTP requests made in R via download.file.  If there is interest, I
>> will polish it.
> 
> It looks right, but I am running under Windows without a compiler.
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From ripley at stats.ox.ac.uk  Fri Jul 28 21:26:22 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 28 Jul 2006 20:26:22 +0100 (BST)
Subject: [Rd] [R] HTTP User-Agent header
In-Reply-To: <44CA61A0.7090804@fhcrc.org>
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>
	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>
	<m2u051k7c7.fsf@ziti.fhcrc.org>
	<88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>
	<44CA61A0.7090804@fhcrc.org>
Message-ID: <Pine.LNX.4.64.0607282018330.10512@gannet.stats.ox.ac.uk>

On Fri, 28 Jul 2006, Robert Gentleman wrote:

> I wonder if it would not be better to make the user agent string 
> something that is configurable (at the time R is built) rather than at 
> run time. This would make Seth's patch about 1% as long. Or this could 
> be handled as an option. The patches are pretty extensive and allow for 
> setting the agent header by setting parameters in function calls (eg 
> download.files). I am not sure there is a good use case for that level 
> of flexibility and the additional code is substantial.
> 
> 
> The issue that I think arises is that there are potentially other 
> systems that will be unhappy with R's identification of itself and so 
> some users may also need to turn it off.

I also thought that there was no need for this level of complexity. 
(BTW, some of the patch is changes Seth has made for other purposes, e.g. 
that to memory.c, so please no one apply all of it.)

I'd be happy for R to just identify itself as 'R', which seems allowed:
(http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html).  But I am a bit 
concerned that sites may not just require the field but also require a 
particular format (even though W3C does not).

> 
> Any strong opinions?
> 
> 
> 
> James P. Howard, II wrote:
> > On 7/28/06, Seth Falcon <sfalcon at fhcrc.org> wrote:
> > 
> >> I have a rough draft patch, see below, that adds a User-Agent header
> >> to HTTP requests made in R via download.file.  If there is interest, I
> >> will polish it.
> > 
> > It looks right, but I am running under Windows without a compiler.
> > 
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Fri Jul 28 21:40:25 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 28 Jul 2006 12:40:25 -0700
Subject: [Rd] [R] HTTP User-Agent header
In-Reply-To: <44CA61A0.7090804@fhcrc.org>
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>
	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>
	<m2u051k7c7.fsf@ziti.fhcrc.org>
	<88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>
	<44CA61A0.7090804@fhcrc.org>
Message-ID: <59d7961d0607281240j612ed4b5h2e67ae8fe838b52d@mail.gmail.com>

On 7/28/06, Robert Gentleman <rgentlem at fhcrc.org> wrote:
> I wonder if it would not be better to make the user agent string
> something that is configurable (at the time R is built) rather than at
> run time. This would make Seth's patch about 1% as long. Or this could
> be handled as an option. The patches are pretty extensive and allow for
> setting the agent header by setting parameters in function calls (eg
> download.files). I am not sure there is a good use case for that level
> of flexibility and the additional code is substantial.
>
>
> The issue that I think arises is that there are potentially other
> systems that will be unhappy with R's identification of itself and so
> some users may also need to turn it off.
>
> Any strong opinions?

Actually two:

1) If you wish to pull down (read extract from HTML or similar) live
data from the web, you might want to be able to "immitate" a certain
browser.  For instance, if you tell some webserver you're a simple
"mobile phone" or "lynx", you might be able get back very clean data.
Some servers might also block unknown web browsers.

2) If the webserver of a package reprocitory decided to make use of
the user-agent string to decide what version of the reprocitory it
should deliver, I would like to be able to trick the server.  Why?
Many times I found myself working on a system where I do not have the
rights to update to the latest or the developers version of R.
However, although I have not the very latest version of R you can do
work.  For instance, in Bioconductor the biocLite() & co gives you
either the stable or the developers of Bioconductor depending on your
R version, but looking into the biocLite() code and beyond, you find
that you actually can install a Bioconductor v1.9 package in R v2.3.1.
 It can be risky business, but if you know what you're doing, it can
save your day (or week).

Cheers

Henrik

>
>
> James P. Howard, II wrote:
> > On 7/28/06, Seth Falcon <sfalcon at fhcrc.org> wrote:
> >
> >> I have a rough draft patch, see below, that adds a User-Agent header
> >> to HTTP requests made in R via download.file.  If there is interest, I
> >> will polish it.
> >
> > It looks right, but I am running under Windows without a compiler.
> >
>
> --
> Robert Gentleman, PhD
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M2-B876
> PO Box 19024
> Seattle, Washington 98109-1024
> 206-667-7700
> rgentlem at fhcrc.org
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From rgentlem at fhcrc.org  Fri Jul 28 21:40:19 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Fri, 28 Jul 2006 12:40:19 -0700
Subject: [Rd] [R] HTTP User-Agent header
In-Reply-To: <Pine.LNX.4.64.0607282018330.10512@gannet.stats.ox.ac.uk>
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>	<m2u051k7c7.fsf@ziti.fhcrc.org>	<88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>	<44CA61A0.7090804@fhcrc.org>
	<Pine.LNX.4.64.0607282018330.10512@gannet.stats.ox.ac.uk>
Message-ID: <44CA6823.9010900@fhcrc.org>



Prof Brian Ripley wrote:
> On Fri, 28 Jul 2006, Robert Gentleman wrote:
> 
>> I wonder if it would not be better to make the user agent string 
>> something that is configurable (at the time R is built) rather than at 
>> run time. This would make Seth's patch about 1% as long. Or this could 
>> be handled as an option. The patches are pretty extensive and allow for 
>> setting the agent header by setting parameters in function calls (eg 
>> download.files). I am not sure there is a good use case for that level 
>> of flexibility and the additional code is substantial.
>>
>>
>> The issue that I think arises is that there are potentially other 
>> systems that will be unhappy with R's identification of itself and so 
>> some users may also need to turn it off.
> 
> I also thought that there was no need for this level of complexity. 
> (BTW, some of the patch is changes Seth has made for other purposes, e.g. 
> that to memory.c, so please no one apply all of it.)
> 
> I'd be happy for R to just identify itself as 'R', which seems allowed:
> (http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html).  But I am a bit 
> concerned that sites may not just require the field but also require a 
> particular format (even though W3C does not).

   For those of use that want to monitor downloads and get an idea of 
the size of the user base for different platforms (which helps to 
allocate resources) I think that we should try to include a bit more 
information.
  I could probably live with as little as R version, but would like to 
have OS there as well...

   best wishes
    Robert


> 
>> Any strong opinions?
>>
>>
>>
>> James P. Howard, II wrote:
>>> On 7/28/06, Seth Falcon <sfalcon at fhcrc.org> wrote:
>>>
>>>> I have a rough draft patch, see below, that adds a User-Agent header
>>>> to HTTP requests made in R via download.file.  If there is interest, I
>>>> will polish it.
>>> It looks right, but I am running under Windows without a compiler.
>>>
>>
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From rgentlem at fhcrc.org  Fri Jul 28 21:52:27 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Fri, 28 Jul 2006 12:52:27 -0700
Subject: [Rd] [R] HTTP User-Agent header
In-Reply-To: <59d7961d0607281240j612ed4b5h2e67ae8fe838b52d@mail.gmail.com>
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>	<m2u051k7c7.fsf@ziti.fhcrc.org>	<88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>	<44CA61A0.7090804@fhcrc.org>
	<59d7961d0607281240j612ed4b5h2e67ae8fe838b52d@mail.gmail.com>
Message-ID: <44CA6AFB.4040207@fhcrc.org>

OK, that suggests setting at the options level would solve both of your 
problems and that seems like the best approach. I don't really want to 
pass this around as a parameter through the maze of functions that might 
actually download something if we don't have to.

I think we can provide something early next week on R-devel for folks to 
test. But I suspect that as Henrik also does, the set of sites that will 
refuse us with a User-Agent header will be much larger than those that 
James has found that refuse us without it.

best wishes
   Robert


Henrik Bengtsson wrote:
> On 7/28/06, Robert Gentleman <rgentlem at fhcrc.org> wrote:
>> I wonder if it would not be better to make the user agent string
>> something that is configurable (at the time R is built) rather than at
>> run time. This would make Seth's patch about 1% as long. Or this could
>> be handled as an option. The patches are pretty extensive and allow for
>> setting the agent header by setting parameters in function calls (eg
>> download.files). I am not sure there is a good use case for that level
>> of flexibility and the additional code is substantial.
>>
>>
>> The issue that I think arises is that there are potentially other
>> systems that will be unhappy with R's identification of itself and so
>> some users may also need to turn it off.
>>
>> Any strong opinions?
> 
> Actually two:
> 
> 1) If you wish to pull down (read extract from HTML or similar) live
> data from the web, you might want to be able to "immitate" a certain
> browser.  For instance, if you tell some webserver you're a simple
> "mobile phone" or "lynx", you might be able get back very clean data.
> Some servers might also block unknown web browsers.
> 
> 2) If the webserver of a package reprocitory decided to make use of
> the user-agent string to decide what version of the reprocitory it
> should deliver, I would like to be able to trick the server.  Why?
> Many times I found myself working on a system where I do not have the
> rights to update to the latest or the developers version of R.
> However, although I have not the very latest version of R you can do
> work.  For instance, in Bioconductor the biocLite() & co gives you
> either the stable or the developers of Bioconductor depending on your
> R version, but looking into the biocLite() code and beyond, you find
> that you actually can install a Bioconductor v1.9 package in R v2.3.1.
>  It can be risky business, but if you know what you're doing, it can
> save your day (or week).
> 
> Cheers
> 
> Henrik
> 
>>
>> James P. Howard, II wrote:
>>> On 7/28/06, Seth Falcon <sfalcon at fhcrc.org> wrote:
>>>
>>>> I have a rough draft patch, see below, that adds a User-Agent header
>>>> to HTTP requests made in R via download.file.  If there is interest, I
>>>> will polish it.
>>> It looks right, but I am running under Windows without a compiler.
>>>
>> --
>> Robert Gentleman, PhD
>> Program in Computational Biology
>> Division of Public Health Sciences
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N, M2-B876
>> PO Box 19024
>> Seattle, Washington 98109-1024
>> 206-667-7700
>> rgentlem at fhcrc.org
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From sfalcon at fhcrc.org  Fri Jul 28 21:55:26 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 28 Jul 2006 12:55:26 -0700
Subject: [Rd] [R] HTTP User-Agent header
In-Reply-To: <Pine.LNX.4.64.0607282018330.10512@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Fri, 28 Jul 2006 20:26:22 +0100 (BST)")
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>
	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>
	<m2u051k7c7.fsf@ziti.fhcrc.org>
	<88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>
	<44CA61A0.7090804@fhcrc.org>
	<Pine.LNX.4.64.0607282018330.10512@gannet.stats.ox.ac.uk>
Message-ID: <m2hd11ijwx.fsf@ziti.fhcrc.org>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
> I also thought that there was no need for this level of complexity. 
> (BTW, some of the patch is changes Seth has made for other purposes, e.g. 
> that to memory.c, so please no one apply all of it.)

*blush* sorry about that.  I made the final diff from a src tree on
another machine and it was dirty.  memory.c should NOT have been
touched by my patch.

> I'd be happy for R to just identify itself as 'R', which seems allowed:
> (http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html).  But I am a bit 
> concerned that sites may not just require the field but also require a 
> particular format (even though W3C does not).

As long as it is going to identify itself, I think there is value in
having it provide version, platform, OS info.

Given the concern that some sites that currently work may stop working
(example?), perhaps making this a global option is a good compromise.
The option could be httpRequestHeader and the default value would be
as proposed in my patch.  A NULL value would result in the current
behavior, no extra header info in the request.


From maechler at stat.math.ethz.ch  Fri Jul 28 21:55:37 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 28 Jul 2006 21:55:37 +0200
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
Message-ID: <17610.27577.357168.917772@stat.math.ethz.ch>

>>>>> "Kevin" == Kevin B Hendricks <kevin.hendricks at sympatico.ca>
>>>>>     on Fri, 28 Jul 2006 14:53:57 -0400 writes:

    [.........]

    Kevin> The idea is to somehow make functions that work well
    Kevin> over small sub- sequences of a much longer vector
    Kevin> without resorting to splitting the vector into many
    Kevin> smaller vectors.

    Kevin> In my particular case, the problem was my data frame
    Kevin> had over 1 million lines had probably over 500,000
    Kevin> unique sort keys (ie. think of it as an R factor with
    Kevin> over 500,000 levels).  The implementation of "by"
    Kevin> uses "tapply" which in turn uses "split".  So "split"
    Kevin> simply ate up all the time trying to create 500,000
    Kevin> vectors each of short length 1, 2, or 3; and the
    Kevin> associated garbage collection.

Not that I have spent enough time thinking about this thread's
topic, but I have seen more than one case where using  tapply()
unnecessarily slowed down computations.
I don't remember the details, but know that in one case, replacing
tapply() by a few lines of code {one of which using lapply() IIRC},
sped up that computation by a factor (of 2 ? or more?).

I also vaguely remember that I thought about making tapply()
faster, but came to the conclusion it could not be
sped up quickly, because it works in a quite more general
context than it was used in that application (and maybe yours?).


    Kevin> I simple loop that walked the short sequence of
    Kevin> values (since the data frame was already sorted)
    Kevin> calculating what it needed, would work much faster
    Kevin> than splitting the original vector into so very many
    Kevin> smaller vectors (and the associated copying of data).

    Kevin> That problem is very similar problem to the
    Kevin> calculation of basic stats on a short moving window
    Kevin> over a very long vector.

    >> The author of that message ultimately wrote the caTools R
    >> package which contains some optimized versions.

    Kevin> I will look into that package and maybe use it for a
    Kevin> model for what I want to do.

    Kevin> Thanks,

    Kevin> Kevin

    Kevin> ______________________________________________
    Kevin> R-devel at r-project.org mailing list
    Kevin> https://stat.ethz.ch/mailman/listinfo/r-devel


From bill at insightful.com  Fri Jul 28 22:51:32 2006
From: bill at insightful.com (Bill Dunlap)
Date: Fri, 28 Jul 2006 13:51:32 -0700 (PDT)
Subject: [Rd] Any interest in "merge" and "by" implementations
 specifically for sorted data?
In-Reply-To: <D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
Message-ID: <Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>

On Fri, 28 Jul 2006, Kevin B. Hendricks wrote:

>
> In my particular case, the problem was my data frame had over 1
> million lines had probably over 500,000 unique sort keys (ie. think
> of it as an R factor with over 500,000 levels).  The implementation
> of "by" uses "tapply" which in turn uses "split".  So "split" simply
> ate up all the time trying to create 500,000 vectors each of short
> length 1, 2, or 3; and the associated garbage collection.
>
> I simple loop that walked the short sequence of values (since the
> data frame was already sorted) calculating what it needed, would work
> much faster than splitting the original vector into so very many
> smaller vectors (and the associated copying of data).
>
> That problem is very similar problem to the calculation of basic
> stats on a short moving window over a very long vector.
>
> I will look into that package and maybe use it for a model for what I
> want to do.

Splus8.0 has something like what you are talking about
that provides a fast way to compute
    sapply(split(xVector, integerGroupCode), summaryFunction)
for some common summary functions.  The 'integerGroupCode'
is typically the codes from a factor, but you could compute
it in other ways.  It needs to be a "small" integer in
the range 1:ngroups (like the 'bin' argument to tabulate).
Like tabulate(), which is called from table(), these are
meant to be called from other functions that can set up
appropriate group codes.  E.g., groupSums or rowSums or
fancier things could be based on this.

They do not insist you sort the input in any way.  That
would really only be useful for group medians and we haven't
written that one yet.

The typical prototype is

> igroupSums
function(x, group = NULL, na.rm = F, weights = NULL, ngroups = if(is.null(
        group)) 1 else max(as.integer(group), na.rm = T))

and the currently supported summary functions are
   mean : igroupMeans
   sum : igroupSums
   prod : igroupProds
   min : igroupMins
   max : igroupMaxs
   range : igroupRanges
   any : igroupAnys
   all : igroupAlls
(The plurals are not all properly spelled and they
are plural so match related functions like rowSums.)
It might be useful to also have one to count the number
of non-missing values in each group of x's.

They are fast:

   > x<-runif(2e6)
   > i<-rep(1:1e6, 2)
   > sys.time(sx <- igroupSums(x,i))
   [1] 0.66 0.67
   > length(sx)
   [1] 1000000

On that machine R takes 44 seconds to go the lapply/split
route:

   > unix.time(unlist(lapply(split(x,i), sum)))
   [1] 43.24  0.78 44.11  0.00  0.00

To save setup time in the S code, out-of-range values
in the group argument (negatives, values greater than
ngroup, and NA's), mean that the correponding element
in x is ignored.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From kevin.hendricks at sympatico.ca  Sat Jul 29 01:56:57 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Fri, 28 Jul 2006 19:56:57 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
Message-ID: <5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>

Hi Bill,

> Splus8.0 has something like what you are talking about
> that provides a fast way to compute
>     sapply(split(xVector, integerGroupCode), summaryFunction)
> for some common summary functions.  The 'integerGroupCode'
> is typically the codes from a factor, but you could compute
> it in other ways.  It needs to be a "small" integer in
> the range 1:ngroups (like the 'bin' argument to tabulate).
> Like tabulate(), which is called from table(), these are
> meant to be called from other functions that can set up
> appropriate group codes.  E.g., groupSums or rowSums or
> fancier things could be based on this.
>
> They do not insist you sort the input in any way.  That
> would really only be useful for group medians and we haven't
> written that one yet.

The sort is also useful for recoding each group into subgroups based  
on some other numeric vector.  This is the problem I run into trying  
to build portfolios that can be used as benchmarks for long term  
stock returns.

Another issue I have is that to recode a long character string that I  
use as a sort key for accessing a subgroup of the data in the  
data.frame to a set of small integers is not fast.  I can make a fast  
implementation if the data is sorted by the key, but without the  
sort, just converting my sort keys to the required small integer  
codes would be expensive for very long vectors since my small integer  
codes would have to reflect the order of the data (ie. be increasing  
subportfolio numbers).

More specifically, I am now converting all of my SAS code to R code  
and the problem is I have lots of snippets of SAS that do the  
following ...

PROC SORT;
   BY MDSIZ FSIZ;

/* WRITE OUT THE MIN SIZE CUTOFF VALUES */
PROC UNIVARIATE NOPRINT;
    VAR FSIZ;
    BY MDSIZ;
    OUTPUT OUT=TMPS1 MIN=XMIN;

where my sort key MDSIZ is a character string that is the  
concatenation of the month ending date MD and the size portfolio of a  
particular firm (SIZ) and I want to find the cutoff points (the mins)  
for each of the portfolios for every month end date across all traded  
firms.


>
> The typical prototype is
>
>> igroupSums
> function(x, group = NULL, na.rm = F, weights = NULL, ngroups = if 
> (is.null(
>         group)) 1 else max(as.integer(group), na.rm = T))
>
> and the currently supported summary functions are
>    mean : igroupMeans
>    sum : igroupSums
>    prod : igroupProds
>    min : igroupMins
>    max : igroupMaxs
>    range : igroupRanges
>    any : igroupAnys
>    all : igroupAlls

SAS is similar in that is also has a specific list of functions you  
can request including all of the basic stats from a PROC univariate  
including higher moment stuff (skewness, kurtosis,  robust  
statistics, and even statistical test results for each coded  
subgroup, and the nice thing is all combinations can be done with one  
call.

But to do that SAS does require the presorting, but it does run  
really fast for even super long vectors with lots of sort keys.

Similarly the next snippet of code, will take the file and resort it  
by the portfolio key and then the market to book ratio (MTB) for all  
trading firms for all monthly periods since 1980.    It will then  
split each size portfolio for each month ending date into 5 equal  
portfolios based on market to book ratios (thus the need for the  
sort).   SAS returns a coded integer vector PMTB (made up of 1s to 5  
with 1s's for the smallest MTB and 5 for the largest MTB) repeated  
for each subgroup of MDSIZ.  PMTB matches the original vector in  
length and therefore fits right into the data frame.

/* SPLIT INTO Market to Book QUINTILES BY MDSIZ */
PROC SORT;
   BY MDSIZ MTB;
PROC RANK GROUPS=5 OUT=TMPS0;
    VAR MTB;
    RANKS PMTB;
    BY MDSIZ;

The problem of assigning elements of a long data vector to portfolios  
and sub portfolios based on the values of specific data columns which  
must be calculated at each step and are not fixed or hardcoded is one  
that finance can run into (and therefore I run into it).

So by sorting I could handle the need for "small integer" recoding  
and the small integers would have meaning (i.e. higher values will  
represent larger MTB firms, etc).

That just leaves the problem of calculating stats on short sequences  
of of a longer integer.

> They are fast:
>
>> x<-runif(2e6)
>> i<-rep(1:1e6, 2)
>> sys.time(sx <- igroupSums(x,i))
>    [1] 0.66 0.67
>> length(sx)
>    [1] 1000000
>
> On that machine R takes 44 seconds to go the lapply/split
> route:
>
>> unix.time(unlist(lapply(split(x,i), sum)))
>    [1] 43.24  0.78 44.11  0.00  0.00


Yes!  That is exactly what I need.

Are there plans for adding something like that to R?

Thanks,

Kevin


From bill at insightful.com  Sat Jul 29 02:31:44 2006
From: bill at insightful.com (Bill Dunlap)
Date: Fri, 28 Jul 2006 17:31:44 -0700 (PDT)
Subject: [Rd] Any interest in "merge" and "by" implementations
 specifically for sorted data?
In-Reply-To: <5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
	<5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
Message-ID: <Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>

On Fri, 28 Jul 2006, Kevin B. Hendricks wrote:

> Hi Bill,
>
> > Splus8.0 has something like what you are talking about
> > that provides a fast way to compute
> >     sapply(split(xVector, integerGroupCode), summaryFunction)
> > for some common summary functions.  The 'integerGroupCode'
> > is typically the codes from a factor, but you could compute
> > it in other ways.  It needs to be a "small" integer in
> > the range 1:ngroups (like the 'bin' argument to tabulate).
> > Like tabulate(), which is called from table(), these are
> > meant to be called from other functions that can set up
> > appropriate group codes.  E.g., groupSums or rowSums or
> > fancier things could be based on this.
> >
> > They do not insist you sort the input in any way.  That
> > would really only be useful for group medians and we haven't
> > written that one yet.
>
> The sort is also useful for recoding each group into subgroups based
> on some other numeric vector.  This is the problem I run into trying
> to build portfolios that can be used as benchmarks for long term
> stock returns.
>
> Another issue I have is that to recode a long character string that I
> use as a sort key for accessing a subgroup of the data in the
> data.frame to a set of small integers is not fast.  I can make a fast
> implementation if the data is sorted by the key, but without the
> sort, just converting my sort keys to the required small integer
> codes would be expensive for very long vectors since my small integer
> codes would have to reflect the order of the data (ie. be increasing
> subportfolio numbers).

True, but the underlying grouped summary code
shouldn't require you to do the sorting.  If
    codes <- match(char, sort(unique(char)))
is too slow then you could try sorting the
data set by th 'char' column and doing
    codes <- cumsum(char[-1] != char[-length(char)])
(loop over columns before doing cumsum if there
are several columns).

If that isn't fast enough, then you could sort
in the C code as well, but I think there could
be lots of cases where that is slower.

I've used this code for out of core applications,
where I definitely do not want to sort the whole
dataset.

> More specifically, I am now converting all of my SAS code to R code
> and the problem is I have lots of snippets of SAS that do the
> following ...
>
> PROC SORT;
>    BY MDSIZ FSIZ;
>
> /* WRITE OUT THE MIN SIZE CUTOFF VALUES */
> PROC UNIVARIATE NOPRINT;
>     VAR FSIZ;
>     BY MDSIZ;
>     OUTPUT OUT=TMPS1 MIN=XMIN;
>
> where my sort key MDSIZ is a character string that is the
> concatenation of the month ending date MD and the size portfolio of a
> particular firm (SIZ) and I want to find the cutoff points (the mins)
> for each of the portfolios for every month end date across all traded
> firms.
>
>
> >
> > The typical prototype is
> >
> >> igroupSums
> > function(x, group = NULL, na.rm = F, weights = NULL, ngroups = if
> > (is.null(
> >         group)) 1 else max(as.integer(group), na.rm = T))
> >
> > and the currently supported summary functions are
> >    mean : igroupMeans
> >    sum : igroupSums
> >    prod : igroupProds
> >    min : igroupMins
> >    max : igroupMaxs
> >    range : igroupRanges
> >    any : igroupAnys
> >    all : igroupAlls
>
> SAS is similar in that is also has a specific list of functions you
> can request including all of the basic stats from a PROC univariate
> including higher moment stuff (skewness, kurtosis,  robust
> statistics, and even statistical test results for each coded
> subgroup, and the nice thing is all combinations can be done with one
> call.
>
> But to do that SAS does require the presorting, but it does run
> really fast for even super long vectors with lots of sort keys.
>
> Similarly the next snippet of code, will take the file and resort it
> by the portfolio key and then the market to book ratio (MTB) for all
> trading firms for all monthly periods since 1980.    It will then
> split each size portfolio for each month ending date into 5 equal
> portfolios based on market to book ratios (thus the need for the
> sort).   SAS returns a coded integer vector PMTB (made up of 1s to 5
> with 1s's for the smallest MTB and 5 for the largest MTB) repeated
> for each subgroup of MDSIZ.  PMTB matches the original vector in
> length and therefore fits right into the data frame.
>
> /* SPLIT INTO Market to Book QUINTILES BY MDSIZ */
> PROC SORT;
>    BY MDSIZ MTB;
> PROC RANK GROUPS=5 OUT=TMPS0;
>     VAR MTB;
>     RANKS PMTB;
>     BY MDSIZ;
>
> The problem of assigning elements of a long data vector to portfolios
> and sub portfolios based on the values of specific data columns which
> must be calculated at each step and are not fixed or hardcoded is one
> that finance can run into (and therefore I run into it).
>
> So by sorting I could handle the need for "small integer" recoding
> and the small integers would have meaning (i.e. higher values will
> represent larger MTB firms, etc).
>
> That just leaves the problem of calculating stats on short sequences
> of of a longer integer.
>
> > They are fast:
> >
> >> x<-runif(2e6)
> >> i<-rep(1:1e6, 2)
> >> sys.time(sx <- igroupSums(x,i))
> >    [1] 0.66 0.67
> >> length(sx)
> >    [1] 1000000
> >
> > On that machine R takes 44 seconds to go the lapply/split
> > route:
> >
> >> unix.time(unlist(lapply(split(x,i), sum)))
> >    [1] 43.24  0.78 44.11  0.00  0.00
>
>
> Yes!  That is exactly what I need.
>
> Are there plans for adding something like that to R?
>
> Thanks,
>
> Kevin
>
>

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From edd at debian.org  Sat Jul 29 04:03:24 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 28 Jul 2006 21:03:24 -0500
Subject: [Rd] Package digest broken under R v2.4.0 devel
In-Reply-To: <59d7961d0607280852x386bac20tda7ca2d829da179@mail.gmail.com>
References: <59d7961d0607272330m5bb3613bvdef3fb70104cb6b9@mail.gmail.com>
	<59d7961d0607280852x386bac20tda7ca2d829da179@mail.gmail.com>
Message-ID: <17610.49644.470922.740994@basebud.nulle.part>


On 28 July 2006 at 08:52, Henrik Bengtsson wrote:
| Found the reason for the bug.  Patch available online;
| 
|   source("http://www.braju.com/R/patches/digest.R")

Splendid -- thank you for both the bug report, and the patch.  The new
revision digest_0.2.2 includes this patch. I also added unit tests in
directory tests/. The new version is now in CRAN's incoming/ directory.

Thanks, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From yc632 at columbia.edu  Sat Jul 29 06:21:36 2006
From: yc632 at columbia.edu (Ken Cheung)
Date: Sat, 29 Jul 2006 00:21:36 -0400 (EDT)
Subject: [Rd] compiling packages for windows
Message-ID: <Pine.GSO.4.63.0607290008480.8995@mango.cc.columbia.edu>

hi,

i've put together some R codes and created a source package.  i 
successfully installed the package in unix using `R CMD INSTALL'

i'd like also to install the source package on my PC, and would appreciate 
any pointer to how to go about it or reading material.  i think it somehow 
involves compiling the package into binary form, but am not sure how to do 
it.  i've tried reading "R Installation and Administration" on "Add-on 
packages" but couldn't figure out.

[i think i wont need as many tools since the codes don't involve C or C++]

thanks,
ken


From kevin.hendricks at sympatico.ca  Sat Jul 29 06:32:21 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Sat, 29 Jul 2006 00:32:21 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
	<5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
	<Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>
Message-ID: <AAC5E1FB-71BB-46C8-9D51-A72DD25C735E@sympatico.ca>

Hi Bill,

>>>    sum : igroupSums

Okay, after thinking about this ...

# assumes i is the small integer factor with n levels
# v is some long vector
# no sorting required

igroupSums <- function(v,i) {
   sums <- rep(0,max(i))
   for (j in 1:length(v)) {
       sums[[i[[j]]]] <- sums[[i[[j]]]] + v[[j]]
   }
   sums
}

if written in fortran or c might be faster than using split.  It is  
at least just linear in time with the length of vector v.  This  
approach could be easily made parallel to t threads simply by picking  
t starting points someplace along v and running this routine in  
parallel on each piece.  You could even do it without thread locking  
if "sums" elements can be accessed atomically or by creating multiple  
copies of "sums" (one for each piece) and then doing a final addition.

I still think I am missing some obvious way to do this but ...

Am I thinking along the right lines?

Kevin


From ggrothendieck at gmail.com  Sat Jul 29 06:42:54 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 29 Jul 2006 00:42:54 -0400
Subject: [Rd] compiling packages for windows
In-Reply-To: <Pine.GSO.4.63.0607290008480.8995@mango.cc.columbia.edu>
References: <Pine.GSO.4.63.0607290008480.8995@mango.cc.columbia.edu>
Message-ID: <971536df0607282142s2e2dbab1m1c3b01c80adf5b42@mail.gmail.com>

1. Check out:
       http://tolstoy.newcastle.edu.au/R/help/05/07/9167.html
    and the references there.

2. Also google for:
       making creating R package tutorial

On 7/29/06, Ken Cheung <yc632 at columbia.edu> wrote:
> hi,
>
> i've put together some R codes and created a source package.  i
> successfully installed the package in unix using `R CMD INSTALL'
>
> i'd like also to install the source package on my PC, and would appreciate
> any pointer to how to go about it or reading material.  i think it somehow
> involves compiling the package into binary form, but am not sure how to do
> it.  i've tried reading "R Installation and Administration" on "Add-on
> packages" but couldn't figure out.
>
> [i think i wont need as many tools since the codes don't involve C or C++]
>
> thanks,
> ken
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From cooch17 at verizon.net  Sat Jul 29 16:06:03 2006
From: cooch17 at verizon.net (Evan Cooch)
Date: Sat, 29 Jul 2006 10:06:03 -0400
Subject: [Rd] R | vnc | X11 fonts
Message-ID: <44CB6B4B.1070500@verizon.net>

Greetings -

Users of the box I'm putting together will need to be able to run R 
remotely, using a virtual desktop. One approach (that I'm trying) is to 
use VNC. So far, I can get the remote gnome desktop up on the server 
(running Fedora Core 5), and can start R from a terminal. However, for a 
lot of the R scripts I've tried, I get 'font errors' - the general error 
message is

Error in X11()  : could not find any X11 fonts
Check that the Font Path is correct


OK, bring up another terminal window on VNC, and try xset q, which shows

Font Path

/usr/share/fonts/default/Type1/, /usr/share/X11/fonts/75dpi/, 
/usr/share/X11/fonts/100dpi/, ...

and so on, and so on - about 10 different font directories in all.

So, given that xset q shows that I have lots of X11 fonts in the Font 
Path, then why does X11() in R tell me I don't have any?


From p.dalgaard at biostat.ku.dk  Sat Jul 29 17:35:15 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 29 Jul 2006 17:35:15 +0200
Subject: [Rd] R | vnc | X11 fonts
In-Reply-To: <44CB6B4B.1070500@verizon.net>
References: <44CB6B4B.1070500@verizon.net>
Message-ID: <x2k65wmnkc.fsf@turmalin.kubism.ku.dk>

Evan Cooch <cooch17 at verizon.net> writes:

> Greetings -
> 
> Users of the box I'm putting together will need to be able to run R 
> remotely, using a virtual desktop. One approach (that I'm trying) is to 
> use VNC. So far, I can get the remote gnome desktop up on the server 
> (running Fedora Core 5), and can start R from a terminal. However, for a 
> lot of the R scripts I've tried, I get 'font errors' - the general error 
> message is
> 
> Error in X11()  : could not find any X11 fonts
> Check that the Font Path is correct
> 
> 
> OK, bring up another terminal window on VNC, and try xset q, which shows
> 
> Font Path
> 
> /usr/share/fonts/default/Type1/, /usr/share/X11/fonts/75dpi/, 
> /usr/share/X11/fonts/100dpi/, ...
> 
> and so on, and so on - about 10 different font directories in all.
> 
> So, given that xset q shows that I have lots of X11 fonts in the Font 
> Path, then why does X11() in R tell me I don't have any?

I don't think xset q is the right diagnostic tool. I suspect that it
just reflects a default setting of vnc. Those directories could be
empty for all that it knows. xfontsel might be more to the point if
you need to know whether the fonts are actually available.

However, I can't reproduce similar behaviour on FC5 with the
straightforward vncserver/vncviewer/twm default setup (i.e., it runs
demo(graphics)).  So I suspect you need to dig deeper or tell us more
details about what goes wrong, e.g. how exactly are you running your R
scripts, will they work from the console, etc.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From cooch17 at verizon.net  Sat Jul 29 18:05:50 2006
From: cooch17 at verizon.net (Evan Cooch)
Date: Sat, 29 Jul 2006 12:05:50 -0400
Subject: [Rd] R | vnc | X11 fonts
In-Reply-To: <x2k65wmnkc.fsf@turmalin.kubism.ku.dk>
References: <44CB6B4B.1070500@verizon.net>
	<x2k65wmnkc.fsf@turmalin.kubism.ku.dk>
Message-ID: <44CB875E.2000809@verizon.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060729/3ccb55cf/attachment.pl 

From cooch17 at verizon.net  Sat Jul 29 18:10:35 2006
From: cooch17 at verizon.net (Evan Cooch)
Date: Sat, 29 Jul 2006 12:10:35 -0400
Subject: [Rd] R | vnc | X11 fonts
In-Reply-To: <x2k65wmnkc.fsf@turmalin.kubism.ku.dk>
References: <44CB6B4B.1070500@verizon.net>
	<x2k65wmnkc.fsf@turmalin.kubism.ku.dk>
Message-ID: <44CB887B.9090605@verizon.net>

Quick followup - works fine with fluxbox (and, as noted, default twm). 
Simply can't get it to work with the gnome desktop, which ultimately I 
would like to.


From kevin.hendricks at sympatico.ca  Sat Jul 29 22:05:09 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Sat, 29 Jul 2006 16:05:09 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <Pine.GSO.4.56.0607290823440.28891@durian.statsci.com>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
	<5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
	<Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>
	<AAC5E1FB-71BB-46C8-9D51-A72DD25C735E@sympatico.ca>
	<Pine.GSO.4.56.0607290823440.28891@durian.statsci.com>
Message-ID: <207048BB-90DD-43DA-8FBC-D73544E6E3A8@sympatico.ca>

Hi Bill,

So you wrote one routine that can calculate any single of a variety  
of stats and allows weights, is that right?  Can it return a data  
frame of any subset of requested stats as well (that is what I was  
thinking of doing anyway).

I think someone can easily calculate all of those things in one pass  
through the array and then allow the user to select which of the new  
columns of stats should be added to a data.frame that is returned to  
the user.

To test all of this, I simply wrote my own igroupSums and integrated  
it into r-devel based on the code in split.c.  I can easily modify it  
to handle the case of calculating  a variety of stats (even all at  
the same time if desired).  I do not deal with "weights" at all and  
ignored that for now.

Here is what your test case now shows on my machine with the latest R  
build
with my added igroupSums routine (added internally to R).

 > x <- rnorm(2e6)
 > i <- rep(1:1e6,2)
 > unix.time(Asums <- unlist(lapply(split(x,i),sum)))
[1] 8.940 0.112 9.053 0.000 0.000
 > names(Asums) <- NULL

My version of igroupSums does not keep the names so I remove them to  
make the results comparable.

Here is my my own internal function igroupSums

 > unix.time(Bsums <- igroupSums(x,i))
[1] 0.932 0.024 0.958 0.000 0.000
 >
 > all.equal(Asums, Bsums)
[1] TRUE


So the speed up is quite significant (9.053 seconds vs 0.858 seconds).

I will next modify my code to handle any single one of maxs, mins,  
sums, counts, anys, alls, means, prods, and ranges by user choice.   
Although I will leave the use of weights as unimplemented for now (I  
always get mixed up thinking about weights and basic stats and I  
never use them so ...)

In case others want to play around with this too, here is the R  
wrapper in igroupSums.R to put in src/library/base/R/


igroupSums <- function(x, f, drop = FALSE, ...) UseMethod("igroupSums")

igroupSums.default <- function(x, f, drop=FALSE, ...)
{
     if(length(list(...))) .NotYetUsed(deparse(...), error = FALSE)

     if (is.list(f)) f <- interaction(f, drop = drop)
     else if (drop || !is.factor(f)) # drop extraneous levels
         f <- factor(f)
     storage.mode(f) <- "integer"  # some factors have double
     if (is.null(attr(x, "class")))
         return(.Internal(igroupSums(x, f)))
     ## else
     r <- by(x,f,sum)
     r
}

igroupSums.data.frame <- function(x, f, drop = FALSE, ...)
     lapply(split(seq(length=nrow(x)), f, drop = drop, ...),
            function(ind) x[ind, , drop = FALSE])


And here is a very simple igroupSums.c to put in src/main/

It still needs a lot of work since it does not handle NAs in the  
vector x yet and still needs to be modified into a general routine to  
handle any single function of counts, sums, maxs, mins, means, prods,  
anys, alls, and ranges


#ifdef HAVE_CONFIG_H
#include <config.h>
#endif

#include "Defn.h"

SEXP attribute_hidden do_igroupSums(SEXP call, SEXP op, SEXP args,  
SEXP env)
{
     SEXP x, f, sums;
     int i, j, nobs, nlevs, nfac;

     checkArity(op, args);

     x = CAR(args);
     f = CADR(args);
     if (!isVector(x))
         errorcall(call, _("first argument must be a vector"));
     if (!isFactor(f))
         errorcall(call, _("second argument must be a factor"));
     nlevs = nlevels(f);
     nfac = LENGTH(CADR(args));
     nobs = LENGTH(CAR(args));
     if (nobs <= 0)
         return R_NilValue;
     if (nfac <= 0)
         errorcall(call, _("Group length is 0 but data length > 0"));
     if (nobs % nfac != 0)
         warningcall(call, _("data length is not a multiple of split  
variable"));

     PROTECT(sums = allocVector(TYPEOF(x), nlevs));
     switch (TYPEOF(x)) {
     case INTSXP:
         for (i=0; i < nlevs; i++) INTEGER(sums)[i] = 0;
         break;
     case REALSXP:
         for (i=0; i < nlevs; i++) REAL(sums)[i] = 0.0;
         break;
     default:
         UNIMPLEMENTED_TYPE("igroupSums", x);
     }
     for (i = 0;  i < nobs; i++) {
         j = INTEGER(f)[i % nfac];
         if (j != NA_INTEGER) {
             j--;
             switch (TYPEOF(x)) {
             case INTSXP:
                 INTEGER(sums)[j] = INTEGER(sums)[j] + INTEGER(x)[i];
                 break;
             case REALSXP:
                 REAL(sums)[j] = REAL(sums)[j] + REAL(x)[i];
                 break;
             default:
                 UNIMPLEMENTED_TYPE("igroupSums", x);
             }
         }
     }
     UNPROTECT(1);
     return sums;
}


If anyone is playing with this themselves, don't forget to update  
Internal.h and names.c to reflect the added routine before you make  
clean and then rebuild.

Once I finish, I will post me patches here and then if someone would  
like to modify them to implement "weights", please let me know.

Even if these never get added to R I can keep them in my own tree and  
use them for my own work.

Thanks again for all of your hints and guidance.  This alone will  
speed up my R code greatly!

Kevin

> That is roughly what I did in C code for the Splus version.
> E.g., here is the integer x case for sums and means.  It accumlates
> the weighted group sum and the group weight so that if we
> are doing the mean it has the right divisor.  It would
> go a bit faster if I didn't bother with the group weight
> in the sum case.
>
> (I was mostly interested in seeing if this function's interface
> was sufficiently general for your uses.  Computing the integer
> group codes can sometimes be a pain and there are cases where you
> might want to combine that with computing the grouped summaries.
> I am guessing that in most cases you want those two functions
> to be separate.)
>
> case S_SUM: /*FALLTHROUGH*/
> case S_MEAN:
>     for(i=0;i<length;i++) {
>         bin = binp ? *binp++ - 1 : 0 ; /* bin is now 0-based */
>         weight = weighted ? *weightp++ : 1.0 ;
>         x = *xp++ ;
>         if (is_na_INT(&bin) || bin<0 || bin>=maxbin || weight==0.0)
>             continue ;
>         if (is_na_DOUBLE(&groupWeightp[bin]))
>             continue ;
>         if (is_na_DOUBLE(&x) || is_na_DOUBLE(&weight)) {
>             if (!na_rm) {
>                 na_set3(&valuep[bin], value->mode, To_NA);
>                 na_set3(&groupWeightp[bin], groupWeight->mode, To_NA);
>             }
>             continue ;
>         }
>         if (!is_na_DOUBLE(&valuep[bin])) {
>             valuep[bin] += x * weight ;
>             groupWeightp[bin] += weight ; /* groupWeightp and  
> valuep should both have same NA-ness */
>         }
>     }
>     if (which==S_MEAN) {
>         for(ibin=0;ibin<maxbin;ibin++) {
>             if (is_na_DOUBLE(&valuep[ibin])) {
>                 /* leave valuep[ibin] as NA */
>             } else if (groupWeightp[ibin]==0.0) {
>                 /* valuep[ibin] must be 0.0 if groupWeightp[ibin]  
> is */
>                 na_set3(&valuep[ibin], value->mode, To_NaN) ;
>             } else {
>                 valuep[ibin] = valuep[ibin] / groupWeightp[ibin] ;
>             }
>         }
>     }
>     break;


From sfalcon at fhcrc.org  Sun Jul 30 05:23:15 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sat, 29 Jul 2006 20:23:15 -0700
Subject: [Rd] download.file crashes on OSX
Message-ID: <m24pwzg4ik.fsf@ziti.fhcrc.org>

Hi,

I'm seeing a 'memory not mapped' crash on OSX (10.4.7) with R-devel
(r38715) when calling download.file() with a URL that doesn't exist.

Here is what reproduces it for me:

    u404 <- "http://bioconductor.org/packages/doesnotexist.aaaa.3"
    f <- "output.u404.txt"
    download.file(u404, f)
    
    trying URL 'http://bioconductor.org/packages/doesnotexist.aaaa.3'
    
     *** caught segfault ***
    address 0x522e6d6c, cause 'memory not mapped'


And here is a patch that resolves this for me.  I'm pretty sure the
context should be closed after the query is made as to its status, but
maybe I'm missing something...

+ seth



Index: src/modules/internet/internet.c
===================================================================
--- src/modules/internet/internet.c     (revision 38715)
+++ src/modules/internet/internet.c     (working copy)
@@ -489,10 +489,10 @@
        int rc = RxmlNanoHTTPReturnCode(ctxt);
        if(rc != 200) {
            char *msg;
-           RxmlNanoHTTPClose(ctxt);
            /* bug work-around: it will crash on OS X if passed directly */
            msg = _("cannot open: HTTP status was '%d %s'");
            warning(msg, rc, RxmlNanoHTTPStatusMsg(ctxt));
+           RxmlNanoHTTPClose(ctxt);
            return NULL;
        } else {
            type = RxmlNanoHTTPContentType(ctxt);


From tshort at eprisolutions.com  Sun Jul 30 14:02:19 2006
From: tshort at eprisolutions.com (tshort)
Date: Sun, 30 Jul 2006 05:02:19 -0700 (PDT)
Subject: [Rd] Any interest in "merge" and "by" implementations
 specifically for so
In-Reply-To: <207048BB-90DD-43DA-8FBC-D73544E6E3A8@sympatico.ca>
References: <07820D54-9DDC-42F7-8F32-C931B2B80DE6@sympatico.ca>
	<Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
	<5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
	<Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>
	<AAC5E1FB-71BB-46C8-9D51-A72DD25C735E@sympatico.ca>
	<207048BB-90DD-43DA-8FBC-D73544E6E3A8@sympatico.ca>
Message-ID: <5562816.post@talk.nabble.com>


Kevin, starting with your idea of sorting first, you can get some speedups
just using R. Start by comparing the base case that Bill used:

> x <- runif(2e6)
> i <- rep(1:1e6, 2)
> unix.time(res0 <- unlist(lapply(split(x,i), sum))) 
[1] 11.00  0.16 11.28    NA    NA

Now, try sorting and using a loop:

> idx <- order(i)
> xs <- x[idx]
> is <- i[idx]
> res <- array(NA, 1e6)
> idx <- which(diff(is) > 0)
> startidx <- c(1, idx+1)
> endidx <- c(idx, length(xs))
> f1 <- function(x, startidx, endidx, FUN = sum)  {
+   for (j in 1:length(res)) {
+     res[j] <- FUN(x[startidx[j]:endidx[j]])
+   }
+   res
+ }
> unix.time(res1 <- f1(xs, startidx, endidx))
[1] 6.86 0.00 7.04   NA   NA

For the case of sum (or averages), you can vectorize this using cumsum as
follows. This won't work for median or max.

> f2 <- function(x, startidx, endidx)  {
+   cum <- cumsum(x)
+   res <- cum[endidx]
+   res[2:length(res)] <- res[2:length(res)] - cum[endidx[1:(length(res) -
1)]]
+   res
+ }
> unix.time(res2 <- f2(xs, startidx, endidx))
[1] 0.20 0.00 0.21   NA   NA

You can also use Luke Tierney's byte compiler
(http://www.stat.uiowa.edu/~luke/R/compiler/) to speed up the loop for
functions where you can't vectorize:

> library(compiler)
> f3 <- cmpfun(f1)
Note: local functions used: FUN 
> unix.time(res3 <- f3(xs, startidx, endidx))
[1] 3.84 0.00 3.91   NA   NA

- Tom

-- 
View this message in context: http://www.nabble.com/Any-interest-in-%22merge%22-and-%22by%22-implementations-specifically-for-sorted-data--tf2009595.html#a5562816
Sent from the R devel forum at Nabble.com.


From kevin.hendricks at sympatico.ca  Sun Jul 30 16:11:21 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Sun, 30 Jul 2006 10:11:21 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <Pine.GSO.4.56.0607290823440.28891@durian.statsci.com>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
	<5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
	<Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>
	<AAC5E1FB-71BB-46C8-9D51-A72DD25C735E@sympatico.ca>
	<Pine.GSO.4.56.0607290823440.28891@durian.statsci.com>
Message-ID: <24DC7CE0-963A-473E-B186-6E1B44E34724@sympatico.ca>

Hi Bill,

After playing with this some more and adding an implementation to  
handle NAs in the data vector, I have run into the problem of what to  
return when the only data values for a particular bin (or level) in  
the data vector were NAs and the user selected na.rm=T

1. Should it return 0 for counts of that particular bin and NA for  
that bin for all of the other functions?  If so, wouldn't that be  
strange to return a NA just since there is no valid data for that bin  
because the user asked for na.rm=T?

2.  Or do I have to literally rebuild the final result vector,  
removing all "unused" bins before returning the results?   And  
wouldn't that cause problems in not all of the levels from 1:ngroups  
will be returned for some variables and not for others.

I personally like the approach of 1. better since if I give an igroup  
function my groups and tell it to na.rm=T from my data vector, I  
would really want all group levels returned and not just the ones  
that had valid data in them and if a particular group had no data, I  
would want the count to be 0 for that bin and all of the other funs  
to return NA for that particular bin?

Is that what you are returning in that case?

Also, do you always return Sums, Maxs, and Mins as "numeric" or do  
you sometimes return "integer" values if an "integer" data vector is  
passed in?

Are "Counts" always returned as "integer" or do you always set them  
to "numeric" or does that vary with the type of the data vector  
passed in?

Do you handle "complex" data vectors in a similar fashion (ie. using  
the length of the complex vector as its value for Maxs, Mins, etc?)?

Thanks,

Kevin


From sfalcon at fhcrc.org  Sun Jul 30 16:39:04 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sun, 30 Jul 2006 07:39:04 -0700
Subject: [Rd] [R] HTTP User-Agent header
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>
	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>
	<m2u051k7c7.fsf@ziti.fhcrc.org>
	<88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>
	<44CA61A0.7090804@fhcrc.org>
	<59d7961d0607281240j612ed4b5h2e67ae8fe838b52d@mail.gmail.com>
	<44CA6AFB.4040207@fhcrc.org>
Message-ID: <m2bqr7dunr.fsf@ziti.fhcrc.org>

Robert Gentleman <rgentlem at fhcrc.org> writes:
> OK, that suggests setting at the options level would solve both of your 
> problems and that seems like the best approach. I don't really want to 
> pass this around as a parameter through the maze of functions that might 
> actually download something if we don't have to.

I have an updated patch that adds an HTTPUserAgent option.  The
default is a string like:

    R (2.4.0 x86_64-unknown-linux-gnu x86_64 linux-gnu)

If the HTTPUserAgent option is NULL, no user agent header is added to
HTTP requests (this is the current behavior).  This option allows R to
use an arbitrary user agent header.

The patch adds two non-exported functions to utils: 
   1) defaultUserAgent - returns a string like above
   2) makeUserAgent - formats content of HTTPUserAgent option for use
      as part of an HTTP request header.

I've tested on OSX and Linux, but not on Windows.  When USE_WININET is
defined, a user agent string of "R" was already being used.  With this
patch, the HTTPUserAgent options is used.  I'm unsure if NULL is
allowed.

Also, in src/main/internet.c there is a comment:
  "Next 6 are for use by libxml, only"
and then a definition for R_HTTPOpen.  Not sure how/when these get
used.  The user agent for these calls remains unspecified with this
patch.

+ seth


Patch summary:
 src/include/R_ext/R-ftp-http.h   |    2 +-
 src/include/Rmodules/Rinternet.h |    2 +-
 src/library/base/man/options.Rd  |    5 +++++
 src/library/utils/R/readhttp.R   |   25 +++++++++++++++++++++++++
 src/library/utils/R/zzz.R        |    3 ++-
 src/main/internet.c              |    2 +-
 src/modules/internet/internet.c  |   37 +++++++++++++++++++++++++------------
 src/modules/internet/nanohttp.c  |    8 ++++++--
 8 files changed, 66 insertions(+), 18 deletions(-)



Index: src/include/R_ext/R-ftp-http.h
===================================================================
--- src/include/R_ext/R-ftp-http.h	(revision 38715)
+++ src/include/R_ext/R-ftp-http.h	(working copy)
@@ -36,7 +36,7 @@
 int   R_FTPRead(void *ctx, char *dest, int len);
 void  R_FTPClose(void *ctx);
 
-void *	RxmlNanoHTTPOpen(const char *URL, char **contentType, int cacheOK);
+void *	RxmlNanoHTTPOpen(const char *URL, char **contentType, const char *headers, int cacheOK);
 int	RxmlNanoHTTPRead(void *ctx, void *dest, int len);
 void	RxmlNanoHTTPClose(void *ctx);
 int 	RxmlNanoHTTPReturnCode(void *ctx);
Index: src/include/Rmodules/Rinternet.h
===================================================================
--- src/include/Rmodules/Rinternet.h	(revision 38715)
+++ src/include/Rmodules/Rinternet.h	(working copy)
@@ -9,7 +9,7 @@
 typedef Rconnection (*R_NewUrlRoutine)(char *description, char *mode);
 typedef Rconnection (*R_NewSockRoutine)(char *host, int port, int server, char *mode); 
 
-typedef void * (*R_HTTPOpenRoutine)(const char *url, const int cacheOK);
+typedef void * (*R_HTTPOpenRoutine)(const char *url, const char *headers, const int cacheOK);
 typedef int    (*R_HTTPReadRoutine)(void *ctx, char *dest, int len);
 typedef void   (*R_HTTPCloseRoutine)(void *ctx);
 	      
Index: src/main/internet.c
===================================================================
--- src/main/internet.c	(revision 38715)
+++ src/main/internet.c	(working copy)
@@ -129,7 +129,7 @@
 {
     if(!initialized) internet_Init();
     if(initialized > 0)
-	return (*ptr->HTTPOpen)(url, 0);
+	return (*ptr->HTTPOpen)(url, NULL, 0);
     else {
 	error(_("internet routines cannot be loaded"));
 	return NULL;
Index: src/library/utils/R/zzz.R
===================================================================
--- src/library/utils/R/zzz.R	(revision 38715)
+++ src/library/utils/R/zzz.R	(working copy)
@@ -9,7 +9,8 @@
              internet.info = 2,
              pkgType = .Platform$pkgType,
              str = list(strict.width = "no"),
-             example.ask = "default")
+             example.ask = "default",
+             HTTPUserAgent = defaultUserAgent())
     extra <-
         if(.Platform$OS.type == "windows") {
             list(mailer = "none",
Index: src/library/utils/R/readhttp.R
===================================================================
--- src/library/utils/R/readhttp.R	(revision 38715)
+++ src/library/utils/R/readhttp.R	(working copy)
@@ -6,3 +6,28 @@
         stop("transfer failure")
     file.show(file, delete.file = delete.file, title = title, ...)
 }
+
+
+
+defaultUserAgent <- function()
+{
+    Rver <- paste(R.version$major, R.version$minor, sep=".")
+    Rdetails <- paste(Rver, R.version$platform, R.version$arch,
+                      R.version$os)
+    paste("R (", Rdetails, ")", sep="")
+}
+
+
+makeUserAgent <- function(format = TRUE) {
+    agent <- getOption("HTTPUserAgent")
+    if (is.null(agent)) {
+        return(NULL)
+    }
+    if (length(agent) != 1)
+      stop(sQuote("HTTPUserAgent"),
+           " option must be a length one character vector or NULL")
+    if (format)
+      paste("User-Agent: ", agent[1], "\r\n", sep = "")
+    else
+      agent[1]
+}
Index: src/library/base/man/options.Rd
===================================================================
--- src/library/base/man/options.Rd	(revision 38715)
+++ src/library/base/man/options.Rd	(working copy)
@@ -368,6 +368,11 @@
     \item{\code{help.try.all.packages}:}{default for an argument of
       \code{\link{help}}.}
 
+    \item{\code{HTTPUserAgent}:}{string used as the user agent in HTTP
+      requests.  If \code{NULL}, HTTP requests will be made without a
+      user agent header.  The default is \code{R (<version> <platform>
+      <arch> <os>)}}
+
     \item{\code{internet.info}:}{The minimum level of information to be
       printed on URL downloads etc.  Default is 2, for failure causes.
       Set to 1 or 0 to get more information.}
Index: src/modules/internet/internet.c
===================================================================
--- src/modules/internet/internet.c	(revision 38715)
+++ src/modules/internet/internet.c	(working copy)
@@ -28,7 +28,7 @@
 #include <Rconnections.h>
 #include <R_ext/R-ftp-http.h>
 
-static void *in_R_HTTPOpen(const char *url, const int cacheOK);
+static void *in_R_HTTPOpen(const char *url, const char *headers, const int cacheOK);
 static int   in_R_HTTPRead(void *ctx, char *dest, int len);
 static void  in_R_HTTPClose(void *ctx);
 
@@ -70,7 +70,7 @@
 
     switch(type) {
     case HTTPsh:
-	ctxt = in_R_HTTPOpen(url, 0);
+	ctxt = in_R_HTTPOpen(url, NULL, 0);
 	if(ctxt == NULL) {
 	  /* if we call error() we get a connection leak*/
 	  /* so do_url has to raise the error*/
@@ -238,14 +238,14 @@
 }
 #endif
 
-/* download(url, destfile, quiet, mode, cacheOK) */
+/* download(url, destfile, quiet, mode, headers, cacheOK) */
 
 #define CPBUFSIZE 65536
 #define IBUFSIZE 4096
 static SEXP in_do_download(SEXP call, SEXP op, SEXP args, SEXP env)
 {
-    SEXP ans, scmd, sfile, smode;
-    char *url, *file, *mode;
+    SEXP ans, scmd, sfile, smode, sheaders, agentFun;
+    char *url, *file, *mode, *headers;
     int quiet, status = 0, cacheOK;
 
     checkArity(op, args);
@@ -271,6 +271,17 @@
     cacheOK = asLogical(CAR(args));
     if(cacheOK == NA_LOGICAL)
 	error(_("invalid '%s' argument"), "cacheOK");
+#ifdef USE_WININET
+    PROTECT(agentFun = lang2(install("makeUserAgent"), ScalarLogical(0)));
+#else
+    PROTECT(agentFun = lang1(install("makeUserAgent")));
+#endif
+    PROTECT(sheaders = eval(agentFun, R_FindNamespace(mkString("utils"))));
+    UNPROTECT(1);
+    if(TYPEOF(sheaders) == NILSXP)
+        headers = NULL;
+    else 
+        headers = CHAR(STRING_ELT(sheaders, 0));
 #ifdef Win32
     if (!pbar.wprog) {
 	pbar.wprog = newwindow(_("Download progress"), rect(0, 0, 540, 100),
@@ -319,7 +330,7 @@
 #ifdef Win32
 	R_FlushConsole();
 #endif
-	ctxt = in_R_HTTPOpen(url, cacheOK);
+	ctxt = in_R_HTTPOpen(url, headers, cacheOK);
 	if(ctxt == NULL) status = 1;
 	else {
 	    if(!quiet) REprintf(_("opened URL\n"), url);
@@ -466,14 +477,14 @@
 
     PROTECT(ans = allocVector(INTSXP, 1));
     INTEGER(ans)[0] = status;
-    UNPROTECT(1);
+    UNPROTECT(2);
     return ans;
 }
 
 
 #if defined(SUPPORT_LIBXML) && !defined(USE_WININET)
 
-void *in_R_HTTPOpen(const char *url, int cacheOK)
+void *in_R_HTTPOpen(const char *url, const char *headers, const int cacheOK)
 {
     inetconn *con;
     void *ctxt;
@@ -484,7 +495,7 @@
     if(timeout == NA_INTEGER || timeout <= 0) timeout = 60;
 
     RxmlNanoHTTPTimeout(timeout);
-    ctxt = RxmlNanoHTTPOpen(url, NULL, cacheOK);
+    ctxt = RxmlNanoHTTPOpen(url, NULL, headers, cacheOK);
     if(ctxt != NULL) {
 	int rc = RxmlNanoHTTPReturnCode(ctxt);
 	if(rc != 200) {
@@ -605,7 +616,8 @@
 }
 #endif /* USE_WININET_ASYNC */
 
-static void *in_R_HTTPOpen(const char *url, const int cacheOK)
+static void *in_R_HTTPOpen(const char *url, const char *headers, 
+                           const int cacheOK)
 {
     WIctxt  wictxt;
     DWORD status, d1 = 4, d2 = 0, d3 = 100;
@@ -622,7 +634,7 @@
     wictxt->length = -1;
     wictxt->type = NULL;
     wictxt->hand =
-	InternetOpen("R", INTERNET_OPEN_TYPE_PRECONFIG, NULL, NULL,
+	InternetOpen(headers, INTERNET_OPEN_TYPE_PRECONFIG, NULL, NULL,
 #ifdef USE_WININET_ASYNC
 		     INTERNET_FLAG_ASYNC
 #else
@@ -870,7 +882,8 @@
 #endif
 
 #ifndef HAVE_INTERNET
-static void *in_R_HTTPOpen(const char *url, const int cacheOK)
+static void *in_R_HTTPOpen(const char *url, const char *headers, 
+                           const int cacheOK)
 {
     return NULL;
 }
Index: src/modules/internet/nanohttp.c
===================================================================
--- src/modules/internet/nanohttp.c	(revision 38715)
+++ src/modules/internet/nanohttp.c	(working copy)
@@ -1034,6 +1034,9 @@
  * @contentType:  if available the Content-Type information will be
  *                returned at that location
  *
+ * @headers: headers to be used in the HTTP request.  These must be name/value
+ *           pairs separated by ':', each on their own line.
+ *
  * This function try to open a connection to the indicated resource
  * via HTTP GET.
  *
@@ -1042,10 +1045,11 @@
  */
 
 void*
-RxmlNanoHTTPOpen(const char *URL, char **contentType, int cacheOK)
+RxmlNanoHTTPOpen(const char *URL, char **contentType, const char *headers,
+                 int cacheOK)
 {
     if (contentType != NULL) *contentType = NULL;
-    return RxmlNanoHTTPMethod(URL, NULL, NULL, contentType, NULL, cacheOK);
+    return RxmlNanoHTTPMethod(URL, NULL, NULL, contentType, headers, cacheOK);
 }
 
 /**


From roger at ysidro.econ.uiuc.edu  Sun Jul 30 17:29:37 2006
From: roger at ysidro.econ.uiuc.edu (roger koenker)
Date: Sun, 30 Jul 2006 10:29:37 -0500
Subject: [Rd] Parametric links for glm?
Message-ID: <0EA0A52D-EA2C-459D-8D39-205A9FDE5F5C@ysidro.econ.uiuc.edu>

At useR 2006 I mentioned that it would be nice to have a way to  
specify binomial links
that involved free parameters  and described some experience with a  
Gosset link involving
a free degrees of freedom parameter, and a Tukey-lambda link with two  
free parameters.
My implementation of this involved some rather kludgey modifications  
of binomial,
make.link and glm that (essentially) added a "..." argument to  
binomial permitting the
parameters to be passed down to the fitting routines.  So, in the  
Gosset case, for example,
had the following passage in  make.link, involving a free degrees of  
freedom parameter nu:

}, Gosset = {
         linkfun <- function(mu) qt(mu,nu)
         linkinv <- function(eta) {
             thresh <- -qqt(.Machine$double.eps,nu)
             eta <- pmin(thresh, pmax(eta, -thresh))
             pt(eta,nu)
         }
         mu.eta <- function(eta) pmax(dt(eta,nu), .Machine$double.eps)
         valideta <- function(eta) TRUE
},

Just prior to the useR meeting, there were some changes in R-devel to  
binomial that allow one to pass an object of class "link-glm" -- if I  
understand properly, this allows one to more easily
roll one's own links, but it leaves the question of passing  
parameters on the table.  That is,
presumably, I could pass a structure, like that above of class "link- 
glm" and thereby avoid
the Cerberus of  officially sanctioned links, but I still don't see  
how to pass my parameters.
Can someone enlighten me?  Or,  would it still be necessary to add  
"..." to the binomial
function?

url:    www.econ.uiuc.edu/~roger                Roger Koenker
email   rkoenker at uiuc.edu                       Department of Economics
vox:    217-333-4558                            University of Illinois
fax:    217-244-6678                            Champaign, IL 61820


From ripley at stats.ox.ac.uk  Sun Jul 30 18:11:14 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 30 Jul 2006 17:11:14 +0100 (BST)
Subject: [Rd] Parametric links for glm?
In-Reply-To: <0EA0A52D-EA2C-459D-8D39-205A9FDE5F5C@ysidro.econ.uiuc.edu>
References: <0EA0A52D-EA2C-459D-8D39-205A9FDE5F5C@ysidro.econ.uiuc.edu>
Message-ID: <Pine.LNX.4.64.0607301705090.25082@gannet.stats.ox.ac.uk>

There is no reason to add ...: you could have 
binomial(link = Gosset(nu=5)).

I really don't like the idea of changing system functions like make.link, 
and believe it is not necessary.

On Sun, 30 Jul 2006, roger koenker wrote:

> At useR 2006 I mentioned that it would be nice to have a way to  
> specify binomial links
> that involved free parameters  and described some experience with a  
> Gosset link involving
> a free degrees of freedom parameter, and a Tukey-lambda link with two  
> free parameters.
> My implementation of this involved some rather kludgey modifications  
> of binomial,
> make.link and glm that (essentially) added a "..." argument to  
> binomial permitting the
> parameters to be passed down to the fitting routines.  So, in the  
> Gosset case, for example,
> had the following passage in  make.link, involving a free degrees of  
> freedom parameter nu:
> 
> }, Gosset = {
>          linkfun <- function(mu) qt(mu,nu)
>          linkinv <- function(eta) {
>              thresh <- -qqt(.Machine$double.eps,nu)
>              eta <- pmin(thresh, pmax(eta, -thresh))
>              pt(eta,nu)
>          }
>          mu.eta <- function(eta) pmax(dt(eta,nu), .Machine$double.eps)
>          valideta <- function(eta) TRUE
> },
> 
> Just prior to the useR meeting, there were some changes in R-devel to  

Actually, it was a redesign of all the link functions to make them 
consistent: quasi was odd here.

> binomial that allow one to pass an object of class "link-glm" -- if I  
> understand properly, this allows one to more easily
> roll one's own links, but it leaves the question of passing  
> parameters on the table.  That is,
> presumably, I could pass a structure, like that above of class "link- 
> glm" and thereby avoid
> the Cerberus of  officially sanctioned links, but I still don't see  
> how to pass my parameters.
> Can someone enlighten me?  Or,  would it still be necessary to add  
> "..." to the binomial
> function?
> 
> url:    www.econ.uiuc.edu/~roger                Roger Koenker
> email   rkoenker at uiuc.edu                       Department of Economics
> vox:    217-333-4558                            University of Illinois
> fax:    217-244-6678                            Champaign, IL 61820
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From roger at ysidro.econ.uiuc.edu  Sun Jul 30 21:49:19 2006
From: roger at ysidro.econ.uiuc.edu (roger koenker)
Date: Sun, 30 Jul 2006 14:49:19 -0500
Subject: [Rd] Parametric links for glm?
In-Reply-To: <Pine.LNX.4.64.0607301705090.25082@gannet.stats.ox.ac.uk>
References: <0EA0A52D-EA2C-459D-8D39-205A9FDE5F5C@ysidro.econ.uiuc.edu>
	<Pine.LNX.4.64.0607301705090.25082@gannet.stats.ox.ac.uk>
Message-ID: <375A2F7B-937D-40F7-8BDA-F6083E67AD12@ysidro.econ.uiuc.edu>

Thanks, that works splendidly.

url:    www.econ.uiuc.edu/~roger                Roger Koenker
email   rkoenker at uiuc.edu                       Department of Economics
vox:    217-333-4558                            University of Illinois
fax:    217-244-6678                            Champaign, IL 61820


On Jul 30, 2006, at 11:11 AM, Prof Brian Ripley wrote:

> There is no reason to add ...: you could have
> binomial(link = Gosset(nu=5)).
>
> I really don't like the idea of changing system functions like  
> make.link,
> and believe it is not necessary.
>
> On Sun, 30 Jul 2006, roger koenker wrote:
>
>> At useR 2006 I mentioned that it would be nice to have a way to
>> specify binomial links
>> that involved free parameters  and described some experience with a
>> Gosset link involving
>> a free degrees of freedom parameter, and a Tukey-lambda link with two
>> free parameters.
>> My implementation of this involved some rather kludgey modifications
>> of binomial,
>> make.link and glm that (essentially) added a "..." argument to
>> binomial permitting the
>> parameters to be passed down to the fitting routines.  So, in the
>> Gosset case, for example,
>> had the following passage in  make.link, involving a free degrees of
>> freedom parameter nu:
>>
>> }, Gosset = {
>>          linkfun <- function(mu) qt(mu,nu)
>>          linkinv <- function(eta) {
>>              thresh <- -qqt(.Machine$double.eps,nu)
>>              eta <- pmin(thresh, pmax(eta, -thresh))
>>              pt(eta,nu)
>>          }
>>          mu.eta <- function(eta) pmax(dt(eta,nu), .Machine 
>> $double.eps)
>>          valideta <- function(eta) TRUE
>> },
>>
>> Just prior to the useR meeting, there were some changes in R-devel to
>
> Actually, it was a redesign of all the link functions to make them
> consistent: quasi was odd here.
>
>> binomial that allow one to pass an object of class "link-glm" -- if I
>> understand properly, this allows one to more easily
>> roll one's own links, but it leaves the question of passing
>> parameters on the table.  That is,
>> presumably, I could pass a structure, like that above of class "link-
>> glm" and thereby avoid
>> the Cerberus of  officially sanctioned links, but I still don't see
>> how to pass my parameters.
>> Can someone enlighten me?  Or,  would it still be necessary to add
>> "..." to the binomial
>> function?
>>
>> url:    www.econ.uiuc.edu/~roger                Roger Koenker
>> email   rkoenker at uiuc.edu                       Department of  
>> Economics
>> vox:    217-333-4558                            University of  
>> Illinois
>> fax:    217-244-6678                            Champaign, IL 61820
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From CarnellR at BATTELLE.ORG  Mon Jul 31 01:42:29 2006
From: CarnellR at BATTELLE.ORG (Carnell, Rob C)
Date: Sun, 30 Jul 2006 19:42:29 -0400
Subject: [Rd] NIST StRD linear regression
Message-ID: <0F923E9EBBF1554ABA641ACA04BEBEC0051BD9FE@WS-BCO-MSE7.milky-way.battelle.org>

NIST maintains a repository of Statistical Reference Datasets at
http://www.itl.nist.gov/div898/strd/.  I have been working through the
datasets to compare R's results to their references with the hope that
if all works well, this could become a validation package.

All the linear regression datasets give results with some degree of
accuracy except one.  The NIST model includes 11 parameters, but R will
not compute the estimates for all 11 parameters because it finds the
data matrix to be singular.

The code I used is below.  Any help in getting R to estimate all 11
regression parameters would be greatly appreciated.

I am posting this to the R-devel list since I think that the discussion
might involve the limitations of platform precision.

I am using R 2.3.1 for Windows XP.

rm(list=ls())
require(gsubfn)

defaultPath <- "my path"

data.base <- "http://www.itl.nist.gov/div898/strd/lls/data/LINKS/DATA"

reg.data <- paste(data.base, "/Filip.dat", sep="")

model <-
"V1~V2+I(V2^2)+I(V2^3)+I(V2^4)+I(V2^5)+I(V2^6)+I(V2^7)+I(V2^8)+I(V2^9)+I
(V2^10)"

filePath <- paste(defaultPath, "//NISTtest.dat", sep="")
download.file(reg.data, filePath, quiet=TRUE)

A <- read.table(filePath, skip=60, strip.white=TRUE)
lm.data <- lm(formula(model), A)

lm.data


Rob Carnell


From ripley at stats.ox.ac.uk  Mon Jul 31 08:52:01 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 31 Jul 2006 07:52:01 +0100 (BST)
Subject: [Rd] NIST StRD linear regression
In-Reply-To: <0F923E9EBBF1554ABA641ACA04BEBEC0051BD9FE@WS-BCO-MSE7.milky-way.battelle.org>
References: <0F923E9EBBF1554ABA641ACA04BEBEC0051BD9FE@WS-BCO-MSE7.milky-way.battelle.org>
Message-ID: <Pine.LNX.4.64.0607310735001.20216@gannet.stats.ox.ac.uk>

That is not an appropriate way to fit a degree-10 polynomial (in any 
language, if fitting a degree-10 polynomial is in fact an appropriate 
statistical analysis, which seems unlikely).

On Sun, 30 Jul 2006, Carnell, Rob C wrote:

> NIST maintains a repository of Statistical Reference Datasets at
> http://www.itl.nist.gov/div898/strd/.  I have been working through the
> datasets to compare R's results to their references with the hope that
> if all works well, this could become a validation package.

What does it validate?  The R user's understanding of numerical methods?

> All the linear regression datasets give results with some degree of
> accuracy except one.  The NIST model includes 11 parameters, but R will
> not compute the estimates for all 11 parameters because it finds the
> data matrix to be singular.
> 
> The code I used is below.  Any help in getting R to estimate all 11
> regression parameters would be greatly appreciated.
> 
> I am posting this to the R-devel list since I think that the discussion
> might involve the limitations of platform precision.
> 
> I am using R 2.3.1 for Windows XP.
> 
> rm(list=ls())
> require(gsubfn)

That is not needed.

> defaultPath <- "my path"
> 
> data.base <- "http://www.itl.nist.gov/div898/strd/lls/data/LINKS/DATA"
> 
> reg.data <- paste(data.base, "/Filip.dat", sep="")
> 
> model <-
> "V1~V2+I(V2^2)+I(V2^3)+I(V2^4)+I(V2^5)+I(V2^6)+I(V2^7)+I(V2^8)+I(V2^9)+I
> (V2^10)"
> 
> filePath <- paste(defaultPath, "//NISTtest.dat", sep="")
> download.file(reg.data, filePath, quiet=TRUE)

filePath <- 
url("http://www.itl.nist.gov/div898/strd/lls/data/LINKS/DATA/Filip.dat")

will suffice.

> A <- read.table(filePath, skip=60, strip.white=TRUE)

> lm.data <- lm(formula(model), A)
> 
> lm.data

lm(V1 ~ poly(V2, 10), A)

works.

> kappa(model.matrix(V1 ~ poly(V2, 10, raw=TRUE), A), exact=TRUE)
[1] 1.767963e+15

shows the design matrix is indeed numerically singular by the naive 
method.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Mon Jul 31 09:08:58 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 31 Jul 2006 09:08:58 +0200
Subject: [Rd] NIST StRD linear regression
In-Reply-To: <0F923E9EBBF1554ABA641ACA04BEBEC0051BD9FE@WS-BCO-MSE7.milky-way.battelle.org>
References: <0F923E9EBBF1554ABA641ACA04BEBEC0051BD9FE@WS-BCO-MSE7.milky-way.battelle.org>
Message-ID: <17613.44170.194635.760834@stat.math.ethz.ch>

>>>>> "RobCar" == Carnell, Rob C <CarnellR at BATTELLE.ORG>
>>>>>     on Sun, 30 Jul 2006 19:42:29 -0400 writes:

    RobCar> NIST maintains a repository of Statistical Reference
    RobCar> Datasets at http://www.itl.nist.gov/div898/strd/.  I
    RobCar> have been working through the datasets to compare
    RobCar> R's results to their references with the hope that
    RobCar> if all works well, this could become a validation
    RobCar> package.

    RobCar> All the linear regression datasets give results with
    RobCar> some degree of accuracy except one.  The NIST model
    RobCar> includes 11 parameters, but R will not compute the
    RobCar> estimates for all 11 parameters because it finds the
    RobCar> data matrix to be singular.

    RobCar> The code I used is below.  Any help in getting R to
    RobCar> estimate all 11 regression parameters would be
    RobCar> greatly appreciated.

    RobCar> I am posting this to the R-devel list since I think
    RobCar> that the discussion might involve the limitations of
    RobCar> platform precision.

    RobCar> I am using R 2.3.1 for Windows XP.

    RobCar> rm(list=ls())
    RobCar> require(gsubfn)

    RobCar> defaultPath <- "my path"

    RobCar> data.base <- "http://www.itl.nist.gov/div898/strd/lls/data/LINKS/DATA"

Here is a slight improvement {note the function file.path(); and
model <- ..; also  poly(V2, 10) !} 
which shows you how to tell lm() to "believe" in 10 digit
precision of input data.  

-------------------------------------------------------------------------------

reg.data <- paste(data.base, "/Filip.dat", sep="")
filePath <- file.path(defaultPath, "NISTtest.dat")
download.file(reg.data, filePath, quiet=TRUE)

A <- read.table(filePath, skip=60, strip.white=TRUE)

## If you really need high-order polynomial regression in S and R,
##  *DO* as you are told in all good books, and use orthogonal polynomials:
(lm.ok <- lm(V1 ~ poly(V2,10), data = A))
## and there is no problem
summary(lm.ok)

## But if you insist on doing nonsense ....

model <- "V1 ~ V2+ I(V2^2)+I(V2^3)+I(V2^4)+I(V2^5)+I(V2^6)+I(V2^7)+I(V2^8)+I(V2^9)+I(V2^10)"

## MM: "better":
(model <- paste("V1 ~ V2", paste("+ I(V2^", 2:10, ")", sep='', collapse='')))
(form <- formula(model))

mod.mat <- model.matrix(form, data = A)
dim(mod.mat) ## 82 11
(m.qr <- qr(mod.mat             ))$rank # -> 10 (only, instead of 11)
(m.qr <- qr(mod.mat, tol = 1e-10))$rank # -> 11

(lm.def  <- lm(form, data = A)) ## last coef. is NA
(lm.plus <- lm(form, data = A, tol = 1e-10))## no NA coefficients

-------------------------------------------------------------------------------


    RobCar> reg.data <- paste(data.base, "/Filip.dat", sep="")

    RobCar> model <-
    RobCar> "V1~V2+I(V2^2)+I(V2^3)+I(V2^4)+I(V2^5)+I(V2^6)+I(V2^7)+I(V2^8)+I(V2^9)+I
    RobCar> (V2^10)"

    RobCar> filePath <- paste(defaultPath, "//NISTtest.dat", sep="")
    RobCar> download.file(reg.data, filePath, quiet=TRUE)

    RobCar> A <- read.table(filePath, skip=60, strip.white=TRUE)
    RobCar> lm.data <- lm(formula(model), A)

    RobCar> lm.data


    RobCar> Rob Carnell

A propos NIST StRD:
If you go further to  NONlinear regression,
and use nls(), you will see that high quality statistics
packages such as R  do *NOT* always conform to NIST -- at least
not to what NIST did about 5 years ago when I last looked.
There are many nonlinear least squares problems where the
correct result is *NO CONVERGENCE* (because of
over-parametrization, ill-posednes, ...), 
owever many (cr.p) pieces of software do "converge"---falsely. 
I think you find more on this topic in the monograph of 
Bates and Watts (1988), but in any case,
just install and use the CRAN R package 'NISTnls' by Doug Bates
which contains the data sets with documentation and example
calls.

Martin Maechler, ETH Zurich


From ligges at statistik.uni-dortmund.de  Mon Jul 31 13:34:59 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Mon, 31 Jul 2006 13:34:59 +0200
Subject: [Rd] R sources: .tgz oder .tar.gz
Message-ID: <44CDEAE3.6030200@statistik.uni-dortmund.de>

This is a minor documentation inconsistency:
While the R Installation and Administration manual speaks about the file 
"R-x.y.z.tgz", this has to be replaced by "R-x.y.z.tar.gz" for x > 1.

Uwe Ligges


From h.wickham at gmail.com  Mon Jul 31 13:41:12 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 31 Jul 2006 12:41:12 +0100
Subject: [Rd] Warning when indexing data.frame with FALSE
Message-ID: <f8e6ff050607310441v1cd40ae0n6fb479cbd5a763a0@mail.gmail.com>

> data.frame()[]
NULL data frame with 0 rows
> data.frame()[FALSE]
Warning in is.na(nm) : is.na() applied to non-(list or vector)
NULL data frame with 0 rows
> data.frame()[NULL]
Warning in is.na(nm) : is.na() applied to non-(list or vector)
NULL data frame with 0 rows

Is this a bug?  I wouldn't have expected the warning in the last two cases.

Regards,

Hadley


From h.wickham at gmail.com  Mon Jul 31 13:42:23 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 31 Jul 2006 12:42:23 +0100
Subject: [Rd] Warning when indexing data.frame with FALSE
In-Reply-To: <f8e6ff050607310441v1cd40ae0n6fb479cbd5a763a0@mail.gmail.com>
References: <f8e6ff050607310441v1cd40ae0n6fb479cbd5a763a0@mail.gmail.com>
Message-ID: <f8e6ff050607310442h16778689va0d70206042311e8@mail.gmail.com>

Sorry, a better example is:

> data.frame(a=1)[FALSE]
NULL data frame with 1 rows
> data.frame(a=1)[NULL]
NULL data frame with 1 rows

vs

> data.frame()[FALSE]
Warning in is.na(nm) : is.na() applied to non-(list or vector)
NULL data frame with 0 rows
> data.frame()[NULL]
Warning in is.na(nm) : is.na() applied to non-(list or vector)
NULL data frame with 0 rows

Hadley


From ripley at stats.ox.ac.uk  Mon Jul 31 13:58:56 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 31 Jul 2006 12:58:56 +0100 (BST)
Subject: [Rd] Warning when indexing data.frame with FALSE
In-Reply-To: <f8e6ff050607310442h16778689va0d70206042311e8@mail.gmail.com>
References: <f8e6ff050607310441v1cd40ae0n6fb479cbd5a763a0@mail.gmail.com>
	<f8e6ff050607310442h16778689va0d70206042311e8@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0607311253030.21136@gannet.stats.ox.ac.uk>

On Mon, 31 Jul 2006, hadley wickham wrote:

> Sorry, a better example is:
> 
> > data.frame(a=1)[FALSE]
> NULL data frame with 1 rows
> > data.frame(a=1)[NULL]
> NULL data frame with 1 rows
> 
> vs
> 
> > data.frame()[FALSE]
> Warning in is.na(nm) : is.na() applied to non-(list or vector)
> NULL data frame with 0 rows
> > data.frame()[NULL]
> Warning in is.na(nm) : is.na() applied to non-(list or vector)
> NULL data frame with 0 rows

It's reasonable:

> names(data.frame())
NULL

which is a problem as data frames are supposed to have names.
So the bug is in data.frame.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Mon Jul 31 14:43:06 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 31 Jul 2006 14:43:06 +0200
Subject: [Rd] Warning when indexing data.frame with FALSE
In-Reply-To: <Pine.LNX.4.64.0607311253030.21136@gannet.stats.ox.ac.uk>
References: <f8e6ff050607310441v1cd40ae0n6fb479cbd5a763a0@mail.gmail.com>
	<f8e6ff050607310442h16778689va0d70206042311e8@mail.gmail.com>
	<Pine.LNX.4.64.0607311253030.21136@gannet.stats.ox.ac.uk>
Message-ID: <x2hd0yq71h.fsf@viggo.kubism.ku.dk>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> On Mon, 31 Jul 2006, hadley wickham wrote:
> 
> > Sorry, a better example is:
> > 
> > > data.frame(a=1)[FALSE]
> > NULL data frame with 1 rows
> > > data.frame(a=1)[NULL]
> > NULL data frame with 1 rows
> > 
> > vs
> > 
> > > data.frame()[FALSE]
> > Warning in is.na(nm) : is.na() applied to non-(list or vector)
> > NULL data frame with 0 rows
> > > data.frame()[NULL]
> > Warning in is.na(nm) : is.na() applied to non-(list or vector)
> > NULL data frame with 0 rows
> 
> It's reasonable:
> 
> > names(data.frame())
> NULL
> 
> which is a problem as data frames are supposed to have names.
> So the bug is in data.frame.

To wit:

> d <- data.frame()
> names(d) <- character(0)
> d[FALSE]
NULL data frame with 0 rows
> d[NULL]
NULL data frame with 0 rows



-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Mon Jul 31 15:25:32 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 31 Jul 2006 15:25:32 +0200 (CEST)
Subject: [Rd] R uses private function in libc (PR#9107)
Message-ID: <20060731132532.D26663F6BA@slim.kubism.ku.dk>

On Fri, 28 Jul 2006, Thomas Lumley wrote, quoting someone else:

> > In any case, as you can see, __libc_stack_end goes away completely by libc
> > 2.3.6, 

I don't see this: my FC3 AMD64 *g*libc 2.3.6 system gives

  2148: 00000000     4 OBJECT  GLOBAL DEFAULT  UND 
__libc_stack_end at GLIBC_2.1 (22)
  9516: 00000000     4 OBJECT  GLOBAL DEFAULT  UND 
__libc_stack_end@@GLIBC_2

so the claim is not a general property of glibc 2.3.6.  Indeed, it seems 
rather to be a question of visibility: the symbol has NOT `gone away 
completely' but been hidden in the .so (it is visible in libc.a in vanilla 
glibc 2.4).

It had already been said that many systems using glibc 2.3.6 or 2.4 do 
export the symbol, as evidenced by the RPMs that exist for FC3 (at 2.3.6) 
and FC5 (at 2.4), the runs on the Debian test farm, and the absence of 
reported problems from anywhere else on any Linux system.  (Not only that, 
the code detects C stack overflows at the intended stack size limit, so 
the symbol linked to has the expected value.)

I had checked the glibc Changelogs and found nothing relevant, and it 
seems this is an undocumented change that the major distros have reverted 
and hence not much of a problem.

> > and as noted in the follow-up I sent to this bug yesterday, the
> > reasons one shouldn't use this symbol are quite clearly stated here:
> >
> > <http://www.mail-archive.com/debian-glibc at lists.debian.org/msg28253.html>
> >
> 
> Only up to a point.  We know that __libc_stack_end is not portable, but it 
> is being used to do something that is impossible to do portably: check 
> whether the C stack is about to overflow. Since there is no way to recover 
> from a C stack overflow, being able to prevent it is valuable.
> 
> Your fix disables this facility on all Linux systems, which may be 
> appropriate for your systems but is clearly undesirable as a change to R. 
> The real question is how to detect systems that do provide 
> __libc_stack_end and whether there is another non-portable way to do the 
> same thing on glibc versions that don't provide it.

I've added a test for the symbol in R-devel.  I did originally expect to 
need one for non-glibc Linuxen (e.g. using Intel and PG compilers) but 
they do find the symbol.  Hopefully this will continue to be the case for 
the major distros.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kevin.hendricks at sympatico.ca  Mon Jul 31 15:41:53 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Mon, 31 Jul 2006 09:41:53 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for so
In-Reply-To: <5562816.post@talk.nabble.com>
References: <07820D54-9DDC-42F7-8F32-C931B2B80DE6@sympatico.ca>
	<Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
	<5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
	<Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>
	<AAC5E1FB-71BB-46C8-9D51-A72DD25C735E@sympatico.ca>
	<207048BB-90DD-43DA-8FBC-D73544E6E3A8@sympatico.ca>
	<5562816.post@talk.nabble.com>
Message-ID: <A37700AE-CA2E-42E9-B734-EEC0A7420569@sympatico.ca>

Hi Tom,

> Now, try sorting and using a loop:
>
>> idx <- order(i)
>> xs <- x[idx]
>> is <- i[idx]
>> res <- array(NA, 1e6)
>> idx <- which(diff(is) > 0)
>> startidx <- c(1, idx+1)
>> endidx <- c(idx, length(xs))
>> f1 <- function(x, startidx, endidx, FUN = sum)  {
> +   for (j in 1:length(res)) {
> +     res[j] <- FUN(x[startidx[j]:endidx[j]])
> +   }
> +   res
> + }
>> unix.time(res1 <- f1(xs, startidx, endidx))
> [1] 6.86 0.00 7.04   NA   NA

I wonder how much time the sorting, reordering and creation os  
startidx and endidx would add to this time?

Either way, your code can nicely be used to quickly create the small  
integer factors I would need if the igroup functions get integrated.   
Thanks!

> For the case of sum (or averages), you can vectorize this using  
> cumsum as
> follows. This won't work for median or max.
>
>> f2 <- function(x, startidx, endidx)  {
> +   cum <- cumsum(x)
> +   res <- cum[endidx]
> +   res[2:length(res)] <- res[2:length(res)] - cum[endidx[1:(length 
> (res) -
> 1)]]
> +   res
> + }
>> unix.time(res2 <- f2(xs, startidx, endidx))
> [1] 0.20 0.00 0.21   NA   NA

Yes that is a quite fast way to handle "sums".

> You can also use Luke Tierney's byte compiler
> (http://www.stat.uiowa.edu/~luke/R/compiler/) to speed up the loop for
> functions where you can't vectorize:
>
>> library(compiler)
>> f3 <- cmpfun(f1)
> Note: local functions used: FUN
>> unix.time(res3 <- f3(xs, startidx, endidx))
> [1] 3.84 0.00 3.91   NA   NA

That looks interesting.  Does it only work for specific operating  
systems and processors?  I will give it a try.

Thanks,

Kevin


From mlcarvalho at fc.ul.pt  Mon Jul 31 15:48:15 2006
From: mlcarvalho at fc.ul.pt (mlcarvalho at fc.ul.pt)
Date: Mon, 31 Jul 2006 15:48:15 +0200 (CEST)
Subject: [Rd] Choropleths maps of the USA states (PR#9111)
Message-ID: <20060731134815.BFF783F03D@slim.kubism.ku.dk>

Dear Colegues:

I have tried to reach Ray Brownrigg,   Ray.Brownrigg at mcs.vuw.ac.nz
but my mails have turned back with the following comment
did not reach the following recipient(s):
Brownrigg at mcs.vuw.ac.nz on Mon, 31 Jul 2006 12:52:39 +0100

There is no such account in the address

=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D

I have a problem with the choropleths maps of the USA states=20

 In fact, when I use the following code

#####################################################

palette(gray(seq(0,.9,len=3D10)))

 ordena.estados<-c("ALABAMA","ARIZONA","ARKANSAS","CALIFORNIA","COLORADO",
"CONNECTICUT","DELAWARE","FLORIDA","GEORGIA","IDAHO","ILLINOIS","INDIANA","=
IOWA",
"KANSAS",
"KENTUCKY","LOUISIANA","MAINE","MARYLAND","MASSACHUSETTS","MICHIGAN","MINNE=
SOTA","MISSISSIPI",
 "MISSOURI", "MONTANA","NEBRASKA","NEVADA","NEW HAMPSHIRE","NEW JERSEY",
"NEW MEXICO","NEW YORK",
"NORTH CAROLINA","NORTH DAKOTA","OHIO","OKLAHOMA","OREGON","PENNSYLVANIA","=
RHODE ISLAND",
"SOUTH CAROLINA",
"SOUTH DAKOTA","TENNESSEE","TEXAS","UTAH","VERMONT","VIRGINIA","WASHINGTON",
"WEST VIRGINIA","WISCONSIN","WYOMING")

W<-c(1,10,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1=
,1,1,1,1,1,1,1,1,1,1,1,1,1)

mapa.sat<-map('state', region =3D ordena.estados,fill=3DT,col=3DW)=20=20

#####################################################

That should paint all the states with the same colour except   "ARIZONA" , =
 I get the  "UTAH" state also coloured as "ARIZONA".

The same thing happens with some other states, I get two states coloured in=
stead of one.

Is there any problem with the way I have made the ranking of states in "ord=
ena.estados"?





=20

Thank you for any help.

Sincerely

Luc=EDlia Carvalho









	[[alternative HTML version deleted]]


From tlumley at u.washington.edu  Mon Jul 31 16:19:01 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 31 Jul 2006 07:19:01 -0700 (PDT)
Subject: [Rd] Any interest in "merge" and "by" implementations
 specifically for sorted data?
In-Reply-To: <AAC5E1FB-71BB-46C8-9D51-A72DD25C735E@sympatico.ca>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
	<5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
	<Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>
	<AAC5E1FB-71BB-46C8-9D51-A72DD25C735E@sympatico.ca>
Message-ID: <Pine.LNX.4.64.0607310716250.32031@homer23.u.washington.edu>

On Sat, 29 Jul 2006, Kevin B. Hendricks wrote:

> Hi Bill,
>
>>>>    sum : igroupSums
>
> Okay, after thinking about this ...
>
> # assumes i is the small integer factor with n levels
> # v is some long vector
> # no sorting required
>
> igroupSums <- function(v,i) {
>   sums <- rep(0,max(i))
>   for (j in 1:length(v)) {
>       sums[[i[[j]]]] <- sums[[i[[j]]]] + v[[j]]
>   }
>   sums
> }
>
> if written in fortran or c might be faster than using split.  It is
> at least just linear in time with the length of vector v.

For sums you should look at rowsum().  It uses a hash table in C and last 
time I looked was faster than using split(). It returns a vector of the 
same length as the input, but that would easily be fixed.

The same approach would work for min, max, range, count, mean, but not for 
arbitrary functions.

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From tplate at acm.org  Mon Jul 31 17:52:10 2006
From: tplate at acm.org (tplate at acm.org)
Date: Mon, 31 Jul 2006 17:52:10 +0200 (CEST)
Subject: [Rd] bug in format.default: trim=TRUE does not always work as
	advertised (PR#9114)
Message-ID: <20060731155210.DF025281EF@slim.kubism.ku.dk>

This is a multi-part message in MIME format.
--------------090008060607010208040805
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

DESCRIPTION OF PROBLEM:

Output from format.default sometimes has whitespace around it when using
big.mark="," and trim=TRUE.  E.g.:

  > # works ok as long as big.mark is not actually used:
  > format(c(-1,1,10,999), big.mark=",", trim=TRUE)
[1] "-1"  "1"   "10"  "999"
  > # but if big.mark is used, output is justified and not trimmed:
  > format(c(-1,1,10,999,1e6), big.mark=",", trim=TRUE)
[1] "       -1" "        1" "       10" "      999" "1,000,000"
  >

The documentation for the argument 'trim' to format.default() states:
     trim: logical; if 'FALSE', logical, numeric and complex values are
           right-justified to a common width: if 'TRUE' the leading
           blanks for justification are suppressed.

Thus, the above behavior of including blanks for justification when 
trim=FALSE (in some situations) seems to contradict the documentation.

PROPOSED FIX:

The last call to prettyNum() in format.default() 
(src/library/base/R/format.R) has the argument

    preserve.width = "common"

If this is changed to

    preserve.width = if (trim) "individual" else "common"

then output is formatted correctly in the case above.

A patch for this one line is attached to this message (patch done 
against the released R-2.3.1 source tarball (2006/06/01), the format.R 
file in this release is not different to the one in the current snapshot 
of the devel version of R).  After making these changes, I ran "make 
check-all".  I did not see any tests that seemed to  break with these 
changes.

-- Tony Plate


--------------090008060607010208040805
Content-Type: text/plain;
 name="format.default.fixes.diff"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="format.default.fixes.diff"

--- R-2.3.1-orig/src/library/base/R/format.R	2006-04-09 16:19:19.000000000 -0600
+++ R-2.3.1/src/library/base/R/format.R	2006-07-26 15:52:42.117456700 -0600
@@ -37,7 +37,7 @@
 			 small.interval = small.interval,
 			 decimal.mark = decimal.mark,
 			 zero.print = zero.print,
-			 preserve.width = "common")
+                         preserve.width = if (trim) "individual" else "common")
 	       )
     }
 }

--------------090008060607010208040805--


From Robert.McGehee at geodecapital.com  Mon Jul 31 17:56:39 2006
From: Robert.McGehee at geodecapital.com (Robert.McGehee at geodecapital.com)
Date: Mon, 31 Jul 2006 17:56:39 +0200 (CEST)
Subject: [Rd] Bug in title() crashes R (PR#9115)
Message-ID: <20060731155639.2353E3F03A@slim.kubism.ku.dk>

Hello,

The below reliably crashes R 2.3.1:
> plot.new()
> title(1:100000)
Process R segmentation fault (core dumped) ...

Also, R will crash when these vectors are much smaller, just not as
reliably.

I haven't tried this in on today's snapshot, but didn't see anything in
the changelog that seems to have addressed this.

HTH,
Robert

> R.version
               _                        =20
platform       i386-pc-mingw32          =20
arch           i386                     =20
os             mingw32                  =20
system         i386, mingw32            =20
status                                  =20
major          2                        =20
minor          3.1                      =20
year           2006                     =20
month          06                       =20
day            01                       =20
svn rev        38247                    =20
language       R                        =20
version.string Version 2.3.1 (2006-06-01)

Robert McGehee
Quantitative Analyst
Geode Capital Management, LLC
53 State Street, 5th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com



This e-mail, and any attachments hereto, are intended for us...{{dropped}}


From tshort at eprisolutions.com  Mon Jul 31 17:57:43 2006
From: tshort at eprisolutions.com (tshort)
Date: Mon, 31 Jul 2006 08:57:43 -0700 (PDT)
Subject: [Rd] Any interest in "merge" and "by" implementations
 specifically for so
In-Reply-To: <A37700AE-CA2E-42E9-B734-EEC0A7420569@sympatico.ca>
References: <07820D54-9DDC-42F7-8F32-C931B2B80DE6@sympatico.ca>
	<Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
	<5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
	<Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>
	<AAC5E1FB-71BB-46C8-9D51-A72DD25C735E@sympatico.ca>
	<207048BB-90DD-43DA-8FBC-D73544E6E3A8@sympatico.ca>
	<5562816.post@talk.nabble.com>
	<A37700AE-CA2E-42E9-B734-EEC0A7420569@sympatico.ca>
Message-ID: <5578580.post@talk.nabble.com>


> Hi Tom,
> 
> > Now, try sorting and using a loop:
> >
> >> idx <- order(i)
> >> xs <- x[idx]
> >> is <- i[idx]
> >> res <- array(NA, 1e6)
> >> idx <- which(diff(is) > 0)
> >> startidx <- c(1, idx+1)
> >> endidx <- c(idx, length(xs))
> >> f1 <- function(x, startidx, endidx, FUN = sum)  {
> > +   for (j in 1:length(res)) {
> > +     res[j] <- FUN(x[startidx[j]:endidx[j]])
> > +   }
> > +   res
> > + }
> >> unix.time(res1 <- f1(xs, startidx, endidx))
> > [1] 6.86 0.00 7.04   NA   NA
> 
> I wonder how much time the sorting, reordering and creation os  
> startidx and endidx would add to this time?

Done interactively, sorting and indexing seemed fast. Here are some timings:

> unix.time({idx <- order(i)
+            xs <- x[idx]
+            is <- i[idx]
+            res <- array(NA, 1e6)
+            idx <- which(diff(is) > 0)
+            startidx <- c(1, idx+1)
+            endidx <- c(idx, length(xs))
+          })
[1] 1.06 0.00 1.09   NA   NA


> That looks interesting.  Does it only work for specific operating  
> systems and processors?  I will give it a try.

No, as far as I know, it works on all operating systems. Also, it gets a
little faster if you directly put the sum in the function:

> f4 <- function(x, startidx, endidx)  {
+   for (j in 1:length(res)) {
+     res[j] <- sum(x[startidx[j]:endidx[j]])
+   }
+   res
+ }
> f5 <- cmpfun(f4)
> unix.time(res5 <- f5(xs, startidx, endidx))
[1] 2.67 0.03 2.95   NA   NA

- Tom


-- 
View this message in context: http://www.nabble.com/Any-interest-in-%22merge%22-and-%22by%22-implementations-specifically-for-sorted-data--tf2009595.html#a5578580
Sent from the R devel forum at Nabble.com.


From mkimpel at iupui.edu  Mon Jul 31 18:52:31 2006
From: mkimpel at iupui.edu (Kimpel, Mark William)
Date: Mon, 31 Jul 2006 12:52:31 -0400
Subject: [Rd] lazyLoadDBfetch error
Message-ID: <836F00680EECD340A96AD34ECFF3B5343CBFCE@iu-mssg-mbx106.ads.iu.edu>


I am getting the following output when I try to load R package gmodels under R-devel. This does not occur in R 2.3.1. In searching the R archives it appears that this message regarding lazyLoadDBfetch should not be occurring in recent R releases.

I have redownloaded R-devel and gmodels and the problem persists.

Ideas?

Thanks,

Mark

> require(gmodels)
Loading required package: gmodels
Error in lazyLoadDBfetch(key, datafile, compressed, envhook) : 
        internal error in R_decompress1
[1] FALSE

sessionInfo()

R version 2.4.0 Under development (unstable) (2006-06-15 r38348) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] "splines"   "tools"     "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"  "base"     

other attached packages:
    gtools      gdata    GOstats   Category   hgu95av2       KEGG   multtest     xtable       RBGL   annotate         GO      graph      Ruuid      limma 
   "2.2.3"    "2.1.2"    "1.6.0"    "1.4.1"   "1.10.0"    "1.8.1"    "1.9.5"    "1.3-2"    "1.8.1"   "1.10.0"    "1.6.5"   "1.11.9"   "1.10.0"    "2.7.5" 
genefilter   survival     rgu34a       affy     affyio    Biobase    RWinEdt 
  "1.10.1"     "2.26"   "1.12.0"   "1.10.0"    "1.1.3"   "1.10.0"    "1.7-4"

Mark W. Kimpel MD 

?
Official Business Address:
?
Department of Psychiatry
Indiana University School of Medicine
PR M116
Institute of Psychiatric Research
791 Union Drive
Indianapolis, IN 46202
?
Preferred Mailing Address:
?
15032 Hunter Court
Westfield, IN? 46074
?
(317) 490-5129 Work, & Mobile
?
(317) 663-0513 Home (no voice mail please)
1-(317)-536-2730 FAX


From rgentlem at fhcrc.org  Mon Jul 31 18:45:30 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Mon, 31 Jul 2006 09:45:30 -0700
Subject: [Rd] [R] HTTP User-Agent header
In-Reply-To: <m2bqr7dunr.fsf@ziti.fhcrc.org>
References: <88a2333a0607280656r7f5b6e64ve6d03dd215433df2@mail.gmail.com>	<Pine.LNX.4.64.0607281538020.20596@gannet.stats.ox.ac.uk>	<m2u051k7c7.fsf@ziti.fhcrc.org>	<88a2333a0607281022i825d415l2840e47697a859fa@mail.gmail.com>	<44CA61A0.7090804@fhcrc.org>	<59d7961d0607281240j612ed4b5h2e67ae8fe838b52d@mail.gmail.com>	<44CA6AFB.4040207@fhcrc.org>
	<m2bqr7dunr.fsf@ziti.fhcrc.org>
Message-ID: <44CE33AA.4090808@fhcrc.org>

should appear at an R-devel near you...
thanks Seth


Seth Falcon wrote:
> Robert Gentleman <rgentlem at fhcrc.org> writes:
>> OK, that suggests setting at the options level would solve both of your 
>> problems and that seems like the best approach. I don't really want to 
>> pass this around as a parameter through the maze of functions that might 
>> actually download something if we don't have to.
> 
> I have an updated patch that adds an HTTPUserAgent option.  The
> default is a string like:
> 
>     R (2.4.0 x86_64-unknown-linux-gnu x86_64 linux-gnu)
> 
> If the HTTPUserAgent option is NULL, no user agent header is added to
> HTTP requests (this is the current behavior).  This option allows R to
> use an arbitrary user agent header.
> 
> The patch adds two non-exported functions to utils: 
>    1) defaultUserAgent - returns a string like above
>    2) makeUserAgent - formats content of HTTPUserAgent option for use
>       as part of an HTTP request header.
> 
> I've tested on OSX and Linux, but not on Windows.  When USE_WININET is
> defined, a user agent string of "R" was already being used.  With this
> patch, the HTTPUserAgent options is used.  I'm unsure if NULL is
> allowed.
> 
> Also, in src/main/internet.c there is a comment:
>   "Next 6 are for use by libxml, only"
> and then a definition for R_HTTPOpen.  Not sure how/when these get
> used.  The user agent for these calls remains unspecified with this
> patch.
> 
> + seth
> 
> 
> Patch summary:
>  src/include/R_ext/R-ftp-http.h   |    2 +-
>  src/include/Rmodules/Rinternet.h |    2 +-
>  src/library/base/man/options.Rd  |    5 +++++
>  src/library/utils/R/readhttp.R   |   25 +++++++++++++++++++++++++
>  src/library/utils/R/zzz.R        |    3 ++-
>  src/main/internet.c              |    2 +-
>  src/modules/internet/internet.c  |   37 +++++++++++++++++++++++++------------
>  src/modules/internet/nanohttp.c  |    8 ++++++--
>  8 files changed, 66 insertions(+), 18 deletions(-)
> 
> 
> 
> Index: src/include/R_ext/R-ftp-http.h
> ===================================================================
> --- src/include/R_ext/R-ftp-http.h	(revision 38715)
> +++ src/include/R_ext/R-ftp-http.h	(working copy)
> @@ -36,7 +36,7 @@
>  int   R_FTPRead(void *ctx, char *dest, int len);
>  void  R_FTPClose(void *ctx);
>  
> -void *	RxmlNanoHTTPOpen(const char *URL, char **contentType, int cacheOK);
> +void *	RxmlNanoHTTPOpen(const char *URL, char **contentType, const char *headers, int cacheOK);
>  int	RxmlNanoHTTPRead(void *ctx, void *dest, int len);
>  void	RxmlNanoHTTPClose(void *ctx);
>  int 	RxmlNanoHTTPReturnCode(void *ctx);
> Index: src/include/Rmodules/Rinternet.h
> ===================================================================
> --- src/include/Rmodules/Rinternet.h	(revision 38715)
> +++ src/include/Rmodules/Rinternet.h	(working copy)
> @@ -9,7 +9,7 @@
>  typedef Rconnection (*R_NewUrlRoutine)(char *description, char *mode);
>  typedef Rconnection (*R_NewSockRoutine)(char *host, int port, int server, char *mode); 
>  
> -typedef void * (*R_HTTPOpenRoutine)(const char *url, const int cacheOK);
> +typedef void * (*R_HTTPOpenRoutine)(const char *url, const char *headers, const int cacheOK);
>  typedef int    (*R_HTTPReadRoutine)(void *ctx, char *dest, int len);
>  typedef void   (*R_HTTPCloseRoutine)(void *ctx);
>  	      
> Index: src/main/internet.c
> ===================================================================
> --- src/main/internet.c	(revision 38715)
> +++ src/main/internet.c	(working copy)
> @@ -129,7 +129,7 @@
>  {
>      if(!initialized) internet_Init();
>      if(initialized > 0)
> -	return (*ptr->HTTPOpen)(url, 0);
> +	return (*ptr->HTTPOpen)(url, NULL, 0);
>      else {
>  	error(_("internet routines cannot be loaded"));
>  	return NULL;
> Index: src/library/utils/R/zzz.R
> ===================================================================
> --- src/library/utils/R/zzz.R	(revision 38715)
> +++ src/library/utils/R/zzz.R	(working copy)
> @@ -9,7 +9,8 @@
>               internet.info = 2,
>               pkgType = .Platform$pkgType,
>               str = list(strict.width = "no"),
> -             example.ask = "default")
> +             example.ask = "default",
> +             HTTPUserAgent = defaultUserAgent())
>      extra <-
>          if(.Platform$OS.type == "windows") {
>              list(mailer = "none",
> Index: src/library/utils/R/readhttp.R
> ===================================================================
> --- src/library/utils/R/readhttp.R	(revision 38715)
> +++ src/library/utils/R/readhttp.R	(working copy)
> @@ -6,3 +6,28 @@
>          stop("transfer failure")
>      file.show(file, delete.file = delete.file, title = title, ...)
>  }
> +
> +
> +
> +defaultUserAgent <- function()
> +{
> +    Rver <- paste(R.version$major, R.version$minor, sep=".")
> +    Rdetails <- paste(Rver, R.version$platform, R.version$arch,
> +                      R.version$os)
> +    paste("R (", Rdetails, ")", sep="")
> +}
> +
> +
> +makeUserAgent <- function(format = TRUE) {
> +    agent <- getOption("HTTPUserAgent")
> +    if (is.null(agent)) {
> +        return(NULL)
> +    }
> +    if (length(agent) != 1)
> +      stop(sQuote("HTTPUserAgent"),
> +           " option must be a length one character vector or NULL")
> +    if (format)
> +      paste("User-Agent: ", agent[1], "\r\n", sep = "")
> +    else
> +      agent[1]
> +}
> Index: src/library/base/man/options.Rd
> ===================================================================
> --- src/library/base/man/options.Rd	(revision 38715)
> +++ src/library/base/man/options.Rd	(working copy)
> @@ -368,6 +368,11 @@
>      \item{\code{help.try.all.packages}:}{default for an argument of
>        \code{\link{help}}.}
>  
> +    \item{\code{HTTPUserAgent}:}{string used as the user agent in HTTP
> +      requests.  If \code{NULL}, HTTP requests will be made without a
> +      user agent header.  The default is \code{R (<version> <platform>
> +      <arch> <os>)}}
> +
>      \item{\code{internet.info}:}{The minimum level of information to be
>        printed on URL downloads etc.  Default is 2, for failure causes.
>        Set to 1 or 0 to get more information.}
> Index: src/modules/internet/internet.c
> ===================================================================
> --- src/modules/internet/internet.c	(revision 38715)
> +++ src/modules/internet/internet.c	(working copy)
> @@ -28,7 +28,7 @@
>  #include <Rconnections.h>
>  #include <R_ext/R-ftp-http.h>
>  
> -static void *in_R_HTTPOpen(const char *url, const int cacheOK);
> +static void *in_R_HTTPOpen(const char *url, const char *headers, const int cacheOK);
>  static int   in_R_HTTPRead(void *ctx, char *dest, int len);
>  static void  in_R_HTTPClose(void *ctx);
>  
> @@ -70,7 +70,7 @@
>  
>      switch(type) {
>      case HTTPsh:
> -	ctxt = in_R_HTTPOpen(url, 0);
> +	ctxt = in_R_HTTPOpen(url, NULL, 0);
>  	if(ctxt == NULL) {
>  	  /* if we call error() we get a connection leak*/
>  	  /* so do_url has to raise the error*/
> @@ -238,14 +238,14 @@
>  }
>  #endif
>  
> -/* download(url, destfile, quiet, mode, cacheOK) */
> +/* download(url, destfile, quiet, mode, headers, cacheOK) */
>  
>  #define CPBUFSIZE 65536
>  #define IBUFSIZE 4096
>  static SEXP in_do_download(SEXP call, SEXP op, SEXP args, SEXP env)
>  {
> -    SEXP ans, scmd, sfile, smode;
> -    char *url, *file, *mode;
> +    SEXP ans, scmd, sfile, smode, sheaders, agentFun;
> +    char *url, *file, *mode, *headers;
>      int quiet, status = 0, cacheOK;
>  
>      checkArity(op, args);
> @@ -271,6 +271,17 @@
>      cacheOK = asLogical(CAR(args));
>      if(cacheOK == NA_LOGICAL)
>  	error(_("invalid '%s' argument"), "cacheOK");
> +#ifdef USE_WININET
> +    PROTECT(agentFun = lang2(install("makeUserAgent"), ScalarLogical(0)));
> +#else
> +    PROTECT(agentFun = lang1(install("makeUserAgent")));
> +#endif
> +    PROTECT(sheaders = eval(agentFun, R_FindNamespace(mkString("utils"))));
> +    UNPROTECT(1);
> +    if(TYPEOF(sheaders) == NILSXP)
> +        headers = NULL;
> +    else 
> +        headers = CHAR(STRING_ELT(sheaders, 0));
>  #ifdef Win32
>      if (!pbar.wprog) {
>  	pbar.wprog = newwindow(_("Download progress"), rect(0, 0, 540, 100),
> @@ -319,7 +330,7 @@
>  #ifdef Win32
>  	R_FlushConsole();
>  #endif
> -	ctxt = in_R_HTTPOpen(url, cacheOK);
> +	ctxt = in_R_HTTPOpen(url, headers, cacheOK);
>  	if(ctxt == NULL) status = 1;
>  	else {
>  	    if(!quiet) REprintf(_("opened URL\n"), url);
> @@ -466,14 +477,14 @@
>  
>      PROTECT(ans = allocVector(INTSXP, 1));
>      INTEGER(ans)[0] = status;
> -    UNPROTECT(1);
> +    UNPROTECT(2);
>      return ans;
>  }
>  
>  
>  #if defined(SUPPORT_LIBXML) && !defined(USE_WININET)
>  
> -void *in_R_HTTPOpen(const char *url, int cacheOK)
> +void *in_R_HTTPOpen(const char *url, const char *headers, const int cacheOK)
>  {
>      inetconn *con;
>      void *ctxt;
> @@ -484,7 +495,7 @@
>      if(timeout == NA_INTEGER || timeout <= 0) timeout = 60;
>  
>      RxmlNanoHTTPTimeout(timeout);
> -    ctxt = RxmlNanoHTTPOpen(url, NULL, cacheOK);
> +    ctxt = RxmlNanoHTTPOpen(url, NULL, headers, cacheOK);
>      if(ctxt != NULL) {
>  	int rc = RxmlNanoHTTPReturnCode(ctxt);
>  	if(rc != 200) {
> @@ -605,7 +616,8 @@
>  }
>  #endif /* USE_WININET_ASYNC */
>  
> -static void *in_R_HTTPOpen(const char *url, const int cacheOK)
> +static void *in_R_HTTPOpen(const char *url, const char *headers, 
> +                           const int cacheOK)
>  {
>      WIctxt  wictxt;
>      DWORD status, d1 = 4, d2 = 0, d3 = 100;
> @@ -622,7 +634,7 @@
>      wictxt->length = -1;
>      wictxt->type = NULL;
>      wictxt->hand =
> -	InternetOpen("R", INTERNET_OPEN_TYPE_PRECONFIG, NULL, NULL,
> +	InternetOpen(headers, INTERNET_OPEN_TYPE_PRECONFIG, NULL, NULL,
>  #ifdef USE_WININET_ASYNC
>  		     INTERNET_FLAG_ASYNC
>  #else
> @@ -870,7 +882,8 @@
>  #endif
>  
>  #ifndef HAVE_INTERNET
> -static void *in_R_HTTPOpen(const char *url, const int cacheOK)
> +static void *in_R_HTTPOpen(const char *url, const char *headers, 
> +                           const int cacheOK)
>  {
>      return NULL;
>  }
> Index: src/modules/internet/nanohttp.c
> ===================================================================
> --- src/modules/internet/nanohttp.c	(revision 38715)
> +++ src/modules/internet/nanohttp.c	(working copy)
> @@ -1034,6 +1034,9 @@
>   * @contentType:  if available the Content-Type information will be
>   *                returned at that location
>   *
> + * @headers: headers to be used in the HTTP request.  These must be name/value
> + *           pairs separated by ':', each on their own line.
> + *
>   * This function try to open a connection to the indicated resource
>   * via HTTP GET.
>   *
> @@ -1042,10 +1045,11 @@
>   */
>  
>  void*
> -RxmlNanoHTTPOpen(const char *URL, char **contentType, int cacheOK)
> +RxmlNanoHTTPOpen(const char *URL, char **contentType, const char *headers,
> +                 int cacheOK)
>  {
>      if (contentType != NULL) *contentType = NULL;
> -    return RxmlNanoHTTPMethod(URL, NULL, NULL, contentType, NULL, cacheOK);
> +    return RxmlNanoHTTPMethod(URL, NULL, NULL, contentType, headers, cacheOK);
>  }
>  
>  /**
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From hin-tak.leung at cimr.cam.ac.uk  Mon Jul 31 22:34:15 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 31 Jul 2006 21:34:15 +0100
Subject: [Rd] building windows packages under wine/linux and cross-compiling.
Message-ID: <44CE6947.7000007@cimr.cam.ac.uk>

Had some fun today, and thought it might be a good idea to share
and possibly for inclusion to R/src/gnuwin32/README.packages .

Wine/linux : while R, ActiveState Perl, mingw all works alright under 
wine, the blocking issue is Rtool's cygwin dependency. forking
(as much of make and sh is forking sub-processes)
on posix-on-win32-on-posix currently doesn't work.
(http://wiki.winehq.org/CygwinSupport)

Cross-compiling: The instruction in R/src/gnuwin32/README.packages 
essentially works, with one missing detail: "R_EXE=/usr/bin/R" is also 
needed. Thus it should be:

     make R_EXE=/usr/bin/R PKGDIR=/mysources RLIB=/R/win/library \
             pkg-mypkg
     make P_EXE=/usr/bin/R KGDIR=/mysources RLIB=/R/win/library \
             pkgcheck-mypkg

Hin-Tak Leung


From ripley at stats.ox.ac.uk  Mon Jul 31 23:09:28 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 31 Jul 2006 22:09:28 +0100 (BST)
Subject: [Rd] building windows packages under wine/linux and
	cross-compiling.
In-Reply-To: <44CE6947.7000007@cimr.cam.ac.uk>
References: <44CE6947.7000007@cimr.cam.ac.uk>
Message-ID: <Pine.LNX.4.64.0607312200010.7529@gannet.stats.ox.ac.uk>

On Mon, 31 Jul 2006, Hin-Tak Leung wrote:

> Had some fun today, and thought it might be a good idea to share
> and possibly for inclusion to R/src/gnuwin32/README.packages .

[...]

> Cross-compiling: The instruction in R/src/gnuwin32/README.packages 
> essentially works, with one missing detail: "R_EXE=/usr/bin/R" is also 
> needed. Thus it should be:
> 
>      make R_EXE=/usr/bin/R PKGDIR=/mysources RLIB=/R/win/library \
>              pkg-mypkg
>      make P_EXE=/usr/bin/R KGDIR=/mysources RLIB=/R/win/library \
>              pkgcheck-mypkg

The instructions do work for those who actually follow them! That file 
says

  Edit MkRules to set BUILD=CROSS and the appropriate paths (including
  HEADER) as needed.

and the appropriate section of that file is

## =================== cross-compilation settings  =================

ifeq ($(strip $(BUILD)),CROSS)
# Next might be mingw32- or i386-mingw32msvc- or i586-
# depending on the cross-compiler.
BINPREF=i586-mingw32-
# Set this to where the mingw32 include files are. It must be accurate.
HEADER=/users/ripley/R/cross-tools5/i586-mingw32/include
endif
# path (possibly full path) to same version of R on the host system
# R_EXE=R

and please do note the last two lines.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kevin.hendricks at sympatico.ca  Mon Jul 31 23:19:52 2006
From: kevin.hendricks at sympatico.ca (Kevin B. Hendricks)
Date: Mon, 31 Jul 2006 17:19:52 -0400
Subject: [Rd] Any interest in "merge" and "by" implementations
	specifically for sorted data?
In-Reply-To: <Pine.LNX.4.64.0607310716250.32031@homer23.u.washington.edu>
References: <Pine.GSO.4.31.0607280805550.24504-100000@markov.stats>
	<FFDE23C5-EA11-4E16-B372-012DB00BD589@sympatico.ca>
	<971536df0607281112j43c4ffc0s96d3b4743b93b690@mail.gmail.com>
	<D5EA9DD0-BFC7-45A6-A541-65E8A9E8192C@sympatico.ca>
	<Pine.GSO.4.56.0607281229290.28145@durian.statsci.com>
	<5A40DD7D-3BF4-4451-AC91-9B121BE9901F@sympatico.ca>
	<Pine.GSO.4.56.0607281725120.28145@durian.statsci.com>
	<AAC5E1FB-71BB-46C8-9D51-A72DD25C735E@sympatico.ca>
	<Pine.LNX.4.64.0607310716250.32031@homer23.u.washington.edu>
Message-ID: <83B4A6AC-520E-45C1-AE0B-C875DDDE1F1C@sympatico.ca>

Hi Thomas,

Here is a comparison of performance times from my own igroupSums  
versus using split and rowsum:

 > x <- rnorm(2e6)
 > i <- rep(1:1e6,2)
 >
 > unix.time(suma <- unlist(lapply(split(x,i),sum)))
[1] 8.188 0.076 8.263 0.000 0.000
 >
 > names(suma)<- NULL
 >
 > unix.time(sumb <- igroupSums(x,i))
[1] 0.036 0.000 0.035 0.000 0.000
 >
 > all.equal(suma, sumb)
[1] TRUE
 >
 > unix.time(sumc <- rowsum(x,i))
[1] 0.744 0.000 0.742 0.000 0.000
 >
 > sumc <- sumc[,1]
 > names(sumc)<-NULL
 > all.equal(suma,sumc)
[1] TRUE


So my implementation of igroupSums is faster and already handles NA.   
I also have implemented igroupMins, igroupMaxs, igroupAnys,  
igroupAlls, igroupCounts, igroupMeans, and igroupRanges.

The igroup functions I implemented do not handle weights yet but do  
handle NAs properly.

Assuming I clean them up, is anyone in the R developer group interested?

Or would you rather I instead extend the rowsum appropach to create  
rowcount, rowmax, rowmin, rowcount, etc using a hash function approach.

All of these approaches simply use differently ways to map group  
codes to integers and then do the functions the same.

Thanks,

Kevin


From Diana.Glaeser at mailbox.tu-dresden.de  Thu Jul 27 12:31:19 2006
From: Diana.Glaeser at mailbox.tu-dresden.de (Diana Glaeser)
Date: Thu, 27 Jul 2006 12:31:19 +0200
Subject: [Rd] Modiefied GJR & Time Varying Skewed-t
Message-ID: <1153996279.44c895f77e912@rmc60-231.urz.tu-dresden.de>

Hello,

I have to calculate some  GARCH models, especially I need to compute a GJR which
I need to modify (add another covariable and a dummy). In addition to this I
will use a Skewed Student?s - t, for which I have to model the kurtosis and the
skewness parameter as a function of the conditional time varying variance.
Hence, in this model there are two feedback mechanisms included. Can I when
programming modify the distribution function of the skewed t or is this a
predefined code? I?ve read on one of your websides, that you work on versions
of fSeries to be more flexible to compute other than standard Grach models.
Please can you answer this letter? It ist very important for me since I work on
my thesis.
Thanks a lot,
Diana


