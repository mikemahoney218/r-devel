From simon.urbanek at r-project.org  Fri Jan  1 18:20:07 2016
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 1 Jan 2016 12:20:07 -0500
Subject: [Rd] R,
	AIX 64-bit builds - trying to understand root cause for message:
	"Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <5685466E.7000804@gmail.com>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
Message-ID: <4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>

Michael,

thanks, I'll have a look once my PDP VMs are up again (later today). This may be a signedness issue although it's unclear why other platforms wouldn't be affected.

Cheers,
Simon


On Dec 31, 2015, at 10:14 AM, Michael Felt <aixtools at gmail.com> wrote:

> On 2015-12-30 09:58, Michael Felt wrote:
>> On 2015-12-29 11:02, Michael Felt wrote:
>>> This seems to be a problem that goes back a long time - and I hope someone who understands what tre is suppossed to be doing will look at this.
>>> 
>>> A short history of other people who have reported on this on different versions of AIX. I shall only add that I get the same results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>> 
>>> Basically, with settings that work for AIX and 32-bit - the only changes being
>>> -maix32 becomes -maix64
>>> and
>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>> 
>>> Then to shorten the 'make' bla bla, first run just make, then
>>> 
>>> cd src/library/tools
>>> make -s sysdata
>>> 
>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed 
>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed 
>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 hours and 30 minutes ago)
>>> 
>>> To that, to get debug data, I have
>>> 
>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>> * rm src/extra/tre/tre-match-parallel.o
>>> * find . -name \*.so -exec rm {} \;
>>> * make
>>> * cd src/library/tools
>>> * make -s sysdata
>>> 
>>> Attached are the two script files of the screen output. The 32-bit one is more verbose - and contains magically lines such as:
>>>   found match 3037fd14 (while "found" does not occur in the 64-bit output)
>>> 
>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc /tmp/sysdata.??.*
>>>     4730   14123  139916 /tmp/sysdata.32.text
>>>     1312    3688   40528 /tmp/sysdata.64.text
>>>     6042   17811  180444 total
>>> 
>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep -c found /tmp/sysdata.??.*
>>> /tmp/sysdata.32.text:19
>>> /tmp/sysdata.64.text:0
>>> 
>>> 
>>> Hope this brings us (or me), closer to a resolution to an old concern.
>>> 
>>> And, best wishes for the new year!
>>> 
>>> Michael
>>> 
>>> 
>> Still hoping for someones curiosity/willingness.
>> 
>> The differences show up in the first comparision that is made (of the string "3.2.3" it seems) - 32-bit is on the left, 64-bit on the right.
>> 
>> Script command is started on Tue Dec 29 08:39:16 UTC 2015.                     |  Script command is started on Tue Dec 29 08:39:56 UTC 2015.
>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make -s sysdata     |  root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make -s sysdata
>> installing 'sysdata.rda'                                                       |  installing 'sysdata.rda'
>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>> length: -1                                                                     |  length: -1
>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>> init > 30380200 3038014c 30380098                                             |   init > 110cc3040 110cc2f28 110cc2e10
>> match end offset = -1                                                          |  match end offset = -1
>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>> length: -1                                                                     |  length: -1
>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>> init > 3037fb88                                                               |   init > 110cc3310
>>  0: 3/00051 | 3037fb88/0:0                                                    |    0: 3/00051 | 110cc3310/0:0
>>  1: ./00046 | 3037fb88/0:0                                                    |    1: ./00046 | 110cc3310/0:0
>> init > 3037fb88                                                               |   init > 110cc3310
>>  1: ./00046 | 3037fb88/0:1                                                    |    1: ./00046 | 110cc3310/0:1
>>  2: 2/00050 | 3037fb88/0:1                                                    |    2: 2/00050 | 110cc3310/0:1
>> assertion failed                                                               |  assertion failed
>> init > 3037fb88                                                               |   init > 110cc3310
>>  2: 2/00050 | 3037fc18/0:1 3037fb88/0:2                                       |    2: 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>  3: ./00046 | 3037fc18/0:1 3037fb88/0:2                                       |    3: ./00046 | 110cc33f0/0:1 110cc3310/0:2
>> assertion failed                           *** DIFFERENCE ***                  |   init > 110cc3310
>> init > 3037fb88                                                               |    3: ./00046 | 110cc3310/0:3
>>  3: ./00046 | 3037fc18/0:1 3037fb88/0:3                                       |    4: 3/00051 | 110cc3310/0:3
>>  4: 3/00051 | 3037fc18/0:1 3037fb88/0:3                                       |  assertion failed
>> assertion failed                                                               |   init > 110cc3310
>> init > 3037fb88                                                               |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>  4: 3/00051 | 3037fc18/0:3 3037fb88/0:4                                       |    5: /00000 | 110cc33f0/0:3 110cc3310/0:4
>>  5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init > 110cc3310
>>  found match 3037fd14 *** DIFFERENCE ***                   |  match end offset = -1
>> match end offset = 5 *** DIFFERENCE ***                   |  tre_tnfa_run_parallel, input type 1
>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>> length: -1                                                                     |  pos:chr/code | states and tags
>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>> -------------+------------------------------------------------                 |   init > 110cc4780 110cc4668 110cc4550
>> init > 303811c0 3038110c 30381058                                             |  match end offset = -1
>> match end offset = -1                                                          |  tre_tnfa_run_parallel, input type 1
>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>> length: -1                                                                     |  pos:chr/code | states and tags
>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>> -------------+------------------------------------------------                 |   init > 110cc5700 110cc55e8 110cc54d0
>> 
> One day further - looks like tre_compile (or just before, after all).
> 
> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see (snip)
> 
> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
> @@ -1,5 +1,5 @@
> - Script command is started on Thu Dec 31 15:04:39 2015.
> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make sysdata
> + Script command is started on Thu Dec 31 15:08:43 2015.
> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make sysdata
>  installing 'sysdata.rda'
>  echo "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" | \
>    R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
> @@ -167,7 +167,7 @@
>  initial: 1/1,0, assert 0
>  initial: 0/0, assert 0
>  initial: 0/0, assert 0
> - final state 30370718
> + final state 110cba530
>  tre_compile: parsing '(^|[^%])(%%)*%V'
>  AST:
>  catenation, sub 0, 0 tags
> @@ -177,7 +177,7 @@
>          assertions: bol
>          union, sub -1, 0 tags
>            literal (, $) (0, 36), pos 0, sub -1, 0 tags
> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>        iteration {0, -1}, sub -1, 0 tags, greedy
>          catenation, sub 2, 0 tags
>            literal (%, %) (37, 37), pos 1, sub -1, 0 tags
> @@ -197,7 +197,7 @@
>  Union
>  Literal 0-36
>  After union left
> - Literal 38-65535
> + Literal 38--1
>  After union right
>  After union right
>    num_tags += 2
> @@ -231,7 +231,7 @@
>          assertions: bol
>          union, sub -1, 0 tags
>            literal (, $) (0, 36), pos 0, sub -1, 0 tags
> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>        iteration {0, -1}, sub -1, 2 tags, greedy
>          catenation, sub 2, 1 tags
>            literal (%, %) (37, 37), pos 1, sub -1, 1 tags
> @@ -255,7 +255,7 @@
>  Union
>  Literal 0-36
>  After union left
> - Literal 38-65535
> + Literal 38--1
>  After union right
>  After union right
>  tre_add_tag_right: tag 3
> @@ -342,7 +342,7 @@
>            catenation, sub -1, 0 tags
>              union, sub -1, 0 tags
>                literal (, $) (0, 36), pos 0, sub -1, 0 tags
> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>              tag 4
> 
> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 64-bit mode.
> 
> I suspect I will "find it" - but a proposed change is appreciated.
> 
> Happy New Year,
> Michael
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From simon.urbanek at r-project.org  Fri Jan  1 22:06:37 2016
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 1 Jan 2016 16:06:37 -0500
Subject: [Rd] R,
	AIX 64-bit builds - trying to understand root cause for message:
	"Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
Message-ID: <F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>

Ok, found the problem - on platforms that support it TRE uses wint_t (from wchar.h) as its type for characters (tre_cint_t) which on AIX is *signed* int. TRE uses liberally conversions between int and tre_cint_t apparently assuming that the latter is unsigned so conversions back to int are suitable for comparisons etc. On other platforms wint_t is unsigned so it works. Manually defining tre_cint_t to unsigned int fixes the issue.

Cheers,
Simon


On Jan 1, 2016, at 12:20 PM, Simon Urbanek <simon.urbanek at r-project.org> wrote:

> Michael,
> 
> thanks, I'll have a look once my PDP VMs are up again (later today). This may be a signedness issue although it's unclear why other platforms wouldn't be affected.
> 
> Cheers,
> Simon
> 
> 
> On Dec 31, 2015, at 10:14 AM, Michael Felt <aixtools at gmail.com> wrote:
> 
>> On 2015-12-30 09:58, Michael Felt wrote:
>>> On 2015-12-29 11:02, Michael Felt wrote:
>>>> This seems to be a problem that goes back a long time - and I hope someone who understands what tre is suppossed to be doing will look at this.
>>>> 
>>>> A short history of other people who have reported on this on different versions of AIX. I shall only add that I get the same results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>>> 
>>>> Basically, with settings that work for AIX and 32-bit - the only changes being
>>>> -maix32 becomes -maix64
>>>> and
>>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>>> 
>>>> Then to shorten the 'make' bla bla, first run just make, then
>>>> 
>>>> cd src/library/tools
>>>> make -s sysdata
>>>> 
>>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed 
>>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed 
>>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 hours and 30 minutes ago)
>>>> 
>>>> To that, to get debug data, I have
>>>> 
>>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>>> * rm src/extra/tre/tre-match-parallel.o
>>>> * find . -name \*.so -exec rm {} \;
>>>> * make
>>>> * cd src/library/tools
>>>> * make -s sysdata
>>>> 
>>>> Attached are the two script files of the screen output. The 32-bit one is more verbose - and contains magically lines such as:
>>>>  found match 3037fd14 (while "found" does not occur in the 64-bit output)
>>>> 
>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc /tmp/sysdata.??.*
>>>>    4730   14123  139916 /tmp/sysdata.32.text
>>>>    1312    3688   40528 /tmp/sysdata.64.text
>>>>    6042   17811  180444 total
>>>> 
>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep -c found /tmp/sysdata.??.*
>>>> /tmp/sysdata.32.text:19
>>>> /tmp/sysdata.64.text:0
>>>> 
>>>> 
>>>> Hope this brings us (or me), closer to a resolution to an old concern.
>>>> 
>>>> And, best wishes for the new year!
>>>> 
>>>> Michael
>>>> 
>>>> 
>>> Still hoping for someones curiosity/willingness.
>>> 
>>> The differences show up in the first comparision that is made (of the string "3.2.3" it seems) - 32-bit is on the left, 64-bit on the right.
>>> 
>>> Script command is started on Tue Dec 29 08:39:16 UTC 2015.                     |  Script command is started on Tue Dec 29 08:39:56 UTC 2015.
>>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make -s sysdata     |  root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make -s sysdata
>>> installing 'sysdata.rda'                                                       |  installing 'sysdata.rda'
>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>> length: -1                                                                     |  length: -1
>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>> init > 30380200 3038014c 30380098                                             |   init > 110cc3040 110cc2f28 110cc2e10
>>> match end offset = -1                                                          |  match end offset = -1
>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>> length: -1                                                                     |  length: -1
>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>> init > 3037fb88                                                               |   init > 110cc3310
>>> 0: 3/00051 | 3037fb88/0:0                                                    |    0: 3/00051 | 110cc3310/0:0
>>> 1: ./00046 | 3037fb88/0:0                                                    |    1: ./00046 | 110cc3310/0:0
>>> init > 3037fb88                                                               |   init > 110cc3310
>>> 1: ./00046 | 3037fb88/0:1                                                    |    1: ./00046 | 110cc3310/0:1
>>> 2: 2/00050 | 3037fb88/0:1                                                    |    2: 2/00050 | 110cc3310/0:1
>>> assertion failed                                                               |  assertion failed
>>> init > 3037fb88                                                               |   init > 110cc3310
>>> 2: 2/00050 | 3037fc18/0:1 3037fb88/0:2                                       |    2: 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:2                                       |    3: ./00046 | 110cc33f0/0:1 110cc3310/0:2
>>> assertion failed                           *** DIFFERENCE ***                  |   init > 110cc3310
>>> init > 3037fb88                                                               |    3: ./00046 | 110cc3310/0:3
>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:3                                       |    4: 3/00051 | 110cc3310/0:3
>>> 4: 3/00051 | 3037fc18/0:1 3037fb88/0:3                                       |  assertion failed
>>> assertion failed                                                               |   init > 110cc3310
>>> init > 3037fb88                                                               |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>> 4: 3/00051 | 3037fc18/0:3 3037fb88/0:4                                       |    5: /00000 | 110cc33f0/0:3 110cc3310/0:4
>>> 5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init > 110cc3310
>>> found match 3037fd14 *** DIFFERENCE ***                   |  match end offset = -1
>>> match end offset = 5 *** DIFFERENCE ***                   |  tre_tnfa_run_parallel, input type 1
>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>> length: -1                                                                     |  pos:chr/code | states and tags
>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>> -------------+------------------------------------------------                 |   init > 110cc4780 110cc4668 110cc4550
>>> init > 303811c0 3038110c 30381058                                             |  match end offset = -1
>>> match end offset = -1                                                          |  tre_tnfa_run_parallel, input type 1
>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>> length: -1                                                                     |  pos:chr/code | states and tags
>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>> -------------+------------------------------------------------                 |   init > 110cc5700 110cc55e8 110cc54d0
>>> 
>> One day further - looks like tre_compile (or just before, after all).
>> 
>> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see (snip)
>> 
>> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
>> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
>> @@ -1,5 +1,5 @@
>> - Script command is started on Thu Dec 31 15:04:39 2015.
>> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make sysdata
>> + Script command is started on Thu Dec 31 15:08:43 2015.
>> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make sysdata
>> installing 'sysdata.rda'
>> echo "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" | \
>>   R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
>> @@ -167,7 +167,7 @@
>> initial: 1/1,0, assert 0
>> initial: 0/0, assert 0
>> initial: 0/0, assert 0
>> - final state 30370718
>> + final state 110cba530
>> tre_compile: parsing '(^|[^%])(%%)*%V'
>> AST:
>> catenation, sub 0, 0 tags
>> @@ -177,7 +177,7 @@
>>         assertions: bol
>>         union, sub -1, 0 tags
>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>       iteration {0, -1}, sub -1, 0 tags, greedy
>>         catenation, sub 2, 0 tags
>>           literal (%, %) (37, 37), pos 1, sub -1, 0 tags
>> @@ -197,7 +197,7 @@
>> Union
>> Literal 0-36
>> After union left
>> - Literal 38-65535
>> + Literal 38--1
>> After union right
>> After union right
>>   num_tags += 2
>> @@ -231,7 +231,7 @@
>>         assertions: bol
>>         union, sub -1, 0 tags
>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>       iteration {0, -1}, sub -1, 2 tags, greedy
>>         catenation, sub 2, 1 tags
>>           literal (%, %) (37, 37), pos 1, sub -1, 1 tags
>> @@ -255,7 +255,7 @@
>> Union
>> Literal 0-36
>> After union left
>> - Literal 38-65535
>> + Literal 38--1
>> After union right
>> After union right
>> tre_add_tag_right: tag 3
>> @@ -342,7 +342,7 @@
>>           catenation, sub -1, 0 tags
>>             union, sub -1, 0 tags
>>               literal (, $) (0, 36), pos 0, sub -1, 0 tags
>> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>             tag 4
>> 
>> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 64-bit mode.
>> 
>> I suspect I will "find it" - but a proposed change is appreciated.
>> 
>> Happy New Year,
>> Michael
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From pdalgd at gmail.com  Fri Jan  1 23:48:09 2016
From: pdalgd at gmail.com (peter dalgaard)
Date: Fri, 1 Jan 2016 23:48:09 +0100
Subject: [Rd] R,
	AIX 64-bit builds - trying to understand root cause for message:
	"Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
Message-ID: <F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>

Nice catch you two!!!

Happy New Year
-pd

> On 01 Jan 2016, at 22:06 , Simon Urbanek <simon.urbanek at r-project.org> wrote:
> 
> Ok, found the problem - on platforms that support it TRE uses wint_t (from wchar.h) as its type for characters (tre_cint_t) which on AIX is *signed* int. TRE uses liberally conversions between int and tre_cint_t apparently assuming that the latter is unsigned so conversions back to int are suitable for comparisons etc. On other platforms wint_t is unsigned so it works. Manually defining tre_cint_t to unsigned int fixes the issue.
> 
> Cheers,
> Simon
> 
> 
> On Jan 1, 2016, at 12:20 PM, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> 
>> Michael,
>> 
>> thanks, I'll have a look once my PDP VMs are up again (later today). This may be a signedness issue although it's unclear why other platforms wouldn't be affected.
>> 
>> Cheers,
>> Simon
>> 
>> 
>> On Dec 31, 2015, at 10:14 AM, Michael Felt <aixtools at gmail.com> wrote:
>> 
>>> On 2015-12-30 09:58, Michael Felt wrote:
>>>> On 2015-12-29 11:02, Michael Felt wrote:
>>>>> This seems to be a problem that goes back a long time - and I hope someone who understands what tre is suppossed to be doing will look at this.
>>>>> 
>>>>> A short history of other people who have reported on this on different versions of AIX. I shall only add that I get the same results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>>>> 
>>>>> Basically, with settings that work for AIX and 32-bit - the only changes being
>>>>> -maix32 becomes -maix64
>>>>> and
>>>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>>>> 
>>>>> Then to shorten the 'make' bla bla, first run just make, then
>>>>> 
>>>>> cd src/library/tools
>>>>> make -s sysdata
>>>>> 
>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed 
>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed 
>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 hours and 30 minutes ago)
>>>>> 
>>>>> To that, to get debug data, I have
>>>>> 
>>>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>>>> * rm src/extra/tre/tre-match-parallel.o
>>>>> * find . -name \*.so -exec rm {} \;
>>>>> * make
>>>>> * cd src/library/tools
>>>>> * make -s sysdata
>>>>> 
>>>>> Attached are the two script files of the screen output. The 32-bit one is more verbose - and contains magically lines such as:
>>>>> found match 3037fd14 (while "found" does not occur in the 64-bit output)
>>>>> 
>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc /tmp/sysdata.??.*
>>>>>   4730   14123  139916 /tmp/sysdata.32.text
>>>>>   1312    3688   40528 /tmp/sysdata.64.text
>>>>>   6042   17811  180444 total
>>>>> 
>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep -c found /tmp/sysdata.??.*
>>>>> /tmp/sysdata.32.text:19
>>>>> /tmp/sysdata.64.text:0
>>>>> 
>>>>> 
>>>>> Hope this brings us (or me), closer to a resolution to an old concern.
>>>>> 
>>>>> And, best wishes for the new year!
>>>>> 
>>>>> Michael
>>>>> 
>>>>> 
>>>> Still hoping for someones curiosity/willingness.
>>>> 
>>>> The differences show up in the first comparision that is made (of the string "3.2.3" it seems) - 32-bit is on the left, 64-bit on the right.
>>>> 
>>>> Script command is started on Tue Dec 29 08:39:16 UTC 2015.                     |  Script command is started on Tue Dec 29 08:39:56 UTC 2015.
>>>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make -s sysdata     |  root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make -s sysdata
>>>> installing 'sysdata.rda'                                                       |  installing 'sysdata.rda'
>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>> length: -1                                                                     |  length: -1
>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>> init > 30380200 3038014c 30380098                                             |   init > 110cc3040 110cc2f28 110cc2e10
>>>> match end offset = -1                                                          |  match end offset = -1
>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>> length: -1                                                                     |  length: -1
>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>> init > 3037fb88                                                               |   init > 110cc3310
>>>> 0: 3/00051 | 3037fb88/0:0                                                    |    0: 3/00051 | 110cc3310/0:0
>>>> 1: ./00046 | 3037fb88/0:0                                                    |    1: ./00046 | 110cc3310/0:0
>>>> init > 3037fb88                                                               |   init > 110cc3310
>>>> 1: ./00046 | 3037fb88/0:1                                                    |    1: ./00046 | 110cc3310/0:1
>>>> 2: 2/00050 | 3037fb88/0:1                                                    |    2: 2/00050 | 110cc3310/0:1
>>>> assertion failed                                                               |  assertion failed
>>>> init > 3037fb88                                                               |   init > 110cc3310
>>>> 2: 2/00050 | 3037fc18/0:1 3037fb88/0:2                                       |    2: 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:2                                       |    3: ./00046 | 110cc33f0/0:1 110cc3310/0:2
>>>> assertion failed                           *** DIFFERENCE ***                  |   init > 110cc3310
>>>> init > 3037fb88                                                               |    3: ./00046 | 110cc3310/0:3
>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:3                                       |    4: 3/00051 | 110cc3310/0:3
>>>> 4: 3/00051 | 3037fc18/0:1 3037fb88/0:3                                       |  assertion failed
>>>> assertion failed                                                               |   init > 110cc3310
>>>> init > 3037fb88                                                               |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>>> 4: 3/00051 | 3037fc18/0:3 3037fb88/0:4                                       |    5: /00000 | 110cc33f0/0:3 110cc3310/0:4
>>>> 5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init > 110cc3310
>>>> found match 3037fd14 *** DIFFERENCE ***                   |  match end offset = -1
>>>> match end offset = 5 *** DIFFERENCE ***                   |  tre_tnfa_run_parallel, input type 1
>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>> -------------+------------------------------------------------                 |   init > 110cc4780 110cc4668 110cc4550
>>>> init > 303811c0 3038110c 30381058                                             |  match end offset = -1
>>>> match end offset = -1                                                          |  tre_tnfa_run_parallel, input type 1
>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>> -------------+------------------------------------------------                 |   init > 110cc5700 110cc55e8 110cc54d0
>>>> 
>>> One day further - looks like tre_compile (or just before, after all).
>>> 
>>> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see (snip)
>>> 
>>> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
>>> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
>>> @@ -1,5 +1,5 @@
>>> - Script command is started on Thu Dec 31 15:04:39 2015.
>>> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make sysdata
>>> + Script command is started on Thu Dec 31 15:08:43 2015.
>>> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make sysdata
>>> installing 'sysdata.rda'
>>> echo "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" | \
>>>  R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
>>> @@ -167,7 +167,7 @@
>>> initial: 1/1,0, assert 0
>>> initial: 0/0, assert 0
>>> initial: 0/0, assert 0
>>> - final state 30370718
>>> + final state 110cba530
>>> tre_compile: parsing '(^|[^%])(%%)*%V'
>>> AST:
>>> catenation, sub 0, 0 tags
>>> @@ -177,7 +177,7 @@
>>>        assertions: bol
>>>        union, sub -1, 0 tags
>>>          literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>      iteration {0, -1}, sub -1, 0 tags, greedy
>>>        catenation, sub 2, 0 tags
>>>          literal (%, %) (37, 37), pos 1, sub -1, 0 tags
>>> @@ -197,7 +197,7 @@
>>> Union
>>> Literal 0-36
>>> After union left
>>> - Literal 38-65535
>>> + Literal 38--1
>>> After union right
>>> After union right
>>>  num_tags += 2
>>> @@ -231,7 +231,7 @@
>>>        assertions: bol
>>>        union, sub -1, 0 tags
>>>          literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>      iteration {0, -1}, sub -1, 2 tags, greedy
>>>        catenation, sub 2, 1 tags
>>>          literal (%, %) (37, 37), pos 1, sub -1, 1 tags
>>> @@ -255,7 +255,7 @@
>>> Union
>>> Literal 0-36
>>> After union left
>>> - Literal 38-65535
>>> + Literal 38--1
>>> After union right
>>> After union right
>>> tre_add_tag_right: tag 3
>>> @@ -342,7 +342,7 @@
>>>          catenation, sub -1, 0 tags
>>>            union, sub -1, 0 tags
>>>              literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>            tag 4
>>> 
>>> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 64-bit mode.
>>> 
>>> I suspect I will "find it" - but a proposed change is appreciated.
>>> 
>>> Happy New Year,
>>> Michael
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From dstr7320 at uni.sydney.edu.au  Sat Jan  2 02:00:14 2016
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Sat, 2 Jan 2016 01:00:14 +0000
Subject: [Rd] URW Fonts Description in Installation and Administration
 Manual
In-Reply-To: <87io3frqb4.fsf@gmail.com>
References: <SN1PR0101MB1439CEE17F9BA8237DD00B51CDFD0@SN1PR0101MB1439.prod.exchangelabs.com>
	<22147.50077.339178.776971@max.nulle.part> <87d1tn3gd2.fsf@gmail.com>
	<22148.14791.710622.471063@max.nulle.part>,<87io3frqb4.fsf@gmail.com>
Message-ID: <SN1PR0101MB1439EFE15715B7F017A11E57CDF00@SN1PR0101MB1439.prod.exchangelabs.com>

Good day,

They are also found by my search.

~$ apt-cache search urw | grep texlive
texlive-fonts-recommended - TeX Live: Recommended fonts
texlive-fonts-extra - TeX Live: Additional fonts
~$ lsb_release -a
No LSB modules are available.
Distributor ID: Debian
Description:    Debian GNU/Linux 8.2 (jessie)
Release:        8.2
Codename:       jessie

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia

From jeroen.ooms at stat.ucla.edu  Sat Jan  2 19:57:31 2016
From: jeroen.ooms at stat.ucla.edu (Jeroen Ooms)
Date: Sat, 2 Jan 2016 19:57:31 +0100
Subject: [Rd] Crash when reusing libcurl connection
Message-ID: <CABFfbXuyXhzf6tceOt8VmtZRiKbT6D_fGNK9602Xdzk6-MY3Og@mail.gmail.com>

Reusing a libcurl based url() connection can lead to a crash:

  con <- url("http://httpbin.org/get", method = "libcurl")
  readLines(con)
  readLines(con)
  readLines(con)

The problem does not appear for other url() implementations:

  con <- url("http://httpbin.org/get", method = "internal")
  readLines(con)
  readLines(con)

  con <- curl::curl("http://httpbin.org/get")
  readLines(con)
  readLines(con)

>From the internet/libcurl.c source code it looks like the free() calls
should be moved out of Curl_close() and into the destroy callback
(which is currently undefined?). Comments from Connections.h suggest
that the close callback should reset, but not destroy the connection
so that it can be recycled:

  void (*close)(struct Rconn *); /* routine closing after auto open */
  void (*destroy)(struct Rconn *); /* when closing connection */

The 'curl' package has a working example how to achieve this with libcurl.


From bmarwick at uw.edu  Sun Jan  3 10:03:20 2016
From: bmarwick at uw.edu (Ben Marwick)
Date: Sun, 3 Jan 2016 20:03:20 +1100
Subject: [Rd] Wrong bug ID & URL in Daily News about R-devel/NEWS
Message-ID: <5688E3D8.1060106@uw.edu>

I was browsing some recent R news at

http://developer.r-project.org/blosxom.cgi/R-devel/NEWS/2016/01/03#n2016-01-03

And reading this item:

"tapply() has been made considerably more efficient without changing
functionality, thanks to proposals from Peter Haverty and Suharto 
Anggono. (PR#16488)"

But I found that the link in the item goes to a page about the GUI, not 
tapply:

https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=16488

It should go to this page for the tapply speed-up:

https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=16640

This is probably just a simple typo, since a quick check of other links 
to bugs in the news showed they were all ok.

Anyway, I couldn't see any webmaster contact details on
http://developer.r-project.org/ so hopefully this list message will 
reach the right person.

Ben


From murdoch.duncan at gmail.com  Sun Jan  3 14:23:45 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 3 Jan 2016 08:23:45 -0500
Subject: [Rd] Wrong bug ID & URL in Daily News about R-devel/NEWS
In-Reply-To: <5688E3D8.1060106@uw.edu>
References: <5688E3D8.1060106@uw.edu>
Message-ID: <568920E1.90809@gmail.com>

On 03/01/2016 4:03 AM, Ben Marwick wrote:
> I was browsing some recent R news at
>
> http://developer.r-project.org/blosxom.cgi/R-devel/NEWS/2016/01/03#n2016-01-03
>
> And reading this item:
>
> "tapply() has been made considerably more efficient without changing
> functionality, thanks to proposals from Peter Haverty and Suharto
> Anggono. (PR#16488)"
>
> But I found that the link in the item goes to a page about the GUI, not
> tapply:
>
> https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=16488
>
> It should go to this page for the tapply speed-up:
>
> https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=16640
>
> This is probably just a simple typo, since a quick check of other links
> to bugs in the news showed they were all ok.
>
> Anyway, I couldn't see any webmaster contact details on
> http://developer.r-project.org/ so hopefully this list message will
> reach the right person.
>

This is a good place to post typos in the documentation.  I'll fix this one.

Duncan Murdoch


From aixtools at gmail.com  Sun Jan  3 16:59:18 2016
From: aixtools at gmail.com (Michael Felt)
Date: Sun, 03 Jan 2016 16:59:18 +0100
Subject: [Rd] R,
 AIX 64-bit builds - trying to understand root cause for message:
 "Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
Message-ID: <56894556.3020902@gmail.com>

On 2016-01-01 23:48, peter dalgaard wrote:
> Nice catch you two!!!
>
> Happy New Year
> -pd
I am much happier with this great start!

Simon - which compiler)s) did you use: xlc and xlfortran, or gcc/gfortran?

I have made some changes to configure(.ac) so maybe my problems are 
self-inflicted. But would be good to know what environment you are using.

Thanks for looking - and finding!!!

Michael
>> On 01 Jan 2016, at 22:06 , Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>
>> Ok, found the problem - on platforms that support it TRE uses wint_t (from wchar.h) as its type for characters (tre_cint_t) which on AIX is *signed* int. TRE uses liberally conversions between int and tre_cint_t apparently assuming that the latter is unsigned so conversions back to int are suitable for comparisons etc. On other platforms wint_t is unsigned so it works. Manually defining tre_cint_t to unsigned int fixes the issue.
>>
>> Cheers,
>> Simon
>>
>>
>> On Jan 1, 2016, at 12:20 PM, Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>
>>> Michael,
>>>
>>> thanks, I'll have a look once my PDP VMs are up again (later today). This may be a signedness issue although it's unclear why other platforms wouldn't be affected.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>> On Dec 31, 2015, at 10:14 AM, Michael Felt<aixtools at gmail.com>  wrote:
>>>
>>>> On 2015-12-30 09:58, Michael Felt wrote:
>>>>> On 2015-12-29 11:02, Michael Felt wrote:
>>>>>> This seems to be a problem that goes back a long time - and I hope someone who understands what tre is suppossed to be doing will look at this.
>>>>>>
>>>>>> A short history of other people who have reported on this on different versions of AIX. I shall only add that I get the same results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>>>>>
>>>>>> Basically, with settings that work for AIX and 32-bit - the only changes being
>>>>>> -maix32 becomes -maix64
>>>>>> and
>>>>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>>>>>
>>>>>> Then to shorten the 'make' bla bla, first run just make, then
>>>>>>
>>>>>> cd src/library/tools
>>>>>> make -s sysdata
>>>>>>
>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed
>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed
>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 hours and 30 minutes ago)
>>>>>>
>>>>>> To that, to get debug data, I have
>>>>>>
>>>>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>>>>> * rm src/extra/tre/tre-match-parallel.o
>>>>>> * find . -name \*.so -exec rm {} \;
>>>>>> * make
>>>>>> * cd src/library/tools
>>>>>> * make -s sysdata
>>>>>>
>>>>>> Attached are the two script files of the screen output. The 32-bit one is more verbose - and contains magically lines such as:
>>>>>> found match 3037fd14 (while "found" does not occur in the 64-bit output)
>>>>>>
>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc /tmp/sysdata.??.*
>>>>>>    4730   14123  139916 /tmp/sysdata.32.text
>>>>>>    1312    3688   40528 /tmp/sysdata.64.text
>>>>>>    6042   17811  180444 total
>>>>>>
>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep -c found /tmp/sysdata.??.*
>>>>>> /tmp/sysdata.32.text:19
>>>>>> /tmp/sysdata.64.text:0
>>>>>>
>>>>>>
>>>>>> Hope this brings us (or me), closer to a resolution to an old concern.
>>>>>>
>>>>>> And, best wishes for the new year!
>>>>>>
>>>>>> Michael
>>>>>>
>>>>>>
>>>>> Still hoping for someones curiosity/willingness.
>>>>>
>>>>> The differences show up in the first comparision that is made (of the string "3.2.3" it seems) - 32-bit is on the left, 64-bit on the right.
>>>>>
>>>>> Script command is started on Tue Dec 29 08:39:16 UTC 2015.                     |  Script command is started on Tue Dec 29 08:39:56 UTC 2015.
>>>>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make -s sysdata     |  root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make -s sysdata
>>>>> installing 'sysdata.rda'                                                       |  installing 'sysdata.rda'
>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>> length: -1                                                                     |  length: -1
>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>> init>  30380200 3038014c 30380098                                             |   init>  110cc3040 110cc2f28 110cc2e10
>>>>> match end offset = -1                                                          |  match end offset = -1
>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>> length: -1                                                                     |  length: -1
>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>> 0: 3/00051 | 3037fb88/0:0                                                    |    0: 3/00051 | 110cc3310/0:0
>>>>> 1: ./00046 | 3037fb88/0:0                                                    |    1: ./00046 | 110cc3310/0:0
>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>> 1: ./00046 | 3037fb88/0:1                                                    |    1: ./00046 | 110cc3310/0:1
>>>>> 2: 2/00050 | 3037fb88/0:1                                                    |    2: 2/00050 | 110cc3310/0:1
>>>>> assertion failed                                                               |  assertion failed
>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>> 2: 2/00050 | 3037fc18/0:1 3037fb88/0:2                                       |    2: 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:2                                       |    3: ./00046 | 110cc33f0/0:1 110cc3310/0:2
>>>>> assertion failed                           *** DIFFERENCE ***                  |   init>  110cc3310
>>>>> init>  3037fb88                                                               |    3: ./00046 | 110cc3310/0:3
>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:3                                       |    4: 3/00051 | 110cc3310/0:3
>>>>> 4: 3/00051 | 3037fc18/0:1 3037fb88/0:3                                       |  assertion failed
>>>>> assertion failed                                                               |   init>  110cc3310
>>>>> init>  3037fb88                                                               |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>>>> 4: 3/00051 | 3037fc18/0:3 3037fb88/0:4                                       |    5: /00000 | 110cc33f0/0:3 110cc3310/0:4
>>>>> 5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init>  110cc3310
>>>>> found match 3037fd14 *** DIFFERENCE ***                   |  match end offset = -1
>>>>> match end offset = 5 *** DIFFERENCE ***                   |  tre_tnfa_run_parallel, input type 1
>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>> -------------+------------------------------------------------                 |   init>  110cc4780 110cc4668 110cc4550
>>>>> init>  303811c0 3038110c 30381058                                             |  match end offset = -1
>>>>> match end offset = -1                                                          |  tre_tnfa_run_parallel, input type 1
>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>> -------------+------------------------------------------------                 |   init>  110cc5700 110cc55e8 110cc54d0
>>>>>
>>>> One day further - looks like tre_compile (or just before, after all).
>>>>
>>>> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see (snip)
>>>>
>>>> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
>>>> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
>>>> @@ -1,5 +1,5 @@
>>>> - Script command is started on Thu Dec 31 15:04:39 2015.
>>>> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make sysdata
>>>> + Script command is started on Thu Dec 31 15:08:43 2015.
>>>> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make sysdata
>>>> installing 'sysdata.rda'
>>>> echo "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" | \
>>>>   R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
>>>> @@ -167,7 +167,7 @@
>>>> initial: 1/1,0, assert 0
>>>> initial: 0/0, assert 0
>>>> initial: 0/0, assert 0
>>>> - final state 30370718
>>>> + final state 110cba530
>>>> tre_compile: parsing '(^|[^%])(%%)*%V'
>>>> AST:
>>>> catenation, sub 0, 0 tags
>>>> @@ -177,7 +177,7 @@
>>>>         assertions: bol
>>>>         union, sub -1, 0 tags
>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>       iteration {0, -1}, sub -1, 0 tags, greedy
>>>>         catenation, sub 2, 0 tags
>>>>           literal (%, %) (37, 37), pos 1, sub -1, 0 tags
>>>> @@ -197,7 +197,7 @@
>>>> Union
>>>> Literal 0-36
>>>> After union left
>>>> - Literal 38-65535
>>>> + Literal 38--1
>>>> After union right
>>>> After union right
>>>>   num_tags += 2
>>>> @@ -231,7 +231,7 @@
>>>>         assertions: bol
>>>>         union, sub -1, 0 tags
>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>       iteration {0, -1}, sub -1, 2 tags, greedy
>>>>         catenation, sub 2, 1 tags
>>>>           literal (%, %) (37, 37), pos 1, sub -1, 1 tags
>>>> @@ -255,7 +255,7 @@
>>>> Union
>>>> Literal 0-36
>>>> After union left
>>>> - Literal 38-65535
>>>> + Literal 38--1
>>>> After union right
>>>> After union right
>>>> tre_add_tag_right: tag 3
>>>> @@ -342,7 +342,7 @@
>>>>           catenation, sub -1, 0 tags
>>>>             union, sub -1, 0 tags
>>>>               literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>             tag 4
>>>>
>>>> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 64-bit mode.
>>>>
>>>> I suspect I will "find it" - but a proposed change is appreciated.
>>>>
>>>> Happy New Year,
>>>> Michael
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From aixtools at gmail.com  Sun Jan  3 17:28:05 2016
From: aixtools at gmail.com (Michael Felt)
Date: Sun, 03 Jan 2016 17:28:05 +0100
Subject: [Rd] R,
 AIX 64-bit builds - trying to understand root cause for message:
 "Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <56894556.3020902@gmail.com>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
	<56894556.3020902@gmail.com>
Message-ID: <56894C15.9060600@gmail.com>

On 2016-01-03 16:59, Michael Felt wrote:
> On 2016-01-01 23:48, peter dalgaard wrote:
>> Nice catch you two!!!
>>
>> Happy New Year
>> -pd
> I am much happier with this great start!
>
> Simon - which compiler)s) did you use: xlc and xlfortran, or 
> gcc/gfortran?
>
> I have made some changes to configure(.ac) so maybe my problems are 
> self-inflicted. But would be good to know what environment you are using.
>
Using the dist, plus the following change:

diff -ru R-3.2.3.dist/src/extra/tre/tre-internal.h 
R-3.2.3.1/src/extra/tre/tre-internal.h
--- R-3.2.3.dist/src/extra/tre/tre-internal.h   2014-06-13 
22:15:07.000000000 +0000
+++ R-3.2.3.1/src/extra/tre/tre-internal.h      2016-01-03 
16:08:31.000000000 +0000
@@ -47,7 +47,7 @@
   #ifdef TRE_WCHAR

   /* Wide characters. */
- typedef wint_t tre_cint_t;
+ typedef uint16_t tre_cint_t;
   #define TRE_CHAR_MAX WCHAR_MAX

   #ifdef TRE_MULTIBYTE
@@ -78,7 +78,7 @@
   #else /* !TRE_WCHAR */

   /* 8 bit characters. */
- typedef short tre_cint_t;
+ typedef uint16_t tre_cint_t;
   #define TRE_CHAR_MAX 255
   #define TRE_MB_CUR_MAX 1

@@ -118,7 +118,7 @@
   #define tre_ctype(s)   wctype(s)
   #else /* !TRE_USE_SYSTEM_WCTYPE */
   /* Define our own versions of iswctype() and wctype(). */
- typedef int (*tre_ctype_t)(tre_cint_t);
+ typedef uint16_t (*tre_ctype_t)(tre_cint_t);
   #define tre_isctype(c, type) ( (type)(c) )
   tre_ctype_t tre_ctype(const char *name);
   #endif /* !TRE_USE_SYSTEM_WCTYPE */

I get the same result as with my modified configure(.ac), namely:

make[4]: Entering directory 
'/data/prj/cran/64/R-aix-3.2.3/src/library/grDevices'
byte-compiling package 'grDevices'
Warning in solve.default(rgb) :
   unable to load shared object 
'/data/prj/cran/64/R-aix-3.2.3/modules//lapack.so':
   rtld: 0712-001 Symbol _gfortran_pow_i4_i4 was referenced
       from module /data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so(), 
but a runtime definition
             of the symbol was not found.
rtld: 0712-001 Symbol 
_gfortran_compare_string/data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so 
was referenced
       from module /data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so(), 
but a runtime definition
             of the symbol was not found.
rtld: 0712-001 Symbol _gfortran_concat_string was referenced
       from module /data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so(), 
but a runtime definition
             of the symbol was not found.
rtld: 0712-002 fatal error: exiting.
Error in solve.default(rgb) : LAPACK routines cannot be loaded
Error: unable to load R code in package 'grDevices'
Execution halted

My expectation is that this has to do with some incorrect flags being 
passed to the linker (not getting the 64-bit libraries of the compiler). 
I have had several long discussions with an AIX gcc specialist and he 
has given me several recommendations for changes to the flags used for 
creating shared libraries. I shall continue looking into this.

I am happy it is not my configure.ac changes - and I have a few ideas on 
how to resolve in configure.ac and/or in m4 files.

MF
> Thanks for looking - and finding!!!
>
> Michael
>>> On 01 Jan 2016, at 22:06 , Simon 
>>> Urbanek<simon.urbanek at r-project.org>  wrote:
>>>
>>> Ok, found the problem - on platforms that support it TRE uses wint_t 
>>> (from wchar.h) as its type for characters (tre_cint_t) which on AIX 
>>> is *signed* int. TRE uses liberally conversions between int and 
>>> tre_cint_t apparently assuming that the latter is unsigned so 
>>> conversions back to int are suitable for comparisons etc. On other 
>>> platforms wint_t is unsigned so it works. Manually defining 
>>> tre_cint_t to unsigned int fixes the issue.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>> On Jan 1, 2016, at 12:20 PM, Simon 
>>> Urbanek<simon.urbanek at r-project.org>  wrote:
>>>
>>>> Michael,
>>>>
>>>> thanks, I'll have a look once my PDP VMs are up again (later 
>>>> today). This may be a signedness issue although it's unclear why 
>>>> other platforms wouldn't be affected.
>>>>
>>>> Cheers,
>>>> Simon
>>>>
>>>>
>>>> On Dec 31, 2015, at 10:14 AM, Michael Felt<aixtools at gmail.com>  wrote:
>>>>
>>>>> On 2015-12-30 09:58, Michael Felt wrote:
>>>>>> On 2015-12-29 11:02, Michael Felt wrote:
>>>>>>> This seems to be a problem that goes back a long time - and I 
>>>>>>> hope someone who understands what tre is suppossed to be doing 
>>>>>>> will look at this.
>>>>>>>
>>>>>>> A short history of other people who have reported on this on 
>>>>>>> different versions of AIX. I shall only add that I get the same 
>>>>>>> results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>>>>>>
>>>>>>> Basically, with settings that work for AIX and 32-bit - the only 
>>>>>>> changes being
>>>>>>> -maix32 becomes -maix64
>>>>>>> and
>>>>>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>>>>>>
>>>>>>> Then to shorten the 'make' bla bla, first run just make, then
>>>>>>>
>>>>>>> cd src/library/tools
>>>>>>> make -s sysdata
>>>>>>>
>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed 
>>>>>>>
>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed 
>>>>>>>
>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed 
>>>>>>> Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 
>>>>>>> hours and 30 minutes ago)
>>>>>>>
>>>>>>> To that, to get debug data, I have
>>>>>>>
>>>>>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = 
>>>>>>> $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>>>>>> * rm src/extra/tre/tre-match-parallel.o
>>>>>>> * find . -name \*.so -exec rm {} \;
>>>>>>> * make
>>>>>>> * cd src/library/tools
>>>>>>> * make -s sysdata
>>>>>>>
>>>>>>> Attached are the two script files of the screen output. The 
>>>>>>> 32-bit one is more verbose - and contains magically lines such as:
>>>>>>> found match 3037fd14 (while "found" does not occur in the 64-bit 
>>>>>>> output)
>>>>>>>
>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc 
>>>>>>> /tmp/sysdata.??.*
>>>>>>>    4730   14123  139916 /tmp/sysdata.32.text
>>>>>>>    1312    3688   40528 /tmp/sysdata.64.text
>>>>>>>    6042   17811  180444 total
>>>>>>>
>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep 
>>>>>>> -c found /tmp/sysdata.??.*
>>>>>>> /tmp/sysdata.32.text:19
>>>>>>> /tmp/sysdata.64.text:0
>>>>>>>
>>>>>>>
>>>>>>> Hope this brings us (or me), closer to a resolution to an old 
>>>>>>> concern.
>>>>>>>
>>>>>>> And, best wishes for the new year!
>>>>>>>
>>>>>>> Michael
>>>>>>>
>>>>>>>
>>>>>> Still hoping for someones curiosity/willingness.
>>>>>>
>>>>>> The differences show up in the first comparision that is made (of 
>>>>>> the string "3.2.3" it seems) - 32-bit is on the left, 64-bit on 
>>>>>> the right.
>>>>>>
>>>>>> Script command is started on Tue Dec 29 08:39:16 UTC 
>>>>>> 2015.                     |  Script command is started on Tue Dec 
>>>>>> 29 08:39:56 UTC 2015.
>>>>>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make 
>>>>>> -s sysdata     |  
>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make 
>>>>>> -s sysdata
>>>>>> installing 
>>>>>> 'sysdata.rda'                                                       
>>>>>> |  installing 'sysdata.rda'
>>>>>> tre_tnfa_run_parallel, input type 
>>>>>> 1                                            |  
>>>>>> tre_tnfa_run_parallel, input type 1
>>>>>> length: 
>>>>>> -1                                                                     
>>>>>> |  length: -1
>>>>>> pos:chr/code | states and 
>>>>>> tags                                                 |  
>>>>>> pos:chr/code | states and tags
>>>>>> -------------+------------------------------------------------                 
>>>>>> |  -------------+------------------------------------------------
>>>>>> init>  30380200 3038014c 
>>>>>> 30380098                                             |   init>  
>>>>>> 110cc3040 110cc2f28 110cc2e10
>>>>>> match end offset = 
>>>>>> -1                                                          |  
>>>>>> match end offset = -1
>>>>>> tre_tnfa_run_parallel, input type 
>>>>>> 1                                            |  
>>>>>> tre_tnfa_run_parallel, input type 1
>>>>>> length: 
>>>>>> -1                                                                     
>>>>>> |  length: -1
>>>>>> pos:chr/code | states and 
>>>>>> tags                                                 |  
>>>>>> pos:chr/code | states and tags
>>>>>> -------------+------------------------------------------------                 
>>>>>> |  -------------+------------------------------------------------
>>>>>> init>  
>>>>>> 3037fb88                                                               
>>>>>> |   init>  110cc3310
>>>>>> 0: 3/00051 | 
>>>>>> 3037fb88/0:0                                                    
>>>>>> |    0: 3/00051 | 110cc3310/0:0
>>>>>> 1: ./00046 | 
>>>>>> 3037fb88/0:0                                                    
>>>>>> |    1: ./00046 | 110cc3310/0:0
>>>>>> init>  
>>>>>> 3037fb88                                                               
>>>>>> |   init>  110cc3310
>>>>>> 1: ./00046 | 
>>>>>> 3037fb88/0:1                                                    
>>>>>> |    1: ./00046 | 110cc3310/0:1
>>>>>> 2: 2/00050 | 
>>>>>> 3037fb88/0:1                                                    
>>>>>> |    2: 2/00050 | 110cc3310/0:1
>>>>>> assertion 
>>>>>> failed                                                               
>>>>>> |  assertion failed
>>>>>> init>  
>>>>>> 3037fb88                                                               
>>>>>> |   init>  110cc3310
>>>>>> 2: 2/00050 | 3037fc18/0:1 
>>>>>> 3037fb88/0:2                                       |    2: 
>>>>>> 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>>>>> 3: ./00046 | 3037fc18/0:1 
>>>>>> 3037fb88/0:2                                       |    3: 
>>>>>> ./00046 | 110cc33f0/0:1 110cc3310/0:2
>>>>>> assertion failed                           *** DIFFERENCE 
>>>>>> ***                  |   init>  110cc3310
>>>>>> init>  
>>>>>> 3037fb88                                                               
>>>>>> |    3: ./00046 | 110cc3310/0:3
>>>>>> 3: ./00046 | 3037fc18/0:1 
>>>>>> 3037fb88/0:3                                       |    4: 
>>>>>> 3/00051 | 110cc3310/0:3
>>>>>> 4: 3/00051 | 3037fc18/0:1 
>>>>>> 3037fb88/0:3                                       |  assertion 
>>>>>> failed
>>>>>> assertion 
>>>>>> failed                                                               
>>>>>> |   init>  110cc3310
>>>>>> init>  
>>>>>> 3037fb88                                                               
>>>>>> |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>>>>> 4: 3/00051 | 3037fc18/0:3 
>>>>>> 3037fb88/0:4                                       |    5: /00000 
>>>>>> | 110cc33f0/0:3 110cc3310/0:4
>>>>>> 5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init>  110cc3310
>>>>>> found match 3037fd14 *** DIFFERENCE ***                   |  
>>>>>> match end offset = -1
>>>>>> match end offset = 5 *** DIFFERENCE ***                   |  
>>>>>> tre_tnfa_run_parallel, input type 1
>>>>>> tre_tnfa_run_parallel, input type 
>>>>>> 1                                            |  length: -1
>>>>>> length: 
>>>>>> -1                                                                     
>>>>>> |  pos:chr/code | states and tags
>>>>>> pos:chr/code | states and 
>>>>>> tags                                                 |  
>>>>>> -------------+------------------------------------------------
>>>>>> -------------+------------------------------------------------                 
>>>>>> |   init>  110cc4780 110cc4668 110cc4550
>>>>>> init>  303811c0 3038110c 
>>>>>> 30381058                                             |  match end 
>>>>>> offset = -1
>>>>>> match end offset = 
>>>>>> -1                                                          |  
>>>>>> tre_tnfa_run_parallel, input type 1
>>>>>> tre_tnfa_run_parallel, input type 
>>>>>> 1                                            |  length: -1
>>>>>> length: 
>>>>>> -1                                                                     
>>>>>> |  pos:chr/code | states and tags
>>>>>> pos:chr/code | states and 
>>>>>> tags                                                 |  
>>>>>> -------------+------------------------------------------------
>>>>>> -------------+------------------------------------------------                 
>>>>>> |   init>  110cc5700 110cc55e8 110cc54d0
>>>>>>
>>>>> One day further - looks like tre_compile (or just before, after all).
>>>>>
>>>>> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see 
>>>>> (snip)
>>>>>
>>>>> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
>>>>> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
>>>>> @@ -1,5 +1,5 @@
>>>>> - Script command is started on Thu Dec 31 15:04:39 2015.
>>>>> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make 
>>>>> sysdata
>>>>> + Script command is started on Thu Dec 31 15:08:43 2015.
>>>>> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make 
>>>>> sysdata
>>>>> installing 'sysdata.rda'
>>>>> echo 
>>>>> "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" 
>>>>> | \
>>>>>   R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
>>>>> @@ -167,7 +167,7 @@
>>>>> initial: 1/1,0, assert 0
>>>>> initial: 0/0, assert 0
>>>>> initial: 0/0, assert 0
>>>>> - final state 30370718
>>>>> + final state 110cba530
>>>>> tre_compile: parsing '(^|[^%])(%%)*%V'
>>>>> AST:
>>>>> catenation, sub 0, 0 tags
>>>>> @@ -177,7 +177,7 @@
>>>>>         assertions: bol
>>>>>         union, sub -1, 0 tags
>>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>       iteration {0, -1}, sub -1, 0 tags, greedy
>>>>>         catenation, sub 2, 0 tags
>>>>>           literal (%, %) (37, 37), pos 1, sub -1, 0 tags
>>>>> @@ -197,7 +197,7 @@
>>>>> Union
>>>>> Literal 0-36
>>>>> After union left
>>>>> - Literal 38-65535
>>>>> + Literal 38--1
>>>>> After union right
>>>>> After union right
>>>>>   num_tags += 2
>>>>> @@ -231,7 +231,7 @@
>>>>>         assertions: bol
>>>>>         union, sub -1, 0 tags
>>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>       iteration {0, -1}, sub -1, 2 tags, greedy
>>>>>         catenation, sub 2, 1 tags
>>>>>           literal (%, %) (37, 37), pos 1, sub -1, 1 tags
>>>>> @@ -255,7 +255,7 @@
>>>>> Union
>>>>> Literal 0-36
>>>>> After union left
>>>>> - Literal 38-65535
>>>>> + Literal 38--1
>>>>> After union right
>>>>> After union right
>>>>> tre_add_tag_right: tag 3
>>>>> @@ -342,7 +342,7 @@
>>>>>           catenation, sub -1, 0 tags
>>>>>             union, sub -1, 0 tags
>>>>>               literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>             tag 4
>>>>>
>>>>> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 
>>>>> 64-bit mode.
>>>>>
>>>>> I suspect I will "find it" - but a proposed change is appreciated.
>>>>>
>>>>> Happy New Year,
>>>>> Michael
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From aixtools at gmail.com  Sun Jan  3 18:00:43 2016
From: aixtools at gmail.com (Michael Felt)
Date: Sun, 03 Jan 2016 18:00:43 +0100
Subject: [Rd] R,
 AIX 64-bit builds - trying to understand root cause for message:
 "Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <56894C15.9060600@gmail.com>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
	<56894556.3020902@gmail.com> <56894C15.9060600@gmail.com>
Message-ID: <568953BB.2080502@gmail.com>

On 2016-01-03 17:28, Michael Felt wrote:
> On 2016-01-03 16:59, Michael Felt wrote:
>> On 2016-01-01 23:48, peter dalgaard wrote:
>>> Nice catch you two!!!
>>>
>>> Happy New Year
>>> -pd
>> I am much happier with this great start!
>>
>> Simon - which compiler)s) did you use: xlc and xlfortran, or 
>> gcc/gfortran?
>>
>> I have made some changes to configure(.ac) so maybe my problems are 
>> self-inflicted. But would be good to know what environment you are 
>> using.
>>
> Using the dist, plus the following change:
>
> diff -ru R-3.2.3.dist/src/extra/tre/tre-internal.h 
> R-3.2.3.1/src/extra/tre/tre-internal.h
> --- R-3.2.3.dist/src/extra/tre/tre-internal.h   2014-06-13 
> 22:15:07.000000000 +0000
> +++ R-3.2.3.1/src/extra/tre/tre-internal.h      2016-01-03 
> 16:08:31.000000000 +0000
> @@ -47,7 +47,7 @@
>   #ifdef TRE_WCHAR
>
>   /* Wide characters. */
> - typedef wint_t tre_cint_t;
> + typedef uint16_t tre_cint_t;
>   #define TRE_CHAR_MAX WCHAR_MAX
>
>   #ifdef TRE_MULTIBYTE
> @@ -78,7 +78,7 @@
>   #else /* !TRE_WCHAR */
>
>   /* 8 bit characters. */
> - typedef short tre_cint_t;
> + typedef uint16_t tre_cint_t;
>   #define TRE_CHAR_MAX 255
>   #define TRE_MB_CUR_MAX 1
>
> @@ -118,7 +118,7 @@
>   #define tre_ctype(s)   wctype(s)
>   #else /* !TRE_USE_SYSTEM_WCTYPE */
>   /* Define our own versions of iswctype() and wctype(). */
> - typedef int (*tre_ctype_t)(tre_cint_t);
> + typedef uint16_t (*tre_ctype_t)(tre_cint_t);
>   #define tre_isctype(c, type) ( (type)(c) )
>   tre_ctype_t tre_ctype(const char *name);
>   #endif /* !TRE_USE_SYSTEM_WCTYPE */
>
> I get the same result as with my modified configure(.ac), namely:
>
> make[4]: Entering directory 
> '/data/prj/cran/64/R-aix-3.2.3/src/library/grDevices'
> byte-compiling package 'grDevices'
> Warning in solve.default(rgb) :
>   unable to load shared object 
> '/data/prj/cran/64/R-aix-3.2.3/modules//lapack.so':
>   rtld: 0712-001 Symbol _gfortran_pow_i4_i4 was referenced
>       from module /data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so(), 
> but a runtime definition
>             of the symbol was not found.
> rtld: 0712-001 Symbol 
> _gfortran_compare_string/data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so was 
> referenced
>       from module /data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so(), 
> but a runtime definition
>             of the symbol was not found.
> rtld: 0712-001 Symbol _gfortran_concat_string was referenced
>       from module /data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so(), 
> but a runtime definition
>             of the symbol was not found.
> rtld: 0712-002 fatal error: exiting.
> Error in solve.default(rgb) : LAPACK routines cannot be loaded
> Error: unable to load R code in package 'grDevices'
> Execution halted
>
> My expectation is that this has to do with some incorrect flags being 
> passed to the linker (not getting the 64-bit libraries of the 
> compiler). I have had several long discussions with an AIX gcc 
> specialist and he has given me several recommendations for changes to 
> the flags used for creating shared libraries. I shall continue looking 
> into this.
>
> I am happy it is not my configure.ac changes - and I have a few ideas 
> on how to resolve in configure.ac and/or in m4 files.
>
> MF
FYI: Still running into problems in grDevices using
/data/prj/cran/${RELEASE}/configure --disable-lto --prefix=/opt \
         --disable-R-shlib --enable-R-static-lib \
         --with-cairo=no --with-libpng=no --with-jpeglib=no 
--with-libtiff=no \
         --with-readline=no --with-x=no

So, Simon - very interested in your environment and whether make 
completes successfully - to the end.

p.s. - I am a bit surprised about the messages below (line 4) because I 
am assuming that shared libraries are not being used (with 
--disable-R-shlib --enable-R-static-lib ).
fyi - from memory - but my expectation is that it has to do with the 
-bexpall and an incorrect library search path being inserted. The symbol 
is in /opt/lib/ppc64 archives:

root at x069:[/opt/lib/ppc64]nm -X64 -Ae *.a | grep __register_frame_info_table
libgcc_s.a[shr.o]: .__register_frame_info_table T   268466492         116
libgcc_s.a[shr.o]: .__register_frame_info_table_bases T   
268466364         120
libgcc_s.a[shr.o]: __register_frame_info_table D   536877472
libgcc_s.a[shr.o]: __register_frame_info_table d   536877472          24
libgcc_s.a[shr.o]: __register_frame_info_table_bases D   536880832
libgcc_s.a[shr.o]: __register_frame_info_table_bases d   
536880832          24
libstdc++.a[libstdc++.so.6]: .__register_frame_info_table T   269107692
libstdc++.a[libstdc++.so.6]: .__register_frame_info_table t   
269107692          40
libstdc++.a[libstdc++.so.6]: __register_frame_info_table U           -
libstdc++.a[libstdc++.so.6]: __register_frame_info_table d   
537156720           8

But these are not being found, rather specified. Somehow the default 
behavior of gcc (i.e., the flags it passes to ld are being overruled). 
It will take time, but I shall find them.


make[4]: Entering directory 
'/data/prj/cran/64/R-aix-3.2.3/src/library/grDevices'
byte-compiling package 'grDevices'

  *** caught segfault ***
address 6c20776173206e6f, cause 'memory not mapped'

Traceback:
  1: `$<-`(`*tmp*`, "name", value = "muffleWarning")
  2: makeRestartList(...)
  3: withRestarts({    .Internal(.signalCondition(simpleWarning(msg, 
call), msg,         call))    .Internal(.dfltWarn(msg, call))}, 
muffleWarning = function() NULL)
  4: .signalSimpleWarning("unable to load shared object 
'/data/prj/cran/64/R-aix-3.2.3/modules//lapack.so':\n  rtld: 0712-001 
Symbol __register_frame_info_table was referenced\n      from module 
/data/prj/cran/64/R-aix-3.2.3/modules/ /lapack.so(), but a runtime 
definition\n\t    of the symbol was not found.\nrtld: 0712-001 Symbol 
__deregister_frame _info was referenced\n      from module 
/data/prj/cran/64/R-aix-3.2.3/modules//lapack.so(), but a runtime 
definition \n\t    of the symbol was not found.\nrtld: 0712-001 Symbol 
__register_frame_info_table was referenced\n      from module 
/data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so(), but a runtime 
definition\n\t    of the symbol was not found.\nrtld: 0712-001 Symbol 
__deregister_frame_info was referenced\n      from module 
/data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so(), but a runtime 
definition\n\t    of the symbol was not found.\nrtld: 0712-001 Symbol 
_gfortran_pow_i4_i4 was referenced\n      from module 
/data/prj/cran/64/R-aix-3.2.3/lib/libRlapack.so(), but a runtime 
definition",     quote(solve.default(rgb)))
  5: solve.default(rgb)
  6: solve(rgb)
  7: drop(whitexyz %*% solve(rgb))
  8: make.rgb(red = c(0.625, 0.34), green = c(0.28, 0.595), blue = 
c(0.155,     0.07), gamma = 1.8, white = "D65", name = "Apple RGB")
  9: eval(expr, envir, enclos)
10: eval(exprs[i], envir)
11: sys.source(codeFile, env, keep.source = keep.source)
12: doTryCatch(return(expr), name, parentenv, handler)
13: tryCatchOne(expr, names, parentenv, handlers[[1L]])
14: tryCatchList(expr, classes, parentenv, handlers)
15: tryCatch(expr, error = function(e) {    call <- conditionCall(e)    
if (!is.null(call)) {        if (identical(call[[1L]], 
quote(doTryCatch)))             call <- sys.call(-4L)        dcall <- 
deparse(call)[1L]        prefix <- paste("Error in", dcall, ": ")        
LONG <- 75L        msg <- conditionMessage(e)        sm <- strsplit(msg, 
"\n") [[1L]]        w <- 14L + nchar(dcall, type = "w") + nchar(sm[1L], 
type = "w")        if (is.na(w))             w <-14L + nchar(dcall, type 
= "b") + nchar(sm[1L],                 type = "b")        if (w > 
LONG)             prefix <- paste0(prefix, "\n  ")    }    else prefix 
<- "Error : "    msg <- paste0(prefix, conditionMessage(e), "\n")    
.Internal(seterrmessage(msg[1L]))    if (!silent && 
identical(getOption("show.error.messages"),         TRUE)) {     
cat(msg, file = stderr())        .Internal(printDeferredWarnings())    
}    invisible(structure(msg, class = "try-error", condition = e))})
16: try(sys.source(codeFile, env, keep.source = keep.source))
17: loadNamespace(package, lib.loc, keep.source, partial = TRUE)
18: withCallingHandlers(expr, packageStartupMessage = function(c) 
invokeRestart("muffleMessage"))
19: suppressPackageStartupMessages(loadNamespace(package, lib.loc,     
keep.source, partial = TRUE))
20: code2LazyLoadDB(package, lib.loc = lib.loc, keep.source = 
keep.source,     compress = compress)
21: tools:::makeLazyLoading("grDevices")
aborting ...
/data/prj/cran/R-3.2.3.1/share/make/lazycomp.mk:7: recipe for target 
'../../../library/grDevices/R/grDevices.rdb' failed
make[4]: *** [../../../library/grDevices/R/grDevices.rdb] Segmentation 
fault (core dumped)
make[4]: Leaving directory 
'/data/prj/cran/64/R-aix-3.2.3/src/library/grDevices'
Makefile:24: recipe for target 'all' failed
make[3]: *** [all] Error 2
make[3]: Leaving directory 
'/data/prj/cran/64/R-aix-3.2.3/src/library/grDevices'
Makefile:36: recipe for target 'R' failed
make[2]: *** [R] Error 1
make[2]: Leaving directory '/data/prj/cran/64/R-aix-3.2.3/src/library'
Makefile:28: recipe for target 'R' failed
make[1]: *** [R] Error 1
make[1]: Leaving directory '/data/prj/cran/64/R-aix-3.2.3/src'
Makefile:60: recipe for target 'R' failed
make: *** [R] Error 1
root at x065:[/data/prj/cran/64/R-aix-3.2.3]

>> Thanks for looking - and finding!!!
>>
>> Michael
>>>> On 01 Jan 2016, at 22:06 , Simon 
>>>> Urbanek<simon.urbanek at r-project.org>  wrote:
>>>>
>>>> Ok, found the problem - on platforms that support it TRE uses 
>>>> wint_t (from wchar.h) as its type for characters (tre_cint_t) which 
>>>> on AIX is *signed* int. TRE uses liberally conversions between int 
>>>> and tre_cint_t apparently assuming that the latter is unsigned so 
>>>> conversions back to int are suitable for comparisons etc. On other 
>>>> platforms wint_t is unsigned so it works. Manually defining 
>>>> tre_cint_t to unsigned int fixes the issue.
>>>>
>>>> Cheers,
>>>> Simon
>>>>
>>>>
>>>> On Jan 1, 2016, at 12:20 PM, Simon 
>>>> Urbanek<simon.urbanek at r-project.org>  wrote:
>>>>
>>>>> Michael,
>>>>>
>>>>> thanks, I'll have a look once my PDP VMs are up again (later 
>>>>> today). This may be a signedness issue although it's unclear why 
>>>>> other platforms wouldn't be affected.
>>>>>
>>>>> Cheers,
>>>>> Simon
>>>>>
>>>>>
>>>>> On Dec 31, 2015, at 10:14 AM, Michael Felt<aixtools at gmail.com>  
>>>>> wrote:
>>>>>
>>>>>> On 2015-12-30 09:58, Michael Felt wrote:
>>>>>>> On 2015-12-29 11:02, Michael Felt wrote:
>>>>>>>> This seems to be a problem that goes back a long time - and I 
>>>>>>>> hope someone who understands what tre is suppossed to be doing 
>>>>>>>> will look at this.
>>>>>>>>
>>>>>>>> A short history of other people who have reported on this on 
>>>>>>>> different versions of AIX. I shall only add that I get the same 
>>>>>>>> results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>>>>>>>
>>>>>>>> Basically, with settings that work for AIX and 32-bit - the 
>>>>>>>> only changes being
>>>>>>>> -maix32 becomes -maix64
>>>>>>>> and
>>>>>>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>>>>>>>
>>>>>>>> Then to shorten the 'make' bla bla, first run just make, then
>>>>>>>>
>>>>>>>> cd src/library/tools
>>>>>>>> make -s sysdata
>>>>>>>>
>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed 
>>>>>>>>
>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed 
>>>>>>>>
>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed 
>>>>>>>> Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 
>>>>>>>> hours and 30 minutes ago)
>>>>>>>>
>>>>>>>> To that, to get debug data, I have
>>>>>>>>
>>>>>>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = 
>>>>>>>> $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>>>>>>> * rm src/extra/tre/tre-match-parallel.o
>>>>>>>> * find . -name \*.so -exec rm {} \;
>>>>>>>> * make
>>>>>>>> * cd src/library/tools
>>>>>>>> * make -s sysdata
>>>>>>>>
>>>>>>>> Attached are the two script files of the screen output. The 
>>>>>>>> 32-bit one is more verbose - and contains magically lines such as:
>>>>>>>> found match 3037fd14 (while "found" does not occur in the 
>>>>>>>> 64-bit output)
>>>>>>>>
>>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc 
>>>>>>>> /tmp/sysdata.??.*
>>>>>>>>    4730   14123  139916 /tmp/sysdata.32.text
>>>>>>>>    1312    3688   40528 /tmp/sysdata.64.text
>>>>>>>>    6042   17811  180444 total
>>>>>>>>
>>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep 
>>>>>>>> -c found /tmp/sysdata.??.*
>>>>>>>> /tmp/sysdata.32.text:19
>>>>>>>> /tmp/sysdata.64.text:0
>>>>>>>>
>>>>>>>>
>>>>>>>> Hope this brings us (or me), closer to a resolution to an old 
>>>>>>>> concern.
>>>>>>>>
>>>>>>>> And, best wishes for the new year!
>>>>>>>>
>>>>>>>> Michael
>>>>>>>>
>>>>>>>>
>>>>>>> Still hoping for someones curiosity/willingness.
>>>>>>>
>>>>>>> The differences show up in the first comparision that is made 
>>>>>>> (of the string "3.2.3" it seems) - 32-bit is on the left, 64-bit 
>>>>>>> on the right.
>>>>>>>
>>>>>>> Script command is started on Tue Dec 29 08:39:16 UTC 
>>>>>>> 2015.                     |  Script command is started on Tue 
>>>>>>> Dec 29 08:39:56 UTC 2015.
>>>>>>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make 
>>>>>>> -s sysdata     |  
>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make 
>>>>>>> -s sysdata
>>>>>>> installing 
>>>>>>> 'sysdata.rda'                                                       
>>>>>>> |  installing 'sysdata.rda'
>>>>>>> tre_tnfa_run_parallel, input type 
>>>>>>> 1                                            |  
>>>>>>> tre_tnfa_run_parallel, input type 1
>>>>>>> length: 
>>>>>>> -1                                                                     
>>>>>>> |  length: -1
>>>>>>> pos:chr/code | states and 
>>>>>>> tags                                                 |  
>>>>>>> pos:chr/code | states and tags
>>>>>>> -------------+------------------------------------------------                 
>>>>>>> |  -------------+------------------------------------------------
>>>>>>> init>  30380200 3038014c 
>>>>>>> 30380098                                             |   init>  
>>>>>>> 110cc3040 110cc2f28 110cc2e10
>>>>>>> match end offset = 
>>>>>>> -1                                                          |  
>>>>>>> match end offset = -1
>>>>>>> tre_tnfa_run_parallel, input type 
>>>>>>> 1                                            |  
>>>>>>> tre_tnfa_run_parallel, input type 1
>>>>>>> length: 
>>>>>>> -1                                                                     
>>>>>>> |  length: -1
>>>>>>> pos:chr/code | states and 
>>>>>>> tags                                                 |  
>>>>>>> pos:chr/code | states and tags
>>>>>>> -------------+------------------------------------------------                 
>>>>>>> |  -------------+------------------------------------------------
>>>>>>> init>  
>>>>>>> 3037fb88                                                               
>>>>>>> |   init>  110cc3310
>>>>>>> 0: 3/00051 | 
>>>>>>> 3037fb88/0:0                                                    
>>>>>>> |    0: 3/00051 | 110cc3310/0:0
>>>>>>> 1: ./00046 | 
>>>>>>> 3037fb88/0:0                                                    
>>>>>>> |    1: ./00046 | 110cc3310/0:0
>>>>>>> init>  
>>>>>>> 3037fb88                                                               
>>>>>>> |   init>  110cc3310
>>>>>>> 1: ./00046 | 
>>>>>>> 3037fb88/0:1                                                    
>>>>>>> |    1: ./00046 | 110cc3310/0:1
>>>>>>> 2: 2/00050 | 
>>>>>>> 3037fb88/0:1                                                    
>>>>>>> |    2: 2/00050 | 110cc3310/0:1
>>>>>>> assertion 
>>>>>>> failed                                                               
>>>>>>> |  assertion failed
>>>>>>> init>  
>>>>>>> 3037fb88                                                               
>>>>>>> |   init>  110cc3310
>>>>>>> 2: 2/00050 | 3037fc18/0:1 
>>>>>>> 3037fb88/0:2                                       |    2: 
>>>>>>> 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>>>>>> 3: ./00046 | 3037fc18/0:1 
>>>>>>> 3037fb88/0:2                                       |    3: 
>>>>>>> ./00046 | 110cc33f0/0:1 110cc3310/0:2
>>>>>>> assertion failed                           *** DIFFERENCE 
>>>>>>> ***                  |   init>  110cc3310
>>>>>>> init>  
>>>>>>> 3037fb88                                                               
>>>>>>> |    3: ./00046 | 110cc3310/0:3
>>>>>>> 3: ./00046 | 3037fc18/0:1 
>>>>>>> 3037fb88/0:3                                       |    4: 
>>>>>>> 3/00051 | 110cc3310/0:3
>>>>>>> 4: 3/00051 | 3037fc18/0:1 
>>>>>>> 3037fb88/0:3                                       |  assertion 
>>>>>>> failed
>>>>>>> assertion 
>>>>>>> failed                                                               
>>>>>>> |   init>  110cc3310
>>>>>>> init>  
>>>>>>> 3037fb88                                                               
>>>>>>> |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>>>>>> 4: 3/00051 | 3037fc18/0:3 
>>>>>>> 3037fb88/0:4                                       |    5: 
>>>>>>> /00000 | 110cc33f0/0:3 110cc3310/0:4
>>>>>>> 5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init>  110cc3310
>>>>>>> found match 3037fd14 *** DIFFERENCE ***                   |  
>>>>>>> match end offset = -1
>>>>>>> match end offset = 5 *** DIFFERENCE ***                   |  
>>>>>>> tre_tnfa_run_parallel, input type 1
>>>>>>> tre_tnfa_run_parallel, input type 
>>>>>>> 1                                            |  length: -1
>>>>>>> length: 
>>>>>>> -1                                                                     
>>>>>>> |  pos:chr/code | states and tags
>>>>>>> pos:chr/code | states and 
>>>>>>> tags                                                 |  
>>>>>>> -------------+------------------------------------------------
>>>>>>> -------------+------------------------------------------------                 
>>>>>>> |   init>  110cc4780 110cc4668 110cc4550
>>>>>>> init>  303811c0 3038110c 
>>>>>>> 30381058                                             |  match 
>>>>>>> end offset = -1
>>>>>>> match end offset = 
>>>>>>> -1                                                          |  
>>>>>>> tre_tnfa_run_parallel, input type 1
>>>>>>> tre_tnfa_run_parallel, input type 
>>>>>>> 1                                            |  length: -1
>>>>>>> length: 
>>>>>>> -1                                                                     
>>>>>>> |  pos:chr/code | states and tags
>>>>>>> pos:chr/code | states and 
>>>>>>> tags                                                 |  
>>>>>>> -------------+------------------------------------------------
>>>>>>> -------------+------------------------------------------------                 
>>>>>>> |   init>  110cc5700 110cc55e8 110cc54d0
>>>>>>>
>>>>>> One day further - looks like tre_compile (or just before, after 
>>>>>> all).
>>>>>>
>>>>>> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see 
>>>>>> (snip)
>>>>>>
>>>>>> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
>>>>>> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
>>>>>> @@ -1,5 +1,5 @@
>>>>>> - Script command is started on Thu Dec 31 15:04:39 2015.
>>>>>> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make 
>>>>>> sysdata
>>>>>> + Script command is started on Thu Dec 31 15:08:43 2015.
>>>>>> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make 
>>>>>> sysdata
>>>>>> installing 'sysdata.rda'
>>>>>> echo 
>>>>>> "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" 
>>>>>> | \
>>>>>>   R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
>>>>>> @@ -167,7 +167,7 @@
>>>>>> initial: 1/1,0, assert 0
>>>>>> initial: 0/0, assert 0
>>>>>> initial: 0/0, assert 0
>>>>>> - final state 30370718
>>>>>> + final state 110cba530
>>>>>> tre_compile: parsing '(^|[^%])(%%)*%V'
>>>>>> AST:
>>>>>> catenation, sub 0, 0 tags
>>>>>> @@ -177,7 +177,7 @@
>>>>>>         assertions: bol
>>>>>>         union, sub -1, 0 tags
>>>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>       iteration {0, -1}, sub -1, 0 tags, greedy
>>>>>>         catenation, sub 2, 0 tags
>>>>>>           literal (%, %) (37, 37), pos 1, sub -1, 0 tags
>>>>>> @@ -197,7 +197,7 @@
>>>>>> Union
>>>>>> Literal 0-36
>>>>>> After union left
>>>>>> - Literal 38-65535
>>>>>> + Literal 38--1
>>>>>> After union right
>>>>>> After union right
>>>>>>   num_tags += 2
>>>>>> @@ -231,7 +231,7 @@
>>>>>>         assertions: bol
>>>>>>         union, sub -1, 0 tags
>>>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>       iteration {0, -1}, sub -1, 2 tags, greedy
>>>>>>         catenation, sub 2, 1 tags
>>>>>>           literal (%, %) (37, 37), pos 1, sub -1, 1 tags
>>>>>> @@ -255,7 +255,7 @@
>>>>>> Union
>>>>>> Literal 0-36
>>>>>> After union left
>>>>>> - Literal 38-65535
>>>>>> + Literal 38--1
>>>>>> After union right
>>>>>> After union right
>>>>>> tre_add_tag_right: tag 3
>>>>>> @@ -342,7 +342,7 @@
>>>>>>           catenation, sub -1, 0 tags
>>>>>>             union, sub -1, 0 tags
>>>>>>               literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>             tag 4
>>>>>>
>>>>>> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 
>>>>>> 64-bit mode.
>>>>>>
>>>>>> I suspect I will "find it" - but a proposed change is appreciated.
>>>>>>
>>>>>> Happy New Year,
>>>>>> Michael
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From bbolker at gmail.com  Sun Jan  3 20:13:26 2016
From: bbolker at gmail.com (Ben Bolker)
Date: Sun, 3 Jan 2016 14:13:26 -0500
Subject: [Rd] trivial typo in R for windows FAQ
Message-ID: <CABghstR-8F=OQJ2QYXQ7OYEH6QGM-Ad=JSmo5G_VpzHtk9a24A@mail.gmail.com>

In https://cran.r-project.org/bin/windows/base/rw-FAQ.html#Package-TclTk-does-not-work_002e
:

"This [is] part of the R installation, so it should be there."

  cheers
    Ben Bolker


From simon.urbanek at r-project.org  Mon Jan  4 01:26:57 2016
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sun, 3 Jan 2016 19:26:57 -0500
Subject: [Rd] R,
	AIX 64-bit builds - trying to understand root cause for message:
	"Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <56894556.3020902@gmail.com>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
	<56894556.3020902@gmail.com>
Message-ID: <5138BF7E-44C2-4ABE-9D3F-0730BCF90BC9@r-project.org>

Michael,

I'm using xlc + xlf - the exact flags are

configure CC=xlc_r CXX=xlc++_r F77=xlf_r FC=xlf95_r LIBS='-L/opt/freeware/lib /opt/freeware/lib/libiconv.a -lpthread' --prefix=/opt/freeware CPPFLAGS=-I/opt/freeware/include

with export OBJECT_MODE=64 in the env (and libiconv from perzl.org RPMs - iconv is a serious pain).

I have changed the TRE typedef from "wint_t" to "unsigned int" since that is what the other platforms use anyway.

On my AIX7 VM I'm running out of memory in xz when lazy-loading is enabled which his odd - the VM has 4Gb which one would think should be enough. The symptom is that installing MASS fails when creating lazy-load rds or the same happens when running make check as memCompress() test for xz fails. I wish there was a way to disable xz altogether..

I'd like to get IBM compilers to work first since those are the official ones. I may try gcc later, but I'm really interested in the IBM ones because that gives us a good non-GNU test (e.g., TRE fails in JIT due some alleged GNUisms so you can't use the strict compiler mode).

Cheers,
Simon


On Jan 3, 2016, at 10:59 AM, Michael Felt <aixtools at gmail.com> wrote:

> On 2016-01-01 23:48, peter dalgaard wrote:
>> Nice catch you two!!!
>> 
>> Happy New Year
>> -pd
> I am much happier with this great start!
> 
> Simon - which compiler)s) did you use: xlc and xlfortran, or gcc/gfortran?
> 
> I have made some changes to configure(.ac) so maybe my problems are self-inflicted. But would be good to know what environment you are using.
> 
> Thanks for looking - and finding!!!
> 
> Michael
>>> On 01 Jan 2016, at 22:06 , Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>> 
>>> Ok, found the problem - on platforms that support it TRE uses wint_t (from wchar.h) as its type for characters (tre_cint_t) which on AIX is *signed* int. TRE uses liberally conversions between int and tre_cint_t apparently assuming that the latter is unsigned so conversions back to int are suitable for comparisons etc. On other platforms wint_t is unsigned so it works. Manually defining tre_cint_t to unsigned int fixes the issue.
>>> 
>>> Cheers,
>>> Simon
>>> 
>>> 
>>> On Jan 1, 2016, at 12:20 PM, Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>> 
>>>> Michael,
>>>> 
>>>> thanks, I'll have a look once my PDP VMs are up again (later today). This may be a signedness issue although it's unclear why other platforms wouldn't be affected.
>>>> 
>>>> Cheers,
>>>> Simon
>>>> 
>>>> 
>>>> On Dec 31, 2015, at 10:14 AM, Michael Felt<aixtools at gmail.com>  wrote:
>>>> 
>>>>> On 2015-12-30 09:58, Michael Felt wrote:
>>>>>> On 2015-12-29 11:02, Michael Felt wrote:
>>>>>>> This seems to be a problem that goes back a long time - and I hope someone who understands what tre is suppossed to be doing will look at this.
>>>>>>> 
>>>>>>> A short history of other people who have reported on this on different versions of AIX. I shall only add that I get the same results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>>>>>> 
>>>>>>> Basically, with settings that work for AIX and 32-bit - the only changes being
>>>>>>> -maix32 becomes -maix64
>>>>>>> and
>>>>>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>>>>>> 
>>>>>>> Then to shorten the 'make' bla bla, first run just make, then
>>>>>>> 
>>>>>>> cd src/library/tools
>>>>>>> make -s sysdata
>>>>>>> 
>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed
>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed
>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 hours and 30 minutes ago)
>>>>>>> 
>>>>>>> To that, to get debug data, I have
>>>>>>> 
>>>>>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>>>>>> * rm src/extra/tre/tre-match-parallel.o
>>>>>>> * find . -name \*.so -exec rm {} \;
>>>>>>> * make
>>>>>>> * cd src/library/tools
>>>>>>> * make -s sysdata
>>>>>>> 
>>>>>>> Attached are the two script files of the screen output. The 32-bit one is more verbose - and contains magically lines such as:
>>>>>>> found match 3037fd14 (while "found" does not occur in the 64-bit output)
>>>>>>> 
>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc /tmp/sysdata.??.*
>>>>>>>   4730   14123  139916 /tmp/sysdata.32.text
>>>>>>>   1312    3688   40528 /tmp/sysdata.64.text
>>>>>>>   6042   17811  180444 total
>>>>>>> 
>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep -c found /tmp/sysdata.??.*
>>>>>>> /tmp/sysdata.32.text:19
>>>>>>> /tmp/sysdata.64.text:0
>>>>>>> 
>>>>>>> 
>>>>>>> Hope this brings us (or me), closer to a resolution to an old concern.
>>>>>>> 
>>>>>>> And, best wishes for the new year!
>>>>>>> 
>>>>>>> Michael
>>>>>>> 
>>>>>>> 
>>>>>> Still hoping for someones curiosity/willingness.
>>>>>> 
>>>>>> The differences show up in the first comparision that is made (of the string "3.2.3" it seems) - 32-bit is on the left, 64-bit on the right.
>>>>>> 
>>>>>> Script command is started on Tue Dec 29 08:39:16 UTC 2015.                     |  Script command is started on Tue Dec 29 08:39:56 UTC 2015.
>>>>>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make -s sysdata     |  root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make -s sysdata
>>>>>> installing 'sysdata.rda'                                                       |  installing 'sysdata.rda'
>>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>>> length: -1                                                                     |  length: -1
>>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>>> init>  30380200 3038014c 30380098                                             |   init>  110cc3040 110cc2f28 110cc2e10
>>>>>> match end offset = -1                                                          |  match end offset = -1
>>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>>> length: -1                                                                     |  length: -1
>>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>> 0: 3/00051 | 3037fb88/0:0                                                    |    0: 3/00051 | 110cc3310/0:0
>>>>>> 1: ./00046 | 3037fb88/0:0                                                    |    1: ./00046 | 110cc3310/0:0
>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>> 1: ./00046 | 3037fb88/0:1                                                    |    1: ./00046 | 110cc3310/0:1
>>>>>> 2: 2/00050 | 3037fb88/0:1                                                    |    2: 2/00050 | 110cc3310/0:1
>>>>>> assertion failed                                                               |  assertion failed
>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>> 2: 2/00050 | 3037fc18/0:1 3037fb88/0:2                                       |    2: 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:2                                       |    3: ./00046 | 110cc33f0/0:1 110cc3310/0:2
>>>>>> assertion failed                           *** DIFFERENCE ***                  |   init>  110cc3310
>>>>>> init>  3037fb88                                                               |    3: ./00046 | 110cc3310/0:3
>>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:3                                       |    4: 3/00051 | 110cc3310/0:3
>>>>>> 4: 3/00051 | 3037fc18/0:1 3037fb88/0:3                                       |  assertion failed
>>>>>> assertion failed                                                               |   init>  110cc3310
>>>>>> init>  3037fb88                                                               |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>>>>> 4: 3/00051 | 3037fc18/0:3 3037fb88/0:4                                       |    5: /00000 | 110cc33f0/0:3 110cc3310/0:4
>>>>>> 5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init>  110cc3310
>>>>>> found match 3037fd14 *** DIFFERENCE ***                   |  match end offset = -1
>>>>>> match end offset = 5 *** DIFFERENCE ***                   |  tre_tnfa_run_parallel, input type 1
>>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>>> -------------+------------------------------------------------                 |   init>  110cc4780 110cc4668 110cc4550
>>>>>> init>  303811c0 3038110c 30381058                                             |  match end offset = -1
>>>>>> match end offset = -1                                                          |  tre_tnfa_run_parallel, input type 1
>>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>>> -------------+------------------------------------------------                 |   init>  110cc5700 110cc55e8 110cc54d0
>>>>>> 
>>>>> One day further - looks like tre_compile (or just before, after all).
>>>>> 
>>>>> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see (snip)
>>>>> 
>>>>> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
>>>>> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
>>>>> @@ -1,5 +1,5 @@
>>>>> - Script command is started on Thu Dec 31 15:04:39 2015.
>>>>> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make sysdata
>>>>> + Script command is started on Thu Dec 31 15:08:43 2015.
>>>>> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make sysdata
>>>>> installing 'sysdata.rda'
>>>>> echo "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" | \
>>>>>  R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
>>>>> @@ -167,7 +167,7 @@
>>>>> initial: 1/1,0, assert 0
>>>>> initial: 0/0, assert 0
>>>>> initial: 0/0, assert 0
>>>>> - final state 30370718
>>>>> + final state 110cba530
>>>>> tre_compile: parsing '(^|[^%])(%%)*%V'
>>>>> AST:
>>>>> catenation, sub 0, 0 tags
>>>>> @@ -177,7 +177,7 @@
>>>>>        assertions: bol
>>>>>        union, sub -1, 0 tags
>>>>>          literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>      iteration {0, -1}, sub -1, 0 tags, greedy
>>>>>        catenation, sub 2, 0 tags
>>>>>          literal (%, %) (37, 37), pos 1, sub -1, 0 tags
>>>>> @@ -197,7 +197,7 @@
>>>>> Union
>>>>> Literal 0-36
>>>>> After union left
>>>>> - Literal 38-65535
>>>>> + Literal 38--1
>>>>> After union right
>>>>> After union right
>>>>>  num_tags += 2
>>>>> @@ -231,7 +231,7 @@
>>>>>        assertions: bol
>>>>>        union, sub -1, 0 tags
>>>>>          literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>      iteration {0, -1}, sub -1, 2 tags, greedy
>>>>>        catenation, sub 2, 1 tags
>>>>>          literal (%, %) (37, 37), pos 1, sub -1, 1 tags
>>>>> @@ -255,7 +255,7 @@
>>>>> Union
>>>>> Literal 0-36
>>>>> After union left
>>>>> - Literal 38-65535
>>>>> + Literal 38--1
>>>>> After union right
>>>>> After union right
>>>>> tre_add_tag_right: tag 3
>>>>> @@ -342,7 +342,7 @@
>>>>>          catenation, sub -1, 0 tags
>>>>>            union, sub -1, 0 tags
>>>>>              literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>            tag 4
>>>>> 
>>>>> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 64-bit mode.
>>>>> 
>>>>> I suspect I will "find it" - but a proposed change is appreciated.
>>>>> 
>>>>> Happy New Year,
>>>>> Michael
>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From aixtools at gmail.com  Mon Jan  4 07:34:45 2016
From: aixtools at gmail.com (Michael Felt)
Date: Mon, 4 Jan 2016 07:34:45 +0100
Subject: [Rd] R,
 AIX 64-bit builds - trying to understand root cause for message:
 "Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <5138BF7E-44C2-4ABE-9D3F-0730BCF90BC9@r-project.org>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
	<56894556.3020902@gmail.com>
	<5138BF7E-44C2-4ABE-9D3F-0730BCF90BC9@r-project.org>
Message-ID: <568A1285.5000709@gmail.com>

I would be "pleased" if you would try packages - i.e., none of "Toolbox" 
or Perzl rpm's.

The iconv I supply might not be working as is (I will need to install a 
new system to check). However, this is why I have been testing with 
R-3.2.3 - to side-step the system library dependencies.

re: xz - I have "installp" version - and any of my packages should work 
side-by-side with the Toolbox/.rpm files - my PATH prefix is /opt (so, 
/opt/bin and /opt/sbin rather than /usr/bin, /usr/local/bin (etc.).

I am testing on a Power6, usually with 2 to 4G RAM active. When I get 
the compile to finish I will up to 8G to test some data processing that 
fails with the 32-bit limitations.

Another question: are you also getting lots of duplicate symbol 
warnings? Curious me. If you are I would like to send my modifications 
to configure(.ac) for you to test (I put .ac in () because I am actually 
editting configure atm but shall put them into configure.ac when I finish)

FYI: I shall be downloading the "try and buy" xlc and xlfortran - and I 
think you will certainly prefer my packaging then as they work without 
the libgc dependencies that many of the rpm packages need.

And, at your option - we can take this discussion over tools - "out of 
forums". Or at least start a new thread.

re: unsigned short - I have adopted the convention to use the *NN_t 
types after running into a problem with unsigned longlong (from a very 
old program). It goes back many years - and maybe they have finalized 
short to mean 16-bits - but I remember when short was meant to help when 
moving from 16-bit to 32-bit and the "word" size changed - i.e., int 
became 32-bit same as long. nd for a long (no pun intended) long was 
32-bit and long long was 64-bit. Those definitions are extinct.

imho - the standard for wint_t is wrong as well - based on an assumption 
about how "short" is defined. And, I consider it poor practice that 
there are som many cases of type cast switches between ushort and int.

Michael

On 04-Jan-16 01:26, Simon Urbanek wrote:
> Michael,
>
> I'm using xlc + xlf - the exact flags are
>
> configure CC=xlc_r CXX=xlc++_r F77=xlf_r FC=xlf95_r LIBS='-L/opt/freeware/lib /opt/freeware/lib/libiconv.a -lpthread' --prefix=/opt/freeware CPPFLAGS=-I/opt/freeware/include
>
> with export OBJECT_MODE=64 in the env (and libiconv from perzl.org RPMs - iconv is a serious pain).
>
> I have changed the TRE typedef from "wint_t" to "unsigned int" since that is what the other platforms use anyway.
>
> On my AIX7 VM I'm running out of memory in xz when lazy-loading is enabled which his odd - the VM has 4Gb which one would think should be enough. The symptom is that installing MASS fails when creating lazy-load rds or the same happens when running make check as memCompress() test for xz fails. I wish there was a way to disable xz altogether..
>
> I'd like to get IBM compilers to work first since those are the official ones. I may try gcc later, but I'm really interested in the IBM ones because that gives us a good non-GNU test (e.g., TRE fails in JIT due some alleged GNUisms so you can't use the strict compiler mode).
>
> Cheers,
> Simon
>
>
> On Jan 3, 2016, at 10:59 AM, Michael Felt <aixtools at gmail.com> wrote:
>
>> On 2016-01-01 23:48, peter dalgaard wrote:
>>> Nice catch you two!!!
>>>
>>> Happy New Year
>>> -pd
>> I am much happier with this great start!
>>
>> Simon - which compiler)s) did you use: xlc and xlfortran, or gcc/gfortran?
>>
>> I have made some changes to configure(.ac) so maybe my problems are self-inflicted. But would be good to know what environment you are using.
>>
>> Thanks for looking - and finding!!!
>>
>> Michael
>>>> On 01 Jan 2016, at 22:06 , Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>>>
>>>> Ok, found the problem - on platforms that support it TRE uses wint_t (from wchar.h) as its type for characters (tre_cint_t) which on AIX is *signed* int. TRE uses liberally conversions between int and tre_cint_t apparently assuming that the latter is unsigned so conversions back to int are suitable for comparisons etc. On other platforms wint_t is unsigned so it works. Manually defining tre_cint_t to unsigned int fixes the issue.
>>>>
>>>> Cheers,
>>>> Simon
>>>>
>>>>
>>>> On Jan 1, 2016, at 12:20 PM, Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>>>
>>>>> Michael,
>>>>>
>>>>> thanks, I'll have a look once my PDP VMs are up again (later today). This may be a signedness issue although it's unclear why other platforms wouldn't be affected.
>>>>>
>>>>> Cheers,
>>>>> Simon
>>>>>
>>>>>
>>>>> On Dec 31, 2015, at 10:14 AM, Michael Felt<aixtools at gmail.com>  wrote:
>>>>>
>>>>>> On 2015-12-30 09:58, Michael Felt wrote:
>>>>>>> On 2015-12-29 11:02, Michael Felt wrote:
>>>>>>>> This seems to be a problem that goes back a long time - and I hope someone who understands what tre is suppossed to be doing will look at this.
>>>>>>>>
>>>>>>>> A short history of other people who have reported on this on different versions of AIX. I shall only add that I get the same results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>>>>>>>
>>>>>>>> Basically, with settings that work for AIX and 32-bit - the only changes being
>>>>>>>> -maix32 becomes -maix64
>>>>>>>> and
>>>>>>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>>>>>>>
>>>>>>>> Then to shorten the 'make' bla bla, first run just make, then
>>>>>>>>
>>>>>>>> cd src/library/tools
>>>>>>>> make -s sysdata
>>>>>>>>
>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed
>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed
>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 hours and 30 minutes ago)
>>>>>>>>
>>>>>>>> To that, to get debug data, I have
>>>>>>>>
>>>>>>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>>>>>>> * rm src/extra/tre/tre-match-parallel.o
>>>>>>>> * find . -name \*.so -exec rm {} \;
>>>>>>>> * make
>>>>>>>> * cd src/library/tools
>>>>>>>> * make -s sysdata
>>>>>>>>
>>>>>>>> Attached are the two script files of the screen output. The 32-bit one is more verbose - and contains magically lines such as:
>>>>>>>> found match 3037fd14 (while "found" does not occur in the 64-bit output)
>>>>>>>>
>>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc /tmp/sysdata.??.*
>>>>>>>>    4730   14123  139916 /tmp/sysdata.32.text
>>>>>>>>    1312    3688   40528 /tmp/sysdata.64.text
>>>>>>>>    6042   17811  180444 total
>>>>>>>>
>>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep -c found /tmp/sysdata.??.*
>>>>>>>> /tmp/sysdata.32.text:19
>>>>>>>> /tmp/sysdata.64.text:0
>>>>>>>>
>>>>>>>>
>>>>>>>> Hope this brings us (or me), closer to a resolution to an old concern.
>>>>>>>>
>>>>>>>> And, best wishes for the new year!
>>>>>>>>
>>>>>>>> Michael
>>>>>>>>
>>>>>>>>
>>>>>>> Still hoping for someones curiosity/willingness.
>>>>>>>
>>>>>>> The differences show up in the first comparision that is made (of the string "3.2.3" it seems) - 32-bit is on the left, 64-bit on the right.
>>>>>>>
>>>>>>> Script command is started on Tue Dec 29 08:39:16 UTC 2015.                     |  Script command is started on Tue Dec 29 08:39:56 UTC 2015.
>>>>>>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make -s sysdata     |  root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make -s sysdata
>>>>>>> installing 'sysdata.rda'                                                       |  installing 'sysdata.rda'
>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>>>> length: -1                                                                     |  length: -1
>>>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>>>> init>  30380200 3038014c 30380098                                             |   init>  110cc3040 110cc2f28 110cc2e10
>>>>>>> match end offset = -1                                                          |  match end offset = -1
>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>>>> length: -1                                                                     |  length: -1
>>>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>>> 0: 3/00051 | 3037fb88/0:0                                                    |    0: 3/00051 | 110cc3310/0:0
>>>>>>> 1: ./00046 | 3037fb88/0:0                                                    |    1: ./00046 | 110cc3310/0:0
>>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>>> 1: ./00046 | 3037fb88/0:1                                                    |    1: ./00046 | 110cc3310/0:1
>>>>>>> 2: 2/00050 | 3037fb88/0:1                                                    |    2: 2/00050 | 110cc3310/0:1
>>>>>>> assertion failed                                                               |  assertion failed
>>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>>> 2: 2/00050 | 3037fc18/0:1 3037fb88/0:2                                       |    2: 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:2                                       |    3: ./00046 | 110cc33f0/0:1 110cc3310/0:2
>>>>>>> assertion failed                           *** DIFFERENCE ***                  |   init>  110cc3310
>>>>>>> init>  3037fb88                                                               |    3: ./00046 | 110cc3310/0:3
>>>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:3                                       |    4: 3/00051 | 110cc3310/0:3
>>>>>>> 4: 3/00051 | 3037fc18/0:1 3037fb88/0:3                                       |  assertion failed
>>>>>>> assertion failed                                                               |   init>  110cc3310
>>>>>>> init>  3037fb88                                                               |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>>>>>> 4: 3/00051 | 3037fc18/0:3 3037fb88/0:4                                       |    5: /00000 | 110cc33f0/0:3 110cc3310/0:4
>>>>>>> 5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init>  110cc3310
>>>>>>> found match 3037fd14 *** DIFFERENCE ***                   |  match end offset = -1
>>>>>>> match end offset = 5 *** DIFFERENCE ***                   |  tre_tnfa_run_parallel, input type 1
>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>>>> -------------+------------------------------------------------                 |   init>  110cc4780 110cc4668 110cc4550
>>>>>>> init>  303811c0 3038110c 30381058                                             |  match end offset = -1
>>>>>>> match end offset = -1                                                          |  tre_tnfa_run_parallel, input type 1
>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>>>> -------------+------------------------------------------------                 |   init>  110cc5700 110cc55e8 110cc54d0
>>>>>>>
>>>>>> One day further - looks like tre_compile (or just before, after all).
>>>>>>
>>>>>> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see (snip)
>>>>>>
>>>>>> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
>>>>>> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
>>>>>> @@ -1,5 +1,5 @@
>>>>>> - Script command is started on Thu Dec 31 15:04:39 2015.
>>>>>> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make sysdata
>>>>>> + Script command is started on Thu Dec 31 15:08:43 2015.
>>>>>> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make sysdata
>>>>>> installing 'sysdata.rda'
>>>>>> echo "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" | \
>>>>>>   R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
>>>>>> @@ -167,7 +167,7 @@
>>>>>> initial: 1/1,0, assert 0
>>>>>> initial: 0/0, assert 0
>>>>>> initial: 0/0, assert 0
>>>>>> - final state 30370718
>>>>>> + final state 110cba530
>>>>>> tre_compile: parsing '(^|[^%])(%%)*%V'
>>>>>> AST:
>>>>>> catenation, sub 0, 0 tags
>>>>>> @@ -177,7 +177,7 @@
>>>>>>         assertions: bol
>>>>>>         union, sub -1, 0 tags
>>>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>       iteration {0, -1}, sub -1, 0 tags, greedy
>>>>>>         catenation, sub 2, 0 tags
>>>>>>           literal (%, %) (37, 37), pos 1, sub -1, 0 tags
>>>>>> @@ -197,7 +197,7 @@
>>>>>> Union
>>>>>> Literal 0-36
>>>>>> After union left
>>>>>> - Literal 38-65535
>>>>>> + Literal 38--1
>>>>>> After union right
>>>>>> After union right
>>>>>>   num_tags += 2
>>>>>> @@ -231,7 +231,7 @@
>>>>>>         assertions: bol
>>>>>>         union, sub -1, 0 tags
>>>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>       iteration {0, -1}, sub -1, 2 tags, greedy
>>>>>>         catenation, sub 2, 1 tags
>>>>>>           literal (%, %) (37, 37), pos 1, sub -1, 1 tags
>>>>>> @@ -255,7 +255,7 @@
>>>>>> Union
>>>>>> Literal 0-36
>>>>>> After union left
>>>>>> - Literal 38-65535
>>>>>> + Literal 38--1
>>>>>> After union right
>>>>>> After union right
>>>>>> tre_add_tag_right: tag 3
>>>>>> @@ -342,7 +342,7 @@
>>>>>>           catenation, sub -1, 0 tags
>>>>>>             union, sub -1, 0 tags
>>>>>>               literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>             tag 4
>>>>>>
>>>>>> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 64-bit mode.
>>>>>>
>>>>>> I suspect I will "find it" - but a proposed change is appreciated.
>>>>>>
>>>>>> Happy New Year,
>>>>>> Michael
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Mon Jan  4 15:52:24 2016
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 4 Jan 2016 09:52:24 -0500
Subject: [Rd] R,
	AIX 64-bit builds - trying to understand root cause for message:
	"Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <568A1285.5000709@gmail.com>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
	<56894556.3020902@gmail.com>
	<5138BF7E-44C2-4ABE-9D3F-0730BCF90BC9@r-project.org>
	<568A1285.5000709@gmail.com>
Message-ID: <11C4A052-1585-41A9-BFBD-1756E6DC8B96@r-project.org>


On Jan 4, 2016, at 1:34 AM, Michael Felt <aixtools at gmail.com> wrote:

> I would be "pleased" if you would try packages - i.e., none of "Toolbox" or Perzl rpm's.
> 

R requires iconv, so you have to get that somehow. I tried to bypass the check and build it anyway against the system one, but that fails as there is a iconv conversion further down the line that is not supported. Building iconv is a PITA because it conflicts with the system one so other tools break when you modify the load path. Perzl's iconv fixes that by incorporating both the system objects and the GNU ones into the same binary and that seems to work reliably so far. That is the only dependency I was using (his iconv doesn't have any dependencies itself).


> The iconv I supply might not be working as is (I will need to install a new system to check). However, this is why I have been testing with R-3.2.3 - to side-step the system library dependencies.
> 
> re: xz - I have "installp" version - and any of my packages should work side-by-side with the Toolbox/.rpm files - my PATH prefix is /opt (so, /opt/bin and /opt/sbin rather than /usr/bin, /usr/local/bin (etc.).
> 

It fails even with the built-in one in R so it has nothing to do with the xz used itself.


> I am testing on a Power6, usually with 2 to 4G RAM active. When I get the compile to finish I will up to 8G to test some data processing that fails with the 32-bit limitations.
> 
> Another question: are you also getting lots of duplicate symbol warnings? Curious me. If you are I would like to send my modifications to configure(.ac) for you to test (I put .ac in () because I am actually editting configure atm but shall put them into configure.ac when I finish)
> 

No, no duplicate warnings.


> FYI: I shall be downloading the "try and buy" xlc and xlfortran - and I think you will certainly prefer my packaging then as they work without the libgc dependencies that many of the rpm packages need.
> 
> And, at your option - we can take this discussion over tools - "out of forums". Or at least start a new thread.
> 

We could leave the list out and create a Wiki or something with the results of our tests.


> re: unsigned short - I have adopted the convention to use the *NN_t types after running into a problem with unsigned longlong (from a very old program). It goes back many years - and maybe they have finalized short to mean 16-bits - but I remember when short was meant to help when moving from 16-bit to 32-bit and the "word" size changed - i.e., int became 32-bit same as long. nd for a long (no pun intended) long was 32-bit and long long was 64-bit. Those definitions are extinct.
> 

I'm not sure what you refer here - the issue with TRE has nothing to do with short - it can take any int type and like I said most platforms use unsigned int which is big enough on all platforms.


> imho - the standard for wint_t is wrong as well - based on an assumption about how "short" is defined. And, I consider it poor practice that there are som many cases of type cast switches between ushort and int.
> 

Not really - it doesn't care about short at all - note that the short typedef is never actually used on AIX since it has wchar support so TRE is only using int.

Cheers,
Simon


> Michael
> 
> On 04-Jan-16 01:26, Simon Urbanek wrote:
>> Michael,
>> 
>> I'm using xlc + xlf - the exact flags are
>> 
>> configure CC=xlc_r CXX=xlc++_r F77=xlf_r FC=xlf95_r LIBS='-L/opt/freeware/lib /opt/freeware/lib/libiconv.a -lpthread' --prefix=/opt/freeware CPPFLAGS=-I/opt/freeware/include
>> 
>> with export OBJECT_MODE=64 in the env (and libiconv from perzl.org RPMs - iconv is a serious pain).
>> 
>> I have changed the TRE typedef from "wint_t" to "unsigned int" since that is what the other platforms use anyway.
>> 
>> On my AIX7 VM I'm running out of memory in xz when lazy-loading is enabled which his odd - the VM has 4Gb which one would think should be enough. The symptom is that installing MASS fails when creating lazy-load rds or the same happens when running make check as memCompress() test for xz fails. I wish there was a way to disable xz altogether..
>> 
>> I'd like to get IBM compilers to work first since those are the official ones. I may try gcc later, but I'm really interested in the IBM ones because that gives us a good non-GNU test (e.g., TRE fails in JIT due some alleged GNUisms so you can't use the strict compiler mode).
>> 
>> Cheers,
>> Simon
>> 
>> 
>> On Jan 3, 2016, at 10:59 AM, Michael Felt <aixtools at gmail.com> wrote:
>> 
>>> On 2016-01-01 23:48, peter dalgaard wrote:
>>>> Nice catch you two!!!
>>>> 
>>>> Happy New Year
>>>> -pd
>>> I am much happier with this great start!
>>> 
>>> Simon - which compiler)s) did you use: xlc and xlfortran, or gcc/gfortran?
>>> 
>>> I have made some changes to configure(.ac) so maybe my problems are self-inflicted. But would be good to know what environment you are using.
>>> 
>>> Thanks for looking - and finding!!!
>>> 
>>> Michael
>>>>> On 01 Jan 2016, at 22:06 , Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>>>> 
>>>>> Ok, found the problem - on platforms that support it TRE uses wint_t (from wchar.h) as its type for characters (tre_cint_t) which on AIX is *signed* int. TRE uses liberally conversions between int and tre_cint_t apparently assuming that the latter is unsigned so conversions back to int are suitable for comparisons etc. On other platforms wint_t is unsigned so it works. Manually defining tre_cint_t to unsigned int fixes the issue.
>>>>> 
>>>>> Cheers,
>>>>> Simon
>>>>> 
>>>>> 
>>>>> On Jan 1, 2016, at 12:20 PM, Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>>>> 
>>>>>> Michael,
>>>>>> 
>>>>>> thanks, I'll have a look once my PDP VMs are up again (later today). This may be a signedness issue although it's unclear why other platforms wouldn't be affected.
>>>>>> 
>>>>>> Cheers,
>>>>>> Simon
>>>>>> 
>>>>>> 
>>>>>> On Dec 31, 2015, at 10:14 AM, Michael Felt<aixtools at gmail.com>  wrote:
>>>>>> 
>>>>>>> On 2015-12-30 09:58, Michael Felt wrote:
>>>>>>>> On 2015-12-29 11:02, Michael Felt wrote:
>>>>>>>>> This seems to be a problem that goes back a long time - and I hope someone who understands what tre is suppossed to be doing will look at this.
>>>>>>>>> 
>>>>>>>>> A short history of other people who have reported on this on different versions of AIX. I shall only add that I get the same results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>>>>>>>> 
>>>>>>>>> Basically, with settings that work for AIX and 32-bit - the only changes being
>>>>>>>>> -maix32 becomes -maix64
>>>>>>>>> and
>>>>>>>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>>>>>>>> 
>>>>>>>>> Then to shorten the 'make' bla bla, first run just make, then
>>>>>>>>> 
>>>>>>>>> cd src/library/tools
>>>>>>>>> make -s sysdata
>>>>>>>>> 
>>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed
>>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed
>>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 hours and 30 minutes ago)
>>>>>>>>> 
>>>>>>>>> To that, to get debug data, I have
>>>>>>>>> 
>>>>>>>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>>>>>>>> * rm src/extra/tre/tre-match-parallel.o
>>>>>>>>> * find . -name \*.so -exec rm {} \;
>>>>>>>>> * make
>>>>>>>>> * cd src/library/tools
>>>>>>>>> * make -s sysdata
>>>>>>>>> 
>>>>>>>>> Attached are the two script files of the screen output. The 32-bit one is more verbose - and contains magically lines such as:
>>>>>>>>> found match 3037fd14 (while "found" does not occur in the 64-bit output)
>>>>>>>>> 
>>>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc /tmp/sysdata.??.*
>>>>>>>>>   4730   14123  139916 /tmp/sysdata.32.text
>>>>>>>>>   1312    3688   40528 /tmp/sysdata.64.text
>>>>>>>>>   6042   17811  180444 total
>>>>>>>>> 
>>>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep -c found /tmp/sysdata.??.*
>>>>>>>>> /tmp/sysdata.32.text:19
>>>>>>>>> /tmp/sysdata.64.text:0
>>>>>>>>> 
>>>>>>>>> 
>>>>>>>>> Hope this brings us (or me), closer to a resolution to an old concern.
>>>>>>>>> 
>>>>>>>>> And, best wishes for the new year!
>>>>>>>>> 
>>>>>>>>> Michael
>>>>>>>>> 
>>>>>>>>> 
>>>>>>>> Still hoping for someones curiosity/willingness.
>>>>>>>> 
>>>>>>>> The differences show up in the first comparision that is made (of the string "3.2.3" it seems) - 32-bit is on the left, 64-bit on the right.
>>>>>>>> 
>>>>>>>> Script command is started on Tue Dec 29 08:39:16 UTC 2015.                     |  Script command is started on Tue Dec 29 08:39:56 UTC 2015.
>>>>>>>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make -s sysdata     |  root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make -s sysdata
>>>>>>>> installing 'sysdata.rda'                                                       |  installing 'sysdata.rda'
>>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>>>>> length: -1                                                                     |  length: -1
>>>>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>>>>> init>  30380200 3038014c 30380098                                             |   init>  110cc3040 110cc2f28 110cc2e10
>>>>>>>> match end offset = -1                                                          |  match end offset = -1
>>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>>>>> length: -1                                                                     |  length: -1
>>>>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>>>> 0: 3/00051 | 3037fb88/0:0                                                    |    0: 3/00051 | 110cc3310/0:0
>>>>>>>> 1: ./00046 | 3037fb88/0:0                                                    |    1: ./00046 | 110cc3310/0:0
>>>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>>>> 1: ./00046 | 3037fb88/0:1                                                    |    1: ./00046 | 110cc3310/0:1
>>>>>>>> 2: 2/00050 | 3037fb88/0:1                                                    |    2: 2/00050 | 110cc3310/0:1
>>>>>>>> assertion failed                                                               |  assertion failed
>>>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>>>> 2: 2/00050 | 3037fc18/0:1 3037fb88/0:2                                       |    2: 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>>>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:2                                       |    3: ./00046 | 110cc33f0/0:1 110cc3310/0:2
>>>>>>>> assertion failed                           *** DIFFERENCE ***                  |   init>  110cc3310
>>>>>>>> init>  3037fb88                                                               |    3: ./00046 | 110cc3310/0:3
>>>>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:3                                       |    4: 3/00051 | 110cc3310/0:3
>>>>>>>> 4: 3/00051 | 3037fc18/0:1 3037fb88/0:3                                       |  assertion failed
>>>>>>>> assertion failed                                                               |   init>  110cc3310
>>>>>>>> init>  3037fb88                                                               |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>>>>>>> 4: 3/00051 | 3037fc18/0:3 3037fb88/0:4                                       |    5: /00000 | 110cc33f0/0:3 110cc3310/0:4
>>>>>>>> 5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init>  110cc3310
>>>>>>>> found match 3037fd14 *** DIFFERENCE ***                   |  match end offset = -1
>>>>>>>> match end offset = 5 *** DIFFERENCE ***                   |  tre_tnfa_run_parallel, input type 1
>>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>>>>> -------------+------------------------------------------------                 |   init>  110cc4780 110cc4668 110cc4550
>>>>>>>> init>  303811c0 3038110c 30381058                                             |  match end offset = -1
>>>>>>>> match end offset = -1                                                          |  tre_tnfa_run_parallel, input type 1
>>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>>>>> -------------+------------------------------------------------                 |   init>  110cc5700 110cc55e8 110cc54d0
>>>>>>>> 
>>>>>>> One day further - looks like tre_compile (or just before, after all).
>>>>>>> 
>>>>>>> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see (snip)
>>>>>>> 
>>>>>>> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
>>>>>>> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
>>>>>>> @@ -1,5 +1,5 @@
>>>>>>> - Script command is started on Thu Dec 31 15:04:39 2015.
>>>>>>> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make sysdata
>>>>>>> + Script command is started on Thu Dec 31 15:08:43 2015.
>>>>>>> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make sysdata
>>>>>>> installing 'sysdata.rda'
>>>>>>> echo "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" | \
>>>>>>>  R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
>>>>>>> @@ -167,7 +167,7 @@
>>>>>>> initial: 1/1,0, assert 0
>>>>>>> initial: 0/0, assert 0
>>>>>>> initial: 0/0, assert 0
>>>>>>> - final state 30370718
>>>>>>> + final state 110cba530
>>>>>>> tre_compile: parsing '(^|[^%])(%%)*%V'
>>>>>>> AST:
>>>>>>> catenation, sub 0, 0 tags
>>>>>>> @@ -177,7 +177,7 @@
>>>>>>>        assertions: bol
>>>>>>>        union, sub -1, 0 tags
>>>>>>>          literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>>      iteration {0, -1}, sub -1, 0 tags, greedy
>>>>>>>        catenation, sub 2, 0 tags
>>>>>>>          literal (%, %) (37, 37), pos 1, sub -1, 0 tags
>>>>>>> @@ -197,7 +197,7 @@
>>>>>>> Union
>>>>>>> Literal 0-36
>>>>>>> After union left
>>>>>>> - Literal 38-65535
>>>>>>> + Literal 38--1
>>>>>>> After union right
>>>>>>> After union right
>>>>>>>  num_tags += 2
>>>>>>> @@ -231,7 +231,7 @@
>>>>>>>        assertions: bol
>>>>>>>        union, sub -1, 0 tags
>>>>>>>          literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>>      iteration {0, -1}, sub -1, 2 tags, greedy
>>>>>>>        catenation, sub 2, 1 tags
>>>>>>>          literal (%, %) (37, 37), pos 1, sub -1, 1 tags
>>>>>>> @@ -255,7 +255,7 @@
>>>>>>> Union
>>>>>>> Literal 0-36
>>>>>>> After union left
>>>>>>> - Literal 38-65535
>>>>>>> + Literal 38--1
>>>>>>> After union right
>>>>>>> After union right
>>>>>>> tre_add_tag_right: tag 3
>>>>>>> @@ -342,7 +342,7 @@
>>>>>>>          catenation, sub -1, 0 tags
>>>>>>>            union, sub -1, 0 tags
>>>>>>>              literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>>> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>>> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>>            tag 4
>>>>>>> 
>>>>>>> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 64-bit mode.
>>>>>>> 
>>>>>>> I suspect I will "find it" - but a proposed change is appreciated.
>>>>>>> 
>>>>>>> Happy New Year,
>>>>>>> Michael
>>>>>>> 
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>> 
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From lukas.stadler at oracle.com  Mon Jan  4 17:09:31 2016
From: lukas.stadler at oracle.com (Lukas Stadler)
Date: Mon, 4 Jan 2016 17:09:31 +0100
Subject: [Rd] deparse with parentheses for SUBSET
Message-ID: <EFE63DD3-7E5D-4C56-A7C1-32124558B863@oracle.com>

Hi,

maybe there?s a reason for it, but the discrepancy between the handling of `[` and `$` in deparsing seems odd to me:
> substitute(a[1], list(a = quote(x * y)))
x * y[1]
> substitute(a$b, list(a = quote(x * y)))
(x * y)$b

The former is still executed in the right order (`*` first, then `[`), which is not what you?d expect looking at the deparse result.
Some code that shows the execution order:
x <- 1; y <- 1; class(y) <- "foo"; `*.foo` <- function(...) -1; expr <- substitute(a[1], list(a=quote(x * y))); list(expr=expr, eval=eval(expr), "x * y[1]"=x * y[1], "(x * y)[1]"=(x * y)[1])

The following simple fix solves the problem for me:

diff -u -r A/src/main/deparse.c B/src/main/deparse.c
--- R-devel 2/src/main/deparse.c	2015-08-09 18:09:04.000000000 +0200
+++ R-devel/src/main/deparse.c	2016-01-04 16:15:09.000000000 +0100
@@ -971,7 +971,11 @@
 		    print2buff(")", d);
 		    break;
 		case PP_SUBSET:
+		    if ((parens = needsparens(fop, CAR(s), 1)))
+			print2buff("(", d);
 		    deparse2buff(CAR(s), d);
+		    if (parens)
+			print2buff(")", d);
 		    if (PRIMVAL(SYMVALUE(op)) == 1)
 			print2buff("[", d);
 		    else

With this applied, the output is more consistent:
> substitute(a[1], list(a = quote(x * y)))
(x * y)[1]
> substitute(a$b, list(a = quote(x * y)))
(x * y)$b

Best Regards,
 Lukas Stadler

From murdoch.duncan at gmail.com  Mon Jan  4 18:42:14 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 4 Jan 2016 12:42:14 -0500
Subject: [Rd] deparse with parentheses for SUBSET
In-Reply-To: <EFE63DD3-7E5D-4C56-A7C1-32124558B863@oracle.com>
References: <EFE63DD3-7E5D-4C56-A7C1-32124558B863@oracle.com>
Message-ID: <568AAEF6.4040407@gmail.com>

On 04/01/2016 11:09 AM, Lukas Stadler wrote:
> Hi,
>
> maybe there?s a reason for it, but the discrepancy between the handling of `[` and `$` in deparsing seems odd to me:
> > substitute(a[1], list(a = quote(x * y)))
> x * y[1]
> > substitute(a$b, list(a = quote(x * y)))
> (x * y)$b
>
> The former is still executed in the right order (`*` first, then `[`), which is not what you?d expect looking at the deparse result.
> Some code that shows the execution order:
> x <- 1; y <- 1; class(y) <- "foo"; `*.foo` <- function(...) -1; expr <- substitute(a[1], list(a=quote(x * y))); list(expr=expr, eval=eval(expr), "x * y[1]"=x * y[1], "(x * y)[1]"=(x * y)[1])
>
> The following simple fix solves the problem for me:
>
> diff -u -r A/src/main/deparse.c B/src/main/deparse.c
> --- R-devel 2/src/main/deparse.c	2015-08-09 18:09:04.000000000 +0200
> +++ R-devel/src/main/deparse.c	2016-01-04 16:15:09.000000000 +0100
> @@ -971,7 +971,11 @@
>   		    print2buff(")", d);
>   		    break;
>   		case PP_SUBSET:
> +		    if ((parens = needsparens(fop, CAR(s), 1)))
> +			print2buff("(", d);
>   		    deparse2buff(CAR(s), d);
> +		    if (parens)
> +			print2buff(")", d);
>   		    if (PRIMVAL(SYMVALUE(op)) == 1)
>   			print2buff("[", d);
>   		    else
>
> With this applied, the output is more consistent:
> > substitute(a[1], list(a = quote(x * y)))
> (x * y)[1]
> > substitute(a$b, list(a = quote(x * y)))
> (x * y)$b

No reason, just a bug.  I'll fix it.

Duncan Murdoch


From aixtools at gmail.com  Mon Jan  4 21:47:10 2016
From: aixtools at gmail.com (Michael Felt)
Date: Mon, 4 Jan 2016 21:47:10 +0100
Subject: [Rd] R,
 AIX 64-bit builds - trying to understand root cause for message:
 "Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <11C4A052-1585-41A9-BFBD-1756E6DC8B96@r-project.org>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
	<56894556.3020902@gmail.com>
	<5138BF7E-44C2-4ABE-9D3F-0730BCF90BC9@r-project.org>
	<568A1285.5000709@gmail.com>
	<11C4A052-1585-41A9-BFBD-1756E6DC8B96@r-project.org>
Message-ID: <568ADA4E.1000304@gmail.com>



On 04-Jan-16 15:52, Simon Urbanek wrote:
> On Jan 4, 2016, at 1:34 AM, Michael Felt <aixtools at gmail.com> wrote:
>
>> I would be "pleased" if you would try packages - i.e., none of "Toolbox" or Perzl rpm's.
>>
> R requires iconv, so you have to get that somehow. I tried to bypass the check and build it anyway against the system one, but that fails as there is a iconv conversion further down the line that is not supported. Building iconv is a PITA because it conflicts with the system one so other tools break when you modify the load path. Perzl's iconv fixes that by incorporating both the system objects and the GNU ones into the same binary and that seems to work reliably so far. That is the only dependency I was using (his iconv doesn't have any dependencies itself).
I would have to install another system and install perzl iconv - 
however, I assume that it also sits in /usr/lib (and/or has a symbolic 
link to it). I have mine installed in /opt/lib - so the default shared 
libraries look like:

cran at x065:[/home/cran/64/R]ldd /home/cran/64/R/bin/exec/R
/home/cran/64/R/bin/exec/R needs:
          /usr/lib/libc.a(shr_64.o)
          /usr/lib/libpthread.a(shr_xpg5_64.o)
          /opt/lib/libintl.a(libintl.so.8)
          /opt/lib/libiconv.a(libiconv.so.2)
          /unix
          /usr/lib/libcrypt.a(shr_64.o)
          /usr/lib/libpthread.a(shr_xpg5.o)
          /usr/lib/libc.a(shr.o)
          /usr/lib/libpthreads.a(shr_comm.o)
          /usr/lib/libcrypt.a(shr.o)

I have tested with adding my (gnu iconv) to the /usr/lib archive, as the 
search does seem to get corrupted.
For testing purposes I have added the 64-bit member to my 32-bit 
packaging - rather than a seperate archive in /opt/lib64

cran at x065:[/home/cran/64/R]ar -X32_64 -tv /opt/lib/libiconv.a
rwxr-xr-x     0/0     1010404 Nov 27 17:28 2014 libiconv.so.2
rwxr-xr-x     0/0     111901 Nov 27 17:28 2014 shr4.o
rwxr-xr-x     0/0     112151 Nov 27 17:28 2014 shr.o
rwxr-xr-x     0/0     1035470 Dec  3 15:11 2015 libiconv.so.2

I did something similiar to this for all the dependencies earlier when I 
was working with R-devel branch. When the build is finishing I will 
workout how to install both into a single archive (the hard part is a 
clean uninstall afterwards, and harder is managing an update. So, 
ideally, I will go to having one package with both 32 and 64 bit members.)

>
>> The iconv I supply might not be working as is (I will need to install a new system to check). However, this is why I have been testing with R-3.2.3 - to side-step the system library dependencies.
>>
>> re: xz - I have "installp" version - and any of my packages should work side-by-side with the Toolbox/.rpm files - my PATH prefix is /opt (so, /opt/bin and /opt/sbin rather than /usr/bin, /usr/local/bin (etc.).
>>
> It fails even with the built-in one in R so it has nothing to do with the xz used itself.
What is the built-in level - do not know off the top of my head. Perzl 
is 5.0.7 and I have been using 5.0.8 (when working with R-devel).

>
>
>> I am testing on a Power6, usually with 2 to 4G RAM active. When I get the compile to finish I will up to 8G to test some data processing that fails with the 32-bit limitations.
>>
>> Another question: are you also getting lots of duplicate symbol warnings? Curious me. If you are I would like to send my modifications to configure(.ac) for you to test (I put .ac in () because I am actually editting configure atm but shall put them into configure.ac when I finish)
>>
> No, no duplicate warnings.
Then I suspect the duplicate warnings have to do with how the m4 macros 
are processing the gcc -v flags (actually, the gfortran -v flags). 
Adding full path to libgcc.a and including -bexpall causes symbols to be 
imported and reexported - hence duplicate.

Another reason for me to get xlfortran installed and "test" against that 
as well.
>
>
>> FYI: I shall be downloading the "try and buy" xlc and xlfortran - and I think you will certainly prefer my packaging then as they work without the libgc dependencies that many of the rpm packages need.
>>
>> And, at your option - we can take this discussion over tools - "out of forums". Or at least start a new thread.
>>
> We could leave the list out and create a Wiki or something with the results of our tests.
I would be happy to sponsor that - either on my forums 
(http://forums.rootvg.net/aixtools/r-for-aix/) or I can look into how I 
create a userid for you on my aixtools wiki. I started something in 
November 
http://www.aixtools.net/index.php/Projects#%22Work%20in%20Progress%22, 
but basically, am waiting for better results before dedicating a page to 
R. In short, I would prefer the forums - as anyone could join the 
discussion without any intervention from me.
>
>
>> re: unsigned short - I have adopted the convention to use the *NN_t types after running into a problem with unsigned longlong (from a very old program). It goes back many years - and maybe they have finalized short to mean 16-bits - but I remember when short was meant to help when moving from 16-bit to 32-bit and the "word" size changed - i.e., int became 32-bit same as long. nd for a long (no pun intended) long was 32-bit and long long was 64-bit. Those definitions are extinct.
>>
> I'm not sure what you refer here - the issue with TRE has nothing to do with short - it can take any int type and like I said most platforms use unsigned int which is big enough on all platforms.
I claim no expertise. My observation is that UTF-XX seems to be 16-bit. 
I say seems, because there may be a multi-byte requirement that does not 
fit in 16-bits and then a larger size is appropriate. From my 
perspective (as a porter) it is easier to identify inconsistency when 
typedef definitions are not directly related to short, int or long. In 
binary it may not make any difference as far as sizeof() is concerned. I 
just hope for improved legibility.

I am not "r-project" - and my assumption is that "r-project" does the 
commits. My contribution is merely my opinion. What you decide is what 
counts - not my opinion.
>
>> imho - the standard for wint_t is wrong as well - based on an assumption about how "short" is defined. And, I consider it poor practice that there are som many cases of type cast switches between ushort and int.
>>
> Not really - it doesn't care about short at all - note that the short typedef is never actually used on AIX since it has wchar support so TRE is only using int.
You lost me here. I am aware that AIX has a very different set of 
include files that tre is not using. My perspective is that R is 
ignoring/overrulling any IBM/AIX wchar processing. See my "not an 
expert" defense above.

Mainly - I am happy that "make sysdata" is working.

p.s. I shall make a new entry on my forums re: where I am at now re:
Warning in solve.default(rgb) :
   unable to load shared object '/home/cran/64/R/modules//lapack.so':
   rtld: 0712-001 Symbol __powidf2 was referenced
       from module /home/cran/64/R/lib/libRlapack.so(), but a runtime 
definition
             of the symbol was not found.
rtld: 0712-001 Symbol _gfortran_pow_i4_i4 was referenced
       from module /home/cran/64/R/lib/libRlapack.so(), but a runtime 
definition
             of the symbol was not found.
rtld: 0712-001 Symbol 
_gfortran_compare_string/home/cran/64/R/lib/libRlapack.so was referenced
       from module /home/cran/64/R/lib/libRlapack.so(), but a runtime 
definition
             of the symbol was not found.
rtld: 0712-001 Symbol _gfortran_concat_string was referenced
       from module /home/cran/64/R/lib/libRlapack.so(), but a runtime 
definition
             of the symbol was not found.
rtld: 0712-002 fatal error: exiting.
Error in solve.default(rgb) : LAPACK routines cannot be loaded
Error: unable to load R code in package 'grDevices'

>
> Cheers,
> Simon
>
>
>> Michael
>>
>> On 04-Jan-16 01:26, Simon Urbanek wrote:
>>> Michael,
>>>
>>> I'm using xlc + xlf - the exact flags are
>>>
>>> configure CC=xlc_r CXX=xlc++_r F77=xlf_r FC=xlf95_r LIBS='-L/opt/freeware/lib /opt/freeware/lib/libiconv.a -lpthread' --prefix=/opt/freeware CPPFLAGS=-I/opt/freeware/include
>>>
>>> with export OBJECT_MODE=64 in the env (and libiconv from perzl.org RPMs - iconv is a serious pain).
>>>
>>> I have changed the TRE typedef from "wint_t" to "unsigned int" since that is what the other platforms use anyway.
>>>
>>> On my AIX7 VM I'm running out of memory in xz when lazy-loading is enabled which his odd - the VM has 4Gb which one would think should be enough. The symptom is that installing MASS fails when creating lazy-load rds or the same happens when running make check as memCompress() test for xz fails. I wish there was a way to disable xz altogether..
>>>
>>> I'd like to get IBM compilers to work first since those are the official ones. I may try gcc later, but I'm really interested in the IBM ones because that gives us a good non-GNU test (e.g., TRE fails in JIT due some alleged GNUisms so you can't use the strict compiler mode).
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>> On Jan 3, 2016, at 10:59 AM, Michael Felt <aixtools at gmail.com> wrote:
>>>
>>>> On 2016-01-01 23:48, peter dalgaard wrote:
>>>>> Nice catch you two!!!
>>>>>
>>>>> Happy New Year
>>>>> -pd
>>>> I am much happier with this great start!
>>>>
>>>> Simon - which compiler)s) did you use: xlc and xlfortran, or gcc/gfortran?
>>>>
>>>> I have made some changes to configure(.ac) so maybe my problems are self-inflicted. But would be good to know what environment you are using.
>>>>
>>>> Thanks for looking - and finding!!!
>>>>
>>>> Michael
>>>>>> On 01 Jan 2016, at 22:06 , Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>>>>>
>>>>>> Ok, found the problem - on platforms that support it TRE uses wint_t (from wchar.h) as its type for characters (tre_cint_t) which on AIX is *signed* int. TRE uses liberally conversions between int and tre_cint_t apparently assuming that the latter is unsigned so conversions back to int are suitable for comparisons etc. On other platforms wint_t is unsigned so it works. Manually defining tre_cint_t to unsigned int fixes the issue.
>>>>>>
>>>>>> Cheers,
>>>>>> Simon
>>>>>>
>>>>>>
>>>>>> On Jan 1, 2016, at 12:20 PM, Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>>>>>>
>>>>>>> Michael,
>>>>>>>
>>>>>>> thanks, I'll have a look once my PDP VMs are up again (later today). This may be a signedness issue although it's unclear why other platforms wouldn't be affected.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Simon
>>>>>>>
>>>>>>>
>>>>>>> On Dec 31, 2015, at 10:14 AM, Michael Felt<aixtools at gmail.com>  wrote:
>>>>>>>
>>>>>>>> On 2015-12-30 09:58, Michael Felt wrote:
>>>>>>>>> On 2015-12-29 11:02, Michael Felt wrote:
>>>>>>>>>> This seems to be a problem that goes back a long time - and I hope someone who understands what tre is suppossed to be doing will look at this.
>>>>>>>>>>
>>>>>>>>>> A short history of other people who have reported on this on different versions of AIX. I shall only add that I get the same results on AIX 5.3 TL7, AIX 6.1 TL9 and AIX 7.1 TL3.
>>>>>>>>>>
>>>>>>>>>> Basically, with settings that work for AIX and 32-bit - the only changes being
>>>>>>>>>> -maix32 becomes -maix64
>>>>>>>>>> and
>>>>>>>>>> export OBJECT_MODE=32 becomes export OBJECT_MODE=64
>>>>>>>>>>
>>>>>>>>>> Then to shorten the 'make' bla bla, first run just make, then
>>>>>>>>>>
>>>>>>>>>> cd src/library/tools
>>>>>>>>>> make -s sysdata
>>>>>>>>>>
>>>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/38817/match=package+tools+malformed
>>>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/36886/match=package+tools+malformed
>>>>>>>>>> http://article.gmane.org/gmane.comp.lang.r.devel/23372/match=package+tools+malformed Date: 2010-01-25 06:55:41 GMT (5 years, 48 weeks, 1 day, 20 hours and 30 minutes ago)
>>>>>>>>>>
>>>>>>>>>> To that, to get debug data, I have
>>>>>>>>>>
>>>>>>>>>> * added -DTRE_DUGUG to src/extra/tre/Makefile # ALL_CFLAGS = $(ALL_CFLAGS_LO) -DTRE_DEBUG
>>>>>>>>>> * rm src/extra/tre/tre-match-parallel.o
>>>>>>>>>> * find . -name \*.so -exec rm {} \;
>>>>>>>>>> * make
>>>>>>>>>> * cd src/library/tools
>>>>>>>>>> * make -s sysdata
>>>>>>>>>>
>>>>>>>>>> Attached are the two script files of the screen output. The 32-bit one is more verbose - and contains magically lines such as:
>>>>>>>>>> found match 3037fd14 (while "found" does not occur in the 64-bit output)
>>>>>>>>>>
>>>>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]wc /tmp/sysdata.??.*
>>>>>>>>>>    4730   14123  139916 /tmp/sysdata.32.text
>>>>>>>>>>    1312    3688   40528 /tmp/sysdata.64.text
>>>>>>>>>>    6042   17811  180444 total
>>>>>>>>>>
>>>>>>>>>> root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]grep -c found /tmp/sysdata.??.*
>>>>>>>>>> /tmp/sysdata.32.text:19
>>>>>>>>>> /tmp/sysdata.64.text:0
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> Hope this brings us (or me), closer to a resolution to an old concern.
>>>>>>>>>>
>>>>>>>>>> And, best wishes for the new year!
>>>>>>>>>>
>>>>>>>>>> Michael
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>> Still hoping for someones curiosity/willingness.
>>>>>>>>>
>>>>>>>>> The differences show up in the first comparision that is made (of the string "3.2.3" it seems) - 32-bit is on the left, 64-bit on the right.
>>>>>>>>>
>>>>>>>>> Script command is started on Tue Dec 29 08:39:16 UTC 2015.                     |  Script command is started on Tue Dec 29 08:39:56 UTC 2015.
>>>>>>>>> root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make -s sysdata     |  root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make -s sysdata
>>>>>>>>> installing 'sysdata.rda'                                                       |  installing 'sysdata.rda'
>>>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>>>>>> length: -1                                                                     |  length: -1
>>>>>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>>>>>> init>  30380200 3038014c 30380098                                             |   init>  110cc3040 110cc2f28 110cc2e10
>>>>>>>>> match end offset = -1                                                          |  match end offset = -1
>>>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  tre_tnfa_run_parallel, input type 1
>>>>>>>>> length: -1                                                                     |  length: -1
>>>>>>>>> pos:chr/code | states and tags                                                 |  pos:chr/code | states and tags
>>>>>>>>> -------------+------------------------------------------------                 |  -------------+------------------------------------------------
>>>>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>>>>> 0: 3/00051 | 3037fb88/0:0                                                    |    0: 3/00051 | 110cc3310/0:0
>>>>>>>>> 1: ./00046 | 3037fb88/0:0                                                    |    1: ./00046 | 110cc3310/0:0
>>>>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>>>>> 1: ./00046 | 3037fb88/0:1                                                    |    1: ./00046 | 110cc3310/0:1
>>>>>>>>> 2: 2/00050 | 3037fb88/0:1                                                    |    2: 2/00050 | 110cc3310/0:1
>>>>>>>>> assertion failed                                                               |  assertion failed
>>>>>>>>> init>  3037fb88                                                               |   init>  110cc3310
>>>>>>>>> 2: 2/00050 | 3037fc18/0:1 3037fb88/0:2                                       |    2: 2/00050 | 110cc33f0/0:1 110cc3310/0:2
>>>>>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:2                                       |    3: ./00046 | 110cc33f0/0:1 110cc3310/0:2
>>>>>>>>> assertion failed                           *** DIFFERENCE ***                  |   init>  110cc3310
>>>>>>>>> init>  3037fb88                                                               |    3: ./00046 | 110cc3310/0:3
>>>>>>>>> 3: ./00046 | 3037fc18/0:1 3037fb88/0:3                                       |    4: 3/00051 | 110cc3310/0:3
>>>>>>>>> 4: 3/00051 | 3037fc18/0:1 3037fb88/0:3                                       |  assertion failed
>>>>>>>>> assertion failed                                                               |   init>  110cc3310
>>>>>>>>> init>  3037fb88                                                               |    4: 3/00051 | 110cc33f0/0:3 110cc3310/0:4
>>>>>>>>> 4: 3/00051 | 3037fc18/0:3 3037fb88/0:4                                       |    5: /00000 | 110cc33f0/0:3 110cc3310/0:4
>>>>>>>>> 5: /00000 | 3037fc18/0:3 3037fb88/0:4 |   init>  110cc3310
>>>>>>>>> found match 3037fd14 *** DIFFERENCE ***                   |  match end offset = -1
>>>>>>>>> match end offset = 5 *** DIFFERENCE ***                   |  tre_tnfa_run_parallel, input type 1
>>>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>>>>>> -------------+------------------------------------------------                 |   init>  110cc4780 110cc4668 110cc4550
>>>>>>>>> init>  303811c0 3038110c 30381058                                             |  match end offset = -1
>>>>>>>>> match end offset = -1                                                          |  tre_tnfa_run_parallel, input type 1
>>>>>>>>> tre_tnfa_run_parallel, input type 1                                            |  length: -1
>>>>>>>>> length: -1                                                                     |  pos:chr/code | states and tags
>>>>>>>>> pos:chr/code | states and tags                                                 |  -------------+------------------------------------------------
>>>>>>>>> -------------+------------------------------------------------                 |   init>  110cc5700 110cc55e8 110cc54d0
>>>>>>>>>
>>>>>>>> One day further - looks like tre_compile (or just before, after all).
>>>>>>>>
>>>>>>>> With TRE_DEBUG switched on in tre-compile.c and tre-ast.c I see (snip)
>>>>>>>>
>>>>>>>> --- /tmp/x.32   2015-12-31 15:09:44.000000000 +0000
>>>>>>>> +++ /tmp/x.64   2015-12-31 15:09:30.000000000 +0000
>>>>>>>> @@ -1,5 +1,5 @@
>>>>>>>> - Script command is started on Thu Dec 31 15:04:39 2015.
>>>>>>>> - root at x069:[/data/prj/cran/32/R-aix-3.2.3/src/library/tools]make sysdata
>>>>>>>> + Script command is started on Thu Dec 31 15:08:43 2015.
>>>>>>>> + root at x069:[/data/prj/cran/64/R-aix-3.2.3/src/library/tools]make sysdata
>>>>>>>> installing 'sysdata.rda'
>>>>>>>> echo "tools:::sysdata2LazyLoadDB(\"/data/prj/cran/R-3.2.3/src/library/tools/R/sysdata.rda\",\"../../../library/tools/R\")" | \
>>>>>>>>   R_DEFAULT_PACKAGES=NULL LC_ALL=C ../../../bin/R --vanilla --slave
>>>>>>>> @@ -167,7 +167,7 @@
>>>>>>>> initial: 1/1,0, assert 0
>>>>>>>> initial: 0/0, assert 0
>>>>>>>> initial: 0/0, assert 0
>>>>>>>> - final state 30370718
>>>>>>>> + final state 110cba530
>>>>>>>> tre_compile: parsing '(^|[^%])(%%)*%V'
>>>>>>>> AST:
>>>>>>>> catenation, sub 0, 0 tags
>>>>>>>> @@ -177,7 +177,7 @@
>>>>>>>>         assertions: bol
>>>>>>>>         union, sub -1, 0 tags
>>>>>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>>>       iteration {0, -1}, sub -1, 0 tags, greedy
>>>>>>>>         catenation, sub 2, 0 tags
>>>>>>>>           literal (%, %) (37, 37), pos 1, sub -1, 0 tags
>>>>>>>> @@ -197,7 +197,7 @@
>>>>>>>> Union
>>>>>>>> Literal 0-36
>>>>>>>> After union left
>>>>>>>> - Literal 38-65535
>>>>>>>> + Literal 38--1
>>>>>>>> After union right
>>>>>>>> After union right
>>>>>>>>   num_tags += 2
>>>>>>>> @@ -231,7 +231,7 @@
>>>>>>>>         assertions: bol
>>>>>>>>         union, sub -1, 0 tags
>>>>>>>>           literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>>>> -           literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>>>> +           literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>>>       iteration {0, -1}, sub -1, 2 tags, greedy
>>>>>>>>         catenation, sub 2, 1 tags
>>>>>>>>           literal (%, %) (37, 37), pos 1, sub -1, 1 tags
>>>>>>>> @@ -255,7 +255,7 @@
>>>>>>>> Union
>>>>>>>> Literal 0-36
>>>>>>>> After union left
>>>>>>>> - Literal 38-65535
>>>>>>>> + Literal 38--1
>>>>>>>> After union right
>>>>>>>> After union right
>>>>>>>> tre_add_tag_right: tag 3
>>>>>>>> @@ -342,7 +342,7 @@
>>>>>>>>           catenation, sub -1, 0 tags
>>>>>>>>             union, sub -1, 0 tags
>>>>>>>>               literal (, $) (0, 36), pos 0, sub -1, 0 tags
>>>>>>>> -               literal (&, M-^?) (38, 65535), pos 0, sub -1, 0 tags
>>>>>>>> +               literal (&, M-^?) (38, -1), pos 0, sub -1, 0 tags
>>>>>>>>             tag 4
>>>>>>>>
>>>>>>>> It seems in 32-bit mode -1 is unsigned (65535) but -1 == -1 in 64-bit mode.
>>>>>>>>
>>>>>>>> I suspect I will "find it" - but a proposed change is appreciated.
>>>>>>>>
>>>>>>>> Happy New Year,
>>>>>>>> Michael
>>>>>>>>
>>>>>>>> ______________________________________________
>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel


From aixtools at gmail.com  Mon Jan  4 23:24:17 2016
From: aixtools at gmail.com (Michael Felt)
Date: Mon, 4 Jan 2016 23:24:17 +0100
Subject: [Rd] R,
 AIX 64-bit builds - trying to understand root cause for message:
 "Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <11C4A052-1585-41A9-BFBD-1756E6DC8B96@r-project.org>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
	<56894556.3020902@gmail.com>
	<5138BF7E-44C2-4ABE-9D3F-0730BCF90BC9@r-project.org>
	<568A1285.5000709@gmail.com>
	<11C4A052-1585-41A9-BFBD-1756E6DC8B96@r-project.org>
Message-ID: <568AF111.8030900@gmail.com>

The bulk is on my forums - the final post for today is:

Results to date:

A. It looks like I am going to need a newer compiler for C - xlc/xlC V11 
apparently does not understand this code:

"/data/prj/cran/R-3.2.3/src/main/memory.c", line 2149.31: 1506-046 (S) 
Syntax error.

I will have to check if R-devel has different code before asking for 
assistence.

  +2139  #ifdef HAVE_STDALIGN_H
  +2140  # include <stdalign.h>
  +2141  #endif
  +2142
  +2143  #include <stdint.h>
  +2144
  +2145  long double *R_allocLD(size_t nelem)
  +2146  {
  +2147  #if __alignof_is_defined
  +2148      // This is C11: picky compilers may warn.
  +2149      size_t ld_align = alignof(long double);
  +2150  #elif __GNUC__
  +2151      // This is C99, but do not rely on it.
  +2152      size_t ld_align = offsetof(struct { char __a; long double 
__b; }, __b);
  +2153  #else
  +2154      size_t ld_align = 0x0F; // value of x86_64, known others 
are 4 or 8
  +2155  #endif
  +2156      if (ld_align > 8) {
  +2157          uintptr_t tmp = (uintptr_t) R_alloc(nelem + 1, 
sizeof(long double));
  +2158          tmp = (tmp + ld_align - 1) & ~ld_align;
  +2159          return (long double *) tmp;
  +2160      } else {
  +2161          return (long double *) R_alloc(nelem, sizeof(long double));
  +2162      }
  +2163  }

If someone has a suggestion for how to test/fix so that I can proceed 
with an older xlc compiler, that would be great!
If not, I shall download the try and buy C compiler to test.

On 04-Jan-16 15:52, Simon Urbanek wrote:
> No, no duplicate warnings.
>
B. There is a very big difference in the way libraries are made when 
gcc/gfortran are not used.

When gcc is being used "everything" is being turned into a shared 
library. The only library I seem to be able
to affect via configure is libR.so (yes/no). The snip here shows that 
all members of the .a archives are
"non-shared" objects rather that a combined group of .o files into a 
single .so shared object.

So, it is not surprising that there are no duplicate symbols.

cran at x068:[/home/cran/64/R]dump -H src/*/*.a | head

src/appl/libappl.a[integrate.o]:

Loader section is not available

src/appl/libappl.a[interv.o]:

Loader section is not available

src/appl/libappl.a[maxcol.o]:
>> >FYI: I shall be downloading the "try and buy" xlc and xlfortran - and I think you will certainly prefer my packaging then as they work without the libgc dependencies that many of the rpm packages need.
>> >
>> >And, at your option - we can take this discussion over tools - "out of forums". Or at least start a new thread.
>> >
> We could leave the list out and create a Wiki or something with the results of our tests.
>
>
>> >re: unsigned short - I have adopted the convention to use the *NN_t types after running into a problem with unsigned longlong (from a very old program). It goes back many years - and maybe they have finalized short to mean 16-bits - but I remember when short was meant to help when moving from 16-bit to 32-bit and the "word" size changed - i.e., int became 32-bit same as long. nd for a long (no pun intended) long was 32-bit and long long was 64-bit. Those definitions are extinct.
>> >
> I'm not sure what you refer here - the issue with TRE has nothing to do with short - it can take any int type and like I said most platforms use unsigned int which is big enough on all platforms.
>
>
>> >imho - the standard for wint_t is wrong as well - based on an assumption about how "short" is defined. And, I consider it poor practice that there are som many cases of type cast switches between ushort and int.
>> >
> Not really - it doesn't care about short at all - note that the short typedef is never actually used on AIX since it has wchar support so TRE is only using int.
>
> Cheers,
> Simon
>
>


From joshmobrien at gmail.com  Tue Jan  5 01:16:51 2016
From: joshmobrien at gmail.com (Josh O'Brien)
Date: Mon, 4 Jan 2016 16:16:51 -0800
Subject: [Rd] For integer vectors, `as(x, "numeric")` has no effect.
Message-ID: <CAOwKfPTvi0qzJ0V9mHb9w98zKAh_Qzr3CfN58Brw2yX5Sy5coQ@mail.gmail.com>

On Dec 19, 2015, at 3:32 AM, Martin Maechler <maechler at
stat.math.ethz.ch> wrote:

>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>    on Sat, 12 Dec 2015 10:32:51 +0100 writes:
>
>>>>>> John Chambers <jmc at r-project.org>
>>>>>>    on Fri, 11 Dec 2015 10:11:05 -0800 writes:
>
>>> Somehow, the most obvious fixes are always back-incompatible these days.
>>> The example intrigued me, so I looked into it a bit (should have been doing something else, but ....)
>
>>> You're right that this is the proverbial thin-edge-of-the-wedge.
>
>>> The problem is in setDataPart(), which will be called whenever a class extends one of the vector types.
>
>>> It does
>>> as(value, dataClass)
>>> The key point is that the third argument to as(), strict=TRUE by default.  So, yes, the change will cause all integer vectors to become double when the class extends "numeric".  Generally, strict=TRUE makes sense here and of course changing THAT would open up yet more incompatibilities.
>
>>> For back compatibility, one would have to have some special code in setDataPart() for the case of integer/numeric.
>
>>> John
>
>>> (Historically, the original sin was probably not making a distinction between "numeric" as a virtual class and "double" as a type/class.)
>
>> Yes, indeed.  In the mean time, I've seen more cases where
>> "the change will cause all integer vectors to become double when the class  extends "numeric".
>> seems detrimental.
>
>> OTOH, I still think we could go in the right direction ---
>> hopefully along the wishes of bioconductor S4 development, see
>> Martin Morgan's e-mail:
>
>> [This is all S4 - only; should not much affect base R / S3]
>> Currently,   "integer" is a subclass of "numeric"  and so the
>> "integer become double" part seems unwanted to me.
>> OTOH,  it would really make sense to more formally
>> have the basic subclasses of  "numeric" to be "integer" and "double",
>> and  to let  as(*, "double") to become different to as(*, "numeric")
>> [Again, this is just for the S4 classes and as() coercions, *not* e.g.
>> for as.numeric() / as.double() !]
>
>> In the DEPRECATED part of the NEWS for R 2.7.0 (April 2008) we
>> have had
>
>> o    The S4 pseudo-classes "single" and double have been removed.
>> (The S4 class for a REALSXP is "numeric": for back-compatibility
>> as(x, "double") coerces to "numeric".)
>
>> I think the removal of "single" was fine, but in hindsight,
>> maybe the removal of "double" -- which was partly broken then --
>> possibly could rather have been a fixup of "double" along the
>> following
>
>> Current "thought experiment proposal" :
>
>> 1) "numeric" := {"integer", "double"}   { class - subclasses }
>> 2) as(1L, "numeric")  continues to return 1L .. since integer is
>> one case of "numeric"
>> 3) as(1L, "double")  newly returns 1.0   {and in fact would be
>> "equivalent" to   as.double(1L)}
>
>> After the above change,  S4  as(*, "double") would correspond to S3 as.double
>> but  as(*, "numeric")  would continue to differ from
>> as.numeric(*), the former *not* changing integers to double.
>
>> Martin
>
> Also note that e.g.
>
>    class(pi)    would return "double" instead of "numeric"
>
> and this will break all the bad programming style usages of
>
>  if(class(x) == "numeric")
>
> which I tend to see in gazillions of user and even package codes
> This bad (aka error prone !)  because "correct" usage would be
>
>  if(inherits(x, "numeric"))
>
> and that of course would *not* break after the change above.
>
> - - - -
>
> A week later, I'm still pretty convinced it would be worth going
> in the direction proposed above.
>
> But I was actually hoping for some encouragement or "mental support"...
> or then to hear why you think the proposition is not good or not
> viable ...
>
>

I really like Martin Maechler's "thought experiment proposal", but (based
partly on the reception its gotten) figure I mustn't be appreciating
the complications
it would introduce..

That said, if it's decided to just make a smaller fix of as(x, "numeric"),
might it be better to make the change at the C level, to R_set_class
in $RHOME/src/main/coerce.c?

Here's the 'offending' bit of R_set_class (the C-code implementing the
R function `class<-`), which treats an INTSXP in the same way as a
REALSXP, breaking before it get coerced to REALSXP:

  else if(!strcmp("numeric", valueString)) {
      setAttrib(obj, R_ClassSymbol, R_NilValue);
      if(IS_S4_OBJECT(obj)) /* NULL class is only valid for S3 objects */
        do_unsetS4(obj, value);
      switch(TYPEOF(obj)) {
      case INTSXP: case REALSXP: break;
      default: PROTECT(obj = coerceVector(obj, REALSXP));
      nProtect++;
      }
  }

Simply deleting "case INTSXP: " will let integer vectors pass
through and get converted to REALSXP by coerceVector().

This approach has a couple of advantages that (unless I'm missing
something) make it seem relatively clean:

  - It requires no additional explicit S4 "coerce" method for
    signature c("integer", "numeric").

  - It simultaneously fixes the behavior of `class<-` (also mentioned
    in my OP) so that it too will convert an "integer" vector to one
    of class "numeric" when a user asks it to.  (Not that they
    "should" be doing that, given the admonition in ?class).


FWIW, I've recompiled R with the simple modification mentioned above.
It passes all tests in "make check" until it reaches one very similar
to that presented by Martin Maechler back on December 11th, failing it
for the same reason (i.e. conversion of the integer vector to
"numeric" by the call to as() in setDataPart()). Here's the test and
its outcome:

    setClass("NumX", contains="numeric", representation(id="character"))
    nn = new("NumX", 1:10, id="test")
    stopifnot(identical(1:10, S3Part(nn, strict = TRUE)))
    ## Error: identical(1:10, S3Part(nn, strict = TRUE)) is not TRUE
    ## Execution halted



>>> On Dec 11, 2015, at 1:25 AM, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
>
>>>>>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>>>> on Tue, 8 Dec 2015 15:25:21 +0100 writes:
>>>>
>>>>>>>>> John Chambers <jmc at r-project.org>
>>>>>>>>> on Mon, 7 Dec 2015 16:05:59 -0800 writes:
>>>>
>>>>>> We do need an explicit method here, I think.
>>>>>> The issue is that as() uses methods for the generic function coerce() but cannot use inheritance in the usual way (if it did, you would be immediately back with no change, since "integer" inherits from "numeric").
>>>>
>>>>>> Copying in the general method for coercing to "numeric" as an explicit method for "integer" gives the expected result:
>>>>
>>>>>>> setMethod("coerce", c("integer", "numeric"), getMethod("coerce", c("ANY", "numeric")))
>>>>>> [1] "coerce"
>>>>>>> typeof(as(1L, "numeric"))
>>>>>> [1] "double"
>>>>
>>>>>> Seems like a reasonable addition to the code, unless someone sees a problem.
>>>>>> John
>>>>
>>>>> I guess that that some package checks (in CRAN + Bioc + ... -
>>>>> land) will break,
>>>>> but I still think we should add such a coercion to R.
>>>>
>>>>> Martin
>>>>
>>>> Hmm...  I've tried to add the above to R
>>>> and do notice that there are consequences that may be larger than
>>>> anticipated:
>>>>
>>>> Here is example code:
>>>>
>>>> myN   <- setClass("myN",   contains="numeric")
>>>> myNid <- setClass("myNid", contains="numeric", representation(id="character"))
>>>> NN <-    setClass("NN", representation(x="numeric"))
>>>>
>>>> (m1 <- myN  (1:3))
>>>> (m2 <- myNid(1:3, id = "i3"))
>>>> tools::assertError(NN (1:3))# in all R versions
>>>>
>>>> ##                     # current R  |  new R
>>>> ##                     # -----------|----------
>>>> class(getDataPart(m1)) # integer    |  numeric
>>>> class(getDataPart(m2)) # integer    |  numeric
>>>>
>>>>
>>>> In other words, with the above setting, the traditional
>>>> gentleperson's agreement in S and R,
>>>>
>>>> __ "numeric" sometimes conveniently means "integer" or "double"  __
>>>>
>>>> will be slightly less often used ... which of course may be a
>>>> very good thing.
>>>>
>>>> However, it breaks strict back compatibility also in cases where
>>>> the previous behavior may have been preferable:
>>>> After all integer vectors need only have the space of doubles.
>>>>
>>>> Shall we still go ahead and do apply this change to R-devel
>>>> and then all package others will be willing to update where necessary?
>>>>
>>>> As this may affect the many hundreds of bioconductor packages
>>>> using S4 classes, I am -- exceptionally -- cross posting to the
>>>> bioc-devel list.
>>>>
>>>> Martin Maechler
>>>>
>>>>
>>>>>> On Dec 7, 2015, at 3:37 PM, Benjamin Tyner <btyner at gmail.com> wrote:
>>>>
>>>>>>> Perhaps it is not that surprising, given that
>>>>>>>
>>>>>> mode(1L)
>>>>>>> [1] "numeric"
>>>>>>>
>>>>>>> and
>>>>>>>
>>>>>> is.numeric(1L)
>>>>>>> [1] TRUE
>>>>>>>
>>>>>>> On the other hand, this is curious, to say the least:
>>>>>>>
>>>>>> is.double(as(1L, "double"))
>>>>>>> [1] FALSE
>>>>>>>
>>>>>> Here's the surprising behavior:
>>>>>>
>>>>>> x <- 1L
>>>>>> xx <- as(x, "numeric")
>>>>>> class(xx)
>>>>>> ## [1] "integer"
>>>>>>
>>>>>> It occurs because the call to `as(x, "numeric")` dispatches the coerce
>>>>>> S4 method for the signature `c("integer", "numeric")`, whose body is
>>>>>> copied in below.
>>>>>>
>>>>>> function (from, to = "numeric", strict = TRUE)
>>>>>> if (strict) {
>>>>>> class(from) <- "numeric"
>>>>>> from
>>>>>> } else from
>>>>>>
>>>>>> This in turn does nothing, even when strict=TRUE, because that
>>>>>> assignment to class "numeric" has no effect:
>>>>>>
>>>>>> x <- 10L
>>>>>> class(x) <- "numeric"
>>>>>> class(x)
>>>>>> [1] "integer"
>>>>>>
>>>>>> Is this the desired behavior for `as(x, "numeric")`?
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel


From aixtools at gmail.com  Tue Jan  5 08:15:24 2016
From: aixtools at gmail.com (Michael Felt)
Date: Tue, 5 Jan 2016 08:15:24 +0100
Subject: [Rd] R,
 AIX 64-bit builds - trying to understand root cause for message:
 "Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <568AF111.8030900@gmail.com>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
	<56894556.3020902@gmail.com>
	<5138BF7E-44C2-4ABE-9D3F-0730BCF90BC9@r-project.org>
	<568A1285.5000709@gmail.com>
	<11C4A052-1585-41A9-BFBD-1756E6DC8B96@r-project.org>
	<568AF111.8030900@gmail.com>
Message-ID: <568B6D8C.4010200@gmail.com>



On 04-Jan-16 23:24, Michael Felt wrote:
> The bulk is on my forums - the final post for today is:
>
> Results to date:
>
> A. It looks like I am going to need a newer compiler for C - xlc/xlC 
> V11 apparently does not understand this code:
>
> "/data/prj/cran/R-3.2.3/src/main/memory.c", line 2149.31: 1506-046 (S) 
> Syntax error.
>
> I will have to check if R-devel has different code before asking for 
> assistence.
>
>  +2139  #ifdef HAVE_STDALIGN_H
>  +2140  # include <stdalign.h>
>  +2141  #endif
>  +2142
>  +2143  #include <stdint.h>
>  +2144
>  +2145  long double *R_allocLD(size_t nelem)
>  +2146  {
>  +2147  #if __alignof_is_defined
>  +2148      // This is C11: picky compilers may warn.
>  +2149      size_t ld_align = alignof(long double);
>  +2150  #elif __GNUC__
>  +2151      // This is C99, but do not rely on it.
>  +2152      size_t ld_align = offsetof(struct { char __a; long double 
> __b; }, __b);
>  +2153  #else
This is a hint/hack - with xlc V11 I get past a syntax "failure" with 
something like the following:
#if __alignof_is_defined
         long double ldbl = 0.0;
     // This is C11: picky compilers may warn.
     size_t ld_align = alignof(ldbl);
#elif __GNUC__

>  +2154 size_t ld_align = 0x0F; // value of x86_64, known others are 4 
> or 8
>  +2155  #endif
>  +2156      if (ld_align > 8) {
>  +2157          uintptr_t tmp = (uintptr_t) R_alloc(nelem + 1, 
> sizeof(long double));
>  +2158          tmp = (tmp + ld_align - 1) & ~ld_align;
>  +2159          return (long double *) tmp;
>  +2160      } else {
>  +2161          return (long double *) R_alloc(nelem, sizeof(long 
> double));
>  +2162      }
>  +2163  }
>
> If someone has a suggestion for how to test/fix so that I can proceed 
> with an older xlc compiler, that would be great!
> If not, I shall download the try and buy C compiler to test.
>
> On 04-Jan-16 15:52, Simon Urbanek wrote:
>> No, no duplicate warnings.
>>
> B. There is a very big difference in the way libraries are made when 
> gcc/gfortran are not used.
>
> When gcc is being used "everything" is being turned into a shared 
> library. The only library I seem to be able
> to affect via configure is libR.so (yes/no). The snip here shows that 
> all members of the .a archives are
> "non-shared" objects rather that a combined group of .o files into a 
> single .so shared object.
>
> So, it is not surprising that there are no duplicate symbols.
>
> cran at x068:[/home/cran/64/R]dump -H src/*/*.a | head
>
> src/appl/libappl.a[integrate.o]:
>
> Loader section is not available
>
> src/appl/libappl.a[interv.o]:
>
> Loader section is not available
>
> src/appl/libappl.a[maxcol.o]:
>>> >FYI: I shall be downloading the "try and buy" xlc and xlfortran - 
>>> and I think you will certainly prefer my packaging then as they work 
>>> without the libgc dependencies that many of the rpm packages need.
>>> >
>>> >And, at your option - we can take this discussion over tools - "out 
>>> of forums". Or at least start a new thread.
>>> >
>> We could leave the list out and create a Wiki or something with the 
>> results of our tests.
>>
>>
>>> >re: unsigned short - I have adopted the convention to use the *NN_t 
>>> types after running into a problem with unsigned longlong (from a 
>>> very old program). It goes back many years - and maybe they have 
>>> finalized short to mean 16-bits - but I remember when short was 
>>> meant to help when moving from 16-bit to 32-bit and the "word" size 
>>> changed - i.e., int became 32-bit same as long. nd for a long (no 
>>> pun intended) long was 32-bit and long long was 64-bit. Those 
>>> definitions are extinct.
>>> >
>> I'm not sure what you refer here - the issue with TRE has nothing to 
>> do with short - it can take any int type and like I said most 
>> platforms use unsigned int which is big enough on all platforms.
>>
>>
>>> >imho - the standard for wint_t is wrong as well - based on an 
>>> assumption about how "short" is defined. And, I consider it poor 
>>> practice that there are som many cases of type cast switches between 
>>> ushort and int.
>>> >
>> Not really - it doesn't care about short at all - note that the short 
>> typedef is never actually used on AIX since it has wchar support so 
>> TRE is only using int.
>>
>> Cheers,
>> Simon
>>
>>
>


From maechler at stat.math.ethz.ch  Tue Jan  5 10:31:00 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 5 Jan 2016 10:31:00 +0100
Subject: [Rd] For integer vectors, `as(x, "numeric")` has no effect.
In-Reply-To: <CAOwKfPTvi0qzJ0V9mHb9w98zKAh_Qzr3CfN58Brw2yX5Sy5coQ@mail.gmail.com>
References: <CAOwKfPTvi0qzJ0V9mHb9w98zKAh_Qzr3CfN58Brw2yX5Sy5coQ@mail.gmail.com>
Message-ID: <22155.36180.844077.237289@stat.math.ethz.ch>

>>>>> Josh O'Brien <joshmobrien at gmail.com>
>>>>>     on Mon, 4 Jan 2016 16:16:51 -0800 writes:

    > On Dec 19, 2015, at 3:32 AM, Martin Maechler <maechler at
    stat.math.ethz.ch> wrote:

    >>>>>>> Martin Maechler <maechler at stat.math.ethz.ch> on
    >>>>>>> Sat, 12 Dec 2015 10:32:51 +0100 writes:
    >> 
    >>>>>>> John Chambers <jmc at r-project.org> on Fri, 11 Dec
    >>>>>>> 2015 10:11:05 -0800 writes:
    >> 
    >>>> Somehow, the most obvious fixes are always
    >>>> back-incompatible these days.  The example intrigued
    >>>> me, so I looked into it a bit (should have been doing
    >>>> something else, but ....)
    >> 
    >>>> You're right that this is the proverbial
    >>>> thin-edge-of-the-wedge.
    >> 
    >>>> The problem is in setDataPart(), which will be called
    >>>> whenever a class extends one of the vector types.
    >> 
    >>>> It does as(value, dataClass) The key point is that the
    >>>> third argument to as(), strict=TRUE by default.  So,
    >>>> yes, the change will cause all integer vectors to
    >>>> become double when the class extends "numeric".
    >>>> Generally, strict=TRUE makes sense here and of course
    >>>> changing THAT would open up yet more incompatibilities.
    >> 
    >>>> For back compatibility, one would have to have some
    >>>> special code in setDataPart() for the case of
    >>>> integer/numeric.
    >> 
    >>>> John
    >> 
    >>>> (Historically, the original sin was probably not making
    >>>> a distinction between "numeric" as a virtual class and
    >>>> "double" as a type/class.)
    >> 
    >>> Yes, indeed.  In the mean time, I've seen more cases
    >>> where "the change will cause all integer vectors to
    >>> become double when the class extends "numeric".  seems
    >>> detrimental.
    >> 
    >>> OTOH, I still think we could go in the right direction
    >>> --- hopefully along the wishes of bioconductor S4
    >>> development, see Martin Morgan's e-mail:
    >> 
    >>> [This is all S4 - only; should not much affect base R /
    >>> S3] Currently, "integer" is a subclass of "numeric" and
    >>> so the "integer become double" part seems unwanted to
    >>> me.  OTOH, it would really make sense to more formally
    >>> have the basic subclasses of "numeric" to be "integer"
    >>> and "double", and to let as(*, "double") to become
    >>> different to as(*, "numeric") [Again, this is just for
    >>> the S4 classes and as() coercions, *not* e.g.  for
    >>> as.numeric() / as.double() !]
    >> 
    >>> In the DEPRECATED part of the NEWS for R 2.7.0 (April
    >>> 2008) we have had
    >> 
    >>> o The S4 pseudo-classes "single" and double have been
    >>> removed.  (The S4 class for a REALSXP is "numeric": for
    >>> back-compatibility as(x, "double") coerces to
    >>> "numeric".)
    >> 
    >>> I think the removal of "single" was fine, but in
    >>> hindsight, maybe the removal of "double" -- which was
    >>> partly broken then -- possibly could rather have been a
    >>> fixup of "double" along the following
    >> 
    >>> Current "thought experiment proposal" :
    >> 
    >>> 1) "numeric" := {"integer", "double"} { class -
    >>> subclasses } 2) as(1L, "numeric") continues to return 1L
    >>> .. since integer is one case of "numeric" 3) as(1L,
    >>> "double") newly returns 1.0 {and in fact would be
    >>> "equivalent" to as.double(1L)}
    >> 
    >>> After the above change, S4 as(*, "double") would
    >>> correspond to S3 as.double but as(*, "numeric") would
    >>> continue to differ from as.numeric(*), the former *not*
    >>> changing integers to double.
    >> 
    >>> Martin
    >> 
    >> Also note that e.g.
    >> 
    >> class(pi) would return "double" instead of "numeric"
    >> 
    >> and this will break all the bad programming style usages
    >> of
    >> 
    >> if(class(x) == "numeric")
    >> 
    >> which I tend to see in gazillions of user and even
    >> package codes This bad (aka error prone !)  because
    >> "correct" usage would be
    >> 
    >> if(inherits(x, "numeric"))
    >> 
    >> and that of course would *not* break after the change
    >> above.
    >> 
    >> - - - -
    >> 
    >> A week later, I'm still pretty convinced it would be
    >> worth going in the direction proposed above.
    >> 
    >> But I was actually hoping for some encouragement or
    >> "mental support"...  or then to hear why you think the
    >> proposition is not good or not viable ...
    >> 
    >> 

    > I really like Martin Maechler's "thought experiment
    > proposal", but (based partly on the reception its gotten)
    > figure I mustn't be appreciating the complications it
    > would introduce..

Actually, I've spent half day implementing it and was very
pleased about it... as matter of fact it passed *all* our checks
also in all recommended packages (*)

To do it cleanly... with very few code changes,
the *only* consequence would be that

   class(1.)

(and similar) then returned  "double" instead of "numeric".
which  *would*  be logical consequent, because indeed,

   numeric = {integer, double}

in that new scheme, and     class(1L) also returns "integer".

To my big chagrin there was very big opposition such a change,
IIRC, mainly on the grounds that for 20 years or so S and then R
books and publications had said that double and numeric should
be basically the same.
   
(*) Below you have a C level proposal which as you note is
    similar to John Chambers R level change:

The consequence is that basically you can no longer have "integer"
entries in "numeric" slots; they are automagically made into "double".
I personally find that not really "acceptable" {waste of storage},
and I would guess that more code "out there in package-land and
user-code" would break than with my change.

    > That said, if it's decided to just make a smaller fix of
    > as(x, "numeric"), might it be better to make the change at
    > the C level, to R_set_class in $RHOME/src/main/coerce.c?

I'm not seeing the advantage to make the change there, apart
from possibly some efficiency gain.

For the time being, I will not work on this ... mainly as I still
believe that my proposal would lead to a much much cleaner setup
(and yes, even be worth some small changes in new editions of
 those R books which deal with such subtle issues)

Martin


From radford at cs.toronto.edu  Tue Jan  5 13:00:38 2016
From: radford at cs.toronto.edu (Radford Neal)
Date: Tue, 5 Jan 2016 07:00:38 -0500
Subject: [Rd] deparse with parentheses for SUBSET
In-Reply-To: <mailman.23.1451991604.1814.r-devel@r-project.org>
References: <mailman.23.1451991604.1814.r-devel@r-project.org>
Message-ID: <20160105120038.GA31897@cs.toronto.edu>

> maybe there?s a reason for it, but the discrepancy between the
> handling of `[` and `$` in deparsing seems odd to me:
>
> > substitute(a[1], list(a = quote(x * y)))
> x * y[1]
>
> > substitute(a$b, list(a = quote(x * y)))
> (x * y)$b
> 
> The former is still executed in the right order (`*` first, then
> `[`), which is not what you?d expect looking at the deparse result.


This is one of a large number of bugs in the deparser and parser that
are fixed in the latest version of pqR (of 2015-09-14), as a result of
a complete rewrite of the parser and extensive revisions to the
deparser.  As I communicated to this list, it would be reasonably easy
to incorporate the rewritten parser and deparser into R Core versions
of R.  You can get more details from http://www.pqr-project.org/NEWS.txt

The portion of the bugs section in that NEWS file relevant to parsing
and deparsing is shown below:

    o The new parser fixes bugs arising from the old parser's kludge to
      handle semicolons, illustrated by the incorrect output seen
      below:
      
        > p<-parse()
        ?"abc;xyz"
        Error in parse() : <stdin>:1:1: unexpected INCOMPLETE_STRING
        1: "abc;
            ^
        > p<-parse()
        ?8 #abc;xyz
        Error in parse() : <stdin>:1:7: unexpected end of input
        1: 8 #abc;
                ^

    o Fixed deparsing of complex numbers, which were always deparsed as
      the sum of a real and an imaginary part, even though the parser
      can only produce complex numbers that are pure imaginary.  For
      example, the following output was produced before:
      
        > deparse(quote(3*5i))
        [1] "3 * (0+5i)"

      This is now deparsed to "3 * 5i".  This bug exists in all R Core
      versions through at least R-3.2.2.

    o Fixed a number of bugs in the deparser that are illustrated by
      the following, which produce incorrect output as noted, in R Core
      versions through at least R-3.2.2:
      
        deparse(parse(text="`+`(a,b)[1]")[[1]])# Omits necessary parens
        deparse(quote(`[<-`(x,1)),control="S_compatible")  # unmatched " and '
        deparse(parse(text="a = b <- c")[[1]]) # Puts in unnecessary parens
        deparse(parse(text="a+!b")[[1]])       # Puts in unnecessary parens
        deparse(parse(text="?lm")[[1]])        # Doesn't know about ? operator
        deparse(parse(text="a:=b")[[1]])       # Doesn't know about := operator
        deparse(parse(text="a$'x'")[[1]])      # Conflates name and character
        deparse(parse(text="`*`(2)")[[1]])     # Result is syntactically invalid
        deparse(parse(text="`$`(a,b+2)")[[1]]) # Result is syntactically invalid
        e<-quote(if(x) X else Y); e[[3]]<-quote(if(T)3); deparse(e)# all here 
        e <- quote(f(x)); e[[2]] <- quote((a=1))[[2]]; deparse(e)  # and below 
        e <- quote(f(Q=x)); e[[2]] <- quote((a=1))[[2]]; deparse(e)# need parens
        e <- quote(while(x) 1); e[[2]] <- quote((a=1))[[2]]; deparse(e)
        e <- quote(if(x) 1 else 2); e[[2]] <- quote((a=1))[[2]]; deparse(e)
        e <- quote(for(x in y) 1); e[[3]] <- quote((a=1))[[2]]; deparse(e)

      In addition, the bug illustrated below was fixed, which was fixed
      (differently) in R-3.0.0:
      
        a<-quote(f(1,2)); a[[1]]<-function(x,y)x+y; deparse(a)  # Omits parens

    o Fixed the following bug (also in R Core versions to at least
      R-3.2.2):
      
       > parse()
       ?'\12a\x.'
       Error: '\x' used without hex digits in character string starting "'\1a\x"

      Note that the "2" has disappeared from the error message.  This
      bug also affected the results of getParseData.

    o Fixed a memory leak that can be seen by running the code below:
      
        > long <- paste0 (c('"', rep("1234567890",820), '\x."'), collapse="")
        > for (i in 1:1000000) try (e <- parse(text=long), silent=TRUE)

      The leak will not occur if 820 is changed to 810 in the above.
      This bug also exists in R Core versions to at least R-3.2.2.

    o Entering a string constant containing Unicode escapes that was
      9999 or 10000 characters long would produce an error message
      saying "String is too long (max 10000 chars)".  This has been
      fixed so that the maximum now really is 10000 characters.  (Also
      present in R Core versions, to at least R-3.2.2.)

    o Fixed a bug that caused the error caret in syntax error reports
      to be misplaced when more than one line of context was shown.
      This was supposedly fixed in R-3.0.2, but incorrectly, resulting
      in the error caret being misplaced when only one line of context
      is shown (in R Core versions to at least R-3.2.2).


From joshmobrien at gmail.com  Tue Jan  5 22:55:31 2016
From: joshmobrien at gmail.com (Josh O'Brien)
Date: Tue, 5 Jan 2016 13:55:31 -0800
Subject: [Rd] For integer vectors, `as(x, "numeric")` has no effect.
In-Reply-To: <22155.36180.844077.237289@stat.math.ethz.ch>
References: <CAOwKfPTvi0qzJ0V9mHb9w98zKAh_Qzr3CfN58Brw2yX5Sy5coQ@mail.gmail.com>
	<22155.36180.844077.237289@stat.math.ethz.ch>
Message-ID: <CAOwKfPQJLh2KtjMxZPRt+=QO0pGVxbwm-pWBdVwWQhDX12WCoQ@mail.gmail.com>

On Tue, Jan 5, 2016 at 1:31 AM, Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>>>>>> Josh O'Brien <joshmobrien at gmail.com>
>>>>>>     on Mon, 4 Jan 2016 16:16:51 -0800 writes:
>
>     > On Dec 19, 2015, at 3:32 AM, Martin Maechler <maechler at
>     stat.math.ethz.ch> wrote:
>
>     >>>>>>> Martin Maechler <maechler at stat.math.ethz.ch> on
>     >>>>>>> Sat, 12 Dec 2015 10:32:51 +0100 writes:
>     >>
>     >>>>>>> John Chambers <jmc at r-project.org> on Fri, 11 Dec
>     >>>>>>> 2015 10:11:05 -0800 writes:
>     >>
>     >>>> Somehow, the most obvious fixes are always
>     >>>> back-incompatible these days.  The example intrigued
>     >>>> me, so I looked into it a bit (should have been doing
>     >>>> something else, but ....)
>     >>
>     >>>> You're right that this is the proverbial
>     >>>> thin-edge-of-the-wedge.
>     >>
>     >>>> The problem is in setDataPart(), which will be called
>     >>>> whenever a class extends one of the vector types.
>     >>
>     >>>> It does as(value, dataClass) The key point is that the
>     >>>> third argument to as(), strict=TRUE by default.  So,
>     >>>> yes, the change will cause all integer vectors to
>     >>>> become double when the class extends "numeric".
>     >>>> Generally, strict=TRUE makes sense here and of course
>     >>>> changing THAT would open up yet more incompatibilities.
>     >>
>     >>>> For back compatibility, one would have to have some
>     >>>> special code in setDataPart() for the case of
>     >>>> integer/numeric.
>     >>
>     >>>> John
>     >>
>     >>>> (Historically, the original sin was probably not making
>     >>>> a distinction between "numeric" as a virtual class and
>     >>>> "double" as a type/class.)
>     >>
>     >>> Yes, indeed.  In the mean time, I've seen more cases
>     >>> where "the change will cause all integer vectors to
>     >>> become double when the class extends "numeric".  seems
>     >>> detrimental.
>     >>
>     >>> OTOH, I still think we could go in the right direction
>     >>> --- hopefully along the wishes of bioconductor S4
>     >>> development, see Martin Morgan's e-mail:
>     >>
>     >>> [This is all S4 - only; should not much affect base R /
>     >>> S3] Currently, "integer" is a subclass of "numeric" and
>     >>> so the "integer become double" part seems unwanted to
>     >>> me.  OTOH, it would really make sense to more formally
>     >>> have the basic subclasses of "numeric" to be "integer"
>     >>> and "double", and to let as(*, "double") to become
>     >>> different to as(*, "numeric") [Again, this is just for
>     >>> the S4 classes and as() coercions, *not* e.g.  for
>     >>> as.numeric() / as.double() !]
>     >>
>     >>> In the DEPRECATED part of the NEWS for R 2.7.0 (April
>     >>> 2008) we have had
>     >>
>     >>> o The S4 pseudo-classes "single" and double have been
>     >>> removed.  (The S4 class for a REALSXP is "numeric": for
>     >>> back-compatibility as(x, "double") coerces to
>     >>> "numeric".)
>     >>
>     >>> I think the removal of "single" was fine, but in
>     >>> hindsight, maybe the removal of "double" -- which was
>     >>> partly broken then -- possibly could rather have been a
>     >>> fixup of "double" along the following
>     >>
>     >>> Current "thought experiment proposal" :
>     >>
>     >>> 1) "numeric" := {"integer", "double"} { class -
>     >>> subclasses } 2) as(1L, "numeric") continues to return 1L
>     >>> .. since integer is one case of "numeric" 3) as(1L,
>     >>> "double") newly returns 1.0 {and in fact would be
>     >>> "equivalent" to as.double(1L)}
>     >>
>     >>> After the above change, S4 as(*, "double") would
>     >>> correspond to S3 as.double but as(*, "numeric") would
>     >>> continue to differ from as.numeric(*), the former *not*
>     >>> changing integers to double.
>     >>
>     >>> Martin
>     >>
>     >> Also note that e.g.
>     >>
>     >> class(pi) would return "double" instead of "numeric"
>     >>
>     >> and this will break all the bad programming style usages
>     >> of
>     >>
>     >> if(class(x) == "numeric")
>     >>
>     >> which I tend to see in gazillions of user and even
>     >> package codes This bad (aka error prone !)  because
>     >> "correct" usage would be
>     >>
>     >> if(inherits(x, "numeric"))
>     >>
>     >> and that of course would *not* break after the change
>     >> above.
>     >>
>     >> - - - -
>     >>
>     >> A week later, I'm still pretty convinced it would be
>     >> worth going in the direction proposed above.
>     >>
>     >> But I was actually hoping for some encouragement or
>     >> "mental support"...  or then to hear why you think the
>     >> proposition is not good or not viable ...
>     >>
>     >>
>
>     > I really like Martin Maechler's "thought experiment
>     > proposal", but (based partly on the reception its gotten)
>     > figure I mustn't be appreciating the complications it
>     > would introduce..
>
> Actually, I've spent half day implementing it and was very
> pleased about it... as matter of fact it passed *all* our checks
> also in all recommended packages (*)
>
> To do it cleanly... with very few code changes,
> the *only* consequence would be that
>
>    class(1.)
>
> (and similar) then returned  "double" instead of "numeric".
> which  *would*  be logical consequent, because indeed,
>
>    numeric = {integer, double}
>
> in that new scheme, and     class(1L) also returns "integer".
>
> To my big chagrin there was very big opposition such a change,
> IIRC, mainly on the grounds that for 20 years or so S and then R
> books and publications had said that double and numeric should
> be basically the same.
>
> (*) Below you have a C level proposal which as you note is
>     similar to John Chambers R level change:
>
> The consequence is that basically you can no longer have "integer"
> entries in "numeric" slots; they are automagically made into "double".
> I personally find that not really "acceptable" {waste of storage},
> and I would guess that more code "out there in package-land and
> user-code" would break than with my change.
>
>     > That said, if it's decided to just make a smaller fix of
>     > as(x, "numeric"), might it be better to make the change at
>     > the C level, to R_set_class in $RHOME/src/main/coerce.c?
>
> I'm not seeing the advantage to make the change there, apart
> from possibly some efficiency gain.
>

One advantage (relative to a solution based on setting a new S4 coerce()
method for signature c("integer", "numeric") ) is that it would also make
the following conversion work as naively expected:

    x <- 10L
    class(x) <- "numeric"
    class(x)
    # [1] "integer"  ## would be "numeric"

I know that's not a recommended strategy for converting an object's
class, but for users like me, trying to make sense of as() and the
class system,  it would be even more perplexing if `as(x, "numeric")`
and `class(x) <- "numeric"` yielded different results.

> For the time being, I will not work on this ... mainly as I still
> believe that my proposal would lead to a much much cleaner setup
> (and yes, even be worth some small changes in new editions of
>  those R books which deal with such subtle issues)
>

Thanks, anyway, for having looked into this. If no changes are to be made,
then it might (?) be worth modifying the "Basic Coercion Methods" section
of ?as. It currently reads:

     Methods are pre-defined for coercing any object to one of the
     basic datatypes.  For example, 'as(x, "numeric")' uses the
     existing 'as.numeric' function.  These built-in methods can be
     listed by 'showMethods("coerce")'.

which is not accurate for integer vectors 'x'.

> Martin<div id="DDB4FAA8-2DD7-40BB-A1B8-4E2AA1F9FDF2"><table style="border-top: 1px solid #aaabb6; margin-top: 10px;">
	<tr>
		<td style="width: 105px; padding-top: 15px;">
			<a href="https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail"
target="_blank"><img
src="https://ipmcdn.avast.com/images/logo-avast-v1.png" style="width:
90px; height:33px;"/></a>
		</td>
		<td style="width: 470px; padding-top: 20px; color: #41424e;
font-size: 13px; font-family: Arial, Helvetica, sans-serif;
line-height: 18px;">This email has been sent from a virus-free
computer protected by Avast. <br /><a
href="https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail"
target="_blank" style="color: #4453ea;">www.avast.com</a>
		</td>
	</tr>
</table><a href="#DDB4FAA8-2DD7-40BB-A1B8-4E2AA1F9FDF2" width="1"
height="1"></a></div>


From aixtools at gmail.com  Wed Jan  6 08:25:09 2016
From: aixtools at gmail.com (Michael Felt)
Date: Wed, 6 Jan 2016 08:25:09 +0100
Subject: [Rd] R,
 AIX 64-bit builds - trying to understand root cause for message:
 "Error: Line starting 'Package: tools ...' is malformed!"
In-Reply-To: <568B6D8C.4010200@gmail.com>
References: <56825A4B.7010508@gmail.com> <56839C9E.2010401@gmail.com>
	<5685466E.7000804@gmail.com>
	<4BED4A65-8EE9-49B8-8AFB-4E6CC3BB5BBF@r-project.org>
	<F92F30A1-4E5C-4312-B151-692F27013F8B@r-project.org>
	<F68557F2-67ED-4EF3-8BDF-F7981D8F38C0@gmail.com>
	<56894556.3020902@gmail.com>
	<5138BF7E-44C2-4ABE-9D3F-0730BCF90BC9@r-project.org>
	<568A1285.5000709@gmail.com>
	<11C4A052-1585-41A9-BFBD-1756E6DC8B96@r-project.org>
	<568AF111.8030900@gmail.com> <568B6D8C.4010200@gmail.com>
Message-ID: <568CC155.3070203@gmail.com>



On 05-Jan-16 08:15, Michael Felt wrote:
> On 04-Jan-16 15:52, Simon Urbanek wrote:
>> No, no duplicate warnings.
I am still getting many duplicate warnings, but am getting farther than 
before: such as:
======= 64-bit ending ======== - what is internal error 5 in R_compress3 
============
* installing *source* package 'MASS' ...
** package 'MASS' successfully unpacked and MD5 sums checked
** libs
         xlc_r -qarch=pwr5 -I/home/cran/64/R/include -DNDEBUG 
-I/usr/local/include      -g  -c MASS.c -o MASS.o
         xlc_r -qarch=pwr5 -I/home/cran/64/R/include -DNDEBUG 
-I/usr/local/include      -g  -c lqs.c -o lqs.o
xlc_r -qarch=pwr5 -Wl,-brtl -Wl,-G -Wl,-bexpall -Wl,-bnoentry -lc 
-L/home/cran/64/R/lib -L/opt/lib -liconv -o MASS.so MASS.o lqs.o -lm 
-L/home/cran/64/R/lib -lR
ld: 0711-224 WARNING: Duplicate symbol: p_xargc
ld: 0711-224 WARNING: Duplicate symbol: p_xargv
ld: 0711-224 WARNING: Duplicate symbol: p_xrcfg
ld: 0711-224 WARNING: Duplicate symbol: p_xrc
ld: 0711-224 WARNING: Duplicate symbol: end
ld: 0711-224 WARNING: Duplicate symbol: .log
ld: 0711-224 WARNING: Duplicate symbol: log
ld: 0711-224 WARNING: Duplicate symbol: .sqrt
ld: 0711-224 WARNING: Duplicate symbol: sqrt
ld: 0711-224 WARNING: Duplicate symbol: guesses
ld: 0711-224 WARNING: Duplicate symbol: .strcmp
ld: 0711-224 WARNING: Duplicate symbol: strcmp
ld: 0711-224 WARNING: Duplicate symbol: .isnan
ld: 0711-224 WARNING: Duplicate symbol: isnan
ld: 0711-224 WARNING: Duplicate symbol: .pow
ld: 0711-224 WARNING: Duplicate symbol: pow
ld: 0711-224 WARNING: Duplicate symbol: .exp
ld: 0711-224 WARNING: Duplicate symbol: exp
ld: 0711-345 Use the -bloadmap or -bnoquiet option to obtain more 
information.
Target "all" is up to date.
installing to /home/cran/64/R/library/MASS/libs
** R
** data
*** moving datasets to lazyload DB
Error in lazyLoadDBinsertVariable(vars[i], from, datafile, ascii, 
compress,  :
   internal error 5 in R_compress3
ERROR: lazydata failed for package 'MASS'
* removing '/home/cran/64/R/library/MASS'
make: 1254-004 The error code from the last command is 1.


Stop.
make: 1254-004 The error code from the last command is 2.


Stop.
make: 1254-004 The error code from the last command is 2.


Stop.
cran at x068:[/home/cran/64/R]

========== 32-bit ending -- never ran "out of stack space" - like this - 
when using gcc/gfortran, but maybe it is just different ========

         xlc_r -qarch=pwr5 -I/home/cran/32/R/include -DNDEBUG 
-I../Include -I../../SuiteSparse_config -I/usr/local/include -g  
-I../Include -DDINT -c amd_global.c -o amd_i_global.o
         xlc_r -qarch=pwr5 -I/home/cran/32/R/include -DNDEBUG 
-I../Include -I../../SuiteSparse_config -I/usr/local/include -g  
-I../Include -DDLONG -c amd_global.c -o amd_l_global.o
         ar -rucs ../../AMD.a amd_i_aat.o amd_l_aat.o amd_i_1.o 
amd_l_1.o amd_i_2.o amd_l_2.o amd_i_postorder.o amd_l_postorder.o 
amd_i_post_tree.o amd_l_post_tree.o amd_i_defaults.o amd_l_defaults.o 
amd_i_order.o amd_l_order.o amd_i_control.o amd_l_control.o amd_i_info.o 
amd_l_info.o amd_i_valid.o amd_l_valid.o amd_i_preprocess.o 
amd_l_preprocess.o amd_i_dump.o amd_l_dump.o amd_i_global.o amd_l_global.o
Target "lib" is up to date.
         xlc_r -qarch=pwr5 -I/home/cran/32/R/include -DNDEBUG -DNTIMER 
-I/usr/local/include      -g  -c SuiteSparse_config.c -o 
SuiteSparse_config.o
         ar -rucs ../SuiteSparse_config.a SuiteSparse_config.o
Target "library" is up to date.
xlc_r -qarch=pwr5 -Wl,-brtl -Wl,-G -Wl,-bexpall -Wl,-bnoentry -lc 
-L/home/cran/32/R/lib -L/opt/lib -liconv -o Matrix.so CHMfactor.o 
Csparse.o TMatrix_as.o Tsparse.o init.o Mutils.o chm_common.o cs.o 
cs_utils.o dense.o dgCMatrix.o dgTMatrix.o dgeMatrix.o dpoMatrix.o 
dppMatrix.o dsCMatrix.o dsyMatrix.o dspMatrix.o dtCMatrix.o dtTMatrix.o 
dtrMatrix.o dtpMatrix.o factorizations.o ldense.o lgCMatrix.o sparseQR.o 
abIndex.o CHOLMOD.a COLAMD.a AMD.a SuiteSparse_config.a 
-L/home/cran/32/R/lib -lRlapack -liconv -lxlf90 
-L/opt/IBM/xlmass/8.1.2/lib/aix61 -L/opt/IBM/xlf/15.1.2/lib -lxlopt 
-lxlipa -lxlf -lxlomp_ser -lpthreads -lm -lm -L/home/cran/32/R/lib -lR
ld: 0711-224 WARNING: Duplicate symbol: p_xargc
ld: 0711-224 WARNING: Duplicate symbol: p_xargv
ld: 0711-224 WARNING: Duplicate symbol: p_xrcfg
ld: 0711-224 WARNING: Duplicate symbol: p_xrc
ld: 0711-224 WARNING: Duplicate symbol: end
ld: 0711-224 WARNING: Duplicate symbol: .bcopy
ld: 0711-224 WARNING: Duplicate symbol: bcopy
ld: 0711-224 WARNING: Duplicate symbol: .strcmp
ld: 0711-224 WARNING: Duplicate symbol: strcmp
ld: 0711-224 WARNING: Duplicate symbol: .sqrt
ld: 0711-224 WARNING: Duplicate symbol: sqrt
ld: 0711-224 WARNING: Duplicate symbol: guesses
ld: 0711-224 WARNING: Duplicate symbol: .ceil
ld: 0711-224 WARNING: Duplicate symbol: ceil
ld: 0711-224 WARNING: Duplicate symbol: .nearest
ld: 0711-224 WARNING: Duplicate symbol: .nearbyint
ld: 0711-224 WARNING: Duplicate symbol: .trunc
ld: 0711-224 WARNING: Duplicate symbol: .floor
ld: 0711-224 WARNING: Duplicate symbol: .fetestexcept
ld: 0711-224 WARNING: Duplicate symbol: fetestexcept
ld: 0711-224 WARNING: Duplicate symbol: .feraiseexcept
ld: 0711-224 WARNING: Duplicate symbol: .feclearexcept
ld: 0711-224 WARNING: Duplicate symbol: feclearexcept
ld: 0711-224 WARNING: Duplicate symbol: .isnan
ld: 0711-224 WARNING: Duplicate symbol: isnan
ld: 0711-224 WARNING: Duplicate symbol: .strcpy
ld: 0711-224 WARNING: Duplicate symbol: strcpy
ld: 0711-224 WARNING: Duplicate symbol: .log
ld: 0711-224 WARNING: Duplicate symbol: log
ld: 0711-224 WARNING: Duplicate symbol: .dgemm
ld: 0711-224 WARNING: Duplicate symbol: dgemm
ld: 0711-224 WARNING: Duplicate symbol: .exp
ld: 0711-224 WARNING: Duplicate symbol: exp
ld: 0711-345 Use the -bloadmap or -bnoquiet option to obtain more 
information.
Target "all" is up to date.
installing to /home/cran/32/R/library/Matrix/libs
** R
Warning: unable to re-encode 'Summary.R' line 183
** data
** inst
** byte-compile and prepare package for lazy loading
Creating a generic function for 'image' from package 'graphics' in 
package 'Matrix'
Creating a generic function for 'solve' from package 'base' in package 
'Matrix'
Creating a generic function for 'chol2inv' from 'base' in package 'Matrix'
     (from the saved implicit definition)
Creating a generic function for 'chol2inv' from package 'base' in 
package 'Matrix'
Creating a generic function for 'determinant' from package 'base' in 
package 'Matrix'
Creating a generic function for 'update' from package 'stats' in package 
'Matrix'
Creating a generic function for 'as.vector' from package 'base' in 
package 'Matrix'
Creating a generic function for 't' from package 'base' in package 'Matrix'
Creating a generic function for 'diag' from package 'base' in package 
'Matrix'
Creating a generic function for 'as.matrix' from package 'base' in 
package 'Matrix'
Creating a generic function for 'as.array' from package 'base' in 
package 'Matrix'
Creating a generic function for 'head' from package 'utils' in package 
'Matrix'
Creating a generic function for 'tail' from package 'utils' in package 
'Matrix'
Creating a generic function for 'drop' from package 'base' in package 
'Matrix'
Creating a generic function for 'mean' from package 'base' in package 
'Matrix'
Creating a generic function for 'cov2cor' from package 'stats' in 
package 'Matrix'
Creating a generic function for 'isSymmetric' from package 'base' in 
package 'Matrix'
Creating a generic function for 'unname' from package 'base' in package 
'Matrix'
Creating a generic function for 'chol' from package 'base' in package 
'Matrix'
Creating a generic function for 'norm' from package 'base' in package 
'Matrix'
Creating a generic function for 'rcond' from 'base' in package 'Matrix'
     (from the saved implicit definition)
Creating a generic function for 'rcond' from package 'base' in package 
'Matrix'
Creating a generic function for 'all.equal' from package 'base' in 
package 'Matrix'
Creating a generic function for 'diff' from package 'base' in package 
'Matrix'
in method for 'coerce' with signature '"matrix.csr","dgRMatrix"': no 
definition for class "matrix.csr"
in method for 'coerce' with signature '"dgRMatrix","matrix.csr"': no 
definition for class "matrix.csr"
in method for 'coerce' with signature '"matrix.csc","dgCMatrix"': no 
definition for class "matrix.csc"
in method for 'coerce' with signature '"dgCMatrix","matrix.csc"': no 
definition for class "matrix.csc"
in method for 'coerce' with signature '"matrix.coo","dgTMatrix"': no 
definition for class "matrix.coo"
in method for 'coerce' with signature '"dgTMatrix","matrix.coo"': no 
definition for class "matrix.coo"
in method for 'coerce' with signature '"dsparseMatrix","matrix.csr"': no 
definition for class "matrix.csr"
in method for 'coerce' with signature '"matrix.csr","dgCMatrix"': no 
definition for class "matrix.csr"
in method for 'coerce' with signature '"matrix.coo","dgCMatrix"': no 
definition for class "matrix.coo"
in method for 'coerce' with signature '"matrix.csr","RsparseMatrix"': no 
definition for class "matrix.csr"
in method for 'coerce' with signature '"matrix.csc","CsparseMatrix"': no 
definition for class "matrix.csc"
in method for 'coerce' with signature '"matrix.coo","TsparseMatrix"': no 
definition for class "matrix.coo"
in method for 'coerce' with signature '"matrix.csr","CsparseMatrix"': no 
definition for class "matrix.csr"
in method for 'coerce' with signature '"matrix.coo","CsparseMatrix"': no 
definition for class "matrix.coo"
in method for 'coerce' with signature '"matrix.csc","TsparseMatrix"': no 
definition for class "matrix.csc"
in method for 'coerce' with signature '"matrix.csr","TsparseMatrix"': no 
definition for class "matrix.csr"
in method for 'coerce' with signature '"CsparseMatrix","matrix.csr"': no 
definition for class "matrix.csr"
in method for 'coerce' with signature '"CsparseMatrix","matrix.coo"': no 
definition for class "matrix.coo"
in method for 'coerce' with signature '"CsparseMatrix","matrix.csc"': no 
definition for class "matrix.csc"
in method for 'coerce' with signature '"matrix.csr","Matrix"': no 
definition for class "matrix.csr"
in method for 'coerce' with signature '"matrix.coo","Matrix"': no 
definition for class "matrix.coo"
in method for 'coerce' with signature '"matrix.csc","Matrix"': no 
definition for class "matrix.csc"
Creating a generic function for 'colSums' from package 'base' in package 
'Matrix'
Creating a generic function for 'colMeans' from package 'base' in 
package 'Matrix'
Creating a generic function for 'rowSums' from package 'base' in package 
'Matrix'
Creating a generic function for 'rowMeans' from package 'base' in 
package 'Matrix'
in method for 'colSums' with signature 'x="igCMatrix"': no definition 
for class "igCMatrix"
in method for 'rowSums' with signature 'x="igCMatrix"': no definition 
for class "igCMatrix"
in method for 'colMeans' with signature 'x="igCMatrix"': no definition 
for class "igCMatrix"
in method for 'rowMeans' with signature 'x="igCMatrix"': no definition 
for class "igCMatrix"
Creating a generic function for 'zapsmall' from package 'base' in 
package 'Matrix'
Creating a generic function for 'qr' from package 'base' in package 'Matrix'
Creating a generic function for 'diag<-' from package 'base' in package 
'Matrix'
Creating a generic function for 'crossprod' from package 'base' in 
package 'Matrix'
Creating a generic function for 'tcrossprod' from package 'base' in 
package 'Matrix'
Creating a generic function for 'print' from package 'base' in package 
'Matrix'
Creating a generic function for 'summary' from package 'base' in package 
'Matrix'
Creating a generic function for 'which' from package 'base' in package 
'Matrix'
in method for 'coerce' with signature '"graphAM","sparseMatrix"': no 
definition for class "graphAM"
in method for 'coerce' with signature '"graph","CsparseMatrix"': no 
definition for class "graph"
in method for 'coerce' with signature '"graph","Matrix"': no definition 
for class "graph"
in method for 'coerce' with signature '"graphNEL","CsparseMatrix"': no 
definition for class "graphNEL"
in method for 'coerce' with signature '"graphNEL","TsparseMatrix"': no 
definition for class "graphNEL"
in method for 'coerce' with signature '"sparseMatrix","graph"': no 
definition for class "graph"
in method for 'coerce' with signature '"sparseMatrix","graphNEL"': no 
definition for class "graphNEL"
in method for 'coerce' with signature '"TsparseMatrix","graphNEL"': no 
definition for class "graphNEL"
Creating a generic function for 'format' from package 'base' in package 
'Matrix'
Creating a generic function for 'qr.R' from package 'base' in package 
'Matrix'
Creating a generic function for 'qr.Q' from package 'base' in package 
'Matrix'
Creating a generic function for 'qr.qy' from package 'base' in package 
'Matrix'
Creating a generic function for 'qr.qty' from package 'base' in package 
'Matrix'
Creating a generic function for 'qr.coef' from package 'base' in package 
'Matrix'
Creating a generic function for 'qr.resid' from package 'base' in 
package 'Matrix'
Creating a generic function for 'qr.fitted' from package 'base' in 
package 'Matrix'
Creating a generic function for 'toeplitz' from package 'stats' in 
package 'Matrix'
** help
*** installing help indices
** building package indices
Loading required package: Matrix
Error: C stack usage  1221002169 is too close to the limit

  *** caught segfault ***
address c4866d8c, cause 'memory not mapped'

Traceback:
  1: structure(list(message = as.character(message), call = call),     
class = class)
  2: simpleError(msg, call)
  3: tryCatchOne(expr, names, parentenv, handlers[[1L]])
  4: tryCatchList(expr, classes, parentenv, handlers)
  5: tryCatch(expr, error = function(e) {    call <- conditionCall(e)    
if (!is.null(call)) {        if (identical(call[[1L]], 
quote(doTryCatch)))             call <- sys.call(-4L)        dcall <- 
deparse(call)[1L]        prefix <- paste("Error in", dcall, ": ")        
LONG <- 75L msg <- conditionMessage(e)        sm <- strsplit(msg, 
"\n")[[1L]]        w <- 14L + nchar(dcall, type = "w") + nchar(sm[1L], 
type = "w")        if (is.na(w))             w <- 14L + nchar(dcall, 
type = "b") + nchar(sm[1L],                 type = "b")        if (w > 
LONG)             prefix <- paste0(prefix, "\n  ")    }    else prefix 
<- "Error : "    msg <- paste0(prefix, conditionMessage(e), "\n") 
.Internal(seterrmessage(msg[1L]))    if (!silent && 
identical(getOption("show.error.messages"),         TRUE)) { cat(msg, 
file = stderr()) .Internal(printDeferredWarnings())    }    
invisible(structure(msg, class = "try-error", condition = e))})
  6: try(.install_package_indices(".", instdir))
  7: do_install_source(pkg_name, instdir, pkg, desc)
  8: do_install(pkg)
  9: tools:::.install_packages()
aborting ...
/home/cran/32/R/bin/INSTALL[34]: 14942332 Segmentation fault(coredump)
make: 1254-004 The error code from the last command is 1.


Stop.
make: 1254-004 The error code from the last command is 2.


Stop.
make: 1254-004 The error code from the last command is 2.


Stop.
cran at x068:[/home/cran/32/R]


From aixtools at gmail.com  Fri Jan  8 00:17:35 2016
From: aixtools at gmail.com (Michael Felt)
Date: Fri, 8 Jan 2016 00:17:35 +0100
Subject: [Rd] R for AIX - guidance re: error messages requested
Message-ID: <568EF20F.8090606@gmail.com>

Hi all,

With the bug in tre identified I am trying to move forward - one step at 
a time.

As I am getting some errors that prevent make completing with version 
3.2.3, and R-devel introduces new issues (that I will face when I get to 
them) I would appreciate some guidance with output of "make check" (of 
3.1.3) and the final message I run into when trying to build 3.2.3. 
Maybe they are related, maybe not.

In short - where should I be looking in more detail (e.g., with debugger 
again), and are the errors possibly related to a library (e.g., lzma/xz 
as it has been mentioned in other mails).

make check

root at x065:[/data/prj/cran/32/R-3.1.3.1]make check
make[1]: Entering directory '/data/prj/cran/32/R-3.1.3.1/tests'
make[2]: Entering directory '/data/prj/cran/32/R-3.1.3.1/tests'
make[3]: Entering directory '/data/prj/cran/32/R-3.1.3.1/tests/Examples'
Testing examples for package 'base'
Error: testing 'base' failed
Execution halted
Makefile:33: recipe for target 'test-Examples-Base' failed
make[3]: *** [test-Examples-Base] Error 1
make[3]: Leaving directory '/data/prj/cran/32/R-3.1.3.1/tests/Examples'
Makefile.common:166: recipe for target 'test-Examples' failed
make[2]: *** [test-Examples] Error 2
make[2]: Leaving directory '/data/prj/cran/32/R-3.1.3.1/tests'
Makefile.common:154: recipe for target 'test-all-basics' failed
make[1]: *** [test-all-basics] Error 1
make[1]: Leaving directory '/data/prj/cran/32/R-3.1.3.1/tests'
Makefile:236: recipe for target 'check' failed
make: *** [check] Error 2

Failing (64-bit) build of R-3.2.3
begin installing recommended package MASS
* installing *source* package 'MASS' ...
** package 'MASS' successfully unpacked and MD5 sums checked
** libs
         xlc_r -qarch=pwr5 -I/home/cran/64/R/include -DNDEBUG 
-I/usr/local/include      -g  -c MASS.c -o MASS.o
         xlc_r -qarch=pwr5 -I/home/cran/64/R/include -DNDEBUG 
-I/usr/local/include      -g  -c lqs.c -o lqs.o
xlc_r -qarch=pwr5 -Wl,-brtl -Wl,-G -Wl,-bexpall -Wl,-bnoentry -lc 
-L/home/cran/64/R/lib -L/opt/lib -liconv -o MASS.so MASS.o lqs.o -lm 
-L/home/cran/64/R/lib -lR
ld: 0711-224 WARNING: Duplicate symbol: p_xargc
ld: 0711-224 WARNING: Duplicate symbol: p_xargv
ld: 0711-224 WARNING: Duplicate symbol: p_xrcfg
ld: 0711-224 WARNING: Duplicate symbol: p_xrc
ld: 0711-224 WARNING: Duplicate symbol: end
ld: 0711-224 WARNING: Duplicate symbol: .log
ld: 0711-224 WARNING: Duplicate symbol: log
ld: 0711-224 WARNING: Duplicate symbol: .sqrt
ld: 0711-224 WARNING: Duplicate symbol: sqrt
ld: 0711-224 WARNING: Duplicate symbol: guesses
ld: 0711-224 WARNING: Duplicate symbol: .strcmp
ld: 0711-224 WARNING: Duplicate symbol: strcmp
ld: 0711-224 WARNING: Duplicate symbol: .isnan
ld: 0711-224 WARNING: Duplicate symbol: isnan
ld: 0711-224 WARNING: Duplicate symbol: .pow
ld: 0711-224 WARNING: Duplicate symbol: pow
ld: 0711-224 WARNING: Duplicate symbol: .exp
ld: 0711-224 WARNING: Duplicate symbol: exp
ld: 0711-345 Use the -bloadmap or -bnoquiet option to obtain more 
information.
Target "all" is up to date.
installing to /home/cran/64/R/library/MASS/libs
** R
** data
*** moving datasets to lazyload DB
Error in lazyLoadDBinsertVariable(vars[i], from, datafile, ascii, 
compress,  :
   internal error 5 in R_compress3
ERROR: lazydata failed for package 'MASS'
* removing '/home/cran/64/R/library/MASS'
make: 1254-004 The error code from the last command is 1.


Stop.
make: 1254-004 The error code from the last command is 2.


Stop.
make: 1254-004 The error code from the last command is 2.


Stop.
cran at x068:[/home/cran/64/R]


From dstr7320 at uni.sydney.edu.au  Fri Jan  8 06:00:04 2016
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Fri, 8 Jan 2016 05:00:04 +0000
Subject: [Rd] Inconsistencies of Fundamental Summary Functions
Message-ID: <SN1PR0101MB1439E442D111FFBFF21D2098CDF60@SN1PR0101MB1439.prod.exchangelabs.com>

Good day,

Functions such as min and max work on a data frame of numbers, but other functions, like median do not. For example,

database <- data.frame(Name = LETTERS[1:3], Amount = 1:3, Price = 4:6)
> min(database[, 2:3])
[1] 1
> mean(database[, 2:3])
[1] NA
> median(database[, 2:3])
Error in median.default(database[, 2:3]) : need numeric data

This observation was made when teaching university students in the first year of their degrees.  Some functions require coercion by using as.matrix but others don't. Surely these simple commands should be consistent.

Also, the documentation for min and max is incomplete. It states "?Numeric? arguments are vectors of type integer and numeric, and logical." It should also mention that it works on data frames, although not when data frames are represented as lists, which can easily be coerced back to data frames.

> min(as.list(database[, 2:3]))
Error in min(as.list(database[, 2:3])) : 
  invalid 'type' (list) of argument

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia

From aixtools at gmail.com  Fri Jan  8 17:34:36 2016
From: aixtools at gmail.com (Michael Felt)
Date: Fri, 08 Jan 2016 17:34:36 +0100
Subject: [Rd] R for AIX - guidance re: error messages requested
In-Reply-To: <568EF20F.8090606@gmail.com>
References: <568EF20F.8090606@gmail.com>
Message-ID: <568FE51C.40400@gmail.com>

On 2016-01-08 00:17, Michael Felt wrote:
> Hi all,
>
> With the bug in tre identified I am trying to move forward - one step 
> at a time.
Guess it is time to close testing via R-3.2.3. Next posts will be:
a) when I have time
b) based on R-devel

Have a good day all!

Michael
>
> As I am getting some errors that prevent make completing with version 
> 3.2.3, and R-devel introduces new issues (that I will face when I get 
> to them) I would appreciate some guidance with output of "make check" 
> (of 3.1.3) and the final message I run into when trying to build 
> 3.2.3. Maybe they are related, maybe not.
>
> In short - where should I be looking in more detail (e.g., with 
> debugger again), and are the errors possibly related to a library 
> (e.g., lzma/xz as it has been mentioned in other mails).
>
> make check
>
> root at x065:[/data/prj/cran/32/R-3.1.3.1]make check
> make[1]: Entering directory '/data/prj/cran/32/R-3.1.3.1/tests'
> make[2]: Entering directory '/data/prj/cran/32/R-3.1.3.1/tests'
> make[3]: Entering directory '/data/prj/cran/32/R-3.1.3.1/tests/Examples'
> Testing examples for package 'base'
> Error: testing 'base' failed
> Execution halted
> Makefile:33: recipe for target 'test-Examples-Base' failed
> make[3]: *** [test-Examples-Base] Error 1
> make[3]: Leaving directory '/data/prj/cran/32/R-3.1.3.1/tests/Examples'
> Makefile.common:166: recipe for target 'test-Examples' failed
> make[2]: *** [test-Examples] Error 2
> make[2]: Leaving directory '/data/prj/cran/32/R-3.1.3.1/tests'
> Makefile.common:154: recipe for target 'test-all-basics' failed
> make[1]: *** [test-all-basics] Error 1
> make[1]: Leaving directory '/data/prj/cran/32/R-3.1.3.1/tests'
> Makefile:236: recipe for target 'check' failed
> make: *** [check] Error 2
>
> Failing (64-bit) build of R-3.2.3
> begin installing recommended package MASS
> * installing *source* package 'MASS' ...
> ** package 'MASS' successfully unpacked and MD5 sums checked
> ** libs
>         xlc_r -qarch=pwr5 -I/home/cran/64/R/include -DNDEBUG 
> -I/usr/local/include      -g  -c MASS.c -o MASS.o
>         xlc_r -qarch=pwr5 -I/home/cran/64/R/include -DNDEBUG 
> -I/usr/local/include      -g  -c lqs.c -o lqs.o
> xlc_r -qarch=pwr5 -Wl,-brtl -Wl,-G -Wl,-bexpall -Wl,-bnoentry -lc 
> -L/home/cran/64/R/lib -L/opt/lib -liconv -o MASS.so MASS.o lqs.o -lm 
> -L/home/cran/64/R/lib -lR
> ld: 0711-224 WARNING: Duplicate symbol: p_xargc
> ld: 0711-224 WARNING: Duplicate symbol: p_xargv
> ld: 0711-224 WARNING: Duplicate symbol: p_xrcfg
> ld: 0711-224 WARNING: Duplicate symbol: p_xrc
> ld: 0711-224 WARNING: Duplicate symbol: end
> ld: 0711-224 WARNING: Duplicate symbol: .log
> ld: 0711-224 WARNING: Duplicate symbol: log
> ld: 0711-224 WARNING: Duplicate symbol: .sqrt
> ld: 0711-224 WARNING: Duplicate symbol: sqrt
> ld: 0711-224 WARNING: Duplicate symbol: guesses
> ld: 0711-224 WARNING: Duplicate symbol: .strcmp
> ld: 0711-224 WARNING: Duplicate symbol: strcmp
> ld: 0711-224 WARNING: Duplicate symbol: .isnan
> ld: 0711-224 WARNING: Duplicate symbol: isnan
> ld: 0711-224 WARNING: Duplicate symbol: .pow
> ld: 0711-224 WARNING: Duplicate symbol: pow
> ld: 0711-224 WARNING: Duplicate symbol: .exp
> ld: 0711-224 WARNING: Duplicate symbol: exp
> ld: 0711-345 Use the -bloadmap or -bnoquiet option to obtain more 
> information.
> Target "all" is up to date.
> installing to /home/cran/64/R/library/MASS/libs
> ** R
> ** data
> *** moving datasets to lazyload DB
> Error in lazyLoadDBinsertVariable(vars[i], from, datafile, ascii, 
> compress,  :
>   internal error 5 in R_compress3
> ERROR: lazydata failed for package 'MASS'
> * removing '/home/cran/64/R/library/MASS'
> make: 1254-004 The error code from the last command is 1.
>
>
> Stop.
> make: 1254-004 The error code from the last command is 2.
>
>
> Stop.
> make: 1254-004 The error code from the last command is 2.
>
>
> Stop.
> cran at x068:[/home/cran/64/R]
>


From antonio.pv.gs at gmail.com  Mon Jan 11 00:14:22 2016
From: antonio.pv.gs at gmail.com (Antonio Perez)
Date: Mon, 11 Jan 2016 00:14:22 +0100
Subject: [Rd] coerce SEXP type to C++ matrix class and back
Message-ID: <CABGWzFSLgybYi0Tw2XhWXZVdMf11HXF6EwLapugDaMqddg_wCA@mail.gmail.com>

Dear all,

I am testing a simple C++ function that takes a double matrix as
argument and which uses routines provided by the C++ Armadillo
package. I am aware of the nice capabilities of Rcpp and RcppArmadillo
which helps simplifying a lot and that I have already successfully
tested. However, I had a hard time trying to figure out how the
coercion from a REALSPX matrix to an arma::mat = arma::Mat<double>
matrix (double matrix in Armadillo) is done. In this particular case,
because of the simplicity of my function, I would like to use base R
only. Since both, Armadillo and R matrix elements, are stored with
column-major ordering I have tried the following silly example:

#include <R.h>
#include <Rdefines.h>
#include <Rinternals.h>
#include <Rmath.h>
#include <R_ext/BLAS.h>
#include <R_ext/Lapack.h>
#include <armadillo>

#define IDX(i,j,dim0) (i) + (j) * (dim0)

extern "C" SEXP Symm(SEXP RA)
{
  int m = INTEGER(GET_DIM(RA))[0];
  int n = INTEGER(GET_DIM(RA))[1];
  double *A;
  A = REAL(RA);

  arma::mat C(m, n), D(m, n);
  for (int i = 0; i < m; i++)
    for (int j = 0; j < n; j++)
      C[IDX(i, j, m)] = A[IDX(i, j, m)];

  D = arma::symmatu(C);

  SEXP B = PROTECT(allocMatrix(REALSXP, m, n));

  for (int i = 0; i < m; i++)
    for (int j = 0; j < n; j++)
      REAL(B)[IDX(i, j, m)] = D[IDX(i, j, m)];

  UNPROTECT(1);
  return(B);
}

but it fails to compile:

~$ R CMD SHLIB example.cpp
g++ -I/usr/share/R/include -DNDEBUG      -fpic  -g -O2
-fstack-protector-strong -Wformat -Werror=format-security
-D_FORTIFY_SOURCE=2 -g  -c example.cpp -o example.o
In file included from /usr/include/c++/4.9/fstream:40:0,
                 from /usr/include/armadillo:21,
                 from example.cpp:7:
/usr/include/c++/4.9/bits/codecvt.h:215:45: error: macro "length"
passed 4 arguments, but takes just 1
       const extern_type* __end, size_t __max) const
                                             ^
In file included from /usr/include/c++/4.9/fstream:939:0,
                 from /usr/include/armadillo:21,
                 from example.cpp:7:
/usr/include/c++/4.9/bits/fstream.tcc:826:60: error: macro "length"
passed 4 arguments, but takes just 1
                                this->gptr() - this->eback());
                                                            ^
/usr/include/c++/4.9/bits/fstream.tcc:943:39: error: macro "length"
passed 4 arguments, but takes just 1
           this->gptr() - this->eback());
                                       ^
In file included from /usr/include/c++/4.9/fstream:40:0,
                 from /usr/include/armadillo:21,
                 from example.cpp:7:
/usr/include/c++/4.9/bits/codecvt.h:214:7: error: expected ?;? at end
of member declaration
       length(state_type& __state, const extern_type* __from,
       ^
/usr/include/c++/4.9/bits/codecvt.h:216:7: error: expected
unqualified-id before ?{? token
       { return this->do_length(__state, __from, __end, __max); }
       ^
/usr/lib/R/etc/Makeconf:137: recipe for target 'example.o' failed
make: *** [example.o] Error 1

Many thanks for your help.


From profjcnash at gmail.com  Mon Jan 11 13:44:08 2016
From: profjcnash at gmail.com (ProfJCNash)
Date: Mon, 11 Jan 2016 07:44:08 -0500
Subject: [Rd] Possibly useful idea
Message-ID: <5693A398.6050207@gmail.com>

I've not worked changing underlying computational infrastructure, but
developers who do might want to use ideas from FlexiBLAS. Apologies in
advance if this is well-known.

Best JN

> From: Martin Koehler koehlerm at mpi-magdeburg.mpg.de
> Date: January 07, 2016
> Subject: FlexiBLAS Version 1.3.0 Release
>
> It is our pleasure to announce the new release of FlexiBLAS. We do not
> provide yet another BLAS implementation in itself, but rather present
> an easy to use method for switching between different BLAS
> implementations while debugging or benchmarking other codes.
>
> Highlights since the release of the initial version (v1.0.0) are:
> - support for BLAS-like extensions known from OpenBLAS and Intel MKL,
> - switch the BLAS backend at program runtime,
> - integration in GNU Octave,
> - and a redesigned command line tool to manage the configuration.
>
> Feel free to check the current version at
> http://www.mpi-magdeburg.mpg.de/projects/flexiblas/
> and drop us a line if you have any comments or requests about it.
>
> Further information on the realization can be found in LAWN 284
> http://www.netlib.org/lapack/lawnspdf/lawn284.pdf
> or updated version of the Manuscript (coming soon) available from the
> project web page.
>
> The library is available under GPLv3. We have tested it in production
> environments on several platforms and hope you will find it useful for
> your research, as well.
>
> Martin K??hler and Jens Saak
>


From edd at debian.org  Mon Jan 11 13:53:57 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 11 Jan 2016 06:53:57 -0600
Subject: [Rd] coerce SEXP type to C++ matrix class and back
In-Reply-To: <CABGWzFSLgybYi0Tw2XhWXZVdMf11HXF6EwLapugDaMqddg_wCA@mail.gmail.com>
References: <CABGWzFSLgybYi0Tw2XhWXZVdMf11HXF6EwLapugDaMqddg_wCA@mail.gmail.com>
Message-ID: <22163.42469.934862.828950@max.nulle.part>


I don't want to sound disrespectful, but why not use RcppArmadillo if
simplicity is you goal?

It is hard to beat the _fully automatic_ conversion:

R> cppFunction("arma::mat doubleUp(const arma::mat & x) { return 2*x; }", depends="RcppArmadillo")
R> doubleUp(matrix(1:9,3,3))
     [,1] [,2] [,3]
[1,]    2    8   14
[2,]    4   10   16
[3,]    6   12   18
R> 

You can of course do all that by hand too, but why do you think both Rcpp and
RcppArmadillo have, respectively, tens of thousands of lines of code?

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd at debian.org  Mon Jan 11 13:57:03 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 11 Jan 2016 06:57:03 -0600
Subject: [Rd] Possibly useful idea
In-Reply-To: <5693A398.6050207@gmail.com>
References: <5693A398.6050207@gmail.com>
Message-ID: <22163.42655.423010.110999@max.nulle.part>


John,

On 11 January 2016 at 07:44, ProfJCNash wrote:
| I've not worked changing underlying computational infrastructure, but
| developers who do might want to use ideas from FlexiBLAS. Apologies in
| advance if this is well-known.

You have been able to do that at the OS level, given a suitable OS variant
like Debian, since the 1990s. My timing comparison package/vignette gcbd does
just that (adjusting before calling R).

I see nothing really new here. It's just dispatching. Sure, if your OS allows
it you can roll it up into the OS. But not all OSs will so appeal to R is
limited.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From antonio.pv.gs at gmail.com  Mon Jan 11 17:54:50 2016
From: antonio.pv.gs at gmail.com (Antonio Perez)
Date: Mon, 11 Jan 2016 17:54:50 +0100
Subject: [Rd] coerce SEXP type to C++ matrix class and back
In-Reply-To: <22163.42469.934862.828950@max.nulle.part>
References: <CABGWzFSLgybYi0Tw2XhWXZVdMf11HXF6EwLapugDaMqddg_wCA@mail.gmail.com>
	<22163.42469.934862.828950@max.nulle.part>
Message-ID: <CABGWzFQKosWnwC9NL9AN5yh6RPZkE1wESYCTmgb+eVf24xpeag@mail.gmail.com>

Dirk,

I am sorry if it sounded disrespectful. On the contrary, as I said,
your packages Rcpp and RcppArmadillo work very well, and use both of
them in more "complex" applications. However, in this particular case
in which I have just one object of one type (matrix double) with its
elements stored column-major similarly to R I though that could find a
reasonable method to coerce my SEXP matrix into a Matrix double in
armadillo without using two packages for this.

I hope this is understood.



I though that there might beI ptough that might result which I insist
has similar and , a matrix with one typeit seems veryas we say
literally in Spanishother

2016-01-11 13:53 GMT+01:00 Dirk Eddelbuettel <edd at debian.org>:
>
> I don't want to sound disrespectful, but why not use RcppArmadillo if
> simplicity is you goal?
>
> It is hard to beat the _fully automatic_ conversion:
>
> R> cppFunction("arma::mat doubleUp(const arma::mat & x) { return 2*x; }", depends="RcppArmadillo")
> R> doubleUp(matrix(1:9,3,3))
>      [,1] [,2] [,3]
> [1,]    2    8   14
> [2,]    4   10   16
> [3,]    6   12   18
> R>
>
> You can of course do all that by hand too, but why do you think both Rcpp and
> RcppArmadillo have, respectively, tens of thousands of lines of code?
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From Berwin.Turlach at gmail.com  Tue Jan 12 05:54:09 2016
From: Berwin.Turlach at gmail.com (Berwin A Turlach)
Date: Tue, 12 Jan 2016 12:54:09 +0800
Subject: [Rd] On 'R CMD INSTALL' with multiple architectures
Message-ID: <20160112125409.10d7e2a7@bossiaea>

G'day all,

I guess it is still early enough in the year to wish everybody a happy
and successful new year.

I thought I should report that the installation of the CRAN package
rstan regularly fails on my machine (a 64 bit linux box running Xubuntu
15.10).  The reason being that I have the 32-bit and the 64-bit
architecture of R installed, and my /tmp file is on a partition with
about 1Gb space.  

During the installation of rstan the compilation of the source
directory regularly fills up my /tmp directory such that at some point
the compilation for the 64-bit architecture (my main architecture)
fails as /tmp runs out of space.  At that time, the src-32 subdirectory
has a size of about 460 MB (~ half of the partition!).

The most recent version of rstan I finally managed to install by
issuing the commands:

	R CMD INSTALL --no-multiarch rstan_2.9.0.tar.gz
followed by
        R --arch=32 CMD INSTALL --libs-only rstan_2.9.0.tar.gz

The last command, to my surprise, actually tried to compile both
libraries (32-bit and 64-bit) again.  So the installation kept failing
until I deleted the src-32 directory while the 64 libraries where build.

By now I realise that the R-admin manual only suggests/documents that
	R --arch=name CMD INSTALL --libs-only pkg1 pgk2 ....
only installs the library for the specified architecture if the package
has "an executable configure script or a src/Makefile file", and is
quite about its behaviour otherwise.  But I wonder whether it would be
reasonable for users to expect that 'R --arch=32 CMD INSTALL
--libs-only' installs only the library for the specified architecture
in all circumstances.

Playing around with a package that also has compiled code, but is
faster to install than rstan, I realise now that my second command
should have been:
  R --arch=32 CMD INSTALL --libs-only --no-multiarch rstan_2.9.0.tar.gz

In summary, I would like to suggest that 'R CMD INSTALL' deletes
architecture specific 'src' subdirectories as soon as they are no
longer needed and/or that 'R --arch=name CMD INSTALL --libs-only'
installs only libraries for the specified architecture (as an unwary
user might expect).

Cheers,

	Berwin

========================== Full address ============================
A/Prof Berwin A Turlach               Tel.: +61 (8) 6488 3338 (secr)
School of Maths and Stats (M019)            +61 (8) 6488 3383 (self)
The University of Western Australia   FAX : +61 (8) 6488 1028
35 Stirling Highway                   
Crawley WA 6009                     e-mail: Berwin.Turlach at gmail.com
Australia                http://www.maths.uwa.edu.au/~berwin
                         http://www.researcherid.com/rid/A-4995-2008


From Berwin.Turlach at gmail.com  Tue Jan 12 05:59:27 2016
From: Berwin.Turlach at gmail.com (Berwin A Turlach)
Date: Tue, 12 Jan 2016 12:59:27 +0800
Subject: [Rd] Small inaccuracy in the Writing R Extensions manual
Message-ID: <20160112125927.1921cead@bossiaea>

G'day all,

In Chapter 1.4 (Writing package vignettes) the Writing R Extensions
manual states:

	By default @code{R CMD build} will run @code{Sweave} on all
	Sweave vignette source files in @file{vignettes}.  If
	@file{Makefile} is found in the vignette source directory, then
	@code{R CMD build} will try to run @command{make} after the
	@code{Sweave} runs, otherwise @code{texi2pdf} is run on each
	@file{.tex} file produced.

This does not seem to be quite correct as stated.  'R CMD build' seems
to run make only if there was a file in the directory vignettes that
Sweave successfully processed.   If the directory vignettes contains a
Makefile and subdirectories in which the actual vignettes are, 'R CMD
build' does not run make.

Cheers,

	Berwin


From murdoch.duncan at gmail.com  Tue Jan 12 13:32:05 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 12 Jan 2016 07:32:05 -0500
Subject: [Rd] Small inaccuracy in the Writing R Extensions manual
In-Reply-To: <20160112125927.1921cead@bossiaea>
References: <20160112125927.1921cead@bossiaea>
Message-ID: <5694F245.5030908@gmail.com>

On 11/01/2016 11:59 PM, Berwin A Turlach wrote:
> G'day all,
>
> In Chapter 1.4 (Writing package vignettes) the Writing R Extensions
> manual states:
>
> 	By default @code{R CMD build} will run @code{Sweave} on all
> 	Sweave vignette source files in @file{vignettes}.  If
> 	@file{Makefile} is found in the vignette source directory, then
> 	@code{R CMD build} will try to run @command{make} after the
> 	@code{Sweave} runs, otherwise @code{texi2pdf} is run on each
> 	@file{.tex} file produced.
>
> This does not seem to be quite correct as stated.  'R CMD build' seems
> to run make only if there was a file in the directory vignettes that
> Sweave successfully processed.   If the directory vignettes contains a
> Makefile and subdirectories in which the actual vignettes are, 'R CMD
> build' does not run make.
>

I think it is behaving as documented:  it says it will run make after 
Sweave, so if Sweave never ran, neither would make.  But perhaps your 
suggestion is good:  it should run make whether or not Sweave (or some 
non-Sweave vignette builder) was run.

Duncan Murdoch


From maechler at stat.math.ethz.ch  Tue Jan 12 15:30:05 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 12 Jan 2016 15:30:05 +0100
Subject: [Rd] Small inaccuracy in the Writing R Extensions manual
In-Reply-To: <5694F245.5030908@gmail.com>
References: <20160112125927.1921cead@bossiaea>
	<5694F245.5030908@gmail.com>
Message-ID: <22165.3565.137331.172351@stat.math.ethz.ch>

>>>>> Duncan Murdoch <murdoch.duncan at gmail.com>
>>>>>     on Tue, 12 Jan 2016 07:32:05 -0500 writes:

    > On 11/01/2016 11:59 PM, Berwin A Turlach wrote:
    >> G'day all,
    >> 
    >> In Chapter 1.4 (Writing package vignettes) the Writing R
    >> Extensions manual states:
    >> 
    >> By default @code{R CMD build} will run @code{Sweave} on
    >> all Sweave vignette source files in @file{vignettes}.  If
    >> @file{Makefile} is found in the vignette source
    >> directory, then @code{R CMD build} will try to run
    >> @command{make} after the @code{Sweave} runs, otherwise
    >> @code{texi2pdf} is run on each @file{.tex} file produced.
    >> 
    >> This does not seem to be quite correct as stated.  'R CMD
    >> build' seems to run make only if there was a file in the
    >> directory vignettes that Sweave successfully processed.
    >> If the directory vignettes contains a Makefile and
    >> subdirectories in which the actual vignettes are, 'R CMD
    >> build' does not run make.
    >> 

    > I think it is behaving as documented: it says it will run
    > make after Sweave, so if Sweave never ran, neither would
    > make.  But perhaps your suggestion is good: it should run
    > make whether or not Sweave (or some non-Sweave vignette
    > builder) was run.

    > Duncan Murdoch

I agree.  These were my thoughts too.
Martin


From Berwin.Turlach at gmail.com  Tue Jan 12 17:11:35 2016
From: Berwin.Turlach at gmail.com (Berwin A Turlach)
Date: Wed, 13 Jan 2016 00:11:35 +0800
Subject: [Rd] Small inaccuracy in the Writing R Extensions manual
In-Reply-To: <5694F245.5030908@gmail.com>
References: <20160112125927.1921cead@bossiaea>
	<5694F245.5030908@gmail.com>
Message-ID: <20160113001135.7b93bc28@absentia>

G'day Duncan,

On Tue, 12 Jan 2016 07:32:05 -0500
Duncan Murdoch <murdoch.duncan at gmail.com> wrote:

> On 11/01/2016 11:59 PM, Berwin A Turlach wrote:
> > G'day all,
> >
> > In Chapter 1.4 (Writing package vignettes) the Writing R Extensions
> > manual states:
> >
> > 	By default @code{R CMD build} will run @code{Sweave} on all
> > 	Sweave vignette source files in @file{vignettes}.  If
> > 	@file{Makefile} is found in the vignette source directory,
> > then @code{R CMD build} will try to run @command{make} after the
> > 	@code{Sweave} runs, otherwise @code{texi2pdf} is run on each
> > 	@file{.tex} file produced.
> >
> > This does not seem to be quite correct as stated.  'R CMD build'
> > seems to run make only if there was a file in the directory
> > vignettes that Sweave successfully processed.   If the directory
> > vignettes contains a Makefile and subdirectories in which the
> > actual vignettes are, 'R CMD build' does not run make.
> >
> 
> I think it is behaving as documented:  it says it will run make after 
> Sweave, so if Sweave never ran, neither would make.  

Sorry, I disagree.  It says that  "R CMD build will try to run make
after the Sweave runs".  For me (and probably others) "after the Sweave
runs" (note the plural) include the cases of "no Sweave runs" and "one
Sweave run".  Otherwise the case of one vignette in the vignettes
directory would produce undocumented (albeit expected) behaviour. :-)

Cheers,

	Berwin


From murdoch.duncan at gmail.com  Tue Jan 12 18:42:34 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 12 Jan 2016 12:42:34 -0500
Subject: [Rd] Small inaccuracy in the Writing R Extensions manual
In-Reply-To: <20160113001135.7b93bc28@absentia>
References: <20160112125927.1921cead@bossiaea> <5694F245.5030908@gmail.com>
	<20160113001135.7b93bc28@absentia>
Message-ID: <56953B0A.2080408@gmail.com>

On 12/01/2016 11:11 AM, Berwin A Turlach wrote:
> G'day Duncan,
>
> On Tue, 12 Jan 2016 07:32:05 -0500
> Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>
> > On 11/01/2016 11:59 PM, Berwin A Turlach wrote:
> > > G'day all,
> > >
> > > In Chapter 1.4 (Writing package vignettes) the Writing R Extensions
> > > manual states:
> > >
> > > 	By default @code{R CMD build} will run @code{Sweave} on all
> > > 	Sweave vignette source files in @file{vignettes}.  If
> > > 	@file{Makefile} is found in the vignette source directory,
> > > then @code{R CMD build} will try to run @command{make} after the
> > > 	@code{Sweave} runs, otherwise @code{texi2pdf} is run on each
> > > 	@file{.tex} file produced.
> > >
> > > This does not seem to be quite correct as stated.  'R CMD build'
> > > seems to run make only if there was a file in the directory
> > > vignettes that Sweave successfully processed.   If the directory
> > > vignettes contains a Makefile and subdirectories in which the
> > > actual vignettes are, 'R CMD build' does not run make.
> > >
> >
> > I think it is behaving as documented:  it says it will run make after
> > Sweave, so if Sweave never ran, neither would make.
>
> Sorry, I disagree.  It says that  "R CMD build will try to run make
> after the Sweave runs".  For me (and probably others) "after the Sweave
> runs" (note the plural) include the cases of "no Sweave runs" and "one
> Sweave run".  Otherwise the case of one vignette in the vignettes
> directory would produce undocumented (albeit expected) behaviour. :-)

Regardless of that, there's a problem if there is no vignette in the 
main directory.  R uses the vignette filename and content to figure out 
which vignette engine to use.  If there's just a Makefile, how would R 
know what to display?  Which .html file or .pdf file corresponds to 
which source file, and where should R go to find the .R file?

So I don't think those things can really be handled as vignettes. They 
can still be handled as  additional files in the inst/doc directory, but 
we probably aren't going to be able to give them full vignette status.

Duncan Murdoch


From cstrato at aon.at  Wed Jan 13 18:57:52 2016
From: cstrato at aon.at (cstrato)
Date: Wed, 13 Jan 2016 18:57:52 +0100
Subject: [Rd] xps installation error on Mac OS X 10.11
In-Reply-To: <D2BBF369.29BE9%zhujack@mail.nih.gov>
References: <D2BBF369.29BE9%zhujack@mail.nih.gov>
Message-ID: <56969020.6040603@aon.at>

Dear Jack,

First, please do not use r-help or r-devel to ask Bioconductor-related 
questions, Bioconductor has its own support site for BioC packages:
https://support.bioconductor.org/

Second, please note that ROOT_6.x cannot be used for xps.

In the README file I mention for Yosemite:
ftp://root.cern.ch/root/root_v5.34.30.macosx64-10.10-clang61.tar.gz
However, you can probably also use the newest version:
ftp://root.cern.ch/root/root_v5.34.34.macosx64-10.10-clang61.tar.gz

Before installing ROOT again please make sure to delete all versions of 
ROOT that you have already installed.

Best regards,
Christian




On 01/13/16 18:28, Zhu, Jack (NIH/NCI) [E] wrote:
>   Dear Christian,
>
> Sorry for bothering you, but it looks like I really need your help with
> the xps installation on my Mac OS X 10.11 system.  I have been
> struggling for a few days and tried all the options listed in your
> README file:
>
> http://bioconductor.org/packages/devel/bioc/readmes/xps/README
>
> I also read all the online posts related to the xps installation.  But
> still have problem.  By strictly following the instructions,  I
> re-installed ROOT from both source and binary for Mac OS X 10.11 and
> added ROOT environmental variables in my .bashrc (all the four lines).
>   The ROOT itself seems working totally fine by different tests and the
>
>     $ echo $ROOTSYS
>     /Applications/root_v6.06.00
>
>     $ echo $LD_LIBRARY_PATH
>     /Applications/root_v6.06.00/lib
>     $ echo $DYLD_LIBRARY_PATH
>     /Applications/root_v6.06.00
>     $echo $PATH
>     /Applications/root_v6.06.00/bin:?
>
> But I always get an error with LD_LIBRARY_PATH when I try to install the
> xps package from the source:
>
>     -------------------
>     $R CMD INSTALL -d -l /Users/zhujack/Library/R/3.3/library
>     xps_1.31.0.tar.gz
>
>     found ROOT version 6.06/00 in directory /Applications/root_v6.06.00
>
>     xps configuration error:
>
>         You must set the shell variable LD_LIBRARY_PATH to the
>         directory where ROOT resides and re-run R CMD INSTALL
>         e.g., (using Bourne shell syntax):
>
>            export "LD_LIBRARY_PATH=$ROOTSYS/lib:$LD_LIBRARY_PATH"
>            R CMD INSTALL xps
>
>         Please consult the README file for more information
>
>     ERROR: configuration failed for package ?xps?
>     * removing ?/Users/zhujack/Library/R/3.3/library/xps?
>     * restoring previous ?/Users/zhujack/Library/R/3.3/library/xps?
>
> I also tried to add the following line to the /usr/local/bin/R:
>
>     LD_LIBRARY_PATH="${LD_LIBRARY_PATH}:/Applications/root_v6.06.00/lib"
>     export LD_LIBRARY_PATH
>
>
> But I still get the same error.  Your help and insigts will be greatly
> appreciared.
>
> Jack
>
>  > sessionInfo()
> R Under development (unstable) (2016-01-11 r69918)
> Platform: x86_64-apple-darwin13.4.0 (64-bit)
> Running under: OS X 10.11.2 (El Capitan)
>
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] BiocInstaller_1.21.2


From hpages at fredhutch.org  Wed Jan 13 19:44:21 2016
From: hpages at fredhutch.org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Wed, 13 Jan 2016 10:44:21 -0800
Subject: [Rd] subscripting a table changed behavior in R devel
Message-ID: <56969B05.8020203@fredhutch.org>

Hi,

With R 3.2.3:

   > t <- table(sample(6, 50, replace=TRUE), sample(4, 50, replace=TRUE))
   > class(t[1:3, ])
   [1] "matrix"

With R devel:

   > t <- table(sample(6, 50, replace=TRUE), sample(4, 50, replace=TRUE))
   > class(t[1:3, ])
   [1] "table"

This breaks some Bioconductor packages that are calling as.data.frame()
on the result of this subscripting (as.data.frame.table and
as.data.frame.matrix behave very differently).

Could this change be mentioned in the NEWS file?

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fredhutch.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From wdunlap at tibco.com  Wed Jan 13 22:46:05 2016
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 13 Jan 2016 13:46:05 -0800
Subject: [Rd] as.data.frame and illegal row.names argument (bug in
	package:DoE.wrapper?)
Message-ID: <CAF8bMcaQvSHxDbEkLexMOLRFWCPXa1DSvykE+9xeWnRudouknQ@mail.gmail.com>

as.data.frame methods behave inconsistently when they are given a row.name
argument of the wrong length.  The matrix method silently ignores row.names
if it has the wrong length and the numeric, integer, and character methods
do not bother to check and thus make an illegal data.frame.

> as.data.frame(matrix(1:6,nrow=3), row.names=c("One","Two"))
  V1 V2
1  1  4
2  2  5
3  3  6
> as.data.frame(1:3, row.names=c("One","Two"))
    1:3
One   1
Two   2
Warning message:
In format.data.frame(x, digits = digits, na.encode = FALSE) :
  corrupt data frame: columns will be truncated or padded with NAs
> as.data.frame(c("a","b","c"), row.names=c("One","Two"))
    c("a", "b", "c")
One                a
Two                b
Warning message:
In format.data.frame(x, digits = digits, na.encode = FALSE) :
  corrupt data frame: columns will be truncated or padded with NAs

(The warnings are from the printing, not the making, of the data.frames.)

I ran into this while using the DoE.wrapper package, which has what I think
is a typo,
giving "t" as the row.names for the output of mapply():
   cross.design.R:    ro <- as.data.frame(mapply("touter",ro1, ro2,
"paste", sep="_"),"t")

I don't know all the reasons why people use as.data.frame instead of
data.frame.


Bill Dunlap
TIBCO Software
wdunlap tibco.com

	[[alternative HTML version deleted]]


From thomas.fuller at coherentlogic.com  Thu Jan 14 22:52:21 2016
From: thomas.fuller at coherentlogic.com (Thomas Fuller)
Date: Thu, 14 Jan 2016 16:52:21 -0500
Subject: [Rd] JDataFrame API
Message-ID: <CAM0JZ3=Xj=c2-VyHO3-8uVjyAgaMoMKr1udnbo4xdvyNEHm55w@mail.gmail.com>

Hi Folks,

If you need to send data from Java to R you may consider using the
JDataFrame API -- which is used to convert data into JSON which then
can be converted into a data frame in R.

Here's the project page:

https://coherentlogic.com/middleware-development/jdataframe/

and here's a partial example which demonstrates what the API looks like:

String result = new JDataFrameBuilder()
    .addColumn("Code", new Object[] {"WV", "VA", })
    .addColumn("Description", new Object[] {"West Virginia", "Virginia"})
    .toJson();

and in R script we would need to do this:

temp <- RJSONIO::fromJSON(json)
tempDF <- as.data.frame(temp)

which yields a data frame that looks like this:

> tempDF
    Description Code
1 West Virginia   WV
2      Virginia   VA

It is my intention to deploy this project to Maven Central this week,
time permitting.

Questions and comments are welcomed.

Tom


From pgrosu at gmail.com  Thu Jan 14 23:35:49 2016
From: pgrosu at gmail.com (Paul Grosu)
Date: Thu, 14 Jan 2016 17:35:49 -0500
Subject: [Rd] as.data.frame and illegal row.names argument (bug
	in	package:DoE.wrapper?)
References: <CAF8bMcaQvSHxDbEkLexMOLRFWCPXa1DSvykE+9xeWnRudouknQ@mail.gmail.com>
Message-ID: <074701d14f1b$eb665ac0$c2331040$@gmail.com>


Hi Bill,

The thing is that is happening here is the specific instance of
as.data.frame that is being run, which in this instance switch between
as.data.frame.matrix() and as.data.frame.matrix().  I attached the
dataframe.R code, which you can find the src/library/base/R folder of the
source code.  Though if you use data.frame() it will give a more expected
result.  

For instance the first runs as follows through matrix:

> as.data.frame.matrix(matrix(1:6,nrow=3), row.names=c("One","Two"))
  V1 V2
1  1  4
2  2  5
3  3  6

The other two run via vector:

> as.data.frame.vector(1:3, row.names=c("One","Two"))
    1:3
One   1
Two   2
Warning message:
In format.data.frame(x, digits = digits, na.encode = FALSE) :
  corrupt data frame: columns will be truncated or padded with NAs

> as.data.frame.vector(c("a","b","c"), row.names=c("One","Two"))
    c("a", "b", "c")
One                a
Two                b
Warning message:
In format.data.frame(x, digits = digits, na.encode = FALSE) :
  corrupt data frame: columns will be truncated or padded with NAs

The thing is that if you use data.frame() it will work more as expected:

> data.frame(matrix(1:6,nrow=3), row.names=c("One","Two"))
Error in data.frame(matrix(1:6, nrow = 3), row.names = c("One", "Two")) : 
  row names supplied are of the wrong length

> data.frame(matrix(1:6,nrow=3), row.names=c("One","Two","Three"))
      X1 X2
One    1  4
Two    2  5
Three  3  6

> data.frame(c("a","b","c"), row.names=c("One","Two"))
Error in data.frame(c("a", "b", "c"), row.names = c("One", "Two")) : 
  row names supplied are of the wrong length

> data.frame(c("a","b","c"), row.names=c("One","Two","Three"))
      c..a....b....c..
One                  a
Two                  b
Three                c

> data.frame(1:3, row.names=c("One","Two"))
Error in data.frame(1:3, row.names = c("One", "Two")) : 
  row names supplied are of the wrong length

> data.frame(1:3, row.names=c("One","Two","Three"))
      X1.3
One      1
Two      2
Three    3

Hope it helps,
Paul

-----Original Message-----
From: R-devel [mailto:r-devel-bounces at r-project.org] On Behalf Of William
Dunlap via R-devel
Sent: Wednesday, January 13, 2016 4:46 PM
To: r-devel at r-project.org; Ulrike Groemping
Subject: [Rd] as.data.frame and illegal row.names argument (bug in
package:DoE.wrapper?)

as.data.frame methods behave inconsistently when they are given a row.name
argument of the wrong length.  The matrix method silently ignores row.names
if it has the wrong length and the numeric, integer, and character methods
do not bother to check and thus make an illegal data.frame.

> as.data.frame(matrix(1:6,nrow=3), row.names=c("One","Two"))
  V1 V2
1  1  4
2  2  5
3  3  6
> as.data.frame(1:3, row.names=c("One","Two"))
    1:3
One   1
Two   2
Warning message:
In format.data.frame(x, digits = digits, na.encode = FALSE) :
  corrupt data frame: columns will be truncated or padded with NAs
> as.data.frame(c("a","b","c"), row.names=c("One","Two"))
    c("a", "b", "c")
One                a
Two                b
Warning message:
In format.data.frame(x, digits = digits, na.encode = FALSE) :
  corrupt data frame: columns will be truncated or padded with NAs

(The warnings are from the printing, not the making, of the data.frames.)

I ran into this while using the DoE.wrapper package, which has what I think
is a typo, giving "t" as the row.names for the output of mapply():
   cross.design.R:    ro <- as.data.frame(mapply("touter",ro1, ro2,
"paste", sep="_"),"t")

I don't know all the reasons why people use as.data.frame instead of
data.frame.


Bill Dunlap
TIBCO Software
wdunlap tibco.com

	[[alternative HTML version deleted]]

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Fri Jan 15 08:57:03 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 15 Jan 2016 08:57:03 +0100
Subject: [Rd] as.data.frame and illegal row.names argument (bug in
	package:DoE.wrapper?)
In-Reply-To: <074701d14f1b$eb665ac0$c2331040$@gmail.com>
References: <CAF8bMcaQvSHxDbEkLexMOLRFWCPXa1DSvykE+9xeWnRudouknQ@mail.gmail.com>
	<074701d14f1b$eb665ac0$c2331040$@gmail.com>
Message-ID: <22168.42575.283450.893916@stat.math.ethz.ch>

>>>>> Paul Grosu <pgrosu at gmail.com>
>>>>>     on Thu, 14 Jan 2016 17:35:49 -0500 writes:

 > Hi Bill,

 > The thing is that is happening here is the specific
 > instance of as.data.frame that is being run, which in this
 > instance switch between as.data.frame.matrix() and as.data.frame.matrix().  

(This must be another typo i.e. "cut/n/paste forgot to modify" lapsus;
 you probably meant *.vector in the 2nd case).

I'm pretty sure Bill was not asking *why* this happens {he would
easily find out if he wanted} but reporting two (potential) bugs:

- one in R  [not reporting erronous as.data.frame() usage]
- one in DoE.wrapper

I'm going to look into the  R one, which is indeed in the
as.data.frame.vector() method, as you've noted.

--
Martin Maechler
ETH Zurich


From soumenpal1990 at yahoo.com  Fri Jan 15 08:05:21 2016
From: soumenpal1990 at yahoo.com (Soumen Pal)
Date: Fri, 15 Jan 2016 07:05:21 +0000 (UTC)
Subject: [Rd] Error in socketConnection(master, port = port, blocking = TRUE,
 open = "a+b", :    cannot open the connection
References: <930069797.4964946.1452841521886.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <930069797.4964946.1452841521886.JavaMail.yahoo@mail.yahoo.com>

Dear All

I have sucessfully created cluster of four nodes using localhost in my local machine by executing the following command

> cl<-makePSOCKcluster(c(rep("localhost",4)),outfile='',homogeneous=FALSE,port=11001)
starting worker pid=4271 on localhost:11001 at 12:12:26.164
starting worker pid=4280 on localhost:11001 at 12:12:26.309
starting worker pid=4289 on localhost:11001 at 12:12:26.456
starting worker pid=4298 on localhost:11001 at 12:12:26.604
> 
> stopCluster(cl)

Now I am trying to create a cluster of 2 nodes (one in my local machine and another remote machine) by using "makePSOCKcluster" command. Both machine have identical settings and connected by SSH. OS is Ubuntu 14.04 LTS & R version 3.2.1. I have executed the follwoing command to create cluster but getting the following error message and R Session is getting hanged.

cl<-makePSOCKcluster(c(rep("soumen at 10.10.2.32",1)),outfile='',homogeneous=FALSE,port=11001)
soumen at 10.10.2.32's password: 
starting worker pid=2324 on soumen-HP-ProBook-440-G2:11001 at 12:11:59.349
Error in socketConnection(master, port = port, blocking = TRUE, open = "a+b",? : 
? cannot open the connection
Calls: <Anonymous> ... doTryCatch -> recvData -> makeSOCKmaster -> socketConnection
In addition: Warning message:
In socketConnection(master, port = port, blocking = TRUE, open = "a+b",? :
? soumen-HP-ProBook-440-G2:11001 cannot be opened
Execution halted


My sessionInfo() is as follwos

sessionInfo()
R version 3.2.1 (2015-06-18)
Platform: x86_64-unknown-linux-gnu (64-bit)
Running under: Ubuntu 14.04.1 LTS

locale:
?[1] LC_CTYPE=en_IN?????? LC_NUMERIC=C???????? LC_TIME=en_IN?????? 
?[4] LC_COLLATE=en_IN???? LC_MONETARY=en_IN??? LC_MESSAGES=en_IN?? 
?[7] LC_PAPER=en_IN?????? LC_NAME=C??????????? LC_ADDRESS=C??????? 
[10] LC_TELEPHONE=C?????? LC_MEASUREMENT=en_IN LC_IDENTIFICATION=C 

attached base packages:
[1] parallel? stats???? graphics? grDevices utils???? datasets? methods? 
[8] base?? 


I dont know how to solve this problem.Plese help me to solve this problem.

Thanks

Soumen Pal

	[[alternative HTML version deleted]]


From daniel.kaschek at physik.uni-freiburg.de  Fri Jan 15 15:03:40 2016
From: daniel.kaschek at physik.uni-freiburg.de (Daniel Kaschek)
Date: Fri, 15 Jan 2016 15:03:40 +0100
Subject: [Rd] Multiple cores are used in simple for loop
Message-ID: <1452866620.6790.3@physik.uni-freiburg.de>

Dear all,

I run different R versions (3.2.1, 3.2.2 and 3.2.3) on different 
platforms (Arch, Ubuntu, Debian) with a different number of available 
cores (24, 4, 24). The following line produces very different behavior 
on the three machines:

for(i in 1:1e6) {n <- 100; M <- matrix(rnorm(n^2), n, n); M %*% M}

On the Ubuntu and Arch machine one core is used, but on the Debian 
machine ALL cores are used with heavy "kernel time" vs. "normal time" 
(red vs. green in htop). It seems that the number of cores used on 
Debian is related to the size of the matrix. Reducing n from 100 to 4 
causes four cores to work.

A similar problem persists with the parallel package and mclapply():

library(parallel)
out <- mclapply(1:1e6, function(i) { n <- 100; M <- matrix(rnorm(n^2), 
n, n); M %*% M }, mc.cores = 24)

On Arch and Debian all 24 cores run and show a high kernel time vs. 
normal time (all CPU bars in htop are 80% red). With mc.cores = 4 on 
the Ubuntu system however, all four cores run at full load with almost 
no kernel time but full normal time (all bars are green).

Have you seen this problem before? Does anybody know how to fix it?

Cheers,
Daniel


From Martin.Morgan at roswellpark.org  Fri Jan 15 15:49:00 2016
From: Martin.Morgan at roswellpark.org (Morgan, Martin)
Date: Fri, 15 Jan 2016 14:49:00 +0000
Subject: [Rd] Error in socketConnection(master, port = port,
 blocking = TRUE, open = "a+b", :    cannot open the connection
In-Reply-To: <930069797.4964946.1452841521886.JavaMail.yahoo@mail.yahoo.com>
References: <930069797.4964946.1452841521886.JavaMail.yahoo.ref@mail.yahoo.com>,
	<930069797.4964946.1452841521886.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <DF23DAC5A53912408040FF04D8B780AAE5B46B@EXMB3RSC.roswellpark.org>

Arrange to make the ssh connection passwordless. Do this by copying your 'public key' to the machine that you are trying to connect to. Google will be your friend in accomplishing this.

It might be that a firewall stands between you and the other machine, or that the other machine does not allow connections to port 11001. Either way, the direction toward a solution is to speak with your system administrator. If it is firewall, then they are unlikely to accommodate you; the strategy is to run your cluster exclusively on one side of the firewall.

Martin Morgan
________________________________________
From: R-devel [r-devel-bounces at r-project.org] on behalf of Soumen Pal via R-devel [r-devel at r-project.org]
Sent: Friday, January 15, 2016 2:05 AM
To: r-devel at r-project.org
Subject: [Rd] Error in socketConnection(master, port = port, blocking = TRUE, open = "a+b", :    cannot open the connection

Dear All

I have sucessfully created cluster of four nodes using localhost in my local machine by executing the following command

> cl<-makePSOCKcluster(c(rep("localhost",4)),outfile='',homogeneous=FALSE,port=11001)
starting worker pid=4271 on localhost:11001 at 12:12:26.164
starting worker pid=4280 on localhost:11001 at 12:12:26.309
starting worker pid=4289 on localhost:11001 at 12:12:26.456
starting worker pid=4298 on localhost:11001 at 12:12:26.604
>
> stopCluster(cl)

Now I am trying to create a cluster of 2 nodes (one in my local machine and another remote machine) by using "makePSOCKcluster" command. Both machine have identical settings and connected by SSH. OS is Ubuntu 14.04 LTS & R version 3.2.1. I have executed the follwoing command to create cluster but getting the following error message and R Session is getting hanged.

cl<-makePSOCKcluster(c(rep("soumen at 10.10.2.32",1)),outfile='',homogeneous=FALSE,port=11001)
soumen at 10.10.2.32's password:
starting worker pid=2324 on soumen-HP-ProBook-440-G2:11001 at 12:11:59.349
Error in socketConnection(master, port = port, blocking = TRUE, open = "a+b",  :
  cannot open the connection
Calls: <Anonymous> ... doTryCatch -> recvData -> makeSOCKmaster -> socketConnection
In addition: Warning message:
In socketConnection(master, port = port, blocking = TRUE, open = "a+b",  :
  soumen-HP-ProBook-440-G2:11001 cannot be opened
Execution halted


My sessionInfo() is as follwos

sessionInfo()
R version 3.2.1 (2015-06-18)
Platform: x86_64-unknown-linux-gnu (64-bit)
Running under: Ubuntu 14.04.1 LTS

locale:
 [1] LC_CTYPE=en_IN       LC_NUMERIC=C         LC_TIME=en_IN
 [4] LC_COLLATE=en_IN     LC_MONETARY=en_IN    LC_MESSAGES=en_IN
 [7] LC_PAPER=en_IN       LC_NAME=C            LC_ADDRESS=C
[10] LC_TELEPHONE=C       LC_MEASUREMENT=en_IN LC_IDENTIFICATION=C

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods
[8] base


I dont know how to solve this problem.Plese help me to solve this problem.

Thanks

Soumen Pal

        [[alternative HTML version deleted]]

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

This email message may contain legally privileged and/or confidential information.  If you are not the intended recipient(s), or the employee or agent responsible for the delivery of this message to the intended recipient(s), you are hereby notified that any disclosure, copying, distribution, or use of this email message is prohibited.  If you have received this message in error, please notify the sender immediately by e-mail and delete this email message from your computer. Thank you.

From plummerm at iarc.fr  Fri Jan 15 16:01:51 2016
From: plummerm at iarc.fr (Martyn Plummer)
Date: Fri, 15 Jan 2016 15:01:51 +0000
Subject: [Rd] Multiple cores are used in simple for loop
In-Reply-To: <1452866620.6790.3@physik.uni-freiburg.de>
References: <1452866620.6790.3@physik.uni-freiburg.de>
Message-ID: <1452870046.30832.109.camel@iarc.fr>

On Fri, 2016-01-15 at 15:03 +0100, Daniel Kaschek wrote:
> Dear all,
> 
> I run different R versions (3.2.1, 3.2.2 and 3.2.3) on different 
> platforms (Arch, Ubuntu, Debian) with a different number of available 
> cores (24, 4, 24). The following line produces very different behavior 
> on the three machines:
> 
> for(i in 1:1e6) {n <- 100; M <- matrix(rnorm(n^2), n, n); M %*% M}
> 
> On the Ubuntu and Arch machine one core is used, but on the Debian 
> machine ALL cores are used with heavy "kernel time" vs. "normal time" 
> (red vs. green in htop). It seems that the number of cores used on 
> Debian is related to the size of the matrix. Reducing n from 100 to 4 
> causes four cores to work.

It depends on what backend R is using for linear algebra. Some will
split large matrix calculations over multiple threads. On Debian, you
can set the blas and lapack libraries to the implementation of your
choice. 

https://wiki.debian.org/DebianScience/LinearAlgebraLibraries

As far as I know reference blas and lapack are still single threaded.

Alternatively, you may be able to control the maximum number of threads
by setting and exporting an appropriate environment variable depending
on what backend you are using, e.g. OPENBLAS_NUM_THREADS or
MKL_NUM_THREADS.

Martyn

> A similar problem persists with the parallel package and mclapply():
> 
> library(parallel)
> out <- mclapply(1:1e6, function(i) { n <- 100; M <- matrix(rnorm(n^2), 
> n, n); M %*% M }, mc.cores = 24)
> 
> On Arch and Debian all 24 cores run and show a high kernel time vs. 
> normal time (all CPU bars in htop are 80% red). With mc.cores = 4 on 
> the Ubuntu system however, all four cores run at full load with almost 
> no kernel time but full normal time (all bars are green).
> 
> Have you seen this problem before? Does anybody know how to fix it?
> 
> Cheers,
> Daniel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From simon.urbanek at r-project.org  Fri Jan 15 16:58:14 2016
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 15 Jan 2016 10:58:14 -0500
Subject: [Rd] JDataFrame API
In-Reply-To: <CAM0JZ3=Xj=c2-VyHO3-8uVjyAgaMoMKr1udnbo4xdvyNEHm55w@mail.gmail.com>
References: <CAM0JZ3=Xj=c2-VyHO3-8uVjyAgaMoMKr1udnbo4xdvyNEHm55w@mail.gmail.com>
Message-ID: <EBCED75E-568C-47DA-9031-E894AACB66C4@r-project.org>

Tom,

this may be good for embedding small data sets, but for practical purposes is doesn't seem like the most efficient solution.

Since you didn't provide any code, I built a test case using the build-in Java JSON API to build a medium-sized dataset (1e6 rows) and read it in just to get a ballpark (see
https://gist.github.com/s-u/4efb284e3c15c6a2db16

# generate:
time java -cp .:javax.json-api-1.0.jar:javax.json-1.0.4.jar A > 1e6

real	0m2.764s
user	0m20.356s
sys	0m0.962s

# read:
> system.time(temp <- RJSONIO::fromJSON("1e6"))
   user  system elapsed 
  3.484   0.279   3.834 
> str(temp)
List of 2
 $ V1: num [1:1000000] 0 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 ...
 $ V2: chr [1:1000000] "X0" "X1" "X2" "X3" ...

For comparison using Java directly (includes both generation and reading into R):

> system.time(temp <- lapply(J("A")$direct(), .jevalArray))
   user  system elapsed 
  0.962   0.186   0.494 

So the JSON route is very roughly ~13x slower than using Java directly. Obviously, this will vary by data set type etc. since there is R overhead involved as well: for example, if you have only numeric variables, the JSON route is 30x slower on reading alone [50x total]. String variables slow down everyone equally. Interestingly, the JSON encoding is using all 16 cores, so the 2.7s real time add up to over 20s CPU time so on smaller machines you may see more overhead. 

If you need process separation, it may be a different story - in principle it is faster to use more native serialization than JSON since parsing is the slowest part for big datasets.

Cheers,
Simon


> On Jan 14, 2016, at 4:52 PM, Thomas Fuller <thomas.fuller at coherentlogic.com> wrote:
> 
> Hi Folks,
> 
> If you need to send data from Java to R you may consider using the
> JDataFrame API -- which is used to convert data into JSON which then
> can be converted into a data frame in R.
> 
> Here's the project page:
> 
> https://coherentlogic.com/middleware-development/jdataframe/
> 
> and here's a partial example which demonstrates what the API looks like:
> 
> String result = new JDataFrameBuilder()
>    .addColumn("Code", new Object[] {"WV", "VA", })
>    .addColumn("Description", new Object[] {"West Virginia", "Virginia"})
>    .toJson();
> 
> and in R script we would need to do this:
> 
> temp <- RJSONIO::fromJSON(json)
> tempDF <- as.data.frame(temp)
> 
> which yields a data frame that looks like this:
> 
>> tempDF
>    Description Code
> 1 West Virginia   WV
> 2      Virginia   VA
> 
> It is my intention to deploy this project to Maven Central this week,
> time permitting.
> 
> Questions and comments are welcomed.
> 
> Tom
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From thomas.fuller at coherentlogic.com  Fri Jan 15 18:35:15 2016
From: thomas.fuller at coherentlogic.com (Thomas Fuller)
Date: Fri, 15 Jan 2016 12:35:15 -0500
Subject: [Rd] JDataFrame API
In-Reply-To: <EBCED75E-568C-47DA-9031-E894AACB66C4@r-project.org>
References: <CAM0JZ3=Xj=c2-VyHO3-8uVjyAgaMoMKr1udnbo4xdvyNEHm55w@mail.gmail.com>
	<EBCED75E-568C-47DA-9031-E894AACB66C4@r-project.org>
Message-ID: <CAM0JZ3nukiLcAxNQ=duOHmy60P2nUN_HA4O_8VRA5vXS+XuoKQ@mail.gmail.com>

Hi Simon,

Thanks for your feedback. -- this is an observation that I wasn't
considering when I wrote this mainly because I am, in fact, working
with rather small data sets. BTW: There is code there, it's under the
bitbucket link -- here's the direct link if you'd still like to look
at it:

https://bitbucket.org/CoherentLogic/jdataframe

Re "for practical purposes is doesn't seem like the most efficient
solution" and "So the JSON route is very roughly ~13x slower than
using Java directly."

I've not benchmarked this and will take a closer look at what you have
today -- in fact I may include these details on the JDataFrame page.
The JDataFrame targets the use case where there's significant
development being done in Java and data is exported into R and,
additionally, the developer intends to keep the two separated as much
as possible. I could work with Java directly, but then I potentially
end up with quite a bit of Java code taking up space in R and I don't
like this because if I need to refactor something I have to do it in
two places.

There's another use case for the JDataFrame as well and that's in an
enterprise application (you may have alluded to this when you said
"[i]f you need process separation..."). Consider a business where
users are working with R and the application that produces the data is
actually running in Tomcat. Shipping large amounts of data over the
wire in this example would be a performance destroyer, but for small
data sets it certainly would be helpful from a development perspective
to expose JSON-based web services where the R script would be able to
convert a result into a data frame gracefully.

Tom

On Fri, Jan 15, 2016 at 10:58 AM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
> Tom,
>
> this may be good for embedding small data sets, but for practical purposes is doesn't seem like the most efficient solution.
>
> Since you didn't provide any code, I built a test case using the build-in Java JSON API to build a medium-sized dataset (1e6 rows) and read it in just to get a ballpark (see
> https://gist.github.com/s-u/4efb284e3c15c6a2db16
>
> # generate:
> time java -cp .:javax.json-api-1.0.jar:javax.json-1.0.4.jar A > 1e6
>
> real    0m2.764s
> user    0m20.356s
> sys     0m0.962s
>
> # read:
>> system.time(temp <- RJSONIO::fromJSON("1e6"))
>    user  system elapsed
>   3.484   0.279   3.834
>> str(temp)
> List of 2
>  $ V1: num [1:1000000] 0 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 ...
>  $ V2: chr [1:1000000] "X0" "X1" "X2" "X3" ...
>
> For comparison using Java directly (includes both generation and reading into R):
>
>> system.time(temp <- lapply(J("A")$direct(), .jevalArray))
>    user  system elapsed
>   0.962   0.186   0.494
>
> So the JSON route is very roughly ~13x slower than using Java directly. Obviously, this will vary by data set type etc. since there is R overhead involved as well: for example, if you have only numeric variables, the JSON route is 30x slower on reading alone [50x total]. String variables slow down everyone equally. Interestingly, the JSON encoding is using all 16 cores, so the 2.7s real time add up to over 20s CPU time so on smaller machines you may see more overhead.
>
> If you need process separation, it may be a different story - in principle it is faster to use more native serialization than JSON since parsing is the slowest part for big datasets.
>
> Cheers,
> Simon
>
>
>> On Jan 14, 2016, at 4:52 PM, Thomas Fuller <thomas.fuller at coherentlogic.com> wrote:
>>
>> Hi Folks,
>>
>> If you need to send data from Java to R you may consider using the
>> JDataFrame API -- which is used to convert data into JSON which then
>> can be converted into a data frame in R.
>>
>> Here's the project page:
>>
>> https://coherentlogic.com/middleware-development/jdataframe/
>>
>> and here's a partial example which demonstrates what the API looks like:
>>
>> String result = new JDataFrameBuilder()
>>    .addColumn("Code", new Object[] {"WV", "VA", })
>>    .addColumn("Description", new Object[] {"West Virginia", "Virginia"})
>>    .toJson();
>>
>> and in R script we would need to do this:
>>
>> temp <- RJSONIO::fromJSON(json)
>> tempDF <- as.data.frame(temp)
>>
>> which yields a data frame that looks like this:
>>
>>> tempDF
>>    Description Code
>> 1 West Virginia   WV
>> 2      Virginia   VA
>>
>> It is my intention to deploy this project to Maven Central this week,
>> time permitting.
>>
>> Questions and comments are welcomed.
>>
>> Tom
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From daniel.kaschek at physik.uni-freiburg.de  Fri Jan 15 19:15:46 2016
From: daniel.kaschek at physik.uni-freiburg.de (Daniel Kaschek)
Date: Fri, 15 Jan 2016 19:15:46 +0100
Subject: [Rd] Multiple cores are used in simple for loop
In-Reply-To: <1452870046.30832.109.camel@iarc.fr>
References: <1452866620.6790.3@physik.uni-freiburg.de>
	<1452870046.30832.109.camel@iarc.fr>
Message-ID: <1452881746.6790.5@physik.uni-freiburg.de>

Dear Martyn,


On Fr, Jan 15, 2016 at 4:01 , Martyn Plummer <plummerm at iarc.fr> wrote:
> 
> Alternatively, you may be able to control the maximum number of 
> threads
> by setting and exporting an appropriate environment variable depending
> on what backend you are using, e.g. OPENBLAS_NUM_THREADS or
> MKL_NUM_THREADS.


Thanks a lot. Running

export OPENBLAS_NUM_THREADS = 1

in the bash before starting R solves both problems!


Cheers,
Daniel


From simon.urbanek at r-project.org  Fri Jan 15 19:58:31 2016
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 15 Jan 2016 13:58:31 -0500
Subject: [Rd] JDataFrame API
In-Reply-To: <CAM0JZ3nukiLcAxNQ=duOHmy60P2nUN_HA4O_8VRA5vXS+XuoKQ@mail.gmail.com>
References: <CAM0JZ3=Xj=c2-VyHO3-8uVjyAgaMoMKr1udnbo4xdvyNEHm55w@mail.gmail.com>
	<EBCED75E-568C-47DA-9031-E894AACB66C4@r-project.org>
	<CAM0JZ3nukiLcAxNQ=duOHmy60P2nUN_HA4O_8VRA5vXS+XuoKQ@mail.gmail.com>
Message-ID: <40BFB1D4-B5FB-42CC-B7F7-EC68821A109F@r-project.org>


> On Jan 15, 2016, at 12:35 PM, Thomas Fuller <thomas.fuller at coherentlogic.com> wrote:
> 
> Hi Simon,
> 
> Thanks for your feedback. -- this is an observation that I wasn't
> considering when I wrote this mainly because I am, in fact, working
> with rather small data sets. BTW: There is code there, it's under the
> bitbucket link -- here's the direct link if you'd still like to look
> at it:
> 
> https://bitbucket.org/CoherentLogic/jdataframe
> 

Ah, sorry, all links just send you back to the page, so I missed the little filed that tells you how to check it out.


> Re "for practical purposes is doesn't seem like the most efficient
> solution" and "So the JSON route is very roughly ~13x slower than
> using Java directly."
> 
> I've not benchmarked this and will take a closer look at what you have
> today -- in fact I may include these details on the JDataFrame page.
> The JDataFrame targets the use case where there's significant
> development being done in Java and data is exported into R and,
> additionally, the developer intends to keep the two separated as much
> as possible. I could work with Java directly, but then I potentially
> end up with quite a bit of Java code taking up space in R and I don't
> like this because if I need to refactor something I have to do it in
> two places.
> 

No, the code is the same - it makes no difference. The R code is only one call to fetch what you need by calling your Java method. The nice thing is that you in fact save some code since there is no reason to serialize since you can simply access all Java objects directly without serialization.


> There's another use case for the JDataFrame as well and that's in an
> enterprise application (you may have alluded to this when you said
> "[i]f you need process separation..."). Consider a business where
> users are working with R and the application that produces the data is
> actually running in Tomcat. Shipping large amounts of data over the
> wire in this example would be a performance destroyer, but for small
> data sets it certainly would be helpful from a development perspective
> to expose JSON-based web services where the R script would be able to
> convert a result into a data frame gracefully.
> 

Yes, sure, that makes sense. Like I said, I would probably use some native format in that case if I worried about performance. Some candidates that come to my mind are ProtoBuf and QAP (serialization used by Rserve). If you have arrays, you can always serialize them directly which may be most efficient, but you'd probably have to write the wrapper for that yourself (annoyingly, the default Java methods use big-endian format which is slower on most machines). But then, you're right that for Tomcat applications the sizes are small enough that using JSON has the benefit that you can inspect payload by eye and/or other tools very easily.

Cheers,
Simon


> 
> On Fri, Jan 15, 2016 at 10:58 AM, Simon Urbanek
> <simon.urbanek at r-project.org> wrote:
>> Tom,
>> 
>> this may be good for embedding small data sets, but for practical purposes is doesn't seem like the most efficient solution.
>> 
>> Since you didn't provide any code, I built a test case using the build-in Java JSON API to build a medium-sized dataset (1e6 rows) and read it in just to get a ballpark (see
>> https://gist.github.com/s-u/4efb284e3c15c6a2db16
>> 
>> # generate:
>> time java -cp .:javax.json-api-1.0.jar:javax.json-1.0.4.jar A > 1e6
>> 
>> real    0m2.764s
>> user    0m20.356s
>> sys     0m0.962s
>> 
>> # read:
>>> system.time(temp <- RJSONIO::fromJSON("1e6"))
>>   user  system elapsed
>>  3.484   0.279   3.834
>>> str(temp)
>> List of 2
>> $ V1: num [1:1000000] 0 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 ...
>> $ V2: chr [1:1000000] "X0" "X1" "X2" "X3" ...
>> 
>> For comparison using Java directly (includes both generation and reading into R):
>> 
>>> system.time(temp <- lapply(J("A")$direct(), .jevalArray))
>>   user  system elapsed
>>  0.962   0.186   0.494
>> 
>> So the JSON route is very roughly ~13x slower than using Java directly. Obviously, this will vary by data set type etc. since there is R overhead involved as well: for example, if you have only numeric variables, the JSON route is 30x slower on reading alone [50x total]. String variables slow down everyone equally. Interestingly, the JSON encoding is using all 16 cores, so the 2.7s real time add up to over 20s CPU time so on smaller machines you may see more overhead.
>> 
>> If you need process separation, it may be a different story - in principle it is faster to use more native serialization than JSON since parsing is the slowest part for big datasets.
>> 
>> Cheers,
>> Simon
>> 
>> 
>>> On Jan 14, 2016, at 4:52 PM, Thomas Fuller <thomas.fuller at coherentlogic.com> wrote:
>>> 
>>> Hi Folks,
>>> 
>>> If you need to send data from Java to R you may consider using the
>>> JDataFrame API -- which is used to convert data into JSON which then
>>> can be converted into a data frame in R.
>>> 
>>> Here's the project page:
>>> 
>>> https://coherentlogic.com/middleware-development/jdataframe/
>>> 
>>> and here's a partial example which demonstrates what the API looks like:
>>> 
>>> String result = new JDataFrameBuilder()
>>>   .addColumn("Code", new Object[] {"WV", "VA", })
>>>   .addColumn("Description", new Object[] {"West Virginia", "Virginia"})
>>>   .toJson();
>>> 
>>> and in R script we would need to do this:
>>> 
>>> temp <- RJSONIO::fromJSON(json)
>>> tempDF <- as.data.frame(temp)
>>> 
>>> which yields a data frame that looks like this:
>>> 
>>>> tempDF
>>>   Description Code
>>> 1 West Virginia   WV
>>> 2      Virginia   VA
>>> 
>>> It is my intention to deploy this project to Maven Central this week,
>>> time permitting.
>>> 
>>> Questions and comments are welcomed.
>>> 
>>> Tom
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
> 


From henrik.bengtsson at gmail.com  Fri Jan 15 20:38:44 2016
From: henrik.bengtsson at gmail.com (Henrik Bengtsson)
Date: Fri, 15 Jan 2016 11:38:44 -0800
Subject: [Rd] Multiple cores are used in simple for loop
In-Reply-To: <1452881746.6790.5@physik.uni-freiburg.de>
References: <1452866620.6790.3@physik.uni-freiburg.de>
	<1452870046.30832.109.camel@iarc.fr>
	<1452881746.6790.5@physik.uni-freiburg.de>
Message-ID: <CAFDcVCRLjHzopwjVBP8=ye1e1B1M0eqLB5tn0JM_d7QGvb8njA@mail.gmail.com>

On Fri, Jan 15, 2016 at 10:15 AM, Daniel Kaschek
<daniel.kaschek at physik.uni-freiburg.de> wrote:
> Dear Martyn,
>
>
> On Fr, Jan 15, 2016 at 4:01 , Martyn Plummer <plummerm at iarc.fr> wrote:
>>
>>
>> Alternatively, you may be able to control the maximum number of threads
>> by setting and exporting an appropriate environment variable depending
>> on what backend you are using, e.g. OPENBLAS_NUM_THREADS or
>> MKL_NUM_THREADS.
>
>
>
> Thanks a lot. Running
>
> export OPENBLAS_NUM_THREADS = 1
>
> in the bash before starting R solves both problems!

I don't have builds so I can try myself, but as an alternative, is it
possible to set this environment variable in ~/.Renviron, or is that
too late in the R startup process?  What about
Sys.setenv(OPENBLAS_NUM_THREADS=1) in ~/.Rprofile?

/Henrik

>
>
>
> Cheers,
> Daniel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From thomas.fuller at coherentlogic.com  Fri Jan 15 22:30:55 2016
From: thomas.fuller at coherentlogic.com (Thomas Fuller)
Date: Fri, 15 Jan 2016 16:30:55 -0500
Subject: [Rd] JDataFrame API
In-Reply-To: <40BFB1D4-B5FB-42CC-B7F7-EC68821A109F@r-project.org>
References: <CAM0JZ3=Xj=c2-VyHO3-8uVjyAgaMoMKr1udnbo4xdvyNEHm55w@mail.gmail.com>
	<EBCED75E-568C-47DA-9031-E894AACB66C4@r-project.org>
	<CAM0JZ3nukiLcAxNQ=duOHmy60P2nUN_HA4O_8VRA5vXS+XuoKQ@mail.gmail.com>
	<40BFB1D4-B5FB-42CC-B7F7-EC68821A109F@r-project.org>
Message-ID: <CAM0JZ3kxy8Na1265-HcTFkkg7SpFyvQnAGmaAYcGfkKYrnk9tw@mail.gmail.com>

Hi Simon,

Aha! I re-read your message and noticed this line:

lapply(J("A")$direct(), .jevalArray)

which I had overlooked earlier. I wrote an example that is very
similar to yours and see what you mean now regarding how we can do
this directly.

Many thanks,

T

groovyScript <- paste (
    "def stringList = [] as java.util.List",
    "def numberList = [] as java.util.List",
    "for (def ctr in 0..99) { stringList << new String(\"TGIF $ctr\");
numberList << ctr; }",
    "def strings = stringList.toArray()",
    "def numbers = numberList.toArray()",
    "def result = [strings, numbers]",
    "return (Object[]) result",
    sep="\n")

result <- Evaluate (groovyScript=groovyScript)

temp <- lapply(result, .jevalArray)

On Fri, Jan 15, 2016 at 1:58 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
>> On Jan 15, 2016, at 12:35 PM, Thomas Fuller <thomas.fuller at coherentlogic.com> wrote:
>>
>> Hi Simon,
>>
>> Thanks for your feedback. -- this is an observation that I wasn't
>> considering when I wrote this mainly because I am, in fact, working
>> with rather small data sets. BTW: There is code there, it's under the
>> bitbucket link -- here's the direct link if you'd still like to look
>> at it:
>>
>> https://bitbucket.org/CoherentLogic/jdataframe
>>
>
> Ah, sorry, all links just send you back to the page, so I missed the little filed that tells you how to check it out.
>
>
>> Re "for practical purposes is doesn't seem like the most efficient
>> solution" and "So the JSON route is very roughly ~13x slower than
>> using Java directly."
>>
>> I've not benchmarked this and will take a closer look at what you have
>> today -- in fact I may include these details on the JDataFrame page.
>> The JDataFrame targets the use case where there's significant
>> development being done in Java and data is exported into R and,
>> additionally, the developer intends to keep the two separated as much
>> as possible. I could work with Java directly, but then I potentially
>> end up with quite a bit of Java code taking up space in R and I don't
>> like this because if I need to refactor something I have to do it in
>> two places.
>>
>
> No, the code is the same - it makes no difference. The R code is only one call to fetch what you need by calling your Java method. The nice thing is that you in fact save some code since there is no reason to serialize since you can simply access all Java objects directly without serialization.
>
>
>> There's another use case for the JDataFrame as well and that's in an
>> enterprise application (you may have alluded to this when you said
>> "[i]f you need process separation..."). Consider a business where
>> users are working with R and the application that produces the data is
>> actually running in Tomcat. Shipping large amounts of data over the
>> wire in this example would be a performance destroyer, but for small
>> data sets it certainly would be helpful from a development perspective
>> to expose JSON-based web services where the R script would be able to
>> convert a result into a data frame gracefully.
>>
>
> Yes, sure, that makes sense. Like I said, I would probably use some native format in that case if I worried about performance. Some candidates that come to my mind are ProtoBuf and QAP (serialization used by Rserve). If you have arrays, you can always serialize them directly which may be most efficient, but you'd probably have to write the wrapper for that yourself (annoyingly, the default Java methods use big-endian format which is slower on most machines). But then, you're right that for Tomcat applications the sizes are small enough that using JSON has the benefit that you can inspect payload by eye and/or other tools very easily.
>
> Cheers,
> Simon
>
>
>>
>> On Fri, Jan 15, 2016 at 10:58 AM, Simon Urbanek
>> <simon.urbanek at r-project.org> wrote:
>>> Tom,
>>>
>>> this may be good for embedding small data sets, but for practical purposes is doesn't seem like the most efficient solution.
>>>
>>> Since you didn't provide any code, I built a test case using the build-in Java JSON API to build a medium-sized dataset (1e6 rows) and read it in just to get a ballpark (see
>>> https://gist.github.com/s-u/4efb284e3c15c6a2db16
>>>
>>> # generate:
>>> time java -cp .:javax.json-api-1.0.jar:javax.json-1.0.4.jar A > 1e6
>>>
>>> real    0m2.764s
>>> user    0m20.356s
>>> sys     0m0.962s
>>>
>>> # read:
>>>> system.time(temp <- RJSONIO::fromJSON("1e6"))
>>>   user  system elapsed
>>>  3.484   0.279   3.834
>>>> str(temp)
>>> List of 2
>>> $ V1: num [1:1000000] 0 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 ...
>>> $ V2: chr [1:1000000] "X0" "X1" "X2" "X3" ...
>>>
>>> For comparison using Java directly (includes both generation and reading into R):
>>>
>>>> system.time(temp <- lapply(J("A")$direct(), .jevalArray))
>>>   user  system elapsed
>>>  0.962   0.186   0.494
>>>
>>> So the JSON route is very roughly ~13x slower than using Java directly. Obviously, this will vary by data set type etc. since there is R overhead involved as well: for example, if you have only numeric variables, the JSON route is 30x slower on reading alone [50x total]. String variables slow down everyone equally. Interestingly, the JSON encoding is using all 16 cores, so the 2.7s real time add up to over 20s CPU time so on smaller machines you may see more overhead.
>>>
>>> If you need process separation, it may be a different story - in principle it is faster to use more native serialization than JSON since parsing is the slowest part for big datasets.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>> On Jan 14, 2016, at 4:52 PM, Thomas Fuller <thomas.fuller at coherentlogic.com> wrote:
>>>>
>>>> Hi Folks,
>>>>
>>>> If you need to send data from Java to R you may consider using the
>>>> JDataFrame API -- which is used to convert data into JSON which then
>>>> can be converted into a data frame in R.
>>>>
>>>> Here's the project page:
>>>>
>>>> https://coherentlogic.com/middleware-development/jdataframe/
>>>>
>>>> and here's a partial example which demonstrates what the API looks like:
>>>>
>>>> String result = new JDataFrameBuilder()
>>>>   .addColumn("Code", new Object[] {"WV", "VA", })
>>>>   .addColumn("Description", new Object[] {"West Virginia", "Virginia"})
>>>>   .toJson();
>>>>
>>>> and in R script we would need to do this:
>>>>
>>>> temp <- RJSONIO::fromJSON(json)
>>>> tempDF <- as.data.frame(temp)
>>>>
>>>> which yields a data frame that looks like this:
>>>>
>>>>> tempDF
>>>>   Description Code
>>>> 1 West Virginia   WV
>>>> 2      Virginia   VA
>>>>
>>>> It is my intention to deploy this project to Maven Central this week,
>>>> time permitting.
>>>>
>>>> Questions and comments are welcomed.
>>>>
>>>> Tom
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>
>


From maechler at stat.math.ethz.ch  Sat Jan 16 20:45:21 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 16 Jan 2016 20:45:21 +0100
Subject: [Rd] as.data.frame and illegal row.names argument (bug
	in	package:DoE.wrapper?)
In-Reply-To: <CAF8bMcaQvSHxDbEkLexMOLRFWCPXa1DSvykE+9xeWnRudouknQ@mail.gmail.com>
References: <CAF8bMcaQvSHxDbEkLexMOLRFWCPXa1DSvykE+9xeWnRudouknQ@mail.gmail.com>
Message-ID: <22170.40401.915015.31175@stat.math.ethz.ch>

>>>>> William Dunlap via R-devel <r-devel at r-project.org>
>>>>>     on Wed, 13 Jan 2016 13:46:05 -0800 writes:

> as.data.frame methods behave inconsistently when they are given a row.name
> argument of the wrong length.  The matrix method silently ignores row.names
> if it has the wrong length and the numeric, integer, and character methods
> do not bother to check and thus make an illegal data.frame.
> 
> > as.data.frame(matrix(1:6,nrow=3), row.names=c("One","Two"))
>   V1 V2
> 1  1  4
> 2  2  5
> 3  3  6
> > as.data.frame(1:3, row.names=c("One","Two"))
>     1:3
> One   1
> Two   2
> Warning message:
> In format.data.frame(x, digits = digits, na.encode = FALSE) :
>   corrupt data frame: columns will be truncated or padded with NAs
> > as.data.frame(c("a","b","c"), row.names=c("One","Two"))
>     c("a", "b", "c")
> One                a
> Two                b
> Warning message:
> In format.data.frame(x, digits = digits, na.encode = FALSE) :
>   corrupt data frame: columns will be truncated or padded with NAs

as I said yesterday, I want to "fix" this in R.
As Paul Grosu mentioned, the bugous -- too tolerant -- behavior
is in the as.data.frame.vector() method,  and the
as.data.frame.matrix() simply drops wrong row.names and use
default row names in that case.

This would leave (at least) two ways to change:
1) the *.matrix compatible one simply forgets wrong  'row.names'
2) Wrong row.names are a user error.

Now, '1)' would be more in line with the matrix method, but
really feels wrong, because it does not catch user error and
silently disregards a specifically specified argument.

For '2)' I propose a fix which will only *warn* about the wrong
'row.names' for now (so code continues to work which has
implicitly relied on the wrong behavior, but with a warning:

    > as.data.frame(1:3, row.names=c("One","Two"))
      1:3
    1   1
    2   2
    3   3
    Warning message:
    In as.data.frame.integer(1:3, row.names = c("One", "Two")) :
      'row.names' is not a character vector of length 3 -- omitting it. Will be an error!
    > 

This will give new warnings in packages, and package authors can
fix these.... before the above will eventually become an error.


The remaining question is if the  as.data.frame.matrix() method
should not also produce the same warning about illegal
row.names.  Interestingly, the *model.matrix* method does
produce an error even now, when row.names are specified of wrong
length:

   > ff <- log(Volume) ~ log(Height) + log(Girth)
   > m <- model.frame(ff, trees)
   > mat <- model.matrix(ff, m)
   > data.frame(mat, row.names = paste0("r", 1:30))
   Error in data.frame(mat, row.names = paste0("r", 1:30)) : 
     row names supplied are of the wrong length
   >


From pgrosu at gmail.com  Mon Jan 18 01:36:56 2016
From: pgrosu at gmail.com (Paul Grosu)
Date: Sun, 17 Jan 2016 19:36:56 -0500
Subject: [Rd] as.data.frame and illegal row.names argument (bug in
	package:DoE.wrapper?)
In-Reply-To: <22168.42575.283450.893916@stat.math.ethz.ch>
References: <CAF8bMcaQvSHxDbEkLexMOLRFWCPXa1DSvykE+9xeWnRudouknQ@mail.gmail.com>	<074701d14f1b$eb665ac0$c2331040$@gmail.com>
	<22168.42575.283450.893916@stat.math.ethz.ch>
Message-ID: <00f201d15188$5638cc20$02aa6460$@gmail.com>

Hi Martin,

Sorry about the confusion.  Yes, my eyes were playing tricks on me during
the copy-&-paste process :)  Thank you for helping so quickly with this.  I
am not part of the R core group to make changes to R, but I've studied the R
source code - and that of quite a few BioConductor packages - for many
years.  So I was just posting to help with why it was happening to focus the
root-cause for a fix, and how to find a possible work-around for it.

Thank you,
Paul

-----Original Message-----
From: Martin Maechler [mailto:maechler at stat.math.ethz.ch] 
Sent: Friday, January 15, 2016 2:57 AM
To: Paul Grosu
Cc: r-devel at r-project.org
Subject: Re: [Rd] as.data.frame and illegal row.names argument (bug in
package:DoE.wrapper?)

>>>>> Paul Grosu <pgrosu at gmail.com>
>>>>>     on Thu, 14 Jan 2016 17:35:49 -0500 writes:

 > Hi Bill,

 > The thing is that is happening here is the specific  > instance of
as.data.frame that is being run, which in this  > instance switch between
as.data.frame.matrix() and as.data.frame.matrix().  

(This must be another typo i.e. "cut/n/paste forgot to modify" lapsus;  you
probably meant *.vector in the 2nd case).

I'm pretty sure Bill was not asking *why* this happens {he would easily find
out if he wanted} but reporting two (potential) bugs:

- one in R  [not reporting erronous as.data.frame() usage]
- one in DoE.wrapper

I'm going to look into the  R one, which is indeed in the
as.data.frame.vector() method, as you've noted.

--
Martin Maechler
ETH Zurich


From mons.magnusson at gmail.com  Mon Jan 18 09:45:52 2016
From: mons.magnusson at gmail.com (=?UTF-8?Q?M=C3=A5ns_Magnusson?=)
Date: Mon, 18 Jan 2016 09:45:52 +0100
Subject: [Rd] r-devel @ Travis
Message-ID: <CAFQDYB0JbN+K8OV4WnDioN_2RBnpbrks7fUktg7nqrh+iP8eJg@mail.gmail.com>

Hi!

I'm developing R packages and use Travis CI for continous integration. When
submitting to CRAN Im suggestet to test the package using the latest
R-devel. I would like that all test where run using Travis. Is there anyone
who knows if this is possible to run travis test using the latest r-devel?

-- 
Regards

M?ns

============================
M?ns Magnusson
070 - 588 97 15
mons.magnusson at gmail.com
============================

	[[alternative HTML version deleted]]


From retep.meissner at gmail.com  Mon Jan 18 10:00:12 2016
From: retep.meissner at gmail.com (Peter Meissner)
Date: Mon, 18 Jan 2016 10:00:12 +0100
Subject: [Rd] r-devel @ Travis
In-Reply-To: <CAFQDYB0JbN+K8OV4WnDioN_2RBnpbrks7fUktg7nqrh+iP8eJg@mail.gmail.com>
References: <CAFQDYB0JbN+K8OV4WnDioN_2RBnpbrks7fUktg7nqrh+iP8eJg@mail.gmail.com>
Message-ID: <op.ybffarjg3euttn@zukd208>

Hey,

Metacran's rbuilder is the place to get started:  
https://github.com/metacran/r-builder

You should be good to go by placing this in your Github repo (branch):  
https://github.com/metacran/r-builder/blob/master/.travis.yml

.. than tell Travis to whatch you repo.


Best, Peter




Am .01.2016, 09:45 Uhr, schrieb M?ns Magnusson <mons.magnusson at gmail.com>:

> Hi!
>
> I'm developing R packages and use Travis CI for continous integration.  
> When
> submitting to CRAN Im suggestet to test the package using the latest
> R-devel. I would like that all test where run using Travis. Is there  
> anyone
> who knows if this is possible to run travis test using the latest  
> r-devel?
>


-- 
Erstellt mit Operas E-Mail-Modul: http://www.opera.com/mail/


From csardi.gabor at gmail.com  Mon Jan 18 10:05:50 2016
From: csardi.gabor at gmail.com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Mon, 18 Jan 2016 09:05:50 +0000
Subject: [Rd] r-devel @ Travis
In-Reply-To: <op.ybffarjg3euttn@zukd208>
References: <CAFQDYB0JbN+K8OV4WnDioN_2RBnpbrks7fUktg7nqrh+iP8eJg@mail.gmail.com>
	<op.ybffarjg3euttn@zukd208>
Message-ID: <CABtg=KkQEpA_gsMmYyNBbnzn66yA5wvxASUX=Dra5tVQRrcKrw@mail.gmail.com>

On Mon, Jan 18, 2016 at 9:00 AM, Peter Meissner
<retep.meissner at gmail.com> wrote:
> Hey,
>
> Metacran's rbuilder is the place to get started:
> https://github.com/metacran/r-builder
>
> You should be good to go by placing this in your Github repo (branch):
> https://github.com/metacran/r-builder/blob/master/.travis.yml

Actually this file is for checking r-builder itself, which is somewhat special.

For a regular R package I think it is better to start with this one:
https://raw.githubusercontent.com/metacran/r-builder/master/sample.travis.yml

Don't forget to rename it to .travis.yml

Gabor

[...]


From edd at debian.org  Mon Jan 18 15:17:41 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 18 Jan 2016 08:17:41 -0600
Subject: [Rd] r-devel @ Travis
In-Reply-To: <CAFQDYB0JbN+K8OV4WnDioN_2RBnpbrks7fUktg7nqrh+iP8eJg@mail.gmail.com>
References: <CAFQDYB0JbN+K8OV4WnDioN_2RBnpbrks7fUktg7nqrh+iP8eJg@mail.gmail.com>
Message-ID: <22172.62469.222094.598616@max.nulle.part>


On 18 January 2016 at 09:45, M?ns Magnusson wrote:
| I'm developing R packages and use Travis CI for continous integration. When
| submitting to CRAN Im suggestet to test the package using the latest
| R-devel. I would like that all test where run using Travis. Is there anyone
| who knows if this is possible to run travis test using the latest r-devel?

Literally "anything is possible" subject to the constraint of Travis hosting
on Ubuntu 12.04 (aka "Precise") with an opt-in to Ubuntu 14.04 (aka "Trusty").

So anything you can build there, or build yourself somewhere else in order to
run there -- and I have made the case that the Launchpad build system by
Canonical/Ubuntu is good -- will work.

12.04 / 14.04 are sometimes a little restrictive, but one can generally do
just fine.  Now, I (as the one rolling up the r-release .deb packages for R)
never created one for R-devel -- but Gabor filled that gap for purposes of
r-builder / r-hub.  That is your (current) best bet.

For what it is worth, I still prefer my R-devel tests to be local -- but use
in Travis is a perfectly fine approach.

Cheers, Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From mons.magnusson at gmail.com  Mon Jan 18 17:38:33 2016
From: mons.magnusson at gmail.com (=?UTF-8?Q?M=C3=A5ns_Magnusson?=)
Date: Mon, 18 Jan 2016 17:38:33 +0100
Subject: [Rd] r-devel @ Travis
In-Reply-To: <22172.62469.222094.598616@max.nulle.part>
References: <CAFQDYB0JbN+K8OV4WnDioN_2RBnpbrks7fUktg7nqrh+iP8eJg@mail.gmail.com>
	<22172.62469.222094.598616@max.nulle.part>
Message-ID: <CAFQDYB2i8_Q5EpBguzPyKyyv4+A4RynB7+mRa0t1twSxG5RKYQ@mail.gmail.com>

Thank you all for the comments and suggestions!

I got the link from Garbor to work, but that is the old r-travis approach
(using C). I tried the same approach with native R Travis build but
unfortunately it did not work. So I contacted Jim Hester and he told me
that they are now actively working with implementing multiple R versions in
the native R builds.

/M?ns

2016-01-18 15:17 GMT+01:00 Dirk Eddelbuettel <edd at debian.org>:

>
> On 18 January 2016 at 09:45, M?ns Magnusson wrote:
> | I'm developing R packages and use Travis CI for continous integration.
> When
> | submitting to CRAN Im suggestet to test the package using the latest
> | R-devel. I would like that all test where run using Travis. Is there
> anyone
> | who knows if this is possible to run travis test using the latest
> r-devel?
>
> Literally "anything is possible" subject to the constraint of Travis
> hosting
> on Ubuntu 12.04 (aka "Precise") with an opt-in to Ubuntu 14.04 (aka
> "Trusty").
>
> So anything you can build there, or build yourself somewhere else in order
> to
> run there -- and I have made the case that the Launchpad build system by
> Canonical/Ubuntu is good -- will work.
>
> 12.04 / 14.04 are sometimes a little restrictive, but one can generally do
> just fine.  Now, I (as the one rolling up the r-release .deb packages for
> R)
> never created one for R-devel -- but Gabor filled that gap for purposes of
> r-builder / r-hub.  That is your (current) best bet.
>
> For what it is worth, I still prefer my R-devel tests to be local -- but
> use
> in Travis is a perfectly fine approach.
>
> Cheers, Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>



-- 
Med v?nlig h?lsning

M?ns

============================
M?ns Magnusson
070 - 588 97 15
mons.magnusson at gmail.com
============================

	[[alternative HTML version deleted]]


From edd at debian.org  Mon Jan 18 17:57:00 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 18 Jan 2016 10:57:00 -0600
Subject: [Rd] r-devel @ Travis
In-Reply-To: <CAFQDYB2i8_Q5EpBguzPyKyyv4+A4RynB7+mRa0t1twSxG5RKYQ@mail.gmail.com>
References: <CAFQDYB0JbN+K8OV4WnDioN_2RBnpbrks7fUktg7nqrh+iP8eJg@mail.gmail.com>
	<22172.62469.222094.598616@max.nulle.part>
	<CAFQDYB2i8_Q5EpBguzPyKyyv4+A4RynB7+mRa0t1twSxG5RKYQ@mail.gmail.com>
Message-ID: <22173.6492.242850.559527@max.nulle.part>


On 18 January 2016 at 17:38, M?ns Magnusson wrote:
| I got the link from Garbor to work, but that is the old r-travis approach
| (using C).

I prefer that approach. It works _now_ and you get complete control. 

| I tried the same approach with native R Travis build but
| unfortunately it did not work. So I contacted Jim Hester and he told me that
| they are now actively working with implementing multiple R versions in the
| native R builds.

Ahh, the good old 'that will be fixed in the next version' trick. You'd
almost suspect Jim now works for a software company ;-)

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From h.wickham at gmail.com  Wed Jan 20 23:13:13 2016
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 20 Jan 2016 16:13:13 -0600
Subject: [Rd] Warn on partial matches in R CMD check
Message-ID: <CABdHhvEs4gX+MHFbeyF4jLnUyFM1hUMt0777d-UY524mpZ864Q@mail.gmail.com>

Hi all (but especially Kurt),

Would it be possible to have a flag to R CMD check that warned on
partial all matches, i.e. turning on:

options(
  warnPartialMatchDollar = TRUE,
  warnPartialMatchArgs = TRUE,
  warnPartialMatchAttr = TRUE
)

I think this is good practice for package code.

I don't think it can currently be made part of the default (because
sometimes the warnings come from other packages), but it would be
really convenient to have as a switch.

Hadley

-- 
http://had.co.nz/


From xie at yihui.name  Wed Jan 20 23:45:57 2016
From: xie at yihui.name (Yihui Xie)
Date: Wed, 20 Jan 2016 16:45:57 -0600
Subject: [Rd] Warn on partial matches in R CMD check
In-Reply-To: <CABdHhvEs4gX+MHFbeyF4jLnUyFM1hUMt0777d-UY524mpZ864Q@mail.gmail.com>
References: <CABdHhvEs4gX+MHFbeyF4jLnUyFM1hUMt0777d-UY524mpZ864Q@mail.gmail.com>
Message-ID: <CANROs4cE_HH512Tr6a7-=g_1KKWpsGMzbbS8dyP0qiFgj=Fuyw@mail.gmail.com>

+1 "What you write is **probably** what you get" sounds like a very
bad idea to me. The real solution to laziness should be
auto-completion instead of partial matching.

Regards,
Yihui


On Wed, Jan 20, 2016 at 4:13 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
> Hi all (but especially Kurt),
>
> Would it be possible to have a flag to R CMD check that warned on
> partial all matches, i.e. turning on:
>
> options(
>   warnPartialMatchDollar = TRUE,
>   warnPartialMatchArgs = TRUE,
>   warnPartialMatchAttr = TRUE
> )
>
> I think this is good practice for package code.
>
> I don't think it can currently be made part of the default (because
> sometimes the warnings come from other packages), but it would be
> really convenient to have as a switch.
>
> Hadley
>
> --
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jupiter.hce at gmail.com  Thu Jan 21 06:25:40 2016
From: jupiter.hce at gmail.com (jupiter)
Date: Thu, 21 Jan 2016 16:25:40 +1100
Subject: [Rd] Failed to install imager
Message-ID: <CAA=hcWQ7JNPwBNKCxYyn00nHtyZzs9a-hNBGZBdeWJ6NGU103Q@mail.gmail.com>

Hi,

I failed to run install.packages("imager")  in CentOS 6, the R version is
3.2.2

g++ -shared -L/usr/local/r/3.2.2/lib64/R/lib -L/usr/local/lib64 -o
imager.so RcppExports.o colourspace.o display.o drawing.o filtering.o
interpolation.o morphology.o transformations.o utils.o wrappers.o -lX11
-lfftw3 -L/usr/local/r/3.2.2/lib64/R/lib -lR
/usr/bin/ld: cannot find -lfftw3


I checked imager src/Makevars.win:
PKG_LIBS += -L$(LIB_FFTW)/lib -lgdi32 -lfftw3-3 $(RCPP_LDFLAGS)

And I've already added LIB_FFTW to my fftw library, what I am still missing?

Thank you.

Kind regards,

- jupiter

	[[alternative HTML version deleted]]


From Rainer at krugs.de  Thu Jan 21 09:26:13 2016
From: Rainer at krugs.de (Rainer M Krug)
Date: Thu, 21 Jan 2016 09:26:13 +0100
Subject: [Rd] Warn on partial matches in R CMD check
In-Reply-To: <CABdHhvEs4gX+MHFbeyF4jLnUyFM1hUMt0777d-UY524mpZ864Q@mail.gmail.com>
	(Hadley Wickham's message of "Wed, 20 Jan 2016 16:13:13 -0600")
References: <CABdHhvEs4gX+MHFbeyF4jLnUyFM1hUMt0777d-UY524mpZ864Q@mail.gmail.com>
Message-ID: <m2mvrzs5i2.fsf@krugs.de>

Hadley Wickham <h.wickham at gmail.com> writes:

> Hi all (but especially Kurt),
>
> Would it be possible to have a flag to R CMD check that warned on
> partial all matches, i.e. turning on:
>
> options(
>   warnPartialMatchDollar = TRUE,
>   warnPartialMatchArgs = TRUE,
>   warnPartialMatchAttr = TRUE
> )
>
> I think this is good practice for package code.

+1

I think that would be brilliant because I already spend a few days
chasing down an error because of an unintended partial match.

>
> I don't think it can currently be made part of the default (because
> sometimes the warnings come from other packages), but it would be
> really convenient to have as a switch.

and also possibly to enable this for normal running of code outside of packages.


Cheers,

Rainer

>
> Hadley

-- 
Rainer M. Krug
email: Rainer<at>krugs<dot>de
PGP: 0x0F52F982
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 454 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20160121/70c3d657/attachment.bin>

From edd at debian.org  Thu Jan 21 13:31:01 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 21 Jan 2016 06:31:01 -0600
Subject: [Rd] Failed to install imager
In-Reply-To: <CAA=hcWQ7JNPwBNKCxYyn00nHtyZzs9a-hNBGZBdeWJ6NGU103Q@mail.gmail.com>
References: <CAA=hcWQ7JNPwBNKCxYyn00nHtyZzs9a-hNBGZBdeWJ6NGU103Q@mail.gmail.com>
Message-ID: <22176.53125.818874.433936@max.nulle.part>


On 21 January 2016 at 16:25, jupiter wrote:
| I failed to run install.packages("imager")  in CentOS 6, the R version is
| 3.2.2
| 
| g++ -shared -L/usr/local/r/3.2.2/lib64/R/lib -L/usr/local/lib64 -o
| imager.so RcppExports.o colourspace.o display.o drawing.o filtering.o
| interpolation.o morphology.o transformations.o utils.o wrappers.o -lX11
| -lfftw3 -L/usr/local/r/3.2.2/lib64/R/lib -lR
| /usr/bin/ld: cannot find -lfftw3

That is your linker / your operating system telling you it does not have fftw3.
 
| I checked imager src/Makevars.win:
| PKG_LIBS += -L$(LIB_FFTW)/lib -lgdi32 -lfftw3-3 $(RCPP_LDFLAGS)

That only tells R to link against fftw3 _but does not install fftw3_.
 
| And I've already added LIB_FFTW to my fftw library, what I am still missing?

Presumably the yum installation of the fftw3 headers and library.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From tom.quarendon at teamwpc.co.uk  Thu Jan 21 18:38:14 2016
From: tom.quarendon at teamwpc.co.uk (Tom Quarendon)
Date: Thu, 21 Jan 2016 17:38:14 +0000
Subject: [Rd] Return options used to configure R
Message-ID: <955E076F-AEAE-4BE0-9E10-FEEB6151A710@teamwpc.co.uk>

Is there any way to print out the options that where passed to configure when R was built?
I want to build a later version to the one I have on my machine, and I want to build it in the same way, with the same configure options.

Thanks.


From csardi.gabor at gmail.com  Fri Jan 22 12:36:50 2016
From: csardi.gabor at gmail.com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Fri, 22 Jan 2016 11:36:50 +0000
Subject: [Rd] Return options used to configure R
In-Reply-To: <955E076F-AEAE-4BE0-9E10-FEEB6151A710@teamwpc.co.uk>
References: <955E076F-AEAE-4BE0-9E10-FEEB6151A710@teamwpc.co.uk>
Message-ID: <CABtg=KmCt8Z-7QD7dB0m+HUQ2T+YRp8wUEqaGOLGdg4MHrvjCg@mail.gmail.com>

A one liner that should work on most systems:

grep("configure", readLines(file.path(R.home(), "etc", "Makeconf")), value=TRUE)

Gabor

On Thu, Jan 21, 2016 at 5:38 PM, Tom Quarendon
<tom.quarendon at teamwpc.co.uk> wrote:
> Is there any way to print out the options that where passed to configure when R was built?
> I want to build a later version to the one I have on my machine, and I want to build it in the same way, with the same configure options.
>
> Thanks.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From tom.quarendon at teamwpc.co.uk  Fri Jan 22 12:40:35 2016
From: tom.quarendon at teamwpc.co.uk (Tom Quarendon)
Date: Fri, 22 Jan 2016 11:40:35 +0000
Subject: [Rd] Return options used to configure R
In-Reply-To: <CABtg=KmCt8Z-7QD7dB0m+HUQ2T+YRp8wUEqaGOLGdg4MHrvjCg@mail.gmail.com>
References: <955E076F-AEAE-4BE0-9E10-FEEB6151A710@teamwpc.co.uk>
	<CABtg=KmCt8Z-7QD7dB0m+HUQ2T+YRp8wUEqaGOLGdg4MHrvjCg@mail.gmail.com>
Message-ID: <AM2PR05MB0771B98096C007332D03FA09B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>

So in English what you are saying is that there's a file called Makeconf in the etc directory under the R_HOME that contains the information.
That certainly seems to be true for Linux. 
Thanks.

-----Original Message-----
From: G?bor Cs?rdi [mailto:csardi.gabor at gmail.com] 
Sent: 22 January 2016 11:37
To: Tom Quarendon <tom.quarendon at teamwpc.co.uk>
Cc: r-devel at r-project.org
Subject: Re: [Rd] Return options used to configure R

A one liner that should work on most systems:

grep("configure", readLines(file.path(R.home(), "etc", "Makeconf")), value=TRUE)

Gabor

On Thu, Jan 21, 2016 at 5:38 PM, Tom Quarendon <tom.quarendon at teamwpc.co.uk> wrote:
> Is there any way to print out the options that where passed to configure when R was built?
> I want to build a later version to the one I have on my machine, and I want to build it in the same way, with the same configure options.
>
> Thanks.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From csardi.gabor at gmail.com  Fri Jan 22 12:45:52 2016
From: csardi.gabor at gmail.com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Fri, 22 Jan 2016 11:45:52 +0000
Subject: [Rd] Return options used to configure R
In-Reply-To: <AM2PR05MB0771B98096C007332D03FA09B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
References: <955E076F-AEAE-4BE0-9E10-FEEB6151A710@teamwpc.co.uk>
	<CABtg=KmCt8Z-7QD7dB0m+HUQ2T+YRp8wUEqaGOLGdg4MHrvjCg@mail.gmail.com>
	<AM2PR05MB0771B98096C007332D03FA09B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
Message-ID: <CABtg=KkYd5vkVKd=ep=fALenkcZZFm-NGmhhHRSdF8ZUX8N=MQ@mail.gmail.com>

It is also true for OSX. Windows is somewhat different, take a look at
the files in R_HOME/etc.

Gabor

On Fri, Jan 22, 2016 at 11:40 AM, Tom Quarendon
<tom.quarendon at teamwpc.co.uk> wrote:
> So in English what you are saying is that there's a file called Makeconf in the etc directory under the R_HOME that contains the information.
> That certainly seems to be true for Linux.
> Thanks.
>
> -----Original Message-----
> From: G?bor Cs?rdi [mailto:csardi.gabor at gmail.com]
> Sent: 22 January 2016 11:37
> To: Tom Quarendon <tom.quarendon at teamwpc.co.uk>
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Return options used to configure R
>
> A one liner that should work on most systems:
>
> grep("configure", readLines(file.path(R.home(), "etc", "Makeconf")), value=TRUE)
>
> Gabor
>
> On Thu, Jan 21, 2016 at 5:38 PM, Tom Quarendon <tom.quarendon at teamwpc.co.uk> wrote:
>> Is there any way to print out the options that where passed to configure when R was built?
>> I want to build a later version to the one I have on my machine, and I want to build it in the same way, with the same configure options.
>>
>> Thanks.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From edd at debian.org  Fri Jan 22 13:07:14 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 22 Jan 2016 06:07:14 -0600
Subject: [Rd] Return options used to configure R
In-Reply-To: <AM2PR05MB0771B98096C007332D03FA09B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
References: <955E076F-AEAE-4BE0-9E10-FEEB6151A710@teamwpc.co.uk>
	<CABtg=KmCt8Z-7QD7dB0m+HUQ2T+YRp8wUEqaGOLGdg4MHrvjCg@mail.gmail.com>
	<AM2PR05MB0771B98096C007332D03FA09B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
Message-ID: <22178.7026.148605.737263@max.nulle.part>


On 22 January 2016 at 11:40, Tom Quarendon wrote:
| So in English what you are saying is that there's a file called Makeconf in the etc directory under the R_HOME that contains the information.
| That certainly seems to be true for Linux. 

And Debian / Ubuntu have a convenience softlink to make this /etc/R/

Also note that 'R CMD config varname' extracts each of these values from the
command-line, rather than R.  And all of this is in the fine manuals you are
cordially invited to peruse at your lesiure ...

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From tom.quarendon at teamwpc.co.uk  Fri Jan 22 14:07:53 2016
From: tom.quarendon at teamwpc.co.uk (Tom Quarendon)
Date: Fri, 22 Jan 2016 13:07:53 +0000
Subject: [Rd] Return options used to configure R
In-Reply-To: <22178.7026.148605.737263@max.nulle.part>
References: <955E076F-AEAE-4BE0-9E10-FEEB6151A710@teamwpc.co.uk>
	<CABtg=KmCt8Z-7QD7dB0m+HUQ2T+YRp8wUEqaGOLGdg4MHrvjCg@mail.gmail.com>
	<AM2PR05MB0771B98096C007332D03FA09B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
	<22178.7026.148605.737263@max.nulle.part>
Message-ID: <AM2PR05MB077161748C5E015304292465B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>

I did have a search, but searching for "configure" just brought up loads of results for how to configure R.
I'm sure it is in the manual, once you know where to look for it and if you know all the manuals inside out.

Looking at the help for R CMD config, it's not actually clear that these relate to the options specified on configure, and it doesn't tell you things like --enable-R-shlib, or --prefix etc. 

Anyway, thanks for the info. The Makeconf file is what I want. At least on Linux, doesn't appear to exist on our OSX installation, but we probably installed that from a pre-built package. Ditto Windows.

-----Original Message-----
From: Dirk Eddelbuettel [mailto:edd at debian.org] 
Sent: 22 January 2016 12:07
To: Tom Quarendon <tom.quarendon at teamwpc.co.uk>
Cc: G?bor Cs?rdi <csardi.gabor at gmail.com>; r-devel at r-project.org
Subject: Re: [Rd] Return options used to configure R


On 22 January 2016 at 11:40, Tom Quarendon wrote:
| So in English what you are saying is that there's a file called Makeconf in the etc directory under the R_HOME that contains the information.
| That certainly seems to be true for Linux. 

And Debian / Ubuntu have a convenience softlink to make this /etc/R/

Also note that 'R CMD config varname' extracts each of these values from the command-line, rather than R.  And all of this is in the fine manuals you are cordially invited to peruse at your lesiure ...

Dirk

--
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From csardi.gabor at gmail.com  Fri Jan 22 14:14:51 2016
From: csardi.gabor at gmail.com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Fri, 22 Jan 2016 13:14:51 +0000
Subject: [Rd] Return options used to configure R
In-Reply-To: <AM2PR05MB077161748C5E015304292465B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
References: <955E076F-AEAE-4BE0-9E10-FEEB6151A710@teamwpc.co.uk>
	<CABtg=KmCt8Z-7QD7dB0m+HUQ2T+YRp8wUEqaGOLGdg4MHrvjCg@mail.gmail.com>
	<AM2PR05MB0771B98096C007332D03FA09B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
	<22178.7026.148605.737263@max.nulle.part>
	<AM2PR05MB077161748C5E015304292465B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
Message-ID: <CABtg=Kkq819v58EAnR6SSUdkY_EatpNeoF9GKk1XBYGEGrV40Q@mail.gmail.com>

On Fri, Jan 22, 2016 at 1:07 PM, Tom Quarendon
<tom.quarendon at teamwpc.co.uk> wrote:
[...]
> Anyway, thanks for the info. The Makeconf file is what I want. At least on Linux, doesn't appear to exist on our OSX installation, but we probably installed that from a pre-built package. Ditto Windows.

Strange, it is there for me on OSX, and I am also using a stock DMG.
For windows the directory structure is (typically?) different because
it has two sub-architectures, but there is some configuration info
there AFAIR.

Gabor

> -----Original Message-----
> From: Dirk Eddelbuettel [mailto:edd at debian.org]
> Sent: 22 January 2016 12:07
> To: Tom Quarendon <tom.quarendon at teamwpc.co.uk>
> Cc: G?bor Cs?rdi <csardi.gabor at gmail.com>; r-devel at r-project.org
> Subject: Re: [Rd] Return options used to configure R
>
>
> On 22 January 2016 at 11:40, Tom Quarendon wrote:
> | So in English what you are saying is that there's a file called Makeconf in the etc directory under the R_HOME that contains the information.
> | That certainly seems to be true for Linux.
>
> And Debian / Ubuntu have a convenience softlink to make this /etc/R/
>
> Also note that 'R CMD config varname' extracts each of these values from the command-line, rather than R.  And all of this is in the fine manuals you are cordially invited to peruse at your lesiure ...
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From bhh at xs4all.nl  Fri Jan 22 14:50:40 2016
From: bhh at xs4all.nl (Berend Hasselman)
Date: Fri, 22 Jan 2016 14:50:40 +0100
Subject: [Rd] Return options used to configure R
In-Reply-To: <AM2PR05MB077161748C5E015304292465B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
References: <955E076F-AEAE-4BE0-9E10-FEEB6151A710@teamwpc.co.uk>
	<CABtg=KmCt8Z-7QD7dB0m+HUQ2T+YRp8wUEqaGOLGdg4MHrvjCg@mail.gmail.com>
	<AM2PR05MB0771B98096C007332D03FA09B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
	<22178.7026.148605.737263@max.nulle.part>
	<AM2PR05MB077161748C5E015304292465B0C40@AM2PR05MB0771.eurprd05.prod.outlook.com>
Message-ID: <9FCABDD2-80A2-45DD-A116-473A2465DDD5@xs4all.nl>


> On 22 Jan 2016, at 14:07, Tom Quarendon <tom.quarendon at teamwpc.co.uk> wrote:
> 
> I did have a search, but searching for "configure" just brought up loads of results for how to configure R.
> I'm sure it is in the manual, once you know where to look for it and if you know all the manuals inside out.
> 
> Looking at the help for R CMD config, it's not actually clear that these relate to the options specified on configure, and it doesn't tell you things like --enable-R-shlib, or --prefix etc. 
> 
> Anyway, thanks for the info. The Makeconf file is what I want. At least on Linux, doesn't appear to exist on our OSX installation, but we probably installed that from a pre-built package. Ditto Windows.
> 

I use the CRAN provided R of OS X.
Makeconf is here:  /Library/Frameworks/R.framework/Versions/3.2/Resources/etc/Makeconf

Berend


From spencer.graves at prodsyse.com  Sun Jan 24 03:27:35 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sat, 23 Jan 2016 20:27:35 -0600
Subject: [Rd] URL for a vignette on CRAN?
Message-ID: <56A43697.4070408@prodsyse.com>

       How can I get a full URL for anything on CRAN?


       Using Safari, Google Chrome, and Firefox under OS X 10.11.2, I 
select a CRAN mirror from "www.r-project.org" and get a URL like 
"https://cran.rstudio.com/".  Then I select "packages" and get a 
different web page, but the URL displayed doesn't change.  I'd like to 
access the full URL of a vignette in a package, but modern web browsers 
hide that detail.


       Thanks,
       Spencer Graves


From pgrosu at gmail.com  Sun Jan 24 03:53:09 2016
From: pgrosu at gmail.com (Paul Grosu)
Date: Sat, 23 Jan 2016 21:53:09 -0500
Subject: [Rd] URL for a vignette on CRAN?
In-Reply-To: <56A43697.4070408@prodsyse.com>
References: <56A43697.4070408@prodsyse.com>
Message-ID: <12e301d15652$5dd7b620$19872260$@gmail.com>

Hi Spencer,

The reason is because the R website is doing frame forwarding rather than
URL forwarding.  You'll need to right-click on the Packages and open it into
a new window for the address bar to reflect the change.  In any case the
following link will change accordingly:

https://cran.rstudio.com/web/packages/

If you really want to know what is happening then below is the difference:

For frame forwarding it will look like this:

<FRAME src="navbar.html" name="contents" frameborder=0>

While for URL forwarding it will look like this:

<a href="web/packages/" target="banner">Packages</a><br>

Hope it helps,
~p

-----Original Message-----
From: R-devel [mailto:r-devel-bounces at r-project.org] On Behalf Of Spencer
Graves
Sent: Saturday, January 23, 2016 9:28 PM
To: r-devel at r-project.org
Subject: [Rd] URL for a vignette on CRAN?

       How can I get a full URL for anything on CRAN?


       Using Safari, Google Chrome, and Firefox under OS X 10.11.2, I select
a CRAN mirror from "www.r-project.org" and get a URL like
"https://cran.rstudio.com/".  Then I select "packages" and get a different
web page, but the URL displayed doesn't change.  I'd like to access the full
URL of a vignette in a package, but modern web browsers hide that detail.


       Thanks,
       Spencer Graves

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From edd at debian.org  Sun Jan 24 03:58:33 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 23 Jan 2016 20:58:33 -0600
Subject: [Rd] URL for a vignette on CRAN?
In-Reply-To: <56A43697.4070408@prodsyse.com>
References: <56A43697.4070408@prodsyse.com>
Message-ID: <22180.15833.65105.538323@max.nulle.part>


Spencer,

On 23 January 2016 at 20:27, Spencer Graves wrote:
|        How can I get a full URL for anything on CRAN?
|
|        Using Safari, Google Chrome, and Firefox under OS X 10.11.2, I 
| select a CRAN mirror from "www.r-project.org" and get a URL like 
| "https://cran.rstudio.com/".  Then I select "packages" and get a 
| different web page, but the URL displayed doesn't change.  I'd like to 
| access the full URL of a vignette in a package, but modern web browsers 
| hide that detail.

1)  All CRAN mirrors use the same layout.

2)  Using a CDN such as cran.rstudio.com, or now the equivalent
    cloud.r-project.org is 'A Good Thing (TM)' because the resulting location
    will almost always be close to any reader -- as it adapts based on the
    reader location. See Wikipedia on 'Content Deliver Networks' for more details.

3)  http://cloud.r-project.org/package=sos is preferred for any pkg, here
    your sos package

4)  It flattens to https://cloud.r-project.org/web/packages/sos/index.html

5)  You can derive the vignette from that page or just construct it:
        https://cloud.r-project.org/web/packages/sos/vignettes/sos.pdf
    This is of the form ${SERVER}/web/packages/${PACKAGE}/${VIGNETTE}

I have been using url such as the one in 5) for a long while. Works like a charm.

Now, from your vague text above, maybe you prefer NOT to use a CDN. In that
case, insert an _explicit_ server, say Berkeley's mirror and you get
       https://cran.cnr.berkeley.edu/web/packages/sos/vignettes/sos.pdf
but that is _still_ of the form ${SERVER}/web/packages/${PACKAGE}/${VIGNETTE}
yet simple uses a different value for ${SERVER}.

Makes sense?

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From spencer.graves at prodsyse.com  Sun Jan 24 09:05:01 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sun, 24 Jan 2016 02:05:01 -0600
Subject: [Rd] URL for a vignette on CRAN?
In-Reply-To: <22180.15833.65105.538323@max.nulle.part>
References: <56A43697.4070408@prodsyse.com>
	<22180.15833.65105.538323@max.nulle.part>
Message-ID: <56A485AD.7090809@prodsyse.com>

Thanks to both Paul Grosu and Dirk Eddelbuettel for informative and 
useful replies.  Spencer


On 1/23/2016 8:58 PM, Dirk Eddelbuettel wrote:
> Spencer,
>
> On 23 January 2016 at 20:27, Spencer Graves wrote:
> |        How can I get a full URL for anything on CRAN?
> |
> |        Using Safari, Google Chrome, and Firefox under OS X 10.11.2, I
> | select a CRAN mirror from "www.r-project.org" and get a URL like
> | "https://cran.rstudio.com/".  Then I select "packages" and get a
> | different web page, but the URL displayed doesn't change.  I'd like to
> | access the full URL of a vignette in a package, but modern web browsers
> | hide that detail.
>
> 1)  All CRAN mirrors use the same layout.
>
> 2)  Using a CDN such as cran.rstudio.com, or now the equivalent
>      cloud.r-project.org is 'A Good Thing (TM)' because the resulting location
>      will almost always be close to any reader -- as it adapts based on the
>      reader location. See Wikipedia on 'Content Deliver Networks' for more details.
>
> 3)  http://cloud.r-project.org/package=sos is preferred for any pkg, here
>      your sos package
>
> 4)  It flattens to https://cloud.r-project.org/web/packages/sos/index.html
>
> 5)  You can derive the vignette from that page or just construct it:
>          https://cloud.r-project.org/web/packages/sos/vignettes/sos.pdf
>      This is of the form ${SERVER}/web/packages/${PACKAGE}/${VIGNETTE}
>
> I have been using url such as the one in 5) for a long while. Works like a charm.
>
> Now, from your vague text above, maybe you prefer NOT to use a CDN. In that
> case, insert an _explicit_ server, say Berkeley's mirror and you get
>         https://cran.cnr.berkeley.edu/web/packages/sos/vignettes/sos.pdf
> but that is _still_ of the form ${SERVER}/web/packages/${PACKAGE}/${VIGNETTE}
> yet simple uses a different value for ${SERVER}.
>
> Makes sense?
>
> Dirk
>


From michaelchirico4 at gmail.com  Wed Jan 27 04:12:21 2016
From: michaelchirico4 at gmail.com (Michael Chirico)
Date: Tue, 26 Jan 2016 22:12:21 -0500
Subject: [Rd] Suggestions for improvement as regards `as` methods,
 and a call for consistency in `as.Date` methods
Message-ID: <CAPRVBcxf2=CzSbXAzxaeGcxznh+39s4VvgZu2FYSCpn4GzwpTA@mail.gmail.com>

Good evening all,

This topic is gone into at a bit more length at my related Stack Overflow
question here:

http://stackoverflow.com/questions/34647674/why-do-as-methods-remove-vector-names-and-is-there-a-way-around-it

There are two lingering issues despite the abundant insight received at SO,
namely:

1) _Why_ do as methods remove their arguments' names attribute?

This is a fact which is mentioned briefly in a select few of the related
help files, namely ?as.vector ("removes *all* attributes including names
for results of atomic mode"), ?as.double ("strips attributes including
names.") and ?as.character ("strips attributes including names"); however,
it appears (1) neither of these references gives a satisfactory explanation
of the reasoning behind this (I can only think of speed) and (2) it would
be much more digestible to users if this information (even copy-pasting the
same blurb) was placed in all of the as reference files (e.g., ?as,
?as.numeric, ?as.Date, ?as.POSIXct, etc.)

Personally, I think that unless there's a substantial efficiency cost to
doing so, the default should in fact be to retain names (if not other
attributes).

2) All as.Date methods should behave consistently as regards attribute
retention

As explicated in the referenced SO topic, the following should all give the
same result (as they would for similar examples involving other as
methods), but don't:

datesc <- c(ind = "2015-07-04", nyd = "2016-01-01")
datesn <- c(ind = 16620, nyd = 16801)
datesp <- structure(c(1435982400, 1451624400), .Names = c("ind", "nyd"),
                    class = c("POSIXct", "POSIXt"), tzone = "")
datesl <- structure(list(sec = c(0, 0), min = c(0L, 0L),
                         hour = c(0L, 0L), mday = c(4L, 1L),
                         mon = c(6L, 0L),
                         year = structure(115:116, .Names = c("ind",
"nyd")),
                         wday = c(6L, 5L), yday = c(184L, 0L),
                         isdst = c(1L, 0L), zone = c("EDT", "EST"),
                         gmtoff = c(NA_integer_, NA_integer_)),
                    .Names = c("sec", "min", "hour", "mday",
                               "mon", "year", "wday", "yday",
                               "isdst", "zone", "gmtoff"),
                    class = c("POSIXlt", "POSIXt"))

Retain names

as.Date.numeric(datesn)
#         ind          nyd
#"2015-07-04" "2016-01-01"
as.Date.POSIXct(datesp)
#         ind          nyd
#"2015-07-04" "2016-01-01"

Destroy names

as.Date.POSIXlt(datesl)
# [1] "2015-07-04" "2016-01-01"
as.Date.character(datesc)
# [1] "2015-07-04" "2016-01-01"


(unconfirmed, but I assume given a glance at the code that all of
as.Date.date, as.Date.dates, as.Date.ts, as.Date.yearmon, and
as.Date.yearqtr will also strip the names)

Regardless of the default behavior as regards keeping/destroying
names/other attributes, it would seem that for the sake of consistency the
above should be unified.

Barring an overhaul of all as methods to retain names, this would mean the
following changes (for example):

as.Date.numeric <- function (x, origin, ...)
{
    if (missing(origin))
        origin <- "1970-01-01"
    if (identical(origin, "0000-00-00"))
        origin <- as.Date("0000-01-01", ...) - 1
    setNames(as.Date(origin, ...) + x, NULL)
}

as.Date.POSIXct <- function (x, tz = "UTC", ...)
{
    if (tz == "UTC") {
        z <- floor(unclass(x)/86400)
        attr(z, "tzone") <- NULL
        attr(z, "names") <- NULL
        structure(z, class = "Date")
    }
    else as.Date(as.POSIXlt(x, tz = tz))
}

Thank you in advance for your consideration and thank you as always for
your time on this project.

Michael Chirico
PhD Candidate in Economics
University of Pennsylvania
3718 Locust Walk
Room 160 McNeil Building
Philadelphia, PA 19104
United States of America

	[[alternative HTML version deleted]]


From olegfink at gmail.com  Wed Jan 27 16:41:11 2016
From: olegfink at gmail.com (Oleg Finkelshteyn)
Date: Wed, 27 Jan 2016 15:41:11 +0000
Subject: [Rd] symbol name conflict in grDevices on linux
Message-ID: <CAJe5o3e2eebMKUKYC0Sg5DPoZR8BzUJaL2LJtiBkPkeSvFLyBw@mail.gmail.com>

It appears that grDevices (and perhaps other R libraries) is built
without passing C_VISIBILITY to PKG_CFLAGS (-fvisibility=hidden),
while other libraries (e.g. utils) do use the flag.

This results in potential crashes on linux in situations like using
embedded R in another application that happens to export a symbol
named similarly to one defined in R's library, since the runtime
linker substitutes the address of the wrong function into the
library's CallEntries.

Using -fvisibility=hidden or -Wl,-Bsymbolic[-functions] fixes this
since then the addresses of functions in CallEntries are fixed at
library build time, which is probably the intended behaviour.

Here is a small example, using grDevices::colors. I compile it with
  gcc -O2 r.c -I/usr/include/R -L/usr/lib/R/lib -lR -DBUG -rdynamic
(remove -DBUG to disable triggering the bug) and run it with
  R_HOME=/usr/lib/R ./a.out

without -DBUG colors() from grDevices is called as expected, however,
with -DBUG adding a colors() function definition in the hosting
binary, this version ends up being called which is most likely not the
intent. I suspect this might not manifest on Debian as it has a global
-Wl,-Bsymbolic-functions which likely gets passed on during the R
build process.

Is there any particular reason why grDevices isn't compiled with
-fvisibility=hidden like utils (which doesn't exhibit the described
problem), and shouldn't that flag and/or -Wl,-Bsymbolic also make its
way to R CMD's *LIB_*FLAGS to aid in getting correct builds of custom
R libraries too?

Thanks

--- r.c ---
#include<Rinternals.h>
#include<Rdefines.h>
#include<Rembedded.h>
#include<R_ext/Parse.h>
#ifdef BUG
void colors(){puts("all colours of the rainbow, but not the expected ones");}
#endif
int cmd(char*x){SEXP c,e;ParseStatus s;int o;
 PROTECT(c=allocVector(STRSXP,1));SET_STRING_ELT(c,0,mkChar(x))
 PROTECT(e=R_ParseVector(c,1,&s,R_NilValue));
 PROTECT(R_tryEval(VECTOR_ELT(e,0),R_GlobalEnv,&o));
 UNPROTECT(3);return s;}
int main(){Rf_initEmbeddedR(2,(char*[]){"R","--slave"});cmd("grDevices::colors()");return
0;}
---


From dstr7320 at uni.sydney.edu.au  Thu Jan 28 10:00:12 2016
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Thu, 28 Jan 2016 09:00:12 +0000
Subject: [Rd] More Capability for Capabilities
Message-ID: <SN1PR0101MB1439789802ED605A83570AF9CDC10@SN1PR0101MB1439.prod.exchangelabs.com>

Good day,

The capabilities function gives a logical result of which features R has been compiled with. Is there a more advanced variety of the function that will give the version number of the library, or its system path, rather than simply TRUE ?

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia


From edd at debian.org  Thu Jan 28 12:32:59 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 28 Jan 2016 05:32:59 -0600
Subject: [Rd] More Capability for Capabilities
In-Reply-To: <SN1PR0101MB1439789802ED605A83570AF9CDC10@SN1PR0101MB1439.prod.exchangelabs.com>
References: <SN1PR0101MB1439789802ED605A83570AF9CDC10@SN1PR0101MB1439.prod.exchangelabs.com>
Message-ID: <22185.64619.244907.435831@max.nulle.part>


On 28 January 2016 at 09:00, Dario Strbenac wrote:
| The capabilities function gives a logical result of which features R has been compiled with. Is there a more advanced variety of the function that will give the version number of the library, or its system path, rather than simply TRUE ?

Both can _change_ when dynamic linking is involved [1].  So I'd say that is a job
for your operating system.

Eg on mine and taking png:

  edd at max:~$ r -e 'print(capabilities()[["png"]])'
  [1] TRUE
  edd at max:~$ ldd /usr/lib/R/modules/R_X11.so | grep png
          libpng12.so.0 => /lib/x86_64-linux-gnu/libpng12.so.0 (0x00007f150324d000)
  edd at max:~$ dpkg -S /lib/x86_64-linux-gnu/libpng12.so.0
  libpng12-0:amd64: /lib/x86_64-linux-gnu/libpng12.so.0
  edd at max:~$ 

Dirk

[1] Presumably only minor numbers change while the ABI remains the same.

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From albapompeo at gmail.com  Thu Jan 28 12:54:40 2016
From: albapompeo at gmail.com (Alba Pompeo)
Date: Thu, 28 Jan 2016 09:54:40 -0200
Subject: [Rd] Abuse of a private glibc symbol in R 3.2.3
Message-ID: <CAJDAfTBZ5FNAsPuoRyk6CLEOPKG-JpY4OoQ3On-brcHS6UnafA@mail.gmail.com>

Hello, developers of R.

I have been unsuccessfully trying to build R on a musl libc system for
the last days.
./configure works, but make fails. The command that errors out is here
- http://pastebin.com/raw/UwFRsiqT

It was brought to my attention that this is a (very longstanding)
abuse of a private
glibc symbol in R.

In R 3.2.3, it seems that configure is trying to test for it on Linux.
It apparently fails to accurately test (as demonstrated by the link error),
perhaps because the test program does not actually *use* __libc_stack_end
so it gets optimized out. (See line 35500 or so in R-3.2.3/configure.)
Ideally, the test program would check that a pointer to __libc_stack_end
is non-null, but that's an autoconf bug.

A work around was to 'export r_cv_libc_stack_end=no' before configuring R.
However, there are a couple little issues with non-ASCII text and a
*lot* of math differences, many of which say "*no* convergence: NOTIFY
R-core!".

Until these are resolved, R can't be packaged for distributions that
use musl, such as Alpine Linux.

Thank you.


From pgrosu at gmail.com  Thu Jan 28 13:53:13 2016
From: pgrosu at gmail.com (Paul Grosu)
Date: Thu, 28 Jan 2016 07:53:13 -0500
Subject: [Rd]  More Capability for Capabilities
Message-ID: <CAMCdZYeRTOAOu0TbPOWEe61HZS_dQn+w8TCY0VyWcfn3apobCw@mail.gmail.com>

Hi Dario,

Here are another couple of other fun functions you can utilize besides the
ones Dirk recommended :)

extSoftVersion()
grSoftVersion()

Below is an example:

> grSoftVersion()
     cairo                   libpng                     jpeg
  "1.10.2"                 "1.6.16"                    "9.1"
                 libtiff
"LIBTIFF, Version 4.0.3"

> extSoftVersion()
      zlib                  bzlib             xz
   "1.2.8"   "1.0.6, 6-Sept-2010"        "5.0.8"
      PCRE                    ICU            TRE
"8.36 2014-09-26"          "53.1" "TRE 0.8.0 R_fixes (BSD)"
     iconv
"win_iconv"

Hope it helps,
~p

On Thu, Jan 28, 2016 at 6:32 AM, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 28 January 2016 at 09:00, Dario Strbenac wrote:
> | The capabilities function gives a logical result of which features R has
> been compiled with. Is there a more advanced variety of the function that
> will give the version number of the library, or its system path, rather
> than simply TRUE ?
>
> Both can _change_ when dynamic linking is involved [1].  So I'd say that
> is a job
> for your operating system.
>
> Eg on mine and taking png:
>
>   edd at max:~$ r -e 'print(capabilities()[["png"]])'
>   [1] TRUE
>   edd at max:~$ ldd /usr/lib/R/modules/R_X11.so | grep png
>           libpng12.so.0 => /lib/x86_64-linux-gnu/libpng12.so.0
> (0x00007f150324d000)
>   edd at max:~$ dpkg -S /lib/x86_64-linux-gnu/libpng12.so.0
>   libpng12-0:amd64: /lib/x86_64-linux-gnu/libpng12.so.0
>   edd at max:~$
>
> Dirk
>
> [1] Presumably only minor numbers change while the ABI remains the same.
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Thu Jan 28 14:01:24 2016
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 28 Jan 2016 14:01:24 +0100
Subject: [Rd] More Capability for Capabilities
In-Reply-To: <CAMCdZYeRTOAOu0TbPOWEe61HZS_dQn+w8TCY0VyWcfn3apobCw@mail.gmail.com>
References: <CAMCdZYeRTOAOu0TbPOWEe61HZS_dQn+w8TCY0VyWcfn3apobCw@mail.gmail.com>
Message-ID: <22186.4388.443324.464683@stat.math.ethz.ch>

>>>>> Paul Grosu <pgrosu at gmail.com>
>>>>>     on Thu, 28 Jan 2016 07:53:13 -0500 writes:

    > Hi Dario,
    > Here are another couple of other fun functions you can utilize besides the
    > ones Dirk recommended :)

    > extSoftVersion()
    > grSoftVersion()

    > Below is an example:

    >> grSoftVersion()
    > cairo                   libpng                     jpeg
    > "1.10.2"                 "1.6.16"                    "9.1"
    > libtiff
    > "LIBTIFF, Version 4.0.3"

    >> extSoftVersion()
    > zlib                  bzlib             xz
    > "1.2.8"   "1.0.6, 6-Sept-2010"        "5.0.8"
    > PCRE                    ICU            TRE
    > "8.36 2014-09-26"          "53.1" "TRE 0.8.0 R_fixes (BSD)"
    > iconv
    > "win_iconv"

    > Hope it helps,
    > ~p

Sure does, thank you.

What also helps is reading  RFM :

The thread started with 'capabilities' and
  ?capabilities

has a prominent link to  extSoftVersion
and that itself mentions  grSoftVersion ... (and few more such functions!). 

Martin 

    > On Thu, Jan 28, 2016 at 6:32 AM, Dirk Eddelbuettel <edd at debian.org> wrote:

    >> 
    >> On 28 January 2016 at 09:00, Dario Strbenac wrote:
    >> | The capabilities function gives a logical result of which features R has
    >> been compiled with. Is there a more advanced variety of the function that
    >> will give the version number of the library, or its system path, rather
    >> than simply TRUE ?
    >> 
    >> Both can _change_ when dynamic linking is involved [1].  So I'd say that
    >> is a job
    >> for your operating system.
    >> 
    >> Eg on mine and taking png:
    >> 
    >> edd at max:~$ r -e 'print(capabilities()[["png"]])'
    >> [1] TRUE
    >> edd at max:~$ ldd /usr/lib/R/modules/R_X11.so | grep png
    >> libpng12.so.0 => /lib/x86_64-linux-gnu/libpng12.so.0
    >> (0x00007f150324d000)
    >> edd at max:~$ dpkg -S /lib/x86_64-linux-gnu/libpng12.so.0
    >> libpng12-0:amd64: /lib/x86_64-linux-gnu/libpng12.so.0
    >> edd at max:~$
    >> 
    >> Dirk
    >> 
    >> [1] Presumably only minor numbers change while the ABI remains the same.
    >> 
    >> --
    >> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From albapompeo at gmail.com  Fri Jan 29 11:23:26 2016
From: albapompeo at gmail.com (Alba Pompeo)
Date: Fri, 29 Jan 2016 08:23:26 -0200
Subject: [Rd] Abuse of a private glibc symbol in R 3.2.3
In-Reply-To: <CAJDAfTBZ5FNAsPuoRyk6CLEOPKG-JpY4OoQ3On-brcHS6UnafA@mail.gmail.com>
References: <CAJDAfTBZ5FNAsPuoRyk6CLEOPKG-JpY4OoQ3On-brcHS6UnafA@mail.gmail.com>
Message-ID: <CAJDAfTAC1U92DXWvxkx7U9ORtJXtY+_e8i3MT85B3o6MsaEkKA@mail.gmail.com>

Here is my log from 'make check' using an Intel i5 64-bit processor -
http://pastebin.com/raw/N6SYAuFX
Here is Isaac's log from 'make check' using an Intel Atom 32-bit
processor - http://pastebin.com/raw/sey6DEk9

We are both on Alpine Linux, which uses the musl libc. http://www.musl-libc.org/

Thank you very much.



On Thu, Jan 28, 2016 at 9:54 AM, Alba Pompeo <albapompeo at gmail.com> wrote:
> Hello, developers of R.
>
> I have been unsuccessfully trying to build R on a musl libc system for
> the last days.
> ./configure works, but make fails. The command that errors out is here
> - http://pastebin.com/raw/UwFRsiqT
>
> It was brought to my attention that this is a (very longstanding)
> abuse of a private
> glibc symbol in R.
>
> In R 3.2.3, it seems that configure is trying to test for it on Linux.
> It apparently fails to accurately test (as demonstrated by the link error),
> perhaps because the test program does not actually *use* __libc_stack_end
> so it gets optimized out. (See line 35500 or so in R-3.2.3/configure.)
> Ideally, the test program would check that a pointer to __libc_stack_end
> is non-null, but that's an autoconf bug.
>
> A work around was to 'export r_cv_libc_stack_end=no' before configuring R.
> However, there are a couple little issues with non-ASCII text and a
> *lot* of math differences, many of which say "*no* convergence: NOTIFY
> R-core!".
>
> Until these are resolved, R can't be packaged for distributions that
> use musl, such as Alpine Linux.
>
> Thank you.


From dstr7320 at uni.sydney.edu.au  Sat Jan 30 12:00:09 2016
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Sat, 30 Jan 2016 11:00:09 +0000
Subject: [Rd] More Capability for Capabilities
In-Reply-To: <22186.4388.443324.464683@stat.math.ethz.ch>
References: <CAMCdZYeRTOAOu0TbPOWEe61HZS_dQn+w8TCY0VyWcfn3apobCw@mail.gmail.com>,
	<22186.4388.443324.464683@stat.math.ethz.ch>
Message-ID: <SN1PR0101MB143992DF5E041B4D47026B00CDDA0@SN1PR0101MB1439.prod.exchangelabs.com>

Good day,

To clarify, extSoftVersion and grSoftVersion first became available in R 3.2.3. The university's servers are running R 3.2.2, so I didn't see it.

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia


From murdoch.duncan at gmail.com  Sat Jan 30 22:11:11 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 30 Jan 2016 16:11:11 -0500
Subject: [Rd] Best way for rgl's .onLoad to fail?
Message-ID: <56AD26EF.5000107@gmail.com>

On OSX and Linux, the rgl package currently requires X11 libs to be 
available for linking.  Recent versions of OSX don't include them by 
default, so I'd like rgl to fail nicely.

Ideally, it will load a library that doesn't need to link to the X11 
libs but will still allow WebGL code to work, but that's complicated, so 
I'd like a stopgap.

I can detect that the failure is about to happen, and call stop() in the 
.onLoad hook, but that gives an ugly message:

 > library(rgl)
Error : .onLoad failed in loadNamespace() for 'rgl', details:
   call: NULL
   error: X11 not found; XQuartz (from www.xquartz.org) is required to 
run rgl.
Error: package or namespace load failed for ?rgl?

Alternatively, I can just give a warning and not attempt to load the rgl 
lib:

 > library(rgl)
Warning message:
X11 not found; XQuartz (from www.xquartz.org) is required to run rgl.

rgl is now loaded, but it doesn't work; just about any function call 
will give an error, e.g.

 > plot3d(1,2,3)
Error in rgl.cur() : object 'rgl_dev_getcurrent' not found

Do people have opinions about this?

One comparable package is RGtk2:  if Gtk2 isn't install, it offers to 
install it.  I could probably do that for XQuartz.  If the user says no, 
RGtk2 gives really ugly error messages.  rgl can work without XQuartz, 
but as I already mentioned, making this work is complicated, so I'd like 
something simple for now.

Duncan Murdoch


From spencer.graves at prodsyse.com  Sat Jan 30 22:34:36 2016
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sat, 30 Jan 2016 15:34:36 -0600
Subject: [Rd] In plot.ts,
 las=1 applies to ylab with multiple series and not to axis labels
Message-ID: <56AD2C6C.8090804@prodsyse.com>

Hello:


       In plot.ts, las=1 applies to ylab and not axis labels with 
multiple series.  The documented behavior is to have las=1 apply to axis 
labels and not ylab.


       To see this, please try the following:


plot.ts(1:4, las=1)


plot.ts(matrix(1:8, 4), las=1)


       On my Mac, the second displays behavior I did not expect.  If 
I've done something stupid here, please advise;  it won't be the first 
time ;-)


       Thanks to all the developers who have made R such a great 
contribution to humanity.


       Best Wishes,
       Spencer Graves


sessionInfo()
R version 3.2.3 (2015-12-10)
Platform: x86_64-apple-darwin13.4.0 (64-bit)
Running under: OS X 10.11.2 (El Capitan)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base

loaded via a namespace (and not attached):
[1] tools_3.2.3


From adrian.waddell at gmail.com  Sun Jan 31 15:13:52 2016
From: adrian.waddell at gmail.com (Adrian Waddell)
Date: Sun, 31 Jan 2016 15:13:52 +0100
Subject: [Rd] Update local320.zip to local323.zip in R-admin
Message-ID: <CACa4aQ6pev-3L1W2fR8mH23iFWwP9xgVRvF1_Fd1-b0rb91qjQ@mail.gmail.com>

In section 3.1.2 of R-admin

https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Getting-the-source-files

the fille name local320.zip seems to be outdated and probably should
be replaced with local323.zip.

Greetings,

Adrian


From hanson at depauw.edu  Sun Jan 31 15:50:46 2016
From: hanson at depauw.edu (Bryan Hanson)
Date: Sun, 31 Jan 2016 09:50:46 -0500
Subject: [Rd] Best way for rgl's .onLoad to fail?
In-Reply-To: <56AD26EF.5000107@gmail.com>
References: <56AD26EF.5000107@gmail.com>
Message-ID: <8D38DD51-6E89-410C-AA46-107BB4762B91@depauw.edu>

I think the 2nd option will be more palatable to inexperienced users, but both do state the important detail.   Bryan

> On Jan 30, 2016, at 4:11 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> On OSX and Linux, the rgl package currently requires X11 libs to be available for linking.  Recent versions of OSX don't include them by default, so I'd like rgl to fail nicely.
> 
> Ideally, it will load a library that doesn't need to link to the X11 libs but will still allow WebGL code to work, but that's complicated, so I'd like a stopgap.
> 
> I can detect that the failure is about to happen, and call stop() in the .onLoad hook, but that gives an ugly message:
> 
> > library(rgl)
> Error : .onLoad failed in loadNamespace() for 'rgl', details:
>  call: NULL
>  error: X11 not found; XQuartz (from www.xquartz.org) is required to run rgl.
> Error: package or namespace load failed for ?rgl?
> 
> Alternatively, I can just give a warning and not attempt to load the rgl lib:
> 
> > library(rgl)
> Warning message:
> X11 not found; XQuartz (from www.xquartz.org) is required to run rgl.
> 
> rgl is now loaded, but it doesn't work; just about any function call will give an error, e.g.
> 
> > plot3d(1,2,3)
> Error in rgl.cur() : object 'rgl_dev_getcurrent' not found
> 
> Do people have opinions about this?
> 
> One comparable package is RGtk2:  if Gtk2 isn't install, it offers to install it.  I could probably do that for XQuartz.  If the user says no, RGtk2 gives really ugly error messages.  rgl can work without XQuartz, but as I already mentioned, making this work is complicated, so I'd like something simple for now.
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Sun Jan 31 19:05:48 2016
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 31 Jan 2016 13:05:48 -0500
Subject: [Rd] Update local320.zip to local323.zip in R-admin
In-Reply-To: <CACa4aQ6pev-3L1W2fR8mH23iFWwP9xgVRvF1_Fd1-b0rb91qjQ@mail.gmail.com>
References: <CACa4aQ6pev-3L1W2fR8mH23iFWwP9xgVRvF1_Fd1-b0rb91qjQ@mail.gmail.com>
Message-ID: <56AE4CFC.50806@gmail.com>

On 31/01/2016 9:13 AM, Adrian Waddell wrote:
> In section 3.1.2 of R-admin
>
> https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Getting-the-source-files
>
> the fille name local320.zip seems to be outdated and probably should
> be replaced with local323.zip.
>

Now fixed.

Duncan Murdoch


