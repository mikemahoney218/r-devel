From bill at insightful.com  Fri Jun  1 02:52:51 2007
From: bill at insightful.com (Bill Dunlap)
Date: Thu, 31 May 2007 17:52:51 -0700 (PDT)
Subject: [Rd] Possible changes to connections
In-Reply-To: <m24plssytq.fsf@ziti.local>
References: <Pine.LNX.4.64.0705301726400.11532@gannet.stats.ox.ac.uk>
	<465E7B0B.2080005@altk.com>
	<Pine.LNX.4.64.0705311534280.27499@gannet.stats.ox.ac.uk>
	<m24plssytq.fsf@ziti.local>
Message-ID: <Pine.GSO.4.56.0705311734520.2074@durian.statsci.com>

On Thu, 31 May 2007, Seth Falcon wrote:

> > When I ran some tests I found 7 packages on CRAN that in their tests
> > were not closing connections.  Four of those are maintained by R-core
> > members.
> > Even though none were by me, I think this is too easy to forget to
> > do!
>
> I agree that it is easy to forget.  It is especially easy if one
> creates so-called anonymous connection references like
> readLines(file(path)) -- this anonymous idiom seems nature to me when
> coding R and it would be nice to make it work for connections.

I like the idea of the connection being closed when there
are no more references to it.  I guess that means when the
garbage collector notices it has been orphaned, which may
take a while.

However, one of my longstanding complaints about connections
in Splus and R may have a bearing here also.  Currently, if you
want to have your file opened in a particular way, say for
only reading or for appending or in binary mode then you
need to specify open=mode when calling file().  However that
also tells it to actually open the file.  I would prefer that
there was a mode= argument to file that meant that when the
file is eventually opened it would be opened with that mode.
open= should be restricted to TRUE or FALSE, or IMO, be eliminated.
(We have an open() function for that.)  With the current system
   readLines(file(path))
does not leave path open but
   readLines(file(path, "r"))
does leave it open.  E.g., using readLines(file(path))
as Seth did appears to work fine:
  > system(paste("/usr/sbin/lsof -p", Sys.getpid(),"|grep /tmp/twolines.txt"))
  > readLines(file("/tmp/twolines.txt"))
  [1] "One,"                 "two, and that is it."
  > system(paste("/usr/sbin/lsof -p", Sys.getpid(),"|grep /tmp/twolines.txt"))
  > # no lsof output means the file is not open
but asking to have it opened in readonly and binary
mode leaks a file descriptor:
  > system(paste("/usr/sbin/lsof -p", Sys.getpid(),"|grep /tmp/twolines.txt"))
  > readLines(file("/tmp/twolines.txt", open="rb"))
  [1] "One,"                 "two, and that is it."
  > system(paste("/usr/sbin/lsof -p", Sys.getpid(),"|grep /tmp/twolines.txt"))
  R       16950 bill    3r   REG    8,2       26   229597 /tmp/twolines.txt
That difference sinces unnatural to me.

Of course, we could just add the mode= argument and hope
people started using it instead of open=.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From edd at debian.org  Fri Jun  1 03:12:16 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 31 May 2007 20:12:16 -0500
Subject: [Rd] Problems when linking to R shared library
In-Reply-To: <007501c7a3ae$25c2f840$38540352@fuji>
References: <007501c7a3ae$25c2f840$38540352@fuji>
Message-ID: <18015.29296.520924.232709@basebud.nulle.part>


On 31 May 2007 at 19:04, John Maddock wrote:
| Folks,
| 
| I'm fairly sure that I'm doing something stupid, but I'm getting a few
| really strange results from *some* of the distributions, but by no means 
| all,
| when I link directly to the R shared library.

When I try to build your program, I get very immediate and explicit messages:

edd at basebud:~> g++ -Wall -O3 -I/usr/share/R/include -o /tmp/johnmaddock /tmp/johnmaddock.cc -lRmath
/tmp/ccb5T7l9.o: In function `main':
johnmaddock.cc:(.text+0xae): undefined reference to `Rf_pf'
johnmaddock.cc:(.text+0xed): undefined reference to `Rf_pchisq'
johnmaddock.cc:(.text+0x136): undefined reference to `Rf_pgamma'
johnmaddock.cc:(.text+0x17a): undefined reference to `Rf_ppois'
johnmaddock.cc:(.text+0x1b9): undefined reference to `Rf_qchisq'
johnmaddock.cc:(.text+0x202): undefined reference to `Rf_qgamma'
collect2: ld returned 1 exit status

which shows that the compiler/linker do not yet know about the functions you
use. 

Your mistake was to not do 

#define MATHLIB_STANDALONE 1

before the #include of Rmath.h.  After that, all is well:

edd at basebud:~> g++ -Wall -O3 -I/usr/share/R/include -o /tmp/johnmaddock /tmp/johnmaddock.cc -lRmath
edd at basebud:~> /tmp/johnmaddock
0.646447
0.527633
0.090204
0.124652
1.38629
5.03504
edd at basebud:~>                    

| I've tried this on both Windows with the precompiled Mingw binary of R-2.5.0
| (compiling my code with MinGW-3.4.2), and by building R-2.5.0 on Mandriva
| Linux with gcc-3.4.4 and --enable-R-shlib.  The actual code is at the end of
| the message, but the main cases are:
| 
| std::cout << pf(1.5, 2.0, 3.0, 1, 0) << std::endl;
| 
| Outputs 1, expect 0.646447

Good.

| std::cout << pchisq(1.5, 2.0, 1, 0) << std::endl;
| 
| Outputs 1, expect 0.527633

Good.
 
| std::cout << pgamma(1.5, 2.0, 3.0, 1, 0) << std::endl;
| 
| Outputs 1, expect 0.090204

Good.
 
| std::cout << ppois(2.0, 5.0, 1, 0) << std::endl;
| 
| Outputs 0, expect 0.124652

Good.
 
 
| std::cout << qchisq(0.5, 2.0, 1, 0) << std::endl;
| 
| Outputs -0.61379, expect 1.38629

Good.
 
| std::cout << qgamma(0.5, 2.0, 3.0, 1, 0) << std::endl;
| 
| Outputs 0.0282703, expect 5.03504

Good.
 
| I should stress that within the R environment, I *do* get the values I
| expect: though sometimes the arguments need adjusting as the C functions
| have slightly different argument lists from the R versions.
| 
| Also:
| 
| std::cout << qpois(0.5, 5.0, 1, 0) << std::endl;
| 
| Seems to go into an infinite loop inside qpois, while:
| 
| qbeta(0.1, 1e-5, 1e-5, 1, 0);
| 
| Raises an access violation inside R: although I should stress that all other
| beta quantiles I've tested come out OK.
| 
| Anyway, hopefully you can just tell me what an idiot I am :-)

We are too polite for that, we also insist that folks do the old RTFM -- the
#define you missed is of course mentioned in the R Extensions manual.

Hth, Dirk

 
| Thanks in advance for any help you can give,
| 
| John Maddock.
| 
| The complete source code is:
| 
| #include <iostream>
| #include <iomanip>
| 
| extern "C" {
| #include "Rmath.h"
| }
| 
| int main(int argc, const char** argv)
| {
|   std::cout << pf(1.5, 2.0, 3.0, 1, 0) << std::endl;
|   std::cout << pchisq(1.5, 2.0, 1, 0) << std::endl;
|   std::cout << pgamma(1.5, 2.0, 3.0, 1, 0) << std::endl;
|   std::cout << ppois(2.0, 5.0, 1, 0) << std::endl;
|   std::cout << qchisq(0.5, 2.0, 1, 0) << std::endl;
|   std::cout << qgamma(0.5, 2.0, 3.0, 1, 0) << std::endl;
|   //std::cout << qpois(0.5, 5.0, 1, 0) << std::endl;
|   return 0;
| }
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From mel at altk.com  Fri Jun  1 08:24:14 2007
From: mel at altk.com (mel)
Date: Fri, 01 Jun 2007 08:24:14 +0200
Subject: [Rd] Possible changes to connections
In-Reply-To: <Pine.LNX.4.64.0705311534280.27499@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0705301726400.11532@gannet.stats.ox.ac.uk>
	<465E7B0B.2080005@altk.com>
	<Pine.LNX.4.64.0705311534280.27499@gannet.stats.ox.ac.uk>
Message-ID: <465FBB8E.1040400@altk.com>

Prof Brian Ripley a ?crit :

>> I use getConnection().
>> In the context in which I use it, the number of the connection is
>> known a priori.
> 
> I don't see how you can know it 'a priori': it is an implementation detail
> (and since R itself uses connections, those details could easily change).

(disclaimer : I don't claim its the best way to proceed)

Before launching my app, the connections context is :
 > showConnections(all=TRUE)
   description class      mode text   isopen   can read can write
0 "stdin"     "terminal" "r"  "text" "opened" "yes"    "no"
1 "stdout"    "terminal" "w"  "text" "opened" "no"     "yes"
2 "stderr"    "terminal" "w"  "text" "opened" "no"     "yes"

So, the call to socketConnections() creates always (at least
for all my experiments) a connection with number 3.
Btw, if (socketConnections(...) != 3) the application simply
don't launch.
So, if the application runs, it's sure that this is with a
connection number==3.
That's why I say that "the number of the connection is known a priori".

Of course, the connection number could also be retrieved eg using
the description field.


From ripley at stats.ox.ac.uk  Fri Jun  1 08:39:07 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Jun 2007 07:39:07 +0100 (BST)
Subject: [Rd] Possible changes to connections
In-Reply-To: <465FBB8E.1040400@altk.com>
References: <Pine.LNX.4.64.0705301726400.11532@gannet.stats.ox.ac.uk>
	<465E7B0B.2080005@altk.com>
	<Pine.LNX.4.64.0705311534280.27499@gannet.stats.ox.ac.uk>
	<465FBB8E.1040400@altk.com>
Message-ID: <Pine.LNX.4.64.0706010735450.3308@gannet.stats.ox.ac.uk>

On Fri, 1 Jun 2007, mel wrote:

> Prof Brian Ripley a ?crit :
>
>>> I use getConnection().
>>> In the context in which I use it, the number of the connection is
>>> known a priori.
>>
>> I don't see how you can know it 'a priori': it is an implementation detail
>> (and since R itself uses connections, those details could easily change).
>
> (disclaimer : I don't claim its the best way to proceed)
>
> Before launching my app, the connections context is :
> > showConnections(all=TRUE)
>   description class      mode text   isopen   can read can write
> 0 "stdin"     "terminal" "r"  "text" "opened" "yes"    "no"
> 1 "stdout"    "terminal" "w"  "text" "opened" "no"     "yes"
> 2 "stderr"    "terminal" "w"  "text" "opened" "no"     "yes"
>
> So, the call to socketConnections() creates always (at least
> for all my experiments) a connection with number 3.
> Btw, if (socketConnections(...) != 3) the application simply
> don't launch.
> So, if the application runs, it's sure that this is with a
> connection number==3.
> That's why I say that "the number of the connection is known a priori".

You don't *know* that: it depends on how R internally numbers connections 
and what the startup code does.  That detail will almost certainly change.

> Of course, the connection number could also be retrieved eg using
> the description field.

For now, at least.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From byron.ellis at gmail.com  Fri Jun  1 09:42:43 2007
From: byron.ellis at gmail.com (Byron Ellis)
Date: Fri, 1 Jun 2007 00:42:43 -0700
Subject: [Rd] Possible changes to connections
In-Reply-To: <Pine.GSO.4.56.0705311734520.2074@durian.statsci.com>
References: <Pine.LNX.4.64.0705301726400.11532@gannet.stats.ox.ac.uk>
	<465E7B0B.2080005@altk.com>
	<Pine.LNX.4.64.0705311534280.27499@gannet.stats.ox.ac.uk>
	<m24plssytq.fsf@ziti.local>
	<Pine.GSO.4.56.0705311734520.2074@durian.statsci.com>
Message-ID: <7098abec0706010042u437fd9c1y5d1c71e062125e64@mail.gmail.com>

On 5/31/07, Bill Dunlap <bill at insightful.com> wrote:

> I like the idea of the connection being closed when there
> are no more references to it.  I guess that means when the
> garbage collector notices it has been orphaned, which may
> take a while.

Although, playing devil's advocate, it Green Book connections do
follow the same pattern as the other resource allocation type,
graphics devices. Not that this should be taken as endorsement, I
think I would like to see graphics devices head in the direction of
being actual objects as well (and I think I would want with() to be
involved with that).

It would also be really nice if connections became more like graphics
devices in that new connections could be implemented from a package.
That would make, for example, implementing clipboard connections on OS
X do the Right Thing under X11 and the GUI.

CLIM-style event streams would also be nice, but is almost surely too
much to ask. :-)

>
> However, one of my longstanding complaints about connections
> in Splus and R may have a bearing here also.  Currently, if you
> want to have your file opened in a particular way, say for
> only reading or for appending or in binary mode then you
> need to specify open=mode when calling file().  However that
> also tells it to actually open the file.  I would prefer that
> there was a mode= argument to file that meant that when the
> file is eventually opened it would be opened with that mode.
> open= should be restricted to TRUE or FALSE, or IMO, be eliminated.
> (We have an open() function for that.)  With the current system
>    readLines(file(path))
> does not leave path open but
>    readLines(file(path, "r"))
> does leave it open.  E.g., using readLines(file(path))
> as Seth did appears to work fine:
>   > system(paste("/usr/sbin/lsof -p", Sys.getpid(),"|grep /tmp/twolines.txt"))
>   > readLines(file("/tmp/twolines.txt"))
>   [1] "One,"                 "two, and that is it."
>   > system(paste("/usr/sbin/lsof -p", Sys.getpid(),"|grep /tmp/twolines.txt"))
>   > # no lsof output means the file is not open
> but asking to have it opened in readonly and binary
> mode leaks a file descriptor:
>   > system(paste("/usr/sbin/lsof -p", Sys.getpid(),"|grep /tmp/twolines.txt"))
>   > readLines(file("/tmp/twolines.txt", open="rb"))
>   [1] "One,"                 "two, and that is it."
>   > system(paste("/usr/sbin/lsof -p", Sys.getpid(),"|grep /tmp/twolines.txt"))
>   R       16950 bill    3r   REG    8,2       26   229597 /tmp/twolines.txt
> That difference sinces unnatural to me.
>
> Of course, we could just add the mode= argument and hope
> people started using it instead of open=.

Maybe the actual solution is actually two types of objects? An
abstract resource object that describes a potential connection and
then leave the connection object to active I/O streams?

>
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
> 360-428-8146
>
>  "All statements in this message represent the opinions of the author and do
>  not necessarily reflect Insightful Corporation policy or position."
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian


From ripley at stats.ox.ac.uk  Fri Jun  1 11:32:39 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Jun 2007 10:32:39 +0100 (BST)
Subject: [Rd] Problem  building R from source on Windows
In-Reply-To: <loom.20070531T173140-968@post.gmane.org>
References: <loom.20070531T173140-968@post.gmane.org>
Message-ID: <Pine.LNX.4.64.0706011030480.4342@gannet.stats.ox.ac.uk>

On Thu, 31 May 2007, Jonathan Swinton wrote:

>
> I have a problem when building R from source on Windows XP.
>
> When I get to 3.1.3 of the Installation and Administration manual and try
> make all recommended
> from R_HOME it fails with
> make: *** No rule to make target `all'.  Stop.

But it is from R_HOME/src/gnuwin32.

> I am pretty sure there is an obvious and well documented thing I am missing,
> but missing it I am. Any clues?
>
> Is my problem that I have a Makefile.in but not a Makefile? Have I understood
> section 3.1.3 correctly that no ./configure step is needed? Although my reading
> of the I&A manual is that no ./configure step is needed under Windows, I did
> wonder and tried running
> sh ./configure

You really don't want to do that, and to be sure it did no harm you need 
to unpack R afresh.

> but that failed with
> chmod: not found
> chmod: not found
> chmod: not found
> configure: error: cannot create configure.lineno; rerun with a POSIX shell
>
>
> make is GNU make 3.79.1; I don't know how to identify which sh it is but it is
> the one in the Rtools\bin directory.
>
> I having downloaded all the tools listed in Appendix E (save InnoSetup) and
> installed them and set my path to be:
>
> PATH=c:\Rtools\bin;C:\Perl\bin\;c:\Rtools\MinGW\bin;c:\progra~1\htmhe~1;C:\Progr
> am Files\MiKTeX 2.6\miktex\bin;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System3
> 2\Wbem;C:\Program Files\Subversion\bin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From whinev at gmail.com  Fri Jun  1 11:44:39 2007
From: whinev at gmail.com (Ev Whin)
Date: Fri, 1 Jun 2007 17:44:39 +0800
Subject: [Rd] Question on the R's C stack limit
Message-ID: <dfed1c180706010244g4dc0c55fg4d86c9c21504ab3e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070601/67707672/attachment.pl 

From ripley at stats.ox.ac.uk  Fri Jun  1 11:58:11 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Jun 2007 10:58:11 +0100 (BST)
Subject: [Rd] Question on the R's C stack limit
In-Reply-To: <dfed1c180706010244g4dc0c55fg4d86c9c21504ab3e@mail.gmail.com>
References: <dfed1c180706010244g4dc0c55fg4d86c9c21504ab3e@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706011052200.1015@gannet.stats.ox.ac.uk>

On Fri, 1 Jun 2007, Ev Whin wrote:

> Dear r-devel members,
>    I encountered a C stack limit issue, when I tried to embed R 2.5 into my
> application. In the R-exts document, it says:"Note that R's own front ends
> use a stack size of 10Mb". I desire to know: is it possible to decrease this
> stack size
> by modifying R's source code? If it's possible, which part of the source
> code is responsible for the issue?

You have picked that out of the Windows-specific documentation without 
saying you are on Windows (are you?).  The setting is in 
src/gnuwin/front-ends, unsurprisingly.  (In the Makefile, to be exact.)

> Thank you all.
>
> Whin
>
> 	[[alternative HTML version deleted]]

Please don't send HTML: see the posting guide.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Fri Jun  1 14:59:56 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 1 Jun 2007 08:59:56 -0400
Subject: [Rd] Question on the R's C stack limit
In-Reply-To: <dfed1c180706010244g4dc0c55fg4d86c9c21504ab3e@mail.gmail.com>
References: <dfed1c180706010244g4dc0c55fg4d86c9c21504ab3e@mail.gmail.com>
Message-ID: <5D84AF01-69E5-4471-A8B1-F7D061B5D846@r-project.org>

On Jun 1, 2007, at 5:44 AM, Ev Whin wrote:

> Dear r-devel members,
>     I encountered a C stack limit issue, when I tried to embed R  
> 2.5 into my
> application.

If you are embedding R, you can change or disable the stack limit by  
setting R_CStackLimit appropriately. There is no need to change the R  
source code.

Cheers,
Simon



> In the R-exts document, it says:"Note that R's own front ends
> use a stack size of 10Mb". I desire to know: is it possible to  
> decrease this
> stack size
> by modifying R's source code? If it's possible, which part of the  
> source
> code is responsible for the issue?
>
> Thank you all.
>


From weston at lindaspaces.com  Fri Jun  1 17:05:01 2007
From: weston at lindaspaces.com (Stephen B. Weston)
Date: Fri, 01 Jun 2007 11:05:01 -0400
Subject: [Rd] Possible changes to connections
Message-ID: <4660359D.6010307@lindaspaces.com>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

 > [I know there is a call to getConnection in package gtools, but
 > the return value is unused!]

Speaking of connections and gtools, I've been wondering if the
gtools setTCPNoDelay function's method of getting the Unix file
descriptor of a socket connection is safe.  It's basically doing
this:

   d <- as.integer(socketConnection("localhost", 80)[1])

Is that depending on an implementation detail that may change?
I think it's useful to allow C extensions to set OS specific
socket options on connection objects.  But perhaps Jeffrey
Horner's proposal addresses this need.

- Steve


From ripley at stats.ox.ac.uk  Fri Jun  1 17:38:27 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Jun 2007 16:38:27 +0100 (BST)
Subject: [Rd] Question on the R's C stack limit
In-Reply-To: <5D84AF01-69E5-4471-A8B1-F7D061B5D846@r-project.org>
References: <dfed1c180706010244g4dc0c55fg4d86c9c21504ab3e@mail.gmail.com>
	<5D84AF01-69E5-4471-A8B1-F7D061B5D846@r-project.org>
Message-ID: <Pine.LNX.4.64.0706011630290.17067@auk.stats>

On Fri, 1 Jun 2007, Simon Urbanek wrote:

> On Jun 1, 2007, at 5:44 AM, Ev Whin wrote:
>
>> Dear r-devel members,
>>     I encountered a C stack limit issue, when I tried to embed R
>> 2.5 into my
>> application.
>
> If you are embedding R, you can change or disable the stack limit by
> setting R_CStackLimit appropriately. There is no need to change the R
> source code.

Ah, you can change or disable R's detection of imminent stack limit 
transgressions.  That does not change the actual stack size.

You may well have guessed right that this question was actually about 
stack limit detection, but that is not what was written.

The point of the comment in the manual is that if you run R embedded in 
another application, R potentially needs a fairly large stack size.  The 1 
or 2Mb default of most Windows' compilers is insufficient, and stack size 
is a parameter in the header of the application, not of the compiled 
R.dll.

>
> Cheers,
> Simon
>
>
>
>> In the R-exts document, it says:"Note that R's own front ends
>> use a stack size of 10Mb". I desire to know: is it possible to
>> decrease this
>> stack size
>> by modifying R's source code? If it's possible, which part of the
>> source
>> code is responsible for the issue?
>>
>> Thank you all.
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From wangtong at usc.edu  Sat Jun  2 01:16:50 2007
From: wangtong at usc.edu (Tong Wang)
Date: Fri, 01 Jun 2007 16:16:50 -0700
Subject: [Rd] Debug with set.seed()
Message-ID: <de14a0ea903e.46604672@usc.edu>

HI, all
    I am debugging an R code with dynamically loaded function in it.  It seems set.seed(n) does not give me the same 
random draws every time.  Could somebody tell me what I should do to get the same outcome verytime ?
    I am not sure what infomation is relevent to this question , the following is a really scatchy description of the code I wrote.I am using the R-2.4.1 built under Cygwin. OS is WinXP.

Thanks a lot  for any help.  
  
    Myfunction<-function(...) {
        .......
        drawsomething<-function(){  out<- .C( "drawit"...........)  
                                                             var <<- out$var  # assign the outputs}
        .......
        for( i in 1 : iter) { .........
                                    drawsomething()
                                    .......... }

       reture( var.stor )     #return stored result
}


From deepayan.sarkar at gmail.com  Sat Jun  2 01:22:18 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 1 Jun 2007 16:22:18 -0700
Subject: [Rd] HTML vignette browser
Message-ID: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>

Hi,

this is tangentially related to the recent discussion on vignettes.
vignette() currently produces a listing of available vignettes, but
these are not clickable. Since R has a browseURL() function, it seems
natural to have a version that produces HTML with clickable links.
Here's an attempt at that:

source("http://dsarkar.fhcrc.org/R/vignette-browser.R")
browseVignettes()
browseVignettes(package = "grid")

etc. Perhaps some variant of this could be added to R.

Comments welcome.

-Deepayan


From pburns at pburns.seanet.com  Sat Jun  2 09:57:22 2007
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Sat, 02 Jun 2007 08:57:22 +0100
Subject: [Rd] Debug with set.seed()
In-Reply-To: <de14a0ea903e.46604672@usc.edu>
References: <de14a0ea903e.46604672@usc.edu>
Message-ID: <466122E2.5080102@pburns.seanet.com>

I think you will find that 'set.seed' does give you the same
random state each time.  That you don't get the same result
each time implies a bug in your code.  Looking for uninitialized
variables would probably be a good start.  Using valgrind
under Linux would most likely find the error quickly.

Also, using '<<-' is generally a bad idea.

Patrick Burns
patrick at burns-stat.com
+44 (0)20 8525 0696
http://www.burns-stat.com
(home of S Poetry and "A Guide for the Unwilling S User")

Tong Wang wrote:

>HI, all
>    I am debugging an R code with dynamically loaded function in it.  It seems set.seed(n) does not give me the same 
>random draws every time.  Could somebody tell me what I should do to get the same outcome verytime ?
>    I am not sure what infomation is relevent to this question , the following is a really scatchy description of the code I wrote.I am using the R-2.4.1 built under Cygwin. OS is WinXP.
>
>Thanks a lot  for any help.  
>  
>    Myfunction<-function(...) {
>        .......
>        drawsomething<-function(){  out<- .C( "drawit"...........)  
>                                                             var <<- out$var  # assign the outputs}
>        .......
>        for( i in 1 : iter) { .........
>                                    drawsomething()
>                                    .......... }
>
>       reture( var.stor )     #return stored result
>}
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>  
>


From adschai at optonline.net  Sun Jun  3 02:07:45 2007
From: adschai at optonline.net (adschai at optonline.net)
Date: Sun, 03 Jun 2007 00:07:45 +0000 (GMT)
Subject: [Rd] [R] setClass with a slot of RODBC
Message-ID: <e34bfa562b949.46620651@optonline.net>

An embedded message was scrubbed...
From: David James <daj025 at gmail.com>
Subject: Re: [R] setClass with a slot of RODBC
Date: Sat, 02 Jun 2007 10:32:47 -0400
Size: 4053
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070603/f3583feb/attachment.mht 

From krys at maths.lth.se  Fri Jun  1 17:03:26 2007
From: krys at maths.lth.se (krys at maths.lth.se)
Date: Fri,  1 Jun 2007 17:03:26 +0200 (CEST)
Subject: [Rd] Determinant function (PR#9715)
Message-ID: <20070601150326.7AA6448CF1@slim.kubism.ku.dk>

Full_Name: Krzysztof Podgorski
Version: R version 2.4.1 (2006-12-18)
OS: Windows XP
Submission from: (NULL) (130.235.3.79)


The function ''det'' works improperly for a singular matrix and returns a
non-zero value even if ''solve'' reports singularity. The matrix is very simple
as shown below.

A <- diag(rep(c(64,8), c(8,8)))
A[9:16,1] <- 8
A[1,9:16] <- 8

det(A)
#[1] -196608
solve(A)
#Error in solve.default(A) : system is computationally singular: reciprocal
condition number = 2.31296e-18


From savicky at cs.cas.cz  Mon Jun  4 14:40:13 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Mon, 4 Jun 2007 14:40:13 +0200
Subject: [Rd] Determinant function (PR#9715)
In-Reply-To: <20070601150326.7AA6448CF1@slim.kubism.ku.dk>
References: <20070601150326.7AA6448CF1@slim.kubism.ku.dk>
Message-ID: <20070604124013.GE14645@cs.cas.cz>

> The function ''det'' works improperly for a singular matrix and returns a
> non-zero value even if ''solve'' reports singularity. The matrix is very simple
> as shown below.
>
> A <- diag(rep(c(64,8), c(8,8)))
> A[9:16,1] <- 8
> A[1,9:16] <- 8
> 
> det(A)
> #[1] -196608
> solve(A)
> #Error in solve.default(A) : system is computationally singular: reciprocal
> condition number = 2.31296e-18

The "det" function cannot work properly in the limited precision
of floating point numbers. May be, "det" could also do a test
of computational singularity and refuse to compute the value
similarly as "solve" does.

The eigen-values of your matrix are
  > eigen(A)$values
   [1]  7.200000e+01  6.400000e+01  6.400000e+01  6.400000e+01  6.400000e+01
   [6]  6.400000e+01  6.400000e+01  6.400000e+01  8.000000e+00  8.000000e+00
  [11]  8.000000e+00  8.000000e+00  8.000000e+00  8.000000e+00  8.000000e+00
  [16] -2.023228e-15
The last value is not zero due to rounding. The determinant is the product
of eigenvalues, so we get something large.

The problem may also be seen as follows:
  > det(A/8)
  [1] -6.98492e-10
This is close to zero as it should be, however, det(A) = det(A/8)*8^16,
and this is what we really get:
  > det(A/8)*8^16
  [1] -196608
  > det(A)
  [1] -196608

There are even matrices closer to a diagonal matrix than A with
a similar problem:
  > B <- 20*diag(16); B[1:2,1:2] <- c(25,35,35,49); det(B);
  [1] 44565.24

All the best, Petr.


From friedrich.leisch at stat.uni-muenchen.de  Mon Jun  4 17:57:34 2007
From: friedrich.leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Mon, 4 Jun 2007 17:57:34 +0200
Subject: [Rd] HTML vignette browser
In-Reply-To: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
References: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
Message-ID: <18020.13934.289824.556395@lxh5.stat.uni-muenchen.de>

>>>>> On Fri, 1 Jun 2007 16:22:18 -0700,
>>>>> Deepayan Sarkar (DS) wrote:

  > Hi,
  > this is tangentially related to the recent discussion on vignettes.
  > vignette() currently produces a listing of available vignettes, but
  > these are not clickable. Since R has a browseURL() function, it seems
  > natural to have a version that produces HTML with clickable links.
  > Here's an attempt at that:

  > source("http://dsarkar.fhcrc.org/R/vignette-browser.R")
  > browseVignettes()
  > browseVignettes(package = "grid")

  > etc. Perhaps some variant of this could be added to R.

  > Comments welcome.

Looks good to me, and certainly something worth being added to R.

2 quick (related) comments:

1) I am not sure if we want to include links to the Latex-Sources by
   default, those might confuse unsuspecting novices a lot. Perhaps
   make those optional using an argument to browseVignettes(), which
   is FALSE by default?

2) Instead links to .Rnw files we may want to include links to the R
   code -> should we R CMD INSTALL a tangled version of each vignette
   such that we can link to it? Of course it is redundant information
   given the .Rnw, but we also have the help pages in several formats
   ready.

.f


From spencer.graves at pdf.com  Mon Jun  4 18:21:13 2007
From: spencer.graves at pdf.com (Spencer Graves)
Date: Mon, 04 Jun 2007 09:21:13 -0700
Subject: [Rd] nls problems
Message-ID: <46643BF9.7030502@pdf.com>

Hi, All: 

      The following identifies apparent inconsistencies and proposed 
fixes between the documentation and the behavior of 'nls'. 

      Specifically, the help file says 'data' 'Can also be a list'.  
However, I got an error when I tried it with a list that could not be 
coerced to a data.frame.  This is documented in the first example below. 

      Also, the help file says 'data' is 'optional'.  Unfortunately, the 
second example below bombs, apparently while checking the wrong thing 
for parameters to estimate. 

      Attached is a version of 'nls' that fixes these problems and 
otherwise produces the same answers (per 'all.equal') as the current 
official version on the "Examples" in 'nls' help file.  What do you 
think about adopting these code changes and adding these examples to the 
'nls' help file (see the attached  'nls-new examples.R')? 

       I am using this in preparing for a presentation on the 'fda' 
package at UseR! in Ames (Aug. 8-10).  I am temporarily adding the 
attached version of 'nls' to the 'fda' package with a help file 
primarily consisting of a pointer to help(nls, package=stats) and the 
attached examples.  However, I'm hoping that someone will find the time 
to review this and either disabuse me of some of my deficiencies in this 
area or announce a plan to have something like this incorporated in a 
future version of R. 

      Thanks,
      Best Wishes,
      Spencer Graves
p.s.  How can I find the official source code for this?  I tried 
"https://svn.r-project.org/R-packages/trunk" and found 'nlme' and other 
packages but not core R like 'stats'. 
#####################
##
## SLIGHT MODIFICATIONS TO CURRENT EXAMPLES
## THAT DON'T WORK (except with my modifications)
##
# Weighted Michaelis-Menten model
# with data = a list that can not be coerced to a data.frame
TreatIrreg <- with(Treated, list(conc1=conc[1], conc.1=conc[-1], rate=rate))

# Passing arguments using a list that can not be coerced to a data.frame
weighted.MM1 <- function(resp, conc1, conc.1, Vm, K){
  conc <- c(conc1, conc.1)
  resp <- TI$rate
#
  pred <- (Vm * conc)/(K + conc)
  (resp - pred) / sqrt(pred)
}
Pur.wt1 <- nls( ~ weighted.MM1(rate, conc1, conc.1, Vm, K), 
data=TreatIrreg,
               start = list(Vm = 200, K = 0.1), trace = TRUE)
##
## ERROR MESSAGE: 
## Error in data.frame(conc1 = 0.02, conc.1 = c(0.02, 0.06, 0.06, 0.11, 
0.11,  :
##    arguments imply differing number of rows: 1, 11, 12
##

# Passing arguments via 'get'
weignted.MM0 <- function(Vm, K){ 
  TI <- get("TreatIrreg")
  conc <- with(TI, c(conc1, conc.1))
  resp <- TI$rate
#
  pred <- (Vm * conc)/(K + conc)
  (resp - pred) / sqrt(pred)
}
Pur.wt0 <- nls( ~ weighted.MM0(Vm, K), start = list(Vm = 200, K = 0.1),
                   trace = TRUE)
##
## ERROR MESSAGE:
## Error in nls(~weighted.MM0(Vm, K), start = list(Vm = 200, K = 0.1), 
trace = TRUE) :
##     no parameters to fit
##

############################

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: nls.R
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070604/45e4d0d8/attachment.pl 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: nls-new examples.R
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070604/45e4d0d8/attachment-0001.pl 

From sfalcon at fhcrc.org  Mon Jun  4 19:03:41 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Mon, 04 Jun 2007 10:03:41 -0700
Subject: [Rd] HTML vignette browser
In-Reply-To: <18020.13934.289824.556395@lxh5.stat.uni-muenchen.de> (Friedrich
	Leisch's message of "Mon, 4 Jun 2007 17:57:34 +0200")
References: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
	<18020.13934.289824.556395@lxh5.stat.uni-muenchen.de>
Message-ID: <m2zm3f3b4i.fsf@ziti.local>

Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> writes:
> Looks good to me, and certainly something worth being added to R.
>
> 2 quick (related) comments:
>
> 1) I am not sure if we want to include links to the Latex-Sources by
>    default, those might confuse unsuspecting novices a lot. Perhaps
>    make those optional using an argument to browseVignettes(), which
>    is FALSE by default?

I agree that the Rnw could confuse folks.  But I'm not sure it needs
to be hidden or turned off by default...  If the .R file was also
included then it would be less confusing I suspect as the curious
could deduce what Rnw is about by triangulation.

> 2) Instead links to .Rnw files we may want to include links to the R
>    code -> should we R CMD INSTALL a tangled version of each vignette
>    such that we can link to it? Of course it is redundant information
>    given the .Rnw, but we also have the help pages in several formats
>    ready.

Including, by default, links to the tangled .R code seems like a
really nice idea.  I think a lot of users who find vignettes don't
realize that all of the code used to generate the entire document is
available to them -- I just had a question from someone who wanted to
know how to make a plot that appeared in a vignette, for example.


+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From deepayan.sarkar at gmail.com  Mon Jun  4 20:25:16 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Mon, 4 Jun 2007 11:25:16 -0700
Subject: [Rd] HTML vignette browser
In-Reply-To: <m2zm3f3b4i.fsf@ziti.local>
References: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
	<18020.13934.289824.556395@lxh5.stat.uni-muenchen.de>
	<m2zm3f3b4i.fsf@ziti.local>
Message-ID: <eb555e660706041125n57bb6e6dq9b251975c5f7e7de@mail.gmail.com>

On 6/4/07, Seth Falcon <sfalcon at fhcrc.org> wrote:
> Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> writes:
> > Looks good to me, and certainly something worth being added to R.
> >
> > 2 quick (related) comments:
> >
> > 1) I am not sure if we want to include links to the Latex-Sources by
> >    default, those might confuse unsuspecting novices a lot. Perhaps
> >    make those optional using an argument to browseVignettes(), which
> >    is FALSE by default?
>
> I agree that the Rnw could confuse folks.  But I'm not sure it needs
> to be hidden or turned off by default...  If the .R file was also
> included then it would be less confusing I suspect as the curious
> could deduce what Rnw is about by triangulation.
>
> > 2) Instead links to .Rnw files we may want to include links to the R
> >    code -> should we R CMD INSTALL a tangled version of each vignette
> >    such that we can link to it? Of course it is redundant information
> >    given the .Rnw, but we also have the help pages in several formats
> >    ready.
>
> Including, by default, links to the tangled .R code seems like a
> really nice idea.  I think a lot of users who find vignettes don't
> realize that all of the code used to generate the entire document is
> available to them -- I just had a question from someone who wanted to
> know how to make a plot that appeared in a vignette, for example.

I agree that having a Stangled .R file would be a great idea (among
other things, it would have the complete code, which many PDFs will
not).

I don't have a strong opinion either way about linking to the .Rnw
file. It should definitely be there if the PDF file is absent (e.g.
for grid, and other packages installed with --no-vignettes, which I
always do for local installation). Maybe we can keep them, but change
the name to something more scary than "source", e.g. "LaTeX/Noweb
source".

-Deepayan


From rgentlem at fhcrc.org  Mon Jun  4 20:52:51 2007
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Mon, 04 Jun 2007 11:52:51 -0700
Subject: [Rd] HTML vignette browser
In-Reply-To: <eb555e660706041125n57bb6e6dq9b251975c5f7e7de@mail.gmail.com>
References: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>	<18020.13934.289824.556395@lxh5.stat.uni-muenchen.de>	<m2zm3f3b4i.fsf@ziti.local>
	<eb555e660706041125n57bb6e6dq9b251975c5f7e7de@mail.gmail.com>
Message-ID: <46645F83.7000007@fhcrc.org>



Deepayan Sarkar wrote:
> On 6/4/07, Seth Falcon <sfalcon at fhcrc.org> wrote:
>> Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> writes:
>>> Looks good to me, and certainly something worth being added to R.
>>>
>>> 2 quick (related) comments:
>>>
>>> 1) I am not sure if we want to include links to the Latex-Sources by
>>>    default, those might confuse unsuspecting novices a lot. Perhaps
>>>    make those optional using an argument to browseVignettes(), which
>>>    is FALSE by default?
>> I agree that the Rnw could confuse folks.  But I'm not sure it needs
>> to be hidden or turned off by default...  If the .R file was also
>> included then it would be less confusing I suspect as the curious
>> could deduce what Rnw is about by triangulation.
>>
>>> 2) Instead links to .Rnw files we may want to include links to the R
>>>    code -> should we R CMD INSTALL a tangled version of each vignette
>>>    such that we can link to it? Of course it is redundant information
>>>    given the .Rnw, but we also have the help pages in several formats
>>>    ready.
>> Including, by default, links to the tangled .R code seems like a
>> really nice idea.  I think a lot of users who find vignettes don't
>> realize that all of the code used to generate the entire document is
>> available to them -- I just had a question from someone who wanted to
>> know how to make a plot that appeared in a vignette, for example.
> 
> I agree that having a Stangled .R file would be a great idea (among
> other things, it would have the complete code, which many PDFs will
> not).
> 
> I don't have a strong opinion either way about linking to the .Rnw
> file. It should definitely be there if the PDF file is absent (e.g.
> for grid, and other packages installed with --no-vignettes, which I
> always do for local installation). Maybe we can keep them, but change
> the name to something more scary than "source", e.g. "LaTeX/Noweb
> source".

   I would very much prefer to keep the source, with some name, scary or 
not...

> 
> -Deepayan
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From ripley at stats.ox.ac.uk  Mon Jun  4 21:42:57 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 4 Jun 2007 20:42:57 +0100 (BST)
Subject: [Rd] HTML vignette browser
In-Reply-To: <eb555e660706041125n57bb6e6dq9b251975c5f7e7de@mail.gmail.com>
References: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
	<18020.13934.289824.556395@lxh5.stat.uni-muenchen.de>
	<m2zm3f3b4i.fsf@ziti.local>
	<eb555e660706041125n57bb6e6dq9b251975c5f7e7de@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706042040200.19228@auk.stats>

Folks,

I think this is a nice idea (and not very different to somethign I have 
bene playing with), but with lots of CHARSXP changes pending I'd 
like to come back to it next week or so.

Sorry, Deepayan, you've happened to hit a very busy stage in R 
development.

Brian

On Mon, 4 Jun 2007, Deepayan Sarkar wrote:

> On 6/4/07, Seth Falcon <sfalcon at fhcrc.org> wrote:
>> Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> writes:
>>> Looks good to me, and certainly something worth being added to R.
>>>
>>> 2 quick (related) comments:
>>>
>>> 1) I am not sure if we want to include links to the Latex-Sources by
>>>    default, those might confuse unsuspecting novices a lot. Perhaps
>>>    make those optional using an argument to browseVignettes(), which
>>>    is FALSE by default?
>>
>> I agree that the Rnw could confuse folks.  But I'm not sure it needs
>> to be hidden or turned off by default...  If the .R file was also
>> included then it would be less confusing I suspect as the curious
>> could deduce what Rnw is about by triangulation.
>>
>>> 2) Instead links to .Rnw files we may want to include links to the R
>>>    code -> should we R CMD INSTALL a tangled version of each vignette
>>>    such that we can link to it? Of course it is redundant information
>>>    given the .Rnw, but we also have the help pages in several formats
>>>    ready.
>>
>> Including, by default, links to the tangled .R code seems like a
>> really nice idea.  I think a lot of users who find vignettes don't
>> realize that all of the code used to generate the entire document is
>> available to them -- I just had a question from someone who wanted to
>> know how to make a plot that appeared in a vignette, for example.
>
> I agree that having a Stangled .R file would be a great idea (among
> other things, it would have the complete code, which many PDFs will
> not).
>
> I don't have a strong opinion either way about linking to the .Rnw
> file. It should definitely be there if the PDF file is absent (e.g.
> for grid, and other packages installed with --no-vignettes, which I
> always do for local installation). Maybe we can keep them, but change
> the name to something more scary than "source", e.g. "LaTeX/Noweb
> source".
>
> -Deepayan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From deepayan.sarkar at gmail.com  Tue Jun  5 00:05:03 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Mon, 4 Jun 2007 15:05:03 -0700
Subject: [Rd] HTML vignette browser
In-Reply-To: <Pine.LNX.4.64.0706042040200.19228@auk.stats>
References: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
	<18020.13934.289824.556395@lxh5.stat.uni-muenchen.de>
	<m2zm3f3b4i.fsf@ziti.local>
	<eb555e660706041125n57bb6e6dq9b251975c5f7e7de@mail.gmail.com>
	<Pine.LNX.4.64.0706042040200.19228@auk.stats>
Message-ID: <eb555e660706041505n224d3629v5eb92bb35c10d304@mail.gmail.com>

On 6/4/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> Folks,
>
> I think this is a nice idea (and not very different to somethign I have
> bene playing with), but with lots of CHARSXP changes pending I'd
> like to come back to it next week or so.
>
> Sorry, Deepayan, you've happened to hit a very busy stage in R
> development.

No problem.

-Deepayan


From adschai at optonline.net  Tue Jun  5 03:43:31 2007
From: adschai at optonline.net (adschai at optonline.net)
Date: Tue, 05 Jun 2007 01:43:31 +0000 (GMT)
Subject: [Rd] setClass with a slot of RODBC
In-Reply-To: <e34bfa562b949.46620651@optonline.net>
References: <e34bfa562b949.46620651@optonline.net>
Message-ID: <e251dcaf2ccf6.4664bfc3@optonline.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070605/42692edc/attachment.pl 

From ligges at statistik.uni-dortmund.de  Tue Jun  5 09:20:12 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 05 Jun 2007 09:20:12 +0200
Subject: [Rd] setClass with a slot of RODBC
In-Reply-To: <e251dcaf2ccf6.4664bfc3@optonline.net>
References: <e34bfa562b949.46620651@optonline.net>
	<e251dcaf2ccf6.4664bfc3@optonline.net>
Message-ID: <46650EAC.1060008@statistik.uni-dortmund.de>



adschai at optonline.net wrote:
>  
> Hi - I tried to get some answer before but there seems to have no one response. My question is that I have a class like below definition:

Don't forget that "RODBC" is not an S4 but an S3 class, hence you have 
to declare it:

setOldClass("RODBC")


Uwe Ligges


> setClass("DBManager", 
>    representation(channel="RODBC"))
>  
> My purpose of the conn slot is to hold a channel to database connection which is returned by a command like:
>  
> channel <- odbcConnect("DB", uid="user", pwd="password")
>  
> According to RODBC documentation, this channel is supposed to have a type of "RODBC". However, if I declare my class as above, R will complain that it does not know about "RODBC" type or class. Please clarify. Thank you.
>
> - adschai 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From friedrich.leisch at stat.uni-muenchen.de  Tue Jun  5 09:36:55 2007
From: friedrich.leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Tue, 5 Jun 2007 09:36:55 +0200
Subject: [Rd] HTML vignette browser
In-Reply-To: <46645F83.7000007@fhcrc.org>
References: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
	<18020.13934.289824.556395@lxh5.stat.uni-muenchen.de>
	<m2zm3f3b4i.fsf@ziti.local>
	<eb555e660706041125n57bb6e6dq9b251975c5f7e7de@mail.gmail.com>
	<46645F83.7000007@fhcrc.org>
Message-ID: <18021.4759.632558.266252@lxh5.stat.uni-muenchen.de>

>>>>> On Mon, 04 Jun 2007 11:52:51 -0700,
>>>>> Robert Gentleman (RG) wrote:

  > Deepayan Sarkar wrote:
  >> On 6/4/07, Seth Falcon <sfalcon at fhcrc.org> wrote:
  >>> Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> writes:
  >>>> Looks good to me, and certainly something worth being added to R.
  >>>> 
  >>>> 2 quick (related) comments:
  >>>> 
  >>>> 1) I am not sure if we want to include links to the Latex-Sources by
  >>>> default, those might confuse unsuspecting novices a lot. Perhaps
  >>>> make those optional using an argument to browseVignettes(), which
  >>>> is FALSE by default?
  >>> I agree that the Rnw could confuse folks.  But I'm not sure it needs
  >>> to be hidden or turned off by default...  If the .R file was also
  >>> included then it would be less confusing I suspect as the curious
  >>> could deduce what Rnw is about by triangulation.
  >>> 
  >>>> 2) Instead links to .Rnw files we may want to include links to the R
  >>>> code -> should we R CMD INSTALL a tangled version of each vignette
  >>>> such that we can link to it? Of course it is redundant information
  >>>> given the .Rnw, but we also have the help pages in several formats
  >>>> ready.
  >>> Including, by default, links to the tangled .R code seems like a
  >>> really nice idea.  I think a lot of users who find vignettes don't
  >>> realize that all of the code used to generate the entire document is
  >>> available to them -- I just had a question from someone who wanted to
  >>> know how to make a plot that appeared in a vignette, for example.
  >> 
  >> I agree that having a Stangled .R file would be a great idea (among
  >> other things, it would have the complete code, which many PDFs will
  >> not).
  >> 
  >> I don't have a strong opinion either way about linking to the .Rnw
  >> file. It should definitely be there if the PDF file is absent (e.g.
  >> for grid, and other packages installed with --no-vignettes, which I
  >> always do for local installation). Maybe we can keep them, but change
  >> the name to something more scary than "source", e.g. "LaTeX/Noweb
  >> source".

  >    I would very much prefer to keep the source, with some name, scary or 
  > not...

I have no strong opinion eitehr way, just "source" may have a lot of
people belive that is R code -> whatever "scary" name is chosen sounds
good to me.

I'll have a shot at installing the tangled code later this week (there
is a holiday coming up on Thursday).

.f


From rdpeng at gmail.com  Tue Jun  5 14:59:34 2007
From: rdpeng at gmail.com (Roger Peng)
Date: Tue, 5 Jun 2007 08:59:34 -0400
Subject: [Rd] HTML vignette browser
In-Reply-To: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
References: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
Message-ID: <66f3bd910706050559k41034041q82dbc63cf85573be@mail.gmail.com>

This is very nice work and I like it a lot.  I think it would be quite
useful for teaching.  My only thought was that when I saw 'source' I
was expecting R code, but instead got LaTeX/Noweb.  It does seem that
'source' is  a little ambiguous here.

-roger

On 6/1/07, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> Hi,
>
> this is tangentially related to the recent discussion on vignettes.
> vignette() currently produces a listing of available vignettes, but
> these are not clickable. Since R has a browseURL() function, it seems
> natural to have a version that produces HTML with clickable links.
> Here's an attempt at that:
>
> source("http://dsarkar.fhcrc.org/R/vignette-browser.R")
> browseVignettes()
> browseVignettes(package = "grid")
>
> etc. Perhaps some variant of this could be added to R.
>
> Comments welcome.
>
> -Deepayan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From aszabo at hpi.mcw.edu  Mon Jun  4 21:54:04 2007
From: aszabo at hpi.mcw.edu (Aniko Szabo)
Date: Mon, 4 Jun 2007 14:54:04 -0500
Subject: [Rd] missing IntegerFromString()
Message-ID: <6BA3828721B5434DAAE1E65C25715A6E1ABAA0@dph002.hpi-mcw.lan>

I have created a DLL not so long ago using C code. My code used the
IntegerFromString() function that used to be exported in the
Rinternals.h header file (and thus easily accessible). Recently I
upgraded to R 2.5.0 and my DLL stopped working. I see that the
IntegerFromString() function is not exported in any of the header files
in the RHOME\include directory. Is it possible for me to use it without
installing all R source files? I can see that the function is in
coerce.c, however it #includes other stuff that I don't have and I am
afraid to mess things about by doing things I don't understand. Or
perhaps there is another function that is intended to be used instead?

 

Thanks,

Aniko


From aaron.king at umich.edu  Tue Jun  5 19:30:04 2007
From: aaron.king at umich.edu (Aaron A. King)
Date: Tue, 5 Jun 2007 13:30:04 -0400
Subject: [Rd] documenting S4 replacement methods
Message-ID: <200706051330.04863.aaron.king@umich.edu>

I'm writing a package that uses S4 classes.  I'd like to have a 'coef<-' 
method for one or more of the classes.  The generic is defined already (in 
nlme).  Defining it is no problem, but I can't seem to figure out how to 
handle the documentation.  In particular, I'd like a \usage entry in the .Rd 
file but no variant of 

\S4method{coef<-}{mif}(object, pars, ..., value)
\S4method{coef<-}{mif}(object, pars, ...) <- value
\S4method{coef}{mif}(object, pars, ...) <- value

does the job.  Is there a way to have the \usage line in the .Rd file?  If so, 
what is the correct syntax?

Thanks in advance,

Aaron



-- 
Aaron A. King, Ph.D.
Ecology & Evolutionary Biology
University of Michigan
GPG Public Key: 0x6E74F51B
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20070605/48f63b8a/attachment.bin 

From deepayan.sarkar at gmail.com  Tue Jun  5 21:12:57 2007
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Tue, 5 Jun 2007 12:12:57 -0700
Subject: [Rd] HTML vignette browser
In-Reply-To: <18021.4759.632558.266252@lxh5.stat.uni-muenchen.de>
References: <eb555e660706011622t4a0538a8obda2b8c4d87d49d0@mail.gmail.com>
	<18020.13934.289824.556395@lxh5.stat.uni-muenchen.de>
	<m2zm3f3b4i.fsf@ziti.local>
	<eb555e660706041125n57bb6e6dq9b251975c5f7e7de@mail.gmail.com>
	<46645F83.7000007@fhcrc.org>
	<18021.4759.632558.266252@lxh5.stat.uni-muenchen.de>
Message-ID: <eb555e660706051212q197cbaadre449d45192cda1fd@mail.gmail.com>

On 6/5/07, Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> wrote:
> >>>>> On Mon, 04 Jun 2007 11:52:51 -0700,
> >>>>> Robert Gentleman (RG) wrote:
>
>   > Deepayan Sarkar wrote:
>   >> On 6/4/07, Seth Falcon <sfalcon at fhcrc.org> wrote:
>   >>> Friedrich Leisch <friedrich.leisch at stat.uni-muenchen.de> writes:
>   >>>> Looks good to me, and certainly something worth being added to R.
>   >>>>
>   >>>> 2 quick (related) comments:
>   >>>>
>   >>>> 1) I am not sure if we want to include links to the Latex-Sources by
>   >>>> default, those might confuse unsuspecting novices a lot. Perhaps
>   >>>> make those optional using an argument to browseVignettes(), which
>   >>>> is FALSE by default?
>   >>> I agree that the Rnw could confuse folks.  But I'm not sure it needs
>   >>> to be hidden or turned off by default...  If the .R file was also
>   >>> included then it would be less confusing I suspect as the curious
>   >>> could deduce what Rnw is about by triangulation.
>   >>>
>   >>>> 2) Instead links to .Rnw files we may want to include links to the R
>   >>>> code -> should we R CMD INSTALL a tangled version of each vignette
>   >>>> such that we can link to it? Of course it is redundant information
>   >>>> given the .Rnw, but we also have the help pages in several formats
>   >>>> ready.
>   >>> Including, by default, links to the tangled .R code seems like a
>   >>> really nice idea.  I think a lot of users who find vignettes don't
>   >>> realize that all of the code used to generate the entire document is
>   >>> available to them -- I just had a question from someone who wanted to
>   >>> know how to make a plot that appeared in a vignette, for example.
>   >>
>   >> I agree that having a Stangled .R file would be a great idea (among
>   >> other things, it would have the complete code, which many PDFs will
>   >> not).
>   >>
>   >> I don't have a strong opinion either way about linking to the .Rnw
>   >> file. It should definitely be there if the PDF file is absent (e.g.
>   >> for grid, and other packages installed with --no-vignettes, which I
>   >> always do for local installation). Maybe we can keep them, but change
>   >> the name to something more scary than "source", e.g. "LaTeX/Noweb
>   >> source".
>
>   >    I would very much prefer to keep the source, with some name, scary or
>   > not...
>
> I have no strong opinion eitehr way, just "source" may have a lot of
> people belive that is R code -> whatever "scary" name is chosen sounds
> good to me.
>
> I'll have a shot at installing the tangled code later this week (there
> is a holiday coming up on Thursday).

Great. Assuming that this will involve .../Meta/vignette.rds getting a
new column similar to "PDF", the code changes in browseVignette()
should be minimal. I'll work on a .Rd file.

-Deepayan


From hpages at fhcrc.org  Wed Jun  6 00:45:00 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Tue, 05 Jun 2007 15:45:00 -0700
Subject: [Rd] 'R CMD INSTALL mypkg' doesn't always update help pages
Message-ID: <4665E76C.3050708@fhcrc.org>

Hi,

'R CMD INSTALL mypkg' and 'install.packages(mypkg, repos=NULL)' don't
update mypkg help pages when mypkg is a source directory. They only
install new help pages if there are some but they leave the already
installed pages untouched. So you end up with mixed man pages from
different versions of the package :-/

I found no mention of this in 'R CMD INSTALL --help' or in
'?install.packages' so it looks like a bug (or at least an
undocumented feature). Isn't it something that the user should be
able to control via the --no-docs option?

This problem can be worked around by first building the source
package with 'R CMD build mypkg' but...

Cheers,
H.


From jarioksa at sun3.oulu.fi  Wed Jun  6 05:57:19 2007
From: jarioksa at sun3.oulu.fi (Jari Oksanen)
Date: Wed, 06 Jun 2007 06:57:19 +0300
Subject: [Rd] 'R CMD INSTALL mypkg' doesn't always update help pages
In-Reply-To: <4665E76C.3050708@fhcrc.org>
References: <4665E76C.3050708@fhcrc.org>
Message-ID: <4881548c03567a4a615cdc0f9d3b633e@sun3.oulu.fi>


On 6 Jun 2007, at 01:45, Herve Pages wrote:

> Hi,
>
> 'R CMD INSTALL mypkg' and 'install.packages(mypkg, repos=NULL)' don't
> update mypkg help pages when mypkg is a source directory. They only
> install new help pages if there are some but they leave the already
> installed pages untouched. So you end up with mixed man pages from
> different versions of the package :-/
>
I have observed this, too.

cheers, Jari Oksanen


From sfalcon at fhcrc.org  Wed Jun  6 06:23:40 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 05 Jun 2007 21:23:40 -0700
Subject: [Rd] missing IntegerFromString()
In-Reply-To: <6BA3828721B5434DAAE1E65C25715A6E1ABAA0@dph002.hpi-mcw.lan>
	(Aniko Szabo's message of "Mon, 4 Jun 2007 14:54:04 -0500")
References: <6BA3828721B5434DAAE1E65C25715A6E1ABAA0@dph002.hpi-mcw.lan>
Message-ID: <m2tztlpv77.fsf@ziti.local>

Hi Aniko,

"Aniko Szabo" <aszabo at hpi.mcw.edu> writes:

> I have created a DLL not so long ago using C code. My code used the
> IntegerFromString() function that used to be exported in the
> Rinternals.h header file (and thus easily accessible). Recently I
> upgraded to R 2.5.0 and my DLL stopped working. I see that the
> IntegerFromString() function is not exported in any of the header files
> in the RHOME\include directory. Is it possible for me to use it without
> installing all R source files? I can see that the function is in
> coerce.c, however it #includes other stuff that I don't have and I am
> afraid to mess things about by doing things I don't understand. Or
> perhaps there is another function that is intended to be used
> instead?

I think you want asInteger (which calls IntegerFromString).  This is
in RHOME/include/Rinternals.h

Best Wishes,

+ seth

PS: Nice to see you again :-)


-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From jhallman at frb.gov  Tue Jun  5 17:37:17 2007
From: jhallman at frb.gov (jhallman at frb.gov)
Date: Tue, 05 Jun 2007 11:37:17 -0400
Subject: [Rd] Can configure.ac detect 64 bit R?
Message-ID: <20070605153717.DB5991F781@mail.rsma.frb.gov>

My fame package has to link to the libchli.so that comes with FAME.
However, FAME is now supplying both 32 and 64 bit versions of the
library. The 32-bit version is $FAME/hli/libchli.so while the 64-bit
version is $FAME/hli/64/libchli.so.  To set the right flags, it seems
that I need to know, from within configure.ac, whether the R
installation is 32 bit or 64 bit.  Is there a way to detect this?

Jeff


From ripley at stats.ox.ac.uk  Wed Jun  6 15:05:25 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 6 Jun 2007 14:05:25 +0100 (BST)
Subject: [Rd] Can configure.ac detect 64 bit R?
In-Reply-To: <20070605153717.DB5991F781@mail.rsma.frb.gov>
References: <20070605153717.DB5991F781@mail.rsma.frb.gov>
Message-ID: <Pine.LNX.4.64.0706061345050.24008@gannet.stats.ox.ac.uk>

On Tue, 5 Jun 2007, jhallman at frb.gov wrote:

> My fame package has to link to the libchli.so that comes with FAME.
> However, FAME is now supplying both 32 and 64 bit versions of the
> library. The 32-bit version is $FAME/hli/libchli.so while the 64-bit
> version is $FAME/hli/64/libchli.so.  To set the right flags, it seems
> that I need to know, from within configure.ac, whether the R
> installation is 32 bit or 64 bit.  Is there a way to detect this?

That sort of differentiation is highly OS-specific.  If FAME is indeed 
doing this on all OSes it will cause considerable confusion.  It is more 
normal to have the 'standard' version in .../lib and the others in 
.../lib/32 or .../lib/sparcv9, or to use lib and lib64 or ....

And I will assume from now on that you mean a Unix-alike.

Next, on any decent OS you don't need to know, as it will choose the 
appropriate DSO from those it can find of that name.  So just having
-L$FAME/hli/64 -L$FAME/hli should suffice.

However, if despite all that you want to know, yes of course configure.ac 
can detect it. Several possibilities include:

-  Ensure that you can compiling in exactly the same way as R way built, 
and test a C program outputting sizeof(void *) == 8.

-  ${R_HOME}/bin/Rscript -e 'cat(.Machine$sizeof.pointer)'
gives the pointer size in bytes.

- file ${R_HOME}/bin/exec/${r_arch}R will have '64-bit' in on a 64-bit 
build on all OSes I know of.

Of these the second is most direct (and the slowest and needs R >= 2.5.0).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From marc_schwartz at comcast.net  Wed Jun  6 18:37:31 2007
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Wed, 06 Jun 2007 11:37:31 -0500
Subject: [Rd] Quick notes on R with F7
Message-ID: <1181147851.4447.46.camel@Bellerophon>

Hi all,

Just a quick heads up that I made the plunge into F7 this week.

R version 2.5.0 Patched (2007-06-05 r41831) compiles and passes make
check-all.  F7 is using:

[marcs at Bellerophon ~]$ gcc --version
gcc (GCC) 4.1.2 20070502 (Red Hat 4.1.2-12)


Some quick F7 notes:

1. Do a clean install rather than an 'in place' upgrade from FC6 or a
prior version. There are a lot of changes, not the least of which is the
consolidation of Extras and Core into a single release.

2. There will be some '.fc6' suffixed RPMS installed if there were no
changes from the FC6 versions. I have 91 of them, out of a total of 1545
installed RPMS.  Note that the F7 version RPM suffix is 'fc7', not
'f7' ...

3. There are some issues with SELinux and policies, so I have reverted
to running in 'Permissive' mode for the time being.

4. Do not use 'rhgb' (the Red Hat Graphical Boot) on the kernel boot
parameters in grub.conf. Especially if (like me) there are boot time
prompts (such as dmcrypt-LUKS passphrases) that need to be input during
boot. This interaction requires going from graphical to text mode and
back, presumably switching virtual terminals. This may be unique to
nVidia based video hardware, but there seems to be some issues with VT
switching, which also seems to cause problems for the 'Fast User
Switching' features new to F7. The symptoms include partially drawn
windows, incomplete logins and X freezes.

5. Emacs 22 has been released and is part of F7. From a quick look, it
would appear that the 'xft/anti-aliasing' font support available from
the CVS branch of 22 is not part of the formal stable release tree. Thus
I will continue to use the version 23 Unicode branch from CVS, along
with the latest ECB (cvs snap) and CEDET (1.0pre4 was just released
today) tool versions.

6. The rumors/intentions of TeXLive being part of F7 were premature and
teTeX is still in place. This is apparently due to the decision on the
part of the Fedora leadership folks that TeXLive is not yet ready for
prime time.


Other than that, things seem to be well, but I suspect that there will
be many updates coming in the first 30 days or so...the Fedora lists
have been quite busy...

HTH,

Marc Schwartz


From ripley at stats.ox.ac.uk  Wed Jun  6 18:58:29 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 6 Jun 2007 17:58:29 +0100 (BST)
Subject: [Rd] Quick notes on R with F7
In-Reply-To: <1181147851.4447.46.camel@Bellerophon>
References: <1181147851.4447.46.camel@Bellerophon>
Message-ID: <Pine.LNX.4.64.0706061751210.7483@gannet.stats.ox.ac.uk>

Marc,

Thanks for the report.  We had noted the release date for F7 as one of the 
milestones to take account of in scheduling 2.5.1, and thought we might 
just know an early adopter.  Unfortunately the other milestone (the 
release of gcc 4.2.0 for MinGW has not happened on the promised date, June 
1, AFAICS).

[Before anyone asks, 2.5.1 is not yet scheduled.]

Brian

On Wed, 6 Jun 2007, Marc Schwartz wrote:

> Hi all,
>
> Just a quick heads up that I made the plunge into F7 this week.
>
> R version 2.5.0 Patched (2007-06-05 r41831) compiles and passes make
> check-all.  F7 is using:
>
> [marcs at Bellerophon ~]$ gcc --version
> gcc (GCC) 4.1.2 20070502 (Red Hat 4.1.2-12)
>
>
> Some quick F7 notes:
>
> 1. Do a clean install rather than an 'in place' upgrade from FC6 or a
> prior version. There are a lot of changes, not the least of which is the
> consolidation of Extras and Core into a single release.
>
> 2. There will be some '.fc6' suffixed RPMS installed if there were no
> changes from the FC6 versions. I have 91 of them, out of a total of 1545
> installed RPMS.  Note that the F7 version RPM suffix is 'fc7', not
> 'f7' ...
>
> 3. There are some issues with SELinux and policies, so I have reverted
> to running in 'Permissive' mode for the time being.
>
> 4. Do not use 'rhgb' (the Red Hat Graphical Boot) on the kernel boot
> parameters in grub.conf. Especially if (like me) there are boot time
> prompts (such as dmcrypt-LUKS passphrases) that need to be input during
> boot. This interaction requires going from graphical to text mode and
> back, presumably switching virtual terminals. This may be unique to
> nVidia based video hardware, but there seems to be some issues with VT
> switching, which also seems to cause problems for the 'Fast User
> Switching' features new to F7. The symptoms include partially drawn
> windows, incomplete logins and X freezes.
>
> 5. Emacs 22 has been released and is part of F7. From a quick look, it
> would appear that the 'xft/anti-aliasing' font support available from
> the CVS branch of 22 is not part of the formal stable release tree. Thus
> I will continue to use the version 23 Unicode branch from CVS, along
> with the latest ECB (cvs snap) and CEDET (1.0pre4 was just released
> today) tool versions.
>
> 6. The rumors/intentions of TeXLive being part of F7 were premature and
> teTeX is still in place. This is apparently due to the decision on the
> part of the Fedora leadership folks that TeXLive is not yet ready for
> prime time.
>
>
> Other than that, things seem to be well, but I suspect that there will
> be many updates coming in the first 30 days or so...the Fedora lists
> have been quite busy...
>
> HTH,
>
> Marc Schwartz
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From vincent.goulet at act.ulaval.ca  Wed Jun  6 19:17:25 2007
From: vincent.goulet at act.ulaval.ca (Vincent Goulet)
Date: Wed, 6 Jun 2007 13:17:25 -0400
Subject: [Rd] C function with unknown output length
Message-ID: <3BAA52D0-FF46-4130-B337-FD95BCA21316@act.ulaval.ca>

Hi all,

Could anyone point me to one or more examples in the R sources of a C  
function that is called without knowing in advance what will be the  
length (say) of the output vector?

To make myself clearer, we have a C function that computes  
probabilities until their sum gets "close enough" to 1. Hence, the  
number of probabilities is not known in advance.

I would like to have an idea what is the best way to handle this  
situation in R.

Thanks in advance!

---
   Vincent Goulet, Associate Professor
   ?cole d'actuariat
   Universit? Laval, Qu?bec
   Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca


From edd at debian.org  Wed Jun  6 20:19:58 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 6 Jun 2007 13:19:58 -0500
Subject: [Rd] C function with unknown output length
In-Reply-To: <3BAA52D0-FF46-4130-B337-FD95BCA21316@act.ulaval.ca>
References: <3BAA52D0-FF46-4130-B337-FD95BCA21316@act.ulaval.ca>
Message-ID: <18022.64206.740661.986749@basebud.nulle.part>


Salut Vincent,

On 6 June 2007 at 13:17, Vincent Goulet wrote:
| Could anyone point me to one or more examples in the R sources of a C  
| function that is called without knowing in advance what will be the  
| length (say) of the output vector?
| 
| To make myself clearer, we have a C function that computes  
| probabilities until their sum gets "close enough" to 1. Hence, the  
| number of probabilities is not known in advance.
| 
| I would like to have an idea what is the best way to handle this  
| situation in R.

I haven't been on the 'Dirk tells everybody to use RcppTemplate' soapbox
lately, so let me (drumroll) suggest to use RcppTemplate.  

So if you were to consider C++, which can be done incrementally relative to
C, then you could collect your data in a self-growing, autonagically
managemed STL Vector, pass it to RcppTemplate, and you're done.  I have a
local .deb package for r-cran-rcpptemplate I can send you (and which I should
upload to Debian), or you can just use it from source on CRAN.  You want the
source for the examples anyway.

If C++ is not an option, then I typically just hunt for decent examples that
do similar stuff.  BDR's RODBC is usually a good source -- he also does not
know ex ante how long the return sets are.  It's not _that_ hard, just
tedious.  You examine the length of your vector, assign a new one for results
of that length, and copy elements.  

As an example, see the following from my rdieharder package (that is pending
an upload to CRAN) where C as opposed to C++ was a given constraint. I wrote
this in a hurry and I may well have missed something to make it a tad better
-- but as indicated above, I'd rather be doing it in C++ anyway.  

In the code, element [1] is a vector of possibly varying size:

  /* vector of size three: [0] is scalar ks_pv, [1] is pvalues vec, [2] name */
  PROTECT(result = allocVector(VECSXP, 3)); 
  /* alloc scalar, and set it */
  PROTECT(pv = allocVector(REALSXP, 1));
  REAL(pv)[0] = testptr->ks_pvalue;
  /* vector and set it */
  PROTECT(vec = allocVector(REALSXP, testptr->psamples)); 
  for (i = 0; i < testptr->psamples; i++) {
    REAL(vec)[i] = testptr->pvalues[i];
  }
  PROTECT(name = allocVector(STRSXP, 1));
  SET_STRING_ELT(name, 0, mkChar(dtestptr->name));

  /* insert scalar and vector */
  SET_VECTOR_ELT(result, 0, pv);
  SET_VECTOR_ELT(result, 1, vec);
  SET_VECTOR_ELT(result, 2, name);
  
  UNPROTECT(4);
  return result;

and testptr->psamples has the unknonw 'N' of vector length.

And yes, we need better cookbook examples for all this.

Hth, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From gavin.simpson at ucl.ac.uk  Wed Jun  6 20:30:34 2007
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 06 Jun 2007 19:30:34 +0100
Subject: [Rd] Quick notes on R with F7
In-Reply-To: <Pine.LNX.4.64.0706061751210.7483@gannet.stats.ox.ac.uk>
References: <1181147851.4447.46.camel@Bellerophon>
	<Pine.LNX.4.64.0706061751210.7483@gannet.stats.ox.ac.uk>
Message-ID: <1181154634.15102.96.camel@gsimpson.geog.ucl.ac.uk>

On Wed, 2007-06-06 at 17:58 +0100, Prof Brian Ripley wrote:
> Marc,
> 
> Thanks for the report.  We had noted the release date for F7 as one of the 
> milestones to take account of in scheduling 2.5.1, and thought we might 
> just know an early adopter.  Unfortunately the other milestone (the 
> release of gcc 4.2.0 for MinGW has not happened on the promised date, June 
> 1, AFAICS).
> 
> [Before anyone asks, 2.5.1 is not yet scheduled.]
> 
> Brian

In case it is of any additional use, over and above Marc's post, I
installed F7 on my laptop at the weekend, and built R2.5.0-patched
(version as of sometime on Saturday afternoon - sorry my laptop is at
home and I'm still at work). Passed make check-all for me as well. All
seems to be well with R and F7 thus far.

G

> 
> On Wed, 6 Jun 2007, Marc Schwartz wrote:
> 
> > Hi all,
> >
> > Just a quick heads up that I made the plunge into F7 this week.
> >
> > R version 2.5.0 Patched (2007-06-05 r41831) compiles and passes make
> > check-all.  F7 is using:
> >
> > [marcs at Bellerophon ~]$ gcc --version
> > gcc (GCC) 4.1.2 20070502 (Red Hat 4.1.2-12)
> >
> >
> > Some quick F7 notes:
> >
> > 1. Do a clean install rather than an 'in place' upgrade from FC6 or a
> > prior version. There are a lot of changes, not the least of which is the
> > consolidation of Extras and Core into a single release.
> >
> > 2. There will be some '.fc6' suffixed RPMS installed if there were no
> > changes from the FC6 versions. I have 91 of them, out of a total of 1545
> > installed RPMS.  Note that the F7 version RPM suffix is 'fc7', not
> > 'f7' ...
> >
> > 3. There are some issues with SELinux and policies, so I have reverted
> > to running in 'Permissive' mode for the time being.
> >
> > 4. Do not use 'rhgb' (the Red Hat Graphical Boot) on the kernel boot
> > parameters in grub.conf. Especially if (like me) there are boot time
> > prompts (such as dmcrypt-LUKS passphrases) that need to be input during
> > boot. This interaction requires going from graphical to text mode and
> > back, presumably switching virtual terminals. This may be unique to
> > nVidia based video hardware, but there seems to be some issues with VT
> > switching, which also seems to cause problems for the 'Fast User
> > Switching' features new to F7. The symptoms include partially drawn
> > windows, incomplete logins and X freezes.
> >
> > 5. Emacs 22 has been released and is part of F7. From a quick look, it
> > would appear that the 'xft/anti-aliasing' font support available from
> > the CVS branch of 22 is not part of the formal stable release tree. Thus
> > I will continue to use the version 23 Unicode branch from CVS, along
> > with the latest ECB (cvs snap) and CEDET (1.0pre4 was just released
> > today) tool versions.
> >
> > 6. The rumors/intentions of TeXLive being part of F7 were premature and
> > teTeX is still in place. This is apparently due to the decision on the
> > part of the Fedora leadership folks that TeXLive is not yet ready for
> > prime time.
> >
> >
> > Other than that, things seem to be well, but I suspect that there will
> > be many updates coming in the first 30 days or so...the Fedora lists
> > have been quite busy...
> >
> > HTH,
> >
> > Marc Schwartz
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From hpages at fhcrc.org  Wed Jun  6 21:20:31 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 06 Jun 2007 12:20:31 -0700
Subject: [Rd] C function with unknown output length
In-Reply-To: <3BAA52D0-FF46-4130-B337-FD95BCA21316@act.ulaval.ca>
References: <3BAA52D0-FF46-4130-B337-FD95BCA21316@act.ulaval.ca>
Message-ID: <466708FF.9010805@fhcrc.org>

Vincent Goulet wrote:
> Hi all,
> 
> Could anyone point me to one or more examples in the R sources of a C  
> function that is called without knowing in advance what will be the  
> length (say) of the output vector?
> 
> To make myself clearer, we have a C function that computes  
> probabilities until their sum gets "close enough" to 1. Hence, the  
> number of probabilities is not known in advance.
> 

Hi Vincent,

Let's say you want to write a function get_matches(const char * pattern, const char * x)
that will find all the occurrences of string 'pattern' in string 'x' and "return"
their positions in the form of an array of integers.
Of course you don't know in advance how many occurrences you're going to find.

One possible strategy is to:

  - Add an extra arg to 'get_matches' for storing the positions and make
    'get_matches' return the number of matches (i.e. the length of *pos):

      int get_matches(int **pos_ptr, const char * pattern, const char * x)

    Note that pos_ptr is a pointer to an int pointer.

  - In get_matches(): use a local array of ints and start with an arbitrary
    initial size for it:

      int get_matches(...)
      {
        int *tmp_pos, tmp_size, npos = 0;

        tmp_size = some initial guess of the number of matches
        tmp_pos = (int *) S_alloc((long) tmp_size, sizeof(int));
        ...

    Then start searching for matches and every time you find one, store its
    position in tmp_pos[npos] and increase npos.
    When tmp_pos is full (npos == tmp_size), realloc with:

        ...
        old_size = tmp_size;
        tmp_size = 2 * old_size; /* there are many different strategies for this */
        tmp_pos = (int *) S_realloc((char *) tmp_pos, (long) tmp_size,
                                    (long) old_tmp_size, sizeof(int));
        ...

    Note that there is no need to check that the call to S_alloc() or S_realloc()
    were successful because these functions will raise an error and end the call
    to .Call if they fail. In this case they will free the memory currently allocated
    (and so will do on any error or user interrupt).

    When you are done, just return with:

        ...
        *pos_ptr = tmp_pos;
        return npos;
      }

  - Call get_matches with:

      int *pos, npos;

      npos = get_matches(&pos, pattern, x);

    Note that memory allocation took place in 'get_matches' but now you need
    to decide how and when the memory pointed by 'pos' will be freed.
    In the R environment, this can be addressed by using exclusively transient
    storage allocation (http://cran.r-project.org/doc/manuals/R-exts.html#Transient)
    as we did in get_matches() so the allocated memory will be automatically
    reclaimed at the end of the call to .C or .Call.
    Of course, the integers stored in pos have to be moved to a "safe" place
    before .Call returns. Typically this will be done with something like:

      SEXP Call_get_matches(...)
      {
        ...
        npos = get_matches(&pos, pattern, x);
        PROTECT(pos_sxp = NEW_INTEGER(npos));
        memcpy(INTEGER(pos_sxp), pos, npos * sizeof(int));
        UNPROTECT(1);
        return pos_sxp; /* end of call to .Call */
      }

There are many variations around this. One of them is to "share" pos and npos between
get_matches and its caller by making them global variables (in this case it is
recommended to use 'static' in their declarations but this requires that get_matches
and its caller are in the same .c file).

Hope this helps.

H.

> I would like to have an idea what is the best way to handle this  
> situation in R.
> 
> Thanks in advance!
> 
> ---
>    Vincent Goulet, Associate Professor
>    ?cole d'actuariat
>    Universit? Laval, Qu?bec
>    Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hin-tak.leung at cimr.cam.ac.uk  Wed Jun  6 22:09:24 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 06 Jun 2007 21:09:24 +0100
Subject: [Rd] Quick notes on R with F7
In-Reply-To: <Pine.LNX.4.64.0706061751210.7483@gannet.stats.ox.ac.uk>
References: <1181147851.4447.46.camel@Bellerophon>
	<Pine.LNX.4.64.0706061751210.7483@gannet.stats.ox.ac.uk>
Message-ID: <46671474.4000307@cimr.cam.ac.uk>

FWIW, I did an in-place upgrade via Yum
(http://fedoraproject.org/wiki/YumUpgradeFaq) and it is viable -
in fact I did the upgrade+reboot remotely; R and mingw-cross both
seem to survive the upgrade.
$ rpm -qa |wc -l
2050
$ rpm -qa |grep 'fc6' |wc -l
149
$ rpm -qa |grep 'fc7' |wc -l
1295

Before upgrade I had 1984 rpm's.

One strangeness I noticed about emacs is that it stays at the splash 
screen and doesn't display the specified file to be edited until control-L.

HTL

Prof Brian Ripley wrote:
> Marc,
> 
> Thanks for the report.  We had noted the release date for F7 as one of the 
> milestones to take account of in scheduling 2.5.1, and thought we might 
> just know an early adopter.  Unfortunately the other milestone (the 
> release of gcc 4.2.0 for MinGW has not happened on the promised date, June 
> 1, AFAICS).
> 
> [Before anyone asks, 2.5.1 is not yet scheduled.]
> 
> Brian
> 
> On Wed, 6 Jun 2007, Marc Schwartz wrote:
> 
>> Hi all,
>>
>> Just a quick heads up that I made the plunge into F7 this week.
>>
>> R version 2.5.0 Patched (2007-06-05 r41831) compiles and passes make
>> check-all.  F7 is using:
>>
>> [marcs at Bellerophon ~]$ gcc --version
>> gcc (GCC) 4.1.2 20070502 (Red Hat 4.1.2-12)
>>
>>
>> Some quick F7 notes:
>>
>> 1. Do a clean install rather than an 'in place' upgrade from FC6 or a
>> prior version. There are a lot of changes, not the least of which is the
>> consolidation of Extras and Core into a single release.
>>
>> 2. There will be some '.fc6' suffixed RPMS installed if there were no
>> changes from the FC6 versions. I have 91 of them, out of a total of 1545
>> installed RPMS.  Note that the F7 version RPM suffix is 'fc7', not
>> 'f7' ...
>>
>> 3. There are some issues with SELinux and policies, so I have reverted
>> to running in 'Permissive' mode for the time being.
>>
>> 4. Do not use 'rhgb' (the Red Hat Graphical Boot) on the kernel boot
>> parameters in grub.conf. Especially if (like me) there are boot time
>> prompts (such as dmcrypt-LUKS passphrases) that need to be input during
>> boot. This interaction requires going from graphical to text mode and
>> back, presumably switching virtual terminals. This may be unique to
>> nVidia based video hardware, but there seems to be some issues with VT
>> switching, which also seems to cause problems for the 'Fast User
>> Switching' features new to F7. The symptoms include partially drawn
>> windows, incomplete logins and X freezes.
>>
>> 5. Emacs 22 has been released and is part of F7. From a quick look, it
>> would appear that the 'xft/anti-aliasing' font support available from
>> the CVS branch of 22 is not part of the formal stable release tree. Thus
>> I will continue to use the version 23 Unicode branch from CVS, along
>> with the latest ECB (cvs snap) and CEDET (1.0pre4 was just released
>> today) tool versions.
>>
>> 6. The rumors/intentions of TeXLive being part of F7 were premature and
>> teTeX is still in place. This is apparently due to the decision on the
>> part of the Fedora leadership folks that TeXLive is not yet ready for
>> prime time.
>>
>>
>> Other than that, things seem to be well, but I suspect that there will
>> be many updates coming in the first 30 days or so...the Fedora lists
>> have been quite busy...
>>
>> HTH,
>>
>> Marc Schwartz
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From bill at insightful.com  Wed Jun  6 23:30:28 2007
From: bill at insightful.com (Bill Dunlap)
Date: Wed, 6 Jun 2007 14:30:28 -0700 (PDT)
Subject: [Rd] C function with unknown output length
In-Reply-To: <3BAA52D0-FF46-4130-B337-FD95BCA21316@act.ulaval.ca>
References: <3BAA52D0-FF46-4130-B337-FD95BCA21316@act.ulaval.ca>
Message-ID: <Pine.GSO.4.56.0706061423360.16082@durian.statsci.com>

On Wed, 6 Jun 2007, Vincent Goulet wrote:

> Could anyone point me to one or more examples in the R sources of a C
> function that is called without knowing in advance what will be the
> length (say) of the output vector?
>
> To make myself clearer, we have a C function that computes
> probabilities until their sum gets "close enough" to 1. Hence, the
> number of probabilities is not known in advance.
>
> I would like to have an idea what is the best way to handle this
> situation in R.

I think you will want to use the .Call(), not .C(),
interface.  Then you can expand the output vector
as you see fit.  E.g., the following sets the output
vector length to 0 and adds 1 to it each time it
needs to.   This works in both R and Splus 8.0.

In Splus SET_LENGTH(vec, len) reserves some extra
space (above the 'len' requested items) so that
future calls to expand it a bit don't always copy
it.  In R, each call to SET_LENGTH appears to copy
the input vector, so you probably want to add extra
logic to reserve some extra space and finally trim
it down to the precise size you want.

#include <R.h>
#include <Rdefines.h>

/* .Call("unknownReturnLength", 0.02) : return
 * sequence of random uniforms, quitting when
 * you see the first one below 0.02.
 */
SEXP unknownReturnLength(SEXP prob_p)
{
   int retval_length ; /* long preferred in S-PLUS */
   double prob, r ;
   SEXP retval ;
   retval_length = 0 ;
   /* how does PROTECT interact with SET_LENGTH? */
   PROTECT(retval = NEW_NUMERIC(retval_length)) ;
   prob = asReal(prob_p);
   GetRNGstate();
   while((r=unif_rand()) >= prob) {
      double *oldptr = NUMERIC_POINTER(retval) ;
      retval_length++ ;
      SET_LENGTH(retval, retval_length) ;
      if (oldptr != NUMERIC_POINTER(retval))
        Rprintf("expanding retval from %d to %d moved it\n", retval_length-1, retval_length) ;
      NUMERIC_POINTER(retval)[retval_length-1] = r ;
   }
   PutRNGstate();
   return retval ;
}

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From marc_schwartz at comcast.net  Wed Jun  6 23:33:16 2007
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Wed, 06 Jun 2007 16:33:16 -0500
Subject: [Rd] Quick notes on R with F7
In-Reply-To: <46671474.4000307@cimr.cam.ac.uk>
References: <1181147851.4447.46.camel@Bellerophon>
	<Pine.LNX.4.64.0706061751210.7483@gannet.stats.ox.ac.uk>
	<46671474.4000307@cimr.cam.ac.uk>
Message-ID: <1181165596.4263.40.camel@Bellerophon>

I did that from 5 to 6, using the DVD ISO file (mounted as a loopback
device) as a local yum repo. 

It worked quickly, since it was HD to HD. It was hairy however and as
noted in the FAQ, left things to be cleaned up after the upgrade.  I was
less comfortable doing it again from 6 to 7.  Figured that I was
tempting fate...

BTW, on the use of grep below, you don't need to pipe the output to
'wc'. You can use:

[marcs at Bellerophon ~]$ rpm -qa | grep . -c
1546
[marcs at Bellerophon ~]$ rpm -qa | grep fc6 -c
91
[marcs at Bellerophon ~]$ rpm -qa | grep fc7 -c
1115


Also on emacs:

1. If you click on the splash screen with a mouse, it will also clear.
It seems to also eventually clear on it's own after a bit (~30 seconds),
at least in 23.

2. You can append '--no-splash' to the emacs command line to disable it.
See 'emacs --help'.


...And in case anyone is wondering (because somebody asked), yes my
system name is a reference to my all-time favorite 1956 SciFi movie,
"Forbidden Planet"...  :-)

Regards,

Marc


On Wed, 2007-06-06 at 21:09 +0100, Hin-Tak Leung wrote:
> FWIW, I did an in-place upgrade via Yum
> (http://fedoraproject.org/wiki/YumUpgradeFaq) and it is viable -
> in fact I did the upgrade+reboot remotely; R and mingw-cross both
> seem to survive the upgrade.
> $ rpm -qa |wc -l
> 2050
> $ rpm -qa |grep 'fc6' |wc -l
> 149
> $ rpm -qa |grep 'fc7' |wc -l
> 1295
> 
> Before upgrade I had 1984 rpm's.
> 
> One strangeness I noticed about emacs is that it stays at the splash 
> screen and doesn't display the specified file to be edited until control-L.
> 
> HTL
> 
> Prof Brian Ripley wrote:
> > Marc,
> > 
> > Thanks for the report.  We had noted the release date for F7 as one of the 
> > milestones to take account of in scheduling 2.5.1, and thought we might 
> > just know an early adopter.  Unfortunately the other milestone (the 
> > release of gcc 4.2.0 for MinGW has not happened on the promised date, June 
> > 1, AFAICS).
> > 
> > [Before anyone asks, 2.5.1 is not yet scheduled.]
> > 
> > Brian
> > 
> > On Wed, 6 Jun 2007, Marc Schwartz wrote:
> > 
> >> Hi all,
> >>
> >> Just a quick heads up that I made the plunge into F7 this week.
> >>
> >> R version 2.5.0 Patched (2007-06-05 r41831) compiles and passes make
> >> check-all.  F7 is using:
> >>
> >> [marcs at Bellerophon ~]$ gcc --version
> >> gcc (GCC) 4.1.2 20070502 (Red Hat 4.1.2-12)
> >>
> >>
> >> Some quick F7 notes:
> >>
> >> 1. Do a clean install rather than an 'in place' upgrade from FC6 or a
> >> prior version. There are a lot of changes, not the least of which is the
> >> consolidation of Extras and Core into a single release.
> >>
> >> 2. There will be some '.fc6' suffixed RPMS installed if there were no
> >> changes from the FC6 versions. I have 91 of them, out of a total of 1545
> >> installed RPMS.  Note that the F7 version RPM suffix is 'fc7', not
> >> 'f7' ...
> >>
> >> 3. There are some issues with SELinux and policies, so I have reverted
> >> to running in 'Permissive' mode for the time being.
> >>
> >> 4. Do not use 'rhgb' (the Red Hat Graphical Boot) on the kernel boot
> >> parameters in grub.conf. Especially if (like me) there are boot time
> >> prompts (such as dmcrypt-LUKS passphrases) that need to be input during
> >> boot. This interaction requires going from graphical to text mode and
> >> back, presumably switching virtual terminals. This may be unique to
> >> nVidia based video hardware, but there seems to be some issues with VT
> >> switching, which also seems to cause problems for the 'Fast User
> >> Switching' features new to F7. The symptoms include partially drawn
> >> windows, incomplete logins and X freezes.
> >>
> >> 5. Emacs 22 has been released and is part of F7. From a quick look, it
> >> would appear that the 'xft/anti-aliasing' font support available from
> >> the CVS branch of 22 is not part of the formal stable release tree. Thus
> >> I will continue to use the version 23 Unicode branch from CVS, along
> >> with the latest ECB (cvs snap) and CEDET (1.0pre4 was just released
> >> today) tool versions.
> >>
> >> 6. The rumors/intentions of TeXLive being part of F7 were premature and
> >> teTeX is still in place. This is apparently due to the decision on the
> >> part of the Fedora leadership folks that TeXLive is not yet ready for
> >> prime time.
> >>
> >>
> >> Other than that, things seem to be well, but I suspect that there will
> >> be many updates coming in the first 30 days or so...the Fedora lists
> >> have been quite busy...
> >>
> >> HTH,
> >>
> >> Marc Schwartz
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From aszabo at hpi.mcw.edu  Wed Jun  6 16:48:54 2007
From: aszabo at hpi.mcw.edu (Aniko Szabo)
Date: Wed, 6 Jun 2007 09:48:54 -0500
Subject: [Rd] missing IntegerFromString()
In-Reply-To: <m2tztlpv77.fsf@ziti.local>
Message-ID: <6BA3828721B5434DAAE1E65C25715A6E1ABBC8@dph002.hpi-mcw.lan>

Thanks to everybody who responded to my question.
asInteger(coerceVector(x,INTSXP)) indeed does what I need. I guess there
is a lot I don't understand about type coercion, as I would not have
expected it to work.

Aniko

-----Original Message-----
From: Seth Falcon [mailto:sfalcon at fhcrc.org] 
Sent: Tuesday, June 05, 2007 11:24 PM
To: Aniko Szabo
Cc: r-devel at r-project.org
Subject: Re: [Rd] missing IntegerFromString()

Hi Aniko,

"Aniko Szabo" <aszabo at hpi.mcw.edu> writes:

> I have created a DLL not so long ago using C code. My code used the
> IntegerFromString() function that used to be exported in the
> Rinternals.h header file (and thus easily accessible). Recently I
> upgraded to R 2.5.0 and my DLL stopped working. I see that the
> IntegerFromString() function is not exported in any of the header
files
> in the RHOME\include directory. Is it possible for me to use it
without
> installing all R source files? I can see that the function is in
> coerce.c, however it #includes other stuff that I don't have and I am
> afraid to mess things about by doing things I don't understand. Or
> perhaps there is another function that is intended to be used
> instead?

I think you want asInteger (which calls IntegerFromString).  This is
in RHOME/include/Rinternals.h

Best Wishes,

+ seth

PS: Nice to see you again :-)


-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research
Center
http://bioconductor.org


From bates at stat.wisc.edu  Thu Jun  7 17:33:16 2007
From: bates at stat.wisc.edu (Douglas Bates)
Date: Thu, 7 Jun 2007 10:33:16 -0500
Subject: [Rd] missing IntegerFromString()
In-Reply-To: <6BA3828721B5434DAAE1E65C25715A6E1ABBC8@dph002.hpi-mcw.lan>
References: <m2tztlpv77.fsf@ziti.local>
	<6BA3828721B5434DAAE1E65C25715A6E1ABBC8@dph002.hpi-mcw.lan>
Message-ID: <40e66e0b0706070833k3d8e2afk7dc1a09088351d2a@mail.gmail.com>

On 6/6/07, Aniko Szabo <aszabo at hpi.mcw.edu> wrote:
> Thanks to everybody who responded to my question.
> asInteger(coerceVector(x,INTSXP)) indeed does what I need. I guess there
> is a lot I don't understand about type coercion, as I would not have
> expected it to work.

It is better to use

asInteger(x)

which will do the coercion if necessary.  When you do the coercion
yourself you should PROTECT the result then UNPROTECT it.  Calling
asInteger directly avoids this overhead without the risk of losing
data in a garbage collection.  asInteger can accomplish this because
only the first element of the SEXP x is converted to an integer.

>
> Aniko
>
> -----Original Message-----
> From: Seth Falcon [mailto:sfalcon at fhcrc.org]
> Sent: Tuesday, June 05, 2007 11:24 PM
> To: Aniko Szabo
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] missing IntegerFromString()
>
> Hi Aniko,
>
> "Aniko Szabo" <aszabo at hpi.mcw.edu> writes:
>
> > I have created a DLL not so long ago using C code. My code used the
> > IntegerFromString() function that used to be exported in the
> > Rinternals.h header file (and thus easily accessible). Recently I
> > upgraded to R 2.5.0 and my DLL stopped working. I see that the
> > IntegerFromString() function is not exported in any of the header
> files
> > in the RHOME\include directory. Is it possible for me to use it
> without
> > installing all R source files? I can see that the function is in
> > coerce.c, however it #includes other stuff that I don't have and I am
> > afraid to mess things about by doing things I don't understand. Or
> > perhaps there is another function that is intended to be used
> > instead?
>
> I think you want asInteger (which calls IntegerFromString).  This is
> in RHOME/include/Rinternals.h
>
> Best Wishes,
>
> + seth
>
> PS: Nice to see you again :-)
>
>
> --
> Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research
> Center
> http://bioconductor.org
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From simon.urbanek at r-project.org  Thu Jun  7 17:57:24 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 7 Jun 2007 11:57:24 -0400
Subject: [Rd] missing IntegerFromString()
In-Reply-To: <40e66e0b0706070833k3d8e2afk7dc1a09088351d2a@mail.gmail.com>
References: <m2tztlpv77.fsf@ziti.local>
	<6BA3828721B5434DAAE1E65C25715A6E1ABBC8@dph002.hpi-mcw.lan>
	<40e66e0b0706070833k3d8e2afk7dc1a09088351d2a@mail.gmail.com>
Message-ID: <FABE3B4B-632F-45FE-A6D4-CCBE8D57245E@r-project.org>


On Jun 7, 2007, at 11:33 AM, Douglas Bates wrote:

> On 6/6/07, Aniko Szabo <aszabo at hpi.mcw.edu> wrote:
>> Thanks to everybody who responded to my question.
>> asInteger(coerceVector(x,INTSXP)) indeed does what I need. I guess  
>> there
>> is a lot I don't understand about type coercion, as I would not have
>> expected it to work.
>
> It is better to use
>
> asInteger(x)
>
> which will do the coercion if necessary.

Unfortunately not if it gets a character vector:

 > .Call("foo","1")
Error: unimplemented type 'character' in 'asInteger'


> When you do the coercion
> yourself you should PROTECT the result then UNPROTECT it.  Calling
> asInteger directly avoids this overhead without the risk of losing
> data in a garbage collection.  asInteger can accomplish this because
> only the first element of the SEXP x is converted to an integer.
>

It could, but doesn't ;). That is what the original IntegerFromString  
did, but now you either have to do that yourself or coerce the whole  
vector (not as efficient but easier to write :P).

Cheers,
Simon


>>
>> Aniko
>>
>> -----Original Message-----
>> From: Seth Falcon [mailto:sfalcon at fhcrc.org]
>> Sent: Tuesday, June 05, 2007 11:24 PM
>> To: Aniko Szabo
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] missing IntegerFromString()
>>
>> Hi Aniko,
>>
>> "Aniko Szabo" <aszabo at hpi.mcw.edu> writes:
>>
>>> I have created a DLL not so long ago using C code. My code used the
>>> IntegerFromString() function that used to be exported in the
>>> Rinternals.h header file (and thus easily accessible). Recently I
>>> upgraded to R 2.5.0 and my DLL stopped working. I see that the
>>> IntegerFromString() function is not exported in any of the header
>> files
>>> in the RHOME\include directory. Is it possible for me to use it
>> without
>>> installing all R source files? I can see that the function is in
>>> coerce.c, however it #includes other stuff that I don't have and  
>>> I am
>>> afraid to mess things about by doing things I don't understand. Or
>>> perhaps there is another function that is intended to be used
>>> instead?
>>
>> I think you want asInteger (which calls IntegerFromString).  This is
>> in RHOME/include/Rinternals.h
>>
>> Best Wishes,
>>
>> + seth
>>
>> PS: Nice to see you again :-)
>>
>>
>> --
>> Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research
>> Center
>> http://bioconductor.org
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ripley at stats.ox.ac.uk  Thu Jun  7 17:59:39 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 7 Jun 2007 16:59:39 +0100 (BST)
Subject: [Rd] missing IntegerFromString()
In-Reply-To: <40e66e0b0706070833k3d8e2afk7dc1a09088351d2a@mail.gmail.com>
References: <m2tztlpv77.fsf@ziti.local>
	<6BA3828721B5434DAAE1E65C25715A6E1ABBC8@dph002.hpi-mcw.lan>
	<40e66e0b0706070833k3d8e2afk7dc1a09088351d2a@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706071651590.21987@gannet.stats.ox.ac.uk>

On Thu, 7 Jun 2007, Douglas Bates wrote:

> On 6/6/07, Aniko Szabo <aszabo at hpi.mcw.edu> wrote:
>> Thanks to everybody who responded to my question.
>> asInteger(coerceVector(x,INTSXP)) indeed does what I need. I guess there
>> is a lot I don't understand about type coercion, as I would not have
>> expected it to work.
>
> It is better to use
>
> asInteger(x)
>
> which will do the coercion if necessary.  When you do the coercion
> yourself you should PROTECT the result then UNPROTECT it.  Calling
> asInteger directly avoids this overhead without the risk of losing
> data in a garbage collection.  asInteger can accomplish this because
> only the first element of the SEXP x is converted to an integer.

I have to say I am puzzled.  IntegerFromString works on a CHARSXP, and 
furthermore does not check its argument (which is one reason why it is no 
longer even exposed).  AFAICS, coerceVector(x,INTSXP) will not accept a 
CHARSXP, but it will accept a STRSXP.  (The same for asInteger.)

So two ways to do this for vector 'x' are

asInteger(x)
INTEGER(coerceVector(x,INTSXP))[0]

provided in the second case you know 'x' has length at least 1.  But the 
first is both safer and more efficient.

If you really have a CHARSXP, then you are not really supposed to work 
with 'bare' CHARSXPs unless you know what you are doing (in which case you 
don't need to ask ...).

>
>>
>> Aniko
>>
>> -----Original Message-----
>> From: Seth Falcon [mailto:sfalcon at fhcrc.org]
>> Sent: Tuesday, June 05, 2007 11:24 PM
>> To: Aniko Szabo
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] missing IntegerFromString()
>>
>> Hi Aniko,
>>
>> "Aniko Szabo" <aszabo at hpi.mcw.edu> writes:
>>
>>> I have created a DLL not so long ago using C code. My code used the
>>> IntegerFromString() function that used to be exported in the
>>> Rinternals.h header file (and thus easily accessible). Recently I
>>> upgraded to R 2.5.0 and my DLL stopped working. I see that the
>>> IntegerFromString() function is not exported in any of the header
>> files
>>> in the RHOME\include directory. Is it possible for me to use it
>> without
>>> installing all R source files? I can see that the function is in
>>> coerce.c, however it #includes other stuff that I don't have and I am
>>> afraid to mess things about by doing things I don't understand. Or
>>> perhaps there is another function that is intended to be used
>>> instead?
>>
>> I think you want asInteger (which calls IntegerFromString).  This is
>> in RHOME/include/Rinternals.h
>>
>> Best Wishes,
>>
>> + seth
>>
>> PS: Nice to see you again :-)
>>
>>
>> --
>> Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research
>> Center
>> http://bioconductor.org
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Jun  7 19:27:22 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 7 Jun 2007 18:27:22 +0100 (BST)
Subject: [Rd] missing IntegerFromString()
In-Reply-To: <Pine.LNX.4.64.0706071651590.21987@gannet.stats.ox.ac.uk>
References: <m2tztlpv77.fsf@ziti.local>
	<6BA3828721B5434DAAE1E65C25715A6E1ABBC8@dph002.hpi-mcw.lan>
	<40e66e0b0706070833k3d8e2afk7dc1a09088351d2a@mail.gmail.com>
	<Pine.LNX.4.64.0706071651590.21987@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0706071824390.23761@gannet.stats.ox.ac.uk>

On Thu, 7 Jun 2007, Prof Brian Ripley wrote:

> On Thu, 7 Jun 2007, Douglas Bates wrote:
>
>> On 6/6/07, Aniko Szabo <aszabo at hpi.mcw.edu> wrote:
>>> Thanks to everybody who responded to my question.
>>> asInteger(coerceVector(x,INTSXP)) indeed does what I need. I guess there
>>> is a lot I don't understand about type coercion, as I would not have
>>> expected it to work.
>>
>> It is better to use
>>
>> asInteger(x)
>>
>> which will do the coercion if necessary.  When you do the coercion
>> yourself you should PROTECT the result then UNPROTECT it.  Calling
>> asInteger directly avoids this overhead without the risk of losing
>> data in a garbage collection.  asInteger can accomplish this because
>> only the first element of the SEXP x is converted to an integer.
>
> I have to say I am puzzled.  IntegerFromString works on a CHARSXP, and
> furthermore does not check its argument (which is one reason why it is no
> longer even exposed).  AFAICS, coerceVector(x,INTSXP) will not accept a
> CHARSXP, but it will accept a STRSXP.  (The same for asInteger.)

I should have added 'The same for asInteger in R-devel'.  I forgot to 
check R 2.5.0 (and suspect others did the same).

> So two ways to do this for vector 'x' are
>
> asInteger(x)
> INTEGER(coerceVector(x,INTSXP))[0]
>
> provided in the second case you know 'x' has length at least 1.  But the
> first is both safer and more efficient.
>
> If you really have a CHARSXP, then you are not really supposed to work
> with 'bare' CHARSXPs unless you know what you are doing (in which case you
> don't need to ask ...).
>
>>
>>>
>>> Aniko
>>>
>>> -----Original Message-----
>>> From: Seth Falcon [mailto:sfalcon at fhcrc.org]
>>> Sent: Tuesday, June 05, 2007 11:24 PM
>>> To: Aniko Szabo
>>> Cc: r-devel at r-project.org
>>> Subject: Re: [Rd] missing IntegerFromString()
>>>
>>> Hi Aniko,
>>>
>>> "Aniko Szabo" <aszabo at hpi.mcw.edu> writes:
>>>
>>>> I have created a DLL not so long ago using C code. My code used the
>>>> IntegerFromString() function that used to be exported in the
>>>> Rinternals.h header file (and thus easily accessible). Recently I
>>>> upgraded to R 2.5.0 and my DLL stopped working. I see that the
>>>> IntegerFromString() function is not exported in any of the header
>>> files
>>>> in the RHOME\include directory. Is it possible for me to use it
>>> without
>>>> installing all R source files? I can see that the function is in
>>>> coerce.c, however it #includes other stuff that I don't have and I am
>>>> afraid to mess things about by doing things I don't understand. Or
>>>> perhaps there is another function that is intended to be used
>>>> instead?
>>>
>>> I think you want asInteger (which calls IntegerFromString).  This is
>>> in RHOME/include/Rinternals.h
>>>
>>> Best Wishes,
>>>
>>> + seth
>>>
>>> PS: Nice to see you again :-)
>>>
>>>
>>> --
>>> Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research
>>> Center
>>> http://bioconductor.org
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From vincent.goulet at act.ulaval.ca  Fri Jun  8 05:27:59 2007
From: vincent.goulet at act.ulaval.ca (Vincent Goulet)
Date: Thu, 7 Jun 2007 23:27:59 -0400
Subject: [Rd] C function with unknown output length
In-Reply-To: <466708FF.9010805@fhcrc.org>
References: <3BAA52D0-FF46-4130-B337-FD95BCA21316@act.ulaval.ca>
	<466708FF.9010805@fhcrc.org>
Message-ID: <A5FA0AF1-CAA4-40DE-8437-80F1C6EA9F27@act.ulaval.ca>

Le 07-06-06 ? 15:20, Herve Pages a ?crit :

> Vincent Goulet wrote:
>> Hi all,
>>
>> Could anyone point me to one or more examples in the R sources of a C
>> function that is called without knowing in advance what will be the
>> length (say) of the output vector?
>>
>> To make myself clearer, we have a C function that computes
>> probabilities until their sum gets "close enough" to 1. Hence, the
>> number of probabilities is not known in advance.
>>
>
> Hi Vincent,
>
> Let's say you want to write a function get_matches(const char *  
> pattern, const char * x)
> that will find all the occurrences of string 'pattern' in string  
> 'x' and "return"
> their positions in the form of an array of integers.
> Of course you don't know in advance how many occurrences you're  
> going to find.
>
> One possible strategy is to:
>
>   - Add an extra arg to 'get_matches' for storing the positions and  
> make
>     'get_matches' return the number of matches (i.e. the length of  
> *pos):
>
>       int get_matches(int **pos_ptr, const char * pattern, const  
> char * x)
>
>     Note that pos_ptr is a pointer to an int pointer.
>
>   - In get_matches(): use a local array of ints and start with an  
> arbitrary
>     initial size for it:
>
>       int get_matches(...)
>       {
>         int *tmp_pos, tmp_size, npos = 0;
>
>         tmp_size = some initial guess of the number of matches
>         tmp_pos = (int *) S_alloc((long) tmp_size, sizeof(int));
>         ...
>
>     Then start searching for matches and every time you find one,  
> store its
>     position in tmp_pos[npos] and increase npos.
>     When tmp_pos is full (npos == tmp_size), realloc with:
>
>         ...
>         old_size = tmp_size;
>         tmp_size = 2 * old_size; /* there are many different  
> strategies for this */
>         tmp_pos = (int *) S_realloc((char *) tmp_pos, (long) tmp_size,
>                                     (long) old_tmp_size, sizeof(int));
>         ...
>
>     Note that there is no need to check that the call to S_alloc()  
> or S_realloc()
>     were successful because these functions will raise an error and  
> end the call
>     to .Call if they fail. In this case they will free the memory  
> currently allocated
>     (and so will do on any error or user interrupt).
>
>     When you are done, just return with:
>
>         ...
>         *pos_ptr = tmp_pos;
>         return npos;
>       }
>
>   - Call get_matches with:
>
>       int *pos, npos;
>
>       npos = get_matches(&pos, pattern, x);
>
>     Note that memory allocation took place in 'get_matches' but now  
> you need
>     to decide how and when the memory pointed by 'pos' will be freed.
>     In the R environment, this can be addressed by using  
> exclusively transient
>     storage allocation (http://cran.r-project.org/doc/manuals/R- 
> exts.html#Transient)
>     as we did in get_matches() so the allocated memory will be  
> automatically
>     reclaimed at the end of the call to .C or .Call.
>     Of course, the integers stored in pos have to be moved to a  
> "safe" place
>     before .Call returns. Typically this will be done with  
> something like:
>
>       SEXP Call_get_matches(...)
>       {
>         ...
>         npos = get_matches(&pos, pattern, x);
>         PROTECT(pos_sxp = NEW_INTEGER(npos));
>         memcpy(INTEGER(pos_sxp), pos, npos * sizeof(int));
>         UNPROTECT(1);
>         return pos_sxp; /* end of call to .Call */
>       }
>
> There are many variations around this. One of them is to "share"  
> pos and npos between
> get_matches and its caller by making them global variables (in this  
> case it is
> recommended to use 'static' in their declarations but this requires  
> that get_matches
> and its caller are in the same .c file).
>
> Hope this helps.

It did, thanks Herve. And thanks also to Dirk and Bill for their  
useful suggestions.

We (actually, my student, but in pure academia style I'll take part  
of the credit ;-) had done something very similar to Herve's  
suggestion, including the "double the size when it's full" strategy,  
but in one function only instead of two. Now I got confirmation it  
was a good way to go. I'm satisfied.

Best,    Vincent

>
> H.
>
>> I would like to have an idea what is the best way to handle this
>> situation in R.
>>
>> Thanks in advance!
>>
>> ---
>>    Vincent Goulet, Associate Professor
>>    ?cole d'actuariat
>>    Universit? Laval, Qu?bec
>>    Vincent.Goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From aszabo at hpi.mcw.edu  Thu Jun  7 21:47:47 2007
From: aszabo at hpi.mcw.edu (Aniko Szabo)
Date: Thu, 7 Jun 2007 14:47:47 -0500
Subject: [Rd] missing IntegerFromString()
In-Reply-To: <Pine.LNX.4.64.0706071849120.23943@gannet.stats.ox.ac.uk>
Message-ID: <6BA3828721B5434DAAE1E65C25715A6E1ABCA5@dph002.hpi-mcw.lan>

I am sorry about the confusion, I was too hasty.
asInteger(coerceVector(x,INTSXP)) does not work after all. Here are more
details of what I am trying to accomplish: I have a matrix with column
names that are actually known to be integers (because I set them so
myself in the R code, say, colnames(mat) <- 1:10. Of course, they become
converted to character strings.)

The relevant part of my code used to be:

SEXP MyFunction(SEXP mat);
	int warn, minY 
	SEXP rl, cl;
	char *rn, *cn;
	GetMatrixDimnames(mat, &rl, &cl, &rn, &cn);
	minY = IntegerFromString(VECTOR_ELT(cl,0), &warn);
	if (warn > 0) error("Names of popmatrix columns are not
integers");

Running some tests it appears that VECTOR_ELT(cl,0) is CHARSXP (which I
wound up using without even knowing it).
I tried replacing the IntegerFromString part with both
asInteger(VECTOR_ELT(cl,0)) and with
asInteger(coerceVector(VECTOR_ELT(cl,0),INTSXP)), but as you surmised,
since VECTOR_ELT(cl,0) is CHARSXP, it does not work.

So, how could I get the actual values in the column names?

Thanks for all your help,
Aniko



-----Original Message-----
From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Sent: Thursday, June 07, 2007 12:51 PM
To: Simon Urbanek
Cc: Douglas Bates; Aniko Szabo
Subject: Re: [Rd] missing IntegerFromString()

On Thu, 7 Jun 2007, Simon Urbanek wrote:

>
> On Jun 7, 2007, at 1:00 PM, Prof Brian Ripley wrote:
>
>> On Thu, 7 Jun 2007, Simon Urbanek wrote:
>> 
>>> 
>>> On Jun 7, 2007, at 11:33 AM, Douglas Bates wrote:
>>> 
>>>> On 6/6/07, Aniko Szabo <aszabo at hpi.mcw.edu> wrote:
>>>>> Thanks to everybody who responded to my question.
>>>>> asInteger(coerceVector(x,INTSXP)) indeed does what I need. I guess
>>>>> there
>>>>> is a lot I don't understand about type coercion, as I would not
have
>>>>> expected it to work.
>>>> 
>>>> It is better to use
>>>> 
>>>> asInteger(x)
>>>> 
>>>> which will do the coercion if necessary.
>>> 
>>> Unfortunately not if it gets a character vector:
>> 
>> Yes, if it gets a character *vector*, no if it gets a CHARSXP.
>> 
>
> Indeed, I was starting with an assumption that the task at hand is to
get the 
> same result as as.integer in R code from a string - mea culpa. I had
the 
> impression that it was likely what Aniko wanted (because anything else
would 
> work with trivial asInteger which I assumed was not enough). Yes, I
made too 
> many unsafe assumptions ;).

You weren't the only one: I think we all are a little confused here ....
The positive outcome is that I will make asInteger work on CHARSXPs as 
well.

Brian

>
> Sorry for the noise,
> Simon
>
>
>>>> .Call("foo","1")
>>> Error: unimplemented type 'character' in 'asInteger'
>>> 
>>> 
>>>> When you do the coercion
>>>> yourself you should PROTECT the result then UNPROTECT it.  Calling
>>>> asInteger directly avoids this overhead without the risk of losing
>>>> data in a garbage collection.  asInteger can accomplish this
because
>>>> only the first element of the SEXP x is converted to an integer.
>>>> 
>>> 
>>> It could, but doesn't ;). That is what the original
IntegerFromString
>>> did, but now you either have to do that yourself or coerce the whole
>>> vector (not as efficient but easier to write :P).
>> 
>> But does coerceVector really handle CHARSXPs?  There are not vectors
and I 
>> don't see it in the code. Consider
>> 
>> #include <Rinternals.h>
>> 
>> SEXP foo(SEXP x)
>> {
>>   return coerceVector(STRING_ELT(x, 0), INTSXP);
>> }
>> 
>> SEXP foo2(SEXP x)
>> {
>>   Rprintf("%d\n", asInteger(STRING_ELT(x, 0)));
>>   return x;
>> }
>> 
>>> .Call("foo","1")
>> Error: cannot coerce type char to integer vector
>>> .Call("foo2","1")
>> -2147483648
>> [1] "1"
>> 
>> (and that is NA_INTEGER).
>> 
>> As I said, if asInteger(coerceVector(x,INTSXP)) works, 'x' is not a 
>> CHARSXP.  So I have little idea what the actual story here is.
>> 
>> Brian
>> 
>> 
>>> Cheers,
>>> Simon
>>> 
>>> 
>>>>> 
>>>>> Aniko
>>>>> 
>>>>> -----Original Message-----
>>>>> From: Seth Falcon [mailto:sfalcon at fhcrc.org]
>>>>> Sent: Tuesday, June 05, 2007 11:24 PM
>>>>> To: Aniko Szabo
>>>>> Cc: r-devel at r-project.org
>>>>> Subject: Re: [Rd] missing IntegerFromString()
>>>>> 
>>>>> Hi Aniko,
>>>>> 
>>>>> "Aniko Szabo" <aszabo at hpi.mcw.edu> writes:
>>>>> 
>>>>>> I have created a DLL not so long ago using C code. My code used
the
>>>>>> IntegerFromString() function that used to be exported in the
>>>>>> Rinternals.h header file (and thus easily accessible). Recently I
>>>>>> upgraded to R 2.5.0 and my DLL stopped working. I see that the
>>>>>> IntegerFromString() function is not exported in any of the header
>>>>> files
>>>>>> in the RHOME\include directory. Is it possible for me to use it
>>>>> without
>>>>>> installing all R source files? I can see that the function is in
>>>>>> coerce.c, however it #includes other stuff that I don't have and
>>>>>> I am
>>>>>> afraid to mess things about by doing things I don't understand.
Or
>>>>>> perhaps there is another function that is intended to be used
>>>>>> instead?
>>>>> 
>>>>> I think you want asInteger (which calls IntegerFromString).  This
is
>>>>> in RHOME/include/Rinternals.h
>>>>> 
>>>>> Best Wishes,
>>>>> 
>>>>> + seth
>>>>> 
>>>>> PS: Nice to see you again :-)
>>>>> 
>>>>> 
>>>>> --
>>>>> Seth Falcon | Computational Biology | Fred Hutchinson Cancer
Research
>>>>> Center
>>>>> http://bioconductor.org
>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> 
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>>> 
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>> -- 
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Jun  8 08:34:00 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 8 Jun 2007 07:34:00 +0100 (BST)
Subject: [Rd] missing IntegerFromString()
In-Reply-To: <6BA3828721B5434DAAE1E65C25715A6E1ABCA5@dph002.hpi-mcw.lan>
References: <6BA3828721B5434DAAE1E65C25715A6E1ABCA5@dph002.hpi-mcw.lan>
Message-ID: <Pine.LNX.4.64.0706080724390.23187@gannet.stats.ox.ac.uk>

On Thu, 7 Jun 2007, Aniko Szabo wrote:

> I am sorry about the confusion, I was too hasty.
> asInteger(coerceVector(x,INTSXP)) does not work after all. Here are more
> details of what I am trying to accomplish: I have a matrix with column
> names that are actually known to be integers (because I set them so
> myself in the R code, say, colnames(mat) <- 1:10. Of course, they become
> converted to character strings.)
>
> The relevant part of my code used to be:
>
> SEXP MyFunction(SEXP mat);
> 	int warn, minY
> 	SEXP rl, cl;
> 	char *rn, *cn;
> 	GetMatrixDimnames(mat, &rl, &cl, &rn, &cn);
> 	minY = IntegerFromString(VECTOR_ELT(cl,0), &warn);
> 	if (warn > 0) error("Names of popmatrix columns are not
> integers");
>
> Running some tests it appears that VECTOR_ELT(cl,0) is CHARSXP (which I
> wound up using without even knowing it).
> I tried replacing the IntegerFromString part with both
> asInteger(VECTOR_ELT(cl,0)) and with
> asInteger(coerceVector(VECTOR_ELT(cl,0),INTSXP)), but as you surmised,
> since VECTOR_ELT(cl,0) is CHARSXP, it does not work.
>
> So, how could I get the actual values in the column names?

 	if(length(cl) > 0)
 	    minY = INTEGER(coerceVector(cl, INTSXP))[0];
 	else minY = NA_INTEGER;

You are assuming that there is at least one dimname, and your code needs 
more careful checks.  cl could be NULL and it could be of length 0.  If 
not NULL it is (currently) guaranteed to be a STRSXP.

In future versions of R 'minY = asInteger(cl)' will be all that is needed.


[Private message posted to the list deleted: you are not allowed to do 
that, as the posting guide points out.  It is a breach of copyright law.]


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Fri Jun  8 08:41:26 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 07 Jun 2007 23:41:26 -0700
Subject: [Rd] missing IntegerFromString()
In-Reply-To: <6BA3828721B5434DAAE1E65C25715A6E1ABCA5@dph002.hpi-mcw.lan>
	(Aniko Szabo's message of "Thu, 7 Jun 2007 14:47:47 -0500")
References: <6BA3828721B5434DAAE1E65C25715A6E1ABCA5@dph002.hpi-mcw.lan>
Message-ID: <m2645z6j8p.fsf@ziti.local>

"Aniko Szabo" <aszabo at hpi.mcw.edu> writes:

> I am sorry about the confusion, I was too hasty.
> asInteger(coerceVector(x,INTSXP)) does not work after all. Here are more
> details of what I am trying to accomplish: I have a matrix with column
> names that are actually known to be integers (because I set them so
> myself in the R code, say, colnames(mat) <- 1:10. Of course, they become
> converted to character strings.)
>
> The relevant part of my code used to be:
>
> SEXP MyFunction(SEXP mat);
> 	int warn, minY 
> 	SEXP rl, cl;
> 	char *rn, *cn;
> 	GetMatrixDimnames(mat, &rl, &cl, &rn, &cn);
> 	minY = IntegerFromString(VECTOR_ELT(cl,0), &warn);
> 	if (warn > 0) error("Names of popmatrix columns are not
> integers");
>
> Running some tests it appears that VECTOR_ELT(cl,0) is CHARSXP (which I
> wound up using without even knowing it).
> I tried replacing the IntegerFromString part with both
> asInteger(VECTOR_ELT(cl,0)) and with
> asInteger(coerceVector(VECTOR_ELT(cl,0),INTSXP)), but as you surmised,
> since VECTOR_ELT(cl,0) is CHARSXP, it does not work.
>
> So, how could I get the actual values in the column names?

How about:

  SEXP colnums;
  int *ivals;
  PROTECT(colnums = coerceVector(cl, INTSXP));
  ivals = INTEGER(colnums);

Here you convert the STRSXP cl into an INTSXP.  If you want the actual
integer values, use the ivals pointer.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From t.marthews at abdn.ac.uk  Fri Jun  8 11:24:04 2007
From: t.marthews at abdn.ac.uk (Marthews, T. R.)
Date: Fri, 8 Jun 2007 10:24:04 +0100
Subject: [Rd] Question about Running C code from R
Message-ID: <E05177CA23A54040A2EBF2A3580126F9D659AA@VMAIL1.uoa.abdn.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070608/1018abaa/attachment.pl 

From software at iangregory.com  Thu Jun  7 04:17:54 2007
From: software at iangregory.com (software at iangregory.com)
Date: Thu,  7 Jun 2007 04:17:54 +0200 (CEST)
Subject: [Rd] Update help file (PR#9724)
Message-ID: <20070607021754.B69F848DE7@slim.kubism.ku.dk>

Full_Name: Ian Gregory
Version: latest
OS: Widnows XP
Submission from: (NULL) (58.110.163.199)


fSeries is a great package keep it up.
Need to update the help page.

Type:    help(garchOxFit)

The line: 
garchOxFit(formula.mean = ~arma(0,0), formula.var = ~garch(1,1))
Should be changed to:
garchOxFit(~garch(1,1),x)

------------------------------------------
eg.
The example in the help page reads:

Examples
## SOURCE("fSeries1.4D-GarchOxModelling")

## Not run: 
## garchOxFit -
   
   # Load Benchmark Data Set:
   data(dem2gbp)
   x = dem2gbp[, 1]
   
   # Fit GARCH(1,1):
   garchOxFit(formula.mean = ~arma(0,0), formula.var = ~garch(1,1))
## End(Not run)


From ripley at stats.ox.ac.uk  Fri Jun  8 14:58:34 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 8 Jun 2007 13:58:34 +0100 (BST)
Subject: [Rd] Question about Running C code from R
In-Reply-To: <E05177CA23A54040A2EBF2A3580126F9D659AA@VMAIL1.uoa.abdn.ac.uk>
References: <E05177CA23A54040A2EBF2A3580126F9D659AA@VMAIL1.uoa.abdn.ac.uk>
Message-ID: <Pine.LNX.4.64.0706081350580.14948@gannet.stats.ox.ac.uk>

Since you are using Borland C++, the examples in the online complement to 
'S Programming' are relevant, as is README.packages.

Basically, you have not managed to export any entry points, and to do so 
you will need to make a DLL and not a .exe.

*However* it is much easier to make use of the MinGW compiler used to make 
R.

You are trying too hard using getNativeSymbolInfo etc, and R CMD INSTALL 
does work under Windows.

I would study 'Writing R Extensions' and 'R Installation and 
Administration Manual', install MinGW and use

R CMD SHLIB

to make a DLL.  It really is a lot easier to follow a well-trodden path
than to create your own.  (In Roger Bivand's analogy: you need stepping 
stones across this morass/mire/bog.)


On Fri, 8 Jun 2007, Marthews, T. R. wrote:

> Dear R-devel,
>
> Apologies for sending what is probably a very simple question to 
> R-devel: I am definitely missing something very simple and can't work 
> out what it is. I've been trying to find the problem here for about a 
> month and need some help!
>
> I am trying to work out how to run a C program from an R script. Rather 
> than try the C program directly, I'm trying to get a much simpler piece 
> of code to work as a proof-of-concept. Here's the C code (simplecall.c):
>
> ***********************************************************************************************
> #include <stdio.h>
> #include <Rinternals.h>
> #include <R_ext/Rdynload.h>
>
> int Rc(int a) {
> return (a+3);
> }
>
> SEXP Rc2(SEXP a) {
> return(18); //LINE A
> // return(ScalarReal(REAL(a)[0]+12)); //LINE B
> }
>
> int main()
> {
> int i,j;
> SEXP m,n;
>
> i=4;j=Rc(i);
> printf("\nUsing Rc: %i+3=%i - OK so far.\n",i,j);
>
> m=6;n=Rc2(m);
> printf("\nUsing Rc2: %i+12=%i - Doing well.\n",m,n);
>
> printf("\nPress <ENTER> ...\n");
> getchar();
> return 0;
> }
> ***********************************************************************************************
>
> and I've compiled this (using the only C compiler I have, which is a 
> Borland C++ Builder which insists on calling the executable 
> "Project.exe"). I managed to get it to compile correctly with the two R 
> includes at the front and the two functions work OK when I run the C 
> executable. What I want to do is access these functions from R, however. 
> Here's the R code I've written (simplecall.r), which I've put together 
> from various websites and guesses:
>
> ***********************************************************************************************
> dll=dyn.load("Project1.exe")
> syms=getNativeSymbolInfo(c("Rc","Rc2"),dll)
>
> RcInR=function(x) {
> .Call(dll$Rc,as.numeric(x))
> }
>
> Rc2InR=function(x) {
> .Call(dll$Rc2,as.numeric(x))
> }
>
> i1=4;j1=Rc(i1)
> cat("\nUsing Rc from R: ",i1,"+3=",j1," - OK so far.\n")
>
> m1=6;n1=Rc2(m1)
> cat("\nUsing Rc2 from R: ",m1,"+12=",n1," - Doing well.\n");
>
> ***********************************************************************************************
>
> Basically, there are two problems (at least!). If I have LINE A in the C 
> code instead of LINE B then it compiles alright, but if I try to run the 
> R script it says:
>
> Error in FUN(c("Rc", "Rc2")[[1]], ...) : no such symbol Rc in package C:/Documents and Settings/Toby/Desktop/cfiles/Project1.exe
>
> I've read a lot online about the "R CMD INSTALL" command and the 
> ?INSTALL man page, but I can't use that command because I've got 
> Windows-R rather than Linux-R (unfortunately). Somehow, R can't 'see' 
> these C functions in the executable, even though I thought including 
> Rinternals.h ensured that it could. Stuck.
>
> Additionally, if I have LINE B instead of LINE A in the C code then it 
> won't compile at all and gives the errors:
>
> [Linker error] Unresolved external '_REAL' referenced from C:\DOCUMENTS AND SETTINGS\TOBY\DESKTOP\CFILES\SIMPLECALL.OBJ
> [Linker error] Unresolved external '_Rf_ScalarReal' referenced from C:\DOCUMENTS AND SETTINGS\TOBY\DESKTOP\CFILES\SIMPLECALL.OBJ
>
> which I find odd because these symbols are defined in the .h files included at the start.
>
> I feel like I'm either a) trying to do this in completely the wrong way or b) suffering from having to use a Windows machine or c) both. I tried setting up a package and inserting the code in the /src directory, but because I can't use the R CMD INSTALL command I can't figure out how to make this idea work either.
>
> Can anyone help me here? Does anyone have an actual example of something like this that works?
>
> Toby Marthews
>
> ?..?????`????..?????`??..?????`?.?????`??..?????`??..?????`?.?
>
> Institut f?r Umweltwissenschaften (IfU, www.uzh.ch/uwinst <http://www.uzh.ch/uwinst> ),
> Universit?t Z?rich, Winterthurerstr. 190, 8057 Z?rich, CH.
>
> Plant & Soil Science Department (www.abdn.ac.uk/biologicalsci/pss <http://www.abdn.ac.uk/biologicalsci/pss> ),
> University of Aberdeen, 23 St Machar Dr., Aberdeen AB24 3UU, UK.
>
> ?`??..?????`?.?????`??..?????`??..?????`?.? ><(((?> ?.???`?..? ><(((?>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From zur at uchicago.edu  Fri Jun  8 15:29:09 2007
From: zur at uchicago.edu (Richard Zur)
Date: Fri, 08 Jun 2007 08:29:09 -0500
Subject: [Rd] R CMD SHLIB error using OS X
Message-ID: <466959A5.9020005@uchicago.edu>

Hello,

I'm using R 2.5.0 with OS X 10.4.9 and Xcode 2.4.1 on a PowerPC.  My 
code used to compile fine with R 2.4.* and Xcode 2.2 (I think).

I'm compiling some C code (named mhroc_prop.c) that calls a fortran 
routine from mvndstpack.f  I get the error

/usr/bin/libtool: file: mvndstpack.o is not an object file (not allowed 
in a library)

after R outputs (sorry... not sure if this is useful information or not)

gcc-4.0 -arch ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -std=gnu99 
-dynamiclib -Wl,-macosx_version_min -Wl,10.3 -undefined dynamic_lookup 
-single_module -multiply_defined suppress -L/usr/local/lib -o 
mhroc_prop.so mhroc_prop.o mvndstpack.o 
-L/Library/Frameworks/R.framework/Resources/lib/ppc -lRlapack 
-L/Library/Frameworks/R.framework/Resources/lib/ppc -lRblas 
-L/usr/local/lib/gcc/powerpc-apple-darwin8/4.2.0 -lgfortran -lgcc_s.10.4 
-lSystemStubs -L/usr/local/lib/gcc/powerpc-apple-darwin8/4.2.0 
-lgfortran -lgcc_s.10.4 -lSystemStubs 
-F/Library/Frameworks/R.framework/.. -framework R

Any ideas?

Thank you,
Richard Zur


From simon.urbanek at r-project.org  Fri Jun  8 18:35:38 2007
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 8 Jun 2007 12:35:38 -0400
Subject: [Rd] R CMD SHLIB error using OS X
In-Reply-To: <466959A5.9020005@uchicago.edu>
References: <466959A5.9020005@uchicago.edu>
Message-ID: <B0986BA7-42D1-4A8F-A2E0-513105A114AC@r-project.org>

Richard,

On Jun 8, 2007, at 9:29 AM, Richard Zur wrote:

> I'm using R 2.5.0 with OS X 10.4.9 and Xcode 2.4.1 on a PowerPC.  My
> code used to compile fine with R 2.4.* and Xcode 2.2 (I think).
>
> I'm compiling some C code (named mhroc_prop.c) that calls a fortran
> routine from mvndstpack.f  I get the error
>
> /usr/bin/libtool: file: mvndstpack.o is not an object file (not  
> allowed
> in a library)
>

The problem is then apparently somewhere earlier - do you have a  
proper Fortran compiler installed? Apparently the fortran object file  
is not created correctly. Please send me the full output (and tell me  
which Fortran you are using and how you installed it).

Cheers,
Simon

PS: I'm moving this to R-SIG-Mac as this is Mac-specific.


> after R outputs (sorry... not sure if this is useful information or  
> not)
>
> gcc-4.0 -arch ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -std=gnu99
> -dynamiclib -Wl,-macosx_version_min -Wl,10.3 -undefined dynamic_lookup
> -single_module -multiply_defined suppress -L/usr/local/lib -o
> mhroc_prop.so mhroc_prop.o mvndstpack.o
> -L/Library/Frameworks/R.framework/Resources/lib/ppc -lRlapack
> -L/Library/Frameworks/R.framework/Resources/lib/ppc -lRblas
> -L/usr/local/lib/gcc/powerpc-apple-darwin8/4.2.0 -lgfortran -lgcc_s. 
> 10.4
> -lSystemStubs -L/usr/local/lib/gcc/powerpc-apple-darwin8/4.2.0
> -lgfortran -lgcc_s.10.4 -lSystemStubs
> -F/Library/Frameworks/R.framework/.. -framework R
>
> Any ideas?
>
> Thank you,
> Richard Zur
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From timb at metrumrg.com  Fri Jun  8 22:01:49 2007
From: timb at metrumrg.com (Tim Bergsma)
Date: Fri, 08 Jun 2007 16:01:49 -0400
Subject: [Rd] suggested package not found
Message-ID: <4669B5AD.2080108@metrumrg.com>

I normally work in Windows, but make my packages under Unix.  My package 
'b' suggests my package 'a'.  R CMD check fails for 'b', even though 'a' 
is installed: "Packages required but not available: b".  What do I have 
to do to make 'a' available, besides R CMD INSTALL 'a'?  I'm not 
spotting the answer in "Writing Extensions...".  Please point me in the 
right direction.

Thanks in advance,

Tim.


From murdoch at stats.uwo.ca  Sat Jun  9 13:18:38 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 09 Jun 2007 07:18:38 -0400
Subject: [Rd] suggested package not found
In-Reply-To: <4669B5AD.2080108@metrumrg.com>
References: <4669B5AD.2080108@metrumrg.com>
Message-ID: <466A8C8E.30105@stats.uwo.ca>

On 08/06/2007 4:01 PM, Tim Bergsma wrote:
> I normally work in Windows, but make my packages under Unix.  My package 
> 'b' suggests my package 'a'.  R CMD check fails for 'b', even though 'a' 
> is installed: "Packages required but not available: b".  What do I have 
> to do to make 'a' available, besides R CMD INSTALL 'a'?  

Is that a typo on line 3?  It seems to be having trouble finding "b", 
not finding "a".

I'm not
> spotting the answer in "Writing Extensions...".  Please point me in the 
> right direction.

Version?

Duncan Murdoch


From timb at metrumrg.com  Sat Jun  9 14:18:41 2007
From: timb at metrumrg.com (Tim Bergsma)
Date: Sat, 09 Jun 2007 08:18:41 -0400
Subject: [Rd] suggested package not found
In-Reply-To: <466A8C8E.30105@stats.uwo.ca>
References: <4669B5AD.2080108@metrumrg.com> <466A8C8E.30105@stats.uwo.ca>
Message-ID: <466A9AA1.3010206@metrumrg.com>

Duncan,

Yes, that was a typo on line three.  Sorry.

$version.string
[1] "Version 2.3.1 (2006-06-01)".

Thanks,

Tim.


Duncan Murdoch wrote:
> On 08/06/2007 4:01 PM, Tim Bergsma wrote:
>> I normally work in Windows, but make my packages under Unix.  My 
>> package 'b' suggests my package 'a'.  R CMD check fails for 'b', even 
>> though 'a' is installed: "Packages required but not available: b".  
>> What do I have to do to make 'a' available, besides R CMD INSTALL 'a'?  
> 
> Is that a typo on line 3?  It seems to be having trouble finding "b", 
> not finding "a".
> 
> I'm not
>> spotting the answer in "Writing Extensions...".  Please point me in 
>> the right direction.
> 
> Version?
> 
> Duncan Murdoch
> 
>


From ripley at stats.ox.ac.uk  Sat Jun  9 15:00:18 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 9 Jun 2007 14:00:18 +0100 (BST)
Subject: [Rd] suggested package not found
In-Reply-To: <466A9AA1.3010206@metrumrg.com>
References: <4669B5AD.2080108@metrumrg.com> <466A8C8E.30105@stats.uwo.ca>
	<466A9AA1.3010206@metrumrg.com>
Message-ID: <Pine.LNX.4.64.0706091358270.12629@gannet.stats.ox.ac.uk>

Where is 'a' installed?

You may need to set R_LIBS: R CMD check is not looking in any of your 
startup files such as ~/.Renviron.

I don't believe this is a Windows/Unix issue, but rather one of the local 
R environment.

On Sat, 9 Jun 2007, Tim Bergsma wrote:

> Duncan,
>
> Yes, that was a typo on line three.  Sorry.
>
> $version.string
> [1] "Version 2.3.1 (2006-06-01)".
>
> Thanks,
>
> Tim.
>
>
> Duncan Murdoch wrote:
>> On 08/06/2007 4:01 PM, Tim Bergsma wrote:
>>> I normally work in Windows, but make my packages under Unix.  My
>>> package 'b' suggests my package 'a'.  R CMD check fails for 'b', even
>>> though 'a' is installed: "Packages required but not available: b".
>>> What do I have to do to make 'a' available, besides R CMD INSTALL 'a'?
>>
>> Is that a typo on line 3?  It seems to be having trouble finding "b",
>> not finding "a".
>>
>> I'm not
>>> spotting the answer in "Writing Extensions...".  Please point me in
>>> the right direction.
>>
>> Version?
>>
>> Duncan Murdoch
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From timb at metrumrg.com  Mon Jun 11 14:33:07 2007
From: timb at metrumrg.com (Tim Bergsma)
Date: Mon, 11 Jun 2007 08:33:07 -0400
Subject: [Rd] suggested package not found
In-Reply-To: <Pine.LNX.4.64.0706091358270.12629@gannet.stats.ox.ac.uk>
References: <4669B5AD.2080108@metrumrg.com> <466A8C8E.30105@stats.uwo.ca>
	<466A9AA1.3010206@metrumrg.com>
	<Pine.LNX.4.64.0706091358270.12629@gannet.stats.ox.ac.uk>
Message-ID: <466D4103.1080303@metrumrg.com>

Prof Brian Ripley wrote:
> Where is 'a' installed?
> 
> You may need to set R_LIBS: R CMD check is not looking in any of your 
> startup files such as ~/.Renviron.

Thanks! That worked. (And in fact, I now see it in "Writing R Extensions").

-Tim

> 
> I don't believe this is a Windows/Unix issue, but rather one of the 
> local R environment.
> 
> On Sat, 9 Jun 2007, Tim Bergsma wrote:
> 
>> Duncan,
>>
>> Yes, that was a typo on line three.  Sorry.
>>
>> $version.string
>> [1] "Version 2.3.1 (2006-06-01)".
>>
>> Thanks,
>>
>> Tim.
>>
>>
>> Duncan Murdoch wrote:
>>> On 08/06/2007 4:01 PM, Tim Bergsma wrote:
>>>> I normally work in Windows, but make my packages under Unix.  My
>>>> package 'b' suggests my package 'a'.  R CMD check fails for 'b', even
>>>> though 'a' is installed: "Packages required but not available: b".
>>>> What do I have to do to make 'a' available, besides R CMD INSTALL 'a'?
>>>
>>> Is that a typo on line 3?  It seems to be having trouble finding "b",
>>> not finding "a".
>>>
>>> I'm not
>>>> spotting the answer in "Writing Extensions...".  Please point me in
>>>> the right direction.
>>>
>>> Version?
>>>
>>> Duncan Murdoch
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From Thomas.Petzoldt at tu-dresden.de  Mon Jun 11 16:19:59 2007
From: Thomas.Petzoldt at tu-dresden.de (Thomas Petzoldt)
Date: Mon, 11 Jun 2007 16:19:59 +0200
Subject: [Rd] package check note: no visible global function definition (in
 functions using Tcl/Tk)
Message-ID: <466D5A0F.2090907@tu-dresden.de>

Hello,

when testing packages under R version 2.6.0 Under development 
(unstable), in order to discover future compatibility issues, I recently 
get numerous "possible problem notes" for different (own and other 
contributed) packages containing Tcl/Tk code,  e.g.:


   * checking R code for possible problems ... NOTE
   sEdit : editVec : build: no visible global function
   definition for 'tclvalue'
   sEdit : editVec : reset: no visible global function
   definition for 'tclvalue<-'
   sEdit : editVec: no visible global function
   definition for 'tktoplevel'


My question:

- Is this an indication of a serious problem?
- How can one avoid (or if not possible suppress) these messages?

Thanks in advance

Thomas P.

OS: WinXP Prof., German
R 2.6.0, svn-rev. 41910, 2007-06-11



-- 
Thomas Petzoldt
Technische Universitaet Dresden
Institut fuer Hydrobiologie        thomas.petzoldt at tu-dresden.de
01062 Dresden                      http://tu-dresden.de/hydrobiologie/
GERMANY


From ripley at stats.ox.ac.uk  Mon Jun 11 17:42:27 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 11 Jun 2007 16:42:27 +0100 (BST)
Subject: [Rd] package check note: no visible global function definition
 (in functions using Tcl/Tk)
In-Reply-To: <466D5A0F.2090907@tu-dresden.de>
References: <466D5A0F.2090907@tu-dresden.de>
Message-ID: <Pine.LNX.4.64.0706111638530.22283@gannet.stats.ox.ac.uk>

It seems that is happens if package tcltk is missing from the Depends: 
list in the DESCRIPTION file.  I just tested with Amelia and homals and 
that solved the various warnings in both cases.

This is not new in pre-2.6.0: you will get the same warnings in 2.5.0 if 
you turn codestools-checking on -- see `Writing R Extensions'.  Only the 
defaults have been changed.


On Mon, 11 Jun 2007, Thomas Petzoldt wrote:

> Hello,
>
> when testing packages under R version 2.6.0 Under development
> (unstable), in order to discover future compatibility issues, I recently
> get numerous "possible problem notes" for different (own and other
> contributed) packages containing Tcl/Tk code,  e.g.:
>
>
>   * checking R code for possible problems ... NOTE
>   sEdit : editVec : build: no visible global function
>   definition for 'tclvalue'
>   sEdit : editVec : reset: no visible global function
>   definition for 'tclvalue<-'
>   sEdit : editVec: no visible global function
>   definition for 'tktoplevel'
>
>
> My question:
>
> - Is this an indication of a serious problem?
> - How can one avoid (or if not possible suppress) these messages?
>
> Thanks in advance
>
> Thomas P.
>
> OS: WinXP Prof., German
> R 2.6.0, svn-rev. 41910, 2007-06-11
>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Mon Jun 11 18:55:21 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Mon, 11 Jun 2007 09:55:21 -0700
Subject: [Rd] package check note: no visible global function definition
	(in functions using Tcl/Tk)
In-Reply-To: <Pine.LNX.4.64.0706111638530.22283@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Mon, 11 Jun 2007 16:42:27 +0100 (BST)")
References: <466D5A0F.2090907@tu-dresden.de>
	<Pine.LNX.4.64.0706111638530.22283@gannet.stats.ox.ac.uk>
Message-ID: <m2abv6v3ba.fsf@ziti.local>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> It seems that is happens if package tcltk is missing from the Depends: 
> list in the DESCRIPTION file.  I just tested with Amelia and homals and 
> that solved the various warnings in both cases.

Adding tcltk to Depends may not always be the desried solution.  If
tcltk is already in Suggests, for example, and the intention is to
optionally provide GUI features, then the code may be correct as-is.
That is, codetools will issue the NOTEs if you have a function that
looks like:

   f <- function() {
     if (require("tckltk")) {
             someTckltkFunctionHere()
     } else
             otherwiseFunction()
     }
   }

There are a number of packages in the BioC repository that provide
such optional features (not just for tcltk) and it would be nice to
have a way of declaring the use such that the NOTE is silenced.

[Note 1: I don't have any ideas at the moment for how this could
work.]

[Note 2: Despite the false-positives, I've already caught a handful of
bugs by reading over these NOTEs and think they provide a lot of value
to the check process]

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From qyang at bu.edu  Mon Jun 11 20:59:03 2007
From: qyang at bu.edu (Qiong Yang)
Date: Mon, 11 Jun 2007 14:59:03 -0400
Subject: [Rd] cannot  wrap lmekin function
Message-ID: <466D9B77.2020806@bu.edu>

Hi,

I had a problem with the lmekin() in Kinship package: lmekin() can not 
be wrapped into another function

For example:

library(kinship)
#creat an example dataset
xx<-rnorm(100);yy<-rnorm(100) ;id<-1:100;
test.dat<-as.data.frame(cbind(xx,yy,id)) ; rm(xx,yy,id)
a<-bdsmatrix(rep(10,10),rep(block,10),dimnames=list(c(1:100),c(1:100))) 


#this works: call lmekin directly
lmekin(yy~xx,random=~1|id,data=test.dat,varlist=a,na.action=na.omit)

#this doesn't work: wrap lmekin into another function

fo<-function(x,y,z,data)lmekin(y~x,random=~1|z,data=test.dat,varlist=a,na.action=na.omit) 

fo(xx,yy,id,data=test.dat)

Error in eval(expr, envir, enclos) : Object "y" not found

I did line by line debug within lmekin(). I found the problem was from 
line #25
m <- eval(m, sys.parent())

Here is the print(m) result before this line
[1] model.frame(data = data, na.action = na.omit, formula = y ~ x +z)

It seems data cannot be passed to the arguments when lmekin() is wrapped 
into another function.
Can anyone help me to figure a fix?

Thanks a lot!

Qiong


From Thomas.Petzoldt at TU-Dresden.de  Mon Jun 11 22:23:34 2007
From: Thomas.Petzoldt at TU-Dresden.de (Thomas Petzoldt)
Date: Mon, 11 Jun 2007 22:23:34 +0200
Subject: [Rd] package check note: no visible global function definition
 (in functions using Tcl/Tk)
In-Reply-To: <m2abv6v3ba.fsf@ziti.local>
References: <466D5A0F.2090907@tu-dresden.de>	<Pine.LNX.4.64.0706111638530.22283@gannet.stats.ox.ac.uk>
	<m2abv6v3ba.fsf@ziti.local>
Message-ID: <466DAF46.6010902@TU-Dresden.de>

Dear Prof.Ripley, Dear Seth,

thank you both, including tcltk in Depends as suggested by Prof. Ripley 
immediately helped to silence the tcltk NOTEs, but Seth is also right. 
It is in fact not the ultimate solution for the Suggests case, that I 
intentionally used like in Seth's code example.

Thomas


Seth Falcon wrote:
> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
> 
>> It seems that is happens if package tcltk is missing from the Depends: 
>> list in the DESCRIPTION file.  I just tested with Amelia and homals and 
>> that solved the various warnings in both cases.
> 
> Adding tcltk to Depends may not always be the desried solution.  If
> tcltk is already in Suggests, for example, and the intention is to
> optionally provide GUI features, then the code may be correct as-is.
> That is, codetools will issue the NOTEs if you have a function that
> looks like:
> 
>    f <- function() {
>      if (require("tckltk")) {
>              someTckltkFunctionHere()
>      } else
>              otherwiseFunction()
>      }
>    }
> 
> There are a number of packages in the BioC repository that provide
> such optional features (not just for tcltk) and it would be nice to
> have a way of declaring the use such that the NOTE is silenced.
> 
> [Note 1: I don't have any ideas at the moment for how this could
> work.]
> 
> [Note 2: Despite the false-positives, I've already caught a handful of
> bugs by reading over these NOTEs and think they provide a lot of value
> to the check process]
> 
> + seth
>


From hb at stat.berkeley.edu  Tue Jun 12 00:42:30 2007
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 12 Jun 2007 00:42:30 +0200
Subject: [Rd] package check note: no visible global function definition
	(in functions using Tcl/Tk)
In-Reply-To: <m2abv6v3ba.fsf@ziti.local>
References: <466D5A0F.2090907@tu-dresden.de>
	<Pine.LNX.4.64.0706111638530.22283@gannet.stats.ox.ac.uk>
	<m2abv6v3ba.fsf@ziti.local>
Message-ID: <59d7961d0706111542gc599d04q576f3f8d9a4a782e@mail.gmail.com>

On 6/11/07, Seth Falcon <sfalcon at fhcrc.org> wrote:
> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
> > It seems that is happens if package tcltk is missing from the Depends:
> > list in the DESCRIPTION file.  I just tested with Amelia and homals and
> > that solved the various warnings in both cases.
>
> Adding tcltk to Depends may not always be the desried solution.  If
> tcltk is already in Suggests, for example, and the intention is to
> optionally provide GUI features, then the code may be correct as-is.
> That is, codetools will issue the NOTEs if you have a function that
> looks like:
>
>    f <- function() {
>      if (require("tckltk")) {
>              someTckltkFunctionHere()
>      } else
>              otherwiseFunction()
>      }
>    }
>
> There are a number of packages in the BioC repository that provide
> such optional features (not just for tcltk) and it would be nice to
> have a way of declaring the use such that the NOTE is silenced.

Same scenario here: I am using Suggest and I found that the NOTEs go
away if you call the function with double-colon (::), e.g.
tcltk::someTckltkFunctionHere().

I also got several NOTEs about non-declared objects if I used
request(<pkgname>), but they go away with request("<pkgname>").

>
> [Note 1: I don't have any ideas at the moment for how this could
> work.]
>
> [Note 2: Despite the false-positives, I've already caught a handful of
> bugs by reading over these NOTEs and think they provide a lot of value
> to the check process]

I second this. I recently found a lot of typos, bugs, and "left overs"
in my code thanks 'codetools'.  It's a great tool - thanks!

Henrik

>
> + seth
>
> --
> Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
> http://bioconductor.org
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ploua at allstate.com  Mon Jun 11 22:20:42 2007
From: ploua at allstate.com (Louisell, Paul)
Date: Mon, 11 Jun 2007 13:20:42 -0700
Subject: [Rd] compiler usage after successful UNIX build
Message-ID: <633AD4C78F3E8F489614A06990F6077B02028086@a0203-xpo0111-s.hodc.ad.allstate.com>

Hi,

I believe my question is pretty simple, but I'd like to give you brief
background first:

I work at a company with UNIX installed on a sparc-sun-solaris platform;
the OS version is SunOS 5.9. Several of us who work here have been
advocating for the installation of R on this server. The IT security
group at my company prefers not to install the gcc compilers on our UNIX
production servers; they're okay doing this in a test environment.

My question: After a successful build, is there anytime that R might
call the compiler? My (limited) understanding was that once the binaries
are created, the compiler is not used unless you're doing another build,
e.g., compiling source code for a package. Does R ever compile routines
during execution? Does it depend on how the installation was done?

Thanks for your help with this.


Paul Louisell
650-833-6254
ploua at allstate.com


From osklyar at ebi.ac.uk  Tue Jun 12 10:24:12 2007
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Tue, 12 Jun 2007 09:24:12 +0100
Subject: [Rd] bug in R environments? Was: [BioC] 'recursive default
	argument' error...
Message-ID: <466E582C.4040108@ebi.ac.uk>

Dear developers,

has anyone experienced the problem described below? Is it a bug in 
handling interrupts in R?

Best,
Oleg

-------- Original Message --------
Subject: Re: [BioC] 'recursive default argument' error in GOENTREZID2GO
From: Diego Diez <diez at kuicr.kyoto-u.ac.jp>

...steps that use to reach me to that point. It happens with any
environment, or at least annotation packages stored as environments.
I can't think of any reason why this happens but let me show you the
code:

> library(rae230a)
> xx <- as.list(rae230aENTREZID)
^C
> xx <- as.list(rae230aENTREZID)
Error in as.list(rae230aENTREZID) : recursive default argument reference

now, while the as.list() is working, cancel the process with control-
C, and after that, the mentioned error happens whenever you try to
repeat the process of transforming the environment to a list. The
cancel must be done soon after hitting return, I found one case when
delaying a little made me unable to reproduce the error. Other
environments found in the package are not affected (i.e.
rae230aSYMBOL, rae230aGENENAME, etc).

Going deeper to the problem, I found that canceling the environment
"loading" with any function reproduces the problem:

> is(rae230aSYMBOL)
^C
> is(rae230aSYMBOL)
Error in .class1(object) : recursive default argument reference
> rae230aSYMBOL
Error: recursive default argument reference

By "loading" a mean that the first time I execute as.list
(rae230aSYMBOL) or is(rae230aSYMBOL) there is a delay which I assume
is the environment being loaded into memory. Any further execution of
the same commands will occur almost immediately.

So, why should I cancel an environment loading soon after trying to
load it? It happens that I was loading an environment inside a
function, ran the function and wanted to cancel the execution, thus,
the error appeared and the environemnt was unusable. Anyway, this
seems to me more an R related issue.

HTH,

Diego.


> sessionInfo()
R version 2.5.0 (2007-04-23)
powerpc-apple-darwin8.9.1

locale:
C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
"methods"
[7] "base"

other attached packages:
  rae230a
"1.16.0"
>



On Jun 11, 2007, at 11:27 PM, Seth Falcon wrote:

> "James W. MacDonald" <jmacdon at med.umich.edu> writes:
>
>> Hi Oleg,
>>
>> Oleg Sklyar wrote:
>>> Hi,
>>>
>>> anybody has an idea as for the following error, the example is  
>>> actually
>>> from the GO package examples. Thanks, Oleg
>>>
>>>> library(GO)
>>>> egId <- "10043"
>>>> egIdGoData <- GOENTREZID2GO[[egId]]
>>> Error: recursive default argument reference
>>
>> I sometimes see that error as well. I have no idea what causes it,  
>> as it
>> doesn't seem repeatable. Anyway, quitting R and starting over has  
>> always
>> fixed the problem for me.
>
> Oleg, is this reproducible for you?  I wasn't able to get the error.
> Have you tried updating to R patched?
>
> + seth
>
> -- 
> Seth Falcon | Computational Biology | Fred Hutchinson Cancer  
> Research Center
> http://bioconductor.org
>
> _______________________________________________
> Bioconductor mailing list
> Bioconductor at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/bioconductor
> Search the archives: http://news.gmane.org/ 
> gmane.science.biology.informatics.conductor

-- 
Dr Oleg Sklyar | EBI-EMBL, Cambridge CB10 1SD, UK | +44-1223-494466


From ripley at stats.ox.ac.uk  Tue Jun 12 10:47:57 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 12 Jun 2007 09:47:57 +0100 (BST)
Subject: [Rd] compiler usage after successful UNIX build
In-Reply-To: <633AD4C78F3E8F489614A06990F6077B02028086@a0203-xpo0111-s.hodc.ad.allstate.com>
References: <633AD4C78F3E8F489614A06990F6077B02028086@a0203-xpo0111-s.hodc.ad.allstate.com>
Message-ID: <Pine.LNX.4.64.0706120938020.22320@gannet.stats.ox.ac.uk>

On Mon, 11 Jun 2007, Louisell, Paul wrote:

> Hi,
>
> I believe my question is pretty simple, but I'd like to give you brief
> background first:
>
> I work at a company with UNIX installed on a sparc-sun-solaris platform;
> the OS version is SunOS 5.9. Several of us who work here have been
> advocating for the installation of R on this server. The IT security
> group at my company prefers not to install the gcc compilers on our UNIX
> production servers; they're okay doing this in a test environment.

Is their objection to gcc or compilers at all?  Sun's own Studio 11 
compilers are now free (and at least as good as gcc in that environment).

> My question: After a successful build, is there anytime that R might
> call the compiler? My (limited) understanding was that once the binaries
> are created, the compiler is not used unless you're doing another build,
> e.g., compiling source code for a package. Does R ever compile routines
> during execution? Does it depend on how the installation was done?

It only compiles code when asked to do so.  That means running R CMD 
COMPILE or R CMD SHLIB.  The latter is run by R CMD INSTALL and that is 
run by install.packages() and elsewhere.  But you would need to have 
specified some C/C++/Fortran source code, so would be expecting this.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jarioksa at sun3.oulu.fi  Tue Jun 12 11:56:25 2007
From: jarioksa at sun3.oulu.fi (Jari Oksanen)
Date: Tue, 12 Jun 2007 12:56:25 +0300
Subject: [Rd] package check note: no visible global function
	definition	(in functions using Tcl/Tk)
In-Reply-To: <59d7961d0706111542gc599d04q576f3f8d9a4a782e@mail.gmail.com>
References: <466D5A0F.2090907@tu-dresden.de>
	<Pine.LNX.4.64.0706111638530.22283@gannet.stats.ox.ac.uk>
	<m2abv6v3ba.fsf@ziti.local>
	<59d7961d0706111542gc599d04q576f3f8d9a4a782e@mail.gmail.com>
Message-ID: <1181642185.14013.60.camel@biol102145.oulu.fi>

On Tue, 2007-06-12 at 00:42 +0200, Henrik Bengtsson wrote:
> On 6/11/07, Seth Falcon <sfalcon at fhcrc.org> wrote:
> > Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
> >
> > > It seems that is happens if package tcltk is missing from the Depends:
> > > list in the DESCRIPTION file.  I just tested with Amelia and homals and
> > > that solved the various warnings in both cases.
> >
> > Adding tcltk to Depends may not always be the desried solution.  If
> > tcltk is already in Suggests, for example, and the intention is to
> > optionally provide GUI features, then the code may be correct as-is.
> > That is, codetools will issue the NOTEs if you have a function that
> > looks like:
> >
> >    f <- function() {
> >      if (require("tckltk")) {
> >              someTckltkFunctionHere()
> >      } else
> >              otherwiseFunction()
> >      }
> >    }
> >
> > There are a number of packages in the BioC repository that provide
> > such optional features (not just for tcltk) and it would be nice to
> > have a way of declaring the use such that the NOTE is silenced.
> 
> Same scenario here: I am using Suggest and I found that the NOTEs go
> away if you call the function with double-colon (::), e.g.
> tcltk::someTckltkFunctionHere().
> 
> I also got several NOTEs about non-declared objects if I used
> request(<pkgname>), but they go away with request("<pkgname>").
> 
The real problem here is what are the consequences for CRAN auditing
with the new defaults. Do you have to pass these tests also? Do you
implement stricter package dependence checking? Do you still allow the
check circumvention device that Henrik, perhaps unwisely, revealed here
(that is package::function)? 

Just being curious, I run checkUsagePackage() for my CRAN package
(vegan), and got 109 messages. 58 of these were "local variables
assigned but may not be used" and need be checked. My first impression
was that they were just harmless leftover, and removing those is not
among my top priorities, but may wait till September. Some were false
positives. Most of the rest (49 + 1 special case) were calls to
functions in other packages with require || stop in the function body.
I'd like to keep them like this, or at least with the circumvention
device. Please don't make this test a requirement in CRAN submissions!

One real error was detected also, but fixing that error broke the
function, since the rest of the function already was expecting erroneous
output to work correctly. 

I urge for more relaxed dependence checking allowing calls to other
packages in functions. I've been a Linux user since Red Hat 5.1 and I
know what is a dependence hell (package depending on package
depending ... depending on broken package). There already are some signs
of that in R, in particular in unsupported platforms like MacOS 10.3.9
where I have trouble in installing some packages that depend on
packages... (if somebody wonders why I still use MacOS 10.3.9, I can
give 129 reasons, each worth one Euro). 

cheers, Jari Oksanen


From ripley at stats.ox.ac.uk  Tue Jun 12 13:12:39 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 12 Jun 2007 12:12:39 +0100 (BST)
Subject: [Rd] bug in R environments? Was: [BioC] 'recursive default
 argument' error...
In-Reply-To: <466E582C.4040108@ebi.ac.uk>
References: <466E582C.4040108@ebi.ac.uk>
Message-ID: <Pine.LNX.4.64.0706121110030.1465@gannet.stats.ox.ac.uk>

On Tue, 12 Jun 2007, Oleg Sklyar wrote:

> Dear developers,
>
> has anyone experienced the problem described below? Is it a bug in
> handling interrupts in R?

I am not sure where you think the 'bug' is in: cf your subject line.
My guess is that the package is using environments in a vulnerable way.

I cannot reproduce your example on my system: I was able to interrupt but 
repeating the as.list worked.  What I suspect may have happened is that 
you have interrupted lazy loading.  From the code

 	    if(PRSEEN(e))
 		errorcall(R_GlobalContext->call,
 			  _("recursive default argument reference"));
 	    SET_PRSEEN(e, 1);
 	    val = eval(PRCODE(e), PRENV(e));
 	    SET_PRSEEN(e, 0);

so you will get this message from a promise whose evaluation was 
incomplete.  I can see several ways around that, but most have runtime 
costs or back-compatibility issues.  (Changing the message may help.)

It looks like rae230a has been implemented to use lazy-loading on whole 
environments (the 'source' is already a lazyload database, so it's not 
transparent).  Lazy-loading was intended for members of environments.

Also, does this happen in R-devel?  There lazy-loading is considerably 
faster and closer to an atomic operation.

All guesswork on something I cannot reproduce, of course.


>
> Best,
> Oleg
>
> -------- Original Message --------
> Subject: Re: [BioC] 'recursive default argument' error in GOENTREZID2GO
> From: Diego Diez <diez at kuicr.kyoto-u.ac.jp>
>
> ...steps that use to reach me to that point. It happens with any
> environment, or at least annotation packages stored as environments.
> I can't think of any reason why this happens but let me show you the
> code:
>
>> library(rae230a)
>> xx <- as.list(rae230aENTREZID)
> ^C
>> xx <- as.list(rae230aENTREZID)
> Error in as.list(rae230aENTREZID) : recursive default argument reference
>
> now, while the as.list() is working, cancel the process with control-
> C, and after that, the mentioned error happens whenever you try to
> repeat the process of transforming the environment to a list. The
> cancel must be done soon after hitting return, I found one case when
> delaying a little made me unable to reproduce the error. Other
> environments found in the package are not affected (i.e.
> rae230aSYMBOL, rae230aGENENAME, etc).
>
> Going deeper to the problem, I found that canceling the environment
> "loading" with any function reproduces the problem:
>
>> is(rae230aSYMBOL)
> ^C
>> is(rae230aSYMBOL)
> Error in .class1(object) : recursive default argument reference
>> rae230aSYMBOL
> Error: recursive default argument reference
>
> By "loading" a mean that the first time I execute as.list
> (rae230aSYMBOL) or is(rae230aSYMBOL) there is a delay which I assume
> is the environment being loaded into memory. Any further execution of
> the same commands will occur almost immediately.
>
> So, why should I cancel an environment loading soon after trying to
> load it? It happens that I was loading an environment inside a
> function, ran the function and wanted to cancel the execution, thus,
> the error appeared and the environemnt was unusable. Anyway, this
> seems to me more an R related issue.
>
> HTH,
>
> Diego.
>
>
>> sessionInfo()
> R version 2.5.0 (2007-04-23)
> powerpc-apple-darwin8.9.1
>
> locale:
> C
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> "methods"
> [7] "base"
>
> other attached packages:
>  rae230a
> "1.16.0"
>>
>
>
>
> On Jun 11, 2007, at 11:27 PM, Seth Falcon wrote:
>
>> "James W. MacDonald" <jmacdon at med.umich.edu> writes:
>>
>>> Hi Oleg,
>>>
>>> Oleg Sklyar wrote:
>>>> Hi,
>>>>
>>>> anybody has an idea as for the following error, the example is
>>>> actually
>>>> from the GO package examples. Thanks, Oleg
>>>>
>>>>> library(GO)
>>>>> egId <- "10043"
>>>>> egIdGoData <- GOENTREZID2GO[[egId]]
>>>> Error: recursive default argument reference
>>>
>>> I sometimes see that error as well. I have no idea what causes it,
>>> as it
>>> doesn't seem repeatable. Anyway, quitting R and starting over has
>>> always
>>> fixed the problem for me.
>>
>> Oleg, is this reproducible for you?  I wasn't able to get the error.
>> Have you tried updating to R patched?
>>
>> + seth
>>
>> --
>> Seth Falcon | Computational Biology | Fred Hutchinson Cancer
>> Research Center
>> http://bioconductor.org
>>
>> _______________________________________________
>> Bioconductor mailing list
>> Bioconductor at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/bioconductor
>> Search the archives: http://news.gmane.org/
>> gmane.science.biology.informatics.conductor
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jfox at mcmaster.ca  Tue Jun 12 13:25:15 2007
From: jfox at mcmaster.ca (John Fox)
Date: Tue, 12 Jun 2007 07:25:15 -0400
Subject: [Rd] Warning under R 2.6.0: Rd files with unknown encoding
Message-ID: <20070612112518.RFIU1673.tomts16-srv.bellnexxia.net@JohnDesktop8300>

Dear R-devel list members,

Under the development version of R (2.6.0), I notice that my sem package
produces the following warning:

	checking Rd files ... WARNING
	Rd files with unknown encoding:
	residuals.Rd

I wonder what the warning means. As far as I can see, residuals.Rd is
similar to the other .Rd files in the package.

At least for the time being, I won't reproduce residuals.Rd here in the
interest of brevity.

Any help would be appreciated.

John

--------------------------------
John Fox, Professor
Department of Sociology
McMaster University
Hamilton, Ontario
Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox


From ripley at stats.ox.ac.uk  Tue Jun 12 13:45:18 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 12 Jun 2007 12:45:18 +0100 (BST)
Subject: [Rd] Warning under R 2.6.0: Rd files with unknown encoding
In-Reply-To: <20070612112518.RFIU1673.tomts16-srv.bellnexxia.net@JohnDesktop8300>
References: <20070612112518.RFIU1673.tomts16-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <Pine.LNX.4.64.0706121238160.15600@auk.stats>

On Tue, 12 Jun 2007, John Fox wrote:

> Dear R-devel list members,
>
> Under the development version of R (2.6.0), I notice that my sem package
> produces the following warning:
>
> 	checking Rd files ... WARNING
> 	Rd files with unknown encoding:
> 	residuals.Rd
>
> I wonder what the warning means. As far as I can see, residuals.Rd is
> similar to the other .Rd files in the package.
>
> At least for the time being, I won't reproduce residuals.Rd here in the
> interest of brevity.

You have in the \details of that file:

     (s_{ij} - c_{ij})/[(c_{ii}c_{jj} - c_{ij}?)/N]^{1/2}}

and that superscript 2 (which will probably come out in your mailer but 
not for all readers) is not ASCII.  'Writing R Extensions' tells you that 
for files that are not entirely ASCII you need to declare the encoding:
I presume you want \encoding{latin1}.

You might also want to think about the N^{*} in the latex version and the 
N in the not-so-plain text version.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From jfox at mcmaster.ca  Tue Jun 12 14:54:04 2007
From: jfox at mcmaster.ca (John Fox)
Date: Tue, 12 Jun 2007 08:54:04 -0400
Subject: [Rd] Warning under R 2.6.0: Rd files with unknown encoding
In-Reply-To: <Pine.LNX.4.64.0706121238160.15600@auk.stats>
Message-ID: <20070612125407.TLWL875.tomts22-srv.bellnexxia.net@JohnDesktop8300>

Dear Brian,

> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Sent: Tuesday, June 12, 2007 7:45 AM
> To: John Fox
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Warning under R 2.6.0: Rd files with 
> unknown encoding
> 
> On Tue, 12 Jun 2007, John Fox wrote:
> 
> > Dear R-devel list members,
> >
> > Under the development version of R (2.6.0), I notice that my sem 
> > package produces the following warning:
> >
> > 	checking Rd files ... WARNING
> > 	Rd files with unknown encoding:
> > 	residuals.Rd
> >
> > I wonder what the warning means. As far as I can see, 
> residuals.Rd is 
> > similar to the other .Rd files in the package.
> >
> > At least for the time being, I won't reproduce residuals.Rd here in 
> > the interest of brevity.
> 
> You have in the \details of that file:
> 
>      (s_{ij} - c_{ij})/[(c_{ii}c_{jj} - c_{ij}?)/N]^{1/2}}
> 
> and that superscript 2 (which will probably come out in your 
> mailer but not for all readers) is not ASCII.  'Writing R 
> Extensions' tells you that for files that are not entirely 
> ASCII you need to declare the encoding:
> I presume you want \encoding{latin1}.

Thanks for catching that. I wonder how it happened, since I believe that I
produced the file with a plain-text editor, probably Tinn-R. 

> 
> You might also want to think about the N^{*} in the latex 
> version and the N in the not-so-plain text version.

Yes, I saw the missing asterisk (and the not-so-plain text) when I compared
the PDF and chtml versions of the help page in my attempt to locate the
error.

Thanks again,
 John

> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bolker at ufl.edu  Tue Jun 12 15:31:21 2007
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 12 Jun 2007 13:31:21 +0000 (UTC)
Subject: [Rd] small typo in NEWS
Message-ID: <loom.20070612T153029-555@post.gmane.org>

 The current NEWS file on the R site states that there is
a new relink (sic) function, which should probably be
relist ...

  Ben Bolker


From sfalcon at fhcrc.org  Tue Jun 12 16:43:09 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 12 Jun 2007 07:43:09 -0700
Subject: [Rd] bug in R environments? Was: [BioC] 'recursive default
	argument' error...
In-Reply-To: <Pine.LNX.4.64.0706121110030.1465@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Tue, 12 Jun 2007 12:12:39 +0100 (BST)")
References: <466E582C.4040108@ebi.ac.uk>
	<Pine.LNX.4.64.0706121110030.1465@gannet.stats.ox.ac.uk>
Message-ID: <m2odjlkzcy.fsf@ziti.local>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> On Tue, 12 Jun 2007, Oleg Sklyar wrote:
>
>> Dear developers,
>>
>> has anyone experienced the problem described below? Is it a bug in
>> handling interrupts in R?
>
> I am not sure where you think the 'bug' is in: cf your subject line.
> My guess is that the package is using environments in a vulnerable
> way.

The issue at hand is, I believe, the same as that discussed here:

http://thread.gmane.org/gmane.comp.lang.r.devel/8103/focus=8104

> I cannot reproduce your example on my system: I was able to interrupt but 
> repeating the as.list worked.

Try with a larger environment.  I can reproduce this with a recent
R-devel using the GO package:

    > library(GO)
    > GOTERM
    ^C
    > GOTERM
    Error: recursive default argument reference

> What I suspect may have happened is that 
> you have interrupted lazy loading.  From the code
>
>  	    if(PRSEEN(e))
>  		errorcall(R_GlobalContext->call,
>  			  _("recursive default argument reference"));
>  	    SET_PRSEEN(e, 1);
>  	    val = eval(PRCODE(e), PRENV(e));
>  	    SET_PRSEEN(e, 0);
>
> so you will get this message from a promise whose evaluation was 
> incomplete.  I can see several ways around that, but most have runtime 
> costs or back-compatibility issues.  (Changing the message may help.)
>
> It looks like rae230a has been implemented to use lazy-loading on whole 
> environments (the 'source' is already a lazyload database, so it's not 
> transparent).  Lazy-loading was intended for members of environments.
>
> Also, does this happen in R-devel?  There lazy-loading is considerably 
> faster and closer to an atomic operation.
>
> All guesswork on something I cannot reproduce, of course.

Good guesses.  Yes, _all_ Bioconductor annotation data packages
currently store each identifier mapping in a separate environment.  So
the package environment contains environments.  The lazy loading db is
important at runtime when users may only need to access one or two of
the environments.  We generate the lazy-loading dbs by hand so that
users installing from source do not have to repeat the process
themselves.  Since the environments are large, it is possible to use
the packages on a system that does not have enough memory to
"properly" install them.

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From maechler at stat.math.ethz.ch  Tue Jun 12 16:57:08 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 12 Jun 2007 16:57:08 +0200
Subject: [Rd] small typo in NEWS
In-Reply-To: <loom.20070612T153029-555@post.gmane.org>
References: <loom.20070612T153029-555@post.gmane.org>
Message-ID: <18030.46148.116243.199671@stat.math.ethz.ch>

>>>>> "BB" == Ben Bolker <bolker at ufl.edu>
>>>>>     on Tue, 12 Jun 2007 13:31:21 +0000 (UTC) writes:

    BB> The current NEWS file on the R site states that there is
    BB> a new relink (sic) function, which should probably be
    BB> relist ...

Yes, thanks;  being fixed "as we speak" ;-)
Martin


From p.dalgaard at biostat.ku.dk  Tue Jun 12 19:11:02 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 12 Jun 2007 19:11:02 +0200
Subject: [Rd] Warning under R 2.6.0: Rd files with unknown encoding
In-Reply-To: <20070612125407.TLWL875.tomts22-srv.bellnexxia.net@JohnDesktop8300>
References: <20070612125407.TLWL875.tomts22-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <466ED3A6.1030101@biostat.ku.dk>

John Fox wrote:
> Dear Brian,
>
>   
>> -----Original Message-----
>> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
>> Sent: Tuesday, June 12, 2007 7:45 AM
>> To: John Fox
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] Warning under R 2.6.0: Rd files with 
>> unknown encoding
>>
>> On Tue, 12 Jun 2007, John Fox wrote:
>>
>>     
>>> Dear R-devel list members,
>>>
>>> Under the development version of R (2.6.0), I notice that my sem 
>>> package produces the following warning:
>>>
>>> 	checking Rd files ... WARNING
>>> 	Rd files with unknown encoding:
>>> 	residuals.Rd
>>>
>>> I wonder what the warning means. As far as I can see, 
>>>       
>> residuals.Rd is 
>>     
>>> similar to the other .Rd files in the package.
>>>
>>> At least for the time being, I won't reproduce residuals.Rd here in 
>>> the interest of brevity.
>>>       
>> You have in the \details of that file:
>>
>>      (s_{ij} - c_{ij})/[(c_{ii}c_{jj} - c_{ij}?)/N]^{1/2}}
>>
>> and that superscript 2 (which will probably come out in your 
>> mailer but not for all readers) is not ASCII.  'Writing R 
>> Extensions' tells you that for files that are not entirely 
>> ASCII you need to declare the encoding:
>> I presume you want \encoding{latin1}.
>>     
>
> Thanks for catching that. I wonder how it happened, since I believe that I
> produced the file with a plain-text editor, probably Tinn-R. 
>   
Several tools seem to be overly helpful in doing that conversion 
(x-caret-2 becomes x-superscript-2) these days. X11 keyboards without 
the nodeadkeys option does it if you forget a space after the caret, and 
Thunderbird does it when displaying emails, which is almost as annoying 
as the automatic smiley recognition (which has been said to "turn Perl 
scripts into love letters").


From ripley at stats.ox.ac.uk  Tue Jun 12 19:18:05 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 12 Jun 2007 18:18:05 +0100 (BST)
Subject: [Rd] Warning under R 2.6.0: Rd files with unknown encoding
In-Reply-To: <20070612125407.TLWL875.tomts22-srv.bellnexxia.net@JohnDesktop8300>
References: <20070612125407.TLWL875.tomts22-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <Pine.LNX.4.64.0706121814340.13786@gannet.stats.ox.ac.uk>

These can be hard to spot.  My technique (which in fact I did not need 
here) is to use 'less' in a C locale, as that does things like

     (s_{ij} - c_{ij})/[(c_{ii}c_{jj} - c_{ij}<B2>)/N]^{1/2}}

with <B2> in reverse video so it is hard to miss.

Brian

On Tue, 12 Jun 2007, John Fox wrote:

> Dear Brian,
>
>> -----Original Message-----
>> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
>> Sent: Tuesday, June 12, 2007 7:45 AM
>> To: John Fox
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] Warning under R 2.6.0: Rd files with
>> unknown encoding
>>
>> On Tue, 12 Jun 2007, John Fox wrote:
>>
>>> Dear R-devel list members,
>>>
>>> Under the development version of R (2.6.0), I notice that my sem
>>> package produces the following warning:
>>>
>>> 	checking Rd files ... WARNING
>>> 	Rd files with unknown encoding:
>>> 	residuals.Rd
>>>
>>> I wonder what the warning means. As far as I can see,
>> residuals.Rd is
>>> similar to the other .Rd files in the package.
>>>
>>> At least for the time being, I won't reproduce residuals.Rd here in
>>> the interest of brevity.
>>
>> You have in the \details of that file:
>>
>>      (s_{ij} - c_{ij})/[(c_{ii}c_{jj} - c_{ij}?)/N]^{1/2}}
>>
>> and that superscript 2 (which will probably come out in your
>> mailer but not for all readers) is not ASCII.  'Writing R
>> Extensions' tells you that for files that are not entirely
>> ASCII you need to declare the encoding:
>> I presume you want \encoding{latin1}.
>
> Thanks for catching that. I wonder how it happened, since I believe that I
> produced the file with a plain-text editor, probably Tinn-R.
>
>>
>> You might also want to think about the N^{*} in the latex
>> version and the N in the not-so-plain text version.
>
> Yes, I saw the missing asterisk (and the not-so-plain text) when I compared
> the PDF and chtml versions of the help page in my attempt to locate the
> error.
>
> Thanks again,
> John
>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From sfalcon at fhcrc.org  Wed Jun 13 01:10:06 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 12 Jun 2007 16:10:06 -0700
Subject: [Rd] PATCH: install inst/ before doing lazyload on Windows
Message-ID: <m2y7iog46p.fsf@ziti.local>

Hi,

On Windows, package files in the inst/ subdir are installed after the
lazyload creation.  This differs from Linux where inst/ is installed
_before_ lazyload creation.

Since packages may need data in inst, I think the order on Windows
should be changed.  Perhaps like this:

diff --git a/src/gnuwin32/MakePkg b/src/gnuwin32/MakePkg
index 57af321..868e8f1 100644
--- a/src/gnuwin32/MakePkg
+++ b/src/gnuwin32/MakePkg
@@ -74,10 +74,10 @@ all:
 	@$(MAKE) --no-print-directory -f $(RHOME)/src/gnuwin32/MakePkg -s nmspace
 	@$(MAKE) --no-print-directory -f $(RHOME)/src/gnuwin32/MakePkg Dynlib 
 	@$(MAKE) --no-print-directory -f $(RHOME)/src/gnuwin32/MakePkg -s R
+	@$(MAKE) --no-print-directory -f $(RHOME)/src/gnuwin32/MakePkg -s $(DPKG)/demo $(DPKG)/exec $(DPKG)/inst $(DATA)
 ifeq ($(strip $(LAZY)),true)
 	@$(MAKE) --no-print-directory -f $(RHOME)/src/gnuwin32/MakePkg -s lazyload
 endif
-	@$(MAKE) --no-print-directory -f $(RHOME)/src/gnuwin32/MakePkg -s $(DPKG)/demo $(DPKG)/exec $(DPKG)/inst $(DATA)
 ifeq ($(strip $(LAZYDATA)),true)
 	@$(MAKE) --no-print-directory -f $(RHOME)/src/gnuwin32/MakePkg -s lazydata
 endif

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From stefano.iacus at unimi.it  Wed Jun 13 02:44:54 2007
From: stefano.iacus at unimi.it (stefano iacus)
Date: Tue, 12 Jun 2007 17:44:54 -0700
Subject: [Rd] R CMD SHLIB error using OS X
In-Reply-To: <466959A5.9020005@uchicago.edu>
References: <466959A5.9020005@uchicago.edu>
Message-ID: <5FB7960F-B08A-4DDF-9241-DA612F9D775D@unimi.it>

please report to R-sig-mac
stefano

On 08/giu/07, at 06:29, Richard Zur wrote:

> Hello,
>
> I'm using R 2.5.0 with OS X 10.4.9 and Xcode 2.4.1 on a PowerPC.  My
> code used to compile fine with R 2.4.* and Xcode 2.2 (I think).
>
> I'm compiling some C code (named mhroc_prop.c) that calls a fortran
> routine from mvndstpack.f  I get the error
>
> /usr/bin/libtool: file: mvndstpack.o is not an object file (not  
> allowed
> in a library)
>
> after R outputs (sorry... not sure if this is useful information or  
> not)
>
> gcc-4.0 -arch ppc -isysroot /Developer/SDKs/MacOSX10.4u.sdk -std=gnu99
> -dynamiclib -Wl,-macosx_version_min -Wl,10.3 -undefined dynamic_lookup
> -single_module -multiply_defined suppress -L/usr/local/lib -o
> mhroc_prop.so mhroc_prop.o mvndstpack.o
> -L/Library/Frameworks/R.framework/Resources/lib/ppc -lRlapack
> -L/Library/Frameworks/R.framework/Resources/lib/ppc -lRblas
> -L/usr/local/lib/gcc/powerpc-apple-darwin8/4.2.0 -lgfortran -lgcc_s. 
> 10.4
> -lSystemStubs -L/usr/local/lib/gcc/powerpc-apple-darwin8/4.2.0
> -lgfortran -lgcc_s.10.4 -lSystemStubs
> -F/Library/Frameworks/R.framework/.. -framework R
>
> Any ideas?
>
> Thank you,
> Richard Zur
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From gavin.simpson at ucl.ac.uk  Wed Jun 13 14:33:15 2007
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 13 Jun 2007 13:33:15 +0100
Subject: [Rd] step() in sink() and Sweave()
In-Reply-To: <1178698222.28498.18.camel@biol102145.oulu.fi>
References: <1178698222.28498.18.camel@biol102145.oulu.fi>
Message-ID: <1181737995.3695.38.camel@gsimpson.geog.ucl.ac.uk>

Dear Developers,

This change also just bit me whilst updating Sweave documents for some
computer classes.

Is there a work-around that can be employed so that we get both the
message() bits and the print() bits in the same place for our Sweave
files?

If not, is there any point in filing this as a bug in R? I see there
have been no (public) responses to Jari's email, yet the change is
rather annoying, and I do not see the rationale for "printing" different
parts of the output from step() in two different ways.

All the best,

Gav

On Wed, 2007-05-09 at 08:10 +0000, Jari Oksanen wrote:
> Dear developers,
> 
> I just noticed that step() function currently prints the current model
> using message(), but the resulting model using print(). The relevant
> commands within the step() body are:
> 
> if (trace) message("Start:  AIC=", format(round(bAIC, 2)), "\n", 
>     cut.string(deparse(as.vector(formula(fit)))), "\n")
> 
> (with example() output:) 
> Start:  AIC=190.69
> Fertility ~ Agriculture + Examination + Education + Catholic + 
>     Infant.Mortality
> 
> And later:
> 
> if (trace) print(aod[o, ])
> 
> (with example() output:)
> 
>                    Df Sum of Sq    RSS    AIC
> - Examination       1      53.0 2158.1  189.9
> <none>                          2105.0  190.7
> - Agriculture       1     307.7 2412.8  195.1
> - Infant.Mortality  1     408.8 2513.8  197.0
> - Catholic          1     447.7 2552.8  197.8
> - Education         1    1162.6 3267.6  209.4
> 
> This is a nuisance if you want to divert output to a file with sink() or
> use step() in Sweave: the header and the table go to different places,
> and without message() part the print() part is crippled.  It may be that
> there is some way to avoid this, but obviously that needs some degree of
> acrobatic R skills. 
> 
> An example of the behaviour:
> 
> sink(tempfile())
> example(step)
> sink()
> 
> I assueme that the behaviour is intentional but searching NEWS did not
> give any information or reasoning. Would it be sensible to go back to
> the old behaviour? I found some Swoven files from R 2.4.0 that still put
> both parts of the output to the same place. For the sake of Sweave and
> sink, I'd prefer the one place to be stdout instead of stderr.
> 
> Best wishes, Jari Oksanen
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From jarioksa at sun3.oulu.fi  Wed Jun 13 15:43:32 2007
From: jarioksa at sun3.oulu.fi (Jari Oksanen)
Date: Wed, 13 Jun 2007 16:43:32 +0300
Subject: [Rd] step() in sink() and Sweave()
In-Reply-To: <1181737995.3695.38.camel@gsimpson.geog.ucl.ac.uk>
References: <1178698222.28498.18.camel@biol102145.oulu.fi>
	<1181737995.3695.38.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <1181742212.26511.12.camel@biol102145.oulu.fi>

On Wed, 2007-06-13 at 13:33 +0100, Gavin Simpson wrote:
> Dear Developers,
> 
> This change also just bit me whilst updating Sweave documents for some
> computer classes.
> 
> Is there a work-around that can be employed so that we get both the
> message() bits and the print() bits in the same place for our Sweave
> files?
> 
> If not, is there any point in filing this as a bug in R? I see there
> have been no (public) responses to Jari's email, yet the change is
> rather annoying, and I do not see the rationale for "printing" different
> parts of the output from step() in two different ways.
> 
I think this is a bug. You should not use message() with optional trace.
The template for the usage in step() is first

if (trace) message()

and later

if (trace) print()

If you specifically request printing setting  trace = TRUE, then you
should not get message().

Interestingly, message() seems to be a warning() that cannot be
suppressed by setting options.

This is so annoying that I haven't updated some of my Sweave documents.
It is better to have outdated documents than crippled documents.

You can handle this in sink(), but I don't know any trick for Sweave
(and it's a nuisance in sink() as well).

cheers, jari oksanen
-- 
Jari Oksanen -- Dept Biology, Univ Oulu, FI-90014 Oulu, Finland
Ph. +358 85531526, cell +358 405136529, fax +358 85531061, skype jhoksane
email jari.oksanen at oulu.fi, homepage http://cc.oulu.fi/~jarioksa/


From beierm at uni-duesseldorf.de  Wed Jun 13 14:14:06 2007
From: beierm at uni-duesseldorf.de (beierm at uni-duesseldorf.de)
Date: Wed, 13 Jun 2007 14:14:06 +0200 (CEST)
Subject: [Rd] subset() only returns first of equally named columns from a
	data.frame (PR#9733)
Message-ID: <20070613121406.BCFE54841A@slim.kubism.ku.dk>

Full_Name: Manfred Beier
Version: 2.5.0 (2007-04-23)
OS: linux-gnu
Submission from: (NULL) (134.99.204.101)


When multiple columns in a data.frame have the same name, only the first of them
is returned by the subset() function even when selected numerically.

> test <- data.frame(cbind(1,2,3))
> names(test) <- c("a","a","a")
> test
  a a a
1 1 2 3
> subset(test, TRUE, c(2,3))
  a a.1
1 1   1

For matrices subset() works correctly.


From friedrich.leisch at stat.uni-muenchen.de  Wed Jun 13 16:31:44 2007
From: friedrich.leisch at stat.uni-muenchen.de (Friedrich Leisch)
Date: Wed, 13 Jun 2007 16:31:44 +0200
Subject: [Rd] step() in sink() and Sweave()
In-Reply-To: <1181742212.26511.12.camel@biol102145.oulu.fi>
References: <1178698222.28498.18.camel@biol102145.oulu.fi>
	<1181737995.3695.38.camel@gsimpson.geog.ucl.ac.uk>
	<1181742212.26511.12.camel@biol102145.oulu.fi>
Message-ID: <18031.65488.381819.113410@celebrian.ci.tuwien.ac.at>

>>>>> On Wed, 13 Jun 2007 16:43:32 +0300,
>>>>> Jari Oksanen (JO) wrote:

  > On Wed, 2007-06-13 at 13:33 +0100, Gavin Simpson wrote:
  >> Dear Developers,
  >> 
  >> This change also just bit me whilst updating Sweave documents for some
  >> computer classes.
  >> 
  >> Is there a work-around that can be employed so that we get both the
  >> message() bits and the print() bits in the same place for our Sweave
  >> files?
  >> 
  >> If not, is there any point in filing this as a bug in R? I see there
  >> have been no (public) responses to Jari's email, yet the change is
  >> rather annoying, and I do not see the rationale for "printing" different
  >> parts of the output from step() in two different ways.
  >> 
  > I think this is a bug. You should not use message() with optional trace.
  > The template for the usage in step() is first

  > if (trace) message()

  > and later

  > if (trace) print()

  > If you specifically request printing setting  trace = TRUE, then you
  > should not get message().

  > Interestingly, message() seems to be a warning() that cannot be
  > suppressed by setting options.

  > This is so annoying that I haven't updated some of my Sweave documents.
  > It is better to have outdated documents than crippled documents.

  > You can handle this in sink(), but I don't know any trick for Sweave
  > (and it's a nuisance in sink() as well).


The topic is on the agenda, but no released code yet. Hadley Wickham
has code collecting all output, messages, warning etc that arise when
an expression is evaluated which can be used in various places like
sink or Sweave to solve this problem. We have already scheduled
discussions for a workshop which we both attend in 3 weeks.

Sorry for not replying to the original email.

Best,
Fritz

-- 
-----------------------------------------------------------------------
Prof. Dr. Friedrich Leisch 

Institut f?r Statistik                          Tel: (+49 89) 2180 3165
Ludwig-Maximilians-Universit?t                  Fax: (+49 89) 2180 5308
Ludwigstra?e 33
D-80539 M?nchen                 http://www.stat.uni-muenchen.de/~leisch


From ripley at stats.ox.ac.uk  Wed Jun 13 16:51:36 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 13 Jun 2007 16:51:36 +0200 (CEST)
Subject: [Rd] (PR#9733) subset() only returns first of equally named
Message-ID: <20070613145136.9C08948DC7@slim.kubism.ku.dk>

>From NEWS for 2.5.0 patched:

     o   <a data.frame>[i, j] could sometimes select the wrong column
         when j is numeric if there are duplicate column names.

> subset(test, TRUE, c(2,3))
   a a.1
1 2   3

Please do not report bugs that are already fixed (as asked in the FAQ).


On Wed, 13 Jun 2007, beierm at uni-duesseldorf.de wrote:

> Full_Name: Manfred Beier
> Version: 2.5.0 (2007-04-23)
> OS: linux-gnu
> Submission from: (NULL) (134.99.204.101)
>
>
> When multiple columns in a data.frame have the same name, only the first of them
> is returned by the subset() function even when selected numerically.
>
>> test <- data.frame(cbind(1,2,3))
>> names(test) <- c("a","a","a")
>> test
>  a a a
> 1 1 2 3
>> subset(test, TRUE, c(2,3))
>  a a.1
> 1 1   1
>
> For matrices subset() works correctly.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Wed Jun 13 17:04:40 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 13 Jun 2007 08:04:40 -0700
Subject: [Rd] step() in sink() and Sweave()
In-Reply-To: <1181742212.26511.12.camel@biol102145.oulu.fi> (Jari Oksanen's
	message of "Wed, 13 Jun 2007 16:43:32 +0300")
References: <1178698222.28498.18.camel@biol102145.oulu.fi>
	<1181737995.3695.38.camel@gsimpson.geog.ucl.ac.uk>
	<1181742212.26511.12.camel@biol102145.oulu.fi>
Message-ID: <m2zm33dhfb.fsf@ziti.local>

Jari Oksanen <jarioksa at sun3.oulu.fi> writes:

> On Wed, 2007-06-13 at 13:33 +0100, Gavin Simpson wrote:
>> Dear Developers,
>> 
>> This change also just bit me whilst updating Sweave documents for some
>> computer classes.
>> 
>> Is there a work-around that can be employed so that we get both the
>> message() bits and the print() bits in the same place for our Sweave
>> files?
>> 
>> If not, is there any point in filing this as a bug in R? I see there
>> have been no (public) responses to Jari's email, yet the change is
>> rather annoying, and I do not see the rationale for "printing" different
>> parts of the output from step() in two different ways.
>> 
> I think this is a bug. You should not use message() with optional trace.
> The template for the usage in step() is first
>
> if (trace) message()
>
> and later
>
> if (trace) print()
>
> If you specifically request printing setting  trace = TRUE, then you
> should not get message().
>
> Interestingly, message() seems to be a warning() that cannot be
> suppressed by setting options.

message is a condition and so is a warning.  This means you have some
control over them.  For example, you can create a wrapper for step
that uses withCallingHandlers to cat out all messages (or print them,
or email them to your friends :-)

mystep <- function(object, scope, scale = 0,
                   direction = c("both", "backward", "forward"),
                   trace = 1, keep = NULL, steps = 1000, k = 2, 
                   ...)
{
    withCallingHandlers(step(object=object, scope=scope, scale=scale,
                             direction=direction, trace=trace,
                             keep=keep, steps=steps, k=k, ...),
                        message=function(m) {
                            cat(conditionMessage(m))
                        })
}

> This is so annoying that I haven't updated some of my Sweave documents.
> It is better to have outdated documents than crippled documents.

I'm not trying to argue that the function shouldn't change, but if it
is so annoying, you can also resolve this problem by defining your own
step function and calling it (forgetting about withCallingHandlers).
Clearly not ideal, but at the same time in the spirit of open source,
no?

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From P.Dalgaard at biostat.ku.dk  Wed Jun 13 17:34:22 2007
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 13 Jun 2007 17:34:22 +0200
Subject: [Rd] R 2.5.1 scheduled for June 28
Message-ID: <46700E7E.4020208@biostat.ku.dk>

This is to announce that we plan to release R version 2.5.1 on Thursday
June 28, 2007. The following information is mainly for developers,
package maintainers and repository maintainers. 

The planned procedure is

June 14: Feature Freeze          2.5.1 beta
June 21: Code Freeze             2.5.1 RC
June 28: Release                 2.5.1

FF:  Feature set complete, only bugfixing from now on
CF:  Only critical bugfixes and platform build issues

Maintainers of recommended packages should notice that as they become
part of the final R tarball, we expect them to follow a similar freeze
pattern (and beware of potential CRAN delays, so please do not cut it
too close to the deadlines).

The source beta/RC tarballs will be made available daily
(barring build troubles) by a cron job running at 4AM CET, and the
tarballs can be picked up at 

http://cran.r-project.org/src/base-prerelease/

a little later. 

The various freeze points are marked by changes to the VERSION file
this is also done automatically by a cron job which runs just after
midnight on the relevant days.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From gkotler at rics.bwh.harvard.edu  Wed Jun 13 17:38:06 2007
From: gkotler at rics.bwh.harvard.edu (Gregory Kotler)
Date: Wed, 13 Jun 2007 11:38:06 -0400
Subject: [Rd] Test for Equality of Coefficient of Variation
Message-ID: <46700F5E.10504@rics.bwh.harvard.edu>

Hi ALL,
Do R have any tools for testing equality of coefficients of variation 
for k normal populations ?
 
  Thank you,
    Gregory Kotler


From ross at biostat.ucsf.edu  Wed Jun 13 18:48:01 2007
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Wed, 13 Jun 2007 09:48:01 -0700
Subject: [Rd] Reported invalid memory references
Message-ID: <1181753281.19590.24.camel@corn.betterworld.us>

While testing for leaks in my own code I noticed some reported memory
problems from valgrind, invoked with 
$ R --vanilla -d "valgrind --leak-check=full"

This is on Debian GNU/Linux (testing aka lenny) with a 2.6 kernel, R
package version 2.4.1-2.  I was running in an emacs shell.

The immediate source of all the problems before I get to the prompt is
the system dynamic loader ld-2.5.so, invoked from R.  Then, when I exit,
there are a bunch of reported leaks, some of which appear to be more
directly from R (though some involve, e.g., readline).

Are these reported errors actually problems?  If so, do they indicate
problems in R or some other component (e.g., ld.so).  Put more
practically, should I file one or more bugs, and if so, against what?

Thanks.
Ross Boylan

==30551== Invalid read of size 4
==30551==    at 0x4016503: (within /lib/ld-2.5.so)
==30551==    by 0x4006009: (within /lib/ld-2.5.so)
==30551==    by 0x40084F5: (within /lib/ld-2.5.so)
==30551==    by 0x40121D4: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF73E: __nss_lookup_function
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF82F: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43F1595: __nss_passwd_lookup
(in /lib/i686/cmov/libc-2.5.so)
==30551==  Address 0x4EFB560 is 32 bytes inside a block of size 34
alloc'd
==30551==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30551==    by 0x4008AF3: (within /lib/ld-2.5.so)
==30551==    by 0x40121D4: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF73E: __nss_lookup_function
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF82F: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43F1595: __nss_passwd_lookup
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x439D87D: getpwuid_r (in /lib/i686/cmov/libc-2.5.so)
==30551== 
==30551== Invalid read of size 4
==30551==    at 0x4016530: (within /lib/ld-2.5.so)
==30551==    by 0x4006009: (within /lib/ld-2.5.so)
==30551==    by 0x40084F5: (within /lib/ld-2.5.so)
==30551==    by 0x400C616: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x400CBDA: (within /lib/ld-2.5.so)
==30551==    by 0x4012234: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==  Address 0x4EFB8A8 is 24 bytes inside a block of size 27
alloc'd
==30551==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30551==    by 0x4008AF3: (within /lib/ld-2.5.so)
==30551==    by 0x400C616: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x400CBDA: (within /lib/ld-2.5.so)
==30551==    by 0x4012234: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF73E: __nss_lookup_function
(in /lib/i686/cmov/libc-2.5.so)
==30551== 
==30551== Conditional jump or move depends on uninitialised value(s)
==30551==    at 0x400B3CC: (within /lib/ld-2.5.so)
==30551==    by 0x401230B: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF73E: __nss_lookup_function
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF82F: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43F1595: __nss_passwd_lookup
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x439D87D: getpwuid_r (in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x439D187: getpwuid (in /lib/i686/cmov/libc-2.5.so)
==30551== 
==30551== Conditional jump or move depends on uninitialised value(s)
==30551==    at 0x400B0CA: (within /lib/ld-2.5.so)
==30551==    by 0x401230B: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF73E: __nss_lookup_function
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF82F: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43F1595: __nss_passwd_lookup
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x439D87D: getpwuid_r (in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x439D187: getpwuid (in /lib/i686/cmov/libc-2.5.so)
==30551== 
==30551== Invalid read of size 4
==30551==    at 0x4016547: (within /lib/ld-2.5.so)
==30551==    by 0x4006009: (within /lib/ld-2.5.so)
==30551==    by 0x40084F5: (within /lib/ld-2.5.so)
==30551==    by 0x40121D4: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF73E: __nss_lookup_function
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x42FDF7B: (within /lib/i686/cmov/libnss_compat-2.5.so)
==30551==    by 0x42FF0AC: _nss_compat_getpwuid_r
(in /lib/i686/cmov/libnss_compat-2.5.so)
==30551==  Address 0x4EFBF54 is 28 bytes inside a block of size 31
alloc'd
==30551==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30551==    by 0x4008AF3: (within /lib/ld-2.5.so)
==30551==    by 0x40121D4: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF73E: __nss_lookup_function
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x42FDF7B: (within /lib/i686/cmov/libnss_compat-2.5.so)
==30551==    by 0x42FF0AC: _nss_compat_getpwuid_r
(in /lib/i686/cmov/libnss_compat-2.5.so)
==30551==    by 0x439D7A2: getpwuid_r (in /lib/i686/cmov/libc-2.5.so)
==30551== 
==30551== Invalid read of size 4
==30551==    at 0x4016503: (within /lib/ld-2.5.so)
==30551==    by 0x4006009: (within /lib/ld-2.5.so)
==30551==    by 0x40084F5: (within /lib/ld-2.5.so)
==30551==    by 0x400C616: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x400CBDA: (within /lib/ld-2.5.so)
==30551==    by 0x4012234: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==  Address 0x4EFC290 is 32 bytes inside a block of size 33
alloc'd
==30551==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30551==    by 0x4008AF3: (within /lib/ld-2.5.so)
==30551==    by 0x400C616: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x400CBDA: (within /lib/ld-2.5.so)
==30551==    by 0x4012234: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x44142E1: (within /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4414494: __libc_dlopen_mode
(in /lib/i686/cmov/libc-2.5.so)
==30551==    by 0x43EF73E: __nss_lookup_function
(in /lib/i686/cmov/libc-2.5.so)
==30551== 
==30551== Conditional jump or move depends on uninitialised value(s)
==30551==    at 0x40163E4: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x48D1C2C: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x48D22AB: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x48D1B63: dlopen (in /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x420BCE5: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404403B: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404463C: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x410BCCD: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x40D5550: Rf_eval (in /usr/lib/R/lib/libR.so)
==30551== 
==30551== Conditional jump or move depends on uninitialised value(s)
==30551==    at 0x40163EF: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x48D1C2C: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x48D22AB: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x48D1B63: dlopen (in /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x420BCE5: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404403B: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404463C: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x410BCCD: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x40D5550: Rf_eval (in /usr/lib/R/lib/libR.so)
==30551== 
==30551== Conditional jump or move depends on uninitialised value(s)
==30551==    at 0x40163FA: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x48D1C2C: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x48D22AB: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x48D1B63: dlopen (in /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x420BCE5: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404403B: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404463C: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x410BCCD: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x40D5550: Rf_eval (in /usr/lib/R/lib/libR.so)
==30551== 
==30551== Conditional jump or move depends on uninitialised value(s)
==30551==    at 0x4016405: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x48D1C2C: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x48D22AB: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x48D1B63: dlopen (in /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x420BCE5: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404403B: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404463C: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x410BCCD: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x40D5550: Rf_eval (in /usr/lib/R/lib/libR.so)
==30551== 
==30551== Invalid read of size 4
==30551==    at 0x4016530: (within /lib/ld-2.5.so)
==30551==    by 0x4006009: (within /lib/ld-2.5.so)
==30551==    by 0x40084F5: (within /lib/ld-2.5.so)
==30551==    by 0x40121D4: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x48D1C2C: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x48D22AB: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x48D1B63: dlopen (in /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x420BCE5: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404403B: (within /usr/lib/R/lib/libR.so)
==30551==  Address 0x5300E00 is 40 bytes inside a block of size 43
alloc'd
==30551==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30551==    by 0x40077B4: (within /lib/ld-2.5.so)
==30551==    by 0x4008439: (within /lib/ld-2.5.so)
==30551==    by 0x40121D4: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x48D1C2C: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x48D22AB: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x48D1B63: dlopen (in /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x420BCE5: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404403B: (within /usr/lib/R/lib/libR.so)
==30551== 
==30551== Conditional jump or move depends on uninitialised value(s)
==30551==    at 0x400AF8B: (within /lib/ld-2.5.so)
==30551==    by 0x401230B: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x48D1C2C: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x48D22AB: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x48D1B63: dlopen (in /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x420BCE5: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404403B: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404463C: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x410BCCD: (within /usr/lib/R/lib/libR.so)
==30551== 
==30551== Conditional jump or move depends on uninitialised value(s)
==30551==    at 0x400B356: (within /lib/ld-2.5.so)
==30551==    by 0x401230B: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x48D1C2C: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x48D22AB: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x48D1B63: dlopen (in /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x420BCE5: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404403B: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404463C: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x410BCCD: (within /usr/lib/R/lib/libR.so)
==30551== 
==30551== Conditional jump or move depends on uninitialised value(s)
==30551==    at 0x400B1D8: (within /lib/ld-2.5.so)
==30551==    by 0x401230B: (within /lib/ld-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x4011C5D: (within /lib/ld-2.5.so)
==30551==    by 0x48D1C2C: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x400E255: (within /lib/ld-2.5.so)
==30551==    by 0x48D22AB: (within /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x48D1B63: dlopen (in /lib/i686/cmov/libdl-2.5.so)
==30551==    by 0x420BCE5: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404403B: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x404463C: (within /usr/lib/R/lib/libR.so)
==30551==    by 0x410BCCD: (within /usr/lib/R/lib/libR.so)

R version 2.4.1 (2006-12-18)



If I then type q(), I get these leaks reported:
==30906== 
==30906== ERROR SUMMARY: 43 errors from 22 contexts (suppressed: 58 from
1)
==30906== malloc/free: in use at exit: 13,184,322 bytes in 6,493 blocks.
==30906== malloc/free: 40,226 allocs, 33,733 frees, 58,642,360 bytes
allocated.
==30906== For counts of detected errors, rerun with: -v
==30906== searching for pointers to 6,493 not-freed blocks.
==30906== checked 13,097,152 bytes.
==30906== 
==30906== 
==30906== 4 bytes in 1 blocks are definitely lost in loss record 1 of 53
==30906==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30906==    by 0x4880C21: xmalloc (in /lib/libreadline.so.5.2)
==30906==    by 0x4869109: readline_internal_teardown
(in /lib/libreadline.so.5.2)
==30906==    by 0x487C867: rl_callback_read_char
(in /lib/libreadline.so.5.2)
==30906==    by 0x420D34A: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x420E8F4: R_ReadConsole (in /usr/lib/R/lib/libR.so)
==30906==    by 0x40FAB8A: Rf_ReplIteration (in /usr/lib/R/lib/libR.so)
==30906==    by 0x40FACFD: run_Rmainloop (in /usr/lib/R/lib/libR.so)
==30906==    by 0x40FAD4B: Rf_mainloop (in /usr/lib/R/lib/libR.so)
==30906==    by 0x80486C5: main (in /usr/lib/R/bin/exec/R)
==30906== 
==30906== 
==30906== 35 bytes in 1 blocks are definitely lost in loss record 11 of
53
==30906==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30906==    by 0x41B8F55: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x40F9CF6: setup_Rmainloop (in /usr/lib/R/lib/libR.so)
==30906==    by 0x40FAD46: Rf_mainloop (in /usr/lib/R/lib/libR.so)
==30906==    by 0x80486C5: main (in /usr/lib/R/bin/exec/R)
==30906== 
==30906== 
==30906== 56 bytes in 14 blocks are definitely lost in loss record 13 of
53
==30906==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30906==    by 0x402353A: realloc (vg_replace_malloc.c:306)
==30906==    by 0x417A5F5: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x417A6E6: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x417A860: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x417C071: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x4069995: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x410BCCD: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x40D5550: Rf_eval (in /usr/lib/R/lib/libR.so)
==30906==    by 0x40D76B6: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x40D5550: Rf_eval (in /usr/lib/R/lib/libR.so)
==30906==    by 0x40D6BF6: (within /usr/lib/R/lib/libR.so)
==30906== 
==30906== 
==30906== 312 (72 direct, 240 indirect) bytes in 2 blocks are definitely
lost in loss record 19 of 53
==30906==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30906==    by 0x43EF967: (within /lib/i686/cmov/libc-2.5.so)
==30906==    by 0x43F01B5: __nss_database_lookup
(in /lib/i686/cmov/libc-2.5.so)
==30906==    by 0x42FDF5B: ???
==30906==    by 0x42FF0AC: ???
==30906==    by 0x439D7A2: getpwuid_r (in /lib/i686/cmov/libc-2.5.so)
==30906==    by 0x439D187: getpwuid (in /lib/i686/cmov/libc-2.5.so)
==30906==    by 0x4132CF0: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x410BCCD: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x40D5550: Rf_eval (in /usr/lib/R/lib/libR.so)
==30906==    by 0x40D82B5: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x40D5550: Rf_eval (in /usr/lib/R/lib/libR.so)
==30906== 
==30906== 
==30906== 579 bytes in 23 blocks are definitely lost in loss record 26
of 53
==30906==    at 0x40234B0: malloc (vg_replace_malloc.c:149)
==30906==    by 0x4045267: (within /usr/lib/R/lib/libR.so)
==30906==    by 0x404569F: process_system_Renviron
(in /usr/lib/R/lib/libR.so)
==30906==    by 0x420EE01: Rf_initialize_R (in /usr/lib/R/lib/libR.so)
==30906==    by 0x80486C0: main (in /usr/lib/R/bin/exec/R)
==30906== 
==30906== LEAK SUMMARY:
==30906==    definitely lost: 746 bytes in 41 blocks.
==30906==    indirectly lost: 240 bytes in 20 blocks.
==30906==      possibly lost: 0 bytes in 0 blocks.
==30906==    still reachable: 13,183,336 bytes in 6,432 blocks.
==30906==         suppressed: 0 bytes in 0 blocks.
==30906== Reachable blocks (those to which a pointer was found) are not
shown.
==30906== To see them, rerun with: --leak-check=full
--show-reachable=yes


From gavin.simpson at ucl.ac.uk  Wed Jun 13 18:50:20 2007
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 13 Jun 2007 17:50:20 +0100
Subject: [Rd] step() in sink() and Sweave()
In-Reply-To: <m2zm33dhfb.fsf@ziti.local>
References: <1178698222.28498.18.camel@biol102145.oulu.fi>
	<1181737995.3695.38.camel@gsimpson.geog.ucl.ac.uk>
	<1181742212.26511.12.camel@biol102145.oulu.fi>
	<m2zm33dhfb.fsf@ziti.local>
Message-ID: <1181753420.3695.55.camel@gsimpson.geog.ucl.ac.uk>

On Wed, 2007-06-13 at 08:04 -0700, Seth Falcon wrote:
> Jari Oksanen <jarioksa at sun3.oulu.fi> writes:
> 
> > On Wed, 2007-06-13 at 13:33 +0100, Gavin Simpson wrote:
> >> Dear Developers,
> >> 
> >> This change also just bit me whilst updating Sweave documents for some
> >> computer classes.
> >> 
> >> Is there a work-around that can be employed so that we get both the
> >> message() bits and the print() bits in the same place for our Sweave
> >> files?
> >> 
> >> If not, is there any point in filing this as a bug in R? I see there
> >> have been no (public) responses to Jari's email, yet the change is
> >> rather annoying, and I do not see the rationale for "printing" different
> >> parts of the output from step() in two different ways.
> >> 
> > I think this is a bug. You should not use message() with optional trace.
> > The template for the usage in step() is first
> >
> > if (trace) message()
> >
> > and later
> >
> > if (trace) print()
> >
> > If you specifically request printing setting  trace = TRUE, then you
> > should not get message().
> >
> > Interestingly, message() seems to be a warning() that cannot be
> > suppressed by setting options.
> 
> message is a condition and so is a warning.  This means you have some
> control over them.  For example, you can create a wrapper for step
> that uses withCallingHandlers to cat out all messages (or print them,
> or email them to your friends :-)
> 
> mystep <- function(object, scope, scale = 0,
>                    direction = c("both", "backward", "forward"),
>                    trace = 1, keep = NULL, steps = 1000, k = 2, 
>                    ...)
> {
>     withCallingHandlers(step(object=object, scope=scope, scale=scale,
>                              direction=direction, trace=trace,
>                              keep=keep, steps=steps, k=k, ...),
>                         message=function(m) {
>                             cat(conditionMessage(m))
>                         })
> }
> 
> > This is so annoying that I haven't updated some of my Sweave documents.
> > It is better to have outdated documents than crippled documents.
> 
> I'm not trying to argue that the function shouldn't change, but if it
> is so annoying, you can also resolve this problem by defining your own
> step function and calling it (forgetting about withCallingHandlers).
> Clearly not ideal, but at the same time in the spirit of open source,
> no?

Thanks for the info on bypassing this issue Seth.

I disagree about your final comment though. If one is trying to teach
the use of step() to people in a computer practical class and you want
to show example output along with the commands used to produce it, you
can't do what you did and produce your own function - it wouldn't be a
good way to teach step() if I was using mystep() in the example code!

If this had been a report I was writing, I'd have just hacked my own
version of step that used print() all the time; one of the reasons I use
R in the first place is that I can go and do this. But this isn't an
option when teaching.

I am still a little mystified as to why the message() and print() bits
are used anyway. I mean, someone obviously felt this was a good idea or
they wouldn't have spent their time making the changes, and I accept
that I am probably not seeing the bigger picture here, but I don't see
the difference between the two bits of information and why you'd want to
treat them differently - why isn't the bit that is print()ed considered
a message for example?

Cheers,

G

> 
> + seth
> 
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Gavin Simpson                 [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From hpages at fhcrc.org  Wed Jun 13 20:07:27 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 13 Jun 2007 11:07:27 -0700
Subject: [Rd] R.INSTALL on Windows
In-Reply-To: <45A8114B.3020500@fhcrc.org>
References: <45A8114B.3020500@fhcrc.org>
Message-ID: <4670325F.6010004@fhcrc.org>

Hi,

This has been addressed in R-2.5.0 and R-2.6.0. Thanks!

H.

Herve Pages wrote:
> Hi,
> 
> I'd like to point out a potential problem with the current R.INSTALL
> directory created by 'R CMD INSTALL' when applied to a source package.
> 
> On Windows (and, AFAIK, only on Windows), 'R CMD INSTALL mypackage_1.0.0.tar.gz'
> creates a temporary R.INSTALL directory in the current directory. This
> directory is removed before the command terminates but only if it was
> successful.
> 
> One inconvenient of this behaviour is that you can get a clash when you try to
> build 2 Windows binary packages (with 'R CMD INSTALL --build') at the same time
> in the same directory. I can circumvent the 00LOCK mechanism by providing
> a different --library option to the 2 commands but, if I'm running the 2 commands
> in the same directory, then they will be creating and using the same R.INSTALL.
> Then, the first command who terminates will remove it and break the other command.
> 
> Is there an easy way to prevent this?
> 
> Is there any reason why R.INSTALL is not kept at the end of 'R CMD INSTALL',
> or why 'R CMD INSTALL' doesn't use a package specific directory name
> (e.g. R.INSTALL.mypackage) like 'R CMD check' does, or why it doesn't
> use one of the "standard" temp places (defined by env. var. TMP or TMPDIR).
> 
> Thanks in advance!
> 
> Cheers,
> H.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From sfalcon at fhcrc.org  Wed Jun 13 20:28:26 2007
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 13 Jun 2007 11:28:26 -0700
Subject: [Rd] PATCH: install inst/ before doing lazyload on Windows
In-Reply-To: <m2y7iog46p.fsf@ziti.local> (Seth Falcon's message of "Tue,
	12 Jun 2007 16:10:06 -0700")
References: <m2y7iog46p.fsf@ziti.local>
Message-ID: <m2d4zzd7zp.fsf@ziti.local>

Seth Falcon <sfalcon at fhcrc.org> writes:
> On Windows, package files in the inst/ subdir are installed after the
> lazyload creation.  This differs from Linux where inst/ is installed
> _before_ lazyload creation.
>
> Since packages may need data in inst, I think the order on Windows
> should be changed.  Perhaps like this:

This has been fixed in R devel and patched.

Thanks!

+ seth

-- 
Seth Falcon | Computational Biology | Fred Hutchinson Cancer Research Center
http://bioconductor.org


From maechler at stat.math.ethz.ch  Thu Jun 14 11:13:47 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 14 Jun 2007 11:13:47 +0200
Subject: [Rd] Test for Equality of Coefficient of Variation
In-Reply-To: <46700F5E.10504@rics.bwh.harvard.edu>
References: <46700F5E.10504@rics.bwh.harvard.edu>
Message-ID: <18033.1739.554740.847373@stat.math.ethz.ch>

Please repost this on R-help, 
which is appropriate here.

Regards, Martin Maechler

>>>>> "GK" == Gregory Kotler <gkotler at rics.bwh.harvard.edu>
>>>>>     on Wed, 13 Jun 2007 11:38:06 -0400 writes:

    GK> Hi ALL,
    GK> Do R have any tools for testing equality of coefficients of variation 
    GK> for k normal populations ?
 
    GK> Thank you,
    GK> Gregory Kotler

    GK> ______________________________________________
    GK> R-devel at r-project.org mailing list
    GK> https://stat.ethz.ch/mailman/listinfo/r-devel


From jeff.horner at vanderbilt.edu  Thu Jun 14 16:49:10 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Thu, 14 Jun 2007 09:49:10 -0500
Subject: [Rd] Clarification for readChar man page
Message-ID: <46715566.5010308@vanderbilt.edu>

Hi,

Here's a patch to the readChar manual page (R-trunk as of today) that 
better clarifies readChar's return value. It could use some work as I'd 
also like to add some text about using nchar() to find the length of the 
string that readchar() returns, but I'm unsure which of type="bytes" or 
type="chars" to mention. Is it type="chars"?

Index: src/library/base/man/readChar.Rd
===================================================================
--- src/library/base/man/readChar.Rd    (revision 41943)
+++ src/library/base/man/readChar.Rd    (working copy)
@@ -57,8 +57,8 @@
  }

  \value{
-  For \code{readChar}, a character vector of length the number of
-  items read (which might be less than \code{length(nchars)}).
+  For \code{readChar}, a character vector of length 1 with the number
+  of characters less than or equal to nchars.

    For \code{writeChar}, a raw vector (if \code{con} is a raw vector) or
    invisibly \code{NULL}.


Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From murdoch at stats.uwo.ca  Thu Jun 14 17:11:29 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 14 Jun 2007 11:11:29 -0400
Subject: [Rd] Clarification for readChar man page
In-Reply-To: <46715566.5010308@vanderbilt.edu>
References: <46715566.5010308@vanderbilt.edu>
Message-ID: <46715AA1.3020707@stats.uwo.ca>

On 6/14/2007 10:49 AM, Jeffrey Horner wrote:
> Hi,
> 
> Here's a patch to the readChar manual page (R-trunk as of today) that 
> better clarifies readChar's return value. 

Your update is not right.  For example:

x <- as.raw(32:96)
readChar(x, nchars=rep(2,100))

This returns a character vector of length 100, of which the first 32 
elements have 2 chars, the next one has 1, and the rest are "".

So the length of nchars really does affect the length of the value.

Now, I haven't looked at the code, but it's possible we could delete the 
"(which might be less than \code{length(nchars)})" remark, and if not, 
it would be useful to explain the situations in which the return value 
could be shorter than the nchars vector.

Duncan Murdoch


It could use some work as I'd
> also like to add some text about using nchar() to find the length of the 
> string that readchar() returns, but I'm unsure which of type="bytes" or 
> type="chars" to mention. Is it type="chars"?
> 
> Index: src/library/base/man/readChar.Rd
> ===================================================================
> --- src/library/base/man/readChar.Rd    (revision 41943)
> +++ src/library/base/man/readChar.Rd    (working copy)
> @@ -57,8 +57,8 @@
>   }
> 
>   \value{
> -  For \code{readChar}, a character vector of length the number of
> -  items read (which might be less than \code{length(nchars)}).
> +  For \code{readChar}, a character vector of length 1 with the number
> +  of characters less than or equal to nchars.
> 
>     For \code{writeChar}, a raw vector (if \code{con} is a raw vector) or
>     invisibly \code{NULL}.
> 
> 
> Jeff


From ripley at stats.ox.ac.uk  Thu Jun 14 17:14:23 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 14 Jun 2007 16:14:23 +0100 (BST)
Subject: [Rd] package check note: no visible global function definition
 (in functions using Tcl/Tk)
In-Reply-To: <m2abv6v3ba.fsf@ziti.local>
References: <466D5A0F.2090907@tu-dresden.de>
	<Pine.LNX.4.64.0706111638530.22283@gannet.stats.ox.ac.uk>
	<m2abv6v3ba.fsf@ziti.local>
Message-ID: <Pine.LNX.4.64.0706141606001.19996@gannet.stats.ox.ac.uk>

On Mon, 11 Jun 2007, Seth Falcon wrote:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> It seems that is happens if package tcltk is missing from the Depends:
>> list in the DESCRIPTION file.  I just tested with Amelia and homals and
>> that solved the various warnings in both cases.
>
> Adding tcltk to Depends may not always be the desried solution.  If

But I didn't say it was (I didn't mention a solution at all). What I did 
say was that it happened if 'tcltk' was missing (which implies that it 
should have been there), and gave two of the tens of instances of this on 
CRAN.

You may prefer the version now in R-devel: this goes slightly the other 
way in that it loads all the Suggests/Enhances packages and also a dummy 
compatibility package for platform differences.  Neither this nor the 
previous version can test the conditionalization is correct, as the code 
is analysed but no path through it is run.  It is entirely possible that 
the problems flagged are in code that can never be reached: this shows up 
dramatically in examples such as Hmisc with non-R code (for S3 or S4).


> tcltk is already in Suggests, for example, and the intention is to
> optionally provide GUI features, then the code may be correct as-is.
> That is, codetools will issue the NOTEs if you have a function that
> looks like:
>
>   f <- function() {
>     if (require("tckltk")) {
>             someTckltkFunctionHere()
>     } else
>             otherwiseFunction()
>     }
>   }
>
> There are a number of packages in the BioC repository that provide
> such optional features (not just for tcltk) and it would be nice to
> have a way of declaring the use such that the NOTE is silenced.
>
> [Note 1: I don't have any ideas at the moment for how this could
> work.]
>
> [Note 2: Despite the false-positives, I've already caught a handful of
> bugs by reading over these NOTEs and think they provide a lot of value
> to the check process]
>
> + seth
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jeff.horner at vanderbilt.edu  Thu Jun 14 17:52:20 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Thu, 14 Jun 2007 10:52:20 -0500
Subject: [Rd] Clarification for readChar man page
In-Reply-To: <46715AA1.3020707@stats.uwo.ca>
References: <46715566.5010308@vanderbilt.edu> <46715AA1.3020707@stats.uwo.ca>
Message-ID: <46716434.7060603@vanderbilt.edu>

Duncan Murdoch wrote:
> On 6/14/2007 10:49 AM, Jeffrey Horner wrote:
>> Hi,
>>
>> Here's a patch to the readChar manual page (R-trunk as of today) that 
>> better clarifies readChar's return value. 
> 
> Your update is not right.  For example:
> 
> x <- as.raw(32:96)
> readChar(x, nchars=rep(2,100))
> 
> This returns a character vector of length 100, of which the first 32 
> elements have 2 chars, the next one has 1, and the rest are "".
> 
> So the length of nchars really does affect the length of the value.
> 
> Now, I haven't looked at the code, but it's possible we could delete the 
> "(which might be less than \code{length(nchars)})" remark, and if not, 
> it would be useful to explain the situations in which the return value 
> could be shorter than the nchars vector.

Well, this is rather a misunderstanding on my part; I completely forgot 
about vectorization. The manual page makes sense to me now.

But the situation about the return value possibly being less than 
length(nchars) isn't clear. Consider a 101 byte text file in a 
non-multibyte character locale:

f <- tempfile()
writeChar(paste(rep(seq(0,9),10),collapse=''),con=f)

and calling readChar() to read 100 bytes with length(nchar)=10:

 > readChar(f,nchar=rep(10,10))
  [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
  [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"

and readChar() reading the entire file with length(nchar)=11:

 > readChar(f,nchar=rep(10,11))
  [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
  [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
[11] "\0"

but the following two outputs are confusing. readchar() with 
length(nchar)>=12 returns a character vector length 12:

 > readChar(f,nchar=rep(10,12))
  [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
  [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
[11] "\0"         ""
 > readChar(f,nchar=rep(10,13))
  [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
  [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
[11] "\0"         ""

It seems that the first time EOF is encountered on a read operation, an 
empty string is returned, but on subsequent reads nothing is returned. 
Is this intended behavior?

Jeff

> 
> Duncan Murdoch
> 
> 
> It could use some work as I'd
>> also like to add some text about using nchar() to find the length of 
>> the string that readchar() returns, but I'm unsure which of 
>> type="bytes" or type="chars" to mention. Is it type="chars"?
>>
>> Index: src/library/base/man/readChar.Rd
>> ===================================================================
>> --- src/library/base/man/readChar.Rd    (revision 41943)
>> +++ src/library/base/man/readChar.Rd    (working copy)
>> @@ -57,8 +57,8 @@
>>   }
>>
>>   \value{
>> -  For \code{readChar}, a character vector of length the number of
>> -  items read (which might be less than \code{length(nchars)}).
>> +  For \code{readChar}, a character vector of length 1 with the number
>> +  of characters less than or equal to nchars.
>>
>>     For \code{writeChar}, a raw vector (if \code{con} is a raw vector) or
>>     invisibly \code{NULL}.
>>
>>
>> Jeff
> 


-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From hpages at fhcrc.org  Thu Jun 14 21:41:13 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Thu, 14 Jun 2007 12:41:13 -0700
Subject: [Rd] Missing args with a default value in S4 methods
Message-ID: <467199D9.6090205@fhcrc.org>

Hi,


Strange things happen with missing args in S4 methods:

  > setGeneric("mygen", signature="x", function(x, ...) standardGeneric("mygen"))
  [1] "mygen"

  > setMethod("mygen", "character", function(x, y=12, z, ...) {cat(missing(y), "\n"); cat(y, "\n")})
  [1] "mygen"

  > mygen("aa", z=99)
  TRUE
  12

  > mygen("aa", , 99)
  TRUE
  Error in cat(y, "\n") : argument is missing, with no default
                                      ^^^^^^^       ^^^^^^^^^^
                                       TRUE          NOT TRUE!


For "normal" functions, things work as expected:

  > myfun <- function(x, y=12, z, ...) {cat(missing(y), "\n"); cat(y, "\n")}

  > myfun("aa", z=99)
  TRUE
  12

  > myfun("aa", , 99)
  TRUE
  12

And with S3 generics too:

  > dd <- data.frame(aa=letters[1:9], ii=9:1)
  > head(dd, z="ignored")
    aa ii
  1  a  9
  2  b  8
  3  c  7
  4  d  6
  5  e  5
  6  f  4

  > head(dd, , "ignored")
    aa ii
  1  a  9
  2  b  8
  3  c  7
  4  d  6
  5  e  5
  6  f  4

Cheers,
H.


From jeff.horner at vanderbilt.edu  Thu Jun 14 23:05:25 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Thu, 14 Jun 2007 16:05:25 -0500
Subject: [Rd] readchar() bug or feature? was Re: Clarification for readChar
 man page
In-Reply-To: <46716434.7060603@vanderbilt.edu>
References: <46715566.5010308@vanderbilt.edu> <46715AA1.3020707@stats.uwo.ca>
	<46716434.7060603@vanderbilt.edu>
Message-ID: <4671AD95.8050605@vanderbilt.edu>

Jeffrey Horner wrote:
> Duncan Murdoch wrote:
>> On 6/14/2007 10:49 AM, Jeffrey Horner wrote:
>>> Hi,
>>>
>>> Here's a patch to the readChar manual page (R-trunk as of today) that 
>>> better clarifies readChar's return value. 
>> Your update is not right.  For example:
>>
>> x <- as.raw(32:96)
>> readChar(x, nchars=rep(2,100))
>>
>> This returns a character vector of length 100, of which the first 32 
>> elements have 2 chars, the next one has 1, and the rest are "".
>>
>> So the length of nchars really does affect the length of the value.
>>
>> Now, I haven't looked at the code, but it's possible we could delete the 
>> "(which might be less than \code{length(nchars)})" remark, and if not, 
>> it would be useful to explain the situations in which the return value 
>> could be shorter than the nchars vector.
> 
> Well, this is rather a misunderstanding on my part; I completely forgot 
> about vectorization. The manual page makes sense to me now.
> 
> But the situation about the return value possibly being less than 
> length(nchars) isn't clear. Consider a 101 byte text file in a 
> non-multibyte character locale:
> 
> f <- tempfile()
> writeChar(paste(rep(seq(0,9),10),collapse=''),con=f)
> 
> and calling readChar() to read 100 bytes with length(nchar)=10:
> 
>  > readChar(f,nchar=rep(10,10))
>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
> 
> and readChar() reading the entire file with length(nchar)=11:
> 
>  > readChar(f,nchar=rep(10,11))
>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
> [11] "\0"
> 
> but the following two outputs are confusing. readchar() with 
> length(nchar)>=12 returns a character vector length 12:
> 
>  > readChar(f,nchar=rep(10,12))
>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
> [11] "\0"         ""
>  > readChar(f,nchar=rep(10,13))
>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
> [11] "\0"         ""
> 
> It seems that the first time EOF is encountered on a read operation, an 
> empty string is returned, but on subsequent reads nothing is returned. 
> Is this intended behavior?

I believe this is an off-by-1 bug in do_readchar(). The following fix to 
R-trunk v41946 causes the above readchar() calls to cap the returned 
vector length at 11:

Index: src/main/connections.c
===================================================================
--- src/main/connections.c      (revision 41946)
+++ src/main/connections.c      (working copy)
@@ -3286,7 +3286,7 @@
             if(!con->open(con)) error(_("cannot open the connection"));
      }
      PROTECT(ans = allocVector(STRSXP, n));
-    for(i = 0, m = i+1; i < n; i++) {
+    for(i = 0, m = 0; i < n; i++) {
         len = INTEGER(nchars)[i];
         if(len == NA_INTEGER || len < 0)
             error(_("invalid value for '%s'"), "nchar");


Jeff

> 
> Jeff
> 
>> Duncan Murdoch
>>
>>
>> It could use some work as I'd
>>> also like to add some text about using nchar() to find the length of 
>>> the string that readchar() returns, but I'm unsure which of 
>>> type="bytes" or type="chars" to mention. Is it type="chars"?
>>>
>>> Index: src/library/base/man/readChar.Rd
>>> ===================================================================
>>> --- src/library/base/man/readChar.Rd    (revision 41943)
>>> +++ src/library/base/man/readChar.Rd    (working copy)
>>> @@ -57,8 +57,8 @@
>>>   }
>>>
>>>   \value{
>>> -  For \code{readChar}, a character vector of length the number of
>>> -  items read (which might be less than \code{length(nchars)}).
>>> +  For \code{readChar}, a character vector of length 1 with the number
>>> +  of characters less than or equal to nchars.
>>>
>>>     For \code{writeChar}, a raw vector (if \code{con} is a raw vector) or
>>>     invisibly \code{NULL}.
>>>
>>>
>>> Jeff
> 
> 


-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From bill at insightful.com  Thu Jun 14 23:05:42 2007
From: bill at insightful.com (Bill Dunlap)
Date: Thu, 14 Jun 2007 14:05:42 -0700 (PDT)
Subject: [Rd] package check note: no visible global function definition
 (in functions using Tcl/Tk)
In-Reply-To: <Pine.LNX.4.64.0706141606001.19996@gannet.stats.ox.ac.uk>
References: <466D5A0F.2090907@tu-dresden.de>
	<Pine.LNX.4.64.0706111638530.22283@gannet.stats.ox.ac.uk>
	<m2abv6v3ba.fsf@ziti.local>
	<Pine.LNX.4.64.0706141606001.19996@gannet.stats.ox.ac.uk>
Message-ID: <Pine.GSO.4.56.0706141353140.5109@durian.statsci.com>

On Thu, 14 Jun 2007, Prof Brian Ripley wrote:

> You may prefer the version now in R-devel: this goes slightly the other
> way in that it loads all the Suggests/Enhances packages and also a dummy
> compatibility package for platform differences.  Neither this nor the
> previous version can test the conditionalization is correct, as the code
> is analysed but no path through it is run.  It is entirely possible that
> the problems flagged are in code that can never be reached: this shows up
> dramatically in examples such as Hmisc with non-R code (for S3 or S4).

Splus 8 has a code-analysis routine called unresolvedGlobalReferences()
that helps identify potential problems when moving R code to Splus.
It is nowhere near as comprehensive as codetools::checkUsage().
However it does look for if statements of the form
   if (is.R())
and
   if (!is.R())
and won't analyze the R-only parts of the code marked by such
statements.  It would be nice if checkUsage() could do that as well.
unresolvedGlobalReferences() does not look for anything more
complicated than is.R() or !is.R() in the if statement, so it is
better to change things like
   if (is.R() || version$major>=9) { # R or future version of Splus
to use a more complicated arrangement of if statements,
each with a simpler condition in it.

To get really fancy, checkUsage() might also look for statements like
   if (require(pkgName))
and run them both ways, to make sure the non-pkgName code really
works when pkgName is not available.   This might overload the
nightly build machine, but would be useful for the developer.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From statmobile at gmail.com  Thu Jun 14 23:45:58 2007
From: statmobile at gmail.com (statmobile at gmail.com)
Date: Thu, 14 Jun 2007 17:45:58 -0400
Subject: [Rd] LAPACK Headers
Message-ID: <20070614214558.GA20567@bjl>

Hey Everyone,

I'm running R 2.4.0 on Debian etch 4.0, and I'm trying to call some
LAPACK functions from the C code in my package.  Actually, to be
honest I'm not really having trouble using commands such as La_dgesv
from within my C code, but I do get warning when compiling the package
saying:

***.c: In function '***':
***.c:37: warning: implicit declaration of function 'La_dgesv'
***.c:37: warning: assignment makes pointer from integer without
a cast

I tried using:

#include <Rmodules/Rlapack.h>

but it won't compile the package at all with that included,
complaining that

***.h:5:30: error: Rmodules/Rlapack.h: No such file or directory

Can someone explain to me how I should include the headers to this
AWESOME wrapper code to the LAPACK libraries?  Am I not following the
proper protocol by using these La_* commands in my package source
code?

Note, I also have the following in Makevars

PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)

TIA!

I initially posted this question on the general list, but I didn't get
any responses.


From hin-tak.leung at cimr.cam.ac.uk  Fri Jun 15 00:27:44 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Thu, 14 Jun 2007 23:27:44 +0100
Subject: [Rd] LAPACK Headers
In-Reply-To: <20070614214558.GA20567@bjl>
References: <20070614214558.GA20567@bjl>
Message-ID: <4671C0E0.7010200@cimr.cam.ac.uk>

Try this? (this is on 2.5.0, I don't use 2.4.x anymore)

#include <R_ext/Lapack.h>

Have you actually tried grep dgesv $R_HOME/include/* $R_HOME/include/*/*
to see which file to include for dgesv ??

HTL

statmobile at gmail.com wrote:
> Hey Everyone,
> 
> I'm running R 2.4.0 on Debian etch 4.0, and I'm trying to call some
> LAPACK functions from the C code in my package.  Actually, to be
> honest I'm not really having trouble using commands such as La_dgesv
> from within my C code, but I do get warning when compiling the package
> saying:
> 
> ***.c: In function '***':
> ***.c:37: warning: implicit declaration of function 'La_dgesv'
> ***.c:37: warning: assignment makes pointer from integer without
> a cast
> 
> I tried using:
> 
> #include <Rmodules/Rlapack.h>
> 
> but it won't compile the package at all with that included,
> complaining that
> 
> ***.h:5:30: error: Rmodules/Rlapack.h: No such file or directory
> 
> Can someone explain to me how I should include the headers to this
> AWESOME wrapper code to the LAPACK libraries?  Am I not following the
> proper protocol by using these La_* commands in my package source
> code?
> 
> Note, I also have the following in Makevars
> 
> PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
> 
> TIA!
> 
> I initially posted this question on the general list, but I didn't get
> any responses.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From statmobile at gmail.com  Fri Jun 15 04:53:42 2007
From: statmobile at gmail.com (statmobile at gmail.com)
Date: Thu, 14 Jun 2007 22:53:42 -0400
Subject: [Rd] LAPACK Headers
In-Reply-To: <4671C0E0.7010200@cimr.cam.ac.uk>
References: <20070614214558.GA20567@bjl> <4671C0E0.7010200@cimr.cam.ac.uk>
Message-ID: <20070615025342.GA21406@bjl>

On Thu, Jun 14, 2007 at 11:27:44PM +0100, Hin-Tak Leung wrote:
> Try this? (this is on 2.5.0, I don't use 2.4.x anymore)
> 
> #include <R_ext/Lapack.h>
> 

I tried this, but I still get the warning of implicit declaration of
function.  It does compile though.

> Have you actually tried grep dgesv $R_HOME/include/* $R_HOME/include/*/*
> to see which file to include for dgesv ??

Well, when I grep the R source files, I get:

$ find . -name "*" -print | xargs grep -i 'La_dgesv'
./src/main/basedecl.h:SEXP La_dgesv(SEXP, SEXP, SEXP);
./src/main/lapack.c:SEXP La_dgesv(SEXP A, SEXP B, SEXP tol)
./src/main/lapack.c:SEXP La_dgesv(SEXP A, SEXP B, SEXP tol)
./src/main/registration.c:    CALLDEF(La_dgesv, 3),
./src/library/base/R/solve.R:     .Call("La_dgesv", a, b, tol, PACKAGE
= "base")
./src/library/base/R/solve.R:     drop(.Call("La_dgesv", a,
as.matrix(b), tol, PACKAGE = "base")))
./src/modules/lapack/Lapack.c:static SEXP modLa_dgesv(SEXP A, SEXP
Bin, SEXP tolin)
./src/modules/lapack/Lapack.c:    tmp->dgesv = modLa_dgesv;
./src/include/Rmodules/Rlapack.h:typedef SEXP (*Rf_La_dgesv)(SEXP A,
SEXP B, SEXP tol);
./src/include/Rmodules/Rlapack.h:    Rf_La_dgesv dgesv;

So it looks like La_dgesv is declared in basedecl.h, but I don't see
this file anywhere else on my machine.  Maybe I shouldn't be using
this function in my package?



> 
> HTL
> 
> statmobile at gmail.com wrote:
> >Hey Everyone,
> >
> >I'm running R 2.4.0 on Debian etch 4.0, and I'm trying to call some
> >LAPACK functions from the C code in my package.  Actually, to be
> >honest I'm not really having trouble using commands such as La_dgesv
> >from within my C code, but I do get warning when compiling the package
> >saying:
> >
> >***.c: In function '***':
> >***.c:37: warning: implicit declaration of function 'La_dgesv'
> >***.c:37: warning: assignment makes pointer from integer without
> >a cast
> >
> >I tried using:
> >
> >#include <Rmodules/Rlapack.h>
> >
> >but it won't compile the package at all with that included,
> >complaining that
> >
> >***.h:5:30: error: Rmodules/Rlapack.h: No such file or directory
> >
> >Can someone explain to me how I should include the headers to this
> >AWESOME wrapper code to the LAPACK libraries?  Am I not following the
> >proper protocol by using these La_* commands in my package source
> >code?
> >
> >Note, I also have the following in Makevars
> >
> >PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
> >
> >TIA!
> >
> >I initially posted this question on the general list, but I didn't get
> >any responses.
> >
> >______________________________________________
> >R-devel at r-project.org mailing list
> >https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Brian J. Lopes
PhD Student
Department of Statistics and Operations Research
University of North Carolina at Chapel Hill

To know that we know what we know, and that we do not know what we do
not know, that is true knowledge --Henry David Thoreau (quoting
Confucius): Walden


From ripley at stats.ox.ac.uk  Fri Jun 15 07:45:09 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 15 Jun 2007 06:45:09 +0100 (BST)
Subject: [Rd] LAPACK Headers
In-Reply-To: <20070615025342.GA21406@bjl>
References: <20070614214558.GA20567@bjl> <4671C0E0.7010200@cimr.cam.ac.uk>
	<20070615025342.GA21406@bjl>
Message-ID: <Pine.LNX.4.64.0706150639100.28253@gannet.stats.ox.ac.uk>

He wants "La_dgesv", which is not an LAPACK entry point at all, but a 
private part of R.  The header it is in is private and not installed.

There is no guarantee that it will remain visible to an R package, and the 
only safe thing to do is to copy the code.

On Thu, 14 Jun 2007, statmobile at gmail.com wrote:

> On Thu, Jun 14, 2007 at 11:27:44PM +0100, Hin-Tak Leung wrote:
>> Try this? (this is on 2.5.0, I don't use 2.4.x anymore)
>>
>> #include <R_ext/Lapack.h>
>>
>
> I tried this, but I still get the warning of implicit declaration of
> function.  It does compile though.
>
>> Have you actually tried grep dgesv $R_HOME/include/* $R_HOME/include/*/*
>> to see which file to include for dgesv ??
>
> Well, when I grep the R source files, I get:
>
> $ find . -name "*" -print | xargs grep -i 'La_dgesv'
> ./src/main/basedecl.h:SEXP La_dgesv(SEXP, SEXP, SEXP);
> ./src/main/lapack.c:SEXP La_dgesv(SEXP A, SEXP B, SEXP tol)
> ./src/main/lapack.c:SEXP La_dgesv(SEXP A, SEXP B, SEXP tol)
> ./src/main/registration.c:    CALLDEF(La_dgesv, 3),
> ./src/library/base/R/solve.R:     .Call("La_dgesv", a, b, tol, PACKAGE
> = "base")
> ./src/library/base/R/solve.R:     drop(.Call("La_dgesv", a,
> as.matrix(b), tol, PACKAGE = "base")))
> ./src/modules/lapack/Lapack.c:static SEXP modLa_dgesv(SEXP A, SEXP
> Bin, SEXP tolin)
> ./src/modules/lapack/Lapack.c:    tmp->dgesv = modLa_dgesv;
> ./src/include/Rmodules/Rlapack.h:typedef SEXP (*Rf_La_dgesv)(SEXP A,
> SEXP B, SEXP tol);
> ./src/include/Rmodules/Rlapack.h:    Rf_La_dgesv dgesv;
>
> So it looks like La_dgesv is declared in basedecl.h, but I don't see
> this file anywhere else on my machine.  Maybe I shouldn't be using
> this function in my package?
>
>
>
>>
>> HTL
>>
>> statmobile at gmail.com wrote:
>>> Hey Everyone,
>>>
>>> I'm running R 2.4.0 on Debian etch 4.0, and I'm trying to call some
>>> LAPACK functions from the C code in my package.  Actually, to be
>>> honest I'm not really having trouble using commands such as La_dgesv
>>> from within my C code, but I do get warning when compiling the package
>>> saying:
>>>
>>> ***.c: In function '***':
>>> ***.c:37: warning: implicit declaration of function 'La_dgesv'
>>> ***.c:37: warning: assignment makes pointer from integer without
>>> a cast
>>>
>>> I tried using:
>>>
>>> #include <Rmodules/Rlapack.h>
>>>
>>> but it won't compile the package at all with that included,
>>> complaining that
>>>
>>> ***.h:5:30: error: Rmodules/Rlapack.h: No such file or directory
>>>
>>> Can someone explain to me how I should include the headers to this
>>> AWESOME wrapper code to the LAPACK libraries?  Am I not following the
>>> proper protocol by using these La_* commands in my package source
>>> code?
>>>
>>> Note, I also have the following in Makevars
>>>
>>> PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
>>>
>>> TIA!
>>>
>>> I initially posted this question on the general list, but I didn't get
>>> any responses.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jmc at r-project.org  Fri Jun 15 15:12:32 2007
From: jmc at r-project.org (John Chambers)
Date: Fri, 15 Jun 2007 09:12:32 -0400
Subject: [Rd] Missing args with a default value in S4 methods
In-Reply-To: <467199D9.6090205@fhcrc.org>
References: <467199D9.6090205@fhcrc.org>
Message-ID: <46729040.9030706@r-project.org>

This has essentially nothing to do with methods, but rather with the 
treatment of missing arguments.

Consider:
 > foo <- function(x,...)bar(x,...)
 > bar <- function(x, y=12, z, ...) {cat(missing(y), "\n"); cat(y, "\n")}

This is the same argument-matching as your example, since the generic 
and method have different formal arguments.  And indeed,

 > foo("a",,z=99)
TRUE
Error in cat(y, "\n") : argument is missing, with no default

The error message is correct, but the argument in question is not "y" 
but "..1".  This is constructed and passed down as a special R object 
representing "missing-argument-with-no-default".   (Splus would have 
worked as you expected, because missingness there is a property of the 
function call, not of the object corresponding to the formal argument.)


Herve Pages wrote:
> Hi,
>
>
> Strange things happen with missing args in S4 methods:
>
>   > setGeneric("mygen", signature="x", function(x, ...) standardGeneric("mygen"))
>   [1] "mygen"
>
>   > setMethod("mygen", "character", function(x, y=12, z, ...) {cat(missing(y), "\n"); cat(y, "\n")})
>   [1] "mygen"
>
>   > mygen("aa", z=99)
>   TRUE
>   12
>
>   > mygen("aa", , 99)
>   TRUE
>   Error in cat(y, "\n") : argument is missing, with no default
>                                       ^^^^^^^       ^^^^^^^^^^
>                                        TRUE          NOT TRUE!
>
>
> For "normal" functions, things work as expected:
>
>   > myfun <- function(x, y=12, z, ...) {cat(missing(y), "\n"); cat(y, "\n")}
>
>   > myfun("aa", z=99)
>   TRUE
>   12
>
>   > myfun("aa", , 99)
>   TRUE
>   12
>
> And with S3 generics too:
>
>   > dd <- data.frame(aa=letters[1:9], ii=9:1)
>   > head(dd, z="ignored")
>     aa ii
>   1  a  9
>   2  b  8
>   3  c  7
>   4  d  6
>   5  e  5
>   6  f  4
>
>   > head(dd, , "ignored")
>     aa ii
>   1  a  9
>   2  b  8
>   3  c  7
>   4  d  6
>   5  e  5
>   6  f  4
>
> Cheers,
> H.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From jeff.horner at vanderbilt.edu  Fri Jun 15 17:07:28 2007
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Fri, 15 Jun 2007 10:07:28 -0500
Subject: [Rd] readchar() bug or feature? was Re: Clarification for
 readChar man page
In-Reply-To: <4671AD95.8050605@vanderbilt.edu>
References: <46715566.5010308@vanderbilt.edu> <46715AA1.3020707@stats.uwo.ca>
	<46716434.7060603@vanderbilt.edu> <4671AD95.8050605@vanderbilt.edu>
Message-ID: <4672AB30.4030206@vanderbilt.edu>

Jeffrey Horner wrote:
> Jeffrey Horner wrote:
>> Duncan Murdoch wrote:
>>> On 6/14/2007 10:49 AM, Jeffrey Horner wrote:
>>>> Hi,
>>>>
>>>> Here's a patch to the readChar manual page (R-trunk as of today) 
>>>> that better clarifies readChar's return value. 
>>> Your update is not right.  For example:
>>>
>>> x <- as.raw(32:96)
>>> readChar(x, nchars=rep(2,100))
>>>
>>> This returns a character vector of length 100, of which the first 32 
>>> elements have 2 chars, the next one has 1, and the rest are "".
>>>
>>> So the length of nchars really does affect the length of the value.
>>>
>>> Now, I haven't looked at the code, but it's possible we could delete 
>>> the "(which might be less than \code{length(nchars)})" remark, and if 
>>> not, it would be useful to explain the situations in which the return 
>>> value could be shorter than the nchars vector.
>>
>> Well, this is rather a misunderstanding on my part; I completely 
>> forgot about vectorization. The manual page makes sense to me now.
>>
>> But the situation about the return value possibly being less than 
>> length(nchars) isn't clear. Consider a 101 byte text file in a 
>> non-multibyte character locale:
>>
>> f <- tempfile()
>> writeChar(paste(rep(seq(0,9),10),collapse=''),con=f)
>>
>> and calling readChar() to read 100 bytes with length(nchar)=10:
>>
>>  > readChar(f,nchar=rep(10,10))
>>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>
>> and readChar() reading the entire file with length(nchar)=11:
>>
>>  > readChar(f,nchar=rep(10,11))
>>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>> [11] "\0"
>>
>> but the following two outputs are confusing. readchar() with 
>> length(nchar)>=12 returns a character vector length 12:
>>
>>  > readChar(f,nchar=rep(10,12))
>>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>> [11] "\0"         ""
>>  > readChar(f,nchar=rep(10,13))
>>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>> [11] "\0"         ""
>>
>> It seems that the first time EOF is encountered on a read operation, 
>> an empty string is returned, but on subsequent reads nothing is 
>> returned. Is this intended behavior?
> 
> I believe this is an off-by-1 bug in do_readchar(). The following fix to 
> R-trunk v41946 causes the above readchar() calls to cap the returned 
> vector length at 11:
> 
> Index: src/main/connections.c
> ===================================================================
> --- src/main/connections.c      (revision 41946)
> +++ src/main/connections.c      (working copy)
> @@ -3286,7 +3286,7 @@
>             if(!con->open(con)) error(_("cannot open the connection"));
>      }
>      PROTECT(ans = allocVector(STRSXP, n));
> -    for(i = 0, m = i+1; i < n; i++) {
> +    for(i = 0, m = 0; i < n; i++) {
>         len = INTEGER(nchars)[i];
>         if(len == NA_INTEGER || len < 0)
>             error(_("invalid value for '%s'"), "nchar");
> 


This does look like an off-by-1 bug as do_readbin's for loops are coded 
just like the above patch.


Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From statmobile at gmail.com  Fri Jun 15 17:21:06 2007
From: statmobile at gmail.com (statmobile at gmail.com)
Date: Fri, 15 Jun 2007 11:21:06 -0400
Subject: [Rd] LAPACK Headers
In-Reply-To: <Pine.LNX.4.64.0706150639100.28253@gannet.stats.ox.ac.uk>
References: <20070614214558.GA20567@bjl> <4671C0E0.7010200@cimr.cam.ac.uk>
	<20070615025342.GA21406@bjl>
	<Pine.LNX.4.64.0706150639100.28253@gannet.stats.ox.ac.uk>
Message-ID: <20070615152106.GA23630@bjl>

Prof. Ripley,

I had a feeling I was going a little too deep into the R source code
in order to pull out these functions.  I particularly like these La_*
functions calling the LAPACK routines, because they have so much of
the error checking already built-in.  I can just copy the code over,
and hopefully it will pick up everything in my package, but I do have
two questions.

1.  I seem to vaguely recall that the R-ext documentation mentions
    that routines such as this could possibly change.  So if someone
    wants to use any of the LAPACK or BLAS routines in their source
    code, they should really only refer to the programs in
    R_ext/Lapack.h? 

2.  I think the LAPACK utilities are key in R, and help new
    researchers avoid having to use proprietary code such as Numerical
    Recipes when doing their research.  Is there a reason why code
    such as the La_* wrapper functions are not ``public''?  I really
    think they're quite useful.

Thanks,
Brian


On Fri, Jun 15, 2007 at 06:45:09AM +0100, Prof Brian Ripley wrote:
> He wants "La_dgesv", which is not an LAPACK entry point at all, but a 
> private part of R.  The header it is in is private and not installed.
> 
> There is no guarantee that it will remain visible to an R package, and the 
> only safe thing to do is to copy the code.
> 
> On Thu, 14 Jun 2007, statmobile at gmail.com wrote:
> 
> >On Thu, Jun 14, 2007 at 11:27:44PM +0100, Hin-Tak Leung wrote:
> >>Try this? (this is on 2.5.0, I don't use 2.4.x anymore)
> >>
> >>#include <R_ext/Lapack.h>
> >>
> >
> >I tried this, but I still get the warning of implicit declaration of
> >function.  It does compile though.
> >
> >>Have you actually tried grep dgesv $R_HOME/include/* $R_HOME/include/*/*
> >>to see which file to include for dgesv ??
> >
> >Well, when I grep the R source files, I get:
> >
> >$ find . -name "*" -print | xargs grep -i 'La_dgesv'
> >./src/main/basedecl.h:SEXP La_dgesv(SEXP, SEXP, SEXP);
> >./src/main/lapack.c:SEXP La_dgesv(SEXP A, SEXP B, SEXP tol)
> >./src/main/lapack.c:SEXP La_dgesv(SEXP A, SEXP B, SEXP tol)
> >./src/main/registration.c:    CALLDEF(La_dgesv, 3),
> >./src/library/base/R/solve.R:     .Call("La_dgesv", a, b, tol, PACKAGE
> >= "base")
> >./src/library/base/R/solve.R:     drop(.Call("La_dgesv", a,
> >as.matrix(b), tol, PACKAGE = "base")))
> >./src/modules/lapack/Lapack.c:static SEXP modLa_dgesv(SEXP A, SEXP
> >Bin, SEXP tolin)
> >./src/modules/lapack/Lapack.c:    tmp->dgesv = modLa_dgesv;
> >./src/include/Rmodules/Rlapack.h:typedef SEXP (*Rf_La_dgesv)(SEXP A,
> >SEXP B, SEXP tol);
> >./src/include/Rmodules/Rlapack.h:    Rf_La_dgesv dgesv;
> >
> >So it looks like La_dgesv is declared in basedecl.h, but I don't see
> >this file anywhere else on my machine.  Maybe I shouldn't be using
> >this function in my package?
> >
> >
> >
> >>
> >>HTL
> >>
> >>statmobile at gmail.com wrote:
> >>>Hey Everyone,
> >>>
> >>>I'm running R 2.4.0 on Debian etch 4.0, and I'm trying to call some
> >>>LAPACK functions from the C code in my package.  Actually, to be
> >>>honest I'm not really having trouble using commands such as La_dgesv
> >>>from within my C code, but I do get warning when compiling the package
> >>>saying:
> >>>
> >>>***.c: In function '***':
> >>>***.c:37: warning: implicit declaration of function 'La_dgesv'
> >>>***.c:37: warning: assignment makes pointer from integer without
> >>>a cast
> >>>
> >>>I tried using:
> >>>
> >>>#include <Rmodules/Rlapack.h>
> >>>
> >>>but it won't compile the package at all with that included,
> >>>complaining that
> >>>
> >>>***.h:5:30: error: Rmodules/Rlapack.h: No such file or directory
> >>>
> >>>Can someone explain to me how I should include the headers to this
> >>>AWESOME wrapper code to the LAPACK libraries?  Am I not following the
> >>>proper protocol by using these La_* commands in my package source
> >>>code?
> >>>
> >>>Note, I also have the following in Makevars
> >>>
> >>>PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
> >>>
> >>>TIA!
> >>>
> >>>I initially posted this question on the general list, but I didn't get
> >>>any responses.
> >>>
> >>>______________________________________________
> >>>R-devel at r-project.org mailing list
> >>>https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Brian J. Lopes
PhD Student
Department of Statistics and Operations Research
University of North Carolina at Chapel Hill

To know that we know what we know, and that we do not know what we do
not know, that is true knowledge --Henry David Thoreau (quoting
Confucius): Walden


From ripley at stats.ox.ac.uk  Fri Jun 15 17:29:01 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 15 Jun 2007 16:29:01 +0100 (BST)
Subject: [Rd] LAPACK Headers
In-Reply-To: <20070615152106.GA23630@bjl>
References: <20070614214558.GA20567@bjl> <4671C0E0.7010200@cimr.cam.ac.uk>
	<20070615025342.GA21406@bjl>
	<Pine.LNX.4.64.0706150639100.28253@gannet.stats.ox.ac.uk>
	<20070615152106.GA23630@bjl>
Message-ID: <Pine.LNX.4.64.0706151624190.11764@gannet.stats.ox.ac.uk>

On Fri, 15 Jun 2007, statmobile at gmail.com wrote:

> Prof. Ripley,
>
> I had a feeling I was going a little too deep into the R source code
> in order to pull out these functions.  I particularly like these La_*
> functions calling the LAPACK routines, because they have so much of
> the error checking already built-in.  I can just copy the code over,
> and hopefully it will pick up everything in my package, but I do have
> two questions.
>
> 1.  I seem to vaguely recall that the R-ext documentation mentions
>    that routines such as this could possibly change.  So if someone
>    wants to use any of the LAPACK or BLAS routines in their source
>    code, they should really only refer to the programs in
>    R_ext/Lapack.h?

Yes.

> 2.  I think the LAPACK utilities are key in R, and help new
>    researchers avoid having to use proprietary code such as Numerical
>    Recipes when doing their research.  Is there a reason why code
>    such as the La_* wrapper functions are not ``public''?  I really
>    think they're quite useful.

They are private, and the R developers must be free to change R internals 
as they need to.  If we made public everything that anyone wanted to use, 
we would never be able to improve R (and we would spend all our time 
answering questions about private structures).

Also, having a large set of entry points that are accessible is a 
performance hit for every R session.  We've have about half hidden on 
platforms which support this, and we are likely to hide more (including 
these).

>
> Thanks,
> Brian
>
>
> On Fri, Jun 15, 2007 at 06:45:09AM +0100, Prof Brian Ripley wrote:
>> He wants "La_dgesv", which is not an LAPACK entry point at all, but a
>> private part of R.  The header it is in is private and not installed.
>>
>> There is no guarantee that it will remain visible to an R package, and the
>> only safe thing to do is to copy the code.
>>
>> On Thu, 14 Jun 2007, statmobile at gmail.com wrote:
>>
>>> On Thu, Jun 14, 2007 at 11:27:44PM +0100, Hin-Tak Leung wrote:
>>>> Try this? (this is on 2.5.0, I don't use 2.4.x anymore)
>>>>
>>>> #include <R_ext/Lapack.h>
>>>>
>>>
>>> I tried this, but I still get the warning of implicit declaration of
>>> function.  It does compile though.
>>>
>>>> Have you actually tried grep dgesv $R_HOME/include/* $R_HOME/include/*/*
>>>> to see which file to include for dgesv ??
>>>
>>> Well, when I grep the R source files, I get:
>>>
>>> $ find . -name "*" -print | xargs grep -i 'La_dgesv'
>>> ./src/main/basedecl.h:SEXP La_dgesv(SEXP, SEXP, SEXP);
>>> ./src/main/lapack.c:SEXP La_dgesv(SEXP A, SEXP B, SEXP tol)
>>> ./src/main/lapack.c:SEXP La_dgesv(SEXP A, SEXP B, SEXP tol)
>>> ./src/main/registration.c:    CALLDEF(La_dgesv, 3),
>>> ./src/library/base/R/solve.R:     .Call("La_dgesv", a, b, tol, PACKAGE
>>> = "base")
>>> ./src/library/base/R/solve.R:     drop(.Call("La_dgesv", a,
>>> as.matrix(b), tol, PACKAGE = "base")))
>>> ./src/modules/lapack/Lapack.c:static SEXP modLa_dgesv(SEXP A, SEXP
>>> Bin, SEXP tolin)
>>> ./src/modules/lapack/Lapack.c:    tmp->dgesv = modLa_dgesv;
>>> ./src/include/Rmodules/Rlapack.h:typedef SEXP (*Rf_La_dgesv)(SEXP A,
>>> SEXP B, SEXP tol);
>>> ./src/include/Rmodules/Rlapack.h:    Rf_La_dgesv dgesv;
>>>
>>> So it looks like La_dgesv is declared in basedecl.h, but I don't see
>>> this file anywhere else on my machine.  Maybe I shouldn't be using
>>> this function in my package?
>>>
>>>
>>>
>>>>
>>>> HTL
>>>>
>>>> statmobile at gmail.com wrote:
>>>>> Hey Everyone,
>>>>>
>>>>> I'm running R 2.4.0 on Debian etch 4.0, and I'm trying to call some
>>>>> LAPACK functions from the C code in my package.  Actually, to be
>>>>> honest I'm not really having trouble using commands such as La_dgesv
>>>>> from within my C code, but I do get warning when compiling the package
>>>>> saying:
>>>>>
>>>>> ***.c: In function '***':
>>>>> ***.c:37: warning: implicit declaration of function 'La_dgesv'
>>>>> ***.c:37: warning: assignment makes pointer from integer without
>>>>> a cast
>>>>>
>>>>> I tried using:
>>>>>
>>>>> #include <Rmodules/Rlapack.h>
>>>>>
>>>>> but it won't compile the package at all with that included,
>>>>> complaining that
>>>>>
>>>>> ***.h:5:30: error: Rmodules/Rlapack.h: No such file or directory
>>>>>
>>>>> Can someone explain to me how I should include the headers to this
>>>>> AWESOME wrapper code to the LAPACK libraries?  Am I not following the
>>>>> proper protocol by using these La_* commands in my package source
>>>>> code?
>>>>>
>>>>> Note, I also have the following in Makevars
>>>>>
>>>>> PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
>>>>>
>>>>> TIA!
>>>>>
>>>>> I initially posted this question on the general list, but I didn't get
>>>>> any responses.
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Robert.McGehee at geodecapital.com  Fri Jun 15 18:20:08 2007
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Fri, 15 Jun 2007 12:20:08 -0400
Subject: [Rd] NaN in crossprod
Message-ID: <EEBC169715EB8C438D3C9283AF0F201C17C819@MSGBOSCLM2WIN.DMN1.FMR.COM>

Hello,
I have come across a troubling problem in which my call to crossprod
will occasionally produce NaNs.  That is, a proper matrix cross-product
will be produced except that some of the matrix elements will
arbitrarily be NaN. For my purposes, this is extremely bad. On several
different R sessions run this morning this example below may fail a few
times out of a million, though sometimes not at all.
> x <- matrix(1, 100, 100); w <- rep(1, 100)
> for(i in 1:1000000) if(any(is.na(crossprod(w,x)))) cat("!")

Unfortunately, this error has been hard to reproduce as I was finding
frequent NaNs produced an hour ago but am not finding any such cases
now. I'm using a shared network computer so it's possible the computer
was under different resource constraints when the problem occurred. I
compiled R 2.5.0 on an Intel Xeon(P4) processor running Linux
2.4.21-47.0.1 on Red Hat AS 3.0, with ATLAS 3.7.30 BLAS support.

My _guess_ is that the problem is on the ATLAS end (bug, bad
compilation, etc.), though as I can't seem to reproduce the problem in
the past hour, I'm not sure I'd even know if I had "fixed" it by using a
different version of ATLAS, or recompiling, etc. And not being quite
sure how crossprod works internally, my guess is not even an educated
one. So, lest the NaNs be a symptom of impending hardware failure, solar
flares, or even a "mis-feature" in R, I thought I'd solicit any
comments, ideas, and suggestions this group might have.

Thanks,
Robert

> R.version               _
platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status
major          2
minor          5.0
year           2007
month          04
day            23
svn rev        41293
language       R
version.string R version 2.5.0 (2007-04-23)


Robert McGehee, CFA
Quantitative Analyst
Geode Capital Management, LLC
One Post Office Square, 28th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com



This e-mail, and any attachments hereto, are intended for us...{{dropped}}


From hpages at fhcrc.org  Fri Jun 15 20:28:10 2007
From: hpages at fhcrc.org (Herve Pages)
Date: Fri, 15 Jun 2007 11:28:10 -0700
Subject: [Rd] Missing args with a default value in S4 methods
In-Reply-To: <46729040.9030706@r-project.org>
References: <467199D9.6090205@fhcrc.org> <46729040.9030706@r-project.org>
Message-ID: <4672DA3A.3080607@fhcrc.org>

John Chambers wrote:
> This has essentially nothing to do with methods, but rather with the
> treatment of missing arguments.
> 
> Consider:
>> foo <- function(x,...)bar(x,...)
>> bar <- function(x, y=12, z, ...) {cat(missing(y), "\n"); cat(y, "\n")}
> 
> This is the same argument-matching as your example, since the generic
> and method have different formal arguments.  And indeed,
> 
>> foo("a",,z=99)
> TRUE
> Error in cat(y, "\n") : argument is missing, with no default
> 
> The error message is correct, but the argument in question is not "y"
> but "..1".  This is constructed and passed down as a special R object
> representing "missing-argument-with-no-default".   (Splus would have
> worked as you expected, because missingness there is a property of the
> function call, not of the object corresponding to the formal argument.)

Thanks John for the clarification! I can see why, _technically speaking_, things
behave how they behave.

Note that what happens with default arguments in methods is not always the same
as with normal functions so it's not always possible to predict what is actually
going to happen... Here is an example:

1) Default arg in the method:

   o generic + method:
     > bar <- function(x, y=12, z) {cat(missing(y), "\n"); cat(x, y, z, "\n")}
     > setGeneric("mygen", signature=c("x", "z"), function(x, y, z) standardGeneric("mygen"))
     > setMethod("mygen", c("ANY", "ANY"), bar)
     > mygen("aa", , "bb")
     TRUE
     Error in cat(x, y, z, "\n") : argument "y" is missing, with no default

   o normal functions:
     > foo <- function(x, y, z) bar(x, y, z)
     > foo("aa", ,"bb")
     TRUE
     Error in cat(x, y, z, "\n") : argument "y" is missing, with no default

   Behaviour is the same.

2) Default arg in the generic:

   o generic + method: example 1) shows that if I want a default value
     for y, it should be put in the generic rather than in the method:
     > bar <- function(x, y, z) {cat(missing(y), "\n"); cat(x, y, z, "\n")}
     > setGeneric("mygen", signature=c("x", "z"), function(x, y=12, z) standardGeneric("mygen"))
     > setMethod("mygen", c("ANY", "ANY"), bar)
     > mygen("aa", , "bb")
     TRUE
     aa 12 bb

   o normal functions:
     > foo <- function(x, y=12, z) bar(x, y, z)
     > foo("aa", ,"bb")
     FALSE
     aa 12 bb

   Behaviour is _almost_ the same!

3) Default arg in the generic _and_ in the method:

   o generic + method:
     > bar <- function(x, y=999, z) {cat(missing(y), "\n"); cat(x, y, z, "\n")}
     > setMethod("mygen", c("ANY", "ANY"), bar)
     > mygen("aa", , "bb")
     TRUE
     aa 999 bb

     Not what I would expect!

   o normal functions:
     > foo("aa", ,"bb")
     FALSE
     aa 12 bb

     Much better.

I'm sure there is a _technical_ explanation for this (with probably some lazy evaluation
involved) but I find the current behaviour confusing and very hard to predict.

Cheers,
H.


> 
> 
> Herve Pages wrote:
>> Hi,
>>
>>
>> Strange things happen with missing args in S4 methods:
>>
>>   > setGeneric("mygen", signature="x", function(x, ...)
>> standardGeneric("mygen"))
>>   [1] "mygen"
>>
>>   > setMethod("mygen", "character", function(x, y=12, z, ...)
>> {cat(missing(y), "\n"); cat(y, "\n")})
>>   [1] "mygen"
>>
>>   > mygen("aa", z=99)
>>   TRUE
>>   12
>>
>>   > mygen("aa", , 99)
>>   TRUE
>>   Error in cat(y, "\n") : argument is missing, with no default
>>                                       ^^^^^^^       ^^^^^^^^^^
>>                                        TRUE          NOT TRUE!
>>
>>
>> For "normal" functions, things work as expected:
>>
>>   > myfun <- function(x, y=12, z, ...) {cat(missing(y), "\n"); cat(y,
>> "\n")}
>>
>>   > myfun("aa", z=99)
>>   TRUE
>>   12
>>
>>   > myfun("aa", , 99)
>>   TRUE
>>   12
>>
>> And with S3 generics too:
>>
>>   > dd <- data.frame(aa=letters[1:9], ii=9:1)
>>   > head(dd, z="ignored")
>>     aa ii
>>   1  a  9
>>   2  b  8
>>   3  c  7
>>   4  d  6
>>   5  e  5
>>   6  f  4
>>
>>   > head(dd, , "ignored")
>>     aa ii
>>   1  a  9
>>   2  b  8
>>   3  c  7
>>   4  d  6
>>   5  e  5
>>   6  f  4
>>
>> Cheers,
>> H.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>   
>


From Carsten.Botts at williams.edu  Fri Jun 15 22:18:28 2007
From: Carsten.Botts at williams.edu (Carsten.Botts at williams.edu)
Date: Fri, 15 Jun 2007 16:18:28 -0400
Subject: [Rd] more help with 'inline' package
Message-ID: <1181938708.4672f4146f09f@imp.williams.edu>

To anyone who can help,

    I am running R on Windows, and have recently discovered Oleg Skylar's
amazing new package "inline," but I am having a difficult time operating it on
Windows.    Looking at some e-mail messages that were exchanged in May, it
seems as if Duncan Murdoch had a similar experience, and attached an
appropriate patch.    But how does this patch work?    Where do I download it,
and once it is downloaded, should the examples in the "inline" package work?

Any help would be greatly appreciated.



Carsten Botts


From murdoch at stats.uwo.ca  Sat Jun 16 15:57:07 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 16 Jun 2007 09:57:07 -0400
Subject: [Rd] readchar() bug or feature? was Re: Clarification for
 readChar man page
In-Reply-To: <4671AD95.8050605@vanderbilt.edu>
References: <46715566.5010308@vanderbilt.edu>
	<46715AA1.3020707@stats.uwo.ca>	<46716434.7060603@vanderbilt.edu>
	<4671AD95.8050605@vanderbilt.edu>
Message-ID: <4673EC33.1000208@stats.uwo.ca>

On 14/06/2007 5:05 PM, Jeffrey Horner wrote:
> Jeffrey Horner wrote:
>> Duncan Murdoch wrote:
>>> On 6/14/2007 10:49 AM, Jeffrey Horner wrote:
>>>> Hi,
>>>>
>>>> Here's a patch to the readChar manual page (R-trunk as of today) that 
>>>> better clarifies readChar's return value. 
>>> Your update is not right.  For example:
>>>
>>> x <- as.raw(32:96)
>>> readChar(x, nchars=rep(2,100))
>>>
>>> This returns a character vector of length 100, of which the first 32 
>>> elements have 2 chars, the next one has 1, and the rest are "".
>>>
>>> So the length of nchars really does affect the length of the value.
>>>
>>> Now, I haven't looked at the code, but it's possible we could delete the 
>>> "(which might be less than \code{length(nchars)})" remark, and if not, 
>>> it would be useful to explain the situations in which the return value 
>>> could be shorter than the nchars vector.
>> Well, this is rather a misunderstanding on my part; I completely forgot 
>> about vectorization. The manual page makes sense to me now.
>>
>> But the situation about the return value possibly being less than 
>> length(nchars) isn't clear. Consider a 101 byte text file in a 
>> non-multibyte character locale:
>>
>> f <- tempfile()
>> writeChar(paste(rep(seq(0,9),10),collapse=''),con=f)
>>
>> and calling readChar() to read 100 bytes with length(nchar)=10:
>>
>>  > readChar(f,nchar=rep(10,10))
>>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>
>> and readChar() reading the entire file with length(nchar)=11:
>>
>>  > readChar(f,nchar=rep(10,11))
>>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>> [11] "\0"
>>
>> but the following two outputs are confusing. readchar() with 
>> length(nchar)>=12 returns a character vector length 12:
>>
>>  > readChar(f,nchar=rep(10,12))
>>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>> [11] "\0"         ""
>>  > readChar(f,nchar=rep(10,13))
>>   [1] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>>   [6] "0123456789" "0123456789" "0123456789" "0123456789" "0123456789"
>> [11] "\0"         ""
>>
>> It seems that the first time EOF is encountered on a read operation, an 
>> empty string is returned, but on subsequent reads nothing is returned. 
>> Is this intended behavior?
> 
> I believe this is an off-by-1 bug in do_readchar(). The following fix to 
> R-trunk v41946 causes the above readchar() calls to cap the returned 
> vector length at 11:
> 
> Index: src/main/connections.c
> ===================================================================
> --- src/main/connections.c      (revision 41946)
> +++ src/main/connections.c      (working copy)
> @@ -3286,7 +3286,7 @@
>              if(!con->open(con)) error(_("cannot open the connection"));
>       }
>       PROTECT(ans = allocVector(STRSXP, n));
> -    for(i = 0, m = i+1; i < n; i++) {
> +    for(i = 0, m = 0; i < n; i++) {
>          len = INTEGER(nchars)[i];
>          if(len == NA_INTEGER || len < 0)
>              error(_("invalid value for '%s'"), "nchar");
> 
> 
> Jeff
> 

Thanks for working this out.  I think your patch is right, but there's 
another bug:  raw vectors are handled differently than connections. 
I'll fix both problems, but I'll do it in R-devel, not R-patched:  I 
think we were consistent with the documentation before, so the bug is 
not extremely serious, and it's getting too close to the release of 
2.5.1 to make this change there (since someone may have depended on the 
previous behaviour).

Duncan Murdoch


From ripley at stats.ox.ac.uk  Sat Jun 16 22:56:59 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 16 Jun 2007 21:56:59 +0100 (BST)
Subject: [Rd] bug in R environments? Was: [BioC] 'recursive default
 argument' error...
In-Reply-To: <m2odjlkzcy.fsf@ziti.local>
References: <466E582C.4040108@ebi.ac.uk>
	<Pine.LNX.4.64.0706121110030.1465@gannet.stats.ox.ac.uk>
	<m2odjlkzcy.fsf@ziti.local>
Message-ID: <Pine.LNX.4.64.0706162111480.20766@gannet.stats.ox.ac.uk>

Thanks for the slow example.  The issue is more specifically pertinent to 
lazyloading of environments than I had realized.  Because interrupts are 
only checked for every 100 eval() calls, the chances that you will check 
one during a standard lazyload call are low (but not zero).  However, when 
you lazyload an environment, it calls the unserialize hook function which 
is an interpreted function containing a for loop over entries in the 
environment.  So lazyloading of a sizeable environment is vulnerable to 
interruption to a much higher degree than other objects.

Luke Tierney and I have been discussing possible strategies.  It seems too 
close to 2.5.1 for a comprehensive solution there, but palliative measures 
may be possible.  Meanwhile, take care in interrupting ....


On Tue, 12 Jun 2007, Seth Falcon wrote:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> On Tue, 12 Jun 2007, Oleg Sklyar wrote:
>>
>>> Dear developers,
>>>
>>> has anyone experienced the problem described below? Is it a bug in
>>> handling interrupts in R?
>>
>> I am not sure where you think the 'bug' is in: cf your subject line.
>> My guess is that the package is using environments in a vulnerable
>> way.
>
> The issue at hand is, I believe, the same as that discussed here:
>
> http://thread.gmane.org/gmane.comp.lang.r.devel/8103/focus=8104
>
>> I cannot reproduce your example on my system: I was able to interrupt but
>> repeating the as.list worked.
>
> Try with a larger environment.  I can reproduce this with a recent
> R-devel using the GO package:
>
>    > library(GO)
>    > GOTERM
>    ^C
>    > GOTERM
>    Error: recursive default argument reference
>
>> What I suspect may have happened is that
>> you have interrupted lazy loading.  From the code
>>
>>  	    if(PRSEEN(e))
>>  		errorcall(R_GlobalContext->call,
>>  			  _("recursive default argument reference"));
>>  	    SET_PRSEEN(e, 1);
>>  	    val = eval(PRCODE(e), PRENV(e));
>>  	    SET_PRSEEN(e, 0);
>>
>> so you will get this message from a promise whose evaluation was
>> incomplete.  I can see several ways around that, but most have runtime
>> costs or back-compatibility issues.  (Changing the message may help.)
>>
>> It looks like rae230a has been implemented to use lazy-loading on whole
>> environments (the 'source' is already a lazyload database, so it's not
>> transparent).  Lazy-loading was intended for members of environments.
>>
>> Also, does this happen in R-devel?  There lazy-loading is considerably
>> faster and closer to an atomic operation.
>>
>> All guesswork on something I cannot reproduce, of course.
>
> Good guesses.  Yes, _all_ Bioconductor annotation data packages
> currently store each identifier mapping in a separate environment.  So
> the package environment contains environments.  The lazy loading db is
> important at runtime when users may only need to access one or two of
> the environments.  We generate the lazy-loading dbs by hand so that
> users installing from source do not have to repeat the process
> themselves.  Since the environments are large, it is possible to use
> the packages on a system that does not have enough memory to
> "properly" install them.
>
> + seth
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jmc at r-project.org  Sun Jun 17 18:33:16 2007
From: jmc at r-project.org (John Chambers)
Date: Sun, 17 Jun 2007 12:33:16 -0400
Subject: [Rd] Missing args with a default value in S4 methods
In-Reply-To: <4672DA3A.3080607@fhcrc.org>
References: <467199D9.6090205@fhcrc.org> <46729040.9030706@r-project.org>
	<4672DA3A.3080607@fhcrc.org>
Message-ID: <4675624C.6080506@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070617/7696b942/attachment.pl 

From murdoch at stats.uwo.ca  Sun Jun 17 22:27:16 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 17 Jun 2007 16:27:16 -0400
Subject: [Rd] X11 help please
Message-ID: <46759924.5020103@stats.uwo.ca>

The rgl package currently crashes R when running under Xvfb (the 
"virtual frame buffer" server), at least on MacOSX.  It makes sense that 
it shouldn't be able to work there (it needs interactivity), but I don't 
know how to detect the problems before they cause the crash.

Currently the error happens the first time you try to open an rgl 
window; when rgl calls XCreateWindow R crashes with the error message

X Error of failed request:  BadMatch (invalid parameter attributes)
  Major opcode of failed request:  1 (X_CreateWindow)
  Serial number of failed request:  28
  Current serial number in output stream:  29

I've checked and as far as I can see all the parameters we're sending to 
XCreateWindow are valid, but I might have missed something:  I don't 
know much about X11 programming.  (The call is

  ::Window xwindow = XCreateWindow(
    xdisplay, RootWindow(xdisplay, DefaultScreen(xdisplay)),
    0, 0, 256, 256, 0,
    xvisualinfo->depth,
    InputOutput,
    xvisualinfo->visual,
    valuemask,
    &attrib
  );

but without context that's probably not worth much to others.)


Are there any experienced X11 programmers out there who can suggest what 
to do next?

Duncan Murdoch


From ripley at stats.ox.ac.uk  Mon Jun 18 05:50:53 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 18 Jun 2007 04:50:53 +0100 (BST)
Subject: [Rd] X11 help please
In-Reply-To: <46759924.5020103@stats.uwo.ca>
References: <46759924.5020103@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0706180419440.7264@gannet.stats.ox.ac.uk>

rgl normally works under Xvfb on Linux: we've been using that for the 
testing 'for ever'.

However R should not 'crash' on an error in a package, and the X11 device 
has error handlers set up by

 	XSetErrorHandler(R_X11Err);
 	XSetIOErrorHandler(R_X11IOErr);

I don't see anything comparable in rgl.

The error seems to be in the attributes, so I would have a closer look at 
those.  In particular, how are you running Xvfb?: you may need something 
like

Xvfb :5 -screen 0 1280x1024x24 &
setenv DISPLAY :5

to ensure that you have a reasonable visual and hence colormap.
(On my system the default is 12 bit.)


On Sun, 17 Jun 2007, Duncan Murdoch wrote:

> The rgl package currently crashes R when running under Xvfb (the
> "virtual frame buffer" server), at least on MacOSX.  It makes sense that
> it shouldn't be able to work there (it needs interactivity), but I don't
> know how to detect the problems before they cause the crash.
>
> Currently the error happens the first time you try to open an rgl
> window; when rgl calls XCreateWindow R crashes with the error message
>
> X Error of failed request:  BadMatch (invalid parameter attributes)
>  Major opcode of failed request:  1 (X_CreateWindow)
>  Serial number of failed request:  28
>  Current serial number in output stream:  29
>
> I've checked and as far as I can see all the parameters we're sending to
> XCreateWindow are valid, but I might have missed something:  I don't
> know much about X11 programming.  (The call is
>
>  ::Window xwindow = XCreateWindow(
>    xdisplay, RootWindow(xdisplay, DefaultScreen(xdisplay)),
>    0, 0, 256, 256, 0,
>    xvisualinfo->depth,
>    InputOutput,
>    xvisualinfo->visual,
>    valuemask,
>    &attrib
>  );
>
> but without context that's probably not worth much to others.)
>
>
> Are there any experienced X11 programmers out there who can suggest what
> to do next?
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Mon Jun 18 13:56:40 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 18 Jun 2007 12:56:40 +0100
Subject: [Rd] X11 help please
In-Reply-To: <Pine.LNX.4.64.0706180419440.7264@gannet.stats.ox.ac.uk>
References: <46759924.5020103@stats.uwo.ca>
	<Pine.LNX.4.64.0706180419440.7264@gannet.stats.ox.ac.uk>
Message-ID: <467672F8.9040105@cimr.cam.ac.uk>

Prof Brian Ripley wrote:
> rgl normally works under Xvfb on Linux: we've been using that for the 
> testing 'for ever'.
> 
> However R should not 'crash' on an error in a package, and the X11 device 
> has error handlers set up by
> 
>  	XSetErrorHandler(R_X11Err);
>  	XSetIOErrorHandler(R_X11IOErr);
> 
> I don't see anything comparable in rgl.
> 
> The error seems to be in the attributes, so I would have a closer look at 
> those.  In particular, how are you running Xvfb?: you may need something 
> like
> 
> Xvfb :5 -screen 0 1280x1024x24 &
> setenv DISPLAY :5
> 
> to ensure that you have a reasonable visual and hence colormap.
> (On my system the default is 12 bit.)

That's interesting - my first thought of Duncan's problem was unusual
colour depth as well, but I thought very few people run their X servers
in anything other than 24-bit or true-color mode these days (and any
MacOSX hardware should be capable of that anyway); if 12-bit is the
Xvfb default it is hightly likely that's the reason.

I have also seen that sort of error messages in CJK related issues,
if the X server's font path has some unsual and broken fonts; so it 
might be a good idea to disable any non-english locale, etc and try not 
to do anything clever in that direction for the time being.

- I do run my old laptop at 16-bit only, as it is old and I get better 
performance that way with little sacrifice on visual appearance,
but that's my choice...

> On Sun, 17 Jun 2007, Duncan Murdoch wrote:
> 
>> The rgl package currently crashes R when running under Xvfb (the
>> "virtual frame buffer" server), at least on MacOSX.  It makes sense that
>> it shouldn't be able to work there (it needs interactivity), but I don't
>> know how to detect the problems before they cause the crash.
>>
>> Currently the error happens the first time you try to open an rgl
>> window; when rgl calls XCreateWindow R crashes with the error message
>>
>> X Error of failed request:  BadMatch (invalid parameter attributes)
>>  Major opcode of failed request:  1 (X_CreateWindow)
>>  Serial number of failed request:  28
>>  Current serial number in output stream:  29
>>
>> I've checked and as far as I can see all the parameters we're sending to
>> XCreateWindow are valid, but I might have missed something:  I don't
>> know much about X11 programming.  (The call is
>>
>>  ::Window xwindow = XCreateWindow(
>>    xdisplay, RootWindow(xdisplay, DefaultScreen(xdisplay)),
>>    0, 0, 256, 256, 0,
>>    xvisualinfo->depth,
>>    InputOutput,
>>    xvisualinfo->visual,
>>    valuemask,
>>    &attrib
>>  );
>>
>> but without context that's probably not worth much to others.)
>>
>>
>> Are there any experienced X11 programmers out there who can suggest what
>> to do next?
>>
>> Duncan Murdoch
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From murdoch at stats.uwo.ca  Mon Jun 18 15:39:40 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 18 Jun 2007 09:39:40 -0400
Subject: [Rd] X11 help please
In-Reply-To: <467672F8.9040105@cimr.cam.ac.uk>
References: <46759924.5020103@stats.uwo.ca>
	<Pine.LNX.4.64.0706180419440.7264@gannet.stats.ox.ac.uk>
	<467672F8.9040105@cimr.cam.ac.uk>
Message-ID: <46768B1C.2030706@stats.uwo.ca>

On 6/18/2007 7:56 AM, Hin-Tak Leung wrote:
> Prof Brian Ripley wrote:
>> rgl normally works under Xvfb on Linux: we've been using that for the 
>> testing 'for ever'.
>> 
>> However R should not 'crash' on an error in a package, and the X11 device 
>> has error handlers set up by
>> 
>>  	XSetErrorHandler(R_X11Err);
>>  	XSetIOErrorHandler(R_X11IOErr);
>> 
>> I don't see anything comparable in rgl.
>> 
>> The error seems to be in the attributes, so I would have a closer look at 
>> those.  In particular, how are you running Xvfb?: you may need something 
>> like
>> 
>> Xvfb :5 -screen 0 1280x1024x24 &
>> setenv DISPLAY :5
>> 
>> to ensure that you have a reasonable visual and hence colormap.
>> (On my system the default is 12 bit.)
> 
> That's interesting - my first thought of Duncan's problem was unusual
> colour depth as well, but I thought very few people run their X servers
> in anything other than 24-bit or true-color mode these days (and any
> MacOSX hardware should be capable of that anyway); if 12-bit is the
> Xvfb default it is hightly likely that's the reason.

I don't know the default, but I've been specifying 24 or 32 bit depth 
each time, and rgl is seeing 32 bit depth.

> I have also seen that sort of error messages in CJK related issues,
> if the X server's font path has some unsual and broken fonts; so it 
> might be a good idea to disable any non-english locale, etc and try not 
> to do anything clever in that direction for the time being.

I do get a warning about a missing font when I run Xvfb; Simon Urbanek 
thought it was ignorable, but maybe not:

Could not init font path element /usr/X11R6/lib/X11/fonts/CID/

This happens before R is running, and sometimes again during the run.

I've now implemented XSetErrorHandler(R_X11Err) as Brian suggested, and 
this moves the error elsewhere:  R doesn't quit when it hits that error, 
but it dies later because rgl isn't handling its incomplete 
initialization properly.  I think that will be relatively easy to track 
down and fix, but I'm still left with two problems I don't know how to 
solve:

1.  Why am I getting this error in the first place?  Since things work 
on Linux, this may be a bug in the MacOSX implementation of Xvfb, but 
Google doesn't turn up other reports of that, so it's more likely an rgl 
problem.

2.  XSetErrorHandler() is a global setting.  If rgl sets it, then it 
will override the setting that X11() used.  Is there a way to retrieve 
the previous setting, so I can set it only temporarily?  There doesn't 
appear to be any XGetErrorHandler() function.

Duncan Murdoch
> 
> - I do run my old laptop at 16-bit only, as it is old and I get better 
> performance that way with little sacrifice on visual appearance,
> but that's my choice...
> 
>> On Sun, 17 Jun 2007, Duncan Murdoch wrote:
>> 
>>> The rgl package currently crashes R when running under Xvfb (the
>>> "virtual frame buffer" server), at least on MacOSX.  It makes sense that
>>> it shouldn't be able to work there (it needs interactivity), but I don't
>>> know how to detect the problems before they cause the crash.
>>>
>>> Currently the error happens the first time you try to open an rgl
>>> window; when rgl calls XCreateWindow R crashes with the error message
>>>
>>> X Error of failed request:  BadMatch (invalid parameter attributes)
>>>  Major opcode of failed request:  1 (X_CreateWindow)
>>>  Serial number of failed request:  28
>>>  Current serial number in output stream:  29
>>>
>>> I've checked and as far as I can see all the parameters we're sending to
>>> XCreateWindow are valid, but I might have missed something:  I don't
>>> know much about X11 programming.  (The call is
>>>
>>>  ::Window xwindow = XCreateWindow(
>>>    xdisplay, RootWindow(xdisplay, DefaultScreen(xdisplay)),
>>>    0, 0, 256, 256, 0,
>>>    xvisualinfo->depth,
>>>    InputOutput,
>>>    xvisualinfo->visual,
>>>    valuemask,
>>>    &attrib
>>>  );
>>>
>>> but without context that's probably not worth much to others.)
>>>
>>>
>>> Are there any experienced X11 programmers out there who can suggest what
>>> to do next?
>>>
>>> Duncan Murdoch
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>


From murdoch at stats.uwo.ca  Mon Jun 18 17:18:24 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 18 Jun 2007 11:18:24 -0400
Subject: [Rd] X11 help please
In-Reply-To: <46768B1C.2030706@stats.uwo.ca>
References: <46759924.5020103@stats.uwo.ca>	<Pine.LNX.4.64.0706180419440.7264@gannet.stats.ox.ac.uk>	<467672F8.9040105@cimr.cam.ac.uk>
	<46768B1C.2030706@stats.uwo.ca>
Message-ID: <4676A240.1060103@stats.uwo.ca>

On 6/18/2007 9:39 AM, Duncan Murdoch wrote:
> On 6/18/2007 7:56 AM, Hin-Tak Leung wrote:
>> Prof Brian Ripley wrote:
>>> rgl normally works under Xvfb on Linux: we've been using that for the 
>>> testing 'for ever'.
>>> 
>>> However R should not 'crash' on an error in a package, and the X11 device 
>>> has error handlers set up by
>>> 
>>>  	XSetErrorHandler(R_X11Err);
>>>  	XSetIOErrorHandler(R_X11IOErr);
>>> 
>>> I don't see anything comparable in rgl.
>>> 
>>> The error seems to be in the attributes, so I would have a closer look at 
>>> those.  In particular, how are you running Xvfb?: you may need something 
>>> like
>>> 
>>> Xvfb :5 -screen 0 1280x1024x24 &
>>> setenv DISPLAY :5
>>> 
>>> to ensure that you have a reasonable visual and hence colormap.
>>> (On my system the default is 12 bit.)
>> 
>> That's interesting - my first thought of Duncan's problem was unusual
>> colour depth as well, but I thought very few people run their X servers
>> in anything other than 24-bit or true-color mode these days (and any
>> MacOSX hardware should be capable of that anyway); if 12-bit is the
>> Xvfb default it is hightly likely that's the reason.
> 
> I don't know the default, but I've been specifying 24 or 32 bit depth 
> each time, and rgl is seeing 32 bit depth.
> 
>> I have also seen that sort of error messages in CJK related issues,
>> if the X server's font path has some unsual and broken fonts; so it 
>> might be a good idea to disable any non-english locale, etc and try not 
>> to do anything clever in that direction for the time being.
> 
> I do get a warning about a missing font when I run Xvfb; Simon Urbanek 
> thought it was ignorable, but maybe not:
> 
> Could not init font path element /usr/X11R6/lib/X11/fonts/CID/
> 
> This happens before R is running, and sometimes again during the run.
> 
> I've now implemented XSetErrorHandler(R_X11Err) as Brian suggested, and 
> this moves the error elsewhere:  R doesn't quit when it hits that error, 
> but it dies later because rgl isn't handling its incomplete 
> initialization properly.  I think that will be relatively easy to track 
> down and fix, but I'm still left with two problems I don't know how to 
> solve:
> 
> 1.  Why am I getting this error in the first place?  Since things work 
> on Linux, this may be a bug in the MacOSX implementation of Xvfb, but 
> Google doesn't turn up other reports of that, so it's more likely an rgl 
> problem.
> 
> 2.  XSetErrorHandler() is a global setting.  If rgl sets it, then it 
> will override the setting that X11() used.  Is there a way to retrieve 
> the previous setting, so I can set it only temporarily?  There doesn't 
> appear to be any XGetErrorHandler() function.

This one was easy:  the value of the XSetErrorHandler call is the 
previous handler.

Duncan Murdoch


From luke at stat.uiowa.edu  Mon Jun 18 23:36:50 2007
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Mon, 18 Jun 2007 16:36:50 -0500 (CDT)
Subject: [Rd] package check note: no visible global function definition
 (in functions using Tcl/Tk)
In-Reply-To: <Pine.GSO.4.56.0706141353140.5109@durian.statsci.com>
References: <466D5A0F.2090907@tu-dresden.de>
	<Pine.LNX.4.64.0706111638530.22283@gannet.stats.ox.ac.uk>
	<m2abv6v3ba.fsf@ziti.local>
	<Pine.LNX.4.64.0706141606001.19996@gannet.stats.ox.ac.uk>
	<Pine.GSO.4.56.0706141353140.5109@durian.statsci.com>
Message-ID: <Pine.OSX.4.61.0706181628340.25165@luke-tierneys-computer-3.local>

On Thu, 14 Jun 2007, Bill Dunlap wrote:

> On Thu, 14 Jun 2007, Prof Brian Ripley wrote:
>
>> You may prefer the version now in R-devel: this goes slightly the other
>> way in that it loads all the Suggests/Enhances packages and also a dummy
>> compatibility package for platform differences.  Neither this nor the
>> previous version can test the conditionalization is correct, as the code
>> is analysed but no path through it is run.  It is entirely possible that
>> the problems flagged are in code that can never be reached: this shows up
>> dramatically in examples such as Hmisc with non-R code (for S3 or S4).
>
> Splus 8 has a code-analysis routine called unresolvedGlobalReferences()
> that helps identify potential problems when moving R code to Splus.
> It is nowhere near as comprehensive as codetools::checkUsage().
> However it does look for if statements of the form
>   if (is.R())
> and
>   if (!is.R())
> and won't analyze the R-only parts of the code marked by such
> statements.  It would be nice if checkUsage() could do that as well.
> unresolvedGlobalReferences() does not look for anything more
> complicated than is.R() or !is.R() in the if statement, so it is
> better to change things like
>   if (is.R() || version$major>=9) { # R or future version of Splus
> to use a more complicated arrangement of if statements,
> each with a simpler condition in it.
>
> To get really fancy, checkUsage() might also look for statements like
>   if (require(pkgName))
> and run them both ways, to make sure the non-pkgName code really
> works when pkgName is not available.   This might overload the
> nightly build machine, but would be useful for the developer.

Doing some level of partial evaluation in conditionals is fairly high
on my priority list. Thinks like if (False) ... and if (is.R())
... should be fairly simple.  Platform test should also not be too
hard to handle, though ideally for those one might want to be able to
check code for sindows, say, on Linux. Handling if (require(...)) is a
little trickier as it probably isn't reasonable to unconditionally try
to execute the require's from inside checkUsage.  It may be reasonable
to allow that as an option or to assume that any require]d packages to
be ckecked have been loaded and so treat require(foo) as TRUE if foo
is loaded and FALSE otherwise.  I need to think this through a bit
more before moving ahead.

Best,

luke

>
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
> 360-428-8146
>
> "All statements in this message represent the opinions of the author and do
> not necessarily reflect Insightful Corporation policy or position."
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From hkawakat at gmail.com  Tue Jun 19 00:33:05 2007
From: hkawakat at gmail.com (Hiroyuki Kawakatsu)
Date: Mon, 18 Jun 2007 23:33:05 +0100
Subject: [Rd] two bessel function bugs for nu<0
Message-ID: <307b90470706181533v70792d00ufc0b6e7476b085e1@mail.gmail.com>

#bug 1: besselI() for nu<0 and expon.scaled=TRUE
#tested with R-devel (2007-06-17 r41981)
x <- 2.3
nu <- -0.4
print(paste(besselI(x, nu, TRUE), "=", exp(-x)*besselI(x, nu, FALSE)))
#fix:
#$ diff bessel_i_old.c bessel_i_new.c
#57c57
#<   bessel_k(x, -alpha, expo) * ((ize == 1)? 2. : 2.*exp(-x))/M_PI
#---
#>   bessel_k(x, -alpha, expo) * ((ize == 1)? 2. : 2.*exp(-2.0*x))/M_PI

#bug 2: besselY() for nu<0
#don't know how to check in R; a few random checks against mathematica 5.2
#fix:
#$ diff bessel_y_old.c bessel_y_new.c
#55c55
#<  return(bessel_y(x, -alpha) + bessel_j(x, -alpha) * sin(-M_PI * alpha));
#---
#>  return(bessel_y(x, -alpha) * cos(M_PI * alpha) - bessel_j(x,
-alpha) * sin(M_PI * alpha));

h.
-- 
----------------------------------
Hiroyuki Kawakatsu
Business School
Dublin City University
Dublin 9, Ireland
Tel +353 (0)1 700 7496


From murdoch at stats.uwo.ca  Tue Jun 19 04:08:21 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 18 Jun 2007 22:08:21 -0400
Subject: [Rd] X11 help please
In-Reply-To: <46759924.5020103@stats.uwo.ca>
References: <46759924.5020103@stats.uwo.ca>
Message-ID: <46773A95.3040509@stats.uwo.ca>

Duncan Murdoch wrote:
> The rgl package currently crashes R when running under Xvfb (the 
> "virtual frame buffer" server), at least on MacOSX.  It makes sense that 
> it shouldn't be able to work there (it needs interactivity), but I don't 
> know how to detect the problems before they cause the crash.
>
> Currently the error happens the first time you try to open an rgl 
> window; when rgl calls XCreateWindow R crashes with the error message
>
> X Error of failed request:  BadMatch (invalid parameter attributes)
>   Major opcode of failed request:  1 (X_CreateWindow)
>   Serial number of failed request:  28
>   Current serial number in output stream:  29
>
> I've checked and as far as I can see all the parameters we're sending to 
> XCreateWindow are valid, but I might have missed something:  I don't 
> know much about X11 programming.  (The call is
>
>   ::Window xwindow = XCreateWindow(
>     xdisplay, RootWindow(xdisplay, DefaultScreen(xdisplay)),
>     0, 0, 256, 256, 0,
>     xvisualinfo->depth,
>     InputOutput,
>     xvisualinfo->visual,
>     valuemask,
>     &attrib
>   );
>
> but without context that's probably not worth much to others.)
>
>
> Are there any experienced X11 programmers out there who can suggest what 
> to do next?

I have now committed some changes to rgl to avoid the crash -- it 
converts the above error into an R error.
I think to actually fix it, I'd need to debug the MacOSX Xvfb code to 
see exactly what it's complaining about.  I don't know where to find 
that source, so this isn't likely to happen soon.

Are there any X11/MacOSX programmers going to the UseR! meeting in 
August?  I'd guess if I could sit down with someone who had experience 
with both of those we could track this down fairly quickly, but I don't 
think I'll be able to do it without that.

Duncan Murdoch


From p.dalgaard at biostat.ku.dk  Tue Jun 19 08:51:45 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 19 Jun 2007 08:51:45 +0200
Subject: [Rd] X11 help please
In-Reply-To: <46773A95.3040509@stats.uwo.ca>
References: <46759924.5020103@stats.uwo.ca> <46773A95.3040509@stats.uwo.ca>
Message-ID: <46777D01.7070301@biostat.ku.dk>

Duncan Murdoch wrote:
> Duncan Murdoch wrote:
>   
>> The rgl package currently crashes R when running under Xvfb (the 
>> "virtual frame buffer" server), at least on MacOSX.  It makes sense that 
>> it shouldn't be able to work there (it needs interactivity), but I don't 
>> know how to detect the problems before they cause the crash.
>>
>> Currently the error happens the first time you try to open an rgl 
>> window; when rgl calls XCreateWindow R crashes with the error message
>>
>> X Error of failed request:  BadMatch (invalid parameter attributes)
>>   Major opcode of failed request:  1 (X_CreateWindow)
>>   Serial number of failed request:  28
>>   Current serial number in output stream:  29
>>
>> I've checked and as far as I can see all the parameters we're sending to 
>> XCreateWindow are valid, but I might have missed something:  I don't 
>> know much about X11 programming.  (The call is
>>
>>   ::Window xwindow = XCreateWindow(
>>     xdisplay, RootWindow(xdisplay, DefaultScreen(xdisplay)),
>>     0, 0, 256, 256, 0,
>>     xvisualinfo->depth,
>>     InputOutput,
>>     xvisualinfo->visual,
>>     valuemask,
>>     &attrib
>>   );
>>
>> but without context that's probably not worth much to others.)
>>
>>
>>     
Just a hunch: Is it possible that "attrib" contains uninitialized 
variables or is getting overwritten with random data?

>> Are there any experienced X11 programmers out there who can suggest what 
>> to do next?
>>     
>
> I have now committed some changes to rgl to avoid the crash -- it 
> converts the above error into an R error.
> I think to actually fix it, I'd need to debug the MacOSX Xvfb code to 
> see exactly what it's complaining about.  I don't know where to find 
> that source, so this isn't likely to happen soon.
>
> Are there any X11/MacOSX programmers going to the UseR! meeting in 
> August?  I'd guess if I could sit down with someone who had experience 
> with both of those we could track this down fairly quickly, but I don't 
> think I'll be able to do it without that.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From r.hankin at noc.soton.ac.uk  Tue Jun 19 11:25:27 2007
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Tue, 19 Jun 2007 10:25:27 +0100
Subject: [Rd] two bessel function bugs for nu<0
In-Reply-To: <307b90470706181533v70792d00ufc0b6e7476b085e1@mail.gmail.com>
References: <307b90470706181533v70792d00ufc0b6e7476b085e1@mail.gmail.com>
Message-ID: <3F4DF494-67E6-4F8A-B5F6-BA46B8DEA716@noc.soton.ac.uk>

I can reproduce both these bugs and confirm that the suggested fix
agrees with Mathematica and Maple for a few trial values.

I can confirm that Hiroyuki's algebra is indeed
consistent with AMS-55 equation 9.1.2
and the old source isn't.   I'd need more
time to look at equation 9.6.2.

I'm not sure why, in bessel_i.c, we are using a float ("expo")
and a long ("ize") as a Boolean [flag to indicate whether or not
to return scaled function values].

PS1:
My first thought was to check against the GSL library
but  this doesn't allow non-integer orders for besselI()

PS2: The source code apologizes for the method used,
suggesting that it may be numerically and computationally
"sub-optimal".

Best wishes

rksh







On 18 Jun 2007, at 23:33, Hiroyuki Kawakatsu wrote:

> #bug 1: besselI() for nu<0 and expon.scaled=TRUE
> #tested with R-devel (2007-06-17 r41981)
> x <- 2.3
> nu <- -0.4
> print(paste(besselI(x, nu, TRUE), "=", exp(-x)*besselI(x, nu, FALSE)))
> #fix:
> #$ diff bessel_i_old.c bessel_i_new.c
> #57c57
> #<   bessel_k(x, -alpha, expo) * ((ize == 1)? 2. : 2.*exp(-x))/M_PI
> #---
> #>   bessel_k(x, -alpha, expo) * ((ize == 1)? 2. : 2.*exp(-2.0*x))/ 
> M_PI
>
> #bug 2: besselY() for nu<0
> #don't know how to check in R; a few random checks against  
> mathematica 5.2
> #fix:
> #$ diff bessel_y_old.c bessel_y_new.c
> #55c55
> #<  return(bessel_y(x, -alpha) + bessel_j(x, -alpha) * sin(-M_PI *  
> alpha));
> #---
> #>  return(bessel_y(x, -alpha) * cos(M_PI * alpha) - bessel_j(x,
> -alpha) * sin(M_PI * alpha));
>
> h.
> -- 
> ----------------------------------
> Hiroyuki Kawakatsu
> Business School
> Dublin City University
> Dublin 9, Ireland
> Tel +353 (0)1 700 7496
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From murdoch at stats.uwo.ca  Tue Jun 19 12:44:00 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 19 Jun 2007 06:44:00 -0400
Subject: [Rd] X11 help please
In-Reply-To: <46777D01.7070301@biostat.ku.dk>
References: <46759924.5020103@stats.uwo.ca> <46773A95.3040509@stats.uwo.ca>
	<46777D01.7070301@biostat.ku.dk>
Message-ID: <4677B370.1040702@stats.uwo.ca>

On 19/06/2007 2:51 AM, Peter Dalgaard wrote:
> Duncan Murdoch wrote:
>> Duncan Murdoch wrote:
>>   
>>> The rgl package currently crashes R when running under Xvfb (the 
>>> "virtual frame buffer" server), at least on MacOSX.  It makes sense that 
>>> it shouldn't be able to work there (it needs interactivity), but I don't 
>>> know how to detect the problems before they cause the crash.
>>>
>>> Currently the error happens the first time you try to open an rgl 
>>> window; when rgl calls XCreateWindow R crashes with the error message
>>>
>>> X Error of failed request:  BadMatch (invalid parameter attributes)
>>>   Major opcode of failed request:  1 (X_CreateWindow)
>>>   Serial number of failed request:  28
>>>   Current serial number in output stream:  29
>>>
>>> I've checked and as far as I can see all the parameters we're sending to 
>>> XCreateWindow are valid, but I might have missed something:  I don't 
>>> know much about X11 programming.  (The call is
>>>
>>>   ::Window xwindow = XCreateWindow(
>>>     xdisplay, RootWindow(xdisplay, DefaultScreen(xdisplay)),
>>>     0, 0, 256, 256, 0,
>>>     xvisualinfo->depth,
>>>     InputOutput,
>>>     xvisualinfo->visual,
>>>     valuemask,
>>>     &attrib
>>>   );
>>>
>>> but without context that's probably not worth much to others.)
>>>
>>>
>>>     
> Just a hunch: Is it possible that "attrib" contains uninitialized 
> variables or is getting overwritten with random data?

I tried memset'ing the whole thing to zeros before setting a couple of 
fields, and that didn't help.  I also tried specifying that 
XCreateWindow should ignore all fields, or all but one, with no change.

I suspect that the attrib structure isn't really the problem, but I 
don't know what the problem is.  X11() works fine under Xvfb on MacOSX, 
and rgl works fine when the Xvfb server is on Linux or Cygwin (with the 
identical line to invoke Xvfb as I was using on MacOSX.)  So there's 
something special about the interaction of rgl with the MacOSX Xvfb.

Duncan Murdoch

> 
>>> Are there any experienced X11 programmers out there who can suggest what 
>>> to do next?
>>>     
>> I have now committed some changes to rgl to avoid the crash -- it 
>> converts the above error into an R error.
>> I think to actually fix it, I'd need to debug the MacOSX Xvfb code to 
>> see exactly what it's complaining about.  I don't know where to find 
>> that source, so this isn't likely to happen soon.
>>
>> Are there any X11/MacOSX programmers going to the UseR! meeting in 
>> August?  I'd guess if I could sit down with someone who had experience 
>> with both of those we could track this down fairly quickly, but I don't 
>> think I'll be able to do it without that.
>>
>> Duncan Murdoch
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From kyousan at sina.com  Wed Jun 20 04:26:13 2007
From: kyousan at sina.com (kyousan at sina.com)
Date: Wed, 20 Jun 2007 04:26:13 +0200 (CEST)
Subject: [Rd] Error in funcion distancia() in package dprep(v1.0) (PR#9745)
Message-ID: <20070620022613.67EA548497@slim.kubism.ku.dk>

Full_Name: Kang Yousan
Version: 2.5.0
OS: Windows XP
Submission from: (NULL) (211.137.211.67)


There is a bug in function distancia() in package dprep. See the description
below.

> distancia

1 function (x, y) 
2 {
3      if (class(y) == "matrix") {
4          distancia = drop(sqrt(colSums((x - t(y))^2)))
5          distancia = t(distancia)
6      }
7      else distancia = sqrt(sum((x - y)^2))
8      distancia
9  }

The t(y) in line 4 should be modified to y. Before the change, see example:
> (x=rnorm(4))
[1]  0.02670846  1.24512505 -0.22145290  1.99760521
> (y=matrix(rnorm(12),4,3))
           [,1]       [,2]       [,3]
[1,]  0.4181184  1.8980350 -1.7398861
[2,] -0.1906483 -0.1777747  0.6666913
[3,]  0.2239468 -0.2631944 -0.3586917
[4,] -1.0316230 -0.7121346  0.3587542
> distancia(x,y)
         [,1]     [,2]     [,3]     [,4]
[1,] 1.698568 2.272631 2.336264 2.847838

After the change:
a<-function (x, y) 
{
    if (class(y) == "matrix") {
        distancia = drop(sqrt(colSums((x - y)^2)))
        distancia = t(distancia)
    }
    else distancia = sqrt(sum((x - y)^2))
    distancia
}
> a(x,y)
         [,1]     [,2]     [,3]
[1,] 3.404299 3.587609 2.481957

The latter result is resonable according to the description of the function
return value: "distancia numeric value representing the Euclidean distance
between x and y, or a row matrix representing the Euclidean distance between x
and each column of y."

Thanks for attention.


From P.Dalgaard at biostat.ku.dk  Wed Jun 20 15:47:11 2007
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 20 Jun 2007 15:47:11 +0200
Subject: [Rd] Error in funcion distancia() in package dprep(v1.0)
	(PR#9745)
In-Reply-To: <20070620022613.67EA548497@slim.kubism.ku.dk>
References: <20070620022613.67EA548497@slim.kubism.ku.dk>
Message-ID: <46792FDF.1030009@biostat.ku.dk>

kyousan at sina.com wrote:
> Full_Name: Kang Yousan
> Version: 2.5.0
> OS: Windows XP
> Submission from: (NULL) (211.137.211.67)
>
>
> There is a bug in function distancia() in package dprep. See the description
> below.
>   
http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Bugs :

Finally, check carefully whether the bug is with R, or a contributed
package. Bug reports on contributed packages should be sent first to the
package maintainer, and only submitted to the R-bugs repository by
package maintainers, mentioning the package in the subject line.




-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From marc_schwartz at comcast.net  Wed Jun 20 17:53:25 2007
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Wed, 20 Jun 2007 10:53:25 -0500
Subject: [Rd] Expected behavior from:  all(c(NA, NA, NA) < NA, na.rm = TRUE)?
Message-ID: <1182354805.3785.47.camel@Bellerophon.localdomain>

Hi all,

Came across this curious behavior in:

  R version 2.5.0 Patched (2007-06-05 r41831)


A simplified example is:

> all(c(NA, NA, NA) > NA, na.rm = TRUE)
[1] TRUE


Is this expected by definition?

If one reduces this to individual comparisons, such as :

> NA > NA
[1] NA

> all(NA > NA)
[1] NA

> all(NA > NA, na.rm = TRUE)
[1] TRUE

the initial comparison on the 3 element vector would be consistent with
the last example. 

If one evaluates each side of the comparison within the parens in the
initial example, you get something along the lines of the following:

x <- c(NA, NA, NA)
x <- x[!is.na(x)]   # remove NA's (eg. mean.default(x, na.rm = TRUE))

> x
logical(0)

> logical(0) > NA
logical(0)

> all(logical(0))
[1] TRUE


If my train of thought is correct, it seems to me that the behavior
above distills down to the comparison between logical(0) and NA, which
rather than returning NA, returns logical(0). 

This would seem appropriate, given that there is no actual comparison
being made with NA, I think, since logical(0) is an 'empty' vector.

However, should all(logical(0)) return TRUE or logical(0)?  For example:

> logical(0) == logical(0)
logical(0)

> all(logical(0) == logical(0))
[1] TRUE


If the initial comparison of logical(0) returns logical(0), which is not
TRUE:

> logical(0) == TRUE
logical(0)

then why does all() return TRUE, if the individual comparison is not
TRUE?  By definition from ?all:

Given a sequence of logical arguments, a logical value indicating
whether or not all of the elements of x are TRUE. 
The value returned is TRUE if all of the values in x are TRUE, and FALSE
if any of the values in x are FALSE. 
If na.rm = FALSE and x consists of a mix of TRUE and NA values, the
value is NA.



Does this make any sense?

Thanks,

Marc Schwartz


From p.dalgaard at biostat.ku.dk  Wed Jun 20 18:37:15 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 20 Jun 2007 18:37:15 +0200
Subject: [Rd] Expected behavior from:  all(c(NA, NA, NA) < NA,
 na.rm = TRUE)?
In-Reply-To: <1182354805.3785.47.camel@Bellerophon.localdomain>
References: <1182354805.3785.47.camel@Bellerophon.localdomain>
Message-ID: <467957BB.8010602@biostat.ku.dk>

Marc Schwartz wrote:
> Hi all,
>
> Came across this curious behavior in:
>
>   R version 2.5.0 Patched (2007-06-05 r41831)
>
>
> A simplified example is:
>
>   
>> all(c(NA, NA, NA) > NA, na.rm = TRUE)
>>     
> [1] TRUE
>
>
> Is this expected by definition?
>
> If one reduces this to individual comparisons, such as :
>
>   
>> NA > NA
>>     
> [1] NA
>
>   
>> all(NA > NA)
>>     
> [1] NA
>
>   
>> all(NA > NA, na.rm = TRUE)
>>     
> [1] TRUE
>
> the initial comparison on the 3 element vector would be consistent with
> the last example. 
>
> If one evaluates each side of the comparison within the parens in the
> initial example, you get something along the lines of the following:
>
> x <- c(NA, NA, NA)
> x <- x[!is.na(x)]   # remove NA's (eg. mean.default(x, na.rm = TRUE))
>
>   
>> x
>>     
> logical(0)
>
>   
>> logical(0) > NA
>>     
> logical(0)
>
>   
>> all(logical(0))
>>     
> [1] TRUE
>
>
> If my train of thought is correct, it seems to me that the behavior
> above distills down to the comparison between logical(0) and NA, which
> rather than returning NA, returns logical(0). 
>
> This would seem appropriate, given that there is no actual comparison
> being made with NA, I think, since logical(0) is an 'empty' vector.
>
> However, should all(logical(0)) return TRUE or logical(0)?  For example:
>
>   
>> logical(0) == logical(0)
>>     
> logical(0)
>
>   
>> all(logical(0) == logical(0))
>>     
> [1] TRUE
>
>
> If the initial comparison of logical(0) returns logical(0), which is not
> TRUE:
>
>   
>> logical(0) == TRUE
>>     
> logical(0)
>
> then why does all() return TRUE, if the individual comparison is not
> TRUE?  By definition from ?all:
>
> Given a sequence of logical arguments, a logical value indicating
> whether or not all of the elements of x are TRUE. 
> The value returned is TRUE if all of the values in x are TRUE, and FALSE
> if any of the values in x are FALSE. 
> If na.rm = FALSE and x consists of a mix of TRUE and NA values, the
> value is NA.
>
>
>
> Does this make any sense?
>   
I don't see the problem. Isn't it just that all(logical(0))==TRUE by 
convention just like prod(numeric(0))==1 etc.?


From tlumley at u.washington.edu  Wed Jun 20 18:48:58 2007
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 20 Jun 2007 09:48:58 -0700 (PDT)
Subject: [Rd] Expected behavior from:  all(c(NA, NA, NA) < NA,
 na.rm = TRUE)?
In-Reply-To: <1182354805.3785.47.camel@Bellerophon.localdomain>
Message-ID: <Pine.LNX.4.43.0706200948580.28720@hymn08.u.washington.edu>

On Wed, 20 Jun 2007, Marc Schwartz wrote:
>
> If my train of thought is correct, it seems to me that the behavior
> above distills down to the comparison between logical(0) and NA, which
> rather than returning NA, returns logical(0).
>
> This would seem appropriate, given that there is no actual comparison
> being made with NA, I think, since logical(0) is an 'empty' vector.
>
> However, should all(logical(0)) return TRUE or logical(0)?  For example:
>
>> logical(0) == logical(0)
> logical(0)
>
>> all(logical(0) == logical(0))
> [1] TRUE

Yes.

>
> If the initial comparison of logical(0) returns logical(0), which is not
> TRUE:
>
>> logical(0) == TRUE
> logical(0)

Yes, they have different lengths, so they aren't equal.

> then why does all() return TRUE, if the individual comparison is not
> TRUE?  By definition from ?all:
>
> Given a sequence of logical arguments, a logical value indicating
> whether or not all of the elements of x are TRUE.

This is the empty set question that should probably be a FAQ.

All elements of logical(0) are  TRUE, in the vacuous sense that it has no elements.

The same sort of thing happens for any(logical(0)), which is FALSE; sum(numeric(0)), which is 0; prod(numeric(0)), which is 1; max(numeric(0)),which is -Inf; and min(numeric(0)), which is Inf.


This seems as though R is trying to be difficult, but there is a real benefit in terms of associativity:
   all(all(x),all(y)) is always the same as all(x,y) under this definition.
   prod(prod(x), prod(y)) is prod(x,y)
   min(min(x),min(y)) is min(x,y)
and so on.

The general principle is that a function made by 'reducing' a vector with an associative binary operator, when applied to an empty vector, gives the identity element for the operator. The identity element for AND is TRUE.


>
> Does this make any sense?
>

Yes, although it is initially surprising.


      -thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From mail at joeconway.com  Wed Jun 20 18:57:48 2007
From: mail at joeconway.com (Joe Conway)
Date: Wed, 20 Jun 2007 09:57:48 -0700
Subject: [Rd] clients and carriage returns
Message-ID: <46795C8C.8080304@joeconway.com>

I've recently ported PL/R (R embedded in Postgres as a procedural 
language) to work on Win32 -- thank you to all involved for making the 
embedded interface common between *nix and Win32!

This of course means users are now creating PL/R functions using Win32 
based editors, which are using \r\n for EOL. I had not realized this 
before, but R throws a parse error when it sees \r, even on a Win32 OS. 
Near as I can tell browsing R source, this is true on all operating 
systems -- e.g. gram.y seems to look only for \n, and in 
src/gnuwin32/graphapp/events.c:handle_char(), \r is actively replaced 
with \n. I didn't find any specific mention of EOL/newline in "Writing R 
Extensions", and only reference to related escape sequences in "R 
Language Definition".

My questions:
- Is it safe (and indeed proper) for PL/R to always convert \r\n to
   \n prior to invoking the R parser?
- Should the same be done for \r to \n (e.g. on OS X)?
- Any other considerations I should care for?

Thanks,

Joe


From marc_schwartz at comcast.net  Wed Jun 20 19:01:31 2007
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Wed, 20 Jun 2007 12:01:31 -0500
Subject: [Rd] Expected behavior from:  all(c(NA, NA, NA) < NA,
	na.rm =	TRUE)?
In-Reply-To: <Pine.LNX.4.43.0706200948580.28720@hymn08.u.washington.edu>
References: <Pine.LNX.4.43.0706200948580.28720@hymn08.u.washington.edu>
Message-ID: <1182358891.3785.66.camel@Bellerophon.localdomain>

On Wed, 2007-06-20 at 09:48 -0700, Thomas Lumley wrote:
> On Wed, 20 Jun 2007, Marc Schwartz wrote:
> >
> > If my train of thought is correct, it seems to me that the behavior
> > above distills down to the comparison between logical(0) and NA, which
> > rather than returning NA, returns logical(0).
> >
> > This would seem appropriate, given that there is no actual comparison
> > being made with NA, I think, since logical(0) is an 'empty' vector.
> >
> > However, should all(logical(0)) return TRUE or logical(0)?  For example:
> >
> >> logical(0) == logical(0)
> > logical(0)
> >
> >> all(logical(0) == logical(0))
> > [1] TRUE
> 
> Yes.
> 
> >
> > If the initial comparison of logical(0) returns logical(0), which is not
> > TRUE:
> >
> >> logical(0) == TRUE
> > logical(0)
> 
> Yes, they have different lengths, so they aren't equal.
> 
> > then why does all() return TRUE, if the individual comparison is not
> > TRUE?  By definition from ?all:
> >
> > Given a sequence of logical arguments, a logical value indicating
> > whether or not all of the elements of x are TRUE.
> 
> This is the empty set question that should probably be a FAQ.
> 
> All elements of logical(0) are  TRUE, in the vacuous sense that it has no elements.
> 
> The same sort of thing happens for any(logical(0)), which is FALSE; sum(numeric(0)), which is 0; prod(numeric(0)), which is 1; max(numeric(0)),which is -Inf; and min(numeric(0)), which is Inf.
> 
> 
> This seems as though R is trying to be difficult, but there is a real benefit in terms of associativity:
>    all(all(x),all(y)) is always the same as all(x,y) under this definition.
>    prod(prod(x), prod(y)) is prod(x,y)
>    min(min(x),min(y)) is min(x,y)
> and so on.
> 
> The general principle is that a function made by 'reducing' a vector with an associative binary operator, when applied to an empty vector, gives the identity element for the operator. The identity element for AND is TRUE.
> 
> 
> >
> > Does this make any sense?
> >
> 
> Yes, although it is initially surprising.

Thanks to you, Peter and Prof. Ripley for the clarifications.  It
compelled me to go back and review empty set characteristics and the
notion of 'vacuous truth'.

As it turns out, in the course of my search, there is a page on the R
Wiki by Tony Plate et al here:

http://wiki.r-project.org/rwiki/doku.php?id=tips:surprises:emptysetfuncs

which covers this and I'll add some comments on this specific example.

I'll just need to add some extra code in my application for these
special cases.

Thanks again, 

Marc


From ripley at stats.ox.ac.uk  Wed Jun 20 19:26:49 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 20 Jun 2007 18:26:49 +0100 (BST)
Subject: [Rd] clients and carriage returns
In-Reply-To: <46795C8C.8080304@joeconway.com>
References: <46795C8C.8080304@joeconway.com>
Message-ID: <Pine.LNX.4.64.0706201814350.28523@gannet.stats.ox.ac.uk>

I think the question is how are you accessing the parser?  The only public 
interface is R_ParseVector, and that works like parse(text=):

> parse(text="abc\ndef")
expression(abc, def)
attr(,"srcfile")
<text>
> parse(text="abc\r\ndef")
Error in parse(text = "abc\r\ndef") :
" syntax error, unexpected $undefined, expecting '\n' or ';' in "abc

This does not happen when reading from files, as the connection machinery 
converts line endings (or fgets does).  So I think the problem may be in 
how you (or PostgreSQL) are getting text from files.

The rules of R syntax are quite simple, e.g.

   Newlines have a function which is a combination of token separator and
   expression terminator.  If an expression can terminate at the end of
   the line the parser will assume it does so, otherwise the newline is
   treated as whitespace.  Semicolons (@samp{;}) may be used to separate
   elementary expressions on the same line.

(from R-lang.texi).

On Wed, 20 Jun 2007, Joe Conway wrote:

> I've recently ported PL/R (R embedded in Postgres as a procedural
> language) to work on Win32 -- thank you to all involved for making the
> embedded interface common between *nix and Win32!
>
> This of course means users are now creating PL/R functions using Win32
> based editors, which are using \r\n for EOL. I had not realized this
> before, but R throws a parse error when it sees \r, even on a Win32 OS.
> Near as I can tell browsing R source, this is true on all operating
> systems -- e.g. gram.y seems to look only for \n, and in
> src/gnuwin32/graphapp/events.c:handle_char(), \r is actively replaced
> with \n.

That's not part of R's I/O, though.

> I didn't find any specific mention of EOL/newline in "Writing R
> Extensions", and only reference to related escape sequences in "R
> Language Definition".
>
> My questions:
> - Is it safe (and indeed proper) for PL/R to always convert \r\n to
>   \n prior to invoking the R parser?
> - Should the same be done for \r to \n (e.g. on OS X)?
> - Any other considerations I should care for?
>
> Thanks,
>
> Joe
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mail at joeconway.com  Wed Jun 20 22:09:44 2007
From: mail at joeconway.com (Joe Conway)
Date: Wed, 20 Jun 2007 13:09:44 -0700
Subject: [Rd] clients and carriage returns
In-Reply-To: <Pine.LNX.4.64.0706201814350.28523@gannet.stats.ox.ac.uk>
References: <46795C8C.8080304@joeconway.com>
	<Pine.LNX.4.64.0706201814350.28523@gannet.stats.ox.ac.uk>
Message-ID: <46798988.60206@joeconway.com>

Prof Brian Ripley wrote:
> I think the question is how are you accessing the parser?  The only 
> public interface is R_ParseVector, and that works like parse(text=):

Yes, I'm using R_ParseVector. PL/R basically takes the function's text 
as stored in the Postgres system catalog table (prosrc field of 
pg_catalog.pg_proc), and feeds it to R_ParseVector more-or-less 
unchanged (currently).

> This does not happen when reading from files, as the connection 
> machinery converts line endings (or fgets does).  So I think the problem 
> may be in how you (or PostgreSQL) are getting text from files.

That makes sense. Many people use a database client such as PgAdmin III 
to create PL/R (and other) functions. PgAdmin adds standard Win32 EOLs 
to multiline CREATE FUNCTION statements, and Postgres dutifully stores 
them with the rest of the text in the catalog, exactly as received.

> The rules of R syntax are quite simple, e.g.
> 
>   Newlines have a function which is a combination of token separator and
>   expression terminator.  If an expression can terminate at the end of
>   the line the parser will assume it does so, otherwise the newline is
>   treated as whitespace.  Semicolons (@samp{;}) may be used to separate
>   elementary expressions on the same line.

I saw this paragraph, but it failed to register (through my thick skull) 
that Newline is quite literally \n. Thanks for pointing it out.

Best regards,

Joe


From hin-tak.leung at cimr.cam.ac.uk  Thu Jun 21 00:52:32 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 20 Jun 2007 23:52:32 +0100
Subject: [Rd] X11 help please
In-Reply-To: <4677B370.1040702@stats.uwo.ca>
References: <46759924.5020103@stats.uwo.ca>
	<46773A95.3040509@stats.uwo.ca>	<46777D01.7070301@biostat.ku.dk>
	<4677B370.1040702@stats.uwo.ca>
Message-ID: <4679AFB0.607@cimr.cam.ac.uk>

Duncan Murdoch wrote:
<snipped>
> I suspect that the attrib structure isn't really the problem, but I 
> don't know what the problem is.  X11() works fine under Xvfb on MacOSX, 
> and rgl works fine when the Xvfb server is on Linux or Cygwin (with the 
> identical line to invoke Xvfb as I was using on MacOSX.)  So there's 
> something special about the interaction of rgl with the MacOSX Xvfb.
<snipped>

While it is exceedingly rare (xorg developers are some of the best...)
are you talking about it working on x86/x86_64 lihux and cygwin/x86,
and not working on powerpc Mac OS X? - i.e. as opposed to possibly
  alpha/sparc/powerpc linux and x86 mac OS X?

The reason why I am asking is that intel is small-endian and
powerpc is big-endian. It is very rare, but can't say if there could
be endian-issues in the interaction. (given that most Xvfb users are
on small-endian platforms?)

It might be useful to ask at the IRC channel #freedesktop at Freenode for 
debug tips - there are some seriously hardcore X11 guru's there... I am 
sure they like to know if you can bring Xvfb down :-).

HTL


From tstex06 at student.vxu.se  Wed Jun 20 16:40:18 2007
From: tstex06 at student.vxu.se (Tamara Steijger)
Date: Wed, 20 Jun 2007 16:40:18 +0200
Subject: [Rd] extending package with function calling an Objective Caml
	program
Message-ID: <7FA9A5A3-FDEA-4B20-B89F-E3D88529EEDA@student.vxu.se>

Hallo,

we are trying to extend the R package multcompView in agreement with  
the author Hans-Peter Piepho. The function multcompLetters implements  
so far a heuristic. We would like to add a function that implements  
an exact algorithm and returns a provable optimum result. This  
algorithm has been implemented in Objective Caml and we would like to  
reuse this code. We wrote an R function that accepts the same input  
as the original function and provides the same result format. But  
this function calls the Obejctive Caml executable. This means that if  
the package is extended with this function the Objective Caml code  
has to be included as well and one needs to assure that it is  
compiled the right way if the package is loaded.

Unfortunately are we not that familiar with R and could not find  
corresponding information in the documentation. Does somebody know if  
something as described above is possible? And where information could  
be found about how to do it?

Thanks,
Tamara Steijger


From ripley at stats.ox.ac.uk  Thu Jun 21 10:21:14 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 21 Jun 2007 09:21:14 +0100 (BST)
Subject: [Rd] extending package with function calling an Objective Caml
 program
In-Reply-To: <7FA9A5A3-FDEA-4B20-B89F-E3D88529EEDA@student.vxu.se>
References: <7FA9A5A3-FDEA-4B20-B89F-E3D88529EEDA@student.vxu.se>
Message-ID: <Pine.LNX.4.64.0706210912350.1843@gannet.stats.ox.ac.uk>

On Wed, 20 Jun 2007, Tamara Steijger wrote:

> Hallo,
>
> we are trying to extend the R package multcompView in agreement with
> the author Hans-Peter Piepho. The function multcompLetters implements
> so far a heuristic. We would like to add a function that implements
> an exact algorithm and returns a provable optimum result. This
> algorithm has been implemented in Objective Caml and we would like to
> reuse this code. We wrote an R function that accepts the same input
> as the original function and provides the same result format. But
> this function calls the Obejctive Caml executable. This means that if
> the package is extended with this function the Objective Caml code
> has to be included as well and one needs to assure that it is
> compiled the right way if the package is loaded.
>
> Unfortunately are we not that familiar with R and could not find
> corresponding information in the documentation. Does somebody know if
> something as described above is possible? And where information could
> be found about how to do it?

It is possible, and the information is in 'Writing R Extensions'.

You would need to use configure to test if an OCaml compiler was 
installed, a src/Makefile to arrange to compile the executable and put it 
under inst/ so it would get installed.

Having said that, the chances that an R user would have an OCaml compiler 
installed seem to me to be very low, and it might be better to arrange to 
distribute pre-compiled versions of your package for platforms for which 
you can build it: preferably i686 and x86_64 Linux, Windows and MacOS X.

A variation on the last approach is to include prebuilt executables in the 
source package, and get configure to choose the right one to be installed 
if no OCaml compiler was found.


> Thanks,
> Tamara Steijger

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From statmobile at gmail.com  Thu Jun 21 22:11:52 2007
From: statmobile at gmail.com (statmobile at gmail.com)
Date: Thu, 21 Jun 2007 16:11:52 -0400
Subject: [Rd] Basic Question on error(_(...
Message-ID: <20070621201152.GA6013@bjl>

I'm sorry to bother this list with such trivial questions, but I'm
trying to take Prof. Ripley's advice in porting some Lapack wrappers
into my own code, because they are not public.  I'm specifically
choosing programs from R-2.5.0/src/modules/lapack/Lapack.c.  

I can't seem to understand the context in functions such as:

<snip>
        error(_("the leading minor of order %d is not positive
        definite"),
              i);
</snip> 

in functions such as modLa_chol.  Is there some place I can look to
understand the usage of the underscore '_', or could someone explain
this to me?

Thanks for the help!


From p.dalgaard at biostat.ku.dk  Thu Jun 21 22:37:31 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 21 Jun 2007 22:37:31 +0200
Subject: [Rd] Basic Question on error(_(...
In-Reply-To: <20070621201152.GA6013@bjl>
References: <20070621201152.GA6013@bjl>
Message-ID: <467AE18B.2000604@biostat.ku.dk>

statmobile at gmail.com wrote:
> I'm sorry to bother this list with such trivial questions, but I'm
> trying to take Prof. Ripley's advice in porting some Lapack wrappers
> into my own code, because they are not public.  I'm specifically
> choosing programs from R-2.5.0/src/modules/lapack/Lapack.c.  
>
> I can't seem to understand the context in functions such as:
>
> <snip>
>         error(_("the leading minor of order %d is not positive
>         definite"),
>               i);
> </snip> 
>
> in functions such as modLa_chol.  Is there some place I can look to
> understand the usage of the underscore '_', or could someone explain
> this to me?
>   
This has to do with internationalization. It signifies that translations 
are available for the error message, e.g. the file "de.po" in the R 
sources has

#: src/modules/lapack/Lapack.c:629
#, c-format
msgid "the leading minor of order %d is not positive definite"
msgstr "der f?hrende Minor der Ordnung %d ist nicht positiv definit"


From mtmorgan at fhcrc.org  Thu Jun 21 22:46:32 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 21 Jun 2007 13:46:32 -0700
Subject: [Rd] segfault during cbind
Message-ID: <6phd4zpm3x3.fsf@gopher4.fhcrc.org>

The following code results in a seg fault.

> sessionInfo()
R version 2.6.0 Under development (unstable) (2007-06-21 r42013) 
x86_64-unknown-linux-gnu 

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     
> csvFile <- read.csv("Barley1.na22.annot.csv", as.is=TRUE, na.strings="---")
> probe <- csvFile[,1]
> gb <- csvFile[, 9]
> rm(csvFile)
> gb <- lapply(unlist(gb),
+              function(x) toupper(strsplit(x,"\\.")[[1]][1]))
> id_file <- cbind(probe,gb)

 *** caught segfault ***
address 0x2c9f0, cause 'memory not mapped'

Traceback:
 1: cbind(probe, gb)
 2: makeBasefiles("Barley1.na22.annot.csv")
aborting ...
Segmentation fault

valgrind says

==25398== Invalid read of size 8
==25398==    at 0x4E7BB2D: cbind (bind.c:1258)
==25398==    by 0x4E7B430: do_bind (bind.c:1113)
==25398==    by 0x4F42A1B: do_internal (names.c:1116)
==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
==25398==    by 0x4EFC3E0: do_set (eval.c:1404)
==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
==25398==    by 0x4EFB866: do_begin (eval.c:1156)
==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
==25398==  Address 0x8F46010 is 72,976 bytes inside a block of size 182,760 free'd
==25398==    at 0x4C226DB: free (in /usr/lib64/valgrind/amd64-linux/vgpreload_memcheck.so)
==25398==    by 0x4F2D848: ReleaseLargeFreeVectors (memory.c:760)
==25398==    by 0x4F359E9: RunGenCollect (memory.c:1378)
==25398==    by 0x4F38938: R_gc_internal (memory.c:2171)
==25398==    by 0x4F38046: Rf_allocVector (memory.c:1961)
==25398==    by 0x4EDE779: duplicate1 (duplicate.c:221)
==25398==    by 0x4EDD698: Rf_duplicate (duplicate.c:115)
==25398==    by 0x4E7BB34: cbind (bind.c:1258)
==25398==    by 0x4E7B430: do_bind (bind.c:1113)
==25398==    by 0x4F42A1B: do_internal (names.c:1116)
==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)

gdb says

(gdb) backtrace
#0  0x00002b2dfe6940c9 in duplicate1 (s=0x2c9f0)
    at /home/mtmorgan/src/R-devel/src/main/duplicate.c:134
#1  0x00002b2dfe694035 in Rf_duplicate (s=0x2c9f0)
    at /home/mtmorgan/src/R-devel/src/main/duplicate.c:115
#2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19, 
    rho=0xb6ba40, deparse_level=1)
    at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
#3  0x00002b2dfe631e51 in do_bind (call=0xaaba48, op=0x62f950, args=0xb6abf0, 
    env=0xb6ba40) at /home/mtmorgan/src/R-devel/src/main/bind.c:1113
#4  0x00002b2dfe6f93d4 in do_internal (call=0xaabab8, op=0x62d028, 
    args=0xaaba10, env=0xb6ba40)
    at /home/mtmorgan/src/R-devel/src/main/names.c:1115

and

(gdb) up
#2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19, 
    rho=0xb6ba40, deparse_level=1)
    at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
(gdb) p i
$7 = 22839
(gdb) p idx
$8 = 22840

Both rm and lapply are needed to trigger the fault; an R level gc()
before the final line 'cures' the fault (and the valgind complaint).

The data file is available (with free registration) at

https://www.affymetrix.com/support/file_download.affx?onloadforward=/analysis/downloads/na22/ivt/Barley1.na22.annot.csv.zip

Martin
-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From ripley at stats.ox.ac.uk  Thu Jun 21 22:56:16 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 21 Jun 2007 21:56:16 +0100 (BST)
Subject: [Rd] Basic Question on error(_(...
In-Reply-To: <467AE18B.2000604@biostat.ku.dk>
References: <20070621201152.GA6013@bjl> <467AE18B.2000604@biostat.ku.dk>
Message-ID: <Pine.LNX.4.64.0706212150100.26695@gannet.stats.ox.ac.uk>

On Thu, 21 Jun 2007, Peter Dalgaard wrote:

> statmobile at gmail.com wrote:
>> I'm sorry to bother this list with such trivial questions, but I'm
>> trying to take Prof. Ripley's advice in porting some Lapack wrappers
>> into my own code, because they are not public.  I'm specifically
>> choosing programs from R-2.5.0/src/modules/lapack/Lapack.c.
>>
>> I can't seem to understand the context in functions such as:
>>
>> <snip>
>>         error(_("the leading minor of order %d is not positive
>>         definite"),
>>               i);
>> </snip>
>>
>> in functions such as modLa_chol.  Is there some place I can look to
>> understand the usage of the underscore '_', or could someone explain
>> this to me?
>>
> This has to do with internationalization. It signifies that translations
> are available for the error message, e.g. the file "de.po" in the R
> sources has
>
> #: src/modules/lapack/Lapack.c:629
> #, c-format
> msgid "the leading minor of order %d is not positive definite"
> msgstr "der f?hrende Minor der Ordnung %d ist nicht positiv definit"

The answer to 'where' is section 1.9 Localization in 'Writing R 
Extensions' or section 3.1 of 'R Internals'.



-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From mtmorgan at fhcrc.org  Thu Jun 21 23:01:55 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 21 Jun 2007 14:01:55 -0700
Subject: [Rd] segfault during cbind
In-Reply-To: <6phd4zpm3x3.fsf@gopher4.fhcrc.org> (Martin Morgan's message of
	"Thu, 21 Jun 2007 13:46:32 -0700")
References: <6phd4zpm3x3.fsf@gopher4.fhcrc.org>
Message-ID: <6ph8xadm37g.fsf@gopher4.fhcrc.org>

To amend, the traceback is only

> Traceback:
>  1: cbind(probe, gb)
> aborting ...

Oops. Martin

Martin Morgan <mtmorgan at fhcrc.org> writes:

> The following code results in a seg fault.
>
>> sessionInfo()
> R version 2.6.0 Under development (unstable) (2007-06-21 r42013) 
> x86_64-unknown-linux-gnu 
>
> locale:
> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base     
>> csvFile <- read.csv("Barley1.na22.annot.csv", as.is=TRUE, na.strings="---")
>> probe <- csvFile[,1]
>> gb <- csvFile[, 9]
>> rm(csvFile)
>> gb <- lapply(unlist(gb),
> +              function(x) toupper(strsplit(x,"\\.")[[1]][1]))
>> id_file <- cbind(probe,gb)
>
>  *** caught segfault ***
> address 0x2c9f0, cause 'memory not mapped'
>
> Traceback:
>  1: cbind(probe, gb)
>  2: makeBasefiles("Barley1.na22.annot.csv")
> aborting ...
> Segmentation fault
>
> valgrind says
>
> ==25398== Invalid read of size 8
> ==25398==    at 0x4E7BB2D: cbind (bind.c:1258)
> ==25398==    by 0x4E7B430: do_bind (bind.c:1113)
> ==25398==    by 0x4F42A1B: do_internal (names.c:1116)
> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
> ==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
> ==25398==    by 0x4EFC3E0: do_set (eval.c:1404)
> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
> ==25398==    by 0x4EFB866: do_begin (eval.c:1156)
> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
> ==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
> ==25398==  Address 0x8F46010 is 72,976 bytes inside a block of size 182,760 free'd
> ==25398==    at 0x4C226DB: free (in /usr/lib64/valgrind/amd64-linux/vgpreload_memcheck.so)
> ==25398==    by 0x4F2D848: ReleaseLargeFreeVectors (memory.c:760)
> ==25398==    by 0x4F359E9: RunGenCollect (memory.c:1378)
> ==25398==    by 0x4F38938: R_gc_internal (memory.c:2171)
> ==25398==    by 0x4F38046: Rf_allocVector (memory.c:1961)
> ==25398==    by 0x4EDE779: duplicate1 (duplicate.c:221)
> ==25398==    by 0x4EDD698: Rf_duplicate (duplicate.c:115)
> ==25398==    by 0x4E7BB34: cbind (bind.c:1258)
> ==25398==    by 0x4E7B430: do_bind (bind.c:1113)
> ==25398==    by 0x4F42A1B: do_internal (names.c:1116)
> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
>
> gdb says
>
> (gdb) backtrace
> #0  0x00002b2dfe6940c9 in duplicate1 (s=0x2c9f0)
>     at /home/mtmorgan/src/R-devel/src/main/duplicate.c:134
> #1  0x00002b2dfe694035 in Rf_duplicate (s=0x2c9f0)
>     at /home/mtmorgan/src/R-devel/src/main/duplicate.c:115
> #2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19, 
>     rho=0xb6ba40, deparse_level=1)
>     at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
> #3  0x00002b2dfe631e51 in do_bind (call=0xaaba48, op=0x62f950, args=0xb6abf0, 
>     env=0xb6ba40) at /home/mtmorgan/src/R-devel/src/main/bind.c:1113
> #4  0x00002b2dfe6f93d4 in do_internal (call=0xaabab8, op=0x62d028, 
>     args=0xaaba10, env=0xb6ba40)
>     at /home/mtmorgan/src/R-devel/src/main/names.c:1115
>
> and
>
> (gdb) up
> #2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19, 
>     rho=0xb6ba40, deparse_level=1)
>     at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
> (gdb) p i
> $7 = 22839
> (gdb) p idx
> $8 = 22840
>
> Both rm and lapply are needed to trigger the fault; an R level gc()
> before the final line 'cures' the fault (and the valgind complaint).
>
> The data file is available (with free registration) at
>
> https://www.affymetrix.com/support/file_download.affx?onloadforward=/analysis/downloads/na22/ivt/Barley1.na22.annot.csv.zip
>
> Martin
> -- 
> Martin Morgan
> Bioconductor / Computational Biology
> http://bioconductor.org
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From ripley at stats.ox.ac.uk  Thu Jun 21 23:10:51 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 21 Jun 2007 22:10:51 +0100 (BST)
Subject: [Rd] segfault during cbind
In-Reply-To: <6phd4zpm3x3.fsf@gopher4.fhcrc.org>
References: <6phd4zpm3x3.fsf@gopher4.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0706212206280.27147@gannet.stats.ox.ac.uk>

I think it needs to be

 		case LISTSXP:
 		    PROTECT(u = coerceVector(u, mode));
 		    k = LENGTH(u);
 		    idx = (!isMatrix(u)) ? rows : k;
 		    for (i = 0; i < idx; i++)
 			SET_VECTOR_ELT(result, n++,
 				       duplicate(VECTOR_ELT(u, i % k)));
 		    UNPROTECT(1);
 		    break;

around 1258 in bind.c.  Can you test that please?


On Thu, 21 Jun 2007, Martin Morgan wrote:

> The following code results in a seg fault.
>
>> sessionInfo()
> R version 2.6.0 Under development (unstable) (2007-06-21 r42013)
> x86_64-unknown-linux-gnu
>
> locale:
> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>> csvFile <- read.csv("Barley1.na22.annot.csv", as.is=TRUE, na.strings="---")
>> probe <- csvFile[,1]
>> gb <- csvFile[, 9]
>> rm(csvFile)
>> gb <- lapply(unlist(gb),
> +              function(x) toupper(strsplit(x,"\\.")[[1]][1]))
>> id_file <- cbind(probe,gb)
>
> *** caught segfault ***
> address 0x2c9f0, cause 'memory not mapped'
>
> Traceback:
> 1: cbind(probe, gb)
> 2: makeBasefiles("Barley1.na22.annot.csv")
> aborting ...
> Segmentation fault
>
> valgrind says
>
> ==25398== Invalid read of size 8
> ==25398==    at 0x4E7BB2D: cbind (bind.c:1258)
> ==25398==    by 0x4E7B430: do_bind (bind.c:1113)
> ==25398==    by 0x4F42A1B: do_internal (names.c:1116)
> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
> ==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
> ==25398==    by 0x4EFC3E0: do_set (eval.c:1404)
> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
> ==25398==    by 0x4EFB866: do_begin (eval.c:1156)
> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
> ==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
> ==25398==  Address 0x8F46010 is 72,976 bytes inside a block of size 182,760 free'd
> ==25398==    at 0x4C226DB: free (in /usr/lib64/valgrind/amd64-linux/vgpreload_memcheck.so)
> ==25398==    by 0x4F2D848: ReleaseLargeFreeVectors (memory.c:760)
> ==25398==    by 0x4F359E9: RunGenCollect (memory.c:1378)
> ==25398==    by 0x4F38938: R_gc_internal (memory.c:2171)
> ==25398==    by 0x4F38046: Rf_allocVector (memory.c:1961)
> ==25398==    by 0x4EDE779: duplicate1 (duplicate.c:221)
> ==25398==    by 0x4EDD698: Rf_duplicate (duplicate.c:115)
> ==25398==    by 0x4E7BB34: cbind (bind.c:1258)
> ==25398==    by 0x4E7B430: do_bind (bind.c:1113)
> ==25398==    by 0x4F42A1B: do_internal (names.c:1116)
> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
>
> gdb says
>
> (gdb) backtrace
> #0  0x00002b2dfe6940c9 in duplicate1 (s=0x2c9f0)
>    at /home/mtmorgan/src/R-devel/src/main/duplicate.c:134
> #1  0x00002b2dfe694035 in Rf_duplicate (s=0x2c9f0)
>    at /home/mtmorgan/src/R-devel/src/main/duplicate.c:115
> #2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19,
>    rho=0xb6ba40, deparse_level=1)
>    at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
> #3  0x00002b2dfe631e51 in do_bind (call=0xaaba48, op=0x62f950, args=0xb6abf0,
>    env=0xb6ba40) at /home/mtmorgan/src/R-devel/src/main/bind.c:1113
> #4  0x00002b2dfe6f93d4 in do_internal (call=0xaabab8, op=0x62d028,
>    args=0xaaba10, env=0xb6ba40)
>    at /home/mtmorgan/src/R-devel/src/main/names.c:1115
>
> and
>
> (gdb) up
> #2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19,
>    rho=0xb6ba40, deparse_level=1)
>    at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
> (gdb) p i
> $7 = 22839
> (gdb) p idx
> $8 = 22840
>
> Both rm and lapply are needed to trigger the fault; an R level gc()
> before the final line 'cures' the fault (and the valgind complaint).
>
> The data file is available (with free registration) at
>
> https://www.affymetrix.com/support/file_download.affx?onloadforward=/analysis/downloads/na22/ivt/Barley1.na22.annot.csv.zip
>
> Martin
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mtmorgan at fhcrc.org  Thu Jun 21 23:23:37 2007
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 21 Jun 2007 14:23:37 -0700
Subject: [Rd] segfault during cbind
In-Reply-To: <Pine.LNX.4.64.0706212206280.27147@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Thu, 21 Jun 2007 22:10:51 +0100 (BST)")
References: <6phd4zpm3x3.fsf@gopher4.fhcrc.org>
	<Pine.LNX.4.64.0706212206280.27147@gannet.stats.ox.ac.uk>
Message-ID: <6ph4pl1m27a.fsf@gopher4.fhcrc.org>

Yes, that seems to do the trick, for both seg fault and valgrind!
Thanks very much.

Martin

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> I think it needs to be
>
>  		case LISTSXP:
>  		    PROTECT(u = coerceVector(u, mode));
>  		    k = LENGTH(u);
>  		    idx = (!isMatrix(u)) ? rows : k;
>  		    for (i = 0; i < idx; i++)
>  			SET_VECTOR_ELT(result, n++,
>  				       duplicate(VECTOR_ELT(u, i % k)));
>  		    UNPROTECT(1);
>  		    break;
>
> around 1258 in bind.c.  Can you test that please?
>
>
> On Thu, 21 Jun 2007, Martin Morgan wrote:
>
>> The following code results in a seg fault.
>>
>>> sessionInfo()
>> R version 2.6.0 Under development (unstable) (2007-06-21 r42013)
>> x86_64-unknown-linux-gnu
>>
>> locale:
>> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>> csvFile <- read.csv("Barley1.na22.annot.csv", as.is=TRUE, na.strings="---")
>>> probe <- csvFile[,1]
>>> gb <- csvFile[, 9]
>>> rm(csvFile)
>>> gb <- lapply(unlist(gb),
>> +              function(x) toupper(strsplit(x,"\\.")[[1]][1]))
>>> id_file <- cbind(probe,gb)
>>
>> *** caught segfault ***
>> address 0x2c9f0, cause 'memory not mapped'
>>
>> Traceback:
>> 1: cbind(probe, gb)
>> 2: makeBasefiles("Barley1.na22.annot.csv")
>> aborting ...
>> Segmentation fault
>>
>> valgrind says
>>
>> ==25398== Invalid read of size 8
>> ==25398==    at 0x4E7BB2D: cbind (bind.c:1258)
>> ==25398==    by 0x4E7B430: do_bind (bind.c:1113)
>> ==25398==    by 0x4F42A1B: do_internal (names.c:1116)
>> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
>> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
>> ==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
>> ==25398==    by 0x4EFC3E0: do_set (eval.c:1404)
>> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
>> ==25398==    by 0x4EFB866: do_begin (eval.c:1156)
>> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
>> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
>> ==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
>> ==25398==  Address 0x8F46010 is 72,976 bytes inside a block of size 182,760 free'd
>> ==25398==    at 0x4C226DB: free (in /usr/lib64/valgrind/amd64-linux/vgpreload_memcheck.so)
>> ==25398==    by 0x4F2D848: ReleaseLargeFreeVectors (memory.c:760)
>> ==25398==    by 0x4F359E9: RunGenCollect (memory.c:1378)
>> ==25398==    by 0x4F38938: R_gc_internal (memory.c:2171)
>> ==25398==    by 0x4F38046: Rf_allocVector (memory.c:1961)
>> ==25398==    by 0x4EDE779: duplicate1 (duplicate.c:221)
>> ==25398==    by 0x4EDD698: Rf_duplicate (duplicate.c:115)
>> ==25398==    by 0x4E7BB34: cbind (bind.c:1258)
>> ==25398==    by 0x4E7B430: do_bind (bind.c:1113)
>> ==25398==    by 0x4F42A1B: do_internal (names.c:1116)
>> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
>> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
>>
>> gdb says
>>
>> (gdb) backtrace
>> #0  0x00002b2dfe6940c9 in duplicate1 (s=0x2c9f0)
>>    at /home/mtmorgan/src/R-devel/src/main/duplicate.c:134
>> #1  0x00002b2dfe694035 in Rf_duplicate (s=0x2c9f0)
>>    at /home/mtmorgan/src/R-devel/src/main/duplicate.c:115
>> #2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19,
>>    rho=0xb6ba40, deparse_level=1)
>>    at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
>> #3  0x00002b2dfe631e51 in do_bind (call=0xaaba48, op=0x62f950, args=0xb6abf0,
>>    env=0xb6ba40) at /home/mtmorgan/src/R-devel/src/main/bind.c:1113
>> #4  0x00002b2dfe6f93d4 in do_internal (call=0xaabab8, op=0x62d028,
>>    args=0xaaba10, env=0xb6ba40)
>>    at /home/mtmorgan/src/R-devel/src/main/names.c:1115
>>
>> and
>>
>> (gdb) up
>> #2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19,
>>    rho=0xb6ba40, deparse_level=1)
>>    at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
>> (gdb) p i
>> $7 = 22839
>> (gdb) p idx
>> $8 = 22840
>>
>> Both rm and lapply are needed to trigger the fault; an R level gc()
>> before the final line 'cures' the fault (and the valgind complaint).
>>
>> The data file is available (with free registration) at
>>
>> https://www.affymetrix.com/support/file_download.affx?onloadforward=/analysis/downloads/na22/ivt/Barley1.na22.annot.csv.zip
>>
>> Martin
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Martin Morgan
Bioconductor / Computational Biology
http://bioconductor.org


From ripley at stats.ox.ac.uk  Thu Jun 21 23:28:15 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 21 Jun 2007 22:28:15 +0100 (BST)
Subject: [Rd] segfault during cbind
In-Reply-To: <6ph4pl1m27a.fsf@gopher4.fhcrc.org>
References: <6phd4zpm3x3.fsf@gopher4.fhcrc.org>
	<Pine.LNX.4.64.0706212206280.27147@gannet.stats.ox.ac.uk>
	<6ph4pl1m27a.fsf@gopher4.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0706212224540.27711@gannet.stats.ox.ac.uk>

On Thu, 21 Jun 2007, Martin Morgan wrote:

> Yes, that seems to do the trick, for both seg fault and valgrind!
> Thanks very much.

Thanks: this and a similar one elsewhere seem long-standing bugs in bind.c
Will commit shortly.

>
> Martin
>
> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> I think it needs to be
>>
>>  		case LISTSXP:
>>  		    PROTECT(u = coerceVector(u, mode));
>>  		    k = LENGTH(u);
>>  		    idx = (!isMatrix(u)) ? rows : k;
>>  		    for (i = 0; i < idx; i++)
>>  			SET_VECTOR_ELT(result, n++,
>>  				       duplicate(VECTOR_ELT(u, i % k)));
>>  		    UNPROTECT(1);
>>  		    break;
>>
>> around 1258 in bind.c.  Can you test that please?
>>
>>
>> On Thu, 21 Jun 2007, Martin Morgan wrote:
>>
>>> The following code results in a seg fault.
>>>
>>>> sessionInfo()
>>> R version 2.6.0 Under development (unstable) (2007-06-21 r42013)
>>> x86_64-unknown-linux-gnu
>>>
>>> locale:
>>> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>> csvFile <- read.csv("Barley1.na22.annot.csv", as.is=TRUE, na.strings="---")
>>>> probe <- csvFile[,1]
>>>> gb <- csvFile[, 9]
>>>> rm(csvFile)
>>>> gb <- lapply(unlist(gb),
>>> +              function(x) toupper(strsplit(x,"\\.")[[1]][1]))
>>>> id_file <- cbind(probe,gb)
>>>
>>> *** caught segfault ***
>>> address 0x2c9f0, cause 'memory not mapped'
>>>
>>> Traceback:
>>> 1: cbind(probe, gb)
>>> 2: makeBasefiles("Barley1.na22.annot.csv")
>>> aborting ...
>>> Segmentation fault
>>>
>>> valgrind says
>>>
>>> ==25398== Invalid read of size 8
>>> ==25398==    at 0x4E7BB2D: cbind (bind.c:1258)
>>> ==25398==    by 0x4E7B430: do_bind (bind.c:1113)
>>> ==25398==    by 0x4F42A1B: do_internal (names.c:1116)
>>> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
>>> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
>>> ==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
>>> ==25398==    by 0x4EFC3E0: do_set (eval.c:1404)
>>> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
>>> ==25398==    by 0x4EFB866: do_begin (eval.c:1156)
>>> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
>>> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
>>> ==25398==    by 0x4EF988D: Rf_eval (eval.c:507)
>>> ==25398==  Address 0x8F46010 is 72,976 bytes inside a block of size 182,760 free'd
>>> ==25398==    at 0x4C226DB: free (in /usr/lib64/valgrind/amd64-linux/vgpreload_memcheck.so)
>>> ==25398==    by 0x4F2D848: ReleaseLargeFreeVectors (memory.c:760)
>>> ==25398==    by 0x4F359E9: RunGenCollect (memory.c:1378)
>>> ==25398==    by 0x4F38938: R_gc_internal (memory.c:2171)
>>> ==25398==    by 0x4F38046: Rf_allocVector (memory.c:1961)
>>> ==25398==    by 0x4EDE779: duplicate1 (duplicate.c:221)
>>> ==25398==    by 0x4EDD698: Rf_duplicate (duplicate.c:115)
>>> ==25398==    by 0x4E7BB34: cbind (bind.c:1258)
>>> ==25398==    by 0x4E7B430: do_bind (bind.c:1113)
>>> ==25398==    by 0x4F42A1B: do_internal (names.c:1116)
>>> ==25398==    by 0x4EF959B: Rf_eval (eval.c:463)
>>> ==25398==    by 0x4EF9F91: Rf_applyClosure (eval.c:666)
>>>
>>> gdb says
>>>
>>> (gdb) backtrace
>>> #0  0x00002b2dfe6940c9 in duplicate1 (s=0x2c9f0)
>>>    at /home/mtmorgan/src/R-devel/src/main/duplicate.c:134
>>> #1  0x00002b2dfe694035 in Rf_duplicate (s=0x2c9f0)
>>>    at /home/mtmorgan/src/R-devel/src/main/duplicate.c:115
>>> #2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19,
>>>    rho=0xb6ba40, deparse_level=1)
>>>    at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
>>> #3  0x00002b2dfe631e51 in do_bind (call=0xaaba48, op=0x62f950, args=0xb6abf0,
>>>    env=0xb6ba40) at /home/mtmorgan/src/R-devel/src/main/bind.c:1113
>>> #4  0x00002b2dfe6f93d4 in do_internal (call=0xaabab8, op=0x62d028,
>>>    args=0xaaba10, env=0xb6ba40)
>>>    at /home/mtmorgan/src/R-devel/src/main/names.c:1115
>>>
>>> and
>>>
>>> (gdb) up
>>> #2  0x00002b2dfe632555 in cbind (call=0xaaba48, args=0xb6abf0, mode=19,
>>>    rho=0xb6ba40, deparse_level=1)
>>>    at /home/mtmorgan/src/R-devel/src/main/bind.c:1263
>>> (gdb) p i
>>> $7 = 22839
>>> (gdb) p idx
>>> $8 = 22840
>>>
>>> Both rm and lapply are needed to trigger the fault; an R level gc()
>>> before the final line 'cures' the fault (and the valgind complaint).
>>>
>>> The data file is available (with free registration) at
>>>
>>> https://www.affymetrix.com/support/file_download.affx?onloadforward=/analysis/downloads/na22/ivt/Barley1.na22.annot.csv.zip
>>>
>>> Martin
>>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Fri Jun 22 10:14:39 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 22 Jun 2007 10:14:39 +0200
Subject: [Rd] Cross-platform check for internet connection
Message-ID: <f8e6ff050706220114gb008b92ib58e151e4742f774@mail.gmail.com>

What's the recommended way to check if an internet connection is
available across platforms?  I was using is.null(nsl()) but this does
not work on windows.

Thanks,

Hadley


From dan.bolser at gmail.com  Fri Jun 22 11:20:55 2007
From: dan.bolser at gmail.com (Dan Bolser)
Date: Fri, 22 Jun 2007 11:20:55 +0200
Subject: [Rd] Compile error on a 'scratch' linux distro
Message-ID: <2c8757af0706220220t353c9673q12940fcaf6c34d76@mail.gmail.com>

Here are the details...

uname -a
Linux yellow 2.6.16.1.i686.1 #23 SMP Mon Aug 28 15:36:14 CEST 2006
i686 GNU/Linux

gcc --version
gcc (GCC) 4.2.0

g77 --version
GNU Fortran (GCC) 3.4.4


What else should I post that may help debug this problem? Below is the
text of the error...

make[3]: Entering directory `/tmp/R-2.5.0/src/main'
gcc -std=gnu99 -Wl,--export-dynamic -L/usr/local/lib -o R.bin Rmain.o
CConverters.o CommandLineArgs.o Rdynload.o Renviron.o RNG.o apply.o
arithmetic.o apse.o array.o attrib.o base.o bind.o builtin.o
character.o coerce.o colors.o complex.o connections.o context.o cov.o
cum.o dcf.o datetime.o debug.o deparse.o deriv.o dotcode.o dounzip.o
dstruct.o duplicate.o engine.o envir.o errors.o eval.o format.o
fourier.o gevents.o gram.o gram-ex.o graphics.o identical.o internet.o
iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o
match.o memory.o model.o names.o objects.o optim.o optimize.o
options.o par.o paste.o pcre.o platform.o plot.o plot3d.o plotmath.o
print.o printarray.o printvector.o printutils.o qsort.o random.o
regex.o registration.o relop.o rlocale.o saveload.o scan.o seq.o
serialize.o size.o sort.o source.o split.o sprintf.o startup.o
subassign.o subscript.o subset.o summary.o sysutils.o unique.o util.o
version.o vfonts.o xxxpr.o   ../unix/libunix.a ../appl/libappl.a
../nmath/libnmath.a -L../../lib -lRblas
-L/arch/i686/usr/lib/gcc/i686-pc-linux-gnu/3.4.4
-L/arch/i686/usr/lib/gcc -L/arch/i686/usr/lib -lg2c -lm -lgcc_s
../extra/zlib/libz.a ../extra/bzip2/libbz2.a ../extra/pcre/libpcre.a
-lreadline  -ldl -lm -liconv
complex.o: In function `z_logbase':
/tmp/R-2.5.0/src/main/complex.c:450: undefined reference to `__divdc3'
complex.o: In function `z_atan2':
/tmp/R-2.5.0/src/main/complex.c:544: undefined reference to `__divdc3'
complex.o: In function `complex_binary':
/tmp/R-2.5.0/src/main/complex.c:257: undefined reference to `__divdc3'
/tmp/R-2.5.0/src/main/complex.c:245: undefined reference to `__muldc3'
collect2: ld returned 1 exit status
make[3]: *** [R.bin] Error 1
make[3]: Leaving directory `/tmp/R-2.5.0/src/main'
make[2]: *** [R] Error 2
make[2]: Leaving directory `/tmp/R-2.5.0/src/main'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/tmp/R-2.5.0/src'
make: *** [R] Error 1


From ripley at stats.ox.ac.uk  Fri Jun 22 12:28:29 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 22 Jun 2007 11:28:29 +0100 (BST)
Subject: [Rd] Compile error on a 'scratch' linux distro
In-Reply-To: <2c8757af0706220220t353c9673q12940fcaf6c34d76@mail.gmail.com>
References: <2c8757af0706220220t353c9673q12940fcaf6c34d76@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706221121190.21000@gannet.stats.ox.ac.uk>

On Fri, 22 Jun 2007, Dan Bolser wrote:

> Here are the details...
>
> uname -a
> Linux yellow 2.6.16.1.i686.1 #23 SMP Mon Aug 28 15:36:14 CEST 2006
> i686 GNU/Linux
>
> gcc --version
> gcc (GCC) 4.2.0
>
> g77 --version
> GNU Fortran (GCC) 3.4.4

You need a matching gcc set: the gcc4 support routines are not matching 
those for gcc3.

Since your gcc postdates your OS, I suggest you get gfortran from gcc 
4.2.0 to match.  In what sense is this a 'scratch' distro?  I'd be 
surprised if a distro shipped with gcc 4.2.0 (released 2007-05-13) and an 
outdated kernel.


> What else should I post that may help debug this problem? Below is the
> text of the error...
>
> make[3]: Entering directory `/tmp/R-2.5.0/src/main'
> gcc -std=gnu99 -Wl,--export-dynamic -L/usr/local/lib -o R.bin Rmain.o
> CConverters.o CommandLineArgs.o Rdynload.o Renviron.o RNG.o apply.o
> arithmetic.o apse.o array.o attrib.o base.o bind.o builtin.o
> character.o coerce.o colors.o complex.o connections.o context.o cov.o
> cum.o dcf.o datetime.o debug.o deparse.o deriv.o dotcode.o dounzip.o
> dstruct.o duplicate.o engine.o envir.o errors.o eval.o format.o
> fourier.o gevents.o gram.o gram-ex.o graphics.o identical.o internet.o
> iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o
> match.o memory.o model.o names.o objects.o optim.o optimize.o
> options.o par.o paste.o pcre.o platform.o plot.o plot3d.o plotmath.o
> print.o printarray.o printvector.o printutils.o qsort.o random.o
> regex.o registration.o relop.o rlocale.o saveload.o scan.o seq.o
> serialize.o size.o sort.o source.o split.o sprintf.o startup.o
> subassign.o subscript.o subset.o summary.o sysutils.o unique.o util.o
> version.o vfonts.o xxxpr.o   ../unix/libunix.a ../appl/libappl.a
> ../nmath/libnmath.a -L../../lib -lRblas
> -L/arch/i686/usr/lib/gcc/i686-pc-linux-gnu/3.4.4
> -L/arch/i686/usr/lib/gcc -L/arch/i686/usr/lib -lg2c -lm -lgcc_s
> ../extra/zlib/libz.a ../extra/bzip2/libbz2.a ../extra/pcre/libpcre.a
> -lreadline  -ldl -lm -liconv
> complex.o: In function `z_logbase':
> /tmp/R-2.5.0/src/main/complex.c:450: undefined reference to `__divdc3'
> complex.o: In function `z_atan2':
> /tmp/R-2.5.0/src/main/complex.c:544: undefined reference to `__divdc3'
> complex.o: In function `complex_binary':
> /tmp/R-2.5.0/src/main/complex.c:257: undefined reference to `__divdc3'
> /tmp/R-2.5.0/src/main/complex.c:245: undefined reference to `__muldc3'
> collect2: ld returned 1 exit status
> make[3]: *** [R.bin] Error 1
> make[3]: Leaving directory `/tmp/R-2.5.0/src/main'
> make[2]: *** [R] Error 2
> make[2]: Leaving directory `/tmp/R-2.5.0/src/main'
> make[1]: *** [R] Error 1
> make[1]: Leaving directory `/tmp/R-2.5.0/src'
> make: *** [R] Error 1
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Fri Jun 22 12:40:17 2007
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 22 Jun 2007 11:40:17 +0100
Subject: [Rd] Compile error on a 'scratch' linux distro
In-Reply-To: <2c8757af0706220220t353c9673q12940fcaf6c34d76@mail.gmail.com>
References: <2c8757af0706220220t353c9673q12940fcaf6c34d76@mail.gmail.com>
Message-ID: <467BA711.3080802@cimr.cam.ac.uk>

Don't do that - if you are using gcc 4.x, you should be using gfortran 
4.x, rather than g77 3.x...

Dan Bolser wrote:
> Here are the details...
> 
> uname -a
> Linux yellow 2.6.16.1.i686.1 #23 SMP Mon Aug 28 15:36:14 CEST 2006
> i686 GNU/Linux
> 
> gcc --version
> gcc (GCC) 4.2.0
> 
> g77 --version
> GNU Fortran (GCC) 3.4.4

<snipped>
> -L/arch/i686/usr/lib/gcc/i686-pc-linux-gnu/3.4.4
> -L/arch/i686/usr/lib/gcc -L/arch/i686/usr/lib -lg2c -lm -lgcc_s
> ../extra/zlib/libz.a ../extra/bzip2/libbz2.a ../extra/pcre/libpcre.a
> -lreadline  -ldl -lm -liconv
> complex.o: In function `z_logbase':
> /tmp/R-2.5.0/src/main/complex.c:450: undefined reference to `__divdc3'
> complex.o: In function `z_atan2':
> /tmp/R-2.5.0/src/main/complex.c:544: undefined reference to `__divdc3'
> complex.o: In function `complex_binary':
> /tmp/R-2.5.0/src/main/complex.c:257: undefined reference to `__divdc3'
> /tmp/R-2.5.0/src/main/complex.c:245: undefined reference to `__muldc3'
> collect2: ld returned 1 exit status
<snipped>


From ripley at stats.ox.ac.uk  Fri Jun 22 13:40:38 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 22 Jun 2007 12:40:38 +0100 (BST)
Subject: [Rd] Cross-platform check for internet connection
In-Reply-To: <f8e6ff050706220114gb008b92ib58e151e4742f774@mail.gmail.com>
References: <f8e6ff050706220114gb008b92ib58e151e4742f774@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706221117520.21000@gannet.stats.ox.ac.uk>

On Fri, 22 Jun 2007, hadley wickham wrote:

> What's the recommended way to check if an internet connection is
> available across platforms?  I was using is.null(nsl()) but this does
> not work on windows.

I don't know a way to do this on Windows without a possible very long 
hang.  It's complicated by the use of two alternative internet connection 
mechanisms on Windows and having little control over the IE-based one.

Another issue is software firewalls: they can take many minutes to 
decide to let a new program talk to the Internet if they 'call home' to 
ask advice.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Fri Jun 22 13:46:17 2007
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 22 Jun 2007 13:46:17 +0200
Subject: [Rd] Cross-platform check for internet connection
In-Reply-To: <Pine.LNX.4.64.0706221117520.21000@gannet.stats.ox.ac.uk>
References: <f8e6ff050706220114gb008b92ib58e151e4742f774@mail.gmail.com>
	<Pine.LNX.4.64.0706221117520.21000@gannet.stats.ox.ac.uk>
Message-ID: <f8e6ff050706220446i39d2222cqb9f30c38f93f2066@mail.gmail.com>

On 6/22/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Fri, 22 Jun 2007, hadley wickham wrote:
>
> > What's the recommended way to check if an internet connection is
> > available across platforms?  I was using is.null(nsl()) but this does
> > not work on windows.
>
> I don't know a way to do this on Windows without a possible very long
> hang.  It's complicated by the use of two alternative internet connection
> mechanisms on Windows and having little control over the IE-based one.
>
> Another issue is software firewalls: they can take many minutes to
> decide to let a new program talk to the Internet if they 'call home' to
> ask advice.

Thanks for those details, I hadn't considered the problems that might
be associated with firewalls.

To give a little more context, I have an example in one of my packages
which downloads some data off the web.  I don't really want to include
the data in my package, since it's not my data (although I'm fairly
certain I could get permission to include it).

So really it doesn't matter if there will be a long delay, provided
that there won't be a long delay for the windows CRAN server.  I could
wrap the entire example in dontrun, but then that loses the useful
checking I get locally when running r cmd check.

Are there any other solutions?

Thanks,

Hadley


From ripley at stats.ox.ac.uk  Fri Jun 22 14:11:11 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 22 Jun 2007 13:11:11 +0100 (BST)
Subject: [Rd] Cross-platform check for internet connection
In-Reply-To: <f8e6ff050706220446i39d2222cqb9f30c38f93f2066@mail.gmail.com>
References: <f8e6ff050706220114gb008b92ib58e151e4742f774@mail.gmail.com> 
	<Pine.LNX.4.64.0706221117520.21000@gannet.stats.ox.ac.uk>
	<f8e6ff050706220446i39d2222cqb9f30c38f93f2066@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706221304410.394@gannet.stats.ox.ac.uk>

On Fri, 22 Jun 2007, hadley wickham wrote:

> On 6/22/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> On Fri, 22 Jun 2007, hadley wickham wrote:
>> 
>> > What's the recommended way to check if an internet connection is
>> > available across platforms?  I was using is.null(nsl()) but this does
>> > not work on windows.
>> 
>> I don't know a way to do this on Windows without a possible very long
>> hang.  It's complicated by the use of two alternative internet connection
>> mechanisms on Windows and having little control over the IE-based one.
>> 
>> Another issue is software firewalls: they can take many minutes to
>> decide to let a new program talk to the Internet if they 'call home' to
>> ask advice.
>
> Thanks for those details, I hadn't considered the problems that might
> be associated with firewalls.
>
> To give a little more context, I have an example in one of my packages
> which downloads some data off the web.  I don't really want to include
> the data in my package, since it's not my data (although I'm fairly
> certain I could get permission to include it).

There are several packages on CRAN which do that.  Some do take a long 
time, and as a result are only partially checked.  If I recall right, 
'celsius' is an example on the stoplist (it takes many tens of minutes to 
get its data) and 'tseries' and a couple more fail occasionally when the 
data are not available in time.

> So really it doesn't matter if there will be a long delay, provided
> that there won't be a long delay for the windows CRAN server.  I could
> wrap the entire example in dontrun, but then that loses the useful
> checking I get locally when running r cmd check.

You could also not run the example on Windows by wrapping it in 
if(.Platform$OS.type != "windows) {}
but I don't see that as necessary.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pinard at iro.umontreal.ca  Fri Jun 22 16:04:50 2007
From: pinard at iro.umontreal.ca (=?iso-8859-1?Q?Fran=E7ois?= Pinard)
Date: Fri, 22 Jun 2007 10:04:50 -0400
Subject: [Rd] R 2.5.0 - Typo in commandArgs.Rd
Message-ID: <20070622140450.GA15819@alcyon.progiciels-bpi.ca>

Hi, people.

commandArgs.Rd has these lines (a bit before \examples):

  If \code{trailingOnly=TRUE}, a character vector of those arguments
  (if any) supplied after \code{==args}.

It should likely be: ... \code{--args}.

-- 
Fran?ois Pinard   http://pinard.progiciels-bpi.ca


From maechler at stat.math.ethz.ch  Fri Jun 22 17:44:36 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 22 Jun 2007 17:44:36 +0200
Subject: [Rd] R 2.5.0 - Typo in commandArgs.Rd
In-Reply-To: <20070622140450.GA15819@alcyon.progiciels-bpi.ca>
References: <20070622140450.GA15819@alcyon.progiciels-bpi.ca>
Message-ID: <18043.61028.934206.653293@stat.math.ethz.ch>

Merci bien, Fran?ois!!

This is now fixed also for the 2.5.1 release candidate.
Martin

>>>>> "FrPi" == Fran?ois Pinard <pinard at iro.umontreal.ca>
>>>>>     on Fri, 22 Jun 2007 10:04:50 -0400 writes:

    FrPi> Hi, people.
    FrPi> commandArgs.Rd has these lines (a bit before \examples):

    FrPi> If \code{trailingOnly=TRUE}, a character vector of those arguments
    FrPi> (if any) supplied after \code{==args}.

    FrPi> It should likely be: ... \code{--args}.

    FrPi> -- 
    FrPi> Fran?ois Pinard   http://pinard.progiciels-bpi.ca


From S.Ellison at lgc.co.uk  Fri Jun 22 16:56:55 2007
From: S.Ellison at lgc.co.uk (S Ellison)
Date: Fri, 22 Jun 2007 15:56:55 +0100
Subject: [Rd] Boxplot issues (formerly posted to R-help in error)
Message-ID: <s67bf162.000@tedmail2.lgc.co.uk>

Boxplot and bxp seem to have changed behaviour a bit of late (R 2.4.1). Or maybe I am mis-remembering.

An annoying feature is that while at=3:6 will work, there is no way of overriding the default xlim of 0.5 to n+0.5. That prevents plotting boxes on, for example, interval scales - a useful thing to do at times. I really can see no good reason for bxp to hard-core the xlim=c(0.5, n+0.5) in the function body; it should be a parameter default conditional on horizontal=, not hard coded.

Also, boxplot does not drop empty groups. I'm sure it used to. I know it is good to be able to see where a factor level is unpopulated, but its a nuisance with fractional factorials and some nested or survey problems when many are known to be missing and are of no interest. Irrespective of whether my memory is correct, the option would be useful. How hard can it be to add a 'drop.empty=F' default to boxplot to allow it to switch?

Obviously, these are things I can fix locally. But who 'owns' boxplot so I can provide suggested code to them for later releases? 

Steve Ellison



*******************************************************************
This email and any attachments are confidential. Any use, co...{{dropped}}


From maechler at stat.math.ethz.ch  Fri Jun 22 18:38:08 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 22 Jun 2007 18:38:08 +0200
Subject: [Rd] two bessel function bugs for nu<0
In-Reply-To: <3F4DF494-67E6-4F8A-B5F6-BA46B8DEA716@noc.soton.ac.uk>
References: <307b90470706181533v70792d00ufc0b6e7476b085e1@mail.gmail.com>
	<3F4DF494-67E6-4F8A-B5F6-BA46B8DEA716@noc.soton.ac.uk>
Message-ID: <18043.64240.165779.521492@stat.math.ethz.ch>

Thank you both, Hiroyuki and Robin,
 
>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Tue, 19 Jun 2007 10:25:27 +0100 writes:

    Robin> I can reproduce both these bugs and confirm that the suggested fix
    Robin> agrees with Mathematica and Maple for a few trial values.

    Robin> I can confirm that Hiroyuki's algebra is indeed
    Robin> consistent with AMS-55 equation 9.1.2
    Robin> and the old source isn't.   I'd need more
    Robin> time to look at equation 9.6.2.

    Robin> I'm not sure why, in bessel_i.c, we are using a float ("expo")
    Robin> and a long ("ize") as a Boolean [flag to indicate whether or not
    Robin> to return scaled function values].

    Robin> PS1:
    Robin> My first thought was to check against the GSL library
    Robin> but  this doesn't allow non-integer orders for besselI()

    Robin> PS2: The source code apologizes for the method used,
    Robin> suggesting that it may be numerically and computationally
    Robin> "sub-optimal".

I had wanted to address the very succinct and fine bug report by
Hiroyuki, but have been diverted by other matters. 
Thank you for the confirmation.

I'm currently testing the changes and plan to commit them, also
for the 2.5.1 release candidate.

Thank you, once more.

With best regards,
Martin 


    Robin> On 18 Jun 2007, at 23:33, Hiroyuki Kawakatsu wrote:

    >> #bug 1: besselI() for nu<0 and expon.scaled=TRUE
    >> #tested with R-devel (2007-06-17 r41981)
    >> x <- 2.3
    >> nu <- -0.4
    >> print(paste(besselI(x, nu, TRUE), "=", exp(-x)*besselI(x, nu, FALSE)))
    >> #fix:
    >> #$ diff bessel_i_old.c bessel_i_new.c
    >> #57c57
    >> #<   bessel_k(x, -alpha, expo) * ((ize == 1)? 2. : 2.*exp(-x))/M_PI
    >> #---
    >> #>   bessel_k(x, -alpha, expo) * ((ize == 1)? 2. : 2.*exp(-2.0*x))/ 
    >> M_PI
    >> 
    >> #bug 2: besselY() for nu<0
    >> #don't know how to check in R; a few random checks against  
    >> mathematica 5.2
    >> #fix:
    >> #$ diff bessel_y_old.c bessel_y_new.c
    >> #55c55
    >> #<  return(bessel_y(x, -alpha) + bessel_j(x, -alpha) * sin(-M_PI *  
    >> alpha));
    >> #---
    >> #>  return(bessel_y(x, -alpha) * cos(M_PI * alpha) - bessel_j(x,
    >> -alpha) * sin(M_PI * alpha));
    >> 
    >> h.
    >> -- 
    >> ----------------------------------
    >> Hiroyuki Kawakatsu
    >> Business School
    >> Dublin City University
    >> Dublin 9, Ireland
    >> Tel +353 (0)1 700 7496
    >> 
    >> ______________________________________________

    Robin> --
    Robin> Robin Hankin
    Robin> Uncertainty Analyst
    Robin> National Oceanography Centre, Southampton
    Robin> European Way, Southampton SO14 3ZH, UK
    Robin> tel  023-8059-7743


From bolker at zoo.ufl.edu  Sat Jun 23 03:02:01 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Fri, 22 Jun 2007 21:02:01 -0400
Subject: [Rd] putting binary files in a package
Message-ID: <467C7109.9070701@zoo.ufl.edu>


   I have some binaries I would like to distribute with a package
(I am not the original author; I have the source code but can't distribute
it because it contains _Numerical Recipes_ code.  The long-term
solution is to replace the code with new code written in R, or
in clean C, but in the meantime ...)

   I'm uncertain both where they ought to go and where they
will work (and hoping there is someplace that will satisfy
both).  I had them in the exec/ directory: according to R-exts,

    Subdirectory 'exec' could contain additional executables the
  package needs, typically scripts for interpreters such as the shell,
  Perl, or Tcl. This mechanism is currently used only by a very few
  packages, and still experimental.

I refer to the executables in the code as follows:

  if (is.null(progdir))
    progdir <- file.path(.path.package("cpcbp"),"exec")
  if (is.null(progname))
      progname=paste("phillips-cpc-",.Platform$OS.type,".exe",sep="")

this installs fine on my system, and I believe I have successfully
cross-built the package in the past.  However, when I uploaded to
win-builder.r-project.org, I got

Warning: Impossible to run e:\temp\R-RELE~1\lib\cpcbp\exec2\PHILLI~2.EXE
Warning: cannot open file 
'e:/temp/R-release/cpcbp.Rcheck\cpcout7f5579da', reason 'No such file or 
directory'

  I tried putting it in inst/exec2 instead (and changing the
directory above), but that doesn't seem to work either.  On my system
(see below), it installs just fine ...

  any ideas?

-----------
 > sessionInfo()
R version 2.5.0 (2007-04-23)
i486-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods" 
[7] "base"    

other attached packages:
   cpcbp  lattice     MASS
   "0.3" "0.15-8" "7.2-34"
 >


From bkerin at fastmail.fm  Fri Jun 22 21:42:57 2007
From: bkerin at fastmail.fm (bkerin at fastmail.fm)
Date: Fri, 22 Jun 2007 21:42:57 +0200 (CEST)
Subject: [Rd] nonlinear fitting documentation error (PR#9749)
Message-ID: <20070622194257.3DDBD659A2@slim.kubism.ku.dk>

Full_Name: Britton Kerin
Version: docs on web
OS: linux
Submission from: (NULL) (216.67.49.115)


This section from the introduction to R confused me (reason below):

   11.7.1 Least squares

   One way to fit a nonlinear model is by minimizing the sum of the squared
errors    
   (SSE) or residuals. This method makes sense if the observed errors could have

   plausibly arisen from a normal distribution.

   Here is an example from Bates & Watts (1988), page 51. The data are:

        > x <- c(0.02, 0.02, 0.06, 0.06, 0.11, 0.11, 0.22, 0.22, 0.56, 0.56,
              1.10, 1.10)
        > y <- c(76, 47, 97, 107, 123, 139, 159, 152, 191, 201, 207, 200)

   The model to be fitted is:

        > fn <- function(p) sum((y - (p[1] * x)/(p[2] + x))^2)

   In order to do the fit we need initial estimates of the parameters. One way
to 
   find sensible starting values is to plot the data, guess some parameter
values, 
   and superimpose the model curve using those values.

The problem is that fn is not the model to be fitted.  The model is y = p1*x/(p2
+ x).  The function fn is the function to be minimized.  So I think the
sendtence 'The model to be fitted is:' should be changed to 'The function to be
minimized is:" or something like that.


From gregory.warnes at mac.com  Sat Jun 23 16:27:33 2007
From: gregory.warnes at mac.com (Gregory Warnes)
Date: Sat, 23 Jun 2007 10:27:33 -0400
Subject: [Rd] [Rpy] error in building rpy in linux
	power-pc[sec=unclassified]
In-Reply-To: <A638730E91FBA941969A262738288BFDD2F970@officeho2.bom.gov.au>
References: <A638730E91FBA941969A262738288BFDD2F970@officeho2.bom.gov.au>
Message-ID: <A113199A-B2C5-4116-9A5E-A6591676A335@mac.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070623/c5f7107a/attachment.pl 

From ligges at statistik.uni-dortmund.de  Sat Jun 23 17:03:43 2007
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sat, 23 Jun 2007 17:03:43 +0200
Subject: [Rd] putting binary files in a package
In-Reply-To: <467C7109.9070701@zoo.ufl.edu>
References: <467C7109.9070701@zoo.ufl.edu>
Message-ID: <467D364F.1020905@statistik.uni-dortmund.de>



Ben Bolker wrote:
>    I have some binaries I would like to distribute with a package
> (I am not the original author; I have the source code but can't distribute
> it because it contains _Numerical Recipes_ code.  The long-term
> solution is to replace the code with new code written in R, or
> in clean C, but in the meantime ...)


So you certainly have checked that it is possible to distribute the 
binaries.


>    I'm uncertain both where they ought to go and where they
> will work (and hoping there is someplace that will satisfy
> both).  I had them in the exec/ directory: according to R-exts,
> 
>     Subdirectory 'exec' could contain additional executables the
>   package needs, typically scripts for interpreters such as the shell,
>   Perl, or Tcl. This mechanism is currently used only by a very few
>   packages, and still experimental.
> 
> I refer to the executables in the code as follows:
> 
>   if (is.null(progdir))
>     progdir <- file.path(.path.package("cpcbp"),"exec")
>   if (is.null(progname))
>       progname=paste("phillips-cpc-",.Platform$OS.type,".exe",sep="")
> 
> this installs fine on my system, and I believe I have successfully
> cross-built the package in the past.  However, when I uploaded to
> win-builder.r-project.org, I got
> 
> Warning: Impossible to run e:\temp\R-RELE~1\lib\cpcbp\exec2\PHILLI~2.EXE
> Warning: cannot open file 
> 'e:/temp/R-release/cpcbp.Rcheck\cpcout7f5579da', reason 'No such file or 
> directory'

I'll take a look and will answer privately later on.

Uwe



>   I tried putting it in inst/exec2 instead (and changing the
> directory above), but that doesn't seem to work either.  On my system
> (see below), it installs just fine ...
> 
>   any ideas?
> 
> -----------
>  > sessionInfo()
> R version 2.5.0 (2007-04-23)
> i486-pc-linux-gnu
> 
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods" 
> [7] "base"    
> 
> other attached packages:
>    cpcbp  lattice     MASS
>    "0.3" "0.15-8" "7.2-34"
>  >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bolker at ufl.edu  Sat Jun 23 18:46:37 2007
From: bolker at ufl.edu (Ben Bolker)
Date: Sat, 23 Jun 2007 16:46:37 +0000 (UTC)
Subject: [Rd] nonlinear fitting documentation error (PR#9749)
References: <20070622194257.3DDBD659A2@slim.kubism.ku.dk>
Message-ID: <loom.20070623T184448-738@post.gmane.org>

 <bkerin <at> fastmail.fm> writes:

> The problem is that fn is not the model to be fitted.  
> The model is y = p1*x/(p2
> + x).  
  Actually, I would say the model is

y_i ~ Normal(p1*x_i/(p2+x_i),sigma^2) ...


From nakama at ki.rim.or.jp  Sun Jun 24 15:46:53 2007
From: nakama at ki.rim.or.jp (nakama at ki.rim.or.jp)
Date: Sun, 24 Jun 2007 15:46:53 +0200 (CEST)
Subject: [Rd] problem gsub in the locale of CP932 and SJIS (PR#9751)
Message-ID: <20070624134653.CE4126596A@slim.kubism.ku.dk>

Full_Name: Ei-ji Nakama
Version: R-2.5.0
OS: any
Submission from: (NULL) (219.117.236.5)


problem by operation of gsub in the locale of CP932 and SJIS.
The inconvenient character code which used 0x5c after the first byte.

--- R-2.5.0.orig/src/main/character.c   2007-04-03 11:05:05.000000000 +0900
+++ R-2.5.0/src/main/character.c        2007-06-24 22:31:06.000000000 +0900
@@ -986,6 +986,17 @@
     char *p = repl;
     n = strlen(repl) - (regmatch[0].rm_eo - regmatch[0].rm_so);
     while (*p) {
+#ifdef  SUPPORT_MBCS
+       if(mbcslocale){
+           int clen;
+           mbstate_t mb_st;
+           mbs_init(&mb_st);
+           if((clen = Mbrtowc(NULL, p, MB_CUR_MAX, &mb_st)) > 1){
+               p+=clen;
+               continue;
+           }
+       }
+#endif
        if (*p == '\\') {
            if ('1' <= p[1] && p[1] <= '9') {
                k = p[1] - '0';
@@ -1014,6 +1025,18 @@
     int i, k;
     char *p = repl, *t = target;
     while (*p) {
+#ifdef  SUPPORT_MBCS
+       if(mbcslocale){
+           int clen;
+           mbstate_t mb_st;
+           mbs_init(&mb_st);
+           if((clen = Mbrtowc(NULL, p, MB_CUR_MAX, &mb_st)) > 1){
+               for ( i=0; i<clen; i++)
+                   *t++ = *p++;
+               continue;
+           }
+       }
+#endif
        if (*p == '\\') {
            if ('1' <= p[1] && p[1] <= '9') {
                k = p[1] - '0';


From nakama at ki.rim.or.jp  Sun Jun 24 18:11:10 2007
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Mon, 25 Jun 2007 01:11:10 +0900
Subject: [Rd] There was a problem by the use of snow.
Message-ID: <dc41e1260706240911v197758b3g9b56a3e06ed16d4c@mail.gmail.com>

problem of the very large memory require by the Sign extension.

--- R-2.5.0.orig/src/main/serialize.c   2007-03-27 01:42:08.000000000 +0900
+++ R-2.5.0/src/main/serialize.c        2007-06-25 00:48:58.000000000 +0900
@@ -1866,7 +1866,7 @@

 static void resize_buffer(membuf_t mb, int needed)
 {
-    int newsize = 2 * needed;
+    size_t newsize = 2 * needed;
     mb->buf = realloc(mb->buf, newsize);
     if (mb->buf == NULL)
        error(_("cannot allocate buffer"));


The time-out of read and write was not set.

51:sendData.SOCKnode <- function(node, data) {
52:     timeout <- getClusterOption("timeout")
53:     old <- options(timeout = timeout);
54:     on.exit(options(old))
55:     serialize(data, node$con)
56: }
57:
58:recvData.SOCKnode <- function(node) {
59:     timeout <- getClusterOption("timeout")
60:     old <- options(timeout = timeout);
61:     on.exit(options(old))
62:     unserialize(node$con)
63: }



--- R-2.5.0.orig/src/modules/internet/sockconn.c        2006-09-04
23:20:59.000000000 +0900
+++ R-2.5.0/src/modules/internet/sockconn.c     2007-06-25
00:51:38.000000000 +0900
@@ -155,14 +155,19 @@
 static size_t sock_read(void *ptr, size_t size, size_t nitems,
                        Rconnection con)
 {
+    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
+
+    R_SockTimeout(timeout);
     return sock_read_helper(con, ptr, size * nitems)/size;
 }

 static size_t sock_write(const void *ptr, size_t size, size_t nitems,
                         Rconnection con)
 {
+    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
     Rsockconn this = (Rsockconn)con->private;

+    R_SockTimeout(timeout);
     return R_SockWrite(this->fd, ptr, size * nitems)/size;
 }

-- 
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From M.Chattopadhyay at bom.gov.au  Mon Jun 25 01:19:36 2007
From: M.Chattopadhyay at bom.gov.au (Mohar Chattopadhyay)
Date: Mon, 25 Jun 2007 09:19:36 +1000
Subject: [Rd] errors in compiling R-2.5.0 and R-2.4.0[sec=unclassified]
Message-ID: <A638730E91FBA941969A262738288BFDD2F97C@officeho2.bom.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070625/8c2dd8ca/attachment.pl 

From ripley at stats.ox.ac.uk  Mon Jun 25 09:30:27 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 25 Jun 2007 08:30:27 +0100 (BST)
Subject: [Rd] errors in compiling R-2.5.0 and R-2.4.0[sec=unclassified]
In-Reply-To: <A638730E91FBA941969A262738288BFDD2F97C@officeho2.bom.gov.au>
References: <A638730E91FBA941969A262738288BFDD2F97C@officeho2.bom.gov.au>
Message-ID: <Pine.LNX.4.64.0706250827140.7903@gannet.stats.ox.ac.uk>

We don't have enough to go on: the errror is before the output you give.
(Hint: 'additional'.)

However, this is a link error and not a compilation error, nor is it an R 
problem.  Please show the full output to your local Linux advisor.
It is likely that the correct flag for PIC code is not being used.

On Mon, 25 Jun 2007, Mohar Chattopadhyay wrote:

> Dear all,
>
> I have encountered errors in compiling R-2.5.0 and R-2.4.0 in a linux
> machine (power-pc). I can successfully build it from the source code if
> I do not use the '--enable-R-shlib' option while executing the
> './configure' command as mentioned in rpy documentation. Using the
> `--enable-R-shlib' option the configure step is executed properly but
> the `make' crashes with the following error message:
>
> Rdynload.o(.text+0x1246): In function `GetFullDLLPath':
> /home/mxc/R-2.5.0/src/main/Rdynload.c:850: additional relocation
> overflows omitted from the output
> collect2: ld returned 1 exit status
> make[3]: *** [libR.so] Error 1
> make[3]: Leaving directory `/home/mxc/R-2.5.0/src/main'
> make[2]: *** [R] Error 2
> make[2]: Leaving directory `/home/mxc/R-2.5.0/src/main'
> make[1]: *** [R] Error 1
> make[1]: Leaving directory `/home/mxc/R-2.5.0/src'
> make: *** [R] Error 1
>
> Right now I am using an older version of R, R-2.1.0 which did not
> produce any error during the `build' and `install' stage, however, the
> recent versions have some problem. R-2.5.0 installs and builds fine on
> its own. Any insight to this problem will be hugely appreciated.
>
> Regards,
>
> Mohar Chattopadhyay
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Jun 25 11:24:45 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 25 Jun 2007 11:24:45 +0200 (CEST)
Subject: [Rd] problem gsub in the locale of CP932 and SJIS (PR#9751)
Message-ID: <20070625092445.D8EBD65979@slim.kubism.ku.dk>

Thanks for this.

I don't think the patch is quite right.  As I understand it, mbstate_t 
should be initialized at the start of the string, not before each 
character, and that is what is done in the rest of R.

Also, do you have an example I can use to test the patch, please?

R 2.5.0 is now in code freeze and I don't think this is vital for that.


On Sun, 24 Jun 2007, nakama at ki.rim.or.jp wrote:

> Full_Name: Ei-ji Nakama
> Version: R-2.5.0
> OS: any
> Submission from: (NULL) (219.117.236.5)
>
>
> problem by operation of gsub in the locale of CP932 and SJIS.
> The inconvenient character code which used 0x5c after the first byte.
>
> --- R-2.5.0.orig/src/main/character.c   2007-04-03 11:05:05.000000000 +0900
> +++ R-2.5.0/src/main/character.c        2007-06-24 22:31:06.000000000 +0900
> @@ -986,6 +986,17 @@
>     char *p = repl;
>     n = strlen(repl) - (regmatch[0].rm_eo - regmatch[0].rm_so);
>     while (*p) {
> +#ifdef  SUPPORT_MBCS
> +       if(mbcslocale){
> +           int clen;
> +           mbstate_t mb_st;
> +           mbs_init(&mb_st);
> +           if((clen = Mbrtowc(NULL, p, MB_CUR_MAX, &mb_st)) > 1){
> +               p+=clen;
> +               continue;
> +           }
> +       }
> +#endif
>        if (*p == '\\') {
>            if ('1' <= p[1] && p[1] <= '9') {
>                k = p[1] - '0';
> @@ -1014,6 +1025,18 @@
>     int i, k;
>     char *p = repl, *t = target;
>     while (*p) {
> +#ifdef  SUPPORT_MBCS
> +       if(mbcslocale){
> +           int clen;
> +           mbstate_t mb_st;
> +           mbs_init(&mb_st);
> +           if((clen = Mbrtowc(NULL, p, MB_CUR_MAX, &mb_st)) > 1){
> +               for ( i=0; i<clen; i++)
> +                   *t++ = *p++;
> +               continue;
> +           }
> +       }
> +#endif
>        if (*p == '\\') {
>            if ('1' <= p[1] && p[1] <= '9') {
>                k = p[1] - '0';
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From nakama at ki.rim.or.jp  Mon Jun 25 12:08:31 2007
From: nakama at ki.rim.or.jp (nakama at ki.rim.or.jp)
Date: Mon, 25 Jun 2007 12:08:31 +0200 (CEST)
Subject: [Rd] problem gsub in the locale of CP932 and SJIS (PR#9751)
Message-ID: <20070625100831.ADC696597D@slim.kubism.ku.dk>

Thanks.

As for mbs_init, the outside of the loop is desirable.

probrem code is.
> gsub("A","=A5u30bd=A5u8868","A")

euc-jp and utf-8 moves without a problem.

> Sys.getlocale("LC_CTYPE")    # SHIFT_JIS system.
[1] "ja_JP.SJIS"
> charToRaw("=A5u30bd=A5u8868")   # The second byte is a char of 5c
[1] 83 5c 95 5c

2007/6/25, Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> Thanks for this.
>
> I don't think the patch is quite right.  As I understand it, mbstate_t
> should be initialized at the start of the string, not before each
> character, and that is what is done in the rest of R.
>
> Also, do you have an example I can use to test the patch, please?
>
> R 2.5.0 is now in code freeze and I don't think this is vital for that.
>
>
> On Sun, 24 Jun 2007, nakama at ki.rim.or.jp wrote:
>
> > Full_Name: Ei-ji Nakama
> > Version: R-2.5.0
> > OS: any
> > Submission from: (NULL) (219.117.236.5)
> >
> >
> > problem by operation of gsub in the locale of CP932 and SJIS.
> > The inconvenient character code which used 0x5c after the first byte.
> >
> > --- R-2.5.0.orig/src/main/character.c   2007-04-03 11:05:05.000000000 +=
0900
> > +++ R-2.5.0/src/main/character.c        2007-06-24 22:31:06.000000000 +=
0900
> > @@ -986,6 +986,17 @@
> >     char *p =3D repl;
> >     n =3D strlen(repl) - (regmatch[0].rm_eo - regmatch[0].rm_so);
> >     while (*p) {
> > +#ifdef  SUPPORT_MBCS
> > +       if(mbcslocale){
> > +           int clen;
> > +           mbstate_t mb_st;
> > +           mbs_init(&mb_st);
> > +           if((clen =3D Mbrtowc(NULL, p, MB_CUR_MAX, &mb_st)) > 1){
> > +               p+=3Dclen;
> > +               continue;
> > +           }
> > +       }
> > +#endif
> >        if (*p =3D=3D '\\') {
> >            if ('1' <=3D p[1] && p[1] <=3D '9') {
> >                k =3D p[1] - '0';
> > @@ -1014,6 +1025,18 @@
> >     int i, k;
> >     char *p =3D repl, *t =3D target;
> >     while (*p) {
> > +#ifdef  SUPPORT_MBCS
> > +       if(mbcslocale){
> > +           int clen;
> > +           mbstate_t mb_st;
> > +           mbs_init(&mb_st);
> > +           if((clen =3D Mbrtowc(NULL, p, MB_CUR_MAX, &mb_st)) > 1){
> > +               for ( i=3D0; i<clen; i++)
> > +                   *t++ =3D *p++;
> > +               continue;
> > +           }
> > +       }
> > +#endif
> >        if (*p =3D=3D '\\') {
> >            if ('1' <=3D p[1] && p[1] <=3D '9') {
> >                k =3D p[1] - '0';
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>
>


--=20
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From ripley at stats.ox.ac.uk  Mon Jun 25 12:18:11 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 25 Jun 2007 11:18:11 +0100 (BST)
Subject: [Rd] There was a problem by the use of snow.
In-Reply-To: <dc41e1260706240911v197758b3g9b56a3e06ed16d4c@mail.gmail.com>
References: <dc41e1260706240911v197758b3g9b56a3e06ed16d4c@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706251023360.6315@auk.stats>

On Mon, 25 Jun 2007, Ei-ji Nakama wrote:

> problem of the very large memory require by the Sign extension.
>
> --- R-2.5.0.orig/src/main/serialize.c   2007-03-27 01:42:08.000000000 +0900
> +++ R-2.5.0/src/main/serialize.c        2007-06-25 00:48:58.000000000 +0900
> @@ -1866,7 +1866,7 @@
>
> static void resize_buffer(membuf_t mb, int needed)
> {
> -    int newsize = 2 * needed;
> +    size_t newsize = 2 * needed;
>     mb->buf = realloc(mb->buf, newsize);
>     if (mb->buf == NULL)
>        error(_("cannot allocate buffer"));

Yes, thanks, but the structure also needs to be changed as the next line 
is

     mb->size = newsize;

and so this would set mb->size to a negative value.

Could you please tell us where you encountered this?

As far as I can see, this code is only used via R_serialize for 
serializing to a raw vector, in which case 'size' can safely be 'int' and 
the re-allocation should be up to 2^31-1 bytes at most (and allocating 
twice what you are asked for seems undesirable).  But there is potential 
overflow at

     if (mb->count + length > mb->size)

and possibly elsewhere.


> The time-out of read and write was not set.
>
> 51:sendData.SOCKnode <- function(node, data) {
> 52:     timeout <- getClusterOption("timeout")
> 53:     old <- options(timeout = timeout);
> 54:     on.exit(options(old))
> 55:     serialize(data, node$con)
> 56: }
> 57:
> 58:recvData.SOCKnode <- function(node) {
> 59:     timeout <- getClusterOption("timeout")
> 60:     old <- options(timeout = timeout);
> 61:     on.exit(options(old))
> 62:     unserialize(node$con)
> 63: }

I don't think sock_read/sock_write is the right place to make that 
setting.  Ideally it would be set when the option is set, but as this is 
in a module that needs an extension to the interface.

Looking at the code, we read from a socket in blocks of 4096, but we write 
in a single block.  The latter is likely to be the problem, and I think 
some redesigning is necessary here.

Perhaps you and Luke Tierney can comment on exactly what the problem is 
and how best to work around it.

>
> --- R-2.5.0.orig/src/modules/internet/sockconn.c 2006-09-04 23:20:59.000000000 +0900
> +++ R-2.5.0/src/modules/internet/sockconn.c     2007-06-25
> 00:51:38.000000000 +0900
> @@ -155,14 +155,19 @@
> static size_t sock_read(void *ptr, size_t size, size_t nitems,
>                        Rconnection con)
> {
> +    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
> +
> +    R_SockTimeout(timeout);
>     return sock_read_helper(con, ptr, size * nitems)/size;
> }
>
> static size_t sock_write(const void *ptr, size_t size, size_t nitems,
>                         Rconnection con)
> {
> +    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
>     Rsockconn this = (Rsockconn)con->private;
>
> +    R_SockTimeout(timeout);
>     return R_SockWrite(this->fd, ptr, size * nitems)/size;
> }
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From nakama at ki.rim.or.jp  Mon Jun 25 12:52:43 2007
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Mon, 25 Jun 2007 19:52:43 +0900
Subject: [Rd] There was a problem by the use of snow.
In-Reply-To: <Pine.LNX.4.64.0706251023360.6315@auk.stats>
References: <dc41e1260706240911v197758b3g9b56a3e06ed16d4c@mail.gmail.com>
	<Pine.LNX.4.64.0706251023360.6315@auk.stats>
Message-ID: <dc41e1260706250352g3eb5e63em64f99b04518db2c4@mail.gmail.com>

Thank you for advice.

library(snow)
cl <- makeSOCKcluster(c("localhost","localhost"))
clusterCall(cl, function(x){Sys.sleep(10);1})
clusterCall(cl, function(x){Sys.sleep(60);1}) # Timeout Code.
stopCluster(cl)

I worked in AIX and Linux.

diff -ruN R-devel.orig/src/include/Rinternals.h R-devel/src/include/Rinternals.h
--- R-devel.orig/src/include/Rinternals.h       2007-06-18
00:50:00.000000000 +0900
+++ R-devel/src/include/Rinternals.h    2007-06-25 13:08:00.000000000 +0900
@@ -725,7 +725,7 @@
     R_pstream_format_t type;
     int version;
     void (*OutChar)(R_outpstream_t, int);
-    void (*OutBytes)(R_outpstream_t, void *, int);
+    void (*OutBytes)(R_outpstream_t, void *, size_t);
     SEXP (*OutPersistHookFunc)(SEXP, SEXP);
     SEXP OutPersistHookData;
 };
@@ -735,7 +735,7 @@
     R_pstream_data_t data;
     R_pstream_format_t type;
     int (*InChar)(R_inpstream_t);
-    void (*InBytes)(R_inpstream_t, void *, int);
+    void (*InBytes)(R_inpstream_t, void *, size_t);
     SEXP (*InPersistHookFunc)(SEXP, SEXP);
     SEXP InPersistHookData;
 };
@@ -743,12 +743,12 @@
 void R_InitInPStream(R_inpstream_t stream, R_pstream_data_t data,
                     R_pstream_format_t type,
                     int (*inchar)(R_inpstream_t),
-                    void (*inbytes)(R_inpstream_t, void *, int),
+                    void (*inbytes)(R_inpstream_t, void *, size_t),
                     SEXP (*phook)(SEXP, SEXP), SEXP pdata);
 void R_InitOutPStream(R_outpstream_t stream, R_pstream_data_t data,
                      R_pstream_format_t type, int version,
                      void (*outchar)(R_outpstream_t, int),
-                     void (*outbytes)(R_outpstream_t, void *, int),
+                     void (*outbytes)(R_outpstream_t, void *, size_t),
                      SEXP (*phook)(SEXP, SEXP), SEXP pdata);

 void R_InitFileInPStream(R_inpstream_t stream, FILE *fp,
diff -ruN R-devel.orig/src/main/serialize.c R-devel/src/main/serialize.c
--- R-devel.orig/src/main/serialize.c   2007-06-18 00:50:02.000000000 +0900
+++ R-devel/src/main/serialize.c        2007-06-25 19:32:05.000000000 +0900
@@ -1529,7 +1529,7 @@
 R_InitInPStream(R_inpstream_t stream, R_pstream_data_t data,
                     R_pstream_format_t type,
                     int (*inchar)(R_inpstream_t),
-                    void (*inbytes)(R_inpstream_t, void *, int),
+                    void (*inbytes)(R_inpstream_t, void *, size_t),
                     SEXP (*phook)(SEXP, SEXP), SEXP pdata)
 {
     stream->data = data;
@@ -1544,7 +1544,7 @@
 R_InitOutPStream(R_outpstream_t stream, R_pstream_data_t data,
                      R_pstream_format_t type, int version,
                      void (*outchar)(R_outpstream_t, int),
-                     void (*outbytes)(R_outpstream_t, void *, int),
+                     void (*outbytes)(R_outpstream_t, void *, size_t),
                      SEXP (*phook)(SEXP, SEXP), SEXP pdata)
 {
     stream->data = data;
@@ -1574,14 +1574,14 @@
     return fgetc(fp);
 }

-static void OutBytesFile(R_outpstream_t stream, void *buf, int length)
+static void OutBytesFile(R_outpstream_t stream, void *buf, size_t length)
 {
     FILE *fp = stream->data;
     size_t out = fwrite(buf, 1, length, fp);
     if (out != length) error(_("write failed"));
 }

-static void InBytesFile(R_inpstream_t stream, void *buf, int length)
+static void InBytesFile(R_inpstream_t stream, void *buf, size_t length)
 {
     FILE *fp = stream->data;
     size_t in = fread(buf, 1, length, fp);
@@ -1629,12 +1629,12 @@
        error(_("cannot write to this connection"));
 }

-static void InBytesConn(R_inpstream_t stream, void *buf, int length)
+static void InBytesConn(R_inpstream_t stream, void *buf, size_t length)
 {
     Rconnection con = (Rconnection) stream->data;
     CheckInConn(con);
     if (con->text) {
-       int i;
+       size_t i;
        char *p = buf;
        for (i = 0; i < length; i++)
            p[i] = Rconn_fgetc(con);
@@ -1659,7 +1659,7 @@
     }
 }

-static void OutBytesConn(R_outpstream_t stream, void *buf, int length)
+static void OutBytesConn(R_outpstream_t stream, void *buf, size_t length)
 {
     Rconnection con = (Rconnection) stream->data;
     CheckOutConn(con);
@@ -1817,7 +1817,7 @@
     bb->buf[bb->count++] = c;
 }

-static void OutBytesBB(R_outpstream_t stream, void *buf, int length)
+static void OutBytesBB(R_outpstream_t stream, void *buf, size_t length)
 {
     bconbuf_t bb = stream->data;
     if (bb->count + length > BCONBUFSIZ)
@@ -1863,14 +1863,14 @@
  */

 typedef struct membuf_st {
-    int size;
-    int count;
+    size_t size;
+    size_t count;
     unsigned char *buf;
 } *membuf_t;

-static void resize_buffer(membuf_t mb, int needed)
+static void resize_buffer(membuf_t mb, size_t needed)
 {
-    int newsize = 2 * needed;
+    size_t newsize = 2 * needed;
     mb->buf = realloc(mb->buf, newsize);
     if (mb->buf == NULL)
        error(_("cannot allocate buffer"));
@@ -1885,7 +1885,7 @@
     mb->buf[mb->count++] = c;
 }

-static void OutBytesMem(R_outpstream_t stream, void *buf, int length)
+static void OutBytesMem(R_outpstream_t stream, void *buf, size_t length)
 {
     membuf_t mb = stream->data;
     if (mb->count + length > mb->size)
@@ -1902,7 +1902,7 @@
     return mb->buf[mb->count++];
 }

-static void InBytesMem(R_inpstream_t stream, void *buf, int length)
+static void InBytesMem(R_inpstream_t stream, void *buf, size_t length)
 {
     membuf_t mb = stream->data;
     if (mb->count + length > mb->size)
@@ -1912,7 +1912,7 @@
 }

 static void InitMemInPStream(R_inpstream_t stream, membuf_t mb,
-                            void *buf, int length,
+                            void *buf, size_t length,
                             SEXP (*phook)(SEXP, SEXP), SEXP pdata)
 {
     mb->count = 0;
diff -ruN R-devel.orig/src/modules/internet/sockconn.c
R-devel/src/modules/internet/sockconn.c
--- R-devel.orig/src/modules/internet/sockconn.c        2007-06-03
00:50:32.000000000 +0900
+++ R-devel/src/modules/internet/sockconn.c     2007-06-25
19:41:32.000000000 +0900
@@ -155,14 +155,19 @@
 static size_t sock_read(void *ptr, size_t size, size_t nitems,
                        Rconnection con)
 {
+    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
+
+    R_SockTimeout(timeout);
     return sock_read_helper(con, ptr, size * nitems)/size;
 }

 static size_t sock_write(const void *ptr, size_t size, size_t nitems,
                         Rconnection con)
 {
+    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
     Rsockconn this = (Rsockconn)con->private;

+    R_SockTimeout(timeout);
     return R_SockWrite(this->fd, ptr, size * nitems)/size;
 }



2007/6/25, Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> On Mon, 25 Jun 2007, Ei-ji Nakama wrote:
>
> > problem of the very large memory require by the Sign extension.
> >
> > --- R-2.5.0.orig/src/main/serialize.c   2007-03-27 01:42:08.000000000 +0900
> > +++ R-2.5.0/src/main/serialize.c        2007-06-25 00:48:58.000000000 +0900
> > @@ -1866,7 +1866,7 @@
> >
> > static void resize_buffer(membuf_t mb, int needed)
> > {
> > -    int newsize = 2 * needed;
> > +    size_t newsize = 2 * needed;
> >     mb->buf = realloc(mb->buf, newsize);
> >     if (mb->buf == NULL)
> >        error(_("cannot allocate buffer"));
>
> Yes, thanks, but the structure also needs to be changed as the next line
> is
>
>      mb->size = newsize;
>
> and so this would set mb->size to a negative value.
>
> Could you please tell us where you encountered this?
>
> As far as I can see, this code is only used via R_serialize for
> serializing to a raw vector, in which case 'size' can safely be 'int' and
> the re-allocation should be up to 2^31-1 bytes at most (and allocating
> twice what you are asked for seems undesirable).  But there is potential
> overflow at
>
>      if (mb->count + length > mb->size)
>
> and possibly elsewhere.
>
>
> > The time-out of read and write was not set.
> >
> > 51:sendData.SOCKnode <- function(node, data) {
> > 52:     timeout <- getClusterOption("timeout")
> > 53:     old <- options(timeout = timeout);
> > 54:     on.exit(options(old))
> > 55:     serialize(data, node$con)
> > 56: }
> > 57:
> > 58:recvData.SOCKnode <- function(node) {
> > 59:     timeout <- getClusterOption("timeout")
> > 60:     old <- options(timeout = timeout);
> > 61:     on.exit(options(old))
> > 62:     unserialize(node$con)
> > 63: }
>
> I don't think sock_read/sock_write is the right place to make that
> setting.  Ideally it would be set when the option is set, but as this is
> in a module that needs an extension to the interface.
>
> Looking at the code, we read from a socket in blocks of 4096, but we write
> in a single block.  The latter is likely to be the problem, and I think
> some redesigning is necessary here.
>
> Perhaps you and Luke Tierney can comment on exactly what the problem is
> and how best to work around it.
>
> >
> > --- R-2.5.0.orig/src/modules/internet/sockconn.c 2006-09-04 23:20:59.000000000 +0900
> > +++ R-2.5.0/src/modules/internet/sockconn.c     2007-06-25
> > 00:51:38.000000000 +0900
> > @@ -155,14 +155,19 @@
> > static size_t sock_read(void *ptr, size_t size, size_t nitems,
> >                        Rconnection con)
> > {
> > +    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
> > +
> > +    R_SockTimeout(timeout);
> >     return sock_read_helper(con, ptr, size * nitems)/size;
> > }
> >
> > static size_t sock_write(const void *ptr, size_t size, size_t nitems,
> >                         Rconnection con)
> > {
> > +    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
> >     Rsockconn this = (Rsockconn)con->private;
> >
> > +    R_SockTimeout(timeout);
> >     return R_SockWrite(this->fd, ptr, size * nitems)/size;
> > }
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>
>


-- 
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From ripley at stats.ox.ac.uk  Mon Jun 25 14:49:52 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 25 Jun 2007 13:49:52 +0100 (BST)
Subject: [Rd] There was a problem by the use of snow.
In-Reply-To: <dc41e1260706250352g3eb5e63em64f99b04518db2c4@mail.gmail.com>
References: <dc41e1260706240911v197758b3g9b56a3e06ed16d4c@mail.gmail.com> 
	<Pine.LNX.4.64.0706251023360.6315@auk.stats>
	<dc41e1260706250352g3eb5e63em64f99b04518db2c4@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706251336030.12491@gannet.stats.ox.ac.uk>

We don't need to change as much as this.  The OutBytes function is only 
called for small objects apart from CHARSXPs:  the latter are limited to
2^31 - 1 bytes.  So 'length' in a read/write will never exceed INT_MAX.

In the current usage, the in-memory code is only used to write to a RAWSXP
which is also limited to 2^31 - 1 bytes, so we only need to deal with 
signed overflows if we do things like double the buffer size, and that's 
pointless as the result will overflow the RAWSXP.

On Mon, 25 Jun 2007, Ei-ji Nakama wrote:

> Thank you for advice.
>
> library(snow)
> cl <- makeSOCKcluster(c("localhost","localhost"))
> clusterCall(cl, function(x){Sys.sleep(10);1})
> clusterCall(cl, function(x){Sys.sleep(60);1}) # Timeout Code.
> stopCluster(cl)
>
> I worked in AIX and Linux.
>
> diff -ruN R-devel.orig/src/include/Rinternals.h 
> R-devel/src/include/Rinternals.h
> --- R-devel.orig/src/include/Rinternals.h       2007-06-18
> 00:50:00.000000000 +0900
> +++ R-devel/src/include/Rinternals.h    2007-06-25 13:08:00.000000000 +0900
> @@ -725,7 +725,7 @@
>    R_pstream_format_t type;
>    int version;
>    void (*OutChar)(R_outpstream_t, int);
> -    void (*OutBytes)(R_outpstream_t, void *, int);
> +    void (*OutBytes)(R_outpstream_t, void *, size_t);
>    SEXP (*OutPersistHookFunc)(SEXP, SEXP);
>    SEXP OutPersistHookData;
> };
> @@ -735,7 +735,7 @@
>    R_pstream_data_t data;
>    R_pstream_format_t type;
>    int (*InChar)(R_inpstream_t);
> -    void (*InBytes)(R_inpstream_t, void *, int);
> +    void (*InBytes)(R_inpstream_t, void *, size_t);
>    SEXP (*InPersistHookFunc)(SEXP, SEXP);
>    SEXP InPersistHookData;
> };
> @@ -743,12 +743,12 @@
> void R_InitInPStream(R_inpstream_t stream, R_pstream_data_t data,
>                    R_pstream_format_t type,
>                    int (*inchar)(R_inpstream_t),
> -                    void (*inbytes)(R_inpstream_t, void *, int),
> +                    void (*inbytes)(R_inpstream_t, void *, size_t),
>                    SEXP (*phook)(SEXP, SEXP), SEXP pdata);
> void R_InitOutPStream(R_outpstream_t stream, R_pstream_data_t data,
>                     R_pstream_format_t type, int version,
>                     void (*outchar)(R_outpstream_t, int),
> -                     void (*outbytes)(R_outpstream_t, void *, int),
> +                     void (*outbytes)(R_outpstream_t, void *, size_t),
>                     SEXP (*phook)(SEXP, SEXP), SEXP pdata);
>
> void R_InitFileInPStream(R_inpstream_t stream, FILE *fp,
> diff -ruN R-devel.orig/src/main/serialize.c R-devel/src/main/serialize.c
> --- R-devel.orig/src/main/serialize.c   2007-06-18 00:50:02.000000000 +0900
> +++ R-devel/src/main/serialize.c        2007-06-25 19:32:05.000000000 +0900
> @@ -1529,7 +1529,7 @@
> R_InitInPStream(R_inpstream_t stream, R_pstream_data_t data,
>                    R_pstream_format_t type,
>                    int (*inchar)(R_inpstream_t),
> -                    void (*inbytes)(R_inpstream_t, void *, int),
> +                    void (*inbytes)(R_inpstream_t, void *, size_t),
>                    SEXP (*phook)(SEXP, SEXP), SEXP pdata)
> {
>    stream->data = data;
> @@ -1544,7 +1544,7 @@
> R_InitOutPStream(R_outpstream_t stream, R_pstream_data_t data,
>                     R_pstream_format_t type, int version,
>                     void (*outchar)(R_outpstream_t, int),
> -                     void (*outbytes)(R_outpstream_t, void *, int),
> +                     void (*outbytes)(R_outpstream_t, void *, size_t),
>                     SEXP (*phook)(SEXP, SEXP), SEXP pdata)
> {
>    stream->data = data;
> @@ -1574,14 +1574,14 @@
>    return fgetc(fp);
> }
>
> -static void OutBytesFile(R_outpstream_t stream, void *buf, int length)
> +static void OutBytesFile(R_outpstream_t stream, void *buf, size_t length)
> {
>    FILE *fp = stream->data;
>    size_t out = fwrite(buf, 1, length, fp);
>    if (out != length) error(_("write failed"));
> }
>
> -static void InBytesFile(R_inpstream_t stream, void *buf, int length)
> +static void InBytesFile(R_inpstream_t stream, void *buf, size_t length)
> {
>    FILE *fp = stream->data;
>    size_t in = fread(buf, 1, length, fp);
> @@ -1629,12 +1629,12 @@
>       error(_("cannot write to this connection"));
> }
>
> -static void InBytesConn(R_inpstream_t stream, void *buf, int length)
> +static void InBytesConn(R_inpstream_t stream, void *buf, size_t length)
> {
>    Rconnection con = (Rconnection) stream->data;
>    CheckInConn(con);
>    if (con->text) {
> -       int i;
> +       size_t i;
>       char *p = buf;
>       for (i = 0; i < length; i++)
>           p[i] = Rconn_fgetc(con);
> @@ -1659,7 +1659,7 @@
>    }
> }
>
> -static void OutBytesConn(R_outpstream_t stream, void *buf, int length)
> +static void OutBytesConn(R_outpstream_t stream, void *buf, size_t length)
> {
>    Rconnection con = (Rconnection) stream->data;
>    CheckOutConn(con);
> @@ -1817,7 +1817,7 @@
>    bb->buf[bb->count++] = c;
> }
>
> -static void OutBytesBB(R_outpstream_t stream, void *buf, int length)
> +static void OutBytesBB(R_outpstream_t stream, void *buf, size_t length)
> {
>    bconbuf_t bb = stream->data;
>    if (bb->count + length > BCONBUFSIZ)
> @@ -1863,14 +1863,14 @@
> */
>
> typedef struct membuf_st {
> -    int size;
> -    int count;
> +    size_t size;
> +    size_t count;
>    unsigned char *buf;
> } *membuf_t;
>
> -static void resize_buffer(membuf_t mb, int needed)
> +static void resize_buffer(membuf_t mb, size_t needed)
> {
> -    int newsize = 2 * needed;
> +    size_t newsize = 2 * needed;
>    mb->buf = realloc(mb->buf, newsize);
>    if (mb->buf == NULL)
>       error(_("cannot allocate buffer"));
> @@ -1885,7 +1885,7 @@
>    mb->buf[mb->count++] = c;
> }
>
> -static void OutBytesMem(R_outpstream_t stream, void *buf, int length)
> +static void OutBytesMem(R_outpstream_t stream, void *buf, size_t length)
> {
>    membuf_t mb = stream->data;
>    if (mb->count + length > mb->size)
> @@ -1902,7 +1902,7 @@
>    return mb->buf[mb->count++];
> }
>
> -static void InBytesMem(R_inpstream_t stream, void *buf, int length)
> +static void InBytesMem(R_inpstream_t stream, void *buf, size_t length)
> {
>    membuf_t mb = stream->data;
>    if (mb->count + length > mb->size)
> @@ -1912,7 +1912,7 @@
> }
>
> static void InitMemInPStream(R_inpstream_t stream, membuf_t mb,
> -                            void *buf, int length,
> +                            void *buf, size_t length,
>                            SEXP (*phook)(SEXP, SEXP), SEXP pdata)
> {
>    mb->count = 0;
> diff -ruN R-devel.orig/src/modules/internet/sockconn.c
> R-devel/src/modules/internet/sockconn.c
> --- R-devel.orig/src/modules/internet/sockconn.c        2007-06-03
> 00:50:32.000000000 +0900
> +++ R-devel/src/modules/internet/sockconn.c     2007-06-25
> 19:41:32.000000000 +0900
> @@ -155,14 +155,19 @@
> static size_t sock_read(void *ptr, size_t size, size_t nitems,
>                       Rconnection con)
> {
> +    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
> +
> +    R_SockTimeout(timeout);
>    return sock_read_helper(con, ptr, size * nitems)/size;
> }
>
> static size_t sock_write(const void *ptr, size_t size, size_t nitems,
>                        Rconnection con)
> {
> +    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
>    Rsockconn this = (Rsockconn)con->private;
>
> +    R_SockTimeout(timeout);
>    return R_SockWrite(this->fd, ptr, size * nitems)/size;
> }
>
>
>
> 2007/6/25, Prof Brian Ripley <ripley at stats.ox.ac.uk>:
>> On Mon, 25 Jun 2007, Ei-ji Nakama wrote:
>> 
>> > problem of the very large memory require by the Sign extension.
>> >
>> > --- R-2.5.0.orig/src/main/serialize.c   2007-03-27 01:42:08.000000000 
>> +0900
>> > +++ R-2.5.0/src/main/serialize.c        2007-06-25 00:48:58.000000000 
>> +0900
>> > @@ -1866,7 +1866,7 @@
>> >
>> > static void resize_buffer(membuf_t mb, int needed)
>> > {
>> > -    int newsize = 2 * needed;
>> > +    size_t newsize = 2 * needed;
>> >     mb->buf = realloc(mb->buf, newsize);
>> >     if (mb->buf == NULL)
>> >        error(_("cannot allocate buffer"));
>> 
>> Yes, thanks, but the structure also needs to be changed as the next line
>> is
>>
>>      mb->size = newsize;
>> 
>> and so this would set mb->size to a negative value.
>> 
>> Could you please tell us where you encountered this?
>> 
>> As far as I can see, this code is only used via R_serialize for
>> serializing to a raw vector, in which case 'size' can safely be 'int' and
>> the re-allocation should be up to 2^31-1 bytes at most (and allocating
>> twice what you are asked for seems undesirable).  But there is potential
>> overflow at
>>
>>      if (mb->count + length > mb->size)
>> 
>> and possibly elsewhere.
>> 
>> 
>> > The time-out of read and write was not set.
>> >
>> > 51:sendData.SOCKnode <- function(node, data) {
>> > 52:     timeout <- getClusterOption("timeout")
>> > 53:     old <- options(timeout = timeout);
>> > 54:     on.exit(options(old))
>> > 55:     serialize(data, node$con)
>> > 56: }
>> > 57:
>> > 58:recvData.SOCKnode <- function(node) {
>> > 59:     timeout <- getClusterOption("timeout")
>> > 60:     old <- options(timeout = timeout);
>> > 61:     on.exit(options(old))
>> > 62:     unserialize(node$con)
>> > 63: }
>> 
>> I don't think sock_read/sock_write is the right place to make that
>> setting.  Ideally it would be set when the option is set, but as this is
>> in a module that needs an extension to the interface.
>> 
>> Looking at the code, we read from a socket in blocks of 4096, but we write
>> in a single block.  The latter is likely to be the problem, and I think
>> some redesigning is necessary here.
>> 
>> Perhaps you and Luke Tierney can comment on exactly what the problem is
>> and how best to work around it.
>> 
>> >
>> > --- R-2.5.0.orig/src/modules/internet/sockconn.c 2006-09-04 
>> 23:20:59.000000000 +0900
>> > +++ R-2.5.0/src/modules/internet/sockconn.c     2007-06-25
>> > 00:51:38.000000000 +0900
>> > @@ -155,14 +155,19 @@
>> > static size_t sock_read(void *ptr, size_t size, size_t nitems,
>> >                        Rconnection con)
>> > {
>> > +    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
>> > +
>> > +    R_SockTimeout(timeout);
>> >     return sock_read_helper(con, ptr, size * nitems)/size;
>> > }
>> >
>> > static size_t sock_write(const void *ptr, size_t size, size_t nitems,
>> >                         Rconnection con)
>> > {
>> > +    int timeout = asInteger(GetOption(install("timeout"), R_BaseEnv));
>> >     Rsockconn this = (Rsockconn)con->private;
>> >
>> > +    R_SockTimeout(timeout);
>> >     return R_SockWrite(this->fd, ptr, size * nitems)/size;
>> > }
>> >
>> >
>> 
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> 
>> 
>> 
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From wangtong at usc.edu  Tue Jun 26 08:05:06 2007
From: wangtong at usc.edu (Tong Wang)
Date: Mon, 25 Jun 2007 23:05:06 -0700
Subject: [Rd] linking problem
Message-ID: <dd60c6ca1ab1.46804a22@usc.edu>

Hi, All 
   I got the following message while trying to compile a file and link it to some local libraries.  I am sure that the path to
local libs are given correctly,  them why can't the linker find them ?
   These libs are static ones,  like libBOOMdebug.a  , is this a problem ?  Do I need to convert all of them to DLL's ?
Is there an easy way to this. I am not quite familiar with this, I would appreciate it if your advice could be a little detailed.

Thanks a lot in advance. 

  
$ R CMD SHLIB -d dmvtnorm.cpp
making dmvtnorm.d from dmvtnorm.c
gcc   -IC:/cygwin/home/owner/R-2.4.1/include -I/home/owner/BOOM2/src  -gdwarf-2 -Wall -O0 -std=gnu99   -c dmvt
norm.c -o dmvtnorm.o
g++   -shared   -o dmvtnorm.dll dmvtnorm.def dmvtnorm.o  -LC:/cygwin/home/owner/R-2.4.1/bin  -L/home/owner/BOO
M2     -lR  -lBOOMdebug -llapack -lf77blas -lcblas -latlas -lg2c -lboost_program_options-gcc -lboost_filesyste
m-gcc -lboost_signals-gcc -lm
c:\programs\Rtools\MinGW\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe: cannot find -lBOOMdebug
collect2: ld returned 1 exit status
make: *** [dmvtnorm.dll] Error 1


From antonella872000 at yahoo.it  Mon Jun 25 23:43:19 2007
From: antonella872000 at yahoo.it (Gatsu)
Date: Mon, 25 Jun 2007 23:43:19 +0200 (CEST)
Subject: [Rd] R routine standalone
Message-ID: <648527.84229.qm@web26907.mail.ukl.yahoo.com>

I'm writing a C program and I'd like to include in it
some R routine (quantile functions, typically).

I found the functions I have to use (qnorm.c qbeta.c
ecc) e some include (nmath.h rmath.h ecc).

But I can't compile the project, I receive linker
error. 

Somebody can help me?

I say, if I want to include qbeta (for example) in a
project of mine, what should I do?


      ___________________________________


From agalecki at umich.edu  Mon Jun 25 22:17:12 2007
From: agalecki at umich.edu (agalecki at umich.edu)
Date: Mon, 25 Jun 2007 22:17:12 +0200 (CEST)
Subject: [Rd] Bug in getVarCov.gls method (PR#9752)
Message-ID: <20070625201712.561086597C@slim.kubism.ku.dk>

Hello,

I am using R2.5 under Windows.

Looks like the following statement 

 vars  <-  (obj$sigma^2)*vw

in getVarCov.gls method (nlme package) needs to  be replaced with:

 vars <- (obj$sigma*vw)^2

With best regards

Andrzej Galecki








Douglas Bates wrote:

>I'm not sure when the getVarCov.gls method was written or by whom.  To
>tell the truth I'm not really sure what it should do.
>
>Does anyone have recommendations about what to do?  The simplest
>thing, if the method is giving incorrect results, is to eliminate the
>method entirely.  Any objections to my doing that?
>
>The method is currently defined as
>
>getVarCov.gls <-
>    function(obj, individual = 1, ...)
>{
>    S <- corMatrix(obj$modelStruct$corStruct)[[individual]]
>    if (!is.null( obj$modelStruct$varStruct))
>    {
>        ind  <-  obj$groups==individual
>        vw  <-  1/varWeights(obj$modelStruct$varStruct)[ind]
>    }
>    else vw  <-  rep(1,nrow(S))
>    vars  <-  (obj$sigma^2)*vw
>    result  <-  t(S * sqrt(vars))*sqrt(vars)
>    class(result)  <-  c("marginal","VarCov")
>    attr(result,"group.levels")  <-  names(obj$groups)
>    result
>}
>
>
>On 2/23/06, Mary Lindstrom <lindstro at biostat.wisc.edu> wrote:
>  
>
>>Sounds like the documentation should be changed. Doug? Jose?
>>
>>- Mary
>>
>>Andrzej Galecki (agalecki at umich.edu) writes:
>> > Hi Mary,
>> >
>> > Thank you for your response. Note that we followed  R documentation,
>> > which states that  getVarCov() can be used with gls() objects.
>> >
>> > Thanks again.
>> >
>> > Andrzej
>> >
>> > Mary Lindstrom wrote:
>> >
>> > >Sorry once again for the slow response. When I wrote getVarCov I was
>> > >not thinking of using it for gls objects. Sounds like it doesn't work
>> > >for them. Either the code should be changed to reject the request when
>> > >the object has class gls or it should be rewritten to work correctly.
>> > >
>> > >- Mary
>> > >
>> > >Andrzej Galecki (agalecki at umich.edu) writes:
>> > > > Hi Mary,
>> > > >
>> > > > Our question is about variance-covariance matrix, hat(sigma_i),
>> > > > returned by getVarCov() function when applied to model fit generated by
>> > > > gls( ) function. It appears that at least in our example the returned
>> > > > matrix was incorrect. Are you aware of any problem with getVarCov ()
>> > > > when applied to an object generated by gls()?
>> > > >
>> > > > To be more specific our impression is that getVarCov() expects to get
>> > > > variances as an input
>> > > > and instead it gets standard deviations and corresponding ratios.
>> > > >
>> > > > Sorry we did not state our question more precisely.
>> > > >
>> > > > Thank you
>> > > >
>> > > > Andrzej
>> > > >
>> > > > PS. Here is our original question to Jose. His response was that the
>> > > > gls() syntax was correct and he directed us to you or to D.Bates
>> > > >
>> > > > We used gls() to fit a marginal model with unstructured
>> > > > covariance matrix. Could you verify gls() syntax, especially part
>> > > > specifying correlation matrix and variance function? Assuming that our
>> > > > gls() code is correct, we think that getVarCoV() returns incorrect
>> > > > marginal covariance matrix in this example. Are you aware of any
>> > > > problems with getVarCov(), when used with a model fit returned by
>> > > > gls()?  If you think that getVarCov() should work fine in the context of
>> > > > this model we are ready to send you a relevant code, in which we extract
>> > > > information from gls() fit and 'manualy' calculate marginal
>> > > > variance-covariance matrix and cross-check it with the output from SAS.
>> > > > Our impression is that getVarCov() expects to get variances as an input
>> > > > and instead it gets standard deviations and corresponding ratios. We
>> > > > would really like to get to the bottom of this issue.
>> > > >
>> > > >
>> > > > Mary Lindstrom wrote:
>> > > >
>> > > > >Hi Andrzej
>> > > > >
>> > > > > > -------- Original Message --------
>> > > > > > Subject:     Re: [Fwd: Mixed Models book.]
>> > > > > > Date:        Thu, 19 Jan 2006 13:06:09 -0500
>> > > > > > From:        jose.pinheiro at novartis.com
>> > > > > > To:  Andrzej Galecki <agalecki at umich.edu>
>> > > > > >
>> > > > > > The getVarCov function was actually written by Mary Lindstrom and, as a
>> > > > > > far as I know, adapted to R
>> > > > > > by Douglas Bates. I did think about including it in the S-PLUS version
>> > > > > > as well, but never got around
>> > > > > > to it. My understanding is that it should also work with gls objects,
>> > > > > > but I believe the main motivation
>> > > > > > was to have it for lme objects. I am not sure if the example is
>> > > > > > triggering some possible bug in the
>> > > > > > code, but perhaps you can ask Mary or Douglas if an updated version may
>> > > > > > be available. I will not have
>> > > > > > time to look at the code and get back to you before the deadlines you
>> > > > > > have for submitting the book.
>> > > > > > Have you tried using getVarCov with simpler gls models (e.g., compound
>> > > > > > symmetry with no variance functions)
>> > > > > > to see if you get the same type of problem?
>> > > > >
>> > > > >The point of getVarCov was to let students compute and see hat(D) the
>> > > > >estimate of the Variance matrix of the random effects and
>> > > > >hat(Sigma_i), the estimate of the marginal variance of y_i. If you are
>> > > > >fitting a General Linear Model (not a generalized mixed effects linear
>> > > > >model just to be clear) then there are no random effects so computing
>> > > > >hat(D) makes no sense. You could however still compute out
>> > > > >hat(Sigma_i).
>> > > > >
>> > > > >Does this answer your question?  - Mary
>> > > > >
>> > > > >
>> > > > >
>> > > > >
>> > > > >
>> > >
>> > >
>> > >
>> > >
>>
>>    
>>
>
>
>  
>


From dale.barr at ucr.edu  Tue Jun 26 00:57:22 2007
From: dale.barr at ucr.edu (dale.barr at ucr.edu)
Date: Tue, 26 Jun 2007 00:57:22 +0200 (CEST)
Subject: [Rd] conflict between lme4 and RMySQL packages (PR#9753)
Message-ID: <20070625225722.A165965962@slim.kubism.ku.dk>

Full_Name: Dale Barr
Version: 2.5.1 (patched)
OS: Ubuntu linux x86_64
Submission from: (NULL) (138.23.70.108)


When RMySQL is loaded in before lme4, the summary() function for lmer objects in
the lme4 packages produces the following error:

Error in printMer(object) : no slot of name "status" for this object of class
"table"

When RMySQL is loaded AFTER lme4, however, no such error arises.  For example,
the following code gives the error:

> library(RMySQL)
Loading required package: DBI
> library(lme4)
Loading required package: Matrix
Loading required package: lattice
> data(sleepstudy)
> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
> summary(fm1)
Error in printMer(object) : no slot of name "status" for this object of class
"table"

Now, here is the exact same code except that lme4 is loaded before RMySQL.  The
summary function works properly.

> library(lme4)
Loading required package: Matrix
Loading required package: lattice
library(RMySQL)> library(RMySQL)
Loading required package: DBI
> data(sleepstudy)
> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
> summary(fm1)
Linear mixed-effects model fit by REML 
Formula: Reaction ~ Days + (Days | Subject) 
   Data: sleepstudy 
  AIC  BIC logLik MLdeviance REMLdeviance
 1754 1770 -871.8       1752         1744
Random effects:
 Groups   Name        Variance Std.Dev. Corr  
 Subject  (Intercept) 610.835  24.7151        
          Days         35.056   5.9208  0.067 
 Residual             655.066  25.5943        
number of obs: 180, groups: Subject, 18

Fixed effects:
            Estimate Std. Error t value
(Intercept)  251.405      6.820   36.86
Days          10.467      1.546    6.77

Correlation of Fixed Effects:
     (Intr)
Days -0.137


MY SESSION INFO:
R version 2.5.1 RC (2007-06-22 r42030) 
x86_64-unknown-linux-gnu 

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[7] "base"     

other attached packages:
     RMySQL         DBI        lme4      Matrix     lattice 
    "0.6-0"     "0.2-3" "0.99875-2" "0.99875-2"   "0.15-11"


From ripley at stats.ox.ac.uk  Tue Jun 26 09:37:30 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 26 Jun 2007 08:37:30 +0100 (BST)
Subject: [Rd] R routine standalone
In-Reply-To: <648527.84229.qm@web26907.mail.ukl.yahoo.com>
References: <648527.84229.qm@web26907.mail.ukl.yahoo.com>
Message-ID: <Pine.LNX.4.64.0706260830280.18828@gannet.stats.ox.ac.uk>

You have not told us your OS nor version of R.

The file src/nmath/standalone/README in the R sources will either tell you 
how to do this or point you to the current documentation (depending on the 
R version).

At a guess (since you use 'project' and don't have the correct case on 
your file names) you are working with Visual Studio or similar under 
Windows.  In that case you are on your own: the R developers only support 
the use of MinGW on Windows (but see README.packages for some hints 
which you should be able to adapt to link to Rmath.dll).


On Mon, 25 Jun 2007, Gatsu wrote:

> I'm writing a C program and I'd like to include in it
> some R routine (quantile functions, typically).
>
> I found the functions I have to use (qnorm.c qbeta.c
> ecc) e some include (nmath.h rmath.h ecc).
>
> But I can't compile the project, I receive linker
> error.
>
> Somebody can help me?
>
> I say, if I want to include qbeta (for example) in a
> project of mine, what should I do?
>
>
>      ___________________________________
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Jun 26 09:49:36 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 26 Jun 2007 09:49:36 +0200 (CEST)
Subject: [Rd] Bug in getVarCov.gls method (PR#9752)
Message-ID: <20070626074936.1F4A96597D@slim.kubism.ku.dk>

On Mon, 25 Jun 2007, agalecki at umich.edu wrote:

> I am using R2.5 under Windows.

I presume you mean 2.5.0 (there is no R2.5: see the posting guide).  But 
which version of nlme, which is the relevant fact here?  The R posting 
guide suggests showing the output of sessionInfo() to establish the 
environment used.

> Looks like the following statement
>
> vars  <-  (obj$sigma^2)*vw
>
> in getVarCov.gls method (nlme package) needs to  be replaced with:
>
> vars <- (obj$sigma*vw)^2

We need some evidence!  Please supply a reproducible example and give your 
reasoning.  For example, the FAQ says

   The most important principle in reporting a bug is to report _facts_,
   not hypotheses or categorizations.  It is always easier to report the
   facts, but people seem to prefer to strain to posit explanations and
   report them instead.  If the explanations are based on guesses about how
   R is implemented, they will be useless; others will have to try to figure
   out what the facts must have been to lead to such speculations.
   Sometimes this is impossible.  But in any case, it is unnecessary work
   for the ones trying to fix the problem.

   It is very useful to try and find simple examples that produce
   apparently the same bug, and somewhat useful to find simple examples
   that might be expected to produce the bug but actually do not.  If you
   want to debug the problem and find exactly what caused it, that is
   wonderful.  You should still report the facts as well as any
   explanations or solutions. Please include an example that reproduces the
   problem, preferably the simplest one you have found.

It should be easily possible to cross-check an example with one of the 
many other ways available to do GLS fits in R.

[...]


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Tue Jun 26 10:43:53 2007
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Tue, 26 Jun 2007 10:43:53 +0200 (CEST)
Subject: [Rd] conflict between lme4 and RMySQL packages (PR#9753)
Message-ID: <20070626084353.227DD65971@slim.kubism.ku.dk>

Thank you, Dale.

I think you've revealed a bug in the method dispatch mechanism.
I'm adding here a script which confirms your finding and add
slightly more insight:

library(RMySQL)
library(lme4)

data(sleepstudy)
fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)

## MM: First save, then print -- the error is in "print" i.e. show() :
s1 <- summary(fm1)
s1 #-> error in printMer()  which is hidden :

debug(lme4:::printMer)
s1 # --> printMer(x, ..)  calls  so <- summary(x)  at the very beginning
## and indeed,  summary(x) -- *inside* printMer() dispatches wrongly !!!!
## whereas top-level, there is no problem :

## maybe here, or then later
undebug(lme4:::printMer)

## This works fine top-level, but gives non-sense when inside  printMer() !!
##
so <- summary(s1) ## does nothing, since s1 *is* already  summary.lmer :
stopifnot(identical(so, s1)) # ok

## one other symptom of the same problem:
showMethods(summary) ## is fine top-level

## whereas it does not see the correct methods when used from inside printMer()
## i.e., also when debugging 



>>>>> "db" == dale barr <dale.barr at ucr.edu>
>>>>>     on Tue, 26 Jun 2007 00:57:22 +0200 (CEST) writes:

    db> Full_Name: Dale Barr
    db> Version: 2.5.1 (patched)
    db> OS: Ubuntu linux x86_64
    db> Submission from: (NULL) (138.23.70.108)


    db> When RMySQL is loaded in before lme4, the summary() function for lmer objects in
    db> the lme4 packages produces the following error:

    db> Error in printMer(object) : no slot of name "status" for this object of class
    db> "table"

    db> When RMySQL is loaded AFTER lme4, however, no such error arises.  For example,
    db> the following code gives the error:

    >> library(RMySQL)
    db> Loading required package: DBI
    >> library(lme4)
    db> Loading required package: Matrix
    db> Loading required package: lattice
    >> data(sleepstudy)
    >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
    >> summary(fm1)
    db> Error in printMer(object) : no slot of name "status" for this object of class
    db> "table"

    db> Now, here is the exact same code except that lme4 is loaded before RMySQL.  The
    db> summary function works properly.

    >> library(lme4)
    db> Loading required package: Matrix
    db> Loading required package: lattice
    db> library(RMySQL)> library(RMySQL)
    db> Loading required package: DBI
    >> data(sleepstudy)
    >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
    >> summary(fm1)
    db> Linear mixed-effects model fit by REML 
    db> Formula: Reaction ~ Days + (Days | Subject) 
    db> Data: sleepstudy 
    db> AIC  BIC logLik MLdeviance REMLdeviance
    db> 1754 1770 -871.8       1752         1744
    db> Random effects:
    db> Groups   Name        Variance Std.Dev. Corr  
    db> Subject  (Intercept) 610.835  24.7151        
    db> Days         35.056   5.9208  0.067 
    db> Residual             655.066  25.5943        
    db> number of obs: 180, groups: Subject, 18

    db> Fixed effects:
    db> Estimate Std. Error t value
    db> (Intercept)  251.405      6.820   36.86
    db> Days          10.467      1.546    6.77

    db> Correlation of Fixed Effects:
    db> (Intr)
    db> Days -0.137


    db> MY SESSION INFO:
    db> R version 2.5.1 RC (2007-06-22 r42030) 
    db> x86_64-unknown-linux-gnu 

    db> locale:
    db> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

    db> attached base packages:
    db> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
    db> [7] "base"     

    db> other attached packages:
    db> RMySQL         DBI        lme4      Matrix     lattice 
    db> "0.6-0"     "0.2-3" "0.99875-2" "0.99875-2"   "0.15-11"

    db> ______________________________________________
    db> R-devel at r-project.org mailing list
    db> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Tue Jun 26 11:51:03 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 26 Jun 2007 10:51:03 +0100 (BST)
Subject: [Rd] conflict between lme4 and RMySQL packages (PR#9753)
In-Reply-To: <20070626084353.227DD65971@slim.kubism.ku.dk>
References: <20070626084353.227DD65971@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0706261002260.19805@gannet.stats.ox.ac.uk>

You have three summary() functions here:

> library(RMySQL)
Loading required package: DBI
> library(lme4)
Loading required package: Matrix
Loading required package: lattice
> find("summary")
[1] "package:Matrix" "package:DBI"    "package:base"

and this is simply a namespace issue (note the environments):

> summary
standardGeneric for "summary" defined from package "base"

function (object, ...)
standardGeneric("summary")
<environment: 0x15122d0>
Methods may be defined for arguments: object

> Matrix:::summary
standardGeneric for "summary" defined from package "base"

function (object, ...)
standardGeneric("summary")
<environment: 0x26c6640>
Methods may be defined for arguments: object

> DBI:::summary
standardGeneric for "summary" defined from package "base"

function (object, ...)
standardGeneric("summary")
<environment: 0x15122d0>
Methods may be defined for arguments: object

so the visible summary() from package:Matrix is a copy of that in the DBI 
namespace, not that in the Matrix namespace.  Since lme4 imports all of 
Matrix, it imports its take-over of summary.  So the issue is not *S4* 
dispatch per se, but how the 'methods' package copes with two or more 
packages presenting the same generic.

If you dig a bit deeper,

> ls(environment(summary)$".AllMTable")
  [1] "ANY"             "DBIObject"       "MySQLConnection" "MySQLDriver"
  [5] "MySQLResult"     "lmer2"           "mer"             "sparseMatrix"
  [9] "summary.lmer2"   "summary.mer"
> ls(environment(summary)$".AllMTable")
  [1] "ANY"             "DBIObject"       "MySQLConnection" "MySQLDriver"
  [5] "MySQLResult"     "lmer2"           "mer"             "sparseMatrix"
  [9] "summary.lmer2"   "summary.mer"
> ls(environment(Matrix:::summary)$".AllMTable")
[1] "ANY"          "sparseMatrix"
> ls(environment(DBI:::summary)$".AllMTable")
  [1] "ANY"             "DBIObject"       "MySQLConnection" "MySQLDriver"
  [5] "MySQLResult"     "lmer2"           "mer"             "sparseMatrix"
  [9] "summary.lmer2"   "summary.mer"

shows the issue: the methods do not get stored on the version in the 
Matrix namespace, but rather on the version in package:Matrix which was 
copied from the existing export and not Matrix:::summary.

Clearly there is going to be a namespace problem one way round: what seems 
undocumented is which.


On Tue, 26 Jun 2007, maechler at stat.math.ethz.ch wrote:

> Thank you, Dale.
>
> I think you've revealed a bug in the method dispatch mechanism.
> I'm adding here a script which confirms your finding and add
> slightly more insight:
>
> library(RMySQL)
> library(lme4)
>
> data(sleepstudy)
> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
>
> ## MM: First save, then print -- the error is in "print" i.e. show() :
> s1 <- summary(fm1)
> s1 #-> error in printMer()  which is hidden :
>
> debug(lme4:::printMer)
> s1 # --> printMer(x, ..)  calls  so <- summary(x)  at the very beginning
> ## and indeed,  summary(x) -- *inside* printMer() dispatches wrongly !!!!
> ## whereas top-level, there is no problem :
>
> ## maybe here, or then later
> undebug(lme4:::printMer)
>
> ## This works fine top-level, but gives non-sense when inside  printMer() !!
> ##
> so <- summary(s1) ## does nothing, since s1 *is* already  summary.lmer :
> stopifnot(identical(so, s1)) # ok
>
> ## one other symptom of the same problem:
> showMethods(summary) ## is fine top-level
>
> ## whereas it does not see the correct methods when used from inside printMer()
> ## i.e., also when debugging
>
>
>
>>>>>> "db" == dale barr <dale.barr at ucr.edu>
>>>>>>     on Tue, 26 Jun 2007 00:57:22 +0200 (CEST) writes:
>
>    db> Full_Name: Dale Barr
>    db> Version: 2.5.1 (patched)
>    db> OS: Ubuntu linux x86_64
>    db> Submission from: (NULL) (138.23.70.108)
>
>
>    db> When RMySQL is loaded in before lme4, the summary() function for lmer objects in
>    db> the lme4 packages produces the following error:
>
>    db> Error in printMer(object) : no slot of name "status" for this object of class
>    db> "table"
>
>    db> When RMySQL is loaded AFTER lme4, however, no such error arises.  For example,
>    db> the following code gives the error:
>
>    >> library(RMySQL)
>    db> Loading required package: DBI
>    >> library(lme4)
>    db> Loading required package: Matrix
>    db> Loading required package: lattice
>    >> data(sleepstudy)
>    >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
>    >> summary(fm1)
>    db> Error in printMer(object) : no slot of name "status" for this object of class
>    db> "table"
>
>    db> Now, here is the exact same code except that lme4 is loaded before RMySQL.  The
>    db> summary function works properly.
>
>    >> library(lme4)
>    db> Loading required package: Matrix
>    db> Loading required package: lattice
>    db> library(RMySQL)> library(RMySQL)
>    db> Loading required package: DBI
>    >> data(sleepstudy)
>    >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
>    >> summary(fm1)
>    db> Linear mixed-effects model fit by REML
>    db> Formula: Reaction ~ Days + (Days | Subject)
>    db> Data: sleepstudy
>    db> AIC  BIC logLik MLdeviance REMLdeviance
>    db> 1754 1770 -871.8       1752         1744
>    db> Random effects:
>    db> Groups   Name        Variance Std.Dev. Corr
>    db> Subject  (Intercept) 610.835  24.7151
>    db> Days         35.056   5.9208  0.067
>    db> Residual             655.066  25.5943
>    db> number of obs: 180, groups: Subject, 18
>
>    db> Fixed effects:
>    db> Estimate Std. Error t value
>    db> (Intercept)  251.405      6.820   36.86
>    db> Days          10.467      1.546    6.77
>
>    db> Correlation of Fixed Effects:
>    db> (Intr)
>    db> Days -0.137
>
>
>    db> MY SESSION INFO:
>    db> R version 2.5.1 RC (2007-06-22 r42030)
>    db> x86_64-unknown-linux-gnu
>
>    db> locale:
>    db> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
>    db> attached base packages:
>    db> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
>    db> [7] "base"
>
>    db> other attached packages:
>    db> RMySQL         DBI        lme4      Matrix     lattice
>    db> "0.6-0"     "0.2-3" "0.99875-2" "0.99875-2"   "0.15-11"
>
>    db> ______________________________________________
>    db> R-devel at r-project.org mailing list
>    db> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From s.ellison at lgc.co.uk  Tue Jun 26 14:16:53 2007
From: s.ellison at lgc.co.uk (s.ellison at lgc.co.uk)
Date: Tue, 26 Jun 2007 14:16:53 +0200 (CEST)
Subject: [Rd] boxplot and bxp do not respect xlim by default (PR#9754)
Message-ID: <20070626121653.8580448F56@slim.kubism.ku.dk>

Full_Name: Steve Ellison
Version: 2.4.1
OS: Windows, Linux
Submission from: (NULL) (194.73.101.157)


bxp() allows specifcation of box locations with at=, but neither adjusts xlim=
to fit at nor does it respect xlim provided explicitly.

This is because bxp() now includes explicit xlim as c(0.5, n+0.5), without
checking for explicitly supplied xlim (or ylim if horizontal).

This also prevents simple added plots (eg if add=T, with at=(1:n)+0.5, the last
box is partly off the plot.

The 'offending' code is in bxp:
    if (!add) {
        plot.new()
        if (horizontal) 
            plot.window(ylim = c(0.5, n + 0.5), xlim = ylim, 
                log = log, xaxs = pars$yaxs)
        else plot.window(xlim = c(0.5, n + 0.5), ylim = ylim, 
            log = log, yaxs = pars$yaxs)
    }

Suggested fix:
   if (!add) {
        plot.new()
	bxp.limits <- if(!is.null(at)) {
              c(at[1]-(at[2]-at[1])/2, at[n]+(at[n]-at[n-1])/2 ) 
           } else {
              c(0.5, n + 0.5)
           }
        if (horizontal) 
            plot.window(ylim = if(is.null(pars$xlim)) bxp.limits else
pars$xlim,
                      xlim = ylim, log = log, xaxs = pars$yaxs)
        else plot.window(xlim = if(is.null(pars$xlim)) bxp.limits else
pars$xlim, 
                      ylim = ylim, log = log, yaxs = pars$yaxs)
    }


This retains the current defaults for xlim with at unspecified but allows
explicit specification of xlim. (which is the grouping level axis whether
horizontal or vertical).

I've tested the above as far as producing a modified bxp and plotting a boxplot
object, but have not tried calling direct from boxplot. boxplot() should,
however, not need modification as xlim and ylim are, I believe, passed via the
namedargs list in the bxp call.


From murdoch at stats.uwo.ca  Tue Jun 26 14:25:24 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 26 Jun 2007 08:25:24 -0400
Subject: [Rd] boxplot and bxp do not respect xlim by default (PR#9754)
In-Reply-To: <20070626121653.8580448F56@slim.kubism.ku.dk>
References: <20070626121653.8580448F56@slim.kubism.ku.dk>
Message-ID: <468105B4.4090601@stats.uwo.ca>

On 6/26/2007 8:16 AM, s.ellison at lgc.co.uk wrote:
> Full_Name: Steve Ellison
> Version: 2.4.1
> OS: Windows, Linux
> Submission from: (NULL) (194.73.101.157)

That version is obsolete, but this problem is still present in R-devel. 
  I'll take a look.

Duncan Murdoch

> 
> 
> bxp() allows specifcation of box locations with at=, but neither adjusts xlim=
> to fit at nor does it respect xlim provided explicitly.
> 
> This is because bxp() now includes explicit xlim as c(0.5, n+0.5), without
> checking for explicitly supplied xlim (or ylim if horizontal).
> 
> This also prevents simple added plots (eg if add=T, with at=(1:n)+0.5, the last
> box is partly off the plot.
> 
> The 'offending' code is in bxp:
>     if (!add) {
>         plot.new()
>         if (horizontal) 
>             plot.window(ylim = c(0.5, n + 0.5), xlim = ylim, 
>                 log = log, xaxs = pars$yaxs)
>         else plot.window(xlim = c(0.5, n + 0.5), ylim = ylim, 
>             log = log, yaxs = pars$yaxs)
>     }
> 
> Suggested fix:
>    if (!add) {
>         plot.new()
> 	bxp.limits <- if(!is.null(at)) {
>               c(at[1]-(at[2]-at[1])/2, at[n]+(at[n]-at[n-1])/2 ) 
>            } else {
>               c(0.5, n + 0.5)
>            }
>         if (horizontal) 
>             plot.window(ylim = if(is.null(pars$xlim)) bxp.limits else
> pars$xlim,
>                       xlim = ylim, log = log, xaxs = pars$yaxs)
>         else plot.window(xlim = if(is.null(pars$xlim)) bxp.limits else
> pars$xlim, 
>                       ylim = ylim, log = log, yaxs = pars$yaxs)
>     }
> 
> 
> This retains the current defaults for xlim with at unspecified but allows
> explicit specification of xlim. (which is the grouping level axis whether
> horizontal or vertical).
> 
> I've tested the above as far as producing a modified bxp and plotting a boxplot
> object, but have not tried calling direct from boxplot. boxplot() should,
> however, not need modification as xlim and ylim are, I believe, passed via the
> namedargs list in the bxp call.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Tue Jun 26 14:47:25 2007
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Tue, 26 Jun 2007 14:47:25 +0200 (CEST)
Subject: [Rd] boxplot and bxp do not respect xlim by default (PR#9754)
Message-ID: <20070626124725.189686597E@slim.kubism.ku.dk>

On 6/26/2007 8:16 AM, s.ellison at lgc.co.uk wrote:
> Full_Name: Steve Ellison
> Version: 2.4.1
> OS: Windows, Linux
> Submission from: (NULL) (194.73.101.157)
> 
> 
> bxp() allows specifcation of box locations with at=, but neither adjusts xlim=
> to fit at nor does it respect xlim provided explicitly.
> 
> This is because bxp() now includes explicit xlim as c(0.5, n+0.5), without
> checking for explicitly supplied xlim (or ylim if horizontal).
> 
> This also prevents simple added plots (eg if add=T, with at=(1:n)+0.5, the last
> box is partly off the plot.
> 
> The 'offending' code is in bxp:
>     if (!add) {
>         plot.new()
>         if (horizontal) 
>             plot.window(ylim = c(0.5, n + 0.5), xlim = ylim, 
>                 log = log, xaxs = pars$yaxs)
>         else plot.window(xlim = c(0.5, n + 0.5), ylim = ylim, 
>             log = log, yaxs = pars$yaxs)
>     }
> 
> Suggested fix:
>    if (!add) {
>         plot.new()
> 	bxp.limits <- if(!is.null(at)) {
>               c(at[1]-(at[2]-at[1])/2, at[n]+(at[n]-at[n-1])/2 ) 
>            } else {
>               c(0.5, n + 0.5)
>            }
>         if (horizontal) 
>             plot.window(ylim = if(is.null(pars$xlim)) bxp.limits else
> pars$xlim,
>                       xlim = ylim, log = log, xaxs = pars$yaxs)
>         else plot.window(xlim = if(is.null(pars$xlim)) bxp.limits else
> pars$xlim, 
>                       ylim = ylim, log = log, yaxs = pars$yaxs)
>     }
> 
> 
> This retains the current defaults for xlim with at unspecified but allows
> explicit specification of xlim. (which is the grouping level axis whether
> horizontal or vertical).

But it fails in a few other cases:  if the user sets the widths, this 
doesn't respect that setting; if the user specifies the location of one 
boxplot (so length(at) == 1) it fails when it tries to access at[2].

This is a somewhat tricky problem, that needs more careful thought than 
I have time for right now, so I'll leave it for someone else (or for 
myself in a less busy future, which may exist in some alternate universe).

What I'd suggest you do in the short term is simply to set up the plot 
axes the way you want before calling bxp, then call it with add=TRUE.

Duncan Murdoch

> 
> I've tested the above as far as producing a modified bxp and plotting a boxplot
> object, but have not tried calling direct from boxplot. boxplot() should,
> however, not need modification as xlim and ylim are, I believe, passed via the
> namedargs list in the bxp call.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From S.Ellison at lgc.co.uk  Tue Jun 26 15:02:10 2007
From: S.Ellison at lgc.co.uk (S.Ellison at lgc.co.uk)
Date: Tue, 26 Jun 2007 15:02:10 +0200 (CEST)
Subject: [Rd] boxplot and bxp do not respect xlim by default (PR#9756)
Message-ID: <20070626130210.22BD56595A@slim.kubism.ku.dk>

What is mystifying is that the issue was not present in previous versions, =
so appropriate code already existed.

However, I agree that there seem to be a couple of additional issues that =
I had missed. =20

I am perfectly happy to look at this again myself, though, and provide =
extended code; would that help?

S

> This retains the current defaults for xlim with at unspecified but =
allows
> explicit specification of xlim. (which is the grouping level axis =
whether
> horizontal or vertical).

But it fails in a few other cases:  if the user sets the widths, this=20
doesn't respect that setting; if the user specifies the location of one=20
boxplot (so length(at) =3D=3D 1) it fails when it tries to access at[2].

This is a somewhat tricky problem, that needs more careful thought than=20
I have time for right now, so I'll leave it for someone else (or for=20
myself in a less busy future, which may exist in some alternate universe).

What I'd suggest you do in the short term is simply to set up the plot=20
axes the way you want before calling bxp, then call it with add=3DTRUE.

Duncan Murdoch


=
*******************************************************************=0D=0A=
This email and any attachments are confidential. Any use, co...{{dropped}}


From maechler at stat.math.ethz.ch  Tue Jun 26 15:07:25 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 26 Jun 2007 15:07:25 +0200
Subject: [Rd] conflict between lme4 and RMySQL packages (PR#9753)
In-Reply-To: <Pine.LNX.4.64.0706261002260.19805@gannet.stats.ox.ac.uk>
References: <20070626084353.227DD65971@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0706261002260.19805@gannet.stats.ox.ac.uk>
Message-ID: <18049.3981.789675.547369@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Tue, 26 Jun 2007 10:51:03 +0100 (BST) writes:

    BDR> You have three summary() functions here:
    >> library(RMySQL)
    BDR> Loading required package: DBI
    >> library(lme4)
    BDR> Loading required package: Matrix
    BDR> Loading required package: lattice
    >> find("summary")
    BDR> [1] "package:Matrix" "package:DBI"    "package:base"

    BDR> and this is simply a namespace issue (note the environments):

    >> summary
    BDR> standardGeneric for "summary" defined from package "base"

    BDR> function (object, ...)
    BDR> standardGeneric("summary")
    BDR> <environment: 0x15122d0>
    BDR> Methods may be defined for arguments: object

    >> Matrix:::summary
    BDR> standardGeneric for "summary" defined from package "base"

    BDR> function (object, ...)
    BDR> standardGeneric("summary")
    BDR> <environment: 0x26c6640>
    BDR> Methods may be defined for arguments: object

    >> DBI:::summary
    BDR> standardGeneric for "summary" defined from package "base"

    BDR> function (object, ...)
    BDR> standardGeneric("summary")
    BDR> <environment: 0x15122d0>
    BDR> Methods may be defined for arguments: object

    BDR> so the visible summary() from package:Matrix is a copy of that in the DBI 
    BDR> namespace, not that in the Matrix namespace.  

    BDR> Since lme4 imports all of 
    BDR> Matrix, it imports its take-over of summary.  So the issue is not *S4* 
    BDR> dispatch per se, but how the 'methods' package copes with two or more 
    BDR> packages presenting the same generic.

yes.  And that's what I meant.

The problem is --- not for the first time ---
that in this case,  from an S4 point of view, you would want to
keep only one version of summary(), namely ``the generic'',
and all packages / namespaces loaded and all other
  setMethod(summary, ...)
should ``attach'' their methods to that generic.
{and of also get an error or at least a loud warning when
 re-setting a method for a signature that already has a method
 set ``with the generic''. }

I think we should provide useRs and package writers a way to
achieve that --- which I think is pretty close to having the S4
generic behave as if there were no namespaces.

The other approach, that some of the bioconductor folks
advocate, is for each package to define it's own version of the
generic explicitly, by  setGeneric(..).
But that also breaks functionality, namely that of all toplevel calls {of
summary() in this case} apart from the ones of the last package loaded,
where as the namespace-internal calls {e.g., the summary(.)
inside printMer(.) in the given case} will continue to work.

    BDR> If you dig a bit deeper,

    >> ls(environment(summary)$".AllMTable")
    BDR> [1] "ANY"             "DBIObject"       "MySQLConnection" "MySQLDriver"
    BDR> [5] "MySQLResult"     "lmer2"           "mer"             "sparseMatrix"
    BDR> [9] "summary.lmer2"   "summary.mer"
    >> ls(environment(summary)$".AllMTable")
    BDR> [1] "ANY"             "DBIObject"       "MySQLConnection" "MySQLDriver"
    BDR> [5] "MySQLResult"     "lmer2"           "mer"             "sparseMatrix"
    BDR> [9] "summary.lmer2"   "summary.mer"
    >> ls(environment(Matrix:::summary)$".AllMTable")
    BDR> [1] "ANY"          "sparseMatrix"
    >> ls(environment(DBI:::summary)$".AllMTable")
    BDR> [1] "ANY"             "DBIObject"       "MySQLConnection" "MySQLDriver"
    BDR> [5] "MySQLResult"     "lmer2"           "mer"             "sparseMatrix"
    BDR> [9] "summary.lmer2"   "summary.mer"

    BDR> shows the issue: the methods do not get stored on the version in the 
    BDR> Matrix namespace, but rather on the version in package:Matrix which was 
    BDR> copied from the existing export and not Matrix:::summary.

    BDR> Clearly there is going to be a namespace problem one
    BDR> way round: what seems undocumented is which.

Hmm, haven't we been "here" before and come to the conclusion
that we'd like a special namespace, ("base4" IIRC ??), for all
those "global S4 generics" ?

Martin

    BDR> On Tue, 26 Jun 2007, maechler at stat.math.ethz.ch wrote:

    >> Thank you, Dale.
    >> 
    >> I think you've revealed a bug in the method dispatch mechanism.
    >> I'm adding here a script which confirms your finding and add
    >> slightly more insight:
    >> 
    >> library(RMySQL)
    >> library(lme4)
    >> 
    >> data(sleepstudy)
    >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
    >> 
    >> ## MM: First save, then print -- the error is in "print" i.e. show() :
    >> s1 <- summary(fm1)
    >> s1 #-> error in printMer()  which is hidden :
    >> 
    >> debug(lme4:::printMer)
    >> s1 # --> printMer(x, ..)  calls  so <- summary(x)  at the very beginning
    >> ## and indeed,  summary(x) -- *inside* printMer() dispatches wrongly !!!!
    >> ## whereas top-level, there is no problem :
    >> 
    >> ## maybe here, or then later
    >> undebug(lme4:::printMer)
    >> 
    >> ## This works fine top-level, but gives non-sense when inside  printMer() !!
    >> ##
    >> so <- summary(s1) ## does nothing, since s1 *is* already  summary.lmer :
    >> stopifnot(identical(so, s1)) # ok
    >> 
    >> ## one other symptom of the same problem:
    >> showMethods(summary) ## is fine top-level
    >> 
    >> ## whereas it does not see the correct methods when used from inside printMer()
    >> ## i.e., also when debugging
    >> 
    >> 
    >> 
    >>>>>>> "db" == dale barr <dale.barr at ucr.edu>
    >>>>>>> on Tue, 26 Jun 2007 00:57:22 +0200 (CEST) writes:
    >> 
    db> Full_Name: Dale Barr
    db> Version: 2.5.1 (patched)
    db> OS: Ubuntu linux x86_64
    db> Submission from: (NULL) (138.23.70.108)
    >> 
    >> 
    db> When RMySQL is loaded in before lme4, the summary() function for lmer objects in
    db> the lme4 packages produces the following error:
    >> 
    db> Error in printMer(object) : no slot of name "status" for this object of class
    db> "table"
    >> 
    db> When RMySQL is loaded AFTER lme4, however, no such error arises.  For example,
    db> the following code gives the error:
    >> 
    >> >> library(RMySQL)
    db> Loading required package: DBI
    >> >> library(lme4)
    db> Loading required package: Matrix
    db> Loading required package: lattice
    >> >> data(sleepstudy)
    >> >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
    >> >> summary(fm1)
    db> Error in printMer(object) : no slot of name "status" for this object of class
    db> "table"
    >> 
    db> Now, here is the exact same code except that lme4 is loaded before RMySQL.  The
    db> summary function works properly.
    >> 
    >> >> library(lme4)
    db> Loading required package: Matrix
    db> Loading required package: lattice
    db> library(RMySQL)> library(RMySQL)
    db> Loading required package: DBI
    >> >> data(sleepstudy)
    >> >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
    >> >> summary(fm1)
    db> Linear mixed-effects model fit by REML
    db> Formula: Reaction ~ Days + (Days | Subject)
    db> Data: sleepstudy
    db> AIC  BIC logLik MLdeviance REMLdeviance
    db> 1754 1770 -871.8       1752         1744
    db> Random effects:
    db> Groups   Name        Variance Std.Dev. Corr
    db> Subject  (Intercept) 610.835  24.7151
    db> Days         35.056   5.9208  0.067
    db> Residual             655.066  25.5943
    db> number of obs: 180, groups: Subject, 18
    >> 
    db> Fixed effects:
    db> Estimate Std. Error t value
    db> (Intercept)  251.405      6.820   36.86
    db> Days          10.467      1.546    6.77
    >> 
    db> Correlation of Fixed Effects:
    db> (Intr)
    db> Days -0.137
    >> 
    >> 
    db> MY SESSION INFO:
    db> R version 2.5.1 RC (2007-06-22 r42030)
    db> x86_64-unknown-linux-gnu
    >> 
    db> locale:
    db> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
    >> 
    db> attached base packages:
    db> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
    db> [7] "base"
    >> 
    db> other attached packages:
    db> RMySQL         DBI        lme4      Matrix     lattice
    db> "0.6-0"     "0.2-3" "0.99875-2" "0.99875-2"   "0.15-11"
    >> 
    db> ______________________________________________
    db> R-devel at r-project.org mailing list
    db> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 

    BDR> -- 
    BDR> Brian D. Ripley,                  ripley at stats.ox.ac.uk
    BDR> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
    BDR> University of Oxford,             Tel:  +44 1865 272861 (self)
    BDR> 1 South Parks Road,                     +44 1865 272866 (PA)
    BDR> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

    BDR> ______________________________________________
    BDR> R-devel at r-project.org mailing list
    BDR> https://stat.ethz.ch/mailman/listinfo/r-devel


From savicky at cs.cas.cz  Tue Jun 26 17:03:24 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Tue, 26 Jun 2007 17:03:24 +0200
Subject: [Rd] R 2.5.0 refuses to print enough digits to recover exact
	floating point values
In-Reply-To: <Pine.LNX.4.64.0705231538310.27405@gannet.stats.ox.ac.uk>
References: <eb97335b0705220013m6f3e137cp147d429c46717e24@mail.gmail.com>
	<4652C19F.1040509@statistik.uni-dortmund.de>
	<f8e6ff050705230251t1170b47enea9ced70a6ca4a1e@mail.gmail.com>
	<f8e6ff050705230257q72f3dbd5ua18072424b38386@mail.gmail.com>
	<Pine.LNX.4.64.0705231538310.27405@gannet.stats.ox.ac.uk>
Message-ID: <20070626150323.GB20879@cs.cas.cz>

I would like to reply to the following email from May in the thread
  [Rd] R 2.5.0 refuses to print enough digits to recover exact floating point values

On Wed, May 23, 2007 at 06:32:36PM +0100, Prof Brian Ripley wrote:
> I think this is a bug in the MacOS X runtime.  I've checked the C99
> standard, and can see no limits on the precision that you should be able
> to specify to printf.
> 
> Not that some protection against such OSes would come amiss.
> 
> However, the C99 standard does make clear that [sf]printf is not required 
> (even as 'recommended practice') to be accurate to more than *_DIG places, 
> which as ?as.character has pointed out is 15 on the machines R runs on.

Let me use
  http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1124.pdf
In Section 7.19.6, Recommended practice, paragraph 13, it is specified
that rounding to DECIMAL_DIG should be done correctly.

In Annex F.5 Binary-decimal conversion, it is explicitly stated that
conversion from the widest supported IEC 60559 format to decimal
with DECIMAL_DIG digits and back is the identity function. In footnote 305,
it is specified that if double (53 bit precision) is the widest format
supported, then DECIMAL_DIG >= 17.

R uses double precision as default, so I think DECIMAL_DIG = 17 is a
reasonable value. This is the minimum number of decimal digits, for which
the conversion
   double -> string -> double
is value preserving, if rounding is correct.

DBL_DIG = 15 is another constant, which is the maximum number of digits,
for which the conversion
   string -> double -> string
may be done value preserving.

> It really is the case that writing out a number to > 15 significant digits 
> and reading it back in again is not required to give exactly the same 
> IEC60559 (sic) number, and furthermore there are R platforms for which 
> this does not happen.  What Mr Weinberg claimed is 'now impossible' never 
> was possible in general (and he seems to be berating the R developers for 
> not striving to do better than the C standard requires of OSes).  In fact, 
> I believe this to be impossible unless you have access to extended 
> precsion arithmetic, as otherwise printf/scanf have to use the same 
> arithmetic as the computations.
> 
> This is why R supports transfer of floating-point numbers via readBin and 
> friends, and uses a binary format itself for save() (by default).
> 
> I should also say that any algorithm that depends on that level of details 
> in the numbers will depend on the compiler used and optimization level and 
> so on.  Don't expect repeatability to that level even with binary data 
> unless you (are allowed to) never apply bugfixes to your system.

Repeatability can hardly be achieved among different R installations, due
to the reasons you explain. However, repeatability of a computation 
within the same installation may be achieved and may be sometimes useful.
For example it may be useful for debugging, similarly as set.seed. Saving
the data in binary is a possible approach for this, however, decimal numbers
in a text may serve this purpose equally well, if they are precise enough.

I would like to ask a question concerning the function scientific
in src/main/format.c, which is called from formatReal in the same file.
Function scientific, besides other things, determines,
whether a smaller number of significant digits than R_print.digits
is sufficient to get a decimal number with relative error
at most max(10^-R_print.digits,2*DBL_EPSILON), where DBL_EPSILON=2^-52.

For simplicity, let me consider only the case, when
R_print.digits = DBL_DIG (which is 15). Then the bound for the relative
error is 1e-15, since 1e-15 > 2*2^-52.

There are two error bounds in consideration:
(1) the absolute error of the rounded mantissa (significand) is at most 5e-15,
(2) the relative error of the rounded number is at most 1e-15.

It is natural to consider also (1), since R_print.digits = 15 and 5e-15 is
the maximum absolute error of the mantissa for correct rounding
to 15 significant digits.

If the mantissa is in [1,5], then (2) => (1).
Hence, for these mantissas, function scientific should suggest a smaller
number of digits than 15 only if the result is as accurate as rounding
to 15 digits.

On the other hand, if the mantissa is in (5,10), then (2) does not imply (1).
Hence, here we sometimes do not get the full precision 15 digit numbers.
Is this behaviour the intention?

This has, for example, the following consequence: if a 15-digit number
is read into R using read.table and then written back to a text using
write.table, we need not get the same result.

For testing, I use the following platforms:

      FLAGS means CFLAGS,FFLAGS,CXXFLAGS,FCFLAGS
      on Linuxes, R version is 2.5.1 RC (2007-06-23 r42041),
      on Windows, R version is binary distribution of R-2.5.1 (RC).

  [1] AMD Athlon(tm) 64 Processor 3500+, SUSE 10.1,
      gcc 4.1.0, FLAGS = -g -O2 -march=pentium4 -mfpmath=sse

  [2] AMD Athlon(tm) 64 Processor 3500+, SUSE 10.1,
      gcc 4.1.0, FLAGS = default

  [3] Intel Xeon processor, Fedora Core 2,
      gcc 3.3.3, FLAGS -g -O2 -march=pentium4 -mfpmath=sse

  [4] Intel Xeon processor, Fedora Core 2,
      gcc 3.3.3, FLAGS = default

  [5] Pentium III, SuSE 10.0,
      gcc 4.0.2, FLAGS = -g -O2 -ffloat-store

  [6] Pentium III, SuSE 10.0,
      gcc 4.0.2, FLAGS = default

  [7] Pentium III, Windows XP.

On all 7 platforms, the problem with reproducing 15-digit numbers
appears for example for the following numbers

  a <- read.table(stdin());
  9.14363081376609
  9.15664585780591
  9.21585022237569
  9.23994602039041
  9.32750736234049
  9.35423342635191
  9.44884219569079
  9.47261017210051

  write.table(a,file="");
  # "V1"
  # "1" 9.1436308137661
  # "2" 9.1566458578059
  # "3" 9.2158502223757
  # "4" 9.2399460203904
  # "5" 9.3275073623405
  # "6" 9.3542334263519
  # "7" 9.4488421956908
  # "8" 9.4726101721005

On platforms [1,3,5,7], the problem appears also for smaller mantissas

  a <- read.table(stdin());
  7.57660233100411
  7.61904762387919
  8.05515628983101
  8.07459617374249

  write.table(a,file="");
  # "V1"
  # "1" 7.5766023310041
  # "2" 7.6190476238792
  # "3" 8.055156289831
  # "4" 8.0745961737425

An alternative approach would be to print the value with R_print.digits
(at most 17) precision and eliminate trailing zeros from the mantissa.
This would guarantee (1) for 15 digits.

More generally, the absolute error of the mantissa would
be at most 5*10^-R_print.digits and if the number may be represented
with smaller number of digits with error of the mantissa
less than 5*10^-R_print.digits, such a shorter representation
would be generated.

For functions, which format each value in a vector separately (as.character,
cat, write.table), removing trailing zeros may be done already in sprintf.
For R function print, which uses the same number of decimal positions
for all numbers in a vector, the string representation of all values
in a vector has to be seen before a decision on the number of removed
trailing zeros is made.

Also, I would like to point out that due to rounding errors in function
scientific, the actual errors sometimes exceed both bounds (1) and (2).
To demonstrate this, use the following:

  vect <- function(z) { v <- strsplit(z,"")[[1]]; as.integer(v[-2]); }
  diff <- function(x,y) { x <- vect(x); y <- vect(y);
      y <- c(y,rep(0,times=length(x)-length(y))); # assuming length(x) >= length(y)
      abs(sum((x - y)*10^-(1:length(x) - 1))); }

  x <- c(
  5.1767789744225927e+21,
  8.8010507503190114e+22,
  8.0551457236914104e+23,
  6.1185028214373079e+24,
  4.1491936503345055e+25,
  9.4921247662789880e+25);
  y <- as.character(x);
  mant.y <- sub("e.*","",y);
  z <- formatC(x,digits=21,width=-1,format="e");
  mant.z <- sub("e.*","",z);

  err <- matrix(nrow=length(x),ncol=2);
  for (i in 1:length(x)) {
      err[i,1] <- diff(mant.z[i],mant.y[i]);
      err[i,2] <- err[i,1]/as.double(mant.z[i]);
  }

  data.frame(formatC=z,as.character=y,abs.err=err[,1],rel.err=err[,2]);

On platforms [1,3,5], the output is (abs.err is absolute error of the mantissa):

                        formatC        as.character      abs.err      rel.err
  1 5.176778974422592651264e+21 5.1767789744226e+21 7.348736e-15 1.419558e-15
  2 8.801050750319011351757e+22  8.801050750319e+22 1.135176e-14 1.289818e-15
  3 8.055145723691410401526e+23 8.0551457236914e+23 1.040153e-14 1.291290e-15
  4 6.118502821437307892007e+24 6.1185028214373e+24 7.892007e-15 1.289859e-15
  5 4.149193650334505529822e+25 4.1491936503345e+25 5.529822e-15 1.332746e-15
  6 9.492124766278988034841e+25 9.4921247662790e+25 1.196516e-14 1.260535e-15

On platforms [2,4,6], as.character works correctly on these examples.

On [7] (windows), the output is

                        formatC         as.character      abs.err      rel.err
  1 5.176778974422592651157e+21  5.1767789744226e+21 7.348843e-15 1.419578e-15
  2 8.801050750319011351831e+22   8.801050750319e+22 1.135183e-14 1.289827e-15
  3 8.055145723691410400945e+23  8.0551457236914e+23 1.040095e-14 1.291217e-15
  4 6.118502821437307892093e+24  6.1185028214373e+24 7.892093e-15 1.289873e-15
  5 4.149193650334505529750e+25 4.14919365033451e+25 4.470250e-15 1.077378e-15
  6 9.492124766278988034877e+25  9.4921247662790e+25 1.196512e-14 1.260532e-15

formatC has smaller precision here, so the errors in the table are calculated
with smaller precision. However, besides x[5], the actual errors of the conversion
are the same as on platforms [1,3,5], since the numbers in x are the same
(verified using save/load in binary format) and besides x[5], also the result of
as.character is the same. The number x[5] is converted correctly.

All the best, Petr.


From btyner at gmail.com  Tue Jun 26 17:58:35 2007
From: btyner at gmail.com (Benjamin Tyner)
Date: Tue, 26 Jun 2007 11:58:35 -0400
Subject: [Rd] possible bug in 'scan'
Message-ID: <5f88b2c50706260858q1bfaa2e0tf62cb0694d01c4c1@mail.gmail.com>

R-devel,

When I run the following code on the attached file,

tmp <- scan("C:/temp.csv",
            what=list("character","numeric"),
            sep=",")

Then tmp[[2]] is a character vector. My impression from the help file
is that it should be a numeric as specified by 'what'

> sessionInfo()
R version 2.5.0 (2007-04-23)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
"methods"   "base"

other attached packages:
 lattice    gdata
"0.15-5"  "2.3.1"

My apologies if this is due to my misunderstanding.
Ben

From Greg.Snow at intermountainmail.org  Tue Jun 26 18:05:15 2007
From: Greg.Snow at intermountainmail.org (Greg Snow)
Date: Tue, 26 Jun 2007 10:05:15 -0600
Subject: [Rd] possible bug in 'scan'
In-Reply-To: <5f88b2c50706260858q1bfaa2e0tf62cb0694d01c4c1@mail.gmail.com>
Message-ID: <07E228A5BE53C24CAD490193A7381BBBA5AA87@LP-EXCHVS07.CO.IHC.COM>

The what argument looks at what the elements are, not the word they say.
Try this:

> tmp <- scan("C:/temp.csv",
>             what=list("",0),
>             sep=",")

Hope this helps,

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at intermountainmail.org
(801) 408-8111
 
 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Benjamin Tyner
> Sent: Tuesday, June 26, 2007 9:59 AM
> To: r-devel at r-project.org
> Subject: [Rd] possible bug in 'scan'
> 
> R-devel,
> 
> When I run the following code on the attached file,
> 
> tmp <- scan("C:/temp.csv",
>             what=list("character","numeric"),
>             sep=",")
> 
> Then tmp[[2]] is a character vector. My impression from the 
> help file is that it should be a numeric as specified by 'what'
> 
> > sessionInfo()
> R version 2.5.0 (2007-04-23)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> "methods"   "base"
> 
> other attached packages:
>  lattice    gdata
> "0.15-5"  "2.3.1"
> 
> My apologies if this is due to my misunderstanding.
> Ben
>


From iago.mosqueira at gmail.com  Tue Jun 26 18:06:38 2007
From: iago.mosqueira at gmail.com (Iago Mosqueira)
Date: Tue, 26 Jun 2007 18:06:38 +0200
Subject: [Rd] Behaviour of mle and environments or calling mle inside a
	function
Message-ID: <dba1e14b0706260906x70a7e017l6334a387cb05b83d@mail.gmail.com>

Dear all,

I would appreciate some help understanding the following behaviour
when stats4::mle is called inside a function. mle seems to look for
its arguments in R_GlobalEnv and not the environment from which it is
called.


library(stats4)

lkhd <- function(alpha=1, beta=0.1, sigma=0.1)
	- sum(dnorm(log(rec), log(alpha*ssb/(beta+ssb)), sqrt(sigma), TRUE))

object <- list(lkhd=lkhd, rec=1:10, ssb=1:10)

foo <- function(x)
{
	rec <- x$rec
	ssb <- x$ssb

	mle(x$lkhd)
}

foo(object)


This fails with

Error in log(rec) : object "rec" not found


rec <- object$rec
ssb <- object$ssb

foo(object)

and this works.

Using R version 2.5.0 (2007-04-23), on Linux (Ubuntu) 2.6.17

Many thanks,


Iago Mosqueira


From btyner at gmail.com  Tue Jun 26 18:23:01 2007
From: btyner at gmail.com (Benjamin Tyner)
Date: Tue, 26 Jun 2007 12:23:01 -0400
Subject: [Rd] possible bug in 'scan'
In-Reply-To: <07E228A5BE53C24CAD490193A7381BBBA5AA87@LP-EXCHVS07.CO.IHC.COM>
References: <5f88b2c50706260858q1bfaa2e0tf62cb0694d01c4c1@mail.gmail.com>
	<07E228A5BE53C24CAD490193A7381BBBA5AA87@LP-EXCHVS07.CO.IHC.COM>
Message-ID: <5f88b2c50706260923n5fbd197q9837be3386a58ea@mail.gmail.com>

How embarrassing -- works like a charm.

On 6/26/07, Greg Snow <Greg.Snow at intermountainmail.org> wrote:
> The what argument looks at what the elements are, not the word they say.
> Try this:
>
> > tmp <- scan("C:/temp.csv",
> >             what=list("",0),
> >             sep=",")
>
> Hope this helps,
>
> --
> Gregory (Greg) L. Snow Ph.D.
> Statistical Data Center
> Intermountain Healthcare
> greg.snow at intermountainmail.org
> (801) 408-8111
>
>
>
> > -----Original Message-----
> > From: r-devel-bounces at r-project.org
> > [mailto:r-devel-bounces at r-project.org] On Behalf Of Benjamin Tyner
> > Sent: Tuesday, June 26, 2007 9:59 AM
> > To: r-devel at r-project.org
> > Subject: [Rd] possible bug in 'scan'
> >
> > R-devel,
> >
> > When I run the following code on the attached file,
> >
> > tmp <- scan("C:/temp.csv",
> >             what=list("character","numeric"),
> >             sep=",")
> >
> > Then tmp[[2]] is a character vector. My impression from the
> > help file is that it should be a numeric as specified by 'what'
> >
> > > sessionInfo()
> > R version 2.5.0 (2007-04-23)
> > i386-pc-mingw32
> >
> > locale:
> > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> > States.1252;LC_MONETARY=English_United
> > States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> >
> > attached base packages:
> > [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> > "methods"   "base"
> >
> > other attached packages:
> >  lattice    gdata
> > "0.15-5"  "2.3.1"
> >
> > My apologies if this is due to my misunderstanding.
> > Ben
> >
>
>


From davison at stats.ox.ac.uk  Tue Jun 26 18:24:37 2007
From: davison at stats.ox.ac.uk (Dan Davison)
Date: Tue, 26 Jun 2007 17:24:37 +0100
Subject: [Rd] possible bug in 'scan'
In-Reply-To: <5f88b2c50706260858q1bfaa2e0tf62cb0694d01c4c1@mail.gmail.com>
References: <5f88b2c50706260858q1bfaa2e0tf62cb0694d01c4c1@mail.gmail.com>
Message-ID: <20070626162437.GA12214@stats.ox.ac.uk>

Hi Ben,

On Tue, Jun 26, 2007 at 11:58:35AM -0400, Benjamin Tyner wrote:
> R-devel,
> 
> When I run the following code on the attached file,
> 
> tmp <- scan("C:/temp.csv",
>            what=list("character","numeric"),
>            sep=",")
> 
> Then tmp[[2]] is a character vector. My impression from the help file
> is that it should be a numeric as specified by 'what'

?scan says

[...]
 what: the type of 'what' gives the type of data to be read.
[...]

so for example

what=list(character(), numeric())

would presumably have worked, but not your code, as both of your list elements are of type character.

Dan

> 
> >sessionInfo()
> R version 2.5.0 (2007-04-23)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> "methods"   "base"
> 
> other attached packages:
> lattice    gdata
> "0.15-5"  "2.3.1"
> 
> My apologies if this is due to my misunderstanding.
> Ben

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Tue Jun 26 18:28:46 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 26 Jun 2007 17:28:46 +0100 (BST)
Subject: [Rd] possible bug in 'scan'
In-Reply-To: <5f88b2c50706260858q1bfaa2e0tf62cb0694d01c4c1@mail.gmail.com>
References: <5f88b2c50706260858q1bfaa2e0tf62cb0694d01c4c1@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706261723060.18303@gannet.stats.ox.ac.uk>

On Tue, 26 Jun 2007, Benjamin Tyner wrote:

> R-devel,
>
> When I run the following code on the attached file,
>
> tmp <- scan("C:/temp.csv",
>           what=list("character","numeric"),
>           sep=",")
>
> Then tmp[[2]] is a character vector. My impression from the help file
> is that it should be a numeric as specified by 'what'

No, as "numeric" is a character vector.

     what: the type of 'what' gives the type of data to be read. The
           supported types are 'logical', 'integer', 'numeric',
           'complex', 'character', 'raw' and 'list'. If 'what' is a
           list, it is assumed that the lines of the data file are
           records each containing 'length(what)' items ("fields") and
           the list components should have elements which are one of the
           first six types listed or 'NULL', see section 'Details'
           below.

so you need what = list("", 0), say.

There are even examples in 'An Introduction to R'.

>
>> sessionInfo()
> R version 2.5.0 (2007-04-23)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
> "methods"   "base"
>
> other attached packages:
> lattice    gdata
> "0.15-5"  "2.3.1"
>
> My apologies if this is due to my misunderstanding.
> Ben
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Tue Jun 26 19:00:44 2007
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 26 Jun 2007 13:00:44 -0400
Subject: [Rd] conflict between lme4 and RMySQL packages (PR#9753)
In-Reply-To: <18049.3981.789675.547369@stat.math.ethz.ch>
References: <20070626084353.227DD65971@slim.kubism.ku.dk>	<Pine.LNX.4.64.0706261002260.19805@gannet.stats.ox.ac.uk>
	<18049.3981.789675.547369@stat.math.ethz.ch>
Message-ID: <4681463C.2080106@stats.uwo.ca>

On 6/26/2007 9:07 AM, Martin Maechler wrote:
>>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>>     on Tue, 26 Jun 2007 10:51:03 +0100 (BST) writes:
> 
>     BDR> You have three summary() functions here:
>     >> library(RMySQL)
>     BDR> Loading required package: DBI
>     >> library(lme4)
>     BDR> Loading required package: Matrix
>     BDR> Loading required package: lattice
>     >> find("summary")
>     BDR> [1] "package:Matrix" "package:DBI"    "package:base"
> 
>     BDR> and this is simply a namespace issue (note the environments):
> 
>     >> summary
>     BDR> standardGeneric for "summary" defined from package "base"
> 
>     BDR> function (object, ...)
>     BDR> standardGeneric("summary")
>     BDR> <environment: 0x15122d0>
>     BDR> Methods may be defined for arguments: object
> 
>     >> Matrix:::summary
>     BDR> standardGeneric for "summary" defined from package "base"
> 
>     BDR> function (object, ...)
>     BDR> standardGeneric("summary")
>     BDR> <environment: 0x26c6640>
>     BDR> Methods may be defined for arguments: object
> 
>     >> DBI:::summary
>     BDR> standardGeneric for "summary" defined from package "base"
> 
>     BDR> function (object, ...)
>     BDR> standardGeneric("summary")
>     BDR> <environment: 0x15122d0>
>     BDR> Methods may be defined for arguments: object
> 
>     BDR> so the visible summary() from package:Matrix is a copy of that in the DBI 
>     BDR> namespace, not that in the Matrix namespace.  
> 
>     BDR> Since lme4 imports all of 
>     BDR> Matrix, it imports its take-over of summary.  So the issue is not *S4* 
>     BDR> dispatch per se, but how the 'methods' package copes with two or more 
>     BDR> packages presenting the same generic.
> 
> yes.  And that's what I meant.
> 
> The problem is --- not for the first time ---
> that in this case,  from an S4 point of view, you would want to
> keep only one version of summary(), namely ``the generic'',
> and all packages / namespaces loaded and all other
>   setMethod(summary, ...)
> should ``attach'' their methods to that generic.
> {and of also get an error or at least a loud warning when
>  re-setting a method for a signature that already has a method
>  set ``with the generic''. }
> 
> I think we should provide useRs and package writers a way to
> achieve that --- which I think is pretty close to having the S4
> generic behave as if there were no namespaces.

I think a better conceptualization is that when S4 converts a function 
or S3 generic into an S4 generic, it does the conversion in place.

The original summary() is an S3 generic living in base, and everyone 
imports base, so it's not a good example.

A better example would be one of the S3 generics in the stats namespace, 
e.g. start().  If they're importing the generic from stats and 
converting it to an S4 generic, then their code should work with anyone 
else who did the same.  I think the easiest way to do this would be if 
we actually replaced the original S3 generic right in the stats 
namespace, but there might be other ways to implement it.

On the other hand, I can see someone defining a generic named start() 
completely independently of the time series meaning in stats, and 
exporting it from their package.  In this case it should live in their 
namespace, and only people who import that namespace will see it.

Duncan Murdoch





> The other approach, that some of the bioconductor folks
> advocate, is for each package to define it's own version of the
> generic explicitly, by  setGeneric(..).
> But that also breaks functionality, namely that of all toplevel calls {of
> summary() in this case} apart from the ones of the last package loaded,
> where as the namespace-internal calls {e.g., the summary(.)
> inside printMer(.) in the given case} will continue to work.
> 
>     BDR> If you dig a bit deeper,
> 
>     >> ls(environment(summary)$".AllMTable")
>     BDR> [1] "ANY"             "DBIObject"       "MySQLConnection" "MySQLDriver"
>     BDR> [5] "MySQLResult"     "lmer2"           "mer"             "sparseMatrix"
>     BDR> [9] "summary.lmer2"   "summary.mer"
>     >> ls(environment(summary)$".AllMTable")
>     BDR> [1] "ANY"             "DBIObject"       "MySQLConnection" "MySQLDriver"
>     BDR> [5] "MySQLResult"     "lmer2"           "mer"             "sparseMatrix"
>     BDR> [9] "summary.lmer2"   "summary.mer"
>     >> ls(environment(Matrix:::summary)$".AllMTable")
>     BDR> [1] "ANY"          "sparseMatrix"
>     >> ls(environment(DBI:::summary)$".AllMTable")
>     BDR> [1] "ANY"             "DBIObject"       "MySQLConnection" "MySQLDriver"
>     BDR> [5] "MySQLResult"     "lmer2"           "mer"             "sparseMatrix"
>     BDR> [9] "summary.lmer2"   "summary.mer"
> 
>     BDR> shows the issue: the methods do not get stored on the version in the 
>     BDR> Matrix namespace, but rather on the version in package:Matrix which was 
>     BDR> copied from the existing export and not Matrix:::summary.
> 
>     BDR> Clearly there is going to be a namespace problem one
>     BDR> way round: what seems undocumented is which.
> 
> Hmm, haven't we been "here" before and come to the conclusion
> that we'd like a special namespace, ("base4" IIRC ??), for all
> those "global S4 generics" ?
> 
> Martin
> 
>     BDR> On Tue, 26 Jun 2007, maechler at stat.math.ethz.ch wrote:
> 
>     >> Thank you, Dale.
>     >> 
>     >> I think you've revealed a bug in the method dispatch mechanism.
>     >> I'm adding here a script which confirms your finding and add
>     >> slightly more insight:
>     >> 
>     >> library(RMySQL)
>     >> library(lme4)
>     >> 
>     >> data(sleepstudy)
>     >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
>     >> 
>     >> ## MM: First save, then print -- the error is in "print" i.e. show() :
>     >> s1 <- summary(fm1)
>     >> s1 #-> error in printMer()  which is hidden :
>     >> 
>     >> debug(lme4:::printMer)
>     >> s1 # --> printMer(x, ..)  calls  so <- summary(x)  at the very beginning
>     >> ## and indeed,  summary(x) -- *inside* printMer() dispatches wrongly !!!!
>     >> ## whereas top-level, there is no problem :
>     >> 
>     >> ## maybe here, or then later
>     >> undebug(lme4:::printMer)
>     >> 
>     >> ## This works fine top-level, but gives non-sense when inside  printMer() !!
>     >> ##
>     >> so <- summary(s1) ## does nothing, since s1 *is* already  summary.lmer :
>     >> stopifnot(identical(so, s1)) # ok
>     >> 
>     >> ## one other symptom of the same problem:
>     >> showMethods(summary) ## is fine top-level
>     >> 
>     >> ## whereas it does not see the correct methods when used from inside printMer()
>     >> ## i.e., also when debugging
>     >> 
>     >> 
>     >> 
>     >>>>>>> "db" == dale barr <dale.barr at ucr.edu>
>     >>>>>>> on Tue, 26 Jun 2007 00:57:22 +0200 (CEST) writes:
>     >> 
>     db> Full_Name: Dale Barr
>     db> Version: 2.5.1 (patched)
>     db> OS: Ubuntu linux x86_64
>     db> Submission from: (NULL) (138.23.70.108)
>     >> 
>     >> 
>     db> When RMySQL is loaded in before lme4, the summary() function for lmer objects in
>     db> the lme4 packages produces the following error:
>     >> 
>     db> Error in printMer(object) : no slot of name "status" for this object of class
>     db> "table"
>     >> 
>     db> When RMySQL is loaded AFTER lme4, however, no such error arises.  For example,
>     db> the following code gives the error:
>     >> 
>     >> >> library(RMySQL)
>     db> Loading required package: DBI
>     >> >> library(lme4)
>     db> Loading required package: Matrix
>     db> Loading required package: lattice
>     >> >> data(sleepstudy)
>     >> >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
>     >> >> summary(fm1)
>     db> Error in printMer(object) : no slot of name "status" for this object of class
>     db> "table"
>     >> 
>     db> Now, here is the exact same code except that lme4 is loaded before RMySQL.  The
>     db> summary function works properly.
>     >> 
>     >> >> library(lme4)
>     db> Loading required package: Matrix
>     db> Loading required package: lattice
>     db> library(RMySQL)> library(RMySQL)
>     db> Loading required package: DBI
>     >> >> data(sleepstudy)
>     >> >> fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy)
>     >> >> summary(fm1)
>     db> Linear mixed-effects model fit by REML
>     db> Formula: Reaction ~ Days + (Days | Subject)
>     db> Data: sleepstudy
>     db> AIC  BIC logLik MLdeviance REMLdeviance
>     db> 1754 1770 -871.8       1752         1744
>     db> Random effects:
>     db> Groups   Name        Variance Std.Dev. Corr
>     db> Subject  (Intercept) 610.835  24.7151
>     db> Days         35.056   5.9208  0.067
>     db> Residual             655.066  25.5943
>     db> number of obs: 180, groups: Subject, 18
>     >> 
>     db> Fixed effects:
>     db> Estimate Std. Error t value
>     db> (Intercept)  251.405      6.820   36.86
>     db> Days          10.467      1.546    6.77
>     >> 
>     db> Correlation of Fixed Effects:
>     db> (Intr)
>     db> Days -0.137
>     >> 
>     >> 
>     db> MY SESSION INFO:
>     db> R version 2.5.1 RC (2007-06-22 r42030)
>     db> x86_64-unknown-linux-gnu
>     >> 
>     db> locale:
>     db> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>     >> 
>     db> attached base packages:
>     db> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
>     db> [7] "base"
>     >> 
>     db> other attached packages:
>     db> RMySQL         DBI        lme4      Matrix     lattice
>     db> "0.6-0"     "0.2-3" "0.99875-2" "0.99875-2"   "0.15-11"
>     >> 
>     db> ______________________________________________
>     db> R-devel at r-project.org mailing list
>     db> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> 
>     >> ______________________________________________
>     >> R-devel at r-project.org mailing list
>     >> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> 
> 
>     BDR> -- 
>     BDR> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>     BDR> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>     BDR> University of Oxford,             Tel:  +44 1865 272861 (self)
>     BDR> 1 South Parks Road,                     +44 1865 272866 (PA)
>     BDR> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
>     BDR> ______________________________________________
>     BDR> R-devel at r-project.org mailing list
>     BDR> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Tue Jun 26 19:15:40 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 26 Jun 2007 19:15:40 +0200
Subject: [Rd] "Math" group generics for S4, and a bug
In-Reply-To: <18044.20219.852968.354884@stat.math.ethz.ch>
References: <op.tub2q6d64hcap5@delllap.ugr.es> <467C0F13.4060004@stats.uwo.ca>
	<18044.20219.852968.354884@stat.math.ethz.ch>
Message-ID: <18049.18876.157823.721646@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Sat, 23 Jun 2007 00:36:43 +0200 writes:

 {on R-help}

 [.....................]
 [.....................]
 
  >>   Duncan Murdoch

      DM> You might have better luck with

      DM>   log1p(tasa)

    MM> {very good point, thank you, Duncan!}

       DM> if the authors of the Matrix package have written a
       DM> method for log1p(); if not, you'll probably have to do
       DM> it yourself.

    MM> They have not yet.

    MM> Note however that this - and expm1() - would
    MM> automagically work for sparse matrices if these two
    MM> functions were part of the "Math" S4 group generic.

    MM> I'd say that there's only historical reason for them
    MM> *not* to be part of "Math", and I am likely going to
    MM> propose to change this ....

I'm now going to propose ...

As I found, expm1() and log1p()  already *HAVE BEEN*  
in the S3 "Math" group generic  
   ``automagically by implementation''.
Just the documentation for this fact has been missing.

Hence, I've added that doc (uncommitted) and I'm about to add
them to the S4 Math group as well.  When doing so, I'd like to
add few more functions to make S3 and S4 "Math" a bit more compatible :
Consequently, I'm proposing to add the following functions to the S4 Math
group generic :

-  log1p, expm1

-  cummax, cummin	{S3 has them; cumprod(), cumsum() are already}

-  digamma, trigamma    {S3 has them; gamma(), lgamma()   are already}

----

When trying to do the above,
I'm pretty quickly successful for cummax & cummin,
most probably because they are primitive functions.
But I currently have problems for the other four,
and in exploring these problems,
I've found that

   log10()

does not S4- dispatch on "Math" neither,
which I think is a pretty peculiar bug;
I think if that was fixed, then my code changes would also work
to make log1p(), expm1(), digamma() and trigamma() correctly
part of "S4 - Math Group".


Martin


From ripley at stats.ox.ac.uk  Tue Jun 26 19:38:27 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 26 Jun 2007 18:38:27 +0100 (BST)
Subject: [Rd] "Math" group generics for S4, and a bug
In-Reply-To: <18049.18876.157823.721646@stat.math.ethz.ch>
References: <op.tub2q6d64hcap5@delllap.ugr.es> <467C0F13.4060004@stats.uwo.ca>
	<18044.20219.852968.354884@stat.math.ethz.ch>
	<18049.18876.157823.721646@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0706261831010.19304@gannet.stats.ox.ac.uk>

Remember that you only get S4 dispatch on Math for S4 generics.
log10 is not an S4 generic until you make it one.  From the help page

      Note: currently those members which are not primitive functions
      must have been converted to S4 generic functions (preferably
      _before_ setting an S4 group generic method) as it only sets
      methods for known S4 generics.  This can be done by a call to
      'setGeneric', for example 'setGeneric("round", group="Math2")'.

Had you done that (it is not mentioned)?

>From my notes about S4 issues sent to R core a while back:

1) Setting methods on a group generic only sets methods for existing
    generics, and only primitives are ab initio generic.

    ?setGeneric and ?Arith differ as to how other members should be
    converted into generics (one arg or two), and the example
    (setGeneric("+")) seems pointless as that is already generic.

    Whereas all of Ops (and its subgroups) and Complex are ab initio
    generic, none of Summary is and log, log10, gamma, lgamma, round,
    signif and trunc are not.

    The discrepancies between the S3 and S4 group generics are hard to
    explain: sign, digamma, trigamma and gammaCody are S3 group generic
    but not S4 group generic (and sign is S4 generic).  log10 is S4
    group generic but log2 is not.  This is probably all history, but
    not at all obvious to end users.

so the issue has been raised before.


On Tue, 26 Jun 2007, Martin Maechler wrote:

>>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>>     on Sat, 23 Jun 2007 00:36:43 +0200 writes:
>
> {on R-help}
>
> [.....................]
> [.....................]
>
>  >>   Duncan Murdoch
>
>      DM> You might have better luck with
>
>      DM>   log1p(tasa)
>
>    MM> {very good point, thank you, Duncan!}
>
>       DM> if the authors of the Matrix package have written a
>       DM> method for log1p(); if not, you'll probably have to do
>       DM> it yourself.
>
>    MM> They have not yet.
>
>    MM> Note however that this - and expm1() - would
>    MM> automagically work for sparse matrices if these two
>    MM> functions were part of the "Math" S4 group generic.
>
>    MM> I'd say that there's only historical reason for them
>    MM> *not* to be part of "Math", and I am likely going to
>    MM> propose to change this ....
>
> I'm now going to propose ...
>
> As I found, expm1() and log1p()  already *HAVE BEEN*
> in the S3 "Math" group generic
>   ``automagically by implementation''.
> Just the documentation for this fact has been missing.
>
> Hence, I've added that doc (uncommitted) and I'm about to add
> them to the S4 Math group as well.  When doing so, I'd like to
> add few more functions to make S3 and S4 "Math" a bit more compatible :
> Consequently, I'm proposing to add the following functions to the S4 Math
> group generic :
>
> -  log1p, expm1
>
> -  cummax, cummin	{S3 has them; cumprod(), cumsum() are already}
>
> -  digamma, trigamma    {S3 has them; gamma(), lgamma()   are already}
>
> ----
>
> When trying to do the above,
> I'm pretty quickly successful for cummax & cummin,
> most probably because they are primitive functions.
> But I currently have problems for the other four,
> and in exploring these problems,
> I've found that
>
>   log10()
>
> does not S4- dispatch on "Math" neither,
> which I think is a pretty peculiar bug;
> I think if that was fixed, then my code changes would also work
> to make log1p(), expm1(), digamma() and trigamma() correctly
> part of "S4 - Math Group".
>
>
> Martin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Jun 26 19:41:55 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 26 Jun 2007 18:41:55 +0100 (BST)
Subject: [Rd] Behaviour of mle and environments or calling mle inside a
 function
In-Reply-To: <dba1e14b0706260906x70a7e017l6334a387cb05b83d@mail.gmail.com>
References: <dba1e14b0706260906x70a7e017l6334a387cb05b83d@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706261732250.18303@gannet.stats.ox.ac.uk>

On Tue, 26 Jun 2007, Iago Mosqueira wrote:

> Dear all,
>
> I would appreciate some help understanding the following behaviour
> when stats4::mle is called inside a function. mle seems to look for
> its arguments in R_GlobalEnv and not the environment from which it is
> called.

It is your function lkhd() that is doing the looking, and lexical scoping 
means that it should be looking in .GlobalEnv (sic), since that is where 
you defined it.  Try a traceback:

> traceback()
10: log(rec)
9: dnorm(log(rec), log(alpha * ssb/(beta + ssb)), sqrt(sigma), TRUE)
8: sum(dnorm(log(rec), log(alpha * ssb/(beta + ssb)), sqrt(sigma),
        TRUE))
7: minuslogl(alpha = 1, beta = 0.1, sigma = 0.1)
6: do.call("minuslogl", l)
5: fn(par, ...)
4: function (par)
    fn(par, ...)(c(1, 0.1, 0.1))
3: optim(start, f, method = method, hessian = TRUE, ...)
2: mle(x$lkhd)
1: foo(object)

I am afraid I have no idea why you thought that your function would look 
in the body of foo().


>
>
> library(stats4)
>
> lkhd <- function(alpha=1, beta=0.1, sigma=0.1)
> 	- sum(dnorm(log(rec), log(alpha*ssb/(beta+ssb)), sqrt(sigma), TRUE))
>
> object <- list(lkhd=lkhd, rec=1:10, ssb=1:10)
>
> foo <- function(x)
> {
> 	rec <- x$rec
> 	ssb <- x$ssb
>
> 	mle(x$lkhd)
> }
>
> foo(object)
>
>
> This fails with
>
> Error in log(rec) : object "rec" not found
>
>
> rec <- object$rec
> ssb <- object$ssb
>
> foo(object)
>
> and this works.
>
> Using R version 2.5.0 (2007-04-23), on Linux (Ubuntu) 2.6.17
>
> Many thanks,
>
>
> Iago Mosqueira
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jmc at r-project.org  Tue Jun 26 20:47:25 2007
From: jmc at r-project.org (John Chambers)
Date: Tue, 26 Jun 2007 14:47:25 -0400
Subject: [Rd] "Math" group generics for S4, and a bug
In-Reply-To: <18049.18876.157823.721646@stat.math.ethz.ch>
References: <op.tub2q6d64hcap5@delllap.ugr.es>	<467C0F13.4060004@stats.uwo.ca>	<18044.20219.852968.354884@stat.math.ethz.ch>
	<18049.18876.157823.721646@stat.math.ethz.ch>
Message-ID: <46815F3D.8020707@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070626/7489b0c9/attachment.pl 

From agalecki at umich.edu  Tue Jun 26 18:13:42 2007
From: agalecki at umich.edu (agalecki at umich.edu)
Date: Tue, 26 Jun 2007 18:13:42 +0200 (CEST)
Subject: [Rd] Bug in getVarCov.gls method (PR#9752)
Message-ID: <20070626161342.834056595A@slim.kubism.ku.dk>

This is a multi-part message in MIME format.
--------------000206090008050103050209
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit


Two attachments:

1. getVarCovBugReport.R  - Rcode with an example illustrating the 
problem and how to fix it
2. getVarCovBugReportSession.txt contains code and R session results.

Thank you

Andrzej Galecki



Prof Brian Ripley wrote:

> On Mon, 25 Jun 2007, agalecki at umich.edu wrote:
>
>> I am using R2.5 under Windows.
>
>
> I presume you mean 2.5.0 (there is no R2.5: see the posting guide).  
> But which version of nlme, which is the relevant fact here?  The R 
> posting guide suggests showing the output of sessionInfo() to 
> establish the environment used.
>
>> Looks like the following statement
>>
>> vars  <-  (obj$sigma^2)*vw
>>
>> in getVarCov.gls method (nlme package) needs to  be replaced with:
>>
>> vars <- (obj$sigma*vw)^2
>
>
> We need some evidence!  Please supply a reproducible example and give 
> your reasoning.  For example, the FAQ says
>
>   The most important principle in reporting a bug is to report _facts_,
>   not hypotheses or categorizations.  It is always easier to report the
>   facts, but people seem to prefer to strain to posit explanations and
>   report them instead.  If the explanations are based on guesses about 
> how
>   R is implemented, they will be useless; others will have to try to 
> figure
>   out what the facts must have been to lead to such speculations.
>   Sometimes this is impossible.  But in any case, it is unnecessary work
>   for the ones trying to fix the problem.
>
>   It is very useful to try and find simple examples that produce
>   apparently the same bug, and somewhat useful to find simple examples
>   that might be expected to produce the bug but actually do not.  If you
>   want to debug the problem and find exactly what caused it, that is
>   wonderful.  You should still report the facts as well as any
>   explanations or solutions. Please include an example that reproduces 
> the
>   problem, preferably the simplest one you have found.
>
> It should be easily possible to cross-check an example with one of the 
> many other ways available to do GLS fits in R.
>
> [...]
>
>


--------------000206090008050103050209
Content-Type: text/plain;
 name="getVarCovBugReport.R"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="getVarCovBugReport.R"

ls()
require(nlme)
sessionInfo()
str(Orthodont)
formula(Orthodont)


# variances of <distance> variable at four different ages  
attach(Orthodont)
d8   <- distance[age==8]
d10  <- distance[age==10]
d12  <- distance[age==12]
d14  <- distance[age==14]
vars0<- diag(var(cbind(d8,d10,d12,d14)))
vars0
detach(Orthodont)


# Model with four means and unstructured covariance matrix 
# to _illustrate_ that getVarCov does not work properly
# It is expected that marginal variances from the following model 
# will be close to <vars0>. 
gls.fit <- gls(distance ~ -1 + factor(age),
    correlation= corSymm(form=~1|Subject), 
    weights=varIdent(form=~1|age),
    data= Orthodont)

# V matrix extracted using getVarCov 
Vmtx <- getVarCov(gls.fit,individual="M01") 
vars.incorrect <- diag(Vmtx)     # incorrect values on the diagonal 
vars.incorrect

# Manualy calculated variances (correct values) based on gls.fit
# Code used here is similar to getVarCov, with one statement corrected 
obj   <- gls.fit
ind   <- obj$groups == "M01"
vw    <- 1/varWeights(obj$modelStruct$varStruct)[ind]  # from getVarCov
vars  <- (obj$sigma *vw)^2   # Corrected statement   


# Please note that vars.corrected is very close to
# vars. (difference most likely due to rounding error)
vars.corrected <- vars.incorrect * vw  
vars.corrected 








--------------000206090008050103050209
Content-Type: text/plain;
 name="getVarCovBugReportSession.txt"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="getVarCovBugReportSession.txt"

> ls()
character(0)
> require(nlme)
Loading required package: nlme
[1] TRUE
> sessionInfo()
R version 2.5.0 (2007-04-23) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[7] "base"     

other attached packages:
    nlme 
"3.1-80" 
> #str(Orthodont)
> #formula(Orthodont)
> 
> # variances of <distance> variable at four different ages  
> attach(Orthodont)
> d8   <- distance[age==8]
> d10  <- distance[age==10]
> d12  <- distance[age==12]
> d14  <- distance[age==14]
> vars0<- diag(var(cbind(d8,d10,d12,d14)))
> vars0
      d8      d10      d12      d14 
5.925926 4.653846 7.938746 7.654558 
> detach(Orthodont)
> 
> 
> # Model with four means and unstructured covariance matrix 
> # to _illustrate_ that getVarCov does not work properly
> # It is expected that marginal variances from the following model 
> # will be close to <vars0>. 
> gls.fit <- gls(distance ~ -1 + factor(age),
+     correlation= corSymm(form=~1|Subject), 
+     weights=varIdent(form=~1|age),
+     data= Orthodont)
> 
> # V matrix extracted using getVarCov 
> Vmtx <- getVarCov(gls.fit,individual="M01") 
> vars.incorrect <- diag(Vmtx)     # incorrect values on the diagonal 
> vars.incorrect
[1] 5.925941 5.251514 6.858886 6.735022
> 
> # Manualy calculated variances (correct values) based on gls.fit
> # Code used here is similar to getVarCov, with one statement corrected 
> obj   <- gls.fit
> ind   <- obj$groups == "M01"
> vw    <- 1/varWeights(obj$modelStruct$varStruct)[ind]  # from getVarCov
> vars  <- (obj$sigma *vw)^2   # Corrected statement   
> 
> 
> # Please note that vars.corrected is very close to
> # vars. (difference most likely due to rounding error)
> vars.corrected <- vars.incorrect * vw  
> vars.corrected 
       8       10       12       14 
5.925941 4.653843 7.938708 7.654569 
> 


--------------000206090008050103050209--


From georgi.boshnakov at manchester.ac.uk  Tue Jun 26 19:15:04 2007
From: georgi.boshnakov at manchester.ac.uk (georgi.boshnakov at manchester.ac.uk)
Date: Tue, 26 Jun 2007 19:15:04 +0200 (CEST)
Subject: [Rd] slight anomaly in formals<- ? (PR#9758)
Message-ID: <20070626171504.D644765971@slim.kubism.ku.dk>

Hi,

The R input/output after the following paragraph is from a session with
version.string R version 2.4.0 Patched (2006-11-23 r39958).

The last element, x$c, of x has no value and after the assignment of x to the
formals of f, x$c does not become a formal argument of f. The second assignment
does the job. It seems that x$c actually becomes the body of f after the first
assignment. There is no problem if the  body of f is not NULL (this probably
explains why the second time the assignment to the formals of f works as
expected.

> x <- alist(a=,b=,c=)
> x$b <- 4
> f <- function(x) NULL
> f
function(x) NULL
> formals(f) <- x
> f
function (a, b = 4)

> formals(f) <- x
> f
function (a, b = 4, c)

> body(f)


-- 
Dr Georgi Boshnakov               tel: (+44) (0)161 306 3684
School of Mathematics             fax: (+44) (0)161 306 3669
The University of Manchester      email: Georgi.Boshnakov at manchester.ac.uk
Sackville Street
Manchester M60 1QD
UK


From maechler at stat.math.ethz.ch  Tue Jun 26 22:24:06 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 26 Jun 2007 22:24:06 +0200
Subject: [Rd] "Math" group generics for S4, and a bug
In-Reply-To: <Pine.LNX.4.64.0706261831010.19304@gannet.stats.ox.ac.uk>
References: <op.tub2q6d64hcap5@delllap.ugr.es> <467C0F13.4060004@stats.uwo.ca>
	<18044.20219.852968.354884@stat.math.ethz.ch>
	<18049.18876.157823.721646@stat.math.ethz.ch>
	<Pine.LNX.4.64.0706261831010.19304@gannet.stats.ox.ac.uk>
Message-ID: <18049.30182.258624.373379@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Tue, 26 Jun 2007 18:38:27 +0100 (BST) writes:

    BDR> Remember that you only get S4 dispatch on Math for S4
    BDR> generics.  log10 is not an S4 generic until you make it
    BDR> one.  From the help page

    BDR>       Note: currently those members which are not
    BDR> primitive functions must have been converted to S4
    BDR> generic functions (preferably _before_ setting an S4
    BDR> group generic method) as it only sets methods for known
    BDR> S4 generics.  This can be done by a call to
    BDR> 'setGeneric', for example 'setGeneric("round",
    BDR> group="Math2")'.

    BDR> Had you done that (it is not mentioned)?

no. embarrassing, since I "once" new about it
(had to do that in the Matrix package)...

    >> From my notes about S4 issues sent to R core a while
    >> back:

    BDR> 1) Setting methods on a group generic only sets methods
    BDR> for existing generics, and only primitives are ab
    BDR> initio generic.

    BDR>     ?setGeneric and ?Arith differ as to how other
    BDR> members should be converted into generics (one arg or
    BDR> two), and the example (setGeneric("+")) seems pointless
    BDR> as that is already generic.

    BDR>     Whereas all of Ops (and its subgroups) and Complex
    BDR> are ab initio generic, none of Summary is and log,
    BDR> log10, gamma, lgamma, round, signif and trunc are not.

    BDR>     The discrepancies between the S3 and S4 group
    BDR> generics are hard to explain: sign, digamma, trigamma
    BDR> and gammaCody are S3 group generic but not S4 group
    BDR> generic (and sign is S4 generic).  log10 is S4 group
    BDR> generic but log2 is not.  This is probably all history,
    BDR> but not at all obvious to end users.

    BDR> so the issue has been raised before.

Indeed.  Thanks a lot, Brian!
Martin

    BDR> On Tue, 26 Jun 2007, Martin Maechler wrote:

    >>>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
    >>>>>>> on Sat, 23 Jun 2007 00:36:43 +0200 writes:
    >> 
    >> {on R-help}
    >> 
    >> [.....................]  [.....................]
    >> 
    >> >> Duncan Murdoch
    >> 
    DM> You might have better luck with
    >> 
    DM> log1p(tasa)
    >> 
    MM> {very good point, thank you, Duncan!}
    >> 
    DM> if the authors of the Matrix package have written a
    DM> method for log1p(); if not, you'll probably have to do
    DM> it yourself.
    >> 
    MM> They have not yet.
    >> 
    MM> Note however that this - and expm1() - would
    MM> automagically work for sparse matrices if these two
    MM> functions were part of the "Math" S4 group generic.
    >> 
    MM> I'd say that there's only historical reason for them
    MM> *not* to be part of "Math", and I am likely going to
    MM> propose to change this ....
    >> 
    >> I'm now going to propose ...
    >> 
    >> As I found, expm1() and log1p() already *HAVE BEEN* in
    >> the S3 "Math" group generic ``automagically by
    >> implementation''.  Just the documentation for this fact
    >> has been missing.
    >> 
    >> Hence, I've added that doc (uncommitted) and I'm about to
    >> add them to the S4 Math group as well.  When doing so,
    >> I'd like to add few more functions to make S3 and S4
    >> "Math" a bit more compatible : Consequently, I'm
    >> proposing to add the following functions to the S4 Math
    >> group generic :
    >> 
    >> - log1p, expm1
    >> 
    >> - cummax, cummin {S3 has them; cumprod(), cumsum() are
    >> already}
    >> 
    >> - digamma, trigamma {S3 has them; gamma(), lgamma() are
    >> already}
    >> 
    >> ----
    >> 
    >> When trying to do the above, I'm pretty quickly
    >> successful for cummax & cummin, most probably because
    >> they are primitive functions.  But I currently have
    >> problems for the other four, and in exploring these
    >> problems, I've found that
    >> 
    >> log10()
    >> 
    >> does not S4- dispatch on "Math" neither, which I think is
    >> a pretty peculiar bug; I think if that was fixed, then my
    >> code changes would also work to make log1p(), expm1(),
    >> digamma() and trigamma() correctly part of "S4 - Math
    >> Group".
    >> 
    >> 
    >> Martin
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
    BDR> Professor of Applied Statistics,
    BDR> http://www.stats.ox.ac.uk/~ripley/ University of
    BDR> Oxford, Tel: +44 1865 272861 (self) 1 South Parks Road,
    BDR> +44 1865 272866 (PA) Oxford OX1 3TG, UK Fax: +44 1865
    BDR> 272595


From maechler at stat.math.ethz.ch  Tue Jun 26 22:28:38 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 26 Jun 2007 22:28:38 +0200
Subject: [Rd] "Math" group generics for S4, and a bug
In-Reply-To: <46815F3D.8020707@r-project.org>
References: <op.tub2q6d64hcap5@delllap.ugr.es> <467C0F13.4060004@stats.uwo.ca>
	<18044.20219.852968.354884@stat.math.ethz.ch>
	<18049.18876.157823.721646@stat.math.ethz.ch>
	<46815F3D.8020707@r-project.org>
Message-ID: <18049.30454.586531.138476@stat.math.ethz.ch>

>>>>> "JMC" == John Chambers <jmc at r-project.org>
>>>>>     on Tue, 26 Jun 2007 14:47:25 -0400 writes:

    JMC> Martin Maechler wrote:
    >>>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
    >>>>>>> on Sat, 23 Jun 2007 00:36:43 +0200 writes:
    >>>>>>> 
    >> 
> {on R-help}
    >> 
    >> [.....................]  [.....................]
    >> 
    >> >> Duncan Murdoch
    >> 
    DM> You might have better luck with
    >> 
    DM> log1p(tasa)
    >> 
    MM> {very good point, thank you, Duncan!}
    >> 
    DM> if the authors of the Matrix package have written a
    DM> method for log1p(); if not, you'll probably have to do
    DM> it yourself.
    >> 
    MM> They have not yet.
    >> 
    MM> Note however that this - and expm1() - would
    MM> automagically work for sparse matrices if these two
    MM> functions were part of the "Math" S4 group generic.
    >> 
    MM> I'd say that there's only historical reason for them
    MM> *not* to be part of "Math", and I am likely going to
    MM> propose to change this ....
    >> 
    >> I'm now going to propose ...
    >> 
    >> As I found, expm1() and log1p() already *HAVE BEEN* in
    >> the S3 "Math" group generic ``automagically by
    >> implementation''.  Just the documentation for this fact
    >> has been missing.
    >> 
    >> Hence, I've added that doc (uncommitted) and I'm about to
    >> add them to the S4 Math group as well.  When doing so,
    >> I'd like to add few more functions to make S3 and S4
    >> "Math" a bit more compatible : Consequently, I'm
    >> proposing to add the following functions to the S4 Math
    >> group generic :
    >> 
    >> - log1p, expm1
    >> 
    >> - cummax, cummin {S3 has them; cumprod(), cumsum() are
    >> already}
    >> 
    >> - digamma, trigamma {S3 has them; gamma(), lgamma() are
    >> already}
    >> 
    >> ----
    >> 
    >> When trying to do the above, I'm pretty quickly
    >> successful for cummax & cummin, most probably because
    >> they are primitive functions.  But I currently have
    >> problems for the other four, and in exploring these
    >> problems, I've found that
    >> 
    >> log10()
    >> 
    >> does not S4- dispatch on "Math" neither, which I think is
    >> a pretty peculiar bug;

    JMC> Well, it depends what you mean by "bug"; I would call
    JMC> it a "design infelicity" (a la Bill Venables), and some
    JMC> might call it a failure to Do What I Mean.  Assuming I
    JMC> understand what you meant (you didn't give an example)
    JMC> I disagree with the letter but very much agree with the
    JMC> spirit.

    JMC> In fact, log10 _is_ in the Math group.  But the
    JMC> programmer is currently responsible for creating a
    JMC> suitable generic function (that's the design
    JMC> infelicity).  If that is done correctly, dispatch seems
    JMC> to work fine:

    >> setGeneric("log10", group = "Math")
    JMC> [1] "log10"

yes, indeed.  Embarrassingly, actually I did know about this,
and indeed, it's not a bug.

    >> setClass("onX", representation(x="numeric", stuff =
    >> "character"))
    JMC> [1] "onX"
    >> setMethod("Math", "onX", function(x)callGeneric(x at x))
    JMC> [1] "Math"
    >> xx = new("onX", x=1:10, stuff = "test") log10(xx)
    JMC>  [1] 0.0000000 0.3010300 0.4771213 0.6020600 0.6989700
    JMC> 0.7781513 0.8450980 [8] 0.9030900 0.9542425 1.0000000
    >> showMethods("log10")
    JMC> Function: log10 (package base) x="ANY" x="integer"
    JMC> (inherited from: x="ANY") x="onX" (definition from
    JMC> function "Math")

    JMC> So unless you mean something different by "does not S4-
    JMC> dispatch", this is not technically a bug.  Your bug
    JMC> presumably came when you either did not call
    JMC> setGeneric() on log10() or else called it in the simple
    JMC> setGeneric("log10") form.

you are right.

    JMC> But in principle I very much agree that this is not a
    JMC> satisfactory situation.  It should be implicit in the
    JMC> definition of log10() that when it is made a generic,
    JMC> that generic has group "Math".  The reason it must now
    JMC> be done by the programmer is that log10() is not a
    JMC> primitive, and so not covered by the automatic
    JMC> definition of a generic that, e.g., applies to sin().

    JMC> I have a proposal to fix this, by generalizing the
    JMC> mechanism used for primitives in base, so that it would
    JMC> allow any function in any package to have an implicit
    JMC> generic form.  When a method is specified for the
    JMC> function, the implicit generic becomes the actual
    JMC> function.

That sounds like a very good idea, allowing the function writer
to specify (if and) how the function should behave as generic.

    JMC>   Sometime after 2.5.1 comes out, this should
    JMC> with luck find its way to r-devel so we can see if it
    JMC> helps.

So, I'm hoping for good luck.. ;-) :-)

Thanks a lot, John!
Martin

    >> I think if that was fixed, then my code changes would
    >> also work to make log1p(), expm1(), digamma() and
    >> trigamma() correctly part of "S4 - Math Group".
    >> 
    >> Martin


From bolker at zoo.ufl.edu  Tue Jun 26 23:20:11 2007
From: bolker at zoo.ufl.edu (bolker at zoo.ufl.edu)
Date: Tue, 26 Jun 2007 23:20:11 +0200 (CEST)
Subject: [Rd] trivial typo in ?ks.test (PR#9759)
Message-ID: <20070626212011.40FB765986@slim.kubism.ku.dk>

 In  ?ks.test

"if the sample size if less than 100 in"

should be

"if the sample size is less than 100 in"

  Ben Bolker



--please do not edit the information below--

Version:
 platform = i486-pc-linux-gnu
 arch = i486
 os = linux-gnu
 system = i486, linux-gnu
 status =
 major = 2
 minor = 5.0
 year = 2007
 month = 04
 day = 23
 svn rev = 41293
 language = R
 version.string = R version 2.5.0 (2007-04-23)

Locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:weaver, package:codetools, package:tools, 
package:digest, package:ellipse, package:cpcbp, package:lattice, 
package:MASS, package:fortunes, package:stats, package:graphics, 
package:grDevices, package:utils, package:datasets, package:methods, 
Autoloads, package:base


From ripley at stats.ox.ac.uk  Wed Jun 27 08:00:34 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 27 Jun 2007 08:00:34 +0200 (CEST)
Subject: [Rd] slight anomaly in formals<- ? (PR#9758)
Message-ID: <20070627060034.4570C6597D@slim.kubism.ku.dk>

On Tue, 26 Jun 2007, georgi.boshnakov at manchester.ac.uk wrote:

> Hi,
>
> The R input/output after the following paragraph is from a session with
> version.string R version 2.4.0 Patched (2006-11-23 r39958).

Which is not recent, but this is unchanged since.

The problem is the definition:

> `formals<-`
function (fun, envir = environment(fun), value)
as.function(c(value, body(fun)), envir)
<environment: namespace:base>

and

> c(x, NULL)
$a


$b
[1] 4

$c

I've fixed this for 2.6.0 (it is not critical enough for 2.5.1 due 
tomorrow). If you need the defn for your version, it is

`formals<-` <- function (fun, envir = environment(fun), value)
{
     bd <- body(fun)
     as.function(c(value, if(is.null(bd)) list(bd) else bd), envir)
}


>
> The last element, x$c, of x has no value and after the assignment of x 
> to the formals of f, x$c does not become a formal argument of f. The 
> second assignment does the job. It seems that x$c actually becomes the 
> body of f after the first assignment. There is no problem if the body of 
> f is not NULL (this probably explains why the second time the assignment 
> to the formals of f works as expected.
>
>> x <- alist(a=,b=,c=)
>> x$b <- 4

Or just x <- alist(a=,b=4,c=)

>> f <- function(x) NULL
>> f
> function(x) NULL
>> formals(f) <- x
>> f
> function (a, b = 4)
>
>> formals(f) <- x
>> f
> function (a, b = 4, c)
>
>> body(f)
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jun 27 08:20:44 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 27 Jun 2007 08:20:44 +0200 (CEST)
Subject: [Rd] Bug in getVarCov.gls method (PR#9752)
Message-ID: <20070627062044.DE0E76596B@slim.kubism.ku.dk>

Thank you, will be fixed in the next release of nlme (not yet scheduled, 
as everythign is code frozen for the release of R 2.5.1 tomorrow).

On Tue, 26 Jun 2007, Andrzej Galecki wrote:

>
> Two attachments:
>
> 1. getVarCovBugReport.R  - Rcode with an example illustrating the problem and 
> how to fix it
> 2. getVarCovBugReportSession.txt contains code and R session results.
>
> Thank you
>
> Andrzej Galecki
>
>
>
> Prof Brian Ripley wrote:
>
>> On Mon, 25 Jun 2007, agalecki at umich.edu wrote:
>> 
>>> I am using R2.5 under Windows.
>> 
>> 
>> I presume you mean 2.5.0 (there is no R2.5: see the posting guide).  But 
>> which version of nlme, which is the relevant fact here?  The R posting 
>> guide suggests showing the output of sessionInfo() to establish the 
>> environment used.
>> 
>>> Looks like the following statement
>>> 
>>> vars  <-  (obj$sigma^2)*vw
>>> 
>>> in getVarCov.gls method (nlme package) needs to  be replaced with:
>>> 
>>> vars <- (obj$sigma*vw)^2
>> 
>> 
>> We need some evidence!  Please supply a reproducible example and give your 
>> reasoning.  For example, the FAQ says
>>
>>   The most important principle in reporting a bug is to report _facts_,
>>   not hypotheses or categorizations.  It is always easier to report the
>>   facts, but people seem to prefer to strain to posit explanations and
>>   report them instead.  If the explanations are based on guesses about how
>>   R is implemented, they will be useless; others will have to try to figure
>>   out what the facts must have been to lead to such speculations.
>>   Sometimes this is impossible.  But in any case, it is unnecessary work
>>   for the ones trying to fix the problem.
>>
>>   It is very useful to try and find simple examples that produce
>>   apparently the same bug, and somewhat useful to find simple examples
>>   that might be expected to produce the bug but actually do not.  If you
>>   want to debug the problem and find exactly what caused it, that is
>>   wonderful.  You should still report the facts as well as any
>>   explanations or solutions. Please include an example that reproduces the
>>   problem, preferably the simplest one you have found.
>> 
>> It should be easily possible to cross-check an example with one of the many 
>> other ways available to do GLS fits in R.
>> 
>> [...]
>> 
>> 
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From r.hankin at noc.soton.ac.uk  Wed Jun 27 09:19:37 2007
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Wed, 27 Jun 2007 08:19:37 +0100
Subject: [Rd] inherits() and virtual classes
Message-ID: <75FA4E14-86B6-4A11-A8B0-B0332C7E1FCB@noc.soton.ac.uk>

Hi

How do I test for an object having a particular virtual class?

In the following, "onion" is a virtual class, and "octonion" is
a non-virtual class contained in onion.  The last call
to inherits() gives FALSE [R-2.5.0], when inherits.Rd led
me to expect TRUE.




setClass("onion",
          representation = "VIRTUAL"
          )

setClass("octonion",
          representation = representation(x="matrix"),
          prototype      = list(x=matrix(numeric(),0,8)),
          contains       = "onion"
          )


jj <- new("octonion",x=as.matrix(1:8))

inherits(jj,"onion")




--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From ripley at stats.ox.ac.uk  Wed Jun 27 09:40:57 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 27 Jun 2007 08:40:57 +0100 (BST)
Subject: [Rd] inherits() and virtual classes
In-Reply-To: <75FA4E14-86B6-4A11-A8B0-B0332C7E1FCB@noc.soton.ac.uk>
References: <75FA4E14-86B6-4A11-A8B0-B0332C7E1FCB@noc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0706270835160.25210@auk.stats>

inherits() is not to do with S4 classes: it tests inheritance in the base 
class system.

See ?is in package 'methods'.

> is(jj, "onion")
[1] TRUE


On Wed, 27 Jun 2007, Robin Hankin wrote:

> Hi
>
> How do I test for an object having a particular virtual class?
>
> In the following, "onion" is a virtual class, and "octonion" is
> a non-virtual class contained in onion.  The last call
> to inherits() gives FALSE [R-2.5.0], when inherits.Rd led
> me to expect TRUE.
>
>
>
>
> setClass("onion",
>          representation = "VIRTUAL"
>          )
>
> setClass("octonion",
>          representation = representation(x="matrix"),
>          prototype      = list(x=matrix(numeric(),0,8)),
>          contains       = "onion"
>          )
>
>
> jj <- new("octonion",x=as.matrix(1:8))
>
> inherits(jj,"onion")
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>  tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From edd at debian.org  Wed Jun 27 13:20:55 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 27 Jun 2007 06:20:55 -0500
Subject: [Rd] Rmpi and OpenMPI ?
In-Reply-To: <46823A1E.5030307@ibe.med.uni-muenchen.de>
References: <46823A1E.5030307@ibe.med.uni-muenchen.de>
Message-ID: <18050.18455.51187.86493@basebud.nulle.part>


On 27 June 2007 at 12:21, Markus Schmidberger wrote:
| Hello,
| 
| I found your discussion about Rmpi and openMpi at the R-devels archive.
| 
| Did you managed to run Rmpi on openMPI (completely)?

The good news is that a few of us have formed a new maintainaer team for
OpenMPI in Debian. New and decently maintained packages have been uploaded to
the NEW queue. They should reach Debian unstable after the usual inspection
delay for 'new' packages (triggered here as we renamed some sub-packages).

As for Rmpi, I have not had time to revisit building it against OpenMPI. It
does work ...
 
| We try to do this installation at a OS debian with the "openmpi-common" 
| package, but it is not working. For example there is no "mpi.h"

... provided you undo some LAM/MPI-ism in Rmpi. That is relatively simple. 

Rmpi will need a little bit of work for OpenMPI as Rmpi seems to use some
lam-only features.  

I hope I will get there, but it will probably be a matter of a few months not
days.  I need to sort out how to do it in a way to preserve the ability to
build with with lam, or fork a new 'ROpenMPI' off it. We'll see. I will
certainly report back with progress reports.

Anybody interested in helping port Rmpi to OpenMPI, please contact me off-line.

Regards, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From ripley at stats.ox.ac.uk  Wed Jun 27 13:38:24 2007
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 27 Jun 2007 13:38:24 +0200 (CEST)
Subject: [Rd] trivial typo in ?ks.test (PR#9759)
Message-ID: <20070627113824.EEAE26597E@slim.kubism.ku.dk>

Thanks, now fixed for 2.5.1.

(BTW, convention has it that sending things as trivial as this to R-devel 
suffices.  Now I must remember to close the PR ....)


On Tue, 26 Jun 2007, bolker at zoo.ufl.edu wrote:

> In  ?ks.test
>
> "if the sample size if less than 100 in"
>
> should be
>
> "if the sample size is less than 100 in"
>
>  Ben Bolker
>
>
>
> --please do not edit the information below--
>
> Version:
> platform = i486-pc-linux-gnu
> arch = i486
> os = linux-gnu
> system = i486, linux-gnu
> status =
> major = 2
> minor = 5.0
> year = 2007
> month = 04
> day = 23
> svn rev = 41293
> language = R
> version.string = R version 2.5.0 (2007-04-23)
>
> Locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> Search Path:
> .GlobalEnv, package:weaver, package:codetools, package:tools,
> package:digest, package:ellipse, package:cpcbp, package:lattice,
> package:MASS, package:fortunes, package:stats, package:graphics,
> package:grDevices, package:utils, package:datasets, package:methods,
> Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From savicky at cs.cas.cz  Wed Jun 27 15:28:26 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Wed, 27 Jun 2007 15:28:26 +0200
Subject: [Rd] make check for 2.5.1 RC fails on mbcsToSbcs in graphics
Message-ID: <20070627132826.GB12244@cs.cas.cz>

configure and make run OK, but make check failed
for R version 2.5.1 RC (2007-06-26 r42068) on graphics with error:

  > ## The following two examples use latin1 characters: these may not
  > ## appear correctly (or be omitted entirely).
  > plot(1:10, 1:10, main = "text(...) examples\n~~~~~~~~~~~~~~",
  +      sub = "R is GNU ?, but not ? ...")
  Error in title(...) : conversion failure in 'mbcsToSbcs'
  Execution halted

The whole tests/Examples/graphics-Ex.Rout.fail is at
  http://www.cs.cas.cz/~savicky/R-devel/graphics-Ex.Rout.fail

The end of make check report is:

  make[5]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/src/library'
  running code in 'grDevices-Ex.R' ... OK
  collecting examples for package 'graphics' ...
  make[5]: Entering directory `/home/petr/R/DEVEL/R-rc-2007-06-26/src/library'
   >>> Building/Updating help pages for package 'graphics'
       Formats: text html latex example 
  make[5]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/src/library'
  running code in 'graphics-Ex.R' ...make[4]: *** [graphics-Ex.Rout] Error 1
  make[4]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/tests/Examples'
  make[3]: *** [test-Examples-Base] Error 2
  make[3]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/tests/Examples'
  make[2]: *** [test-Examples] Error 2
  make[2]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/tests'
  make[1]: *** [test-all-basics] Error 1
  make[1]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/tests'
  make: *** [check] Error 2

Otherwise, the installation works.

  R.Version

  platform       i686-pc-linux-gnu                     
  arch           i686                                  
  os             linux-gnu                             
  system         i686, linux-gnu                       
  status         RC                                    
  major          2                                     
  minor          5.1                                   
  year           2007                                  
  month          06                                    
  day            26                                    
  svn.rev        42068                                 
  language       R                                     
  version.string R version 2.5.1 RC (2007-06-26 r42068)

System SUSE LINUX 10.0, gcc version 4.0.2 20050901 (prerelease) (SUSE Linux),
default options,

  $LANG = cs_CZ.UTF-8
  $LC_MESSAGES = POSIX
  $LC_TIME = POSIX
  no other LC_* set

Petr.


From ripley at stats.ox.ac.uk  Wed Jun 27 16:04:01 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 27 Jun 2007 15:04:01 +0100 (BST)
Subject: [Rd] make check for 2.5.1 RC fails on mbcsToSbcs in graphics
In-Reply-To: <20070627132826.GB12244@cs.cas.cz>
References: <20070627132826.GB12244@cs.cas.cz>
Message-ID: <Pine.LNX.4.64.0706271442360.6441@gannet.stats.ox.ac.uk>

But R 2.5.0 does the same, and as far as I know R has done so for many 
past versions.

You are asking the impossible: outputting Latin-1 in a Latin-2 
environment.  Remember that postscript() does not handle UTF-8, and so 
uses whatever it thinks the local 8-bit encoding is, in your case 
either Latin-2 or ASCII.  We can probably work around this, but definitely 
not at this late stage for 2.5.1.


On Wed, 27 Jun 2007, Petr Savicky wrote:

> configure and make run OK, but make check failed
> for R version 2.5.1 RC (2007-06-26 r42068) on graphics with error:
>
>  > ## The following two examples use latin1 characters: these may not
>  > ## appear correctly (or be omitted entirely).
>  > plot(1:10, 1:10, main = "text(...) examples\n~~~~~~~~~~~~~~",
>  +      sub = "R is GNU ?, but not ? ...")
>  Error in title(...) : conversion failure in 'mbcsToSbcs'
>  Execution halted
>
> The whole tests/Examples/graphics-Ex.Rout.fail is at
>  http://www.cs.cas.cz/~savicky/R-devel/graphics-Ex.Rout.fail
>
> The end of make check report is:
>
>  make[5]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/src/library'
>  running code in 'grDevices-Ex.R' ... OK
>  collecting examples for package 'graphics' ...
>  make[5]: Entering directory `/home/petr/R/DEVEL/R-rc-2007-06-26/src/library'
>   >>> Building/Updating help pages for package 'graphics'
>       Formats: text html latex example
>  make[5]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/src/library'
>  running code in 'graphics-Ex.R' ...make[4]: *** [graphics-Ex.Rout] Error 1
>  make[4]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/tests/Examples'
>  make[3]: *** [test-Examples-Base] Error 2
>  make[3]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/tests/Examples'
>  make[2]: *** [test-Examples] Error 2
>  make[2]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/tests'
>  make[1]: *** [test-all-basics] Error 1
>  make[1]: Leaving directory `/home/petr/R/DEVEL/R-rc-2007-06-26/tests'
>  make: *** [check] Error 2
>
> Otherwise, the installation works.
>
>  R.Version
>
>  platform       i686-pc-linux-gnu
>  arch           i686
>  os             linux-gnu
>  system         i686, linux-gnu
>  status         RC
>  major          2
>  minor          5.1
>  year           2007
>  month          06
>  day            26
>  svn.rev        42068
>  language       R
>  version.string R version 2.5.1 RC (2007-06-26 r42068)
>
> System SUSE LINUX 10.0, gcc version 4.0.2 20050901 (prerelease) (SUSE Linux),
> default options,
>
>  $LANG = cs_CZ.UTF-8
>  $LC_MESSAGES = POSIX
>  $LC_TIME = POSIX
>  no other LC_* set
>
> Petr.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Wed Jun 27 16:26:16 2007
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 27 Jun 2007 16:26:16 +0200
Subject: [Rd] make check for 2.5.1 RC fails on mbcsToSbcs in graphics
In-Reply-To: <Pine.LNX.4.64.0706271442360.6441@gannet.stats.ox.ac.uk>
References: <20070627132826.GB12244@cs.cas.cz>
	<Pine.LNX.4.64.0706271442360.6441@gannet.stats.ox.ac.uk>
Message-ID: <46827388.6020706@biostat.ku.dk>

Prof Brian Ripley wrote:
> But R 2.5.0 does the same, and as far as I know R has done so for many 
> past versions.
>
> You are asking the impossible: outputting Latin-1 in a Latin-2 
> environment.  Remember that postscript() does not handle UTF-8, and so 
> uses whatever it thinks the local 8-bit encoding is, in your case 
> either Latin-2 or ASCII.  We can probably work around this, but 
> definitely not at this late stage for 2.5.1.
Yes. Longer term we probably should. I don't think we want  "make check" 
to be locale-dependent, and we do enforce C locale elsewhere.


From schmidb at ibe.med.uni-muenchen.de  Wed Jun 27 12:21:18 2007
From: schmidb at ibe.med.uni-muenchen.de (Markus Schmidberger)
Date: Wed, 27 Jun 2007 12:21:18 +0200
Subject: [Rd]  Rmpi and OpenMPI ?
References: dc41e1260703292048j65ed60bfv13f4eb6862de6715@mail.gmail.com
Message-ID: <46823A1E.5030307@ibe.med.uni-muenchen.de>

Hello,

I found your discussion about Rmpi and openMpi at the R-devels archive.

Did you managed to run Rmpi on openMPI (completely)?

We try to do this installation at a OS debian with the "openmpi-common" 
package, but it is not working. For example there is no "mpi.h"

Thanks
Markus

-- 
Dipl.-Tech. Math. Markus Schmidberger

Ludwig-Maximilians-Universit?t M?nchen
IBE - Institut f?r medizinische Informationsverarbeitung,
Biometrie und Epidemiologie
Marchioninistr. 15, D-81377 Muenchen
URL: http://ibe.web.med.uni-muenchen.de 
Mail: Markus.Schmidberger [at] ibe.med.uni-muenchen.de


From ripley at stats.ox.ac.uk  Wed Jun 27 17:20:39 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 27 Jun 2007 16:20:39 +0100 (BST)
Subject: [Rd] make check for 2.5.1 RC fails on mbcsToSbcs in graphics
In-Reply-To: <46827388.6020706@biostat.ku.dk>
References: <20070627132826.GB12244@cs.cas.cz>
	<Pine.LNX.4.64.0706271442360.6441@gannet.stats.ox.ac.uk>
	<46827388.6020706@biostat.ku.dk>
Message-ID: <Pine.LNX.4.64.0706271544050.15363@auk.stats>

On Wed, 27 Jun 2007, Peter Dalgaard wrote:

> Prof Brian Ripley wrote:
>> But R 2.5.0 does the same, and as far as I know R has done so for many
>> past versions.
>>
>> You are asking the impossible: outputting Latin-1 in a Latin-2
>> environment.  Remember that postscript() does not handle UTF-8, and so
>> uses whatever it thinks the local 8-bit encoding is, in your case
>> either Latin-2 or ASCII.  We can probably work around this, but
>> definitely not at this late stage for 2.5.1.

> Yes. Longer term we probably should. I don't think we want  "make check"
> to be locale-dependent, and we do enforce C locale elsewhere.

But you can't really avoid it if you want to test non-ASCII
features: for example, you cannot test Latin-1 graphics in a C locale.

It was intended that the postscript device opened for testing graphics was 
opened with encoding="ISOLatin1".  That should certainly have helped, at 
least in a UTF-8 locale, but unfortunately there were a couple of typos in 
tests/Examples/Makefile.  Fixing that file makes 'make check' work in 
cs_CZ.utf8 at least on my machine.

It still remains that (for examples) you cannot successfully run make 
check in a MBCS locale without iconv, nor will zh_CN.gbk nor zh_TW.big5 
work.  I've added a note to R-admin to say that you may need to try a 
suitable locale.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rmh at temple.edu  Wed Jun 27 17:59:02 2007
From: rmh at temple.edu (rmh at temple.edu)
Date: Wed, 27 Jun 2007 17:59:02 +0200 (CEST)
Subject: [Rd] possible bug in conflicts() (PR#9760)
Message-ID: <20070627155902.DA97B65994@slim.kubism.ku.dk>

# R for Windows will not send your bug report automatically.
# Please copy the bug report (after finishing it) to
# your favorite email program and send it to
#
#       r-bugs at r-project.org
#
######################################################

Dare I say the word: bug.  It looks to me like a bug in conficts().
The use of seq_along in this line in base::conflicts
+     for (i in seq_along(where)) z[[i]] <- objects(pos = where[i])
is not appropriate.  It has the effect of ignoring the names of the
attached objects.

The proposed repair works as I wish.

> options(chmhelp = FALSE)
> if(!exists("baseenv", mode="function")) baseenv <- function() NULL
> options(STERM='iESS', editor='gnuclient.exe')
> search()
 [1] ".GlobalEnv"        "package:stats"     "package:graphics" 
 [4] "package:grDevices" "package:utils"     "package:datasets" 
 [7] "package:rcom"      "package:methods"   "Autoloads"        
[10] "package:base"     
> ls(all=TRUE)
character(0)
> conflicts(detail=TRUE)
$`package:methods`
[1] "body<-"

$`package:base`
[1] "body<-"

> conflicts(where=search()[c(8,10)], detail=TRUE)  ## this is effectively using search()[1:2]
list()
> conflicts <-
+ function (where = search(), detail = FALSE) 
+ {
+     if (length(where) < 1) 
+         stop("argument 'where' of length 0")
+     z <- vector(length(where), mode = "list")
+     names(z) <- where
+     for (i in where) z[[i]] <- objects(pos = i)  ## rmh
+     all <- unlist(z, use.names = FALSE)
+     dups <- duplicated(all)
+     dups <- all[dups]
+     if (detail) {
+         for (i in where) z[[i]] <- z[[i]][match(dups, z[[i]], 
+             0)]
+         z[sapply(z, function(x) length(x) == 0)] <- NULL
+         z
+     }
+     else dups
+ }
> 
> conflicts(where=search()[c(8,10)], detail=TRUE)  ## now it honors c(8,10)
$`package:methods`
[1] "body<-"

$`package:base`
[1] "body<-"

> conflicts(detail=T)
$.GlobalEnv
[1] "conflicts"

$`package:methods`
[1] "body<-"

$`package:base`
[1] "body<-"    "conflicts"

> bug.report()
bug.report()
The unsent bug report can be found in file c:/tmp/R.bug.report 
> 

--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 5.0
 year = 2007
 month = 04
 day = 23
 svn rev = 41293
 language = R
 version.string = R version 2.5.0 (2007-04-23)

Windows XP Home (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, 
package:rcom, package:methods, Autoloads, package:base


From spluque at gmail.com  Thu Jun 28 01:15:17 2007
From: spluque at gmail.com (Sebastian P. Luque)
Date: Wed, 27 Jun 2007 18:15:17 -0500
Subject: [Rd] error message from lmer
Message-ID: <87abult2ey.fsf@patagonia.sebmags.homelinux.org>

Hi,

I've begun to use the lme4 package, rather than nlme, for more flexibility
during modelling, and running the examples in lmer I receive this error
message:

---<---------------cut here---------------start-------------->---
R> (fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy))
Error in printMer(object) : no slot of name "status" for this object of class "table"

R> sessionInfo()
R version 2.5.1 RC (2007-06-25 r42057) 
x86_64-pc-linux-gnu 

locale:
LC_CTYPE=en_CA.UTF-8;LC_NUMERIC=C;LC_TIME=en_CA.UTF-8;LC_COLLATE=en_CA.UTF-8;LC_MONETARY=en_CA.UTF-8;LC_MESSAGES=en_CA.UTF-8;LC_PAPER=en_CA.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_CA.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "stats4"    "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[7] "methods"   "base"     

other attached packages:
       lme4      Matrix rcompletion    rcompgen     lattice    diveMove 
"0.99875-2" "0.99875-2"     "0.1-2"    "0.1-13"   "0.15-11"     "0.7-9" 
    reshape 
    "0.7.4" 
---<---------------cut here---------------end---------------->---

Since this is happening in a fresh session, and with code from examples
help file, this looks like a potential bug.  Any thoughts?


Cheers,

-- 
Seb


From Mark.Bravington at csiro.au  Thu Jun 28 01:27:22 2007
From: Mark.Bravington at csiro.au (Mark.Bravington at csiro.au)
Date: Thu, 28 Jun 2007 09:27:22 +1000
Subject: [Rd] rbind.data.frame changes
Message-ID: <D79013E40FEF254AAF0D72DFC94F274831841B@extas4-hba.tas.csiro.au>

Dear R-devel

Pre-2.5.0, 'rbind.data.frame(x,y,...)' would set the class of each
column to be the class of that column in 'x'. This has changed now,
because 'rbind.data.frame' first deletes any zero-row arguments; so if
'x' is a zero-row DF, the classes will be set to those in 'y'.

This breaks my code in a number of places, where I've created 0*N
data.frames with the correct column classes, and then subsequently added
rows, typically via 'rbind( my.df, list( col1=...))'. Typically the
issue is with unwanted conversion of characters into factors, and I've
set up the zero-row DF specifically to avoid that.

My understanding of the motivation for the change is that there were
problems with 0*0 data.frames only. But 0*(N>0) data.frames where N>0
were handled OK, I think. It therefore seems to me that the new
behaviour is undesirable for 0*(N>0), in that they are treated
differently to (M>0)*(N>0) data.frames for no very compelling reason. 

Before I go through all the code in 'mvbutils' and 'debug' to work round
this, I wanted to make sure that the change really is intentional and
"permanent". Can anyone confirm/deny this?

Thanks
Mark

Mark Bravington
CSIRO Mathematical & Information Sciences
Marine Laboratory
Castray Esplanade
Hobart 7001
TAS

ph (+61) 3 6232 5118
fax (+61) 3 6232 5012
mob (+61) 438 315 623


From bolker at zoo.ufl.edu  Thu Jun 28 02:33:53 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Wed, 27 Jun 2007 20:33:53 -0400
Subject: [Rd] navel-gazing
Message-ID: <468301F1.2010701@zoo.ufl.edu>

 
  I did some trawling on the ISI web of science,
selecting all papers citing all papers
with "R DEV COR TEAM" in the author field
(which is how ISI seems to be tagging things).
The results are interesting -- about 2400 references.
Enjoy these summaries ...

urlpref = "http://www.zoo.ufl.edu/bolker/R_isidata"
types = c("author","country","doctype","inst","lang","pubyr",
  "source","subject")
files = paste("isidat_",types,".txt",sep="")
dat = lapply(paste(urlpref,files,sep="/"),
  function(f) {
    read.table(f,quote="\"",header=TRUE,as.is=TRUE)})
tmpf = function(x) {
  x = head(x,10)
  barplot(x[,ncol(x)-1],horiz=TRUE,names.arg=x[,1],cex.names=0.8)
}
layout(matrix(c(rep(1:6,each=2),rep(7:8,each=3)),ncol=6,nrow=3,byrow=TRUE))
par(las=1,mar=c(1,7,1,1))
invisible(lapply(dat[1:6],tmpf))
par(las=1,mar=c(1,16,1,1))
invisible(lapply(dat[7:8],tmpf))


From ripley at stats.ox.ac.uk  Thu Jun 28 07:08:45 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 28 Jun 2007 06:08:45 +0100 (BST)
Subject: [Rd] error message from lmer
In-Reply-To: <87abult2ey.fsf@patagonia.sebmags.homelinux.org>
References: <87abult2ey.fsf@patagonia.sebmags.homelinux.org>
Message-ID: <Pine.LNX.4.64.0706280557300.23081@gannet.stats.ox.ac.uk>

See the thread starting

https://stat.ethz.ch/pipermail/r-devel/2007-June/046157.html
https://stat.ethz.ch/pipermail/r-devel/2007-June/046160.html

I can't reproduce this without knowing what is in your startup files: it 
should work with --vanilla, so please try that and try to eliminate 
whatever is in your .Rprofile etc that is causing the problem.

Incidentally, using rcompletion is counterproductive in R 2.5.1 RC: the 
base functionality using rcompgen is a more sophisticated version.

On Wed, 27 Jun 2007, Sebastian P. Luque wrote:

> Hi,
>
> I've begun to use the lme4 package, rather than nlme, for more flexibility
> during modelling, and running the examples in lmer I receive this error
> message:
>
> ---<---------------cut here---------------start-------------->---
> R> (fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy))
> Error in printMer(object) : no slot of name "status" for this object of class "table"
>
> R> sessionInfo()
> R version 2.5.1 RC (2007-06-25 r42057)
> x86_64-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_CA.UTF-8;LC_NUMERIC=C;LC_TIME=en_CA.UTF-8;LC_COLLATE=en_CA.UTF-8;LC_MONETARY=en_CA.UTF-8;LC_MESSAGES=en_CA.UTF-8;LC_PAPER=en_CA.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_CA.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] "stats4"    "stats"     "graphics"  "grDevices" "utils"     "datasets"
> [7] "methods"   "base"
>
> other attached packages:
>       lme4      Matrix rcompletion    rcompgen     lattice    diveMove
> "0.99875-2" "0.99875-2"     "0.1-2"    "0.1-13"   "0.15-11"     "0.7-9"
>    reshape
>    "0.7.4"
> ---<---------------cut here---------------end---------------->---
>
> Since this is happening in a fresh session, and with code from examples
> help file, this looks like a potential bug.  Any thoughts?
>
>
> Cheers,
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From xiaoning_zhang at hotmail.com  Thu Jun 28 09:55:38 2007
From: xiaoning_zhang at hotmail.com (zhangxiaoning)
Date: Thu, 28 Jun 2007 15:55:38 +0800
Subject: [Rd] Question on the R's C stack limit
Message-ID: <BAY113-W17F6B14C595F31A70DBFEBFB090@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20070628/7eae8b6e/attachment.pl 

From xiaoning_zhang at hotmail.com  Thu Jun 28 10:20:55 2007
From: xiaoning_zhang at hotmail.com (Xiaoning)
Date: Thu, 28 Jun 2007 01:20:55 -0700 (PDT)
Subject: [Rd] How to set R_CStackLimit
Message-ID: <11338977.post@talk.nabble.com>


Hi,
 
I have tried to disable stack checking by set R_CStackLimit to -1. However,
it always crashes my win32 multiple threads program. I am using R-2.5.0. My
code looks like:
 
#include <Rversion.h>
#if (R_VERSION >= R_Version(2,3,0))
#define R_INTERFACE_PTRS 1
#define CSTACK_DEFNS 1
#include <Rinterface.h> 
#endif
 
and then, add below line to my main function:
    R_CStackLimit = (uintptr_t)-1;  //crashes when step to this line.
 
As for input library in link option, I only link to Rdll.lib. Am I missing
something?
 
Thanks very much!
 
xzhang

-- 
View this message in context: http://www.nabble.com/How-to-set-R_CStackLimit-tf3993070.html#a11338977
Sent from the R devel mailing list archive at Nabble.com.


From r.hankin at noc.soton.ac.uk  Thu Jun 28 14:38:32 2007
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Thu, 28 Jun 2007 13:38:32 +0100
Subject: [Rd] signature() and setMethod() problems
Message-ID: <5EB87C76-7CEA-4C1B-930E-3C19409338D0@noc.soton.ac.uk>

I am having difficulty using signature().

I have one virtual class  (onion) and
two nonvirtual classes (quaternion and octonion).
containing onion.

I want to define three distinct sets of
arithmetic operations: one for onion-onion,
one for onion-real, and one for real-onion [this
is more computationally efficient than
coercing reals to onions and then using onion-onion
operations].

Executing the following code gives an error [R-2.5.0]
at the first call to setMethod():

Error in match.call(fun, fcall) : unused argument(s) (o1 = "onion",  
o2 = "onion")


Why is this, and what would the List suggest
is Best Practice here?





setClass("onion",
          representation = "VIRTUAL"
          )

setClass("quaternion",
          representation = representation(x="matrix"),
          prototype      = list(x=matrix(numeric(),0,4)),
          contains       = "onion"
          )

setClass("octonion",
          representation = representation(x="matrix"),
          prototype      = list(x=matrix(numeric(),0,8)),
          contains       = "onion"
          )

".onion.onion.arith" <- function(o1,o2){stop("OO not implemented")}
".onion.real.arith" <- function(o,r){stop("OR not implemented")}
".real.onion.arith" <- function(r,o){stop("RO not implemented")}

setMethod("Arith", signature 
(o1="onion",o2="onion" ), .onion.onion.arith)
setMethod("Arith", signature(o="onion",r="ANY" ), .onion.real.arith)
setMethod("Arith", signature(r="ANY",o="onion" ), .real.onion.arith)



--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From maechler at stat.math.ethz.ch  Thu Jun 28 15:07:52 2007
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 28 Jun 2007 15:07:52 +0200
Subject: [Rd] signature() and setMethod() problems
In-Reply-To: <5EB87C76-7CEA-4C1B-930E-3C19409338D0@noc.soton.ac.uk>
References: <5EB87C76-7CEA-4C1B-930E-3C19409338D0@noc.soton.ac.uk>
Message-ID: <18051.45736.205670.324365@stat.math.ethz.ch>

>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Thu, 28 Jun 2007 13:38:32 +0100 writes:

    Robin> I am having difficulty using signature().  I have one
    Robin> virtual class (onion) and two nonvirtual classes
    Robin> (quaternion and octonion).  containing onion.

    Robin> I want to define three distinct sets of arithmetic
    Robin> operations: one for onion-onion, one for onion-real,
    Robin> and one for real-onion [this is more computationally
    Robin> efficient than coercing reals to onions and then
    Robin> using onion-onion operations].

    Robin> Executing the following code gives an error [R-2.5.0]
    Robin> at the first call to setMethod():

    Robin> Error in match.call(fun, fcall) : unused argument(s)
    Robin> (o1 = "onion", o2 = "onion")

    Robin> Why is this,

you are not free to call your arguments whatever you like:
The generic function prescribes the signature,
in the case of Arith,
its  (e1, e2)

    Robin> and what would the List suggest is Best Practice here?

use the correct signature :-)

Regards,
Martin




    Robin> setClass("onion", representation = "VIRTUAL" )

    Robin> setClass("quaternion", representation =
    Robin> representation(x="matrix"), prototype =
    Robin> list(x=matrix(numeric(),0,4)), contains = "onion" )

    Robin> setClass("octonion", representation =
    Robin> representation(x="matrix"), prototype =
    Robin> list(x=matrix(numeric(),0,8)), contains = "onion" )

    Robin> ".onion.onion.arith" <- function(o1,o2){stop("OO not
    Robin> implemented")} ".onion.real.arith" <-
    Robin> function(o,r){stop("OR not implemented")}
    Robin> ".real.onion.arith" <- function(r,o){stop("RO not
    Robin> implemented")}

    Robin> setMethod("Arith", signature (o1="onion",o2="onion"
    Robin> ), .onion.onion.arith) setMethod("Arith",
    Robin> signature(o="onion",r="ANY" ), .onion.real.arith)
    Robin> setMethod("Arith", signature(r="ANY",o="onion" ),
    Robin> .real.onion.arith)



    Robin> -- Robin Hankin Uncertainty Analyst National
    Robin> Oceanography Centre, Southampton European Way,
    Robin> Southampton SO14 3ZH, UK tel 023-8059-7743

    Robin> ______________________________________________
    Robin> R-devel at r-project.org mailing list
    Robin> https://stat.ethz.ch/mailman/listinfo/r-devel


From tlumley at u.washington.edu  Thu Jun 28 16:30:14 2007
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Thu, 28 Jun 2007 07:30:14 -0700 (PDT)
Subject: [Rd] navel-gazing
In-Reply-To: <468301F1.2010701@zoo.ufl.edu>
References: <468301F1.2010701@zoo.ufl.edu>
Message-ID: <Pine.LNX.4.64.0706280728130.26323@homer21.u.washington.edu>

On Wed, 27 Jun 2007, Ben Bolker wrote:

>
>  I did some trawling on the ISI web of science,
> selecting all papers citing all papers
> with "R DEV COR TEAM" in the author field
> (which is how ISI seems to be tagging things).

It's not quite that simple. If people use the recommended citation then 
they get tagged that way, but there are several other variants in the ISI database.

 	-thomas


From ripley at stats.ox.ac.uk  Thu Jun 28 16:31:29 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 28 Jun 2007 15:31:29 +0100 (BST)
Subject: [Rd] signature() and setMethod() problems
In-Reply-To: <18051.45736.205670.324365@stat.math.ethz.ch>
References: <5EB87C76-7CEA-4C1B-930E-3C19409338D0@noc.soton.ac.uk>
	<18051.45736.205670.324365@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0706281526520.10053@gannet.stats.ox.ac.uk>

On Thu, 28 Jun 2007, Martin Maechler wrote:

>>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>>     on Thu, 28 Jun 2007 13:38:32 +0100 writes:
>
>    Robin> I am having difficulty using signature().  I have one
>    Robin> virtual class (onion) and two nonvirtual classes
>    Robin> (quaternion and octonion).  containing onion.
>
>    Robin> I want to define three distinct sets of arithmetic
>    Robin> operations: one for onion-onion, one for onion-real,
>    Robin> and one for real-onion [this is more computationally
>    Robin> efficient than coercing reals to onions and then
>    Robin> using onion-onion operations].
>
>    Robin> Executing the following code gives an error [R-2.5.0]
>    Robin> at the first call to setMethod():
>
>    Robin> Error in match.call(fun, fcall) : unused argument(s)
>    Robin> (o1 = "onion", o2 = "onion")
>
>    Robin> Why is this,
>
> you are not free to call your arguments whatever you like:
> The generic function prescribes the signature,
> in the case of Arith,
> its  (e1, e2)
>
>    Robin> and what would the List suggest is Best Practice here?
>
> use the correct signature :-)

For completeness, let me mention that in the special case of one-argument 
primitives the name in the signature is ignored, essentially because the 
name is not used by the primitive itself and so there have been different 
interpretations (e.g. `!`(x) and `!`(e1) ).  In all other cases, methods 
should agree with the generic as Martin advises.

>
> Regards,
> Martin
>
>
>
>
>    Robin> setClass("onion", representation = "VIRTUAL" )
>
>    Robin> setClass("quaternion", representation =
>    Robin> representation(x="matrix"), prototype =
>    Robin> list(x=matrix(numeric(),0,4)), contains = "onion" )
>
>    Robin> setClass("octonion", representation =
>    Robin> representation(x="matrix"), prototype =
>    Robin> list(x=matrix(numeric(),0,8)), contains = "onion" )
>
>    Robin> ".onion.onion.arith" <- function(o1,o2){stop("OO not
>    Robin> implemented")} ".onion.real.arith" <-
>    Robin> function(o,r){stop("OR not implemented")}
>    Robin> ".real.onion.arith" <- function(r,o){stop("RO not
>    Robin> implemented")}
>
>    Robin> setMethod("Arith", signature (o1="onion",o2="onion"
>    Robin> ), .onion.onion.arith) setMethod("Arith",
>    Robin> signature(o="onion",r="ANY" ), .onion.real.arith)
>    Robin> setMethod("Arith", signature(r="ANY",o="onion" ),
>    Robin> .real.onion.arith)
>
>
>
>    Robin> -- Robin Hankin Uncertainty Analyst National
>    Robin> Oceanography Centre, Southampton European Way,
>    Robin> Southampton SO14 3ZH, UK tel 023-8059-7743
>
>    Robin> ______________________________________________
>    Robin> R-devel at r-project.org mailing list
>    Robin> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From spluque at gmail.com  Thu Jun 28 20:15:28 2007
From: spluque at gmail.com (Sebastian P. Luque)
Date: Thu, 28 Jun 2007 13:15:28 -0500
Subject: [Rd] error message from lmer
References: <87abult2ey.fsf@patagonia.sebmags.homelinux.org>
	<Pine.LNX.4.64.0706280557300.23081@gannet.stats.ox.ac.uk>
Message-ID: <87ps3grlmn.fsf@patagonia.sebmags.homelinux.org>

On Thu, 28 Jun 2007 06:08:45 +0100 (BST),
Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:

> See the thread starting
> https://stat.ethz.ch/pipermail/r-devel/2007-June/046157.html
> https://stat.ethz.ch/pipermail/r-devel/2007-June/046160.html

Thank you, I think I've indeed encountered the same issue (with 'R
--vanilla').  If I load package diveMove (which depends on stats4, in my
local development version) after lme4:

---<---------------cut here---------------start-------------->---
> library(lme4)         # load lme4 first; everything ok
Loading required package: Matrix
Loading required package: lattice
> (fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy))
Linear mixed-effects model fit by REML 
Formula: Reaction ~ Days + (Days | Subject) 
   Data: sleepstudy 
  AIC  BIC logLik MLdeviance REMLdeviance
 1754 1770 -871.8       1752         1744
Random effects:
 Groups   Name        Variance Std.Dev. Corr  
 Subject  (Intercept) 610.835  24.7151        
          Days         35.056   5.9208  0.067 
 Residual             655.066  25.5943        
number of obs: 180, groups: Subject, 18

Fixed effects:
            Estimate Std. Error t value
(Intercept)  251.405      6.820   36.86
Days          10.467      1.546    6.77

Correlation of Fixed Effects:
     (Intr)
Days -0.137
> library(diveMove)     # load this now; everything ok too
Loading required package: stats4
>      (fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy))
Linear mixed-effects model fit by REML 
Formula: Reaction ~ Days + (Days | Subject) 
   Data: sleepstudy 
  AIC  BIC logLik MLdeviance REMLdeviance
 1754 1770 -871.8       1752         1744
Random effects:
 Groups   Name        Variance Std.Dev. Corr  
 Subject  (Intercept) 610.835  24.7151        
          Days         35.056   5.9208  0.067 
 Residual             655.066  25.5943        
number of obs: 180, groups: Subject, 18

Fixed effects:
            Estimate Std. Error t value
(Intercept)  251.405      6.820   36.86
Days          10.467      1.546    6.77

Correlation of Fixed Effects:
     (Intr)
Days -0.137
---<---------------cut here---------------end---------------->---


Now if diveMove is loaded before lme4 (with 'R --vanilla' again):

---<---------------cut here---------------start-------------->---
> library(diveMove)    # load diveMove first
Loading required package: stats4
> library(lme4)        # load lme4 here; error in printMer()
Loading required package: Matrix
Loading required package: lattice
> (fm1 <- lmer(Reaction ~ Days + (Days|Subject), sleepstudy))
Error in printMer(object) : no slot of name "status" for this object of class "table"
> find("summary")
[1] "package:Matrix" "package:stats4" "package:base"  
---<---------------cut here---------------end---------------->---


-- 
Seb


From ripley at stats.ox.ac.uk  Thu Jun 28 22:32:12 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 28 Jun 2007 21:32:12 +0100 (BST)
Subject: [Rd] How to set R_CStackLimit
In-Reply-To: <11338977.post@talk.nabble.com>
References: <11338977.post@talk.nabble.com>
Message-ID: <Pine.LNX.4.64.0706280943500.19736@gannet.stats.ox.ac.uk>

First, Rinterface.h is not installed on Windows, so you must be using a 
header from within the R sources.  You do so at your own peril!

R_CStackLimit is only described in a Unix-specific section of 'Writing R 
Extensions'.  The description there and Rinterface.h is designed for Unix 
compilers, not for Windows compilers.  Since R_CStackLimit is a variable 
exported from a DLL, many Windows compilers will need it declared as a 
dllimport.  You have not told us your compiler (but 'Rdll.lib' is not part 
of R and not needed for the recommended MinGW).  If (as I guess) it is 
Visual Studio, you need to heed the comments in README.packages about 
this.

On Thu, 28 Jun 2007, Xiaoning wrote:

>
> Hi,
>
> I have tried to disable stack checking by set R_CStackLimit to -1. However,
> it always crashes my win32 multiple threads program. I am using R-2.5.0. My
> code looks like:
>
> #include <Rversion.h>
> #if (R_VERSION >= R_Version(2,3,0))
> #define R_INTERFACE_PTRS 1
> #define CSTACK_DEFNS 1
> #include <Rinterface.h>
> #endif
>
> and then, add below line to my main function:
>    R_CStackLimit = (uintptr_t)-1;  //crashes when step to this line.
>
> As for input library in link option, I only link to Rdll.lib. Am I missing
> something?
>
> Thanks very much!
>
> xzhang
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Peter.Ruckdeschel at uni-bayreuth.de  Thu Jun 28 23:05:10 2007
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Thu, 28 Jun 2007 23:05:10 +0200
Subject: [Rd] minor flaw in integrate()
Message-ID: <46842286.8080402@uni-bayreuth.de>

Hi,

I noticed a minor flaw in integrate() from package stats:

Taking up arguments lower and upper from integrate(),

   if (lower ==  Inf) && (upper ==  Inf)

       or

   if (lower == -Inf) && (upper == -Inf)

integrate() calculates the value for (lower==-Inf) && (upper==Inf).

Rather, it should return 0.

Quick fix:

### old code ###
### [snip]
    else {
            if (is.na(lower) || is.na(upper))
                stop("a limit is missing")
            if (is.finite(lower)) {
                inf <- 1
                bound <- lower
            }
            else if (is.finite(upper)) {
                inf <- -1
                bound <- upper
            }
            else {
                inf <- 2
                bound <- 0
            }
            wk <- .External("call_dqagi", ff, rho = environment(),
                as.double(bound), as.integer(inf), as.double(abs.tol),
                as.double(rel.tol), limit = limit, PACKAGE = "base")
    }
### [snip]

### new code  to replace the old one ###

### [snip]
    else {
            if (is.na(lower) || is.na(upper))
                stop("a limit is missing")

            if (lower == upper){

                wk <- list("value" = 0, "abs.error" = 0,
                        "subdivisions" = subdivisions,
                        "ierr" = 0 )

            } else {
                    if (is.finite(lower)) {
                        inf <- 1
                        bound <- lower
                    }
                    else if (is.finite(upper)) {
                            inf <- -1
                        bound <- upper
                    }
                    else {
                        inf <- 2
                        bound <- 0
                    }
                    wk <- .External("call_dqagi", ff, rho = environment(),
                            as.double(bound), as.integer(inf),
                            as.double(abs.tol), as.double(rel.tol),
                            limit = limit, PACKAGE = "base")

            }
    }
### [snip]

Best, Peter


From Peter.Ruckdeschel at uni-bayreuth.de  Thu Jun 28 23:05:36 2007
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Thu, 28 Jun 2007 23:05:36 +0200
Subject: [Rd] inaccuracy in qbinom with partial argument matching
Message-ID: <468422A0.1040808@uni-bayreuth.de>

Hi,

I found the following strange effect with
qbinom & partial argument matching

p0 <- pbinom(0, size = 3, prob = 0.25)
qbinom(p0,      size = 3, prob = 0.25)  ## 0 o.k.
qbinom(p0-0.05, size = 3, prob = 0.25)  ## 0 o.k.

## positional matching:
qbinom(p0,             3,        0.25)  ## 0 o.k.

## partial argument matching:
qbinom(p0     , s = 3,    p    = 0.25)  ## 1 ???
qbinom(p0-0.05, s = 3,    p    = 0.25)  ## 1 ???
qbinom(p0-0.06, s = 3,    p    = 0.25)  ## 0 o.K.

Unfortunately I have no I idea how to fix this.

I guess however that this will happen for other
cases as well, but I have not pursued this further.

Best, Peter

platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          5.0
year           2007
month          04
day            23
svn rev        41293
language       R
version.string R version 2.5.0 (2007-04-23)


From Robert.McGehee at geodecapital.com  Fri Jun 29 00:30:39 2007
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Thu, 28 Jun 2007 18:30:39 -0400
Subject: [Rd] saving objects with embedded environments
Message-ID: <EEBC169715EB8C438D3C9283AF0F201C17C830@MSGBOSCLM2WIN.DMN1.FMR.COM>

Hello,
I have been running linear regressions on large data sets. As 'lm' saves
a great deal of extraneous (for me) data including the residuals,
fitted.values, model frame, etc., I generally set these to NULL within
the object before saving off the model to a file.

In the below example, however, I have found that depending on whether or
not I run 'lm' within another function or not, the entire function
environment is saved off with the file. So, even while object.size and
all.equal report that both 'lm's are equal and of small size, one saves
as a 24MB file and the other as 646 bytes. These seems to be because in
the first example the function environment is saved in attr(x1$terms,
".Environment") and takes up all 24MB of space.

Anyway, I think this is a bug, or if nothing else very undesirable (that
an object reported to be 0.5kb takes up 24MB). There also seems to be
some inconsistency on how environments are saved depending on if it is
the global environment or not, though I'm not familiar enough with
environments to know if this was intentional. Comments are appreciated.

Thanks,
Robert

##################################################################
testEq <- function(B) {
    x <- lm(y ~ x1+x2+x3, data=B, model=FALSE)
    x$residuals <- x$effects <- x$fitted.values <- x$qr$qr <- NULL
    x
}

N <- 900000
B <- data.frame(y=rnorm(N)+1:N, x1=rnorm(N)+1:N, x2=rnorm(N)+1:N,
x3=rnorm(N)+1:N)
x1 <- testEq(B)
x2 <- lm(y ~ x1+x2+x3, data=B, model=FALSE)
x2$residuals <- x2$effects <- x2$fitted.values <- x2$qr$qr <- NULL

all.equal(x1, x2) ## TRUE
object.size(x1)  ## 5112
object.size(x2)  ## 5112
save(x1, file="x1.RData")
save(x2, file="x2.RData")
file.info("x1.RData")$size ## 24063852 bytes
file.info("x2.RData")$size ## 646 bytes

> R.version
               _                           
platform       i686-pc-linux-gnu           
arch           i686                        
os             linux-gnu                   
system         i686, linux-gnu             
status                                     
major          2                           
minor          5.0                         
year           2007                        
month          04                          
day            23                          
svn rev        41293                       
language       R                           
version.string R version 2.5.0 (2007-04-23)


Robert McGehee, CFA
Quantitative Analyst
Geode Capital Management, LLC
One Post Office Square, 28th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com



This e-mail, and any attachments hereto, are intended for us...{{dropped}}


From s.blomberg1 at uq.edu.au  Fri Jun 29 01:39:00 2007
From: s.blomberg1 at uq.edu.au (Simon Blomberg)
Date: Fri, 29 Jun 2007 09:39:00 +1000
Subject: [Rd] navel-gazing
In-Reply-To: <Pine.LNX.4.64.0706280728130.26323@homer21.u.washington.edu>
References: <468301F1.2010701@zoo.ufl.edu>
	<Pine.LNX.4.64.0706280728130.26323@homer21.u.washington.edu>
Message-ID: <1183073940.5165.9.camel@sib-sblomber01d.sib.uq.edu.au>

Also, for completeness you could add in the citation to Ihaka and
Gentleman (1996). Otherwise it looks like nothing was happening before
2004.

Cheers,

Simon.

On Thu, 2007-06-28 at 07:30 -0700, Thomas Lumley wrote:
> On Wed, 27 Jun 2007, Ben Bolker wrote:
> 
> >
> >  I did some trawling on the ISI web of science,
> > selecting all papers citing all papers
> > with "R DEV COR TEAM" in the author field
> > (which is how ISI seems to be tagging things).
> 
> It's not quite that simple. If people use the recommended citation then 
> they get tagged that way, but there are several other variants in the ISI database.
> 
>  	-thomas
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Simon Blomberg, BSc (Hons), PhD, MAppStat. 
Lecturer and Consultant Statistician 
Faculty of Biological and Chemical Sciences 
The University of Queensland 
St. Lucia Queensland 4072 
Australia

Room 320, Goddard Building (8)
T: +61 7 3365 2506 
email: S.Blomberg1_at_uq.edu.au 

The combination of some data and an aching desire for 
an answer does not ensure that a reasonable answer can 
be extracted from a given body of data. - John Tukey.


From ripley at stats.ox.ac.uk  Fri Jun 29 08:03:32 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 29 Jun 2007 07:03:32 +0100 (BST)
Subject: [Rd] inaccuracy in qbinom with partial argument matching
In-Reply-To: <468422A0.1040808@uni-bayreuth.de>
References: <468422A0.1040808@uni-bayreuth.de>
Message-ID: <Pine.LNX.4.64.0706290701540.30346@gannet.stats.ox.ac.uk>

On Thu, 28 Jun 2007, Peter Ruckdeschel wrote:

> Hi,
>
> I found the following strange effect with
> qbinom & partial argument matching
>
> p0 <- pbinom(0, size = 3, prob = 0.25)
> qbinom(p0,      size = 3, prob = 0.25)  ## 0 o.k.
> qbinom(p0-0.05, size = 3, prob = 0.25)  ## 0 o.k.
>
> ## positional matching:
> qbinom(p0,             3,        0.25)  ## 0 o.k.
>
> ## partial argument matching:
> qbinom(p0     , s = 3,    p    = 0.25)  ## 1 ???
> qbinom(p0-0.05, s = 3,    p    = 0.25)  ## 1 ???
> qbinom(p0-0.06, s = 3,    p    = 0.25)  ## 0 o.K.
>
> Unfortunately I have no I idea how to fix this.

You use a call that specifies your intentions accurately.  This is not 
'partial argument matching': 'p' is an exact match to the first argument 
of

> args(qbinom)
function (p, size, prob, lower.tail = TRUE, log.p = FALSE)

and that is how argument matching in R is documented to work.

The 'inaccuracy' is in the diagnosis: please see the FAQ.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From savicky at cs.cas.cz  Fri Jun 29 11:04:06 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Fri, 29 Jun 2007 11:04:06 +0200
Subject: [Rd] inaccuracy in qbinom with partial argument matching
In-Reply-To: <Pine.LNX.4.64.0706290701540.30346@gannet.stats.ox.ac.uk>
References: <468422A0.1040808@uni-bayreuth.de>
	<Pine.LNX.4.64.0706290701540.30346@gannet.stats.ox.ac.uk>
Message-ID: <20070629090405.GA8425@cs.cas.cz>

> > ## partial argument matching:
> > qbinom(p0     , s = 3,    p    = 0.25)  ## 1 ???
> > qbinom(p0-0.05, s = 3,    p    = 0.25)  ## 1 ???
> > qbinom(p0-0.06, s = 3,    p    = 0.25)  ## 0 o.K.
> >
> > Unfortunately I have no I idea how to fix this.
> 
> You use a call that specifies your intentions accurately.  This is not 
> 'partial argument matching': 'p' is an exact match to the first argument 
> of
> 
> > args(qbinom)
> function (p, size, prob, lower.tail = TRUE, log.p = FALSE)
> 
> and that is how argument matching in R is documented to work.
> 
> The 'inaccuracy' is in the diagnosis: please see the FAQ.
 
Let me add an explanation, why
  qbinom(p0     , s = 3,    p    = 0.25)
does not produce an error message about missing "prob" argument:
Since "size" and "p" arguments are given, p0 is used for
the third argument and not for the first.

Although the behavior is logical, it may not be immediately clear.
I do not see this case explicitly in FAQ or R-intro.pdf 10.3.

Petr.


From Peter.Ruckdeschel at uni-bayreuth.de  Fri Jun 29 12:06:41 2007
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Fri, 29 Jun 2007 12:06:41 +0200
Subject: [Rd] inaccuracy in qbinom with partial argument matching
Message-ID: <4684D9B1.6000803@uni-bayreuth.de>

Petr Savicky wrote:
> Brian Ripley wrote:
>> I wrote:
>> > ## partial argument matching:
>> > qbinom(p0     , s = 3,    p    = 0.25)  ## 1 ???
>> > qbinom(p0-0.05, s = 3,    p    = 0.25)  ## 1 ???
>> > qbinom(p0-0.06, s = 3,    p    = 0.25)  ## 0 o.K.
>> >
>> > Unfortunately I have no I idea how to fix this.
>> 
>> You use a call that specifies your intentions accurately.  This is not 
>> 'partial argument matching': 'p' is an exact match to the first argument 
>> of
>> 
>> > args(qbinom)
>> function (p, size, prob, lower.tail = TRUE, log.p = FALSE)
>> 
>> and that is how argument matching in R is documented to work.
>> 
>> The 'inaccuracy' is in the diagnosis: please see the FAQ.
>  
> Let me add an explanation, why
>   qbinom(p0     , s = 3,    p    = 0.25)
> does not produce an error message about missing "prob" argument:
> Since "size" and "p" arguments are given, p0 is used for
> the third argument and not for the first.
> 
> Although the behavior is logical, it may not be immediately clear.
> I do not see this case explicitly in FAQ or R-intro.pdf 10.3.

To close this thread:
First thanks to Brian and Petr for their explanation ---and to Petr
for defending me.

But I think, Brian was right, it was my fault not to see that qbinom's
first argument 'p' was matched against my abbreviated 'prob' argument
0.25, which is ---I think--- the reason for Brian's
"please see the FAQ"...

Although not itself an FAQ nor in the R-intro manual, argument matching
is completely & clearly described in

   http://cran.r-project.org/doc/manuals/R-lang.html#Argument-matching

In fact my code is a badly chosen example:

I am working on automatically generated q-, (and r,d,p)- functions,
so left continuity of q<>-fct.'s is an issue.
Unfortunately numbers p0 and .25 are so close together that they gave
results only differing by 1 when interchanged, so I was led to the
conclusion that it was a left-continuity-issue of qbinom with partial
matched arguments which it was obviously not ---sorry for bothering
you.

As a conclusion which may be worth noting for other occasions as well:

    Be careful with partial argument matching !

Best, Peter


From agalecki at umich.edu  Fri Jun 29 01:18:25 2007
From: agalecki at umich.edu (agalecki at umich.edu)
Date: Fri, 29 Jun 2007 01:18:25 +0200 (CEST)
Subject: [Rd] Bug in varIdent (nlme package) (PR#9765)
Message-ID: <20070628231825.AE5946599A@slim.kubism.ku.dk>

This is a multi-part message in MIME format.
--------------000706080709050507050106
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hello,

1. The following code (below) and output  <varIdentOutput.txt> 
illustrate that
argument fixed= in varIdent function is ignored during the execution.

2. File named <RevisedvarIdent.txt> shows how to fix the problem.
The  changed line in this file  is labeled  using  comment " # !!! This 
line changed".

Thank you

Andrzej Galecki


###  Code used for illustration starts here  ####
library(nlme)
sessionInfo()

Orth <- subset(Orthodont, Subject %in% c("M01","F01"))
# Argument fixed in varIdent is ignored
vf1.incorrect  <- varIdent(form=~1|Sex,fixed=c(Female=0.5))
vf1I <- Initialize(vf1.incorrect, data=Orth)
varWeights(vf1I)

# Tentative varIdent function (revised)
source("C:/temp/RevisedvarIdent.txt")

vf2.correct  <- varIdent(form=~1|Sex,fixed=c(Female=0.5))
vf2I <- Initialize(vf2.correct, data=Orth)
coef(vf2I)
varWeights(vf2I)
# rm(varIdent)  # Remove tentative varIdent function

###  Code ends here  ####


--------------000706080709050507050106
Content-Type: text/plain;
 name="RevisedvarIdent.txt"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="RevisedvarIdent.txt"

varIdent <-
function (value = numeric(0), form = ~1, fixed = NULL) 
{
    if (is.null(getGroupsFormula(form))) {
        value <- numeric(0)
        attr(value, "fixed") <- NULL
    }
    else {
        if ((lv <- length(value)) > 0) {
            if (is.null(grpNames <- names(value)) && (lv > 1)) {
                stop("Initial values must have group names in varIdent")
            }
            value <- unlist(value)
            if (any(value <= 0)) {
                stop("Initial values for \"varIdent\" must be > 0.")
            }
            value <- log(value)
        }
        else grpNames <- NULL
        attr(value, "groupNames") <- grpNames
        if (!is.null(fixed)) {       # !!! This line changed
            fix <- attr(value, "fixed") <- log(unlist(fixed))
            if (is.null(fixNames <- names(fix))) {
                stop("Fixed parameters must have names in varIdent")
            }
            if (!is.null(attr(value, "groupNames"))) {
                attr(value, "groupNames") <- c(attr(value, "groupNames"), 
                  fixNames)
            }
        }
    }
    attr(value, "formula") <- asOneSidedFormula(form)
    class(value) <- c("varIdent", "varFunc")
    value
}


--------------000706080709050507050106
Content-Type: text/plain;
 name="varIdentOutput.txt"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="varIdentOutput.txt"

> library(nlme)
> sessionInfo()
R version 2.5.0 (2007-04-23) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[7] "base"     

other attached packages:
    nlme 
"3.1-80" 
> 


> # Argument fixed in varIdent is ignored
> Orth <- subset(Orthodont, Subject %in% c("M01","F01"))
> # Argument fixed in varIdent is ignored
> vf1.incorrect  <- varIdent(form=~1|Sex,fixed=c(Female=0.5))
> vf1I <- Initialize(vf1.incorrect, data=Orth)
> varWeights(vf1I)
  Male   Male   Male   Male Female Female Female Female 
     1      1      1      1      1      1      1      1 
> 


> # Tentative varIdent function (revised)
> source("C:/temp/RevisedvarIdent.txt")
> 
> vf2.correct  <- varIdent(form=~1|Sex,fixed=c(Female=0.5))
> vf2I <- Initialize(vf2.correct, data=Orth)
> varWeights(vf2I)
  Male   Male   Male   Male Female Female Female Female 
     1      1      1      1      2      2      2      2 
> rm(varIdent)  # Remove tentative varIdent function











--------------000706080709050507050106--


From sneumann at pubhealth.ku.dk  Fri Jun 29 13:53:33 2007
From: sneumann at pubhealth.ku.dk (sneumann at pubhealth.ku.dk)
Date: Fri, 29 Jun 2007 13:53:33 +0200 (CEST)
Subject: [Rd] R CMD build with mingw and msys (PR#9766)
Message-ID: <20070629115333.7407D2478B@slim.kubism.ku.dk>

Full_Name: Steffen
Version: 2-5-0
OS: Windows
Submission from: (NULL) (192.124.243.162)


Hi,

the R CMD build script is using 

    if($WINDOWS) {
        ## workaround for paths in Cygwin tar
        $filepath =~ s+^([A-Za-z]):+/cygdrive/\1+;
    }

which does not work if the build environment is a MINGW.
I have added the patch below, 

Yours,
Steffen

$ diff -u build build.orig 
--- build       Fri Jun 29 13:50:16 2007
+++ build.orig  Fri Jun 29 08:51:48 2007
@@ -47,7 +47,6 @@
 R::Vars::error("R_HOME", "R_EXE");
 
 my $WINDOWS = ($R::Vars::OSTYPE eq "windows");
-my $MSYS = ( $ENV{OSTYPE} eq "msys" ); 
 
 my @exclude_patterns = R::Utils::get_exclude_patterns();
 
@@ -222,14 +221,10 @@
     my $filepath = &file_path($startdir, $filename);
     ## under Windows, need separate Cygwin and Windows versions of path.
     my $origfilepath = $filepath;
-    if ($MSYS) {
-               ## different workwaround for MSYS
-               $filepath =~ s+^([A-Za-z]):+/\1/+;
-    } elsif ($WINDOWS) {
-               ## workaround for paths in Cygwin tar
-               $filepath =~ s+^([A-Za-z]):+/cygdrive/\1+;
+    if($WINDOWS) {
+       ## workaround for paths in Cygwin tar
+       $filepath =~ s+^([A-Za-z]):+/cygdrive/\1+;
     }
-       
     R_system(join(" ",
                  ("$tar chf",
                   &shell_quote_file_path($filepath),


From bolker at zoo.ufl.edu  Fri Jun 29 23:29:36 2007
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Fri, 29 Jun 2007 17:29:36 -0400
Subject: [Rd] sweep sanity checking?
Message-ID: <468579C0.7090809@zoo.ufl.edu>


  A friend of mine just got bitten by the fact that
sweep() will happily sweep out a STATS vector
of an arbitrary length -- even one whose length
is not a divisor of any of the margins -- without
complaining.  I know the answer to this could
be "well just don't do that", but it's easy to make
a mistake in which margin you're sweeping ...

  What would R-core think of the following 'enhanced'
sweep?  It always warns if dim(x)[MARGIN] is
not a multiple of length(STATS) {it's very hard indeed
for me to think of a situation where you'd actually
want this}; if check.margin=TRUE it is a bit stricter,
complaining whenever dim(x)[MARGIN] doesn't
match length(STATS).

  This change seems fairly harmless since it never does anything
more than warn; the default for check.margin could
be FALSE if you wanted to allow people a bit more rope
to hang themselves with ...  (of course this won't prevent
you from sweeping the wrong margin of a square matrix,
but nothing will).

  cheers
    Ben Bolker

sweep <- function (x, MARGIN, STATS, FUN = "-", check.margin=TRUE, ...)
{
    FUN <- match.fun(FUN)
    dims <- dim(x)
    if (check.margin && dims[MARGIN]!=length(STATS)) {
      warning("length(STATS) != dim(x)[MARGIN]")
    } else if (dims[MARGIN] %% length(STATS)!=0)
      warning("dim(x)[MARGIN] is not a multiple of length(STATS)")
    perm <- c(MARGIN, (1:length(dims))[-MARGIN])
    FUN(x, aperm(array(STATS, dims[perm]), order(perm)), ...)
  }


From rdpeng at gmail.com  Sat Jun 30 01:44:28 2007
From: rdpeng at gmail.com (Roger Peng)
Date: Fri, 29 Jun 2007 19:44:28 -0400
Subject: [Rd] saving objects with embedded environments
In-Reply-To: <EEBC169715EB8C438D3C9283AF0F201C17C830@MSGBOSCLM2WIN.DMN1.FMR.COM>
References: <EEBC169715EB8C438D3C9283AF0F201C17C830@MSGBOSCLM2WIN.DMN1.FMR.COM>
Message-ID: <66f3bd910706291644s6db3b3a9ncd1bd075ceec3553@mail.gmail.com>

I believe this is intentional.  See ?serialize.  When lm() is called
in a function, the environment is saved in case the resulting fitted
model object needs to be updated, for example, with update().

if you don't want the linear model object, you might try just saving
the relevant objects to a separate list rather than try to delete
everything that is irrelevant from the 'lm' object.

-roger

On 6/28/07, McGehee, Robert <Robert.McGehee at geodecapital.com> wrote:
> Hello,
> I have been running linear regressions on large data sets. As 'lm' saves
> a great deal of extraneous (for me) data including the residuals,
> fitted.values, model frame, etc., I generally set these to NULL within
> the object before saving off the model to a file.
>
> In the below example, however, I have found that depending on whether or
> not I run 'lm' within another function or not, the entire function
> environment is saved off with the file. So, even while object.size and
> all.equal report that both 'lm's are equal and of small size, one saves
> as a 24MB file and the other as 646 bytes. These seems to be because in
> the first example the function environment is saved in attr(x1$terms,
> ".Environment") and takes up all 24MB of space.
>
> Anyway, I think this is a bug, or if nothing else very undesirable (that
> an object reported to be 0.5kb takes up 24MB). There also seems to be
> some inconsistency on how environments are saved depending on if it is
> the global environment or not, though I'm not familiar enough with
> environments to know if this was intentional. Comments are appreciated.
>
> Thanks,
> Robert
>
> ##################################################################
> testEq <- function(B) {
>     x <- lm(y ~ x1+x2+x3, data=B, model=FALSE)
>     x$residuals <- x$effects <- x$fitted.values <- x$qr$qr <- NULL
>     x
> }
>
> N <- 900000
> B <- data.frame(y=rnorm(N)+1:N, x1=rnorm(N)+1:N, x2=rnorm(N)+1:N,
> x3=rnorm(N)+1:N)
> x1 <- testEq(B)
> x2 <- lm(y ~ x1+x2+x3, data=B, model=FALSE)
> x2$residuals <- x2$effects <- x2$fitted.values <- x2$qr$qr <- NULL
>
> all.equal(x1, x2) ## TRUE
> object.size(x1)  ## 5112
> object.size(x2)  ## 5112
> save(x1, file="x1.RData")
> save(x2, file="x2.RData")
> file.info("x1.RData")$size ## 24063852 bytes
> file.info("x2.RData")$size ## 646 bytes
>
> > R.version
>                _
> platform       i686-pc-linux-gnu
> arch           i686
> os             linux-gnu
> system         i686, linux-gnu
> status
> major          2
> minor          5.0
> year           2007
> month          04
> day            23
> svn rev        41293
> language       R
> version.string R version 2.5.0 (2007-04-23)
>
>
> Robert McGehee, CFA
> Quantitative Analyst
> Geode Capital Management, LLC
> One Post Office Square, 28th Floor | Boston, MA | 02109
> Tel: 617/392-8396    Fax:617/476-6389
> mailto:robert.mcgehee at geodecapital.com
>
>
>
> This e-mail, and any attachments hereto, are intended for us...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From rfrancois at mango-solutions.com  Sat Jun 30 02:12:50 2007
From: rfrancois at mango-solutions.com (Romain Francois)
Date: Sat, 30 Jun 2007 01:12:50 +0100
Subject: [Rd] graphic for the R profiler
Message-ID: <4685A002.7010002@mango-solutions.com>

Hello all,

I just wanted to share a small perl script that generates a dot file 
from the result of the R profiler. The dot file can than be used to 
create a graphical display of the profiling.  You can save this file in 
the bin directory of your R installation and then create a graph, for 
example an SVG by piping the output of the script to dot:

$ R CMD Rprof2dot Rprof.out | dot -Tsvg > test3.svg

Some example graphics are presented in the R wiki here: 
http://wiki.r-project.org/rwiki/doku.php?id=tips:misc:profiling

Cheers,

Romain

<code perl>

#! /usr/bin/perl
 
use Getopt::Long;
 
my $cutoff=5;
GetOptions ('cutoff=s' => \$cutoff );
 
%calltree = ();
%allfun = ();
 
while (<>) {
  if (/^sample\.interval=/) {
  	s <http://www.perldoc.com/perl5.6/pod/func/s.html>/sample\.interval=//;
  	$sample = $_ / 1e6;
  } else {
	  chomp <http://www.perldoc.com/perl5.6/pod/func/chomp.html>;
	  @line = reverse <http://www.perldoc.com/perl5.6/pod/func/reverse.html> split <http://www.perldoc.com/perl5.6/pod/func/split.html>(/ /);
	  
    $caller = shift <http://www.perldoc.com/perl5.6/pod/func/shift.html>(@line);
    $allfun{$caller}++;
    while( $called = shift <http://www.perldoc.com/perl5.6/pod/func/shift.html>(@line) ){
      $allfun{$called}++;
      $calltree{$caller}{$called} ++ ;
      $caller = $called;
    }
    
  }
}
 
print <http://www.perldoc.com/perl5.6/pod/func/print.html> "digraph {\n" ;
print <http://www.perldoc.com/perl5.6/pod/func/print.html> 'graph [ rankdir = "LR"]; '."\n";
foreach $fun (keys <http://www.perldoc.com/perl5.6/pod/func/keys.html> %allfun){
  $_ = $fun;
  s <http://www.perldoc.com/perl5.6/pod/func/s.html>/"$//;
  $value = $allfun{$fun} ;
  print "$fun [shape=rect,fontsize=6,label=$_\\n(".$value.")\"] \n" if $value > ($cutoff-1) ;
}
  
foreach $caller (keys <http://www.perldoc.com/perl5.6/pod/func/keys.html> %calltree){
  for $called ( keys <http://www.perldoc.com/perl5.6/pod/func/keys.html> %{ $calltree{$caller} } ) {
    $value = $calltree{$caller}{$called} ;
    $n1 = $allfun{$called} ;
    $n2 = $allfun{$caller} ;
    
    print <http://www.perldoc.com/perl5.6/pod/func/print.html> " $caller -> $called [label=" . $value. ",fontsize=6]\n" if ( $value > $cutoff );

  }
}
print <http://www.perldoc.com/perl5.6/pod/func/print.html> "}\n

</code>

-- 
Mango Solutions
data analysis that delivers

Tel:  +44(0) 1249 467 467
Fax:  +44(0) 1249 467 468
Mob:  +44(0) 7813 526 123


From rfrancois at mango-solutions.com  Sat Jun 30 08:07:44 2007
From: rfrancois at mango-solutions.com (Romain Francois)
Date: Sat, 30 Jun 2007 07:07:44 +0100
Subject: [Rd] graphic for the R profiler
Message-ID: <4685F330.7090403@mango-solutions.com>

((resent without the generated links, thanks Dirk))

Hello all,

I just wanted to share a small perl script that generates a dot file
from the result of the R profiler. The dot file can than be used to
create a graphical display of the profiling.  You can save this file in
the bin directory of your R installation and then create a graph, for
example an SVG by piping the output of the script to dot:

$ R CMD Rprof2dot Rprof.out | dot -Tsvg > test3.svg

Some example graphics are presented in the R wiki here:
http://wiki.r-project.org/rwiki/doku.php?id=tips:misc:profiling

Cheers,

Romain

<code perl>
#! /usr/bin/perl

use Getopt::Long;

my $cutoff=5;
GetOptions ('cutoff=s' => \$cutoff );

%calltree = ();
%allfun = ();

while (<>) {
   if (/^sample\.interval=/) {
   	s/sample\.interval=//;
   	$sample = $_ / 1e6;
   } else {
	  chomp;
	  @line = reverse split(/ /);
	
     $caller = shift(@line);
     $allfun{$caller}++;
     while( $called = shift(@line) ){
       $allfun{$called}++;
       $calltree{$caller}{$called} ++ ;
       $caller = $called;
     }

   }
}

print "digraph {\n" ;
print 'graph [ rankdir = "LR"]; '."\n";
foreach $fun (keys %allfun){
   $_ = $fun;
   s/"$//;
   $value = $allfun{$fun} ;
   print "$fun [shape=rect,fontsize=6,label=$_\\n(".$value.")\"] \n" if 
$value > ($cutoff-1) ;
}

foreach $caller (keys %calltree){
   for $called ( keys %{ $calltree{$caller} } ) {
     $value = $calltree{$caller}{$called} ;
     $n1 = $allfun{$called} ;
     $n2 = $allfun{$caller} ;

     print " $caller -> $called [label=" . $value. ",fontsize=6]\n" if ( 
$value > $cutoff );
   }
}
print "}\n"
</code>



-- 
Mango Solutions
data analysis that delivers

Tel:  +44(0) 1249 467 467
Fax:  +44(0) 1249 467 468
Mob:  +44(0) 7813 526 123


From savicky at cs.cas.cz  Sat Jun 30 13:32:34 2007
From: savicky at cs.cas.cz (Petr Savicky)
Date: Sat, 30 Jun 2007 13:32:34 +0200
Subject: [Rd] make check for 2.5.1 RC fails on mbcsToSbcs in graphics
In-Reply-To: <Pine.LNX.4.64.0706271544050.15363@auk.stats>
References: <20070627132826.GB12244@cs.cas.cz>
	<Pine.LNX.4.64.0706271442360.6441@gannet.stats.ox.ac.uk>
	<46827388.6020706@biostat.ku.dk>
	<Pine.LNX.4.64.0706271544050.15363@auk.stats>
Message-ID: <20070630113233.GA2273@cs.cas.cz>

On Wed, Jun 27, 2007 at 04:20:39PM +0100, Prof Brian Ripley wrote:
> But you can't really avoid it if you want to test non-ASCII
> features: for example, you cannot test Latin-1 graphics in a C locale.
> 
> It was intended that the postscript device opened for testing graphics was 
> opened with encoding="ISOLatin1".  That should certainly have helped, at 
> least in a UTF-8 locale, but unfortunately there were a couple of typos in 
> tests/Examples/Makefile.  Fixing that file makes 'make check' work in 
> cs_CZ.utf8 at least on my machine.
> 
> It still remains that (for examples) you cannot successfully run make 
> check in a MBCS locale without iconv, nor will zh_CN.gbk nor zh_TW.big5 
> work.  I've added a note to R-admin to say that you may need to try a 
> suitable locale.

I applied the following patch obtained by comparing R-devel_2007-06-26 and R-devel_2007-06-27

--- D070626/R-devel/tests/Examples/Makefile.in	2007-05-10 17:50:54.000000000 +0200
+++ D070627/R-devel/tests/Examples/Makefile.in	2007-06-27 17:50:09.000000000 +0200
@@ -82,8 +82,8 @@
 	@if test -f $@; then mv $@ $@.prev; fi
 	@echo $(ECHO_N) "running code in '$<' ...$(ECHO_C)"
 	@echo 'tools:::.convert_examples("graphics-Ex.R", "graphics-Ex.R-locale", "latin1")' | $(R) --slave > /dev/null 2>&1 || exit 1
-	@sed -e 's/grDevices::postscript("graphics-Ex.ps")/grDevices::postscript("graphics-Ex.ps",encoding="ISOlatin1")/' graphics-Ex.R-locale \
-	  | $(R) < graphics-Ex.R-locale  > $@ 2>&1 || (mv $@ $@.fail && exit 1)
+	@sed -e 's/grDevices::postscript("graphics-Ex.ps")/grDevices::postscript("graphics-Ex.ps",encoding="ISOLatin1")/' graphics-Ex.R-locale \
+	  | $(R) > $@ 2>&1 || (mv $@ $@.fail && exit 1)
 	@rm graphics-Ex.R-locale
 	@echo "$(ECHO_T) OK"
 	@if test -f $@.prev; then \

to my copy of R-2.5.1. Then, make check works with no error in cs_CZ.UTF-8 locale
also on my machine. Thank you for the correction.

Petr.


From automorphism at gmail.com  Fri Jun 29 22:55:10 2007
From: automorphism at gmail.com (automorphism at gmail.com)
Date: Fri, 29 Jun 2007 22:55:10 +0200 (CEST)
Subject: [Rd] Shapiro Test P Value Incorrect? (PR#9768)
Message-ID: <20070629205510.2D14529D52@slim.kubism.ku.dk>

Full_Name: Jason Polak
Version: R version 2.5.0 (2007-04-23)
OS: Xubuntu 7.04
Submission from: (NULL) (137.122.144.35)


Dear R group,

I have noticed a strange anomaly with the shapiro.test() function. Unfortunately
I do not know how to calculate the shapiro test P values manually so I don't
know if this is an actual bug.

So, to produce the results, run the following code:

pvalues = 0;
for (i in 1:17)
{
	j = 1:(i+3);
	pvalues[i]=shapiro.test(j)$p;
}

plot(pvalues);
print(pvalues);

Now I just made the graph to illustrate that the p-values are strictly
decreasing. To me this makes intuitive sense: we are using the Shapiro test to
test normality of (1,2,3,4),(1,2,3,4,5), and so on. So the p-value should
decrease.

These are the p-values:
 [1] 0.9718776 0.9671740 0.9605557 0.9492892 0.9331653 0.9135602 0.8923668
 [8] 0.8698419 0.8757315 0.8371814 0.7964400 0.7545289 0.7123167 0.6704457
[15] 0.6294307 0.5896464 0.5513749

However, there is an increase in p-value when you go from (1,..,11) to
(1,..,12). Is this just a quirk of the Shapiro test, or is there an error in the
calculation algorithm?


From ripley at stats.ox.ac.uk  Sat Jun 30 15:16:38 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 30 Jun 2007 14:16:38 +0100 (BST)
Subject: [Rd] make check for 2.5.1 RC fails on mbcsToSbcs in graphics
In-Reply-To: <20070630113233.GA2273@cs.cas.cz>
References: <20070627132826.GB12244@cs.cas.cz>
	<Pine.LNX.4.64.0706271442360.6441@gannet.stats.ox.ac.uk>
	<46827388.6020706@biostat.ku.dk>
	<Pine.LNX.4.64.0706271544050.15363@auk.stats>
	<20070630113233.GA2273@cs.cas.cz>
Message-ID: <Pine.LNX.4.64.0706301416230.17524@gannet.stats.ox.ac.uk>

But, this is already dealt with in 2.5.1 patched ...

On Sat, 30 Jun 2007, Petr Savicky wrote:

> On Wed, Jun 27, 2007 at 04:20:39PM +0100, Prof Brian Ripley wrote:
>> But you can't really avoid it if you want to test non-ASCII
>> features: for example, you cannot test Latin-1 graphics in a C locale.
>>
>> It was intended that the postscript device opened for testing graphics was
>> opened with encoding="ISOLatin1".  That should certainly have helped, at
>> least in a UTF-8 locale, but unfortunately there were a couple of typos in
>> tests/Examples/Makefile.  Fixing that file makes 'make check' work in
>> cs_CZ.utf8 at least on my machine.
>>
>> It still remains that (for examples) you cannot successfully run make
>> check in a MBCS locale without iconv, nor will zh_CN.gbk nor zh_TW.big5
>> work.  I've added a note to R-admin to say that you may need to try a
>> suitable locale.
>
> I applied the following patch obtained by comparing R-devel_2007-06-26 and R-devel_2007-06-27
>
> --- D070626/R-devel/tests/Examples/Makefile.in	2007-05-10 17:50:54.000000000 +0200
> +++ D070627/R-devel/tests/Examples/Makefile.in	2007-06-27 17:50:09.000000000 +0200
> @@ -82,8 +82,8 @@
> 	@if test -f $@; then mv $@ $@.prev; fi
> 	@echo $(ECHO_N) "running code in '$<' ...$(ECHO_C)"
> 	@echo 'tools:::.convert_examples("graphics-Ex.R", "graphics-Ex.R-locale", "latin1")' | $(R) --slave > /dev/null 2>&1 || exit 1
> -	@sed -e 's/grDevices::postscript("graphics-Ex.ps")/grDevices::postscript("graphics-Ex.ps",encoding="ISOlatin1")/' graphics-Ex.R-locale \
> -	  | $(R) < graphics-Ex.R-locale  > $@ 2>&1 || (mv $@ $@.fail && exit 1)
> +	@sed -e 's/grDevices::postscript("graphics-Ex.ps")/grDevices::postscript("graphics-Ex.ps",encoding="ISOLatin1")/' graphics-Ex.R-locale \
> +	  | $(R) > $@ 2>&1 || (mv $@ $@.fail && exit 1)
> 	@rm graphics-Ex.R-locale
> 	@echo "$(ECHO_T) OK"
> 	@if test -f $@.prev; then \
>
> to my copy of R-2.5.1. Then, make check works with no error in cs_CZ.UTF-8 locale
> also on my machine. Thank you for the correction.
>
> Petr.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bates at stat.wisc.edu  Sat Jun 30 17:13:44 2007
From: bates at stat.wisc.edu (Douglas Bates)
Date: Sat, 30 Jun 2007 10:13:44 -0500
Subject: [Rd] GPL 3 has been released
Message-ID: <40e66e0b0706300813m6b12f0detf2f623f8e3c90d9e@mail.gmail.com>

Version 3 of the GNU Public License (GPL) has been released.  A ZDNet
article about it can be found at

http://news.zdnet.com/2100-3513_22-6194139.html?part=rss&tag=feed&subj=zdnn


