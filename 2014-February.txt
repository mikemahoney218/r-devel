From i.costigan at me.com  Sat Feb  1 04:14:02 2014
From: i.costigan at me.com (Imanuel Costigan)
Date: Sat, 01 Feb 2014 03:14:02 +0000 (GMT)
Subject: [Rd] Running examples with R5 constructor from package failing
Message-ID: <f8ca6be3-14d2-4c71-b07f-6190f853eedf@me.com>

I am having an issue with reference classes (R5) in a package I am developing. They have both been illustrated in the `roxygentest` package I've got hosted on Github [1].?

When I run `R CMD check .` on the source directory of my package I am told that:
> Error: could not find function "Blob"

However, when I install and load the package, I can successfully run the command in the example.?

Does someone know why this is happening?

The relevant definitions and the example (in Rd format):

R5 definition:
```
draw.Blob <- function (type = 'small')?
{
? 'Something about blobs'
? type <<- 'small'
}

Blob <- setRefClass (
? Class = "Blob",?
? fields = list(type = 'character'),
? methods = list(draw = draw.Blob)
)
```

Example:
```
\examples{
Blob(type = 'small')
}
```

Cheers

[1]?https://github.com/imanuelcostigan/roxygentest

From murdoch.duncan at gmail.com  Sat Feb  1 14:57:45 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 01 Feb 2014 08:57:45 -0500
Subject: [Rd] Running examples with R5 constructor from package failing
In-Reply-To: <f8ca6be3-14d2-4c71-b07f-6190f853eedf@me.com>
References: <f8ca6be3-14d2-4c71-b07f-6190f853eedf@me.com>
Message-ID: <52ECFD59.6020302@gmail.com>

On 14-01-31 10:14 PM, Imanuel Costigan wrote:> I am having an issue with 
reference classes (R5) in a package I am developing. They have both been 
illustrated in the `roxygentest` package I've got hosted on Github [1].
 >
 > When I run `R CMD check .` on the source directory of my package I am 
told that:
 >> Error: could not find function "Blob"
 >
 > However, when I install and load the package, I can successfully run 
the command in the example.
 >
 > Does someone know why this is happening?
 >
 > The relevant definitions and the example (in Rd format):
 >
 > R5 definition:
 > ```
 > draw.Blob <- function (type = 'small')
 > {
 >    'Something about blobs'
 >    type <<- 'small'
 > }
 >
 > Blob <- setRefClass (
 >    Class = "Blob",
 >    fields = list(type = 'character'),
 >    methods = list(draw = draw.Blob)
 > )
 > ```
 >
 > Example:
 > ```
 > \examples{
 > Blob(type = 'small')
 > }
 > ```

The symptoms make it look as though the *function* Blob is not exported. 
  I see in your source that you do export the *class* Blob, but the docs 
don't make it clear to me that this also implies export of the generator 
function.

So I'd add

export(Blob)

to your NAMESPACE.  I just checked another package that exports a class, 
and it separately exported the generator function, so I guess this is known.

Duncan Murdoch


From i.costigan at me.com  Sat Feb  1 22:21:10 2014
From: i.costigan at me.com (Imanuel Costigan)
Date: Sat, 01 Feb 2014 21:21:10 +0000 (GMT)
Subject: [Rd] Running examples with R5 constructor from package failing
In-Reply-To: <52ECFD59.6020302@gmail.com>
Message-ID: <7cfabe1a-b9ad-4d0e-a0c6-f3e31b3059dc@me.com>

You referred to another package that exports an R5 class. Which one?

Thanks for your help.

On 02 Feb, 2014,at 12:57 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:

On 14-01-31 10:14 PM, Imanuel Costigan wrote:> I am having an issue with 
reference classes (R5) in a package I am developing. They have both been 
illustrated in the `roxygentest` package I've got hosted on Github [1].
>
> When I run `R CMD check .` on the source directory of my package I am 
told that:
>> Error: could not find function "Blob"
>
> However, when I install and load the package, I can successfully run 
the command in the example.
>
> Does someone know why this is happening?
>
> The relevant definitions and the example (in Rd format):
>
> R5 definition:
> ```
> draw.Blob <- function (type = 'small')
> {
> 'Something about blobs'
> type <<- 'small'
> }
>
> Blob <- setRefClass (
> Class = "Blob",
> fields = list(type = 'character'),
> methods = list(draw = draw.Blob)
> )
> ```
>
> Example:
> ```
> \examples{
> Blob(type = 'small')
> }
> ```

The symptoms make it look as though the *function* Blob is not exported. 
I see in your source that you do export the *class* Blob, but the docs 
don't make it clear to me that this also implies export of the generator 
function.

So I'd add

export(Blob)

to your NAMESPACE. I just checked another package that exports a class, 
and it separately exported the generator function, so I guess this is known.

Duncan Murdoch




From murdoch.duncan at gmail.com  Sat Feb  1 23:03:28 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 01 Feb 2014 17:03:28 -0500
Subject: [Rd] Running examples with R5 constructor from package failing
In-Reply-To: <7cfabe1a-b9ad-4d0e-a0c6-f3e31b3059dc@me.com>
References: <7cfabe1a-b9ad-4d0e-a0c6-f3e31b3059dc@me.com>
Message-ID: <52ED6F30.6060400@gmail.com>

On 14-02-01 4:21 PM, Imanuel Costigan wrote:> You referred to another 
package that exports an R5 class. Which one?

I was looking at lme4, which doesn't have any reference classes, but 
should be relevant since the setClass function behaves a lot like 
setRefClass.

The ascii package does use setRefClass.  I don't think it uses 
exportClass though...

Duncan Murdoch

 >
 > Thanks for your help.
 >
 > On 02 Feb, 2014,at 12:57 AM, Duncan Murdoch <murdoch.duncan at gmail.com>
 > wrote:
 >
 >> On 14-01-31 10:14 PM, Imanuel Costigan wrote:> I am having an issue with
 >> reference classes (R5) in a package I am developing. They have both been
 >> illustrated in the `roxygentest` package I've got hosted on Github [1].
 >> >
 >> > When I run `R CMD check .` on the source directory of my package I am
 >> told that:
 >> >> Error: could not find function "Blob"
 >> >
 >> > However, when I install and load the package, I can successfully run
 >> the command in the example.
 >> >
 >> > Does someone know why this is happening?
 >> >
 >> > The relevant definitions and the example (in Rd format):
 >> >
 >> > R5 definition:
 >> > ```
 >> > draw.Blob <- function (type = 'small')
 >> > {
 >> > 'Something about blobs'
 >> > type <<- 'small'
 >> > }
 >> >
 >> > Blob <- setRefClass (
 >> > Class = "Blob",
 >> > fields = list(type = 'character'),
 >> > methods = list(draw = draw.Blob)
 >> > )
 >> > ```
 >> >
 >> > Example:
 >> > ```
 >> > \examples{
 >> > Blob(type = 'small')
 >> > }
 >> > ```
 >>
 >> The symptoms make it look as though the *function* Blob is not exported.
 >> I see in your source that you do export the *class* Blob, but the docs
 >> don't make it clear to me that this also implies export of the generator
 >> function.
 >>
 >> So I'd add
 >>
 >> export(Blob)
 >>
 >> to your NAMESPACE. I just checked another package that exports a class,
 >> and it separately exported the generator function, so I guess this is
 >> known.
 >>
 >> Duncan Murdoch
 >>
 >>
 >>


From saptarshi.guha at gmail.com  Mon Feb  3 09:41:27 2014
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Mon, 3 Feb 2014 00:41:27 -0800
Subject: [Rd] String Vector Encoding
Message-ID: <CAJDot1pchKieYXq3WcX7_36Kd9Hb5q8WB4+=8bMML=_9vt7+xQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140203/a3530186/attachment.pl>

From romain at r-enthusiasts.com  Mon Feb  3 11:07:40 2014
From: romain at r-enthusiasts.com (Romain Francois)
Date: Mon, 3 Feb 2014 11:07:40 +0100
Subject: [Rd] LinkingTo self
Message-ID: <C9D6ABA9-72D2-499E-A467-D0B8D309C094@r-enthusiasts.com>

Hello, 

Shipping header files for a package in inst/include and let other packages use it with LinkingTo is popular. 

Unfortunately for the package itself, we still need to use something like :

PKG_CPPFLAGS+=-I../inst/include/

in the Makevars and Makevars.win files. 

Could this become automatic ? 

So if a package has src/ and inst/include/ can we have it so that a -I flag is set accordingly. 

Would anyone be interested in reviewing a patch against R-devel for such feature ?

Romain


From murdoch.duncan at gmail.com  Mon Feb  3 12:37:29 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 03 Feb 2014 06:37:29 -0500
Subject: [Rd] String Vector Encoding
In-Reply-To: <CAJDot1pchKieYXq3WcX7_36Kd9Hb5q8WB4+=8bMML=_9vt7+xQ@mail.gmail.com>
References: <CAJDot1pchKieYXq3WcX7_36Kd9Hb5q8WB4+=8bMML=_9vt7+xQ@mail.gmail.com>
Message-ID: <52EF7F79.8030101@gmail.com>

On 14-02-03 3:41 AM, Saptarshi Guha wrote:
> Hello,
>
> I was reading through serialize.c and i couldn't answer something.
>
> In readItem, case CHARSXP,  rules exists to adjust the read string for
> string encoding.

This is described in the R Internals manual.

Duncan Murdoch

>
> Q1. I couldn't find where the encoding of the elements of the string vector
> are written? Is it when writeItem writes out the attributes of the item?
> But i couldn't find encoding in the attributes field
>
>   x <- "fa\xE7ile"
> Encoding(x) <- "latin1"
>   xx <- iconv(x, "latin1", "UTF-8")
> y=c(x,xx)
> attributes(y)
>
> NULL
>
> Apologies if this has been asked before
> Regards
> Saptarshi
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From kemp.samuel at gmail.com  Mon Feb  3 13:00:51 2014
From: kemp.samuel at gmail.com (Samuel Kemp)
Date: Mon, 3 Feb 2014 12:00:51 +0000
Subject: [Rd] Fwd: linker issue
In-Reply-To: <CAK399c6Kgj7teFgJHNkqkjbxDn4QMX-8iyZSrGvVF5r073LWvw@mail.gmail.com>
References: <CAK399c6Kgj7teFgJHNkqkjbxDn4QMX-8iyZSrGvVF5r073LWvw@mail.gmail.com>
Message-ID: <CAK399c71mNoCv4KrvmhKDMMLYZY56KHWFxy_hXSkMjyejcXAiw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140203/05417504/attachment.pl>

From murdoch.duncan at gmail.com  Mon Feb  3 13:22:26 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 03 Feb 2014 07:22:26 -0500
Subject: [Rd] Fwd: linker issue
In-Reply-To: <CAK399c71mNoCv4KrvmhKDMMLYZY56KHWFxy_hXSkMjyejcXAiw@mail.gmail.com>
References: <CAK399c6Kgj7teFgJHNkqkjbxDn4QMX-8iyZSrGvVF5r073LWvw@mail.gmail.com>
	<CAK399c71mNoCv4KrvmhKDMMLYZY56KHWFxy_hXSkMjyejcXAiw@mail.gmail.com>
Message-ID: <52EF8A02.5000600@gmail.com>

On 14-02-03 7:00 AM, Samuel Kemp wrote:
> Hi,
>
> I am trying to compile C++ with R and I am coming up against - what I
> believe - is a linker configuration issue.
>
> For example, using has_develop() gives the following message...
>
>> has_devel()

I assume you're using the function from devtools.

It tests whether you have your development environment set up correctly 
for use with devtools, and this result shows you don't.  You might try 
using the base R tools (e.g. R CMD SHLIB from the command line) to see 
if this is a devtools problem or more basic.

If it's a devtools problem, you should contact the maintainer of that 
package.

If it's not just a devtools problem and you still need help, you need to 
describe what you did in more detail.  What is your PATH? What about 
other environment variables? What version of R are you using?  What 
version of Rtools?

Duncan Murdoch

> "C:/PROGRA~1/R/R-30~1.2/bin/i386/R" --vanilla CMD SHLIB foo.c
> gcc -m32 -I"C:/PROGRA~1/R/R-30~1.2/include" -DNDEBUG
> -I"d:/RCompile/CRANpkg/extralibs64/local/include"     -O3 -Wall  -std=gnu99
> -mtune=core2 -c foo.c -o foo.o
> gcc -m32 -shared -s -static-libgcc -o foo.dll tmp.def foo.o
> -Ld:/RCompile/CRANpkg/extralibs64/local/lib/i386
> -Ld:/RCompile/CRANpkg/extralibs64/local/lib
> -LC:/PROGRA~1/R/R-30~1.2/bin/i386 -lR
> collect2: ld returned 9 exit status
> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>    unable to load shared object 'C:/TEMP/Rtmpes5hJL/foo.dll':
>    LoadLibrary failure:  The specified module could not be found.
>
>   I am running Windows 7 (32-bit), Rtools has been installed and is in my
> path (i.e. I can run gcc/g++). The object file (.o) gets created but then
> the linking goes awry.
>
> Another thing here is that I do not know where the directory RCompile is as
> it appears to be trying to link some 64-bit stuff (i.e. extralibs64).
>
> Any help/thoughts would be fantastic,
>
> Sam
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From berryboessenkool at hotmail.com  Mon Feb  3 13:43:18 2014
From: berryboessenkool at hotmail.com (Berry Boessenkool)
Date: Mon, 3 Feb 2014 13:43:18 +0100
Subject: [Rd] seq range argument
Message-ID: <DUB123-W38EA0ACC05B6A132C636B0D5AB0@phx.gbl>

Hello dear developers,

I find myself often having the result of "range" oder "extendrange", which I want to create a sequence with.
But "seq" needs two seperate arguments "from" and "two".
Could an argument "range" be added?

Otherwise I will have to create an object with the range (may come from a longer calculation), index twice from it and remove it again - kind of an unnecessary bunch of code, I think.

Here's an example:

# What I currently do:
D_orig <- rnorm(20, sd=30)
D_range <- extendrange(D_orig, f=0.1)
Ijustneed <- seq(D_range[1], D_range[2], len=100)
rm(D_range)

# what I'd like to have instead:
D_orig <- rnorm(20, sd=30)
Ijustneed <- seq(range=extendrange(D_orig, f=0.1), len=100)

regards,
Berry

-------------------------------------
Berry Boessenkool
Potsdam, Germany
------------------------------------- 		 	   		  

From pd.mes at cbs.dk  Mon Feb  3 14:36:46 2014
From: pd.mes at cbs.dk (Peter Dalgaard)
Date: Mon, 3 Feb 2014 14:36:46 +0100
Subject: [Rd] Release plans for R versions 3.0.3 and 3.1.0
Message-ID: <0A618C28-0FAF-4604-AF91-6CAF19CC927E@cbs.dk>

The upcoming wrap-up release 3.0.3 is scheduled for March 6. 

The start of the next series, 3.1.0 is scheduled for April 10.

Detailed schedules will be published on developer.r-project.org.

Package maintainers, especially of recommended packages, are asked to time potential modifications to avoid collisions with the release process. 

For the Core Team

Peter D.

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From lorenz at usgs.gov  Mon Feb  3 15:00:41 2014
From: lorenz at usgs.gov (Lorenz, David)
Date: Mon, 3 Feb 2014 08:00:41 -0600
Subject: [Rd] seq range argument
In-Reply-To: <DUB123-W38EA0ACC05B6A132C636B0D5AB0@phx.gbl>
References: <DUB123-W38EA0ACC05B6A132C636B0D5AB0@phx.gbl>
Message-ID: <CALxY2LdGEGcFPo4jxEr_XnMLp4zWio=nbmMuPPUCo-oKkCdcaA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140203/8b7c88f5/attachment.pl>

From saptarshi.guha at gmail.com  Mon Feb  3 16:06:29 2014
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Mon, 3 Feb 2014 07:06:29 -0800
Subject: [Rd] String Vector Encoding
In-Reply-To: <52EF7F79.8030101@gmail.com>
References: <CAJDot1pchKieYXq3WcX7_36Kd9Hb5q8WB4+=8bMML=_9vt7+xQ@mail.gmail.com>
	<52EF7F79.8030101@gmail.com>
Message-ID: <CAJDot1q8nHtPy+-dBx+DPQ5pZ+Fh4EQaEG=aAiiPD41-kOT6ew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140203/30af75b0/attachment.pl>

From berryboessenkool at hotmail.com  Mon Feb  3 15:43:05 2014
From: berryboessenkool at hotmail.com (Berry Boessenkool)
Date: Mon, 3 Feb 2014 15:43:05 +0100
Subject: [Rd] seq range argument
In-Reply-To: <CALxY2LdGEGcFPo4jxEr_XnMLp4zWio=nbmMuPPUCo-oKkCdcaA@mail.gmail.com>
References: <DUB123-W38EA0ACC05B6A132C636B0D5AB0@phx.gbl>,
	<CALxY2LdGEGcFPo4jxEr_XnMLp4zWio=nbmMuPPUCo-oKkCdcaA@mail.gmail.com>
Message-ID: <DUB123-W3874E8490DF6FE90B1D5FFD5AB0@phx.gbl>

Thanks Dave!
I settled on something similar, but more general, for my function collection package.
I just thought this could be wanted by more people and thus interesting for base::seq.

In case anyone is interested in my solution, keep reading.

Berry


# Add a range argument to seq

seqr <- function(from=1, to=1, range, ...)
{
# Input checking:
if(!is.vector(range)) stop("'range' must be a vector.")
if(!is.numeric(range)) stop("'range' must be numeric.")
# only set from and to if range is given as input:
if(!missing(range)) 
? {
? from <- range[1]???? # first
? to <- tail(range,1)? # and last value
? if(length(range)>2L)
???? {
???? from <- min(range, finite=TRUE) # min
???? to?? <- max(range, finite=TRUE) # and max
???? }
? }
# now call seq with from and to (obtained from range)
seq(from=from, to=to, ...)
}


# Examples
m <- c(41, 12, 38, 29, 50, 39, 22)
seqr(range=extendrange(m, f=0.1), len=5)
# Takes min and max of range if thae vector has more than two elements. 
seqr(range=m, by=3)


-----------


From: lorenz at usgs.gov
Date: Mon, 3 Feb 2014 08:00:41 -0600
Subject: Re: [Rd] seq range argument
To: berryboessenkool at hotmail.com
CC: r-devel at r-project.org

Berry,? It sounds like you just need a little helper function like this:
ser <- function(x, len=100, f=0.1) {? ?dr <- extendrange(x, f=f)? ?return(seq(dr[1L], dr[2L], length.out=len))

?}
I called it ser, short for sequence extended range. Use it thusly:
Ijustneed <- ser(D_orig)
? Hope this helps. I use and create little help functions like this all the time. Even extendrange could be considered a helper function as it is only a couple of lines long.

Dave 		 	   		  

From istazahn at gmail.com  Mon Feb  3 17:29:32 2014
From: istazahn at gmail.com (Ista Zahn)
Date: Mon, 3 Feb 2014 11:29:32 -0500
Subject: [Rd] seq range argument
In-Reply-To: <CALxY2LdGEGcFPo4jxEr_XnMLp4zWio=nbmMuPPUCo-oKkCdcaA@mail.gmail.com>
References: <DUB123-W38EA0ACC05B6A132C636B0D5AB0@phx.gbl>
	<CALxY2LdGEGcFPo4jxEr_XnMLp4zWio=nbmMuPPUCo-oKkCdcaA@mail.gmail.com>
Message-ID: <CA+vqiLF_vP+s7nh=Xt89P9ae2QQk+FKtqxuR=2ppGPqr6Cy-SA@mail.gmail.com>

This is slightly more verbose, but perhaps

do.call("seq", as.list(c(extendrange(D_orig, f=0.1), len=100)))

Best,
Ista

On Mon, Feb 3, 2014 at 9:00 AM, Lorenz, David <lorenz at usgs.gov> wrote:
> Berry,
>   It sounds like you just need a little helper function like this:
>
> ser <- function(x, len=100, f=0.1) {
>    dr <- extendrange(x, f=f)
>    return(seq(dr[1L], dr[2L], length.out=len))
>  }
>
> I called it ser, short for sequence extended range. Use it thusly:
>
> Ijustneed <- ser(D_orig)
>
>   Hope this helps. I use and create little help functions like this all the
> time. Even extendrange could be considered a helper function as it is only
> a couple of lines long.
> Dave
>
>
>
> On Mon, Feb 3, 2014 at 6:43 AM, Berry Boessenkool <
> berryboessenkool at hotmail.com> wrote:
>
>> Hello dear developers,
>>
>> I find myself often having the result of "range" oder "extendrange", which
>> I want to create a sequence with.
>> But "seq" needs two seperate arguments "from" and "two".
>> Could an argument "range" be added?
>>
>> Otherwise I will have to create an object with the range (may come from a
>> longer calculation), index twice from it and remove it again - kind of an
>> unnecessary bunch of code, I think.
>>
>> Here's an example:
>>
>> # What I currently do:
>> D_orig <- rnorm(20, sd=30)
>> D_range <- extendrange(D_orig, f=0.1)
>> Ijustneed <- seq(D_range[1], D_range[2], len=100)
>> rm(D_range)
>>
>> # what I'd like to have instead:
>> D_orig <- rnorm(20, sd=30)
>> Ijustneed <- seq(range=extendrange(D_orig, f=0.1), len=100)
>>
>> regards,
>> Berry
>>
>> -------------------------------------
>> Berry Boessenkool
>> Potsdam, Germany
>> -------------------------------------
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Mon Feb  3 17:43:55 2014
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 3 Feb 2014 11:43:55 -0500
Subject: [Rd] String Vector Encoding
In-Reply-To: <CAJDot1q8nHtPy+-dBx+DPQ5pZ+Fh4EQaEG=aAiiPD41-kOT6ew@mail.gmail.com>
References: <CAJDot1pchKieYXq3WcX7_36Kd9Hb5q8WB4+=8bMML=_9vt7+xQ@mail.gmail.com>
	<52EF7F79.8030101@gmail.com>
	<CAJDot1q8nHtPy+-dBx+DPQ5pZ+Fh4EQaEG=aAiiPD41-kOT6ew@mail.gmail.com>
Message-ID: <63E630B5-6511-4AA0-9352-153FE9F340A6@r-project.org>

On Feb 3, 2014, at 10:06 AM, Saptarshi Guha <saptarshi.guha at gmail.com> wrote:

> True but I was hoping someone could point me where in the source code this
> happens.
> 

src/main/serialize.c @1655 and @1663


> Cheers
> Saptarshi
> On Feb 3, 2014 3:37 AM, "Duncan Murdoch" <murdoch.duncan at gmail.com> wrote:
> 
>> On 14-02-03 3:41 AM, Saptarshi Guha wrote:
>> 
>>> Hello,
>>> 
>>> I was reading through serialize.c and i couldn't answer something.
>>> 
>>> In readItem, case CHARSXP,  rules exists to adjust the read string for
>>> string encoding.
>>> 
>> 
>> This is described in the R Internals manual.
>> 
>> Duncan Murdoch
>> 
>> 
>>> Q1. I couldn't find where the encoding of the elements of the string
>>> vector
>>> are written? Is it when writeItem writes out the attributes of the item?
>>> But i couldn't find encoding in the attributes field
>>> 
>>>  x <- "fa\xE7ile"
>>> Encoding(x) <- "latin1"
>>>  xx <- iconv(x, "latin1", "UTF-8")
>>> y=c(x,xx)
>>> attributes(y)
>>> 
>>> NULL
>>> 
>>> Apologies if this has been asked before
>>> Regards
>>> Saptarshi
>>> 
>>>        [[alternative HTML version deleted]]
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
>> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hb at biostat.ucsf.edu  Tue Feb  4 04:22:27 2014
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Mon, 3 Feb 2014 19:22:27 -0800
Subject: [Rd] capture.output(): Using a rawConnection() [linear] instead of
 textConnection() [exponential]?
Message-ID: <CAFDcVCSU2dFGB1K1e4AroKd3hFFPb5U-7PqFp3550JGHj_6Kdw@mail.gmail.com>

I've noticed that the processing time for the default capture.output()
grows exponentially in the number of characters outputted/captured.
The default settings sinks to a temporary textConnection().  When
instead sinking to a rawConnection(), the processing time becomes
linear.  See below example and attached PNG figure [also at
http://xfer.aroma-project.org/tmp/20140203/capture.output_text-vs-raw.png].

I know little about text encoding, but I wouldn't be surprised I'm
overseeing encoding issues when sinking to raw followed by
rawToChar().  According to the below example, both approaches seem to
work with my current setup (sessionInfo() below), but on the other
hand it's only writing an ASCII "a" character multiple times.

Q. Is it possible to utilize rawConnection() instead of
textConnection() and still get the same output regardless of
encodings?

Q. What causes textConnection() to be exponential when rawConnection()
is linear?


REPRODUCIBLE EXAMPLE:

captureViaText <- function(..., local=TRUE, envir=parent.frame()) {
  eval({
    # Basically what capture.output() does by default
    file <- textConnection("rval", open="w", local=local)
    capture.output(..., file=file)
    close(file)
    rval
  }, envir=envir)
} # captureViaText()

captureViaRaw <- function(..., local=TRUE, envir=parent.frame()) {
  eval({
    # Basically what capture.output() does by default
    file <- rawConnection(raw(0L), open="w")
    capture.output(..., file=file)
    res <- rawConnectionValue(file)
    close(file)
    res <- rawToChar(res)
    res <- unlist(strsplit(res, split="\n", fixed=TRUE))
    res
  }, envir=envir)
} # captureViaRaw()


data <- data.frame(size=10^seq(from=3, to=7.9, by=0.1),
captureViaText=NA, captureViaRaw=NA)
names <- colnames(data)[-1]
for (kk in which(is.na(data[[ncol(data)]]))) {
  # String to output
  x <- rep("a", times=data$size[kk])
  x[seq(from=1L, to=length(x), by=1e3)] <- "\n"
  x <- paste(x, collapse="")
  cat(sprintf("Output size: %d characters\n", nchar(x)))

  # Benchmark
  values <- list()
  for (name in names) {
    print(name)
    fcn <- get(name, mode="function")
    t <- system.time({
      res <- fcn(cat(x))
    }, gcFirst=TRUE)
    n <- sum(nchar(res))
    values[[name]] <- res
    rm(list="res")
    cat(sprintf("%s: %.2g seconds to capture %d characters\n", name, t[3], n))
    data[kk,name] <- t[3]
  } # for (name ...)

  # Assert same captures
  for (cc in seq_along(values)) stopifnot(identical(values[[cc]], values[[1]]))
  rm(list="values")
} # for (size ...)

local({
  png("capture.output_text-vs-raw.png", width=840, height=840)
  on.exit(dev.off())
  plot(data[,c(1,2)], type="n", xlab="Number of characters", ylab="Time (s)")
  for (cc in 2:ncol(data)) lines(data[,c(1,cc)], lwd=2, col=cc)
  legend("topleft", lwd=2, col=2:ncol(data), names, bty="n")
})

> sessionInfo()
R Under development (unstable) (2014-01-30 r64901)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_3.1.0

Thanks,

Henrik
-------------- next part --------------
A non-text attachment was scrubbed...
Name: capture.output_text-vs-raw.png
Type: image/png
Size: 6579 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140203/ee20d00f/attachment.png>

From david at revolutionanalytics.com  Wed Feb  5 00:01:37 2014
From: david at revolutionanalytics.com (David Smith)
Date: Tue, 4 Feb 2014 15:01:37 -0800
Subject: [Rd] Revolutions Blog: January 2014 roundup
Message-ID: <CABgvEC9hDhQa_B5eGMbmLiWD+FeMtXG5xLU+TmrEC75G4DvToA@mail.gmail.com>

Revolution Analytics staff write about R every weekday at the Revolutions blog:
 http://blog.revolutionanalytics.com
and every month I post a summary of articles from the previous month
of particular interest to readers of r-help.

In case you missed them, here are some articles related to R from the
month of January:

Princeton's Germ?n Rodr?guez has published a useful "Introduction to
R" guide, with a focus on linear and logistic regression:
http://bit.ly/1c1bero

The rxDForest function in the RevoScaleR package fits random forests
of histogram-binning trees: http://bit.ly/1b08qAq

A tutorial on using the xts package to analyze http://bit.ly/1c1bc30
and plot time series data http://bit.ly/1c1bc31

In a video interview with Trevor Hastie, John Chambers recounts the
history of S and R: http://bit.ly/1c1bern

A review of "Doing Data Science", a new book by Rachel Schutt and
Cathy O'Neil http://bit.ly/1c1berp

Hadley Wickham introduces the dplyr package, with its "grammar of data
manipulation" http://bit.ly/1c1bcje

The new choroplethr package makes it easier to create data maps in R:
http://bit.ly/1c1bcjf

A developer preview of SparkR, an interface between R and Apache
Spark, is now available: http://bit.ly/1c1berq

Joseph Rickert reviews the capabilities of R for topological data
analysis: http://bit.ly/1c1berr

In a recent survey of data scientists, R is the most-used software
tool other than SQL: http://bit.ly/1c1bers

A new JSS article on computing with massive data, and a change in
policy for acceptable JSS software licenses: http://bit.ly/1b08srV

Large scale optimization with the optim and rxDataStep functions:
http://bit.ly/1c1bert

Large enterprise software vendors with connections to R: http://bit.ly/1c1bcji

A preview of a forthcoming update to Max Kuhn's caret package, and an
interactive chart showing similarities amongst the 143 statistical and
machine learning models it supports: http://bit.ly/1c1beru

Simulation-based forecasts by combining expert opinion: http://bit.ly/1c1bcjj

Tips on getting R help: http://bit.ly/1c1bcjk

The top 10 posts on the Revolutions blog from 2013: http://bit.ly/1b08qAt

Some non-R stories in the past month included: levitation with sound
waves (http://bit.ly/1c1bcjl), the NYT's 4th Down Bot
(http://bit.ly/1c1berv), bird flight patterns (http://bit.ly/1c1bcjm),
camera magic on Vine (http://bit.ly/1c1berw), visualizing whisky
flavor profiles (http://bit.ly/1c1bcjn), the Cornsweet illusion
(http://bit.ly/1b08srW), and a one-sentence explanation of the Fourier
Transform (http://bit.ly/1c1berz).

Meeting times for local R user groups (http://bit.ly/eC5YQe) can be
found on the updated R Community Calendar at: http://bit.ly/bb3naW

If you're looking for more articles about R, you can find summaries
from previous months at http://blog.revolutionanalytics.com/roundups/.
You can receive daily blog posts via email using services like
blogtrottr.com, or join the Revolution Analytics mailing list at
http://revolutionanalytics.com/newsletter to be alerted to new
articles on a monthly basis.

As always, thanks for the comments and please keep sending suggestions
to me at david at revolutionanalytics.com . Don't forget you can also
follow the blog using an RSS reader, or by following me on Twitter
(I'm @revodavid).

Cheers,
# David

-- 
David M Smith <david at revolutionanalytics.com>
VP of Marketing, Revolution Analytics  http://blog.revolutionanalytics.com
Tel: +1 (650) 646-9523 (Seattle WA, USA)
Twitter: @revodavid


From david at revolutionanalytics.com  Wed Feb  5 00:20:21 2014
From: david at revolutionanalytics.com (David Smith)
Date: Tue, 4 Feb 2014 15:20:21 -0800
Subject: [Rd] Revolutions Blog: January 2014 roundup
In-Reply-To: <CABgvEC9hDhQa_B5eGMbmLiWD+FeMtXG5xLU+TmrEC75G4DvToA@mail.gmail.com>
References: <CABgvEC9hDhQa_B5eGMbmLiWD+FeMtXG5xLU+TmrEC75G4DvToA@mail.gmail.com>
Message-ID: <CABgvEC-wfC31yqmve9KQjXXdP7-av5NFRNamazrC0-Kz4LnCjQ@mail.gmail.com>

Apologies, r-devel -- I meant to send that message to r-help as I've
done for the past five years. I'll resend it there now. Sorry about
the duplication.

# David Smith
-- 
David M Smith <david at revolutionanalytics.com>
VP of Marketing, Revolution Analytics  http://blog.revolutionanalytics.com
Tel: +1 (650) 646-9523 (Seattle WA, USA)
Twitter: @revodavid



On Tue, Feb 4, 2014 at 3:01 PM, David Smith
<david at revolutionanalytics.com> wrote:
> Revolution Analytics staff write about R every weekday at the Revolutions blog:
>  http://blog.revolutionanalytics.com
> and every month I post a summary of articles from the previous month
> of particular interest to readers of r-help.
>
> In case you missed them, here are some articles related to R from the
> month of January:
>
> Princeton's Germ?n Rodr?guez has published a useful "Introduction to
> R" guide, with a focus on linear and logistic regression:
> http://bit.ly/1c1bero
>
> The rxDForest function in the RevoScaleR package fits random forests
> of histogram-binning trees: http://bit.ly/1b08qAq
>
> A tutorial on using the xts package to analyze http://bit.ly/1c1bc30
> and plot time series data http://bit.ly/1c1bc31
>
> In a video interview with Trevor Hastie, John Chambers recounts the
> history of S and R: http://bit.ly/1c1bern
>
> A review of "Doing Data Science", a new book by Rachel Schutt and
> Cathy O'Neil http://bit.ly/1c1berp
>
> Hadley Wickham introduces the dplyr package, with its "grammar of data
> manipulation" http://bit.ly/1c1bcje
>
> The new choroplethr package makes it easier to create data maps in R:
> http://bit.ly/1c1bcjf
>
> A developer preview of SparkR, an interface between R and Apache
> Spark, is now available: http://bit.ly/1c1berq
>
> Joseph Rickert reviews the capabilities of R for topological data
> analysis: http://bit.ly/1c1berr
>
> In a recent survey of data scientists, R is the most-used software
> tool other than SQL: http://bit.ly/1c1bers
>
> A new JSS article on computing with massive data, and a change in
> policy for acceptable JSS software licenses: http://bit.ly/1b08srV
>
> Large scale optimization with the optim and rxDataStep functions:
> http://bit.ly/1c1bert
>
> Large enterprise software vendors with connections to R: http://bit.ly/1c1bcji
>
> A preview of a forthcoming update to Max Kuhn's caret package, and an
> interactive chart showing similarities amongst the 143 statistical and
> machine learning models it supports: http://bit.ly/1c1beru
>
> Simulation-based forecasts by combining expert opinion: http://bit.ly/1c1bcjj
>
> Tips on getting R help: http://bit.ly/1c1bcjk
>
> The top 10 posts on the Revolutions blog from 2013: http://bit.ly/1b08qAt
>
> Some non-R stories in the past month included: levitation with sound
> waves (http://bit.ly/1c1bcjl), the NYT's 4th Down Bot
> (http://bit.ly/1c1berv), bird flight patterns (http://bit.ly/1c1bcjm),
> camera magic on Vine (http://bit.ly/1c1berw), visualizing whisky
> flavor profiles (http://bit.ly/1c1bcjn), the Cornsweet illusion
> (http://bit.ly/1b08srW), and a one-sentence explanation of the Fourier
> Transform (http://bit.ly/1c1berz).
>
> Meeting times for local R user groups (http://bit.ly/eC5YQe) can be
> found on the updated R Community Calendar at: http://bit.ly/bb3naW
>
> If you're looking for more articles about R, you can find summaries
> from previous months at http://blog.revolutionanalytics.com/roundups/.
> You can receive daily blog posts via email using services like
> blogtrottr.com, or join the Revolution Analytics mailing list at
> http://revolutionanalytics.com/newsletter to be alerted to new
> articles on a monthly basis.
>
> As always, thanks for the comments and please keep sending suggestions
> to me at david at revolutionanalytics.com . Don't forget you can also
> follow the blog using an RSS reader, or by following me on Twitter
> (I'm @revodavid).
>
> Cheers,
> # David
>
> --
> David M Smith <david at revolutionanalytics.com>
> VP of Marketing, Revolution Analytics  http://blog.revolutionanalytics.com
> Tel: +1 (650) 646-9523 (Seattle WA, USA)
> Twitter: @revodavid


From proebuck at mdanderson.org  Wed Feb  5 01:13:38 2014
From: proebuck at mdanderson.org (Roebuck,Paul L)
Date: Wed, 5 Feb 2014 00:13:38 +0000
Subject: [Rd] R CMD check, NOTEs, & S4-dependent packages
Message-ID: <CF16DE50.48EBD%proebuck@mdanderson.org>

As I was running "R CMD check" on one of my older packages
(matlab), I was attempting to fix one of the NOTEs which
bitches about attempting to change the search path using
require().

In my case, I am repeating a package dependency for "methods"
package in my .onLoad() function. Can this scenario (based
on something B. Ripley discussed many years ago) no longer
occur? Just another R package anachronism? Was I really
modifying the search path by repeating a DESCRIPTION dependency?


.onLoad <- function(libname, pkgname) {
    ## In case namespace is loaded (via import) by package that
    ## doesn't depend on S4 methods and used in a session with
    ## non-default set of packages.
    require(methods)

    ?
}


From kasperdanielhansen at gmail.com  Wed Feb  5 01:32:39 2014
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Tue, 4 Feb 2014 19:32:39 -0500
Subject: [Rd] R CMD check, NOTEs, & S4-dependent packages
In-Reply-To: <CF16DE50.48EBD%proebuck@mdanderson.org>
References: <CF16DE50.48EBD%proebuck@mdanderson.org>
Message-ID: <CAC2h7usf5z-riFk9vG8C9qx9eqbYj8pW4c=G=v9Wo6_bSGJfMQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140204/b0950b80/attachment.pl>

From dusa.adrian at unibuc.ro  Thu Feb  6 09:49:14 2014
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Thu, 6 Feb 2014 10:49:14 +0200
Subject: [Rd] C headers
Message-ID: <CAJ=0CtA2YWcgF-VB2PApYsPKkgPpmpbR6HaTdac0E3i47koXiA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140206/d9abeadd/attachment.pl>

From ripley at stats.ox.ac.uk  Thu Feb  6 10:25:41 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 06 Feb 2014 09:25:41 +0000
Subject: [Rd] C headers
In-Reply-To: <CAJ=0CtA2YWcgF-VB2PApYsPKkgPpmpbR6HaTdac0E3i47koXiA@mail.gmail.com>
References: <CAJ=0CtA2YWcgF-VB2PApYsPKkgPpmpbR6HaTdac0E3i47koXiA@mail.gmail.com>
Message-ID: <52F35515.4010305@stats.ox.ac.uk>

This is an R-sig-mac issue, so Cc:ed there.

I have seen this after an upgrade to Mavericks: you have a partial 
installation of the pre-Mavericks Xcode Command Line Tools after the 
upgrade (which removed some of it).

See the current R-admin manual for how to use the CRAN binary of R 3.0.2 
with Mavericks.  Or get R_patched from r.research.att.com, which will 
change the compiler specs for you.

On 06/02/2014 08:49, Adrian Du?a wrote:
> Dear list,
>
> Just upgraded to MacOS Mavericks, fresh install of R 3.0.2 and trying to
> install a previous version of my QCA package (the most recent one source
> file, which passed the R CMD check --as-cran with R 3.0.1)
>
> I seem to have some difficulties in the C code, apparently it doesn't find
> some headers (please see below):
>
> ============
> $ R CMD INSTALL --no-multiarch QCA.history/QCA_1.1-1.tar.gz
> * installing to library
> ???/Library/Frameworks/R.framework/Versions/3.0/Resources/library???
> * installing *source* package ???QCA??? ...
> ** libs
> llvm-gcc-4.2 -arch x86_64 -std=gnu99
> -I/Library/Frameworks/R.framework/Resources/include -DNDEBUG
>   -I/usr/local/include    -fPIC  -mtune=core2 -g -O2  -c allSol.c -o allSol.o
> In file included from allSol.c:1:
> /Library/Frameworks/R.framework/Resources/include/R.h:28:20: error:
> stdlib.h: No such file or directory
> /Library/Frameworks/R.framework/Resources/include/R.h:29:73: error:
> stdio.h: No such file or directory
> In file included from
> /Library/Frameworks/R.framework/Resources/include/R.h:30,
>                   from allSol.c:1:
> /usr/llvm-gcc-4.2/bin/../lib/gcc/i686-apple-darwin11/4.2.1/include/limits.h:15:25:
> error: limits.h: No such file or directory
> In file included from allSol.c:1:
> /Library/Frameworks/R.framework/Resources/include/R.h:31:18: error: math.h:
> No such file or directory
> In file included from
> /Library/Frameworks/R.framework/Resources/include/R.h:44,
>                   from allSol.c:1:
> /Library/Frameworks/R.framework/Resources/include/R_ext/RS.h:26:47: error:
> string.h: No such file or directory
> In file included from allSol.c:2:
> /Library/Frameworks/R.framework/Resources/include/Rinternals.h:862: error:
> expected declaration specifiers or ???...??? before ???FILE???
> /Library/Frameworks/R.framework/Resources/include/Rinternals.h:865: error:
> expected declaration specifiers or ???...??? before ???FILE???
> allSol.c: In function ???allSol???:
> allSol.c:62: warning: implicit declaration of function ???div???
> allSol.c:62: error: request for member ???quot??? in something not a structure
> or union
> allSol.c:62: error: request for member ???rem??? in something not a structure
> or union
> allSol.c:213: error: request for member ???quot??? in something not a structure
> or union
> allSol.c:213: error: request for member ???rem??? in something not a structure
> or union
> allSol.c:279: error: request for member ???quot??? in something not a structure
> or union
> allSol.c:279: error: request for member ???rem??? in something not a structure
> or union
> make: *** [allSol.o] Error 1
> ERROR: compilation failed for package ???QCA???
> * removing
> ???/Library/Frameworks/R.framework/Versions/3.0/Resources/library/QCA???
> * restoring previous
> ???/Library/Frameworks/R.framework/Versions/3.0/Resources/library/QCA???
> ============
>
> It doesn't find stdlib.h, stdio.h, limits.h, math.h, string.h (etc,
> basically all important ones).
>
> I have Xcode version 5.0.2 installed, do I need anything else installed in
> the system?
>
> Thank you,
> Adrian
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From goran.brostrom at umu.se  Thu Feb  6 10:27:22 2014
From: goran.brostrom at umu.se (=?UTF-8?B?R8O2cmFuIEJyb3N0csO2bQ==?=)
Date: Thu, 6 Feb 2014 10:27:22 +0100
Subject: [Rd] C headers
In-Reply-To: <CAJ=0CtA2YWcgF-VB2PApYsPKkgPpmpbR6HaTdac0E3i47koXiA@mail.gmail.com>
References: <CAJ=0CtA2YWcgF-VB2PApYsPKkgPpmpbR6HaTdac0E3i47koXiA@mail.gmail.com>
Message-ID: <52F3557A.5080703@umu.se>

I went through this pain two days ago, but I managed both building R 
from source and my own packages by following Brian Ripley excellent (as 
always) pointers on the r-sig-mac mailing list (around october 2013). 
Look there, and ask further questions on that list.

G?ran Brostr?m

On 02/06/2014 09:49 AM, Adrian Du?a wrote:
> Dear list,
>
> Just upgraded to MacOS Mavericks, fresh install of R 3.0.2 and trying to
> install a previous version of my QCA package (the most recent one source
> file, which passed the R CMD check --as-cran with R 3.0.1)
>
> I seem to have some difficulties in the C code, apparently it doesn't find
> some headers (please see below):
>
> ============
> $ R CMD INSTALL --no-multiarch QCA.history/QCA_1.1-1.tar.gz
> * installing to library
> ?/Library/Frameworks/R.framework/Versions/3.0/Resources/library?
> * installing *source* package ?QCA? ...
> ** libs
> llvm-gcc-4.2 -arch x86_64 -std=gnu99
> -I/Library/Frameworks/R.framework/Resources/include -DNDEBUG
>   -I/usr/local/include    -fPIC  -mtune=core2 -g -O2  -c allSol.c -o allSol.o
> In file included from allSol.c:1:
> /Library/Frameworks/R.framework/Resources/include/R.h:28:20: error:
> stdlib.h: No such file or directory
> /Library/Frameworks/R.framework/Resources/include/R.h:29:73: error:
> stdio.h: No such file or directory
> In file included from
> /Library/Frameworks/R.framework/Resources/include/R.h:30,
>                   from allSol.c:1:
> /usr/llvm-gcc-4.2/bin/../lib/gcc/i686-apple-darwin11/4.2.1/include/limits.h:15:25:
> error: limits.h: No such file or directory
> In file included from allSol.c:1:
> /Library/Frameworks/R.framework/Resources/include/R.h:31:18: error: math.h:
> No such file or directory
> In file included from
> /Library/Frameworks/R.framework/Resources/include/R.h:44,
>                   from allSol.c:1:
> /Library/Frameworks/R.framework/Resources/include/R_ext/RS.h:26:47: error:
> string.h: No such file or directory
> In file included from allSol.c:2:
> /Library/Frameworks/R.framework/Resources/include/Rinternals.h:862: error:
> expected declaration specifiers or ?...? before ?FILE?
> /Library/Frameworks/R.framework/Resources/include/Rinternals.h:865: error:
> expected declaration specifiers or ?...? before ?FILE?
> allSol.c: In function ?allSol?:
> allSol.c:62: warning: implicit declaration of function ?div?
> allSol.c:62: error: request for member ?quot? in something not a structure
> or union
> allSol.c:62: error: request for member ?rem? in something not a structure
> or union
> allSol.c:213: error: request for member ?quot? in something not a structure
> or union
> allSol.c:213: error: request for member ?rem? in something not a structure
> or union
> allSol.c:279: error: request for member ?quot? in something not a structure
> or union
> allSol.c:279: error: request for member ?rem? in something not a structure
> or union
> make: *** [allSol.o] Error 1
> ERROR: compilation failed for package ?QCA?
> * removing
> ?/Library/Frameworks/R.framework/Versions/3.0/Resources/library/QCA?
> * restoring previous
> ?/Library/Frameworks/R.framework/Versions/3.0/Resources/library/QCA?
> ============
>
> It doesn't find stdlib.h, stdio.h, limits.h, math.h, string.h (etc,
> basically all important ones).
>
> I have Xcode version 5.0.2 installed, do I need anything else installed in
> the system?
>
> Thank you,
> Adrian
>


From pburns at pburns.seanet.com  Thu Feb  6 19:25:10 2014
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Thu, 06 Feb 2014 18:25:10 +0000
Subject: [Rd] suggested addition to 'install.packages' help file
Message-ID: <52F3D386.5040006@pburns.seanet.com>

I suggest that there be an additional sentence
in the explanation for the 'repos' argument in
the help file for 'install.packages':

If the repository is on a local drive, then the
string should begin with \code{file:}, e.g.,
\code{"file:J:/Rrepos"}.


Perhaps I'm missing some subtlety, but it makes
things work in my case.

Pat

-- 
Patrick Burns
pburns at pburns.seanet.com
twitter: @burnsstat @portfolioprobe
http://www.portfolioprobe.com/blog
http://www.burns-stat.com
(home of:
  'Impatient R'
  'The R Inferno'
  'Tao Te Programming')


From carl at witthoft.com  Fri Feb  7 02:31:16 2014
From: carl at witthoft.com (Carl Witthoft)
Date: Thu, 06 Feb 2014 20:31:16 -0500
Subject: [Rd] suggestion for "sets" tools upgrade
Message-ID: <52F43764.8060301@witthoft.com>

First, let me apologize in advance if this is the wrong place to submit 
a suggestion for a change to functions in the base-R package.  It never 
really occurred to me that I'd have an idea worthy of such a change.

My idea is to provide an upgrade to all the "sets" tools (intersect, 
union, setdiff, setequal) that allows the user to apply them in a 
strictly algebraic style.

The current tools, as well documented, remove duplicate values in the 
input vectors.  This can be helpful in stats work, but is inconsistent 
with the mathematical concept of sets and set measure.  What I propose 
is that all these functions be given an additional argument with a 
default value:  "multiple=FALSE" .  When called this way, the functions 
remain as at present.  When called with "multiple=TRUE,"  they treat the 
input vectors as true 'sets' of elements.

I've already written and tested upgrades to all four functions, so if 
upgrading the base-R package is not appropriate, I'll post as a package 
to CRAN.  It just seems more sensible to add to the base.

Thanks in advance for any advice or comments.
(Please be sure to email, as I can't recall if I'm currently registered 
for r-devel)

Here's an example of the new code:

intersect<-function (x, y,multiple=FALSE)
{
     y <- as.vector(y)
	trueint <- y[match(as.vector(x), y, 0L)]
     if(!multiple) trueint <- unique(trueint)
	return(trueint)
}

thanks
Carl
-


From michael.weylandt at gmail.com  Fri Feb  7 03:39:28 2014
From: michael.weylandt at gmail.com (R. Michael Weylandt)
Date: Thu, 6 Feb 2014 21:39:28 -0500
Subject: [Rd] suggestion for "sets" tools upgrade
In-Reply-To: <52F43764.8060301@witthoft.com>
References: <52F43764.8060301@witthoft.com>
Message-ID: <CAAmySGMZBpYxs8VuZi4Z8+hEPfbct6USxpesja8m3489OOaMBw@mail.gmail.com>

On Thu, Feb 6, 2014 at 8:31 PM, Carl Witthoft <carl at witthoft.com> wrote:
> First, let me apologize in advance if this is the wrong place to submit a
> suggestion for a change to functions in the base-R package.  It never really
> occurred to me that I'd have an idea worthy of such a change.
>
> My idea is to provide an upgrade to all the "sets" tools (intersect, union,
> setdiff, setequal) that allows the user to apply them in a strictly
> algebraic style.
>
> The current tools, as well documented, remove duplicate values in the input
> vectors.  This can be helpful in stats work, but is inconsistent with the
> mathematical concept of sets and set measure.

No comments about back-compatability concerns, etc. but why do you
think this is closer to the "mathematical concept of sets"? As I
learned them, sets have no repeats (or order) and other languages with
set primitives tend to agree:

python> {1,1,2,3} == {1,2,3}
True

I believe C++ calls what you're looking for a multiset (albeit with a
guarantee or orderedness).

Cheers,
Michael


From kevin.r.coombes at gmail.com  Fri Feb  7 10:59:16 2014
From: kevin.r.coombes at gmail.com (Kevin Coombes)
Date: Fri, 07 Feb 2014 04:59:16 -0500
Subject: [Rd] suggestion for "sets" tools upgrade
In-Reply-To: <CAAmySGMZBpYxs8VuZi4Z8+hEPfbct6USxpesja8m3489OOaMBw@mail.gmail.com>
References: <52F43764.8060301@witthoft.com>
	<CAAmySGMZBpYxs8VuZi4Z8+hEPfbct6USxpesja8m3489OOaMBw@mail.gmail.com>
Message-ID: <52F4AE74.2060405@gmail.com>

As a mathematician by training (and a former practicing mathematician, 
both of which qualifications I rarely feel compelled to pull out of the 
closet), I have to agree with Michael's challenge to the original 
assertion about the "mathematical concept of sets".

Sets are collections of distinct objects (at least in Cantors' original 
naive definition) and do not have a notion of "duplicate values".  In 
the modern axiomatic definition, one axiom is that "two sets are equal 
if and only if they contain the same members". To expand on Michael's 
example, the union of {1, 2} with {1, 3} is {1, 2, 3}, not {1, 2, 1, 3} 
since there is only one distinct object designated by the value "1".

A computer programming language could choose to use the ordered vector 
(or list) [1, 2, 1, 3] as an internal representation of the union of 
[1,2], and [1,3], but it would then have to work hard to perform every 
other meaningful set operation.  For instance, the cardinality of the 
union still has to equal three (not four, which is the length of the 
list), since there are exactly three distinct objects that are members. 
And, as Michael points out, the set represented by [1,2,3] has to be 
equal to the set represented by [1,2,1,3] since they contain exactly the 
same members.

   Kevin

On 2/6/2014 9:39 PM, R. Michael Weylandt wrote:
> On Thu, Feb 6, 2014 at 8:31 PM, Carl Witthoft <carl at witthoft.com> wrote:
>> First, let me apologize in advance if this is the wrong place to submit a
>> suggestion for a change to functions in the base-R package.  It never really
>> occurred to me that I'd have an idea worthy of such a change.
>>
>> My idea is to provide an upgrade to all the "sets" tools (intersect, union,
>> setdiff, setequal) that allows the user to apply them in a strictly
>> algebraic style.
>>
>> The current tools, as well documented, remove duplicate values in the input
>> vectors.  This can be helpful in stats work, but is inconsistent with the
>> mathematical concept of sets and set measure.
> No comments about back-compatability concerns, etc. but why do you
> think this is closer to the "mathematical concept of sets"? As I
> learned them, sets have no repeats (or order) and other languages with
> set primitives tend to agree:
>
> python> {1,1,2,3} == {1,2,3}
> True
>
> I believe C++ calls what you're looking for a multiset (albeit with a
> guarantee or orderedness).
>
> Cheers,
> Michael
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Fri Feb  7 13:37:33 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 07 Feb 2014 07:37:33 -0500
Subject: [Rd] suggestion for "sets" tools upgrade
In-Reply-To: <52F43764.8060301@witthoft.com>
References: <52F43764.8060301@witthoft.com>
Message-ID: <52F4D38D.4070608@gmail.com>

On 14-02-06 8:31 PM, Carl Witthoft wrote:
> First, let me apologize in advance if this is the wrong place to submit
> a suggestion for a change to functions in the base-R package.  It never
> really occurred to me that I'd have an idea worthy of such a change.
>
> My idea is to provide an upgrade to all the "sets" tools (intersect,
> union, setdiff, setequal) that allows the user to apply them in a
> strictly algebraic style.
>
> The current tools, as well documented, remove duplicate values in the
> input vectors.  This can be helpful in stats work, but is inconsistent
> with the mathematical concept of sets and set measure.

I understand what you are asking for, but I think this justification for 
it is just wrong.  Sets don't have duplicated elements:  an element is 
in a set, or it is not.  It can't be in the set more than once.



What I propose
> is that all these functions be given an additional argument with a
> default value:  "multiple=FALSE" .  When called this way, the functions
> remain as at present.  When called with "multiple=TRUE,"  they treat the
> input vectors as true 'sets' of elements.
>
> I've already written and tested upgrades to all four functions, so if
> upgrading the base-R package is not appropriate, I'll post as a package
> to CRAN.  It just seems more sensible to add to the base.
>
> Thanks in advance for any advice or comments.
> (Please be sure to email, as I can't recall if I'm currently registered
> for r-devel)
>
> Here's an example of the new code:
>
> intersect<-function (x, y,multiple=FALSE)
> {
>       y <- as.vector(y)
> 	trueint <- y[match(as.vector(x), y, 0L)]
>       if(!multiple) trueint <- unique(trueint)
> 	return(trueint)
> }

This is not symmetric.  I'd like intersect(x,y,TRUE) to be the same as 
intersect(y,x,TRUE), up to re-ordering.  That's not true of your function:

 > x <- c(1,1,2,3)
 > y <- c(1,1,1,4)
 > intersect(x,y,multiple=TRUE)
[1] 1 1
 > intersect(y,x,multiple=TRUE)
[1] 1 1 1

I'd suggest that you clearly define what you mean by your functions, and 
put them in a package, along with examples where they give more useful 
results than the standard definitions.  I think the current base package 
functions match the mathematical definitions better.

Duncan Murdoch


From sannandi at umail.iu.edu  Fri Feb  7 19:15:35 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Fri, 7 Feb 2014 10:15:35 -0800
Subject: [Rd] How to set user read request while R install
Message-ID: <CAGSjAUCt6cHCKKyJYOgdj70e=srFK5fRKyPezZ6ce714iwpUmg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140207/c9fe7378/attachment.pl>

From simon.urbanek at r-project.org  Fri Feb  7 20:16:04 2014
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 7 Feb 2014 14:16:04 -0500
Subject: [Rd] How to set user read request while R install
In-Reply-To: <CAGSjAUCt6cHCKKyJYOgdj70e=srFK5fRKyPezZ6ce714iwpUmg@mail.gmail.com>
References: <CAGSjAUCt6cHCKKyJYOgdj70e=srFK5fRKyPezZ6ce714iwpUmg@mail.gmail.com>
Message-ID: <86172722-59D1-4F06-9063-7C39BA49FBE6@r-project.org>

Sandip,

this has nothing to do with R but rather your restrictive umask setting. If you want others to have rx permissions, change your umask to something like 0022 which is more commonly used (please see unix documentation on the concepts involved).

Cheers,
Simon


On Feb 7, 2014, at 1:15 PM, Sandip Nandi <sannandi at umail.iu.edu> wrote:

> Hi ,
> 
> I have installed R on my system and the user access control looks like this
> 
> -rwxr-x*---* 1 root root 10578117 Feb  3 11:26 libR.so
> 
> I have installed R as root , but the access control for other is not
> enabled by default ( at least Read option) .
> This can be solved using linux ways, but I am interested to know if there
> is any way to mention while we run R or install R packages.
> 
> What I am trying to achieve ?
> 
>   We have multinode system , and some tool will install R and other
> packages in all nodes. But the software which will access R run as
> different user and not able to read . If R has some functionality while
> installing , it can be performed easily else some manual work need to done.
> 
> Thanks,
> Sandip
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From sannandi at umail.iu.edu  Fri Feb  7 21:06:06 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Fri, 7 Feb 2014 12:06:06 -0800
Subject: [Rd] How to set user read request while R install
In-Reply-To: <86172722-59D1-4F06-9063-7C39BA49FBE6@r-project.org>
References: <CAGSjAUCt6cHCKKyJYOgdj70e=srFK5fRKyPezZ6ce714iwpUmg@mail.gmail.com>
	<86172722-59D1-4F06-9063-7C39BA49FBE6@r-project.org>
Message-ID: <CAGSjAUBiXqrJarjmn0ezeQfZmzCX0YFn=Bf-HiJ7XFa8Q0UCnw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140207/ce84179a/attachment.pl>

From carl at witthoft.com  Fri Feb  7 22:11:24 2014
From: carl at witthoft.com (Carl Witthoft)
Date: Fri, 07 Feb 2014 16:11:24 -0500
Subject: [Rd] suggestion for "sets" tools upgrade
In-Reply-To: <52F4D38D.4070608@gmail.com>
References: <52F43764.8060301@witthoft.com> <52F4D38D.4070608@gmail.com>
Message-ID: <52F54BFC.2010608@witthoft.com>

Thanks to Duncan and all who responded.

I agree that the algebraic set rules do not allow for indistinguishable 
elements;  I must have been deeply immersed in quantum fermions when I 
wrote "strictly" rather than "less" in front of "algebraic style.

I'll clean up my code (so that intersect() remains symmetric, among 
other things) , and submit as a separate package to CRAN.

Carl


On 2/7/14 7:37 AM, Duncan Murdoch wrote:
> On 14-02-06 8:31 PM, Carl Witthoft wrote:

>> My idea is to provide an upgrade to all the "sets" tools (intersect,
>> union, setdiff, setequal) that allows the user to apply them in a
>> strictly algebraic style.
>>
>> The current tools, as well documented, remove duplicate values in the
>> input vectors.  This can be helpful in stats work, but is inconsistent
>> with the mathematical concept of sets and set measure.
>
> I understand what you are asking for, but I think this justification for
> it is just wrong.  Sets don't have duplicated elements:  an element is
> in a set, or it is not.  It can't be in the set more than once.
>
>
>
> What I propose
>> is that all these functions be given an additional argument with a
>> default value:  "multiple=FALSE" .  When called this way, the functions
>> remain as at present.  When called with "multiple=TRUE,"  they treat the
>> input vectors as true 'sets' of elements.

>> Here's an example of the new code:
>>
>> intersect<-function (x, y,multiple=FALSE)
>> {
>>       y <- as.vector(y)
>>     trueint <- y[match(as.vector(x), y, 0L)]
>>       if(!multiple) trueint <- unique(trueint)
>>     return(trueint)
>> }
>
> This is not symmetric.  I'd like intersect(x,y,TRUE) to be the same as
> intersect(y,x,TRUE), up to re-ordering.  That's not true of your function:
>
>  > x <- c(1,1,2,3)
>  > y <- c(1,1,1,4)
>  > intersect(x,y,multiple=TRUE)
> [1] 1 1
>  > intersect(y,x,multiple=TRUE)
> [1] 1 1 1
>
> I'd suggest that you clearly define what you mean by your functions, and
> put them in a package, along with examples where they give more useful
> results than the standard definitions.  I think the current base package
> functions match the mathematical definitions better.
>
> Duncan Murdoch
>
>

-- 

Sent from a parallel universe almost, but not entirely,
nothing at all like this one.


From csardi.gabor at gmail.com  Sat Feb  8 16:19:20 2014
From: csardi.gabor at gmail.com (=?ISO-8859-1?B?R+Fib3IgQ3PhcmRp?=)
Date: Sat, 8 Feb 2014 10:19:20 -0500
Subject: [Rd] Redefining .Call
Message-ID: <CABtg=K=bj7fSrR04=0ujACwV59T1H-L48JfRbiXKhFaTynPq+g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140208/a98c87aa/attachment.pl>

From simon.urbanek at r-project.org  Sat Feb  8 16:44:21 2014
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sat, 8 Feb 2014 10:44:21 -0500
Subject: [Rd] Redefining .Call
In-Reply-To: <CABtg=K=bj7fSrR04=0ujACwV59T1H-L48JfRbiXKhFaTynPq+g@mail.gmail.com>
References: <CABtg=K=bj7fSrR04=0ujACwV59T1H-L48JfRbiXKhFaTynPq+g@mail.gmail.com>
Message-ID: <B230B0A8-60CD-48DA-A540-259BDF93070F@r-project.org>

G?bor,

On Feb 8, 2014, at 10:19 AM, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:

> Hi All,
> 
> is there a caveat in redefining .Call in a package? (Apart from the
> performance hit of the extra function call.)
> 

Why don't you just do s/\.Call/myCall/g in R/* instead? That would be a bit less dangerous in case you forget about it or need to use .Call in some cases.


> I want to execute a check every time I call back to C, and this seems to be
> the easiest solution, instead of modifying all functions of the package. It
> also seems to be a good way to supply the PACKAGE argument, btw.
> 

Ideally, you should not be using PACKAGE in the first place - it's mostly for backwards compatibility. Modern packages should be using cached symbols created by useDynLib() since they are much faster than looking up symbols for every call which unnecessary and  slow.

Cheers,
Simon


> I guess this is a good solution, but I might have overlooked something.
> 
> Thanks,
> Gabor
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From csardi.gabor at gmail.com  Sat Feb  8 17:12:02 2014
From: csardi.gabor at gmail.com (=?ISO-8859-1?B?R+Fib3IgQ3PhcmRp?=)
Date: Sat, 8 Feb 2014 11:12:02 -0500
Subject: [Rd] Redefining .Call
In-Reply-To: <B230B0A8-60CD-48DA-A540-259BDF93070F@r-project.org>
References: <CABtg=K=bj7fSrR04=0ujACwV59T1H-L48JfRbiXKhFaTynPq+g@mail.gmail.com>
	<B230B0A8-60CD-48DA-A540-259BDF93070F@r-project.org>
Message-ID: <CABtg=Kk3nz14vpNXa+Z5=c-dy0mrxK-BQJKCM9n-RoCBYD+=6g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140208/8ef390e0/attachment.pl>

From ripley at stats.ox.ac.uk  Sun Feb  9 10:10:17 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 09 Feb 2014 09:10:17 +0000
Subject: [Rd] suggested addition to 'install.packages' help file
In-Reply-To: <52F3D386.5040006@pburns.seanet.com>
References: <52F3D386.5040006@pburns.seanet.com>
Message-ID: <52F745F9.4030302@stats.ox.ac.uk>

On 06/02/2014 18:25, Patrick Burns wrote:
> I suggest that there be an additional sentence
> in the explanation for the 'repos' argument in
> the help file for 'install.packages':
>
> If the repository is on a local drive, then the
> string should begin with \code{file:}, e.g.,
> \code{"file:J:/Rrepos"}.
>
>
> Perhaps I'm missing some subtlety, but it makes
> things work in my case.

You are (more than one).  The help says

    repos: character vector, the base URL(s) of the repositories to use,

A file:// scheme *is* a URL, but how to specify it correctly is 
described under ?url.  'Local drive' is a not a portable concept, but a 
repository on a file system mounted on the same machine may also be 
accessible via a http:// scheme.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From carl at witthoft.com  Sun Feb  9 14:07:51 2014
From: carl at witthoft.com (Carl Witthoft)
Date: Sun, 09 Feb 2014 08:07:51 -0500
Subject: [Rd] suggestion for "sets" tools upgrade
In-Reply-To: <21239.19601.645124.801661@fangorn.hornik.net>
References: <52F43764.8060301@witthoft.com>	<52F4D38D.4070608@gmail.com>	<52F54BFC.2010608@witthoft.com>
	<21239.19601.645124.801661@fangorn.hornik.net>
Message-ID: <52F77DA7.1020505@witthoft.com>

No, I wasn't, so thanks for pointing me to that package.  I think I'll 
still post my new toys, because "sets"  fails the "obvious for dummies" 
test.  I looked at the documentation, and while it's clearly a very 
powerful collection of functions, it's not obvious exactly what the 
family of "cset_*" tools do or don't do.
The stuff I'm writing is,  I hope :-), much easier to learn and remember 
for the casual or occasional user.   De gustibus non disputandum applies 
here.

Carl


On 2/9/14 4:38 AM, Kurt Hornik wrote:
>>>>>> Carl Witthoft writes:
>
>> Thanks to Duncan and all who responded.
>> I agree that the algebraic set rules do not allow for indistinguishable
>> elements;  I must have been deeply immersed in quantum fermions when I
>> wrote "strictly" rather than "less" in front of "algebraic style.
>
>> I'll clean up my code (so that intersect() remains symmetric, among
>> other things) , and submit as a separate package to CRAN.
>
>> Carl
>
> Btw, you are aware of the "sets" package on CRAN (which does the
> multisets I think you were asking for)?
>
> Best
> -k

-- 

Sent from a parallel universe almost, but not entirely,
nothing at all like this one.


From kevinushey at gmail.com  Mon Feb 10 07:52:13 2014
From: kevinushey at gmail.com (Kevin Ushey)
Date: Sun, 9 Feb 2014 22:52:13 -0800
Subject: [Rd] Question re: NA, NaNs in R
Message-ID: <CAJXgQP2M4N5EyL2RmYZT6qMwx9BQgnhmEM=2WDj0MccPxC4TFg@mail.gmail.com>

Hi R-devel,

I have a question about the differentiation between NA and NaN values
as implemented in R. In arithmetic.c, we have

int R_IsNA(double x)
{
    if (isnan(x)) {
ieee_double y;
y.value = x;
return (y.word[lw] == 1954);
    }
    return 0;
}

ieee_double is just used for type punning so we can check the final
bits and see if they're equal to 1954; if they are, x is NA, if
they're not, x is NaN (as defined for R_IsNaN).

My question is -- I can see a substantial increase in speed (on my
computer, in certain cases) if I replace this check with

int R_IsNA(double x)
{
    return memcmp(
        (char*)(&x),
        (char*)(&NA_REAL),
        sizeof(double)
    ) == 0;
}

IIUC, there is only one bit pattern used to encode R NA values, so
this should be safe. But I would like to be sure:

Is there any guarantee that the different functions in R would return
NA as identical to the bit pattern defined for NA_REAL, for a given
architecture? Similarly for NaN value(s) and R_NaN?

My guess is that it is possible some functions used internally by R
might encode NaN values differently; ie, setting the lower word to a
value different than 1954 (hence being NaN, but potentially not
identical to R_NaN), or perhaps this is architecture-dependent.
However, NA should be one specific bit pattern (?). And, I wonder if
there is any guarantee that the different functions used in R would
return an NaN value as identical to R_NaN (which appears to be the
'IEEE NaN')?

(interested parties can see + run a simple benchmark from the gist at
https://gist.github.com/kevinushey/8911432)

Thanks,
Kevin


From ripley at stats.ox.ac.uk  Mon Feb 10 08:11:05 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Feb 2014 07:11:05 +0000
Subject: [Rd] Question re: NA, NaNs in R
In-Reply-To: <CAJXgQP2M4N5EyL2RmYZT6qMwx9BQgnhmEM=2WDj0MccPxC4TFg@mail.gmail.com>
References: <CAJXgQP2M4N5EyL2RmYZT6qMwx9BQgnhmEM=2WDj0MccPxC4TFg@mail.gmail.com>
Message-ID: <52F87B89.2040607@stats.ox.ac.uk>

There is one NA but mulitple NaNs.

And please re-read 'man memcmp': your cast is wrong.

On 10/02/2014 06:52, Kevin Ushey wrote:
> Hi R-devel,
>
> I have a question about the differentiation between NA and NaN values
> as implemented in R. In arithmetic.c, we have
>
> int R_IsNA(double x)
> {
>      if (isnan(x)) {
> ieee_double y;
> y.value = x;
> return (y.word[lw] == 1954);
>      }
>      return 0;
> }
>
> ieee_double is just used for type punning so we can check the final
> bits and see if they're equal to 1954; if they are, x is NA, if
> they're not, x is NaN (as defined for R_IsNaN).
>
> My question is -- I can see a substantial increase in speed (on my
> computer, in certain cases) if I replace this check with
>
> int R_IsNA(double x)
> {
>      return memcmp(
>          (char*)(&x),
>          (char*)(&NA_REAL),
>          sizeof(double)
>      ) == 0;
> }
>
> IIUC, there is only one bit pattern used to encode R NA values, so
> this should be safe. But I would like to be sure:
>
> Is there any guarantee that the different functions in R would return
> NA as identical to the bit pattern defined for NA_REAL, for a given
> architecture? Similarly for NaN value(s) and R_NaN?
>
> My guess is that it is possible some functions used internally by R
> might encode NaN values differently; ie, setting the lower word to a
> value different than 1954 (hence being NaN, but potentially not
> identical to R_NaN), or perhaps this is architecture-dependent.
> However, NA should be one specific bit pattern (?). And, I wonder if
> there is any guarantee that the different functions used in R would
> return an NaN value as identical to R_NaN (which appears to be the
> 'IEEE NaN')?
>
> (interested parties can see + run a simple benchmark from the gist at
> https://gist.github.com/kevinushey/8911432)
>
> Thanks,
> Kevin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mtmorgan at fhcrc.org  Mon Feb 10 08:24:33 2014
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sun, 09 Feb 2014 23:24:33 -0800
Subject: [Rd] eapply duplicates elements unnecessarily
Message-ID: <52F87EB1.3020101@fhcrc.org>

eapply duplicates the elements of the environment it is being applied to

 > env = new.env(); x = 1; tracemem(x)
[1] "<0x1758cd18>"
 > env[["x"]] = x
 > xx <- eapply(env, length)
tracemem[0x1758cd18 -> 0x1758cbc8]: eapply

but duplication seems unnecessary. I think this is because of 'duplicate' in 
FrameValues (envir.c:2402). It's hard to tell what contract FrameValues is 
living up to, but is  INCREMENT_NAMED() sufficient? (the PROTECT on value in 
line 2398 also seems unnecessary -- it must already be protected?)

Martin
-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From timhesterberg at gmail.com  Mon Feb 10 16:21:28 2014
From: timhesterberg at gmail.com (Tim Hesterberg)
Date: Mon, 10 Feb 2014 07:21:28 -0800
Subject: [Rd] Question re: NA, NaNs in R
In-Reply-To: <52F87B89.2040607@stats.ox.ac.uk> (message from Prof Brian Ripley
	on Mon, 10 Feb 2014 07:11:05 +0000)
References: <52F87B89.2040607@stats.ox.ac.uk>
Message-ID: <yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>

This isn't quite what you were asking, but might inform your choice.

R doesn't try to maintain the distinction between NA and NaN when
doing calculations, e.g.:
> NA + NaN
[1] NA
> NaN + NA
[1] NaN
So for the aggregate package, I didn't attempt to treat them differently.

The aggregate package is available at
http://www.timhesterberg.net/r-packages

Here is the inst/doc/missingValues.txt file from that package:

--------------------------------------------------
Copyright 2012 Google Inc. All Rights Reserved.
Author: Tim Hesterberg <rocket at google.com>
Distributed under GPL 2 or later.


	Handling of missing values and not-a-numbers.


Here I'll note how this package handles missing values.
I do it the way R handles them, rather than the more strict way that S+ does.

First, for terminology,
  NaN = "not-a-number", e.g. the result of 0/0
  NA  = "missing value" or "true missing value", e.g. survey non-response
  xx  = I'll uses this for the union of those, or "missing value of any kind".

For background, at the hardware level there is an IEEE standard that
specifies that certain bit patterns are NaN, and specifies that
operations involving an NaN result in another NaN.

That standard doesn't say anything about missing values, which are
important in statistics.

So what R and S+ do is to pick one of the bit patterns and declare
that to be a NA.  In other words, the NA bit pattern is a subset of
the NaN bit patterns.

At the user level, the reverse seems to hold.
You can assign either NA or NaN to an object.
But:
	is.na(x) returns TRUE for both
	is.nan(x) returns TRUE for NaN and FALSE for NA
Based on that, you'd think that NaN is a subset of NA.
To tell whether something is a true missing value do:
	(is.na(x) & !is.nan(x))

The S+ convention is that any operation involving NA results in an NA;
otherwise any operation involving NaN results in NaN.

The R convention is that any operation involving xx results in an xx;
a missing value of any kind results in another missing value of any
kind.  R considers NA and NaN equivalent for testing purposes:
	all.equal(NA_real_, NaN)
gives TRUE.

Some R functions follow the S+ convention, e.g. the Math2 functions
in src/main/arithmetic.c use this macro:
#define if_NA_Math2_set(y,a,b)				\
	if      (ISNA (a) || ISNA (b)) y = NA_REAL;	\
	else if (ISNAN(a) || ISNAN(b)) y = R_NaN;

Other R functions, like the basic arithmetic operations +-/*^,
do not (search for PLUSOP in src/main/arithmetic.c).
They just let the hardware do the calculations.
As a result, you can get odd results like
> is.nan(NA_real_ + NaN)
[1] FALSE
> is.nan(NaN + NA_real_)
[1] TRUE

The R help files help(is.na) and help(is.nan) suggest that
computations involving NA and NaN are indeterminate.

It is faster to use the R convention; most operations are just
handled by the hardware, without extra work.

In cases like sum(x, na.rm=TRUE), the help file specifies that both NA
and NaN are removed.




>There is one NA but mulitple NaNs.
>
>And please re-read 'man memcmp': your cast is wrong.
>
>On 10/02/2014 06:52, Kevin Ushey wrote:
>> Hi R-devel,
>>
>> I have a question about the differentiation between NA and NaN values
>> as implemented in R. In arithmetic.c, we have
>>
>> int R_IsNA(double x)
>> {
>>      if (isnan(x)) {
>> ieee_double y;
>> y.value = x;
>> return (y.word[lw] == 1954);
>>      }
>>      return 0;
>> }
>>
>> ieee_double is just used for type punning so we can check the final
>> bits and see if they're equal to 1954; if they are, x is NA, if
>> they're not, x is NaN (as defined for R_IsNaN).
>>
>> My question is -- I can see a substantial increase in speed (on my
>> computer, in certain cases) if I replace this check with
>>
>> int R_IsNA(double x)
>> {
>>      return memcmp(
>>          (char*)(&x),
>>          (char*)(&NA_REAL),
>>          sizeof(double)
>>      ) == 0;
>> }
>>
>> IIUC, there is only one bit pattern used to encode R NA values, so
>> this should be safe. But I would like to be sure:
>>
>> Is there any guarantee that the different functions in R would return
>> NA as identical to the bit pattern defined for NA_REAL, for a given
>> architecture? Similarly for NaN value(s) and R_NaN?
>>
>> My guess is that it is possible some functions used internally by R
>> might encode NaN values differently; ie, setting the lower word to a
>> value different than 1954 (hence being NaN, but potentially not
>> identical to R_NaN), or perhaps this is architecture-dependent.
>> However, NA should be one specific bit pattern (?). And, I wonder if
>> there is any guarantee that the different functions used in R would
>> return an NaN value as identical to R_NaN (which appears to be the
>> 'IEEE NaN')?
>>
>> (interested parties can see + run a simple benchmark from the gist at
>> https://gist.github.com/kevinushey/8911432)
>>
>> Thanks,
>> Kevin
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>--
>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From dale.w.steele at gmail.com  Mon Feb 10 16:06:51 2014
From: dale.w.steele at gmail.com (eleetselad)
Date: Mon, 10 Feb 2014 07:06:51 -0800 (PST)
Subject: [Rd] Stata support in package foreign
In-Reply-To: <52E0D117.7040505@stats.ox.ac.uk>
References: <52E0D117.7040505@stats.ox.ac.uk>
Message-ID: <1392044811148-4685037.post@n4.nabble.com>

FWIW, documentation .dta from Stata 13::

http://www.stata.com/help.cgi?dta

"Stata 13 writes what are
    known as .dta format-117 files and can read all formats of files that
    have ever been released.  The recent history of .dta formats is


        Format        Current as of
        ---------------------------------------
          117         Stata 13 
          116         internal; never released
          115         Stata 12
          114         Stata 10
          113         Stata  8
        ---------------------------------------


    Format 117 is documented below..."



--
View this message in context: http://r.789695.n4.nabble.com/Stata-support-in-package-foreign-tp4684022p4685037.html
Sent from the R devel mailing list archive at Nabble.com.


From kevinushey at gmail.com  Mon Feb 10 18:47:13 2014
From: kevinushey at gmail.com (Kevin Ushey)
Date: Mon, 10 Feb 2014 09:47:13 -0800
Subject: [Rd] Question re: NA, NaNs in R
In-Reply-To: <yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>
References: <52F87B89.2040607@stats.ox.ac.uk>
	<yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>
Message-ID: <CAJXgQP397f8fk6mKN1ggo72x+=Y04fwZsVnAADsY7iyscpk_vg@mail.gmail.com>

Thanks Tim, this is exactly the explanation I was hoping to see. Much
appreciated!

On Mon, Feb 10, 2014 at 7:21 AM, Tim Hesterberg <timhesterberg at gmail.com> wrote:
> This isn't quite what you were asking, but might inform your choice.
>
> R doesn't try to maintain the distinction between NA and NaN when
> doing calculations, e.g.:
>> NA + NaN
> [1] NA
>> NaN + NA
> [1] NaN
> So for the aggregate package, I didn't attempt to treat them differently.
>
> The aggregate package is available at
> http://www.timhesterberg.net/r-packages
>
> Here is the inst/doc/missingValues.txt file from that package:
>
> --------------------------------------------------
> Copyright 2012 Google Inc. All Rights Reserved.
> Author: Tim Hesterberg <rocket at google.com>
> Distributed under GPL 2 or later.
>
>
>         Handling of missing values and not-a-numbers.
>
>
> Here I'll note how this package handles missing values.
> I do it the way R handles them, rather than the more strict way that S+ does.
>
> First, for terminology,
>   NaN = "not-a-number", e.g. the result of 0/0
>   NA  = "missing value" or "true missing value", e.g. survey non-response
>   xx  = I'll uses this for the union of those, or "missing value of any kind".
>
> For background, at the hardware level there is an IEEE standard that
> specifies that certain bit patterns are NaN, and specifies that
> operations involving an NaN result in another NaN.
>
> That standard doesn't say anything about missing values, which are
> important in statistics.
>
> So what R and S+ do is to pick one of the bit patterns and declare
> that to be a NA.  In other words, the NA bit pattern is a subset of
> the NaN bit patterns.
>
> At the user level, the reverse seems to hold.
> You can assign either NA or NaN to an object.
> But:
>         is.na(x) returns TRUE for both
>         is.nan(x) returns TRUE for NaN and FALSE for NA
> Based on that, you'd think that NaN is a subset of NA.
> To tell whether something is a true missing value do:
>         (is.na(x) & !is.nan(x))
>
> The S+ convention is that any operation involving NA results in an NA;
> otherwise any operation involving NaN results in NaN.
>
> The R convention is that any operation involving xx results in an xx;
> a missing value of any kind results in another missing value of any
> kind.  R considers NA and NaN equivalent for testing purposes:
>         all.equal(NA_real_, NaN)
> gives TRUE.
>
> Some R functions follow the S+ convention, e.g. the Math2 functions
> in src/main/arithmetic.c use this macro:
> #define if_NA_Math2_set(y,a,b)                          \
>         if      (ISNA (a) || ISNA (b)) y = NA_REAL;     \
>         else if (ISNAN(a) || ISNAN(b)) y = R_NaN;
>
> Other R functions, like the basic arithmetic operations +-/*^,
> do not (search for PLUSOP in src/main/arithmetic.c).
> They just let the hardware do the calculations.
> As a result, you can get odd results like
>> is.nan(NA_real_ + NaN)
> [1] FALSE
>> is.nan(NaN + NA_real_)
> [1] TRUE
>
> The R help files help(is.na) and help(is.nan) suggest that
> computations involving NA and NaN are indeterminate.
>
> It is faster to use the R convention; most operations are just
> handled by the hardware, without extra work.
>
> In cases like sum(x, na.rm=TRUE), the help file specifies that both NA
> and NaN are removed.
>
>
>
>
>>There is one NA but mulitple NaNs.
>>
>>And please re-read 'man memcmp': your cast is wrong.
>>
>>On 10/02/2014 06:52, Kevin Ushey wrote:
>>> Hi R-devel,
>>>
>>> I have a question about the differentiation between NA and NaN values
>>> as implemented in R. In arithmetic.c, we have
>>>
>>> int R_IsNA(double x)
>>> {
>>>      if (isnan(x)) {
>>> ieee_double y;
>>> y.value = x;
>>> return (y.word[lw] == 1954);
>>>      }
>>>      return 0;
>>> }
>>>
>>> ieee_double is just used for type punning so we can check the final
>>> bits and see if they're equal to 1954; if they are, x is NA, if
>>> they're not, x is NaN (as defined for R_IsNaN).
>>>
>>> My question is -- I can see a substantial increase in speed (on my
>>> computer, in certain cases) if I replace this check with
>>>
>>> int R_IsNA(double x)
>>> {
>>>      return memcmp(
>>>          (char*)(&x),
>>>          (char*)(&NA_REAL),
>>>          sizeof(double)
>>>      ) == 0;
>>> }
>>>
>>> IIUC, there is only one bit pattern used to encode R NA values, so
>>> this should be safe. But I would like to be sure:
>>>
>>> Is there any guarantee that the different functions in R would return
>>> NA as identical to the bit pattern defined for NA_REAL, for a given
>>> architecture? Similarly for NaN value(s) and R_NaN?
>>>
>>> My guess is that it is possible some functions used internally by R
>>> might encode NaN values differently; ie, setting the lower word to a
>>> value different than 1954 (hence being NaN, but potentially not
>>> identical to R_NaN), or perhaps this is architecture-dependent.
>>> However, NA should be one specific bit pattern (?). And, I wonder if
>>> there is any guarantee that the different functions used in R would
>>> return an NaN value as identical to R_NaN (which appears to be the
>>> 'IEEE NaN')?
>>>
>>> (interested parties can see + run a simple benchmark from the gist at
>>> https://gist.github.com/kevinushey/8911432)
>>>
>>> Thanks,
>>> Kevin
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>--
>>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>University of Oxford,             Tel:  +44 1865 272861 (self)
>>1 South Parks Road,                     +44 1865 272866 (PA)
>>Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch.duncan at gmail.com  Mon Feb 10 19:07:51 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 10 Feb 2014 13:07:51 -0500
Subject: [Rd] Question re: NA, NaNs in R
In-Reply-To: <yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>
References: <52F87B89.2040607@stats.ox.ac.uk>
	<yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>
Message-ID: <52F91577.9060807@gmail.com>

On 10/02/2014 10:21 AM, Tim Hesterberg wrote:
> This isn't quite what you were asking, but might inform your choice.
>
> R doesn't try to maintain the distinction between NA and NaN when
> doing calculations, e.g.:
> > NA + NaN
> [1] NA
> > NaN + NA
> [1] NaN
> So for the aggregate package, I didn't attempt to treat them differently.

This looks like a bug to me.  In 32 bit 3.0.2 and R-patched I see

 > NA + NaN
[1] NA
 > NaN + NA
[1] NA

This seems more reasonable to me.  NA should propagate.  (I can see an 
argument for NaN for the answer here, as I can't think of any possible 
non-missing value that would give anything else when added to NaN, but 
the answer should not depend on the order of operands.)

However, I get the same as you in 64 bit 3.0.2.  All calculations I've 
shown are on 64 bit Windows 7.

Duncan Murdoch


>
> The aggregate package is available at
> http://www.timhesterberg.net/r-packages
>
> Here is the inst/doc/missingValues.txt file from that package:
>
> --------------------------------------------------
> Copyright 2012 Google Inc. All Rights Reserved.
> Author: Tim Hesterberg <rocket at google.com>
> Distributed under GPL 2 or later.
>
>
> 	Handling of missing values and not-a-numbers.
>
>
> Here I'll note how this package handles missing values.
> I do it the way R handles them, rather than the more strict way that S+ does.
>
> First, for terminology,
>    NaN = "not-a-number", e.g. the result of 0/0
>    NA  = "missing value" or "true missing value", e.g. survey non-response
>    xx  = I'll uses this for the union of those, or "missing value of any kind".
>
> For background, at the hardware level there is an IEEE standard that
> specifies that certain bit patterns are NaN, and specifies that
> operations involving an NaN result in another NaN.
>
> That standard doesn't say anything about missing values, which are
> important in statistics.
>
> So what R and S+ do is to pick one of the bit patterns and declare
> that to be a NA.  In other words, the NA bit pattern is a subset of
> the NaN bit patterns.
>
> At the user level, the reverse seems to hold.
> You can assign either NA or NaN to an object.
> But:
> 	is.na(x) returns TRUE for both
> 	is.nan(x) returns TRUE for NaN and FALSE for NA
> Based on that, you'd think that NaN is a subset of NA.
> To tell whether something is a true missing value do:
> 	(is.na(x) & !is.nan(x))
>
> The S+ convention is that any operation involving NA results in an NA;
> otherwise any operation involving NaN results in NaN.
>
> The R convention is that any operation involving xx results in an xx;
> a missing value of any kind results in another missing value of any
> kind.  R considers NA and NaN equivalent for testing purposes:
> 	all.equal(NA_real_, NaN)
> gives TRUE.
>
> Some R functions follow the S+ convention, e.g. the Math2 functions
> in src/main/arithmetic.c use this macro:
> #define if_NA_Math2_set(y,a,b)				\
> 	if      (ISNA (a) || ISNA (b)) y = NA_REAL;	\
> 	else if (ISNAN(a) || ISNAN(b)) y = R_NaN;
>
> Other R functions, like the basic arithmetic operations +-/*^,
> do not (search for PLUSOP in src/main/arithmetic.c).
> They just let the hardware do the calculations.
> As a result, you can get odd results like
> > is.nan(NA_real_ + NaN)
> [1] FALSE
> > is.nan(NaN + NA_real_)
> [1] TRUE
>
> The R help files help(is.na) and help(is.nan) suggest that
> computations involving NA and NaN are indeterminate.
>
> It is faster to use the R convention; most operations are just
> handled by the hardware, without extra work.
>
> In cases like sum(x, na.rm=TRUE), the help file specifies that both NA
> and NaN are removed.
>
>
>
>
> >There is one NA but mulitple NaNs.
> >
> >And please re-read 'man memcmp': your cast is wrong.
> >
> >On 10/02/2014 06:52, Kevin Ushey wrote:
> >> Hi R-devel,
> >>
> >> I have a question about the differentiation between NA and NaN values
> >> as implemented in R. In arithmetic.c, we have
> >>
> >> int R_IsNA(double x)
> >> {
> >>      if (isnan(x)) {
> >> ieee_double y;
> >> y.value = x;
> >> return (y.word[lw] == 1954);
> >>      }
> >>      return 0;
> >> }
> >>
> >> ieee_double is just used for type punning so we can check the final
> >> bits and see if they're equal to 1954; if they are, x is NA, if
> >> they're not, x is NaN (as defined for R_IsNaN).
> >>
> >> My question is -- I can see a substantial increase in speed (on my
> >> computer, in certain cases) if I replace this check with
> >>
> >> int R_IsNA(double x)
> >> {
> >>      return memcmp(
> >>          (char*)(&x),
> >>          (char*)(&NA_REAL),
> >>          sizeof(double)
> >>      ) == 0;
> >> }
> >>
> >> IIUC, there is only one bit pattern used to encode R NA values, so
> >> this should be safe. But I would like to be sure:
> >>
> >> Is there any guarantee that the different functions in R would return
> >> NA as identical to the bit pattern defined for NA_REAL, for a given
> >> architecture? Similarly for NaN value(s) and R_NaN?
> >>
> >> My guess is that it is possible some functions used internally by R
> >> might encode NaN values differently; ie, setting the lower word to a
> >> value different than 1954 (hence being NaN, but potentially not
> >> identical to R_NaN), or perhaps this is architecture-dependent.
> >> However, NA should be one specific bit pattern (?). And, I wonder if
> >> there is any guarantee that the different functions used in R would
> >> return an NaN value as identical to R_NaN (which appears to be the
> >> 'IEEE NaN')?
> >>
> >> (interested parties can see + run a simple benchmark from the gist at
> >> https://gist.github.com/kevinushey/8911432)
> >>
> >> Thanks,
> >> Kevin
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> >
> >--
> >Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >University of Oxford,             Tel:  +44 1865 272861 (self)
> >1 South Parks Road,                     +44 1865 272866 (PA)
> >Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From kevinushey at gmail.com  Mon Feb 10 19:43:50 2014
From: kevinushey at gmail.com (Kevin Ushey)
Date: Mon, 10 Feb 2014 10:43:50 -0800
Subject: [Rd] Question re: NA, NaNs in R
In-Reply-To: <52F91577.9060807@gmail.com>
References: <52F87B89.2040607@stats.ox.ac.uk>
	<yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>
	<52F91577.9060807@gmail.com>
Message-ID: <CAJXgQP1dvCiZDKqkaryXGMYgAhqjrZvPzZivfvXEXwLN7DwPiQ@mail.gmail.com>

Also, similarly, to clarify, should there be _one_ unique bit pattern
for R's NA_REAL, or two? Because I see (for a function hex that
produces the hex representation of a number):

> hex(NA_real_)
[1] "7FF00000000007A2"
> hex(NA_real_+1)
[1] "7FF80000000007A2"
> hex(NaN)
[1] "7FF8000000000000"

This is with 64-bit R (on OS X Mavericks, R-devel r64910), as well. I
also noticed in a conversation of Arun (co-author of data.table) that:

On 32-bit R-2.15.3:

NA: 7ff80000000007a2
NaN: 7ff8000000000000

On 64-bit version of R-2.15.3
NA: 7ff00000000007a2
NaN: 7ff8000000000000

Notice that the initial bit pattern is 7ff0, rather than 7ff8, for
64-bit R. Is this intentional?

Thanks,
Kevin

(function follows:)

// assume size of double, unsigned long long is the same
SEXP hex(SEXP x) {

  // double is 8 bytes, each byte can be represented by 2 hex chars,
  // so need a str with 16+1 slots
  int n = sizeof(unsigned long long) * 2 + 1;

  unsigned long long *xx = (unsigned long long*) REAL(x);
  char buf[n];
  snprintf(buf, n, "%016llX", *xx);
  SEXP output = PROTECT(allocVector(STRSXP, 1));
  SET_STRING_ELT(output, 0, mkChar(buf));
  UNPROTECT(1);
  return output;
}

On Mon, Feb 10, 2014 at 10:07 AM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 10/02/2014 10:21 AM, Tim Hesterberg wrote:
>>
>> This isn't quite what you were asking, but might inform your choice.
>>
>> R doesn't try to maintain the distinction between NA and NaN when
>> doing calculations, e.g.:
>> > NA + NaN
>> [1] NA
>> > NaN + NA
>> [1] NaN
>> So for the aggregate package, I didn't attempt to treat them differently.
>
>
> This looks like a bug to me.  In 32 bit 3.0.2 and R-patched I see
>
>
>> NA + NaN
> [1] NA
>> NaN + NA
> [1] NA
>
> This seems more reasonable to me.  NA should propagate.  (I can see an
> argument for NaN for the answer here, as I can't think of any possible
> non-missing value that would give anything else when added to NaN, but the
> answer should not depend on the order of operands.)
>
> However, I get the same as you in 64 bit 3.0.2.  All calculations I've shown
> are on 64 bit Windows 7.
>
> Duncan Murdoch
>
>
>
>>
>> The aggregate package is available at
>> http://www.timhesterberg.net/r-packages
>>
>> Here is the inst/doc/missingValues.txt file from that package:
>>
>> --------------------------------------------------
>> Copyright 2012 Google Inc. All Rights Reserved.
>> Author: Tim Hesterberg <rocket at google.com>
>> Distributed under GPL 2 or later.
>>
>>
>>         Handling of missing values and not-a-numbers.
>>
>>
>> Here I'll note how this package handles missing values.
>> I do it the way R handles them, rather than the more strict way that S+
>> does.
>>
>> First, for terminology,
>>    NaN = "not-a-number", e.g. the result of 0/0
>>    NA  = "missing value" or "true missing value", e.g. survey non-response
>>    xx  = I'll uses this for the union of those, or "missing value of any
>> kind".
>>
>> For background, at the hardware level there is an IEEE standard that
>> specifies that certain bit patterns are NaN, and specifies that
>> operations involving an NaN result in another NaN.
>>
>> That standard doesn't say anything about missing values, which are
>> important in statistics.
>>
>> So what R and S+ do is to pick one of the bit patterns and declare
>> that to be a NA.  In other words, the NA bit pattern is a subset of
>> the NaN bit patterns.
>>
>> At the user level, the reverse seems to hold.
>> You can assign either NA or NaN to an object.
>> But:
>>         is.na(x) returns TRUE for both
>>         is.nan(x) returns TRUE for NaN and FALSE for NA
>> Based on that, you'd think that NaN is a subset of NA.
>> To tell whether something is a true missing value do:
>>         (is.na(x) & !is.nan(x))
>>
>> The S+ convention is that any operation involving NA results in an NA;
>> otherwise any operation involving NaN results in NaN.
>>
>> The R convention is that any operation involving xx results in an xx;
>> a missing value of any kind results in another missing value of any
>> kind.  R considers NA and NaN equivalent for testing purposes:
>>         all.equal(NA_real_, NaN)
>> gives TRUE.
>>
>> Some R functions follow the S+ convention, e.g. the Math2 functions
>> in src/main/arithmetic.c use this macro:
>> #define if_NA_Math2_set(y,a,b)                          \
>>         if      (ISNA (a) || ISNA (b)) y = NA_REAL;     \
>>         else if (ISNAN(a) || ISNAN(b)) y = R_NaN;
>>
>> Other R functions, like the basic arithmetic operations +-/*^,
>> do not (search for PLUSOP in src/main/arithmetic.c).
>> They just let the hardware do the calculations.
>> As a result, you can get odd results like
>> > is.nan(NA_real_ + NaN)
>> [1] FALSE
>> > is.nan(NaN + NA_real_)
>> [1] TRUE
>>
>> The R help files help(is.na) and help(is.nan) suggest that
>> computations involving NA and NaN are indeterminate.
>>
>> It is faster to use the R convention; most operations are just
>> handled by the hardware, without extra work.
>>
>> In cases like sum(x, na.rm=TRUE), the help file specifies that both NA
>> and NaN are removed.
>>
>>
>>
>>
>> >There is one NA but mulitple NaNs.
>> >
>> >And please re-read 'man memcmp': your cast is wrong.
>> >
>> >On 10/02/2014 06:52, Kevin Ushey wrote:
>> >> Hi R-devel,
>> >>
>> >> I have a question about the differentiation between NA and NaN values
>> >> as implemented in R. In arithmetic.c, we have
>> >>
>> >> int R_IsNA(double x)
>> >> {
>> >>      if (isnan(x)) {
>> >> ieee_double y;
>> >> y.value = x;
>> >> return (y.word[lw] == 1954);
>> >>      }
>> >>      return 0;
>> >> }
>> >>
>> >> ieee_double is just used for type punning so we can check the final
>> >> bits and see if they're equal to 1954; if they are, x is NA, if
>> >> they're not, x is NaN (as defined for R_IsNaN).
>> >>
>> >> My question is -- I can see a substantial increase in speed (on my
>> >> computer, in certain cases) if I replace this check with
>> >>
>> >> int R_IsNA(double x)
>> >> {
>> >>      return memcmp(
>> >>          (char*)(&x),
>> >>          (char*)(&NA_REAL),
>> >>          sizeof(double)
>> >>      ) == 0;
>> >> }
>> >>
>> >> IIUC, there is only one bit pattern used to encode R NA values, so
>> >> this should be safe. But I would like to be sure:
>> >>
>> >> Is there any guarantee that the different functions in R would return
>> >> NA as identical to the bit pattern defined for NA_REAL, for a given
>> >> architecture? Similarly for NaN value(s) and R_NaN?
>> >>
>> >> My guess is that it is possible some functions used internally by R
>> >> might encode NaN values differently; ie, setting the lower word to a
>> >> value different than 1954 (hence being NaN, but potentially not
>> >> identical to R_NaN), or perhaps this is architecture-dependent.
>> >> However, NA should be one specific bit pattern (?). And, I wonder if
>> >> there is any guarantee that the different functions used in R would
>> >> return an NaN value as identical to R_NaN (which appears to be the
>> >> 'IEEE NaN')?
>> >>
>> >> (interested parties can see + run a simple benchmark from the gist at
>> >> https://gist.github.com/kevinushey/8911432)
>> >>
>> >> Thanks,
>> >> Kevin
>> >>
>> >> ______________________________________________
>> >> R-devel at r-project.org mailing list
>> >> https://stat.ethz.ch/mailman/listinfo/r-devel
>> >>
>> >
>> >
>> >--
>> >Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> >Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> >University of Oxford,             Tel:  +44 1865 272861 (self)
>> >1 South Parks Road,                     +44 1865 272866 (PA)
>> >Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From murdoch.duncan at gmail.com  Mon Feb 10 20:06:10 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 10 Feb 2014 14:06:10 -0500
Subject: [Rd] Question re: NA, NaNs in R
In-Reply-To: <CAJXgQP1dvCiZDKqkaryXGMYgAhqjrZvPzZivfvXEXwLN7DwPiQ@mail.gmail.com>
References: <52F87B89.2040607@stats.ox.ac.uk>	<yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>	<52F91577.9060807@gmail.com>
	<CAJXgQP1dvCiZDKqkaryXGMYgAhqjrZvPzZivfvXEXwLN7DwPiQ@mail.gmail.com>
Message-ID: <52F92322.3000406@gmail.com>

On 10/02/2014 1:43 PM, Kevin Ushey wrote:
> Also, similarly, to clarify, should there be _one_ unique bit pattern
> for R's NA_REAL, or two? Because I see (for a function hex that
> produces the hex representation of a number):

I don't think the language definition defines bit patterns, it defines 
behaviour.  If both of those bit patterns behave correctly, then it's 
fine.  (I see the same patterns as you do in 64 bit R-patched, but only 
the 2nd in 32 bit R).

Now, perhaps we should define the bit pattern for NA_real_ to make the 
optimization you're looking into a bit easier; I don't know if that's 
trivial or hard.

Duncan Murdoch

>
> > hex(NA_real_)
> [1] "7FF00000000007A2"
> > hex(NA_real_+1)
> [1] "7FF80000000007A2"
> > hex(NaN)
> [1] "7FF8000000000000"
>
> This is with 64-bit R (on OS X Mavericks, R-devel r64910), as well. I
> also noticed in a conversation of Arun (co-author of data.table) that:
>
> On 32-bit R-2.15.3:
>
> NA: 7ff80000000007a2
> NaN: 7ff8000000000000
>
> On 64-bit version of R-2.15.3
> NA: 7ff00000000007a2
> NaN: 7ff8000000000000
>
> Notice that the initial bit pattern is 7ff0, rather than 7ff8, for
> 64-bit R. Is this intentional?
>
> Thanks,
> Kevin
>
> (function follows:)
>
> // assume size of double, unsigned long long is the same
> SEXP hex(SEXP x) {
>
>    // double is 8 bytes, each byte can be represented by 2 hex chars,
>    // so need a str with 16+1 slots
>    int n = sizeof(unsigned long long) * 2 + 1;
>
>    unsigned long long *xx = (unsigned long long*) REAL(x);
>    char buf[n];
>    snprintf(buf, n, "%016llX", *xx);
>    SEXP output = PROTECT(allocVector(STRSXP, 1));
>    SET_STRING_ELT(output, 0, mkChar(buf));
>    UNPROTECT(1);
>    return output;
> }
>
> On Mon, Feb 10, 2014 at 10:07 AM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
> > On 10/02/2014 10:21 AM, Tim Hesterberg wrote:
> >>
> >> This isn't quite what you were asking, but might inform your choice.
> >>
> >> R doesn't try to maintain the distinction between NA and NaN when
> >> doing calculations, e.g.:
> >> > NA + NaN
> >> [1] NA
> >> > NaN + NA
> >> [1] NaN
> >> So for the aggregate package, I didn't attempt to treat them differently.
> >
> >
> > This looks like a bug to me.  In 32 bit 3.0.2 and R-patched I see
> >
> >
> >> NA + NaN
> > [1] NA
> >> NaN + NA
> > [1] NA
> >
> > This seems more reasonable to me.  NA should propagate.  (I can see an
> > argument for NaN for the answer here, as I can't think of any possible
> > non-missing value that would give anything else when added to NaN, but the
> > answer should not depend on the order of operands.)
> >
> > However, I get the same as you in 64 bit 3.0.2.  All calculations I've shown
> > are on 64 bit Windows 7.
> >
> > Duncan Murdoch
> >
> >
> >
> >>
> >> The aggregate package is available at
> >> http://www.timhesterberg.net/r-packages
> >>
> >> Here is the inst/doc/missingValues.txt file from that package:
> >>
> >> --------------------------------------------------
> >> Copyright 2012 Google Inc. All Rights Reserved.
> >> Author: Tim Hesterberg <rocket at google.com>
> >> Distributed under GPL 2 or later.
> >>
> >>
> >>         Handling of missing values and not-a-numbers.
> >>
> >>
> >> Here I'll note how this package handles missing values.
> >> I do it the way R handles them, rather than the more strict way that S+
> >> does.
> >>
> >> First, for terminology,
> >>    NaN = "not-a-number", e.g. the result of 0/0
> >>    NA  = "missing value" or "true missing value", e.g. survey non-response
> >>    xx  = I'll uses this for the union of those, or "missing value of any
> >> kind".
> >>
> >> For background, at the hardware level there is an IEEE standard that
> >> specifies that certain bit patterns are NaN, and specifies that
> >> operations involving an NaN result in another NaN.
> >>
> >> That standard doesn't say anything about missing values, which are
> >> important in statistics.
> >>
> >> So what R and S+ do is to pick one of the bit patterns and declare
> >> that to be a NA.  In other words, the NA bit pattern is a subset of
> >> the NaN bit patterns.
> >>
> >> At the user level, the reverse seems to hold.
> >> You can assign either NA or NaN to an object.
> >> But:
> >>         is.na(x) returns TRUE for both
> >>         is.nan(x) returns TRUE for NaN and FALSE for NA
> >> Based on that, you'd think that NaN is a subset of NA.
> >> To tell whether something is a true missing value do:
> >>         (is.na(x) & !is.nan(x))
> >>
> >> The S+ convention is that any operation involving NA results in an NA;
> >> otherwise any operation involving NaN results in NaN.
> >>
> >> The R convention is that any operation involving xx results in an xx;
> >> a missing value of any kind results in another missing value of any
> >> kind.  R considers NA and NaN equivalent for testing purposes:
> >>         all.equal(NA_real_, NaN)
> >> gives TRUE.
> >>
> >> Some R functions follow the S+ convention, e.g. the Math2 functions
> >> in src/main/arithmetic.c use this macro:
> >> #define if_NA_Math2_set(y,a,b)                          \
> >>         if      (ISNA (a) || ISNA (b)) y = NA_REAL;     \
> >>         else if (ISNAN(a) || ISNAN(b)) y = R_NaN;
> >>
> >> Other R functions, like the basic arithmetic operations +-/*^,
> >> do not (search for PLUSOP in src/main/arithmetic.c).
> >> They just let the hardware do the calculations.
> >> As a result, you can get odd results like
> >> > is.nan(NA_real_ + NaN)
> >> [1] FALSE
> >> > is.nan(NaN + NA_real_)
> >> [1] TRUE
> >>
> >> The R help files help(is.na) and help(is.nan) suggest that
> >> computations involving NA and NaN are indeterminate.
> >>
> >> It is faster to use the R convention; most operations are just
> >> handled by the hardware, without extra work.
> >>
> >> In cases like sum(x, na.rm=TRUE), the help file specifies that both NA
> >> and NaN are removed.
> >>
> >>
> >>
> >>
> >> >There is one NA but mulitple NaNs.
> >> >
> >> >And please re-read 'man memcmp': your cast is wrong.
> >> >
> >> >On 10/02/2014 06:52, Kevin Ushey wrote:
> >> >> Hi R-devel,
> >> >>
> >> >> I have a question about the differentiation between NA and NaN values
> >> >> as implemented in R. In arithmetic.c, we have
> >> >>
> >> >> int R_IsNA(double x)
> >> >> {
> >> >>      if (isnan(x)) {
> >> >> ieee_double y;
> >> >> y.value = x;
> >> >> return (y.word[lw] == 1954);
> >> >>      }
> >> >>      return 0;
> >> >> }
> >> >>
> >> >> ieee_double is just used for type punning so we can check the final
> >> >> bits and see if they're equal to 1954; if they are, x is NA, if
> >> >> they're not, x is NaN (as defined for R_IsNaN).
> >> >>
> >> >> My question is -- I can see a substantial increase in speed (on my
> >> >> computer, in certain cases) if I replace this check with
> >> >>
> >> >> int R_IsNA(double x)
> >> >> {
> >> >>      return memcmp(
> >> >>          (char*)(&x),
> >> >>          (char*)(&NA_REAL),
> >> >>          sizeof(double)
> >> >>      ) == 0;
> >> >> }
> >> >>
> >> >> IIUC, there is only one bit pattern used to encode R NA values, so
> >> >> this should be safe. But I would like to be sure:
> >> >>
> >> >> Is there any guarantee that the different functions in R would return
> >> >> NA as identical to the bit pattern defined for NA_REAL, for a given
> >> >> architecture? Similarly for NaN value(s) and R_NaN?
> >> >>
> >> >> My guess is that it is possible some functions used internally by R
> >> >> might encode NaN values differently; ie, setting the lower word to a
> >> >> value different than 1954 (hence being NaN, but potentially not
> >> >> identical to R_NaN), or perhaps this is architecture-dependent.
> >> >> However, NA should be one specific bit pattern (?). And, I wonder if
> >> >> there is any guarantee that the different functions used in R would
> >> >> return an NaN value as identical to R_NaN (which appears to be the
> >> >> 'IEEE NaN')?
> >> >>
> >> >> (interested parties can see + run a simple benchmark from the gist at
> >> >> https://gist.github.com/kevinushey/8911432)
> >> >>
> >> >> Thanks,
> >> >> Kevin
> >> >>
> >> >> ______________________________________________
> >> >> R-devel at r-project.org mailing list
> >> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >> >>
> >> >
> >> >
> >> >--
> >> >Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >> >Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >> >University of Oxford,             Tel:  +44 1865 272861 (self)
> >> >1 South Parks Road,                     +44 1865 272866 (PA)
> >> >Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >


From murdoch.duncan at gmail.com  Mon Feb 10 20:33:15 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 10 Feb 2014 14:33:15 -0500
Subject: [Rd] Question re: NA, NaNs in R
In-Reply-To: <CAJXgQP1dvCiZDKqkaryXGMYgAhqjrZvPzZivfvXEXwLN7DwPiQ@mail.gmail.com>
References: <52F87B89.2040607@stats.ox.ac.uk>	<yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>	<52F91577.9060807@gmail.com>
	<CAJXgQP1dvCiZDKqkaryXGMYgAhqjrZvPzZivfvXEXwLN7DwPiQ@mail.gmail.com>
Message-ID: <52F9297B.5000109@gmail.com>

On 10/02/2014 1:43 PM, Kevin Ushey wrote:
> Also, similarly, to clarify, should there be _one_ unique bit pattern
> for R's NA_REAL, or two? Because I see (for a function hex that
> produces the hex representation of a number):
>
> > hex(NA_real_)
> [1] "7FF00000000007A2"
> > hex(NA_real_+1)
> [1] "7FF80000000007A2"
> > hex(NaN)
> [1] "7FF8000000000000"
>
> This is with 64-bit R (on OS X Mavericks, R-devel r64910), as well. I
> also noticed in a conversation of Arun (co-author of data.table) that:

I've just taken a look at the IEEE Std 754-2008.  The encoding we use 
for NA is a "signaling NaN".  The standard says that operations on 
signaling NaN values convert them to "quiet NaN" values, with the most 
significant bit of the mantissa set.  That's the difference between your 
first and second rows.

R doesn't do all this bit twiddling, it's done in hardware.  Perhaps we 
should have chosen a quiet NaN for NA from the beginning; they stay 
quiet when you do operations on them.  However, I think the choice of 
bit pattern was made before that behaviour was mandated, and a change 
now would be quite disruptive.

Similarly, the standard doesn't say which bit pattern propagates when 
you do binary operations on two NaNs.  That's why sometimes NA + NaN is 
NA, and sometimes NaN.

Duncan Murdoch



>
> On 32-bit R-2.15.3:
>
> NA: 7ff80000000007a2
> NaN: 7ff8000000000000
>
> On 64-bit version of R-2.15.3
> NA: 7ff00000000007a2
> NaN: 7ff8000000000000
>
> Notice that the initial bit pattern is 7ff0, rather than 7ff8, for
> 64-bit R. Is this intentional?
>
> Thanks,
> Kevin
>
> (function follows:)
>
> // assume size of double, unsigned long long is the same
> SEXP hex(SEXP x) {
>
>    // double is 8 bytes, each byte can be represented by 2 hex chars,
>    // so need a str with 16+1 slots
>    int n = sizeof(unsigned long long) * 2 + 1;
>
>    unsigned long long *xx = (unsigned long long*) REAL(x);
>    char buf[n];
>    snprintf(buf, n, "%016llX", *xx);
>    SEXP output = PROTECT(allocVector(STRSXP, 1));
>    SET_STRING_ELT(output, 0, mkChar(buf));
>    UNPROTECT(1);
>    return output;
> }
>
> On Mon, Feb 10, 2014 at 10:07 AM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
> > On 10/02/2014 10:21 AM, Tim Hesterberg wrote:
> >>
> >> This isn't quite what you were asking, but might inform your choice.
> >>
> >> R doesn't try to maintain the distinction between NA and NaN when
> >> doing calculations, e.g.:
> >> > NA + NaN
> >> [1] NA
> >> > NaN + NA
> >> [1] NaN
> >> So for the aggregate package, I didn't attempt to treat them differently.
> >
> >
> > This looks like a bug to me.  In 32 bit 3.0.2 and R-patched I see
> >
> >
> >> NA + NaN
> > [1] NA
> >> NaN + NA
> > [1] NA
> >
> > This seems more reasonable to me.  NA should propagate.  (I can see an
> > argument for NaN for the answer here, as I can't think of any possible
> > non-missing value that would give anything else when added to NaN, but the
> > answer should not depend on the order of operands.)
> >
> > However, I get the same as you in 64 bit 3.0.2.  All calculations I've shown
> > are on 64 bit Windows 7.
> >
> > Duncan Murdoch
> >
> >
> >
> >>
> >> The aggregate package is available at
> >> http://www.timhesterberg.net/r-packages
> >>
> >> Here is the inst/doc/missingValues.txt file from that package:
> >>
> >> --------------------------------------------------
> >> Copyright 2012 Google Inc. All Rights Reserved.
> >> Author: Tim Hesterberg <rocket at google.com>
> >> Distributed under GPL 2 or later.
> >>
> >>
> >>         Handling of missing values and not-a-numbers.
> >>
> >>
> >> Here I'll note how this package handles missing values.
> >> I do it the way R handles them, rather than the more strict way that S+
> >> does.
> >>
> >> First, for terminology,
> >>    NaN = "not-a-number", e.g. the result of 0/0
> >>    NA  = "missing value" or "true missing value", e.g. survey non-response
> >>    xx  = I'll uses this for the union of those, or "missing value of any
> >> kind".
> >>
> >> For background, at the hardware level there is an IEEE standard that
> >> specifies that certain bit patterns are NaN, and specifies that
> >> operations involving an NaN result in another NaN.
> >>
> >> That standard doesn't say anything about missing values, which are
> >> important in statistics.
> >>
> >> So what R and S+ do is to pick one of the bit patterns and declare
> >> that to be a NA.  In other words, the NA bit pattern is a subset of
> >> the NaN bit patterns.
> >>
> >> At the user level, the reverse seems to hold.
> >> You can assign either NA or NaN to an object.
> >> But:
> >>         is.na(x) returns TRUE for both
> >>         is.nan(x) returns TRUE for NaN and FALSE for NA
> >> Based on that, you'd think that NaN is a subset of NA.
> >> To tell whether something is a true missing value do:
> >>         (is.na(x) & !is.nan(x))
> >>
> >> The S+ convention is that any operation involving NA results in an NA;
> >> otherwise any operation involving NaN results in NaN.
> >>
> >> The R convention is that any operation involving xx results in an xx;
> >> a missing value of any kind results in another missing value of any
> >> kind.  R considers NA and NaN equivalent for testing purposes:
> >>         all.equal(NA_real_, NaN)
> >> gives TRUE.
> >>
> >> Some R functions follow the S+ convention, e.g. the Math2 functions
> >> in src/main/arithmetic.c use this macro:
> >> #define if_NA_Math2_set(y,a,b)                          \
> >>         if      (ISNA (a) || ISNA (b)) y = NA_REAL;     \
> >>         else if (ISNAN(a) || ISNAN(b)) y = R_NaN;
> >>
> >> Other R functions, like the basic arithmetic operations +-/*^,
> >> do not (search for PLUSOP in src/main/arithmetic.c).
> >> They just let the hardware do the calculations.
> >> As a result, you can get odd results like
> >> > is.nan(NA_real_ + NaN)
> >> [1] FALSE
> >> > is.nan(NaN + NA_real_)
> >> [1] TRUE
> >>
> >> The R help files help(is.na) and help(is.nan) suggest that
> >> computations involving NA and NaN are indeterminate.
> >>
> >> It is faster to use the R convention; most operations are just
> >> handled by the hardware, without extra work.
> >>
> >> In cases like sum(x, na.rm=TRUE), the help file specifies that both NA
> >> and NaN are removed.
> >>
> >>
> >>
> >>
> >> >There is one NA but mulitple NaNs.
> >> >
> >> >And please re-read 'man memcmp': your cast is wrong.
> >> >
> >> >On 10/02/2014 06:52, Kevin Ushey wrote:
> >> >> Hi R-devel,
> >> >>
> >> >> I have a question about the differentiation between NA and NaN values
> >> >> as implemented in R. In arithmetic.c, we have
> >> >>
> >> >> int R_IsNA(double x)
> >> >> {
> >> >>      if (isnan(x)) {
> >> >> ieee_double y;
> >> >> y.value = x;
> >> >> return (y.word[lw] == 1954);
> >> >>      }
> >> >>      return 0;
> >> >> }
> >> >>
> >> >> ieee_double is just used for type punning so we can check the final
> >> >> bits and see if they're equal to 1954; if they are, x is NA, if
> >> >> they're not, x is NaN (as defined for R_IsNaN).
> >> >>
> >> >> My question is -- I can see a substantial increase in speed (on my
> >> >> computer, in certain cases) if I replace this check with
> >> >>
> >> >> int R_IsNA(double x)
> >> >> {
> >> >>      return memcmp(
> >> >>          (char*)(&x),
> >> >>          (char*)(&NA_REAL),
> >> >>          sizeof(double)
> >> >>      ) == 0;
> >> >> }
> >> >>
> >> >> IIUC, there is only one bit pattern used to encode R NA values, so
> >> >> this should be safe. But I would like to be sure:
> >> >>
> >> >> Is there any guarantee that the different functions in R would return
> >> >> NA as identical to the bit pattern defined for NA_REAL, for a given
> >> >> architecture? Similarly for NaN value(s) and R_NaN?
> >> >>
> >> >> My guess is that it is possible some functions used internally by R
> >> >> might encode NaN values differently; ie, setting the lower word to a
> >> >> value different than 1954 (hence being NaN, but potentially not
> >> >> identical to R_NaN), or perhaps this is architecture-dependent.
> >> >> However, NA should be one specific bit pattern (?). And, I wonder if
> >> >> there is any guarantee that the different functions used in R would
> >> >> return an NaN value as identical to R_NaN (which appears to be the
> >> >> 'IEEE NaN')?
> >> >>
> >> >> (interested parties can see + run a simple benchmark from the gist at
> >> >> https://gist.github.com/kevinushey/8911432)
> >> >>
> >> >> Thanks,
> >> >> Kevin
> >> >>
> >> >> ______________________________________________
> >> >> R-devel at r-project.org mailing list
> >> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >> >>
> >> >
> >> >
> >> >--
> >> >Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >> >Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >> >University of Oxford,             Tel:  +44 1865 272861 (self)
> >> >1 South Parks Road,                     +44 1865 272866 (PA)
> >> >Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >


From Rainer at krugs.de  Mon Feb 10 20:54:46 2014
From: Rainer at krugs.de (Rainer M Krug)
Date: Mon, 10 Feb 2014 20:54:46 +0100
Subject: [Rd] Question re: NA, NaNs in R
In-Reply-To: <52F91577.9060807@gmail.com>
References: <52F87B89.2040607@stats.ox.ac.uk>	<yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>
	<52F91577.9060807@gmail.com>
Message-ID: <52F92E86.7070408@krugs.de>



On 02/10/14, 19:07 , Duncan Murdoch wrote:
> On 10/02/2014 10:21 AM, Tim Hesterberg wrote:
>> This isn't quite what you were asking, but might inform your choice.
>>
>> R doesn't try to maintain the distinction between NA and NaN when
>> doing calculations, e.g.:
>> > NA + NaN
>> [1] NA
>> > NaN + NA
>> [1] NaN
>> So for the aggregate package, I didn't attempt to treat them differently.
> 
> This looks like a bug to me.  In 32 bit 3.0.2 and R-patched I see
> 
>> NA + NaN
> [1] NA
>> NaN + NA
> [1] NA

But under 3.0.2 patched 64 bit on Maverick:

> version
               _
platform       x86_64-apple-darwin10.8.0
arch           x86_64
os             darwin10.8.0
system         x86_64, darwin10.8.0
status         Patched
major          3
minor          0.2
year           2014
month          01
day            07
svn rev        64692
language       R
version.string R version 3.0.2 Patched (2014-01-07 r64692)
nickname       Frisbee Sailing
> NA+NaN
[1] NA
> NaN+NA
[1] NaN

> 
> This seems more reasonable to me.  NA should propagate.  (I can see an
> argument for NaN for the answer here, as I can't think of any possible
> non-missing value that would give anything else when added to NaN, but
> the answer should not depend on the order of operands.)
> 
> However, I get the same as you in 64 bit 3.0.2.  All calculations I've
> shown are on 64 bit Windows 7.
> 
> Duncan Murdoch
> 
> 
>>
>> The aggregate package is available at
>> http://www.timhesterberg.net/r-packages
>>
>> Here is the inst/doc/missingValues.txt file from that package:
>>
>> --------------------------------------------------
>> Copyright 2012 Google Inc. All Rights Reserved.
>> Author: Tim Hesterberg <rocket at google.com>
>> Distributed under GPL 2 or later.
>>
>>
>>     Handling of missing values and not-a-numbers.
>>
>>
>> Here I'll note how this package handles missing values.
>> I do it the way R handles them, rather than the more strict way that
>> S+ does.
>>
>> First, for terminology,
>>    NaN = "not-a-number", e.g. the result of 0/0
>>    NA  = "missing value" or "true missing value", e.g. survey
>> non-response
>>    xx  = I'll uses this for the union of those, or "missing value of
>> any kind".
>>
>> For background, at the hardware level there is an IEEE standard that
>> specifies that certain bit patterns are NaN, and specifies that
>> operations involving an NaN result in another NaN.
>>
>> That standard doesn't say anything about missing values, which are
>> important in statistics.
>>
>> So what R and S+ do is to pick one of the bit patterns and declare
>> that to be a NA.  In other words, the NA bit pattern is a subset of
>> the NaN bit patterns.
>>
>> At the user level, the reverse seems to hold.
>> You can assign either NA or NaN to an object.
>> But:
>>     is.na(x) returns TRUE for both
>>     is.nan(x) returns TRUE for NaN and FALSE for NA
>> Based on that, you'd think that NaN is a subset of NA.
>> To tell whether something is a true missing value do:
>>     (is.na(x) & !is.nan(x))
>>
>> The S+ convention is that any operation involving NA results in an NA;
>> otherwise any operation involving NaN results in NaN.
>>
>> The R convention is that any operation involving xx results in an xx;
>> a missing value of any kind results in another missing value of any
>> kind.  R considers NA and NaN equivalent for testing purposes:
>>     all.equal(NA_real_, NaN)
>> gives TRUE.
>>
>> Some R functions follow the S+ convention, e.g. the Math2 functions
>> in src/main/arithmetic.c use this macro:
>> #define if_NA_Math2_set(y,a,b)                \
>>     if      (ISNA (a) || ISNA (b)) y = NA_REAL;    \
>>     else if (ISNAN(a) || ISNAN(b)) y = R_NaN;
>>
>> Other R functions, like the basic arithmetic operations +-/*^,
>> do not (search for PLUSOP in src/main/arithmetic.c).
>> They just let the hardware do the calculations.
>> As a result, you can get odd results like
>> > is.nan(NA_real_ + NaN)
>> [1] FALSE
>> > is.nan(NaN + NA_real_)
>> [1] TRUE
>>
>> The R help files help(is.na) and help(is.nan) suggest that
>> computations involving NA and NaN are indeterminate.
>>
>> It is faster to use the R convention; most operations are just
>> handled by the hardware, without extra work.
>>
>> In cases like sum(x, na.rm=TRUE), the help file specifies that both NA
>> and NaN are removed.
>>
>>
>>
>>
>> >There is one NA but mulitple NaNs.
>> >
>> >And please re-read 'man memcmp': your cast is wrong.
>> >
>> >On 10/02/2014 06:52, Kevin Ushey wrote:
>> >> Hi R-devel,
>> >>
>> >> I have a question about the differentiation between NA and NaN values
>> >> as implemented in R. In arithmetic.c, we have
>> >>
>> >> int R_IsNA(double x)
>> >> {
>> >>      if (isnan(x)) {
>> >> ieee_double y;
>> >> y.value = x;
>> >> return (y.word[lw] == 1954);
>> >>      }
>> >>      return 0;
>> >> }
>> >>
>> >> ieee_double is just used for type punning so we can check the final
>> >> bits and see if they're equal to 1954; if they are, x is NA, if
>> >> they're not, x is NaN (as defined for R_IsNaN).
>> >>
>> >> My question is -- I can see a substantial increase in speed (on my
>> >> computer, in certain cases) if I replace this check with
>> >>
>> >> int R_IsNA(double x)
>> >> {
>> >>      return memcmp(
>> >>          (char*)(&x),
>> >>          (char*)(&NA_REAL),
>> >>          sizeof(double)
>> >>      ) == 0;
>> >> }
>> >>
>> >> IIUC, there is only one bit pattern used to encode R NA values, so
>> >> this should be safe. But I would like to be sure:
>> >>
>> >> Is there any guarantee that the different functions in R would return
>> >> NA as identical to the bit pattern defined for NA_REAL, for a given
>> >> architecture? Similarly for NaN value(s) and R_NaN?
>> >>
>> >> My guess is that it is possible some functions used internally by R
>> >> might encode NaN values differently; ie, setting the lower word to a
>> >> value different than 1954 (hence being NaN, but potentially not
>> >> identical to R_NaN), or perhaps this is architecture-dependent.
>> >> However, NA should be one specific bit pattern (?). And, I wonder if
>> >> there is any guarantee that the different functions used in R would
>> >> return an NaN value as identical to R_NaN (which appears to be the
>> >> 'IEEE NaN')?
>> >>
>> >> (interested parties can see + run a simple benchmark from the gist at
>> >> https://gist.github.com/kevinushey/8911432)
>> >>
>> >> Thanks,
>> >> Kevin
>> >>
>> >> ______________________________________________
>> >> R-devel at r-project.org mailing list
>> >> https://stat.ethz.ch/mailman/listinfo/r-devel
>> >>
>> >
>> >
>> >--
>> >Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> >Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> >University of Oxford,             Tel:  +44 1865 272861 (self)
>> >1 South Parks Road,                     +44 1865 272866 (PA)
>> >Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
Biology, UCT), Dipl. Phys. (Germany)

Centre of Excellence for Invasion Biology
Stellenbosch University
South Africa

Tel :       +33 - (0)9 53 10 27 44
Cell:       +33 - (0)6 85 62 59 98
Fax :       +33 - (0)9 58 10 27 44

Fax (D):    +49 - (0)3 21 21 25 22 44

email:      Rainer at krugs.de

Skype:      RMkrug

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 560 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140210/5a6f60a2/attachment.bin>

From kirill.mueller at ivt.baug.ethz.ch  Tue Feb 11 02:53:22 2014
From: kirill.mueller at ivt.baug.ethz.ch (=?ISO-8859-1?Q?Kirill_M=FCller?=)
Date: Tue, 11 Feb 2014 02:53:22 +0100
Subject: [Rd] $new cannot be accessed when running from Rscript and methods
 package is not loaded
Message-ID: <52F98292.2090209@ivt.baug.ethz.ch>

Hi


Accesses the $new method for a class defined in a package fails if the 
methods package is not loaded. I have created a test package with the 
following single code file:

newTest <- function() {
   cl <- get("someClass")
   cl$new
}

someClass <- setRefClass("someClass")

(This is similar to code actually used in the testthat package.)

If methods is not loaded, executing the newTest function fails in the 
following scenarios:

- Package "depends" on methods (scenario "depend")
- Package "imports" methods and imports either the setRefClass function 
(scenario "import-setRefClass") or the whole package (scenario 
"import-methods")

It succeeds if the newTest function calls require(methods) (scenario 
"require").

The script at 
https://raw2.github.com/krlmlr/methodsTest/master/test-all.sh creates an 
empty user library in subdirectory r-lib of the current directory, 
installs devtools, and tests the four scenarios by repeatedly installing 
the corresponding version of the package and trying to execute newTest() 
from Rscript. I have attached the output. The package itself is on 
GitHub: https://github.com/krlmlr/methodsTest , there is a branch for 
each scenario.

Why does it seem to be necessary to load the methods package here?


Best regards

Kirill


From peter.meilstrup at gmail.com  Tue Feb 11 03:22:25 2014
From: peter.meilstrup at gmail.com (Peter Meilstrup)
Date: Mon, 10 Feb 2014 18:22:25 -0800
Subject: [Rd] $new cannot be accessed when running from Rscript and
 methods package is not loaded
In-Reply-To: <52F98292.2090209@ivt.baug.ethz.ch>
References: <52F98292.2090209@ivt.baug.ethz.ch>
Message-ID: <CAJoaRhasj4wJw_o710HQLwfUEWVEh9cgZ8uf63mCLubHuOuFwg@mail.gmail.com>

Because "depends" is treated incorrectly (if I may place a value
judgement on it). I had an earlier thread on this, not sure if any
changes have taken place since then:

http://r.789695.n4.nabble.com/Dependencies-of-Imports-not-attached-td4666529.html

On Mon, Feb 10, 2014 at 5:53 PM, Kirill M?ller
<kirill.mueller at ivt.baug.ethz.ch> wrote:
> Hi
>
>
> Accesses the $new method for a class defined in a package fails if the
> methods package is not loaded. I have created a test package with the
> following single code file:
>
> newTest <- function() {
>   cl <- get("someClass")
>   cl$new
> }
>
> someClass <- setRefClass("someClass")
>
> (This is similar to code actually used in the testthat package.)
>
> If methods is not loaded, executing the newTest function fails in the
> following scenarios:
>
> - Package "depends" on methods (scenario "depend")
> - Package "imports" methods and imports either the setRefClass function
> (scenario "import-setRefClass") or the whole package (scenario
> "import-methods")
>
> It succeeds if the newTest function calls require(methods) (scenario
> "require").
>
> The script at https://raw2.github.com/krlmlr/methodsTest/master/test-all.sh
> creates an empty user library in subdirectory r-lib of the current
> directory, installs devtools, and tests the four scenarios by repeatedly
> installing the corresponding version of the package and trying to execute
> newTest() from Rscript. I have attached the output. The package itself is on
> GitHub: https://github.com/krlmlr/methodsTest , there is a branch for each
> scenario.
>
> Why does it seem to be necessary to load the methods package here?
>
>
> Best regards
>
> Kirill
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From kirill.mueller at ivt.baug.ethz.ch  Tue Feb 11 03:30:13 2014
From: kirill.mueller at ivt.baug.ethz.ch (=?ISO-8859-1?Q?Kirill_M=FCller?=)
Date: Tue, 11 Feb 2014 03:30:13 +0100
Subject: [Rd] $new cannot be accessed when running from Rscript and
 methods package is not loaded
In-Reply-To: <CAJoaRhasj4wJw_o710HQLwfUEWVEh9cgZ8uf63mCLubHuOuFwg@mail.gmail.com>
References: <52F98292.2090209@ivt.baug.ethz.ch>
	<CAJoaRhasj4wJw_o710HQLwfUEWVEh9cgZ8uf63mCLubHuOuFwg@mail.gmail.com>
Message-ID: <52F98B35.7030404@ivt.baug.ethz.ch>

On 02/11/2014 03:22 AM, Peter Meilstrup wrote:
> Because "depends" is treated incorrectly (if I may place a value
> judgement on it). I had an earlier thread on this, not sure if any
> changes have taken place since then:
>
> http://r.789695.n4.nabble.com/Dependencies-of-Imports-not-attached-td4666529.html
Peter


Thanks. Could you please clarify: The thread you mention refers to a 
scenario where a package uses another package that depends on methods. 
The issue I'm describing doesn't have this, there is only a single 
package that tries to use $new and fails. ?

On that note: A related discussion on R-devel advises depending on 
methods, but this doesn't seem to be enough in this case:

http://r.789695.n4.nabble.com/advise-on-Depends-td4678930.html


-Kirill


From edd at debian.org  Tue Feb 11 03:31:40 2014
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 10 Feb 2014 20:31:40 -0600
Subject: [Rd] $new cannot be accessed when running from Rscript and
 methods package is not loaded
In-Reply-To: <52F98292.2090209@ivt.baug.ethz.ch>
References: <52F98292.2090209@ivt.baug.ethz.ch>
Message-ID: <21241.35724.813573.176958@max.nulle.part>


On 11 February 2014 at 02:53, Kirill M?ller wrote:
| Why does it seem to be necessary to load the methods package here?

"Just use littler (TM pending)".  

It (auto-)load methods automagically, thanks to Jeff Horner.  See below.

   edd at max:~$ chmod 0755 /tmp/kirill.r 
   edd at max:~$ /tmp/kirill.r 
   [1] "refObjectGenerator"
   attr(,"package")
   [1] "methods"
   edd at max:~$ cat /tmp/kirill.r 
   #!/usr/bin/r
   
   newTest <- function() {
      cl <- get("someClass")
      cl$new
   }

   someClass <- setRefClass("someClass")
   print(class(someClass))
   edd at max:~$ 

For Rscript, you still need to load it explicitly like any other packages you
want to use.

Dirk

PS New littler release pending in a few days or weeks. The Github repo is
current and working.

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From kevinushey at gmail.com  Tue Feb 11 05:52:17 2014
From: kevinushey at gmail.com (Kevin Ushey)
Date: Mon, 10 Feb 2014 20:52:17 -0800
Subject: [Rd] Question re: NA, NaNs in R
In-Reply-To: <52F92E86.7070408@krugs.de>
References: <52F87B89.2040607@stats.ox.ac.uk>
	<yajf4n479eo7.fsf@rocket-macbookpro3.roam.corp.google.com>
	<52F91577.9060807@gmail.com> <52F92E86.7070408@krugs.de>
Message-ID: <CAJXgQP0tvyMtMRDMOZMc5n0Vuze0uAvFVq9bB4ZNUxY3rJ69Hg@mail.gmail.com>

Hi Duncan,

Thanks a ton -- I appreciate your taking the time to investigate this,
and especially even checking into the IEEE standard to clarify.

Cheers,
Kevin

On Mon, Feb 10, 2014 at 11:54 AM, Rainer M Krug <Rainer at krugs.de> wrote:
>
>
> On 02/10/14, 19:07 , Duncan Murdoch wrote:
>> On 10/02/2014 10:21 AM, Tim Hesterberg wrote:
>>> This isn't quite what you were asking, but might inform your choice.
>>>
>>> R doesn't try to maintain the distinction between NA and NaN when
>>> doing calculations, e.g.:
>>> > NA + NaN
>>> [1] NA
>>> > NaN + NA
>>> [1] NaN
>>> So for the aggregate package, I didn't attempt to treat them differently.
>>
>> This looks like a bug to me.  In 32 bit 3.0.2 and R-patched I see
>>
>>> NA + NaN
>> [1] NA
>>> NaN + NA
>> [1] NA
>
> But under 3.0.2 patched 64 bit on Maverick:
>
>> version
>                _
> platform       x86_64-apple-darwin10.8.0
> arch           x86_64
> os             darwin10.8.0
> system         x86_64, darwin10.8.0
> status         Patched
> major          3
> minor          0.2
> year           2014
> month          01
> day            07
> svn rev        64692
> language       R
> version.string R version 3.0.2 Patched (2014-01-07 r64692)
> nickname       Frisbee Sailing
>> NA+NaN
> [1] NA
>> NaN+NA
> [1] NaN
>
>>
>> This seems more reasonable to me.  NA should propagate.  (I can see an
>> argument for NaN for the answer here, as I can't think of any possible
>> non-missing value that would give anything else when added to NaN, but
>> the answer should not depend on the order of operands.)
>>
>> However, I get the same as you in 64 bit 3.0.2.  All calculations I've
>> shown are on 64 bit Windows 7.
>>
>> Duncan Murdoch
>>
>>
>>>
>>> The aggregate package is available at
>>> http://www.timhesterberg.net/r-packages
>>>
>>> Here is the inst/doc/missingValues.txt file from that package:
>>>
>>> --------------------------------------------------
>>> Copyright 2012 Google Inc. All Rights Reserved.
>>> Author: Tim Hesterberg <rocket at google.com>
>>> Distributed under GPL 2 or later.
>>>
>>>
>>>     Handling of missing values and not-a-numbers.
>>>
>>>
>>> Here I'll note how this package handles missing values.
>>> I do it the way R handles them, rather than the more strict way that
>>> S+ does.
>>>
>>> First, for terminology,
>>>    NaN = "not-a-number", e.g. the result of 0/0
>>>    NA  = "missing value" or "true missing value", e.g. survey
>>> non-response
>>>    xx  = I'll uses this for the union of those, or "missing value of
>>> any kind".
>>>
>>> For background, at the hardware level there is an IEEE standard that
>>> specifies that certain bit patterns are NaN, and specifies that
>>> operations involving an NaN result in another NaN.
>>>
>>> That standard doesn't say anything about missing values, which are
>>> important in statistics.
>>>
>>> So what R and S+ do is to pick one of the bit patterns and declare
>>> that to be a NA.  In other words, the NA bit pattern is a subset of
>>> the NaN bit patterns.
>>>
>>> At the user level, the reverse seems to hold.
>>> You can assign either NA or NaN to an object.
>>> But:
>>>     is.na(x) returns TRUE for both
>>>     is.nan(x) returns TRUE for NaN and FALSE for NA
>>> Based on that, you'd think that NaN is a subset of NA.
>>> To tell whether something is a true missing value do:
>>>     (is.na(x) & !is.nan(x))
>>>
>>> The S+ convention is that any operation involving NA results in an NA;
>>> otherwise any operation involving NaN results in NaN.
>>>
>>> The R convention is that any operation involving xx results in an xx;
>>> a missing value of any kind results in another missing value of any
>>> kind.  R considers NA and NaN equivalent for testing purposes:
>>>     all.equal(NA_real_, NaN)
>>> gives TRUE.
>>>
>>> Some R functions follow the S+ convention, e.g. the Math2 functions
>>> in src/main/arithmetic.c use this macro:
>>> #define if_NA_Math2_set(y,a,b)                \
>>>     if      (ISNA (a) || ISNA (b)) y = NA_REAL;    \
>>>     else if (ISNAN(a) || ISNAN(b)) y = R_NaN;
>>>
>>> Other R functions, like the basic arithmetic operations +-/*^,
>>> do not (search for PLUSOP in src/main/arithmetic.c).
>>> They just let the hardware do the calculations.
>>> As a result, you can get odd results like
>>> > is.nan(NA_real_ + NaN)
>>> [1] FALSE
>>> > is.nan(NaN + NA_real_)
>>> [1] TRUE
>>>
>>> The R help files help(is.na) and help(is.nan) suggest that
>>> computations involving NA and NaN are indeterminate.
>>>
>>> It is faster to use the R convention; most operations are just
>>> handled by the hardware, without extra work.
>>>
>>> In cases like sum(x, na.rm=TRUE), the help file specifies that both NA
>>> and NaN are removed.
>>>
>>>
>>>
>>>
>>> >There is one NA but mulitple NaNs.
>>> >
>>> >And please re-read 'man memcmp': your cast is wrong.
>>> >
>>> >On 10/02/2014 06:52, Kevin Ushey wrote:
>>> >> Hi R-devel,
>>> >>
>>> >> I have a question about the differentiation between NA and NaN values
>>> >> as implemented in R. In arithmetic.c, we have
>>> >>
>>> >> int R_IsNA(double x)
>>> >> {
>>> >>      if (isnan(x)) {
>>> >> ieee_double y;
>>> >> y.value = x;
>>> >> return (y.word[lw] == 1954);
>>> >>      }
>>> >>      return 0;
>>> >> }
>>> >>
>>> >> ieee_double is just used for type punning so we can check the final
>>> >> bits and see if they're equal to 1954; if they are, x is NA, if
>>> >> they're not, x is NaN (as defined for R_IsNaN).
>>> >>
>>> >> My question is -- I can see a substantial increase in speed (on my
>>> >> computer, in certain cases) if I replace this check with
>>> >>
>>> >> int R_IsNA(double x)
>>> >> {
>>> >>      return memcmp(
>>> >>          (char*)(&x),
>>> >>          (char*)(&NA_REAL),
>>> >>          sizeof(double)
>>> >>      ) == 0;
>>> >> }
>>> >>
>>> >> IIUC, there is only one bit pattern used to encode R NA values, so
>>> >> this should be safe. But I would like to be sure:
>>> >>
>>> >> Is there any guarantee that the different functions in R would return
>>> >> NA as identical to the bit pattern defined for NA_REAL, for a given
>>> >> architecture? Similarly for NaN value(s) and R_NaN?
>>> >>
>>> >> My guess is that it is possible some functions used internally by R
>>> >> might encode NaN values differently; ie, setting the lower word to a
>>> >> value different than 1954 (hence being NaN, but potentially not
>>> >> identical to R_NaN), or perhaps this is architecture-dependent.
>>> >> However, NA should be one specific bit pattern (?). And, I wonder if
>>> >> there is any guarantee that the different functions used in R would
>>> >> return an NaN value as identical to R_NaN (which appears to be the
>>> >> 'IEEE NaN')?
>>> >>
>>> >> (interested parties can see + run a simple benchmark from the gist at
>>> >> https://gist.github.com/kevinushey/8911432)
>>> >>
>>> >> Thanks,
>>> >> Kevin
>>> >>
>>> >> ______________________________________________
>>> >> R-devel at r-project.org mailing list
>>> >> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> >>
>>> >
>>> >
>>> >--
>>> >Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>> >Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>> >University of Oxford,             Tel:  +44 1865 272861 (self)
>>> >1 South Parks Road,                     +44 1865 272866 (PA)
>>> >Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
> Biology, UCT), Dipl. Phys. (Germany)
>
> Centre of Excellence for Invasion Biology
> Stellenbosch University
> South Africa
>
> Tel :       +33 - (0)9 53 10 27 44
> Cell:       +33 - (0)6 85 62 59 98
> Fax :       +33 - (0)9 58 10 27 44
>
> Fax (D):    +49 - (0)3 21 21 25 22 44
>
> email:      Rainer at krugs.de
>
> Skype:      RMkrug
>


From dusa.adrian at unibuc.ro  Tue Feb 11 13:41:19 2014
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Tue, 11 Feb 2014 14:41:19 +0200
Subject: [Rd] C headers
In-Reply-To: <CAJ=0CtA2YWcgF-VB2PApYsPKkgPpmpbR6HaTdac0E3i47koXiA@mail.gmail.com>
References: <CAJ=0CtA2YWcgF-VB2PApYsPKkgPpmpbR6HaTdac0E3i47koXiA@mail.gmail.com>
Message-ID: <CAJ=0CtB4TQDHRXL_-K-kva-nVd7qBTjbG_yC=5=CwNWBzWBspA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140211/83841326/attachment.pl>

From winstonchang1 at gmail.com  Tue Feb 11 18:06:53 2014
From: winstonchang1 at gmail.com (Winston Chang)
Date: Tue, 11 Feb 2014 11:06:53 -0600
Subject: [Rd] $new cannot be accessed when running from Rscript and
 methods package is not loaded
In-Reply-To: <21241.35724.813573.176958@max.nulle.part>
References: <52F98292.2090209@ivt.baug.ethz.ch>
	<21241.35724.813573.176958@max.nulle.part>
Message-ID: <CAFOpNVGqDm6TN0DAGy=9kckGjZsdumDpuWwKW3J_nBM5SNH=Qg@mail.gmail.com>

To state the issue that Kirill raised in a different way... A package
with S4 or reference classes and Depends:methods can throw an error
when you do something as simple as this:
  Rscript -e "mypackage::foo()"

But this will work:
  Rscript -e "library(mypackage); foo()"

This is because when mypackage has Depends:methods, calling
mypackage::foo() merely loads mypackage, and doesn't attach it -- and
when this happens, the methods package is also loaded and not
attached. In this situation, you can get errors of the type that Dirk
noted.

In contrast, library(mypackage) causes methods to be attached, and so
you won't get those errors. This seems like a problem with the
behavior of the :: operator. Why should it be that when a package is
loaded, the packages listed in Depends are not attached? Presumably,
when someone lists a package in Depends instead of Imports, it's for a
good reason, as is the case here with the methods package.

In the following thread, it's stated that the defensive approach is to
use Depends:methods -- but that's still not enough for running the
code listed above.
http://r.789695.n4.nabble.com/advise-on-Depends-td4678930.html

-Winston


On Mon, Feb 10, 2014 at 8:31 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> On 11 February 2014 at 02:53, Kirill M?ller wrote:
> | Why does it seem to be necessary to load the methods package here?
>
> "Just use littler (TM pending)".
>
> It (auto-)load methods automagically, thanks to Jeff Horner.  See below.
>
>    edd at max:~$ chmod 0755 /tmp/kirill.r
>    edd at max:~$ /tmp/kirill.r
>    [1] "refObjectGenerator"
>    attr(,"package")
>    [1] "methods"
>    edd at max:~$ cat /tmp/kirill.r
>    #!/usr/bin/r
>
>    newTest <- function() {
>       cl <- get("someClass")
>       cl$new
>    }
>
>    someClass <- setRefClass("someClass")
>    print(class(someClass))
>    edd at max:~$
>
> For Rscript, you still need to load it explicitly like any other packages you
> want to use.
>
> Dirk
>
> PS New littler release pending in a few days or weeks. The Github repo is
> current and working.
>
> --
> Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From lawrence.michael at gene.com  Tue Feb 11 19:02:18 2014
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Tue, 11 Feb 2014 10:02:18 -0800
Subject: [Rd] getting environment from "top" promise
Message-ID: <CAOQ5NycGGOcYd=cOoeODGWSkBepV0fAp_uXqsKCmqCFKbdoo8g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140211/199ed28d/attachment.pl>

From murdoch.duncan at gmail.com  Tue Feb 11 19:26:31 2014
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 11 Feb 2014 13:26:31 -0500
Subject: [Rd] $new cannot be accessed when running from Rscript and
 methods package is not loaded
In-Reply-To: <CAFOpNVGqDm6TN0DAGy=9kckGjZsdumDpuWwKW3J_nBM5SNH=Qg@mail.gmail.com>
References: <52F98292.2090209@ivt.baug.ethz.ch>	<21241.35724.813573.176958@max.nulle.part>
	<CAFOpNVGqDm6TN0DAGy=9kckGjZsdumDpuWwKW3J_nBM5SNH=Qg@mail.gmail.com>
Message-ID: <52FA6B57.5090501@gmail.com>

On 11/02/2014 12:06 PM, Winston Chang wrote:
> To state the issue that Kirill raised in a different way... A package
> with S4 or reference classes and Depends:methods can throw an error
> when you do something as simple as this:
>    Rscript -e "mypackage::foo()"
>
> But this will work:
>    Rscript -e "library(mypackage); foo()"
>
> This is because when mypackage has Depends:methods, calling
> mypackage::foo() merely loads mypackage, and doesn't attach it -- and
> when this happens, the methods package is also loaded and not
> attached. In this situation, you can get errors of the type that Dirk
> noted.
>
> In contrast, library(mypackage) causes methods to be attached, and so
> you won't get those errors. This seems like a problem with the
> behavior of the :: operator. Why should it be that when a package is
> loaded, the packages listed in Depends are not attached? Presumably,
> when someone lists a package in Depends instead of Imports, it's for a
> good reason, as is the case here with the methods package.

I think the idea is that the search list belongs to the user, and 
packages shouldn't be messing with it.  If the user doesn't have 
mypackage and methods in his/her search list, maybe there's a reason for 
that, and mypackage::foo shouldn't mess with it.

I think the real problem is that loading the mypackage namespace isn't 
enough to get the functions within it to work.

Duncan Murdoch


>
> In the following thread, it's stated that the defensive approach is to
> use Depends:methods -- but that's still not enough for running the
> code listed above.
> http://r.789695.n4.nabble.com/advise-on-Depends-td4678930.html
>
> -Winston
>
>
> On Mon, Feb 10, 2014 at 8:31 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
> >
> > On 11 February 2014 at 02:53, Kirill M?ller wrote:
> > | Why does it seem to be necessary to load the methods package here?
> >
> > "Just use littler (TM pending)".
> >
> > It (auto-)load methods automagically, thanks to Jeff Horner.  See below.
> >
> >    edd at max:~$ chmod 0755 /tmp/kirill.r
> >    edd at max:~$ /tmp/kirill.r
> >    [1] "refObjectGenerator"
> >    attr(,"package")
> >    [1] "methods"
> >    edd at max:~$ cat /tmp/kirill.r
> >    #!/usr/bin/r
> >
> >    newTest <- function() {
> >       cl <- get("someClass")
> >       cl$new
> >    }
> >
> >    someClass <- setRefClass("someClass")
> >    print(class(someClass))
> >    edd at max:~$
> >
> > For Rscript, you still need to load it explicitly like any other packages you
> > want to use.
> >
> > Dirk
> >
> > PS New littler release pending in a few days or weeks. The Github repo is
> > current and working.
> >
> > --
> > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Tue Feb 11 19:28:54 2014
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 11 Feb 2014 10:28:54 -0800
Subject: [Rd] $new cannot be accessed when running from Rscript and
 methods package is not loaded
In-Reply-To: <CAFOpNVGqDm6TN0DAGy=9kckGjZsdumDpuWwKW3J_nBM5SNH=Qg@mail.gmail.com>
References: <52F98292.2090209@ivt.baug.ethz.ch>	<21241.35724.813573.176958@max.nulle.part>
	<CAFOpNVGqDm6TN0DAGy=9kckGjZsdumDpuWwKW3J_nBM5SNH=Qg@mail.gmail.com>
Message-ID: <52FA6BE6.20100@fhcrc.org>

On 02/11/2014 09:06 AM, Winston Chang wrote:
> To state the issue that Kirill raised in a different way... A package
> with S4 or reference classes and Depends:methods can throw an error
> when you do something as simple as this:
>    Rscript -e "mypackage::foo()"
>
> But this will work:
>    Rscript -e "library(mypackage); foo()"
>
> This is because when mypackage has Depends:methods, calling
> mypackage::foo() merely loads mypackage, and doesn't attach it -- and
> when this happens, the methods package is also loaded and not
> attached. In this situation, you can get errors of the type that Dirk
> noted.
>
> In contrast, library(mypackage) causes methods to be attached, and so
> you won't get those errors. This seems like a problem with the
> behavior of the :: operator. Why should it be that when a package is
> loaded, the packages listed in Depends are not attached? Presumably,
> when someone lists a package in Depends instead of Imports, it's for a
> good reason, as is the case here with the methods package.

To me it's worth distinguishing between the particular problem associated with 
the methods package, and the more general problem encountered when PkgA fails to 
import symbols used in PkgB, and instead relies on PkgB symbols to be found on 
the search path. In the latter it seems better practice to import(PkgB) (or 
importFrom) in the NAMESPACE and probably Import: PkgB in DESCRIPTION.

> In the following thread, it's stated that the defensive approach is to
> use Depends:methods -- but that's still not enough for running the
> code listed above.
> http://r.789695.n4.nabble.com/advise-on-Depends-td4678930.html

A more defensive defensive approach might be to add

     .onLoad <- function(...) require(methods)

but this leads to either

     * checking dependencies in R code ... WARNING
     'library' or 'require' call not declared from: ?methods?
     See the information on DESCRIPTION files in the chapter 'Creating R
     packages' of the 'Writing R Extensions' manual.
     ...
     * checking R code for possible problems ... NOTE
     File ?PkgA/R/binding.R?:
       .onLoad calls:
         require(methods)

     Package startup functions should not change the search path.
     See section ?Good practice? in '?.onAttach'.

with Imports: methods, or

     * checking dependencies in R code ... NOTE
     'library' or 'require' call to ?methods? which was already attached by Depends.
       Please remove these calls from your code.
     See the information on DESCRIPTION files in the chapter 'Creating R
     packages' of the 'Writing R Extensions' manual.
     ...
     * checking R code for possible problems ... NOTE
     File ?PkgA/R/binding.R?:
       .onLoad calls:
         require(methods)

     Package startup functions should not change the search path.
     See section ?Good practice? in '?.onAttach'.

with Depends: methods

So is there really any WARNING / NOTE-free way of using the methods package?

Martin

>
> -Winston
>
>
> On Mon, Feb 10, 2014 at 8:31 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
>>
>> On 11 February 2014 at 02:53, Kirill M?ller wrote:
>> | Why does it seem to be necessary to load the methods package here?
>>
>> "Just use littler (TM pending)".
>>
>> It (auto-)load methods automagically, thanks to Jeff Horner.  See below.
>>
>>     edd at max:~$ chmod 0755 /tmp/kirill.r
>>     edd at max:~$ /tmp/kirill.r
>>     [1] "refObjectGenerator"
>>     attr(,"package")
>>     [1] "methods"
>>     edd at max:~$ cat /tmp/kirill.r
>>     #!/usr/bin/r
>>
>>     newTest <- function() {
>>        cl <- get("someClass")
>>        cl$new
>>     }
>>
>>     someClass <- setRefClass("someClass")
>>     print(class(someClass))
>>     edd at max:~$
>>
>> For Rscript, you still need to load it explicitly like any other packages you
>> want to use.
>>
>> Dirk
>>
>> PS New littler release pending in a few days or weeks. The Github repo is
>> current and working.
>>
>> --
>> Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From simon.urbanek at r-project.org  Tue Feb 11 22:27:14 2014
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 11 Feb 2014 16:27:14 -0500
Subject: [Rd] $new cannot be accessed when running from Rscript and
	methods package is not loaded
In-Reply-To: <52FA6BE6.20100@fhcrc.org>
References: <52F98292.2090209@ivt.baug.ethz.ch>	<21241.35724.813573.176958@max.nulle.part>
	<CAFOpNVGqDm6TN0DAGy=9kckGjZsdumDpuWwKW3J_nBM5SNH=Qg@mail.gmail.com>
	<52FA6BE6.20100@fhcrc.org>
Message-ID: <93CB91C9-ADED-4870-A8B3-10392A43395D@r-project.org>


On Feb 11, 2014, at 1:28 PM, Martin Morgan <mtmorgan at fhcrc.org> wrote:

> On 02/11/2014 09:06 AM, Winston Chang wrote:
>> To state the issue that Kirill raised in a different way... A package
>> with S4 or reference classes and Depends:methods can throw an error
>> when you do something as simple as this:
>>   Rscript -e "mypackage::foo()"
>> 
>> But this will work:
>>   Rscript -e "library(mypackage); foo()"
>> 
>> This is because when mypackage has Depends:methods, calling
>> mypackage::foo() merely loads mypackage, and doesn't attach it -- and
>> when this happens, the methods package is also loaded and not
>> attached. In this situation, you can get errors of the type that Dirk
>> noted.
>> 
>> In contrast, library(mypackage) causes methods to be attached, and so
>> you won't get those errors. This seems like a problem with the
>> behavior of the :: operator. Why should it be that when a package is
>> loaded, the packages listed in Depends are not attached?

Because the whole point is that you don't want mypackage on the search path, otherwise you wouldn't use :: in the first place. Namespaces are about solving the namespace clutter, not exacerbating it ;).


>> Presumably,
>> when someone lists a package in Depends instead of Imports, it's for a
>> good reason, as is the case here with the methods package.
> 
> To me it's worth distinguishing between the particular problem associated with the methods package, and the more general problem encountered when PkgA fails to import symbols used in PkgB, and instead relies on PkgB symbols to be found on the search path. In the latter it seems better practice to import(PkgB) (or importFrom) in the NAMESPACE and probably Import: PkgB in DESCRIPTION.
> 
>> In the following thread, it's stated that the defensive approach is to
>> use Depends:methods -- but that's still not enough for running the
>> code listed above.
>> http://r.789695.n4.nabble.com/advise-on-Depends-td4678930.html
> 
> A more defensive defensive approach might be to add
> 
>    .onLoad <- function(...) require(methods)
> 

But that will attach methods again - not good.

I suspect the problem could be classified as bug in methods which doesn't behave correctly if not attached. I didn't look into details, but there used to be a technical problem in R C API where you could not pass the right environments to make that work (that bit me when I tried to use S4 a while ago), but I think that has been solved, so conceptually I think this is a bug that could be fixed. This sounds like something that should be possible to fix - even if it means fixing something in R to make it happen. Working around it in hacky ways mentioned here doesn't solve the underlying problem.

Cheers,
Simon


> but this leads to either
> 
>    * checking dependencies in R code ... WARNING
>    'library' or 'require' call not declared from: ?methods?
>    See the information on DESCRIPTION files in the chapter 'Creating R
>    packages' of the 'Writing R Extensions' manual.
>    ...
>    * checking R code for possible problems ... NOTE
>    File ?PkgA/R/binding.R?:
>      .onLoad calls:
>        require(methods)
> 
>    Package startup functions should not change the search path.
>    See section ?Good practice? in '?.onAttach'.
> 
> with Imports: methods, or
> 
>    * checking dependencies in R code ... NOTE
>    'library' or 'require' call to ?methods? which was already attached by Depends.
>      Please remove these calls from your code.
>    See the information on DESCRIPTION files in the chapter 'Creating R
>    packages' of the 'Writing R Extensions' manual.
>    ...
>    * checking R code for possible problems ... NOTE
>    File ?PkgA/R/binding.R?:
>      .onLoad calls:
>        require(methods)
> 
>    Package startup functions should not change the search path.
>    See section ?Good practice? in '?.onAttach'.
> 
> with Depends: methods
> 
> So is there really any WARNING / NOTE-free way of using the methods package?
> 
> Martin
> 
>> 
>> -Winston
>> 
>> 
>> On Mon, Feb 10, 2014 at 8:31 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
>>> 
>>> On 11 February 2014 at 02:53, Kirill M?ller wrote:
>>> | Why does it seem to be necessary to load the methods package here?
>>> 
>>> "Just use littler (TM pending)".
>>> 
>>> It (auto-)load methods automagically, thanks to Jeff Horner.  See below.
>>> 
>>>    edd at max:~$ chmod 0755 /tmp/kirill.r
>>>    edd at max:~$ /tmp/kirill.r
>>>    [1] "refObjectGenerator"
>>>    attr(,"package")
>>>    [1] "methods"
>>>    edd at max:~$ cat /tmp/kirill.r
>>>    #!/usr/bin/r
>>> 
>>>    newTest <- function() {
>>>       cl <- get("someClass")
>>>       cl$new
>>>    }
>>> 
>>>    someClass <- setRefClass("someClass")
>>>    print(class(someClass))
>>>    edd at max:~$
>>> 
>>> For Rscript, you still need to load it explicitly like any other packages you
>>> want to use.
>>> 
>>> Dirk
>>> 
>>> PS New littler release pending in a few days or weeks. The Github repo is
>>> current and working.
>>> 
>>> --
>>> Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 
> 
> -- 
> Computational Biology / Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N.
> PO Box 19024 Seattle, WA 98109
> 
> Location: Arnold Building M1 B861
> Phone: (206) 667-2793
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From romain at r-enthusiasts.com  Wed Feb 12 03:23:31 2014
From: romain at r-enthusiasts.com (Romain Francois)
Date: Wed, 12 Feb 2014 03:23:31 +0100
Subject: [Rd] getting environment from "top" promise
In-Reply-To: <CAOQ5NycGGOcYd=cOoeODGWSkBepV0fAp_uXqsKCmqCFKbdoo8g@mail.gmail.com>
References: <CAOQ5NycGGOcYd=cOoeODGWSkBepV0fAp_uXqsKCmqCFKbdoo8g@mail.gmail.com>
Message-ID: <0851FF0A-7462-43BA-8B03-53DAB8C34ACE@r-enthusiasts.com>

Hello, 

We have something very similar to your while loop in dplyr. 
https://github.com/hadley/dplyr/blob/02a609310184d003c2ae9e0c013bfa69fa4d257a/inst/include/tools/DataDots.h#L15

because we need to know exactly in which environment a promise is supposed to be evaluated, even though we might combine standard R evaluation with an alternative faster engine. this is the basis of what we called hybrid evaluation. 


For future work, I also have the while loop in the Promise class in Rcpp11, so that when you create a Promise in Rcpp11, its .environment() method gives you what you expect. 
https://github.com/romainfrancois/Rcpp11/blob/master/inst/include/Rcpp/Promise.h#L14 

So, this is something I find useful, although I?m not sure we are supposed to mess with promises. 

Romain

Le 11 f?vr. 2014 ? 19:02, Michael Lawrence <lawrence.michael at gene.com> a ?crit :

> Hi all,
> 
> It seems that there is a use case for obtaining the environment for the
> "top" promise. By "top", I mean following the promise chain up the call
> stack until hitting a non-promise.
> 
> S4 data containers often mimic the API of base R data structures. This
> means writing S4 methods for functions that quote their arguments, like
> with() and subset(). The methods package directly forwards any arguments
> not used for dispatch, so substitute(subset) is able to resolve the
> original quoted argument (this is not the case for naively written
> wrappers).  The problem then becomes figuring out the environment in which
> to evaluate the expression.
> 
> Consider:
> 
> setClass("A", representation(df = "data.frame"))
> 
> setMethod("subset", "A", function(x, subset) {
>  env <- parent.frame(2)
>  x at df <- x at df[eval(substitute(subset), x at df, env),,drop=FALSE]
>  x
> })
> 
> dropLowMpg <- function(x, cutoff=20) {
>  invisible(subset(x, mpg > cutoff))
> }
> 
> a <- new("A", df=mtcars)
> dropLowMpg(a)
> 
> The above works just fine, because we figured out that we need to evaluate
> in the grand-parent frame to avoid the frame of the generic call. But now
> let's assume A has a subclass B, and subset,B delegates to subset,A via
> callNextMethod(). The call stack is different, and our assumption is
> invalid.
> 
> setClass("B", representation(nrow="integer"), contains="A")
> setMethod("subset", "B", function(x, ...) {
>  ans <- callNextMethod()
>  ans at nrow <- nrow(ans at df)
>  ans
> })
> b <- new("B", df=mtcars)
> dropLowMpg(b)
> Error in eval(expr, envir, enclos) (from #3) : object 'cutoff' not found
> 
> We can fix this with a simple C function:
> SEXP top_prenv(SEXP nm, SEXP env)
> {
>  SEXP promise = findVar(nm, env);
>  while(TYPEOF(promise) == PROMSXP) {
>    env = PRENV(promise);
>    promise = PREXPR(promise);
>  }
>  return env;
> }
> 
> With R wrapper:
> top_prenv <- function(x) {
>  .Call2("top_prenv", substitute(x), parent.frame())
> }
> 
> Then this works (need to set subset,B again to reset cache):
> 
> setMethod("subset", "A", function(x, subset) {
>  env <- top_prenv(subset)
>  x at df <- x at df[eval(substitute(subset), x at df, env),,drop=FALSE]
>  x
> })
> setMethod("subset", "B", function(x, ...) {
>  ans <- callNextMethod()
>  ans at nrow <- nrow(ans at df)
>  ans
> })
> 
> b <- new("B", df=mtcars)
> dropLowMpg(b)
> 
> Would this be a useful addition to R? Is there a better way to solve this
> issue? We're using this successfully in the IRanges package now, but we'd
> like to avoid dealing with the internal details of R, and this is something
> that could be of general benefit.
> 
> Thanks,
> Michael
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From michael.haupt at oracle.com  Wed Feb 12 15:33:47 2014
From: michael.haupt at oracle.com (Michael Haupt)
Date: Wed, 12 Feb 2014 15:33:47 +0100
Subject: [Rd] FastR
In-Reply-To: <F7753B3E-DBC2-4DAD-998E-4D4C6BA95494@oracle.com>
References: <F7753B3E-DBC2-4DAD-998E-4D4C6BA95494@oracle.com>
Message-ID: <6F85F2A0-EE24-4DBA-9AC5-AC89E0EE8966@oracle.com>

Dear all,

at UseR! 2013, the FastR project was announced by Tomas Kalibera, Petr Maj, and Jan Vitek. FastR is an implementation of the R programming language in Java using AST interpretation and specialisation for improved performance. Since, the implementation has been extended to support JIT compilation, leading to performance improvements.

The goal of the project is to further the R community and its success by hoping to make the R language even higher-level and faster to meet continually evolving challenges. The implementation currently lacks many of R's features, such as data frames, S3/S4, packages, graphics, ..., but it is growing.

At this time, FastR is a collaborative effort of Purdue University, Johannes-Kepler-University Linz, and Oracle Labs. Contributions in all possible forms - tests, code, bug fixes, design hints, criticism - are very welcome!

I would like to point the R developers to the FastR project page, now on BitBucket: https://bitbucket.org/allr. The project mailing list is at https://groups.yahoo.com/neo/groups/fastr/info.

Best regards,

Michael Haupt

-- 
Dr. Michael Haupt
Principal Member of Technical Staff
Phone: +49 331 200 7277, Fax: +49 331 200 7561
Oracle Labs
Oracle Deutschland B.V. & Co. KG, Schiffbauergasse 14, 14467 Potsdam, Germany


From marc_schwartz at me.com  Wed Feb 12 17:28:34 2014
From: marc_schwartz at me.com (Marc Schwartz)
Date: Wed, 12 Feb 2014 10:28:34 -0600
Subject: [Rd] path.package() versus system.file() for locating installed
 package folders
Message-ID: <0E72299F-E12F-4B64-8399-96B960E12A6C@me.com>

Hi all,

For several years, I have used path.package() to get the path to Perl scripts contained within WriteXLS.

I have a request to change this to using system.file(), which would provide the ability to utilize WriteXLS functionality, without having to load the package, which path.package() requires.

Based upon my review of the code, I don't see any obvious down sides to making the change, but wanted to solicit comments from anyone that might challenge the change in the code.

Thanks in advance.

Regards,

Marc Schwartz


From ripley at stats.ox.ac.uk  Wed Feb 12 18:05:05 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 12 Feb 2014 17:05:05 +0000
Subject: [Rd] path.package() versus system.file() for locating installed
 package folders
In-Reply-To: <0E72299F-E12F-4B64-8399-96B960E12A6C@me.com>
References: <0E72299F-E12F-4B64-8399-96B960E12A6C@me.com>
Message-ID: <52FBA9C1.9020707@stats.ox.ac.uk>

On 12/02/2014 16:28, Marc Schwartz wrote:
> Hi all,
>
> For several years, I have used path.package() to get the path to Perl scripts contained within WriteXLS.
>
> I have a request to change this to using system.file(), which would provide the ability to utilize WriteXLS functionality, without having to load the package, which path.package() requires.
>
> Based upon my review of the code, I don't see any obvious down sides to making the change, but wanted to solicit comments from anyone that might challenge the change in the code.
>
> Thanks in advance.
>
> Regards,
>
> Marc Schwartz

I don't think path.package() ever was the right tool: find.package() 
looks a closer match, and system.file() is a wrapper for it (which was 
all that was made available for many years: up to R 2.13.0 AFAIR).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From marc_schwartz at me.com  Wed Feb 12 18:29:38 2014
From: marc_schwartz at me.com (Marc Schwartz)
Date: Wed, 12 Feb 2014 11:29:38 -0600
Subject: [Rd] path.package() versus system.file() for locating installed
 package folders
In-Reply-To: <52FBA9C1.9020707@stats.ox.ac.uk>
References: <0E72299F-E12F-4B64-8399-96B960E12A6C@me.com>
	<52FBA9C1.9020707@stats.ox.ac.uk>
Message-ID: <F4B65696-31EE-4C39-BFC1-E2D0314A9C25@me.com>


On Feb 12, 2014, at 11:05 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:

> On 12/02/2014 16:28, Marc Schwartz wrote:
>> Hi all,
>> 
>> For several years, I have used path.package() to get the path to Perl scripts contained within WriteXLS.
>> 
>> I have a request to change this to using system.file(), which would provide the ability to utilize WriteXLS functionality, without having to load the package, which path.package() requires.
>> 
>> Based upon my review of the code, I don't see any obvious down sides to making the change, but wanted to solicit comments from anyone that might challenge the change in the code.
>> 
>> Thanks in advance.
>> 
>> Regards,
>> 
>> Marc Schwartz
> 
> I don't think path.package() ever was the right tool: find.package() looks a closer match, and system.file() is a wrapper for it (which was all that was made available for many years: up to R 2.13.0 AFAIR).


Thanks.

I don't, at this point, recall the history as to why I elected to use path.package(), but my guess is that I looked at some subset of other CRAN packages at the time that also included script files and used them as a model. In hindsight, not the best approach.

Regards,

Marc


> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From winstonchang1 at gmail.com  Wed Feb 12 22:15:35 2014
From: winstonchang1 at gmail.com (Winston Chang)
Date: Wed, 12 Feb 2014 15:15:35 -0600
Subject: [Rd] $new cannot be accessed when running from Rscript and
 methods package is not loaded
In-Reply-To: <93CB91C9-ADED-4870-A8B3-10392A43395D@r-project.org>
References: <52F98292.2090209@ivt.baug.ethz.ch>
	<21241.35724.813573.176958@max.nulle.part>
	<CAFOpNVGqDm6TN0DAGy=9kckGjZsdumDpuWwKW3J_nBM5SNH=Qg@mail.gmail.com>
	<52FA6BE6.20100@fhcrc.org>
	<93CB91C9-ADED-4870-A8B3-10392A43395D@r-project.org>
Message-ID: <CAFOpNVFV_WrJmeWxaHsuhh2UdrsrQ7e4Yo_aLsbZuqktZesR_w@mail.gmail.com>

On Tue, Feb 11, 2014 at 3:27 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
> I suspect the problem could be classified as bug in methods which doesn't behave correctly if not attached. I didn't look into details, but there used to be a technical problem in R C API where you could not pass the right environments to make that work (that bit me when I tried to use S4 a while ago), but I think that has been solved, so conceptually I think this is a bug that could be fixed. This sounds like something that should be possible to fix - even if it means fixing something in R to make it happen. Working around it in hacky ways mentioned here doesn't solve the underlying problem.


I agree that the best solution would for methods to work properly even
when not attached. I suspect that many people would be appreciative it
if this issue were fixed and they didn't have to resort to these hacks
and workarounds.

-Winston


From kellyhavel1989 at gmail.com  Thu Feb 13 15:24:05 2014
From: kellyhavel1989 at gmail.com (Qiang Kou)
Date: Thu, 13 Feb 2014 09:24:05 -0500
Subject: [Rd] FastR
In-Reply-To: <6F85F2A0-EE24-4DBA-9AC5-AC89E0EE8966@oracle.com>
References: <F7753B3E-DBC2-4DAD-998E-4D4C6BA95494@oracle.com>
	<6F85F2A0-EE24-4DBA-9AC5-AC89E0EE8966@oracle.com>
Message-ID: <CALD6sdYrh8p9D-cR+qSMieHr3hy85ttpTLKxUOBUZFk6H5ezzA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140213/d82b7bb1/attachment.pl>

From michael.haupt at oracle.com  Thu Feb 13 16:15:46 2014
From: michael.haupt at oracle.com (Michael Haupt)
Date: Thu, 13 Feb 2014 16:15:46 +0100
Subject: [Rd] FastR
In-Reply-To: <CALD6sdYrh8p9D-cR+qSMieHr3hy85ttpTLKxUOBUZFk6H5ezzA@mail.gmail.com>
References: <F7753B3E-DBC2-4DAD-998E-4D4C6BA95494@oracle.com>
	<6F85F2A0-EE24-4DBA-9AC5-AC89E0EE8966@oracle.com>
	<CALD6sdYrh8p9D-cR+qSMieHr3hy85ttpTLKxUOBUZFk6H5ezzA@mail.gmail.com>
Message-ID: <296B5634-5A37-4B71-97A5-AB1F425EC99A@oracle.com>

Hello,

Am 13.02.2014 um 15:24 schrieb Qiang Kou <kellyhavel1989 at gmail.com>:
> It will be really wonderful if R can run on JVM.

thank you. :-)

There are actually two currently available execution models for FastR.

1. Run atop a stock JVM: the JVM will run FastR's Truffle-based AST interpreter like a normal Java application.

2. Run atop GraalVM, which is a HotSpot VM where the Graal dynamic compiler is employed instead of the usual C1/C2 JIT compilers. The advantage of running on GraalVM is that the VM knows about Truffle, and will partially evaluate Truffle ASTs and generate machine code from them, leading to much better performance.

When built from the BitBucket repository, the default execution model is #2.

> So you moved from github (https://github.com/allr/fastr) to BitBucket ?

Yes, as the internal infrastructure we're using is 100 % Mercurial.

Best regards,

Michael Haupt

-- 
Dr. Michael Haupt
Principal Member of Technical Staff
Phone: +49 331 200 7277, Fax: +49 331 200 7561
Oracle Labs
Oracle Deutschland B.V. & Co. KG, Schiffbauergasse 14, 14467 Potsdam, Germany


From pburns at pburns.seanet.com  Thu Feb 13 19:12:14 2014
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Thu, 13 Feb 2014 18:12:14 +0000
Subject: [Rd] no objects apparent in built package
Message-ID: <52FD0AFE.4000107@pburns.seanet.com>

Here's a weird problem that I hope someone
can give me some hints for.

Actions:

Build a package of all R functions  -- no
compiled code.  No indication of anything
being wrong.

'require' the newly built package.

As far as the session is concerned, there
is nothing in the package.


This is being done in RStudio on Windows
with R version 3.0.2.

The package used to work.  There was a very
minor change to one function when the package
started not working.

The zip files that don't work are the same size
as the one that does work.

Thanks for any suggestions.

Pat


-- 
Patrick Burns
pburns at pburns.seanet.com
twitter: @burnsstat @portfolioprobe
http://www.portfolioprobe.com/blog
http://www.burns-stat.com
(home of:
  'Impatient R'
  'The R Inferno'
  'Tao Te Programming')


From ligges at statistik.tu-dortmund.de  Thu Feb 13 23:27:39 2014
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 13 Feb 2014 23:27:39 +0100
Subject: [Rd] no objects apparent in built package
In-Reply-To: <52FD0AFE.4000107@pburns.seanet.com>
References: <52FD0AFE.4000107@pburns.seanet.com>
Message-ID: <52FD46DB.5020707@statistik.tu-dortmund.de>



On 13.02.2014 19:12, Patrick Burns wrote:
> Here's a weird problem that I hope someone
> can give me some hints for.
>
> Actions:
>
> Build a package of all R functions  -- no
> compiled code.  No indication of anything
> being wrong.
>
> 'require' the newly built package.
>
> As far as the session is concerned, there
> is nothing in the package.

Check the NAMESPACE file?
Can you really source all functions?

Otehrwise, please make the package available.

Best,
Uwe Ligges


>
>
> This is being done in RStudio on Windows
> with R version 3.0.2.
>
> The package used to work.  There was a very
> minor change to one function when the package
> started not working.
>
> The zip files that don't work are the same size
> as the one that does work.
>
> Thanks for any suggestions.
>
> Pat
>
>


From renaud at mancala.cbio.uct.ac.za  Fri Feb 14 11:03:19 2014
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Fri, 14 Feb 2014 12:03:19 +0200
Subject: [Rd] contrib.url in non-interactive mode
Message-ID: <CAHavPHFuH55iuFjH9h5MdZkVqjS_=urDw_t-GcK8y5rxVj8SpA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140214/a29b65b8/attachment.pl>

From ripley at stats.ox.ac.uk  Fri Feb 14 11:54:38 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Feb 2014 10:54:38 +0000
Subject: [Rd] contrib.url in non-interactive mode
In-Reply-To: <CAHavPHFuH55iuFjH9h5MdZkVqjS_=urDw_t-GcK8y5rxVj8SpA@mail.gmail.com>
References: <CAHavPHFuH55iuFjH9h5MdZkVqjS_=urDw_t-GcK8y5rxVj8SpA@mail.gmail.com>
Message-ID: <52FDF5EE.6060208@stats.ox.ac.uk>

On 14/02/2014 10:03, Renaud Gaujoux wrote:
> Hi,
>
> is it intended that one cannot install packages in non-interactive mode,
> without explicitly setting a CRAN mirror (see below)?
> Couldn't a default mirror be used in that case?
> Thank you.

You seem to be talking about installing from CRAN.  The intention is 
indeed that in non-interactive use you have to select the repositories 
you want to use.  See ?setRepositories and its links.

It is up to you to set a default mirror: we have little idea where you 
live (and it may not be where your email address suggests).  Geolocation 
of mirrors had been mooted but not implemented (and in a corporate 
setting is not 100% reliable).  The whole point of mirrors is to spread 
the load: without them there would be no CRAN as the main host would not 
allow the traffic.

This would have been appropriate for R-help, if it would not have been 
answered by doing the homework required by the posting guide (which also 
requires no HTML ...).

>
> Bests,
> Renaud
>
> $ Rscript --vanilla -e "install.packages('whatever')"
> Installing package into '/home/renaud/R/x86_64-pc-linux-gnu-library/3.0'
> (as 'lib' is unspecified)
> Error in contrib.url(repos, type) :
>    trying to use CRAN without setting a mirror
> Calls: install.packages -> grep -> contrib.url
> Execution halted
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From luke-tierney at uiowa.edu  Fri Feb 14 16:40:20 2014
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Fri, 14 Feb 2014 09:40:20 -0600
Subject: [Rd] getting environment from "top" promise
In-Reply-To: <0851FF0A-7462-43BA-8B03-53DAB8C34ACE@r-enthusiasts.com>
References: <CAOQ5NycGGOcYd=cOoeODGWSkBepV0fAp_uXqsKCmqCFKbdoo8g@mail.gmail.com>
	<0851FF0A-7462-43BA-8B03-53DAB8C34ACE@r-enthusiasts.com>
Message-ID: <alpine.LFD.2.10.1402140936570.2293@nokomis.stat.uiowa.edu>

On Tue, 11 Feb 2014, Romain Francois wrote:

> Hello,
>
> We have something very similar to your while loop in dplyr.
> https://github.com/hadley/dplyr/blob/02a609310184d003c2ae9e0c013bfa69fa4d257a/inst/include/tools/DataDots.h#L15
>
> because we need to know exactly in which environment a promise is supposed to be evaluated, even though we might combine standard R evaluation with an alternative faster engine. this is the basis of what we called hybrid evaluation.
>
>
> For future work, I also have the while loop in the Promise class in Rcpp11, so that when you create a Promise in Rcpp11, its .environment() method gives you what you expect.
> https://github.com/romainfrancois/Rcpp11/blob/master/inst/include/Rcpp/Promise.h#L14
>
> So, this is something I find useful, although I?m not sure we are supposed to mess with promises.

No you are not :-)

Promises are an internal mechanism for implementing lazy
evaluation. They are convenient but also very inefficient, so they may
very well go away when a better approach becomes available.  What will
not go away is the functionality they provide -- bindings with
deferred evaluations, an expression/code for the evaluation, and an
environment (until the evaluation happens). If you build on those
concepts you will be more future proof than if you assume there will
be an internal promise object.

Best,

luke

>
> Romain
>
> Le 11 f?vr. 2014 ? 19:02, Michael Lawrence <lawrence.michael at gene.com> a ?crit :
>
>> Hi all,
>>
>> It seems that there is a use case for obtaining the environment for the
>> "top" promise. By "top", I mean following the promise chain up the call
>> stack until hitting a non-promise.
>>
>> S4 data containers often mimic the API of base R data structures. This
>> means writing S4 methods for functions that quote their arguments, like
>> with() and subset(). The methods package directly forwards any arguments
>> not used for dispatch, so substitute(subset) is able to resolve the
>> original quoted argument (this is not the case for naively written
>> wrappers).  The problem then becomes figuring out the environment in which
>> to evaluate the expression.
>>
>> Consider:
>>
>> setClass("A", representation(df = "data.frame"))
>>
>> setMethod("subset", "A", function(x, subset) {
>>  env <- parent.frame(2)
>>  x at df <- x at df[eval(substitute(subset), x at df, env),,drop=FALSE]
>>  x
>> })
>>
>> dropLowMpg <- function(x, cutoff=20) {
>>  invisible(subset(x, mpg > cutoff))
>> }
>>
>> a <- new("A", df=mtcars)
>> dropLowMpg(a)
>>
>> The above works just fine, because we figured out that we need to evaluate
>> in the grand-parent frame to avoid the frame of the generic call. But now
>> let's assume A has a subclass B, and subset,B delegates to subset,A via
>> callNextMethod(). The call stack is different, and our assumption is
>> invalid.
>>
>> setClass("B", representation(nrow="integer"), contains="A")
>> setMethod("subset", "B", function(x, ...) {
>>  ans <- callNextMethod()
>>  ans at nrow <- nrow(ans at df)
>>  ans
>> })
>> b <- new("B", df=mtcars)
>> dropLowMpg(b)
>> Error in eval(expr, envir, enclos) (from #3) : object 'cutoff' not found
>>
>> We can fix this with a simple C function:
>> SEXP top_prenv(SEXP nm, SEXP env)
>> {
>>  SEXP promise = findVar(nm, env);
>>  while(TYPEOF(promise) == PROMSXP) {
>>    env = PRENV(promise);
>>    promise = PREXPR(promise);
>>  }
>>  return env;
>> }
>>
>> With R wrapper:
>> top_prenv <- function(x) {
>>  .Call2("top_prenv", substitute(x), parent.frame())
>> }
>>
>> Then this works (need to set subset,B again to reset cache):
>>
>> setMethod("subset", "A", function(x, subset) {
>>  env <- top_prenv(subset)
>>  x at df <- x at df[eval(substitute(subset), x at df, env),,drop=FALSE]
>>  x
>> })
>> setMethod("subset", "B", function(x, ...) {
>>  ans <- callNextMethod()
>>  ans at nrow <- nrow(ans at df)
>>  ans
>> })
>>
>> b <- new("B", df=mtcars)
>> dropLowMpg(b)
>>
>> Would this be a useful addition to R? Is there a better way to solve this
>> issue? We're using this successfully in the IRanges package now, but we'd
>> like to avoid dealing with the internal details of R, and this is something
>> that could be of general benefit.
>>
>> Thanks,
>> Michael
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From b.rowlingson at lancaster.ac.uk  Fri Feb 14 19:02:11 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 14 Feb 2014 18:02:11 +0000
Subject: [Rd] contrib.url in non-interactive mode
In-Reply-To: <ba9f21e66cf34e0aae139d4f603951e2@EX-1-HT0.lancs.local>
References: <CAHavPHFuH55iuFjH9h5MdZkVqjS_=urDw_t-GcK8y5rxVj8SpA@mail.gmail.com>
	<ba9f21e66cf34e0aae139d4f603951e2@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMgdSt3v=mOhZjYYJ3u6zTkEveGUdH=ei8+L6Uvwj4N+Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140214/a9db5e7f/attachment.pl>

From romain at r-enthusiasts.com  Fri Feb 14 19:07:16 2014
From: romain at r-enthusiasts.com (Romain Francois)
Date: Fri, 14 Feb 2014 19:07:16 +0100
Subject: [Rd] getting environment from "top" promise
In-Reply-To: <alpine.LFD.2.10.1402140936570.2293@nokomis.stat.uiowa.edu>
References: <CAOQ5NycGGOcYd=cOoeODGWSkBepV0fAp_uXqsKCmqCFKbdoo8g@mail.gmail.com>
	<0851FF0A-7462-43BA-8B03-53DAB8C34ACE@r-enthusiasts.com>
	<alpine.LFD.2.10.1402140936570.2293@nokomis.stat.uiowa.edu>
Message-ID: <F71E63EB-1B18-4309-9240-E214665F7BF7@r-enthusiasts.com>


Le 14 f?vr. 2014 ? 16:40, luke-tierney at uiowa.edu a ?crit :

> On Tue, 11 Feb 2014, Romain Francois wrote:
> 
>> Hello,
>> 
>> We have something very similar to your while loop in dplyr.
>> https://github.com/hadley/dplyr/blob/02a609310184d003c2ae9e0c013bfa69fa4d257a/inst/include/tools/DataDots.h#L15
>> 
>> because we need to know exactly in which environment a promise is supposed to be evaluated, even though we might combine standard R evaluation with an alternative faster engine. this is the basis of what we called hybrid evaluation.
>> 
>> 
>> For future work, I also have the while loop in the Promise class in Rcpp11, so that when you create a Promise in Rcpp11, its .environment() method gives you what you expect.
>> https://github.com/romainfrancois/Rcpp11/blob/master/inst/include/Rcpp/Promise.h#L14
>> 
>> So, this is something I find useful, although I?m not sure we are supposed to mess with promises.
> 
> No you are not :-)

Most of what we do with them is consult them. So whenever the better approach you mention becomes available in R, we can update the Promise class and change how to get access to the expression and the environment in which it will be eventually evaluated. 

Not the first time I get ? you are not supposed to use that because we might change it ?. Experience is that that sort of changes are relatively slow to happen, so are easy to adapt to. 

Romain

> Promises are an internal mechanism for implementing lazy
> evaluation. They are convenient but also very inefficient, so they may
> very well go away when a better approach becomes available.  What will
> not go away is the functionality they provide -- bindings with
> deferred evaluations, an expression/code for the evaluation, and an
> environment (until the evaluation happens). If you build on those
> concepts you will be more future proof than if you assume there will
> be an internal promise object.
> 
> Best,
> 
> luke
> 
>> 
>> Romain
>> 
>> Le 11 f?vr. 2014 ? 19:02, Michael Lawrence <lawrence.michael at gene.com> a ?crit :
>> 
>>> Hi all,
>>> 
>>> It seems that there is a use case for obtaining the environment for the
>>> "top" promise. By "top", I mean following the promise chain up the call
>>> stack until hitting a non-promise.
>>> 
>>> S4 data containers often mimic the API of base R data structures. This
>>> means writing S4 methods for functions that quote their arguments, like
>>> with() and subset(). The methods package directly forwards any arguments
>>> not used for dispatch, so substitute(subset) is able to resolve the
>>> original quoted argument (this is not the case for naively written
>>> wrappers).  The problem then becomes figuring out the environment in which
>>> to evaluate the expression.
>>> 
>>> Consider:
>>> 
>>> setClass("A", representation(df = "data.frame"))
>>> 
>>> setMethod("subset", "A", function(x, subset) {
>>> env <- parent.frame(2)
>>> x at df <- x at df[eval(substitute(subset), x at df, env),,drop=FALSE]
>>> x
>>> })
>>> 
>>> dropLowMpg <- function(x, cutoff=20) {
>>> invisible(subset(x, mpg > cutoff))
>>> }
>>> 
>>> a <- new("A", df=mtcars)
>>> dropLowMpg(a)
>>> 
>>> The above works just fine, because we figured out that we need to evaluate
>>> in the grand-parent frame to avoid the frame of the generic call. But now
>>> let's assume A has a subclass B, and subset,B delegates to subset,A via
>>> callNextMethod(). The call stack is different, and our assumption is
>>> invalid.
>>> 
>>> setClass("B", representation(nrow="integer"), contains="A")
>>> setMethod("subset", "B", function(x, ...) {
>>> ans <- callNextMethod()
>>> ans at nrow <- nrow(ans at df)
>>> ans
>>> })
>>> b <- new("B", df=mtcars)
>>> dropLowMpg(b)
>>> Error in eval(expr, envir, enclos) (from #3) : object 'cutoff' not found
>>> 
>>> We can fix this with a simple C function:
>>> SEXP top_prenv(SEXP nm, SEXP env)
>>> {
>>> SEXP promise = findVar(nm, env);
>>> while(TYPEOF(promise) == PROMSXP) {
>>>   env = PRENV(promise);
>>>   promise = PREXPR(promise);
>>> }
>>> return env;
>>> }
>>> 
>>> With R wrapper:
>>> top_prenv <- function(x) {
>>> .Call2("top_prenv", substitute(x), parent.frame())
>>> }
>>> 
>>> Then this works (need to set subset,B again to reset cache):
>>> 
>>> setMethod("subset", "A", function(x, subset) {
>>> env <- top_prenv(subset)
>>> x at df <- x at df[eval(substitute(subset), x at df, env),,drop=FALSE]
>>> x
>>> })
>>> setMethod("subset", "B", function(x, ...) {
>>> ans <- callNextMethod()
>>> ans at nrow <- nrow(ans at df)
>>> ans
>>> })
>>> 
>>> b <- new("B", df=mtcars)
>>> dropLowMpg(b)
>>> 
>>> Would this be a useful addition to R? Is there a better way to solve this
>>> issue? We're using this successfully in the IRanges package now, but we'd
>>> like to avoid dealing with the internal details of R, and this is something
>>> that could be of general benefit.
>>> 
>>> Thanks,
>>> Michael
>>> 
>>> 	[[alternative HTML version deleted]]
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 
> -- 
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>   Actuarial Science
> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From edd at debian.org  Fri Feb 14 19:32:28 2014
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 14 Feb 2014 12:32:28 -0600
Subject: [Rd] contrib.url in non-interactive mode
In-Reply-To: <CAHavPHFuH55iuFjH9h5MdZkVqjS_=urDw_t-GcK8y5rxVj8SpA@mail.gmail.com>
References: <CAHavPHFuH55iuFjH9h5MdZkVqjS_=urDw_t-GcK8y5rxVj8SpA@mail.gmail.com>
Message-ID: <21246.24892.859506.688029@max.nulle.part>


Renaud,

The script below has been in use for about as long as littler existed, and
also ships with it. I use it, and its sibbling 'update.r' all the time. Doing
this at the command-line frees the R prompt during compilations too...

As Barry suggests, the RStudio-provided CDN is not a bad choice either as a
repo. 

Dirk

edd at max:~$ cat bin/install.r 
#!/usr/bin/env r
#
# a simple example to install one or more packages

if (is.null(argv) | length(argv)<1) {

  cat("Usage: installr.r pkg1 [pkg2 pkg3 ...]\n")
  q()

}

## adjust as necessary, see help('download.packages')
#repos <- "http://cran.us.r-project.org"
repos <- "http://cran.r-project.org"

## this makes sense on Debian where no packages touch /usr/local
lib.loc <- "/usr/local/lib/R/site-library"

install.packages(argv, lib.loc, repos)
edd at max:~$ 

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From h.wickham at gmail.com  Fri Feb 14 21:02:41 2014
From: h.wickham at gmail.com (Hadley Wickham)
Date: Fri, 14 Feb 2014 12:02:41 -0800
Subject: [Rd] contrib.url in non-interactive mode
In-Reply-To: <CANVKczMgdSt3v=mOhZjYYJ3u6zTkEveGUdH=ei8+L6Uvwj4N+Q@mail.gmail.com>
References: <CAHavPHFuH55iuFjH9h5MdZkVqjS_=urDw_t-GcK8y5rxVj8SpA@mail.gmail.com>
	<ba9f21e66cf34e0aae139d4f603951e2@EX-1-HT0.lancs.local>
	<CANVKczMgdSt3v=mOhZjYYJ3u6zTkEveGUdH=ei8+L6Uvwj4N+Q@mail.gmail.com>
Message-ID: <CABdHhvHgr4h8sXN8qcfbLj5O=Uw363KLbJYB6kQRuHhQ-O+X0A@mail.gmail.com>

>> It is up to you to set a default mirror: we have little idea where you
>> live (and it may not be where your email address suggests).  Geolocation
>> of mirrors had been mooted but not implemented (and in a corporate
>> setting is not 100% reliable).  The whole point of mirrors is to spread
>> the load: without them there would be no CRAN as the main host would not
>> allow the traffic.
>>
>>
> The RStudio CRAN mirror uses Amazon's CDN to achieve a degree of geographic
> convenience:
>
> http://blog.rstudio.org/2013/06/10/rstudio-cran-mirror/

Cloudfront, the service we use, currently has 36 locations around the
world: http://aws.amazon.com/cloudfront/details/.

Hadley

-- 
http://had.co.nz/


From whuber at embl.de  Sun Feb 16 09:46:50 2014
From: whuber at embl.de (Wolfgang Huber)
Date: Sun, 16 Feb 2014 09:46:50 +0100
Subject: [Rd]  Revolutions Blog: January 2014 roundup
Message-ID: <6539EBDA-AB13-4E06-9249-664433379701@embl.de>


FYI:

Revolution Analytics staff write about R every weekday at the Revolutions blog:
http://blog.revolutionanalytics.com
and every month I post a summary of articles from the previous month
of particular interest to readers of r-help.

In case you missed them, here are some articles related to R from the
month of January:

Princeton's Germ?n Rodr?guez has published a useful "Introduction to
R" guide, with a focus on linear and logistic regression:
http://bit.ly/1c1bero

The rxDForest function in the RevoScaleR package fits random forests
of histogram-binning trees: http://bit.ly/1b08qAq

A tutorial on using the xts package to analyze http://bit.ly/1c1bc30
and plot time series data http://bit.ly/1c1bc31

In a video interview with Trevor Hastie, John Chambers recounts the
history of S and R: http://bit.ly/1c1bern

A review of "Doing Data Science", a new book by Rachel Schutt and
Cathy O'Neil http://bit.ly/1c1berp

Hadley Wickham introduces the dplyr package, with its "grammar of data
manipulation" http://bit.ly/1c1bcje

The new choroplethr package makes it easier to create data maps in R:
http://bit.ly/1c1bcjf

A developer preview of SparkR, an interface between R and Apache
Spark, is now available: http://bit.ly/1c1berq

Joseph Rickert reviews the capabilities of R for topological data
analysis: http://bit.ly/1c1berr

In a recent survey of data scientists, R is the most-used software
tool other than SQL: http://bit.ly/1c1bers

A new JSS article on computing with massive data, and a change in
policy for acceptable JSS software licenses: http://bit.ly/1b08srV

Large scale optimization with the optim and rxDataStep functions:
http://bit.ly/1c1bert

Large enterprise software vendors with connections to R: http://bit.ly/1c1bcji

A preview of a forthcoming update to Max Kuhn's caret package, and an
interactive chart showing similarities amongst the 143 statistical and
machine learning models it supports: http://bit.ly/1c1beru

Simulation-based forecasts by combining expert opinion: http://bit.ly/1c1bcjj

Tips on getting R help: http://bit.ly/1c1bcjk

The top 10 posts on the Revolutions blog from 2013: http://bit.ly/1b08qAt

Some non-R stories in the past month included: levitation with sound
waves (http://bit.ly/1c1bcjl), the NYT's 4th Down Bot
(http://bit.ly/1c1berv), bird flight patterns (http://bit.ly/1c1bcjm),
camera magic on Vine (http://bit.ly/1c1berw), visualizing whisky
flavor profiles (http://bit.ly/1c1bcjn), the Cornsweet illusion
(http://bit.ly/1b08srW), and a one-sentence explanation of the Fourier
Transform (http://bit.ly/1c1berz).

Meeting times for local R user groups (http://bit.ly/eC5YQe) can be
found on the updated R Community Calendar at: http://bit.ly/bb3naW

If you're looking for more articles about R, you can find summaries
from previous months at http://blog.revolutionanalytics.com/roundups/.
You can receive daily blog posts via email using services like
blogtrottr.com, or join the Revolution Analytics mailing list at
http://revolutionanalytics.com/newsletter to be alerted to new
articles on a monthly basis.

As always, thanks for the comments and please keep sending suggestions
to me at david at revolutionanalytics.com . Don't forget you can also
follow the blog using an RSS reader, or by following me on Twitter
(I'm @revodavid).

Cheers,
# David

-- 
David M Smith <david at revolutionanalytics.com>
VP of Marketing, Revolution Analytics  http://blog.revolutionanalytics.com
Tel: +1 (650) 646-9523 (Seattle WA, USA)
Twitter: @revodavid

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From whuber at embl.de  Sun Feb 16 09:51:17 2014
From: whuber at embl.de (Wolfgang Huber)
Date: Sun, 16 Feb 2014 09:51:17 +0100
Subject: [Rd] Revolutions Blog: January 2014 roundup
In-Reply-To: <6539EBDA-AB13-4E06-9249-664433379701@embl.de>
References: <6539EBDA-AB13-4E06-9249-664433379701@embl.de>
Message-ID: <3C207D6E-6942-47C3-A98A-4F942C93AF31@embl.de>

My apologies. Clicked ?send? prematurely with wrong recipient.

Il giorno 16 Feb 2014, alle ore 09:46, Wolfgang Huber <whuber at embl.de> ha scritto:

> 
> FYI:
> 
> Revolution Analytics staff write about R every weekday at the Revolutions blog:
> http://blog.revolutionanalytics.com


From thosjleeper at gmail.com  Tue Feb 18 20:43:02 2014
From: thosjleeper at gmail.com (Thomas J. Leeper)
Date: Tue, 18 Feb 2014 20:43:02 +0100
Subject: [Rd] Graphical parameters xaxs/yaxs
Message-ID: <CAOC91MRdF1M2noLLhCYoa=TstaXp92ra0YqF0ZSkOuzz+eJdZw@mail.gmail.com>

The documentation for `plot.window` says:

Note that the coordinate ranges will be extended by 4% if the
appropriate graphical parameter xaxs or yaxs has value "s" (which is
the default).


Yet calling `plot.window` with xaxs or yaxs set to "s" yields an error:

> plot.window(c(0,1), c(0,1), xaxs="s")
Error in plot.window(c(0, 1), c(0, 1), xaxs = "s") :
  axis style "s" unimplemented


This is consistent with the Graphical Parameters documentation, which
reads: "Only "r" and "i" styles have been implemented in R."

Should the plot.window documentation be corrected to say "r" is the
default or am I missing something?

Thanks,
-Thomas


Thomas J. Leeper
http://www.thomasleeper.com


From hpages at fhcrc.org  Wed Feb 19 01:17:46 2014
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 18 Feb 2014 16:17:46 -0800
Subject: [Rd] dispatch on "c" method when passing named arguments
Message-ID: <5303F82A.3090805@fhcrc.org>

Hi,

Many S4 objects in Bioconductor support "combining" via a "c" method.
A common use case is to combine a collection of S4 objects stored in
a list with the following idiom:

   do.call("c", list_of_objects)

For many users this doesn't return what they expect though, because
their 'list_of_objects' is a named list and this seems to "break"
dispatch if the "c" method is defined for a parent class.

Here is an example:

   setClass("A", representation(aa="integer"))

   setMethod("c", "A",
     function(x, ..., recursive=FALSE)
     {
       if (missing(x)) {
         objects <- list(...)
         x <- objects[[1L]]
       } else {
         objects <- list(x, ...)
       }
       new(class(x), aa=unlist(lapply(objects, slot, "aa"), 
use.names=FALSE))
     }
   )

   raw_input <- list(chr1=1:3, chr2=11:12)
   list_of_A_objects <- lapply(raw_input, function(aa) new("A", aa=aa))

Then:

   > do.call("c", list_of_A_objects)
   An object of class "A"
   Slot "aa":
   [1]  1  2  3 11 12

==> all is fine.

But:

   setClass("B", contains="A")
   list_of_B_objects <- lapply(raw_input, function(aa) new("B", aa=aa))

Then:

   > do.call("c", list_of_B_objects)
   $chr1
   An object of class "B"
   Slot "aa":
   [1] 1 2 3

   $chr2
   An object of class "B"
   Slot "aa":
   [1] 11 12

==> dispatch failed!

Note that selectMethod() is not helping the user understand what's
going on:

   > selectMethod("c", "B")
   Method Definition:

   function (x, ..., recursive = FALSE)
   {
     if (missing(x)) {
         objects <- list(...)
         x <- objects[[1L]]
     }
     else {
         objects <- list(x, ...)
     }
     new(class(x), aa = unlist(lapply(objects, slot, "aa"), use.names = 
FALSE))
   }

   Signatures:
           x
   target  "B"
   defined "A"

Not obvious to realize that dispatch failed when selectMethod() has no
problem finding the expected method.

Many BioC users have been bitten by this for many years now and many
more will be. The work around is simple:

   do.call("c", unname(list_of_objects))

but not obvious for most users and easy to forget even for advanced
users.

Interestingly calling "c" with unnamed arguments seems to "repair"
the dispatch mechanism for any subsequent call:

   > do.call("c", unname(list_of_B_objects))
   An object of class "B"
   Slot "aa":
   [1]  1  2  3 11 12

   > do.call("c", list_of_B_objects)
   An object of class "B"
   Slot "aa":
   [1]  1  2  3 11 12

==> now it works even with a named list!

(Apparently some caching happened, as reported by showMethods("c").)

It would be really really nice if something could be done about this
and I'd be happy to contribute in any way I can.

A big thanks in advance from the Bioconductor community!

H.

PS: My understanding is that c() being a primitive, a special dispatch
mechanism is used i.e. there is something like a "pre-dispatch step"
where only the 1st arg is considered, and only if this arg is an S4
object is the implicit S4 generic called. But even that special
dispatch doesn't quite explain the behavior I report above.

 > sessionInfo()
R Under development (unstable) (2014-02-10 r64961)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From mtmorgan at fhcrc.org  Wed Feb 19 03:24:50 2014
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 18 Feb 2014 18:24:50 -0800
Subject: [Rd] R CMD Sweave tmp.tex doesn't create figures with fig=TRUE,
	include=FALSE
Message-ID: <530415F2.5020608@fhcrc.org>

With this file

/tmp$ cat tmp.Rnw
\documentclass{article}
\begin{document}
<<figureexample, fig=TRUE, include=FALSE, width=4.2, height=4.6>>=
v = seq(0, 60i, length=1000)
plot(abs(v)*exp(v), type="l", col="Royalblue")
@
\includegraphics{tmp-figureexample}
\end{document}

This command

/tmp$ R --vanilla CMD Sweave tmp.Rnw
Output file:  tmp.tex

does not produce a figure

/tmp$ ls *figureexample*
ls: cannot access *figureexample*: No such file or directory

/tmp$ R --version
R Under development (unstable) (2014-02-18 r65029) -- "Unsuffered Consequences"

but this does

/tmp$ R --vanilla CMD Sweave --pdf tmp.Rnw
Output file:  tmp.pdf

and so did

$ Rrel --version|head -n 1
R version 3.0.2 Patched (2014-01-02 r64626) -- "Frisbee Sailing"

Martin
-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From fisher at plessthan.com  Wed Feb 19 21:50:43 2014
From: fisher at plessthan.com (Fisher Dennis)
Date: Wed, 19 Feb 2014 12:50:43 -0800
Subject: [Rd] "Spinning ball" in Rgui in Windows but not in OS X
Message-ID: <799EF2C8-70E4-4784-BC92-ED8972CCCC2B@plessthan.com>

R 3.0.2
OS X, Windows 7

Colleagues

This is my first submission to this bulletin board so forgive me if I miss some etiquette issue.  

I am running some C code in Rgui in both OS X and Windows.  It takes ~ 10 seconds for the code to execute.
In OS X, the GUI is silent during this period.
In Windows, a spinning wheel appears and the GUi grays out, then recovers.
Is it possible to suppress the spinning wheel and the graying out?  I don?t know if these are controlled by the OS or by R.

Any help would be appreciated.  Thanks.  If it would help to have the code, I can provide it.

Dennis


Dennis Fisher MD
P < (The "P Less Than" Company)
Phone: 1-866-PLessThan (1-866-753-7784)
Fax: 1-866-PLessThan (1-866-753-7784)
www.PLessThan.com


From Guillermo.Vinue at uv.es  Thu Feb 20 12:19:19 2014
From: Guillermo.Vinue at uv.es (Guillermo.Vinue at uv.es)
Date: Thu, 20 Feb 2014 12:19:19 +0100 (CET)
Subject: [Rd] Where to put package vignettes
Message-ID: <8247367824vivigui@uv.es>

Dear R-devel list,

My name is Guillermo Vinu?. I have created an R package that includes a
vignette. Earlier on, to test my package, I tried to install it both in
Linux and Windows and it worked. My vignette was in /inst/doc.

Now, I have finished for good and before submitting my package to CRAN
I've tried to install it again first in Linux and then in Windows (I
removed that first installation some time ago).

My package was succesfully installed in Linux (Fedora 18 and R 2.15.2)
and the vignette was available. However, when trying to install it in
Windows (R 3.0.2), unfortunately the vignette didn't appear. My vignette
is build with knitr. 

In fact, if I first install the package on Windows, the vignette is
accesible, but then in Linux, not.

I have read that as from R 2.14.0 the preferred location for the Sweave
sources is the subdirectory vignettes of the source packages, but for
compatibility with earlier versions of R, vignette sources will be
looked for in inst/doc if vignettes does not exist.

Where do I have to put my vignette so that it could be available with
any installation and which files (.Rnw or .pdf) should be included?. 

I hope you can clarify my doubts. I have seen the collection of prior
postings to the list, but I have not found a specifical answer to my doubts .

Thank you very much in advance.

Best regards,

Guillermo


From sorenh at math.aau.dk  Thu Feb 20 12:48:19 2014
From: sorenh at math.aau.dk (=?utf-8?B?U8O4cmVuIEjDuGpzZ2FhcmQ=?=)
Date: Thu, 20 Feb 2014 11:48:19 +0000
Subject: [Rd] Where to put package vignettes
In-Reply-To: <8247367824vivigui@uv.es>
References: <8247367824vivigui@uv.es>
Message-ID: <7E8037094A0C2146AA3E6F94DAE621C39324847F@AD-EXCHMBX2-1.aau.dk>

My understanding is this:

1) Put vignettes files (.Rnw files) in the /vignettes subdirectory. 2) Build the package foo with R CMD build foo. 3) Install the package with R CMD INSTALL foo_xxx.tar.gz

Then the vignettes will be available. However you can also install the package with R CMD INSTALL foo, but then the vignettes will *not* be available (because it is in the build process that the vignettes go from /vignettes to /inst/doc)

Regards 
S?ren


-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Guillermo.Vinue at uv.es
Sent: 20. februar 2014 12:19
To: r-devel at r-project.org
Subject: [Rd] Where to put package vignettes

Dear R-devel list,

My name is Guillermo Vinu?. I have created an R package that includes a vignette. Earlier on, to test my package, I tried to install it both in Linux and Windows and it worked. My vignette was in /inst/doc.

Now, I have finished for good and before submitting my package to CRAN I've tried to install it again first in Linux and then in Windows (I removed that first installation some time ago).

My package was succesfully installed in Linux (Fedora 18 and R 2.15.2) and the vignette was available. However, when trying to install it in Windows (R 3.0.2), unfortunately the vignette didn't appear. My vignette is build with knitr. 

In fact, if I first install the package on Windows, the vignette is accesible, but then in Linux, not.

I have read that as from R 2.14.0 the preferred location for the Sweave sources is the subdirectory vignettes of the source packages, but for compatibility with earlier versions of R, vignette sources will be looked for in inst/doc if vignettes does not exist.

Where do I have to put my vignette so that it could be available with any installation and which files (.Rnw or .pdf) should be included?. 

I hope you can clarify my doubts. I have seen the collection of prior postings to the list, but I have not found a specifical answer to my doubts .

Thank you very much in advance.

Best regards,

Guillermo

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

From sorenh at math.aau.dk  Thu Feb 20 15:45:07 2014
From: sorenh at math.aau.dk (=?utf-8?B?U8O4cmVuIEjDuGpzZ2FhcmQ=?=)
Date: Thu, 20 Feb 2014 14:45:07 +0000
Subject: [Rd] Where to put package vignettes
In-Reply-To: <3418272497vivigui@uv.es>
References: <7E8037094A0C2146AA3E6F94DAE621C39324847F@AD-EXCHMBX2-1.aau.dk>
	<3418272497vivigui@uv.es>
Message-ID: <7E8037094A0C2146AA3E6F94DAE621C39324868E@AD-EXCHMBX2-1.aau.dk>

Guillermino,

Sorry but I've never made it beyond Sweave in connection with R packages; we will have to wait for more insight from others.

S?ren

-----Original Message-----
From: Guillermo.Vinue at uv.es [mailto:Guillermo.Vinue at uv.es] 
Sent: 20. februar 2014 15:43
To: S?ren H?jsgaard
Cc: r-devel at r-project.org
Subject: RE: [Rd] Where to put package vignettes

Dear S?ren,

Thank you very much for your answer, it solved my problem and now my package can be installed both on Linux and Windows and the vignette is available in both systems. I put the vignette in /vignettes.

However, unfortunately my problems have not ended here. As mentioned, my vignette is built with knitr and with the following commands:

1) R CMD check foo
2) R CMD build foo
3) R CMD INSTALL foo_xxx.tar.gz

the vignette is built with Sweave!

I have read in http://yihui.name/knitr/demo/vignette/ that in that case, a Makefile should be incorporated.

I have incorporated in /inst/doc the makefile from https://github.com/yihui/knitr/blob/7eb34104/inst/doc/Makefile

however, my vignette is still built with Sweave. I use R 2.15.2.

How can I fix this performance?.

Thank you very much again.

Best regards,

Guillermo

> My understanding is this:
> 
> 1) Put vignettes files (.Rnw files) in the /vignettes subdirectory. 2)
Build the package foo with R CMD build foo. 3) Install the package with R CMD INSTALL foo_xxx.tar.gz
> 
> Then the vignettes will be available. However you can also install the
package with R CMD INSTALL foo, but then the vignettes will *not* be available (because it is in the build process that the vignettes go from /vignettes to /inst/doc)
> 
> Regards
> S?ren
> 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org
[mailto:r-devel-bounces at r-project.org] On Behalf Of Guillermo.Vinue at uv.es
> Sent: 20. februar 2014 12:19
> To: r-devel at r-project.org
> Subject: [Rd] Where to put package vignettes
> 
> Dear R-devel list,
> 
> My name is Guillermo Vinu?. I have created an R package that includes
a vignette. Earlier on, to test my package, I tried to install it both in Linux and Windows and it worked. My vignette was in /inst/doc.
> 
> Now, I have finished for good and before submitting my package to CRAN
I've tried to install it again first in Linux and then in Windows (I removed that first installation some time ago).
> 
> My package was succesfully installed in Linux (Fedora 18 and R 2.15.2)
and the vignette was available. However, when trying to install it in Windows (R 3.0.2), unfortunately the vignette didn't appear. My vignette is build with knitr. 
> 
> In fact, if I first install the package on Windows, the vignette is
accesible, but then in Linux, not.
> 
> I have read that as from R 2.14.0 the preferred location for the
Sweave sources is the subdirectory vignettes of the source packages, but for compatibility with earlier versions of R, vignette sources will be looked for in inst/doc if vignettes does not exist.
> 
> Where do I have to put my vignette so that it could be available with
any installation and which files (.Rnw or .pdf) should be included?. 
> 
> I hope you can clarify my doubts. I have seen the collection of prior
postings to the list, but I have not found a specifical answer to my doubts .
> 
> Thank you very much in advance.
> 
> Best regards,
> 
> Guillermo
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 



From Guillermo.Vinue at uv.es  Thu Feb 20 15:43:11 2014
From: Guillermo.Vinue at uv.es (Guillermo.Vinue at uv.es)
Date: Thu, 20 Feb 2014 15:43:11 +0100 (CET)
Subject: [Rd] Where to put package vignettes
In-Reply-To: <7E8037094A0C2146AA3E6F94DAE621C39324847F@AD-EXCHMBX2-1.aau.dk>
References: <7E8037094A0C2146AA3E6F94DAE621C39324847F@AD-EXCHMBX2-1.aau.dk>
Message-ID: <3418272497vivigui@uv.es>

Dear S?ren,

Thank you very much for your answer, it solved my problem and now my
package can be installed both on Linux and Windows and the vignette is
available in both systems. I put the vignette in /vignettes.

However, unfortunately my problems have not ended here. As mentioned, my
vignette is built with knitr and with the following commands:

1) R CMD check foo
2) R CMD build foo
3) R CMD INSTALL foo_xxx.tar.gz

the vignette is built with Sweave!

I have read in http://yihui.name/knitr/demo/vignette/ that in that case,
a Makefile should be incorporated.

I have incorporated in /inst/doc the makefile from
https://github.com/yihui/knitr/blob/7eb34104/inst/doc/Makefile

however, my vignette is still built with Sweave. I use R 2.15.2.

How can I fix this performance?.

Thank you very much again.

Best regards,

Guillermo

> My understanding is this:
> 
> 1) Put vignettes files (.Rnw files) in the /vignettes subdirectory. 2)
Build the package foo with R CMD build foo. 3) Install the package with
R CMD INSTALL foo_xxx.tar.gz
> 
> Then the vignettes will be available. However you can also install the
package with R CMD INSTALL foo, but then the vignettes will *not* be
available (because it is in the build process that the vignettes go from
/vignettes to /inst/doc)
> 
> Regards 
> S?ren
> 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org
[mailto:r-devel-bounces at r-project.org] On Behalf Of Guillermo.Vinue at uv.es
> Sent: 20. februar 2014 12:19
> To: r-devel at r-project.org
> Subject: [Rd] Where to put package vignettes
> 
> Dear R-devel list,
> 
> My name is Guillermo Vinu?. I have created an R package that includes
a vignette. Earlier on, to test my package, I tried to install it both
in Linux and Windows and it worked. My vignette was in /inst/doc.
> 
> Now, I have finished for good and before submitting my package to CRAN
I've tried to install it again first in Linux and then in Windows (I
removed that first installation some time ago).
> 
> My package was succesfully installed in Linux (Fedora 18 and R 2.15.2)
and the vignette was available. However, when trying to install it in
Windows (R 3.0.2), unfortunately the vignette didn't appear. My vignette
is build with knitr. 
> 
> In fact, if I first install the package on Windows, the vignette is
accesible, but then in Linux, not.
> 
> I have read that as from R 2.14.0 the preferred location for the
Sweave sources is the subdirectory vignettes of the source packages, but
for compatibility with earlier versions of R, vignette sources will be
looked for in inst/doc if vignettes does not exist.
> 
> Where do I have to put my vignette so that it could be available with
any installation and which files (.Rnw or .pdf) should be included?. 
> 
> I hope you can clarify my doubts. I have seen the collection of prior
postings to the list, but I have not found a specifical answer to my
doubts .
> 
> Thank you very much in advance.
> 
> Best regards,
> 
> Guillermo
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From baptiste.auguie at gmail.com  Thu Feb 20 15:56:17 2014
From: baptiste.auguie at gmail.com (baptiste auguie)
Date: Thu, 20 Feb 2014 11:56:17 -0300
Subject: [Rd] Where to put package vignettes
In-Reply-To: <7E8037094A0C2146AA3E6F94DAE621C39324868E@AD-EXCHMBX2-1.aau.dk>
References: <7E8037094A0C2146AA3E6F94DAE621C39324847F@AD-EXCHMBX2-1.aau.dk>
	<3418272497vivigui@uv.es>
	<7E8037094A0C2146AA3E6F94DAE621C39324868E@AD-EXCHMBX2-1.aau.dk>
Message-ID: <CANLFJPqpwgCzRf0_G8KW0-TtQ+N_wDRs4jbSkYdr66TDnzzn1Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140220/e924e1f9/attachment.pl>

From h.wickham at gmail.com  Thu Feb 20 16:55:02 2014
From: h.wickham at gmail.com (Hadley Wickham)
Date: Thu, 20 Feb 2014 09:55:02 -0600
Subject: [Rd] Where to put package vignettes
In-Reply-To: <CANLFJPqpwgCzRf0_G8KW0-TtQ+N_wDRs4jbSkYdr66TDnzzn1Q@mail.gmail.com>
References: <7E8037094A0C2146AA3E6F94DAE621C39324847F@AD-EXCHMBX2-1.aau.dk>
	<3418272497vivigui@uv.es>
	<7E8037094A0C2146AA3E6F94DAE621C39324868E@AD-EXCHMBX2-1.aau.dk>
	<CANLFJPqpwgCzRf0_G8KW0-TtQ+N_wDRs4jbSkYdr66TDnzzn1Q@mail.gmail.com>
Message-ID: <CABdHhvGq1VHE6AbaNquuNwSCXHeGstzRp5FZ9W4AYdNbT-H6EQ@mail.gmail.com>

You also need to make sure that your knitr vignettes include

%\VignetteEngine{knitr::knitr}

See http://yihui.name/knitr/demo/vignette/ for full details.

Hadley

On Thu, Feb 20, 2014 at 8:56 AM, baptiste auguie
<baptiste.auguie at gmail.com> wrote:
> Hi,
>
> You should  take the following steps: 1) upgrade R, 2) specify
> VignetteBuilder: knitr in your DESCRIPTION file, 3) check how other CRAN
> packages using knitr do it (e.g. knitr itself). No makefile is needed, that
> was a temporary workaround, now irrelevant.
>
> HTH,
>
> baptiste
>
>
> On 20 February 2014 11:45, S?ren H?jsgaard <sorenh at math.aau.dk> wrote:
>
>> Guillermino,
>>
>> Sorry but I've never made it beyond Sweave in connection with R packages;
>> we will have to wait for more insight from others.
>>
>> S?ren
>>
>> -----Original Message-----
>> From: Guillermo.Vinue at uv.es [mailto:Guillermo.Vinue at uv.es]
>> Sent: 20. februar 2014 15:43
>> To: S?ren H?jsgaard
>> Cc: r-devel at r-project.org
>> Subject: RE: [Rd] Where to put package vignettes
>>
>> Dear S?ren,
>>
>> Thank you very much for your answer, it solved my problem and now my
>> package can be installed both on Linux and Windows and the vignette is
>> available in both systems. I put the vignette in /vignettes.
>>
>> However, unfortunately my problems have not ended here. As mentioned, my
>> vignette is built with knitr and with the following commands:
>>
>> 1) R CMD check foo
>> 2) R CMD build foo
>> 3) R CMD INSTALL foo_xxx.tar.gz
>>
>> the vignette is built with Sweave!
>>
>> I have read in http://yihui.name/knitr/demo/vignette/ that in that case,
>> a Makefile should be incorporated.
>>
>> I have incorporated in /inst/doc the makefile from
>> https://github.com/yihui/knitr/blob/7eb34104/inst/doc/Makefile
>>
>> however, my vignette is still built with Sweave. I use R 2.15.2.
>>
>> How can I fix this performance?.
>>
>> Thank you very much again.
>>
>> Best regards,
>>
>> Guillermo
>>
>> > My understanding is this:
>> >
>> > 1) Put vignettes files (.Rnw files) in the /vignettes subdirectory. 2)
>> Build the package foo with R CMD build foo. 3) Install the package with R
>> CMD INSTALL foo_xxx.tar.gz
>> >
>> > Then the vignettes will be available. However you can also install the
>> package with R CMD INSTALL foo, but then the vignettes will *not* be
>> available (because it is in the build process that the vignettes go from
>> /vignettes to /inst/doc)
>> >
>> > Regards
>> > S?ren
>> >
>> >
>> > -----Original Message-----
>> > From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Guillermo.Vinue at uv.es
>> > Sent: 20. februar 2014 12:19
>> > To: r-devel at r-project.org
>> > Subject: [Rd] Where to put package vignettes
>> >
>> > Dear R-devel list,
>> >
>> > My name is Guillermo Vinu?. I have created an R package that includes
>> a vignette. Earlier on, to test my package, I tried to install it both in
>> Linux and Windows and it worked. My vignette was in /inst/doc.
>> >
>> > Now, I have finished for good and before submitting my package to CRAN
>> I've tried to install it again first in Linux and then in Windows (I
>> removed that first installation some time ago).
>> >
>> > My package was succesfully installed in Linux (Fedora 18 and R 2.15.2)
>> and the vignette was available. However, when trying to install it in
>> Windows (R 3.0.2), unfortunately the vignette didn't appear. My vignette is
>> build with knitr.
>> >
>> > In fact, if I first install the package on Windows, the vignette is
>> accesible, but then in Linux, not.
>> >
>> > I have read that as from R 2.14.0 the preferred location for the
>> Sweave sources is the subdirectory vignettes of the source packages, but
>> for compatibility with earlier versions of R, vignette sources will be
>> looked for in inst/doc if vignettes does not exist.
>> >
>> > Where do I have to put my vignette so that it could be available with
>> any installation and which files (.Rnw or .pdf) should be included?.
>> >
>> > I hope you can clarify my doubts. I have seen the collection of prior
>> postings to the list, but I have not found a specifical answer to my
>> doubts .
>> >
>> > Thank you very much in advance.
>> >
>> > Best regards,
>> >
>> > Guillermo
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>         [[alternative HTML version deleted]]
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
http://had.co.nz/


From xie at yihui.name  Thu Feb 20 18:37:46 2014
From: xie at yihui.name (Yihui Xie)
Date: Thu, 20 Feb 2014 11:37:46 -0600
Subject: [Rd] Where to put package vignettes
In-Reply-To: <3418272497vivigui@uv.es>
References: <7E8037094A0C2146AA3E6F94DAE621C39324847F@AD-EXCHMBX2-1.aau.dk>
	<3418272497vivigui@uv.es>
Message-ID: <CANROs4fS34nwBCjPU+ay_YS=2whN3emA5Msn-p1HSVWsje2RYw@mail.gmail.com>

It is not guaranteed that knitr vignettes will work for R < 3.0.x
(even with the Makefile approach, which was really a hack). Unless you
must stay with R 2.15.x, you are strongly recommended to upgrade to R
3.0.x and forget about the Makefile approach. Then follow the three
steps mentioned in http://yihui.name/knitr/demo/vignette/

If you still cannot work it out, please point us to the source of your package.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Web: http://yihui.name


On Thu, Feb 20, 2014 at 8:43 AM,  <Guillermo.Vinue at uv.es> wrote:
> Dear S?ren,
>
> Thank you very much for your answer, it solved my problem and now my
> package can be installed both on Linux and Windows and the vignette is
> available in both systems. I put the vignette in /vignettes.
>
> However, unfortunately my problems have not ended here. As mentioned, my
> vignette is built with knitr and with the following commands:
>
> 1) R CMD check foo
> 2) R CMD build foo
> 3) R CMD INSTALL foo_xxx.tar.gz
>
> the vignette is built with Sweave!
>
> I have read in http://yihui.name/knitr/demo/vignette/ that in that case,
> a Makefile should be incorporated.
>
> I have incorporated in /inst/doc the makefile from
> https://github.com/yihui/knitr/blob/7eb34104/inst/doc/Makefile
>
> however, my vignette is still built with Sweave. I use R 2.15.2.
>
> How can I fix this performance?.
>
> Thank you very much again.
>
> Best regards,
>
> Guillermo
>
>> My understanding is this:
>>
>> 1) Put vignettes files (.Rnw files) in the /vignettes subdirectory. 2)
> Build the package foo with R CMD build foo. 3) Install the package with
> R CMD INSTALL foo_xxx.tar.gz
>>
>> Then the vignettes will be available. However you can also install the
> package with R CMD INSTALL foo, but then the vignettes will *not* be
> available (because it is in the build process that the vignettes go from
> /vignettes to /inst/doc)
>>
>> Regards
>> S?ren
>>
>>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Guillermo.Vinue at uv.es
>> Sent: 20. februar 2014 12:19
>> To: r-devel at r-project.org
>> Subject: [Rd] Where to put package vignettes
>>
>> Dear R-devel list,
>>
>> My name is Guillermo Vinu?. I have created an R package that includes
> a vignette. Earlier on, to test my package, I tried to install it both
> in Linux and Windows and it worked. My vignette was in /inst/doc.
>>
>> Now, I have finished for good and before submitting my package to CRAN
> I've tried to install it again first in Linux and then in Windows (I
> removed that first installation some time ago).
>>
>> My package was succesfully installed in Linux (Fedora 18 and R 2.15.2)
> and the vignette was available. However, when trying to install it in
> Windows (R 3.0.2), unfortunately the vignette didn't appear. My vignette
> is build with knitr.
>>
>> In fact, if I first install the package on Windows, the vignette is
> accesible, but then in Linux, not.
>>
>> I have read that as from R 2.14.0 the preferred location for the
> Sweave sources is the subdirectory vignettes of the source packages, but
> for compatibility with earlier versions of R, vignette sources will be
> looked for in inst/doc if vignettes does not exist.
>>
>> Where do I have to put my vignette so that it could be available with
> any installation and which files (.Rnw or .pdf) should be included?.
>>
>> I hope you can clarify my doubts. I have seen the collection of prior
> postings to the list, but I have not found a specifical answer to my
> doubts .
>>
>> Thank you very much in advance.
>>
>> Best regards,
>>
>> Guillermo


From mtmorgan at fhcrc.org  Fri Feb 21 04:41:04 2014
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 20 Feb 2014 19:41:04 -0800
Subject: [Rd] instantiating a reference class with an initialize() method
 from .onLoad fails
Message-ID: <5306CAD0.70608@fhcrc.org>

PkgA has a single R/binding.R file containing

    .A <- setRefClass("A", methods=list(initialize=function(...) {}))
    .onLoad <- function(...) .A()

A NAMESPACE with

     import(methods)
     exportClasses("A")

and DESCRIPTION

     Package: PkgA
     Type: Package
     Title: Documenting reference classes
     Version: 0.0.1
     Date: 2012-08-05
     Author: Martin Morgan
     Maintainer: Martin Morgan <mtmorgan at fhcrc.org>
     Description: This package implements a simple 'reference' class
     Depends: methods
     Imports: methods
     License: Apache License 2.0
     Collate: binding.R

R CMD INSTALL PkgA results in

p$ R --vanilla CMD INSTALL PkgA
* installing to library ?/home/mtmorgan/R/x86_64-unknown-linux-gnu-library/3.1?
* installing *source* package ?PkgA? ...
** R
** preparing package for lazy loading
** help
No man pages found in package  ?PkgA?
*** installing help indices
** building package indices
** testing if installed package can be loaded
Error : .onLoad failed in loadNamespace() for 'PkgA', details:
   call: initialize(value, ...)
   error: attempt to apply non-function
Error: loading failed
Execution halted
ERROR: loading failed
* removing ?/home/mtmorgan/R/x86_64-unknown-linux-gnu-library/3.1/PkgA?
* restoring previous ?/home/mtmorgan/R/x86_64-unknown-linux-gnu-library/3.1/PkgA?

Having read

     https://stat.ethz.ch/pipermail/r-devel/2013-October/067636.html

I used

     setLoadAction(function(nmspc) .A())

in place of .onLoad, and had success. However, a more complicated scenario,

     https://stat.ethz.ch/pipermail/bioc-devel/2014-February/005271.html

where a data file contains an instance of a class defined in a package that 
imports PkgA, fails during R CMD check or in an R session with

     env = new.env(); load("data.Rdata", env); get("data", env)

including when .A() is eval() or evalq()'d in envir=nmspc.

Thanks for any hints.

Martin
-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From Guillermo.Vinue at uv.es  Fri Feb 21 10:22:53 2014
From: Guillermo.Vinue at uv.es (Guillermo.Vinue at uv.es)
Date: Fri, 21 Feb 2014 10:22:53 +0100 (CET)
Subject: [Rd] Where to put package vignettes
In-Reply-To: <CANROs4fS34nwBCjPU+ay_YS=2whN3emA5Msn-p1HSVWsje2RYw@mail.gmail.com>
References: <CANROs4fS34nwBCjPU+ay_YS=2whN3emA5Msn-p1HSVWsje2RYw@mail.gmail.com>
Message-ID: <5355289375vivigui@uv.es>

Dear All,

As you mentioned, it was a matter of upgrading R. Now I have R 3.0.2 and
everything has worked well.

Thank you very much for all your comments and suggestions. They have
been very helpful.

Best regards,

Guillermo

> It is not guaranteed that knitr vignettes will work for R < 3.0.x
> (even with the Makefile approach, which was really a hack). Unless you
> must stay with R 2.15.x, you are strongly recommended to upgrade to R
> 3.0.x and forget about the Makefile approach. Then follow the three
> steps mentioned in http://yihui.name/knitr/demo/vignette/
> 
> If you still cannot work it out, please point us to the source of your
package.
> 
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Web: http://yihui.name
> 
> 
> On Thu, Feb 20, 2014 at 8:43 AM,  <Guillermo.Vinue at uv.es> wrote:
> > Dear S?ren,
> >
> > Thank you very much for your answer, it solved my problem and now my
> > package can be installed both on Linux and Windows and the vignette is
> > available in both systems. I put the vignette in /vignettes.
> >
> > However, unfortunately my problems have not ended here. As mentioned, my
> > vignette is built with knitr and with the following commands:
> >
> > 1) R CMD check foo
> > 2) R CMD build foo
> > 3) R CMD INSTALL foo_xxx.tar.gz
> >
> > the vignette is built with Sweave!
> >
> > I have read in http://yihui.name/knitr/demo/vignette/ that in that case,
> > a Makefile should be incorporated.
> >
> > I have incorporated in /inst/doc the makefile from
> > https://github.com/yihui/knitr/blob/7eb34104/inst/doc/Makefile
> >
> > however, my vignette is still built with Sweave. I use R 2.15.2.
> >
> > How can I fix this performance?.
> >
> > Thank you very much again.
> >
> > Best regards,
> >
> > Guillermo
> >
> >> My understanding is this:
> >>
> >> 1) Put vignettes files (.Rnw files) in the /vignettes subdirectory. 2)
> > Build the package foo with R CMD build foo. 3) Install the package with
> > R CMD INSTALL foo_xxx.tar.gz
> >>
> >> Then the vignettes will be available. However you can also install the
> > package with R CMD INSTALL foo, but then the vignettes will *not* be
> > available (because it is in the build process that the vignettes go from
> > /vignettes to /inst/doc)
> >>
> >> Regards
> >> S?ren
> >>
> >>
> >> -----Original Message-----
> >> From: r-devel-bounces at r-project.org
> > [mailto:r-devel-bounces at r-project.org] On Behalf Of
Guillermo.Vinue at uv.es
> >> Sent: 20. februar 2014 12:19
> >> To: r-devel at r-project.org
> >> Subject: [Rd] Where to put package vignettes
> >>
> >> Dear R-devel list,
> >>
> >> My name is Guillermo Vinu?. I have created an R package that includes
> > a vignette. Earlier on, to test my package, I tried to install it both
> > in Linux and Windows and it worked. My vignette was in /inst/doc.
> >>
> >> Now, I have finished for good and before submitting my package to CRAN
> > I've tried to install it again first in Linux and then in Windows (I
> > removed that first installation some time ago).
> >>
> >> My package was succesfully installed in Linux (Fedora 18 and R 2.15.2)
> > and the vignette was available. However, when trying to install it in
> > Windows (R 3.0.2), unfortunately the vignette didn't appear. My vignette
> > is build with knitr.
> >>
> >> In fact, if I first install the package on Windows, the vignette is
> > accesible, but then in Linux, not.
> >>
> >> I have read that as from R 2.14.0 the preferred location for the
> > Sweave sources is the subdirectory vignettes of the source packages, but
> > for compatibility with earlier versions of R, vignette sources will be
> > looked for in inst/doc if vignettes does not exist.
> >>
> >> Where do I have to put my vignette so that it could be available with
> > any installation and which files (.Rnw or .pdf) should be included?.
> >>
> >> I hope you can clarify my doubts. I have seen the collection of prior
> > postings to the list, but I have not found a specifical answer to my
> > doubts .
> >>
> >> Thank you very much in advance.
> >>
> >> Best regards,
> >>
> >> Guillermo
> 
> 


From dstr7320 at uni.sydney.edu.au  Sun Feb 23 03:00:23 2014
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Sun, 23 Feb 2014 02:00:23 +0000
Subject: [Rd] Random Count Generation with rnbinom
Message-ID: <87caca24a5a940bab42bf4a8eefad579@BLUPR01MB035.prod.exchangelabs.com>

The documentation states :

An alternative parametrization (often used in ecology) is by the mean ?mu?, and ?size?, the dispersion parameter.

However, this fails :

> rnbinom(10, mu = 100, size = 0)
 [1] NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN
Warning message:
In rnbinom(10, mu = 100, size = 0) : NAs produced

For dispersion set to 0, it should work like drawing from a Poisson distribution.

It also produces incorrect draws for non-zero dispersions :

> rnbinom(10, mu = 100, size = 0.000001)
 [1] 0 0 0 0 0 0 0 0 0 0

It also fails for underdispersed count models :

> rnbinom(10, mu = 100, size = -0.1)
 [1] NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN
Warning message:
In rnbinom(10, mu = 100, size = -0.1) : NAs produced

> sessionInfo()
R version 3.0.2 (2013-09-25)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_AU.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_AU.UTF-8        LC_COLLATE=en_AU.UTF-8    
 [5] LC_MONETARY=en_AU.UTF-8    LC_MESSAGES=en_AU.UTF-8   
 [7] LC_PAPER=en_AU.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_AU.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
[1] tools_3.0.2

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia

From Achim.Zeileis at uibk.ac.at  Sun Feb 23 03:16:14 2014
From: Achim.Zeileis at uibk.ac.at (Achim Zeileis)
Date: Sun, 23 Feb 2014 03:16:14 +0100 (CET)
Subject: [Rd] Random Count Generation with rnbinom
In-Reply-To: <87caca24a5a940bab42bf4a8eefad579@BLUPR01MB035.prod.exchangelabs.com>
References: <87caca24a5a940bab42bf4a8eefad579@BLUPR01MB035.prod.exchangelabs.com>
Message-ID: <alpine.DEB.2.10.1402230308050.32132@paninaro.uibk.ac.at>

On Sun, 23 Feb 2014, Dario Strbenac wrote:

> The documentation states :
>
> An alternative parametrization (often used in ecology) is by the mean ?mu?, and ?size?, the dispersion parameter.
>
> However, this fails :
>
>> rnbinom(10, mu = 100, size = 0)
> [1] NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN
> Warning message:
> In rnbinom(10, mu = 100, size = 0) : NAs produced
>
> For dispersion set to 0, it should work like drawing from a Poisson 
> distribution.

No, Poisson is the case for size converging to Inf. Compare:

R> dnbinom(1:4, mu = 1, size = 1e9)
[1] 0.36787945 0.18393972 0.06131324 0.01532831
R> dpois(1:4, lambda = 1)
[1] 0.36787944 0.18393972 0.06131324 0.01532831

This is easy to see from the explanation in the manual page:

   The variance is 'mu + mu^2/size' in this parametrization.

So for size = Inf this yields mu, i.e., equidispersion. And for finite 
positive size, there is always overdispersion.

> It also produces incorrect draws for non-zero dispersions :
>
>> rnbinom(10, mu = 100, size = 0.000001)
> [1] 0 0 0 0 0 0 0 0 0 0

This conforms with the documentation

   The case 'size == 0' is the distribution concentrated at zero.
   This is the limiting distribution for 'size' approaching zero,
   even if 'mu' rather than 'prob' is held constant. Notice though,
   that the mean of the limit distribution is 0, whatever the value
   of 'mu'.

> It also fails for underdispersed count models :
>
>> rnbinom(10, mu = 100, size = -0.1)
> [1] NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN
> Warning message:
> In rnbinom(10, mu = 100, size = -0.1) : NAs produced

And here the manual explains:

     size: target for number of successful trials, or dispersion
           parameter (the shape parameter of the gamma mixing
           distribution).  Must be strictly positive, need not be
           integer.


>> sessionInfo()
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
> [1] LC_CTYPE=en_AU.UTF-8       LC_NUMERIC=C 
> [3] LC_TIME=en_AU.UTF-8        LC_COLLATE=en_AU.UTF-8 
> [5] LC_MONETARY=en_AU.UTF-8    LC_MESSAGES=en_AU.UTF-8 
> [7] LC_PAPER=en_AU.UTF-8       LC_NAME=C 
> [9] LC_ADDRESS=C               LC_TELEPHONE=C 
> [11] LC_MEASUREMENT=en_AU.UTF-8 LC_IDENTIFICATION=C 
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base 
>
> loaded via a namespace (and not attached):
> [1] tools_3.0.2
>
> --------------------------------------
> Dario Strbenac
> PhD Student
> University of Sydney
> Camperdown NSW 2050
> Australia
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From peljasz at yahoo.co.uk  Tue Feb 25 09:42:45 2014
From: peljasz at yahoo.co.uk (lejeczek)
Date: Tue, 25 Feb 2014 08:42:45 +0000
Subject: [Rd] acml blas+lapac in R
Message-ID: <530C5785.5010603@yahoo.co.uk>

dear experts

I'd like to ask you, probably on behalf all of us who try to 
use AMD's ACML for performance optimisation a question.
There seem to be problem when these two, R and ACML are 
coupled,
described here:

http://devgurus.amd.com/message/1255852#1255852

I'd like to ask, while not being a programmer/developer, how 
incorrect and dangerous this might be?
maybe such a setup must be avoided all together?

many thanks & regards


From ripley at stats.ox.ac.uk  Tue Feb 25 11:39:24 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 25 Feb 2014 10:39:24 +0000
Subject: [Rd] acml blas+lapac in R
In-Reply-To: <530C5785.5010603@yahoo.co.uk>
References: <530C5785.5010603@yahoo.co.uk>
Message-ID: <530C72DC.20009@stats.ox.ac.uk>

Note that this is in the 'R Installation and Administration Manual'. 
Please follow the posting guide and check the manuals before posting.

On 25/02/2014 08:42, lejeczek wrote:
> dear experts
>
> I'd like to ask you, probably on behalf all of us who try to use AMD's
> ACML for performance optimisation a question.
> There seem to be problem when these two, R and ACML are coupled,
> described here:
>
> http://devgurus.amd.com/message/1255852#1255852
>
> I'd like to ask, while not being a programmer/developer, how incorrect
> and dangerous this might be?
> maybe such a setup must be avoided all together?

As an R developer is reputed to have said several years ago

'Do you want it fast or do you want it right?'

Handing NAs correctly is pretty fundamental to R's operation.  There are 
several other optimized BLAS which are not known to work incorrectly, 
and I always use one of those.

>
> many thanks & regards
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sannandi at umail.iu.edu  Tue Feb 25 21:00:19 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Tue, 25 Feb 2014 12:00:19 -0800
Subject: [Rd] What this error means
Message-ID: <CAGSjAUDCKyQc9PSB0diXkFejYhf7C-XGeWu2ozsMerFBCGA72g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140225/16751bd2/attachment.pl>

From gmbecker at ucdavis.edu  Tue Feb 25 22:04:39 2014
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Tue, 25 Feb 2014 13:04:39 -0800
Subject: [Rd] What this error means
In-Reply-To: <CAGSjAUDCKyQc9PSB0diXkFejYhf7C-XGeWu2ozsMerFBCGA72g@mail.gmail.com>
References: <CAGSjAUDCKyQc9PSB0diXkFejYhf7C-XGeWu2ozsMerFBCGA72g@mail.gmail.com>
Message-ID: <CADwqtCNzMd-L3ewmQfUFVKBc8WCw5xWjF6Ti=oZDKrTHGkx0gA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140225/65927b76/attachment.pl>

From sannandi at umail.iu.edu  Tue Feb 25 22:09:32 2014
From: sannandi at umail.iu.edu (Sandip Nandi)
Date: Tue, 25 Feb 2014 13:09:32 -0800
Subject: [Rd] What this error means
In-Reply-To: <CADwqtCNzMd-L3ewmQfUFVKBc8WCw5xWjF6Ti=oZDKrTHGkx0gA@mail.gmail.com>
References: <CAGSjAUDCKyQc9PSB0diXkFejYhf7C-XGeWu2ozsMerFBCGA72g@mail.gmail.com>
	<CADwqtCNzMd-L3ewmQfUFVKBc8WCw5xWjF6Ti=oZDKrTHGkx0gA@mail.gmail.com>
Message-ID: <CAGSjAUBXo7us4x2KxZv-CkLWMyYBH_0iAcnoc1xwVMSRc2mRBw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140225/4ecc39c5/attachment.pl>

From gmbecker at ucdavis.edu  Tue Feb 25 22:12:27 2014
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Tue, 25 Feb 2014 13:12:27 -0800
Subject: [Rd] What this error means
In-Reply-To: <CAGSjAUBXo7us4x2KxZv-CkLWMyYBH_0iAcnoc1xwVMSRc2mRBw@mail.gmail.com>
References: <CAGSjAUDCKyQc9PSB0diXkFejYhf7C-XGeWu2ozsMerFBCGA72g@mail.gmail.com>
	<CADwqtCNzMd-L3ewmQfUFVKBc8WCw5xWjF6Ti=oZDKrTHGkx0gA@mail.gmail.com>
	<CAGSjAUBXo7us4x2KxZv-CkLWMyYBH_0iAcnoc1xwVMSRc2mRBw@mail.gmail.com>
Message-ID: <CADwqtCNqwOsV1s-eMUZm8vpOVP8D+s=pGArihYaLzcv+scQZfA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140225/72d71880/attachment.pl>

From peljasz at yahoo.co.uk  Wed Feb 26 07:40:39 2014
From: peljasz at yahoo.co.uk (lejeczek)
Date: Wed, 26 Feb 2014 06:40:39 +0000
Subject: [Rd] acml blas+lapac in R
In-Reply-To: <530C72DC.20009@stats.ox.ac.uk>
References: <530C5785.5010603@yahoo.co.uk> <530C72DC.20009@stats.ox.ac.uk>
Message-ID: <530D8C67.9060007@yahoo.co.uk>

thank you Brian
if ACML is the problem I wonder if it ever was pointed out 
to AMD
shame because ACML results in really nice performance on AMD 
hardware


On 25/02/14 10:39, Prof Brian Ripley wrote:
> Note that this is in the 'R Installation and 
> Administration Manual'. Please follow the posting guide 
> and check the manuals before posting.
>
> On 25/02/2014 08:42, lejeczek wrote:
>> dear experts
>>
>> I'd like to ask you, probably on behalf all of us who try 
>> to use AMD's
>> ACML for performance optimisation a question.
>> There seem to be problem when these two, R and ACML are 
>> coupled,
>> described here:
>>
>> http://devgurus.amd.com/message/1255852#1255852
>>
>> I'd like to ask, while not being a programmer/developer, 
>> how incorrect
>> and dangerous this might be?
>> maybe such a setup must be avoided all together?
>
> As an R developer is reputed to have said several years ago
>
> 'Do you want it fast or do you want it right?'
>
> Handing NAs correctly is pretty fundamental to R's 
> operation. There are several other optimized BLAS which 
> are not known to work incorrectly, and I always use one of 
> those.
>
>>
>> many thanks & regards
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From romain at r-enthusiasts.com  Wed Feb 26 09:41:49 2014
From: romain at r-enthusiasts.com (=?windows-1252?Q?Romain_Fran=E7ois?=)
Date: Wed, 26 Feb 2014 09:41:49 +0100
Subject: [Rd] help with gotoExitingHandler(R_NilValue, call, entry);
	. Implementation of error handling internally
Message-ID: <23F7D6BB-528B-4FA2-B576-3FB80250B1C3@r-enthusiasts.com>

Hello, 

I?m trying to leverage R_ToplevelExec to implement C level try/catch. 

The way it is implemented allows for running a function in a top level context. This context gets an empty handler stack, so either the function runs correctly or it jumps. When it jumps, it does not find a handler, so it jumps to the top level context. 

R does not allow me to call begin context and end context directly, so instead what I do is call R_ToplevelExec, grab the global context inside the function, install my own handler that I don?t set to be a calling one, pretend this context is a CTXT_FUNCTION. 

Eventually I get to jump fun, so that I can later on grab the condition from R_ReturnedValue. 

This works well in the ? not simple error ? case, i.e. if I call stop( simpleError(...) ), but with simple errors, i.e. calls to Rf_error internally or bare calls to stop( "vvzvz" ) I can?t access the error. 

And this boils down to this call: 

gotoExitingHandler(R_NilValue, call, entry);

inside vsignalError : 

static void vsignalError(SEXP call, const char *format, va_list ap)
{
    char localbuf[BUFSIZE];
    SEXP list, oldstack;

    oldstack = R_HandlerStack;
    Rvsnprintf(localbuf, BUFSIZE - 1, format, ap);
    while ((list = findSimpleErrorHandler()) != R_NilValue) {
	char *buf = errbuf;
	SEXP entry = CAR(list);
	R_HandlerStack = CDR(list);
	strncpy(buf, localbuf, BUFSIZE - 1);
	/*	Rvsnprintf(buf, BUFSIZE - 1, format, ap);*/
	buf[BUFSIZE - 1] = 0;
	if (IS_CALLING_ENTRY(entry)) {
	    if (ENTRY_HANDLER(entry) == R_RestartToken)
		return; /* go to default error handling; do not reset stack */
	    else {
		SEXP hooksym, hcall, qcall;
		/* protect oldstack here, not outside loop, so handler
		   stack gets unwound in case error is protect stack
		   overflow */
		PROTECT(oldstack);
		hooksym = install(".handleSimpleError");
		PROTECT(qcall = LCONS(R_QuoteSymbol,
				      LCONS(call, R_NilValue)));
		PROTECT(hcall = LCONS(qcall, R_NilValue));
		hcall = LCONS(mkString(buf), hcall);
		hcall = LCONS(ENTRY_HANDLER(entry), hcall);
		PROTECT(hcall = LCONS(hooksym, hcall));
		eval(hcall, R_GlobalEnv);
		UNPROTECT(4);
	    }
	}
	else gotoExitingHandler(R_NilValue, call, entry);   // <<<  HERE
    }
    R_HandlerStack = oldstack;
}

Would it be possible to construct a simple condition instead of passing down R_NilValue so that I can grab this error and deal with it. 

The alternative is to set the handler to be a calling one, but I?d like to avoid that as much as possible as this means going back to the R side of things just to get access to the condition. 

My code is here: https://gist.github.com/romainfrancois/9225811

I have only tested this on OSX with R-devel. The code only uses R internal api (not Rcpp*). 

So down to what I?d like you to consider please if you are still reading here. Can we feed gotoExitingHandler with something more interesting than NULL. please. 



The end game is to add one layer of abstraction, e.g. pass to R_ToplevelExec a function that first deals with contexts, then calls an actual function. Combining this with lambda functions in C++ will make quite a nice and elegant way to handle error handling at the C++ level. 

I can provide the code that would create the simpleError, this is just making a simple VECSXP with names and classes, no big trouble here. 

Romain


From romain at r-enthusiasts.com  Thu Feb 27 08:13:23 2014
From: romain at r-enthusiasts.com (=?windows-1252?Q?Romain_Fran=E7ois?=)
Date: Thu, 27 Feb 2014 08:13:23 +0100
Subject: [Rd] help with gotoExitingHandler(R_NilValue, call, entry);
	. Implementation of error handling internally
In-Reply-To: <23F7D6BB-528B-4FA2-B576-3FB80250B1C3@r-enthusiasts.com>
References: <23F7D6BB-528B-4FA2-B576-3FB80250B1C3@r-enthusiasts.com>
Message-ID: <E831BF4D-6DD3-44AB-AAE9-2DADF18819D8@r-enthusiasts.com>

Of course one problem is that R hides things that I need for this, such as R_HandlerStack and R_ReturnedValue. 

I understand they have to be hidden, in which case can we have an exposed mechanism similar to what R_ToplevelExec does, but with the added functionality of giving access to the condition where R_ToplevelExec would return TRUE. 

Would someone be willing to review a patch to R with this added functionality. Please. 

In any case, I still would like some comments about my initial question about R_NilValue use in gotoExitingHandler(R_NilValue, call, entry);

Romain

Le 26 f?vr. 2014 ? 09:41, Romain Fran?ois <romain at r-enthusiasts.com> a ?crit :

> Hello, 
> 
> I?m trying to leverage R_ToplevelExec to implement C level try/catch. 
> 
> The way it is implemented allows for running a function in a top level context. This context gets an empty handler stack, so either the function runs correctly or it jumps. When it jumps, it does not find a handler, so it jumps to the top level context. 
> 
> R does not allow me to call begin context and end context directly, so instead what I do is call R_ToplevelExec, grab the global context inside the function, install my own handler that I don?t set to be a calling one, pretend this context is a CTXT_FUNCTION. 
> 
> Eventually I get to jump fun, so that I can later on grab the condition from R_ReturnedValue. 
> 
> This works well in the ? not simple error ? case, i.e. if I call stop( simpleError(...) ), but with simple errors, i.e. calls to Rf_error internally or bare calls to stop( "vvzvz" ) I can?t access the error. 
> 
> And this boils down to this call: 
> 
> gotoExitingHandler(R_NilValue, call, entry);
> 
> inside vsignalError : 
> 
> static void vsignalError(SEXP call, const char *format, va_list ap)
> {
>    char localbuf[BUFSIZE];
>    SEXP list, oldstack;
> 
>    oldstack = R_HandlerStack;
>    Rvsnprintf(localbuf, BUFSIZE - 1, format, ap);
>    while ((list = findSimpleErrorHandler()) != R_NilValue) {
> 	char *buf = errbuf;
> 	SEXP entry = CAR(list);
> 	R_HandlerStack = CDR(list);
> 	strncpy(buf, localbuf, BUFSIZE - 1);
> 	/*	Rvsnprintf(buf, BUFSIZE - 1, format, ap);*/
> 	buf[BUFSIZE - 1] = 0;
> 	if (IS_CALLING_ENTRY(entry)) {
> 	    if (ENTRY_HANDLER(entry) == R_RestartToken)
> 		return; /* go to default error handling; do not reset stack */
> 	    else {
> 		SEXP hooksym, hcall, qcall;
> 		/* protect oldstack here, not outside loop, so handler
> 		   stack gets unwound in case error is protect stack
> 		   overflow */
> 		PROTECT(oldstack);
> 		hooksym = install(".handleSimpleError");
> 		PROTECT(qcall = LCONS(R_QuoteSymbol,
> 				      LCONS(call, R_NilValue)));
> 		PROTECT(hcall = LCONS(qcall, R_NilValue));
> 		hcall = LCONS(mkString(buf), hcall);
> 		hcall = LCONS(ENTRY_HANDLER(entry), hcall);
> 		PROTECT(hcall = LCONS(hooksym, hcall));
> 		eval(hcall, R_GlobalEnv);
> 		UNPROTECT(4);
> 	    }
> 	}
> 	else gotoExitingHandler(R_NilValue, call, entry);   // <<<  HERE
>    }
>    R_HandlerStack = oldstack;
> }
> 
> Would it be possible to construct a simple condition instead of passing down R_NilValue so that I can grab this error and deal with it. 
> 
> The alternative is to set the handler to be a calling one, but I?d like to avoid that as much as possible as this means going back to the R side of things just to get access to the condition. 
> 
> My code is here: https://gist.github.com/romainfrancois/9225811
> 
> I have only tested this on OSX with R-devel. The code only uses R internal api (not Rcpp*). 
> 
> So down to what I?d like you to consider please if you are still reading here. Can we feed gotoExitingHandler with something more interesting than NULL. please. 
> 
> 
> 
> The end game is to add one layer of abstraction, e.g. pass to R_ToplevelExec a function that first deals with contexts, then calls an actual function. Combining this with lambda functions in C++ will make quite a nice and elegant way to handle error handling at the C++ level. 
> 
> I can provide the code that would create the simpleError, this is just making a simple VECSXP with names and classes, no big trouble here. 
> 
> Romain
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Thu Feb 27 11:50:04 2014
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 27 Feb 2014 11:50:04 +0100
Subject: [Rd] R and LANGUAGE
In-Reply-To: <1392925173.21613.22.camel@mothra.biostat.mcw.edu>
References: <1392925173.21613.22.camel@mothra.biostat.mcw.edu>
Message-ID: <21263.6236.996046.861313@stat.math.ethz.ch>

Diverted from  ESS-help.

It is really about R's LANGUAGE, locales  and
then a wish for   sessionInfo() :

>>>>> Sparapani, Rodney <rsparapa at mcw.edu>
>>>>>     on Thu, 20 Feb 2014 19:39:33 +0000 writes:

    >> Just guessing: perhaps this is something that is set when
    >> R is initialized and not queried every time something is
    >> printed?
    >> 
    >> Kasper

    > Hi Kasper:

    > Good guess, but wrong ;o) Actually, the problem is in
    > Sys.getlocale() Recent versions of R have this in its
    > help...

    >      Note that the ?LANGUAGE? environment variable has
    > precedence over ?"LC_MESSAGES"? in selecting the language
    > for message translation on most R platforms.

    > However, the function itself just ignores LANGUAGE.  I
    > searched bugzilla, but did not find anything related to
    > LANGUAGE or Sys.getlocale() I guess this is a feature :o)

Note that  'locale'  is general OS / system term, 
which R cannot define. 
On a Unix alike (e.g., here, Fedora Linux), if you have defined the 
   LC_*  plus LANG  plus LANGUAGE   
variables,

	locale

only  prints the  LC_* stuff  and LANG, but not LANGUAGE.
I did not dig, but I'm pretty sure  LANGUAGE is R's own way to specify
the messages language  *in addition* to locale settings,
and with higher precedence, as you've mentioned above.

Hence Sys.getlocale() should clearly  *not* report LANGUAGE.

OTOH,

  > Sys.getlocale()
  [1] "LC_CTYPE=de_CH.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=de_CH.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=de_CH.UTF-8;LC_PAPER=de_CH.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=de_CH.UTF-8;LC_IDENTIFICATION=C"
  > Sys.getenv("LANG")
  [1] "de_CH.UTF-8"
  > Sys.getenv("LANGUAGE")
  [1] "en"
  > 

So,  Sys.getlocale() also does not report  LANG,
even though,  'locale'  does report that for me.

--------------------------------------

After all the above, and a bit independent of that :

I believe you are right, and R's  sessionInfo()
should report something like LANGUAGE,
as that "hides" the setting of LC_MESSAGES.

Where "something like" could mean one of several possibilities:
a) in spite of the above, add  "LANGUAGE=.." to the locale part
   of sessionInfo()'s result.
b) A new entry LANGUAGE as part of the result.

And 'b)' typically should be combined with a tweak to the
print.sessionInfo()  method.  It could say
   "Language for messages:" instead of "LANGUAGE"

Martin

-
Martin Maechler, ETH Zurich


From romain at r-enthusiasts.com  Thu Feb 27 12:38:09 2014
From: romain at r-enthusiasts.com (=?windows-1252?Q?Romain_Fran=E7ois?=)
Date: Thu, 27 Feb 2014 12:38:09 +0100
Subject: [Rd] help with gotoExitingHandler(R_NilValue, call, entry);
	. Implementation of error handling internally
In-Reply-To: <E831BF4D-6DD3-44AB-AAE9-2DADF18819D8@r-enthusiasts.com>
References: <23F7D6BB-528B-4FA2-B576-3FB80250B1C3@r-enthusiasts.com>
	<E831BF4D-6DD3-44AB-AAE9-2DADF18819D8@r-enthusiasts.com>
Message-ID: <0674D275-0390-4025-94BC-C8EA0722BA50@r-enthusiasts.com>

Never mind. For my initial question, I can just use: R_curErrorBuf

My current implementation now only depend on R_FunTab and R_GlobalContext which R does not conceal behind attribute_hidden. 
https://github.com/romainfrancois/Rcpp11/blob/master/inst/include/Rcpp/Context.h

Romain

Le 27 f?vr. 2014 ? 08:13, Romain Fran?ois <romain at r-enthusiasts.com> a ?crit :

> Of course one problem is that R hides things that I need for this, such as R_HandlerStack and R_ReturnedValue. 
> 
> I understand they have to be hidden, in which case can we have an exposed mechanism similar to what R_ToplevelExec does, but with the added functionality of giving access to the condition where R_ToplevelExec would return TRUE. 
> 
> Would someone be willing to review a patch to R with this added functionality. Please. 
> 
> In any case, I still would like some comments about my initial question about R_NilValue use in gotoExitingHandler(R_NilValue, call, entry);
> 
> Romain
> 
> Le 26 f?vr. 2014 ? 09:41, Romain Fran?ois <romain at r-enthusiasts.com> a ?crit :
> 
>> Hello, 
>> 
>> I?m trying to leverage R_ToplevelExec to implement C level try/catch. 
>> 
>> The way it is implemented allows for running a function in a top level context. This context gets an empty handler stack, so either the function runs correctly or it jumps. When it jumps, it does not find a handler, so it jumps to the top level context. 
>> 
>> R does not allow me to call begin context and end context directly, so instead what I do is call R_ToplevelExec, grab the global context inside the function, install my own handler that I don?t set to be a calling one, pretend this context is a CTXT_FUNCTION. 
>> 
>> Eventually I get to jump fun, so that I can later on grab the condition from R_ReturnedValue. 
>> 
>> This works well in the ? not simple error ? case, i.e. if I call stop( simpleError(...) ), but with simple errors, i.e. calls to Rf_error internally or bare calls to stop( "vvzvz" ) I can?t access the error. 
>> 
>> And this boils down to this call: 
>> 
>> gotoExitingHandler(R_NilValue, call, entry);
>> 
>> inside vsignalError : 
>> 
>> static void vsignalError(SEXP call, const char *format, va_list ap)
>> {
>>   char localbuf[BUFSIZE];
>>   SEXP list, oldstack;
>> 
>>   oldstack = R_HandlerStack;
>>   Rvsnprintf(localbuf, BUFSIZE - 1, format, ap);
>>   while ((list = findSimpleErrorHandler()) != R_NilValue) {
>> 	char *buf = errbuf;
>> 	SEXP entry = CAR(list);
>> 	R_HandlerStack = CDR(list);
>> 	strncpy(buf, localbuf, BUFSIZE - 1);
>> 	/*	Rvsnprintf(buf, BUFSIZE - 1, format, ap);*/
>> 	buf[BUFSIZE - 1] = 0;
>> 	if (IS_CALLING_ENTRY(entry)) {
>> 	    if (ENTRY_HANDLER(entry) == R_RestartToken)
>> 		return; /* go to default error handling; do not reset stack */
>> 	    else {
>> 		SEXP hooksym, hcall, qcall;
>> 		/* protect oldstack here, not outside loop, so handler
>> 		   stack gets unwound in case error is protect stack
>> 		   overflow */
>> 		PROTECT(oldstack);
>> 		hooksym = install(".handleSimpleError");
>> 		PROTECT(qcall = LCONS(R_QuoteSymbol,
>> 				      LCONS(call, R_NilValue)));
>> 		PROTECT(hcall = LCONS(qcall, R_NilValue));
>> 		hcall = LCONS(mkString(buf), hcall);
>> 		hcall = LCONS(ENTRY_HANDLER(entry), hcall);
>> 		PROTECT(hcall = LCONS(hooksym, hcall));
>> 		eval(hcall, R_GlobalEnv);
>> 		UNPROTECT(4);
>> 	    }
>> 	}
>> 	else gotoExitingHandler(R_NilValue, call, entry);   // <<<  HERE
>>   }
>>   R_HandlerStack = oldstack;
>> }
>> 
>> Would it be possible to construct a simple condition instead of passing down R_NilValue so that I can grab this error and deal with it. 
>> 
>> The alternative is to set the handler to be a calling one, but I?d like to avoid that as much as possible as this means going back to the R side of things just to get access to the condition. 
>> 
>> My code is here: https://gist.github.com/romainfrancois/9225811
>> 
>> I have only tested this on OSX with R-devel. The code only uses R internal api (not Rcpp*). 
>> 
>> So down to what I?d like you to consider please if you are still reading here. Can we feed gotoExitingHandler with something more interesting than NULL. please. 
>> 
>> 
>> 
>> The end game is to add one layer of abstraction, e.g. pass to R_ToplevelExec a function that first deals with contexts, then calls an actual function. Combining this with lambda functions in C++ will make quite a nice and elegant way to handle error handling at the C++ level. 
>> 
>> I can provide the code that would create the simpleError, this is just making a simple VECSXP with names and classes, no big trouble here. 
>> 
>> Romain
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Thu Feb 27 19:45:00 2014
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 27 Feb 2014 19:45:00 +0100
Subject: [Rd] R and LANGUAGE
In-Reply-To: <21263.6236.996046.861313@stat.math.ethz.ch>
References: <1392925173.21613.22.camel@mothra.biostat.mcw.edu>
	<21263.6236.996046.861313@stat.math.ethz.ch>
Message-ID: <21263.34732.140794.413614@stat.math.ethz.ch>

>>>>> Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Thu, 27 Feb 2014 11:50:04 +0100 writes:

    > Diverted from  ESS-help.
    > It is really about R's LANGUAGE, locales  and
    > then a wish for   sessionInfo() :

>>>>> Sparapani, Rodney <rsparapa at mcw.edu>
>>>>>     on Thu, 20 Feb 2014 19:39:33 +0000 writes:

    >>> Just guessing: perhaps this is something that is set when
    >>> R is initialized and not queried every time something is
    >>> printed?
    >>> 
    >>> Kasper

    >> Hi Kasper:

    >> Good guess, but wrong ;o) Actually, the problem is in
    >> Sys.getlocale() Recent versions of R have this in its
    >> help...

    >> Note that the ?LANGUAGE? environment variable has
    >> precedence over ?"LC_MESSAGES"? in selecting the language
    >> for message translation on most R platforms.

    >> However, the function itself just ignores LANGUAGE.  I
    >> searched bugzilla, but did not find anything related to
    >> LANGUAGE or Sys.getlocale() I guess this is a feature :o)

    > Note that  'locale'  is general OS / system term, 
    > which R cannot define. 
    > On a Unix alike (e.g., here, Fedora Linux), if you have defined the 
    > LC_*  plus LANG  plus LANGUAGE   
    > variables,

    > locale

    > only  prints the  LC_* stuff  and LANG, but not LANGUAGE.
    > I did not dig, but I'm pretty sure  LANGUAGE is R's own way to specify
    > the messages language  *in addition* to locale settings,
    > and with higher precedence, as you've mentioned above.

    > Hence Sys.getlocale() should clearly  *not* report LANGUAGE.

    > OTOH,

    >> Sys.getlocale()
    > [1] "LC_CTYPE=de_CH.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=de_CH.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=de_CH.UTF-8;LC_PAPER=de_CH.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=de_CH.UTF-8;LC_IDENTIFICATION=C"
    >> Sys.getenv("LANG")
    > [1] "de_CH.UTF-8"
    >> Sys.getenv("LANGUAGE")
    > [1] "en"
    >> 

    > So,  Sys.getlocale() also does not report  LANG,
    > even though,  'locale'  does report that for me.

I've been partly wrong and incomplete in what I said above.
Two kind fellow R corers pointed me to

the  'R-admin' manual

and to

    <http://www.gnu.org/software/gettext/manual/html_node/The-LANGUAGE-variable.html#The-LANGUAGE-variable>
    <http://www.gnu.org/software/gettext/manual/html_node/Locale-Environment-Variables.html#Locale-Environment-Variables>

for an explanation of LANGUAGE and other locale env vars.

and note that LANGUAGE is specific to GNU gettext, which is why we describe 
it as 'on many systems' .......
and also note that not installations / OSes are using the glibc
library for gettext which is also assumed in parts of the GNU
manuals above.

If (and how if)  sessionInfo() should be improved, by having it
report more about the LANG/LANGUAGE/LC_*   is a different topic,
that we will hopefully settle as well...

Martin.


From skostysh at princeton.edu  Thu Feb 27 22:43:02 2014
From: skostysh at princeton.edu (Scott Kostyshak)
Date: Thu, 27 Feb 2014 16:43:02 -0500
Subject: [Rd] [PATCH] suggestions for R-lang manual
In-Reply-To: <CAE3=dmefQSwG-AELeZmZFHi90VaknXUtEgfsVQgxii7J0Z75cg@mail.gmail.com>
References: <CAE3=dmefQSwG-AELeZmZFHi90VaknXUtEgfsVQgxii7J0Z75cg@mail.gmail.com>
Message-ID: <CAE3=dmcKmmaQtSwx41i_PUfeC3o1z7rRTUWSBHfK64T-bpjbaQ@mail.gmail.com>

On Thu, Nov 21, 2013 at 1:17 AM, Scott Kostyshak <skostysh at princeton.edu> wrote:
> Attached is a patch with suggestions for the R-lang manual at r64277.
>
> Below are a few comments (some are implemented in the patch):
>
> In the section "Objects", there is a table introduced by "The
> following table describes the possible values returned by typeof". One
> of the results is "any". Can "any" be returned by "typeof()" ?
>
> Regarding the "Recycling rules" section,
>
> -One exception is that when adding vectors to matrices, a warning is not
> -given if the lengths are incompatible.
> - at c Is that a bug?
> -
>
> was this a bug that was fixed? I see the following behavior:
>
>> myvec <- 1:3
>> mymat <- matrix(1:12, ncol=2)
>> myvec <- 1:5
>> myvec + mymat
>      [,1] [,2]
> [1,]    2    9
> [2,]    4   11
> [3,]    6   13
> [4,]    8   15
> [5,]   10   12
> [6,]    7   14
> Warning message:
> In myvec + mymat :
>   longer object length is not a multiple of shorter object length
>>
>
> Regarding
>
> -The arguments in the call to the generic are rematched with the
> -arguments for the method using the standard argument matching mechanism.
> -The first argument, i.e.@: the object, will have been evaluated.
> -
>
> this information is duplicated. See a few paragraphs up "When the
> method is invoked it is called..."
>
> Scott
>
>
> --
> Scott Kostyshak
> Economics PhD Candidate
> Princeton University

The patch still applies cleanly (one offset) on r65090.

Best,

Scott


--
Scott Kostyshak
Economics PhD Candidate
Princeton University


From mdsumner at gmail.com  Fri Feb 28 05:25:46 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 28 Feb 2014 15:25:46 +1100
Subject: [Rd] vignettes with similar names
Message-ID: <CAAcGz98tvCGXVMUjC2tp3-71fbcQ7zBeo3ksB8qeh15Rq7FsYQ@mail.gmail.com>

In R 3.0.2 Patched (2014-01-31 r64905) and 3.0.3 beta (2014-02-25
r65077) I see a problem loading vignettes when I create a package with
two vignettes with similar names, e.g.

"vignette3"
"vignette3-install"

These seem not to be distinguished, and I get this

vignette("vignette3")
vignette ?vignette3? not found

vignette("vignette3-install")
Warning message:
vignette ?vignette3-install? found more than once,
using the one found in ?.?

This was not an issue in 2.15.3, and it works correctly in R-dev
(2014-02-17 r65021).

Cheers, Mike.


From desithree at yahoo.com  Fri Feb 28 01:01:42 2014
From: desithree at yahoo.com (Desi Three)
Date: Thu, 27 Feb 2014 16:01:42 -0800 (PST)
Subject: [Rd] how to draw scatter plots (etc) with streaming data
Message-ID: <1393545702.84707.YahooMailNeo@web121203.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20140227/a26a0f3b/attachment.pl>

From ripley at stats.ox.ac.uk  Fri Feb 28 13:02:26 2014
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 28 Feb 2014 12:02:26 +0000
Subject: [Rd] vignettes with similar names
In-Reply-To: <CAAcGz98tvCGXVMUjC2tp3-71fbcQ7zBeo3ksB8qeh15Rq7FsYQ@mail.gmail.com>
References: <CAAcGz98tvCGXVMUjC2tp3-71fbcQ7zBeo3ksB8qeh15Rq7FsYQ@mail.gmail.com>
Message-ID: <53107AD2.5030404@stats.ox.ac.uk>

On 28/02/2014 04:25, Michael Sumner wrote:
> In R 3.0.2 Patched (2014-01-31 r64905) and 3.0.3 beta (2014-02-25
> r65077) I see a problem loading vignettes when I create a package with
> two vignettes with similar names, e.g.
>
> "vignette3"
> "vignette3-install"
>
> These seem not to be distinguished, and I get this
>
> vignette("vignette3")
> vignette ?vignette3? not found
>
> vignette("vignette3-install")
> Warning message:
> vignette ?vignette3-install? found more than once,
> using the one found in ?.?
>
> This was not an issue in 2.15.3, and it works correctly in R-dev
> (2014-02-17 r65021).

Maybe, but we don't have a 'commented, minimal, self-contained, 
reproducible' example, to quote the posting guide.

However, R 3.0.x is in code freeze and will be completely frozen next week.

So your only recourse for 3.0.x is to avoid such names.

> Cheers, Mike.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From macqueen1 at llnl.gov  Fri Feb 28 17:59:46 2014
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Fri, 28 Feb 2014 16:59:46 +0000
Subject: [Rd] how to draw scatter plots (etc) with streaming data
In-Reply-To: <1393545702.84707.YahooMailNeo@web121203.mail.ne1.yahoo.com>
References: <1393545702.84707.YahooMailNeo@web121203.mail.ne1.yahoo.com>
Message-ID: <CF35FF55.ED822%macqueen1@llnl.gov>

I'm not sure whether R-help or R-devel is appropriate...

But here's a little simulation to help get you started with the plotting
part:

plot( c(1,100) , c(-6,6), type='n')
for (x in 1:100) {points(x, rnorm(1)) ; Sys.sleep(1)}

-Don


-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 2/27/14 4:01 PM, "Desi Three" <desithree at yahoo.com> wrote:

>I am working with R for few weeks and I am trying to use it for my
>following scenario.
>
>1)I have a java code that is receiving streaming data on a thread
>2) am hoping to instantiate R some how (may use one of rjava,jri,rserv;
>not yet sure which one is right)
>3) how can I draw scatter plot with this streaming data. Should I
>recreate plot with newly created data frame? If so, I am getting data at
>every second and recreating plots may not be efficient. I would like to
>have a solution in R, where I will add this new data to existing plots.
>
>I am looking to draw plots in R, because I am going to represent this
>data in multiple graphs (including the output of regression graphs every
>10 mins). I looked into shiny package, but shiny (as I understand)
>doesn't take external data sets
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel


From jayesh.baviskar at equestind.com  Fri Feb 28 09:42:24 2014
From: jayesh.baviskar at equestind.com (jayesh.baviskar)
Date: Fri, 28 Feb 2014 00:42:24 -0800 (PST)
Subject: [Rd] How to use R script inside javascript?
Message-ID: <1393576944534-4685988.post@n4.nabble.com>

Hello all,

I want to use r script inside the webpage. I come to know that is it
possible to embed R script with HTML.

I want your help guys. I want to use package like "quantmod" inside my
webpage.

Thanks in advance & positively awaiting for your suggestions.

Regards,

Jayesh Baviskar  





--
View this message in context: http://r.789695.n4.nabble.com/How-to-use-R-script-inside-javascript-tp4685988.html
Sent from the R devel mailing list archive at Nabble.com.


